import{T as sp,c as wg,m as tf,a as Tg,l as No,b as Fa,d as ec,p as rf,e as qo,f as kg,g as Eg,t as Sg,v as Ig,h as Cg}from"../chunks/Table.svelte_svelte_type_style_lang.b70fa270.js";import{b as wu}from"../chunks/paths.3547eff1.js";import{S as fi,i as di,s as pi,e as bt,b as ge,v as ci,d as Le,f as ui,g as Ee,h as X,y as Et,z as At,A as St,B as It,C as ar,k as xe,a as Ze,l as be,m as Se,c as Xe,n as ie,P as _t,E as he,G as or,H as lr,I as cr,T as $i,L as ks,M as Es,q as st,r as at,u as jt,D as ap,F as op,W as sa,p as qe,O as tc,J as Go,K as Tu,X as ic,N as Bt,Y as lp,Z as cp,_ as ku,Q as Ss,V as up,o as Eu,$ as Su,a0 as Ag,w as oc,a1 as Iu,a2 as Cu,x as nf,a3 as zg,a4 as hp}from"../chunks/index.4b7e7ed9.js";import{w as fp,h as dp}from"../chunks/singletons.fc952f65.js";import{p as Mg}from"../chunks/stores.7b0fd8af.js";function Pg(d){let n,c;return n=new sp({props:{id:d[0],cls:d[1],theme:d[6],background:d[8],overrides:d[7],$$slots:{default:[Lg]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.id=l[0]),h&2&&(_.cls=l[1]),h&64&&(_.theme=l[6]),h&256&&(_.background=l[8]),h&128&&(_.overrides=l[7]),h&5692&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Dg(d){let n,c;return n=new sp({props:{id:d[0],cls:d[1],theme:d[6],background:d[8],overrides:d[7],$$slots:{default:[Bg]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.id=l[0]),h&2&&(_.cls=l[1]),h&64&&(_.theme=l[6]),h&256&&(_.background=l[8]),h&128&&(_.overrides=l[7]),h&5692&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function sf(d){let n;return{c(){n=xe("div"),this.h()},l(c){n=be(c,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","ons-spacer")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function af(d){let n;return{c(){n=xe("div"),this.h()},l(c){n=be(c,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","ons-spacer")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function Lg(d){let n,c,l,h,_,x=d[4]&&sf();const s=d[11].default,b=ar(s,d,d[12],null);let S=d[5]&&af();return{c(){n=xe("div"),x&&x.c(),c=Ze(),b&&b.c(),l=Ze(),S&&S.c(),this.h()},l(I){n=be(I,"DIV",{id:!0,class:!0});var P=Se(n);x&&x.l(P),c=Xe(P),b&&b.l(P),l=Xe(P),S&&S.l(P),P.forEach(X),this.h()},h(){ie(n,"id",d[10]),ie(n,"class",h="ons-page__container ons-container "+d[9]+" svelte-1i9f2l"),_t(n,"ons-page__container--wider",d[2]==="wider"),_t(n,"ons-page__container--full",d[2]==="full"),_t(n,"ons-page__container--tall-height",d[3]==="tall"),_t(n,"ons-page__container--full-height",d[3]==="full")},m(I,P){ge(I,n,P),x&&x.m(n,null),he(n,c),b&&b.m(n,null),he(n,l),S&&S.m(n,null),_=!0},p(I,P){I[4]?x||(x=sf(),x.c(),x.m(n,c)):x&&(x.d(1),x=null),b&&b.p&&(!_||P&4096)&&or(b,s,I,I[12],_?cr(s,I[12],P,null):lr(I[12]),null),I[5]?S||(S=af(),S.c(),S.m(n,null)):S&&(S.d(1),S=null),(!_||P&1024)&&ie(n,"id",I[10]),(!_||P&512&&h!==(h="ons-page__container ons-container "+I[9]+" svelte-1i9f2l"))&&ie(n,"class",h),(!_||P&516)&&_t(n,"ons-page__container--wider",I[2]==="wider"),(!_||P&516)&&_t(n,"ons-page__container--full",I[2]==="full"),(!_||P&520)&&_t(n,"ons-page__container--tall-height",I[3]==="tall"),(!_||P&520)&&_t(n,"ons-page__container--full-height",I[3]==="full")},i(I){_||(Ee(b,I),_=!0)},o(I){Le(b,I),_=!1},d(I){I&&X(n),x&&x.d(),b&&b.d(I),S&&S.d()}}}function of(d){let n;return{c(){n=xe("div"),this.h()},l(c){n=be(c,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","ons-spacer")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function lf(d){let n;return{c(){n=xe("div"),this.h()},l(c){n=be(c,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","ons-spacer")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function Bg(d){let n,c,l,h,_,x,s=d[4]&&of();const b=d[11].default,S=ar(b,d,d[12],null);let I=d[5]&&lf();return{c(){n=xe("div"),s&&s.c(),c=Ze(),l=xe("div"),S&&S.c(),h=Ze(),I&&I.c(),this.h()},l(P){n=be(P,"DIV",{id:!0,class:!0});var z=Se(n);s&&s.l(z),c=Xe(z),l=be(z,"DIV",{class:!0});var V=Se(l);S&&S.l(V),V.forEach(X),h=Xe(z),I&&I.l(z),z.forEach(X),this.h()},h(){ie(l,"class","svelte-1i9f2l"),_t(l,"ons-page__container--narrow",d[2]==="narrow"),_t(l,"ons-page__container--medium",d[2]==="medium"),ie(n,"id",d[10]),ie(n,"class",_="ons-page__container ons-container "+d[9]+" svelte-1i9f2l"),_t(n,"ons-page__container--tall-height",d[3]==="tall"),_t(n,"ons-page__container--full-height",d[3]==="full")},m(P,z){ge(P,n,z),s&&s.m(n,null),he(n,c),he(n,l),S&&S.m(l,null),he(n,h),I&&I.m(n,null),x=!0},p(P,z){P[4]?s||(s=of(),s.c(),s.m(n,c)):s&&(s.d(1),s=null),S&&S.p&&(!x||z&4096)&&or(S,b,P,P[12],x?cr(b,P[12],z,null):lr(P[12]),null),(!x||z&4)&&_t(l,"ons-page__container--narrow",P[2]==="narrow"),(!x||z&4)&&_t(l,"ons-page__container--medium",P[2]==="medium"),P[5]?I||(I=lf(),I.c(),I.m(n,null)):I&&(I.d(1),I=null),(!x||z&1024)&&ie(n,"id",P[10]),(!x||z&512&&_!==(_="ons-page__container ons-container "+P[9]+" svelte-1i9f2l"))&&ie(n,"class",_),(!x||z&520)&&_t(n,"ons-page__container--tall-height",P[3]==="tall"),(!x||z&520)&&_t(n,"ons-page__container--full-height",P[3]==="full")},i(P){x||(Ee(S,P),x=!0)},o(P){Le(S,P),x=!1},d(P){P&&X(n),s&&s.d(),S&&S.d(P),I&&I.d()}}}function Rg(d){let n,c,l,h,_;const x=[Dg,Pg],s=[];function b(S,I){return I&4&&(n=null),n==null&&(n=!!["narrow","medium"].includes(S[2])),n?0:1}return c=b(d,-1),l=s[c]=x[c](d),{c(){l.c(),h=bt()},l(S){l.l(S),h=bt()},m(S,I){s[c].m(S,I),ge(S,h,I),_=!0},p(S,[I]){let P=c;c=b(S,I),c===P?s[c].p(S,I):(ci(),Le(s[P],1,1,()=>{s[P]=null}),ui(),l=s[c],l?l.p(S,I):(l=s[c]=x[c](S),l.c()),Ee(l,1),l.m(h.parentNode,h))},i(S){_||(Ee(l),_=!0)},o(S){Le(l),_=!1},d(S){s[c].d(S),S&&X(h)}}}function Fg(d,n,c){let l,h,{$$slots:_={},$$scope:x}=n,{id:s=null}=n,{cls:b=null}=n,{width:S="wide"}=n,{height:I="auto"}=n,{marginTop:P=!1}=n,{marginBottom:z=!1}=n,{theme:V=null}=n,{themeOverrides:N=null}=n,{background:R=null}=n;return d.$$set=K=>{"id"in K&&c(0,s=K.id),"cls"in K&&c(1,b=K.cls),"width"in K&&c(2,S=K.width),"height"in K&&c(3,I=K.height),"marginTop"in K&&c(4,P=K.marginTop),"marginBottom"in K&&c(5,z=K.marginBottom),"theme"in K&&c(6,V=K.theme),"themeOverrides"in K&&c(7,N=K.themeOverrides),"background"in K&&c(8,R=K.background),"$$scope"in K&&c(12,x=K.$$scope)},d.$$.update=()=>{d.$$.dirty&321&&c(10,l=s&&!(V||R)?s:null),d.$$.dirty&322&&c(9,h=b&&!(V||R)?b:"")},[s,b,S,I,P,z,V,N,R,h,l,_,x]}class lc extends fi{constructor(n){super(),di(this,n,Fg,Rg,pi,{id:0,cls:1,width:2,height:3,marginTop:4,marginBottom:5,theme:6,themeOverrides:7,background:8})}}var Og=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pp(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function cf(d,n,c){const l=d.slice();return l[5]=n[c],l}function Vg(d){let n=d[5].label+"",c;return{c(){c=st(n)},l(l){c=at(l,n)},m(l,h){ge(l,c,h)},p(l,h){h&1&&n!==(n=l[5].label+"")&&jt(c,n)},d(l){l&&X(c)}}}function Ug(d){let n,c=d[5].label+"",l,h;return{c(){n=xe("a"),l=st(c),this.h()},l(_){n=be(_,"A",{class:!0,href:!0});var x=Se(n);l=at(x,c),x.forEach(X),this.h()},h(){ie(n,"class","ons-breadcrumb__link"),ie(n,"href",h=d[5].href)},m(_,x){ge(_,n,x),he(n,l)},p(_,x){x&1&&c!==(c=_[5].label+"")&&jt(l,c),x&1&&h!==(h=_[5].href)&&ie(n,"href",h)},d(_){_&&X(n)}}}function uf(d){let n,c,l,h,_;function x(S,I){return S[5].href?Ug:Vg}let s=x(d),b=s(d);return{c(){n=xe("li"),b.c(),c=Ze(),l=ks("svg"),h=ks("path"),_=Ze(),this.h()},l(S){n=be(S,"LI",{class:!0});var I=Se(n);b.l(I),c=Xe(I),l=Es(I,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0});var P=Se(l);h=Es(P,"path",{d:!0,transform:!0}),Se(h).forEach(X),P.forEach(X),_=Xe(I),I.forEach(X),this.h()},h(){ie(h,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),ie(h,"transform","translate(-5.02 -1.59)"),ie(l,"class","ons-svg-icon svelte-w4p0hu"),ie(l,"viewBox","0 0 8 13"),ie(l,"xmlns","http://www.w3.org/2000/svg"),ie(l,"focusable","false"),ie(n,"class","ons-breadcrumb__item ons-u-p-no")},m(S,I){ge(S,n,I),b.m(n,null),he(n,c),he(n,l),he(l,h),he(n,_)},p(S,I){s===(s=x(S))&&b?b.p(S,I):(b.d(1),b=s(S),b&&(b.c(),b.m(n,c)))},d(S){S&&X(n),b.d()}}}function Ng(d){let n,c,l=d[0],h=[];for(let _=0;_<l.length;_+=1)h[_]=uf(cf(d,l,_));return{c(){n=xe("nav"),c=xe("ol");for(let _=0;_<h.length;_+=1)h[_].c();this.h()},l(_){n=be(_,"NAV",{class:!0,"aria-label":!0});var x=Se(n);c=be(x,"OL",{class:!0});var s=Se(c);for(let b=0;b<h.length;b+=1)h[b].l(s);s.forEach(X),x.forEach(X),this.h()},h(){ie(c,"class","ons-breadcrumb__items ons-u-fs-s"),ie(n,"class","ons-breadcrumb print--hide"),ie(n,"aria-label","Breadcrumbs")},m(_,x){ge(_,n,x),he(n,c);for(let s=0;s<h.length;s+=1)h[s]&&h[s].m(c,null)},p(_,x){if(x&1){l=_[0];let s;for(s=0;s<l.length;s+=1){const b=cf(_,l,s);h[s]?h[s].p(b,x):(h[s]=uf(b),h[s].c(),h[s].m(c,null))}for(;s<h.length;s+=1)h[s].d(1);h.length=l.length}},d(_){_&&X(n),$i(h,_)}}}function jg(d){let n,c;return n=new lc({props:{theme:d[2],themeOverrides:d[3],width:d[1],background:d[4],$$slots:{default:[Ng]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,[h]){const _={};h&4&&(_.theme=l[2]),h&8&&(_.themeOverrides=l[3]),h&2&&(_.width=l[1]),h&16&&(_.background=l[4]),h&257&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Gg(d,n,c){let{links:l=[]}=n,{width:h="wide"}=n,{theme:_=null}=n,{themeOverrides:x=null}=n,{background:s=null}=n;return d.$$set=b=>{"links"in b&&c(0,l=b.links),"width"in b&&c(1,h=b.width),"theme"in b&&c(2,_=b.theme),"themeOverrides"in b&&c(3,x=b.themeOverrides),"background"in b&&c(4,s=b.background)},[l,h,_,x,s]}class qg extends fi{constructor(n){super(),di(this,n,Gg,jg,pi,{links:0,width:1,theme:2,themeOverrides:3,background:4})}}function hf(d){let n,c;return{c(){n=xe("h2"),c=st(d[3]),this.h()},l(l){n=be(l,"H2",{class:!0});var h=Se(n);c=at(h,d[3]),h.forEach(X),this.h()},h(){ie(n,"class","section-title"),_t(n,"ons-u-vh",d[4])},m(l,h){ge(l,n,h),he(n,c)},p(l,h){h&8&&jt(c,l[3]),h&16&&_t(n,"ons-u-vh",l[4])},d(l){l&&X(n)}}}function Zg(d){let n,c,l,h=d[3]&&hf(d);const _=d[18].default,x=ar(_,d,d[20],null);return{c(){h&&h.c(),n=Ze(),c=xe("div"),x&&x.c(),this.h()},l(s){h&&h.l(s),n=Xe(s),c=be(s,"DIV",{class:!0});var b=Se(c);x&&x.l(b),b.forEach(X),this.h()},h(){ie(c,"class","grid "+d[12]+" svelte-1og4gya"),qe(c,"grid-gap",d[14]),qe(c,"min-height",d[13])},m(s,b){h&&h.m(s,b),ge(s,n,b),ge(s,c,b),x&&x.m(c,null),l=!0},p(s,b){s[3]?h?h.p(s,b):(h=hf(s),h.c(),h.m(n.parentNode,n)):h&&(h.d(1),h=null),x&&x.p&&(!l||b&1048576)&&or(x,_,s,s[20],l?cr(_,s[20],b,null):lr(s[20]),null)},i(s){l||(Ee(x,s),l=!0)},o(s){Le(x,s),l=!1},d(s){h&&h.d(s),s&&X(n),s&&X(c),x&&x.d(s)}}}function ff(d){let n,c,l;return c=new lc({props:{cls:d[1],theme:d[5],themeOverrides:d[6],width:"narrow",marginBottom:d[8],$$slots:{default:[Xg]},$$scope:{ctx:d}}}),{c(){n=xe("figcaption"),Et(c.$$.fragment),this.h()},l(h){n=be(h,"FIGCAPTION",{class:!0});var _=Se(n);At(c.$$.fragment,_),_.forEach(X),this.h()},h(){ie(n,"class","svelte-1og4gya")},m(h,_){ge(h,n,_),St(c,n,null),l=!0},p(h,_){const x={};_&2&&(x.cls=h[1]),_&32&&(x.theme=h[5]),_&64&&(x.themeOverrides=h[6]),_&256&&(x.marginBottom=h[8]),_&1049088&&(x.$$scope={dirty:_,ctx:h}),c.$set(x)},i(h){l||(Ee(c.$$.fragment,h),l=!0)},o(h){Le(c.$$.fragment,h),l=!1},d(h){h&&X(n),It(c)}}}function Xg(d){let n;return{c(){n=xe("span"),this.h()},l(c){n=be(c,"SPAN",{class:!0});var l=Se(n);l.forEach(X),this.h()},h(){ie(n,"class","ons-figure__caption")},m(c,l){ge(c,n,l),n.innerHTML=d[9]},p(c,l){l&512&&(n.innerHTML=c[9])},d(c){c&&X(n)}}}function Hg(d){let n,c,l,h,_;c=new lc({props:{id:d[0],cls:d[1],theme:d[5],themeOverrides:d[6],width:d[2],height:["tall","full"].includes(d[10])?d[10]:"auto",marginTop:d[7],marginBottom:d[9]?!1:d[8],$$slots:{default:[Zg]},$$scope:{ctx:d}}});let x=d[9]&&ff(d);return{c(){n=xe("figure"),Et(c.$$.fragment),l=Ze(),x&&x.c(),this.h()},l(s){n=be(s,"FIGURE",{"aria-label":!0,class:!0});var b=Se(n);At(c.$$.fragment,b),l=Xe(b),x&&x.l(b),b.forEach(X),this.h()},h(){ie(n,"aria-label",d[9]),ie(n,"class","svelte-1og4gya"),ap(()=>d[19].call(n))},m(s,b){ge(s,n,b),St(c,n,null),he(n,l),x&&x.m(n,null),h=op(n,d[19].bind(n)),_=!0},p(s,[b]){const S={};b&1&&(S.id=s[0]),b&2&&(S.cls=s[1]),b&32&&(S.theme=s[5]),b&64&&(S.themeOverrides=s[6]),b&4&&(S.width=s[2]),b&1024&&(S.height=["tall","full"].includes(s[10])?s[10]:"auto"),b&128&&(S.marginTop=s[7]),b&768&&(S.marginBottom=s[9]?!1:s[8]),b&1048600&&(S.$$scope={dirty:b,ctx:s}),c.$set(S),s[9]?x?(x.p(s,b),b&512&&Ee(x,1)):(x=ff(s),x.c(),Ee(x,1),x.m(n,null)):x&&(ci(),Le(x,1,1,()=>{x=null}),ui()),(!_||b&512)&&ie(n,"aria-label",s[9])},i(s){_||(Ee(c.$$.fragment,s),Ee(x),_=!0)},o(s){Le(c.$$.fragment,s),Le(x),_=!1},d(s){s&&X(n),It(c),x&&x.d(),h()}}}function Wg(d,n,c){let l,{$$slots:h={},$$scope:_}=n,{id:x=null}=n,{cls:s=null}=n,{width:b="medium"}=n,{title:S=""}=n,{hideTitle:I=!1}=n,{theme:P=null}=n,{themeOverrides:z=null}=n,{marginTop:V=!1}=n,{marginBottom:N=!0}=n,{colwidth:R="medium"}=n,{caption:K=""}=n,{height:ce=200}=n,{gap:ae=12}=n,Be=!R||R==="full"?"":`grid-${R}`,Oe=ce==="full"?"100vh":Number.isNaN(ce)?ce:ce+"px",ke=Number.isNaN(ae)?ae:ae+"px";const Ve={narrow:{w:180,c:4},medium:{w:280,c:3},wide:{w:400,c:2},full:{w:"100%",c:1}};let ze;const Ne=fp(Ve[R].c);sa("cols",Ne);function Ct(){ze=this.clientWidth,c(11,ze)}return d.$$set=dt=>{"id"in dt&&c(0,x=dt.id),"cls"in dt&&c(1,s=dt.cls),"width"in dt&&c(2,b=dt.width),"title"in dt&&c(3,S=dt.title),"hideTitle"in dt&&c(4,I=dt.hideTitle),"theme"in dt&&c(5,P=dt.theme),"themeOverrides"in dt&&c(6,z=dt.themeOverrides),"marginTop"in dt&&c(7,V=dt.marginTop),"marginBottom"in dt&&c(8,N=dt.marginBottom),"colwidth"in dt&&c(15,R=dt.colwidth),"caption"in dt&&c(9,K=dt.caption),"height"in dt&&c(10,ce=dt.height),"gap"in dt&&c(16,ae=dt.gap),"$$scope"in dt&&c(20,_=dt.$$scope)},d.$$.update=()=>{d.$$.dirty&100352&&c(17,l=R=="full"?1:ze?Math.floor((ze+ae)/(Ve[R].w+ae)):Ve[R].c),d.$$.dirty&131072&&Ne.set(l)},[x,s,b,S,I,P,z,V,N,K,ce,ze,Be,Oe,ke,R,ae,l,h,Ct,_]}class Kg extends fi{constructor(n){super(),di(this,n,Wg,Hg,pi,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:15,caption:9,height:10,gap:16})}}function Jg(d){let n;const c=d[13].default,l=ar(c,d,d[14],null);return{c(){l&&l.c()},l(h){l&&l.l(h)},m(h,_){l&&l.m(h,_),n=!0},p(h,_){l&&l.p&&(!n||_&16384)&&or(l,c,h,h[14],n?cr(c,h[14],_,null):lr(h[14]),null)},i(h){n||(Ee(l,h),n=!0)},o(h){Le(l,h),n=!1},d(h){l&&l.d(h)}}}function Yg(d){let n,c;return n=new Kg({props:{id:d[0],cls:d[1],width:d[2],height:d[10],title:d[3],hideTitle:d[4],theme:d[5],themeOverrides:d[6],marginTop:d[7],marginBottom:d[8],colwidth:d[9],gap:d[11],$$slots:{default:[Jg]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,[h]){const _={};h&1&&(_.id=l[0]),h&2&&(_.cls=l[1]),h&4&&(_.width=l[2]),h&1024&&(_.height=l[10]),h&8&&(_.title=l[3]),h&16&&(_.hideTitle=l[4]),h&32&&(_.theme=l[5]),h&64&&(_.themeOverrides=l[6]),h&128&&(_.marginTop=l[7]),h&256&&(_.marginBottom=l[8]),h&512&&(_.colwidth=l[9]),h&2048&&(_.gap=l[11]),h&16384&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Qg(d,n,c){let{$$slots:l={},$$scope:h}=n,{id:_=null}=n,{cls:x="ons-cards"}=n,{width:s="wide"}=n,{title:b=""}=n,{hideTitle:S=!1}=n,{theme:I=null}=n,{themeOverrides:P=null}=n,{marginTop:z=!1}=n,{marginBottom:V=!0}=n,{colwidth:N="medium"}=n,{height:R=200}=n,{noBackground:K=!1}=n,{gap:ce=K?36:16}=n;return sa("noBackground",K),d.$$set=ae=>{"id"in ae&&c(0,_=ae.id),"cls"in ae&&c(1,x=ae.cls),"width"in ae&&c(2,s=ae.width),"title"in ae&&c(3,b=ae.title),"hideTitle"in ae&&c(4,S=ae.hideTitle),"theme"in ae&&c(5,I=ae.theme),"themeOverrides"in ae&&c(6,P=ae.themeOverrides),"marginTop"in ae&&c(7,z=ae.marginTop),"marginBottom"in ae&&c(8,V=ae.marginBottom),"colwidth"in ae&&c(9,N=ae.colwidth),"height"in ae&&c(10,R=ae.height),"noBackground"in ae&&c(12,K=ae.noBackground),"gap"in ae&&c(11,ce=ae.gap),"$$scope"in ae&&c(14,h=ae.$$scope)},[_,x,s,b,S,I,P,z,V,N,R,ce,K,l,h]}class Au extends fi{constructor(n){super(),di(this,n,Qg,Yg,pi,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:9,height:10,noBackground:12,gap:11})}}const df=()=>Math.random().toString(16).slice(2,8),$g=(d,n=!1)=>typeof d=="string"?d.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").concat(n?`-${df()}`:""):df(),e_=d=>{if(!d)return!1;const n=new Date(d);return!isNaN(n)},pf=(d,n="en-GB",c={year:"numeric",month:"long",day:"2-digit"})=>new Date(d).toLocaleDateString(n,c);function t_(d){let n,c;return{c(){n=xe("h3"),c=st(d[0]),this.h()},l(l){n=be(l,"H3",{class:!0});var h=Se(n);c=at(h,d[0]),h.forEach(X),this.h()},h(){ie(n,"class","ons-card__title ons-u-fs-m"),_t(n,"ons-u-vh",d[2]),qe(n,"padding",d[8]?"":"8px 16px 0"),qe(n,"margin-bottom","5px")},m(l,h){ge(l,n,h),he(n,c)},p(l,h){h&1&&jt(c,l[0]),h&4&&_t(n,"ons-u-vh",l[2]),h&256&&qe(n,"padding",l[8]?"":"8px 16px 0")},d(l){l&&X(n)}}}function i_(d){let n,c,l,h,_=d[3]&&mf(d);return{c(){n=xe("a"),_&&_.c(),c=Ze(),l=xe("h3"),h=st(d[0]),this.h()},l(x){n=be(x,"A",{href:!0,class:!0});var s=Se(n);_&&_.l(s),c=Xe(s),l=be(s,"H3",{class:!0});var b=Se(l);h=at(b,d[0]),b.forEach(X),s.forEach(X),this.h()},h(){ie(l,"class","ons-card__title ons-u-fs-m"),qe(l,"padding",!d[8]&&!d[3]?"12px 16px 0":d[8]?"":"0 16px"),ie(n,"href",d[5]),ie(n,"class","ons-card__link ons-u-db"),_t(n,"ons-u-vh",d[2])},m(x,s){ge(x,n,s),_&&_.m(n,null),he(n,c),he(n,l),he(l,h)},p(x,s){x[3]?_?_.p(x,s):(_=mf(x),_.c(),_.m(n,c)):_&&(_.d(1),_=null),s&1&&jt(h,x[0]),s&264&&qe(l,"padding",!x[8]&&!x[3]?"12px 16px 0":x[8]?"":"0 16px"),s&32&&ie(n,"href",x[5]),s&4&&_t(n,"ons-u-vh",x[2])},d(x){x&&X(n),_&&_.d()}}}function mf(d){let n,c;return{c(){n=xe("img"),this.h()},l(l){n=be(l,"IMG",{class:!0,src:!0,alt:!0,loading:!0}),this.h()},h(){ie(n,"class","ons-card__image ons-u-mb-s svelte-k1nrya"),ic(n.src,c=d[3])||ie(n,"src",c),ie(n,"alt",d[4]),ie(n,"loading","lazy"),qe(n,"width","100%")},m(l,h){ge(l,n,h)},p(l,h){h&8&&!ic(n.src,c=l[3])&&ie(n,"src",c),h&16&&ie(n,"alt",l[4])},d(l){l&&X(n)}}}function r_(d){let n,c,l,h,_,x,s,b=`span ${d[9]&&d[10]<3?d[10]:d[6]==1?1:d[6]>d[10]?d[10]:d[6]}`,S;function I(R,K){if(R[5]&&R[0])return i_;if(R[0])return t_}let P=I(d),z=P&&P(d);const V=d[13].default,N=ar(V,d,d[12],null);return{c(){n=xe("div"),c=xe("div"),z&&z.c(),l=Ze(),h=xe("div"),N&&N.c(),this.h()},l(R){n=be(R,"DIV",{class:!0});var K=Se(n);c=be(K,"DIV",{id:!0,class:!0,"aria-describedby":!0});var ce=Se(c);z&&z.l(ce),l=Xe(ce),h=be(ce,"DIV",{id:!0,class:!0});var ae=Se(h);N&&N.l(ae),ae.forEach(X),ce.forEach(X),K.forEach(X),this.h()},h(){ie(h,"id",_=d[1]+"_text"),ie(h,"class","svelte-k1nrya"),_t(h,"tile__body",!d[8]),ie(c,"id",d[1]),ie(c,"class","ons-card"),ie(c,"aria-describedby",x=d[1]+"_text"),ie(n,"class",s=tc(d[8]?"":"tile tile__content")+" svelte-k1nrya"),qe(n,"grid-column",b),qe(n,"grid-column-end",d[9]?d[10]+1:null),qe(n,"grid-row",d[7]>1?`span ${d[7]}`:null)},m(R,K){ge(R,n,K),he(n,c),z&&z.m(c,null),he(c,l),he(c,h),N&&N.m(h,null),S=!0},p(R,[K]){P===(P=I(R))&&z?z.p(R,K):(z&&z.d(1),z=P&&P(R),z&&(z.c(),z.m(c,l))),N&&N.p&&(!S||K&4096)&&or(N,V,R,R[12],S?cr(V,R[12],K,null):lr(R[12]),null),(!S||K&2&&_!==(_=R[1]+"_text"))&&ie(h,"id",_),(!S||K&256)&&_t(h,"tile__body",!R[8]),(!S||K&2)&&ie(c,"id",R[1]),(!S||K&2&&x!==(x=R[1]+"_text"))&&ie(c,"aria-describedby",x),(!S||K&256&&s!==(s=tc(R[8]?"":"tile tile__content")+" svelte-k1nrya"))&&ie(n,"class",s),K&1600&&b!==(b=`span ${R[9]&&R[10]<3?R[10]:R[6]==1?1:R[6]>R[10]?R[10]:R[6]}`)&&qe(n,"grid-column",b),K&1536&&qe(n,"grid-column-end",R[9]?R[10]+1:null),K&128&&qe(n,"grid-row",R[7]>1?`span ${R[7]}`:null)},i(R){S||(Ee(N,R),S=!0)},o(R){Le(N,R),S=!1},d(R){R&&X(n),z&&z.d(),N&&N.d(R)}}}function n_(d,n,c){let l,{$$slots:h={},$$scope:_}=n,{title:x=null}=n,{id:s=$g(x)}=n,{hideTitle:b=!1}=n,{image:S=null}=n,{imageAlt:I=null}=n,{href:P=null}=n,{colspan:z=1}=n,{rowspan:V=1}=n,{noBackground:N=Go("noBackground")||!1}=n,{grow:R=!1}=n;const K=Go("cols");return Tu(d,K,ce=>c(10,l=ce)),d.$$set=ce=>{"title"in ce&&c(0,x=ce.title),"id"in ce&&c(1,s=ce.id),"hideTitle"in ce&&c(2,b=ce.hideTitle),"image"in ce&&c(3,S=ce.image),"imageAlt"in ce&&c(4,I=ce.imageAlt),"href"in ce&&c(5,P=ce.href),"colspan"in ce&&c(6,z=ce.colspan),"rowspan"in ce&&c(7,V=ce.rowspan),"noBackground"in ce&&c(8,N=ce.noBackground),"grow"in ce&&c(9,R=ce.grow),"$$scope"in ce&&c(12,_=ce.$$scope)},[x,s,b,S,I,P,z,V,N,R,l,K,_,h]}class Qn extends fi{constructor(n){super(),di(this,n,n_,r_,pi,{title:0,id:1,hideTitle:2,image:3,imageAlt:4,href:5,colspan:6,rowspan:7,noBackground:8,grow:9})}}function gf(d){let n,c;return{c(){n=xe("div"),c=st("!"),this.h()},l(l){n=be(l,"DIV",{class:!0,"aria-hidden":!0});var h=Se(n);c=at(h,"!"),h.forEach(X),this.h()},h(){ie(n,"class","ons-panel__icon"),ie(n,"aria-hidden","true")},m(l,h){ge(l,n,h),he(n,c)},d(l){l&&X(n)}}}function _f(d){let n,c,l;return{c(){n=xe("p"),c=xe("strong"),l=st(d[0])},l(h){n=be(h,"P",{});var _=Se(n);c=be(_,"STRONG",{});var x=Se(c);l=at(x,d[0]),x.forEach(X),_.forEach(X)},m(h,_){ge(h,n,_),he(n,c),he(c,l)},p(h,_){_&1&&jt(l,h[0])},d(h){h&&X(n)}}}function s_(d){let n,c,l,h,_,x,s,b,S,I,P,z=d[1]&&gf(),V=d[0]&&_f(d);const N=d[5].default,R=ar(N,d,d[4],null);return{c(){n=xe("div"),c=xe("div"),z&&z.c(),l=Ze(),h=xe("span"),_=st("Important information:"),x=Ze(),s=xe("div"),b=xe("div"),V&&V.c(),S=Ze(),I=xe("p"),R&&R.c(),this.h()},l(K){n=be(K,"DIV",{class:!0,style:!0});var ce=Se(n);c=be(ce,"DIV",{class:!0});var ae=Se(c);z&&z.l(ae),l=Xe(ae),h=be(ae,"SPAN",{class:!0});var Be=Se(h);_=at(Be,"Important information:"),Be.forEach(X),x=Xe(ae),s=be(ae,"DIV",{class:!0});var Oe=Se(s);b=be(Oe,"DIV",{class:!0});var ke=Se(b);V&&V.l(ke),S=Xe(ke),I=be(ke,"P",{class:!0});var Ve=Se(I);R&&R.l(Ve),Ve.forEach(X),ke.forEach(X),Oe.forEach(X),ae.forEach(X),ce.forEach(X),this.h()},h(){ie(h,"class","ons-panel__assistive-text ons-u-vh"),ie(I,"class","ons-u-mb-no"),ie(b,"class","ons-u-fs-r default-line-height"),ie(s,"class","ons-panel__body"),ie(c,"class","ons-u-bg--tr"),_t(c,"ons-panel--warn",d[1]),ie(n,"class","ons-panel ons-panel--info ons-panel--no-title ons-u-mt-m ons-u-mb-l svelte-g4zlbx"),ie(n,"style",d[2])},m(K,ce){ge(K,n,ce),he(n,c),z&&z.m(c,null),he(c,l),he(c,h),he(h,_),he(c,x),he(c,s),he(s,b),V&&V.m(b,null),he(b,S),he(b,I),R&&R.m(I,null),P=!0},p(K,[ce]){K[1]?z||(z=gf(),z.c(),z.m(c,l)):z&&(z.d(1),z=null),K[0]?V?V.p(K,ce):(V=_f(K),V.c(),V.m(b,S)):V&&(V.d(1),V=null),R&&R.p&&(!P||ce&16)&&or(R,N,K,K[4],P?cr(N,K[4],ce,null):lr(K[4]),null),(!P||ce&2)&&_t(c,"ons-panel--warn",K[1]),(!P||ce&4)&&ie(n,"style",K[2])},i(K){P||(Ee(R,K),P=!0)},o(K){Le(R,K),P=!1},d(K){K&&X(n),z&&z.d(),V&&V.d(),R&&R.d(K)}}}function a_(d,n,c){let l,{$$slots:h={},$$scope:_}=n,{title:x=null}=n,{important:s=!1}=n,{mode:b="info"}=n;return d.$$set=S=>{"title"in S&&c(0,x=S.title),"important"in S&&c(1,s=S.important),"mode"in S&&c(3,b=S.mode),"$$scope"in S&&c(4,_=S.$$scope)},d.$$.update=()=>{d.$$.dirty&8&&c(2,l=b==="success"?"background: var(--ons-color-success-tint); border-color: var(--ons-color-success);":b==="pending"?"background: var(--ons-color-pending-tint); border-color: var(--ons-color-pending);":b==="error"?"background: var(--ons-color-errors-tint); border-color: var(--ons-color-errors);":null)},[x,s,l,b,_,h]}class o_ extends fi{constructor(n){super(),di(this,n,a_,s_,pi,{title:0,important:1,mode:3})}}function yf(d,n,c){const l=d.slice();return l[1]=n[c],l[3]=c,l}function vf(d){let n,c=d[0],l=[];for(let h=0;h<c.length;h+=1)l[h]=bf(yf(d,c,h));return{c(){n=xe("dl");for(let h=0;h<l.length;h+=1)l[h].c();this.h()},l(h){n=be(h,"DL",{class:!0,title:!0,"aria-label":!0});var _=Se(n);for(let x=0;x<l.length;x+=1)l[x].l(_);_.forEach(X),this.h()},h(){ie(n,"class","ons-metadata metadata__list ons-grid ons-grid--gutterless ons-u-cf ons-u-mb-m"),ie(n,"title","Dataset ID and release date information"),ie(n,"aria-label","Dataset ID and release date information")},m(h,_){ge(h,n,_);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(n,null)},p(h,_){if(_&1){c=h[0];let x;for(x=0;x<c.length;x+=1){const s=yf(h,c,x);l[x]?l[x].p(s,_):(l[x]=bf(s),l[x].c(),l[x].m(n,null))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){h&&X(n),$i(l,h)}}}function l_(d){let n,c=d[1].value+"",l;return{c(){n=new lp(!1),l=bt(),this.h()},l(h){n=cp(h,!1),l=bt(),this.h()},h(){n.a=l},m(h,_){n.m(c,h,_),ge(h,l,_)},p(h,_){_&1&&c!==(c=h[1].value+"")&&n.p(c)},d(h){h&&X(l),h&&n.d()}}}function c_(d){let n,c=pf(d[1].value)+"",l,h,_,x,s=d[1].extra&&xf(d);return{c(){n=xe("time"),l=st(c),_=Ze(),s&&s.c(),x=bt(),this.h()},l(b){n=be(b,"TIME",{datetime:!0});var S=Se(n);l=at(S,c),S.forEach(X),_=Xe(b),s&&s.l(b),x=bt(),this.h()},h(){ie(n,"datetime",h=new Date(d[1].value).toISOString())},m(b,S){ge(b,n,S),he(n,l),ge(b,_,S),s&&s.m(b,S),ge(b,x,S)},p(b,S){S&1&&c!==(c=pf(b[1].value)+"")&&jt(l,c),S&1&&h!==(h=new Date(b[1].value).toISOString())&&ie(n,"datetime",h),b[1].extra?s?s.p(b,S):(s=xf(b),s.c(),s.m(x.parentNode,x)):s&&(s.d(1),s=null)},d(b){b&&X(n),b&&X(_),s&&s.d(b),b&&X(x)}}}function xf(d){let n,c=d[1].extra+"",l;return{c(){n=new lp(!1),l=bt(),this.h()},l(h){n=cp(h,!1),l=bt(),this.h()},h(){n.a=l},m(h,_){n.m(c,h,_),ge(h,l,_)},p(h,_){_&1&&c!==(c=h[1].extra+"")&&n.p(c)},d(h){h&&X(l),h&&n.d()}}}function bf(d){let n,c,l=d[1].key+"",h,_,x,s,b,S,I;function P(N,R){return R&1&&(b=null),b==null&&(b=!!e_(N[1].value)),b?c_:l_}let z=P(d,-1),V=z(d);return{c(){n=xe("div"),c=xe("dt"),h=st(l),_=st(":"),x=Ze(),s=xe("dd"),V.c(),S=Ze(),this.h()},l(N){n=be(N,"DIV",{class:!0});var R=Se(n);c=be(R,"DT",{class:!0});var K=Se(c);h=at(K,l),_=at(K,":"),K.forEach(X),x=Xe(R),s=be(R,"DD",{class:!0});var ce=Se(s);V.l(ce),ce.forEach(X),S=Xe(R),R.forEach(X),this.h()},h(){ie(c,"class","ons-metadata__term ons-u-mr-xs"),ie(s,"class","ons-metadata__value ons-u-f-no"),ie(n,"class",I="ons-grid__col ons-col-"+(d[1].col?d[1].col:12)+"@m"),_t(n,"ons-u-mt-xs",d[3]!==0)},m(N,R){ge(N,n,R),he(n,c),he(c,h),he(c,_),he(n,x),he(n,s),V.m(s,null),he(n,S)},p(N,R){R&1&&l!==(l=N[1].key+"")&&jt(h,l),z===(z=P(N,R))&&V?V.p(N,R):(V.d(1),V=z(N),V&&(V.c(),V.m(s,null))),R&1&&I!==(I="ons-grid__col ons-col-"+(N[1].col?N[1].col:12)+"@m")&&ie(n,"class",I),R&1&&_t(n,"ons-u-mt-xs",N[3]!==0)},d(N){N&&X(n),V.d()}}}function u_(d){let n=Array.isArray(d[0]),c,l=n&&vf(d);return{c(){l&&l.c(),c=bt()},l(h){l&&l.l(h),c=bt()},m(h,_){l&&l.m(h,_),ge(h,c,_)},p(h,[_]){_&1&&(n=Array.isArray(h[0])),n?l?l.p(h,_):(l=vf(h),l.c(),l.m(c.parentNode,c)):l&&(l.d(1),l=null)},i:Bt,o:Bt,d(h){l&&l.d(h),h&&X(c)}}}function h_(d,n,c){let{meta:l=null}=n;return d.$$set=h=>{"meta"in h&&c(0,l=h.meta)},[l]}class f_ extends fi{constructor(n){super(),di(this,n,h_,u_,pi,{meta:0})}}const d_=d=>({}),wf=d=>({}),p_=d=>({}),Tf=d=>({}),m_=d=>({}),kf=d=>({});function Ef(d){let n,c,l,h,_;return{c(){n=xe("div"),c=xe("div"),l=xe("a"),h=xe("img"),this.h()},l(x){n=be(x,"DIV",{class:!0});var s=Se(n);c=be(s,"DIV",{class:!0});var b=Se(c);l=be(b,"A",{href:!0,class:!0});var S=Se(l);h=be(S,"IMG",{src:!0,alt:!0,class:!0}),S.forEach(X),b.forEach(X),s.forEach(X),this.h()},h(){ic(h.src,_="//cdn.ons.gov.uk/assets/images/ons-logo/kitemark/uksa-kitemark.svg")||ie(h,"src",_),ie(h,"alt","UK Statistics Authority Kitemark"),ie(h,"class","national-statistics__logo"),ie(l,"href","https://uksa.statisticsauthority.gov.uk/about-the-authority/uk-statistical-system/types-of-official-statistics/"),ie(l,"class","national-statistics__link ons-u-fs-xxxl"),ie(c,"class","ons-grid--flex ons-grid--between@m ons-u-mt-s@m ons-u-mb-m@xxs ons-u-flex-jc-fe@m"),ie(n,"class","ons-grid__col ons-col-2@m svelte-lohx48")},m(x,s){ge(x,n,s),he(n,c),he(c,l),he(l,h)},d(x){x&&X(n)}}}function Sf(d){let n,c,l,h;return{c(){n=xe("div"),c=xe("div"),l=xe("img"),this.h()},l(_){n=be(_,"DIV",{class:!0});var x=Se(n);c=be(x,"DIV",{class:!0});var s=Se(c);l=be(s,"IMG",{src:!0,title:!0,alt:!0,class:!0,focusable:!0,width:!0,height:!0}),s.forEach(X),x.forEach(X),this.h()},h(){ic(l.src,h="https://cdn.ons.gov.uk/assets/images/census-logo/logo-census-2021-purple-landscape.svg")||ie(l,"src",h),ie(l,"title","Census 2021"),ie(l,"alt","Census 2021"),ie(l,"class","header__svg-logo margin-right--1"),ie(l,"focusable","false"),ie(l,"width","167"),ie(l,"height","32"),ie(c,"class","ons-grid__col svelte-lohx48"),ie(n,"class","ons-grid ons-u-mb-m")},m(_,x){ge(_,n,x),he(n,c),he(c,l)},d(_){_&&X(n)}}}function g_(d){let n,c,l,h,_,x,s,b,S,I,P,z,V;const N=d[7].before,R=ar(N,d,d[8],kf);let K=d[1]&&Ef();const ce=d[7].brand,ae=ar(ce,d,d[8],Tf);let Be=d[2]&&Sf();P=new f_({props:{meta:d[3]}});const Oe=d[7].after,ke=ar(Oe,d,d[8],wf);return{c(){n=xe("section"),R&&R.c(),c=Ze(),l=xe("div"),h=xe("div"),_=xe("h1"),x=st(d[0]),s=Ze(),K&&K.c(),b=Ze(),ae&&ae.c(),S=Ze(),Be&&Be.c(),I=Ze(),Et(P.$$.fragment),z=Ze(),ke&&ke.c(),this.h()},l(Ve){n=be(Ve,"SECTION",{class:!0});var ze=Se(n);R&&R.l(ze),c=Xe(ze),l=be(ze,"DIV",{class:!0});var Ne=Se(l);h=be(Ne,"DIV",{class:!0});var Ct=Se(h);_=be(Ct,"H1",{class:!0});var dt=Se(_);x=at(dt,d[0]),dt.forEach(X),Ct.forEach(X),s=Xe(Ne),K&&K.l(Ne),Ne.forEach(X),b=Xe(ze),ae&&ae.l(ze),S=Xe(ze),Be&&Be.l(ze),I=Xe(ze),At(P.$$.fragment,ze),z=Xe(ze),ke&&ke.l(ze),ze.forEach(X),this.h()},h(){ie(_,"class","ons-u-fs-xxxl ons-u-mt-s ons-u-mb-m ons-u-pb-no ons-u-pt-no"),ie(h,"class","ons-grid__col ons-col-10@m svelte-lohx48"),ie(l,"class","ons-grid"),ie(n,"class","ons-u-mb-xl")},m(Ve,ze){ge(Ve,n,ze),R&&R.m(n,null),he(n,c),he(n,l),he(l,h),he(h,_),he(_,x),he(l,s),K&&K.m(l,null),he(n,b),ae&&ae.m(n,null),he(n,S),Be&&Be.m(n,null),he(n,I),St(P,n,null),he(n,z),ke&&ke.m(n,null),V=!0},p(Ve,ze){R&&R.p&&(!V||ze&256)&&or(R,N,Ve,Ve[8],V?cr(N,Ve[8],ze,m_):lr(Ve[8]),kf),(!V||ze&1)&&jt(x,Ve[0]),Ve[1]?K||(K=Ef(),K.c(),K.m(l,null)):K&&(K.d(1),K=null),ae&&ae.p&&(!V||ze&256)&&or(ae,ce,Ve,Ve[8],V?cr(ce,Ve[8],ze,p_):lr(Ve[8]),Tf),Ve[2]?Be||(Be=Sf(),Be.c(),Be.m(n,I)):Be&&(Be.d(1),Be=null);const Ne={};ze&8&&(Ne.meta=Ve[3]),P.$set(Ne),ke&&ke.p&&(!V||ze&256)&&or(ke,Oe,Ve,Ve[8],V?cr(Oe,Ve[8],ze,d_):lr(Ve[8]),wf)},i(Ve){V||(Ee(R,Ve),Ee(ae,Ve),Ee(P.$$.fragment,Ve),Ee(ke,Ve),V=!0)},o(Ve){Le(R,Ve),Le(ae,Ve),Le(P.$$.fragment,Ve),Le(ke,Ve),V=!1},d(Ve){Ve&&X(n),R&&R.d(Ve),K&&K.d(),ae&&ae.d(Ve),Be&&Be.d(),It(P),ke&&ke.d(Ve)}}}function __(d){let n,c;return n=new lc({props:{theme:d[4],themeOverrides:d[5],background:d[6],$$slots:{default:[g_]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,[h]){const _={};h&16&&(_.theme=l[4]),h&32&&(_.themeOverrides=l[5]),h&64&&(_.background=l[6]),h&271&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function y_(d,n,c){let{$$slots:l={},$$scope:h}=n,{title:_="Page title"}=n,{natStatBadge:x=!1}=n,{censusLogo:s=!1}=n,{meta:b=null}=n,{theme:S=null}=n,{themeOverrides:I=null}=n,{background:P=null}=n;return d.$$set=z=>{"title"in z&&c(0,_=z.title),"natStatBadge"in z&&c(1,x=z.natStatBadge),"censusLogo"in z&&c(2,s=z.censusLogo),"meta"in z&&c(3,b=z.meta),"theme"in z&&c(4,S=z.theme),"themeOverrides"in z&&c(5,I=z.themeOverrides),"background"in z&&c(6,P=z.background),"$$scope"in z&&c(8,h=z.$$scope)},[_,x,s,b,S,I,P,l,h]}class v_ extends fi{constructor(n){super(),di(this,n,y_,__,pi,{title:0,natStatBadge:1,censusLogo:2,meta:3,theme:4,themeOverrides:5,background:6})}}function x_(d){let n,c,l,h,_,x,s,b,S,I,P,z;const V=d[3].default,N=ar(V,d,d[2],null);return{c(){n=xe("details"),c=xe("summary"),l=xe("h3"),h=st(d[0]),_=Ze(),x=xe("span"),s=ks("svg"),b=ks("path"),I=Ze(),P=xe("div"),N&&N.c(),this.h()},l(R){n=be(R,"DETAILS",{class:!0});var K=Se(n);c=be(K,"SUMMARY",{class:!0,"data-ga-action":!0});var ce=Se(c);l=be(ce,"H3",{class:!0});var ae=Se(l);h=at(ae,d[0]),ae.forEach(X),_=Xe(ce),x=be(ce,"SPAN",{class:!0});var Be=Se(x);s=Es(Be,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0});var Oe=Se(s);b=Es(Oe,"path",{d:!0,transform:!0}),Se(b).forEach(X),Oe.forEach(X),Be.forEach(X),ce.forEach(X),I=Xe(K),P=be(K,"DIV",{class:!0});var ke=Se(P);N&&N.l(ke),ke.forEach(X),K.forEach(X),this.h()},h(){ie(l,"class","ons-collapsible__title"),ie(b,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),ie(b,"transform","translate(-5.02 -1.59)"),ie(s,"class","ons-svg-icon svelte-1uv81ck"),ie(s,"viewBox","0 0 8 13"),ie(s,"xmlns","http://www.w3.org/2000/svg"),ie(s,"focusable","false"),ie(x,"class","ons-collapsible__icon"),ie(c,"class","ons-collapsible__heading ons-js-collapsible-heading svelte-1uv81ck"),ie(c,"data-ga-action",S=d[1]?"Close panel":"Open panel"),ie(P,"class","ons-collapsible__content ons-js-collapsible-content"),ie(n,"class","ons-collapsible ons-js-collapsible"),n.open=d[1]},m(R,K){ge(R,n,K),he(n,c),he(c,l),he(l,h),he(c,_),he(c,x),he(x,s),he(s,b),he(n,I),he(n,P),N&&N.m(P,null),z=!0},p(R,[K]){(!z||K&1)&&jt(h,R[0]),(!z||K&2&&S!==(S=R[1]?"Close panel":"Open panel"))&&ie(c,"data-ga-action",S),N&&N.p&&(!z||K&4)&&or(N,V,R,R[2],z?cr(V,R[2],K,null):lr(R[2]),null),(!z||K&2)&&(n.open=R[1])},i(R){z||(Ee(N,R),z=!0)},o(R){Le(N,R),z=!1},d(R){R&&X(n),N&&N.d(R)}}}function b_(d,n,c){let{$$slots:l={},$$scope:h}=n,{title:_="Title"}=n,{open:x=!1}=n;return d.$$set=s=>{"title"in s&&c(0,_=s.title),"open"in s&&c(1,x=s.open),"$$scope"in s&&c(2,h=s.$$scope)},[_,x,h,l]}class w_ extends fi{constructor(n){super(),di(this,n,b_,x_,pi,{title:0,open:1})}}function If(d){let n,c,l,h;return{c(){n=ks("svg"),c=ks("path"),this.h()},l(_){n=Es(_,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var x=Se(n);c=Es(x,"path",{d:!0}),Se(c).forEach(X),x.forEach(X),this.h()},h(){ie(c,"d",l=d[3][d[0]].d),ie(n,"class","ons-svg-icon"),ie(n,"viewBox",h=d[3][d[0]].viewBox),ie(n,"xmlns","http://www.w3.org/2000/svg"),ie(n,"focusable","false"),ie(n,"fill","currentColor"),_t(n,"ons-u-ml-xs",d[1]),_t(n,"ons-u-mr-xs",d[2])},m(_,x){ge(_,n,x),he(n,c)},p(_,x){x&1&&l!==(l=_[3][_[0]].d)&&ie(c,"d",l),x&1&&h!==(h=_[3][_[0]].viewBox)&&ie(n,"viewBox",h),x&2&&_t(n,"ons-u-ml-xs",_[1]),x&4&&_t(n,"ons-u-mr-xs",_[2])},d(_){_&&X(n)}}}function T_(d){let n,c=d[3][d[0]]&&If(d);return{c(){c&&c.c(),n=bt()},l(l){c&&c.l(l),n=bt()},m(l,h){c&&c.m(l,h),ge(l,n,h)},p(l,[h]){l[3][l[0]]?c?c.p(l,h):(c=If(l),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i:Bt,o:Bt,d(l){c&&c.d(l),l&&X(n)}}}function k_(d,n,c){let{type:l="arrow"}=n,{marginLeft:h=!1}=n,{marginRight:_=!1}=n;const x={arrow:{d:"m10 .2-.9.9c-.1.1-.1.4 0 .5l4 4H.6c-.2 0-.4.2-.4.4v1.2c0 .2.2.4.4.4h12.5l-3.9 3.7c-.2.2-.2.4 0 .6l.8.9c.2.2.4.2.6 0L16.8 7c.2-.2.2-.4 0-.6L10.7.3c-.3-.2-.5-.2-.7-.1z",viewBox:"0 0 17 13"},externalLink:{d:"M13.5,9H13a.5.5,0,0,0-.5.5v3h-9v-9h3A.5.5,0,0,0,7,3V2.5A.5.5,0,0,0,6.5,2h-4a.5.5,0,0,0-.5.5v11a.5.5,0,0,0,.5.5h11a.5.5,0,0,0,.5-.5v-4A.5.5,0,0,0,13.5,9Z M8.83,7.88a.51.51,0,0,0,.71,0l2.31-2.32,1.28,1.28A.51.51,0,0,0,14,6.49v-4a.52.52,0,0,0-.5-.5h-4A.51.51,0,0,0,9,2.52a.58.58,0,0,0,.14.33l1.28,1.28L8.12,6.46a.51.51,0,0,0,0,.71Z",viewBox:"2 2 12 12"},signout:{d:"M13.85,7.65l-2.5-2.5a.5.5,0,0,0-.71,0,.48.48,0,0,0-.15.36V7h-3a.5.5,0,0,0-.5.5v1a.5.5,0,0,0,.5.5h3v1.5A.49.49,0,0,0,11,11a.48.48,0,0,0,.34-.14l2.51-2.5a.49.49,0,0,0,0-.68Z M8.5,14h-6a.5.5,0,0,1-.5-.5V2.5A.5.5,0,0,1,2.5,2h6a.5.5,0,0,1,.5.5V3a.5.5,0,0,1-.5.5h-5v9h5A.5.5,0,0,1,9,13v.5A.5.5,0,0,1,8.5,14Z",viewBox:"0 0 12 12"},print:{d:"M17 4H3C1.3 4 0 5.2 0 6.8v5.5h4V16h12v-3.7h4V6.8C20 5.2 18.7 4 17 4zm-3 10H6V9h8v5zm3-6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-1-8H4v3h12V0z",viewBox:"0 0 20 16"},download:{d:"M5.6 9a.48.48 0 0 0 .7 0l3-3.2a.48.48 0 0 0 0-.7C9.3 5 9.2 5 9 5H7.5V.5A.47.47 0 0 0 7 0H5a.47.47 0 0 0-.5.5V5H3a.47.47 0 0 0-.5.5.37.37 0 0 0 .1.3Z M11.5 9H11a.47.47 0 0 0-.5.5v1h-9v-1A.47.47 0 0 0 1 9H.5a.47.47 0 0 0-.5.5v2a.47.47 0 0 0 .5.5h11a.47.47 0 0 0 .5-.5v-2a.47.47 0 0 0-.5-.5Z",viewBox:"0 0 12 12"},tick:{d:"M14.35,3.9l-.71-.71a.5.5,0,0,0-.71,0h0L5.79,10.34,3.07,7.61a.51.51,0,0,0-.71,0l-.71.71a.51.51,0,0,0,0,.71l3.78,3.78a.5.5,0,0,0,.71,0h0L14.35,4.6A.5.5,0,0,0,14.35,3.9Z",viewBox:"1.5 3 13 10"},search:{d:"M11.86 10.23 8.62 6.99a4.63 4.63 0 1 0-6.34 1.64 4.55 4.55 0 0 0 2.36.64 4.65 4.65 0 0 0 2.33-.65l3.24 3.23a.46.46 0 0 0 .65 0l1-1a.48.48 0 0 0 0-.62Zm-5-3.32a3.28 3.28 0 0 1-2.31.93 3.22 3.22 0 1 1 2.35-.93Z",viewBox:"0 0 12 12"}};return d.$$set=s=>{"type"in s&&c(0,l=s.type),"marginLeft"in s&&c(1,h=s.marginLeft),"marginRight"in s&&c(2,_=s.marginRight)},[l,h,_,x]}let cc=class extends fi{constructor(n){super(),di(this,n,k_,T_,pi,{type:0,marginLeft:1,marginRight:2})}};function E_(d){let n,c,l,h,_,x,s,b,S=d[4]&&d[5]==="before"&&Cf(d);const I=d[9].default,P=ar(I,d,d[8],null);let z=d[4]&&d[5]==="after"&&Af(d);return{c(){n=xe("button"),c=xe("span"),S&&S.c(),l=Ze(),h=xe("span"),P&&P.c(),_=Ze(),z&&z.c(),this.h()},l(V){n=be(V,"BUTTON",{type:!0,class:!0});var N=Se(n);c=be(N,"SPAN",{class:!0});var R=Se(c);S&&S.l(R),l=Xe(R),h=be(R,"SPAN",{class:!0});var K=Se(h);P&&P.l(K),K.forEach(X),_=Xe(R),z&&z.l(R),R.forEach(X),N.forEach(X),this.h()},h(){ie(h,"class","ons-btn__text"),ie(c,"class","ons-btn__inner"),ie(n,"type",d[0]),ie(n,"class","ons-btn"),n.disabled=d[6],_t(n,"ons-btn--small",d[3]),_t(n,"ons-btn--secondary",d[1]==="secondary"),_t(n,"ons-btn--ghost",d[1]==="ghost"),_t(n,"ons-btn--disabled",d[6])},m(V,N){ge(V,n,N),he(n,c),S&&S.m(c,null),he(c,l),he(c,h),P&&P.m(h,null),he(c,_),z&&z.m(c,null),x=!0,s||(b=Ss(n,"click",d[11]),s=!0)},p(V,N){V[4]&&V[5]==="before"?S?(S.p(V,N),N&48&&Ee(S,1)):(S=Cf(V),S.c(),Ee(S,1),S.m(c,l)):S&&(ci(),Le(S,1,1,()=>{S=null}),ui()),P&&P.p&&(!x||N&256)&&or(P,I,V,V[8],x?cr(I,V[8],N,null):lr(V[8]),null),V[4]&&V[5]==="after"?z?(z.p(V,N),N&48&&Ee(z,1)):(z=Af(V),z.c(),Ee(z,1),z.m(c,null)):z&&(ci(),Le(z,1,1,()=>{z=null}),ui()),(!x||N&1)&&ie(n,"type",V[0]),(!x||N&64)&&(n.disabled=V[6]),(!x||N&8)&&_t(n,"ons-btn--small",V[3]),(!x||N&2)&&_t(n,"ons-btn--secondary",V[1]==="secondary"),(!x||N&2)&&_t(n,"ons-btn--ghost",V[1]==="ghost"),(!x||N&64)&&_t(n,"ons-btn--disabled",V[6])},i(V){x||(Ee(S),Ee(P,V),Ee(z),x=!0)},o(V){Le(S),Le(P,V),Le(z),x=!1},d(V){V&&X(n),S&&S.d(),P&&P.d(V),z&&z.d(),s=!1,b()}}}function S_(d){let n,c,l,h,_,x,s,b,S,I=d[4]&&d[5]==="before"&&zf(d);const P=d[9].default,z=ar(P,d,d[8],null);let V=d[4]&&d[5]==="after"&&Mf(d);return{c(){n=xe("a"),c=xe("span"),I&&I.c(),l=Ze(),h=xe("span"),z&&z.c(),_=Ze(),V&&V.c(),this.h()},l(N){n=be(N,"A",{href:!0,role:!0,class:!0,disabled:!0});var R=Se(n);c=be(R,"SPAN",{class:!0});var K=Se(c);I&&I.l(K),l=Xe(K),h=be(K,"SPAN",{class:!0});var ce=Se(h);z&&z.l(ce),ce.forEach(X),_=Xe(K),V&&V.l(K),K.forEach(X),R.forEach(X),this.h()},h(){ie(h,"class","ons-btn__text"),ie(c,"class","ons-btn__inner"),ie(n,"href",x=d[6]?null:d[2]),ie(n,"role","button"),ie(n,"class","ons-btn ons-btn--link ons-js-submit-btn"),ie(n,"disabled",d[6]),_t(n,"ons-btn--small",d[3]),_t(n,"ons-btn--secondary",d[1]==="secondary"),_t(n,"ons-btn--ghost",d[1]==="ghost"),_t(n,"ons-btn--disabled",d[6])},m(N,R){ge(N,n,R),he(n,c),I&&I.m(c,null),he(c,l),he(c,h),z&&z.m(h,null),he(c,_),V&&V.m(c,null),s=!0,b||(S=Ss(n,"click",d[10]),b=!0)},p(N,R){N[4]&&N[5]==="before"?I?(I.p(N,R),R&48&&Ee(I,1)):(I=zf(N),I.c(),Ee(I,1),I.m(c,l)):I&&(ci(),Le(I,1,1,()=>{I=null}),ui()),z&&z.p&&(!s||R&256)&&or(z,P,N,N[8],s?cr(P,N[8],R,null):lr(N[8]),null),N[4]&&N[5]==="after"?V?(V.p(N,R),R&48&&Ee(V,1)):(V=Mf(N),V.c(),Ee(V,1),V.m(c,null)):V&&(ci(),Le(V,1,1,()=>{V=null}),ui()),(!s||R&68&&x!==(x=N[6]?null:N[2]))&&ie(n,"href",x),(!s||R&64)&&ie(n,"disabled",N[6]),(!s||R&8)&&_t(n,"ons-btn--small",N[3]),(!s||R&2)&&_t(n,"ons-btn--secondary",N[1]==="secondary"),(!s||R&2)&&_t(n,"ons-btn--ghost",N[1]==="ghost"),(!s||R&64)&&_t(n,"ons-btn--disabled",N[6])},i(N){s||(Ee(I),Ee(z,N),Ee(V),s=!0)},o(N){Le(I),Le(z,N),Le(V),s=!1},d(N){N&&X(n),I&&I.d(),z&&z.d(N),V&&V.d(),b=!1,S()}}}function Cf(d){let n,c;return n=new cc({props:{type:d[4],marginRight:!0}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&16&&(_.type=l[4]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Af(d){let n,c;return n=new cc({props:{type:d[4],marginLeft:!0}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&16&&(_.type=l[4]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function zf(d){let n,c;return n=new cc({props:{type:d[4],marginRight:!0}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&16&&(_.type=l[4]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Mf(d){let n,c;return n=new cc({props:{type:d[4],marginLeft:!0}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&16&&(_.type=l[4]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function I_(d){let n,c,l,h;const _=[S_,E_],x=[];function s(b,S){return b[2]?0:1}return n=s(d),c=x[n]=_[n](d),{c(){c.c(),l=bt()},l(b){c.l(b),l=bt()},m(b,S){x[n].m(b,S),ge(b,l,S),h=!0},p(b,[S]){let I=n;n=s(b),n===I?x[n].p(b,S):(ci(),Le(x[I],1,1,()=>{x[I]=null}),ui(),c=x[n],c?c.p(b,S):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Le(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function C_(d,n,c){let{$$slots:l={},$$scope:h}=n;const _=ku();let{type:x="button"}=n,{variant:s="primary"}=n,{href:b=""}=n,{small:S=!1}=n,{icon:I=""}=n,{iconPosition:P="before"}=n,{disabled:z=!1}=n;const V=R=>_("click",R),N=R=>_("click",R);return d.$$set=R=>{"type"in R&&c(0,x=R.type),"variant"in R&&c(1,s=R.variant),"href"in R&&c(2,b=R.href),"small"in R&&c(3,S=R.small),"icon"in R&&c(4,I=R.icon),"iconPosition"in R&&c(5,P=R.iconPosition),"disabled"in R&&c(6,z=R.disabled),"$$scope"in R&&c(8,h=R.$$scope)},[x,s,b,S,I,P,z,_,h,l,V,N]}class zu extends fi{constructor(n){super(),di(this,n,C_,I_,pi,{type:0,variant:1,href:2,small:3,icon:4,iconPosition:5,disabled:6})}}var pu=wg,A_=function(d){var n,c,l,h;if(n=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(d)){var _=n[1],x=_.replace(/a$/,""),s=x==="cmyk"?4:3;c=pu[x],l=n[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(S,I){return/%$/.test(S)&&I===s?parseFloat(S)/100:(/%$/.test(S),parseFloat(S))}),_===x&&l.push(1),h=l[s]===void 0?1:l[s],l=l.slice(0,s),c[x]=function(){return l}}else if(/^#[A-Fa-f0-9]+$/.test(d)){var x=d.replace(/^#/,""),s=x.length;c=pu.rgb,l=x.split(s===3?/(.)/:/(..)/),l=l.filter(Boolean).map(function(P){return parseInt(s===3?P+P:P,16)}),h=1,c.rgb=function(){return l},l[0]||(l[0]=0),l[1]||(l[1]=0),l[2]||(l[2]=0)}else c=pu.keyword,c.keyword=function(){return d},l=d,h=1;var b={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{b.rgb=c.rgb(l)}catch{}try{b.hsl=c.hsl(l)}catch{}try{b.hsv=c.hsv(l)}catch{}try{b.cmyk=c.cmyk(l)}catch{}try{b.keyword=c.keyword(l)}catch{}return b.rgb&&(b.hex="#"+b.rgb.map(function(S){var I=S.toString(16);return I.length===1?"0"+I:I}).join("")),b.rgb&&(b.rgba=b.rgb.concat(h)),b.hsl&&(b.hsla=b.hsl.concat(h)),b.hsv&&(b.hsva=b.hsv.concat(h)),b.cmyk&&(b.cmyka=b.cmyk.concat(h)),b};const z_=pp(A_);function M_(d){return d}function P_(d){if(d==null)return M_;var n,c,l=d.scale[0],h=d.scale[1],_=d.translate[0],x=d.translate[1];return function(s,b){b||(n=c=0);var S=2,I=s.length,P=new Array(I);for(P[0]=(n+=s[0])*l+_,P[1]=(c+=s[1])*h+x;S<I;)P[S]=s[S],++S;return P}}function D_(d,n){for(var c,l=d.length,h=l-n;h<--l;)c=d[h],d[h++]=d[l],d[l]=c}function L_(d,n){return typeof n=="string"&&(n=d.objects[n]),n.type==="GeometryCollection"?{type:"FeatureCollection",features:n.geometries.map(function(c){return Pf(d,c)})}:Pf(d,n)}function Pf(d,n){var c=n.id,l=n.bbox,h=n.properties==null?{}:n.properties,_=B_(d,n);return c==null&&l==null?{type:"Feature",properties:h,geometry:_}:l==null?{type:"Feature",id:c,properties:h,geometry:_}:{type:"Feature",id:c,bbox:l,properties:h,geometry:_}}function B_(d,n){var c=P_(d.transform),l=d.arcs;function h(I,P){P.length&&P.pop();for(var z=l[I<0?~I:I],V=0,N=z.length;V<N;++V)P.push(c(z[V],V));I<0&&D_(P,N)}function _(I){return c(I)}function x(I){for(var P=[],z=0,V=I.length;z<V;++z)h(I[z],P);return P.length<2&&P.push(P[0]),P}function s(I){for(var P=x(I);P.length<4;)P.push(P[0]);return P}function b(I){return I.map(s)}function S(I){var P=I.type,z;switch(P){case"GeometryCollection":return{type:P,geometries:I.geometries.map(S)};case"Point":z=_(I.coordinates);break;case"MultiPoint":z=I.coordinates.map(_);break;case"LineString":z=x(I.arcs);break;case"MultiLineString":z=I.arcs.map(x);break;case"Polygon":z=b(I.arcs);break;case"MultiPolygon":z=I.arcs.map(b);break;default:return null}return{type:P,coordinates:z}}return S(n)}const Df="https://raw.githubusercontent.com/jtrim-ons/key-pop-api-downloader/main/generated/";function R_(d){let n=[...d].sort((l,h)=>l.key.localeCompare(h.key));return{selString:d.length==0?"data":n.map((l,h)=>h<n.length-1?`${l.key}-${l.code}`:`${l.key}`).join("/"),lastCode:d.length>0?n[n.length-1].code:null}}async function mp(d,n=[],c=window.fetch){if(n.length>0&&!n[0].newFormat)throw new Error("OLD FORMAT!");let{selString:l,lastCode:h}=R_(n),_={data:{}},x;if(n.length===0){let s=`${Df}${n.length}var_percent/${l}.json`;x=await(await c(s)).json(),_.total_pop={count:x.sex.count[0]+x.sex.count[1],percent:100}}else{let s=`${Df}${n.length}var-combined_percent/${l}.json`,S=await(await c(s)).json();x=S.bar_chart_data[h],_.mapData=S.map_data[h],_.total_pop=x.total_pop}for(let s of d){_.data[s.key]={};for(let b of s.tables)_.data[s.key][b.code]={values:x[b.code]}}return _}function F_(d,n,c){for(let l=1;l<n.length;l++)if(d<=n[l])return c[l-1]}async function O_(d,n,c=window.fetch){let h=await(await c(d)).json();return await L_(h,n)}function Ts(d){return d.charAt(0).toUpperCase()+d.slice(1)}function Lf(d){return d.replace(new RegExp(" \\([0-9]* categories\\)"),"")}function Bf(d){for(const n of d)if(n.var in tf)return tf[n.var][n.code];return null}function rc(d,n,c){let l=c.all[d][n].values,h=c.selected[d][n].values,_=[];return Tg[n].forEach((x,s)=>{let b=x.label,S=l.percent[s],I=h.percent[s];c.selected.total_pop!=c.all.total_pop&&_.push({group:"This group",category:b,value:I}),_.push({group:"Whole population",category:b,value:S})}),_}function Rf(d){if(d===100)return"100";const n=d.toFixed(1);return n!=="0.0"?n:"Less than 0.05"}async function V_({fetch:d}){let n=await O_(wu+No.url,No.layer,d),c=(await mp(ec,[],d)).data,l=n.features.map(_=>({code:_.properties[No.code],name:_.properties[No.name]})),h=l.map(({code:_,name:x})=>({code:_,name:x,value:100,color:Fa.seq[4]}));return{geojson:n,geoCodesAndNames:l,geoPerc:h,all:c,selected:null}}const O0=Object.freeze(Object.defineProperty({__proto__:null,load:V_},Symbol.toStringTag,{value:"Module"}));var gp={exports:{}};(function(d,n){(function(c,l){d.exports=l()})(Og,function(){var c,l,h;function _(s,b){if(!c)c=b;else if(!l)l=b;else{var S="var sharedChunk = {}; ("+c+")(sharedChunk); ("+l+")(sharedChunk);",I={};c(I),h=b(I),typeof window<"u"&&(h.workerUrl=window.URL.createObjectURL(new Blob([S],{type:"text/javascript"})))}}_(["exports"],function(s){var b=S;function S(i,e,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=o}function I(i,e,r,o){const p=new b(i,e,r,o);return function(g){return p.solve(g)}}S.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var p=this.sampleCurveX(r)-i;if(Math.abs(p)<e)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=p/g}var v=0,T=1;for(r=i,o=0;o<20&&(p=this.sampleCurveX(r),!(Math.abs(p-i)<e));o++)i>p?v=r:T=r,r=.5*(T-v)+v;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const P=I(.25,.1,.25,1);function z(i,e,r){return Math.min(r,Math.max(e,i))}function V(i,e,r){const o=r-e,p=((i-e)%o+o)%o+e;return p===e?r:p}function N(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}let R=1;function K(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ce(i,e,r){const o={};for(const p in i)o[p]=e.call(r||this,i[p],p,i);return o}function ae(i,e,r){const o={};for(const p in i)e.call(r||this,i[p],p,i)&&(o[p]=i[p]);return o}function Be(i){return Array.isArray(i)?i.map(Be):typeof i=="object"&&i?ce(i,Be):i}const Oe={};function ke(i){Oe[i]||(typeof console<"u"&&console.warn(i),Oe[i]=!0)}function Ve(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function ze(i){let e=0;for(let r,o,p=0,g=i.length,v=g-1;p<g;v=p++)r=i[p],o=i[v],e+=(o.x-r.x)*(r.y+o.y);return e}function Ne(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ct(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,p,g)=>{const v=p||g;return e[o]=!v||v.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let dt,yi,gt=null;function ni(i){if(gt==null){const e=i.navigator?i.navigator.userAgent:null;gt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return gt}function er(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const ti={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),o=r.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,o.drawImage(i,0,0,i.width,i.height),o.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(dt||(dt=document.createElement("a")),dt.href=i,dt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(yi==null&&(yi=matchMedia("(prefers-reduced-motion: reduce)")),yi.matches)}};var xt=mr;function mr(i,e){this.x=i,this.y=e}mr.prototype={clone:function(){return new mr(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround:function(i,e){var r=Math.cos(i),o=Math.sin(i),p=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},mr.convert=function(i){return i instanceof mr?i:Array.isArray(i)?new mr(i[0],i[1]):i};const Si={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Lt="mapbox-tiles";let Ri,Mi,Ai=500,ur=50;function Ui(){typeof caches>"u"||Ri||(Ri=caches.open(Lt))}let Ki=1/0;const gr={supported:!1,testSupport:function(i){!He&&Tr&&(hi?Ni(i):_r=i)}};let _r,Tr,He=!1,hi=!1;function Ni(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Tr),i.isContextLost())return;gr.supported=!0}catch{}i.deleteTexture(e),He=!0}typeof document<"u"&&(Tr=document.createElement("img"),Tr.onload=function(){_r&&Ni(_r),_r=null,hi=!0},Tr.onerror=function(){He=!0,_r=null},Tr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Rr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Rr);class kr extends Error{constructor(e,r,o,p){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=p}}const Is=Ne()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function vn(i,e){const r=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Is(),signal:r.signal});let p=!1,g=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),((v,T,k)=>{if(g)return;const A=Date.now();fetch(o).then(L=>L.ok?((F,j,q)=>{(i.type==="arrayBuffer"?F.arrayBuffer():i.type==="json"?F.json():F.text()).then(Z=>{g||(j&&q&&function(re,te,me){if(Ui(),!Ri)return;const Te={status:te.status,statusText:te.statusText,headers:new Headers};te.headers.forEach((ve,Fe)=>Te.headers.set(Fe,ve));const pe=Ct(te.headers.get("Cache-Control")||"");pe["no-store"]||(pe["max-age"]&&Te.headers.set("Expires",new Date(me+1e3*pe["max-age"]).toUTCString()),new Date(Te.headers.get("Expires")).getTime()-me<42e4||function(ve,Fe){if(Mi===void 0)try{new Response(new ReadableStream),Mi=!0}catch{Mi=!1}Mi?Fe(ve.body):ve.blob().then(Fe)}(te,ve=>{const Fe=new Response(ve,Te);Ui(),Ri&&Ri.then(Re=>Re.put(function(lt){const ht=lt.indexOf("?");return ht<0?lt:lt.slice(0,ht)}(re.url),Fe)).catch(Re=>ke(Re.message))}))}(o,j,q),p=!0,e(null,Z,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Z=>{g||e(new Error(Z.message))})})(L,null,A):L.blob().then(F=>e(new kr(L.status,L.statusText,i.url,F)))).catch(L=>{L.code!==20&&e(new Error(L.message))})})(),{cancel:()=>{g=!0,p||r.abort()}}}const $n=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Ne()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Ne()){const o=i.url.substring(0,i.url.indexOf("://"));return(Si.REGISTERED_PROTOCOLS[o]||vn)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(Is())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return vn(i,e);if(Ne()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(o,p){const g=new XMLHttpRequest;g.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const v in o.headers)g.setRequestHeader(v,o.headers[v]);return o.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=o.credentials==="include",g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let v=g.response;if(o.type==="json")try{v=JSON.parse(g.response)}catch(T){return p(T)}p(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else{const v=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});p(new kr(g.status,g.statusText,o.url,v))}},g.send(o.body),{cancel:()=>g.abort()}}(i,e)},es=function(i,e){return $n(N(i,{type:"arrayBuffer"}),e)};function Cs(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const Zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Yr,xn;Yr=[],xn=0;const bn=function(i,e){if(gr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),xn>=Si.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Yr.push(g),g}xn++;let r=!1;const o=()=>{if(!r)for(r=!0,xn--;Yr.length&&xn<Si.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Yr.shift(),{requestParameters:v,callback:T,cancelled:k}=g;k||(g.cancel=bn(v,T).cancel)}},p=es(i,(g,v,T,k)=>{o(),g?e(g):v&&function(A,L){typeof createImageBitmap=="function"?function(F,j){const q=new Blob([new Uint8Array(F)],{type:"image/png"});createImageBitmap(q).then(Z=>{j(null,Z)}).catch(Z=>{j(new Error(`Could not load image because of ${Z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(A,L):function(F,j){const q=new Image;q.onload=()=>{j(null,q),URL.revokeObjectURL(q.src),q.onload=null,window.requestAnimationFrame(()=>{q.src=Zt})},q.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Z=new Blob([new Uint8Array(F)],{type:"image/png"});q.src=F.byteLength?URL.createObjectURL(Z):Zt}(A,L)}(v,(A,L)=>{A!=null?e(A):L!=null&&e(null,L,{cacheControl:T,expires:k})})});return{cancel:()=>{p.cancel(),o()}}};function As(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function an(i,e,r){if(r&&r[i]){const o=r[i].indexOf(e);o!==-1&&r[i].splice(o,1)}}class on{constructor(e,r={}){N(this,r),this.type=e}}class ts extends on{constructor(e,r={}){super("error",N({error:e},r))}}class ln{on(e,r){return this._listeners=this._listeners||{},As(e,r,this._listeners),this}off(e,r){return an(e,r,this._listeners),an(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},As(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new on(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const p=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const T of p)T.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const T of g)an(o,T,this._oneTimeListeners),T.call(this,e);const v=this._eventedParent;v&&(N(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(e))}else e instanceof ts&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var De={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Qe{constructor(e,r,o,p){this.message=(e?`${e}: `:"")+o,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function Dn(i){const e=i.value;return e?[new Qe(i.key,e,"constants have been deprecated as of v8")]:[]}function jr(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}function Xt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Fr(i){if(Array.isArray(i))return i.map(Fr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Fr(i[r]);return e}return Xt(i)}class Er extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Sr{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,p]of r)this.bindings[o]=p}concat(e){return new Sr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const wn={kind:"null"},Ke={kind:"number"},Rt={kind:"string"},Pt={kind:"boolean"},Ji={kind:"color"},Tn={kind:"object"},Mt={kind:"value"},cn={kind:"collator"},ji={kind:"formatted"},is={kind:"padding"},Pi={kind:"resolvedImage"};function hr(i,e){return{kind:"array",itemType:i,N:e}}function ii(i){if(i.kind==="array"){const e=ii(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const rs=[wn,Ke,Rt,Pt,Ji,ji,Tn,hr(Mt),is,Pi];function Qr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Qr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of rs)if(!Qr(r,e))return null}}return`Expected ${ii(i)} but found ${ii(e)} instead.`}function Ln(i,e){return e.some(r=>r.kind===i.kind)}function Bn(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var ns,Rn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function J(i){return(i=Math.round(i))<0?0:i>255?255:i}function D(i){return J(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function O(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function H(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{ns={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in Rn)return Rn[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=r.indexOf("("),p=r.indexOf(")");if(o!==-1&&p+1===r.length){var g=r.substr(0,o),v=r.substr(o+1,p-(o+1)).split(","),T=1;switch(g){case"rgba":if(v.length!==4)return null;T=O(v.pop());case"rgb":return v.length!==3?null:[D(v[0]),D(v[1]),D(v[2]),T];case"hsla":if(v.length!==4)return null;T=O(v.pop());case"hsl":if(v.length!==3)return null;var k=(parseFloat(v[0])%360+360)%360/360,A=O(v[1]),L=O(v[2]),F=L<=.5?L*(A+1):L+A-L*A,j=2*L-F;return[J(255*H(j,F,k+1/3)),J(255*H(j,F,k)),J(255*H(j,F,k-1/3)),T];default:return null}}return null}}catch{}class W{constructor(e,r,o,p=1){this.r=e,this.g=r,this.b=o,this.a=p}static parse(e){if(!e)return;if(e instanceof W)return e;if(typeof e!="string")return;const r=ns(e);return r?new W(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,o,p]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(o)},${p})`}toArray(){const{r:e,g:r,b:o,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*r/p,255*o/p,p]}}W.black=new W(0,0,0,1),W.white=new W(1,1,1,1),W.transparent=new W(0,0,0,0),W.red=new W(1,0,0,1);class ne{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ue{constructor(e,r,o,p,g){this.text=e,this.image=r,this.scale=o,this.fontStack=p,this.textColor=g}}class oe{constructor(e){this.sections=e}static fromString(e){return new oe([new ue(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof oe?e:oe.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class se{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof se)return e;if(typeof e=="number")return new se([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new se(e)}}toString(){return JSON.stringify(this.values)}}class fe{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new fe({name:e,available:!1}):null}}function Ce(i,e,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,r,o]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ue(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof W||i instanceof ne||i instanceof oe||i instanceof se||i instanceof fe)return!0;if(Array.isArray(i)){for(const e of i)if(!Ue(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ue(i[e]))return!1;return!0}return!1}function Ie(i){if(i===null)return wn;if(typeof i=="string")return Rt;if(typeof i=="boolean")return Pt;if(typeof i=="number")return Ke;if(i instanceof W)return Ji;if(i instanceof ne)return cn;if(i instanceof oe)return ji;if(i instanceof se)return is;if(i instanceof fe)return Pi;if(Array.isArray(i)){const e=i.length;let r;for(const o of i){const p=Ie(o);if(r){if(r===p)continue;r=Mt;break}r=p}return hr(r||Mt,e)}return Tn}function ut(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof W||i instanceof oe||i instanceof se||i instanceof fe?i.toString():JSON.stringify(i)}class ft{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ue(e[1]))return r.error("invalid value");const o=e[1];let p=Ie(o);const g=r.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new ft(p,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class rt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const wt={string:Rt,number:Ke,boolean:Pt,object:Tn};class kt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,p=1;const g=e[0];if(g==="array"){let T,k;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in wt)||A==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);T=wt[A],p++}else T=Mt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);k=e[2],p++}o=hr(T,k)}else{if(!wt[g])throw new Error(`Types doesn't contain name = ${g}`);o=wt[g]}const v=[];for(;p<e.length;p++){const T=r.parse(e[p],p,Mt);if(!T)return null;v.push(T)}return new kt(o,v)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!Qr(this.type,Ie(o)))return o;if(r===this.args.length-1)throw new rt(`Expected value to be of type ${ii(this.type)}, but found ${ii(Ie(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ht={"to-boolean":Pt,"to-color":Ji,"to-number":Ke,"to-string":Rt};class zt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if(!Ht[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const p=Ht[o],g=[];for(let v=1;v<e.length;v++){const T=r.parse(e[v],v,Mt);if(!T)return null;g.push(T)}return new zt(p,g)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,o;for(const p of this.args){if(r=p.evaluate(e),o=null,r instanceof W)return r;if(typeof r=="string"){const g=e.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ce(r[0],r[1],r[2],r[3]),!o))return new W(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new rt(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const o of this.args){r=o.evaluate(e);const p=se.parse(r);if(p)return p}throw new rt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new rt(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?oe.fromString(ut(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?fe.fromString(ut(this.args[0].evaluate(e))):ut(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ft=["Unknown","Point","LineString","Polygon"];class Wt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ft[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=W.parse(e)),r}}class si{constructor(e,r,o,p){this.name=e,this.type=r,this._evaluate=o,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const o=e[0],p=si.definitions[o];if(!p)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=v.filter(([A])=>!Array.isArray(A)||A.length===e.length-1);let k=null;for(const[A,L]of T){k=new os(r.registry,r.path,null,r.scope);const F=[];let j=!1;for(let q=1;q<e.length;q++){const Z=e[q],re=Array.isArray(A)?A[q-1]:A.type,te=k.parse(Z,1+F.length,re);if(!te){j=!0;break}F.push(te)}if(!j)if(Array.isArray(A)&&A.length!==F.length)k.error(`Expected ${A.length} arguments, but found ${F.length} instead.`);else{for(let q=0;q<F.length;q++){const Z=Array.isArray(A)?A[q]:A.type,re=F[q];k.concat(q+1).checkSubtype(Z,re.type)}if(k.errors.length===0)return new si(o,g,L,F)}}if(T.length===1)r.errors.push(...k.errors);else{const A=(T.length?T:v).map(([F])=>{return j=F,Array.isArray(j)?`(${j.map(ii).join(", ")})`:`(${ii(j.type)}...)`;var j}).join(" | "),L=[];for(let F=1;F<e.length;F++){const j=r.parse(e[F],1+L.length);if(!j)return null;L.push(ii(j.type))}r.error(`Expected arguments of type ${A}, but found (${L.join(", ")}) instead.`)}return null}static register(e,r){si.definitions=r;for(const o in r)e[o]=si}}class Gi{constructor(e,r,o){this.type=cn,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const p=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Pt);if(!p)return null;const g=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Pt);if(!g)return null;let v=null;return o.locale&&(v=r.parse(o.locale,1,Rt),!v)?null:new Gi(p,g,v)}evaluate(e){return new ne(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const vi=8192;function tr(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ss(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function zs(i,e){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*vi),Math.round(o*p*vi)]}function ai(i,e,r){const o=i[0]-e[0],p=i[1]-e[1],g=i[0]-r[0],v=i[1]-r[1];return o*v-g*p==0&&o*g<=0&&p*v<=0}function Ua(i,e){let r=!1;for(let v=0,T=e.length;v<T;v++){const k=e[v];for(let A=0,L=k.length;A<L-1;A++){if(ai(i,k[A],k[A+1]))return!1;(p=k[A])[1]>(o=i)[1]!=(g=k[A+1])[1]>o[1]&&o[0]<(g[0]-p[0])*(o[1]-p[1])/(g[1]-p[1])+p[0]&&(r=!r)}}var o,p,g;return r}function Na(i,e){for(let r=0;r<e.length;r++)if(Ua(i,e[r]))return!0;return!1}function Xo(i,e,r,o){const p=o[0]-r[0],g=o[1]-r[1],v=(i[0]-r[0])*g-p*(i[1]-r[1]),T=(e[0]-r[0])*g-p*(e[1]-r[1]);return v>0&&T<0||v<0&&T>0}function Ho(i,e,r){for(const A of r)for(let L=0;L<A.length-1;++L)if((T=[(v=A[L+1])[0]-(g=A[L])[0],v[1]-g[1]])[0]*(k=[(p=e)[0]-(o=i)[0],p[1]-o[1]])[1]-T[1]*k[0]!=0&&Xo(o,p,g,v)&&Xo(g,v,o,p))return!0;var o,p,g,v,T,k;return!1}function ja(i,e){for(let r=0;r<i.length;++r)if(!Ua(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Ho(i[r],i[r+1],e))return!1;return!0}function uc(i,e){for(let r=0;r<e.length;r++)if(ja(i,e[r]))return!0;return!1}function aa(i,e,r){const o=[];for(let p=0;p<i.length;p++){const g=[];for(let v=0;v<i[p].length;v++){const T=zs(i[p][v],r);tr(e,T),g.push(T)}o.push(g)}return o}function Ga(i,e,r){const o=[];for(let p=0;p<i.length;p++){const g=aa(i[p],e,r);o.push(g)}return o}function Wo(i,e,r,o){if(i[0]<r[0]||i[0]>r[2]){const p=.5*o;let g=i[0]-r[0]>p?-o:r[0]-i[0]>p?o:0;g===0&&(g=i[0]-r[2]>p?-o:r[2]-i[0]>p?o:0),i[0]+=g}tr(e,i)}function Ko(i,e,r,o){const p=Math.pow(2,o.z)*vi,g=[o.x*vi,o.y*vi],v=[];for(const T of i)for(const k of T){const A=[k.x+g[0],k.y+g[1]];Wo(A,e,r,p),v.push(A)}return v}function Jo(i,e,r,o){const p=Math.pow(2,o.z)*vi,g=[o.x*vi,o.y*vi],v=[];for(const k of i){const A=[];for(const L of k){const F=[L.x+g[0],L.y+g[1]];tr(e,F),A.push(F)}v.push(A)}if(e[2]-e[0]<=p/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const k of v)for(const A of k)Wo(A,e,r,p)}var T;return v}class Fn{constructor(e,r){this.type=Pt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ue(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let p=0;p<o.features.length;++p){const g=o.features[p].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Fn(o,o.features[p].geometry)}else if(o.type==="Feature"){const p=o.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Fn(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Fn(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=r.canonicalID();if(o.type==="Polygon"){const T=aa(o.coordinates,g,v),k=Ko(r.geometry(),p,g,v);if(!ss(p,g))return!1;for(const A of k)if(!Ua(A,T))return!1}if(o.type==="MultiPolygon"){const T=Ga(o.coordinates,g,v),k=Ko(r.geometry(),p,g,v);if(!ss(p,g))return!1;for(const A of k)if(!Na(A,T))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=r.canonicalID();if(o.type==="Polygon"){const T=aa(o.coordinates,g,v),k=Jo(r.geometry(),p,g,v);if(!ss(p,g))return!1;for(const A of k)if(!ja(A,T))return!1}if(o.type==="MultiPolygon"){const T=Ga(o.coordinates,g,v),k=Jo(r.geometry(),p,g,v);if(!ss(p,g))return!1;for(const A of k)if(!uc(A,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Ms(i){if(i instanceof si&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Fn)return!1;let e=!0;return i.eachChild(r=>{e&&!Ms(r)&&(e=!1)}),e}function as(i){if(i instanceof si&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!as(r)&&(e=!1)}),e}function oa(i,e){if(i instanceof si&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!oa(o,e)&&(r=!1)}),r}class la{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new la(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class os{constructor(e,r=[],o,p=new Sr,g=[]){this.registry=e,this.path=r,this.key=r.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=g,this.expectedType=o}parse(e,r,o,p,g={}){return r?this.concat(r,o,p)._parse(e,g):this._parse(e,g)}_parse(e,r){function o(p,g,v){return v==="assert"?new kt(g,[p]):v==="coerce"?new zt(g,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let v=g.parse(e,this);if(!v)return null;if(this.expectedType){const T=this.expectedType,k=v.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||k.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(T.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array"){if(this.checkSubtype(T,k))return null}else v=o(v,T,r.typeAnnotation||"coerce");else v=o(v,T,r.typeAnnotation||"coerce");else v=o(v,T,r.typeAnnotation||"assert")}if(!(v instanceof ft)&&v.type.kind!=="resolvedImage"&&qa(v)){const T=new Wt;try{v=new ft(v.type,v.evaluate(T))}catch(k){return this.error(k.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const p=typeof e=="number"?this.path.concat(e):this.path,g=o?this.scope.concat(o):this.scope;return new os(this.registry,p,r||null,g,this.errors)}error(e,...r){const o=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new Er(o,e))}checkSubtype(e,r){const o=Qr(e,r);return o&&this.error(o),o}}function qa(i){if(i instanceof la)return qa(i.boundExpression);if(i instanceof si&&i.name==="error"||i instanceof Gi||i instanceof Fn)return!1;const e=i instanceof zt||i instanceof kt;let r=!0;return i.eachChild(o=>{r=e?r&&qa(o):r&&o instanceof ft}),!!r&&Ms(i)&&oa(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ca(i,e){const r=i.length-1;let o,p,g=0,v=r,T=0;for(;g<=v;)if(T=Math.floor((g+v)/2),o=i[T],p=i[T+1],o<=e){if(T===r||e<p)return T;g=T+1}else{if(!(o>e))throw new rt("Input is not a number.");v=T-1}return 0}class Ps{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[p,g]of o)this.labels.push(p),this.outputs.push(g)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Ke);if(!o)return null;const p=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let v=1;v<e.length;v+=2){const T=v===1?-1/0:e[v],k=e[v+1],A=v,L=v+1;if(typeof T!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=T)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const F=r.parse(k,L,g);if(!F)return null;g=g||F.type,p.push([T,F])}return new Ps(g,o,p)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return o[0].evaluate(e);const g=r.length;return p>=r[g-1]?o[g-1].evaluate(e):o[ca(r,p)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function xi(i,e,r){return i*(1-r)+e*r}var Ds=Object.freeze({__proto__:null,number:xi,color:function(i,e,r){return new W(xi(i.r,e.r,r),xi(i.g,e.g,r),xi(i.b,e.b,r),xi(i.a,e.a,r))},array:function(i,e,r){return i.map((o,p)=>xi(o,e[p],r))},padding:function(i,e,r){const o=i.values,p=e.values;return new se([xi(o[0],p[0],r),xi(o[1],p[1],r),xi(o[2],p[2],r),xi(o[3],p[3],r)])}});const Yo=.95047,Qo=1.08883,Za=4/29,ua=6/29,$o=3*ua*ua,hc=Math.PI/180,fc=180/Math.PI;function Xa(i){return i>.008856451679035631?Math.pow(i,1/3):i/$o+Za}function Ha(i){return i>ua?i*i*i:$o*(i-Za)}function Wa(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Ka(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Jt(i){const e=Ka(i.r),r=Ka(i.g),o=Ka(i.b),p=Xa((.4124564*e+.3575761*r+.1804375*o)/Yo),g=Xa((.2126729*e+.7151522*r+.072175*o)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-Xa((.0193339*e+.119192*r+.9503041*o)/Qo)),alpha:i.a}}function el(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*Ha(e),r=Yo*Ha(r),o=Qo*Ha(o),new W(Wa(3.2404542*r-1.5371385*e-.4985314*o),Wa(-.969266*r+1.8760108*e+.041556*o),Wa(.0556434*r-.2040259*e+1.0572252*o),i.alpha)}function dc(i,e,r){const o=e-i;return i+r*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ls={forward:Jt,reverse:el,interpolate:function(i,e,r){return{l:xi(i.l,e.l,r),a:xi(i.a,e.a,r),b:xi(i.b,e.b,r),alpha:xi(i.alpha,e.alpha,r)}}},Bs={forward:function(i){const{l:e,a:r,b:o}=Jt(i),p=Math.atan2(o,r)*fc;return{h:p<0?p+360:p,c:Math.sqrt(r*r+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*hc,r=i.c;return el({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:dc(i.h,e.h,r),c:xi(i.c,e.c,r),l:xi(i.l,e.l,r),alpha:xi(i.alpha,e.alpha,r)}}};var tl=Object.freeze({__proto__:null,lab:Ls,hcl:Bs});class Ir{constructor(e,r,o,p,g){this.type=e,this.operator=r,this.interpolation=o,this.input=p,this.labels=[],this.outputs=[];for(const[v,T]of g)this.labels.push(v),this.outputs.push(T)}static interpolationFactor(e,r,o,p){let g=0;if(e.name==="exponential")g=Ja(r,e.base,o,p);else if(e.name==="linear")g=Ja(r,1,o,p);else if(e.name==="cubic-bezier"){const v=e.controlPoints;g=new b(v[0],v[1],v[2],v[3]).solve(Ja(r,1,o,p))}return g}static parse(e,r){let[o,p,g,...v]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const A=p[1];if(typeof A!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:A}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const A=p.slice(1);if(A.length!==4||A.some(L=>typeof L!="number"||L<0||L>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,Ke),!g)return null;const T=[];let k=null;o==="interpolate-hcl"||o==="interpolate-lab"?k=Ji:r.expectedType&&r.expectedType.kind!=="value"&&(k=r.expectedType);for(let A=0;A<v.length;A+=2){const L=v[A],F=v[A+1],j=A+3,q=A+4;if(typeof L!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(T.length&&T[T.length-1][0]>=L)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const Z=r.parse(F,q,k);if(!Z)return null;k=k||Z.type,T.push([L,Z])}return k.kind==="number"||k.kind==="color"||k.kind==="padding"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new Ir(k,o,p,g,T):r.error(`Type ${ii(k)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return o[0].evaluate(e);const g=r.length;if(p>=r[g-1])return o[g-1].evaluate(e);const v=ca(r,p),T=Ir.interpolationFactor(this.interpolation,p,r[v],r[v+1]),k=o[v].evaluate(e),A=o[v+1].evaluate(e);return this.operator==="interpolate"?Ds[this.type.kind.toLowerCase()](k,A,T):this.operator==="interpolate-hcl"?Bs.reverse(Bs.interpolate(Bs.forward(k),Bs.forward(A),T)):Ls.reverse(Ls.interpolate(Ls.forward(k),Ls.forward(A),T))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ja(i,e,r,o){const p=o-r,g=i-r;return p===0?0:e===1?g/p:(Math.pow(e,g)-1)/(Math.pow(e,p)-1)}class ha{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let o=null;const p=r.expectedType;p&&p.kind!=="value"&&(o=p);const g=[];for(const T of e.slice(1)){const k=r.parse(T,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!k)return null;o=o||k.type,g.push(k)}if(!o)throw new Error("No output type");const v=p&&g.some(T=>Qr(p,T.type));return new ha(v?Mt:o,g)}evaluate(e){let r,o=null,p=0;for(const g of this.args)if(p++,o=g.evaluate(e),o&&o instanceof fe&&!o.available&&(r||(r=o.name),o=null,p===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class fa{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let g=1;g<e.length-1;g+=2){const v=e[g];if(typeof v!="string")return r.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const T=r.parse(e[g+1],g+1);if(!T)return null;o.push([v,T])}const p=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return p?new fa(o,p):null}outputDefined(){return this.result.outputDefined()}}class Ya{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Ke),p=r.parse(e[2],2,hr(r.expectedType||Mt));return o&&p?new Ya(p.type.itemType,o,p):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new rt(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new rt(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new rt(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Qa{constructor(e,r){this.type=Pt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Mt),p=r.parse(e[2],2,Mt);return o&&p?Ln(o.type,[Pt,Rt,Ke,wn,Mt])?new Qa(o,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Bn(r,["boolean","string","number","null"]))throw new rt(`Expected first argument to be of type boolean, string, number or null, but found ${ii(Ie(r))} instead.`);if(!Bn(o,["string","array"]))throw new rt(`Expected second argument to be of type array or string, but found ${ii(Ie(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class da{constructor(e,r,o){this.type=Ke,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Mt),p=r.parse(e[2],2,Mt);if(!o||!p)return null;if(!Ln(o.type,[Pt,Rt,Ke,wn,Mt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(o.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,Ke);return g?new da(o,p,g):null}return new da(o,p)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Bn(r,["boolean","string","number","null"]))throw new rt(`Expected first argument to be of type boolean, string, number or null, but found ${ii(Ie(r))} instead.`);if(!Bn(o,["string","array"]))throw new rt(`Expected second argument to be of type array or string, but found ${ii(Ie(o))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return o.indexOf(r,p)}return o.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class $a{constructor(e,r,o,p,g,v){this.inputType=e,this.type=r,this.input=o,this.cases=p,this.outputs=g,this.otherwise=v}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const g={},v=[];for(let A=2;A<e.length-1;A+=2){let L=e[A];const F=e[A+1];Array.isArray(L)||(L=[L]);const j=r.concat(A);if(L.length===0)return j.error("Expected at least one branch label.");for(const Z of L){if(typeof Z!="number"&&typeof Z!="string")return j.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return j.error("Numeric branch labels must be integer values.");if(o){if(j.checkSubtype(o,Ie(Z)))return null}else o=Ie(Z);if(g[String(Z)]!==void 0)return j.error("Branch labels must be unique.");g[String(Z)]=v.length}const q=r.parse(F,A,p);if(!q)return null;p=p||q.type,v.push(q)}const T=r.parse(e[1],1,Mt);if(!T)return null;const k=r.parse(e[e.length-1],e.length-1,p);return k?T.type.kind!=="value"&&r.concat(1).checkSubtype(o,T.type)?null:new $a(o,p,T,g,v,k):null}evaluate(e){const r=this.input.evaluate(e);return(Ie(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class eo{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const p=[];for(let v=1;v<e.length-1;v+=2){const T=r.parse(e[v],v,Pt);if(!T)return null;const k=r.parse(e[v+1],v+1,o);if(!k)return null;p.push([T,k]),o=o||k.type}const g=r.parse(e[e.length-1],e.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new eo(o,p,g)}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class pa{constructor(e,r,o,p){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Mt),p=r.parse(e[2],2,Ke);if(!o||!p)return null;if(!Ln(o.type,[hr(Mt),Rt,Mt]))return r.error(`Expected first argument to be of type array or string, but found ${ii(o.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,Ke);return g?new pa(o.type,o,p,g):null}return new pa(o.type,o,p)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Bn(r,["string","array"]))throw new rt(`Expected first argument to be of type array or string, but found ${ii(Ie(r))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return r.slice(o,p)}return r.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function il(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function rl(i,e,r,o){return o.compare(e,r)===0}function ls(i,e,r){const o=i!=="=="&&i!=="!=";return class _p{constructor(g,v,T){this.type=Pt,this.lhs=g,this.rhs=v,this.collator=T,this.hasUntypedArgument=g.type.kind==="value"||v.type.kind==="value"}static parse(g,v){if(g.length!==3&&g.length!==4)return v.error("Expected two or three arguments.");const T=g[0];let k=v.parse(g[1],1,Mt);if(!k)return null;if(!il(T,k.type))return v.concat(1).error(`"${T}" comparisons are not supported for type '${ii(k.type)}'.`);let A=v.parse(g[2],2,Mt);if(!A)return null;if(!il(T,A.type))return v.concat(2).error(`"${T}" comparisons are not supported for type '${ii(A.type)}'.`);if(k.type.kind!==A.type.kind&&k.type.kind!=="value"&&A.type.kind!=="value")return v.error(`Cannot compare types '${ii(k.type)}' and '${ii(A.type)}'.`);o&&(k.type.kind==="value"&&A.type.kind!=="value"?k=new kt(A.type,[k]):k.type.kind!=="value"&&A.type.kind==="value"&&(A=new kt(k.type,[A])));let L=null;if(g.length===4){if(k.type.kind!=="string"&&A.type.kind!=="string"&&k.type.kind!=="value"&&A.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(L=v.parse(g[3],3,cn),!L)return null}return new _p(k,A,L)}evaluate(g){const v=this.lhs.evaluate(g),T=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const k=Ie(v),A=Ie(T);if(k.kind!==A.kind||k.kind!=="string"&&k.kind!=="number")throw new rt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${k.kind}, ${A.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const k=Ie(v),A=Ie(T);if(k.kind!=="string"||A.kind!=="string")return e(g,v,T)}return this.collator?r(g,v,T,this.collator.evaluate(g)):e(g,v,T)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const pc=ls("==",function(i,e,r){return e===r},rl),mc=ls("!=",function(i,e,r){return e!==r},function(i,e,r,o){return!rl(0,e,r,o)}),gc=ls("<",function(i,e,r){return e<r},function(i,e,r,o){return o.compare(e,r)<0}),_c=ls(">",function(i,e,r){return e>r},function(i,e,r,o){return o.compare(e,r)>0}),yc=ls("<=",function(i,e,r){return e<=r},function(i,e,r,o){return o.compare(e,r)<=0}),vc=ls(">=",function(i,e,r){return e>=r},function(i,e,r,o){return o.compare(e,r)>=0});class to{constructor(e,r,o,p,g){this.type=Rt,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Ke);if(!o)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=r.parse(p.locale,1,Rt),!g))return null;let v=null;if(p.currency&&(v=r.parse(p.currency,1,Rt),!v))return null;let T=null;if(p["min-fraction-digits"]&&(T=r.parse(p["min-fraction-digits"],1,Ke),!T))return null;let k=null;return p["max-fraction-digits"]&&(k=r.parse(p["max-fraction-digits"],1,Ke),!k)?null:new to(o,g,v,T,k)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ma{constructor(e){this.type=ji,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const p=[];let g=!1;for(let v=1;v<=e.length-1;++v){const T=e[v];if(g&&typeof T=="object"&&!Array.isArray(T)){g=!1;let k=null;if(T["font-scale"]&&(k=r.parse(T["font-scale"],1,Ke),!k))return null;let A=null;if(T["text-font"]&&(A=r.parse(T["text-font"],1,hr(Rt)),!A))return null;let L=null;if(T["text-color"]&&(L=r.parse(T["text-color"],1,Ji),!L))return null;const F=p[p.length-1];F.scale=k,F.font=A,F.textColor=L}else{const k=r.parse(e[v],1,Mt);if(!k)return null;const A=k.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:k,scale:null,font:null,textColor:null})}}return new ma(p)}evaluate(e){return new oe(this.sections.map(r=>{const o=r.content.evaluate(e);return Ie(o)===Pi?new ue("",o,null,null,null):new ue(ut(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class io{constructor(e){this.type=Pi,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Rt);return o?new io(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=fe.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class ro{constructor(e){this.type=Ke,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ii(o.type)} instead.`):new ro(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new rt(`Expected value to be of type string or array, but found ${ii(Ie(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const cs={"==":pc,"!=":mc,">":_c,"<":gc,">=":vc,"<=":yc,array:kt,at:Ya,boolean:kt,case:eo,coalesce:ha,collator:Gi,format:ma,image:io,in:Qa,"index-of":da,interpolate:Ir,"interpolate-hcl":Ir,"interpolate-lab":Ir,length:ro,let:fa,literal:ft,match:$a,number:kt,"number-format":to,object:kt,slice:pa,step:Ps,string:kt,"to-boolean":zt,"to-color":zt,"to-number":zt,"to-string":zt,var:la,within:Fn};function nl(i,[e,r,o,p]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const g=p?p.evaluate(i):1,v=Ce(e,r,o,g);if(v)throw new rt(v);return new W(e/255*g,r/255*g,o/255*g,g)}function sl(i,e){return i in e}function ga(i,e){const r=e[i];return r===void 0?null:r}function On(i){return{type:i}}function al(i){return{result:"success",value:i}}function us(i){return{result:"error",value:i}}function gi(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ol(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Gt(i){return!!i.expression&&i.expression.interpolated}function Yt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function mi(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function bi(i){return i}function Rs(i,e){const r=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",p=o||!(o||i.property!==void 0),g=i.type||(Gt(e)?"exponential":"interval");if(r||e.type==="padding"){const A=r?W.parse:se.parse;(i=jr({},i)).stops&&(i.stops=i.stops.map(L=>[L[0],A(L[1])])),i.default=A(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!tl[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let v,T,k;if(g==="exponential")v=ll;else if(g==="interval")v=bc;else if(g==="categorical"){v=xc,T=Object.create(null);for(const A of i.stops)T[A[0]]=A[1];k=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=wc}if(o){const A={},L=[];for(let q=0;q<i.stops.length;q++){const Z=i.stops[q],re=Z[0].zoom;A[re]===void 0&&(A[re]={zoom:re,type:i.type,property:i.property,default:i.default,stops:[]},L.push(re)),A[re].stops.push([Z[0].value,Z[1]])}const F=[];for(const q of L)F.push([A[q].zoom,Rs(A[q],e)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Ir.interpolationFactor.bind(void 0,j),zoomStops:F.map(q=>q[0]),evaluate:({zoom:q},Z)=>ll({stops:F,base:i.base},e,q).evaluate(q,Z)}}if(p){const A=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Ir.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(L=>L[0]),evaluate:({zoom:L})=>v(i,e,L,T,k)}}return{kind:"source",evaluate(A,L){const F=L&&L.properties?L.properties[i.property]:void 0;return F===void 0?hs(i.default,e.default):v(i,e,F,T,k)}}}function hs(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function xc(i,e,r,o,p){return hs(typeof r===p?o[r]:void 0,i.default,e.default)}function bc(i,e,r){if(Yt(r)!=="number")return hs(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const p=ca(i.stops.map(g=>g[0]),r);return i.stops[p][1]}function ll(i,e,r){const o=i.base!==void 0?i.base:1;if(Yt(r)!=="number")return hs(i.default,e.default);const p=i.stops.length;if(p===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[p-1][0])return i.stops[p-1][1];const g=ca(i.stops.map(L=>L[0]),r),v=function(L,F,j,q){const Z=q-j,re=L-j;return Z===0?0:F===1?re/Z:(Math.pow(F,re)-1)/(Math.pow(F,Z)-1)}(r,o,i.stops[g][0],i.stops[g+1][0]),T=i.stops[g][1],k=i.stops[g+1][1];let A=Ds[e.type]||bi;if(i.colorSpace&&i.colorSpace!=="rgb"){const L=tl[i.colorSpace];A=(F,j)=>L.reverse(L.interpolate(L.forward(F),L.forward(j),v))}return typeof T.evaluate=="function"?{evaluate(...L){const F=T.evaluate.apply(void 0,L),j=k.evaluate.apply(void 0,L);if(F!==void 0&&j!==void 0)return A(F,j,v)}}:A(T,k,v)}function wc(i,e,r){switch(e.type){case"color":r=W.parse(r);break;case"formatted":r=oe.fromString(r.toString());break;case"resolvedImage":r=fe.fromString(r.toString());break;case"padding":r=se.parse(r);break;default:Yt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return hs(r,i.default,e.default)}si.register(cs,{error:[{kind:"error"},[Rt],(i,[e])=>{throw new rt(e.evaluate(i))}],typeof:[Rt,[Mt],(i,[e])=>ii(Ie(e.evaluate(i)))],"to-rgba":[hr(Ke,4),[Ji],(i,[e])=>e.evaluate(i).toArray()],rgb:[Ji,[Ke,Ke,Ke],nl],rgba:[Ji,[Ke,Ke,Ke,Ke],nl],has:{type:Pt,overloads:[[[Rt],(i,[e])=>sl(e.evaluate(i),i.properties())],[[Rt,Tn],(i,[e,r])=>sl(e.evaluate(i),r.evaluate(i))]]},get:{type:Mt,overloads:[[[Rt],(i,[e])=>ga(e.evaluate(i),i.properties())],[[Rt,Tn],(i,[e,r])=>ga(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Mt,[Rt],(i,[e])=>ga(e.evaluate(i),i.featureState||{})],properties:[Tn,[],i=>i.properties()],"geometry-type":[Rt,[],i=>i.geometryType()],id:[Mt,[],i=>i.id()],zoom:[Ke,[],i=>i.globals.zoom],"heatmap-density":[Ke,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ke,[],i=>i.globals.lineProgress||0],accumulated:[Mt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ke,On(Ke),(i,e)=>{let r=0;for(const o of e)r+=o.evaluate(i);return r}],"*":[Ke,On(Ke),(i,e)=>{let r=1;for(const o of e)r*=o.evaluate(i);return r}],"-":{type:Ke,overloads:[[[Ke,Ke],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ke],(i,[e])=>-e.evaluate(i)]]},"/":[Ke,[Ke,Ke],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ke,[Ke,Ke],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ke,[Ke],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ke,[Ke],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ke,[Ke],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ke,[Ke],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ke,[Ke],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ke,[Ke],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ke,[Ke],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ke,[Ke],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ke,[Ke],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ke,[Ke],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ke,On(Ke),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ke,On(Ke),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ke,[Ke],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ke,[Ke],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ke,[Ke],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ke,[Ke],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Pt,[Rt,Mt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Pt,[Mt],(i,[e])=>i.id()===e.value],"filter-type-==":[Pt,[Rt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Pt,[Rt,Mt],(i,[e,r])=>{const o=i.properties()[e.value],p=r.value;return typeof o==typeof p&&o<p}],"filter-id-<":[Pt,[Mt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[Pt,[Rt,Mt],(i,[e,r])=>{const o=i.properties()[e.value],p=r.value;return typeof o==typeof p&&o>p}],"filter-id->":[Pt,[Mt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[Pt,[Rt,Mt],(i,[e,r])=>{const o=i.properties()[e.value],p=r.value;return typeof o==typeof p&&o<=p}],"filter-id-<=":[Pt,[Mt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[Pt,[Rt,Mt],(i,[e,r])=>{const o=i.properties()[e.value],p=r.value;return typeof o==typeof p&&o>=p}],"filter-id->=":[Pt,[Mt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[Pt,[Mt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Pt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Pt,[hr(Rt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Pt,[hr(Mt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Pt,[Rt,hr(Mt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Pt,[Rt,hr(Mt)],(i,[e,r])=>function(o,p,g,v){for(;g<=v;){const T=g+v>>1;if(p[T]===o)return!0;p[T]>o?v=T-1:g=T+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[On(Pt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[On(Pt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Pt,[Pt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Pt,[Rt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Rt,[Rt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Rt,[Rt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Rt,On(Mt),(i,e)=>e.map(r=>ut(r.evaluate(i))).join("")],"resolved-locale":[Rt,[cn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class _a{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Wt,this._defaultValue=r?function(o){return o.type==="color"&&mi(o.default)?new W(0,0,0,0):o.type==="color"?W.parse(o.default)||null:o.type==="padding"?se.parse(o.default)||null:o.default===void 0?null:o.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,o,p,g,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,p,g,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new rt(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Fs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in cs}function Os(i,e){const r=new os(cs,[],e?function(p){const g={color:Ji,string:Rt,number:Ke,enum:Rt,boolean:Pt,formatted:ji,padding:is,resolvedImage:Pi};return p.type==="array"?hr(g[p.value]||Mt,p.length):g[p.type]}(e):void 0),o=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?al(new _a(o,e)):us(r.errors)}class Vs{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!as(r.expression)}evaluateWithoutErrorHandling(e,r,o,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,p,g,v)}evaluate(e,r,o,p,g,v){return this._styleExpression.evaluate(e,r,o,p,g,v)}}class no{constructor(e,r,o,p){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!as(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,o,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,p,g,v)}evaluate(e,r,o,p,g,v){return this._styleExpression.evaluate(e,r,o,p,g,v)}interpolationFactor(e,r,o){return this.interpolationType?Ir.interpolationFactor(this.interpolationType,e,r,o):0}}function cl(i,e){const r=Os(i,e);if(r.result==="error")return r;const o=r.value.expression,p=Ms(o);if(!p&&!gi(e))return us([new Er("","data expressions not supported")]);const g=oa(o,["zoom"]);if(!g&&!ol(e))return us([new Er("","zoom expressions not supported")]);const v=va(o);return v||g?v instanceof Er?us([v]):v instanceof Ir&&!Gt(e)?us([new Er("",'"interpolate" expressions cannot be used with this property')]):al(v?new no(p?"camera":"composite",r.value,v.labels,v instanceof Ir?v.interpolation:void 0):new Vs(p?"constant":"source",r.value)):us([new Er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ya{constructor(e,r){this._parameters=e,this._specification=r,jr(this,Rs(this._parameters,this._specification))}static deserialize(e){return new ya(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function va(i){let e=null;if(i instanceof fa)e=va(i.result);else if(i instanceof ha){for(const r of i.args)if(e=va(r),e)break}else(i instanceof Ps||i instanceof Ir)&&i.input instanceof si&&i.input.name==="zoom"&&(e=i);return e instanceof Er||i.eachChild(r=>{const o=va(r);o instanceof Er?e=o:!e&&o?e=new Er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Er("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Gr(i){const e=i.key,r=i.value,o=i.valueSpec||{},p=i.objectElementValidators||{},g=i.style,v=i.styleSpec;let T=[];const k=Yt(r);if(k!=="object")return[new Qe(e,r,`object expected, ${k} found`)];for(const A in r){const L=A.split(".")[0],F=o[L]||o["*"];let j;if(p[L])j=p[L];else if(o[L])j=Ar;else if(p["*"])j=p["*"];else{if(!o["*"]){T.push(new Qe(e,r[A],`unknown property "${A}"`));continue}j=Ar}T=T.concat(j({key:(e&&`${e}.`)+A,value:r[A],valueSpec:F,style:g,styleSpec:v,object:r,objectKey:A},r))}for(const A in o)p[A]||o[A].required&&o[A].default===void 0&&r[A]===void 0&&T.push(new Qe(e,r,`missing required property "${A}"`));return T}function ul(i){const e=i.value,r=i.valueSpec,o=i.style,p=i.styleSpec,g=i.key,v=i.arrayElementValidator||Ar;if(Yt(e)!=="array")return[new Qe(g,e,`array expected, ${Yt(e)} found`)];if(r.length&&e.length!==r.length)return[new Qe(g,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Qe(g,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let T={type:r.value,values:r.values};p.$version<7&&(T.function=r.function),Yt(r.value)==="object"&&(T=r.value);let k=[];for(let A=0;A<e.length;A++)k=k.concat(v({array:e,arrayIndex:A,value:e[A],valueSpec:T,style:o,styleSpec:p,key:`${g}[${A}]`}));return k}function so(i){const e=i.key,r=i.value,o=i.valueSpec;let p=Yt(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new Qe(e,r,`number expected, ${p} found`)]:"minimum"in o&&r<o.minimum?[new Qe(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Qe(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function hl(i){const e=i.valueSpec,r=Xt(i.value.type);let o,p,g,v={};const T=r!=="categorical"&&i.value.property===void 0,k=!T,A=Yt(i.value.stops)==="array"&&Yt(i.value.stops[0])==="array"&&Yt(i.value.stops[0][0])==="object",L=Gr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(q){if(r==="identity")return[new Qe(q.key,q.value,'identity function may not have a "stops" property')];let Z=[];const re=q.value;return Z=Z.concat(ul({key:q.key,value:re,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:F})),Yt(re)==="array"&&re.length===0&&Z.push(new Qe(q.key,re,"array must have at least one stop")),Z},default:function(q){return Ar({key:q.key,value:q.value,valueSpec:e,style:q.style,styleSpec:q.styleSpec})}}});return r==="identity"&&T&&L.push(new Qe(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||L.push(new Qe(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Gt(i.valueSpec)&&L.push(new Qe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(k&&!gi(i.valueSpec)?L.push(new Qe(i.key,i.value,"property functions not supported")):T&&!ol(i.valueSpec)&&L.push(new Qe(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!A||i.value.property!==void 0||L.push(new Qe(i.key,i.value,'"property" property is required')),L;function F(q){let Z=[];const re=q.value,te=q.key;if(Yt(re)!=="array")return[new Qe(te,re,`array expected, ${Yt(re)} found`)];if(re.length!==2)return[new Qe(te,re,`array length 2 expected, length ${re.length} found`)];if(A){if(Yt(re[0])!=="object")return[new Qe(te,re,`object expected, ${Yt(re[0])} found`)];if(re[0].zoom===void 0)return[new Qe(te,re,"object stop key must have zoom")];if(re[0].value===void 0)return[new Qe(te,re,"object stop key must have value")];if(g&&g>Xt(re[0].zoom))return[new Qe(te,re[0].zoom,"stop zoom values must appear in ascending order")];Xt(re[0].zoom)!==g&&(g=Xt(re[0].zoom),p=void 0,v={}),Z=Z.concat(Gr({key:`${te}[0]`,value:re[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:so,value:j}}))}else Z=Z.concat(j({key:`${te}[0]`,value:re[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},re));return Fs(Fr(re[1]))?Z.concat([new Qe(`${te}[1]`,re[1],"expressions are not allowed in function stops.")]):Z.concat(Ar({key:`${te}[1]`,value:re[1],valueSpec:e,style:q.style,styleSpec:q.styleSpec}))}function j(q,Z){const re=Yt(q.value),te=Xt(q.value),me=q.value!==null?q.value:Z;if(o){if(re!==o)return[new Qe(q.key,me,`${re} stop domain type must match previous stop domain type ${o}`)]}else o=re;if(re!=="number"&&re!=="string"&&re!=="boolean")return[new Qe(q.key,me,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&r!=="categorical"){let Te=`number expected, ${re} found`;return gi(e)&&r===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(q.key,me,Te)]}return r!=="categorical"||re!=="number"||isFinite(te)&&Math.floor(te)===te?r!=="categorical"&&re==="number"&&p!==void 0&&te<p?[new Qe(q.key,me,"stop domain values must appear in ascending order")]:(p=te,r==="categorical"&&te in v?[new Qe(q.key,me,"stop domain values must be unique")]:(v[te]=!0,[])):[new Qe(q.key,me,`integer expected, found ${te}`)]}}function Vn(i){const e=(i.expressionContext==="property"?cl:Os)(Fr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Qe(`${i.key}${o.key}`,i.value,o.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Qe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!as(r))return[new Qe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!as(r))return[new Qe(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!oa(r,["zoom","feature-state"]))return[new Qe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ms(r))return[new Qe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Us(i){const e=i.key,r=i.value,o=i.valueSpec,p=[];return Array.isArray(o.values)?o.values.indexOf(Xt(r))===-1&&p.push(new Qe(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Xt(r))===-1&&p.push(new Qe(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function fs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!fs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Tc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function xa(i){if(i==null)return{filter:()=>!0,needGeometry:!1};fs(i)||(i=Ns(i));const e=Os(i,Tc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,p)=>e.value.evaluate(r,o,{},p),needGeometry:dl(i)}}function fl(i,e){return i<e?-1:i>e?1:0}function dl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(dl(i[e]))return!0;return!1}function Ns(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ao(i[1],i[2],"=="):e==="!="?ds(ao(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ao(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Ns))):e==="all"?["all"].concat(i.slice(1).map(Ns)):e==="none"?["all"].concat(i.slice(1).map(Ns).map(ds)):e==="in"?ba(i[1],i.slice(2)):e==="!in"?ds(ba(i[1],i.slice(2))):e==="has"?js(i[1]):e==="!has"?ds(js(i[1])):e!=="within"||i;var r}function ao(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function ba(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(fl)]]:["filter-in-small",i,["literal",e]]}}function js(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ds(i){return["!",i]}function Gs(i){return fs(Fr(i.value))?Vn(jr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pl(i)}function pl(i){const e=i.value,r=i.key;if(Yt(e)!=="array")return[new Qe(r,e,`array expected, ${Yt(e)} found`)];const o=i.styleSpec;let p,g=[];if(e.length<1)return[new Qe(r,e,"filter array must have at least 1 element")];switch(g=g.concat(Us({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Xt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Xt(e[1])==="$type"&&g.push(new Qe(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Qe(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Yt(e[1]),p!=="string"&&g.push(new Qe(`${r}[1]`,e[1],`string expected, ${p} found`)));for(let v=2;v<e.length;v++)p=Yt(e[v]),Xt(e[1])==="$type"?g=g.concat(Us({key:`${r}[${v}]`,value:e[v],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new Qe(`${r}[${v}]`,e[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<e.length;v++)g=g.concat(pl({key:`${r}[${v}]`,value:e[v],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Yt(e[1]),e.length!==2?g.push(new Qe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new Qe(`${r}[1]`,e[1],`string expected, ${p} found`));break;case"within":p=Yt(e[1]),e.length!==2?g.push(new Qe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="object"&&g.push(new Qe(`${r}[1]`,e[1],`object expected, ${p} found`))}return g}function qs(i,e){const r=i.key,o=i.style,p=i.styleSpec,g=i.value,v=i.objectKey,T=p[`${e}_${i.layerType}`];if(!T)return[];const k=v.match(/^(.*)-transition$/);if(e==="paint"&&k&&T[k[1]]&&T[k[1]].transition)return Ar({key:r,value:g,valueSpec:p.transition,style:o,styleSpec:p});const A=i.valueSpec||T[v];if(!A)return[new Qe(r,g,`unknown property "${v}"`)];let L;if(Yt(g)==="string"&&gi(A)&&!A.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new Qe(r,g,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&(v==="text-field"&&o&&!o.glyphs&&F.push(new Qe(r,g,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&mi(Fr(g))&&Xt(g.type)==="identity"&&F.push(new Qe(r,g,'"text-font" does not support identity functions'))),F.concat(Ar({key:i.key,value:g,valueSpec:A,style:o,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:v}))}function ml(i){return qs(i,"paint")}function gl(i){return qs(i,"layout")}function _l(i){let e=[];const r=i.value,o=i.key,p=i.style,g=i.styleSpec;r.type||r.ref||e.push(new Qe(o,r,'either "type" or "ref" is required'));let v=Xt(r.type);const T=Xt(r.ref);if(r.id){const k=Xt(r.id);for(let A=0;A<i.arrayIndex;A++){const L=p.layers[A];Xt(L.id)===k&&e.push(new Qe(o,r.id,`duplicate layer id "${r.id}", previously used at line ${L.id.__line__}`))}}if("ref"in r){let k;["type","source","source-layer","filter","layout"].forEach(A=>{A in r&&e.push(new Qe(o,r[A],`"${A}" is prohibited for ref layers`))}),p.layers.forEach(A=>{Xt(A.id)===T&&(k=A)}),k?k.ref?e.push(new Qe(o,r.ref,"ref cannot reference another ref layer")):v=Xt(k.type):e.push(new Qe(o,r.ref,`ref layer "${T}" not found`))}else if(v!=="background")if(r.source){const k=p.sources&&p.sources[r.source],A=k&&Xt(k.type);k?A==="vector"&&v==="raster"?e.push(new Qe(o,r.source,`layer "${r.id}" requires a raster source`)):A==="raster"&&v!=="raster"?e.push(new Qe(o,r.source,`layer "${r.id}" requires a vector source`)):A!=="vector"||r["source-layer"]?A==="raster-dem"&&v!=="hillshade"?e.push(new Qe(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!r.paint||!r.paint["line-gradient"]||A==="geojson"&&k.lineMetrics||e.push(new Qe(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Qe(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Qe(o,r.source,`source "${r.source}" not found`))}else e.push(new Qe(o,r,'missing required property "source"'));return e=e.concat(Gr({key:o,value:r,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ar({key:`${o}.type`,value:r.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:Gs,layout:k=>Gr({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":A=>gl(jr({layerType:v},A))}}),paint:k=>Gr({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":A=>ml(jr({layerType:v},A))}})}})),e}function ps(i){const e=i.value,r=i.key,o=Yt(e);return o!=="string"?[new Qe(r,e,`string expected, ${o} found`)]:[]}const yl={promoteId:function({key:i,value:e}){if(Yt(e)==="string")return ps({key:i,value:e});{const r=[];for(const o in e)r.push(...ps({key:`${i}.${o}`,value:e[o]}));return r}}};function Zs(i){const e=i.value,r=i.key,o=i.styleSpec,p=i.style;if(!e.type)return[new Qe(r,e,'"type" is required')];const g=Xt(e.type);let v;switch(g){case"vector":case"raster":case"raster-dem":return v=Gr({key:r,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:yl}),v;case"geojson":if(v=Gr({key:r,value:e,valueSpec:o.source_geojson,style:p,styleSpec:o,objectElementValidators:yl}),e.cluster)for(const T in e.clusterProperties){const[k,A]=e.clusterProperties[T],L=typeof k=="string"?[k,["accumulated"],["get",T]]:k;v.push(...Vn({key:`${r}.${T}.map`,value:A,expressionContext:"cluster-map"})),v.push(...Vn({key:`${r}.${T}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return Gr({key:r,value:e,valueSpec:o.source_video,style:p,styleSpec:o});case"image":return Gr({key:r,value:e,valueSpec:o.source_image,style:p,styleSpec:o});case"canvas":return[new Qe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Us({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:o})}}function Xs(i){const e=i.value,r=i.styleSpec,o=r.light,p=i.style;let g=[];const v=Yt(e);if(e===void 0)return g;if(v!=="object")return g=g.concat([new Qe("light",e,`object expected, ${v} found`)]),g;for(const T in e){const k=T.match(/^(.*)-transition$/);g=g.concat(k&&o[k[1]]&&o[k[1]].transition?Ar({key:T,value:e[T],valueSpec:r.transition,style:p,styleSpec:r}):o[T]?Ar({key:T,value:e[T],valueSpec:o[T],style:p,styleSpec:r}):[new Qe(T,e[T],`unknown property "${T}"`)])}return g}function Cr(i){const e=i.value,r=i.styleSpec,o=r.terrain,p=i.style;let g=[];const v=Yt(e);if(e===void 0)return g;if(v!=="object")return g=g.concat([new Qe("terrain",e,`object expected, ${v} found`)]),g;for(const T in e)g=g.concat(o[T]?Ar({key:T,value:e[T],valueSpec:o[T],style:p,styleSpec:r}):[new Qe(T,e[T],`unknown property "${T}"`)]);return g}const Hs={"*":()=>[],array:ul,boolean:function(i){const e=i.value,r=i.key,o=Yt(e);return o!=="boolean"?[new Qe(r,e,`boolean expected, ${o} found`)]:[]},number:so,color:function(i){const e=i.key,r=i.value,o=Yt(r);return o!=="string"?[new Qe(e,r,`color expected, ${o} found`)]:ns(r)===null?[new Qe(e,r,`color expected, "${r}" found`)]:[]},constants:Dn,enum:Us,filter:Gs,function:hl,layer:_l,object:Gr,source:Zs,light:Xs,terrain:Cr,string:ps,formatted:function(i){return ps(i).length===0?[]:Vn(i)},resolvedImage:function(i){return ps(i).length===0?[]:Vn(i)},padding:function(i){const e=i.key,r=i.value;if(Yt(r)==="array"){if(r.length<1||r.length>4)return[new Qe(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let p=[];for(let g=0;g<r.length;g++)p=p.concat(Ar({key:`${e}[${g}]`,value:r[g],valueSpec:o}));return p}return so({key:e,value:r,valueSpec:{}})}};function Ar(i){const e=i.value,r=i.valueSpec,o=i.styleSpec;return r.expression&&mi(Xt(e))?hl(i):r.expression&&Fs(Fr(e))?Vn(i):r.type&&Hs[r.type]?Hs[r.type](i):Gr(jr({},i,{valueSpec:r.type?o[r.type]:r}))}function kc(i){const e=i.value,r=i.key,o=ps(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Qe(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Qe(r,e,'"glyphs" url must include a "{range}" token'))),o}function kn(i,e=De){let r=[];return r=r.concat(Ar({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:kc,"*":()=>[]}})),i.constants&&(r=r.concat(Dn({key:"constants",value:i.constants,style:i,styleSpec:e}))),vl(r)}function vl(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function un(i){return function(...e){return vl(i.apply(this,e))}}kn.source=un(Zs),kn.light=un(Xs),kn.terrain=un(Cr),kn.layer=un(_l),kn.filter=un(Gs),kn.paintProperty=un(ml),kn.layoutProperty=un(gl);const Ws=kn,oo=Ws.light,Ec=Ws.paintProperty,Sc=Ws.layoutProperty;function wa(i,e){let r=!1;if(e&&e.length)for(const o of e)i.fire(new ts(new Error(o.message))),r=!0;return r}class Ks{constructor(e,r,o){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(r=v[1])+2*(o=v[2]);for(let k=0;k<this.d*this.d;k++){const A=v[3+k],L=v[3+k+1];p.push(A===L?null:v.subarray(A,L))}const T=v[3+p.length+1];this.keys=v.subarray(v[3+p.length],T),this.bboxes=v.subarray(T),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let v=0;v<this.d*this.d;v++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const g=o/r*e;this.min=-g,this.max=e+g}insert(e,r,o,p,g){this._forEachCell(r,o,p,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,p,g,v){this.cells[g].push(v)}query(e,r,o,p,g){const v=this.min,T=this.max;if(e<=v&&r<=v&&T<=o&&T<=p&&!g)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(e,r,o,p,this._queryCell,k,{},g),k}}_queryCell(e,r,o,p,g,v,T,k){const A=this.cells[g];if(A!==null){const L=this.keys,F=this.bboxes;for(let j=0;j<A.length;j++){const q=A[j];if(T[q]===void 0){const Z=4*q;(k?k(F[Z+0],F[Z+1],F[Z+2],F[Z+3]):e<=F[Z+2]&&r<=F[Z+3]&&o>=F[Z+0]&&p>=F[Z+1])?(T[q]=!0,v.push(L[q])):T[q]=!1}}}}_forEachCell(e,r,o,p,g,v,T,k){const A=this._convertToCellCoord(e),L=this._convertToCellCoord(r),F=this._convertToCellCoord(o),j=this._convertToCellCoord(p);for(let q=A;q<=F;q++)for(let Z=L;Z<=j;Z++){const re=this.d*Z+q;if((!k||k(this._convertFromCellCoord(q),this._convertFromCellCoord(Z),this._convertFromCellCoord(q+1),this._convertFromCellCoord(Z+1)))&&g.call(this,e,r,o,p,re,v,T,k))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let v=0;v<this.cells.length;v++)o+=this.cells[v].length;const p=new Int32Array(r+o+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let g=r;for(let v=0;v<e.length;v++){const T=e[v];p[3+v]=g,p.set(T,g),g+=T.length}return p[3+e.length]=g,p.set(this.keys,g),g+=this.keys.length,p[3+e.length+1]=g,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new Ks(e.buffer)}}const hn={};function ct(i,e,r={}){if(hn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),hn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}ct("Object",Object),ct("TransferableGridIndex",Ks),ct("Color",W),ct("Error",Error),ct("AJAXError",kr),ct("ResolvedImage",fe),ct("StylePropertyFunction",ya),ct("StyleExpression",_a,{omit:["_evaluator"]}),ct("ZoomDependentExpression",no),ct("ZoomConstantExpression",Vs),ct("CompoundExpression",si,{omit:["_evaluate"]});for(const i in cs)cs[i]._classRegistryKey||ct(`Expression_${i}`,cs[i]);function xl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Un(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(xl(i)||er(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const o of i)r.push(Un(o,e));return r}if(typeof i=="object"){const r=i.constructor,o=r._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!hn[o])throw new Error(`${o} is not registered.`);const p=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&p===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||hn[o].omit.indexOf(g)>=0)continue;const v=i[g];p[g]=hn[o].shallow.indexOf(g)>=0?v:Un(v,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(p.$name=o),p}throw new Error("can't serialize object of type "+typeof i)}function En(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||xl(i)||er(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(En);if(typeof i=="object"){const e=i.$name||"Object";if(!hn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=hn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const g=i[p];o[p]=hn[e].shallow.indexOf(p)>=0?g:En(g)}return o}throw new Error("can't deserialize object of type "+typeof i)}class lo{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const et={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Ta(i){for(const e of i)if(uo(e.charCodeAt(0)))return!0;return!1}function Ic(i){for(const e of i)if(!co(e.charCodeAt(0)))return!1;return!0}function co(i){return!(et.Arabic(i)||et["Arabic Supplement"](i)||et["Arabic Extended-A"](i)||et["Arabic Presentation Forms-A"](i)||et["Arabic Presentation Forms-B"](i))}function uo(i){return!(i!==746&&i!==747&&(i<4352||!(et["Bopomofo Extended"](i)||et.Bopomofo(i)||et["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||et["CJK Compatibility Ideographs"](i)||et["CJK Compatibility"](i)||et["CJK Radicals Supplement"](i)||et["CJK Strokes"](i)||!(!et["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||et["CJK Unified Ideographs Extension A"](i)||et["CJK Unified Ideographs"](i)||et["Enclosed CJK Letters and Months"](i)||et["Hangul Compatibility Jamo"](i)||et["Hangul Jamo Extended-A"](i)||et["Hangul Jamo Extended-B"](i)||et["Hangul Jamo"](i)||et["Hangul Syllables"](i)||et.Hiragana(i)||et["Ideographic Description Characters"](i)||et.Kanbun(i)||et["Kangxi Radicals"](i)||et["Katakana Phonetic Extensions"](i)||et.Katakana(i)&&i!==12540||!(!et["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!et["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||et["Unified Canadian Aboriginal Syllabics"](i)||et["Unified Canadian Aboriginal Syllabics Extended"](i)||et["Vertical Forms"](i)||et["Yijing Hexagram Symbols"](i)||et["Yi Syllables"](i)||et["Yi Radicals"](i))))}function bl(i){return!(uo(i)||function(e){return!!(et["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||et["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||et["Letterlike Symbols"](e)||et["Number Forms"](e)||et["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||et["Control Pictures"](e)&&e!==9251||et["Optical Character Recognition"](e)||et["Enclosed Alphanumerics"](e)||et["Geometric Shapes"](e)||et["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||et["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||et["CJK Symbols and Punctuation"](e)||et.Katakana(e)||et["Private Use Area"](e)||et["CJK Compatibility Forms"](e)||et["Small Form Variants"](e)||et["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function wl(i){return i>=1424&&i<=2303||et["Arabic Presentation Forms-A"](i)||et["Arabic Presentation Forms-B"](i)}function Cc(i,e){return!(!e&&wl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||et.Khmer(i))}function Tl(i){for(const e of i)if(wl(e.charCodeAt(0)))return!0;return!1}const ho="deferred",fo="loading",po="loaded";let mo=null,yr="unavailable",Sn=null;const kl=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(yr="error"),mo&&mo(i)};function ms(){go.fire(new on("pluginStateChange",{pluginStatus:yr,pluginURL:Sn}))}const go=new ln,Js=function(){return yr},El=function(){if(yr!==ho||!Sn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");yr=fo,ms(),Sn&&es({url:Sn},i=>{i?kl(i):(yr=po,ms())})},Or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>yr===po||Or.applyArabicShaping!=null,isLoading:()=>yr===fo,setState(i){if(!Ne())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");yr=i.pluginStatus,Sn=i.pluginURL},isParsed(){if(!Ne())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Or.applyArabicShaping!=null&&Or.processBidirectionalText!=null&&Or.processStyledBidirectionalText!=null},getPluginURL(){if(!Ne())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Sn}};class wi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lo,this.transition={})}isSupportedScript(e){return function(r,o){for(const p of r)if(!Cc(p.charCodeAt(0),o))return!1;return!0}(e,Or.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class Ys{constructor(e,r){this.property=e,this.value=r,this.expression=function(o,p){if(mi(o))return new ya(o,p);if(Fs(o)){const g=cl(o,p);if(g.result==="error")throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=o;return p.type==="color"&&typeof o=="string"?g=W.parse(o):p.type!=="padding"||typeof o!="number"&&!Array.isArray(o)||(g=se.parse(o)),{kind:"constant",evaluate:()=>g}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class ka{constructor(e){this.property=e,this.value=new Ys(e,void 0)}transitioned(e,r){return new Il(this.property,this.value,r,N({},e.transition,this.transition),e.now)}untransitioned(){return new Il(this.property,this.value,null,{},0)}}class Sl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Be(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ka(this._values[e].property)),this._values[e].value=new Ys(this._values[e].property,r===null?void 0:Be(r))}getTransition(e){return Be(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ka(this._values[e].property)),this._values[e].transition=Be(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){const o=new Cl(this._properties);for(const p of Object.keys(this._values))o._values[p]=this._values[p].transitioned(e,r._values[p]);return o}untransitioned(){const e=new Cl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Il{constructor(e,r,o,p,g){this.property=e,this.value=r,this.begin=g+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const p=e.now||0,g=this.value.possiblyEvaluate(e,r,o),v=this.prior;if(v){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return v.possiblyEvaluate(e,r,o);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(e,r,o),g,function(k){if(k<=0)return 0;if(k>=1)return 1;const A=k*k,L=A*k;return 4*(k<.5?L:3*(k-A)+L-.75)}(T))}}return g}}class Cl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const p=new Qs(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(e,r,o);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ac{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Be(this._values[e].value)}setValue(e,r){this._values[e]=new Ys(this._values[e].property,r===null?void 0:Be(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const p=new Qs(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(e,r,o);return p}}class $r{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,p){return this.property.evaluate(this.value,this.parameters,e,r,o,p)}}class Qs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){const p=Ds[this.specification.type];return p?p(e,r,o):e}}class Tt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,p){return new $r(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,p)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new $r(this,{kind:"constant",value:void 0},e.parameters);const p=Ds[this.specification.type];return p?new $r(this,{kind:"constant",value:p(e.value.value,r.value.value,o)},e.parameters):e}evaluate(e,r,o,p,g,v){return e.kind==="constant"?e.value:e.evaluate(r,o,p,g,v)}}class gs extends Tt{possiblyEvaluate(e,r,o,p){if(e.value===void 0)return new $r(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},o,p),v=e.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,T=this._calculate(v,v,v,r);return new $r(this,{kind:"constant",value:T},r)}if(e.expression.kind==="camera"){const g=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new $r(this,{kind:"constant",value:g},r)}return new $r(this,e.expression,r)}evaluate(e,r,o,p,g,v){if(e.kind==="source"){const T=e.evaluate(r,o,p,g,v);return this._calculate(T,T,T,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,p),e.evaluate({zoom:Math.floor(r.zoom)},o,p),e.evaluate({zoom:Math.floor(r.zoom)+1},o,p),r):e.value}_calculate(e,r,o,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class _o{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},o,p);return this._calculate(g,g,g,r)}return this._calculate(e.expression.evaluate(new wi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new wi(Math.floor(r.zoom),r)),e.expression.evaluate(new wi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class In{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,p){return!!e.expression.evaluate(r,null,{},o,p)}interpolate(){return!1}}class Yi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const p=this.defaultPropertyValues[r]=new Ys(o,void 0),g=this.defaultTransitionablePropertyValues[r]=new ka(o);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}ct("DataDrivenProperty",Tt),ct("DataConstantProperty",pt),ct("CrossFadedDataDrivenProperty",gs),ct("CrossFadedProperty",_o),ct("ColorRampProperty",In);const Cn="-transition";class en extends ln{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Ac(r.layout)),r.paint)){this._transitionablePaint=new Sl(r.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qs(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,o={}){r!=null&&this._validate(Sc,`layers.${this.id}.layout.${e}`,e,r,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Cn)?this._transitionablePaint.getTransition(e.slice(0,-Cn.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(Ec,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(Cn))return this._transitionablePaint.setTransition(e.slice(0,-Cn.length),r||void 0),!1;{const p=this._transitionablePaint._values[e],g=p.property.specification["property-type"]==="cross-faded-data-driven",v=p.value.isDataDriven(),T=p.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const k=this._transitionablePaint._values[e].value;return k.isDataDriven()||v||g||this._handleOverridablePaintPropertyUpdate(e,T,k)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ae(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,p,g={}){return(!g||g.validate!==!1)&&wa(this,e.call(Ws,{key:r,layerType:this.type,objectKey:o,value:p,styleSpec:De,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof $r&&gi(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Al={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class An{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ii{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Di(i,e=1){let r=0,o=0;return{members:i.map(p=>{const g=Al[p.type].BYTES_PER_ELEMENT,v=r=yo(r,Math.max(e,g)),T=p.components||1;return o=Math.max(o,g),r+=g*T,{name:p.name,type:p.type,components:T,offset:v}}),size:yo(r,Math.max(o,e)),alignment:e}}function yo(i,e){return Math.ceil(i/e)*e}class Nn extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const p=2*e;return this.int16[p+0]=r,this.int16[p+1]=o,e}}Nn.prototype.bytesPerElement=4,ct("StructArrayLayout2i4",Nn);class f extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,p)}emplace(e,r,o,p,g){const v=4*e;return this.int16[v+0]=r,this.int16[v+1]=o,this.int16[v+2]=p,this.int16[v+3]=g,e}}f.prototype.bytesPerElement=8,ct("StructArrayLayout4i8",f);class t extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,o,p,g,v)}emplace(e,r,o,p,g,v,T){const k=6*e;return this.int16[k+0]=r,this.int16[k+1]=o,this.int16[k+2]=p,this.int16[k+3]=g,this.int16[k+4]=v,this.int16[k+5]=T,e}}t.prototype.bytesPerElement=12,ct("StructArrayLayout2i4i12",t);class a extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,o,p,g,v)}emplace(e,r,o,p,g,v,T){const k=4*e,A=8*e;return this.int16[k+0]=r,this.int16[k+1]=o,this.uint8[A+4]=p,this.uint8[A+5]=g,this.uint8[A+6]=v,this.uint8[A+7]=T,e}}a.prototype.bytesPerElement=8,ct("StructArrayLayout2i4ub8",a);class u extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const p=2*e;return this.float32[p+0]=r,this.float32[p+1]=o,e}}u.prototype.bytesPerElement=8,ct("StructArrayLayout2f8",u);class m extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g,v,T,k,A,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,o,p,g,v,T,k,A,L)}emplace(e,r,o,p,g,v,T,k,A,L,F){const j=10*e;return this.uint16[j+0]=r,this.uint16[j+1]=o,this.uint16[j+2]=p,this.uint16[j+3]=g,this.uint16[j+4]=v,this.uint16[j+5]=T,this.uint16[j+6]=k,this.uint16[j+7]=A,this.uint16[j+8]=L,this.uint16[j+9]=F,e}}m.prototype.bytesPerElement=20,ct("StructArrayLayout10ui20",m);class y extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g,v,T,k,A,L,F,j){const q=this.length;return this.resize(q+1),this.emplace(q,e,r,o,p,g,v,T,k,A,L,F,j)}emplace(e,r,o,p,g,v,T,k,A,L,F,j,q){const Z=12*e;return this.int16[Z+0]=r,this.int16[Z+1]=o,this.int16[Z+2]=p,this.int16[Z+3]=g,this.uint16[Z+4]=v,this.uint16[Z+5]=T,this.uint16[Z+6]=k,this.uint16[Z+7]=A,this.int16[Z+8]=L,this.int16[Z+9]=F,this.int16[Z+10]=j,this.int16[Z+11]=q,e}}y.prototype.bytesPerElement=24,ct("StructArrayLayout4i4ui4i24",y);class w extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o)}emplace(e,r,o,p){const g=3*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=p,e}}w.prototype.bytesPerElement=12,ct("StructArrayLayout3f12",w);class E extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}E.prototype.bytesPerElement=4,ct("StructArrayLayout1ul4",E);class C extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g,v,T,k,A){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,o,p,g,v,T,k,A)}emplace(e,r,o,p,g,v,T,k,A,L){const F=10*e,j=5*e;return this.int16[F+0]=r,this.int16[F+1]=o,this.int16[F+2]=p,this.int16[F+3]=g,this.int16[F+4]=v,this.int16[F+5]=T,this.uint32[j+3]=k,this.uint16[F+8]=A,this.uint16[F+9]=L,e}}C.prototype.bytesPerElement=20,ct("StructArrayLayout6i1ul2ui20",C);class M extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,o,p,g,v)}emplace(e,r,o,p,g,v,T){const k=6*e;return this.int16[k+0]=r,this.int16[k+1]=o,this.int16[k+2]=p,this.int16[k+3]=g,this.int16[k+4]=v,this.int16[k+5]=T,e}}M.prototype.bytesPerElement=12,ct("StructArrayLayout2i2i2i12",M);class B extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,p,g)}emplace(e,r,o,p,g,v){const T=4*e,k=8*e;return this.float32[T+0]=r,this.float32[T+1]=o,this.float32[T+2]=p,this.int16[k+6]=g,this.int16[k+7]=v,e}}B.prototype.bytesPerElement=16,ct("StructArrayLayout2f1f2i16",B);class U extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,p)}emplace(e,r,o,p,g){const v=12*e,T=3*e;return this.uint8[v+0]=r,this.uint8[v+1]=o,this.float32[T+1]=p,this.float32[T+2]=g,e}}U.prototype.bytesPerElement=12,ct("StructArrayLayout2ub2f12",U);class G extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o)}emplace(e,r,o,p){const g=3*e;return this.uint16[g+0]=r,this.uint16[g+1]=o,this.uint16[g+2]=p,e}}G.prototype.bytesPerElement=6,ct("StructArrayLayout3ui6",G);class $ extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g,v,T,k,A,L,F,j,q,Z,re,te,me){const Te=this.length;return this.resize(Te+1),this.emplace(Te,e,r,o,p,g,v,T,k,A,L,F,j,q,Z,re,te,me)}emplace(e,r,o,p,g,v,T,k,A,L,F,j,q,Z,re,te,me,Te){const pe=24*e,ve=12*e,Fe=48*e;return this.int16[pe+0]=r,this.int16[pe+1]=o,this.uint16[pe+2]=p,this.uint16[pe+3]=g,this.uint32[ve+2]=v,this.uint32[ve+3]=T,this.uint32[ve+4]=k,this.uint16[pe+10]=A,this.uint16[pe+11]=L,this.uint16[pe+12]=F,this.float32[ve+7]=j,this.float32[ve+8]=q,this.uint8[Fe+36]=Z,this.uint8[Fe+37]=re,this.uint8[Fe+38]=te,this.uint32[ve+10]=me,this.int16[pe+22]=Te,e}}$.prototype.bytesPerElement=48,ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$);class Y extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,p,g,v,T,k,A,L,F,j,q,Z,re,te,me,Te,pe,ve,Fe,Re,lt,ht,tt,Ye,We,it){const $e=this.length;return this.resize($e+1),this.emplace($e,e,r,o,p,g,v,T,k,A,L,F,j,q,Z,re,te,me,Te,pe,ve,Fe,Re,lt,ht,tt,Ye,We,it)}emplace(e,r,o,p,g,v,T,k,A,L,F,j,q,Z,re,te,me,Te,pe,ve,Fe,Re,lt,ht,tt,Ye,We,it,$e){const Ge=34*e,vt=17*e;return this.int16[Ge+0]=r,this.int16[Ge+1]=o,this.int16[Ge+2]=p,this.int16[Ge+3]=g,this.int16[Ge+4]=v,this.int16[Ge+5]=T,this.int16[Ge+6]=k,this.int16[Ge+7]=A,this.uint16[Ge+8]=L,this.uint16[Ge+9]=F,this.uint16[Ge+10]=j,this.uint16[Ge+11]=q,this.uint16[Ge+12]=Z,this.uint16[Ge+13]=re,this.uint16[Ge+14]=te,this.uint16[Ge+15]=me,this.uint16[Ge+16]=Te,this.uint16[Ge+17]=pe,this.uint16[Ge+18]=ve,this.uint16[Ge+19]=Fe,this.uint16[Ge+20]=Re,this.uint16[Ge+21]=lt,this.uint16[Ge+22]=ht,this.uint32[vt+12]=tt,this.float32[vt+13]=Ye,this.float32[vt+14]=We,this.float32[vt+15]=it,this.float32[vt+16]=$e,e}}Y.prototype.bytesPerElement=68,ct("StructArrayLayout8i15ui1ul4f68",Y);class Q extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Q.prototype.bytesPerElement=4,ct("StructArrayLayout1f4",Q);class le extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o)}emplace(e,r,o,p){const g=3*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=p,e}}le.prototype.bytesPerElement=6,ct("StructArrayLayout3i6",le);class de extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o)}emplace(e,r,o,p){const g=4*e;return this.uint32[2*e+0]=r,this.uint16[g+2]=o,this.uint16[g+3]=p,e}}de.prototype.bytesPerElement=8,ct("StructArrayLayout1ul2ui8",de);class _e extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=o,e}}_e.prototype.bytesPerElement=4,ct("StructArrayLayout2ui4",_e);class ee extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ee.prototype.bytesPerElement=2,ct("StructArrayLayout1ui2",ee);class we extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,p)}emplace(e,r,o,p,g){const v=4*e;return this.float32[v+0]=r,this.float32[v+1]=o,this.float32[v+2]=p,this.float32[v+3]=g,e}}we.prototype.bytesPerElement=16,ct("StructArrayLayout4f16",we);class ye extends An{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new xt(this.anchorPointX,this.anchorPointY)}}ye.prototype.size=20;class Me extends C{get(e){return new ye(this,e)}}ct("CollisionBoxArray",Me);class Pe extends An{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Pe.prototype.size=48;class je extends ${get(e){return new Pe(this,e)}}ct("PlacedSymbolArray",je);class Ae extends An{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ae.prototype.size=68;class nt extends Y{get(e){return new Ae(this,e)}}ct("SymbolInstanceArray",nt);class Je extends Q{getoffsetX(e){return this.float32[1*e+0]}}ct("GlyphOffsetArray",Je);class ot extends le{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ct("SymbolLineVertexArray",ot);class Dt extends An{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Dt.prototype.size=8;class Ot extends de{get(e){return new Dt(this,e)}}ct("FeatureIndexArray",Ot);class yt extends Nn{}class $t extends Nn{}class ei extends Nn{}class qt extends t{}class Kt extends a{}class ri extends u{}class qi extends m{}class tn extends y{}class qr extends w{}class rn extends E{}class zn extends M{}class Vr extends U{}class vr extends G{}class fn extends _e{}const Ea=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fi}=Ea;class Ut{constructor(e=[]){this.segments=e}prepareSegment(e,r,o,p){let g=this.segments[this.segments.length-1];return e>Ut.MAX_VERTEX_ARRAY_LENGTH&&ke(`Max vertices per segment is ${Ut.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>Ut.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,p){return new Ut([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:p,vaos:{},sortKey:0}])}}function Qt(i,e){return 256*(i=z(Math.floor(i),0,255))+z(Math.floor(e),0,255)}Ut.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ct("SegmentVector",Ut);const Zi=Di([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xi={exports:{}},Ti={exports:{}};Ti.exports=function(i,e){var r,o,p,g,v,T,k,A;for(o=i.length-(r=3&i.length),p=e,v=3432918353,T=461845907,A=0;A<o;)k=255&i.charCodeAt(A)|(255&i.charCodeAt(++A))<<8|(255&i.charCodeAt(++A))<<16|(255&i.charCodeAt(++A))<<24,++A,p=27492+(65535&(g=5*(65535&(p=(p^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*T+(((k>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(k=0,r){case 3:k^=(255&i.charCodeAt(A+2))<<16;case 2:k^=(255&i.charCodeAt(A+1))<<8;case 1:p^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(A)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*T+(((k>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Ur={exports:{}};Ur.exports=function(i,e){for(var r,o=i.length,p=e^o,g=0;o>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(r>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++g;switch(o){case 3:p^=(255&i.charCodeAt(g+2))<<16;case 2:p^=(255&i.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var jn=Ti.exports,vo=Ur.exports;Xi.exports=jn,Xi.exports.murmur3=jn,Xi.exports.murmur2=vo;class _s{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,p){this.ids.push(zl(e)),this.positions.push(r,o,p)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=zl(e);let o=0,p=this.ids.length-1;for(;o<p;){const v=o+p>>1;this.ids[v]>=r?p=v:o=v+1}const g=[];for(;this.ids[o]===r;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(e,r){const o=new Float64Array(e.ids),p=new Uint32Array(e.positions);return xo(o,p,0,o.length-1),r&&r.push(o.buffer,p.buffer),{ids:o,positions:p}}static deserialize(e){const r=new _s;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function zl(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Xi.exports(String(i))}function xo(i,e,r,o){for(;r<o;){const p=i[r+o>>1];let g=r-1,v=o+1;for(;;){do g++;while(i[g]<p);do v--;while(i[v]>p);if(g>=v)break;Mn(i,g,v),Mn(e,3*g,3*v),Mn(e,3*g+1,3*v+1),Mn(e,3*g+2,3*v+2)}v-r<o-v?(xo(i,e,r,v),r=v+1):(xo(i,e,v+1,o),o=v)}}function Mn(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}ct("FeaturePositionMap",_s);class Gn{constructor(e,r){this.gl=e.gl,this.location=r}}class qn extends Gn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Sa extends Gn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Du extends Gn{constructor(e,r){super(e,r),this.current=W.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Lp=new Float32Array(16);function zc(i){return[Qt(255*i.r,255*i.g),Qt(255*i.b,255*i.a)]}class bo{constructor(e,r,o){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new Du(e,r):new qn(e,r)}}class Ia{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,o,p){const g=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&e.set(g)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"?new Sa(e,r):new qn(e,r)}}class Zn{constructor(e,r,o,p){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,o,p,g){const v=this.paintVertexArray.length,T=this.expression.evaluate(new wi(0),r,{},p,[],g);this.paintVertexArray.resize(e),this._setPaintValue(v,e,T)}updatePaintArray(e,r,o,p){const g=this.expression.evaluate({zoom:0},o,p);this._setPaintValue(e,r,g)}_setPaintValue(e,r,o){if(this.type==="color"){const p=zc(o);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dn{constructor(e,r,o,p,g,v){this.expression=e,this.uniformNames=r.map(T=>`u_${T}_t`),this.type=o,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(T=>({name:`a_${T}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(e,r,o,p,g){const v=this.expression.evaluate(new wi(this.zoom),r,{},p,[],g),T=this.expression.evaluate(new wi(this.zoom+1),r,{},p,[],g),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,v,T)}updatePaintArray(e,r,o,p){const g=this.expression.evaluate({zoom:this.zoom},o,p),v=this.expression.evaluate({zoom:this.zoom+1},o,p);this._setPaintValue(e,r,g,v)}_setPaintValue(e,r,o,p){if(this.type==="color"){const g=zc(o),v=zc(p);for(let T=e;T<r;T++)this.paintVertexArray.emplace(T,g[0],g[1],v[0],v[1])}else{for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,o,p);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=z(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,r,o){return new qn(e,r)}}class ys{constructor(e,r,o,p,g,v){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=p,this.layerId=v,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,r,o){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,p,g){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(e,r,o,p){if(!p||!o)return;const{min:g,mid:v,max:T}=o,k=p[g],A=p[v],L=p[T];if(k&&A&&L)for(let F=e;F<r;F++)this.zoomInPaintVertexArray.emplace(F,A.tl[0],A.tl[1],A.br[0],A.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],A.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,A.tl[0],A.tl[1],A.br[0],A.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],A.pixelRatio,L.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Zi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Zi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Lu{constructor(e,r,o){this.binders={},this._buffers=[];const p=[];for(const g in e.paint._values){if(!o(g))continue;const v=e.paint.get(g);if(!(v instanceof $r&&gi(v.property.specification)))continue;const T=Bp(g,e.type),k=v.value,A=v.property.specification.type,L=v.property.useIntegerZoom,F=v.property.specification["property-type"],j=F==="cross-faded"||F==="cross-faded-data-driven";if(k.kind==="constant")this.binders[g]=j?new Ia(k.value,T):new bo(k.value,T,A),p.push(`/u_${g}`);else if(k.kind==="source"||j){const q=Bu(g,A,"source");this.binders[g]=j?new ys(k,A,L,r,q,e.id):new Zn(k,T,A,q),p.push(`/a_${g}`)}else{const q=Bu(g,A,"composite");this.binders[g]=new dn(k,T,A,L,r,q),p.push(`/z_${g}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Zn||r instanceof dn?r.maxValue:0}populatePaintArrays(e,r,o,p,g){for(const v in this.binders){const T=this.binders[v];(T instanceof Zn||T instanceof dn||T instanceof ys)&&T.populatePaintArray(e,r,o,p,g)}}setConstantPatternPositions(e,r){for(const o in this.binders){const p=this.binders[o];p instanceof Ia&&p.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,o,p,g){let v=!1;for(const T in e){const k=r.getPositions(T);for(const A of k){const L=o.feature(A.index);for(const F in this.binders){const j=this.binders[F];if((j instanceof Zn||j instanceof dn||j instanceof ys)&&j.expression.isStateDependent===!0){const q=p.paint.get(F);j.expression=q.value,j.updatePaintArray(A.start,A.end,L,e[T],g),v=!0}}}}return v}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof bo||o instanceof Ia)&&e.push(...o.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Zn||o instanceof dn)for(let p=0;p<o.paintVertexAttributes.length;p++)e.push(o.paintVertexAttributes[p].name);else if(o instanceof ys)for(let p=0;p<Zi.members.length;p++)e.push(Zi.members[p].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof bo||o instanceof Ia||o instanceof dn)for(const p of o.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof bo||g instanceof Ia||g instanceof dn){for(const v of g.uniformNames)if(r[v]){const T=g.getBinding(e,r[v],v);o.push({name:v,property:p,binding:T})}}}return o}setUniforms(e,r,o,p){for(const{name:g,property:v,binding:T}of r)this.binders[v].setUniform(T,p,o.get(v),g)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof ys){const p=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(o instanceof Zn||o instanceof dn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof Zn||o instanceof dn||o instanceof ys)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Zn||r instanceof dn||r instanceof ys)&&r.destroy()}}}class $s{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new Lu(p,r,o);this.needsUpload=!1,this._featureMap=new _s,this._bufferOffset=0}populatePaintArrays(e,r,o,p,g,v){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,r,p,g,v);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,p){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,r,g,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Bp(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Bu(i,e,r){const o={color:{source:u,composite:we},number:{source:Q,composite:u}},p=function(g){return{"line-pattern":{source:qi,composite:qi},"fill-pattern":{source:qi,composite:qi},"fill-extrusion-pattern":{source:qi,composite:qi}}[g]}(i);return p&&p[r]||o[e][r]}ct("ConstantBinder",bo),ct("CrossFadedConstantBinder",Ia),ct("SourceExpressionBinder",Zn),ct("CrossFadedCompositeBinder",ys),ct("CompositeExpressionBinder",dn),ct("ProgramConfiguration",Lu,{omit:["_buffers"]}),ct("ProgramConfigurationSet",$s);var Oi=8192;const Mc=Math.pow(2,14)-1,Ru=-Mc-1;function ea(i){const e=Oi/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const p=r[o];for(let g=0;g<p.length;g++){const v=p[g],T=Math.round(v.x*e),k=Math.round(v.y*e);v.x=z(T,Ru,Mc),v.y=z(k,Ru,Mc),(T<v.x||T>v.x+1||k<v.y||k>v.y+1)&&ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function ta(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ea(i):[]}}function Ml(i,e,r,o,p){i.emplaceBack(2*e+(o+1)/2,2*r+(p+1)/2)}class Pc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new $t,this.indexArray=new vr,this.segments=new Ut,this.programConfigurations=new $s(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){const p=this.layers[0],g=[];let v=null,T=!1;p.type==="circle"&&(v=p.layout.get("circle-sort-key"),T=!v.isConstant());for(const{feature:k,id:A,index:L,sourceLayerIndex:F}of e){const j=this.layers[0]._featureFilter.needGeometry,q=ta(k,j);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),q,o))continue;const Z=T?v.evaluate(q,{},o):void 0,re={id:A,properties:k.properties,type:k.type,sourceLayerIndex:F,index:L,geometry:j?q.geometry:ea(k),patterns:{},sortKey:Z};g.push(re)}T&&g.sort((k,A)=>k.sortKey-A.sortKey);for(const k of g){const{geometry:A,index:L,sourceLayerIndex:F}=k,j=e[L].feature;this.addFeature(k,A,L,o),r.featureIndex.insert(j,A,L,F,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fi),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,p){for(const g of r)for(const v of g){const T=v.x,k=v.y;if(T<0||T>=Oi||k<0||k>=Oi)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=A.vertexLength;Ml(this.layoutVertexArray,T,k,-1,-1),Ml(this.layoutVertexArray,T,k,1,-1),Ml(this.layoutVertexArray,T,k,1,1),Ml(this.layoutVertexArray,T,k,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},p)}}function Fu(i,e){for(let r=0;r<i.length;r++)if(Ca(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ca(i,e[r]))return!0;return!!Dc(i,e)}function Rp(i,e,r){return!!Ca(i,e)||!!Lc(e,i,r)}function Ou(i,e){if(i.length===1)return Uu(e,i[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let p=0;p<o.length;p++)if(Ca(i,o[p]))return!0}for(let r=0;r<i.length;r++)if(Uu(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Dc(i,e[r]))return!0;return!1}function Fp(i,e,r){if(i.length>1){if(Dc(i,e))return!0;for(let o=0;o<e.length;o++)if(Lc(e[o],i,r))return!0}for(let o=0;o<i.length;o++)if(Lc(i[o],e,r))return!0;return!1}function Dc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],p=i[r+1];for(let g=0;g<e.length-1;g++)if(Op(o,p,e[g],e[g+1]))return!0}return!1}function Op(i,e,r,o){return Ve(i,r,o)!==Ve(e,r,o)&&Ve(i,e,r)!==Ve(i,e,o)}function Lc(i,e,r){const o=r*r;if(e.length===1)return i.distSqr(e[0])<o;for(let p=1;p<e.length;p++)if(Vu(i,e[p-1],e[p])<o)return!0;return!1}function Vu(i,e,r){const o=e.distSqr(r);if(o===0)return i.distSqr(e);const p=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/o;return i.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function Uu(i,e){let r,o,p,g=!1;for(let v=0;v<i.length;v++){r=i[v];for(let T=0,k=r.length-1;T<r.length;k=T++)o=r[T],p=r[k],o.y>e.y!=p.y>e.y&&e.x<(p.x-o.x)*(e.y-o.y)/(p.y-o.y)+o.x&&(g=!g)}return g}function Ca(i,e){let r=!1;for(let o=0,p=i.length-1;o<i.length;p=o++){const g=i[o],v=i[p];g.y>e.y!=v.y>e.y&&e.x<(v.x-g.x)*(e.y-g.y)/(v.y-g.y)+g.x&&(r=!r)}return r}function Vp(i,e,r){const o=r[0],p=r[2];if(i.x<o.x&&e.x<o.x||i.x>p.x&&e.x>p.x||i.y<o.y&&e.y<o.y||i.y>p.y&&e.y>p.y)return!1;const g=Ve(i,e,r[0]);return g!==Ve(i,e,r[1])||g!==Ve(i,e,r[2])||g!==Ve(i,e,r[3])}function wo(i,e,r){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Pl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Dl(i,e,r,o,p){if(!e[0]&&!e[1])return i;const g=xt.convert(e)._mult(p);r==="viewport"&&g._rotate(-o);const v=[];for(let T=0;T<i.length;T++)v.push(i[T].sub(g));return v}ct("CircleBucket",Pc,{omit:["layers"]});const Up=new Yi({"circle-sort-key":new Tt(De.layout_circle["circle-sort-key"])});var Np={paint:new Yi({"circle-radius":new Tt(De.paint_circle["circle-radius"]),"circle-color":new Tt(De.paint_circle["circle-color"]),"circle-blur":new Tt(De.paint_circle["circle-blur"]),"circle-opacity":new Tt(De.paint_circle["circle-opacity"]),"circle-translate":new pt(De.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(De.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(De.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(De.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(De.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(De.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(De.paint_circle["circle-stroke-opacity"])}),layout:Up},xr=1e-6,br=typeof Float32Array<"u"?Float32Array:Array;function Nu(){var i=new br(9);return br!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Bc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ju(i,e,r){var o=e[0],p=e[1],g=e[2],v=e[3],T=e[4],k=e[5],A=e[6],L=e[7],F=e[8],j=e[9],q=e[10],Z=e[11],re=e[12],te=e[13],me=e[14],Te=e[15],pe=r[0],ve=r[1],Fe=r[2],Re=r[3];return i[0]=pe*o+ve*T+Fe*F+Re*re,i[1]=pe*p+ve*k+Fe*j+Re*te,i[2]=pe*g+ve*A+Fe*q+Re*me,i[3]=pe*v+ve*L+Fe*Z+Re*Te,i[4]=(pe=r[4])*o+(ve=r[5])*T+(Fe=r[6])*F+(Re=r[7])*re,i[5]=pe*p+ve*k+Fe*j+Re*te,i[6]=pe*g+ve*A+Fe*q+Re*me,i[7]=pe*v+ve*L+Fe*Z+Re*Te,i[8]=(pe=r[8])*o+(ve=r[9])*T+(Fe=r[10])*F+(Re=r[11])*re,i[9]=pe*p+ve*k+Fe*j+Re*te,i[10]=pe*g+ve*A+Fe*q+Re*me,i[11]=pe*v+ve*L+Fe*Z+Re*Te,i[12]=(pe=r[12])*o+(ve=r[13])*T+(Fe=r[14])*F+(Re=r[15])*re,i[13]=pe*p+ve*k+Fe*j+Re*te,i[14]=pe*g+ve*A+Fe*q+Re*me,i[15]=pe*v+ve*L+Fe*Z+Re*Te,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var To,jp=ju;function Gu(){var i=new br(3);return br!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function qu(i,e,r){var o=new br(3);return o[0]=i,o[1]=e,o[2]=r,o}function Ll(i,e,r){var o=e[0],p=e[1],g=e[2],v=e[3];return i[0]=r[0]*o+r[4]*p+r[8]*g+r[12]*v,i[1]=r[1]*o+r[5]*p+r[9]*g+r[13]*v,i[2]=r[2]*o+r[6]*p+r[10]*g+r[14]*v,i[3]=r[3]*o+r[7]*p+r[11]*g+r[15]*v,i}function Zu(){var i=new br(4);return br!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Xu(i,e){const r=Ll([],[i.x,i.y,0,1],e);return new xt(r[0]/r[3],r[1]/r[3])}Gu(),To=new br(4),br!=Float32Array&&(To[0]=0,To[1]=0,To[2]=0,To[3]=0),Gu(),qu(1,0,0),qu(0,1,0),Zu(),Zu(),Nu(),function(){var i;i=new br(2),br!=Float32Array&&(i[0]=0,i[1]=0)}();class Hu extends Pc{}ct("HeatmapBucket",Hu,{omit:["layers"]});var Gp={paint:new Yi({"heatmap-radius":new Tt(De.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(De.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(De.paint_heatmap["heatmap-intensity"]),"heatmap-color":new In(De.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(De.paint_heatmap["heatmap-opacity"])})};function Rc(i,{width:e,height:r},o,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*r*o}`)}else p=new Uint8Array(e*r*o);return i.width=e,i.height=r,i.data=p,i}function Wu(i,{width:e,height:r},o){if(e===i.width&&r===i.height)return;const p=Rc({},{width:e,height:r},o);Fc(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},o),i.width=e,i.height=r,i.data=p.data}function Fc(i,e,r,o,p,g){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||r.x>i.width-p.width||r.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||o.x>e.width-p.width||o.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=i.data,T=e.data;if(v===T)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<p.height;k++){const A=((r.y+k)*i.width+r.x)*g,L=((o.y+k)*e.width+o.x)*g;for(let F=0;F<p.width*g;F++)T[L+F]=v[A+F]}return e}class ko{constructor(e,r){Rc(this,e,1,r)}resize(e){Wu(this,e,1)}clone(){return new ko({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,p,g){Fc(e,r,o,p,g,1)}}class Zr{constructor(e,r){Rc(this,e,4,r)}resize(e){Wu(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,p,g){Fc(e,r,o,p,g,4)}}function Ku(i){const e={},r=i.resolution||256,o=i.clips?i.clips.length:1,p=i.image||new Zr({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const g=(v,T,k)=>{e[i.evaluationKey]=k;const A=i.expression.evaluate(e);p.data[v+T+0]=Math.floor(255*A.r/A.a),p.data[v+T+1]=Math.floor(255*A.g/A.a),p.data[v+T+2]=Math.floor(255*A.b/A.a),p.data[v+T+3]=Math.floor(255*A.a)};if(i.clips)for(let v=0,T=0;v<o;++v,T+=4*r)for(let k=0,A=0;k<r;k++,A+=4){const L=k/(r-1),{start:F,end:j}=i.clips[v];g(T,A,F*(1-L)+j*L)}else for(let v=0,T=0;v<r;v++,T+=4)g(0,T,v/(r-1));return p}ct("AlphaImage",ko),ct("RGBAImage",Zr);var qp={paint:new Yi({"hillshade-illumination-direction":new pt(De.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(De.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(De.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(De.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(De.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(De.paint_hillshade["hillshade-accent-color"])})};const Zp=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xp}=Zp;var Bl={exports:{}};function Rl(i,e,r){r=r||2;var o,p,g,v,T,k,A,L=e&&e.length,F=L?e[0]*r:i.length,j=Ju(i,0,F,r,!0),q=[];if(!j||j.next===j.prev)return q;if(L&&(j=function(re,te,me,Te){var pe,ve,Fe,Re=[];for(pe=0,ve=te.length;pe<ve;pe++)(Fe=Ju(re,te[pe]*Te,pe<ve-1?te[pe+1]*Te:re.length,Te,!1))===Fe.next&&(Fe.steiner=!0),Re.push(em(Fe));for(Re.sort(Yp),pe=0;pe<Re.length;pe++)me=Qp(Re[pe],me);return me}(i,e,j,r)),i.length>80*r){o=g=i[0],p=v=i[1];for(var Z=r;Z<F;Z+=r)(T=i[Z])<o&&(o=T),(k=i[Z+1])<p&&(p=k),T>g&&(g=T),k>v&&(v=k);A=(A=Math.max(g-o,v-p))!==0?32767/A:0}return Eo(j,q,r,o,p,A,0),q}function Ju(i,e,r,o,p){var g,v;if(p===Uc(i,e,r,o)>0)for(g=e;g<r;g+=o)v=$u(g,i[g],i[g+1],v);else for(g=r-o;g>=e;g-=o)v=$u(g,i[g],i[g+1],v);return v&&Fl(v,v.next)&&(Io(v),v=v.next),v}function ia(i,e){if(!i)return i;e||(e=i);var r,o=i;do if(r=!1,o.steiner||!Fl(o,o.next)&&zi(o.prev,o,o.next)!==0)o=o.next;else{if(Io(o),(o=e=o.prev)===o.next)break;r=!0}while(r||o!==e);return e}function Eo(i,e,r,o,p,g,v){if(i){!v&&g&&function(L,F,j,q){var Z=L;do Z.z===0&&(Z.z=Oc(Z.x,Z.y,F,j,q)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==L);Z.prevZ.nextZ=null,Z.prevZ=null,function(re){var te,me,Te,pe,ve,Fe,Re,lt,ht=1;do{for(me=re,re=null,ve=null,Fe=0;me;){for(Fe++,Te=me,Re=0,te=0;te<ht&&(Re++,Te=Te.nextZ);te++);for(lt=ht;Re>0||lt>0&&Te;)Re!==0&&(lt===0||!Te||me.z<=Te.z)?(pe=me,me=me.nextZ,Re--):(pe=Te,Te=Te.nextZ,lt--),ve?ve.nextZ=pe:re=pe,pe.prevZ=ve,ve=pe;me=Te}ve.nextZ=null,ht*=2}while(Fe>1)}(Z)}(i,o,p,g);for(var T,k,A=i;i.prev!==i.next;)if(T=i.prev,k=i.next,g?Wp(i,o,p,g):Hp(i))e.push(T.i/r|0),e.push(i.i/r|0),e.push(k.i/r|0),Io(i),i=k.next,A=k.next;else if((i=k)===A){v?v===1?Eo(i=Kp(ia(i),e,r),e,r,o,p,g,2):v===2&&Jp(i,e,r,o,p,g):Eo(ia(i),e,r,o,p,g,1);break}}}function Hp(i){var e=i.prev,r=i,o=i.next;if(zi(e,r,o)>=0)return!1;for(var p=e.x,g=r.x,v=o.x,T=e.y,k=r.y,A=o.y,L=p<g?p<v?p:v:g<v?g:v,F=T<k?T<A?T:A:k<A?k:A,j=p>g?p>v?p:v:g>v?g:v,q=T>k?T>A?T:A:k>A?k:A,Z=o.next;Z!==e;){if(Z.x>=L&&Z.x<=j&&Z.y>=F&&Z.y<=q&&Aa(p,T,g,k,v,A,Z.x,Z.y)&&zi(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function Wp(i,e,r,o){var p=i.prev,g=i,v=i.next;if(zi(p,g,v)>=0)return!1;for(var T=p.x,k=g.x,A=v.x,L=p.y,F=g.y,j=v.y,q=T<k?T<A?T:A:k<A?k:A,Z=L<F?L<j?L:j:F<j?F:j,re=T>k?T>A?T:A:k>A?k:A,te=L>F?L>j?L:j:F>j?F:j,me=Oc(q,Z,e,r,o),Te=Oc(re,te,e,r,o),pe=i.prevZ,ve=i.nextZ;pe&&pe.z>=me&&ve&&ve.z<=Te;){if(pe.x>=q&&pe.x<=re&&pe.y>=Z&&pe.y<=te&&pe!==p&&pe!==v&&Aa(T,L,k,F,A,j,pe.x,pe.y)&&zi(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,ve.x>=q&&ve.x<=re&&ve.y>=Z&&ve.y<=te&&ve!==p&&ve!==v&&Aa(T,L,k,F,A,j,ve.x,ve.y)&&zi(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;pe&&pe.z>=me;){if(pe.x>=q&&pe.x<=re&&pe.y>=Z&&pe.y<=te&&pe!==p&&pe!==v&&Aa(T,L,k,F,A,j,pe.x,pe.y)&&zi(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;ve&&ve.z<=Te;){if(ve.x>=q&&ve.x<=re&&ve.y>=Z&&ve.y<=te&&ve!==p&&ve!==v&&Aa(T,L,k,F,A,j,ve.x,ve.y)&&zi(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function Kp(i,e,r){var o=i;do{var p=o.prev,g=o.next.next;!Fl(p,g)&&Yu(p,o,o.next,g)&&So(p,g)&&So(g,p)&&(e.push(p.i/r|0),e.push(o.i/r|0),e.push(g.i/r|0),Io(o),Io(o.next),o=i=g),o=o.next}while(o!==i);return ia(o)}function Jp(i,e,r,o,p,g){var v=i;do{for(var T=v.next.next;T!==v.prev;){if(v.i!==T.i&&tm(v,T)){var k=Qu(v,T);return v=ia(v,v.next),k=ia(k,k.next),Eo(v,e,r,o,p,g,0),void Eo(k,e,r,o,p,g,0)}T=T.next}v=v.next}while(v!==i)}function Yp(i,e){return i.x-e.x}function Qp(i,e){var r=function(p,g){var v,T=g,k=p.x,A=p.y,L=-1/0;do{if(A<=T.y&&A>=T.next.y&&T.next.y!==T.y){var F=T.x+(A-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(F<=k&&F>L&&(L=F,v=T.x<T.next.x?T:T.next,F===k))return v}T=T.next}while(T!==g);if(!v)return null;var j,q=v,Z=v.x,re=v.y,te=1/0;T=v;do k>=T.x&&T.x>=Z&&k!==T.x&&Aa(A<re?k:L,A,Z,re,A<re?L:k,A,T.x,T.y)&&(j=Math.abs(A-T.y)/(k-T.x),So(T,p)&&(j<te||j===te&&(T.x>v.x||T.x===v.x&&$p(v,T)))&&(v=T,te=j)),T=T.next;while(T!==q);return v}(i,e);if(!r)return e;var o=Qu(r,i);return ia(o,o.next),ia(r,r.next)}function $p(i,e){return zi(i.prev,i,e.prev)<0&&zi(e.next,i,i.next)<0}function Oc(i,e,r,o,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function em(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Aa(i,e,r,o,p,g,v,T){return(p-v)*(e-T)>=(i-v)*(g-T)&&(i-v)*(o-T)>=(r-v)*(e-T)&&(r-v)*(g-T)>=(p-v)*(o-T)}function tm(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,o){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==o.i&&p.next.i!==o.i&&Yu(p,p.next,r,o))return!0;p=p.next}while(p!==r);return!1}(i,e)&&(So(i,e)&&So(e,i)&&function(r,o){var p=r,g=!1,v=(r.x+o.x)/2,T=(r.y+o.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&v<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next;while(p!==r);return g}(i,e)&&(zi(i.prev,i,e.prev)||zi(i,e.prev,e))||Fl(i,e)&&zi(i.prev,i,i.next)>0&&zi(e.prev,e,e.next)>0)}function zi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Fl(i,e){return i.x===e.x&&i.y===e.y}function Yu(i,e,r,o){var p=Vl(zi(i,e,r)),g=Vl(zi(i,e,o)),v=Vl(zi(r,o,i)),T=Vl(zi(r,o,e));return p!==g&&v!==T||!(p!==0||!Ol(i,r,e))||!(g!==0||!Ol(i,o,e))||!(v!==0||!Ol(r,i,o))||!(T!==0||!Ol(r,e,o))}function Ol(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Vl(i){return i>0?1:i<0?-1:0}function So(i,e){return zi(i.prev,i,i.next)<0?zi(i,e,i.next)>=0&&zi(i,i.prev,e)>=0:zi(i,e,i.prev)<0||zi(i,i.next,e)<0}function Qu(i,e){var r=new Vc(i.i,i.x,i.y),o=new Vc(e.i,e.x,e.y),p=i.next,g=e.prev;return i.next=e,e.prev=i,r.next=p,p.prev=r,o.next=r,r.prev=o,g.next=o,o.prev=g,o}function $u(i,e,r,o){var p=new Vc(i,e,r);return o?(p.next=o.next,p.prev=o,o.next.prev=p,o.next=p):(p.prev=p,p.next=p),p}function Io(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Vc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Uc(i,e,r,o){for(var p=0,g=e,v=r-o;g<r;g+=o)p+=(i[v]-i[g])*(i[g+1]+i[v+1]),v=g;return p}function im(i,e,r,o,p){eh(i,e,r||0,o||i.length-1,p||rm)}function eh(i,e,r,o,p){for(;o>r;){if(o-r>600){var g=o-r+1,v=e-r+1,T=Math.log(g),k=.5*Math.exp(2*T/3),A=.5*Math.sqrt(T*k*(g-k)/g)*(v-g/2<0?-1:1);eh(i,e,Math.max(r,Math.floor(e-v*k/g+A)),Math.min(o,Math.floor(e+(g-v)*k/g+A)),p)}var L=i[e],F=r,j=o;for(Co(i,r,e),p(i[o],L)>0&&Co(i,r,o);F<j;){for(Co(i,F,j),F++,j--;p(i[F],L)<0;)F++;for(;p(i[j],L)>0;)j--}p(i[r],L)===0?Co(i,r,j):Co(i,++j,o),j<=e&&(r=j+1),e<=j&&(o=j-1)}}function Co(i,e,r){var o=i[e];i[e]=i[r],i[r]=o}function rm(i,e){return i<e?-1:i>e?1:0}function Nc(i,e){const r=i.length;if(r<=1)return[i];const o=[];let p,g;for(let v=0;v<r;v++){const T=ze(i[v]);T!==0&&(i[v].area=Math.abs(T),g===void 0&&(g=T<0),g===T<0?(p&&o.push(p),p=[i[v]]):p.push(i[v]))}if(p&&o.push(p),e>1)for(let v=0;v<o.length;v++)o[v].length<=e||(im(o[v],e,1,o[v].length-1,nm),o[v]=o[v].slice(0,e));return o}function nm(i,e){return e.area-i.area}function jc(i,e,r){const o=r.patternDependencies;let p=!1;for(const g of e){const v=g.paint.get(`${i}-pattern`);v.isConstant()||(p=!0);const T=v.constantOr(null);T&&(p=!0,o[T.to]=!0,o[T.from]=!0)}return p}function Gc(i,e,r,o,p){const g=p.patternDependencies;for(const v of e){const T=v.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let k=T.evaluate({zoom:o-1},r,{},p.availableImages),A=T.evaluate({zoom:o},r,{},p.availableImages),L=T.evaluate({zoom:o+1},r,{},p.availableImages);k=k&&k.name?k.name:k,A=A&&A.name?A.name:A,L=L&&L.name?L.name:L,g[k]=!0,g[A]=!0,g[L]=!0,r.patterns[v.id]={min:k,mid:A,max:L}}}return r}Bl.exports=Rl,Bl.exports.default=Rl,Rl.deviation=function(i,e,r,o){var p=e&&e.length,g=Math.abs(Uc(i,0,p?e[0]*r:i.length,r));if(p)for(var v=0,T=e.length;v<T;v++)g-=Math.abs(Uc(i,e[v]*r,v<T-1?e[v+1]*r:i.length,r));var k=0;for(v=0;v<o.length;v+=3){var A=o[v]*r,L=o[v+1]*r,F=o[v+2]*r;k+=Math.abs((i[A]-i[F])*(i[L+1]-i[A+1])-(i[A]-i[L])*(i[F+1]-i[A+1]))}return g===0&&k===0?0:Math.abs((k-g)/g)},Rl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},o=0,p=0;p<i.length;p++){for(var g=0;g<i[p].length;g++)for(var v=0;v<e;v++)r.vertices.push(i[p][g][v]);p>0&&r.holes.push(o+=i[p-1].length)}return r};class qc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ei,this.indexArray=new vr,this.indexArray2=new fn,this.programConfigurations=new $s(e.layers,e.zoom),this.segments=new Ut,this.segments2=new Ut,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=jc("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),g=!p.isConstant(),v=[];for(const{feature:T,id:k,index:A,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,j=ta(T,F);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),j,o))continue;const q=g?p.evaluate(j,{},o,r.availableImages):void 0,Z={id:k,properties:T.properties,type:T.type,sourceLayerIndex:L,index:A,geometry:F?j.geometry:ea(T),patterns:{},sortKey:q};v.push(Z)}g&&v.sort((T,k)=>T.sortKey-k.sortKey);for(const T of v){const{geometry:k,index:A,sourceLayerIndex:L}=T;if(this.hasPattern){const F=Gc("fill",this.layers,T,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(T,k,A,o,{});r.featureIndex.insert(e[A].feature,k,A,L,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,p,g){for(const v of Nc(r,500)){let T=0;for(const q of v)T+=q.length;const k=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=k.vertexLength,L=[],F=[];for(const q of v){if(q.length===0)continue;q!==v[0]&&F.push(L.length/2);const Z=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),re=Z.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(re+q.length-1,re),L.push(q[0].x),L.push(q[0].y);for(let te=1;te<q.length;te++)this.layoutVertexArray.emplaceBack(q[te].x,q[te].y),this.indexArray2.emplaceBack(re+te-1,re+te),L.push(q[te].x),L.push(q[te].y);Z.vertexLength+=q.length,Z.primitiveLength+=q.length}const j=Bl.exports(L,F);for(let q=0;q<j.length;q+=3)this.indexArray.emplaceBack(A+j[q],A+j[q+1],A+j[q+2]);k.vertexLength+=T,k.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,p)}}ct("FillBucket",qc,{omit:["layers","patternFeatures"]});const sm=new Yi({"fill-sort-key":new Tt(De.layout_fill["fill-sort-key"])});var am={paint:new Yi({"fill-antialias":new pt(De.paint_fill["fill-antialias"]),"fill-opacity":new Tt(De.paint_fill["fill-opacity"]),"fill-color":new Tt(De.paint_fill["fill-color"]),"fill-outline-color":new Tt(De.paint_fill["fill-outline-color"]),"fill-translate":new pt(De.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(De.paint_fill["fill-translate-anchor"]),"fill-pattern":new gs(De.paint_fill["fill-pattern"])}),layout:sm};const om=Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),lm=Di([{name:"a_centroid",components:2,type:"Int16"}],4),{members:cm}=om;var vs={},um=xt,th=za;function za(i,e,r,o,p){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=p,i.readFields(hm,this,e)}function hm(i,e,r){i==1?e.id=r.readVarint():i==2?function(o,p){for(var g=o.readVarint()+o.pos;o.pos<g;){var v=p._keys[o.readVarint()],T=p._values[o.readVarint()];p.properties[v]=T}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function fm(i){for(var e,r,o=0,p=0,g=i.length,v=g-1;p<g;v=p++)o+=((r=i[v]).x-(e=i[p]).x)*(e.y+r.y);return o}za.types=["Unknown","Point","LineString","Polygon"],za.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,o=1,p=0,g=0,v=0,T=[];i.pos<r;){if(p<=0){var k=i.readVarint();o=7&k,p=k>>3}if(p--,o===1||o===2)g+=i.readSVarint(),v+=i.readSVarint(),o===1&&(e&&T.push(e),e=[]),e.push(new um(g,v));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&T.push(e),T},za.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,o=0,p=0,g=0,v=1/0,T=-1/0,k=1/0,A=-1/0;i.pos<e;){if(o<=0){var L=i.readVarint();r=7&L,o=L>>3}if(o--,r===1||r===2)(p+=i.readSVarint())<v&&(v=p),p>T&&(T=p),(g+=i.readSVarint())<k&&(k=g),g>A&&(A=g);else if(r!==7)throw new Error("unknown command "+r)}return[v,k,T,A]},za.prototype.toGeoJSON=function(i,e,r){var o,p,g=this.extent*Math.pow(2,r),v=this.extent*i,T=this.extent*e,k=this.loadGeometry(),A=za.types[this.type];function L(q){for(var Z=0;Z<q.length;Z++){var re=q[Z];q[Z]=[360*(re.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+T)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(o=0;o<k.length;o++)F[o]=k[o][0];L(k=F);break;case 2:for(o=0;o<k.length;o++)L(k[o]);break;case 3:for(k=function(q){var Z=q.length;if(Z<=1)return[q];for(var re,te,me=[],Te=0;Te<Z;Te++){var pe=fm(q[Te]);pe!==0&&(te===void 0&&(te=pe<0),te===pe<0?(re&&me.push(re),re=[q[Te]]):re.push(q[Te]))}return re&&me.push(re),me}(k),o=0;o<k.length;o++)for(p=0;p<k[o].length;p++)L(k[o][p])}k.length===1?k=k[0]:A="Multi"+A;var j={type:"Feature",geometry:{type:A,coordinates:k},properties:this.properties};return"id"in this&&(j.id=this.id),j};var dm=th,ih=rh;function rh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(pm,this,e),this.length=this._features.length}function pm(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(o){for(var p=null,g=o.readVarint()+o.pos;o.pos<g;){var v=o.readVarint()>>3;p=v===1?o.readString():v===2?o.readFloat():v===3?o.readDouble():v===4?o.readVarint64():v===5?o.readVarint():v===6?o.readSVarint():v===7?o.readBoolean():null}return p}(r))}rh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new dm(this._pbf,e,this.extent,this._keys,this._values)};var mm=ih;function gm(i,e,r){if(i===3){var o=new mm(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}vs.VectorTile=function(i,e){this.layers=i.readFields(gm,{},e)},vs.VectorTileFeature=th,vs.VectorTileLayer=ih;const _m=vs.VectorTileFeature.types,Zc=Math.pow(2,13);function Ao(i,e,r,o,p,g,v,T){i.emplaceBack(e,r,2*Math.floor(o*Zc)+v,p*Zc*2,g*Zc*2,Math.round(T))}class Xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new qt,this.centroidVertexArray=new yt,this.indexArray=new vr,this.programConfigurations=new $s(e.layers,e.zoom),this.segments=new Ut,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasPattern=jc("fill-extrusion",this.layers,r);for(const{feature:p,id:g,index:v,sourceLayerIndex:T}of e){const k=this.layers[0]._featureFilter.needGeometry,A=ta(p,k);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),A,o))continue;const L={id:g,sourceLayerIndex:T,index:v,geometry:k?A.geometry:ea(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Gc("fill-extrusion",this.layers,L,this.zoom,r)):this.addFeature(L,L.geometry,v,o,{}),r.featureIndex.insert(p,L.geometry,v,T,this.index,!0)}}addFeatures(e,r,o){for(const p of this.features){const{geometry:g}=p;this.addFeature(p,g,p.index,r,o)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cm),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,lm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,p,g){const v={x:0,y:0,vertexCount:0};for(const T of Nc(r,500)){let k=0;for(const Z of T)k+=Z.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Z of T){if(Z.length===0||vm(Z))continue;let re=0;for(let te=0;te<Z.length;te++){const me=Z[te];if(te>=1){const Te=Z[te-1];if(!ym(me,Te)){A.vertexLength+4>Ut.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pe=me.sub(Te)._perp()._unit(),ve=Te.dist(me);re+ve>32768&&(re=0),Ao(this.layoutVertexArray,me.x,me.y,pe.x,pe.y,0,0,re),Ao(this.layoutVertexArray,me.x,me.y,pe.x,pe.y,0,1,re),v.x+=2*me.x,v.y+=2*me.y,v.vertexCount+=2,re+=ve,Ao(this.layoutVertexArray,Te.x,Te.y,pe.x,pe.y,0,0,re),Ao(this.layoutVertexArray,Te.x,Te.y,pe.x,pe.y,0,1,re),v.x+=2*Te.x,v.y+=2*Te.y,v.vertexCount+=2;const Fe=A.vertexLength;this.indexArray.emplaceBack(Fe,Fe+2,Fe+1),this.indexArray.emplaceBack(Fe+1,Fe+2,Fe+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+k>Ut.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),_m[e.type]!=="Polygon")continue;const L=[],F=[],j=A.vertexLength;for(const Z of T)if(Z.length!==0){Z!==T[0]&&F.push(L.length/2);for(let re=0;re<Z.length;re++){const te=Z[re];Ao(this.layoutVertexArray,te.x,te.y,0,0,1,1,0),v.x+=te.x,v.y+=te.y,v.vertexCount+=1,L.push(te.x),L.push(te.y)}}const q=Bl.exports(L,F);for(let Z=0;Z<q.length;Z+=3)this.indexArray.emplaceBack(j+q[Z],j+q[Z+2],j+q[Z+1]);A.primitiveLength+=q.length/3,A.vertexLength+=k}for(let T=0;T<v.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(v.x/v.vertexCount),Math.floor(v.y/v.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,p)}}function ym(i,e){return i.x===e.x&&(i.x<0||i.x>Oi)||i.y===e.y&&(i.y<0||i.y>Oi)}function vm(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Oi)||i.every(e=>e.y<0)||i.every(e=>e.y>Oi)}ct("FillExtrusionBucket",Xc,{omit:["layers","features"]});var xm={paint:new Yi({"fill-extrusion-opacity":new pt(De["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(De["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(De["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(De["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gs(De["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(De["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(De["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pt(De["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function zo(i,e){return i.x*e.x+i.y*e.y}function nh(i,e){if(i.length===1){let r=0;const o=e[r++];let p;for(;!p||o.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){const g=e[r],v=i[0],T=p.sub(o),k=g.sub(o),A=v.sub(o),L=zo(T,T),F=zo(T,k),j=zo(k,k),q=zo(A,T),Z=zo(A,k),re=L*j-F*F,te=(j*q-F*Z)/re,me=(L*Z-F*q)/re,Te=o.z*(1-te-me)+p.z*te+g.z*me;if(isFinite(Te))return Te}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const bm=Di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:wm}=bm,Tm=Di([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:km}=Tm,Em=vs.VectorTileFeature.types,Sm=Math.cos(Math.PI/180*37.5),sh=Math.pow(2,14)/.5;class Hc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Kt,this.layoutVertexArray2=new ri,this.indexArray=new vr,this.programConfigurations=new $s(e.layers,e.zoom),this.segments=new Ut,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=jc("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),g=!p.isConstant(),v=[];for(const{feature:T,id:k,index:A,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,j=ta(T,F);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),j,o))continue;const q=g?p.evaluate(j,{},o):void 0,Z={id:k,properties:T.properties,type:T.type,sourceLayerIndex:L,index:A,geometry:F?j.geometry:ea(T),patterns:{},sortKey:q};v.push(Z)}g&&v.sort((T,k)=>T.sortKey-k.sortKey);for(const T of v){const{geometry:k,index:A,sourceLayerIndex:L}=T;if(this.hasPattern){const F=Gc("line",this.layers,T,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(T,k,A,o,{});r.featureIndex.insert(e[A].feature,k,A,L,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,km)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,p,g){const v=this.layers[0].layout,T=v.get("line-join").evaluate(e,{}),k=v.get("line-cap"),A=v.get("line-miter-limit"),L=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of r)this.addLine(F,e,T,k,A,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,g,p)}addLine(e,r,o,p,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<e.length-1;me++)this.totalDistance+=e[me].dist(e[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Em[r.type]==="Polygon";let k=e.length;for(;k>=2&&e[k-1].equals(e[k-2]);)k--;let A=0;for(;A<k-1&&e[A].equals(e[A+1]);)A++;if(k<(T?3:2))return;o==="bevel"&&(g=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let j,q,Z,re,te;this.e1=this.e2=-1,T&&(j=e[k-2],te=e[A].sub(j)._unit()._perp());for(let me=A;me<k;me++){if(Z=me===k-1?T?e[A+1]:void 0:e[me+1],Z&&e[me].equals(Z))continue;te&&(re=te),j&&(q=j),j=e[me],te=Z?Z.sub(j)._unit()._perp():re,re=re||te;let Te=re.add(te);Te.x===0&&Te.y===0||Te._unit();const pe=re.x*te.x+re.y*te.y,ve=Te.x*te.x+Te.y*te.y,Fe=ve!==0?1/ve:1/0,Re=2*Math.sqrt(2-2*ve),lt=ve<Sm&&q&&Z,ht=re.x*te.y-re.y*te.x>0;if(lt&&me>A){const We=j.dist(q);if(We>2*L){const it=j.sub(j.sub(q)._mult(L/We)._round());this.updateDistance(q,it),this.addCurrentVertex(it,re,0,0,F),q=it}}const tt=q&&Z;let Ye=tt?o:T?"butt":p;if(tt&&Ye==="round"&&(Fe<v?Ye="miter":Fe<=2&&(Ye="fakeround")),Ye==="miter"&&Fe>g&&(Ye="bevel"),Ye==="bevel"&&(Fe>2&&(Ye="flipbevel"),Fe<g&&(Ye="miter")),q&&this.updateDistance(q,j),Ye==="miter")Te._mult(Fe),this.addCurrentVertex(j,Te,0,0,F);else if(Ye==="flipbevel"){if(Fe>100)Te=te.mult(-1);else{const We=Fe*re.add(te).mag()/re.sub(te).mag();Te._perp()._mult(We*(ht?-1:1))}this.addCurrentVertex(j,Te,0,0,F),this.addCurrentVertex(j,Te.mult(-1),0,0,F)}else if(Ye==="bevel"||Ye==="fakeround"){const We=-Math.sqrt(Fe*Fe-1),it=ht?We:0,$e=ht?0:We;if(q&&this.addCurrentVertex(j,re,it,$e,F),Ye==="fakeround"){const Ge=Math.round(180*Re/Math.PI/20);for(let vt=1;vt<Ge;vt++){let mt=vt/Ge;if(mt!==.5){const _i=mt-.5;mt+=mt*_i*(mt-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*_i*_i+(.848013+pe*(.215638*pe-1.06021)))}const Vt=te.sub(re)._mult(mt)._add(re)._unit()._mult(ht?-1:1);this.addHalfVertex(j,Vt.x,Vt.y,!1,ht,0,F)}}Z&&this.addCurrentVertex(j,te,-it,-$e,F)}else if(Ye==="butt")this.addCurrentVertex(j,Te,0,0,F);else if(Ye==="square"){const We=q?1:-1;this.addCurrentVertex(j,Te,We,We,F)}else Ye==="round"&&(q&&(this.addCurrentVertex(j,re,0,0,F),this.addCurrentVertex(j,re,1,1,F,!0)),Z&&(this.addCurrentVertex(j,te,-1,-1,F,!0),this.addCurrentVertex(j,te,0,0,F)));if(lt&&me<k-1){const We=j.dist(Z);if(We>2*L){const it=j.add(Z.sub(j)._mult(L/We)._round());this.updateDistance(j,it),this.addCurrentVertex(it,te,0,0,F),j=it}}}}addCurrentVertex(e,r,o,p,g,v=!1){const T=r.y*p-r.x,k=-r.y-r.x*p;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,v,!1,o,g),this.addHalfVertex(e,T,k,v,!0,-p,g),this.distance>sh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,o,p,g,v))}addHalfVertex({x:e,y:r},o,p,g,v,T,k){const A=.5*(this.lineClips?this.scaledDistance*(sh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(r<<1)+(v?1:0),Math.round(63*o)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),k.primitiveLength++),v?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}ct("LineBucket",Hc,{omit:["layers","patternFeatures"]});const Im=new Yi({"line-cap":new pt(De.layout_line["line-cap"]),"line-join":new Tt(De.layout_line["line-join"]),"line-miter-limit":new pt(De.layout_line["line-miter-limit"]),"line-round-limit":new pt(De.layout_line["line-round-limit"]),"line-sort-key":new Tt(De.layout_line["line-sort-key"])});var ah={paint:new Yi({"line-opacity":new Tt(De.paint_line["line-opacity"]),"line-color":new Tt(De.paint_line["line-color"]),"line-translate":new pt(De.paint_line["line-translate"]),"line-translate-anchor":new pt(De.paint_line["line-translate-anchor"]),"line-width":new Tt(De.paint_line["line-width"]),"line-gap-width":new Tt(De.paint_line["line-gap-width"]),"line-offset":new Tt(De.paint_line["line-offset"]),"line-blur":new Tt(De.paint_line["line-blur"]),"line-dasharray":new _o(De.paint_line["line-dasharray"]),"line-pattern":new gs(De.paint_line["line-pattern"]),"line-gradient":new In(De.paint_line["line-gradient"])}),layout:Im};const oh=new class extends Tt{possiblyEvaluate(i,e){return e=new wi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,o){return e=N({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,o)}}(ah.paint.properties["line-width"].specification);function lh(i,e){return e>0?e+2*i:i}oh.useIntegerZoom=!0;const Cm=Di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Am=Di([{name:"a_projected_pos",components:3,type:"Float32"}],4);Di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zm=Di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Di([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ch=Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Mm=Di([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pm(i,e,r){return i.sections.forEach(o=>{o.text=function(p,g,v){const T=g.layout.get("text-transform").evaluate(v,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),Or.applyArabicShaping&&(p=Or.applyArabicShaping(p)),p}(o.text,e,r)}),i}Di([{name:"triangle",components:3,type:"Uint16"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Di([{type:"Float32",name:"offsetX"}]),Di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Mo={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Qi=24,Wc=oi,uh=function(i,e,r,o,p){var g,v,T=8*p-o-1,k=(1<<T)-1,A=k>>1,L=-7,F=r?p-1:0,j=r?-1:1,q=i[e+F];for(F+=j,g=q&(1<<-L)-1,q>>=-L,L+=T;L>0;g=256*g+i[e+F],F+=j,L-=8);for(v=g&(1<<-L)-1,g>>=-L,L+=o;L>0;v=256*v+i[e+F],F+=j,L-=8);if(g===0)g=1-A;else{if(g===k)return v?NaN:1/0*(q?-1:1);v+=Math.pow(2,o),g-=A}return(q?-1:1)*v*Math.pow(2,g-o)},hh=function(i,e,r,o,p,g){var v,T,k,A=8*g-p-1,L=(1<<A)-1,F=L>>1,j=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=o?0:g-1,Z=o?1:-1,re=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,v=L):(v=Math.floor(Math.log(e)/Math.LN2),e*(k=Math.pow(2,-v))<1&&(v--,k*=2),(e+=v+F>=1?j/k:j*Math.pow(2,1-F))*k>=2&&(v++,k/=2),v+F>=L?(T=0,v=L):v+F>=1?(T=(e*k-1)*Math.pow(2,p),v+=F):(T=e*Math.pow(2,F-1)*Math.pow(2,p),v=0));p>=8;i[r+q]=255&T,q+=Z,T/=256,p-=8);for(v=v<<p|T,A+=p;A>0;i[r+q]=255&v,q+=Z,v/=256,A-=8);i[r+q-Z]|=128*re};function oi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}oi.Varint=0,oi.Fixed64=1,oi.Bytes=2,oi.Fixed32=5;var xs,Kc=4294967296,fh=1/Kc,dh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Xn(i){return i.type===oi.Bytes?i.readVarint()+i.pos:i.pos+1}function Ma(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function ph(i,e,r){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(var p=r.pos-1;p>=i;p--)r.buf[p+o]=r.buf[p]}function Dm(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Lm(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Bm(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Rm(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Fm(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Om(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Vm(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Um(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Nm(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Ul(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Pa(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function mh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function jm(i,e,r){i===1&&r.readMessage(Gm,e)}function Gm(i,e,r){if(i===3){const{id:o,bitmap:p,width:g,height:v,left:T,top:k,advance:A}=r.readMessage(qm,{});e.push({id:o,bitmap:new ko({width:g+6,height:v+6},p),metrics:{width:g,height:v,left:T,top:k,advance:A}})}}function qm(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function gh(i){let e=0,r=0;for(const v of i)e+=v.w*v.h,r=Math.max(r,v.w);i.sort((v,T)=>T.h-v.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let p=0,g=0;for(const v of i)for(let T=o.length-1;T>=0;T--){const k=o[T];if(!(v.w>k.w||v.h>k.h)){if(v.x=k.x,v.y=k.y,g=Math.max(g,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===k.w&&v.h===k.h){const A=o.pop();T<o.length&&(o[T]=A)}else v.h===k.h?(k.x+=v.w,k.w-=v.w):v.w===k.w?(k.y+=v.h,k.h-=v.h):(o.push({x:k.x+v.w,y:k.y,w:k.w-v.w,h:v.h}),k.y+=v.h,k.h-=v.h);break}}return{w:p,h:g,fill:e/(p*g)||0}}oi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),p=o>>3,g=this.pos;this.type=7&o,i(p,e,this),this.pos===g&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Ul(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=mh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Ul(this.buf,this.pos)+Ul(this.buf,this.pos+4)*Kc;return this.pos+=8,i},readSFixed64:function(){var i=Ul(this.buf,this.pos)+mh(this.buf,this.pos+4)*Kc;return this.pos+=8,i},readFloat:function(){var i=uh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=uh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,o=this.buf;return e=127&(r=o[this.pos++]),r<128?e:(e|=(127&(r=o[this.pos++]))<<7,r<128?e:(e|=(127&(r=o[this.pos++]))<<14,r<128?e:(e|=(127&(r=o[this.pos++]))<<21,r<128?e:function(p,g,v){var T,k,A=v.buf;if(T=(112&(k=A[v.pos++]))>>4,k<128||(T|=(127&(k=A[v.pos++]))<<3,k<128)||(T|=(127&(k=A[v.pos++]))<<10,k<128)||(T|=(127&(k=A[v.pos++]))<<17,k<128)||(T|=(127&(k=A[v.pos++]))<<24,k<128)||(T|=(1&(k=A[v.pos++]))<<31,k<128))return Ma(p,T,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&dh?function(r,o,p){return dh.decode(r.subarray(o,p))}(this.buf,e,i):function(r,o,p){for(var g="",v=o;v<p;){var T,k,A,L=r[v],F=null,j=L>239?4:L>223?3:L>191?2:1;if(v+j>p)break;j===1?L<128&&(F=L):j===2?(192&(T=r[v+1]))==128&&(F=(31&L)<<6|63&T)<=127&&(F=null):j===3?(k=r[v+2],(192&(T=r[v+1]))==128&&(192&k)==128&&((F=(15&L)<<12|(63&T)<<6|63&k)<=2047||F>=55296&&F<=57343)&&(F=null)):j===4&&(k=r[v+2],A=r[v+3],(192&(T=r[v+1]))==128&&(192&k)==128&&(192&A)==128&&((F=(15&L)<<18|(63&T)<<12|(63&k)<<6|63&A)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,j=1):F>65535&&(F-=65536,g+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),g+=String.fromCharCode(F),v+=j}return g}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==oi.Bytes)return i.push(this.readVarint(e));var r=Xn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==oi.Bytes)return i.push(this.readSVarint());var e=Xn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==oi.Bytes)return i.push(this.readBoolean());var e=Xn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==oi.Bytes)return i.push(this.readFloat());var e=Xn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==oi.Bytes)return i.push(this.readDouble());var e=Xn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==oi.Bytes)return i.push(this.readFixed32());var e=Xn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==oi.Bytes)return i.push(this.readSFixed32());var e=Xn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==oi.Bytes)return i.push(this.readFixed64());var e=Xn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==oi.Bytes)return i.push(this.readSFixed64());var e=Xn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===oi.Varint)for(;this.buf[this.pos++]>127;);else if(e===oi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===oi.Fixed32)this.pos+=4;else{if(e!==oi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Pa(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Pa(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Pa(this.buf,-1&i,this.pos),Pa(this.buf,Math.floor(i*fh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Pa(this.buf,-1&i,this.pos),Pa(this.buf,Math.floor(i*fh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var o,p;if(e>=0?(o=e%4294967296|0,p=e/4294967296|0):(p=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,p=p+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,v,T){T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,T.buf[T.pos]=127&(g>>>=7)}(o,0,r),function(g,v){var T=(7&g)<<4;v.buf[v.pos++]|=T|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(p,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,p,g){for(var v,T,k=0;k<p.length;k++){if((v=p.charCodeAt(k))>55295&&v<57344){if(!T){v>56319||k+1===p.length?(o[g++]=239,o[g++]=191,o[g++]=189):T=v;continue}if(v<56320){o[g++]=239,o[g++]=191,o[g++]=189,T=v;continue}v=T-55296<<10|v-56320|65536,T=null}else T&&(o[g++]=239,o[g++]=191,o[g++]=189,T=null);v<128?o[g++]=v:(v<2048?o[g++]=v>>6|192:(v<65536?o[g++]=v>>12|224:(o[g++]=v>>18|240,o[g++]=v>>12&63|128),o[g++]=v>>6&63|128),o[g++]=63&v|128)}return g}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&ph(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),hh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),hh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var o=this.pos-r;o>=128&&ph(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,r){this.writeTag(i,oi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Dm,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Lm,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Fm,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Bm,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Rm,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Om,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Vm,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Um,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Nm,e)},writeBytesField:function(i,e){this.writeTag(i,oi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,oi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,oi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,oi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,oi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,oi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,oi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,oi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,oi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,oi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};class Jc{constructor(e,{pixelRatio:r,version:o,stretchX:p,stretchY:g,content:v}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=g,this.content=v,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class _h{constructor(e,r){const o={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,o,g),this.addImages(r,p,g);const{w:v,h:T}=gh(g),k=new Zr({width:v||1,height:T||1});for(const A in e){const L=e[A],F=o[A].paddedRect;Zr.copy(L.data,k,{x:0,y:0},{x:F.x+1,y:F.y+1},L.data)}for(const A in r){const L=r[A],F=p[A].paddedRect,j=F.x+1,q=F.y+1,Z=L.data.width,re=L.data.height;Zr.copy(L.data,k,{x:0,y:0},{x:j,y:q},L.data),Zr.copy(L.data,k,{x:0,y:re-1},{x:j,y:q-1},{width:Z,height:1}),Zr.copy(L.data,k,{x:0,y:0},{x:j,y:q+re},{width:Z,height:1}),Zr.copy(L.data,k,{x:Z-1,y:0},{x:j-1,y:q},{width:1,height:re}),Zr.copy(L.data,k,{x:0,y:0},{x:j+Z,y:q},{width:1,height:re})}this.image=k,this.iconPositions=o,this.patternPositions=p}addImages(e,r,o){for(const p in e){const g=e[p],v={x:0,y:0,w:g.data.width+2,h:g.data.height+2};o.push(v),r[p]=new Jc(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[p,g]=e.tl;o.update(r.data,void 0,{x:p,y:g})}}ct("ImagePosition",Jc),ct("ImageAtlas",_h),s.WritingMode=void 0,(xs=s.WritingMode||(s.WritingMode={}))[xs.none=0]="none",xs[xs.horizontal=1]="horizontal",xs[xs.vertical=2]="vertical",xs[xs.horizontalOnly=3]="horizontalOnly";const Nl=-17;class Po{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const o=new Po;return o.scale=e||1,o.fontStack=r,o}static forImage(e){const r=new Po;return r.imageName=e,r}}class Da{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const o=new Da;for(let p=0;p<e.sections.length;p++){const g=e.sections[p];g.image?o.addImageSection(g):o.addTextSection(g,r)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let o=0;o<e.length;o++){const p=e.charCodeAt(o+1)||null,g=e.charCodeAt(o-1)||null;r+=p&&bl(p)&&!Mo[e[o+1]]||g&&bl(g)&&!Mo[e[o-1]]||!Mo[e[o]]?e[o]:Mo[e[o]]}return r}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&Gl[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Gl[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new Da;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Po.forText(e.scale,e.fontStack||r));const o=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(o)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void ke("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Po.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ke("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jl(i,e,r,o,p,g,v,T,k,A,L,F,j,q,Z,re){const te=Da.fromFeature(i,p);let me;F===s.WritingMode.vertical&&te.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:pe}=Or;if(Te&&te.sections.length===1){me=[];const Re=Te(te.toString(),Yc(te,A,g,e,o,q,Z));for(const lt of Re){const ht=new Da;ht.text=lt,ht.sections=te.sections;for(let tt=0;tt<lt.length;tt++)ht.sectionIndex.push(0);me.push(ht)}}else if(pe){me=[];const Re=pe(te.text,te.sectionIndex,Yc(te,A,g,e,o,q,Z));for(const lt of Re){const ht=new Da;ht.text=lt[0],ht.sectionIndex=lt[1],ht.sections=te.sections,me.push(ht)}}else me=function(Re,lt){const ht=[],tt=Re.text;let Ye=0;for(const We of lt)ht.push(Re.substring(Ye,We)),Ye=We;return Ye<tt.length&&ht.push(Re.substring(Ye,tt.length)),ht}(te,Yc(te,A,g,e,o,q,Z));const ve=[],Fe={positionedLines:ve,text:te.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Re,lt,ht,tt,Ye,We,it,$e,Ge,vt,mt,Vt){let _i=0,ki=Nl,Vi=0,Hr=0;const ir=$e==="right"?1:$e==="left"?0:.5;let Li=0;for(const Bi of Ye){Bi.trim();const nr=Bi.getMaxScale(),dr=(nr-1)*Qi,wr={positionedGlyphs:[],lineOffset:0};Re.positionedLines[Li]=wr;const Mr=wr.positionedGlyphs;let Pr=0;if(!Bi.length()){ki+=We,++Li;continue}for(let Wi=0;Wi<Bi.length();Wi++){const Nt=Bi.getSection(Wi),Nr=Bi.getSectionIndex(Wi),sr=Bi.getCharCode(Wi);let pr=0,nn=null,pn=null,mn=null,Wn=Qi;const sn=!(Ge===s.WritingMode.horizontal||!mt&&!uo(sr)||mt&&(Gl[sr]||(Hi=sr,et.Arabic(Hi)||et["Arabic Supplement"](Hi)||et["Arabic Extended-A"](Hi)||et["Arabic Presentation Forms-A"](Hi)||et["Arabic Presentation Forms-B"](Hi))));if(Nt.imageName){const Wr=tt[Nt.imageName];if(!Wr)continue;mn=Nt.imageName,Re.iconsInText=Re.iconsInText||!0,pn=Wr.paddedRect;const Dr=Wr.displaySize;Nt.scale=Nt.scale*Qi/Vt,nn={width:Dr[0],height:Dr[1],left:1,top:-3,advance:sn?Dr[1]:Dr[0]},pr=dr+(Qi-Dr[1]*Nt.scale),Wn=nn.advance;const Kn=sn?Dr[0]*Nt.scale-Qi*nr:Dr[1]*Nt.scale-Qi*nr;Kn>0&&Kn>Pr&&(Pr=Kn)}else{const Wr=ht[Nt.fontStack],Dr=Wr&&Wr[sr];if(Dr&&Dr.rect)pn=Dr.rect,nn=Dr.metrics;else{const Kn=lt[Nt.fontStack],Bo=Kn&&Kn[sr];if(!Bo)continue;nn=Bo.metrics}pr=(nr-Nt.scale)*Qi}sn?(Re.verticalizable=!0,Mr.push({glyph:sr,imageName:mn,x:_i,y:ki+pr,vertical:sn,scale:Nt.scale,fontStack:Nt.fontStack,sectionIndex:Nr,metrics:nn,rect:pn}),_i+=Wn*Nt.scale+vt):(Mr.push({glyph:sr,imageName:mn,x:_i,y:ki+pr,vertical:sn,scale:Nt.scale,fontStack:Nt.fontStack,sectionIndex:Nr,metrics:nn,rect:pn}),_i+=nn.advance*Nt.scale+vt)}Mr.length!==0&&(Vi=Math.max(_i-vt,Vi),Hm(Mr,0,Mr.length-1,ir,Pr)),_i=0;const Ei=We*nr+Pr;wr.lineOffset=Math.max(Pr,dr),ki+=Ei,Hr=Math.max(Ei,Hr),++Li}var Hi;const rr=ki-Nl,{horizontalAlign:fr,verticalAlign:zr}=Qc(it);(function(Bi,nr,dr,wr,Mr,Pr,Ei,Wi,Nt){const Nr=(nr-dr)*Mr;let sr=0;sr=Pr!==Ei?-Wi*wr-Nl:(-wr*Nt+.5)*Ei;for(const pr of Bi)for(const nn of pr.positionedGlyphs)nn.x+=Nr,nn.y+=sr})(Re.positionedLines,ir,fr,zr,Vi,Hr,We,rr,Ye.length),Re.top+=-zr*rr,Re.bottom=Re.top+rr,Re.left+=-fr*Vi,Re.right=Re.left+Vi}(Fe,e,r,o,me,v,T,k,F,A,j,re),!function(Re){for(const lt of Re)if(lt.positionedGlyphs.length!==0)return!1;return!0}(ve)&&Fe}const Gl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yh(i,e,r,o,p,g){if(e.imageName){const v=o[e.imageName];return v?v.displaySize[0]*e.scale*Qi/g+p:0}{const v=r[e.fontStack],T=v&&v[i];return T?T.metrics.advance*e.scale+p:0}}function vh(i,e,r,o){const p=Math.pow(i-e,2);return o?i<e?p/2:2*p:p+Math.abs(r)*r}function Xm(i,e,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function xh(i,e,r,o,p,g){let v=null,T=vh(e,r,p,g);for(const k of o){const A=vh(e-k.x,r,p,g)+k.badness;A<=T&&(v=k,T=A)}return{index:i,x:e,priorBreak:v,badness:T}}function bh(i){return i?bh(i.priorBreak).concat(i.index):[]}function Yc(i,e,r,o,p,g,v){if(g!=="point")return[];if(!i)return[];const T=[],k=function(j,q,Z,re,te,me){let Te=0;for(let pe=0;pe<j.length();pe++){const ve=j.getSection(pe);Te+=yh(j.getCharCode(pe),ve,re,te,q,me)}return Te/Math.max(1,Math.ceil(Te/Z))}(i,e,r,o,p,v),A=i.text.indexOf("")>=0;let L=0;for(let j=0;j<i.length();j++){const q=i.getSection(j),Z=i.getCharCode(j);if(Gl[Z]||(L+=yh(Z,q,o,p,e,v)),j<i.length()-1){const re=!((F=Z)<11904||!(et["Bopomofo Extended"](F)||et.Bopomofo(F)||et["CJK Compatibility Forms"](F)||et["CJK Compatibility Ideographs"](F)||et["CJK Compatibility"](F)||et["CJK Radicals Supplement"](F)||et["CJK Strokes"](F)||et["CJK Symbols and Punctuation"](F)||et["CJK Unified Ideographs Extension A"](F)||et["CJK Unified Ideographs"](F)||et["Enclosed CJK Letters and Months"](F)||et["Halfwidth and Fullwidth Forms"](F)||et.Hiragana(F)||et["Ideographic Description Characters"](F)||et["Kangxi Radicals"](F)||et["Katakana Phonetic Extensions"](F)||et.Katakana(F)||et["Vertical Forms"](F)||et["Yi Radicals"](F)||et["Yi Syllables"](F)));(Zm[Z]||re||q.imageName)&&T.push(xh(j+1,L,k,T,Xm(Z,i.getCharCode(j+1),re&&A),!1))}}var F;return bh(xh(i.length(),L,k,T,0,!0))}function Qc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Hm(i,e,r,o,p){if(!o&&!p)return;const g=i[r],v=(i[r].x+g.metrics.advance*g.scale)*o;for(let T=e;T<=r;T++)i[T].x-=v,i[T].y+=p}function Wm(i,e,r){const{horizontalAlign:o,verticalAlign:p}=Qc(r),g=e[0]-i.displaySize[0]*o,v=e[1]-i.displaySize[1]*p;return{image:i,top:v,bottom:v+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function wh(i,e,r,o,p,g){const v=i.image;let T;if(v.content){const te=v.content,me=v.pixelRatio||1;T=[te[0]/me,te[1]/me,v.displaySize[0]-te[2]/me,v.displaySize[1]-te[3]/me]}const k=e.left*g,A=e.right*g;let L,F,j,q;r==="width"||r==="both"?(q=p[0]+k-o[3],F=p[0]+A+o[1]):(q=p[0]+(k+A-v.displaySize[0])/2,F=q+v.displaySize[0]);const Z=e.top*g,re=e.bottom*g;return r==="height"||r==="both"?(L=p[1]+Z-o[0],j=p[1]+re+o[2]):(L=p[1]+(Z+re-v.displaySize[1])/2,j=L+v.displaySize[1]),{image:v,top:L,right:F,bottom:j,left:q,collisionPadding:T}}const Hn=128;function Th(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new wi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:p}=r;let g=0;for(;g<o.length&&o[g]<=i;)g++;g=Math.max(0,g-1);let v=g;for(;v<o.length&&o[v]<i+1;)v++;v=Math.min(o.length-1,v);const T=o[g],k=o[v];return r.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:k,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:k,minSize:r.evaluate(new wi(T)),maxSize:r.evaluate(new wi(k)),interpolationType:p}}}class bs extends xt{constructor(e,r,o,p){super(e,r),this.angle=o,p!==void 0&&(this.segment=p)}clone(){return new bs(this.x,this.y,this.angle,this.segment)}}function kh(i,e,r,o,p){if(e.segment===void 0)return!0;let g=e,v=e.segment+1,T=0;for(;T>-r/2;){if(v--,v<0)return!1;T-=i[v].dist(g),g=i[v]}T+=i[v].dist(i[v+1]),v++;const k=[];let A=0;for(;T<r/2;){const L=i[v],F=i[v+1];if(!F)return!1;let j=i[v-1].angleTo(L)-L.angleTo(F);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:T,angleDelta:j}),A+=j;T-k[0].distance>o;)A-=k.shift().angleDelta;if(A>p)return!1;v++,T+=L.dist(F)}return!0}function Eh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Sh(i,e,r){return i?.6*e*r:0}function Ih(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Km(i,e,r,o,p,g){const v=Sh(r,p,g),T=Ih(r,o)*g;let k=0;const A=Eh(i)/2;for(let L=0;L<i.length-1;L++){const F=i[L],j=i[L+1],q=F.dist(j);if(k+q>A){const Z=(A-k)/q,re=xi(F.x,j.x,Z),te=xi(F.y,j.y,Z),me=new bs(re,te,j.angleTo(F),L);return me._round(),!v||kh(i,me,T,v,e)?me:void 0}k+=q}}function Jm(i,e,r,o,p,g,v,T,k){const A=Sh(o,g,v),L=Ih(o,p),F=L*v,j=i[0].x===0||i[0].x===k||i[0].y===0||i[0].y===k;return e-F<e/4&&(e=F+e/4),Ch(i,j?e/2*T%e:(L/2+2*g)*v*T%e,e,A,r,F,j,!1,k)}function Ch(i,e,r,o,p,g,v,T,k){const A=g/2,L=Eh(i);let F=0,j=e-r,q=[];for(let Z=0;Z<i.length-1;Z++){const re=i[Z],te=i[Z+1],me=re.dist(te),Te=te.angleTo(re);for(;j+r<F+me;){j+=r;const pe=(j-F)/me,ve=xi(re.x,te.x,pe),Fe=xi(re.y,te.y,pe);if(ve>=0&&ve<k&&Fe>=0&&Fe<k&&j-A>=0&&j+A<=L){const Re=new bs(ve,Fe,Te,Z);Re._round(),o&&!kh(i,Re,g,o,p)||q.push(Re)}}F+=me}return T||q.length||v||(q=Ch(i,F/2,r,o,p,g,v,!0,k)),q}function Ah(i,e,r,o,p){const g=[];for(let v=0;v<i.length;v++){const T=i[v];let k;for(let A=0;A<T.length-1;A++){let L=T[A],F=T[A+1];L.x<e&&F.x<e||(L.x<e?L=new xt(e,L.y+(e-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x<e&&(F=new xt(e,L.y+(e-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y<r&&F.y<r||(L.y<r?L=new xt(L.x+(r-L.y)/(F.y-L.y)*(F.x-L.x),r)._round():F.y<r&&(F=new xt(L.x+(r-L.y)/(F.y-L.y)*(F.x-L.x),r)._round()),L.x>=o&&F.x>=o||(L.x>=o?L=new xt(o,L.y+(o-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x>=o&&(F=new xt(o,L.y+(o-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y>=p&&F.y>=p||(L.y>=p?L=new xt(L.x+(p-L.y)/(F.y-L.y)*(F.x-L.x),p)._round():F.y>=p&&(F=new xt(L.x+(p-L.y)/(F.y-L.y)*(F.x-L.x),p)._round()),k&&L.equals(k[k.length-1])||(k=[L],g.push(k)),k.push(F)))))}}return g}function zh(i,e,r,o){const p=[],g=i.image,v=g.pixelRatio,T=g.paddedRect.w-2,k=g.paddedRect.h-2,A=i.right-i.left,L=i.bottom-i.top,F=g.stretchX||[[0,T]],j=g.stretchY||[[0,k]],q=(We,it)=>We+it[1]-it[0],Z=F.reduce(q,0),re=j.reduce(q,0),te=T-Z,me=k-re;let Te=0,pe=Z,ve=0,Fe=re,Re=0,lt=te,ht=0,tt=me;if(g.content&&o){const We=g.content;Te=ql(F,0,We[0]),ve=ql(j,0,We[1]),pe=ql(F,We[0],We[2]),Fe=ql(j,We[1],We[3]),Re=We[0]-Te,ht=We[1]-ve,lt=We[2]-We[0]-pe,tt=We[3]-We[1]-Fe}const Ye=(We,it,$e,Ge)=>{const vt=Zl(We.stretch-Te,pe,A,i.left),mt=Xl(We.fixed-Re,lt,We.stretch,Z),Vt=Zl(it.stretch-ve,Fe,L,i.top),_i=Xl(it.fixed-ht,tt,it.stretch,re),ki=Zl($e.stretch-Te,pe,A,i.left),Vi=Xl($e.fixed-Re,lt,$e.stretch,Z),Hr=Zl(Ge.stretch-ve,Fe,L,i.top),ir=Xl(Ge.fixed-ht,tt,Ge.stretch,re),Li=new xt(vt,Vt),Hi=new xt(ki,Vt),rr=new xt(ki,Hr),fr=new xt(vt,Hr),zr=new xt(mt/v,_i/v),Bi=new xt(Vi/v,ir/v),nr=e*Math.PI/180;if(nr){const Mr=Math.sin(nr),Pr=Math.cos(nr),Ei=[Pr,-Mr,Mr,Pr];Li._matMult(Ei),Hi._matMult(Ei),fr._matMult(Ei),rr._matMult(Ei)}const dr=We.stretch+We.fixed,wr=it.stretch+it.fixed;return{tl:Li,tr:Hi,bl:fr,br:rr,tex:{x:g.paddedRect.x+1+dr,y:g.paddedRect.y+1+wr,w:$e.stretch+$e.fixed-dr,h:Ge.stretch+Ge.fixed-wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zr,pixelOffsetBR:Bi,minFontScaleX:lt/v/A,minFontScaleY:tt/v/L,isSDF:r}};if(o&&(g.stretchX||g.stretchY)){const We=Mh(F,te,Z),it=Mh(j,me,re);for(let $e=0;$e<We.length-1;$e++){const Ge=We[$e],vt=We[$e+1];for(let mt=0;mt<it.length-1;mt++)p.push(Ye(Ge,it[mt],vt,it[mt+1]))}}else p.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:k+1}));return p}function ql(i,e,r){let o=0;for(const p of i)o+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return o}function Mh(i,e,r){const o=[{fixed:-1,stretch:0}];for(const[p,g]of i){const v=o[o.length-1];o.push({fixed:p-v.stretch,stretch:v.stretch}),o.push({fixed:p-v.stretch,stretch:v.stretch+(g-p)})}return o.push({fixed:e+1,stretch:r}),o}function Zl(i,e,r,o){return i/e*r+o}function Xl(i,e,r,o){return i-e*r/o}ct("Anchor",bs);class Hl{constructor(e,r,o,p,g,v,T,k,A,L){if(this.boxStartIndex=e.length,A){let F=v.top,j=v.bottom;const q=v.collisionPadding;q&&(F-=q[1],j+=q[3]);let Z=j-F;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{let F=v.top*T-k[0],j=v.bottom*T+k[2],q=v.left*T-k[3],Z=v.right*T+k[1];const re=v.collisionPadding;if(re&&(q-=re[0]*T,F-=re[1]*T,Z+=re[2]*T,j+=re[3]*T),L){const te=new xt(q,F),me=new xt(Z,F),Te=new xt(q,j),pe=new xt(Z,j),ve=L*Math.PI/180;te._rotate(ve),me._rotate(ve),Te._rotate(ve),pe._rotate(ve),q=Math.min(te.x,me.x,Te.x,pe.x),Z=Math.max(te.x,me.x,Te.x,pe.x),F=Math.min(te.y,me.y,Te.y,pe.y),j=Math.max(te.y,me.y,Te.y,pe.y)}e.emplaceBack(r.x,r.y,q,F,Z,j,o,p,g)}this.boxEndIndex=e.length}}class Ym{constructor(e=[],r=Qm){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,p=r[e];for(;e>0;){const g=e-1>>1,v=r[g];if(o(p,v)>=0)break;r[e]=v,e=g}r[e]=p}_down(e){const{data:r,compare:o}=this,p=this.length>>1,g=r[e];for(;e<p;){let v=1+(e<<1),T=r[v];const k=v+1;if(k<this.length&&o(r[k],T)<0&&(v=k,T=r[k]),o(T,g)>=0)break;r[e]=T,e=v}r[e]=g}}function Qm(i,e){return i<e?-1:i>e?1:0}function $m(i,e=1,r=!1){let o=1/0,p=1/0,g=-1/0,v=-1/0;const T=i[0];for(let q=0;q<T.length;q++){const Z=T[q];(!q||Z.x<o)&&(o=Z.x),(!q||Z.y<p)&&(p=Z.y),(!q||Z.x>g)&&(g=Z.x),(!q||Z.y>v)&&(v=Z.y)}const k=Math.min(g-o,v-p);let A=k/2;const L=new Ym([],eg);if(k===0)return new xt(o,p);for(let q=o;q<g;q+=k)for(let Z=p;Z<v;Z+=k)L.push(new La(q+A,Z+A,A,i));let F=function(q){let Z=0,re=0,te=0;const me=q[0];for(let Te=0,pe=me.length,ve=pe-1;Te<pe;ve=Te++){const Fe=me[Te],Re=me[ve],lt=Fe.x*Re.y-Re.x*Fe.y;re+=(Fe.x+Re.x)*lt,te+=(Fe.y+Re.y)*lt,Z+=3*lt}return new La(re/Z,te/Z,0,q)}(i),j=L.length;for(;L.length;){const q=L.pop();(q.d>F.d||!F.d)&&(F=q,r&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,j)),q.max-F.d<=e||(A=q.h/2,L.push(new La(q.p.x-A,q.p.y-A,A,i)),L.push(new La(q.p.x+A,q.p.y-A,A,i)),L.push(new La(q.p.x-A,q.p.y+A,A,i)),L.push(new La(q.p.x+A,q.p.y+A,A,i)),j+=4)}return r&&(console.log(`num probes: ${j}`),console.log(`best distance: ${F.d}`)),F.p}function eg(i,e){return e.max-i.max}function La(i,e,r,o){this.p=new xt(i,e),this.h=r,this.d=function(p,g){let v=!1,T=1/0;for(let k=0;k<g.length;k++){const A=g[k];for(let L=0,F=A.length,j=F-1;L<F;j=L++){const q=A[L],Z=A[j];q.y>p.y!=Z.y>p.y&&p.x<(Z.x-q.x)*(p.y-q.y)/(Z.y-q.y)+q.x&&(v=!v),T=Math.min(T,Vu(p,q,Z))}}return(v?1:-1)*Math.sqrt(T)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const $c=Number.POSITIVE_INFINITY;function Ph(i,e){return e[1]!==$c?function(r,o,p){let g=0,v=0;switch(o=Math.abs(o),p=Math.abs(p),r){case"top-right":case"top-left":case"top":v=p-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-p}switch(r){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,v]}(i,e[0],e[1]):function(r,o){let p=0,g=0;o<0&&(o=0);const v=o/Math.sqrt(2);switch(r){case"top-right":case"top-left":g=v-7;break;case"bottom-right":case"bottom-left":g=7-v;break;case"bottom":g=7-o;break;case"top":g=o-7}switch(r){case"top-right":case"bottom-right":p=-v;break;case"top-left":case"bottom-left":p=v;break;case"left":p=o;break;case"right":p=-o}return[p,g]}(i,e[0])}function eu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tg(i,e,r,o,p,g,v,T,k,A,L){let F=g.textMaxSize.evaluate(e,{});F===void 0&&(F=v);const j=i.layers[0].layout,q=j.get("icon-offset").evaluate(e,{},L),Z=Lh(r.horizontal),re=v/24,te=i.tilePixelRatio*re,me=i.tilePixelRatio*F/24,Te=i.tilePixelRatio*T,pe=i.tilePixelRatio*j.get("symbol-spacing"),ve=j.get("text-padding")*i.tilePixelRatio,Fe=function(Ge,vt,mt,Vt=1){const _i=Ge.get("icon-padding").evaluate(vt,{},mt),ki=_i&&_i.values;return[ki[0]*Vt,ki[1]*Vt,ki[2]*Vt,ki[3]*Vt]}(j,e,L,i.tilePixelRatio),Re=j.get("text-max-angle")/180*Math.PI,lt=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",ht=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",tt=j.get("symbol-placement"),Ye=pe/2,We=j.get("icon-text-fit");let it;o&&We!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(it=wh(o,r.vertical,We,j.get("icon-text-fit-padding"),q,re)),Z&&(o=wh(o,Z,We,j.get("icon-text-fit-padding"),q,re)));const $e=(Ge,vt)=>{vt.x<0||vt.x>=Oi||vt.y<0||vt.y>=Oi||function(mt,Vt,_i,ki,Vi,Hr,ir,Li,Hi,rr,fr,zr,Bi,nr,dr,wr,Mr,Pr,Ei,Wi,Nt,Nr,sr,pr,nn){const pn=mt.addToLineVertexArray(Vt,_i);let mn,Wn,sn,Wr,Dr=0,Kn=0,Bo=0,Jh=0,uu=-1,hu=-1;const Jn={};let Yh=Xi.exports(""),fu=0,du=0;if(Li._unevaluatedLayout.getValue("text-radial-offset")===void 0?[fu,du]=Li.layout.get("text-offset").evaluate(Nt,{},pr).map(Lr=>Lr*Qi):(fu=Li.layout.get("text-radial-offset").evaluate(Nt,{},pr)*Qi,du=$c),mt.allowVerticalPlacement&&ki.vertical){const Lr=Li.layout.get("text-rotate").evaluate(Nt,{},pr)+90;sn=new Hl(Hi,Vt,rr,fr,zr,ki.vertical,Bi,nr,dr,Lr),ir&&(Wr=new Hl(Hi,Vt,rr,fr,zr,ir,Mr,Pr,dr,Lr))}if(Vi){const Lr=Li.layout.get("icon-rotate").evaluate(Nt,{}),Pn=Li.layout.get("icon-text-fit")!=="none",Ro=zh(Vi,Lr,sr,Pn),Fo=ir?zh(ir,Lr,sr,Pn):void 0;Wn=new Hl(Hi,Vt,rr,fr,zr,Vi,Mr,Pr,!1,Lr),Dr=4*Ro.length;const ef=mt.iconSizeData;let na=null;ef.kind==="source"?(na=[Hn*Li.layout.get("icon-size").evaluate(Nt,{})],na[0]>ws&&ke(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ef.kind==="composite"&&(na=[Hn*Nr.compositeIconSizes[0].evaluate(Nt,{},pr),Hn*Nr.compositeIconSizes[1].evaluate(Nt,{},pr)],(na[0]>ws||na[1]>ws)&&ke(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,Ro,na,Wi,Ei,Nt,s.WritingMode.none,Vt,pn.lineStartIndex,pn.lineLength,-1,pr),uu=mt.icon.placedSymbolArray.length-1,Fo&&(Kn=4*Fo.length,mt.addSymbols(mt.icon,Fo,na,Wi,Ei,Nt,s.WritingMode.vertical,Vt,pn.lineStartIndex,pn.lineLength,-1,pr),hu=mt.icon.placedSymbolArray.length-1)}const Qh=Object.keys(ki.horizontal);for(const Lr of Qh){const Pn=ki.horizontal[Lr];if(!mn){Yh=Xi.exports(Pn.text);const Fo=Li.layout.get("text-rotate").evaluate(Nt,{},pr);mn=new Hl(Hi,Vt,rr,fr,zr,Pn,Bi,nr,dr,Fo)}const Ro=Pn.positionedLines.length===1;if(Bo+=Dh(mt,Vt,Pn,Hr,Li,dr,Nt,wr,pn,ki.vertical?s.WritingMode.horizontal:s.WritingMode.horizontalOnly,Ro?Qh:[Lr],Jn,uu,Nr,pr),Ro)break}ki.vertical&&(Jh+=Dh(mt,Vt,ki.vertical,Hr,Li,dr,Nt,wr,pn,s.WritingMode.vertical,["vertical"],Jn,hu,Nr,pr));const pg=mn?mn.boxStartIndex:mt.collisionBoxArray.length,mg=mn?mn.boxEndIndex:mt.collisionBoxArray.length,gg=sn?sn.boxStartIndex:mt.collisionBoxArray.length,_g=sn?sn.boxEndIndex:mt.collisionBoxArray.length,yg=Wn?Wn.boxStartIndex:mt.collisionBoxArray.length,vg=Wn?Wn.boxEndIndex:mt.collisionBoxArray.length,xg=Wr?Wr.boxStartIndex:mt.collisionBoxArray.length,bg=Wr?Wr.boxEndIndex:mt.collisionBoxArray.length;let gn=-1;const Ql=(Lr,Pn)=>Lr&&Lr.circleDiameter?Math.max(Lr.circleDiameter,Pn):Pn;gn=Ql(mn,gn),gn=Ql(sn,gn),gn=Ql(Wn,gn),gn=Ql(Wr,gn);const $h=gn>-1?1:0;$h&&(gn*=nn/Qi),mt.glyphOffsetArray.length>=Ba.MAX_GLYPHS&&ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Nt.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,Nt.sortKey),mt.symbolInstances.emplaceBack(Vt.x,Vt.y,Jn.right>=0?Jn.right:-1,Jn.center>=0?Jn.center:-1,Jn.left>=0?Jn.left:-1,Jn.vertical||-1,uu,hu,Yh,pg,mg,gg,_g,yg,vg,xg,bg,rr,Bo,Jh,Dr,Kn,$h,0,Bi,fu,du,gn)}(i,vt,Ge,r,o,p,it,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,te,[ve,ve,ve,ve],lt,k,Te,Fe,ht,q,e,g,A,L,v)};if(tt==="line")for(const Ge of Ah(e.geometry,0,0,Oi,Oi)){const vt=Jm(Ge,pe,Re,r.vertical||Z,o,24,me,i.overscaling,Oi);for(const mt of vt){const Vt=Z;Vt&&ig(i,Vt.text,Ye,mt)||$e(Ge,mt)}}else if(tt==="line-center"){for(const Ge of e.geometry)if(Ge.length>1){const vt=Km(Ge,Re,r.vertical||Z,o,24,me);vt&&$e(Ge,vt)}}else if(e.type==="Polygon")for(const Ge of Nc(e.geometry,0)){const vt=$m(Ge,16);$e(Ge[0],new bs(vt.x,vt.y,0))}else if(e.type==="LineString")for(const Ge of e.geometry)$e(Ge,new bs(Ge[0].x,Ge[0].y,0));else if(e.type==="Point")for(const Ge of e.geometry)for(const vt of Ge)$e([vt],new bs(vt.x,vt.y,0))}const ws=32640;function Dh(i,e,r,o,p,g,v,T,k,A,L,F,j,q,Z){const re=function(Te,pe,ve,Fe,Re,lt,ht,tt){const Ye=Fe.layout.get("text-rotate").evaluate(lt,{})*Math.PI/180,We=[];for(const it of pe.positionedLines)for(const $e of it.positionedGlyphs){if(!$e.rect)continue;const Ge=$e.rect||{};let vt=4,mt=!0,Vt=1,_i=0;const ki=(Re||tt)&&$e.vertical,Vi=$e.metrics.advance*$e.scale/2;if(tt&&pe.verticalizable){const Ei=($e.scale-1)*Qi,Wi=(Qi-$e.metrics.width*$e.scale)/2;_i=it.lineOffset/2-($e.imageName?-Wi:Ei)}if($e.imageName){const Ei=ht[$e.imageName];mt=Ei.sdf,Vt=Ei.pixelRatio,vt=1/Vt}const Hr=Re?[$e.x+Vi,$e.y]:[0,0];let ir=Re?[0,0]:[$e.x+Vi+ve[0],$e.y+ve[1]-_i],Li=[0,0];ki&&(Li=ir,ir=[0,0]);const Hi=($e.metrics.left-vt)*$e.scale-Vi+ir[0],rr=(-$e.metrics.top-vt)*$e.scale+ir[1],fr=Hi+Ge.w*$e.scale/Vt,zr=rr+Ge.h*$e.scale/Vt,Bi=new xt(Hi,rr),nr=new xt(fr,rr),dr=new xt(Hi,zr),wr=new xt(fr,zr);if(ki){const Ei=new xt(-Vi,Vi-Nl),Wi=-Math.PI/2,Nt=12-Vi,Nr=new xt(22-Nt,-($e.imageName?Nt:0)),sr=new xt(...Li);Bi._rotateAround(Wi,Ei)._add(Nr)._add(sr),nr._rotateAround(Wi,Ei)._add(Nr)._add(sr),dr._rotateAround(Wi,Ei)._add(Nr)._add(sr),wr._rotateAround(Wi,Ei)._add(Nr)._add(sr)}if(Ye){const Ei=Math.sin(Ye),Wi=Math.cos(Ye),Nt=[Wi,-Ei,Ei,Wi];Bi._matMult(Nt),nr._matMult(Nt),dr._matMult(Nt),wr._matMult(Nt)}const Mr=new xt(0,0),Pr=new xt(0,0);We.push({tl:Bi,tr:nr,bl:dr,br:wr,tex:Ge,writingMode:pe.writingMode,glyphOffset:Hr,sectionIndex:$e.sectionIndex,isSDF:mt,pixelOffsetTL:Mr,pixelOffsetBR:Pr,minFontScaleX:0,minFontScaleY:0})}return We}(0,r,T,p,g,v,o,i.allowVerticalPlacement),te=i.textSizeData;let me=null;te.kind==="source"?(me=[Hn*p.layout.get("text-size").evaluate(v,{})],me[0]>ws&&ke(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):te.kind==="composite"&&(me=[Hn*q.compositeTextSizes[0].evaluate(v,{},Z),Hn*q.compositeTextSizes[1].evaluate(v,{},Z)],(me[0]>ws||me[1]>ws)&&ke(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,re,me,T,g,v,A,e,k.lineStartIndex,k.lineLength,j,Z);for(const Te of L)F[Te]=i.text.placedSymbolArray.length-1;return 4*re.length}function Lh(i){for(const e in i)return i[e];return null}function ig(i,e,r,o){const p=i.compareText;if(e in p){const g=p[e];for(let v=g.length-1;v>=0;v--)if(o.dist(g[v])<r)return!0}else p[e]=[];return p[e].push(o),!1}const rg=vs.VectorTileFeature.types,ng=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wl(i,e,r,o,p,g,v,T,k,A,L,F,j){const q=T?Math.min(ws,Math.round(T[0])):0,Z=T?Math.min(ws,Math.round(T[1])):0;i.emplaceBack(e,r,Math.round(32*o),Math.round(32*p),g,v,(q<<1)+(k?1:0),Z,16*A,16*L,256*F,256*j)}function tu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function sg(i){for(const e of i.sections)if(Tl(e.text))return!0;return!1}class iu{constructor(e){this.layoutVertexArray=new tn,this.indexArray=new vr,this.programConfigurations=e,this.segments=new Ut,this.dynamicLayoutVertexArray=new qr,this.opacityVertexArray=new rn,this.placedSymbolArray=new je}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,p){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Am.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ng,!0),this.opacityVertexBuffer.itemSize=1),(o||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ct("SymbolBuffers",iu);class ru{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new Ut,this.collisionVertexArray=new Vr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,zm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ct("CollisionBuffers",ru);class Ba{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(v=>v.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bc([]),this.placementViewportMatrix=Bc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Th(this.zoom,r["text-size"]),this.iconSizeData=Th(this.zoom,r["icon-size"]);const o=this.layers[0].layout,p=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=su(o,"text-overlap","text-allow-overlap")!=="never"||su(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(v=>s.WritingMode[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=e.sourceID}createArrays(){this.text=new iu(new $s(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new iu(new $s(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Je,this.lineVertexArray=new ot,this.symbolInstances=new nt}calculateGlyphDependencies(e,r,o,p,g){for(let v=0;v<e.length;v++)if(r[e.charCodeAt(v)]=!0,(o||p)&&g){const T=Mo[e.charAt(v)];T&&(r[T.charCodeAt(0)]=!0)}}populate(e,r,o){const p=this.layers[0],g=p.layout,v=g.get("text-font"),T=g.get("text-field"),k=g.get("icon-image"),A=(T.value.kind!=="constant"||T.value.value instanceof oe&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),L=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,F=g.get("symbol-sort-key");if(this.features=[],!A&&!L)return;const j=r.iconDependencies,q=r.glyphDependencies,Z=r.availableImages,re=new wi(this.zoom);for(const{feature:te,id:me,index:Te,sourceLayerIndex:pe}of e){const ve=p._featureFilter.needGeometry,Fe=ta(te,ve);if(!p._featureFilter.filter(re,Fe,o))continue;let Re,lt;if(ve||(Fe.geometry=ea(te)),A){const tt=p.getValueAndResolveTokens("text-field",Fe,o,Z),Ye=oe.factory(tt);sg(Ye)&&(this.hasRTLText=!0),(!this.hasRTLText||Js()==="unavailable"||this.hasRTLText&&Or.isParsed())&&(Re=Pm(Ye,p,Fe))}if(L){const tt=p.getValueAndResolveTokens("icon-image",Fe,o,Z);lt=tt instanceof fe?tt:fe.fromString(tt)}if(!Re&&!lt)continue;const ht=this.sortFeaturesByKey?F.evaluate(Fe,{},o):void 0;if(this.features.push({id:me,text:Re,icon:lt,index:Te,sourceLayerIndex:pe,geometry:Fe.geometry,properties:te.properties,type:rg[te.type],sortKey:ht}),lt&&(j[lt.name]=!0),Re){const tt=v.evaluate(Fe,{},o).join(","),Ye=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.WritingMode.vertical)>=0;for(const We of Re.sections)if(We.image)j[We.image.name]=!0;else{const it=Ta(Re.toString()),$e=We.fontStack||tt,Ge=q[$e]=q[$e]||{};this.calculateGlyphDependencies(We.text,Ge,Ye,this.allowVerticalPlacement,it)}}}g.get("symbol-placement")==="line"&&(this.features=function(te){const me={},Te={},pe=[];let ve=0;function Fe(tt){pe.push(te[tt]),ve++}function Re(tt,Ye,We){const it=Te[tt];return delete Te[tt],Te[Ye]=it,pe[it].geometry[0].pop(),pe[it].geometry[0]=pe[it].geometry[0].concat(We[0]),it}function lt(tt,Ye,We){const it=me[Ye];return delete me[Ye],me[tt]=it,pe[it].geometry[0].shift(),pe[it].geometry[0]=We[0].concat(pe[it].geometry[0]),it}function ht(tt,Ye,We){const it=We?Ye[0][Ye[0].length-1]:Ye[0][0];return`${tt}:${it.x}:${it.y}`}for(let tt=0;tt<te.length;tt++){const Ye=te[tt],We=Ye.geometry,it=Ye.text?Ye.text.toString():null;if(!it){Fe(tt);continue}const $e=ht(it,We),Ge=ht(it,We,!0);if($e in Te&&Ge in me&&Te[$e]!==me[Ge]){const vt=lt($e,Ge,We),mt=Re($e,Ge,pe[vt].geometry);delete me[$e],delete Te[Ge],Te[ht(it,pe[mt].geometry,!0)]=mt,pe[vt].geometry=null}else $e in Te?Re($e,Ge,We):Ge in me?lt($e,Ge,We):(Fe(tt),me[$e]=ve-1,Te[Ge]=ve-1)}return pe.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((te,me)=>te.sortKey-me.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(r[e.segment+1]),g=e.dist(r[e.segment]);const v={};for(let T=e.segment+1;T<r.length;T++)v[T]={x:r[T].x,y:r[T].y,tileUnitDistanceFromAnchor:p},T<r.length-1&&(p+=r[T+1].dist(r[T]));for(let T=e.segment||0;T>=0;T--)v[T]={x:r[T].x,y:r[T].y,tileUnitDistanceFromAnchor:g},T>0&&(g+=r[T-1].dist(r[T]));for(let T=0;T<r.length;T++){const k=v[T];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,p,g,v,T,k,A,L,F,j){const q=e.indexArray,Z=e.layoutVertexArray,re=e.segments.prepareSegment(4*r.length,Z,q,this.canOverlap?v.sortKey:void 0),te=this.glyphOffsetArray.length,me=re.vertexLength,Te=this.allowVerticalPlacement&&T===s.WritingMode.vertical?Math.PI/2:0,pe=v.text&&v.text.sections;for(let ve=0;ve<r.length;ve++){const{tl:Fe,tr:Re,bl:lt,br:ht,tex:tt,pixelOffsetTL:Ye,pixelOffsetBR:We,minFontScaleX:it,minFontScaleY:$e,glyphOffset:Ge,isSDF:vt,sectionIndex:mt}=r[ve],Vt=re.vertexLength,_i=Ge[1];Wl(Z,k.x,k.y,Fe.x,_i+Fe.y,tt.x,tt.y,o,vt,Ye.x,Ye.y,it,$e),Wl(Z,k.x,k.y,Re.x,_i+Re.y,tt.x+tt.w,tt.y,o,vt,We.x,Ye.y,it,$e),Wl(Z,k.x,k.y,lt.x,_i+lt.y,tt.x,tt.y+tt.h,o,vt,Ye.x,We.y,it,$e),Wl(Z,k.x,k.y,ht.x,_i+ht.y,tt.x+tt.w,tt.y+tt.h,o,vt,We.x,We.y,it,$e),tu(e.dynamicLayoutVertexArray,k,Te),q.emplaceBack(Vt,Vt+1,Vt+2),q.emplaceBack(Vt+1,Vt+2,Vt+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ge[0]),ve!==r.length-1&&mt===r[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,v,v.index,{},j,pe&&pe[mt])}e.placedSymbolArray.emplaceBack(k.x,k.y,te,this.glyphOffsetArray.length-te,me,A,L,k.segment,o?o[0]:0,o?o[1]:0,p[0],p[1],T,0,!1,0,F)}_addCollisionDebugVertex(e,r,o,p,g,v){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,p,g,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(e,r,o,p,g,v,T){const k=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),A=k.vertexLength,L=g.layoutVertexArray,F=g.collisionVertexArray,j=T.anchorX,q=T.anchorY;this._addCollisionDebugVertex(L,F,v,j,q,new xt(e,r)),this._addCollisionDebugVertex(L,F,v,j,q,new xt(o,r)),this._addCollisionDebugVertex(L,F,v,j,q,new xt(o,p)),this._addCollisionDebugVertex(L,F,v,j,q,new xt(e,p)),k.vertexLength+=4;const Z=g.indexArray;Z.emplaceBack(A,A+1),Z.emplaceBack(A+1,A+2),Z.emplaceBack(A+2,A+3),Z.emplaceBack(A+3,A),k.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,p){for(let g=e;g<r;g++){const v=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,p?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ru(zn,ch.members,fn),this.iconCollisionBox=new ru(zn,ch.members,fn);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,p,g,v,T,k,A){const L={};for(let F=r;F<o;F++){const j=e.get(F);L.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},L.textFeatureIndex=j.featureIndex;break}for(let F=p;F<g;F++){const j=e.get(F);L.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},L.verticalTextFeatureIndex=j.featureIndex;break}for(let F=v;F<T;F++){const j=e.get(F);L.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},L.iconFeatureIndex=j.featureIndex;break}for(let F=k;F<A;F++){const j=e.get(F);L.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},L.verticalIconFeatureIndex=j.featureIndex;break}return L}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),p=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<p;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),p=[],g=[],v=[];for(let T=0;T<this.symbolInstances.length;++T){v.push(T);const k=this.symbolInstances.get(T);p.push(0|Math.round(r*k.anchorX+o*k.anchorY)),g.push(k.featureIndex)}return v.sort((T,k)=>p[T]-p[k]||g[k]-g[T]),v}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((p,g,v)=>{p>=0&&v.indexOf(p)===g&&this.addIndicesForPlacedSymbol(this.text,p)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ct("SymbolBucket",Ba,{omit:["layers","collisionBoxArray","features","compareText"]}),Ba.MAX_GLYPHS=65535,Ba.addDynamicAttributes=tu;const ag=new Yi({"symbol-placement":new pt(De.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(De.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(De.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(De.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(De.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pt(De.layout_symbol["icon-allow-overlap"]),"icon-overlap":new pt(De.layout_symbol["icon-overlap"]),"icon-ignore-placement":new pt(De.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(De.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(De.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(De.layout_symbol["icon-size"]),"icon-text-fit":new pt(De.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pt(De.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(De.layout_symbol["icon-image"]),"icon-rotate":new Tt(De.layout_symbol["icon-rotate"]),"icon-padding":new Tt(De.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(De.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(De.layout_symbol["icon-offset"]),"icon-anchor":new Tt(De.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(De.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(De.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(De.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(De.layout_symbol["text-field"]),"text-font":new Tt(De.layout_symbol["text-font"]),"text-size":new Tt(De.layout_symbol["text-size"]),"text-max-width":new Tt(De.layout_symbol["text-max-width"]),"text-line-height":new pt(De.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(De.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(De.layout_symbol["text-justify"]),"text-radial-offset":new Tt(De.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(De.layout_symbol["text-variable-anchor"]),"text-anchor":new Tt(De.layout_symbol["text-anchor"]),"text-max-angle":new pt(De.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(De.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(De.layout_symbol["text-rotate"]),"text-padding":new pt(De.layout_symbol["text-padding"]),"text-keep-upright":new pt(De.layout_symbol["text-keep-upright"]),"text-transform":new Tt(De.layout_symbol["text-transform"]),"text-offset":new Tt(De.layout_symbol["text-offset"]),"text-allow-overlap":new pt(De.layout_symbol["text-allow-overlap"]),"text-overlap":new pt(De.layout_symbol["text-overlap"]),"text-ignore-placement":new pt(De.layout_symbol["text-ignore-placement"]),"text-optional":new pt(De.layout_symbol["text-optional"])});var nu={paint:new Yi({"icon-opacity":new Tt(De.paint_symbol["icon-opacity"]),"icon-color":new Tt(De.paint_symbol["icon-color"]),"icon-halo-color":new Tt(De.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(De.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(De.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(De.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(De.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tt(De.paint_symbol["text-opacity"]),"text-color":new Tt(De.paint_symbol["text-color"],{runtimeType:Ji,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Tt(De.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(De.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(De.paint_symbol["text-halo-blur"]),"text-translate":new pt(De.paint_symbol["text-translate"]),"text-translate-anchor":new pt(De.paint_symbol["text-translate-anchor"])}),layout:ag};class Bh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:wn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ct("FormatSectionOverride",Bh,{omit:["defaultValue"]});class Kl extends en{constructor(e){super(e,nu)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const p=[];for(const g of o)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,p){const g=this.layout.get(e).evaluate(r,{},o,p),v=this._unevaluatedLayout._values[e];return v.isDataDriven()||Fs(v.value)||!g?g:function(T,k){return k.replace(/{([^{}]+)}/g,(A,L)=>L in T?String(T[L]):"")}(r.properties,g)}createBucket(e){return new Ba(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of nu.paint.overridableProperties){if(!Kl.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new Bh(r),p=new _a(o,r.property.specification);let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new Vs("source",p):new no("composite",p,r.value.zoomStops),this.paint._values[e]=new $r(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Kl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),p=nu.paint.properties[r];let g=!1;const v=T=>{for(const k of T)if(p.overrides&&p.overrides.hasOverride(k))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof oe)v(o.value.value.sections);else if(o.value.kind==="source"){const T=A=>{g||(A instanceof ft&&Ie(A.value)===ji?v(A.value.sections):A instanceof ma?v(A.sections):A.eachChild(T))},k=o.value;k._styleExpression&&T(k._styleExpression.expression)}return g}}function su(i,e,r){let o="never";const p=i.get(e);return p?o=p:i.get(r)&&(o="always"),o}var og={paint:new Yi({"background-color":new pt(De.paint_background["background-color"]),"background-pattern":new _o(De.paint_background["background-pattern"]),"background-opacity":new pt(De.paint_background["background-opacity"])})},lg={paint:new Yi({"raster-opacity":new pt(De.paint_raster["raster-opacity"]),"raster-hue-rotate":new pt(De.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(De.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(De.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(De.paint_raster["raster-saturation"]),"raster-contrast":new pt(De.paint_raster["raster-contrast"]),"raster-resampling":new pt(De.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(De.paint_raster["raster-fade-duration"])})};class cg extends en{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const ug={circle:class extends en{constructor(i){super(i,Np)}createBucket(i){return new Pc(i)}queryRadius(i){const e=i;return wo("circle-radius",this,e)+wo("circle-stroke-width",this,e)+Pl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,o,p,g,v,T){const k=Dl(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,v),A=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),L=this.paint.get("circle-pitch-alignment")==="map",F=L?k:function(q,Z){return q.map(re=>Xu(re,Z))}(k,T),j=L?A*v:A;for(const q of o)for(const Z of q){const re=L?Z:Xu(Z,T);let te=j;const me=Ll([],[Z.x,Z.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?te*=me[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(te*=g.cameraToCenterDistance/me[3]),Rp(F,re,te))return!0}return!1}},heatmap:class extends en{constructor(i){super(i,Gp),this._updateColorRamp()}createBucket(i){return new Hu(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ku({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends en{constructor(i){super(i,qp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends en{constructor(i){super(i,am)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new qc(i)}queryRadius(){return Pl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,o,p,g,v){return Ou(Dl(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,v),o)}isTileClipped(){return!0}},"fill-extrusion":class extends en{constructor(i){super(i,xm)}createBucket(i){return new Xc(i)}queryRadius(){return Pl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,o,p,g,v,T){const k=Dl(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,v),A=this.paint.get("fill-extrusion-height").evaluate(e,r),L=this.paint.get("fill-extrusion-base").evaluate(e,r),F=function(q,Z,re,te){const me=[];for(const Te of q){const pe=[Te.x,Te.y,0,1];Ll(pe,pe,Z),me.push(new xt(pe[0]/pe[3],pe[1]/pe[3]))}return me}(k,T),j=function(q,Z,re,te){const me=[],Te=[],pe=te[8]*Z,ve=te[9]*Z,Fe=te[10]*Z,Re=te[11]*Z,lt=te[8]*re,ht=te[9]*re,tt=te[10]*re,Ye=te[11]*re;for(const We of q){const it=[],$e=[];for(const Ge of We){const vt=Ge.x,mt=Ge.y,Vt=te[0]*vt+te[4]*mt+te[12],_i=te[1]*vt+te[5]*mt+te[13],ki=te[2]*vt+te[6]*mt+te[14],Vi=te[3]*vt+te[7]*mt+te[15],Hr=ki+Fe,ir=Vi+Re,Li=Vt+lt,Hi=_i+ht,rr=ki+tt,fr=Vi+Ye,zr=new xt((Vt+pe)/ir,(_i+ve)/ir);zr.z=Hr/ir,it.push(zr);const Bi=new xt(Li/fr,Hi/fr);Bi.z=rr/fr,$e.push(Bi)}me.push(it),Te.push($e)}return[me,Te]}(o,L,A,T);return function(q,Z,re){let te=1/0;Ou(re,Z)&&(te=nh(re,Z[0]));for(let me=0;me<Z.length;me++){const Te=Z[me],pe=q[me];for(let ve=0;ve<Te.length-1;ve++){const Fe=Te[ve],Re=[Fe,Te[ve+1],pe[ve+1],pe[ve],Fe];Fu(re,Re)&&(te=Math.min(te,nh(re,Re)))}}return te!==1/0&&te}(j[0],j[1],F)}},line:class extends en{constructor(i){super(i,ah),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ps,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=oh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Hc(i)}queryRadius(i){const e=i,r=lh(wo("line-width",this,e),wo("line-gap-width",this,e)),o=wo("line-offset",this,e);return r/2+Math.abs(o)+Pl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,o,p,g,v){const T=Dl(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,v),k=v/2*lh(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),A=this.paint.get("line-offset").evaluate(e,r);return A&&(o=function(L,F){const j=[];for(let q=0;q<L.length;q++){const Z=L[q],re=[];for(let te=0;te<Z.length;te++){const me=Z[te-1],Te=Z[te],pe=Z[te+1],ve=te===0?new xt(0,0):Te.sub(me)._unit()._perp(),Fe=te===Z.length-1?new xt(0,0):pe.sub(Te)._unit()._perp(),Re=ve._add(Fe)._unit(),lt=Re.x*Fe.x+Re.y*Fe.y;lt!==0&&Re._mult(1/lt),re.push(Re._mult(F)._add(Te))}j.push(re)}return j}(o,A*v)),function(L,F,j){for(let q=0;q<F.length;q++){const Z=F[q];if(L.length>=3){for(let re=0;re<Z.length;re++)if(Ca(L,Z[re]))return!0}if(Fp(L,Z,j))return!0}return!1}(T,o,k)}isTileClipped(){return!0}},symbol:Kl,background:class extends en{constructor(i){super(i,og)}},raster:class extends en{constructor(i){super(i,lg)}}};class hg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Rh=63710088e-1;class Ci{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ci(V(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,p=e.lat*r,g=Math.sin(o)*Math.sin(p)+Math.cos(o)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return Rh*Math.acos(Math.min(g,1))}toBounds(e=0){const r=360*e/40075017,o=r/Math.cos(Math.PI/180*this.lat);return new ra(new Ci(this.lng-o,this.lat-r),new Ci(this.lng+o,this.lat+r))}static convert(e){if(e instanceof Ci)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ci(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ci(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ra{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ci?new Ci(e.lng,e.lat):Ci.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ci?new Ci(e.lng,e.lat):Ci.convert(e),this}extend(e){const r=this._sw,o=this._ne;let p,g;if(e instanceof Ci)p=e,g=e;else{if(!(e instanceof ra))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ra.convert(e)):this.extend(Ci.convert(e)):this;if(p=e._sw,g=e._ne,!p||!g)return this}return r||o?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),o.lng=Math.max(g.lng,o.lng),o.lat=Math.max(g.lat,o.lat)):(this._sw=new Ci(p.lng,p.lat),this._ne=new Ci(g.lng,g.lat)),this}getCenter(){return new Ci((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ci(this.getWest(),this.getNorth())}getSouthEast(){return new Ci(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:o}=Ci.convert(e);let p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&p}static convert(e){return e instanceof ra?e:e&&new ra(e)}}const Fh=2*Math.PI*Rh;function Oh(i){return Fh*Math.cos(i*Math.PI/180)}function Vh(i){return(180+i)/360}function Uh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Nh(i,e){return i/Oh(e)}function au(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Jl{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=Ci.convert(e);return new Jl(Vh(o.lng),Uh(o.lat),Nh(r,o.lat))}toLngLat(){return new Ci(360*this.x-180,au(this.y))}toAltitude(){return this.z*Oh(au(this.y))}meterInMercatorCoordinateUnits(){return 1/Fh*(e=au(this.y),1/Math.cos(e*Math.PI/180));var e}}function jh(i,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class ou{constructor(e,r,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=Do(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const p=(v=this.y,T=this.z,k=jh(256*(g=this.x),256*(v=Math.pow(2,T)-v-1),T),A=jh(256*(g+1),256*(v+1),T),k[0]+","+k[1]+","+A[0]+","+A[1]);var g,v,T,k,A;const L=function(F,j,q){let Z,re="";for(let te=F;te>0;te--)Z=1<<te-1,re+=(j&Z?1:0)+(q&Z?2:0);return re}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,p)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new xt((e.x*r-this.x)*Oi,(e.y*r-this.y)*Oi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gh{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Do(e,r.z,r.z,r.x,r.y)}}class Xr{constructor(e,r,o,p,g){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new ou(o,+p,+g),this.key=Do(r,e,o,p,g)}clone(){return new Xr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Xr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Do(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Do(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Xr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,p=2*this.canonical.y;return[new Xr(r,this.wrap,r,o,p),new Xr(r,this.wrap,r,o+1,p),new Xr(r,this.wrap,r,o,p+1),new Xr(r,this.wrap,r,o+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Xr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Xr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Jl(e.x-this.wrap,e.y))}}function Do(i,e,r,o,p){(i*=2)<0&&(i=-1*i-1);const g=1<<r;return(g*g*i+g*p+o).toString(36)+r.toString(36)+e.toString(36)}ct("CanonicalTileID",ou),ct("OverscaledTileID",Xr,{omit:["posMatrix"]});class qh{constructor(e,r,o){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void ke(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=o||"mapbox";for(let g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let g=0;g<p;g++)for(let v=0;v<p;v++){const T=this.get(g,v);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(e,r){const o=new Uint8Array(this.data.buffer),p=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(o[p],o[p+1],o[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,o){return(256*e*256+256*r+o)/10-1e4}_unpackTerrarium(e,r,o){return 256*e+r+o/256-32768}getPixels(){return new Zr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,g=r*this.dim+this.dim,v=o*this.dim,T=o*this.dim+this.dim;switch(r){case-1:p=g-1;break;case 1:g=p+1}switch(o){case-1:v=T-1;break;case 1:T=v+1}const k=-r*this.dim,A=-o*this.dim;for(let L=v;L<T;L++)for(let F=p;F<g;F++)this.data[this._idx(F,L)]=e.data[this._idx(F+k,L+A)]}}ct("DEMData",qh);class Zh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Xh{constructor(e,r,o,p,g){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=o,e._y=p,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Hh{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ks(Oi,16,0),this.grid3D=new Ks(Oi,16,0),this.featureIndexArray=new Ot,this.promoteId=r}insert(e,r,o,p,g,v){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,p,g);const k=v?this.grid3D:this.grid;for(let A=0;A<r.length;A++){const L=r[A],F=[1/0,1/0,-1/0,-1/0];for(let j=0;j<L.length;j++){const q=L[j];F[0]=Math.min(F[0],q.x),F[1]=Math.min(F[1],q.y),F[2]=Math.max(F[2],q.x),F[3]=Math.max(F[3],q.y)}F[0]<Oi&&F[1]<Oi&&F[2]>=0&&F[3]>=0&&k.insert(T,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new vs.VectorTile(new Wc(this.rawTileData)).layers,this.sourceLayerCoder=new Zh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,o,p){this.loadVTLayers();const g=e.params||{},v=Oi/e.tileSize/e.scale,T=xa(g.filter),k=e.queryGeometry,A=e.queryPadding*v,L=Kh(k),F=this.grid.query(L.minX-A,L.minY-A,L.maxX+A,L.maxY+A),j=Kh(e.cameraQueryGeometry),q=this.grid3D.query(j.minX-A,j.minY-A,j.maxX+A,j.maxY+A,(te,me,Te,pe)=>function(ve,Fe,Re,lt,ht){for(const Ye of ve)if(Fe<=Ye.x&&Re<=Ye.y&&lt>=Ye.x&&ht>=Ye.y)return!0;const tt=[new xt(Fe,Re),new xt(Fe,ht),new xt(lt,ht),new xt(lt,Re)];if(ve.length>2){for(const Ye of tt)if(Ca(ve,Ye))return!0}for(let Ye=0;Ye<ve.length-1;Ye++)if(Vp(ve[Ye],ve[Ye+1],tt))return!0;return!1}(e.cameraQueryGeometry,te-A,me-A,Te+A,pe+A));for(const te of q)F.push(te);F.sort(fg);const Z={};let re;for(let te=0;te<F.length;te++){const me=F[te];if(me===re)continue;re=me;const Te=this.featureIndexArray.get(me);let pe=null;this.loadMatchingFeature(Z,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,T,g.layers,g.availableImages,r,o,p,(ve,Fe,Re)=>(pe||(pe=ea(ve)),Fe.queryIntersectsFeature(k,ve,Re,pe,this.z,e.transform,v,e.pixelPosMatrix)))}return Z}loadMatchingFeature(e,r,o,p,g,v,T,k,A,L,F){const j=this.bucketLayerIDs[r];if(v&&!function(te,me){for(let Te=0;Te<te.length;Te++)if(me.indexOf(te[Te])>=0)return!0;return!1}(v,j))return;const q=this.sourceLayerCoder.decode(o),Z=this.vtLayers[q].feature(p);if(g.needGeometry){const te=ta(Z,!0);if(!g.filter(new wi(this.tileID.overscaledZ),te,this.tileID.canonical))return}else if(!g.filter(new wi(this.tileID.overscaledZ),Z))return;const re=this.getId(Z,q);for(let te=0;te<j.length;te++){const me=j[te];if(v&&v.indexOf(me)<0)continue;const Te=k[me];if(!Te)continue;let pe={};re&&L&&(pe=L.getState(Te.sourceLayer||"_geojsonTileLayer",re));const ve=N({},A[me]);ve.paint=Wh(ve.paint,Te.paint,Z,pe,T),ve.layout=Wh(ve.layout,Te.layout,Z,pe,T);const Fe=!F||F(Z,Te,pe);if(!Fe)continue;const Re=new Xh(Z,this.z,this.x,this.y,re);Re.layer=ve;let lt=e[me];lt===void 0&&(lt=e[me]=[]),lt.push({featureIndex:p,feature:Re,intersectionZ:Fe})}}lookupSymbolFeatures(e,r,o,p,g,v,T,k){const A={};this.loadVTLayers();const L=xa(g);for(const F of e)this.loadMatchingFeature(A,o,p,F,L,v,T,k,r);return A}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof o=="boolean"&&(o=Number(o))),o}}function Wh(i,e,r,o,p){return ce(i,(g,v)=>{const T=e instanceof Qs?e.get(v):null;return T&&T.evaluate?T.evaluate(r,o,p):T})}function Kh(i){let e=1/0,r=1/0,o=-1/0,p=-1/0;for(const g of i)e=Math.min(e,g.x),r=Math.min(r,g.y),o=Math.max(o,g.x),p=Math.max(p,g.y);return{minX:e,minY:r,maxX:o,maxY:p}}function fg(i,e){return e-i}var lu;ct("FeatureIndex",Hh,{omit:["rawTileData","sourceLayerCoder"]}),s.PerformanceMarkers=void 0,(lu=s.PerformanceMarkers||(s.PerformanceMarkers={})).create="create",lu.load="load",lu.fullLoad="fullLoad";let Yl=null,Lo=[];const cu=1e3/30,dg={mark(i){performance.mark(i)},frame(i){const e=i;Yl!=null&&Lo.push(e-Yl),Yl=e},clearMetrics(){Yl=null,Lo=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in s.PerformanceMarkers)performance.clearMarks(s.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",s.PerformanceMarkers.create,s.PerformanceMarkers.load),performance.measure("fullLoadTime",s.PerformanceMarkers.create,s.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=Lo.length,o=1/(Lo.reduce((g,v)=>g+v,0)/r/1e3),p=Lo.filter(g=>g>cu).reduce((g,v)=>g+(v-cu)/cu,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:p/(r+p)*100}}};s.AJAXError=kr,s.ARRAY_TYPE=br,s.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},K(["receive","process"],this),this.invoker=new hg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ne()?i:window}send(i,e,r,o,p=!1){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[g]=r);const v=ni(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:i,hasCallback:!!r,targetMapId:o,mustQueue:p,sourceMapId:this.mapId,data:Un(e,v)},v),{cancel:()=>{r&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const o=this.cancelCallbacks[r];delete this.cancelCallbacks[r],o&&o()}else Ne()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(En(e.error)):r(null,En(e.data)))}else{let r=!1;const o=ni(this.globalScope)?void 0:[],p=e.hasCallback?(T,k)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:T?Un(T):null,data:Un(k,o)},o)}:T=>{r=!0};let g=null;const v=En(e.data);if(this.parent[e.type])g=this.parent[e.type](e.sourceMapId,v,p);else if(this.parent.getWorkerSource){const T=e.type.split(".");g=this.parent.getWorkerSource(e.sourceMapId,T[0],v.source)[T[1]](v,p)}else p(new Error(`Could not find function ${e.type}`));!r&&g&&g.cancel&&(this.cancelCallbacks[i]=g.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.AlphaImage=ko,s.CanonicalTileID=ou,s.CollisionBoxArray=Me,s.CollisionCircleLayoutArray=class extends B{},s.Color=W,s.DEMData=qh,s.DataConstantProperty=pt,s.DictionaryCoder=Zh,s.EXTENT=Oi,s.ErrorEvent=ts,s.EvaluationParameters=wi,s.Event=on,s.Evented=ln,s.FeatureIndex=Hh,s.FillBucket=qc,s.FillExtrusionBucket=Xc,s.GeoJSONFeature=Xh,s.ImageAtlas=_h,s.ImagePosition=Jc,s.LineBucket=Hc,s.LineStripIndexArray=class extends ee{},s.LngLat=Ci,s.LngLatBounds=ra,s.MercatorCoordinate=Jl,s.ONE_EM=Qi,s.OverscaledTileID=Xr,s.PerformanceUtils=dg,s.PosArray=yt,s.Properties=Yi,s.QuadTriangleArray=class extends G{},s.RGBAImage=Zr,s.RasterBoundsArray=class extends f{},s.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},s.ResourceType=Rr,s.SegmentVector=Ut,s.SymbolBucket=Ba,s.Transitionable=Sl,s.TriangleIndexArray=vr,s.Uniform1f=qn,s.Uniform1i=class extends Gn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.Uniform2f=class extends Gn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.Uniform3f=class extends Gn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.Uniform4f=Sa,s.UniformColor=Du,s.UniformMatrix4f=class extends Gn{constructor(i,e){super(i,e),this.current=Lp}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.UnwrappedTileID=Gh,s.ValidationError=Qe,s.ZoomHistory=lo,s.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},s.addDynamicAttributes=tu,s.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let o=i.length;const p=new Array(i.length);let g=null;i.forEach((v,T)=>{e(v,(k,A)=>{k&&(g=k),p[T]=A,--o==0&&r(g,p)})})},s.bezier=I,s.bindAll=K,s.cacheEntryPossiblyAdded=function(i){Ki++,Ki>ur&&(i.getActor().send("enforceCacheSizeLimit",Ai),Ki=0)},s.clamp=z,s.clearTileCache=function(i){const e=caches.delete(Lt);i&&e.catch(i).then(()=>i())},s.clipLine=Ah,s.clone=function(i){var e=new br(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.clone$1=Be,s.clone$2=function(i){var e=new br(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},s.collisionCircleLayout=Mm,s.config=Si,s.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.create=function(){var i=new br(16);return br!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=Nu,s.createExpression=Os,s.createFilter=xa,s.createLayout=Di,s.createStyleLayer=function(i){return i.type==="custom"?new cg(i):new ug[i.type](i)},s.cross=function(i,e,r){var o=e[0],p=e[1],g=e[2],v=r[0],T=r[1],k=r[2];return i[0]=p*k-g*T,i[1]=g*v-o*k,i[2]=o*T-p*v,i},s.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},s.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},s.ease=P,s.emitValidationErrors=wa,s.enforceCacheSizeLimit=function(i){Ui(),Ri&&Ri.then(e=>{e.keys().then(r=>{for(let o=0;o<r.length-i;o++)e.delete(r[o])})})},s.equals=function(i,e){var r=i[0],o=i[1],p=i[2],g=i[3],v=i[4],T=i[5],k=i[6],A=i[7],L=i[8],F=i[9],j=i[10],q=i[11],Z=i[12],re=i[13],te=i[14],me=i[15],Te=e[0],pe=e[1],ve=e[2],Fe=e[3],Re=e[4],lt=e[5],ht=e[6],tt=e[7],Ye=e[8],We=e[9],it=e[10],$e=e[11],Ge=e[12],vt=e[13],mt=e[14],Vt=e[15];return Math.abs(r-Te)<=xr*Math.max(1,Math.abs(r),Math.abs(Te))&&Math.abs(o-pe)<=xr*Math.max(1,Math.abs(o),Math.abs(pe))&&Math.abs(p-ve)<=xr*Math.max(1,Math.abs(p),Math.abs(ve))&&Math.abs(g-Fe)<=xr*Math.max(1,Math.abs(g),Math.abs(Fe))&&Math.abs(v-Re)<=xr*Math.max(1,Math.abs(v),Math.abs(Re))&&Math.abs(T-lt)<=xr*Math.max(1,Math.abs(T),Math.abs(lt))&&Math.abs(k-ht)<=xr*Math.max(1,Math.abs(k),Math.abs(ht))&&Math.abs(A-tt)<=xr*Math.max(1,Math.abs(A),Math.abs(tt))&&Math.abs(L-Ye)<=xr*Math.max(1,Math.abs(L),Math.abs(Ye))&&Math.abs(F-We)<=xr*Math.max(1,Math.abs(F),Math.abs(We))&&Math.abs(j-it)<=xr*Math.max(1,Math.abs(j),Math.abs(it))&&Math.abs(q-$e)<=xr*Math.max(1,Math.abs(q),Math.abs($e))&&Math.abs(Z-Ge)<=xr*Math.max(1,Math.abs(Z),Math.abs(Ge))&&Math.abs(re-vt)<=xr*Math.max(1,Math.abs(re),Math.abs(vt))&&Math.abs(te-mt)<=xr*Math.max(1,Math.abs(te),Math.abs(mt))&&Math.abs(me-Vt)<=xr*Math.max(1,Math.abs(me),Math.abs(Vt))},s.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:p}){return i.kind==="source"?o/Hn:i.kind==="composite"?xi(o/Hn,p/Hn,r):e},s.evaluateSizeForZoom=function(i,e){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:v}=i,T=p?z(Ir.interpolationFactor(p,e,g,v),0,1):0;i.kind==="camera"?o=xi(i.minSize,i.maxSize,T):r=T}return{uSizeT:r,uSize:o}},s.evaluateVariableOffset=Ph,s.evented=go,s.exported=ti,s.exported$1=gr,s.extend=N,s.filterObject=ae,s.fromRotation=function(i,e){var r=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=r,i[2]=0,i[3]=-r,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.getAnchorAlignment=Qc,s.getAnchorJustification=eu,s.getArrayBuffer=es,s.getImage=bn,s.getJSON=function(i,e){return $n(N(i,{type:"json"}),e)},s.getOverlapMode=su,s.getRTLTextPluginStatus=Js,s.getReferrer=Is,s.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let o=0;o<i.length;o++){const p=window.document.createElement("source");Cs(i[o])||(r.crossOrigin="Anonymous"),p.src=i[o],r.appendChild(p)}return{cancel:()=>{}}},s.identity=Bc,s.invert=function(i,e){var r=e[0],o=e[1],p=e[2],g=e[3],v=e[4],T=e[5],k=e[6],A=e[7],L=e[8],F=e[9],j=e[10],q=e[11],Z=e[12],re=e[13],te=e[14],me=e[15],Te=r*T-o*v,pe=r*k-p*v,ve=r*A-g*v,Fe=o*k-p*T,Re=o*A-g*T,lt=p*A-g*k,ht=L*re-F*Z,tt=L*te-j*Z,Ye=L*me-q*Z,We=F*te-j*re,it=F*me-q*re,$e=j*me-q*te,Ge=Te*$e-pe*it+ve*We+Fe*Ye-Re*tt+lt*ht;return Ge?(i[0]=(T*$e-k*it+A*We)*(Ge=1/Ge),i[1]=(p*it-o*$e-g*We)*Ge,i[2]=(re*lt-te*Re+me*Fe)*Ge,i[3]=(j*Re-F*lt-q*Fe)*Ge,i[4]=(k*Ye-v*$e-A*tt)*Ge,i[5]=(r*$e-p*Ye+g*tt)*Ge,i[6]=(te*ve-Z*lt-me*pe)*Ge,i[7]=(L*lt-j*ve+q*pe)*Ge,i[8]=(v*it-T*Ye+A*ht)*Ge,i[9]=(o*Ye-r*it-g*ht)*Ge,i[10]=(Z*Re-re*ve+me*Te)*Ge,i[11]=(F*ve-L*Re-q*Te)*Ge,i[12]=(T*tt-v*We-k*ht)*Ge,i[13]=(r*We-o*tt+p*ht)*Ge,i[14]=(re*pe-Z*Fe-te*Te)*Ge,i[15]=(L*Fe-F*pe+j*Te)*Ge,i):null},s.isImageBitmap=er,s.isSafari=ni,s.isWorker=Ne,s.keysDifference=function(i,e){const r=[];for(const o in i)o in e||r.push(o);return r},s.lazyLoadRTLTextPlugin=function(){Or.isLoading()||Or.isLoaded()||Js()!=="deferred"||El()},s.makeRequest=$n,s.mapObject=ce,s.mercatorXfromLng=Vh,s.mercatorYfromLat=Uh,s.mercatorZfromAltitude=Nh,s.mul=jp,s.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},s.multiply=ju,s.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},s.normalize=function(i,e){var r=e[0],o=e[1],p=e[2],g=r*r+o*o+p*p;return g>0&&(g=1/Math.sqrt(g)),i[0]=e[0]*g,i[1]=e[1]*g,i[2]=e[2]*g,i},s.number=xi,s.ortho=function(i,e,r,o,p,g,v){var T=1/(e-r),k=1/(o-p),A=1/(g-v);return i[0]=-2*T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*k,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*A,i[11]=0,i[12]=(e+r)*T,i[13]=(p+o)*k,i[14]=(v+g)*A,i[15]=1,i},s.parseCacheControl=Ct,s.parseGlyphPbf=function(i){return new Wc(i).readFields(jm,[])},s.pbf=Wc,s.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Oi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,o={layoutIconSize:r["icon-size"].possiblyEvaluate(new wi(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new wi(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new wi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:A}=i.bucket.textSizeData;o.compositeTextSizes=[r["text-size"].possiblyEvaluate(new wi(k),i.canonical),r["text-size"].possiblyEvaluate(new wi(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:A}=i.bucket.iconSizeData;o.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new wi(k),i.canonical),r["icon-size"].possiblyEvaluate(new wi(A),i.canonical)]}const p=e.get("text-line-height")*Qi,g=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",v=e.get("text-keep-upright"),T=e.get("text-size");for(const k of i.bucket.features){const A=e.get("text-font").evaluate(k,{},i.canonical).join(","),L=T.evaluate(k,{},i.canonical),F=o.layoutTextSize.evaluate(k,{},i.canonical),j=o.layoutIconSize.evaluate(k,{},i.canonical),q={horizontal:{},vertical:void 0},Z=k.text;let re,te=[0,0];if(Z){const pe=Z.toString(),ve=e.get("text-letter-spacing").evaluate(k,{},i.canonical)*Qi,Fe=Ic(pe)?ve:0,Re=e.get("text-anchor").evaluate(k,{},i.canonical),lt=e.get("text-variable-anchor");if(!lt){const it=e.get("text-radial-offset").evaluate(k,{},i.canonical);te=it?Ph(Re,[it*Qi,$c]):e.get("text-offset").evaluate(k,{},i.canonical).map($e=>$e*Qi)}let ht=g?"center":e.get("text-justify").evaluate(k,{},i.canonical);const tt=e.get("symbol-placement"),Ye=tt==="point"?e.get("text-max-width").evaluate(k,{},i.canonical)*Qi:0,We=()=>{i.bucket.allowVerticalPlacement&&Ta(pe)&&(q.vertical=jl(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,Ye,p,Re,"left",Fe,te,s.WritingMode.vertical,!0,tt,F,L))};if(!g&&lt){const it=ht==="auto"?lt.map(Ge=>eu(Ge)):[ht];let $e=!1;for(let Ge=0;Ge<it.length;Ge++){const vt=it[Ge];if(!q.horizontal[vt])if($e)q.horizontal[vt]=q.horizontal[0];else{const mt=jl(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,Ye,p,"center",vt,Fe,te,s.WritingMode.horizontal,!1,tt,F,L);mt&&(q.horizontal[vt]=mt,$e=mt.positionedLines.length===1)}}We()}else{ht==="auto"&&(ht=eu(Re));const it=jl(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,Ye,p,Re,ht,Fe,te,s.WritingMode.horizontal,!1,tt,F,L);it&&(q.horizontal[ht]=it),We(),Ta(pe)&&g&&v&&(q.vertical=jl(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,Ye,p,Re,ht,Fe,te,s.WritingMode.vertical,!1,tt,F,L))}}let me=!1;if(k.icon&&k.icon.name){const pe=i.imageMap[k.icon.name];pe&&(re=Wm(i.imagePositions[k.icon.name],e.get("icon-offset").evaluate(k,{},i.canonical),e.get("icon-anchor").evaluate(k,{},i.canonical)),me=!!pe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=me:i.bucket.sdfIcons!==me&&ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pe.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Te=Lh(q.horizontal)||q.vertical;i.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||re)&&tg(i.bucket,k,q,re,i.imageMap,o,F,j,te,me,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},s.perspective=function(i,e,r,o,p){var g,v=1/Math.tan(e/2);return i[0]=v/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+o)*(g=1/(o-p)),i[14]=2*p*o*g):(i[10]=-1,i[14]=-2*o),i},s.pick=function(i,e){const r={};for(let o=0;o<e.length;o++){const p=e[o];p in i&&(r[p]=i[p])}return r},s.plugin=Or,s.pointGeometry=xt,s.polygonIntersectsPolygon=Fu,s.potpack=gh,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=ct,s.registerForPluginStateChange=function(i){return i({pluginStatus:yr,pluginURL:Sn}),go.on("pluginStateChange",i),i},s.renderColorRamp=Ku,s.rotateX=function(i,e,r){var o=Math.sin(r),p=Math.cos(r),g=e[4],v=e[5],T=e[6],k=e[7],A=e[8],L=e[9],F=e[10],j=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=g*p+A*o,i[5]=v*p+L*o,i[6]=T*p+F*o,i[7]=k*p+j*o,i[8]=A*p-g*o,i[9]=L*p-v*o,i[10]=F*p-T*o,i[11]=j*p-k*o,i},s.rotateZ=function(i,e,r){var o=Math.sin(r),p=Math.cos(r),g=e[0],v=e[1],T=e[2],k=e[3],A=e[4],L=e[5],F=e[6],j=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=g*p+A*o,i[1]=v*p+L*o,i[2]=T*p+F*o,i[3]=k*p+j*o,i[4]=A*p-g*o,i[5]=L*p-v*o,i[6]=F*p-T*o,i[7]=j*p-k*o,i},s.scale=function(i,e,r){var o=r[0],p=r[1],g=r[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*g,i[9]=e[9]*g,i[10]=e[10]*g,i[11]=e[11]*g,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},s.setCacheLimits=function(i,e){Ai=i,ur=e},s.setRTLTextPlugin=function(i,e,r=!1){if(yr===ho||yr===fo||yr===po)throw new Error("setRTLTextPlugin cannot be called multiple times.");Sn=ti.resolveURL(i),yr=ho,mo=e,ms(),r||El()},s.spec=De,s.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},s.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},s.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},s.toEvaluationFeature=ta,s.transformMat3=function(i,e,r){var o=e[0],p=e[1],g=e[2];return i[0]=o*r[0]+p*r[3]+g*r[6],i[1]=o*r[1]+p*r[4]+g*r[7],i[2]=o*r[2]+p*r[5]+g*r[8],i},s.transformMat4=Ll,s.transformMat4$1=function(i,e,r){var o=e[0],p=e[1];return i[0]=r[0]*o+r[4]*p+r[12],i[1]=r[1]*o+r[5]*p+r[13],i},s.translate=function(i,e,r){var o,p,g,v,T,k,A,L,F,j,q,Z,re=r[0],te=r[1],me=r[2];return e===i?(i[12]=e[0]*re+e[4]*te+e[8]*me+e[12],i[13]=e[1]*re+e[5]*te+e[9]*me+e[13],i[14]=e[2]*re+e[6]*te+e[10]*me+e[14],i[15]=e[3]*re+e[7]*te+e[11]*me+e[15]):(p=e[1],g=e[2],v=e[3],T=e[4],k=e[5],A=e[6],L=e[7],F=e[8],j=e[9],q=e[10],Z=e[11],i[0]=o=e[0],i[1]=p,i[2]=g,i[3]=v,i[4]=T,i[5]=k,i[6]=A,i[7]=L,i[8]=F,i[9]=j,i[10]=q,i[11]=Z,i[12]=o*re+T*te+F*me+e[12],i[13]=p*re+k*te+j*me+e[13],i[14]=g*re+A*te+q*me+e[14],i[15]=v*re+L*te+Z*me+e[15]),i},s.triggerPluginCompletionEvent=kl,s.unicodeBlockLookup=et,s.uniqueId=function(){return R++},s.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateLight=oo,s.validateStyle=Ws,s.vectorTile=vs,s.warnOnce=ke,s.wrap=V}),_(["./shared"],function(s){function b(J){const D=typeof J;if(D==="number"||D==="boolean"||D==="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){let W="[";for(const ne of J)W+=`${b(ne)},`;return`${W}]`}const O=Object.keys(J).sort();let H="{";for(let W=0;W<O.length;W++)H+=`${JSON.stringify(O[W])}:${b(J[O[W]])},`;return`${H}}`}function S(J){let D="";for(const O of s.refProperties)D+=`/${b(J[O])}`;return D}class I{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,O){for(const W of D){this._layerConfigs[W.id]=W;const ne=this._layers[W.id]=s.createStyleLayer(W);ne._featureFilter=s.createFilter(ne.filter),this.keyCache[W.id]&&delete this.keyCache[W.id]}for(const W of O)delete this.keyCache[W],delete this._layerConfigs[W],delete this._layers[W];this.familiesBySource={};const H=function(W,ne){const ue={};for(let se=0;se<W.length;se++){const fe=ne&&ne[W[se].id]||S(W[se]);ne&&(ne[W[se].id]=fe);let Ce=ue[fe];Ce||(Ce=ue[fe]=[]),Ce.push(W[se])}const oe=[];for(const se in ue)oe.push(ue[se]);return oe}(Object.values(this._layerConfigs),this.keyCache);for(const W of H){const ne=W.map(Ue=>this._layers[Ue.id]),ue=ne[0];if(ue.visibility==="none")continue;const oe=ue.source||"";let se=this.familiesBySource[oe];se||(se=this.familiesBySource[oe]={});const fe=ue.sourceLayer||"_geojsonTileLayer";let Ce=se[fe];Ce||(Ce=se[fe]=[]),Ce.push(ne)}}}class P{constructor(D){const O={},H=[];for(const oe in D){const se=D[oe],fe=O[oe]={};for(const Ce in se){const Ue=se[+Ce];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ie={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};H.push(Ie),fe[Ce]={rect:Ie,metrics:Ue.metrics}}}const{w:W,h:ne}=s.potpack(H),ue=new s.AlphaImage({width:W||1,height:ne||1});for(const oe in D){const se=D[oe];for(const fe in se){const Ce=se[+fe];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const Ue=O[oe][fe].rect;s.AlphaImage.copy(Ce.bitmap,ue,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},Ce.bitmap)}}this.image=ue,this.positions=O}}s.register("GlyphAtlas",P);class z{constructor(D){this.tileID=new s.OverscaledTileID(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId}parse(D,O,H,W,ne){this.status="parsing",this.data=D,this.collisionBoxArray=new s.CollisionBoxArray;const ue=new s.DictionaryCoder(Object.keys(D.layers).sort()),oe=new s.FeatureIndex(this.tileID,this.promoteId);oe.bucketLayerIDs=[];const se={},fe={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Ce=O.familiesBySource[this.source];for(const zt in Ce){const Ft=D.layers[zt];if(!Ft)continue;Ft.version===1&&s.warnOnce(`Vector tile source "${this.source}" layer "${zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wt=ue.encode(zt),si=[];for(let Gi=0;Gi<Ft.length;Gi++){const vi=Ft.feature(Gi),tr=oe.getId(vi,zt);si.push({feature:vi,id:tr,index:Gi,sourceLayerIndex:Wt})}for(const Gi of Ce[zt]){const vi=Gi[0];vi.source!==this.source&&s.warnOnce(`layer.source = ${vi.source} does not equal this.source = ${this.source}`),vi.minzoom&&this.zoom<Math.floor(vi.minzoom)||vi.maxzoom&&this.zoom>=vi.maxzoom||vi.visibility!=="none"&&(V(Gi,this.zoom,H),(se[vi.id]=vi.createBucket({index:oe.bucketLayerIDs.length,layers:Gi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wt,sourceID:this.source})).populate(si,fe,this.tileID.canonical),oe.bucketLayerIDs.push(Gi.map(tr=>tr.id)))}}let Ue,Ie,ut,ft;const rt=s.mapObject(fe.glyphDependencies,zt=>Object.keys(zt).map(Number));Object.keys(rt).length?W.send("getGlyphs",{uid:this.uid,stacks:rt},(zt,Ft)=>{Ue||(Ue=zt,Ie=Ft,Ht.call(this))}):Ie={};const wt=Object.keys(fe.iconDependencies);wt.length?W.send("getImages",{icons:wt,source:this.source,tileID:this.tileID,type:"icons"},(zt,Ft)=>{Ue||(Ue=zt,ut=Ft,Ht.call(this))}):ut={};const kt=Object.keys(fe.patternDependencies);function Ht(){if(Ue)return ne(Ue);if(Ie&&ut&&ft){const zt=new P(Ie),Ft=new s.ImageAtlas(ut,ft);for(const Wt in se){const si=se[Wt];si instanceof s.SymbolBucket?(V(si.layers,this.zoom,H),s.performSymbolLayout({bucket:si,glyphMap:Ie,glyphPositions:zt.positions,imageMap:ut,imagePositions:Ft.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):si.hasPattern&&(si instanceof s.LineBucket||si instanceof s.FillBucket||si instanceof s.FillExtrusionBucket)&&(V(si.layers,this.zoom,H),si.addFeatures(fe,this.tileID.canonical,Ft.patternPositions))}this.status="done",ne(null,{buckets:Object.values(se).filter(Wt=>!Wt.isEmpty()),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zt.image,imageAtlas:Ft,glyphMap:this.returnDependencies?Ie:null,iconMap:this.returnDependencies?ut:null,glyphPositions:this.returnDependencies?zt.positions:null})}}kt.length?W.send("getImages",{icons:kt,source:this.source,tileID:this.tileID,type:"patterns"},(zt,Ft)=>{Ue||(Ue=zt,ft=Ft,Ht.call(this))}):ft={},Ht.call(this)}}function V(J,D,O){const H=new s.EvaluationParameters(D);for(const W of J)W.recalculate(H,O)}function N(J,D){const O=s.getArrayBuffer(J.request,(H,W,ne,ue)=>{H?D(H):W&&D(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(W)),rawData:W,cacheControl:ne,expires:ue})});return()=>{O.cancel(),D()}}class R{constructor(D,O,H,W){this.actor=D,this.layerIndex=O,this.availableImages=H,this.loadVectorData=W||N,this.loading={},this.loaded={}}loadTile(D,O){const H=D.uid;this.loading||(this.loading={});const W=!!(D&&D.request&&D.request.collectResourceTiming)&&new s.RequestPerformance(D.request),ne=this.loading[H]=new z(D);ne.abort=this.loadVectorData(D,(ue,oe)=>{if(delete this.loading[H],ue||!oe)return ne.status="done",this.loaded[H]=ne,O(ue);const se=oe.rawData,fe={};oe.expires&&(fe.expires=oe.expires),oe.cacheControl&&(fe.cacheControl=oe.cacheControl);const Ce={};if(W){const Ue=W.finish();Ue&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Ue)))}ne.vectorTile=oe.vectorTile,ne.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ue,Ie)=>{if(Ue||!Ie)return O(Ue);O(null,s.extend({rawTileData:se.slice(0)},Ie,fe,Ce))}),this.loaded=this.loaded||{},this.loaded[H]=ne})}reloadTile(D,O){const H=this.loaded,W=D.uid,ne=this;if(H&&H[W]){const ue=H[W];ue.showCollisionBoxes=D.showCollisionBoxes;const oe=(se,fe)=>{const Ce=ue.reloadCallback;Ce&&(delete ue.reloadCallback,ue.parse(ue.vectorTile,ne.layerIndex,this.availableImages,ne.actor,Ce)),O(se,fe)};ue.status==="parsing"?ue.reloadCallback=oe:ue.status==="done"&&(ue.vectorTile?ue.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor,oe):oe())}}abortTile(D,O){const H=this.loading,W=D.uid;H&&H[W]&&H[W].abort&&(H[W].abort(),delete H[W]),O()}removeTile(D,O){const H=this.loaded,W=D.uid;H&&H[W]&&delete H[W],O()}}class K{constructor(){this.loaded={}}loadTile(D,O){const{uid:H,encoding:W,rawImageData:ne}=D,ue=s.isImageBitmap(ne)?this.getImageData(ne):ne,oe=new s.DEMData(H,ue,W);this.loaded=this.loaded||{},this.loaded[H]=oe,O(null,oe)}getImageData(D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const O=this.offscreenCanvasContext.getImageData(-1,-1,D.width+2,D.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:O.width,height:O.height},O.data)}removeTile(D){const O=this.loaded,H=D.uid;O&&O[H]&&delete O[H]}}var ce=function J(D,O){var H,W=D&&D.type;if(W==="FeatureCollection")for(H=0;H<D.features.length;H++)J(D.features[H],O);else if(W==="GeometryCollection")for(H=0;H<D.geometries.length;H++)J(D.geometries[H],O);else if(W==="Feature")J(D.geometry,O);else if(W==="Polygon")ae(D.coordinates,O);else if(W==="MultiPolygon")for(H=0;H<D.coordinates.length;H++)ae(D.coordinates[H],O);return D};function ae(J,D){if(J.length!==0){Be(J[0],D);for(var O=1;O<J.length;O++)Be(J[O],!D)}}function Be(J,D){for(var O=0,H=0,W=0,ne=J.length,ue=ne-1;W<ne;ue=W++){var oe=(J[W][0]-J[ue][0])*(J[ue][1]+J[W][1]),se=O+oe;H+=Math.abs(O)>=Math.abs(oe)?O-se+oe:oe-se+O,O=se}O+H>=0!=!!D&&J.reverse()}const Oe=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ke{constructor(D){this._feature=D,this.extent=s.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){const D=[];for(const O of this._feature.geometry)D.push([new s.pointGeometry(O[0],O[1])]);return D}{const D=[];for(const O of this._feature.geometry){const H=[];for(const W of O)H.push(new s.pointGeometry(W[0],W[1]));D.push(H)}return D}}toGeoJSON(D,O,H){return Oe.call(this,D,O,H)}}class Ve{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=D.length,this._features=D}feature(D){return new ke(this._features[D])}}var ze={exports:{}},Ne=s.pointGeometry,Ct=s.vectorTile.VectorTileFeature,dt=yi;function yi(J,D){this.options=D||{},this.features=J,this.length=J.length}function gt(J,D){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=D||4096}yi.prototype.feature=function(J){return new gt(this.features[J],this.options.extent)},gt.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var D=0;D<J.length;D++){for(var O=J[D],H=[],W=0;W<O.length;W++)H.push(new Ne(O[W][0],O[W][1]));this.geometry.push(H)}return this.geometry},gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,D=1/0,O=-1/0,H=1/0,W=-1/0,ne=0;ne<J.length;ne++)for(var ue=J[ne],oe=0;oe<ue.length;oe++){var se=ue[oe];D=Math.min(D,se.x),O=Math.max(O,se.x),H=Math.min(H,se.y),W=Math.max(W,se.y)}return[D,H,O,W]},gt.prototype.toGeoJSON=Ct.prototype.toGeoJSON;var ni=s.pbf,er=dt;function ti(J){var D=new ni;return function(O,H){for(var W in O.layers)H.writeMessage(3,xt,O.layers[W])}(J,D),D.finish()}function xt(J,D){var O;D.writeVarintField(15,J.version||1),D.writeStringField(1,J.name||""),D.writeVarintField(5,J.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<J.length;O++)H.feature=J.feature(O),D.writeMessage(2,mr,H);var W=H.keys;for(O=0;O<W.length;O++)D.writeStringField(3,W[O]);var ne=H.values;for(O=0;O<ne.length;O++)D.writeMessage(4,Ai,ne[O])}function mr(J,D){var O=J.feature;O.id!==void 0&&D.writeVarintField(1,O.id),D.writeMessage(2,Si,J),D.writeVarintField(3,O.type),D.writeMessage(4,Mi,O)}function Si(J,D){var O=J.feature,H=J.keys,W=J.values,ne=J.keycache,ue=J.valuecache;for(var oe in O.properties){var se=O.properties[oe],fe=ne[oe];if(se!==null){fe===void 0&&(H.push(oe),ne[oe]=fe=H.length-1),D.writeVarint(fe);var Ce=typeof se;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(se=JSON.stringify(se));var Ue=Ce+":"+se,Ie=ue[Ue];Ie===void 0&&(W.push(se),ue[Ue]=Ie=W.length-1),D.writeVarint(Ie)}}}function Lt(J,D){return(D<<3)+(7&J)}function Ri(J){return J<<1^J>>31}function Mi(J,D){for(var O=J.loadGeometry(),H=J.type,W=0,ne=0,ue=O.length,oe=0;oe<ue;oe++){var se=O[oe],fe=1;H===1&&(fe=se.length),D.writeVarint(Lt(1,fe));for(var Ce=H===3?se.length-1:se.length,Ue=0;Ue<Ce;Ue++){Ue===1&&H!==1&&D.writeVarint(Lt(2,Ce-1));var Ie=se[Ue].x-W,ut=se[Ue].y-ne;D.writeVarint(Ri(Ie)),D.writeVarint(Ri(ut)),W+=Ie,ne+=ut}H===3&&D.writeVarint(Lt(7,1))}}function Ai(J,D){var O=typeof J;O==="string"?D.writeStringField(1,J):O==="boolean"?D.writeBooleanField(7,J):O==="number"&&(J%1!=0?D.writeDoubleField(3,J):J<0?D.writeSVarintField(6,J):D.writeVarintField(5,J))}function ur(J,D,O,H,W,ne){if(W-H<=O)return;const ue=H+W>>1;Ui(J,D,ue,H,W,ne%2),ur(J,D,O,H,ue-1,ne+1),ur(J,D,O,ue+1,W,ne+1)}function Ui(J,D,O,H,W,ne){for(;W>H;){if(W-H>600){const fe=W-H+1,Ce=O-H+1,Ue=Math.log(fe),Ie=.5*Math.exp(2*Ue/3),ut=.5*Math.sqrt(Ue*Ie*(fe-Ie)/fe)*(Ce-fe/2<0?-1:1);Ui(J,D,O,Math.max(H,Math.floor(O-Ce*Ie/fe+ut)),Math.min(W,Math.floor(O+(fe-Ce)*Ie/fe+ut)),ne)}const ue=D[2*O+ne];let oe=H,se=W;for(Ki(J,D,H,O),D[2*W+ne]>ue&&Ki(J,D,H,W);oe<se;){for(Ki(J,D,oe,se),oe++,se--;D[2*oe+ne]<ue;)oe++;for(;D[2*se+ne]>ue;)se--}D[2*H+ne]===ue?Ki(J,D,H,se):(se++,Ki(J,D,se,W)),se<=O&&(H=se+1),O<=se&&(W=se-1)}}function Ki(J,D,O,H){gr(J,O,H),gr(D,2*O,2*H),gr(D,2*O+1,2*H+1)}function gr(J,D,O){const H=J[D];J[D]=J[O],J[O]=H}function _r(J,D,O,H){const W=J-O,ne=D-H;return W*W+ne*ne}ze.exports=ti,ze.exports.fromVectorTileJs=ti,ze.exports.fromGeojsonVt=function(J,D){D=D||{};var O={};for(var H in J)O[H]=new er(J[H].features,D),O[H].name=H,O[H].version=D.version,O[H].extent=D.extent;return ti({layers:O})},ze.exports.GeoJSONWrapper=er;const Tr=J=>J[0],He=J=>J[1];class hi{constructor(D,O=Tr,H=He,W=64,ne=Float64Array){this.nodeSize=W,this.points=D;const ue=D.length<65536?Uint16Array:Uint32Array,oe=this.ids=new ue(D.length),se=this.coords=new ne(2*D.length);for(let fe=0;fe<D.length;fe++)oe[fe]=fe,se[2*fe]=O(D[fe]),se[2*fe+1]=H(D[fe]);ur(oe,se,W,0,oe.length-1,0)}range(D,O,H,W){return function(ne,ue,oe,se,fe,Ce,Ue){const Ie=[0,ne.length-1,0],ut=[];let ft,rt;for(;Ie.length;){const wt=Ie.pop(),kt=Ie.pop(),Ht=Ie.pop();if(kt-Ht<=Ue){for(let Wt=Ht;Wt<=kt;Wt++)ft=ue[2*Wt],rt=ue[2*Wt+1],ft>=oe&&ft<=fe&&rt>=se&&rt<=Ce&&ut.push(ne[Wt]);continue}const zt=Math.floor((Ht+kt)/2);ft=ue[2*zt],rt=ue[2*zt+1],ft>=oe&&ft<=fe&&rt>=se&&rt<=Ce&&ut.push(ne[zt]);const Ft=(wt+1)%2;(wt===0?oe<=ft:se<=rt)&&(Ie.push(Ht),Ie.push(zt-1),Ie.push(Ft)),(wt===0?fe>=ft:Ce>=rt)&&(Ie.push(zt+1),Ie.push(kt),Ie.push(Ft))}return ut}(this.ids,this.coords,D,O,H,W,this.nodeSize)}within(D,O,H){return function(W,ne,ue,oe,se,fe){const Ce=[0,W.length-1,0],Ue=[],Ie=se*se;for(;Ce.length;){const ut=Ce.pop(),ft=Ce.pop(),rt=Ce.pop();if(ft-rt<=fe){for(let Ft=rt;Ft<=ft;Ft++)_r(ne[2*Ft],ne[2*Ft+1],ue,oe)<=Ie&&Ue.push(W[Ft]);continue}const wt=Math.floor((rt+ft)/2),kt=ne[2*wt],Ht=ne[2*wt+1];_r(kt,Ht,ue,oe)<=Ie&&Ue.push(W[wt]);const zt=(ut+1)%2;(ut===0?ue-se<=kt:oe-se<=Ht)&&(Ce.push(rt),Ce.push(wt-1),Ce.push(zt)),(ut===0?ue+se>=kt:oe+se>=Ht)&&(Ce.push(wt+1),Ce.push(ft),Ce.push(zt))}return Ue}(this.ids,this.coords,D,O,H,this.nodeSize)}}const Ni={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},Rr=Math.fround||(kr=new Float32Array(1),J=>(kr[0]=+J,kr[0]));var kr;class Is{constructor(D){this.options=bn(Object.create(Ni),D),this.trees=new Array(this.options.maxZoom+1)}load(D){const{log:O,minZoom:H,maxZoom:W,nodeSize:ne}=this.options;O&&console.time("total time");const ue=`prepare ${D.length} points`;O&&console.time(ue),this.points=D;let oe=[];for(let se=0;se<D.length;se++)D[se].geometry&&oe.push($n(D[se],se));this.trees[W+1]=new hi(oe,As,an,ne,Float32Array),O&&console.timeEnd(ue);for(let se=W;se>=H;se--){const fe=+Date.now();oe=this._cluster(oe,se),this.trees[se]=new hi(oe,As,an,ne,Float32Array),O&&console.log("z%d: %d clusters in %dms",se,oe.length,+Date.now()-fe)}return O&&console.timeEnd("total time"),this}getClusters(D,O){let H=((D[0]+180)%360+360)%360-180;const W=Math.max(-90,Math.min(90,D[1]));let ne=D[2]===180?180:((D[2]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)H=-180,ne=180;else if(H>ne){const Ce=this.getClusters([H,W,180,ue],O),Ue=this.getClusters([-180,W,ne,ue],O);return Ce.concat(Ue)}const oe=this.trees[this._limitZoom(O)],se=oe.range(Zt(H),Yr(ue),Zt(ne),Yr(W)),fe=[];for(const Ce of se){const Ue=oe.points[Ce];fe.push(Ue.numPoints?es(Ue):this.points[Ue.index])}return fe}getChildren(D){const O=this._getOriginId(D),H=this._getOriginZoom(D),W="No cluster with the specified id.",ne=this.trees[H];if(!ne)throw new Error(W);const ue=ne.points[O];if(!ue)throw new Error(W);const oe=this.options.radius/(this.options.extent*Math.pow(2,H-1)),se=ne.within(ue.x,ue.y,oe),fe=[];for(const Ce of se){const Ue=ne.points[Ce];Ue.parentId===D&&fe.push(Ue.numPoints?es(Ue):this.points[Ue.index])}if(fe.length===0)throw new Error(W);return fe}getLeaves(D,O,H){const W=[];return this._appendLeaves(W,D,O=O||10,H=H||0,0),W}getTile(D,O,H){const W=this.trees[this._limitZoom(D)],ne=Math.pow(2,D),{extent:ue,radius:oe}=this.options,se=oe/ue,fe=(H-se)/ne,Ce=(H+1+se)/ne,Ue={features:[]};return this._addTileFeatures(W.range((O-se)/ne,fe,(O+1+se)/ne,Ce),W.points,O,H,ne,Ue),O===0&&this._addTileFeatures(W.range(1-se/ne,fe,1,Ce),W.points,ne,H,ne,Ue),O===ne-1&&this._addTileFeatures(W.range(0,fe,se/ne,Ce),W.points,-1,H,ne,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(D){let O=this._getOriginZoom(D)-1;for(;O<=this.options.maxZoom;){const H=this.getChildren(D);if(O++,H.length!==1)break;D=H[0].properties.cluster_id}return O}_appendLeaves(D,O,H,W,ne){const ue=this.getChildren(O);for(const oe of ue){const se=oe.properties;if(se&&se.cluster?ne+se.point_count<=W?ne+=se.point_count:ne=this._appendLeaves(D,se.cluster_id,H,W,ne):ne<W?ne++:D.push(oe),D.length===H)break}return ne}_addTileFeatures(D,O,H,W,ne,ue){for(const oe of D){const se=O[oe],fe=se.numPoints;let Ce,Ue,Ie;if(fe)Ce=Cs(se),Ue=se.x,Ie=se.y;else{const rt=this.points[se.index];Ce=rt.properties,Ue=Zt(rt.geometry.coordinates[0]),Ie=Yr(rt.geometry.coordinates[1])}const ut={type:1,geometry:[[Math.round(this.options.extent*(Ue*ne-H)),Math.round(this.options.extent*(Ie*ne-W))]],tags:Ce};let ft;fe?ft=se.id:this.options.generateId?ft=se.index:this.points[se.index].id&&(ft=this.points[se.index].id),ft!==void 0&&(ut.id=ft),ue.features.push(ut)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,O){const H=[],{radius:W,extent:ne,reduce:ue,minPoints:oe}=this.options,se=W/(ne*Math.pow(2,O));for(let fe=0;fe<D.length;fe++){const Ce=D[fe];if(Ce.zoom<=O)continue;Ce.zoom=O;const Ue=this.trees[O+1],Ie=Ue.within(Ce.x,Ce.y,se),ut=Ce.numPoints||1;let ft=ut;for(const rt of Ie){const wt=Ue.points[rt];wt.zoom>O&&(ft+=wt.numPoints||1)}if(ft>ut&&ft>=oe){let rt=Ce.x*ut,wt=Ce.y*ut,kt=ue&&ut>1?this._map(Ce,!0):null;const Ht=(fe<<5)+(O+1)+this.points.length;for(const zt of Ie){const Ft=Ue.points[zt];if(Ft.zoom<=O)continue;Ft.zoom=O;const Wt=Ft.numPoints||1;rt+=Ft.x*Wt,wt+=Ft.y*Wt,Ft.parentId=Ht,ue&&(kt||(kt=this._map(Ce,!0)),ue(kt,this._map(Ft)))}Ce.parentId=Ht,H.push(vn(rt/ft,wt/ft,Ht,ft,kt))}else if(H.push(Ce),ft>1)for(const rt of Ie){const wt=Ue.points[rt];wt.zoom<=O||(wt.zoom=O,H.push(wt))}}return H}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,O){if(D.numPoints)return O?bn({},D.properties):D.properties;const H=this.points[D.index].properties,W=this.options.map(H);return O&&W===H?bn({},W):W}}function vn(J,D,O,H,W){return{x:Rr(J),y:Rr(D),zoom:1/0,id:O,parentId:-1,numPoints:H,properties:W}}function $n(J,D){const[O,H]=J.geometry.coordinates;return{x:Rr(Zt(O)),y:Rr(Yr(H)),zoom:1/0,index:D,parentId:-1}}function es(J){return{type:"Feature",id:J.id,properties:Cs(J),geometry:{type:"Point",coordinates:[(D=J.x,360*(D-.5)),xn(J.y)]}};var D}function Cs(J){const D=J.numPoints,O=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return bn(bn({},J.properties),{cluster:!0,cluster_id:J.id,point_count:D,point_count_abbreviated:O})}function Zt(J){return J/360+.5}function Yr(J){const D=Math.sin(J*Math.PI/180),O=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return O<0?0:O>1?1:O}function xn(J){const D=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function bn(J,D){for(const O in D)J[O]=D[O];return J}function As(J){return J.x}function an(J){return J.y}function on(J,D,O,H){for(var W,ne=H,ue=O-D>>1,oe=O-D,se=J[D],fe=J[D+1],Ce=J[O],Ue=J[O+1],Ie=D+3;Ie<O;Ie+=3){var ut=ts(J[Ie],J[Ie+1],se,fe,Ce,Ue);if(ut>ne)W=Ie,ne=ut;else if(ut===ne){var ft=Math.abs(Ie-ue);ft<oe&&(W=Ie,oe=ft)}}ne>H&&(W-D>3&&on(J,D,W,H),J[W+2]=ne,O-W>3&&on(J,W,O,H))}function ts(J,D,O,H,W,ne){var ue=W-O,oe=ne-H;if(ue!==0||oe!==0){var se=((J-O)*ue+(D-H)*oe)/(ue*ue+oe*oe);se>1?(O=W,H=ne):se>0&&(O+=ue*se,H+=oe*se)}return(ue=J-O)*ue+(oe=D-H)*oe}function ln(J,D,O,H){var W={id:J===void 0?null:J,type:D,geometry:O,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ne){var ue=ne.geometry,oe=ne.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")De(ne,ue);else if(oe==="Polygon"||oe==="MultiLineString")for(var se=0;se<ue.length;se++)De(ne,ue[se]);else if(oe==="MultiPolygon")for(se=0;se<ue.length;se++)for(var fe=0;fe<ue[se].length;fe++)De(ne,ue[se][fe])}(W),W}function De(J,D){for(var O=0;O<D.length;O+=3)J.minX=Math.min(J.minX,D[O]),J.minY=Math.min(J.minY,D[O+1]),J.maxX=Math.max(J.maxX,D[O]),J.maxY=Math.max(J.maxY,D[O+1])}function Qe(J,D,O,H){if(D.geometry){var W=D.geometry.coordinates,ne=D.geometry.type,ue=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),oe=[],se=D.id;if(O.promoteId?se=D.properties[O.promoteId]:O.generateId&&(se=H||0),ne==="Point")Dn(W,oe);else if(ne==="MultiPoint")for(var fe=0;fe<W.length;fe++)Dn(W[fe],oe);else if(ne==="LineString")jr(W,oe,ue,!1);else if(ne==="MultiLineString"){if(O.lineMetrics){for(fe=0;fe<W.length;fe++)jr(W[fe],oe=[],ue,!1),J.push(ln(se,"LineString",oe,D.properties));return}Xt(W,oe,ue,!1)}else if(ne==="Polygon")Xt(W,oe,ue,!0);else{if(ne!=="MultiPolygon"){if(ne==="GeometryCollection"){for(fe=0;fe<D.geometry.geometries.length;fe++)Qe(J,{id:se,geometry:D.geometry.geometries[fe],properties:D.properties},O,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fe=0;fe<W.length;fe++){var Ce=[];Xt(W[fe],Ce,ue,!0),oe.push(Ce)}}J.push(ln(se,ne,oe,D.properties))}}function Dn(J,D){D.push(Fr(J[0])),D.push(Er(J[1])),D.push(0)}function jr(J,D,O,H){for(var W,ne,ue=0,oe=0;oe<J.length;oe++){var se=Fr(J[oe][0]),fe=Er(J[oe][1]);D.push(se),D.push(fe),D.push(0),oe>0&&(ue+=H?(W*fe-se*ne)/2:Math.sqrt(Math.pow(se-W,2)+Math.pow(fe-ne,2))),W=se,ne=fe}var Ce=D.length-3;D[2]=1,on(D,0,Ce,O),D[Ce+2]=1,D.size=Math.abs(ue),D.start=0,D.end=D.size}function Xt(J,D,O,H){for(var W=0;W<J.length;W++){var ne=[];jr(J[W],ne,O,H),D.push(ne)}}function Fr(J){return J/360+.5}function Er(J){var D=Math.sin(J*Math.PI/180),O=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return O<0?0:O>1?1:O}function Sr(J,D,O,H,W,ne,ue,oe){if(H/=D,ne>=(O/=D)&&ue<H)return J;if(ue<O||ne>=H)return null;for(var se=[],fe=0;fe<J.length;fe++){var Ce=J[fe],Ue=Ce.geometry,Ie=Ce.type,ut=W===0?Ce.minX:Ce.minY,ft=W===0?Ce.maxX:Ce.maxY;if(ut>=O&&ft<H)se.push(Ce);else if(!(ft<O||ut>=H)){var rt=[];if(Ie==="Point"||Ie==="MultiPoint")wn(Ue,rt,O,H,W);else if(Ie==="LineString")Ke(Ue,rt,O,H,W,!1,oe.lineMetrics);else if(Ie==="MultiLineString")Pt(Ue,rt,O,H,W,!1);else if(Ie==="Polygon")Pt(Ue,rt,O,H,W,!0);else if(Ie==="MultiPolygon")for(var wt=0;wt<Ue.length;wt++){var kt=[];Pt(Ue[wt],kt,O,H,W,!0),kt.length&&rt.push(kt)}if(rt.length){if(oe.lineMetrics&&Ie==="LineString"){for(wt=0;wt<rt.length;wt++)se.push(ln(Ce.id,Ie,rt[wt],Ce.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(rt.length===1?(Ie="LineString",rt=rt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=rt.length===3?"Point":"MultiPoint"),se.push(ln(Ce.id,Ie,rt,Ce.tags))}}}return se.length?se:null}function wn(J,D,O,H,W){for(var ne=0;ne<J.length;ne+=3){var ue=J[ne+W];ue>=O&&ue<=H&&(D.push(J[ne]),D.push(J[ne+1]),D.push(J[ne+2]))}}function Ke(J,D,O,H,W,ne,ue){for(var oe,se,fe=Rt(J),Ce=W===0?Tn:Mt,Ue=J.start,Ie=0;Ie<J.length-3;Ie+=3){var ut=J[Ie],ft=J[Ie+1],rt=J[Ie+2],wt=J[Ie+3],kt=J[Ie+4],Ht=W===0?ut:ft,zt=W===0?wt:kt,Ft=!1;ue&&(oe=Math.sqrt(Math.pow(ut-wt,2)+Math.pow(ft-kt,2))),Ht<O?zt>O&&(se=Ce(fe,ut,ft,wt,kt,O),ue&&(fe.start=Ue+oe*se)):Ht>H?zt<H&&(se=Ce(fe,ut,ft,wt,kt,H),ue&&(fe.start=Ue+oe*se)):Ji(fe,ut,ft,rt),zt<O&&Ht>=O&&(se=Ce(fe,ut,ft,wt,kt,O),Ft=!0),zt>H&&Ht<=H&&(se=Ce(fe,ut,ft,wt,kt,H),Ft=!0),!ne&&Ft&&(ue&&(fe.end=Ue+oe*se),D.push(fe),fe=Rt(J)),ue&&(Ue+=oe)}var Wt=J.length-3;ut=J[Wt],ft=J[Wt+1],rt=J[Wt+2],(Ht=W===0?ut:ft)>=O&&Ht<=H&&Ji(fe,ut,ft,rt),Wt=fe.length-3,ne&&Wt>=3&&(fe[Wt]!==fe[0]||fe[Wt+1]!==fe[1])&&Ji(fe,fe[0],fe[1],fe[2]),fe.length&&D.push(fe)}function Rt(J){var D=[];return D.size=J.size,D.start=J.start,D.end=J.end,D}function Pt(J,D,O,H,W,ne){for(var ue=0;ue<J.length;ue++)Ke(J[ue],D,O,H,W,ne,!1)}function Ji(J,D,O,H){J.push(D),J.push(O),J.push(H)}function Tn(J,D,O,H,W,ne){var ue=(ne-D)/(H-D);return J.push(ne),J.push(O+(W-O)*ue),J.push(1),ue}function Mt(J,D,O,H,W,ne){var ue=(ne-O)/(W-O);return J.push(D+(H-D)*ue),J.push(ne),J.push(1),ue}function cn(J,D){for(var O=[],H=0;H<J.length;H++){var W,ne=J[H],ue=ne.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")W=ji(ne.geometry,D);else if(ue==="MultiLineString"||ue==="Polygon"){W=[];for(var oe=0;oe<ne.geometry.length;oe++)W.push(ji(ne.geometry[oe],D))}else if(ue==="MultiPolygon")for(W=[],oe=0;oe<ne.geometry.length;oe++){for(var se=[],fe=0;fe<ne.geometry[oe].length;fe++)se.push(ji(ne.geometry[oe][fe],D));W.push(se)}O.push(ln(ne.id,ue,W,ne.tags))}return O}function ji(J,D){var O=[];O.size=J.size,J.start!==void 0&&(O.start=J.start,O.end=J.end);for(var H=0;H<J.length;H+=3)O.push(J[H]+D,J[H+1],J[H+2]);return O}function is(J,D){if(J.transformed)return J;var O,H,W,ne=1<<J.z,ue=J.x,oe=J.y;for(O=0;O<J.features.length;O++){var se=J.features[O],fe=se.geometry,Ce=se.type;if(se.geometry=[],Ce===1)for(H=0;H<fe.length;H+=2)se.geometry.push(Pi(fe[H],fe[H+1],D,ne,ue,oe));else for(H=0;H<fe.length;H++){var Ue=[];for(W=0;W<fe[H].length;W+=2)Ue.push(Pi(fe[H][W],fe[H][W+1],D,ne,ue,oe));se.geometry.push(Ue)}}return J.transformed=!0,J}function Pi(J,D,O,H,W,ne){return[Math.round(O*(J*H-W)),Math.round(O*(D*H-ne))]}function hr(J,D,O,H,W){for(var ne=D===W.maxZoom?0:W.tolerance/((1<<D)*W.extent),ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:H,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<J.length;oe++){ue.numFeatures++,ii(ue,J[oe],ne,W);var se=J[oe].minX,fe=J[oe].minY,Ce=J[oe].maxX,Ue=J[oe].maxY;se<ue.minX&&(ue.minX=se),fe<ue.minY&&(ue.minY=fe),Ce>ue.maxX&&(ue.maxX=Ce),Ue>ue.maxY&&(ue.maxY=Ue)}return ue}function ii(J,D,O,H){var W=D.geometry,ne=D.type,ue=[];if(ne==="Point"||ne==="MultiPoint")for(var oe=0;oe<W.length;oe+=3)ue.push(W[oe]),ue.push(W[oe+1]),J.numPoints++,J.numSimplified++;else if(ne==="LineString")rs(ue,W,J,O,!1,!1);else if(ne==="MultiLineString"||ne==="Polygon")for(oe=0;oe<W.length;oe++)rs(ue,W[oe],J,O,ne==="Polygon",oe===0);else if(ne==="MultiPolygon")for(var se=0;se<W.length;se++){var fe=W[se];for(oe=0;oe<fe.length;oe++)rs(ue,fe[oe],J,O,!0,oe===0)}if(ue.length){var Ce=D.tags||null;if(ne==="LineString"&&H.lineMetrics){for(var Ue in Ce={},D.tags)Ce[Ue]=D.tags[Ue];Ce.mapbox_clip_start=W.start/W.size,Ce.mapbox_clip_end=W.end/W.size}var Ie={geometry:ue,type:ne==="Polygon"||ne==="MultiPolygon"?3:ne==="LineString"||ne==="MultiLineString"?2:1,tags:Ce};D.id!==null&&(Ie.id=D.id),J.features.push(Ie)}}function rs(J,D,O,H,W,ne){var ue=H*H;if(H>0&&D.size<(W?ue:H))O.numPoints+=D.length/3;else{for(var oe=[],se=0;se<D.length;se+=3)(H===0||D[se+2]>ue)&&(O.numSimplified++,oe.push(D[se]),oe.push(D[se+1])),O.numPoints++;W&&function(fe,Ce){for(var Ue=0,Ie=0,ut=fe.length,ft=ut-2;Ie<ut;ft=Ie,Ie+=2)Ue+=(fe[Ie]-fe[ft])*(fe[Ie+1]+fe[ft+1]);if(Ue>0===Ce)for(Ie=0,ut=fe.length;Ie<ut/2;Ie+=2){var rt=fe[Ie],wt=fe[Ie+1];fe[Ie]=fe[ut-2-Ie],fe[Ie+1]=fe[ut-1-Ie],fe[ut-2-Ie]=rt,fe[ut-1-Ie]=wt}}(oe,ne),J.push(oe)}}function Qr(J,D){var O=(D=this.options=function(W,ne){for(var ue in ne)W[ue]=ne[ue];return W}(Object.create(this.options),D)).debug;if(O&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(W,ne){var ue=[];if(W.type==="FeatureCollection")for(var oe=0;oe<W.features.length;oe++)Qe(ue,W.features[oe],ne,oe);else Qe(ue,W.type==="Feature"?W:{geometry:W},ne);return ue}(J,D);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(W,ne){var ue=ne.buffer/ne.extent,oe=W,se=Sr(W,1,-1-ue,ue,0,-1,2,ne),fe=Sr(W,1,1-ue,2+ue,0,-1,2,ne);return(se||fe)&&(oe=Sr(W,1,-ue,1+ue,0,-1,2,ne)||[],se&&(oe=cn(se,1).concat(oe)),fe&&(oe=oe.concat(cn(fe,-1)))),oe}(H,D),H.length&&this.splitTile(H,0,0,0),O&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ln(J,D,O){return 32*((1<<J)*O+D)+J}function Bn(J,D){const O=J.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const H=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!H)return D(null,null);const W=new Ve(H.features);let ne=ze.exports(W);ne.byteOffset===0&&ne.byteLength===ne.buffer.byteLength||(ne=new Uint8Array(ne)),D(null,{vectorTile:W,rawData:ne.buffer})}Qr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qr.prototype.splitTile=function(J,D,O,H,W,ne,ue){for(var oe=[J,D,O,H],se=this.options,fe=se.debug;oe.length;){H=oe.pop(),O=oe.pop(),D=oe.pop(),J=oe.pop();var Ce=1<<D,Ue=Ln(D,O,H),Ie=this.tiles[Ue];if(!Ie&&(fe>1&&console.time("creation"),Ie=this.tiles[Ue]=hr(J,D,O,H,se),this.tileCoords.push({z:D,x:O,y:H}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,O,H,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var ut="z"+D;this.stats[ut]=(this.stats[ut]||0)+1,this.total++}if(Ie.source=J,W){if(D===se.maxZoom||D===W)continue;var ft=1<<W-D;if(O!==Math.floor(ne/ft)||H!==Math.floor(ue/ft))continue}else if(D===se.indexMaxZoom||Ie.numPoints<=se.indexMaxPoints)continue;if(Ie.source=null,J.length!==0){fe>1&&console.time("clipping");var rt,wt,kt,Ht,zt,Ft,Wt=.5*se.buffer/se.extent,si=.5-Wt,Gi=.5+Wt,vi=1+Wt;rt=wt=kt=Ht=null,zt=Sr(J,Ce,O-Wt,O+Gi,0,Ie.minX,Ie.maxX,se),Ft=Sr(J,Ce,O+si,O+vi,0,Ie.minX,Ie.maxX,se),J=null,zt&&(rt=Sr(zt,Ce,H-Wt,H+Gi,1,Ie.minY,Ie.maxY,se),wt=Sr(zt,Ce,H+si,H+vi,1,Ie.minY,Ie.maxY,se),zt=null),Ft&&(kt=Sr(Ft,Ce,H-Wt,H+Gi,1,Ie.minY,Ie.maxY,se),Ht=Sr(Ft,Ce,H+si,H+vi,1,Ie.minY,Ie.maxY,se),Ft=null),fe>1&&console.timeEnd("clipping"),oe.push(rt||[],D+1,2*O,2*H),oe.push(wt||[],D+1,2*O,2*H+1),oe.push(kt||[],D+1,2*O+1,2*H),oe.push(Ht||[],D+1,2*O+1,2*H+1)}}},Qr.prototype.getTile=function(J,D,O){var H=this.options,W=H.extent,ne=H.debug;if(J<0||J>24)return null;var ue=1<<J,oe=Ln(J,D=(D%ue+ue)%ue,O);if(this.tiles[oe])return is(this.tiles[oe],W);ne>1&&console.log("drilling down to z%d-%d-%d",J,D,O);for(var se,fe=J,Ce=D,Ue=O;!se&&fe>0;)fe--,Ce=Math.floor(Ce/2),Ue=Math.floor(Ue/2),se=this.tiles[Ln(fe,Ce,Ue)];return se&&se.source?(ne>1&&console.log("found parent tile z%d-%d-%d",fe,Ce,Ue),ne>1&&console.time("drilling down"),this.splitTile(se.source,fe,Ce,Ue,J,D,O),ne>1&&console.timeEnd("drilling down"),this.tiles[oe]?is(this.tiles[oe],W):null):null};class ns extends R{constructor(D,O,H,W){super(D,O,H,Bn),W&&(this.loadGeoJSON=W)}loadData(D,O){var H;(H=this._pendingRequest)===null||H===void 0||H.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const W=!!(D&&D.request&&D.request.collectResourceTiming)&&new s.RequestPerformance(D.request);this._pendingCallback=O,this._pendingRequest=this.loadGeoJSON(D,(ne,ue)=>{if(delete this._pendingCallback,delete this._pendingRequest,ne||!ue)return O(ne);if(typeof ue!="object")return O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{ce(ue,!0);try{if(D.filter){const se=s.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));ue={type:"FeatureCollection",features:ue.features.filter(Ce=>se.value.evaluate({zoom:0},Ce))}}this._geoJSONIndex=D.cluster?new Is(function({superclusterOptions:se,clusterProperties:fe}){if(!fe||!se)return se;const Ce={},Ue={},Ie={accumulated:null,zoom:0},ut={properties:null},ft=Object.keys(fe);for(const rt of ft){const[wt,kt]=fe[rt],Ht=s.createExpression(kt),zt=s.createExpression(typeof wt=="string"?[wt,["accumulated"],["get",rt]]:wt);Ce[rt]=Ht.value,Ue[rt]=zt.value}return se.map=rt=>{ut.properties=rt;const wt={};for(const kt of ft)wt[kt]=Ce[kt].evaluate(Ie,ut);return wt},se.reduce=(rt,wt)=>{ut.properties=wt;for(const kt of ft)Ie.accumulated=rt[kt],rt[kt]=Ue[kt].evaluate(Ie,ut)},se}(D)).load(ue.features):function(se,fe){return new Qr(se,fe)}(ue,D.geojsonVtOptions)}catch(se){return O(se)}this.loaded={};const oe={};if(W){const se=W.finish();se&&(oe.resourceTiming={},oe.resourceTiming[D.source]=JSON.parse(JSON.stringify(se)))}O(null,oe)}})}reloadTile(D,O){const H=this.loaded;return H&&H[D.uid]?super.reloadTile(D,O):this.loadTile(D,O)}loadGeoJSON(D,O){if(D.request)return s.getJSON(D.request,O);if(typeof D.data=="string")try{O(null,JSON.parse(D.data))}catch{O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}else O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(D,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(D,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(H){O(H)}}getClusterChildren(D,O){try{O(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(H){O(H)}}getClusterLeaves(D,O){try{O(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(H){O(H)}}}class Rn{constructor(D){this.self=D,this.actor=new s.Actor(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:R,geojson:ns},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,H)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=H},this.self.registerRTLTextPlugin=O=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=O.applyArabicShaping,s.plugin.processBidirectionalText=O.processBidirectionalText,s.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(D,O){this.referrer=O}setImages(D,O,H){this.availableImages[D]=O;for(const W in this.workerSources[D]){const ne=this.workerSources[D][W];for(const ue in ne)ne[ue].availableImages=O}H()}setLayers(D,O,H){this.getLayerIndex(D).replace(O),H()}updateLayers(D,O,H){this.getLayerIndex(D).update(O.layers,O.removedIds),H()}loadTile(D,O,H){this.getWorkerSource(D,O.type,O.source).loadTile(O,H)}loadDEMTile(D,O,H){this.getDEMWorkerSource(D,O.source).loadTile(O,H)}reloadTile(D,O,H){this.getWorkerSource(D,O.type,O.source).reloadTile(O,H)}abortTile(D,O,H){this.getWorkerSource(D,O.type,O.source).abortTile(O,H)}removeTile(D,O,H){this.getWorkerSource(D,O.type,O.source).removeTile(O,H)}removeDEMTile(D,O){this.getDEMWorkerSource(D,O.source).removeTile(O)}removeSource(D,O,H){if(!this.workerSources[D]||!this.workerSources[D][O.type]||!this.workerSources[D][O.type][O.source])return;const W=this.workerSources[D][O.type][O.source];delete this.workerSources[D][O.type][O.source],W.removeSource!==void 0?W.removeSource(O,H):H()}loadWorkerSource(D,O,H){try{this.self.importScripts(O.url),H()}catch(W){H(W.toString())}}syncRTLPluginState(D,O,H){try{s.plugin.setState(O);const W=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&W!=null){this.self.importScripts(W);const ne=s.plugin.isParsed();H(ne?void 0:new Error(`RTL Text Plugin failed to import scripts from ${W}`),ne)}}catch(W){H(W.toString())}}getAvailableImages(D){let O=this.availableImages[D];return O||(O=[]),O}getLayerIndex(D){let O=this.layerIndexes[D];return O||(O=this.layerIndexes[D]=new I),O}getWorkerSource(D,O,H){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][O]||(this.workerSources[D][O]={}),!this.workerSources[D][O][H]){const W={send:(ne,ue,oe)=>{this.actor.send(ne,ue,oe,D)}};this.workerSources[D][O][H]=new this.workerSourceTypes[O](W,this.getLayerIndex(D),this.getAvailableImages(D))}return this.workerSources[D][O][H]}getDEMWorkerSource(D,O){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][O]||(this.demWorkerSources[D][O]=new K),this.demWorkerSources[D][O]}enforceCacheSizeLimit(D,O){s.enforceCacheSizeLimit(O)}}return s.isWorker()&&(self.worker=new Rn(self)),Rn}),_(["./shared"],function(s){var b=S;function S(f){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,m,y=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(y);try{m=new Worker(w),u=!0}catch{u=!1}return m&&m.terminate(),URL.revokeObjectURL(w),u}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var u=document.createElement("canvas");u.width=u.height=1;var m=u.getContext("2d");if(!m)return!1;var y=m.getImageData(0,0,1,1);return y&&y.width===u.width}()?(I[a=t&&t.failIfMajorPerformanceCaveat]===void 0&&(I[a]=function(u){var m,y=function(w){var E=document.createElement("canvas"),C=Object.create(S.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=w,E.getContext("webgl",C)||E.getContext("experimental-webgl",C)}(u);if(!y)return!1;try{m=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!m||y.isContextLost())&&(y.shaderSource(m,"void main() {}"),y.compileShader(m),y.getShaderParameter(m,y.COMPILE_STATUS)===!0)}(a)),I[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(f)}var I={};function P(f,t){if(Array.isArray(f)){if(!Array.isArray(t)||f.length!==t.length)return!1;for(let a=0;a<f.length;a++)if(!P(f[a],t[a]))return!1;return!0}if(typeof f=="object"&&f!==null&&t!==null){if(typeof t!="object"||Object.keys(f).length!==Object.keys(t).length)return!1;for(const a in f)if(!P(f[a],t[a]))return!1;return!0}return f===t}S.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class z{static testProp(t){if(!z.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in z.docStyle)return t[a];return t[0]}static create(t,a,u){const m=window.document.createElement(t);return a!==void 0&&(m.className=a),u&&u.appendChild(m),m}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){z.docStyle&&z.selectProp&&(z.userSelect=z.docStyle[z.selectProp],z.docStyle[z.selectProp]="none")}static enableDrag(){z.docStyle&&z.selectProp&&(z.docStyle[z.selectProp]=z.userSelect)}static setTransform(t,a){t.style[z.transformProp]=a}static addEventListener(t,a,u,m={}){t.addEventListener(a,u,"passive"in m?m:m.capture)}static removeEventListener(t,a,u,m={}){t.removeEventListener(a,u,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",z.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",z.suppressClickInternal,!0)},0)}static mousePos(t,a){const u=t.getBoundingClientRect();return new s.pointGeometry(a.clientX-u.left-t.clientLeft,a.clientY-u.top-t.clientTop)}static touchPos(t,a){const u=t.getBoundingClientRect(),m=[];for(let y=0;y<a.length;y++)m.push(new s.pointGeometry(a[y].clientX-u.left-t.clientLeft,a[y].clientY-u.top-t.clientTop));return m}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,z.selectProp=z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),z.transformProp=z.testProp(["transform","WebkitTransform"]);class V{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeSpriteURL(t,a,u){const m=function(y){const w=y.match(N);if(!w)throw new Error(`Unable to parse URL "${y}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(t);return m.path+=`${a}${u}`,function(y){const w=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${w}`}(m)}setTransformRequest(t){this._transformRequestFn=t}}const N=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class R{constructor(t,a,u,m){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(a,m)}update(t,a,u){const{width:m,height:y}=t,w=!(this.size&&this.size[0]===m&&this.size[1]===y||u),{context:E}=this,{gl:C}=E;if(this.useMipmap=!!(a&&a.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!a||a.premultiply!==!1)),w)this.size=[m,y],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.isImageBitmap(t)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,t):C.texImage2D(C.TEXTURE_2D,0,this.format,m,y,0,this.format,C.UNSIGNED_BYTE,t.data);else{const{x:M,y:B}=u||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.isImageBitmap(t)?C.texSubImage2D(C.TEXTURE_2D,0,M,B,C.RGBA,C.UNSIGNED_BYTE,t):C.texSubImage2D(C.TEXTURE_2D,0,M,B,m,y,C.RGBA,C.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(t,a,u){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),u!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=y.LINEAR),t!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,t),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,u||t),this.filter=t),a!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,a),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function K(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class ce extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:u}of this.requestors)this._notify(a,u);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let u=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,a){if(!t)return!0;let u=0;for(const m of t){if(m[0]<u||m[1]<m[0]||a<m[1])return!1;u=m[1]}return!0}_validateContent(t,a){return!(t&&(t.length!==4||t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,a){const u=this.images[t];if(u.data.width!==a.data.width||u.data.height!==a.data.height)throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=u.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let u=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(u=!1);this.isLoaded()||u?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const u={};for(const m of t){this.images[m]||this.fire(new s.Event("styleimagemissing",{id:m}));const y=this.images[m];y?u[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:s.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,u)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],u=this.getImage(t);if(!u)return null;if(a&&a.position.version===u.version)return a.position;if(a)a.position.version=u.version;else{const m={w:u.data.width+2,h:u.data.height+2,x:0,y:0},y=new s.ImagePosition(m,u);this.patterns[t]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new R(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:a,h:u}=s.potpack(t),m=this.atlasImage;m.resize({width:a||1,height:u||1});for(const y in this.patterns){const{bin:w}=this.patterns[y],E=w.x+1,C=w.y+1,M=this.images[y].data,B=M.width,U=M.height;s.RGBAImage.copy(M,m,{x:0,y:0},{x:E,y:C},{width:B,height:U}),s.RGBAImage.copy(M,m,{x:0,y:U-1},{x:E,y:C-1},{width:B,height:1}),s.RGBAImage.copy(M,m,{x:0,y:0},{x:E,y:C+U},{width:B,height:1}),s.RGBAImage.copy(M,m,{x:B-1,y:0},{x:E-1,y:C},{width:1,height:U}),s.RGBAImage.copy(M,m,{x:0,y:0},{x:E+B,y:C},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const u=this.images[a];u||s.warnOnce(`Image with ID: "${a}" was not found`),K(u)&&this.updateImage(a,u)}}}const ae=1e20;function Be(f,t,a,u,m,y,w,E,C){for(let M=t;M<t+u;M++)Oe(f,a*y+M,y,m,w,E,C);for(let M=a;M<a+m;M++)Oe(f,M*y+t,1,u,w,E,C)}function Oe(f,t,a,u,m,y,w){y[0]=0,w[0]=-ae,w[1]=ae,m[0]=f[t];for(let E=1,C=0,M=0;E<u;E++){m[E]=f[t+E*a];const B=E*E;do{const U=y[C];M=(m[E]-m[U]+B-U*U)/(E-U)/2}while(M<=w[C]&&--C>-1);C++,y[C]=E,w[C]=M,w[C+1]=ae}for(let E=0,C=0;E<u;E++){for(;w[C+1]<E;)C++;const M=y[C],B=E-M;f[t+E*a]=m[M]+B*B}}class ke{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t,a){const u=[];for(const m in t)for(const y of t[m])u.push({stack:m,id:y});s.asyncAll(u,({stack:m,id:y},w)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{}});let C=E.glyphs[y];if(C!==void 0)return void w(null,{stack:m,id:y,glyph:C});if(C=this._tinySDF(E,m,y),C)return E.glyphs[y]=C,void w(null,{stack:m,id:y,glyph:C});const M=Math.floor(y/256);if(256*M>65535)return void w(new Error("glyphs > 65535 not supported"));if(E.ranges[M])return void w(null,{stack:m,id:y,glyph:C});let B=E.requests[M];B||(B=E.requests[M]=[],ke.loadGlyphRange(m,M,this.url,this.requestManager,(U,G)=>{if(G){for(const $ in G)this._doesCharSupportLocalGlyph(+$)||(E.glyphs[+$]=G[+$]);E.ranges[M]=!0}for(const $ of B)$(U,G);delete E.requests[M]})),B.push((U,G)=>{U?w(U):G&&w(null,{stack:m,id:y,glyph:G[y]||null})})},(m,y)=>{if(m)a(m);else if(y){const w={};for(const{stack:E,id:C,glyph:M}of y)(w[E]||(w[E]={}))[C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};a(null,w)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(s.unicodeBlockLookup["CJK Unified Ideographs"](t)||s.unicodeBlockLookup["Hangul Syllables"](t)||s.unicodeBlockLookup.Hiragana(t)||s.unicodeBlockLookup.Katakana(t))}_tinySDF(t,a,u){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let y=t.tinySDF;if(!y){let E="400";/bold/i.test(a)?E="900":/medium/i.test(a)?E="500":/light/i.test(a)&&(E="200"),y=t.tinySDF=new ke.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:m,fontWeight:E})}const w=y.draw(String.fromCharCode(u));return{id:u,bitmap:new s.AlphaImage({width:w.width||30,height:w.height||30},w.data),metrics:{width:w.glyphWidth||24,height:w.glyphHeight||24,left:w.glyphLeft||0,top:w.glyphTop-27||-8,advance:w.glyphAdvance||24}}}}ke.loadGlyphRange=function(f,t,a,u,m){const y=256*t,w=y+255,E=u.transformRequest(a.replace("{fontstack}",f).replace("{range}",`${y}-${w}`),s.ResourceType.Glyphs);s.getArrayBuffer(E,(C,M)=>{if(C)m(C);else if(M){const B={};for(const U of s.parseGlyphPbf(M))B[U.id]=U;m(null,B)}})},ke.TinySDF=class{constructor({fontSize:f=24,buffer:t=3,radius:a=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:w="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=a;const E=this.size=f+4*t,C=this._createCanvas(E),M=this.ctx=C.getContext("2d",{willReadFrequently:!0});M.font=`${w} ${y} ${f}px ${m}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(f){const t=document.createElement("canvas");return t.width=t.height=f,t}draw(f){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(f),w=Math.ceil(a),E=Math.min(this.size-this.buffer,Math.ceil(y-m)),C=Math.min(this.size-this.buffer,w+Math.ceil(u)),M=E+2*this.buffer,B=C+2*this.buffer,U=Math.max(M*B,0),G=new Uint8ClampedArray(U),$={data:G,width:M,height:B,glyphWidth:E,glyphHeight:C,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(E===0||C===0)return $;const{ctx:Y,buffer:Q,gridInner:le,gridOuter:de}=this;Y.clearRect(Q,Q,E,C),Y.fillText(f,Q,Q+w);const _e=Y.getImageData(Q,Q,E,C);de.fill(ae,0,U),le.fill(0,0,U);for(let ee=0;ee<C;ee++)for(let we=0;we<E;we++){const ye=_e.data[4*(ee*E+we)+3]/255;if(ye===0)continue;const Me=(ee+Q)*M+we+Q;if(ye===1)de[Me]=0,le[Me]=ae;else{const Pe=.5-ye;de[Me]=Pe>0?Pe*Pe:0,le[Me]=Pe<0?Pe*Pe:0}}Be(de,0,0,M,B,M,this.f,this.v,this.z),Be(le,Q,Q,E,C,M,this.f,this.v,this.z);for(let ee=0;ee<U;ee++){const we=Math.sqrt(de[ee])-Math.sqrt(le[ee]);G[ee]=Math.round(255-255*(we/this.radius+this.cutoff))}return $}};const Ve=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(f,t){return s.sphericalToCartesian(f.expression.evaluate(t))}interpolate(f,t,a){return{x:s.number(f.x,t.x,a),y:s.number(f.y,t.y,a),z:s.number(f.z,t.z,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),ze="-transition";class Ne extends s.Evented{constructor(t){super(),this._transitionable=new s.Transitionable(Ve),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(s.validateLight,t,a))for(const u in t){const m=t[u];u.endsWith(ze)?this._transitionable.setTransition(u.slice(0,-ze.length),m):this._transitionable.setValue(u,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&s.emitValidationErrors(this,t.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Ct{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const u=t.join(",")+String(a);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,a)),this.dashEntry[u]}getDashRanges(t,a,u){const m=[];let y=t.length%2==1?-t[t.length-1]*u:0,w=t[0]*u,E=!0;m.push({left:y,right:w,isDash:E,zeroLength:t[0]===0});let C=t[0];for(let M=1;M<t.length;M++){E=!E;const B=t[M];y=C*u,C+=B,w=C*u,m.push({left:y,right:w,isDash:E,zeroLength:B===0})}return m}addRoundDash(t,a,u){const m=a/2;for(let y=-u;y<=u;y++){const w=this.width*(this.nextRow+u+y);let E=0,C=t[E];for(let M=0;M<this.width;M++){M/C.right>1&&(C=t[++E]);const B=Math.abs(M-C.left),U=Math.abs(M-C.right),G=Math.min(B,U);let $;const Y=y/u*(m+1);if(C.isDash){const Q=m-Math.abs(Y);$=Math.sqrt(G*G+Q*Q)}else $=m-Math.sqrt(G*G+Y*Y);this.data[w+M]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const C=t[E],M=t[E+1];C.zeroLength?t.splice(E,1):M&&M.isDash===C.isDash&&(M.left=C.left,t.splice(E,1))}const a=t[0],u=t[t.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const m=this.width*this.nextRow;let y=0,w=t[y];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++y]);const C=Math.abs(E-w.left),M=Math.abs(E-w.right),B=Math.min(C,M);this.data[m+E]=Math.max(0,Math.min(255,(w.isDash?B:-B)+128))}}addDash(t,a){const u=a?7:0,m=2*u+1;if(this.nextRow+m>this.height)return s.warnOnce("LineAtlas out of space"),null;let y=0;for(let E=0;E<t.length;E++)y+=t[E];if(y!==0){const E=this.width/y,C=this.getDashRanges(t,this.width,E);a?this.addRoundDash(C,E,u):this.addRegularDash(C)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:y};return this.nextRow+=m,this.dirty=!0,w}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class dt{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const u=this.workerPool.acquire(this.id);for(let m=0;m<u.length;m++){const y=new dt.Actor(u[m],a,this.id);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a,u){s.asyncAll(this.actors,(m,y)=>{m.send(t,a,y)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function yi(f,t,a){const u=function(m,y){if(m)return a(m);if(y){const w=s.pick(s.extend(y,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(w.vectorLayers=y.vector_layers,w.vectorLayerIds=w.vectorLayers.map(E=>E.id)),a(null,w)}};return f.url?s.getJSON(t.transformRequest(f.url,s.ResourceType.Source),u):s.exported.frame(()=>u(null,f))}dt.Actor=s.Actor;class gt{constructor(t,a,u){this.bounds=s.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),u=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),m=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),y=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),w=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return t.x>=u&&t.x<y&&t.y>=m&&t.y<w}}class ni extends s.Evented{constructor(t,a,u,m){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(a,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yi(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new s.ErrorEvent(t)):a&&(s.extend(this,a),a.bounds&&(this.tileBounds=new gt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(t,a){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(u,s.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(w,E){return delete t.request,t.aborted?a(null):w&&w.status!==404?a(w):(E&&E.resourceTiming&&(t.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&t.setExpiryData(E),t.loadVectorData(E,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",m,y.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",m,y.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class er extends s.Evented{constructor(t,a,u,m){super(),this.id=t,this.dispatcher=u,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yi(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.ErrorEvent(t)):a&&(s.extend(this,a),a.bounds&&(this.tileBounds=new gt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=s.getImage(this.map._requestManager.transformRequest(u,s.ResourceType.Tile),(m,y,w)=>{if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(m)t.state="errored",a(m);else if(y){this.map._refreshExpiredTiles&&t.setExpiryData(w);const E=this.map.painter.context,C=E.gl;t.texture=this.map.painter.getTileTexture(y.width),t.texture?t.texture.update(y,{useMipmap:!0}):(t.texture=new R(E,y,C.RGBA,{useMipmap:!0}),t.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&C.texParameterf(C.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),t.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),a(null)}})}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}let ti;class xt extends er{constructor(t,a,u,m){super(t,a,u,m),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,a){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function m(y,w){y&&(t.state="errored",a(y)),w&&(t.dem=w,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",a(null))}t.request=s.getImage(this.map._requestManager.transformRequest(u,s.ResourceType.Tile),(function(y,w){if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(y)t.state="errored",a(y);else if(w){this.map._refreshExpiredTiles&&t.setExpiryData(w),delete w.cacheControl,delete w.expires;const E=s.isImageBitmap(w)&&(ti==null&&(ti=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ti)?w:s.exported.getImageData(w,1),C={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:E,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,m.bind(this)))}}).bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const a=t.canonical,u=Math.pow(2,a.z),m=(a.x-1+u)%u,y=a.x===0?t.wrap-1:t.wrap,w=(a.x+1+u)%u,E=a.x+1===u?t.wrap+1:t.wrap,C={};return C[new s.OverscaledTileID(t.overscaledZ,y,a.z,m,a.y).key]={backfilled:!1},C[new s.OverscaledTileID(t.overscaledZ,E,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(C[new s.OverscaledTileID(t.overscaledZ,y,a.z,m,a.y-1).key]={backfilled:!1},C[new s.OverscaledTileID(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},C[new s.OverscaledTileID(t.overscaledZ,E,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<u&&(C[new s.OverscaledTileID(t.overscaledZ,y,a.z,m,a.y+1).key]={backfilled:!1},C[new s.OverscaledTileID(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},C[new s.OverscaledTileID(t.overscaledZ,E,a.z,w,a.y+1).key]={backfilled:!1}),C}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class mr extends s.Evented{constructor(t,a,u,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(m),this._data=a.data,this._options=s.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const y=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*y,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*y,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:s.EXTENT,radius:(a.clusterRadius||50)*y,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},a),this}getClusterChildren(t,a){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},a),this}getClusterLeaves(t,a,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:a,offset:u},m),this}_updateWorkerData(t){const a=s.extend({},this.workerOptions),u=this._data;typeof u=="string"?(a.request=this.map._requestManager.transformRequest(s.exported.resolveURL(u),s.ResourceType.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(u),this._pendingLoads++,this.fire(new s.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(m,y)=>{if(this._pendingLoads--,this._removed||y&&y.abandoned)return void this.fire(new s.Event("dataabort",{dataType:"source",sourceDataType:t}));let w=null;if(y&&y.resourceTiming&&y.resourceTiming[this.id]&&(w=y.resourceTiming[this.id].slice(0)),m)return void this.fire(new s.ErrorEvent(m));const E={dataType:"source",sourceDataType:t};this._collectResourceTiming&&w&&w.length>0&&s.extend(E,{resourceTiming:w}),this.fire(new s.Event("data",E))})}loaded(){return this._pendingLoads===0}loadTile(t,a){const u=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const m={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(u,m,(y,w)=>(delete t.request,t.unloadVectorData(),t.aborted?a(null):y?a(y):(t.loadVectorData(w,this.map.painter,u==="reloadTile"),a(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Si=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Lt extends s.Evented{constructor(t,a,u,m){super(),this.id=t,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=a}load(t,a){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(u,m)=>{this._loaded=!0,u?this.fire(new s.ErrorEvent(u)):m&&(this.image=m,t&&(this.coordinates=t),a&&a(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const a=t.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(m){let y=1/0,w=1/0,E=-1/0,C=-1/0;for(const G of m)y=Math.min(y,G.x),w=Math.min(w,G.y),E=Math.max(E,G.x),C=Math.max(C,G.y);const M=Math.max(E-y,C-w),B=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),U=Math.pow(2,B);return new s.CanonicalTileID(B,Math.floor((y+E)/2*U),Math.floor((w+C)/2*U))}(a),this.minzoom=this.maxzoom=this.tileID.z;const u=a.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new s.RasterBoundsArray,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(u[2].x,u[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Si.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new R(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ri extends Lt{constructor(t,a,u,m){super(t,a,u,m),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,s.ResourceType.Source).url);s.getVideo(this.urls,(a,u)=>{this._loaded=!0,a?this.fire(new s.ErrorEvent(a)):u&&(this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Si.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new R(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Mi extends Lt{constructor(t,a,u,m){super(t,a,u,m),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(w=>typeof w!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,u=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Si.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new R(a,this.canvas,u.RGBA,{premultiply:!0});for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ai={vector:ni,raster:er,"raster-dem":xt,geojson:mr,video:Ri,image:Lt,canvas:Mi};function ur(f,t){const a=s.create();return s.translate(a,a,[1,1,0]),s.scale(a,a,[.5*f.width,.5*f.height,1]),s.multiply(a,a,f.calculatePosMatrix(t.toUnwrapped()))}function Ui(f,t,a,u,m,y){const w=function(U,G,$){if(U)for(const Y of U){const Q=G[Y];if(Q&&Q.source===$&&Q.type==="fill-extrusion")return!0}else for(const Y in G){const Q=G[Y];if(Q.source===$&&Q.type==="fill-extrusion")return!0}return!1}(m&&m.layers,t,f.id),E=y.maxPitchScaleFactor(),C=f.tilesIn(u,E,w);C.sort(Ki);const M=[];for(const U of C)M.push({wrappedTileID:U.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(t,a,f._state,U.queryGeometry,U.cameraQueryGeometry,U.scale,m,y,E,ur(f.transform,U.tileID))});const B=function(U){const G={},$={};for(const Y of U){const Q=Y.queryResults,le=Y.wrappedTileID,de=$[le]=$[le]||{};for(const _e in Q){const ee=Q[_e],we=de[_e]=de[_e]||{},ye=G[_e]=G[_e]||[];for(const Me of ee)we[Me.featureIndex]||(we[Me.featureIndex]=!0,ye.push(Me))}}return G}(M);for(const U in B)B[U].forEach(G=>{const $=G.feature,Y=f.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=Y});return B}function Ki(f,t){const a=f.tileID,u=t.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}class gr{constructor(t,a){this.tileID=t,this.uid=s.uniqueId(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<s.exported.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(a=>t.saveTileTexture(a)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,y){const w={};if(!y)return w;for(const E of m){const C=E.layerIds.map(M=>y.getLayer(M)).filter(Boolean);if(C.length!==0){E.layers=C,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(M=>C.filter(B=>B.id===M)[0]));for(const M of C)w[M.id]=E}}return w}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof s.SymbolBucket){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof s.SymbolBucket&&y.hasRTLText){this.hasRTLText=!0,s.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(m).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new s.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const m=this.buckets[u];m.uploadPending()&&m.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new R(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new R(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,u,m,y,w,E,C,M,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:w,tileSize:this.tileSize,pixelPosMatrix:B,transform:C,params:E,queryPadding:this.queryPadding*M},t,a,u):{}}querySourceFeatures(t,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const m=u.loadVTLayers(),y=a?a.sourceLayer:"",w=m._geojsonTileLayer||m[y];if(!w)return;const E=s.createFilter(a&&a.filter),{z:C,x:M,y:B}=this.tileID.canonical,U={z:C,x:M,y:B};for(let G=0;G<w.length;G++){const $=w.feature(G);if(E.needGeometry){const le=s.toEvaluationFeature($,!0);if(!E.filter(new s.EvaluationParameters(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!E.filter(new s.EvaluationParameters(this.tileID.overscaledZ),$))continue;const Y=u.getId($,y),Q=new s.GeoJSONFeature($,C,M,B,Y);Q.tile=U,t.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const u=s.parseCacheControl(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let m=!1;if(this.expirationTime>u)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{const y=this.expirationTime-a;y?this.expirationTime=u+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!a.style.hasLayer(m))continue;const y=this.buckets[m],w=y.layers[0].sourceLayer||"_geojsonTileLayer",E=u[w],C=t[w];if(!E||!C||Object.keys(C).length===0)continue;y.update(C,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=a&&a.style&&a.style.getLayer(m);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.exported.now()+t}setDependencies(t,a){const u={};for(const m of a)u[m]=!0;this.dependencies[t]=u}hasDependency(t,a){for(const u of t){const m=this.dependencies[u];if(m){for(const y of a)if(m[y])return!0}}return!1}}class _r{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,u){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:a,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},u)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const u=t.wrapped().key,m=a===void 0?0:this.data[u].indexOf(a),y=this.data[u][m];return this.data[u].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const u in this.data)for(const m of this.data[u])t(m.value)||a.push(m);for(const u of a)this.remove(u.value.tileID,u)}}class Tr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,u){const m=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},s.extend(this.stateChanges[t][m],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==m&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const y in this.state[t][m])u[y]||(this.deletedStates[t][m][y]=null)}else for(const y in u)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][y]===null&&delete this.deletedStates[t][m][y]}removeFeatureState(t,a,u){if(this.deletedStates[t]===null)return;const m=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&a!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][u]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(u in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][u]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,a){const u=String(a),m=s.extend({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const y=this.deletedStates[t][a];if(y===null)return{};for(const w in y)delete m[w]}return m}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const u={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),s.extend(this.state[m][w],this.stateChanges[m][w]),y[w]=this.state[m][w];u[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const w in this.state[m])y[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else for(const E of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][E];y[w]=this.state[m][w]}u[m]=u[m]||{},s.extend(u[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const m in t)t[m].setFeatureState(u,a)}}class He extends s.Evented{constructor(t,a,u){super(),this.id=t,this.dispatcher=u,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(m,y,w,E){const C=new Ai[y.type](m,y,w,E);if(C.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${C.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],C),C}(t,a,u,this),this._tiles={},this._cache=new _r(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Tr}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a){return this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new s.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(hi).map(t=>t.key)}getRenderableIds(t){const a=[];for(const u in this._tiles)this._isIdRenderable(u,t)&&a.push(this._tiles[u]);return t?a.sort((u,m)=>{const y=u.tileID,w=m.tileID,E=new s.pointGeometry(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),C=new s.pointGeometry(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-w.overscaledZ||C.y-E.y||C.x-E.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(hi).map(u=>u.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,a){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,t,a)))}_tileLoaded(t,a,u,m){if(m)return t.state="errored",void(m.status!==404?this._source.fire(new s.ErrorEvent(m,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=s.exported.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let m=0;m<a.length;m++){const y=a[m];if(t.neighboringTiles&&t.neighboringTiles[y]){const w=this.getTileByID(y);u(t,w),u(w,t)}}function u(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let w=y.tileID.canonical.x-m.tileID.canonical.x;const E=y.tileID.canonical.y-m.tileID.canonical.y,C=Math.pow(2,m.tileID.canonical.z),M=y.tileID.key;w===0&&E===0||Math.abs(E)>1||(Math.abs(w)>1&&(Math.abs(w+C)===1?w+=C:Math.abs(w-C)===1&&(w-=C)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,w,E),m.neighboringTiles&&m.neighboringTiles[M]&&(m.neighboringTiles[M].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,u,m){for(const y in this._tiles){let w=this._tiles[y];if(m[y]||!w.hasData()||w.tileID.overscaledZ<=a||w.tileID.overscaledZ>u)continue;let E=w.tileID;for(;w&&w.tileID.overscaledZ>a+1;){const M=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[M.key],w&&w.hasData()&&(E=M)}let C=E;for(;C.overscaledZ>a;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){m[E.key]=E;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=t.overscaledZ-1;u>=a;u--){const m=t.scaledTo(u),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(a*u*5),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const u={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),u[y.tileID.key]=y}this._tiles=u;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(t,a){if(this.transform=t,this.terrain=a,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new s.OverscaledTileID(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(u=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(u=u.filter(M=>this._source.hasTile(M)))):u=[];const m=t.coveringZoomLevel(this._source),y=Math.max(m-He.maxOverzooming,this._source.minzoom),w=Math.max(m+He.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const B of u)if(B.canonical.z>this._source.minzoom){const U=B.scaledTo(B.canonical.z-1);M[U.key]=U;const G=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));M[G.key]=G}u=u.concat(Object.values(M))}const E=this._updateRetainedTiles(u,m);if(Ni(this._source.type)){const M={},B={},U=Object.keys(E);for(const G of U){const $=E[G],Y=this._tiles[G];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=s.exported.now())continue;const Q=this.findLoadedParent($,y);Q&&(this._addTile(Q.tileID),M[Q.tileID.key]=Q.tileID),B[G]=$}this._retainLoadedChildren(B,m,w,E);for(const G in M)E[G]||(this._coveredTiles[G]=!0,E[G]=M[G]);if(a){const G={},$={};for(const Y of u)this._tiles[Y.key].hasData()?G[Y.key]=Y:$[Y.key]=Y;for(const Y in $){const Q=$[Y].children(this._source.maxzoom);this._tiles[Q[0].key]&&this._tiles[Q[1].key]&&this._tiles[Q[2].key]&&this._tiles[Q[3].key]&&(G[Q[0].key]=E[Q[0].key]=Q[0],G[Q[1].key]=E[Q[1].key]=Q[1],G[Q[2].key]=E[Q[2].key]=Q[2],G[Q[3].key]=E[Q[3].key]=Q[3],delete $[Y])}for(const Y in $){const Q=this.findLoadedParent($[Y],this._source.minzoom);if(Q){G[Q.tileID.key]=E[Q.tileID.key]=Q.tileID;for(const le in G)G[le].isChildOf(Q.tileID)&&delete G[le]}}for(const Y in this._tiles)G[Y]||(this._coveredTiles[Y]=!0)}}for(const M in E)this._tiles[M].clearFadeHold();const C=s.keysDifference(this._tiles,E);for(const M of C){const B=this._tiles[M];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){const u={},m={},y=Math.max(a-He.maxOverzooming,this._source.minzoom),w=Math.max(a+He.maxUnderzooming,this._source.minzoom),E={};for(const C of t){const M=this._addTile(C);u[C.key]=C,M.hasData()||a<this._source.maxzoom&&(E[C.key]=C)}this._retainLoadedChildren(E,a,w,u);for(const C of t){let M=this._tiles[C.key];if(M.hasData())continue;if(a+1>this._source.maxzoom){const U=C.children(this._source.maxzoom)[0],G=this.getTile(U);if(G&&G.hasData()){u[U.key]=U;continue}}else{const U=C.children(this._source.maxzoom);if(u[U[0].key]&&u[U[1].key]&&u[U[2].key]&&u[U[3].key])continue}let B=M.wasRequested();for(let U=C.overscaledZ-1;U>=y;--U){const G=C.scaledTo(U);if(m[G.key]||(m[G.key]=!0,M=this.getTile(G),!M&&B&&(M=this._addTile(G)),M&&(u[G.key]=G,B=M.wasRequested(),M.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let u,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){u=this._loadedParentTiles[m.key];break}a.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;m=y}for(const y of a)this._loadedParentTiles[y]=u}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const u=a;return a||(a=new gr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))),a.uses++,this._tiles[t.key]=a,u||this._source.fire(new s.Event("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=a.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,u){const m=[],y=this.transform;if(!y)return m;const w=u?y.getCameraQueryGeometry(t):t,E=t.map(Y=>y.pointCoordinate(Y,this.terrain)),C=w.map(Y=>y.pointCoordinate(Y,this.terrain)),M=this.getIds();let B=1/0,U=1/0,G=-1/0,$=-1/0;for(const Y of C)B=Math.min(B,Y.x),U=Math.min(U,Y.y),G=Math.max(G,Y.x),$=Math.max($,Y.y);for(let Y=0;Y<M.length;Y++){const Q=this._tiles[M[Y]];if(Q.holdingForFade())continue;const le=Q.tileID,de=Math.pow(2,y.zoom-Q.tileID.overscaledZ),_e=a*Q.queryPadding*s.EXTENT/Q.tileSize/de,ee=[le.getTilePoint(new s.MercatorCoordinate(B,U)),le.getTilePoint(new s.MercatorCoordinate(G,$))];if(ee[0].x-_e<s.EXTENT&&ee[0].y-_e<s.EXTENT&&ee[1].x+_e>=0&&ee[1].y+_e>=0){const we=E.map(Me=>le.getTilePoint(Me)),ye=C.map(Me=>le.getTilePoint(Me));m.push({tile:Q,tileID:le,queryGeometry:we,cameraQueryGeometry:ye,scale:de})}}return m}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of a)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Ni(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=s.exported.now())return!0}return!1}setFeatureState(t,a,u){this._state.updateState(t=t||"_geojsonTileLayer",a,u)}removeFeatureState(t,a,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,u)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,u){const m=this._tiles[t];m&&m.setDependencies(a,u)}reloadTilesForDependencies(t,a){for(const u in this._tiles)this._tiles[u].hasDependency(t,a)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(t,a))}}function hi(f,t){const a=Math.abs(2*f.wrap)-+(f.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||u-a||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function Ni(f){return f==="raster"||f==="image"||f==="video"}He.maxOverzooming=10,He.maxUnderzooming=3;const Rr="mapboxgl_preloaded_worker_pool";class kr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<kr.workerCount;)this.workers.push(new Worker(Nn.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Rr]}numActive(){return Object.keys(this.active).length}}const Is=Math.floor(s.exported.hardwareConcurrency/2);let vn;function $n(){return vn||(vn=new kr),vn}function es(f,t){const a={};for(const u in f)u!=="ref"&&(a[u]=f[u]);return s.refProperties.forEach(u=>{u in t&&(a[u]=t[u])}),a}function Cs(f){f=f.slice();const t=Object.create(null);for(let a=0;a<f.length;a++)t[f[a].id]=f[a];for(let a=0;a<f.length;a++)"ref"in f[a]&&(f[a]=es(f[a],t[f[a].ref]));return f}kr.workerCount=Math.max(Math.min(Is,6),1);const Zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Yr(f,t,a){a.push({command:Zt.addSource,args:[f,t[f]]})}function xn(f,t,a){t.push({command:Zt.removeSource,args:[f]}),a[f]=!0}function bn(f,t,a,u){xn(f,a,u),Yr(f,t,a)}function As(f,t,a){let u;for(u in f[a])if(Object.prototype.hasOwnProperty.call(f[a],u)&&u!=="data"&&!P(f[a][u],t[a][u]))return!1;for(u in t[a])if(Object.prototype.hasOwnProperty.call(t[a],u)&&u!=="data"&&!P(f[a][u],t[a][u]))return!1;return!0}function an(f,t,a,u,m,y){let w;for(w in t=t||{},f=f||{})Object.prototype.hasOwnProperty.call(f,w)&&(P(f[w],t[w])||a.push({command:y,args:[u,w,t[w],m]}));for(w in t)Object.prototype.hasOwnProperty.call(t,w)&&!Object.prototype.hasOwnProperty.call(f,w)&&(P(f[w],t[w])||a.push({command:y,args:[u,w,t[w],m]}))}function on(f){return f.id}function ts(f,t){return f[t.id]=t,f}class ln{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.clamp(t,0,1);let a=1,u=this._distances[a];const m=t*this.paddedLength+this.padding;for(;u<m&&a<this._distances.length;)u=this._distances[++a];const y=a-1,w=this._distances[y],E=u-w,C=E>0?(m-w)/E:0;return this.points[y].mult(1-C).add(this.points[a].mult(C))}}function De(f,t){let a=!0;return f==="always"||f!=="never"&&t!=="never"||(a=!1),a}class Qe{constructor(t,a,u){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(a/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,u,m,y){this._forEachCell(a,u,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(t,a,u,m){this._forEachCell(a-m,u-m,a+m,u+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(u),this.circles.push(m)}_insertBoxCell(t,a,u,m,y,w){this.boxCells[y].push(w)}_insertCircleCell(t,a,u,m,y,w){this.circleCells[y].push(w)}_query(t,a,u,m,y,w,E){if(u<0||t>this.width||m<0||a>this.height)return[];const C=[];if(t<=0&&a<=0&&this.width<=u&&this.height<=m){if(y)return[{key:null,x1:t,y1:a,x2:u,y2:m}];for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const B=this.circles[3*M],U=this.circles[3*M+1],G=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:B-G,y1:U-G,x2:B+G,y2:U+G})}}else this._forEachCell(t,a,u,m,this._queryCell,C,{hitTest:y,overlapMode:w,seenUids:{box:{},circle:{}}},E);return C}query(t,a,u,m){return this._query(t,a,u,m,!1,null)}hitTest(t,a,u,m,y,w){return this._query(t,a,u,m,!0,y,w).length>0}hitTestCircle(t,a,u,m,y){const w=t-u,E=t+u,C=a-u,M=a+u;if(E<0||w>this.width||M<0||C>this.height)return!1;const B=[];return this._forEachCell(w,C,E,M,this._queryCellCircle,B,{hitTest:!0,overlapMode:m,circle:{x:t,y:a,radius:u},seenUids:{box:{},circle:{}}},y),B.length>0}_queryCell(t,a,u,m,y,w,E,C){const{seenUids:M,hitTest:B,overlapMode:U}=E,G=this.boxCells[y];if(G!==null){const Y=this.bboxes;for(const Q of G)if(!M.box[Q]){M.box[Q]=!0;const le=4*Q,de=this.boxKeys[Q];if(t<=Y[le+2]&&a<=Y[le+3]&&u>=Y[le+0]&&m>=Y[le+1]&&(!C||C(de))&&(!B||!De(U,de.overlapMode))&&(w.push({key:de,x1:Y[le],y1:Y[le+1],x2:Y[le+2],y2:Y[le+3]}),B))return!0}}const $=this.circleCells[y];if($!==null){const Y=this.circles;for(const Q of $)if(!M.circle[Q]){M.circle[Q]=!0;const le=3*Q,de=this.circleKeys[Q];if(this._circleAndRectCollide(Y[le],Y[le+1],Y[le+2],t,a,u,m)&&(!C||C(de))&&(!B||!De(U,de.overlapMode))){const _e=Y[le],ee=Y[le+1],we=Y[le+2];if(w.push({key:de,x1:_e-we,y1:ee-we,x2:_e+we,y2:ee+we}),B)return!0}}}return!1}_queryCellCircle(t,a,u,m,y,w,E,C){const{circle:M,seenUids:B,overlapMode:U}=E,G=this.boxCells[y];if(G!==null){const Y=this.bboxes;for(const Q of G)if(!B.box[Q]){B.box[Q]=!0;const le=4*Q,de=this.boxKeys[Q];if(this._circleAndRectCollide(M.x,M.y,M.radius,Y[le+0],Y[le+1],Y[le+2],Y[le+3])&&(!C||C(de))&&!De(U,de.overlapMode))return w.push(!0),!0}}const $=this.circleCells[y];if($!==null){const Y=this.circles;for(const Q of $)if(!B.circle[Q]){B.circle[Q]=!0;const le=3*Q,de=this.circleKeys[Q];if(this._circlesCollide(Y[le],Y[le+1],Y[le+2],M.x,M.y,M.radius)&&(!C||C(de))&&!De(U,de.overlapMode))return w.push(!0),!0}}}_forEachCell(t,a,u,m,y,w,E,C){const M=this._convertToXCellCoord(t),B=this._convertToYCellCoord(a),U=this._convertToXCellCoord(u),G=this._convertToYCellCoord(m);for(let $=M;$<=U;$++)for(let Y=B;Y<=G;Y++)if(y.call(this,t,a,u,m,this.xCellCount*Y+$,w,E,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,u,m,y,w){const E=m-t,C=y-a,M=u+w;return M*M>E*E+C*C}_circleAndRectCollide(t,a,u,m,y,w,E){const C=(w-m)/2,M=Math.abs(t-(m+C));if(M>C+u)return!1;const B=(E-y)/2,U=Math.abs(a-(y+B));if(U>B+u)return!1;if(M<=C||U<=B)return!0;const G=M-C,$=U-B;return G*G+$*$<=u*u}}function Dn(f,t,a,u,m){const y=s.create();return t?(s.scale(y,y,[1/m,1/m,1]),a||s.rotateZ(y,y,u.angle)):s.multiply(y,u.labelPlaneMatrix,f),y}function jr(f,t,a,u,m){if(t){const y=s.clone(f);return s.scale(y,y,[m,m,1]),a||s.rotateZ(y,y,-u.angle),y}return u.glCoordMatrix}function Xt(f,t,a){let u;a?(u=[f.x,f.y,a(f.x,f.y),1],s.transformMat4(u,u,t)):(u=[f.x,f.y,0,1],cn(u,u,t));const m=u[3];return{point:new s.pointGeometry(u[0]/m,u[1]/m),signedDistanceFromCamera:m}}function Fr(f,t){return .5+f/t*.5}function Er(f,t){const a=f[0]/f[3],u=f[1]/f[3];return a>=-t[0]&&a<=t[0]&&u>=-t[1]&&u<=t[1]}function Sr(f,t,a,u,m,y,w,E,C,M){const B=u?f.textSizeData:f.iconSizeData,U=s.evaluateSizeForZoom(B,a.transform.zoom),G=[256/a.width*2+1,256/a.height*2+1],$=u?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;$.clear();const Y=f.lineVertexArray,Q=u?f.text.placedSymbolArray:f.icon.placedSymbolArray,le=a.transform.width/a.transform.height;let de=!1;for(let _e=0;_e<Q.length;_e++){const ee=Q.get(_e);if(ee.hidden||ee.writingMode===s.WritingMode.vertical&&!de){Mt(ee.numGlyphs,$);continue}let we;if(de=!1,M?(we=[ee.anchorX,ee.anchorY,M(ee.anchorX,ee.anchorY),1],s.transformMat4(we,we,t)):(we=[ee.anchorX,ee.anchorY,0,1],cn(we,we,t)),!Er(we,G)){Mt(ee.numGlyphs,$);continue}const ye=Fr(a.transform.cameraToCenterDistance,we[3]),Me=s.evaluateSizeForFeature(B,U,ee),Pe=w?Me/ye:Me*ye,je=new s.pointGeometry(ee.anchorX,ee.anchorY),Ae=Xt(je,m,M).point,nt={},Je=Rt(ee,Pe,!1,E,t,m,y,f.glyphOffsetArray,Y,$,Ae,je,nt,le,C,M);de=Je.useVertical,(Je.notEnoughRoom||de||Je.needsFlipping&&Rt(ee,Pe,!0,E,t,m,y,f.glyphOffsetArray,Y,$,Ae,je,nt,le,C,M).notEnoughRoom)&&Mt(ee.numGlyphs,$)}u?f.text.dynamicLayoutVertexBuffer.updateData($):f.icon.dynamicLayoutVertexBuffer.updateData($)}function wn(f,t,a,u,m,y,w,E,C,M,B,U,G){const $=E.glyphStartIndex+E.numGlyphs,Y=E.lineStartIndex,Q=E.lineStartIndex+E.lineLength,le=t.getoffsetX(E.glyphStartIndex),de=t.getoffsetX($-1),_e=Ji(f*le,a,u,m,y,w,E.segment,Y,Q,C,M,B,U,G);if(!_e)return null;const ee=Ji(f*de,a,u,m,y,w,E.segment,Y,Q,C,M,B,U,G);return ee?{first:_e,last:ee}:null}function Ke(f,t,a,u){return f===s.WritingMode.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*u?{useVertical:!0}:(f===s.WritingMode.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Rt(f,t,a,u,m,y,w,E,C,M,B,U,G,$,Y,Q){const le=t/24,de=f.lineOffsetX*le,_e=f.lineOffsetY*le;let ee;if(f.numGlyphs>1){const we=f.glyphStartIndex+f.numGlyphs,ye=f.lineStartIndex,Me=f.lineStartIndex+f.lineLength,Pe=wn(le,E,de,_e,a,B,U,f,C,y,G,Y,Q);if(!Pe)return{notEnoughRoom:!0};const je=Xt(Pe.first.point,w,Q).point,Ae=Xt(Pe.last.point,w,Q).point;if(u&&!a){const nt=Ke(f.writingMode,je,Ae,$);if(nt)return nt}ee=[Pe.first];for(let nt=f.glyphStartIndex+1;nt<we-1;nt++)ee.push(Ji(le*E.getoffsetX(nt),de,_e,a,B,U,f.segment,ye,Me,C,y,G,Y,Q));ee.push(Pe.last)}else{if(u&&!a){const ye=Xt(U,m,Q).point,Me=f.lineStartIndex+f.segment+1,Pe=new s.pointGeometry(C.getx(Me),C.gety(Me)),je=Xt(Pe,m,Q),Ae=je.signedDistanceFromCamera>0?je.point:Pt(U,Pe,ye,1,m,Q),nt=Ke(f.writingMode,ye,Ae,$);if(nt)return nt}const we=Ji(le*E.getoffsetX(f.glyphStartIndex),de,_e,a,B,U,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,C,y,G,Y,Q);if(!we)return{notEnoughRoom:!0};ee=[we]}for(const we of ee)s.addDynamicAttributes(M,we.point,we.angle);return{}}function Pt(f,t,a,u,m,y){const w=Xt(f.add(f.sub(t)._unit()),m,y).point,E=a.sub(w);return a.add(E._mult(u/E.mag()))}function Ji(f,t,a,u,m,y,w,E,C,M,B,U,G,$){const Y=u?f-t:f+t;let Q=Y>0?1:-1,le=0;u&&(Q*=-1,le=Math.PI),Q<0&&(le+=Math.PI);let de=Q>0?E+w:E+w+1,_e=m,ee=m,we=0,ye=0;const Me=Math.abs(Y),Pe=[];for(;we+ye<=Me;){if(de+=Q,de<E||de>=C)return null;if(ee=_e,Pe.push(_e),_e=U[de],_e===void 0){const ot=new s.pointGeometry(M.getx(de),M.gety(de)),Dt=Xt(ot,B,$);if(Dt.signedDistanceFromCamera>0)_e=U[de]=Dt.point;else{const Ot=de-Q;_e=Pt(we===0?y:new s.pointGeometry(M.getx(Ot),M.gety(Ot)),ot,ee,Me-we+1,B,$)}}we+=ye,ye=ee.dist(_e)}const je=(Me-we)/ye,Ae=_e.sub(ee),nt=Ae.mult(je)._add(ee);nt._add(Ae._unit()._perp()._mult(a*Q));const Je=le+Math.atan2(_e.y-ee.y,_e.x-ee.x);return Pe.push(nt),{point:nt,angle:G?Je:0,path:Pe}}const Tn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Mt(f,t){for(let a=0;a<f;a++){const u=t.length;t.resize(u+4),t.float32.set(Tn,3*u)}}function cn(f,t,a){const u=t[0],m=t[1];return f[0]=a[0]*u+a[4]*m+a[12],f[1]=a[1]*u+a[5]*m+a[13],f[3]=a[3]*u+a[7]*m+a[15],f}const ji=100;class is{constructor(t,a=new Qe(t.width+200,t.height+200,25),u=new Qe(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=u,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ji,this.screenBottomBoundary=t.height+ji,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,u,m,y,w){const E=this.projectAndGetPerspectiveRatio(m,t.anchorPointX,t.anchorPointY,w),C=u*E.perspectiveRatio,M=t.x1*C+E.point.x,B=t.y1*C+E.point.y,U=t.x2*C+E.point.x,G=t.y2*C+E.point.y;return!this.isInsideGrid(M,B,U,G)||a!=="always"&&this.grid.hitTest(M,B,U,G,a,y)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[M,B,U,G],offscreen:this.isOffscreen(M,B,U,G)}}placeCollisionCircles(t,a,u,m,y,w,E,C,M,B,U,G,$,Y){const Q=[],le=new s.pointGeometry(a.anchorX,a.anchorY),de=Xt(le,w,Y),_e=Fr(this.transform.cameraToCenterDistance,de.signedDistanceFromCamera),ee=(B?y/_e:y*_e)/s.ONE_EM,we=Xt(le,E,Y).point,ye=wn(ee,m,a.lineOffsetX*ee,a.lineOffsetY*ee,!1,we,le,a,u,E,{},!1,Y);let Me=!1,Pe=!1,je=!0;if(ye){const Ae=.5*G*_e+$,nt=new s.pointGeometry(-100,-100),Je=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ot=new ln,Dt=ye.first,Ot=ye.last;let yt=[];for(let qt=Dt.path.length-1;qt>=1;qt--)yt.push(Dt.path[qt]);for(let qt=1;qt<Ot.path.length;qt++)yt.push(Ot.path[qt]);const $t=2.5*Ae;if(C){const qt=yt.map(Kt=>Xt(Kt,C,Y));yt=qt.some(Kt=>Kt.signedDistanceFromCamera<=0)?[]:qt.map(Kt=>Kt.point)}let ei=[];if(yt.length>0){const qt=yt[0].clone(),Kt=yt[0].clone();for(let ri=1;ri<yt.length;ri++)qt.x=Math.min(qt.x,yt[ri].x),qt.y=Math.min(qt.y,yt[ri].y),Kt.x=Math.max(Kt.x,yt[ri].x),Kt.y=Math.max(Kt.y,yt[ri].y);ei=qt.x>=nt.x&&Kt.x<=Je.x&&qt.y>=nt.y&&Kt.y<=Je.y?[yt]:Kt.x<nt.x||qt.x>Je.x||Kt.y<nt.y||qt.y>Je.y?[]:s.clipLine([yt],nt.x,nt.y,Je.x,Je.y)}for(const qt of ei){ot.reset(qt,.25*Ae);let Kt=0;Kt=ot.length<=.5*Ae?1:Math.ceil(ot.paddedLength/$t)+1;for(let ri=0;ri<Kt;ri++){const qi=ri/Math.max(Kt-1,1),tn=ot.lerp(qi),qr=tn.x+ji,rn=tn.y+ji;Q.push(qr,rn,Ae,0);const zn=qr-Ae,Vr=rn-Ae,vr=qr+Ae,fn=rn+Ae;if(je=je&&this.isOffscreen(zn,Vr,vr,fn),Pe=Pe||this.isInsideGrid(zn,Vr,vr,fn),t!=="always"&&this.grid.hitTestCircle(qr,rn,Ae,t,U)&&(Me=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Me}}}}return{circles:!M&&Me||!Pe||_e<this.perspectiveRatioCutoff?[]:Q,offscreen:je,collisionDetected:Me}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let u=1/0,m=1/0,y=-1/0,w=-1/0;for(const B of t){const U=new s.pointGeometry(B.x+ji,B.y+ji);u=Math.min(u,U.x),m=Math.min(m,U.y),y=Math.max(y,U.x),w=Math.max(w,U.y),a.push(U)}const E=this.grid.query(u,m,y,w).concat(this.ignoredGrid.query(u,m,y,w)),C={},M={};for(const B of E){const U=B.key;if(C[U.bucketInstanceId]===void 0&&(C[U.bucketInstanceId]={}),C[U.bucketInstanceId][U.featureIndex])continue;const G=[new s.pointGeometry(B.x1,B.y1),new s.pointGeometry(B.x2,B.y1),new s.pointGeometry(B.x2,B.y2),new s.pointGeometry(B.x1,B.y2)];s.polygonIntersectsPolygon(a,G)&&(C[U.bucketInstanceId][U.featureIndex]=!0,M[U.bucketInstanceId]===void 0&&(M[U.bucketInstanceId]=[]),M[U.bucketInstanceId].push(U.featureIndex))}return M}insertCollisionBox(t,a,u,m,y,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:w,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,u,m,y,w){const E=u?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:y,collisionGroupID:w,overlapMode:a};for(let M=0;M<t.length;M+=4)E.insertCircle(C,t[M],t[M+1],t[M+2])}projectAndGetPerspectiveRatio(t,a,u,m){let y;return m?(y=[a,u,m(a,u),1],s.transformMat4(y,y,t)):(y=[a,u,0,1],cn(y,y,t)),{point:new s.pointGeometry((y[0]/y[3]+1)/2*this.transform.width+ji,(-y[1]/y[3]+1)/2*this.transform.height+ji),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(t,a,u,m){return u<ji||t>=this.screenRightBoundary||m<ji||a>this.screenBottomBoundary}isInsideGrid(t,a,u,m){return u>=0&&t<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=s.identity([]);return s.translate(t,t,[-100,-100,0]),t}}function Pi(f,t,a){return t*(s.EXTENT/(f.tileSize*Math.pow(2,a-f.tileID.overscaledZ)))}class hr{constructor(t,a,u,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):m&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class ii{constructor(t,a,u,m,y){this.text=new hr(t?t.text:null,a,u,y),this.icon=new hr(t?t.icon:null,a,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rs{constructor(t,a,u){this.text=t,this.icon=a,this.skipFade=u}}class Qr{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Ln{constructor(t,a,u,m,y){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=m,this.tileID=y}}class Bn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[t]}}function ns(f,t,a,u,m){const{horizontalAlign:y,verticalAlign:w}=s.getAnchorAlignment(f),E=-(y-.5)*t,C=-(w-.5)*a,M=s.evaluateVariableOffset(f,u);return new s.pointGeometry(E+M[0]*m,C+M[1]*m)}function Rn(f,t,a,u,m,y){const{x1:w,x2:E,y1:C,y2:M,anchorPointX:B,anchorPointY:U}=f,G=new s.pointGeometry(t,a);return u&&G._rotate(m?y:-y),{x1:w+G.x,y1:C+G.y,x2:E+G.x,y2:M+G.y,anchorPointX:B,anchorPointY:U}}class J{constructor(t,a,u,m,y){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new is(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Bn(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,u,m){const y=u.getBucket(a),w=u.latestFeatureIndex;if(!y||!w||a.id!==y.layerIds[0])return;const E=u.collisionBoxArray,C=y.layers[0].layout,M=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),B=u.tileSize/s.EXTENT,U=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),G=C.get("text-pitch-alignment")==="map",$=C.get("text-rotation-alignment")==="map",Y=Pi(u,1,this.transform.zoom),Q=Dn(U,G,$,this.transform,Y);let le=null;if(G){const _e=jr(U,G,$,this.transform,Y);le=s.multiply([],this.transform.labelPlaneMatrix,_e)}this.retainedQueryData[y.bucketInstanceId]=new Ln(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,u.tileID);const de={bucket:y,layout:C,posMatrix:U,textLabelPlaneMatrix:Q,labelToScreenMatrix:le,scale:M,textPixelRatio:B,holdingForFade:u.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const _e of y.sortKeyRanges){const{sortKey:ee,symbolInstanceStart:we,symbolInstanceEnd:ye}=_e;t.push({sortKey:ee,symbolInstanceStart:we,symbolInstanceEnd:ye,parameters:de})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:de})}attemptAnchorPlacement(t,a,u,m,y,w,E,C,M,B,U,G,$,Y,Q,le){const de=[G.textOffset0,G.textOffset1],_e=ns(t,u,m,de,y),ee=this.collisionIndex.placeCollisionBox(Rn(a,_e.x,_e.y,w,E,this.transform.angle),U,C,M,B.predicate,le);if((!Q||this.collisionIndex.placeCollisionBox(Rn(Q,_e.x,_e.y,w,E,this.transform.angle),U,C,M,B.predicate,le).box.length!==0)&&ee.box.length>0){let we;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(we=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:de,width:u,height:m,anchor:t,textBoxScale:y,prevAnchor:we},this.markUsedJustification($,t,G,Y),$.allowVerticalPlacement&&(this.markUsedOrientation($,Y,G),this.placedOrientations[G.crossTileID]=Y),{shift:_e,placedGlyphBoxes:ee}}}placeLayerBucketPart(t,a,u){const{bucket:m,layout:y,posMatrix:w,textLabelPlaneMatrix:E,labelToScreenMatrix:C,textPixelRatio:M,holdingForFade:B,collisionBoxArray:U,partiallyEvaluatedTextSize:G,collisionGroup:$}=t.parameters,Y=y.get("text-optional"),Q=y.get("icon-optional"),le=s.getOverlapMode(y,"text-overlap","text-allow-overlap"),de=le==="always",_e=s.getOverlapMode(y,"icon-overlap","icon-allow-overlap"),ee=_e==="always",we=y.get("text-rotation-alignment")==="map",ye=y.get("text-pitch-alignment")==="map",Me=y.get("icon-text-fit")!=="none",Pe=y.get("symbol-z-order")==="viewport-y",je=de&&(ee||!m.hasIconData()||Q),Ae=ee&&(de||!m.hasTextData()||Y);!m.collisionArrays&&U&&m.deserializeCollisionBoxes(U);const nt=(Je,ot)=>{if(a[Je.crossTileID])return;if(B)return void(this.placements[Je.crossTileID]=new rs(!1,!1,!1));let Dt=!1,Ot=!1,yt=!0,$t=null,ei={box:null,offscreen:null},qt={box:null,offscreen:null},Kt=null,ri=null,qi=null,tn=0,qr=0,rn=0;ot.textFeatureIndex?tn=ot.textFeatureIndex:Je.useRuntimeCollisionCircles&&(tn=Je.featureIndex),ot.verticalTextFeatureIndex&&(qr=ot.verticalTextFeatureIndex);const zn=this.retainedQueryData[m.bucketInstanceId].tileID,Vr=this.terrain?(Fi,Ut)=>this.terrain.getElevation(zn,Fi,Ut):null;for(const Fi of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Ut=ot[Fi];Ut&&(Ut.elevation=Vr?Vr(Ut.anchorPointX,Ut.anchorPointY):0)}const vr=ot.textBox;if(vr){const Fi=Qt=>{let Zi=s.WritingMode.horizontal;if(m.allowVerticalPlacement&&!Qt&&this.prevPlacement){const Xi=this.prevPlacement.placedOrientations[Je.crossTileID];Xi&&(this.placedOrientations[Je.crossTileID]=Xi,Zi=Xi,this.markUsedOrientation(m,Zi,Je))}return Zi},Ut=(Qt,Zi)=>{if(m.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&ot.verticalTextBox){for(const Xi of m.writingModes)if(Xi===s.WritingMode.vertical?(ei=Zi(),qt=ei):ei=Qt(),ei&&ei.box&&ei.box.length)break}else ei=Qt()};if(y.get("text-variable-anchor")){let Qt=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Je.crossTileID]){const Ti=this.prevPlacement.variableOffsets[Je.crossTileID];Qt.indexOf(Ti.anchor)>0&&(Qt=Qt.filter(Ur=>Ur!==Ti.anchor),Qt.unshift(Ti.anchor))}const Zi=(Ti,Ur,jn)=>{const vo=Ti.x2-Ti.x1,_s=Ti.y2-Ti.y1,zl=Je.textBoxScale,xo=Me&&_e==="never"?Ur:null;let Mn={box:[],offscreen:!1};const Gn=le!=="never"?2*Qt.length:Qt.length;for(let qn=0;qn<Gn;++qn){const Sa=this.attemptAnchorPlacement(Qt[qn%Qt.length],Ti,vo,_s,zl,we,ye,M,w,$,qn>=Qt.length?le:"never",Je,m,jn,xo,Vr);if(Sa&&(Mn=Sa.placedGlyphBoxes,Mn&&Mn.box&&Mn.box.length)){Dt=!0,$t=Sa.shift;break}}return Mn};Ut(()=>Zi(vr,ot.iconBox,s.WritingMode.horizontal),()=>{const Ti=ot.verticalTextBox;return m.allowVerticalPlacement&&!(ei&&ei.box&&ei.box.length)&&Je.numVerticalGlyphVertices>0&&Ti?Zi(Ti,ot.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),ei&&(Dt=ei.box,yt=ei.offscreen);const Xi=Fi(ei&&ei.box);if(!Dt&&this.prevPlacement){const Ti=this.prevPlacement.variableOffsets[Je.crossTileID];Ti&&(this.variableOffsets[Je.crossTileID]=Ti,this.markUsedJustification(m,Ti.anchor,Je,Xi))}}else{const Qt=(Zi,Xi)=>{const Ti=this.collisionIndex.placeCollisionBox(Zi,le,M,w,$.predicate,Vr);return Ti&&Ti.box&&Ti.box.length&&(this.markUsedOrientation(m,Xi,Je),this.placedOrientations[Je.crossTileID]=Xi),Ti};Ut(()=>Qt(vr,s.WritingMode.horizontal),()=>{const Zi=ot.verticalTextBox;return m.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&Zi?Qt(Zi,s.WritingMode.vertical):{box:null,offscreen:null}}),Fi(ei&&ei.box&&ei.box.length)}}if(Kt=ei,Dt=Kt&&Kt.box&&Kt.box.length>0,yt=Kt&&Kt.offscreen,Je.useRuntimeCollisionCircles){const Fi=m.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex),Ut=s.evaluateSizeForFeature(m.textSizeData,G,Fi),Qt=y.get("text-padding");ri=this.collisionIndex.placeCollisionCircles(le,Fi,m.lineVertexArray,m.glyphOffsetArray,Ut,w,E,C,u,ye,$.predicate,Je.collisionCircleDiameter,Qt,Vr),ri.circles.length&&ri.collisionDetected&&!u&&s.warnOnce("Collisions detected, but collision boxes are not shown"),Dt=de||ri.circles.length>0&&!ri.collisionDetected,yt=yt&&ri.offscreen}if(ot.iconFeatureIndex&&(rn=ot.iconFeatureIndex),ot.iconBox){const Fi=Ut=>{const Qt=Me&&$t?Rn(Ut,$t.x,$t.y,we,ye,this.transform.angle):Ut;return this.collisionIndex.placeCollisionBox(Qt,_e,M,w,$.predicate,Vr)};qt&&qt.box&&qt.box.length&&ot.verticalIconBox?(qi=Fi(ot.verticalIconBox),Ot=qi.box.length>0):(qi=Fi(ot.iconBox),Ot=qi.box.length>0),yt=yt&&qi.offscreen}const fn=Y||Je.numHorizontalGlyphVertices===0&&Je.numVerticalGlyphVertices===0,Ea=Q||Je.numIconVertices===0;if(fn||Ea?Ea?fn||(Ot=Ot&&Dt):Dt=Ot&&Dt:Ot=Dt=Ot&&Dt,Dt&&Kt&&Kt.box&&this.collisionIndex.insertCollisionBox(Kt.box,le,y.get("text-ignore-placement"),m.bucketInstanceId,qt&&qt.box&&qr?qr:tn,$.ID),Ot&&qi&&this.collisionIndex.insertCollisionBox(qi.box,_e,y.get("icon-ignore-placement"),m.bucketInstanceId,rn,$.ID),ri&&(Dt&&this.collisionIndex.insertCollisionCircles(ri.circles,le,y.get("text-ignore-placement"),m.bucketInstanceId,tn,$.ID),u)){const Fi=m.bucketInstanceId;let Ut=this.collisionCircleArrays[Fi];Ut===void 0&&(Ut=this.collisionCircleArrays[Fi]=new Qr);for(let Qt=0;Qt<ri.circles.length;Qt+=4)Ut.circles.push(ri.circles[Qt+0]),Ut.circles.push(ri.circles[Qt+1]),Ut.circles.push(ri.circles[Qt+2]),Ut.circles.push(ri.collisionDetected?1:0)}if(Je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Je.crossTileID]=new rs(Dt||je,Ot||Ae,yt||m.justReloaded),a[Je.crossTileID]=!0};if(Pe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Je=m.getSortedSymbolIndexes(this.transform.angle);for(let ot=Je.length-1;ot>=0;--ot){const Dt=Je[ot];nt(m.symbolInstances.get(Dt),m.collisionArrays[Dt])}}else for(let Je=t.symbolInstanceStart;Je<t.symbolInstanceEnd;Je++)nt(m.symbolInstances.get(Je),m.collisionArrays[Je]);if(u&&m.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[m.bucketInstanceId];s.invert(Je.invProjMatrix,w),Je.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(t,a,u,m){let y;y=m===s.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(a)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const E of w)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=y>=0&&E!==y?0:u.crossTileID)}markUsedOrientation(t,a,u){const m=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,y=a===s.WritingMode.vertical?a:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const E of w)t.text.placedSymbolArray.get(E).placedOrientation=m;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const m=a?a.symbolFadeChange(t):1,y=a?a.opacities:{},w=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const C in this.placements){const M=this.placements[C],B=y[C];B?(this.opacities[C]=new ii(B,m,M.text,M.icon),u=u||M.text!==B.text.placed||M.icon!==B.icon.placed):(this.opacities[C]=new ii(null,m,M.text,M.icon,M.skipFade),u=u||M.text||M.icon)}for(const C in y){const M=y[C];if(!this.opacities[C]){const B=new ii(M,m,!1,!1);B.isHidden()||(this.opacities[C]=B,u=u||M.text.placed||M.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const u={};for(const m of a){const y=m.getBucket(t);y&&m.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,u,m.collisionBoxArray)}}updateBucketOpacities(t,a,u){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,y=new ii(null,0,!1,!1,!0),w=m.get("text-allow-overlap"),E=m.get("icon-allow-overlap"),C=m.get("text-variable-anchor"),M=m.get("text-rotation-alignment")==="map",B=m.get("text-pitch-alignment")==="map",U=m.get("icon-text-fit")!=="none",G=new ii(null,0,w&&(E||!t.hasIconData()||m.get("icon-optional")),E&&(w||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const $=(Y,Q,le)=>{for(let de=0;de<Q/4;de++)Y.opacityVertexArray.emplaceBack(le)};for(let Y=0;Y<t.symbolInstances.length;Y++){const Q=t.symbolInstances.get(Y),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:de,crossTileID:_e}=Q;let ee=this.opacities[_e];a[_e]?ee=y:ee||(ee=G,this.opacities[_e]=ee),a[_e]=!0;const we=Q.numIconVertices>0,ye=this.placedOrientations[Q.crossTileID],Me=ye===s.WritingMode.vertical,Pe=ye===s.WritingMode.horizontal||ye===s.WritingMode.horizontalOnly;if(le>0||de>0){const je=fe(ee.text);$(t.text,le,Me?Ce:je),$(t.text,de,Pe?Ce:je);const Ae=ee.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(ot=>{ot>=0&&(t.text.placedSymbolArray.get(ot).hidden=Ae||Me?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Ae||Pe?1:0);const nt=this.variableOffsets[Q.crossTileID];nt&&this.markUsedJustification(t,nt.anchor,Q,ye);const Je=this.placedOrientations[Q.crossTileID];Je&&(this.markUsedJustification(t,"left",Q,Je),this.markUsedOrientation(t,Je,Q))}if(we){const je=fe(ee.icon),Ae=!(U&&Q.verticalPlacedIconSymbolIndex&&Me);Q.placedIconSymbolIndex>=0&&($(t.icon,Q.numIconVertices,Ae?je:Ce),t.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=ee.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&($(t.icon,Q.numVerticalIconVertices,Ae?Ce:je),t.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=ee.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const je=t.collisionArrays[Y];if(je){let Ae=new s.pointGeometry(0,0);if(je.textBox||je.verticalTextBox){let Je=!0;if(C){const ot=this.variableOffsets[_e];ot?(Ae=ns(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale),M&&Ae._rotate(B?this.transform.angle:-this.transform.angle)):Je=!1}je.textBox&&D(t.textCollisionBox.collisionVertexArray,ee.text.placed,!Je||Me,Ae.x,Ae.y),je.verticalTextBox&&D(t.textCollisionBox.collisionVertexArray,ee.text.placed,!Je||Pe,Ae.x,Ae.y)}const nt=!!(!Pe&&je.verticalIconBox);je.iconBox&&D(t.iconCollisionBox.collisionVertexArray,ee.icon.placed,nt,U?Ae.x:0,U?Ae.y:0),je.verticalIconBox&&D(t.iconCollisionBox.collisionVertexArray,ee.icon.placed,!nt,U?Ae.x:0,U?Ae.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Y.invProjMatrix,t.placementViewportMatrix=Y.viewportMatrix,t.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function D(f,t,a,u,m){f.emplaceBack(t?1:0,a?1:0,u||0,m||0),f.emplaceBack(t?1:0,a?1:0,u||0,m||0),f.emplaceBack(t?1:0,a?1:0,u||0,m||0),f.emplaceBack(t?1:0,a?1:0,u||0,m||0)}const O=Math.pow(2,25),H=Math.pow(2,24),W=Math.pow(2,17),ne=Math.pow(2,16),ue=Math.pow(2,9),oe=Math.pow(2,8),se=Math.pow(2,1);function fe(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,a=Math.floor(127*f.opacity);return a*O+t*H+a*W+t*ne+a*ue+t*oe+a*se+t}const Ce=0;class Ue{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,u,m,y){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<w.length;)if(a.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1}}class Ie{constructor(t,a,u,m,y,w,E,C){this.placement=new J(t,a,w,E,C),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,a,u){const m=s.exported.now(),y=()=>{const w=s.exported.now()-m;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=a[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=E)&&(!w.maxzoom||w.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Ue(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ut=512/s.EXTENT/2;class ft{constructor(t,a,u){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(let m=0;m<a.length;m++){const y=a.get(m),w=y.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,t)})}}getScaledCoordinates(t,a){const u=ut/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*s.EXTENT+t.anchorX)*u),y:Math.floor((a.canonical.y*s.EXTENT+t.anchorY)*u)}}findMatches(t,a,u){const m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let y=0;y<t.length;y++){const w=t.get(y);if(w.crossTileID)continue;const E=this.indexedSymbolInstances[w.key];if(!E)continue;const C=this.getScaledCoordinates(w,a);for(const M of E)if(Math.abs(M.coord.x-C.x)<=m&&Math.abs(M.coord.y-C.y)<=m&&!u[M.crossTileID]){u[M.crossTileID]=!0,w.crossTileID=M.crossTileID;break}}}}class rt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const u in this.indexes){const m=this.indexes[u],y={};for(const w in m){const E=m[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),y[E.tileID.key]=E}this.indexes[u]=y}this.lng=t}addBucket(t,a,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>t.overscaledZ)for(const E in w){const C=w[E];C.tileID.isChildOf(t)&&C.findMatches(a.symbolInstances,t,m)}else{const E=w[t.scaledTo(Number(y)).key];E&&E.findMatches(a.symbolInstances,t,m)}}for(let y=0;y<a.symbolInstances.length;y++){const w=a.symbolInstances.get(y);w.crossTileID||(w.crossTileID=u.generate(),m[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ft(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const u in a.indexedSymbolInstances)for(const m of a.indexedSymbolInstances[u])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let a=!1;for(const u in this.indexes){const m=this.indexes[u];for(const y in m)t[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,m[y]),delete m[y],a=!0)}return a}}class kt{constructor(){this.layerIndexes={},this.crossTileIDs=new rt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,u){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new wt);let y=!1;const w={};m.handleWrapJump(u);for(const E of a){const C=E.getBucket(t);C&&t.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(E.tileID,C,this.crossTileIDs)&&(y=!0),w[C.bucketInstanceId]=!0)}return m.removeStaleBuckets(w)&&(y=!0),y}pruneUnusedLayers(t){const a={};t.forEach(u=>{a[u]=!0});for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}var Ht=s.createLayout([{name:"a_pos",type:"Int16",components:2}]);class zt extends s.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const a=this._tiles[t];a.textures.forEach(u=>u.destroy()),a.textures=[]}}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),s.ortho(u.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),this._tiles[u.key]=new gr(u,this.tileSize))}removeOutdated(t){const a={};this.renderHistory=this.renderHistory.filter((u,m)=>this.renderHistory.indexOf(u)===m).slice(0,this.renderHistorySize);for(const u of this._renderableTilesKeys)a[u]=!0;for(const u of this.renderHistory)a[u]=!0;for(const u in this._tiles)a[u]||(this._tiles[u].clearTextures(t),delete this._tiles[u])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const a={};for(const u of this._renderableTilesKeys){const m=this._tiles[u].tileID;if(m.canonical.equals(t.canonical)){const y=t.clone();y.posMatrix=new Float64Array(16),s.ortho(y.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),a[u]=y}else if(m.canonical.isChildOf(t.canonical)){const y=t.clone();y.posMatrix=new Float64Array(16);const w=m.canonical.z-t.canonical.z,E=m.canonical.x-(m.canonical.x>>w<<w),C=m.canonical.y-(m.canonical.y>>w<<w),M=s.EXTENT>>w;s.ortho(y.posMatrix,0,M,0,M,0,1),s.translate(y.posMatrix,y.posMatrix,[-E*M,-C*M,0]),a[u]=y}else if(t.canonical.isChildOf(m.canonical)){const y=t.clone();y.posMatrix=new Float64Array(16);const w=t.canonical.z-m.canonical.z,E=t.canonical.x-(t.canonical.x>>w<<w),C=t.canonical.y-(t.canonical.y>>w<<w),M=s.EXTENT>>w;s.ortho(y.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),s.translate(y.posMatrix,y.posMatrix,[E*M,C*M,0]),s.scale(y.posMatrix,y.posMatrix,[1/2**w,1/2**w,0]),a[u]=y}}return a}getSourceTile(t,a){const u=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>u.maxzoom&&(m=u.maxzoom),m<u.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!y||!y.dem)&&a)for(;m>=u.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(t.scaledTo(m--).key);return y}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(a=>a.timeLoaded>=t)}}class Ft{constructor(t,a,u){this.style=t,this.sourceCache=new zt(a),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.elevationOffset=typeof u.elevationOffset=="number"?u.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,a,u,m=s.EXTENT){if(!(a>=0&&a<m&&u>=0&&u<m))return this.elevationOffset;let y=0;const w=this.getTerrainData(t);if(w.tile&&w.tile.dem){const E=s.transformMat4$1([],[a/m*s.EXTENT,u/m*s.EXTENT],w.u_terrain_matrix),C=[E[0]*w.tile.dem.dim,E[1]*w.tile.dem.dim],M=[Math.floor(C[0]),Math.floor(C[1])],B=w.tile.dem.get(M[0],M[1]),U=w.tile.dem.get(M[0],M[1]+1),G=w.tile.dem.get(M[0]+1,M[1]),$=w.tile.dem.get(M[0]+1,M[1]+1);y=s.number(s.number(B,U,C[0]-M[0]),s.number(G,$,C[0]-M[0]),C[1]-M[1])}return y}rememberForRerender(t,a){for(const u in this.sourceCache._tiles){const m=this.sourceCache._tiles[u];(m.tileID.equals(a)||m.tileID.isChildOf(a))&&(t===this.sourceCache.sourceCache.id&&(m.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][m.tileID.key]=!0)}}needsRerender(t,a){return this._rerender[t]&&this._rerender[t][a.key]}clearRerenderCache(){this._rerender={}}getElevation(t,a,u,m=s.EXTENT){return(this.getDEMElevation(t,a,u,m)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.style.map.painter.context,y=new s.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new R(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new R(m,new s.RGBAImage({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.identity([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const m=this.style.map.painter.context;a.demTexture=this.style.map.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new R(m,a.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),a.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const u=a&&a+a.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?y=t.canonical.z-m:s.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>y<<y),E=t.canonical.y-(t.canonical.y>>y<<y),C=s.fromScaling(new Float64Array(16),[1/(s.EXTENT<<y),1/(s.EXTENT<<y),0]);s.translate(C,C,[w*s.EXTENT,E*s.EXTENT,0]),this._demMatrixCache[t.key]={matrix:C,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const a=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(a,a,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,a,a))}return this._rttFramebuffer}getFramebuffer(t){const a=this.style.map.painter,u=a.width/devicePixelRatio,m=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new R(a.context,{width:u,height:m,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new R(a.context,{width:u,height:m,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(u,m,!0),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,u,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,w=0;y<this._coordsTextureSize;y++)for(let E=0;E<this._coordsTextureSize;E++,w+=4)a[w+0]=255&E,a[w+1]=255&y,a[w+2]=E>>8<<4|y>>8,a[w+3]=0;const u=new s.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),m=new R(t,u,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){const a=new Uint8Array(4),u=this.style.map.painter,m=u.context,y=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(t.x,u.height/devicePixelRatio-t.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,a),m.bindFramebuffer.set(null);const w=a[0]+(a[2]>>4<<8),E=a[1]+((15&a[2])<<8),C=this.coordsIndex[255-a[3]],M=C&&this.sourceCache.getTileByID(C);if(!M)return null;const B=this._coordsTextureSize,U=(1<<M.tileID.canonical.z)*B;return new s.MercatorCoordinate((M.tileID.canonical.x*B+w)/U,(M.tileID.canonical.y*B+E)/U,this.getElevation(M.tileID,w,E,B))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,a=new s.PosArray,u=new s.TriangleIndexArray,m=this.meshSize,y=s.EXTENT/m,w=m*m;for(let E=0;E<=m;E++)for(let C=0;C<=m;C++)a.emplaceBack(C*y,E*y);for(let E=0;E<w;E+=m+1)for(let C=0;C<m;C++)u.emplaceBack(C+E,m+C+E+1,m+C+E+2),u.emplaceBack(C+E,m+C+E+2,C+E+1);return this._mesh={indexBuffer:t.createIndexBuffer(u),vertexBuffer:t.createVertexBuffer(a,Ht.members),segments:s.SegmentVector.simpleSegment(0,0,a.length,u.length)},this._mesh}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return a&&a.dem&&(u.minElevation=(a.dem.min+this.elevationOffset)*this.exaggeration,u.maxElevation=(a.dem.max+this.elevationOffset)*this.exaggeration),u}}const Wt=(f,t)=>s.emitValidationErrors(f,t&&t.filter(a=>a.identifier!=="source.canvas")),si=s.pick(Zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Gi=s.pick(Zt,["setCenter","setZoom","setBearing","setPitch"]),vi=function(){const f={},t=s.spec.$version;for(const a in s.spec.$root){const u=s.spec.$root[a];if(u.required){let m=null;m=a==="version"?t:u.type==="array"?[]:{},m!=null&&(f[a]=m)}}return f}();class tr extends s.Evented{constructor(t,a={}){super(),this.map=t,this.dispatcher=new dt($n(),this),this.imageManager=new ce,this.imageManager.setEventedParent(this),this.glyphManager=new ke(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new Ct(256,512),this.crossTileSymbolIndex=new kt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const u=this;this._rtlTextPluginCallback=tr.registerForPluginStateChange(m=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,w)=>{if(s.triggerPluginCompletionEvent(y),w&&w.every(E=>E))for(const E in u.sourceCaches)u.sourceCaches[E].reload()})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.sourceCaches[m.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===w.id&&this._validateLayer(C)}})}loadURL(t,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const u=typeof a.validate!="boolean"||a.validate,m=this.map._requestManager.transformRequest(t,s.ResourceType.Style);this._request=s.getJSON(m,(y,w)=>{this._request=null,y?this.fire(new s.ErrorEvent(y)):w&&this._load(w,u)})}loadJSON(t,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(vi,!1)}_load(t,a){if(a&&Wt(this,s.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const u=Cs(this.stylesheet.layers);this._order=u.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of u)m=s.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ne(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(a,u,m,y){let w,E,C;const M=m>1?"@2x":"";let B=s.getJSON(u.transformRequest(u.normalizeSpriteURL(a,M,".json"),s.ResourceType.SpriteJSON),($,Y)=>{B=null,C||(C=$,w=Y,G())}),U=s.getImage(u.transformRequest(u.normalizeSpriteURL(a,M,".png"),s.ResourceType.SpriteImage),($,Y)=>{U=null,C||(C=$,E=Y,G())});function G(){if(C)y(C);else if(w&&E){const $=s.exported.getImageData(E),Y={};for(const Q in w){const{width:le,height:de,x:_e,y:ee,sdf:we,pixelRatio:ye,stretchX:Me,stretchY:Pe,content:je}=w[Q],Ae=new s.RGBAImage({width:le,height:de});s.RGBAImage.copy($,Ae,{x:_e,y:ee},{x:0,y:0},{width:le,height:de}),Y[Q]={data:Ae,pixelRatio:ye,sdf:we,stretchX:Me,stretchY:Pe,content:je}}y(null,Y)}}return{cancel(){B&&(B.cancel(),B=null),U&&(U.cancel(),U=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(a,u)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(u)for(const m in u)this.imageManager.addImage(m,u[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const u=t.sourceLayer;if(!u)return;const m=a.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const a=[];for(const u of t){const m=this._layers[u];m.type!=="custom"&&a.push(m.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const w in this._updatedSources){const E=this._updatedSources[w];if(E==="reload")this._reloadSource(w);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(w)}}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const u={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];u[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in u){const y=this.sourceCaches[m];u[m]!==y.used&&y.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.z=t.zoom,a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const a=this.sourceCaches[t.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new Ft(this,a,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=u=>{u.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=u=>{u.tile&&(u.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(u.sourceId,u.tile.tileID)):u.source.type==="geojson"&&this.terrain.rememberForRerender(u.sourceId,u.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new s.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),Wt(this,s.validateStyle(t)))return!1;(t=s.clone$1(t)).layers=Cs(t.layers);const a=function(m,y){if(!m)return[{command:Zt.setStyle,args:[y]}];let w=[];try{if(!P(m.version,y.version))return[{command:Zt.setStyle,args:[y]}];P(m.center,y.center)||w.push({command:Zt.setCenter,args:[y.center]}),P(m.zoom,y.zoom)||w.push({command:Zt.setZoom,args:[y.zoom]}),P(m.bearing,y.bearing)||w.push({command:Zt.setBearing,args:[y.bearing]}),P(m.pitch,y.pitch)||w.push({command:Zt.setPitch,args:[y.pitch]}),P(m.sprite,y.sprite)||w.push({command:Zt.setSprite,args:[y.sprite]}),P(m.glyphs,y.glyphs)||w.push({command:Zt.setGlyphs,args:[y.glyphs]}),P(m.transition,y.transition)||w.push({command:Zt.setTransition,args:[y.transition]}),P(m.light,y.light)||w.push({command:Zt.setLight,args:[y.light]});const E={},C=[];(function(B,U,G,$){let Y;for(Y in U=U||{},B=B||{})Object.prototype.hasOwnProperty.call(B,Y)&&(Object.prototype.hasOwnProperty.call(U,Y)||xn(Y,G,$));for(Y in U)Object.prototype.hasOwnProperty.call(U,Y)&&(Object.prototype.hasOwnProperty.call(B,Y)?P(B[Y],U[Y])||(B[Y].type==="geojson"&&U[Y].type==="geojson"&&As(B,U,Y)?G.push({command:Zt.setGeoJSONSourceData,args:[Y,U[Y].data]}):bn(Y,U,G,$)):Yr(Y,U,G))})(m.sources,y.sources,C,E);const M=[];m.layers&&m.layers.forEach(B=>{E[B.source]?w.push({command:Zt.removeLayer,args:[B.id]}):M.push(B)}),w=w.concat(C),function(B,U,G){U=U||[];const $=(B=B||[]).map(on),Y=U.map(on),Q=B.reduce(ts,{}),le=U.reduce(ts,{}),de=$.slice(),_e=Object.create(null);let ee,we,ye,Me,Pe,je,Ae;for(ee=0,we=0;ee<$.length;ee++)ye=$[ee],Object.prototype.hasOwnProperty.call(le,ye)?we++:(G.push({command:Zt.removeLayer,args:[ye]}),de.splice(de.indexOf(ye,we),1));for(ee=0,we=0;ee<Y.length;ee++)ye=Y[Y.length-1-ee],de[de.length-1-ee]!==ye&&(Object.prototype.hasOwnProperty.call(Q,ye)?(G.push({command:Zt.removeLayer,args:[ye]}),de.splice(de.lastIndexOf(ye,de.length-we),1)):we++,je=de[de.length-ee],G.push({command:Zt.addLayer,args:[le[ye],je]}),de.splice(de.length-ee,0,ye),_e[ye]=!0);for(ee=0;ee<Y.length;ee++)if(ye=Y[ee],Me=Q[ye],Pe=le[ye],!_e[ye]&&!P(Me,Pe))if(P(Me.source,Pe.source)&&P(Me["source-layer"],Pe["source-layer"])&&P(Me.type,Pe.type)){for(Ae in an(Me.layout,Pe.layout,G,ye,null,Zt.setLayoutProperty),an(Me.paint,Pe.paint,G,ye,null,Zt.setPaintProperty),P(Me.filter,Pe.filter)||G.push({command:Zt.setFilter,args:[ye,Pe.filter]}),P(Me.minzoom,Pe.minzoom)&&P(Me.maxzoom,Pe.maxzoom)||G.push({command:Zt.setLayerZoomRange,args:[ye,Pe.minzoom,Pe.maxzoom]}),Me)Object.prototype.hasOwnProperty.call(Me,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?an(Me[Ae],Pe[Ae],G,ye,Ae.slice(6),Zt.setPaintProperty):P(Me[Ae],Pe[Ae])||G.push({command:Zt.setLayerProperty,args:[ye,Ae,Pe[Ae]]}));for(Ae in Pe)Object.prototype.hasOwnProperty.call(Pe,Ae)&&!Object.prototype.hasOwnProperty.call(Me,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?an(Me[Ae],Pe[Ae],G,ye,Ae.slice(6),Zt.setPaintProperty):P(Me[Ae],Pe[Ae])||G.push({command:Zt.setLayerProperty,args:[ye,Ae,Pe[Ae]]}))}else G.push({command:Zt.removeLayer,args:[ye]}),je=de[de.lastIndexOf(ye)+1],G.push({command:Zt.addLayer,args:[Pe,je]})}(M,y.layers,w)}catch(E){console.warn("Unable to compute style diff:",E),w=[{command:Zt.setStyle,args:[y]}]}return w}(this.serialize(),t).filter(m=>!(m.command in Gi));if(a.length===0)return!1;const u=a.filter(m=>!(m.command in si));if(u.length>0)throw new Error(`Unimplemented: ${u.map(m=>m.command).join(", ")}.`);return a.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,!0}addImage(t,a){if(this.getImage(t))return this.fire(new s.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,u={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateStyle.source,`sources.${t}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const m=this.sourceCaches[t]=new He(t,a,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new s.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.sourceCaches[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,u={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new s.ErrorEvent(new Error(`Layer "${m}" already exists on this map.`)));let y;if(t.type==="custom"){if(Wt(this,s.validateCustomStyleLayer(t)))return;y=s.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=s.clone$1(t),t=s.extend(t,{source:m})),this._validate(s.validateStyle.layer,`layers.${m}`,t,{arrayIndex:-1},u))return;y=s.createStyleLayer(t),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[y.id]=y.serialize()}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)this.fire(new s.ErrorEvent(new Error(`Cannot add layer "${m}" before non-existing layer "${a}".`)));else{if(this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const E=this._removedLayers[m];delete this._removedLayers[m],E.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const u=this._order.indexOf(t);this._order.splice(u,1);const m=a?this._order.indexOf(a):this._order.length;a&&m===-1?this.fire(new s.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new s.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,u){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===a&&m.maxzoom===u||(a!=null&&(m.minzoom=a),u!=null&&(m.maxzoom=u),this._updateLayer(m)):this.fire(new s.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,u={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!P(m.filter,a))return a==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(s.validateStyle.filter,`layers.${m.id}.filter`,a,null,u)||(m.filter=s.clone$1(a),this._updateLayer(m)))}else this.fire(new s.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,a,u,m={}){this._checkLoaded();const y=this.getLayer(t);y?P(y.getLayoutProperty(a),u)||(y.setLayoutProperty(a,u,m),this._updateLayer(y)):this.fire(new s.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const u=this.getLayer(t);if(u)return u.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,u,m={}){this._checkLoaded();const y=this.getLayer(t);y?P(y.getPaintProperty(a),u)||(y.setPaintProperty(a,u,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const u=t.source,m=t.sourceLayer,y=this.sourceCaches[u];if(y===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const w=y.getSource().type;w==="geojson"&&m?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||m?(t.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,t.id,a)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const u=t.source,m=this.sourceCaches[u];if(m===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const y=m.getSource().type,w=y==="vector"?t.sourceLayer:void 0;y!=="vector"||w?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(w,t.id,a):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,u=t.sourceLayer,m=this.sourceCaches[a];if(m!==void 0)return m.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),m.getFeatureState(u,t.id)):void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=w=>this._layers[w].type==="fill-extrusion",u={},m=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E)){u[E]=w;for(const C of t){const M=C[E];if(M)for(const B of M)m.push(B)}}}m.sort((w,E)=>E.intersectionZ-w.intersectionZ);const y=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E))for(let C=m.length-1;C>=0;C--){const M=m[C].feature;if(u[M.layer.id]<w)break;y.push(M),m.pop()}else for(const C of t){const M=C[E];if(M)for(const B of M)y.push(B.feature)}}return y}queryRenderedFeatures(t,a,u){a&&a.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",a.filter,null,a);const m={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of a.layers){const E=this._layers[w];if(!E)return this.fire(new s.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];m[E.source]=!0}}const y=[];a.availableImages=this._availableImages;for(const w in this.sourceCaches)a.layers&&!m[w]||y.push(Ui(this.sourceCaches[w],this._layers,this._serializedLayers,t,a,u));return this.placement&&y.push(function(w,E,C,M,B,U,G){const $={},Y=U.queryRenderedSymbols(M),Q=[];for(const le of Object.keys(Y).map(Number))Q.push(G[le]);Q.sort(Ki);for(const le of Q){const de=le.featureIndex.lookupSymbolFeatures(Y[le.bucketInstanceId],E,le.bucketIndex,le.sourceLayerIndex,B.filter,B.layers,B.availableImages,w);for(const _e in de){const ee=$[_e]=$[_e]||[],we=de[_e];we.sort((ye,Me)=>{const Pe=le.featureSortOrder;if(Pe){const je=Pe.indexOf(ye.featureIndex);return Pe.indexOf(Me.featureIndex)-je}return Me.featureIndex-ye.featureIndex});for(const ye of we)ee.push(ye)}}for(const le in $)$[le].forEach(de=>{const _e=de.feature,ee=C[w[le].source].getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ee});return $}(this._layers,this._serializedLayers,this.sourceCaches,t,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,a){a&&a.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",a.filter,null,a);const u=this.sourceCaches[t];return u?function(m,y){const w=m.getRenderableIds().map(M=>m.getTileByID(M)),E=[],C={};for(let M=0;M<w.length;M++){const B=w[M],U=B.tileID.canonical.key;C[U]||(C[U]=!0,B.querySourceFeatures(E,y))}return E}(u,a):[]}addSourceType(t,a,u){return tr.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(tr.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const u=this.light.getLight();let m=!1;for(const w in t)if(!P(t[w],u[w])){m=!0;break}if(!m)return;const y={now:s.exported.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(y)}_validate(t,a,u,m,y={}){return(!y||y.validate!==!1)&&Wt(this,t.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:u,styleSpec:s.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const a=this.sourceCaches[t];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,u,m,y=!1){let w=!1,E=!1;const C={};for(const M of this._order){const B=this._layers[M];if(B.type!=="symbol")continue;if(!C[B.source]){const G=this.sourceCaches[B.source];C[B.source]=G.getRenderableIds(!0).map($=>G.getTileByID($)).sort(($,Y)=>Y.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(Y.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(B,C[B.source],t.center.lng);w=w||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),t.zoom))&&(this.pauseablePlacement=new Ie(t,this.terrain,this._order,y,a,u,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w)for(const M of this._order){const B=this._layers[M];B.type==="symbol"&&this.placement.updateLayerOpacities(B,C[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,u){this.imageManager.getImages(a.icons,u),this._updateTilesForChangedImages();const m=this.sourceCaches[a.source];m&&m.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(t,a,u){this.glyphManager.getGlyphs(a.stacks,u)}getResource(t,a,u){return s.makeRequest(a,u)}}tr.getSourceType=function(f){return Ai[f]},tr.setSourceType=function(f,t){Ai[f]=t},tr.registerForPluginStateChange=s.registerForPluginStateChange;var ss="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const zs={prelude:ai(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ai(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ai(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ai(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ai(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ai("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ai(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ai(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ai(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ai(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ai(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ai(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ai(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ai(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ai(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ai(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ai(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ai("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ss),terrainDepth:ai("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ss),terrainCoords:ai("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ss)};function ai(f,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/attribute ([\w]+) ([\w]+)/g),m=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=y?y.concat(m):m,E={};return{fragmentSource:f=f.replace(a,(C,M,B,U,G)=>(E[G]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${G}
varying ${B} ${U} ${G};
#else
uniform ${B} ${U} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${B} ${U} ${G} = u_${G};
#endif
`)),vertexSource:t=t.replace(a,(C,M,B,U,G)=>{const $=U==="float"?"vec2":"vec4",Y=G.match(/color/)?"color":$;return E[G]?M==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${$} a_${G};
varying ${B} ${U} ${G};
#else
uniform ${B} ${U} u_${G};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${B} ${U} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${Y}(a_${G}, u_${G}_t);
#else
    ${B} ${U} ${G} = u_${G};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${$} a_${G};
#else
uniform ${B} ${U} u_${G};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${U} ${G} = a_${G};
#else
    ${B} ${U} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${U} ${G} = unpack_mix_${Y}(a_${G}, u_${G}_t);
#else
    ${B} ${U} ${G} = u_${G};
#endif
`}),staticAttributes:u,staticUniforms:w}}class Ua{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,u,m,y,w,E,C,M){this.context=t;let B=this.boundPaintVertexBuffers.length!==m.length;for(let U=0;!B&&U<m.length;U++)this.boundPaintVertexBuffers[U]!==m[U]&&(B=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===a&&this.boundLayoutVertexBuffer===u&&!B&&this.boundIndexBuffer===y&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===C&&this.boundDynamicVertexBuffer3===M?(t.bindVertexArrayOES.set(this.vao),E&&E.bind(),y&&y.dynamicDraw&&y.bind(),C&&C.bind(),M&&M.bind()):this.freshBind(a,u,m,y,w,E,C,M)}freshBind(t,a,u,m,y,w,E,C){let M;const B=t.numAttributes,U=this.context,G=U.gl;if(U.extVertexArrayObject)this.vao&&this.destroy(),this.vao=U.extVertexArrayObject.createVertexArrayOES(),U.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=C;else{M=U.currentNumAttributes||0;for(let $=B;$<M;$++)G.disableVertexAttribArray($)}a.enableAttributes(G,t);for(const $ of u)$.enableAttributes(G,t);w&&w.enableAttributes(G,t),E&&E.enableAttributes(G,t),C&&C.enableAttributes(G,t),a.bind(),a.setVertexAttribPointers(G,t,y);for(const $ of u)$.bind(),$.setVertexAttribPointers(G,t,y);w&&(w.bind(),w.setVertexAttribPointers(G,t,y)),m&&m.bind(),E&&(E.bind(),E.setVertexAttribPointers(G,t,y)),C&&(C.bind(),C.setVertexAttribPointers(G,t,y)),U.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Na(f){const t=[];for(let a=0;a<f.length;a++){if(f[a]===null)continue;const u=f[a].split(" ");t.push(u.pop())}return t}class Xo{constructor(t,a,u,m,y,w,E){const C=t.gl;this.program=C.createProgram();const M=Na(u.staticAttributes),B=m?m.getBinderAttributes():[],U=M.concat(B),G=zs.prelude.staticUniforms?Na(zs.prelude.staticUniforms):[],$=u.staticUniforms?Na(u.staticUniforms):[],Y=m?m.getBinderUniforms():[],Q=G.concat($).concat(Y),le=[];for(const Pe of Q)le.indexOf(Pe)<0&&le.push(Pe);const de=m?m.defines():[];w&&de.push("#define OVERDRAW_INSPECTOR;"),E&&de.push("#define TERRAIN3D;");const _e=de.concat(zs.prelude.fragmentSource,u.fragmentSource).join(`
`),ee=de.concat(zs.prelude.vertexSource,u.vertexSource).join(`
`),we=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(we,_e),C.compileShader(we),C.attachShader(this.program,we);const ye=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(ye,ee),C.compileShader(ye),C.attachShader(this.program,ye),this.attributes={};const Me={};this.numAttributes=U.length;for(let Pe=0;Pe<this.numAttributes;Pe++)U[Pe]&&(C.bindAttribLocation(this.program,Pe,U[Pe]),this.attributes[U[Pe]]=Pe);C.linkProgram(this.program),C.deleteShader(ye),C.deleteShader(we);for(let Pe=0;Pe<le.length;Pe++){const je=le[Pe];if(je&&!Me[je]){const Ae=C.getUniformLocation(this.program,je);Ae&&(Me[je]=Ae)}}this.fixedUniforms=y(t,Me),this.terrainUniforms=((Pe,je)=>({u_depth:new s.Uniform1i(Pe,je.u_depth),u_terrain:new s.Uniform1i(Pe,je.u_terrain),u_terrain_dim:new s.Uniform1f(Pe,je.u_terrain_dim),u_terrain_matrix:new s.UniformMatrix4f(Pe,je.u_terrain_matrix),u_terrain_unpack:new s.Uniform4f(Pe,je.u_terrain_unpack),u_terrain_offset:new s.Uniform1f(Pe,je.u_terrain_offset),u_terrain_exaggeration:new s.Uniform1f(Pe,je.u_terrain_exaggeration)}))(t,Me),this.binderUniforms=m?m.getUniforms(t,Me):[]}draw(t,a,u,m,y,w,E,C,M,B,U,G,$,Y,Q,le,de,_e){const ee=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(m),t.setColorMode(y),t.setCullFace(w),C){t.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,C.depthTexture),t.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,C.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(C[ye])}for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(E[ye]);Q&&Q.setUniforms(t,this.binderUniforms,$,{zoom:Y});let we=0;switch(a){case ee.LINES:we=2;break;case ee.TRIANGLES:we=3;break;case ee.LINE_STRIP:we=1}for(const ye of G.get()){const Me=ye.vaos||(ye.vaos={});(Me[M]||(Me[M]=new Ua)).bind(t,this,B,Q?Q.getPaintVertexBuffers():[],U,ye.vertexOffset,le,de,_e),ee.drawElements(a,ye.primitiveLength*we,ee.UNSIGNED_SHORT,ye.primitiveOffset*we*2)}}}function Ho(f,t,a){const u=1/Pi(a,1,t.transform.tileZoom),m=Math.pow(2,a.tileID.overscaledZ),y=a.tileSize*Math.pow(2,t.transform.tileZoom)/m,w=y*(a.tileID.canonical.x+a.tileID.wrap*m),E=y*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[u,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[w>>16,E>>16],u_pixel_coord_lower:[65535&w,65535&E]}}const ja=(f,t,a,u)=>{const m=t.style.light,y=m.properties.get("position"),w=[y.x,y.y,y.z],E=s.create$1();m.properties.get("anchor")==="viewport"&&s.fromRotation(E,-t.transform.angle),s.transformMat3(w,w,E);const C=m.properties.get("color");return{u_matrix:f,u_lightpos:w,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+a,u_opacity:u}},uc=(f,t,a,u,m,y,w)=>s.extend(ja(f,t,a,u),Ho(y,t,w),{u_height_factor:-Math.pow(2,m.overscaledZ)/w.tileSize/8}),aa=f=>({u_matrix:f}),Ga=(f,t,a,u)=>s.extend(aa(f),Ho(a,t,u)),Wo=(f,t)=>({u_matrix:f,u_world:t}),Ko=(f,t,a,u,m)=>s.extend(Ga(f,t,a,u),{u_world:m}),Jo=(f,t,a,u)=>{const m=f.transform;let y,w;if(u.paint.get("circle-pitch-alignment")==="map"){const E=Pi(a,1,m.zoom);y=!0,w=[E,E]}else y=!1,w=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(t.posMatrix,a,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:w}},Fn=(f,t,a)=>{const u=Pi(a,1,t.zoom),m=Math.pow(2,t.zoom-a.tileID.overscaledZ),y=a.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[t.pixelsToGLUnits[0]/(u*m),t.pixelsToGLUnits[1]/(u*m)],u_overscale_factor:y}},Ms=(f,t,a=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:a}),as=f=>({u_matrix:f}),oa=(f,t,a,u)=>({u_matrix:f,u_extrude_scale:Pi(t,1,a),u_intensity:u});function la(f,t){const a=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new s.MercatorCoordinate(0,u/a).toLngLat().lat,new s.MercatorCoordinate(0,(u+1)/a).toLngLat().lat]}const os=(f,t,a,u)=>{const m=f.transform;return{u_matrix:Ds(f,t,a,u),u_ratio:1/Pi(t,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},qa=(f,t,a,u,m)=>s.extend(os(f,t,a,m),{u_image:0,u_image_height:u}),ca=(f,t,a,u,m)=>{const y=f.transform,w=xi(t,y);return{u_matrix:Ds(f,t,a,m),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Pi(t,1,y.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[w,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Ps=(f,t,a,u,m,y)=>{const w=f.lineAtlas,E=xi(t,f.transform),C=a.layout.get("line-cap")==="round",M=w.getDash(u.from,C),B=w.getDash(u.to,C),U=M.width*m.fromScale,G=B.width*m.toScale;return s.extend(os(f,t,a,y),{u_patternscale_a:[E/U,-M.height/2],u_patternscale_b:[E/G,-B.height/2],u_sdfgamma:w.width/(256*Math.min(U,G)*f.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:B.y,u_mix:m.t})};function xi(f,t){return 1/Pi(f,1,t.tileZoom)}function Ds(f,t,a,u){return f.translatePosMatrix(u?u.posMatrix:t.tileID.posMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Yo=(f,t,a,u,m)=>{return{u_matrix:f,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(w=m.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(y=m.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Qo(m.paint.get("raster-hue-rotate"))};var y,w};function Qo(f){f*=Math.PI/180;const t=Math.sin(f),a=Math.cos(f);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Za=(f,t,a,u,m,y,w,E,C,M)=>{const B=m.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:B.width/B.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+C,u_pitch_with_map:+u,u_texsize:M,u_texture:0}},ua=(f,t,a,u,m,y,w,E,C,M,B)=>{const U=m.transform;return s.extend(Za(f,t,a,u,m,y,w,E,C,M),{u_gamma_scale:u?Math.cos(U._pitch)*U.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+B})},$o=(f,t,a,u,m,y,w,E,C,M)=>s.extend(ua(f,t,a,u,m,y,w,E,!0,C,!0),{u_texsize_icon:M,u_texture_icon:1}),hc=(f,t,a)=>({u_matrix:f,u_opacity:t,u_color:a}),fc=(f,t,a,u,m,y)=>s.extend(function(w,E,C,M){const B=C.imageManager.getPattern(w.from.toString()),U=C.imageManager.getPattern(w.to.toString()),{width:G,height:$}=C.imageManager.getPixelSize(),Y=Math.pow(2,M.tileID.overscaledZ),Q=M.tileSize*Math.pow(2,C.transform.tileZoom)/Y,le=Q*(M.tileID.canonical.x+M.tileID.wrap*Y),de=Q*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[G,$],u_mix:E.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Pi(M,1,C.transform.tileZoom),u_pixel_coord_upper:[le>>16,de>>16],u_pixel_coord_lower:[65535&le,65535&de]}}(u,y,a,m),{u_matrix:f,u_opacity:t}),Xa={fillExtrusion:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_lightpos:new s.Uniform3f(f,t.u_lightpos),u_lightintensity:new s.Uniform1f(f,t.u_lightintensity),u_lightcolor:new s.Uniform3f(f,t.u_lightcolor),u_vertical_gradient:new s.Uniform1f(f,t.u_vertical_gradient),u_opacity:new s.Uniform1f(f,t.u_opacity)}),fillExtrusionPattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_lightpos:new s.Uniform3f(f,t.u_lightpos),u_lightintensity:new s.Uniform1f(f,t.u_lightintensity),u_lightcolor:new s.Uniform3f(f,t.u_lightcolor),u_vertical_gradient:new s.Uniform1f(f,t.u_vertical_gradient),u_height_factor:new s.Uniform1f(f,t.u_height_factor),u_image:new s.Uniform1i(f,t.u_image),u_texsize:new s.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(f,t.u_scale),u_fade:new s.Uniform1f(f,t.u_fade),u_opacity:new s.Uniform1f(f,t.u_opacity)}),fill:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),fillPattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_image:new s.Uniform1i(f,t.u_image),u_texsize:new s.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(f,t.u_scale),u_fade:new s.Uniform1f(f,t.u_fade)}),fillOutline:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_world:new s.Uniform2f(f,t.u_world)}),fillOutlinePattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_world:new s.Uniform2f(f,t.u_world),u_image:new s.Uniform1i(f,t.u_image),u_texsize:new s.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(f,t.u_scale),u_fade:new s.Uniform1f(f,t.u_fade)}),circle:(f,t)=>({u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(f,t.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(f,t.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(f,t.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),collisionBox:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(f,t.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(f,t.u_extrude_scale),u_overscale_factor:new s.Uniform1f(f,t.u_overscale_factor)}),collisionCircle:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_inv_matrix:new s.UniformMatrix4f(f,t.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(f,t.u_viewport_size)}),debug:(f,t)=>({u_color:new s.UniformColor(f,t.u_color),u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_overlay:new s.Uniform1i(f,t.u_overlay),u_overlay_scale:new s.Uniform1f(f,t.u_overlay_scale)}),clippingMask:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),heatmap:(f,t)=>({u_extrude_scale:new s.Uniform1f(f,t.u_extrude_scale),u_intensity:new s.Uniform1f(f,t.u_intensity),u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),heatmapTexture:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_world:new s.Uniform2f(f,t.u_world),u_image:new s.Uniform1i(f,t.u_image),u_color_ramp:new s.Uniform1i(f,t.u_color_ramp),u_opacity:new s.Uniform1f(f,t.u_opacity)}),hillshade:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_image:new s.Uniform1i(f,t.u_image),u_latrange:new s.Uniform2f(f,t.u_latrange),u_light:new s.Uniform2f(f,t.u_light),u_shadow:new s.UniformColor(f,t.u_shadow),u_highlight:new s.UniformColor(f,t.u_highlight),u_accent:new s.UniformColor(f,t.u_accent)}),hillshadePrepare:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_image:new s.Uniform1i(f,t.u_image),u_dimension:new s.Uniform2f(f,t.u_dimension),u_zoom:new s.Uniform1f(f,t.u_zoom),u_unpack:new s.Uniform4f(f,t.u_unpack)}),line:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_ratio:new s.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(f,t.u_units_to_pixels)}),lineGradient:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_ratio:new s.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(f,t.u_units_to_pixels),u_image:new s.Uniform1i(f,t.u_image),u_image_height:new s.Uniform1f(f,t.u_image_height)}),linePattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_texsize:new s.Uniform2f(f,t.u_texsize),u_ratio:new s.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_image:new s.Uniform1i(f,t.u_image),u_units_to_pixels:new s.Uniform2f(f,t.u_units_to_pixels),u_scale:new s.Uniform3f(f,t.u_scale),u_fade:new s.Uniform1f(f,t.u_fade)}),lineSDF:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_ratio:new s.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(f,t.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(f,t.u_patternscale_a),u_patternscale_b:new s.Uniform2f(f,t.u_patternscale_b),u_sdfgamma:new s.Uniform1f(f,t.u_sdfgamma),u_image:new s.Uniform1i(f,t.u_image),u_tex_y_a:new s.Uniform1f(f,t.u_tex_y_a),u_tex_y_b:new s.Uniform1f(f,t.u_tex_y_b),u_mix:new s.Uniform1f(f,t.u_mix)}),raster:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_tl_parent:new s.Uniform2f(f,t.u_tl_parent),u_scale_parent:new s.Uniform1f(f,t.u_scale_parent),u_buffer_scale:new s.Uniform1f(f,t.u_buffer_scale),u_fade_t:new s.Uniform1f(f,t.u_fade_t),u_opacity:new s.Uniform1f(f,t.u_opacity),u_image0:new s.Uniform1i(f,t.u_image0),u_image1:new s.Uniform1i(f,t.u_image1),u_brightness_low:new s.Uniform1f(f,t.u_brightness_low),u_brightness_high:new s.Uniform1f(f,t.u_brightness_high),u_saturation_factor:new s.Uniform1f(f,t.u_saturation_factor),u_contrast_factor:new s.Uniform1f(f,t.u_contrast_factor),u_spin_weights:new s.Uniform3f(f,t.u_spin_weights)}),symbolIcon:(f,t)=>({u_is_size_zoom_constant:new s.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(f,t.u_size_t),u_size:new s.Uniform1f(f,t.u_size),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(f,t.u_pitch),u_rotate_symbol:new s.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(f,t.u_fade_change),u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new s.Uniform1i(f,t.u_is_text),u_pitch_with_map:new s.Uniform1i(f,t.u_pitch_with_map),u_texsize:new s.Uniform2f(f,t.u_texsize),u_texture:new s.Uniform1i(f,t.u_texture)}),symbolSDF:(f,t)=>({u_is_size_zoom_constant:new s.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(f,t.u_size_t),u_size:new s.Uniform1f(f,t.u_size),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(f,t.u_pitch),u_rotate_symbol:new s.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(f,t.u_fade_change),u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new s.Uniform1i(f,t.u_is_text),u_pitch_with_map:new s.Uniform1i(f,t.u_pitch_with_map),u_texsize:new s.Uniform2f(f,t.u_texsize),u_texture:new s.Uniform1i(f,t.u_texture),u_gamma_scale:new s.Uniform1f(f,t.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(f,t.u_is_halo)}),symbolTextAndIcon:(f,t)=>({u_is_size_zoom_constant:new s.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(f,t.u_size_t),u_size:new s.Uniform1f(f,t.u_size),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(f,t.u_pitch),u_rotate_symbol:new s.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(f,t.u_fade_change),u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new s.Uniform1i(f,t.u_is_text),u_pitch_with_map:new s.Uniform1i(f,t.u_pitch_with_map),u_texsize:new s.Uniform2f(f,t.u_texsize),u_texsize_icon:new s.Uniform2f(f,t.u_texsize_icon),u_texture:new s.Uniform1i(f,t.u_texture),u_texture_icon:new s.Uniform1i(f,t.u_texture_icon),u_gamma_scale:new s.Uniform1f(f,t.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(f,t.u_is_halo)}),background:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_opacity:new s.Uniform1f(f,t.u_opacity),u_color:new s.UniformColor(f,t.u_color)}),backgroundPattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_opacity:new s.Uniform1f(f,t.u_opacity),u_image:new s.Uniform1i(f,t.u_image),u_pattern_tl_a:new s.Uniform2f(f,t.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(f,t.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(f,t.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(f,t.u_pattern_br_b),u_texsize:new s.Uniform2f(f,t.u_texsize),u_mix:new s.Uniform1f(f,t.u_mix),u_pattern_size_a:new s.Uniform2f(f,t.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(f,t.u_pattern_size_b),u_scale_a:new s.Uniform1f(f,t.u_scale_a),u_scale_b:new s.Uniform1f(f,t.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(f,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(f,t.u_tile_units_to_pixels)}),terrain:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_texture:new s.Uniform1i(f,t.u_texture)}),terrainDepth:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),terrainCoords:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_texture:new s.Uniform1i(f,t.u_texture),u_terrain_coords_id:new s.Uniform1f(f,t.u_terrain_coords_id)})};class Ha{constructor(t,a,u){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ka{constructor(t,a,u,m){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let u=0;u<this.attributes.length;u++){const m=a.attributes[this.attributes[u].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,a,u){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],w=a.attributes[y.name];w!==void 0&&t.vertexAttribPointer(w,y.components,t[Wa[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class el extends Jt{getDefault(){return s.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class dc extends Jt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ls extends Jt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Bs extends Jt{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tl extends Jt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ir extends Jt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ja extends Jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ha extends Jt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class fa extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ya extends Jt{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Qa extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class da extends Jt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class $a extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class eo extends Jt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class pa extends Jt{getDefault(){return s.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class il extends Jt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class rl extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class ls extends Jt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class pc extends Jt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class mc extends Jt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class gc extends Jt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _c extends Jt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class yc extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class vc extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class to extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ma extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class io extends Jt{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ro extends Jt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class cs extends Jt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class nl extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class sl extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ga extends Jt{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class On extends ga{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class al extends ga{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class us{constructor(t,a,u,m){this.context=t,this.width=a,this.height=u;const y=t.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new On(t,w),m&&(this.depthAttachment=new al(t,w)),y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class gi{constructor(t,a,u){this.blendFunction=t,this.blendColor=a,this.mask=u}}gi.Replace=[1,0],gi.disabled=new gi(gi.Replace,s.Color.transparent,[!1,!1,!1,!1]),gi.unblended=new gi(gi.Replace,s.Color.transparent,[!0,!0,!0,!0]),gi.alphaBlended=new gi([1,771],s.Color.transparent,[!0,!0,!0,!0]);class ol{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new el(this),this.clearDepth=new dc(this),this.clearStencil=new Ls(this),this.colorMask=new Bs(this),this.depthMask=new tl(this),this.stencilMask=new Ir(this),this.stencilFunc=new Ja(this),this.stencilOp=new ha(this),this.stencilTest=new fa(this),this.depthRange=new Ya(this),this.depthTest=new Qa(this),this.depthFunc=new da(this),this.blend=new $a(this),this.blendFunc=new eo(this),this.blendColor=new pa(this),this.blendEquation=new il(this),this.cullFace=new rl(this),this.cullFaceSide=new ls(this),this.frontFace=new pc(this),this.program=new mc(this),this.activeTexture=new gc(this),this.viewport=new _c(this),this.bindFramebuffer=new yc(this),this.bindRenderbuffer=new vc(this),this.bindTexture=new to(this),this.bindVertexBuffer=new ma(this),this.bindElementBuffer=new io(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ro(this),this.pixelStoreUnpack=new cs(this),this.pixelStoreUnpackPremultiplyAlpha=new nl(this),this.pixelStoreUnpackFlipY=new sl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Ha(this,t,a)}createVertexBuffer(t,a,u){return new Ka(this,t,a,u)}createRenderbuffer(t,a,u){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,t,a,u),this.bindRenderbuffer.set(null),y}createFramebuffer(t,a,u){return new us(this,t,a,u)}clear({color:t,depth:a}){const u=this.gl;let m=0;t&&(m|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(m|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){P(t.blendFunction,gi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Gt{constructor(t,a,u){this.func=t,this.mask=a,this.range=u}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);const Yt=7680;class mi{constructor(t,a,u,m,y,w){this.test=t,this.ref=a,this.mask=u,this.fail=m,this.depthFail=y,this.pass=w}}mi.disabled=new mi({func:519,mask:0},0,0,Yt,Yt,Yt);class bi{constructor(t,a,u){this.enable=t,this.mode=a,this.frontFace=u}}let Rs;function hs(f,t,a,u,m,y,w){const E=f.context,C=E.gl,M=f.useProgram("collisionBox"),B=[];let U=0,G=0;for(let ee=0;ee<u.length;ee++){const we=u[ee],ye=t.getTile(we),Me=ye.getBucket(a);if(!Me)continue;let Pe=we.posMatrix;m[0]===0&&m[1]===0||(Pe=f.translatePosMatrix(we.posMatrix,ye,m,y));const je=w?Me.textCollisionBox:Me.iconCollisionBox,Ae=Me.collisionCircleArray;if(Ae.length>0){const nt=s.create(),Je=Pe;s.mul(nt,Me.placementInvProjMatrix,f.transform.glCoordMatrix),s.mul(nt,nt,Me.placementViewportMatrix),B.push({circleArray:Ae,circleOffset:G,transform:Je,invTransform:nt,coord:we}),U+=Ae.length/4,G=U}je&&M.draw(E,C.LINES,Gt.disabled,mi.disabled,f.colorModeForRenderPass(),bi.disabled,Fn(Pe,f.transform,ye),f.style.terrain&&f.style.terrain.getTerrainData(we),a.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,f.transform.zoom,null,null,je.collisionVertexBuffer)}if(!w||!B.length)return;const $=f.useProgram("collisionCircle"),Y=new s.CollisionCircleLayoutArray;Y.resize(4*U),Y._trim();let Q=0;for(const ee of B)for(let we=0;we<ee.circleArray.length/4;we++){const ye=4*we,Me=ee.circleArray[ye+0],Pe=ee.circleArray[ye+1],je=ee.circleArray[ye+2],Ae=ee.circleArray[ye+3];Y.emplace(Q++,Me,Pe,je,Ae,0),Y.emplace(Q++,Me,Pe,je,Ae,1),Y.emplace(Q++,Me,Pe,je,Ae,2),Y.emplace(Q++,Me,Pe,je,Ae,3)}(!Rs||Rs.length<2*U)&&(Rs=function(ee){const we=2*ee,ye=new s.QuadTriangleArray;ye.resize(we),ye._trim();for(let Me=0;Me<we;Me++){const Pe=6*Me;ye.uint16[Pe+0]=4*Me+0,ye.uint16[Pe+1]=4*Me+1,ye.uint16[Pe+2]=4*Me+2,ye.uint16[Pe+3]=4*Me+2,ye.uint16[Pe+4]=4*Me+3,ye.uint16[Pe+5]=4*Me+0}return ye}(U));const le=E.createIndexBuffer(Rs,!0),de=E.createVertexBuffer(Y,s.collisionCircleLayout.members,!0);for(const ee of B){const we={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(_e=f.transform).cameraToCenterDistance,u_viewport_size:[_e.width,_e.height]};$.draw(E,C.TRIANGLES,Gt.disabled,mi.disabled,f.colorModeForRenderPass(),bi.disabled,we,f.style.terrain&&f.style.terrain.getTerrainData(ee.coord),a.id,de,le,s.SegmentVector.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,f.transform.zoom,null,null,null)}var _e;de.destroy(),le.destroy()}bi.disabled=new bi(!1,1029,2305),bi.backCCW=new bi(!0,1029,2305);const xc=s.identity(new Float32Array(16));function bc(f,t,a,u,m,y){const{horizontalAlign:w,verticalAlign:E}=s.getAnchorAlignment(f),C=-(w-.5)*t,M=-(E-.5)*a,B=s.evaluateVariableOffset(f,u);return new s.pointGeometry((C/m+B[0])*y,(M/m+B[1])*y)}function ll(f,t,a,u,m,y,w,E,C,M,B){const U=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,$=f.icon.dynamicLayoutVertexArray,Y={};G.clear();for(let Q=0;Q<U.length;Q++){const le=U.get(Q),de=f.allowVerticalPlacement&&!le.placedOrientation,_e=le.hidden||!le.crossTileID||de?null:u[le.crossTileID];if(_e){const ee=new s.pointGeometry(le.anchorX,le.anchorY),we=Xt(ee,a?w:y,B),ye=Fr(m.cameraToCenterDistance,we.signedDistanceFromCamera);let Me=s.evaluateSizeForFeature(f.textSizeData,C,le)*ye/s.ONE_EM;a&&(Me*=f.tilePixelRatio/E);const{width:Pe,height:je,anchor:Ae,textOffset:nt,textBoxScale:Je}=_e,ot=bc(Ae,Pe,je,nt,Je,Me),Dt=a?Xt(ee.add(ot),y,B).point:we.point.add(t?ot.rotate(-m.angle):ot),Ot=f.allowVerticalPlacement&&le.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let yt=0;yt<le.numGlyphs;yt++)s.addDynamicAttributes(G,Dt,Ot);M&&le.associatedIconIndex>=0&&(Y[le.associatedIconIndex]={shiftedAnchor:Dt,angle:Ot})}else Mt(le.numGlyphs,G)}if(M){$.clear();const Q=f.icon.placedSymbolArray;for(let le=0;le<Q.length;le++){const de=Q.get(le);if(de.hidden)Mt(de.numGlyphs,$);else{const _e=Y[le];if(_e)for(let ee=0;ee<de.numGlyphs;ee++)s.addDynamicAttributes($,_e.shiftedAnchor,_e.angle);else Mt(de.numGlyphs,$)}}f.icon.dynamicLayoutVertexBuffer.updateData($)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function wc(f,t,a){return a.iconsInText&&t?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function _a(f,t,a,u,m,y,w,E,C,M,B,U){const G=f.context,$=G.gl,Y=f.transform,Q=E==="map",le=C==="map",de=E!=="viewport"&&a.layout.get("symbol-placement")!=="point",_e=Q&&!le&&!de,ee=!a.layout.get("symbol-sort-key").isConstant();let we=!1;const ye=f.depthModeForSublayer(0,Gt.ReadOnly),Me=a.layout.get("text-variable-anchor"),Pe=[];for(const je of u){const Ae=t.getTile(je),nt=Ae.getBucket(a);if(!nt)continue;const Je=m?nt.text:nt.icon;if(!Je||!Je.segments.get().length)continue;const ot=Je.programConfigurations.get(a.id),Dt=m||nt.sdfIcons,Ot=m?nt.textSizeData:nt.iconSizeData,yt=le||Y.pitch!==0,$t=f.useProgram(wc(Dt,m,nt),ot),ei=s.evaluateSizeForZoom(Ot,Y.zoom),qt=f.style.terrain&&f.style.terrain.getTerrainData(je);let Kt,ri,qi,tn,qr=[0,0],rn=null;if(m){if(ri=Ae.glyphAtlasTexture,qi=$.LINEAR,Kt=Ae.glyphAtlasTexture.size,nt.iconsInText){qr=Ae.imageAtlasTexture.size,rn=Ae.imageAtlasTexture;const Ur=Ot.kind==="composite"||Ot.kind==="camera";tn=yt||f.options.rotating||f.options.zooming||Ur?$.LINEAR:$.NEAREST}}else{const Ur=a.layout.get("icon-size").constantOr(0)!==1||nt.iconsNeedLinear;ri=Ae.imageAtlasTexture,qi=Dt||f.options.rotating||f.options.zooming||Ur||yt?$.LINEAR:$.NEAREST,Kt=Ae.imageAtlasTexture.size}const zn=Pi(Ae,1,f.transform.zoom),Vr=Dn(je.posMatrix,le,Q,f.transform,zn),vr=jr(je.posMatrix,le,Q,f.transform,zn),fn=Me&&nt.hasTextData(),Ea=a.layout.get("icon-text-fit")!=="none"&&fn&&nt.hasIconData();if(de){const Ur=f.style.terrain?(vo,_s)=>f.style.terrain.getElevation(je,vo,_s):null,jn=a.layout.get("text-rotation-alignment")==="map";Sr(nt,je.posMatrix,f,m,Vr,vr,le,M,jn,Ur)}const Fi=f.translatePosMatrix(je.posMatrix,Ae,y,w),Ut=de||m&&Me||Ea?xc:Vr,Qt=f.translatePosMatrix(vr,Ae,y,w,!0),Zi=Dt&&a.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Xi;Xi=Dt?nt.iconsInText?$o(Ot.kind,ei,_e,le,f,Fi,Ut,Qt,Kt,qr):ua(Ot.kind,ei,_e,le,f,Fi,Ut,Qt,m,Kt,!0):Za(Ot.kind,ei,_e,le,f,Fi,Ut,Qt,m,Kt);const Ti={program:$t,buffers:Je,uniformValues:Xi,atlasTexture:ri,atlasTextureIcon:rn,atlasInterpolation:qi,atlasInterpolationIcon:tn,isSDF:Dt,hasHalo:Zi};if(ee&&nt.canOverlap){we=!0;const Ur=Je.segments.get();for(const jn of Ur)Pe.push({segments:new s.SegmentVector([jn]),sortKey:jn.sortKey,state:Ti,terrainData:qt})}else Pe.push({segments:Je.segments,sortKey:0,state:Ti,terrainData:qt})}we&&Pe.sort((je,Ae)=>je.sortKey-Ae.sortKey);for(const je of Pe){const Ae=je.state;if(G.activeTexture.set($.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,$.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(G.activeTexture.set($.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Ae.isSDF){const nt=Ae.uniformValues;Ae.hasHalo&&(nt.u_is_halo=1,Fs(Ae.buffers,je.segments,a,f,Ae.program,ye,B,U,nt,je.terrainData)),nt.u_is_halo=0}Fs(Ae.buffers,je.segments,a,f,Ae.program,ye,B,U,Ae.uniformValues,je.terrainData)}}function Fs(f,t,a,u,m,y,w,E,C,M){const B=u.context;m.draw(B,B.gl.TRIANGLES,y,w,E,bi.disabled,C,M,a.id,f.layoutVertexBuffer,f.indexBuffer,t,a.paint,u.transform.zoom,f.programConfigurations.get(a.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Os(f,t,a,u,m,y,w){const E=f.context.gl,C=a.paint.get("fill-pattern"),M=C&&C.constantOr(1),B=a.getCrossfadeParameters();let U,G,$,Y,Q;w?(G=M&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=E.LINES):(G=M?"fillPattern":"fill",U=E.TRIANGLES);for(const le of u){const de=t.getTile(le);if(M&&!de.patternsLoaded())continue;const _e=de.getBucket(a);if(!_e)continue;const ee=_e.programConfigurations.get(a.id),we=f.useProgram(G,ee),ye=f.style.terrain&&f.style.terrain.getTerrainData(le);M&&(f.context.activeTexture.set(E.TEXTURE0),de.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ee.updatePaintBuffers(B));const Me=C.constantOr(null);if(Me&&de.imageAtlas){const Ae=de.imageAtlas,nt=Ae.patternPositions[Me.to.toString()],Je=Ae.patternPositions[Me.from.toString()];nt&&Je&&ee.setConstantPatternPositions(nt,Je)}const Pe=ye?le:null,je=f.translatePosMatrix(Pe?Pe.posMatrix:le.posMatrix,de,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(w){Y=_e.indexBuffer2,Q=_e.segments2;const Ae=[E.drawingBufferWidth,E.drawingBufferHeight];$=G==="fillOutlinePattern"&&M?Ko(je,f,B,de,Ae):Wo(je,Ae)}else Y=_e.indexBuffer,Q=_e.segments,$=M?Ga(je,f,B,de):aa(je);we.draw(f.context,U,m,f.stencilModeForClipping(le),y,bi.disabled,$,ye,a.id,_e.layoutVertexBuffer,Y,Q,a.paint,f.transform.zoom,ee)}}function Vs(f,t,a,u,m,y,w){const E=f.context,C=E.gl,M=a.paint.get("fill-extrusion-pattern"),B=M.constantOr(1),U=a.getCrossfadeParameters(),G=a.paint.get("fill-extrusion-opacity");for(const $ of u){const Y=t.getTile($),Q=Y.getBucket(a);if(!Q)continue;const le=f.style.terrain&&f.style.terrain.getTerrainData($),de=Q.programConfigurations.get(a.id),_e=f.useProgram(B?"fillExtrusionPattern":"fillExtrusion",de);B&&(f.context.activeTexture.set(C.TEXTURE0),Y.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),de.updatePaintBuffers(U));const ee=M.constantOr(null);if(ee&&Y.imageAtlas){const Pe=Y.imageAtlas,je=Pe.patternPositions[ee.to.toString()],Ae=Pe.patternPositions[ee.from.toString()];je&&Ae&&de.setConstantPatternPositions(je,Ae)}const we=f.translatePosMatrix($.posMatrix,Y,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ye=a.paint.get("fill-extrusion-vertical-gradient"),Me=B?uc(we,f,ye,G,$,U,Y):ja(we,f,ye,G);_e.draw(E,E.gl.TRIANGLES,m,y,w,bi.backCCW,Me,le,a.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,a.paint,f.transform.zoom,de,f.style.terrain&&Q.centroidVertexBuffer)}}function no(f,t,a,u,m,y,w){const E=f.context,C=E.gl,M=a.fbo;if(!M)return;const B=f.useProgram("hillshade"),U=f.style.terrain&&f.style.terrain.getTerrainData(t);E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),B.draw(E,C.TRIANGLES,m,y,w,bi.disabled,((G,$,Y,Q)=>{const le=Y.paint.get("hillshade-shadow-color"),de=Y.paint.get("hillshade-highlight-color"),_e=Y.paint.get("hillshade-accent-color");let ee=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);Y.paint.get("hillshade-illumination-anchor")==="viewport"&&(ee-=G.transform.angle);const we=!G.options.moving;return{u_matrix:Q?Q.posMatrix:G.transform.calculatePosMatrix($.tileID.toUnwrapped(),we),u_image:0,u_latrange:la(0,$.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),ee],u_shadow:le,u_highlight:de,u_accent:_e}})(f,a,u,U?t:null),U,u.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function cl(f,t,a,u,m,y){const w=f.context,E=w.gl,C=t.dem;if(C&&C.data){const M=C.dim,B=C.stride,U=C.getPixels();if(w.activeTexture.set(E.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(B),t.demTexture){const $=t.demTexture;$.update(U,{premultiply:!1}),$.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else t.demTexture=new R(w,U,E.RGBA,{premultiply:!1}),t.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);w.activeTexture.set(E.TEXTURE0);let G=t.fbo;if(!G){const $=new R(w,{width:M,height:M,data:null},E.RGBA);$.bind(E.LINEAR,E.CLAMP_TO_EDGE),G=t.fbo=w.createFramebuffer(M,M,!0),G.colorAttachment.set($.texture)}w.bindFramebuffer.set(G.framebuffer),w.viewport.set([0,0,M,M]),f.useProgram("hillshadePrepare").draw(w,E.TRIANGLES,u,m,y,bi.disabled,(($,Y)=>{const Q=Y.stride,le=s.create();return s.ortho(le,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(le,le,[0,-s.EXTENT,0]),{u_matrix:le,u_image:1,u_dimension:[Q,Q],u_zoom:$.overscaledZ,u_unpack:Y.getUnpackVector()}})(t.tileID,C),null,a.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function ya(f,t,a,u,m,y){const w=u.paint.get("raster-fade-duration");if(!y&&w>0){const E=s.exported.now(),C=(E-f.timeAdded)/w,M=t?(E-t.timeAdded)/w:-1,B=a.getSource(),U=m.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),G=!t||Math.abs(t.tileID.overscaledZ-U)>Math.abs(f.tileID.overscaledZ-U),$=G&&f.refreshedUponExpiration?1:s.clamp(G?C:1-M,0,1);return f.refreshedUponExpiration&&C>=1&&(f.refreshedUponExpiration=!1),t?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}const va=new s.Color(1,0,0,1),Gr=new s.Color(0,1,0,1),ul=new s.Color(0,0,1,1),so=new s.Color(1,0,1,1),hl=new s.Color(0,1,1,1);function Vn(f,t,a,u){fs(f,0,t+a/2,f.transform.width,a,u)}function Us(f,t,a,u){fs(f,t-a/2,0,a,f.transform.height,u)}function fs(f,t,a,u,m,y){const w=f.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*f.pixelRatio,a*f.pixelRatio,u*f.pixelRatio,m*f.pixelRatio),w.clear({color:y}),E.disable(E.SCISSOR_TEST)}function Tc(f,t,a){const u=f.context,m=u.gl,y=a.posMatrix,w=f.useProgram("debug"),E=Gt.disabled,C=mi.disabled,M=f.colorModeForRenderPass(),B="$debug",U=f.style.terrain&&f.style.terrain.getTerrainData(a);u.activeTexture.set(m.TEXTURE0),f.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE);const G=t.getTileByID(a.key).latestRawTileData,$=Math.floor((G&&G.byteLength||0)/1024),Y=t.getTile(a).tileSize,Q=512/Math.min(Y,512)*(a.overscaledZ/f.transform.zoom)*.5;let le=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(le+=` => ${a.overscaledZ}`),function(de,_e){de.initDebugOverlayCanvas();const ee=de.debugOverlayCanvas,we=de.context.gl,ye=de.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,ee.width,ee.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(_e,5,5),ye.strokeText(_e,5,5),de.debugOverlayTexture.update(ee),de.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(f,`${le} ${$}kB`),w.draw(u,m.TRIANGLES,E,C,gi.alphaBlended,bi.disabled,Ms(y,s.Color.transparent,Q),null,B,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),w.draw(u,m.LINE_STRIP,E,C,M,bi.disabled,Ms(y,s.Color.red),U,B,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function xa(f,t,a){const u=f.context,m=u.gl,y=f.colorModeForRenderPass(),w=new Gt(m.LEQUAL,Gt.ReadWrite,f.depthRangeFor3D),E=f.useProgram("terrain"),C=t.getTerrainMesh(),M=t.getTerrainData(a.tileID);u.bindFramebuffer.set(null),u.viewport.set([0,0,f.width,f.height]),u.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const B=f.transform.calculatePosMatrix(a.tileID.toUnwrapped());E.draw(u,m.TRIANGLES,w,mi.disabled,y,bi.backCCW,{u_matrix:B,u_texture:0},M,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}function fl(f,t,a,u){const m=f.context,y=a.tileSize*t.qualityFactor;a.textures[u]||(a.textures[u]=f.getTileTexture(y)||new R(m,{width:y,height:y,data:null},m.gl.RGBA),a.textures[u].bind(m.gl.LINEAR,m.gl.CLAMP_TO_EDGE),u===0&&t.sourceCache.renderHistory.unshift(a.tileID.key));const w=t.getRTTFramebuffer();w.colorAttachment.set(a.textures[u].texture),m.bindFramebuffer.set(w.framebuffer),m.viewport.set([0,0,y,y])}class dl{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,a=t.terrain;for(const u in t.sourceCaches){this._coordsDescendingInv[u]={};const m=t.sourceCaches[u].getVisibleCoordinates();for(const y of m){const w=a.sourceCache.getTerrainCoords(y);for(const E in w)this._coordsDescendingInv[u][E]||(this._coordsDescendingInv[u][E]=[]),this._coordsDescendingInv[u][E].push(w[E])}}for(const u of t._order){const m=t._layers[u],y=m.source;if(this._renderToTexture[m.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const w in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][w]=this._coordsDescendingInv[y][w].map(E=>E.key).sort().join()}}return this._renderableTiles.forEach(u=>{for(const m in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[m][u.tileID.key];y&&y!==u.textureCoords[m]&&u.clearTextures(this.painter),a.needsRerender(m,u.tileID)&&u.clearTextures(this.painter)}this._rerender[u.tileID.key]=!u.textures.length}),a.clearRerenderCache(),a.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const a=t.type,u=this.painter,m=u.style._order,y=u.currentLayer,w=y+1===m.length;if(this._renderToTexture[a]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(m[y]),!w))return!0;if(this._renderToTexture[this._prevType]||a==="hillshade"||this._renderToTexture[a]&&w){this._prevType=a;const E=this._stacks.length-1,C=this._stacks[E]||[];for(const M of this._renderableTiles){if(fl(u,u.style.terrain,M,E),this._rerender[M.tileID.key]){u.context.clear({color:s.Color.transparent});for(let B=0;B<C.length;B++){const U=u.style._layers[C[B]],G=U.source?this._coordsDescendingInv[U.source][M.tileID.key]:[M.tileID];u._renderTileClippingMasks(U,G),u.renderLayer(u,u.style.sourceCaches[U.source],U,G),U.source&&(M.textureCoords[U.source]=this._coordsDescendingInvStr[U.source][M.tileID.key])}}xa(u,u.style.terrain,M)}if(a==="hillshade"){this._stacks.push([m[y]]);for(const M of this._renderableTiles){const B=this._coordsDescendingInv[t.source][M.tileID.key];fl(u,u.style.terrain,M,this._stacks.length-1),u.context.clear({color:s.Color.transparent}),u._renderTileClippingMasks(t,B),u.renderLayer(u,u.style.sourceCaches[t.source],t,B),xa(u,u.style.terrain,M)}return!0}return this._renderToTexture[a]}return!1}}const Ns={symbol:function(f,t,a,u,m){if(f.renderPass!=="translucent")return;const y=mi.disabled,w=f.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(E,C,M,B,U,G,$){const Y=C.transform,Q=U==="map",le=G==="map";for(const de of E){const _e=B.getTile(de),ee=_e.getBucket(M);if(!ee||!ee.text||!ee.text.segments.get().length)continue;const we=s.evaluateSizeForZoom(ee.textSizeData,Y.zoom),ye=Pi(_e,1,C.transform.zoom),Me=Dn(de.posMatrix,le,Q,C.transform,ye),Pe=M.layout.get("icon-text-fit")!=="none"&&ee.hasIconData();if(we){const je=Math.pow(2,Y.zoom-_e.tileID.overscaledZ);ll(ee,Q,le,$,Y,Me,de.posMatrix,je,we,Pe,C.style.terrain?(Ae,nt)=>C.style.terrain.getElevation(de,Ae,nt):null)}}}(u,f,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),m),a.paint.get("icon-opacity").constantOr(1)!==0&&_a(f,t,a,u,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),y,w),a.paint.get("text-opacity").constantOr(1)!==0&&_a(f,t,a,u,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),y,w),t.map.showCollisionBoxes&&(hs(f,t,a,u,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),hs(f,t,a,u,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,a,u){if(f.renderPass!=="translucent")return;const m=a.paint.get("circle-opacity"),y=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),E=!a.layout.get("circle-sort-key").isConstant();if(m.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const C=f.context,M=C.gl,B=f.depthModeForSublayer(0,Gt.ReadOnly),U=mi.disabled,G=f.colorModeForRenderPass(),$=[];for(let Y=0;Y<u.length;Y++){const Q=u[Y],le=t.getTile(Q),de=le.getBucket(a);if(!de)continue;const _e=de.programConfigurations.get(a.id),ee=f.useProgram("circle",_e),we=de.layoutVertexBuffer,ye=de.indexBuffer,Me=f.style.terrain&&f.style.terrain.getTerrainData(Q),Pe={programConfiguration:_e,program:ee,layoutVertexBuffer:we,indexBuffer:ye,uniformValues:Jo(f,Q,le,a),terrainData:Me};if(E){const je=de.segments.get();for(const Ae of je)$.push({segments:new s.SegmentVector([Ae]),sortKey:Ae.sortKey,state:Pe})}else $.push({segments:de.segments,sortKey:0,state:Pe})}E&&$.sort((Y,Q)=>Y.sortKey-Q.sortKey);for(const Y of $){const{programConfiguration:Q,program:le,layoutVertexBuffer:de,indexBuffer:_e,uniformValues:ee,terrainData:we}=Y.state;le.draw(C,M.TRIANGLES,B,U,G,bi.disabled,ee,we,a.id,de,_e,Y.segments,a.paint,f.transform.zoom,Q)}},heatmap:function(f,t,a,u){if(a.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const m=f.context,y=m.gl,w=mi.disabled,E=new gi([y.ONE,y.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(C,M,B){const U=C.gl;C.activeTexture.set(U.TEXTURE1),C.viewport.set([0,0,M.width/4,M.height/4]);let G=B.heatmapFbo;if(G)U.bindTexture(U.TEXTURE_2D,G.colorAttachment.get()),C.bindFramebuffer.set(G.framebuffer);else{const $=U.createTexture();U.bindTexture(U.TEXTURE_2D,$),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),G=B.heatmapFbo=C.createFramebuffer(M.width/4,M.height/4,!1),function(Y,Q,le,de){const _e=Y.gl;_e.texImage2D(_e.TEXTURE_2D,0,_e.RGBA,Q.width/4,Q.height/4,0,_e.RGBA,Y.extRenderToTextureHalfFloat?Y.extTextureHalfFloat.HALF_FLOAT_OES:_e.UNSIGNED_BYTE,null),de.colorAttachment.set(le)}(C,M,$,G)}})(m,f,a),m.clear({color:s.Color.transparent});for(let C=0;C<u.length;C++){const M=u[C];if(t.hasRenderableParent(M))continue;const B=t.getTile(M),U=B.getBucket(a);if(!U)continue;const G=U.programConfigurations.get(a.id),$=f.useProgram("heatmap",G),{zoom:Y}=f.transform;$.draw(m,y.TRIANGLES,Gt.disabled,w,E,bi.disabled,oa(M.posMatrix,B,Y,a.paint.get("heatmap-intensity")),null,a.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,a.paint,f.transform.zoom,G)}m.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(m,y){const w=m.context,E=w.gl,C=y.heatmapFbo;if(!C)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let M=y.colorRampTexture;M||(M=y.colorRampTexture=new R(w,y.colorRamp,E.RGBA)),M.bind(E.LINEAR,E.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(w,E.TRIANGLES,Gt.disabled,mi.disabled,m.colorModeForRenderPass(),bi.disabled,((B,U,G,$)=>{const Y=s.create();s.ortho(Y,0,B.width,B.height,0,0,1);const Q=B.context.gl;return{u_matrix:Y,u_world:[Q.drawingBufferWidth,Q.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}})(m,y),null,y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(f,a))},line:function(f,t,a,u){if(f.renderPass!=="translucent")return;const m=a.paint.get("line-opacity"),y=a.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const w=f.depthModeForSublayer(0,Gt.ReadOnly),E=f.colorModeForRenderPass(),C=a.paint.get("line-dasharray"),M=a.paint.get("line-pattern"),B=M.constantOr(1),U=a.paint.get("line-gradient"),G=a.getCrossfadeParameters(),$=B?"linePattern":C?"lineSDF":U?"lineGradient":"line",Y=f.context,Q=Y.gl;let le=!0;for(const de of u){const _e=t.getTile(de);if(B&&!_e.patternsLoaded())continue;const ee=_e.getBucket(a);if(!ee)continue;const we=ee.programConfigurations.get(a.id),ye=f.context.program.get(),Me=f.useProgram($,we),Pe=le||Me.program!==ye,je=f.style.terrain&&f.style.terrain.getTerrainData(de),Ae=M.constantOr(null);if(Ae&&_e.imageAtlas){const ot=_e.imageAtlas,Dt=ot.patternPositions[Ae.to.toString()],Ot=ot.patternPositions[Ae.from.toString()];Dt&&Ot&&we.setConstantPatternPositions(Dt,Ot)}const nt=je?de:null,Je=B?ca(f,_e,a,G,nt):C?Ps(f,_e,a,C,G,nt):U?qa(f,_e,a,ee.lineClipsArray.length,nt):os(f,_e,a,nt);if(B)Y.activeTexture.set(Q.TEXTURE0),_e.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),we.updatePaintBuffers(G);else if(C&&(Pe||f.lineAtlas.dirty))Y.activeTexture.set(Q.TEXTURE0),f.lineAtlas.bind(Y);else if(U){const ot=ee.gradients[a.id];let Dt=ot.texture;if(a.gradientVersion!==ot.version){let Ot=256;if(a.stepInterpolant){const yt=t.getSource().maxzoom,$t=de.canonical.z===yt?Math.ceil(1<<f.transform.maxZoom-de.canonical.z):1;Ot=s.clamp(s.nextPowerOfTwo(ee.maxLineLength/s.EXTENT*1024*$t),256,Y.maxTextureSize)}ot.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:ot.gradient||void 0,clips:ee.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new R(Y,ot.gradient,Q.RGBA),ot.version=a.gradientVersion,Dt=ot.texture}Y.activeTexture.set(Q.TEXTURE0),Dt.bind(a.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}Me.draw(Y,Q.TRIANGLES,w,f.stencilModeForClipping(de),E,bi.disabled,Je,je,a.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,a.paint,f.transform.zoom,we,ee.layoutVertexBuffer2),le=!1}},fill:function(f,t,a,u){const m=a.paint.get("fill-color"),y=a.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const w=f.colorModeForRenderPass(),E=a.paint.get("fill-pattern"),C=f.opaquePassEnabledForLayer()&&!E.constantOr(1)&&m.constantOr(s.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===C){const M=f.depthModeForSublayer(1,f.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly);Os(f,t,a,u,M,w,!1)}if(f.renderPass==="translucent"&&a.paint.get("fill-antialias")){const M=f.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly);Os(f,t,a,u,M,w,!0)}},"fill-extrusion":function(f,t,a,u){const m=a.paint.get("fill-extrusion-opacity");if(m!==0&&f.renderPass==="translucent"){const y=new Gt(f.context.gl.LEQUAL,Gt.ReadWrite,f.depthRangeFor3D);if(m!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Vs(f,t,a,u,y,mi.disabled,gi.disabled),Vs(f,t,a,u,y,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const w=f.colorModeForRenderPass();Vs(f,t,a,u,y,mi.disabled,w)}}},hillshade:function(f,t,a,u){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const m=f.context,y=f.depthModeForSublayer(0,Gt.ReadOnly),w=f.colorModeForRenderPass(),[E,C]=f.renderPass==="translucent"?f.stencilConfigForOverlap(u):[{},u];for(const M of C){const B=t.getTile(M);B.needsHillshadePrepare!==void 0&&B.needsHillshadePrepare&&f.renderPass==="offscreen"?cl(f,B,a,y,mi.disabled,w):f.renderPass==="translucent"&&no(f,M,B,a,y,E[M.overscaledZ],w)}m.viewport.set([0,0,f.width,f.height])},raster:function(f,t,a,u){if(f.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!u.length)return;const m=f.context,y=m.gl,w=t.getSource(),E=f.useProgram("raster"),C=f.colorModeForRenderPass(),[M,B]=w instanceof Lt?[{},u]:f.stencilConfigForOverlap(u),U=B[B.length-1].overscaledZ,G=!f.options.moving;for(const $ of B){const Y=f.depthModeForSublayer($.overscaledZ-U,a.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,y.LESS),Q=t.getTile($);Q.registerFadeDuration(a.paint.get("raster-fade-duration"));const le=t.findLoadedParent($,0),de=ya(Q,le,t,a,f.transform,f.style.terrain);let _e,ee;const we=a.paint.get("raster-resampling")==="nearest"?y.NEAREST:y.LINEAR;m.activeTexture.set(y.TEXTURE0),Q.texture.bind(we,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),m.activeTexture.set(y.TEXTURE1),le?(le.texture.bind(we,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,le.tileID.overscaledZ-Q.tileID.overscaledZ),ee=[Q.tileID.canonical.x*_e%1,Q.tileID.canonical.y*_e%1]):Q.texture.bind(we,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST);const ye=f.style.terrain&&f.style.terrain.getTerrainData($),Me=ye?$:null,Pe=Me?Me.posMatrix:f.transform.calculatePosMatrix($.toUnwrapped(),G),je=Yo(Pe,ee||[0,0],_e||1,de,a);w instanceof Lt?E.draw(m,y.TRIANGLES,Y,mi.disabled,C,bi.disabled,je,ye,a.id,w.boundsBuffer,f.quadTriangleIndexBuffer,w.boundsSegments):E.draw(m,y.TRIANGLES,Y,M[$.overscaledZ],C,bi.disabled,je,ye,a.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,t,a,u){const m=a.paint.get("background-color"),y=a.paint.get("background-opacity");if(y===0)return;const w=f.context,E=w.gl,C=f.transform,M=C.tileSize,B=a.paint.get("background-pattern");if(f.isPatternMissing(B))return;const U=!B&&m.a===1&&y===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==U)return;const G=mi.disabled,$=f.depthModeForSublayer(0,U==="opaque"?Gt.ReadWrite:Gt.ReadOnly),Y=f.colorModeForRenderPass(),Q=f.useProgram(B?"backgroundPattern":"background"),le=u||C.coveringTiles({tileSize:M,terrain:f.style.terrain});B&&(w.activeTexture.set(E.TEXTURE0),f.imageManager.bind(f.context));const de=a.getCrossfadeParameters();for(const _e of le){const ee=u?_e.posMatrix:f.transform.calculatePosMatrix(_e.toUnwrapped()),we=B?fc(ee,y,f,B,{tileID:_e,tileSize:M},de):hc(ee,y,m),ye=f.style.terrain&&f.style.terrain.getTerrainData(_e);Q.draw(w,E.TRIANGLES,$,G,Y,bi.disabled,we,ye,a.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}},debug:function(f,t,a){for(let u=0;u<a.length;u++)Tc(f,t,a[u])},custom:function(f,t,a){const u=f.context,m=a.implementation;if(f.renderPass==="offscreen"){const y=m.prerender;y&&(f.setCustomLayerDefaults(),u.setColorMode(f.colorModeForRenderPass()),y.call(m,u.gl,f.transform.customLayerMatrix()),u.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),u.setColorMode(f.colorModeForRenderPass()),u.setStencilMode(mi.disabled);const y=m.renderingMode==="3d"?new Gt(f.context.gl.LEQUAL,Gt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Gt.ReadOnly);u.setDepthMode(y),m.render(u.gl,f.transform.customLayerMatrix()),u.setDirty(),f.setBaseState(),u.bindFramebuffer.set(null)}}};class ao{constructor(t,a){this.context=new ol(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.create(),renderTime:0},this.setup(),this.numSublayers=He.maxUnderzooming+He.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new kt,this.gpuTimers={}}resize(t,a,u){if(this.width=t*u,this.height=a*u,this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,a=new s.PosArray;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(a,Ht.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const u=new s.PosArray;u.emplaceBack(0,0),u.emplaceBack(s.EXTENT,0),u.emplaceBack(0,s.EXTENT),u.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=t.createVertexBuffer(u,Ht.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const m=new s.RasterBoundsArray;m.emplaceBack(0,0,0,0),m.emplaceBack(s.EXTENT,0,s.EXTENT,0),m.emplaceBack(0,s.EXTENT,0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(m,Si.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const y=new s.PosArray;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,Ht.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const w=new s.LineStripIndexArray;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const E=new s.TriangleIndexArray;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new R(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const C=this.context.gl;this.stencilClearMode=new mi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=s.create();s.ortho(u,0,this.width,this.height,0,0,1),s.scale(u,u,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,a.TRIANGLES,Gt.disabled,this.stencilClearMode,gi.disabled,bi.disabled,as(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source;const u=this.context,m=u.gl;this.nextStencilID+a.length>256&&this.clearStencil(),u.setColorMode(gi.disabled),u.setDepthMode(Gt.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of a){const E=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,C=this.style.terrain&&this.style.terrain.getTerrainData(w);y.draw(u,m.TRIANGLES,Gt.disabled,new mi({func:m.ALWAYS,mask:0},E,255,m.KEEP,m.KEEP,m.REPLACE),gi.disabled,bi.disabled,as(w.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new mi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new mi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,u=t.sort((w,E)=>E.overscaledZ-w.overscaledZ),m=u[u.length-1].overscaledZ,y=u[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let E=0;E<y;E++)w[E+m]=new mi({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[w,u]}return[{[m]:mi.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new gi([t.CONSTANT_COLOR,t.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gi.unblended:gi.alphaBlended}depthModeForSublayer(t,a,u){if(!this.opaquePassEnabledForLayer())return Gt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Gt(u||this.context.gl.LEQUAL,a,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const u=this.style._order,m=this.style.sourceCaches,y=this.style.terrain&&new dl(this);for(const M in m){const B=m[M];B.used&&B.prepare(this.context)}const w={},E={},C={};for(const M in m){const B=m[M];w[M]=B.getVisibleCoordinates(),E[M]=w[M].slice().reverse(),C[M]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<u.length;M++)if(this.style._layers[u[M]].is3D()){this.opaquePassCutoff=M;break}if(y){this.opaquePassCutoff=0;const M=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||M.length)&&(s.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,U){const G=B.context,$=G.gl,Y=gi.unblended,Q=new Gt($.LEQUAL,Gt.ReadWrite,[0,1]),le=U.getTerrainMesh(),de=U.sourceCache.getRenderableTiles(),_e=B.useProgram("terrainDepth");G.bindFramebuffer.set(U.getFramebuffer("depth").framebuffer),G.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),G.clear({color:s.Color.transparent,depth:1});for(const ee of de){const we=U.getTerrainData(ee.tileID),ye=B.transform.calculatePosMatrix(ee.tileID.toUnwrapped());_e.draw(G,$.TRIANGLES,Q,mi.disabled,Y,bi.backCCW,{u_matrix:ye},we,"terrain",le.vertexBuffer,le.indexBuffer,le.segments)}G.bindFramebuffer.set(null),G.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain),function(B,U){const G=B.context,$=G.gl,Y=gi.unblended,Q=new Gt($.LEQUAL,Gt.ReadWrite,[0,1]),le=U.getTerrainMesh(),de=U.getCoordsTexture(),_e=U.sourceCache.getRenderableTiles(),ee=B.useProgram("terrainCoords");G.bindFramebuffer.set(U.getFramebuffer("coords").framebuffer),G.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),G.clear({color:s.Color.transparent,depth:1}),U.coordsIndex=[];for(const we of _e){const ye=U.getTerrainData(we.tileID);G.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,de.texture);const Me=B.transform.calculatePosMatrix(we.tileID.toUnwrapped());ee.draw(G,$.TRIANGLES,Q,mi.disabled,Y,bi.backCCW,{u_matrix:Me,u_terrain_coords_id:(255-U.coordsIndex.length)/255,u_texture:0},ye,"terrain",le.vertexBuffer,le.indexBuffer,le.segments),U.coordsIndex.push(we.tileID.key)}G.bindFramebuffer.set(null),G.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const M of u){const B=this.style._layers[M];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const U=E[B.source];(B.type==="custom"||U.length)&&this.renderLayer(this,m[B.source],B,U)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!y)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[u[this.currentLayer]],B=m[M.source],U=w[M.source];this._renderTileClippingMasks(M,U),this.renderLayer(this,B,M,U)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const M=this.style._layers[u[this.currentLayer]],B=m[M.source];if(y&&y.renderLayer(M))continue;const U=(M.type==="symbol"?C:E)[M.source];this._renderTileClippingMasks(M,w[M.source]),this.renderLayer(this,B,M,U)}if(this.options.showTileBoundaries){let M,B;Object.values(this.style._layers).forEach(U=>{U.source&&!U.isHidden(this.transform.zoom)&&(U.source!==(B&&B.id)&&(B=this.style.sourceCaches[U.source]),(!M||M.getSource().maxzoom<B.getSource().maxzoom)&&(M=B))}),M&&Ns.debug(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const B=M.transform.padding;Vn(M,M.transform.height-(B.top||0),3,va),Vn(M,B.bottom||0,3,Gr),Us(M,B.left||0,3,ul),Us(M,M.transform.width-(B.right||0),3,so);const U=M.transform.centerPoint;(function(G,$,Y,Q){fs(G,$-1,Y-10,2,20,Q),fs(G,$-10,Y-1,20,2,Q)})(M,U.x,M.transform.height-U.y,hl)}(this),this.context.setDefault()}renderLayer(t,a,u,m){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(m||[]).length)&&(this.id=u.id,this.gpuTimingStart(u),Ns[u.type](t,a,u,m,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let u=this.gpuTimers[t.id];u||(u=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),u.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,u.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const a={};for(const u in t){const m=t[u],y=this.context.extTimerQuery,w=y.getQueryObjectEXT(m.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(m.query),a[u]=w}return a}translatePosMatrix(t,a,u,m,y){if(!u[0]&&!u[1])return t;const w=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const M=Math.sin(w),B=Math.cos(w);u=[u[0]*B-u[1]*M,u[0]*M+u[1]*B]}const E=[y?u[0]:Pi(a,u[0],this.transform.zoom),y?u[1]:Pi(a,u[1],this.transform.zoom),0],C=new Float32Array(16);return s.translate(C,t,E),C}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!a||!u}useProgram(t,a){this.cache=this.cache||{};const u=t+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new Xo(this.context,t,zs[t],a,Xa[t],this._showOverdrawInspector,this.style.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new R(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class ba{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,u){const m=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=1/(E=s.transformMat4([],E,t))[3]/a*m;return s.mul$1(E,E,[C,C,1/E[3],C])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=s.sub([],y[E[0]],y[E[1]]),M=s.sub([],y[E[2]],y[E[1]]),B=s.normalize([],s.cross([],C,M)),U=-s.dot(B,y[E[1]]);return B.concat(U)});return new ba(y,w)}}class js{constructor(t,a){this.min=t,this.max=a,this.center=s.scale$1([],s.add([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],u=s.clone$2(this.min),m=s.clone$2(this.max);for(let y=0;y<a.length;y++)u[y]=a[y]?this.min[y]:this.center[y],m[y]=a[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new js(u,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let m=0;m<t.planes.length;m++){const y=t.planes[m];let w=0;for(let E=0;E<a.length;E++)s.dot$1(y,a[E])>=0&&w++;if(w===0)return 0;w!==a.length&&(u=!1)}if(u)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let E=0;E<t.points.length;E++){const C=t.points[E][m]-this.min[m];y=Math.min(y,C),w=Math.max(w,C)}if(w<0||y>this.max[m]-this.min[m])return 0}return 1}}class ds{constructor(t=0,a=0,u=0,m=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=u,this.right=m}interpolate(t,a,u){return a.top!=null&&t.top!=null&&(this.top=s.number(t.top,a.top,u)),a.bottom!=null&&t.bottom!=null&&(this.bottom=s.number(t.bottom,a.bottom,u)),a.left!=null&&t.left!=null&&(this.left=s.number(t.left,a.left,u)),a.right!=null&&t.right!=null&&(this.right=s.number(t.right,a.right,u)),this}getCenter(t,a){const u=s.clamp((this.left+t-this.right)/2,0,t),m=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.pointGeometry(u,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ds(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Gs{constructor(t,a,u,m,y){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=y===void 0||!!y,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=u??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ds,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Gs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const a=-s.wrap(t,-180,180)*Math.PI/180;var u;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(u=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),function(m,y,w){var E=y[0],C=y[1],M=y[2],B=y[3],U=Math.sin(w),G=Math.cos(w);m[0]=E*G+M*U,m[1]=C*G+B*U,m[2]=E*-U+M*G,m[3]=C*-U+B*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=s.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,u){this._unmodified=!1,this._edgeInsets.interpolate(t,a,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new s.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const u=this.pointCoordinate(new s.pointGeometry(0,0)),m=this.pointCoordinate(new s.pointGeometry(this.width,0)),y=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new s.pointGeometry(0,this.height)),E=Math.floor(Math.min(u.x,m.x,y.x,w.x)),C=Math.floor(Math.max(u.x,m.x,y.x,w.x)),M=1;for(let B=E-M;B<=C+M;B++)B!==0&&a.push(new s.UnwrappedTileID(B,t))}return a}coveringTiles(t){var a,u;let m=this.coveringZoomLevel(t);const y=m;if(t.minzoom!==void 0&&m<t.minzoom)return[];t.maxzoom!==void 0&&m>t.maxzoom&&(m=t.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),E=s.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,m),M=[C*w.x,C*w.y,0],B=[C*E.x,C*E.y,0],U=ba.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let G=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(G=m);const $=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,Y=ee=>({aabb:new js([ee*C,0,0],[(ee+1)*C,C,0]),zoom:0,x:0,y:0,wrap:ee,fullyVisible:!1}),Q=[],le=[],de=m,_e=t.reparseOverscaled?y:m;if(this._renderWorldCopies)for(let ee=1;ee<=3;ee++)Q.push(Y(-ee)),Q.push(Y(ee));for(Q.push(Y(0));Q.length>0;){const ee=Q.pop(),we=ee.x,ye=ee.y;let Me=ee.fullyVisible;if(!Me){const ot=ee.aabb.intersects(U);if(ot===0)continue;Me=ot===2}const Pe=t.terrain?M:B,je=ee.aabb.distanceX(Pe),Ae=ee.aabb.distanceY(Pe),nt=Math.max(Math.abs(je),Math.abs(Ae)),Je=$+(1<<de-ee.zoom)-2;if(ee.zoom===de||nt>Je&&ee.zoom>=G){const ot=de-ee.zoom,Dt=M[0]-.5-(we<<ot),Ot=M[1]-.5-(ye<<ot);le.push({tileID:new s.OverscaledTileID(ee.zoom===de?_e:ee.zoom,ee.wrap,ee.zoom,we,ye),distanceSq:s.sqrLen([B[0]-.5-we,B[1]-.5-ye]),tileDistanceToCamera:Math.sqrt(Dt*Dt+Ot*Ot)})}else for(let ot=0;ot<4;ot++){const Dt=(we<<1)+ot%2,Ot=(ye<<1)+(ot>>1),yt=ee.zoom+1;let $t=ee.aabb.quadrant(ot);if(t.terrain){const ei=new s.OverscaledTileID(yt,ee.wrap,yt,Dt,Ot),qt=t.terrain.getMinMaxElevation(ei),Kt=(a=qt.minElevation)!==null&&a!==void 0?a:this.elevation,ri=(u=qt.maxElevation)!==null&&u!==void 0?u:this.elevation;$t=new js([$t.min[0],$t.min[1],Kt],[$t.max[0],$t.max[1],ri])}Q.push({aabb:$t,zoom:yt,x:Dt,y:Ot,wrap:ee.wrap,fullyVisible:Me})}}return le.sort((ee,we)=>ee.distanceSq-we.distanceSq).map(ee=>ee.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=s.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.pointGeometry(s.mercatorXfromLng(t.lng)*this.worldSize,s.mercatorYfromLat(a)*this.worldSize)}unproject(t){return new s.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,a){const u=s.MercatorCoordinate.fromLngLat(t),m=(1<<this.tileZoom)*s.EXTENT,y=u.x*m,w=u.y*m,E=Math.floor(y/s.EXTENT),C=Math.floor(w/s.EXTENT),M=new s.OverscaledTileID(this.tileZoom,0,this.tileZoom,E,C);return a.getElevation(M,y%s.EXTENT,w%s.EXTENT,s.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const a=this.pointLocation(this.centerPoint,t),u=this.getElevation(a,t);if(!(this.elevation-u))return;const m=this.getCameraPosition(),y=s.MercatorCoordinate.fromLngLat(m.lngLat,m.altitude),w=s.MercatorCoordinate.fromLngLat(a,u),E=y.x-w.x,C=y.y-w.y,M=y.z-w.z,B=Math.sqrt(E*E+C*C+M*M),U=this.scaleZoom(this.cameraToCenterDistance/B/this.tileSize);this._elevation=u,this._center=a,this.zoom=U}setLocationAtPoint(t,a){const u=this.pointCoordinate(a),m=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(t),w=new s.MercatorCoordinate(y.x-(u.x-m.x),y.y-(u.y-m.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,a){return a?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,a),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,a){return this.coordinateLocation(this.pointCoordinate(t,a))}locationCoordinate(t){return s.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,a){if(a){const G=a.pointCoordinate(t);if(G!=null)return G}const u=[t.x,t.y,0,1],m=[t.x,t.y,1,1];s.transformMat4(u,u,this.pixelMatrixInverse),s.transformMat4(m,m,this.pixelMatrixInverse);const y=u[3],w=m[3],E=u[1]/y,C=m[1]/w,M=u[2]/y,B=m[2]/w,U=M===B?0:(0-M)/(B-M);return new s.MercatorCoordinate(s.number(u[0]/y,m[0]/w,U)/this.worldSize,s.number(E,C,U)/this.worldSize)}coordinatePoint(t,a=0,u=this.pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,a,1];return s.transformMat4(m,m,u),new s.pointGeometry(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new s.LngLatBounds().extend(this.pointLocation(new s.pointGeometry(0,t))).extend(this.pointLocation(new s.pointGeometry(this.width,t))).extend(this.pointLocation(new s.pointGeometry(this.width,this.height))).extend(this.pointLocation(new s.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,a=!1){const u=t.key,m=a?this._alignedPosMatrixCache:this._posMatrixCache;if(m[u])return m[u];const y=t.canonical,w=this.worldSize/this.zoomScale(y.z),E=y.x+Math.pow(2,y.z)*t.wrap,C=s.identity(new Float64Array(16));return s.translate(C,C,[E*w,y.y*w,0]),s.scale(C,C,[w/s.EXTENT,w/s.EXTENT,1]),s.multiply(C,a?this.alignedProjMatrix:this.projMatrix,C),m[u]=new Float32Array(C),m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,a,u,m,y=-90,w=90,E=-180,C=180;const M=this.size,B=this._unmodified;if(this.latRange){const $=this.latRange;y=s.mercatorYfromLat($[1])*this.worldSize,w=s.mercatorYfromLat($[0])*this.worldSize,t=w-y<M.y?M.y/(w-y):0}if(this.lngRange){const $=this.lngRange;E=s.wrap(s.mercatorXfromLng($[0])*this.worldSize,0,this.worldSize),C=s.wrap(s.mercatorXfromLng($[1])*this.worldSize,0,this.worldSize),C<E&&(C+=this.worldSize),a=C-E<M.x?M.x/(C-E):0}const U=this.point,G=Math.max(a||0,t||0);if(G)return this.center=this.unproject(new s.pointGeometry(a?(C+E)/2:U.x,t?(w+y)/2:U.y)),this.zoom+=this.scaleZoom(G),this._unmodified=B,void(this._constraining=!1);if(this.latRange){const $=U.y,Y=M.y/2;$-Y<y&&(m=y+Y),$+Y>w&&(m=w-Y)}if(this.lngRange){const $=(E+C)/2,Y=s.wrap(U.x,$-this.worldSize/2,$+this.worldSize/2),Q=M.x/2;Y-Q<E&&(u=E+Q),Y+Q>C&&(u=C-Q)}u===void 0&&m===void 0||(this.center=this.unproject(new s.pointGeometry(u!==void 0?u:U.x,m!==void 0?m:U.y)).wrap()),this._unmodified=B,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let m=s.identity(new Float64Array(16));s.scale(m,m,[this.width/2,-this.height/2,1]),s.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=s.identity(new Float64Array(16)),s.scale(m,m,[1,-1,1]),s.translate(m,m,[-1,-1,0]),s.scale(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const y=Math.PI/2+this._pitch,w=this._fov*(.5+t.y/this.height),E=Math.sin(w)*this.cameraToSeaLevelDistance/Math.sin(s.clamp(Math.PI-y-w,.01,Math.PI-.01)),C=this.getHorizon(),M=2*Math.atan(C/this.cameraToCenterDistance)*(.5+t.y/(2*C)),B=Math.sin(M)*this.cameraToSeaLevelDistance/Math.sin(s.clamp(Math.PI-y-M,.01,Math.PI-.01)),U=Math.cos(Math.PI/2-this._pitch)*E+this.cameraToSeaLevelDistance,G=Math.cos(Math.PI/2-this._pitch)*B+this.cameraToSeaLevelDistance,$=1.01*Math.min(U,G),Y=this.height/50;m=new Float64Array(16),s.perspective(m,this._fov,this.width/this.height,Y,$),m[8]=2*-t.x/this.width,m[9]=2*t.y/this.height,s.scale(m,m,[1,-1,1]),s.translate(m,m,[0,0,-this.cameraToCenterDistance]),s.rotateX(m,m,this._pitch),s.rotateZ(m,m,this.angle),s.translate(m,m,[-a,-u,0]),this.mercatorMatrix=s.scale([],m,[this.worldSize,this.worldSize,this.worldSize]),s.scale(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,m),s.translate(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=s.invert([],m),this.pixelMatrix3D=s.multiply(new Float64Array(16),this.labelPlaneMatrix,m);const Q=this.width%2/2,le=this.height%2/2,de=Math.cos(this.angle),_e=Math.sin(this.angle),ee=a-Math.round(a)+de*Q+_e*le,we=u-Math.round(u)+de*le+_e*Q,ye=new Float64Array(m);if(s.translate(ye,ye,[ee>.5?ee-1:ee,we>.5?we-1:we,0]),this.alignedProjMatrix=ye,m=s.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new s.pointGeometry(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.transformMat4(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,t))}getCameraQueryGeometry(t){const a=this.getCameraPoint();if(t.length===1)return[t[0],a];{let u=a.x,m=a.y,y=a.x,w=a.y;for(const E of t)u=Math.min(u,E.x),m=Math.min(m,E.y),y=Math.max(y,E.x),w=Math.max(w,E.y);return[new s.pointGeometry(u,m),new s.pointGeometry(y,m),new s.pointGeometry(y,w),new s.pointGeometry(u,w),new s.pointGeometry(u,m)]}}}class pl{constructor(t){this._hashName=t&&encodeURIComponent(t),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(a,u){let m=!1,y=null;const w=()=>{y=null,m&&(a(),y=setTimeout(w,300),m=!1)};return()=>(m=!0,y||w(),y)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,m=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),w=Math.round(a.lng*y)/y,E=Math.round(a.lat*y)/y,C=this._map.getBearing(),M=this._map.getPitch();let B="";if(B+=t?`/${w}/${E}/${u}`:`${u}/${E}/${w}`,(C||M)&&(B+="/"+Math.round(10*C)/10),M&&(B+=`/${Math.round(M)}`),this._hashName){const U=this._hashName;let G=!1;const $=window.location.hash.slice(1).split("&").map(Y=>{const Q=Y.split("=")[0];return Q===U?(G=!0,`${Q}=${B}`):Y}).filter(Y=>Y);return G||$.push(`${U}=${B}`),`#${$.join("&")}`}return`#${B}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(a=u)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:a,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const qs={linearity:.3,easing:s.bezier(0,0,.3,1)},ml=s.extend({deceleration:2500,maxSpeed:1400},qs),gl=s.extend({deceleration:20,maxSpeed:1400},qs),_l=s.extend({deceleration:1e3,maxSpeed:360},qs),ps=s.extend({deceleration:1e3,maxSpeed:90},qs);class yl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=s.exported.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){const y=Xs(a.pan.mag(),u,s.extend({},ml,t||{}));m.offset=a.pan.mult(y.amount/a.pan.mag()),m.center=this._map.transform.center,Zs(m,y)}if(a.zoom){const y=Xs(a.zoom,u,gl);m.zoom=this._map.transform.zoom+y.amount,Zs(m,y)}if(a.bearing){const y=Xs(a.bearing,u,_l);m.bearing=this._map.transform.bearing+s.clamp(y.amount,-179,179),Zs(m,y)}if(a.pitch){const y=Xs(a.pitch,u,ps);m.pitch=this._map.transform.pitch+y.amount,Zs(m,y)}if(m.zoom||m.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),s.extend(m,{noMoveStart:!0})}}function Zs(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function Xs(f,t,a){const{maxSpeed:u,linearity:m,deceleration:y}=a,w=s.clamp(f*m/(t/1e3),-u,u),E=Math.abs(w)/(y*m);return{easing:a.easing,duration:1e3*E,amount:w*(E/2)}}class Cr extends s.Event{constructor(t,a,u,m={}){const y=z.mousePos(a.getCanvasContainer(),u),w=a.unproject(y);super(t,s.extend({point:y,lngLat:w,originalEvent:u},m)),this._defaultPrevented=!1,this.target=a}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Hs extends s.Event{constructor(t,a,u){const m=t==="touchend"?u.changedTouches:u.touches,y=z.touchPos(a.getCanvasContainer(),m),w=y.map(C=>a.unproject(C)),E=y.reduce((C,M,B,U)=>C.add(M.div(U.length)),new s.pointGeometry(0,0));super(t,{points:y,point:E,lngLats:w,lngLat:a.unproject(E),originalEvent:u}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ar extends s.Event{constructor(t,a,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class kc{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ar(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Cr(t.type,this._map,t))}mouseup(t){this._map.fire(new Cr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Cr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Cr(t.type,this._map,t))}mouseover(t){this._map.fire(new Cr(t.type,this._map,t))}mouseout(t){this._map.fire(new Cr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Hs(t.type,this._map,t))}touchmove(t){this._map.fire(new Hs(t.type,this._map,t))}touchend(t){this._map.fire(new Hs(t.type,this._map,t))}touchcancel(t){this._map.fire(new Hs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Cr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Cr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vl{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(z.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const u=a;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=u,this._box||(this._box=z.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(m.x,u.x),w=Math.max(m.x,u.x),E=Math.min(m.y,u.y),C=Math.max(m.y,u.y);z.setTransform(this._box,`translate(${y}px,${E}px)`),this._box.style.width=w-y+"px",this._box.style.height=C-E+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const u=this._startPos,m=a;if(this.reset(),z.suppressClick(),u.x!==m.x||u.y!==m.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(u,m,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new s.Event(t,{originalEvent:a}))}}function un(f,t){if(f.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${t.length}`);const a={};for(let u=0;u<f.length;u++)a[f[u].identifier]=t[u];return a}class Ws{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(m){const y=new s.pointGeometry(0,0);for(const w of m)y._add(w);return y.div(m.length)}(a),this.touches=un(u,a)))}touchmove(t,a,u){if(this.aborted||!this.centroid)return;const m=un(u,a);for(const y in this.touches){const w=this.touches[y],E=m[y];(!E||E.dist(w)>30)&&(this.aborted=!0)}}touchend(t,a,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class oo{constructor(t){this.singleTap=new Ws(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,u){this.singleTap.touchstart(t,a,u)}touchmove(t,a,u){this.singleTap.touchmove(t,a,u)}touchend(t,a,u){const m=this.singleTap.touchend(t,a,u);if(m){const y=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(y&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Ec{constructor(){this._zoomIn=new oo({numTouches:1,numTaps:2}),this._zoomOut=new oo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,u){this._zoomIn.touchstart(t,a,u),this._zoomOut.touchstart(t,a,u)}touchmove(t,a,u){this._zoomIn.touchmove(t,a,u),this._zoomOut.touchmove(t,a,u)}touchend(t,a,u){const m=this._zoomIn.touchend(t,a,u),y=this._zoomOut.touchend(t,a,u);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Sc={0:1,2:2};class wa{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const u=z.mouseButton(t);this._correctButton(t,u)&&(this._lastPoint=a,this._eventButton=u)}mousemoveWindow(t,a){const u=this._lastPoint;if(u){if(t.preventDefault(),function(m,y){const w=Sc[y];return m.buttons===void 0||(m.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(u,a)}}mouseupWindow(t){this._lastPoint&&z.mouseButton(t)===this._eventButton&&(this._moved&&z.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ks extends wa{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class hn extends wa{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const u=.8*(a.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){t.preventDefault()}}class ct extends wa{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const u=-.5*(a.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){t.preventDefault()}}class xl{constructor(t,a){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,a,u){return this._calculateTransform(t,a,u)}touchmove(t,a,u){if(this._map._cooperativeGestures&&(this._minTouches===2&&u.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,u.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(u.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,a,u)}touchend(t,a,u){this._calculateTransform(t,a,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,u){u.length>0&&(this._active=!0);const m=un(u,a),y=new s.pointGeometry(0,0),w=new s.pointGeometry(0,0);let E=0;for(const M in m){const B=m[M],U=this._touches[M];U&&(y._add(B),w._add(B.sub(U)),E++,m[M]=B)}if(this._touches=m,E<this._minTouches||!w.mag())return;const C=w.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Un{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,a,u){return{}}touchstart(t,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,u){if(!this._firstTwoTouches)return;t.preventDefault();const[m,y]=this._firstTwoTouches,w=En(u,a,m),E=En(u,a,y);if(!w||!E)return;const C=this._aroundCenter?null:w.add(E).div(2);return this._move([w,E],C,t)}touchend(t,a,u){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,w=En(u,a,m),E=En(u,a,y);w&&E||(this._active&&z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function En(f,t,a){for(let u=0;u<f.length;u++)if(f[u].identifier===a)return t[u]}function lo(f,t){return Math.log(f/t)/Math.LN2}class et extends Un{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(lo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lo(this._distance,u),pinchAround:a}}}function Ta(f,t){return 180*f.angleWith(t)/Math.PI}class Ic extends Un{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const u=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ta(this._vector,u),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,u=Ta(t,this._startVector);return Math.abs(u)<a}}function co(f){return Math.abs(f.y)>Math.abs(f.x)}class uo extends Un{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,u){super.touchstart(t,a,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,co(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,u){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),y=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,u){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,y=a.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return co(t)&&co(a)&&w}}const bl={panStep:100,bearingStep:15,pitchStep:10};class wl{constructor(){const t=bl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,u=0,m=0,y=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,m=0),{cameraAnimation:E=>{const C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Cc,zoom:a?Math.round(C)+a*(t.shiftKey?2:1):C,bearing:E.getBearing()+u*this._bearingStep,pitch:E.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cc(f){return f*(2-f)}const Tl=4.000244140625;class ho{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=s.exported.now(),m=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%Tl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=z.mousePos(this._el,t);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(a)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Tl?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&C!==0&&(C=1/C);const M=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(M*C))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,u=this._startZoom,m=this._easing;let y,w=!1;if(this._type==="wheel"&&u&&m){const E=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),C=m(E);y=s.number(u,a,C),E<1?this._frameId||(this._frameId=!0):w=!0}else y=a,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:y-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=s.ease;if(this._prevEase){const u=this._prevEase,m=(s.exported.now()-u.start)/u.duration,y=u.easing(m+.01)-u.easing(m),w=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-w*w);a=s.bezier(w,E,.25,1)}return this._prevEase={start:s.exported.now(),duration:t,easing:a},a}reset(){this._active=!1}}class fo{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class po{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mo{constructor(){this._tap=new oo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,a,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=a[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,a,u))}touchmove(t,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const m=a[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,a,u)}touchend(t,a,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,a,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yr{constructor(t,a,u){this._el=t,this._mousePan=a,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sn{constructor(t,a,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class kl{constructor(t,a,u,m){this._el=t,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ms=f=>f.zoom||f.drag||f.pitch||f.rotate;class go extends s.Event{}function Js(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class El{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yl(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,w]of this._listeners)z.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,a,u]of this._listeners)z.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new kc(a,t));const m=a.boxZoom=new vl(a,t);this._add("boxZoom",m);const y=new Ec,w=new po;a.doubleClickZoom=new fo(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const E=new mo;this._add("tapDragZoom",E);const C=a.touchPitch=new uo(a);this._add("touchPitch",C);const M=new hn(t),B=new ct(t);a.dragRotate=new Sn(t,M,B),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const U=new Ks(t),G=new xl(t,a);a.dragPan=new yr(u,U,G),this._add("mousePan",U),this._add("touchPan",G,["touchZoom","touchRotate"]);const $=new Ic,Y=new et;a.touchZoomRotate=new kl(u,Y,$,E),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]);const Q=a.scrollZoom=new ho(a,this);this._add("scrollZoom",Q,["mousePan"]);const le=a.keyboard=new wl;this._add("keyboard",le),this._add("blockableMapEvent",new kn(a));for(const de of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[de]&&a[de].enable(t[de])}_add(t,a,u){this._handlers.push({handlerName:t,handler:a,allowed:u}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ms(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,u){for(const m in t)if(m!==u&&(!a||a.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const u of t)this._el.contains(u.target)&&a.push(u);return a}handleEvent(t,a){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const u=t.type==="renderFrame"?void 0:t,m={needsRenderFrame:!1},y={},w={},E=t.touches,C=E?this._getMapTouches(E):void 0,M=C?z.touchPos(this._el,C):z.mousePos(this._el,t);for(const{handlerName:G,handler:$,allowed:Y}of this._handlers){if(!$.isEnabled())continue;let Q;this._blockedByActive(w,Y,G)?$.reset():$[a||t.type]&&(Q=$[a||t.type](t,M,C),this.mergeHandlerResult(m,y,Q,G,u),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||$.isActive())&&(w[G]=$)}const B={};for(const G in this._previousActiveHandlers)w[G]||(B[G]=u);this._previousActiveHandlers=w,(Object.keys(B).length||Js(m))&&(this._changes.push([m,y,B]),this._triggerRenderFrame()),(Object.keys(w).length||Js(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=m;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,a,u,m,y){if(!u)return;s.extend(t,u);const w={handlerName:m,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(a.zoom=w),u.panDelta!==void 0&&(a.drag=w),u.pitchDelta!==void 0&&(a.pitch=w),u.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},u={};for(const[m,y,w]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new s.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),s.extend(a,y),s.extend(u,w);this._updateMapTransform(t,a,u),this._changes=[]}_updateMapTransform(t,a,u){const m=this._map,y=m.transform,w=m.style&&m.style.terrain;if(!(Js(t)||w&&this._drag))return this._fireEvents(a,u,!0);let{panDelta:E,zoomDelta:C,bearingDelta:M,pitchDelta:B,around:U,pinchAround:G}=t;G!==void 0&&(U=G),m._stop(!0),U=U||m.transform.centerPoint;const $=y.pointLocation(E?U.sub(E):U);M&&(y.bearing+=M),B&&(y.pitch+=B),C&&(y.zoom+=C),w?a.drag&&!this._drag?(this._drag={center:y.centerPoint,lngLat:y.pointLocation(U),point:U,handlerName:a.drag.handlerName},m.fire(new s.Event("freezeElevation",{freeze:!0}))):this._drag&&u[this._drag.handlerName]?(m.fire(new s.Event("freezeElevation",{freeze:!1})),this._drag=null):a.drag&&this._drag&&(y.center=y.pointLocation(y.centerPoint.sub(E))):y.setLocationAtPoint($,U),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,u,!0)}_fireEvents(t,a,u){const m=ms(this._eventsInProgress),y=ms(t),w={};for(const B in t){const{originalEvent:U}=t[B];this._eventsInProgress[B]||(w[`${B}start`]=U),this._eventsInProgress[B]=t[B]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const B in w)this._fireEvent(B,w[B]);y&&this._fireEvent("move",y.originalEvent);for(const B in t){const{originalEvent:U}=t[B];this._fireEvent(B,U)}const E={};let C;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:G}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],C=a[U]||G,E[`${B}end`]=C)}for(const B in E)this._fireEvent(B,E[B]);const M=ms(this._eventsInProgress);if(u&&(m||y)&&!M){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;B?(U(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:C})):(this._map.fire(new s.Event("moveend",{originalEvent:C})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new s.Event(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new go("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Or={extend:(f,...t)=>s.extend(f,...t),run(f){f()},logToElement(f,t=!1,a="log"){const u=window.document.getElementById(a);u&&(t&&(u.innerHTML=""),u.innerHTML+=`<br>${f}`)}};class wi extends s.Evented{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,u){return t=s.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,s.extend({offset:t},a),u)}panTo(t,a,u){return this.easeTo(s.extend({center:t},a),u)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,u){return this.easeTo(s.extend({zoom:t},a),u)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,u){return this.easeTo(s.extend({bearing:t},a),u)}resetNorth(t,a){return this.rotateTo(0,s.extend({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=s.LngLatBounds.convert(t);const u=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,a)}_cameraForBoxAndBearing(t,a,u,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=s.extend({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const ye=m.padding;m.padding={top:ye,bottom:ye,right:ye,left:ye}}m.padding=s.extend(y,m.padding);const w=this.transform,E=w.padding,C=w.project(s.LngLat.convert(t)),M=w.project(s.LngLat.convert(a)),B=C.rotate(-u*Math.PI/180),U=M.rotate(-u*Math.PI/180),G=new s.pointGeometry(Math.max(B.x,U.x),Math.max(B.y,U.y)),$=new s.pointGeometry(Math.min(B.x,U.x),Math.min(B.y,U.y)),Y=G.sub($),Q=(w.width-(E.left+E.right+m.padding.left+m.padding.right))/Y.x,le=(w.height-(E.top+E.bottom+m.padding.top+m.padding.bottom))/Y.y;if(le<0||Q<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const de=Math.min(w.scaleZoom(w.scale*Math.min(Q,le)),m.maxZoom),_e=s.pointGeometry.convert(m.offset),ee=new s.pointGeometry((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(u*Math.PI/180),we=_e.add(ee).mult(w.scale/w.zoomScale(de));return{center:w.unproject(C.add(M).div(2).sub(we)),zoom:de,bearing:u}}fitBounds(t,a,u){return this._fitInternal(this.cameraForBounds(t,a),a,u)}fitScreenCoordinates(t,a,u,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(t)),this.transform.pointLocation(s.pointGeometry.convert(a)),u,m),m,y)}_fitInternal(t,a,u){return t?(delete(a=s.extend(t,a)).padding,a.linear?this.easeTo(a,u):this.flyTo(a,u)):this}jumpTo(t,a){this.stop();const u=this.transform;let m=!1,y=!1,w=!1;return"zoom"in t&&u.zoom!==+t.zoom&&(m=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=s.LngLat.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(y=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(w=!0,u.pitch=+t.pitch),t.padding==null||u.isPaddingEqual(t.padding)||(u.padding=t.padding),this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),m&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),y&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),w&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a))}calculateCameraOptionsFromTo(t,a,u,m=0){const y=s.MercatorCoordinate.fromLngLat(t,a),w=s.MercatorCoordinate.fromLngLat(u,m),E=w.x-y.x,C=w.y-y.y,M=w.z-y.z,B=Math.hypot(E,C,M);if(B===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(E,C),G=this.transform.scaleZoom(this.transform.cameraToCenterDistance/B/this.transform.tileSize),$=180*Math.atan2(E,-C)/Math.PI;let Y=180*Math.acos(U/B)/Math.PI;return Y=M<0?90-Y:90+Y,{center:w.toLngLat(),zoom:G,pitch:Y,bearing:$}}easeTo(t,a){this._stop(!1,t.easeId),((t=s.extend({offset:[0,0],duration:500,easing:s.ease},t)).animate===!1||!t.essential&&s.exported.prefersReducedMotion)&&(t.duration=0);const u=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),E=this.getPadding(),C="zoom"in t?+t.zoom:m,M="bearing"in t?this._normalizeBearing(t.bearing,y):y,B="pitch"in t?+t.pitch:w,U="padding"in t?t.padding:u.padding,G=s.pointGeometry.convert(t.offset);let $=u.centerPoint.add(G);const Y=u.pointLocation($),Q=s.LngLat.convert(t.center||Y);this._normalizeCenter(Q);const le=u.project(Y),de=u.project(Q).sub(le),_e=u.zoomScale(C-m);let ee,we;t.around&&(ee=s.LngLat.convert(t.around),we=u.locationPoint(ee));const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||C!==m,this._rotating=this._rotating||y!==M,this._pitching=this._pitching||B!==w,this._padding=!u.isPaddingEqual(U),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ye),this._ease(Me=>{if(this._zooming&&(u.zoom=s.number(m,C,Me)),this._rotating&&(u.bearing=s.number(y,M,Me)),this._pitching&&(u.pitch=s.number(w,B,Me)),this._padding&&(u.interpolatePadding(E,U,Me),$=u.centerPoint.add(G)),ee)u.setLocationAtPoint(ee,we);else{const Pe=u.zoomScale(u.zoom-m),je=C>m?Math.min(2,_e):Math.max(.5,_e),Ae=Math.pow(je,1-Me),nt=u.unproject(le.add(de.mult(Me*Ae)).mult(Pe));u.setLocationAtPoint(u.renderWorldCopies?nt.wrap():nt,$)}this._fireMoveEvents(a)},Me=>{this._afterEase(a,Me)},t),this}_prepareEase(t,a,u={}){this._moving=!0,this.fire(new s.Event("freezeElevation",{freeze:!0})),a||u.moving||this.fire(new s.Event("movestart",t)),this._zooming&&!u.zooming&&this.fire(new s.Event("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new s.Event("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new s.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.Event("move",t)),this._zooming&&this.fire(new s.Event("zoom",t)),this._rotating&&this.fire(new s.Event("rotate",t)),this._pitching&&this.fire(new s.Event("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId,this.fire(new s.Event("freezeElevation",{freeze:!1}));const u=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new s.Event("zoomend",t)),m&&this.fire(new s.Event("rotateend",t)),y&&this.fire(new s.Event("pitchend",t)),this.fire(new s.Event("moveend",t))}flyTo(t,a){if(!t.essential&&s.exported.prefersReducedMotion){const yt=s.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(yt,a)}this.stop(),t=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},t);const u=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),E=this.getPadding(),C="zoom"in t?s.clamp(+t.zoom,u.minZoom,u.maxZoom):m,M="bearing"in t?this._normalizeBearing(t.bearing,y):y,B="pitch"in t?+t.pitch:w,U="padding"in t?t.padding:u.padding,G=u.zoomScale(C-m),$=s.pointGeometry.convert(t.offset);let Y=u.centerPoint.add($);const Q=u.pointLocation(Y),le=s.LngLat.convert(t.center||Q);this._normalizeCenter(le);const de=u.project(Q),_e=u.project(le).sub(de);let ee=t.curve;const we=Math.max(u.width,u.height),ye=we/G,Me=_e.mag();if("minZoom"in t){const yt=s.clamp(Math.min(t.minZoom,m,C),u.minZoom,u.maxZoom),$t=we/u.zoomScale(yt-m);ee=Math.sqrt($t/Me*2)}const Pe=ee*ee;function je(yt){const $t=(ye*ye-we*we+(yt?-1:1)*Pe*Pe*Me*Me)/(2*(yt?ye:we)*Pe*Me);return Math.log(Math.sqrt($t*$t+1)-$t)}function Ae(yt){return(Math.exp(yt)-Math.exp(-yt))/2}function nt(yt){return(Math.exp(yt)+Math.exp(-yt))/2}const Je=je(0);let ot=function(yt){return nt(Je)/nt(Je+ee*yt)},Dt=function(yt){return we*((nt(Je)*(Ae($t=Je+ee*yt)/nt($t))-Ae(Je))/Pe)/Me;var $t},Ot=(je(1)-Je)/ee;if(Math.abs(Me)<1e-6||!isFinite(Ot)){if(Math.abs(we-ye)<1e-6)return this.easeTo(t,a);const yt=ye<we?-1:1;Ot=Math.abs(Math.log(ye/we))/ee,Dt=function(){return 0},ot=function($t){return Math.exp(yt*ee*$t)}}return t.duration="duration"in t?+t.duration:1e3*Ot/("screenSpeed"in t?+t.screenSpeed/ee:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=y!==M,this._pitching=B!==w,this._padding=!u.isPaddingEqual(U),this._prepareEase(a,!1),this._ease(yt=>{const $t=yt*Ot,ei=1/ot($t);u.zoom=yt===1?C:m+u.scaleZoom(ei),this._rotating&&(u.bearing=s.number(y,M,yt)),this._pitching&&(u.pitch=s.number(w,B,yt)),this._padding&&(u.interpolatePadding(E,U,yt),Y=u.centerPoint.add($));const qt=yt===1?le:u.unproject(de.add(_e.mult(Dt($t))).mult(ei));u.setLocationAtPoint(u.renderWorldCopies?qt.wrap():qt,Y),this._fireMoveEvents(a)},()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,a)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,a,u){u.animate===!1||u.duration===0?(t(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=s.wrap(t,-180,180);const u=Math.abs(t-a);return Math.abs(t-360-a)<u&&(t-=360),Math.abs(t+360-a)<u&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const u=t.lng-a.center.lng;t.lng+=u>180?-360:u<-180?360:0}}class Ys{constructor(t={}){this.options=t,s.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const u=this._map._getUIString(`AttributionControl.${a}`);t.title=u,t.setAttribute("aria-label",u)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const a=this._map.style.sourceCaches;for(const m in a){const y=a[m];if(y.used||y.usedForTerrain){const w=y.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,y)=>m.length-y.length),t=t.filter((m,y)=>{for(let w=y+1;w<t.length;w++)if(t[w].indexOf(m)>=0)return!1;return!0});const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ka{constructor(t={}){this.options=t,s.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=z.create("div","maplibregl-ctrl mapboxgl-ctrl");const a=z.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact","mapboxgl-compact"):a.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Sl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const m of u)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Il={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Cl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Ac={showCompass:!0,showZoom:!0,visualizePitch:!1};class $r{constructor(t,a,u=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new hn({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new ct({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),z.addEventListener(a,"mousedown",this.mousedown),z.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(a,"touchmove",this.touchmove),z.addEventListener(a,"touchend",this.touchend),z.addEventListener(a,"touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),z.disableDrag()}move(t,a){const u=this.map,m=this.mouseRotate.mousemoveWindow(t,a);if(m&&m.bearingDelta&&u.setBearing(u.getBearing()+m.bearingDelta),this.mousePitch){const y=this.mousePitch.mousemoveWindow(t,a);y&&y.pitchDelta&&u.setPitch(u.getPitch()+y.pitchDelta)}}off(){const t=this.element;z.removeEventListener(t,"mousedown",this.mousedown),z.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(t,"touchmove",this.touchmove),z.removeEventListener(t,"touchend",this.touchend),z.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){z.enableDrag(),z.removeEventListener(window,"mousemove",this.mousemove),z.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(s.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),z.mousePos(this.element,t)),z.addEventListener(window,"mousemove",this.mousemove),z.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,z.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Qs(f,t,a){if(f=new s.LngLat(f.lng,f.lat),t){const u=new s.LngLat(f.lng-360,f.lat),m=new s.LngLat(f.lng+360,f.lat),y=a.locationPoint(f).distSqr(t);a.locationPoint(u).distSqr(t)<y?f=u:a.locationPoint(m).distSqr(t)<y&&(f=m)}for(;Math.abs(f.lng-a.center.lng)>180;){const u=a.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=a.width&&u.y<=a.height)break;f.lng>a.center.lng?f.lng-=360:f.lng+=360}return f}const pt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tt(f,t,a){const u=f.classList;for(const m in pt)u.remove(`maplibregl-${a}-anchor-${m}`,`mapboxgl-${a}-anchor-${m}`);u.add(`maplibregl-${a}-anchor-${t}`,`mapboxgl-${a}-anchor-${t}`)}class gs extends s.Evented{constructor(t,a){if(super(),(t instanceof HTMLElement||a)&&(t=s.extend({element:t},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=s.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div"),this._element.setAttribute("aria-label","Map marker");const u=z.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${m}px`),u.setAttributeNS(null,"width",`${y}px`),u.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const w=z.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const E=z.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const C=z.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const _e of M){const ee=z.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",_e.rx),ee.setAttributeNS(null,"ry",_e.ry),C.appendChild(ee)}const B=z.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const U=z.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(U);const G=z.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"fill","#000000");const $=z.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),G.appendChild($);const Y=z.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const Q=z.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=z.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const de=z.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#FFFFFF"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962"),Q.appendChild(le),Q.appendChild(de),E.appendChild(C),E.appendChild(B),E.appendChild(G),E.appendChild(Y),E.appendChild(Q),u.appendChild(E),u.setAttributeNS(null,"height",m*this._scale+"px"),u.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(u),this._offset=s.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),Tt(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const a=t.code,u=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,u=this._element;this._popup&&(a===u||u.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Qs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let a="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?a=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(a=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let u="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?u="rotateX(0deg)":this._pitchAlignment==="map"&&(u=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,`${pt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${u} ${a}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),y=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*y?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=s.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const _o={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let In,Yi=0,Cn=!1;const en={maxWidth:100,unit:"metric"};function Al(f,t,a){const u=a&&a.maxWidth||100,m=f._container.clientHeight/2,y=f.unproject([0,m]),w=f.unproject([u,m]),E=y.distanceTo(w);if(a&&a.unit==="imperial"){const C=3.2808*E;C>5280?An(t,u,C/5280,f._getUIString("ScaleControl.Miles")):An(t,u,C,f._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?An(t,u,E/1852,f._getUIString("ScaleControl.NauticalMiles")):E>=1e3?An(t,u,E/1e3,f._getUIString("ScaleControl.Kilometers")):An(t,u,E,f._getUIString("ScaleControl.Meters"))}function An(f,t,a,u){const m=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let E=y/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(C){const M=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*M)/M}(E),w*E}(a);f.style.width=t*(m/a)+"px",f.innerHTML=`${m}&nbsp;${u}`}const Ii={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Di=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yo(f){if(f){if(typeof f=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(f,2)));return{center:new s.pointGeometry(0,0),top:new s.pointGeometry(0,f),"top-left":new s.pointGeometry(t,t),"top-right":new s.pointGeometry(-t,t),bottom:new s.pointGeometry(0,-f),"bottom-left":new s.pointGeometry(t,-t),"bottom-right":new s.pointGeometry(-t,-t),left:new s.pointGeometry(f,0),right:new s.pointGeometry(-f,0)}}if(f instanceof s.pointGeometry||Array.isArray(f)){const t=s.pointGeometry.convert(f);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.pointGeometry.convert(f.center||[0,0]),top:s.pointGeometry.convert(f.top||[0,0]),"top-left":s.pointGeometry.convert(f["top-left"]||[0,0]),"top-right":s.pointGeometry.convert(f["top-right"]||[0,0]),bottom:s.pointGeometry.convert(f.bottom||[0,0]),"bottom-left":s.pointGeometry.convert(f["bottom-left"]||[0,0]),"bottom-right":s.pointGeometry.convert(f["bottom-right"]||[0,0]),left:s.pointGeometry.convert(f.left||[0,0]),right:s.pointGeometry.convert(f.right||[0,0])}}return yo(new s.pointGeometry(0,0))}const Nn={supported:b,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends wi{constructor(f){var t;if(s.PerformanceUtils.mark(s.PerformanceMarkers.create),(f=s.extend({},Cl,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Gs(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new Sl,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Il,f.locale),this._clickTolerance=f.clickTolerance,this._pixelRatio=(t=f.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new V(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new El(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new pl(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,s.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new Ys({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new ka,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.Event(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new s.Event("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=f.onAdd(this);this._controls.push(f);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,t,a,u){return u==null&&this.style.terrain&&(u=this.transform.getElevation(a,this.style.terrain)),super.calculateCameraOptionsFromTo(f,t,a,u)}resize(f){const t=this._containerDimensions(),a=t[0],u=t[1];this._resizeCanvas(a,u,this.getPixelRatio()),this.transform.resize(a,u),this.painter.resize(a,u,this.getPixelRatio());const m=!this._moving;return m&&(this.stop(),this.fire(new s.Event("movestart",f)).fire(new s.Event("move",f))),this.fire(new s.Event("resize",f)),m&&this.fire(new s.Event("moveend",f)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(f){const[t,a]=this._containerDimensions();this._pixelRatio=f,this._resizeCanvas(t,a,f),this.painter.resize(t,a,f)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(s.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(s.LngLat.convert(f),this.style&&this.style.terrain)}unproject(f){return this.transform.pointLocation(s.pointGeometry.convert(f),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(f,t,a){if(f==="mouseenter"||f==="mouseover"){let u=!1;return{layer:t,listener:a,delegates:{mousemove:y=>{const w=this.getLayer(t)?this.queryRenderedFeatures(y.point,{layers:[t]}):[];w.length?u||(u=!0,a.call(this,new Cr(f,this,y.originalEvent,{features:w}))):u=!1},mouseout:()=>{u=!1}}}}if(f==="mouseleave"||f==="mouseout"){let u=!1;return{layer:t,listener:a,delegates:{mousemove:w=>{(this.getLayer(t)?this.queryRenderedFeatures(w.point,{layers:[t]}):[]).length?u=!0:u&&(u=!1,a.call(this,new Cr(f,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,a.call(this,new Cr(f,this,w.originalEvent)))}}}}{const u=m=>{const y=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];y.length&&(m.features=y,a.call(this,m),delete m.features)};return{layer:t,listener:a,delegates:{[f]:u}}}}on(f,t,a){if(a===void 0)return super.on(f,t);const u=this._createDelegatedListener(f,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(u);for(const m in u.delegates)this.on(m,u.delegates[m]);return this}once(f,t,a){if(a===void 0)return super.once(f,t);const u=this._createDelegatedListener(f,t,a);for(const m in u.delegates)this.once(m,u.delegates[m]);return this}off(f,t,a){return a===void 0?super.off(f,t):(this._delegatedListeners&&this._delegatedListeners[f]&&(u=>{const m=this._delegatedListeners[f];for(let y=0;y<m.length;y++){const w=m[y];if(w.layer===t&&w.listener===a){for(const E in w.delegates)this.off(E,w.delegates[E]);return m.splice(y,1),this}}})(),this)}queryRenderedFeatures(f,t){if(!this.style)return[];let a;if(t!==void 0||f===void 0||f instanceof s.pointGeometry||Array.isArray(f)||(t=f,f=void 0),t=t||{},(f=f||[[0,0],[this.transform.width,this.transform.height]])instanceof s.pointGeometry||typeof f[0]=="number")a=[s.pointGeometry.convert(f)];else{const u=s.pointGeometry.convert(f[0]),m=s.pointGeometry.convert(f[1]);a=[u,new s.pointGeometry(m.x,u.y),m,new s.pointGeometry(u.x,m.y),u]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(f,t){return this.style.querySourceFeatures(f,t)}setStyle(f,t){return(t=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(f,t))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),f?(this.style=new tr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new tr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,t){if(typeof f=="string"){const a=this._requestManager.transformRequest(f,s.ResourceType.Style);s.getJSON(a,(u,m)=>{u?this.fire(new s.ErrorEvent(u)):m&&this._updateDiff(m,t)})}else typeof f=="object"&&this._updateDiff(f,t)}_updateDiff(f,t){try{this.style.setState(f)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(f,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")}addSource(f,t){return this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)}isSourceLoaded(f){const t=this.style&&this.style.sourceCaches[f];if(t!==void 0)return t.loaded();this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){return this.style.setTerrain(f),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const t in f){const a=f[t]._tiles;for(const u in a){const m=a[u];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(f,t,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,a)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,t,{pixelRatio:a=1,sdf:u=!1,stretchX:m,stretchY:y,content:w}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||s.isImageBitmap(t)){const{width:E,height:C,data:M}=s.exported.getImageData(t);this.style.addImage(f,{data:new s.RGBAImage({width:E,height:C},M),pixelRatio:a,stretchX:m,stretchY:y,content:w,sdf:u,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:C,data:M}=t,B=t;this.style.addImage(f,{data:new s.RGBAImage({width:E,height:C},new Uint8Array(M)),pixelRatio:a,stretchX:m,stretchY:y,content:w,sdf:u,version:0,userImage:B}),B.onAdd&&B.onAdd(this,f)}}}updateImage(f,t){const a=this.style.getImage(f);if(!a)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||s.isImageBitmap(t)?s.exported.getImageData(t):t,{width:m,height:y,data:w}=u;if(m===void 0||y===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==a.data.width||y!==a.data.height)return this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||s.isImageBitmap(t));a.data.replace(w,E),this.style.updateImage(f,a)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,t){s.getImage(this._requestManager.transformRequest(f,s.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(f,t){return this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)}moveLayer(f,t){return this.style.moveLayer(f,t),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,t,a){return this.style.setLayerZoomRange(f,t,a),this._update(!0)}setFilter(f,t,a={}){return this.style.setFilter(f,t,a),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,t,a,u={}){return this.style.setPaintProperty(f,t,a,u),this._update(!0)}getPaintProperty(f,t){return this.style.getPaintProperty(f,t)}setLayoutProperty(f,t,a,u={}){return this.style.setLayoutProperty(f,t,a,u),this._update(!0)}getLayoutProperty(f,t){return this.style.getLayoutProperty(f,t)}setLight(f,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,t){return this.style.setFeatureState(f,t),this._update()}removeFeatureState(f,t){return this.style.removeFeatureState(f,t),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,t=0;return this._container&&(f=this._container.clientWidth||400,t=this._container.clientHeight||300),[f,t]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=z.create("div","maplibregl-canvas-container mapboxgl-canvas-container",f);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=z.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions();this._resizeCanvas(a[0],a[1],this.getPixelRatio());const u=this._controlContainer=z.create("div","maplibregl-control-container mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=z.create("div",`maplibregl-ctrl-${y} mapboxgl-ctrl-${y}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const f=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=z.create("div","maplibregl-cooperative-gesture-screen",f);let t="Control",a=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(a=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${a}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",u=>{u.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",u=>{u.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",u=>{this._onCooperativeGesture(u,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(f,t,a){this._canvas.width=a*f,this._canvas.height=a*t,this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const f=s.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);t?(this.painter=new ao(t,this.transform),s.exported$1.testSupport(t)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(f,t,a){return!t&&a<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){let t,a=0;const u=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,t),a=s.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let m=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,E=s.exported.now();this.style.zoomHistory.update(w,E);const C=new s.EvaluationParameters(w,{now:E,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=C.crossFadingFactor();M===1&&M===this._crossFadingFactor||(m=!0,this._crossFadingFactor=M),this.style.update(C)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.PerformanceUtils.mark(s.PerformanceMarkers.load),this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const w=s.exported.now()-a;u.endQueryEXT(u.TIME_ELAPSED_EXT,t),setTimeout(()=>{const E=u.getQueryObjectEXT(t,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(t),this.fire(new s.Event("gpu-timing-frame",{cpuTime:w,gpuTime:E}))},50)}if(this.listens("gpu-timing-layer")){const w=this.painter.collectGpuTimers();setTimeout(()=>{const E=this.painter.queryGpuTimers(w);this.fire(new s.Event("gpu-timing-layer",{layerTimes:E}))},50)}const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,s.PerformanceUtils.mark(s.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),z.remove(this._canvasContainer),z.remove(this._controlContainer),this._cooperativeGestures&&z.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),s.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.exported.frame(f=>{s.PerformanceUtils.frame(f),this._frame=null,this._render(f)}))}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,t){s.setCacheLimits(f,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(f){this.options=s.extend({},Ac,f),this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map.getZoom(),t=f===this._map.getMaxZoom(),a=f===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=f}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $r(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,t){const a=z.create("button",f,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(f,t){const a=this._map._getUIString(`NavigationControl.${t}`);f.title=a,f.setAttribute("aria-label",a)}},GeolocateControl:class extends s.Evented{constructor(f){super(),this.options=s.extend({},_o,f),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(f){var t;return this._map=f,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,In!==void 0?t(In):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(a=>{In=a.state!=="denied",t(In)}):(In=!!window.navigator.geolocation,t(In)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Yi=0,Cn=!1}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),a=f.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",f)),this._finish()}}_updateCamera(f){const t=new s.LngLat(f.coords.longitude,f.coords.latitude),a=f.coords.accuracy,u=this._map.getBearing(),m=s.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),m,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new s.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._container.clientHeight/2,t=this._map.unproject([0,f]),a=this._map.unproject([1,f]),u=t.distanceTo(a),m=Math.ceil(2*this._accuracy/u);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Cn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=z.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new gs(this._dotElement),this._circleElement=z.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Yi--,Cn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Yi++,Yi>1?(f={maximumAge:6e5,timeout:0},Cn=!0):(f=this.options.positionOptions,Cn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ys,LogoControl:ka,ScaleControl:class{constructor(f){this.options=s.extend({},en,f),s.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Al(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,Al(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=z.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(f){this.options=f,s.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(f){return this._map=f,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=z.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends s.Evented{constructor(f){super(),this.options=s.extend(Object.create(Ii),f),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=s.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=f;u=a.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_update(f){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=z.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=z.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(y=>this._container.classList.add(y)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qs(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!f))return;const t=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat);let a=this.options.anchor;const u=yo(this.options.offset);if(!a){const y=this._container.offsetWidth,w=this._container.offsetHeight;let E;E=t.y+u.bottom.y<w?["top"]:t.y>this._map.transform.height-w?["bottom"]:[],t.x<y/2?E.push("left"):t.x>this._map.transform.width-y/2&&E.push("right"),a=E.length===0?"bottom":E.join("-")}const m=t.add(u[a]).round();z.setTransform(this._container,`${pt[a]} translate(${m.x}px,${m.y}px)`),Tt(this._container,a,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Di);f&&f.focus()}_onClose(){this.remove()}},Marker:gs,Style:tr,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,AJAXError:s.AJAXError,config:s.config,CanvasSource:Mi,GeoJSONSource:mr,ImageSource:Lt,RasterDEMTileSource:xt,RasterTileSource:er,VectorTileSource:ni,VideoSource:Ri,prewarm:function(){$n().acquire(Rr)},clearPrewarmedResources:function(){const f=vn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Rr),vn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return kr.workerCount},set workerCount(f){kr.workerCount=f},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.clearTileCache(f)},workerUrl:"",addProtocol(f,t){s.config.REGISTERED_PROTOCOLS[f]=t},removeProtocol(f){delete s.config.REGISTERED_PROTOCOLS[f]}};return Or.extend(Nn,{isSafari:s.isSafari,getPerformanceMetrics:s.PerformanceUtils.getPerformanceMetrics}),Nn});var x=h;return x})})(gp);var U_=gp.exports;const Oo=pp(U_);var Br=(d,n,c)=>new Promise((l,h)=>{var _=b=>{try{s(c.next(b))}catch(S){h(S)}},x=b=>{try{s(c.throw(b))}catch(S){h(S)}},s=b=>b.done?l(b.value):Promise.resolve(b.value).then(_,x);s((c=c.apply(d,n)).next())}),Jr=Uint8Array,Oa=Uint16Array,N_=Int32Array,yp=new Jr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vp=new Jr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),j_=new Jr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xp=function(d,n){for(var c=new Oa(31),l=0;l<31;++l)c[l]=n+=1<<d[l-1];for(var h=new N_(c[30]),l=1;l<30;++l)for(var _=c[l];_<c[l+1];++_)h[_]=_-c[l]<<5|l;return{b:c,r:h}},bp=xp(yp,2),wp=bp.b,G_=bp.r;wp[28]=258,G_[258]=28;var q_=xp(vp,0),Z_=q_.b,yu=new Oa(32768);for(li=0;li<32768;++li)Yn=(li&43690)>>1|(li&21845)<<1,Yn=(Yn&52428)>>2|(Yn&13107)<<2,Yn=(Yn&61680)>>4|(Yn&3855)<<4,yu[li]=((Yn&65280)>>8|(Yn&255)<<8)>>1;var Yn,li,jo=function(d,n,c){for(var l=d.length,h=0,_=new Oa(n);h<l;++h)d[h]&&++_[d[h]-1];var x=new Oa(n);for(h=1;h<n;++h)x[h]=x[h-1]+_[h-1]<<1;var s;if(c){s=new Oa(1<<n);var b=15-n;for(h=0;h<l;++h)if(d[h])for(var S=h<<4|d[h],I=n-d[h],P=x[d[h]-1]++<<I,z=P|(1<<I)-1;P<=z;++P)s[yu[P]>>b]=S}else for(s=new Oa(l),h=0;h<l;++h)d[h]&&(s[h]=yu[x[d[h]-1]++]>>15-d[h]);return s},Zo=new Jr(288);for(li=0;li<144;++li)Zo[li]=8;var li;for(li=144;li<256;++li)Zo[li]=9;var li;for(li=256;li<280;++li)Zo[li]=7;var li;for(li=280;li<288;++li)Zo[li]=8;var li,Tp=new Jr(32);for(li=0;li<32;++li)Tp[li]=5;var li,X_=jo(Zo,9,1),H_=jo(Tp,5,1),mu=function(d){for(var n=d[0],c=1;c<d.length;++c)d[c]>n&&(n=d[c]);return n},_n=function(d,n,c){var l=n/8|0;return(d[l]|d[l+1]<<8)>>(n&7)&c},gu=function(d,n){var c=n/8|0;return(d[c]|d[c+1]<<8|d[c+2]<<16)>>(n&7)},W_=function(d){return(d+7)/8|0},K_=function(d,n,c){(n==null||n<0)&&(n=0),(c==null||c>d.length)&&(c=d.length);var l=new Jr(c-n);return l.set(d.subarray(n,c)),l},J_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Kr=function(d,n,c){var l=new Error(n||J_[d]);if(l.code=d,Error.captureStackTrace&&Error.captureStackTrace(l,Kr),!c)throw l;return l},Mu=function(d,n,c,l){var h=d.length,_=l?l.length:0;if(!h||n.f&&!n.l)return c||new Jr(0);var x=!c||n.i!=2,s=n.i;c||(c=new Jr(h*3));var b=function(hi){var Ni=c.length;if(hi>Ni){var Rr=new Jr(Math.max(Ni*2,hi));Rr.set(c),c=Rr}},S=n.f||0,I=n.p||0,P=n.b||0,z=n.l,V=n.d,N=n.m,R=n.n,K=h*8;do{if(!z){S=_n(d,I,1);var ce=_n(d,I+1,3);if(I+=3,ce)if(ce==1)z=X_,V=H_,N=9,R=5;else if(ce==2){var ke=_n(d,I,31)+257,Ve=_n(d,I+10,15)+4,ze=ke+_n(d,I+5,31)+1;I+=14;for(var Ne=new Jr(ze),Ct=new Jr(19),dt=0;dt<Ve;++dt)Ct[j_[dt]]=_n(d,I+dt*3,7);I+=Ve*3;for(var yi=mu(Ct),gt=(1<<yi)-1,ni=jo(Ct,yi,1),dt=0;dt<ze;){var er=ni[_n(d,I,gt)];I+=er&15;var ae=er>>4;if(ae<16)Ne[dt++]=ae;else{var ti=0,xt=0;for(ae==16?(xt=3+_n(d,I,3),I+=2,ti=Ne[dt-1]):ae==17?(xt=3+_n(d,I,7),I+=3):ae==18&&(xt=11+_n(d,I,127),I+=7);xt--;)Ne[dt++]=ti}}var mr=Ne.subarray(0,ke),Si=Ne.subarray(ke);N=mu(mr),R=mu(Si),z=jo(mr,N,1),V=jo(Si,R,1)}else Kr(1);else{var ae=W_(I)+4,Be=d[ae-4]|d[ae-3]<<8,Oe=ae+Be;if(Oe>h){s&&Kr(0);break}x&&b(P+Be),c.set(d.subarray(ae,Oe),P),n.b=P+=Be,n.p=I=Oe*8,n.f=S;continue}if(I>K){s&&Kr(0);break}}x&&b(P+131072);for(var Lt=(1<<N)-1,Ri=(1<<R)-1,Mi=I;;Mi=I){var ti=z[gu(d,I)&Lt],Ai=ti>>4;if(I+=ti&15,I>K){s&&Kr(0);break}if(ti||Kr(2),Ai<256)c[P++]=Ai;else if(Ai==256){Mi=I,z=null;break}else{var ur=Ai-254;if(Ai>264){var dt=Ai-257,Ui=yp[dt];ur=_n(d,I,(1<<Ui)-1)+wp[dt],I+=Ui}var Ki=V[gu(d,I)&Ri],gr=Ki>>4;Ki||Kr(3),I+=Ki&15;var Si=Z_[gr];if(gr>3){var Ui=vp[gr];Si+=gu(d,I)&(1<<Ui)-1,I+=Ui}if(I>K){s&&Kr(0);break}x&&b(P+131072);var _r=P+ur;if(P<Si){var Tr=_-Si,He=Math.min(Si,_r);for(Tr+P<0&&Kr(3);P<He;++P)c[P]=l[Tr+P]}for(;P<_r;P+=4)c[P]=c[P-Si],c[P+1]=c[P+1-Si],c[P+2]=c[P+2-Si],c[P+3]=c[P+3-Si];P=_r}}n.l=z,n.p=Mi,n.b=P,n.f=S,z&&(S=1,n.m=N,n.d=V,n.n=R)}while(!S);return P==c.length?c:K_(c,0,P)},Y_=new Jr(0),Q_=function(d){(d[0]!=31||d[1]!=139||d[2]!=8)&&Kr(6,"invalid gzip data");var n=d[3],c=10;n&4&&(c+=(d[10]|d[11]<<8)+2);for(var l=(n>>3&1)+(n>>4&1);l>0;l-=!d[c++]);return c+(n&2)},$_=function(d){var n=d.length;return(d[n-4]|d[n-3]<<8|d[n-2]<<16|d[n-1]<<24)>>>0},ey=function(d,n){return((d[0]&15)!=8||d[0]>>4>7||(d[0]<<8|d[1])%31)&&Kr(6,"invalid zlib data"),(d[1]>>5&1)==+!n&&Kr(6,"invalid zlib data: "+(d[1]&32?"need":"unexpected")+" dictionary"),(d[1]>>3&4)+2};function ty(d,n){return Mu(d,{i:2},n&&n.out,n&&n.dictionary)}function iy(d,n){var c=Q_(d);return c+8>d.length&&Kr(6,"invalid gzip data"),Mu(d.subarray(c,-8),{i:2},n&&n.out||new Jr($_(d)),n&&n.dictionary)}function ry(d,n){return Mu(d.subarray(ey(d,n&&n.dictionary),-4),{i:2},n&&n.out,n&&n.dictionary)}function vu(d,n){return d[0]==31&&d[1]==139&&d[2]==8?iy(d,n):(d[0]&15)!=8||d[0]>>4>7||(d[0]<<8|d[1])%31?ty(d,n):ry(d,n)}var ny=typeof TextDecoder<"u"&&new TextDecoder,sy=0;try{ny.decode(Y_,{stream:!0}),sy=1}catch{}var kp=(d,n)=>d*Math.pow(2,n),Vo=(d,n)=>Math.floor(d/Math.pow(2,n)),nc=(d,n)=>kp(d.getUint16(n+1,!0),8)+d.getUint8(n),Ep=(d,n)=>kp(d.getUint32(n+2,!0),16)+d.getUint16(n,!0),ay=(d,n,c,l,h)=>{if(d!=l.getUint8(h))return d-l.getUint8(h);const _=nc(l,h+1);if(n!=_)return n-_;const x=nc(l,h+4);return c!=x?c-x:0},oy=(d,n,c,l)=>{const h=Sp(d,n|128,c,l);return h?{z:n,x:c,y:l,offset:h[0],length:h[1],is_dir:!0}:null},Ff=(d,n,c,l)=>{const h=Sp(d,n,c,l);return h?{z:n,x:c,y:l,offset:h[0],length:h[1],is_dir:!1}:null},Sp=(d,n,c,l)=>{let h=0,_=d.byteLength/17-1;for(;h<=_;){const x=_+h>>1,s=ay(n,c,l,d,x*17);if(s>0)h=x+1;else if(s<0)_=x-1;else return[Ep(d,x*17+7),d.getUint32(x*17+13,!0)]}return null},ly=(d,n)=>d.is_dir&&!n.is_dir?1:!d.is_dir&&n.is_dir?-1:d.z!==n.z?d.z-n.z:d.x!==n.x?d.x-n.x:d.y-n.y,Ip=(d,n)=>{const c=d.getUint8(n*17);return{z:c&127,x:nc(d,n*17+1),y:nc(d,n*17+4),offset:Ep(d,n*17+7),length:d.getUint32(n*17+13,!0),is_dir:c>>7===1}},Of=d=>{const n=[],c=new DataView(d);for(let l=0;l<c.byteLength/17;l++)n.push(Ip(c,l));return cy(n)},cy=d=>{d.sort(ly);const n=new ArrayBuffer(17*d.length),c=new Uint8Array(n);for(let l=0;l<d.length;l++){const h=d[l];let _=h.z;h.is_dir&&(_=_|128),c[l*17]=_,c[l*17+1]=h.x&255,c[l*17+2]=h.x>>8&255,c[l*17+3]=h.x>>16&255,c[l*17+4]=h.y&255,c[l*17+5]=h.y>>8&255,c[l*17+6]=h.y>>16&255,c[l*17+7]=h.offset&255,c[l*17+8]=Vo(h.offset,8)&255,c[l*17+9]=Vo(h.offset,16)&255,c[l*17+10]=Vo(h.offset,24)&255,c[l*17+11]=Vo(h.offset,32)&255,c[l*17+12]=Vo(h.offset,48)&255,c[l*17+13]=h.length&255,c[l*17+14]=h.length>>8&255,c[l*17+15]=h.length>>16&255,c[l*17+16]=h.length>>24&255}return n},uy=(d,n)=>{if(d.byteLength<17)return null;const c=d.byteLength/17,l=Ip(d,c-1);if(l.is_dir){const h=l.z,_=n.z-h,x=Math.trunc(n.x/(1<<_)),s=Math.trunc(n.y/(1<<_));return{z:h,x,y:s}}return null};function hy(d){return Br(this,null,function*(){const n=yield d.getBytes(0,512e3),c=new DataView(n.data),l=c.getUint32(4,!0),h=c.getUint16(8,!0),_=new TextDecoder("utf-8"),x=JSON.parse(_.decode(new DataView(n.data,10,l)));let s=0;x.compression==="gzip"&&(s=2);let b=0;"minzoom"in x&&(b=+x.minzoom);let S=0;"maxzoom"in x&&(S=+x.maxzoom);let I=0,P=0,z=0,V=-180,N=-85,R=180,K=85;if(x.bounds){const ae=x.bounds.split(",");V=+ae[0],N=+ae[1],R=+ae[2],K=+ae[3]}if(x.center){const ae=x.center.split(",");I=+ae[0],P=+ae[1],z=+ae[2]}return{specVersion:c.getUint16(2,!0),rootDirectoryOffset:10+l,rootDirectoryLength:h*17,jsonMetadataOffset:10,jsonMetadataLength:l,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:b,maxZoom:S,minLon:V,minLat:N,maxLon:R,maxLat:K,centerZoom:z,centerLon:I,centerLat:P,etag:n.etag}})}function fy(d,n,c,l,h,_,x){return Br(this,null,function*(){let s=yield c.getArrayBuffer(n,d.rootDirectoryOffset,d.rootDirectoryLength,d);d.specVersion===1&&(s=Of(s));const b=Ff(new DataView(s),l,h,_);if(b){let P=(yield n.getBytes(b.offset,b.length,x)).data;const z=new DataView(P);return z.getUint8(0)==31&&z.getUint8(1)==139&&(P=vu(new Uint8Array(P))),{data:P}}const S=uy(new DataView(s),{z:l,x:h,y:_});if(S){const I=oy(new DataView(s),S.z,S.x,S.y);if(I){let P=yield c.getArrayBuffer(n,I.offset,I.length,d);d.specVersion===1&&(P=Of(P));const z=Ff(new DataView(P),l,h,_);if(z){let N=(yield n.getBytes(z.offset,z.length,x)).data;const R=new DataView(N);return R.getUint8(0)==31&&R.getUint8(1)==139&&(N=vu(new Uint8Array(N))),{data:N}}}}})}var Cp={getHeader:hy,getZxy:fy},dy=class{constructor(){this.tile=(d,n)=>{if(d.type=="json"){const c=d.url.substr(10);let l=this.tiles.get(c);return l||(l=new Vf(c),this.tiles.set(c,l)),l.getHeader().then(h=>{const _={tiles:[d.url+"/{z}/{x}/{y}"],minzoom:h.minZoom,maxzoom:h.maxZoom,bounds:[h.minLon,h.minLat,h.maxLon,h.maxLat]};n(null,_,null,null)}).catch(h=>{n(h,null,null,null)}),{cancel:()=>{}}}else{const c=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),l=d.url.match(c);if(!l)throw new Error("Invalid PMTiles protocol URL");const h=l[1];let _=this.tiles.get(h);_||(_=new Vf(h),this.tiles.set(h,_));const x=l[2],s=l[3],b=l[4],S=new AbortController,I=S.signal;let P=()=>{S.abort()};return _.getHeader().then(z=>{_.getZxy(+x,+s,+b,I).then(V=>{V?n(null,new Uint8Array(V.data),V.cacheControl,V.expires):z.tileType==1?n(null,new Uint8Array,null,null):n(null,null,null,null)}).catch(V=>{V.name!=="AbortError"&&n(V,null,null,null)})}),{cancel:P}}},this.tiles=new Map}add(d){this.tiles.set(d.source.getKey(),d)}get(d){return this.tiles.get(d)}};function Ra(d,n){return(n>>>0)*4294967296+(d>>>0)}function py(d,n){const c=n.buf;let l,h;if(h=c[n.pos++],l=(h&112)>>4,h<128||(h=c[n.pos++],l|=(h&127)<<3,h<128)||(h=c[n.pos++],l|=(h&127)<<10,h<128)||(h=c[n.pos++],l|=(h&127)<<17,h<128)||(h=c[n.pos++],l|=(h&127)<<24,h<128)||(h=c[n.pos++],l|=(h&1)<<31,h<128))return Ra(d,l);throw new Error("Expected varint not more than 10 bytes")}function Uo(d){const n=d.buf;let c,l;return l=n[d.pos++],c=l&127,l<128||(l=n[d.pos++],c|=(l&127)<<7,l<128)||(l=n[d.pos++],c|=(l&127)<<14,l<128)||(l=n[d.pos++],c|=(l&127)<<21,l<128)?c:(l=n[d.pos],c|=(l&15)<<28,py(c,d))}function my(d,n,c,l){if(l==0){c==1&&(n[0]=d-1-n[0],n[1]=d-1-n[1]);const h=n[0];n[0]=n[1],n[1]=h}}var gy=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function _y(d,n,c){if(d>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(n>Math.pow(2,d)-1||c>Math.pow(2,d)-1)throw Error("tile x/y outside zoom level bounds");const l=gy[d],h=Math.pow(2,d);let _=0,x=0,s=0;const b=[n,c];let S=h/2;for(;S>0;)_=(b[0]&S)>0?1:0,x=(b[1]&S)>0?1:0,s+=S*S*(3*_^x),my(S,b,_,x),S=S/2;return l+s}function Ap(d,n){return Br(this,null,function*(){if(n===1||n===0)return d;if(n===2){if(typeof globalThis.DecompressionStream>"u")return vu(new Uint8Array(d));{let l=new Response(d).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(l).arrayBuffer()}}else throw Error("Compression method not supported")})}var yy=127;function vy(d,n){let c=0,l=d.length-1;for(;c<=l;){const h=l+c>>1,_=n-d[h].tileId;if(_>0)c=h+1;else if(_<0)l=h-1;else return d[h]}return l>=0&&(d[l].runLength===0||n-d[l].tileId<d[l].runLength)?d[l]:null}var xy=class{constructor(d){this.url=d}getKey(){return this.url}getBytes(d,n,c){return Br(this,null,function*(){let l;c||(l=new AbortController,c=l.signal);let h=yield fetch(this.url,{signal:c,headers:{Range:"bytes="+d+"-"+(d+n-1)}});if(h.status===416&&d===0){const s=h.headers.get("Content-Range");if(!s||!s.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const b=+s.substr(8);h=yield fetch(this.url,{signal:c,headers:{Range:"bytes=0-"+(b-1)}})}if(h.status>=300)throw Error("Bad response code: "+h.status);const _=h.headers.get("Content-Length");if(h.status===200&&(!_||+_>n))throw l&&l.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield h.arrayBuffer(),etag:h.headers.get("ETag")||void 0,cacheControl:h.headers.get("Cache-Control")||void 0,expires:h.headers.get("Expires")||void 0}})}};function yn(d,n){const c=d.getUint32(n+4,!0),l=d.getUint32(n+0,!0);return c*Math.pow(2,32)+l}function by(d,n){const c=new DataView(d),l=c.getUint8(7);if(l>3)throw Error(`Archive is spec version ${l} but this library supports up to spec version 3`);return{specVersion:l,rootDirectoryOffset:yn(c,8),rootDirectoryLength:yn(c,16),jsonMetadataOffset:yn(c,24),jsonMetadataLength:yn(c,32),leafDirectoryOffset:yn(c,40),leafDirectoryLength:yn(c,48),tileDataOffset:yn(c,56),tileDataLength:yn(c,64),numAddressedTiles:yn(c,72),numTileEntries:yn(c,80),numTileContents:yn(c,88),clustered:c.getUint8(96)===1,internalCompression:c.getUint8(97),tileCompression:c.getUint8(98),tileType:c.getUint8(99),minZoom:c.getUint8(100),maxZoom:c.getUint8(101),minLon:c.getInt32(102,!0)/1e7,minLat:c.getInt32(106,!0)/1e7,maxLon:c.getInt32(110,!0)/1e7,maxLat:c.getInt32(114,!0)/1e7,centerZoom:c.getUint8(118),centerLon:c.getInt32(119,!0)/1e7,centerLat:c.getInt32(123,!0)/1e7,etag:n}}function zp(d){const n={buf:new Uint8Array(d),pos:0},c=Uo(n),l=[];let h=0;for(let _=0;_<c;_++){const x=Uo(n);l.push({tileId:h+x,offset:0,length:0,runLength:1}),h+=x}for(let _=0;_<c;_++)l[_].runLength=Uo(n);for(let _=0;_<c;_++)l[_].length=Uo(n);for(let _=0;_<c;_++){const x=Uo(n);x===0&&_>0?l[_].offset=l[_-1].offset+l[_-1].length:l[_].offset=x-1}return l}function wy(d){const n=new DataView(d);return n.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):n.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Va=class extends Error{};function Ty(d,n,c,l){return Br(this,null,function*(){const h=yield d.getBytes(0,16384);if(new DataView(h.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(wy(h.data)<3)return[yield Cp.getHeader(d)];const x=h.data.slice(0,yy);let s=h.etag;l&&h.etag!=l&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+d.getKey()),s=void 0);const b=by(x,s);if(c){const S=h.data.slice(b.rootDirectoryOffset,b.rootDirectoryOffset+b.rootDirectoryLength),I=d.getKey()+"|"+(b.etag||"")+"|"+b.rootDirectoryOffset+"|"+b.rootDirectoryLength,P=zp(yield n(S,b.internalCompression));return[b,[I,P.length,P]]}return[b,void 0]})}function ky(d,n,c,l,h){return Br(this,null,function*(){const _=yield d.getBytes(c,l);if(h.etag&&h.etag!==_.etag)throw new Va(_.etag);const x=yield n(_.data,h.internalCompression),s=zp(x);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var Ey=class{constructor(d=100,n=!0,c=Ap){this.cache=new Map,this.maxCacheEntries=d,this.counter=1,this.prefetch=n,this.decompress=c}getHeader(d,n){return Br(this,null,function*(){const c=d.getKey();if(this.cache.has(c))return this.cache.get(c).lastUsed=this.counter++,yield this.cache.get(c).data;const l=new Promise((h,_)=>{Ty(d,this.decompress,this.prefetch,n).then(x=>{x[1]&&this.cache.set(x[1][0],{lastUsed:this.counter++,data:Promise.resolve(x[1][2])}),h(x[0]),this.prune()}).catch(x=>{_(x)})});return this.cache.set(c,{lastUsed:this.counter++,data:l}),l})}getDirectory(d,n,c,l){return Br(this,null,function*(){const h=d.getKey()+"|"+(l.etag||"")+"|"+n+"|"+c;if(this.cache.has(h))return this.cache.get(h).lastUsed=this.counter++,yield this.cache.get(h).data;const _=new Promise((x,s)=>{ky(d,this.decompress,n,c,l).then(b=>{x(b),this.prune()}).catch(b=>{s(b)})});return this.cache.set(h,{lastUsed:this.counter++,data:_}),_})}getArrayBuffer(d,n,c,l){return Br(this,null,function*(){const h=d.getKey()+"|"+(l.etag||"")+"|"+n+"|"+c;if(this.cache.has(h))return this.cache.get(h).lastUsed=this.counter++,yield this.cache.get(h).data;const _=new Promise((x,s)=>{d.getBytes(n,c).then(b=>{if(l.etag&&l.etag!==b.etag)throw new Va(b.etag);x(b.data),this.cache.has(h),this.prune()}).catch(b=>{s(b)})});return this.cache.set(h,{lastUsed:this.counter++,data:_}),_})}prune(){if(this.cache.size>=this.maxCacheEntries){let d=1/0,n;this.cache.forEach((c,l)=>{c.lastUsed<d&&(d=c.lastUsed,n=l)}),n&&this.cache.delete(n)}}invalidate(d,n){return Br(this,null,function*(){this.cache.delete(d.getKey()),yield this.getHeader(d,n)})}},Vf=class{constructor(d,n,c){typeof d=="string"?this.source=new xy(d):this.source=d,c?this.decompress=c:this.decompress=Ap,n?this.cache=n:this.cache=new Ey}getHeader(){return Br(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(d,n,c,l){return Br(this,null,function*(){const h=_y(d,n,c),_=yield this.cache.getHeader(this.source);if(_.specVersion<3)return Cp.getZxy(_,this.source,this.cache,d,n,c,l);if(d<_.minZoom||d>_.maxZoom)return;let x=_.rootDirectoryOffset,s=_.rootDirectoryLength;for(let b=0;b<=3;b++){const S=yield this.cache.getDirectory(this.source,x,s,_),I=vy(S,h);if(I)if(I.runLength>0){const P=yield this.source.getBytes(_.tileDataOffset+I.offset,I.length,l);if(_.etag&&_.etag!==P.etag)throw new Va(P.etag);return{data:yield this.decompress(P.data,_.tileCompression),cacheControl:P.cacheControl,expires:P.expires}}else x=_.leafDirectoryOffset+I.offset,s=I.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(d,n,c,l){return Br(this,null,function*(){try{return yield this.getZxyAttempt(d,n,c,l)}catch(h){if(h instanceof Va)return this.cache.invalidate(this.source,h.message),yield this.getZxyAttempt(d,n,c,l);throw h}})}getMetadataAttempt(){return Br(this,null,function*(){const d=yield this.cache.getHeader(this.source),n=yield this.source.getBytes(d.jsonMetadataOffset,d.jsonMetadataLength);if(d.etag&&d.etag!==n.etag)throw new Va(n.etag);const c=yield this.decompress(n.data,d.internalCompression),l=new TextDecoder("utf-8");return JSON.parse(l.decode(c))})}getMetadata(){return Br(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(d){if(d instanceof Va)return this.cache.invalidate(this.source,d.message),yield this.getMetadataAttempt();throw d}})}};const{document:Uf}=Ag;function Nf(d){let n;const c=d[20].default,l=ar(c,d,d[19],null);return{c(){l&&l.c()},l(h){l&&l.l(h)},m(h,_){l&&l.m(h,_),n=!0},p(h,_){l&&l.p&&(!n||_&524288)&&or(l,c,h,h[19],n?cr(c,h[19],_,null):lr(h[19]),null)},i(h){n||(Ee(l,h),n=!0)},o(h){Le(l,h),n=!1},d(h){l&&l.d(h)}}}function Sy(d){let n,c,l,h,_,x=d[3]&&Nf(d);return{c(){n=xe("link"),l=Ze(),h=xe("div"),x&&x.c(),this.h()},l(s){const b=up("svelte-19mu9pj",Uf.head);n=be(b,"LINK",{rel:!0,href:!0}),b.forEach(X),l=Xe(s),h=be(s,"DIV",{id:!0,class:!0});var S=Se(h);x&&x.l(S),S.forEach(X),this.h()},h(){ie(n,"rel","stylesheet"),ie(n,"href",c=d[1]?d[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"),ie(h,"id",d[0]),ie(h,"class","map svelte-1tna482")},m(s,b){he(Uf.head,n),ge(s,l,b),ge(s,h,b),x&&x.m(h,null),d[21](h),_=!0},p(s,[b]){(!_||b&2&&c!==(c=s[1]?s[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"))&&ie(n,"href",c),s[3]?x?(x.p(s,b),b&8&&Ee(x,1)):(x=Nf(s),x.c(),Ee(x,1),x.m(h,null)):x&&(ci(),Le(x,1,1,()=>{x=null}),ui()),(!_||b&1)&&ie(h,"id",s[0])},i(s){_||(Ee(x),_=!0)},o(s){Le(x),_=!1},d(s){X(n),s&&X(l),s&&X(h),x&&x.d(),d[21](null)}}}function Iy(d=1e3){return new Promise(n=>setTimeout(n,d))}function Cy(d,n,c){let{$$slots:l={},$$scope:h}=n;const _=ku();let{map:x}=n,{id:s="map"}=n,{location:b={lng:15,lat:45,zoom:1}}=n,{style:S={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=n,{css:I=null}=n,{pmtiles:P=!1}=n,{options:z={}}=n,{minzoom:V=0}=n,{maxzoom:N=14}=n,{controls:R=!1}=n,{tabbable:K=!1}=n,{zoom:ce=null}=n,{center:ae=null}=n,{pitch:Be=null}=n,{bearing:Oe=null}=n,{interactive:ke=!0}=n,{attribution:Ve=!0}=n,ze,Ne={},Ct=!1;sa("map",{getMap:()=>x}),b.bounds?Ne.bounds=b.bounds:b.lng&&b.lat&&(Ne.center=[+b.lng,+b.lat],b.zoom&&(Ne.zoom=+b.zoom),b.pitch&&(Ne.pitch=+b.pitch),b.bearing&&(Ne.bearing=+b.bearing)),Ve||(Ne.attributionControl=!1),Ne={...Ne,...z},Eu(()=>{if(P){let gt=new dy;Oo.addProtocol("pmtiles",gt.tile)}c(4,x=new Oo.Map({container:ze,style:S,minZoom:V,maxZoom:N,interactive:ke,...Ne})),R&&!Array.isArray(R)?x.addControl(new Oo.NavigationControl({showCompass:!1})):Array.isArray(R)&&R!=["locate"]&&x.addControl(new Oo.NavigationControl({showCompass:R.includes("compass"),visualizePitch:R.includes("pitch")})),Array.isArray(R)&&R.includes("locate")&&x.addControl(new Oo.GeolocateControl),x.on("load",gt=>{c(5,ce=x.getZoom()),c(6,ae=x.getCenter()),c(7,Be=x.getPitch()),c(8,Oe=x.getBearing()),c(3,Ct=!0),!K&&document.querySelector(`#${s} canvas`)&&(document.querySelector(`#${s} canvas`).tabIndex="-1"),_("load",{event:gt})}),x.on("moveend",()=>{c(5,ce=x.getZoom()),c(6,ae=x.getCenter()),c(7,Be=x.getPitch()),c(8,Oe=x.getBearing())})}),Su(async()=>{await Iy(250),x&&x.remove(),c(4,x=null)});function dt(gt){x&&x.setStyle(gt),_("style",{style:gt})}function yi(gt){oc[gt?"unshift":"push"](()=>{ze=gt,c(2,ze)})}return d.$$set=gt=>{"map"in gt&&c(4,x=gt.map),"id"in gt&&c(0,s=gt.id),"location"in gt&&c(9,b=gt.location),"style"in gt&&c(10,S=gt.style),"css"in gt&&c(1,I=gt.css),"pmtiles"in gt&&c(11,P=gt.pmtiles),"options"in gt&&c(12,z=gt.options),"minzoom"in gt&&c(13,V=gt.minzoom),"maxzoom"in gt&&c(14,N=gt.maxzoom),"controls"in gt&&c(15,R=gt.controls),"tabbable"in gt&&c(16,K=gt.tabbable),"zoom"in gt&&c(5,ce=gt.zoom),"center"in gt&&c(6,ae=gt.center),"pitch"in gt&&c(7,Be=gt.pitch),"bearing"in gt&&c(8,Oe=gt.bearing),"interactive"in gt&&c(17,ke=gt.interactive),"attribution"in gt&&c(18,Ve=gt.attribution),"$$scope"in gt&&c(19,h=gt.$$scope)},d.$$.update=()=>{d.$$.dirty&1024&&dt(S)},[s,I,ze,Ct,x,ce,ae,Be,Oe,b,S,P,z,V,N,R,K,ke,Ve,h,l,yi]}let Ay=class extends fi{constructor(n){super(),di(this,n,Cy,Sy,pi,{map:4,id:0,location:9,style:10,css:1,pmtiles:11,options:12,minzoom:13,maxzoom:14,controls:15,tabbable:16,zoom:5,center:6,pitch:7,bearing:8,interactive:17,attribution:18})}};function jf(d){let n;const c=d[12].default,l=ar(c,d,d[11],null);return{c(){l&&l.c()},l(h){l&&l.l(h)},m(h,_){l&&l.m(h,_),n=!0},p(h,_){l&&l.p&&(!n||_&2048)&&or(l,c,h,h[11],n?cr(c,h[11],_,null):lr(h[11]),null)},i(h){n||(Ee(l,h),n=!0)},o(h){Le(l,h),n=!1},d(h){l&&l.d(h)}}}function zy(d){let n,c,l=d[0]&&jf(d);return{c(){l&&l.c(),n=bt()},l(h){l&&l.l(h),n=bt()},m(h,_){l&&l.m(h,_),ge(h,n,_),c=!0},p(h,[_]){h[0]?l?(l.p(h,_),_&1&&Ee(l,1)):(l=jf(h),l.c(),Ee(l,1),l.m(n.parentNode,n)):l&&(ci(),Le(l,1,1,()=>{l=null}),ui())},i(h){c||(Ee(l),c=!0)},o(h){Le(l),c=!1},d(h){l&&l.d(h),h&&X(n)}}}function My(d=1e3){return new Promise(n=>setTimeout(n,d))}function Py(d,n,c){let{$$slots:l={},$$scope:h}=n,{id:_}=n,{type:x}=n,{url:s=null}=n,{props:b={}}=n,{data:S=null}=n,{layer:I=null}=n,{promoteId:P=null}=n,{minzoom:z=null}=n,{maxzoom:V=null}=n,{tilesize:N=256}=n,R=!1,K=s;const{getMap:ce}=Go("map"),ae=ce();sa("source",{source:_,layer:I,promoteId:P}),ae.getSource(_)&&ae.removeSource(_);async function Be(){await My(100),ae.isSourceLoaded(_)?(c(0,R=!0),console.log(_+" map source loaded!")):(console.log("..."),Be())}z&&(b.minzoom=z),V&&(b.maxzoom=V),I&&P?(b.promoteId={},b.promoteId[I]=P):P&&(b.promoteId=P);function Oe(){console.log(_+" map source loading...");let Ne;x=="geojson"?S?Ne={type:x,data:S,...b}:s&&(Ne={type:x,data:s,...b}):x=="vector"?(Ne={type:x,...b},s.slice(0,7)==="pmtiles"?Ne.url=s:Ne.tiles=[s]):x=="raster"?Ne={type:x,tiles:[s],tileSize:N,...b}:x=="raster-dem"&&(Ne={type:x,tiles:[s],tileSize:N,...b}),Ne&&(console.log(Ne),ae.addSource(_,Ne),Be())}function ke(Ne){let Ct=ae.getSource(_);Ct&&Ct.setData(Ne)}function Ve(Ne){if(Ne!==K){let Ct=ae.getSource(_);Ct&&(Ne.slice(0,7)==="pmtiles"?Ct.setUrl(Ne):Ct.setTiles([Ne])),K=Ne}}function ze(Ne){Ne!==K&&(ae.getSource(_).tiles=[Ne],ae.style.sourceCaches[_].clearTiles(),ae.style.sourceCaches[_].update(ae.transform),ae.triggerRepaint(),K=Ne)}return Eu(Oe),Su(async()=>{ae&&ae.getSource(_)&&(ae.getStyle().layers.filter(Ct=>Ct.source==_).forEach(Ct=>{ae.removeLayer(Ct.id)}),ae.removeSource(_))}),d.$$set=Ne=>{"id"in Ne&&c(2,_=Ne.id),"type"in Ne&&c(3,x=Ne.type),"url"in Ne&&c(4,s=Ne.url),"props"in Ne&&c(1,b=Ne.props),"data"in Ne&&c(5,S=Ne.data),"layer"in Ne&&c(6,I=Ne.layer),"promoteId"in Ne&&c(7,P=Ne.promoteId),"minzoom"in Ne&&c(8,z=Ne.minzoom),"maxzoom"in Ne&&c(9,V=Ne.maxzoom),"tilesize"in Ne&&c(10,N=Ne.tilesize),"$$scope"in Ne&&c(11,h=Ne.$$scope)},d.$$.update=()=>{d.$$.dirty&41&&x=="geojson"&&R&&ke(S),d.$$.dirty&25&&x=="vector"&&R&&Ve(s),d.$$.dirty&25&&x=="raster"&&R&&ze(s)},[R,b,_,x,s,S,I,P,z,V,N,h,l]}class Dy extends fi{constructor(n){super(),di(this,n,Py,zy,pi,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const Ly=d=>({hovered:d[0]&1}),Gf=d=>({hovered:d[0]});function By(d){let n;const c=d[30].default,l=ar(c,d,d[29],Gf);return{c(){l&&l.c()},l(h){l&&l.l(h)},m(h,_){l&&l.m(h,_),n=!0},p(h,_){l&&l.p&&(!n||_[0]&536870913)&&or(l,c,h,h[29],n?cr(c,h[29],_,Ly):lr(h[29]),Gf)},i(h){n||(Ee(l,h),n=!0)},o(h){Le(l,h),n=!1},d(h){l&&l.d(h)}}}function Ry(d,n,c){let l,{$$slots:h={},$$scope:_}=n;const x=ku();let{id:s}=n,{type:b}=n,{filter:S=null}=n,{layout:I={}}=n,{paint:P={}}=n,{data:z=null}=n,{colorKey:V="color"}=n,{nameKey:N=null}=n,{valueKey:R=null}=n,{idKey:K=null}=n,{select:ce=!1}=n,{clickIgnore:ae=!1}=n,{clickCenter:Be=!1}=n,{selected:Oe=null}=n,{hover:ke=!1}=n,{hovered:Ve=null}=n,{highlight:ze=!1}=n,{highlightKey:Ne="highlighted"}=n,{highlighted:Ct=[]}=n,{order:dt=null}=n,{maxzoom:yi=null}=n,{minzoom:gt=null}=n,{sourceLayer:ni=null}=n,{visible:er=!0}=n;const{source:ti,layer:xt,promoteId:mr}=Go("source"),{getMap:Si}=Go("map"),Lt=Si();sa("layer",{layer:s});const Ri=fp({id:null,feature:null,event:null});Tu(d,Ri,He=>c(32,l=He)),sa("hover",Ri),K=K||mr,ni=ni||xt;let Mi=null,Ai=null,ur=[];I.visibility=er?"visible":"none";let Ui={id:s,type:b,source:ti,paint:P,layout:I};S&&(Ui.filter=S),ni&&(Ui["source-layer"]=ni),yi&&(Ui.maxzoom=yi),gt&&(Ui.minzoom=gt),Eu(()=>{Lt.getLayer(s)&&Lt.removeLayer(s),Lt.addLayer(Ui,dt)});function Ki(He,hi=V){if(console.log("updating colors..."),N||R)for(const Ni of He)Lt.setFeatureState({source:ti,sourceLayer:ni,id:Ni[K]},{color:hi?Ni[hi]:null,name:N?Ni[N]:null,value:R?Ni[R]:null});else for(const Ni of He)Lt.setFeatureState({source:ti,sourceLayer:ni,id:Ni[K]},{color:Ni[hi]})}function gr(He){Lt.getLayer(s)&&Lt.setFilter(s,He)}function _r(He){if(Lt.getLayer(s))for(const hi in He)Lt.setPaintProperty(s,hi,He[hi])}function Tr(He){Lt.getLayer(s)&&Lt.setLayoutProperty(s,"visibility",He?"visible":"none")}return ce&&Lt.on("click",s,He=>{if(He.features.length>0&&!ae){let hi=He.features[0];if(c(2,Oe=hi.id),x("select",{id:Oe,feature:hi,event:He}),Mi&&Lt.setFeatureState({source:ti,sourceLayer:ni,id:Mi},{selected:!1}),Lt.setFeatureState({source:ti,sourceLayer:ni,id:Oe},{selected:!0}),Be){let Ni=centroid(He.features[0].toJSON().geometry);Lt.flyTo({center:Ni.geometry.coordinates})}c(26,Mi=Oe)}}),ke&&(Lt.on("mousemove",s,He=>{if(He.features.length>0){Ve&&Lt.setFeatureState({source:ti,sourceLayer:ni,id:Ve},{hovered:!1});let hi=He.features[0];c(0,Ve=c(27,Ai=hi.id)),Ri.set({id:Ve,feature:hi,event:He}),x("hover",l),Lt.setFeatureState({source:ti,sourceLayer:ni,id:Ve},{hovered:!0}),Lt.getCanvas().style.cursor="pointer"}}),Lt.on("mouseleave",s,He=>{Ve&&Lt.setFeatureState({source:ti,sourceLayer:ni,id:Ve},{hovered:!1}),c(0,Ve=c(27,Ai=null)),Ri.set({id:null,feature:null,event:He}),x("hover",l),Lt.getCanvas().style.cursor=""})),Su(async()=>{Lt&&Lt.getLayer(s)&&Lt.removeLayer(s)}),d.$$set=He=>{"id"in He&&c(6,s=He.id),"type"in He&&c(7,b=He.type),"filter"in He&&c(8,S=He.filter),"layout"in He&&c(4,I=He.layout),"paint"in He&&c(9,P=He.paint),"data"in He&&c(10,z=He.data),"colorKey"in He&&c(11,V=He.colorKey),"nameKey"in He&&c(12,N=He.nameKey),"valueKey"in He&&c(13,R=He.valueKey),"idKey"in He&&c(5,K=He.idKey),"select"in He&&c(14,ce=He.select),"clickIgnore"in He&&c(15,ae=He.clickIgnore),"clickCenter"in He&&c(16,Be=He.clickCenter),"selected"in He&&c(2,Oe=He.selected),"hover"in He&&c(17,ke=He.hover),"hovered"in He&&c(0,Ve=He.hovered),"highlight"in He&&c(18,ze=He.highlight),"highlightKey"in He&&c(19,Ne=He.highlightKey),"highlighted"in He&&c(20,Ct=He.highlighted),"order"in He&&c(21,dt=He.order),"maxzoom"in He&&c(22,yi=He.maxzoom),"minzoom"in He&&c(23,gt=He.minzoom),"sourceLayer"in He&&c(3,ni=He.sourceLayer),"visible"in He&&c(24,er=He.visible),"$$scope"in He&&c(29,_=He.$$scope)},d.$$.update=()=>{if(d.$$.dirty[0]&3072&&z&&Ki(z,V),d.$$.dirty[0]&256&&gr(S),d.$$.dirty[0]&512&&_r(P),d.$$.dirty[0]&16777216&&Tr(er),d.$$.dirty[0]&270270472&&ze&&Ct!=ur){if(ur[0])for(const He of ur){let hi={};hi[Ne]=!1,Lt.setFeatureState({source:ti,sourceLayer:ni,id:He},hi)}if(c(28,ur=Ct),Ct[0])for(const He of Ct){let hi={};hi[Ne]=!0,Lt.setFeatureState({source:ti,sourceLayer:ni,id:He},hi)}}d.$$.dirty[0]&67125260&&ce&&Oe!=Mi&&(Mi&&Lt.setFeatureState({source:ti,sourceLayer:ni,id:Mi},{selected:!1}),Oe&&Lt.setFeatureState({source:ti,sourceLayer:ni,id:Oe},{selected:!0}),c(26,Mi=Oe)),d.$$.dirty[0]&134348809&&ke&&Ve!=Ai&&(Ai&&Lt.setFeatureState({source:ti,sourceLayer:ni,id:Ai},{hovered:!1}),Ve&&Lt.setFeatureState({source:ti,sourceLayer:ni,id:Ve},{hovered:!0}),c(27,Ai=Ve))},[Ve,Ri,Oe,ni,I,K,s,b,S,P,z,V,N,R,ce,ae,Be,ke,ze,Ne,Ct,dt,yi,gt,er,Ki,Mi,Ai,ur,_,h]}class qf extends fi{constructor(n){super(),di(this,n,Ry,By,pi,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function Zf(d,n,c){const l=d.slice();return l[10]=n[c],l[12]=c,l}function Xf(d){let n,c,l,h,_,x=d[6](d[4][d[12]])+"",s;return{c(){n=xe("div"),c=Ze(),l=xe("div"),h=Ze(),_=xe("div"),s=st(x),this.h()},l(b){n=be(b,"DIV",{class:!0,style:!0}),Se(n).forEach(X),c=Xe(b),l=be(b,"DIV",{class:!0,style:!0}),Se(l).forEach(X),h=Xe(b),_=be(b,"DIV",{class:!0,style:!0});var S=Se(_);s=at(S,x),S.forEach(X),this.h()},h(){ie(n,"class","block svelte-j1hxpu"),qe(n,"width",100/(d[4].length-1)+"%"),qe(n,"left",d[12]*(100/(d[4].length-1))+"%"),qe(n,"background-color",d[5][d[12]]),ie(l,"class","line svelte-j1hxpu"),qe(l,"left",d[12]*(100/(d[4].length-1))+"%"),ie(_,"class","tick svelte-j1hxpu"),qe(_,"left",d[12]*(100/(d[4].length-1))+"%"),_t(_,"tick-start",d[12]==0)},m(b,S){ge(b,n,S),ge(b,c,S),ge(b,l,S),ge(b,h,S),ge(b,_,S),he(_,s)},p(b,S){S&16&&qe(n,"width",100/(b[4].length-1)+"%"),S&16&&qe(n,"left",b[12]*(100/(b[4].length-1))+"%"),S&32&&qe(n,"background-color",b[5][b[12]]),S&16&&qe(l,"left",b[12]*(100/(b[4].length-1))+"%"),S&80&&x!==(x=b[6](b[4][b[12]])+"")&&jt(s,x),S&16&&qe(_,"left",b[12]*(100/(b[4].length-1))+"%")},d(b){b&&X(n),b&&X(c),b&&X(l),b&&X(h),b&&X(_)}}}function Hf(d){let n,c,l,h=d[7](d[1])+"",_,x;return{c(){n=xe("div"),c=Ze(),l=xe("div"),_=st(h),x=st(d[8]),this.h()},l(s){n=be(s,"DIV",{class:!0,style:!0}),Se(n).forEach(X),c=Xe(s),l=be(s,"DIV",{class:!0,style:!0});var b=Se(l);_=at(b,h),x=at(b,d[8]),b.forEach(X),this.h()},h(){ie(n,"class","marker svelte-j1hxpu"),qe(n,"width",d[2]+"px"),qe(n,"left","calc("+d[9](d[1],d[4])+"% - "+d[2]/2+"px)"),ie(l,"class","value svelte-j1hxpu"),qe(l,"left",d[9](d[1],d[4])+"%")},m(s,b){ge(s,n,b),ge(s,c,b),ge(s,l,b),he(l,_),he(l,x)},p(s,b){b&4&&qe(n,"width",s[2]+"px"),b&22&&qe(n,"left","calc("+s[9](s[1],s[4])+"% - "+s[2]/2+"px)"),b&130&&h!==(h=s[7](s[1])+"")&&jt(_,h),b&256&&jt(x,s[8]),b&18&&qe(l,"left",s[9](s[1],s[4])+"%")},d(s){s&&X(n),s&&X(c),s&&X(l)}}}function Wf(d){let n,c,l,h=d[7](d[0])+"",_,x;return{c(){n=xe("div"),c=Ze(),l=xe("div"),_=st(h),x=st(d[8]),this.h()},l(s){n=be(s,"DIV",{class:!0,style:!0}),Se(n).forEach(X),c=Xe(s),l=be(s,"DIV",{class:!0,style:!0});var b=Se(l);_=at(b,h),x=at(b,d[8]),b.forEach(X),this.h()},h(){ie(n,"class","marker marker-hovered svelte-j1hxpu"),qe(n,"width",d[2]+"px"),qe(n,"left","calc("+d[9](d[0],d[4])+"% - "+d[2]/2+"px)"),ie(l,"class","value svelte-j1hxpu"),qe(l,"left",d[9](d[0],d[4])+"%")},m(s,b){ge(s,n,b),ge(s,c,b),ge(s,l,b),he(l,_),he(l,x)},p(s,b){b&4&&qe(n,"width",s[2]+"px"),b&21&&qe(n,"left","calc("+s[9](s[0],s[4])+"% - "+s[2]/2+"px)"),b&129&&h!==(h=s[7](s[0])+"")&&jt(_,h),b&256&&jt(x,s[8]),b&17&&qe(l,"left",s[9](s[0],s[4])+"%")},d(s){s&&X(n),s&&X(c),s&&X(l)}}}function Fy(d){let n,c,l,h,_,x=d[6](d[4][d[4].length-1])+"",s,b,S,I,P=d[4].slice(1),z=[];for(let R=0;R<P.length;R+=1)z[R]=Xf(Zf(d,P,R));let V=d[1]&&Hf(d),N=d[0]&&Wf(d);return{c(){n=xe("div");for(let R=0;R<z.length;R+=1)z[R].c();c=Ze(),l=xe("div"),h=Ze(),_=xe("div"),s=st(x),b=st(d[8]),S=Ze(),V&&V.c(),I=Ze(),N&&N.c(),this.h()},l(R){n=be(R,"DIV",{class:!0,style:!0});var K=Se(n);for(let ae=0;ae<z.length;ae+=1)z[ae].l(K);c=Xe(K),l=be(K,"DIV",{class:!0,style:!0}),Se(l).forEach(X),h=Xe(K),_=be(K,"DIV",{class:!0,style:!0});var ce=Se(_);s=at(ce,x),b=at(ce,d[8]),ce.forEach(X),S=Xe(K),V&&V.l(K),I=Xe(K),N&&N.l(K),K.forEach(X),this.h()},h(){ie(l,"class","line svelte-j1hxpu"),qe(l,"left","100%"),ie(_,"class","tick tick-end svelte-j1hxpu"),qe(_,"left","100%"),ie(n,"class","container svelte-j1hxpu"),qe(n,"height",d[3]+"px")},m(R,K){ge(R,n,K);for(let ce=0;ce<z.length;ce+=1)z[ce]&&z[ce].m(n,null);he(n,c),he(n,l),he(n,h),he(n,_),he(_,s),he(_,b),he(n,S),V&&V.m(n,null),he(n,I),N&&N.m(n,null)},p(R,[K]){if(K&112){P=R[4].slice(1);let ce;for(ce=0;ce<P.length;ce+=1){const ae=Zf(R,P,ce);z[ce]?z[ce].p(ae,K):(z[ce]=Xf(ae),z[ce].c(),z[ce].m(n,c))}for(;ce<z.length;ce+=1)z[ce].d(1);z.length=P.length}K&80&&x!==(x=R[6](R[4][R[4].length-1])+"")&&jt(s,x),K&256&&jt(b,R[8]),R[1]?V?V.p(R,K):(V=Hf(R),V.c(),V.m(n,I)):V&&(V.d(1),V=null),R[0]?N?N.p(R,K):(N=Wf(R),N.c(),N.m(n,null)):N&&(N.d(1),N=null),K&8&&qe(n,"height",R[3]+"px")},i:Bt,o:Bt,d(R){R&&X(n),$i(z,R),V&&V.d(),N&&N.d()}}}function Oy(d,n,c){let{hovered:l=null}=n,{selected:h=null}=n,{lineWidth:_=3}=n,{height:x=15}=n,{breaks:s=[0,20,40,60,80,100]}=n,{colors:b=["rgba(234,236,177,.8)","rgba(169,216,145,.8)","rgba(0,167,186,.8)","rgba(0,78,166,.8)","rgba(0,13,84,.8)"]}=n,{formatTick:S=V=>V.toFixed(1)}=n,{formatVal:I=V=>V.toFixed(1)}=n,{suffix:P="%"}=n;const z=(V,N)=>{let R=0;for(;V>N[R+1];)R+=1;let K=100/(N.length-1),ce=(V-N[R])/(N[R+1]-N[R]);return(R+ce)*K};return d.$$set=V=>{"hovered"in V&&c(0,l=V.hovered),"selected"in V&&c(1,h=V.selected),"lineWidth"in V&&c(2,_=V.lineWidth),"height"in V&&c(3,x=V.height),"breaks"in V&&c(4,s=V.breaks),"colors"in V&&c(5,b=V.colors),"formatTick"in V&&c(6,S=V.formatTick),"formatVal"in V&&c(7,I=V.formatVal),"suffix"in V&&c(8,P=V.suffix)},[l,h,_,x,s,b,S,I,P,z]}class Vy extends fi{constructor(n){super(),di(this,n,Oy,Fy,pi,{hovered:0,selected:1,lineWidth:2,height:3,breaks:4,colors:5,formatTick:6,formatVal:7,suffix:8})}}function Kf(d,n,c){const l=d.slice();return l[2]=n[c],l[4]=c,l}function Jf(d){let n,c,l,h=d[2].name+"",_,x,s,b=d[2].value.toFixed(1)+"",S,I,P;return{c(){n=xe("tr"),c=xe("td"),l=xe("strong"),_=st(h),x=Ze(),s=xe("td"),S=st(b),I=st("%"),P=Ze(),this.h()},l(z){n=be(z,"TR",{});var V=Se(n);c=be(V,"TD",{});var N=Se(c);l=be(N,"STRONG",{});var R=Se(l);_=at(R,h),R.forEach(X),N.forEach(X),x=Xe(V),s=be(V,"TD",{class:!0});var K=Se(s);S=at(K,b),I=at(K,"%"),K.forEach(X),P=Xe(V),V.forEach(X),this.h()},h(){ie(s,"class","text-right svelte-1diepvv")},m(z,V){ge(z,n,V),he(n,c),he(c,l),he(l,_),he(n,x),he(n,s),he(s,S),he(s,I),he(n,P)},p(z,V){V&1&&h!==(h=z[2].name+"")&&jt(_,h),V&1&&b!==(b=z[2].value.toFixed(1)+"")&&jt(S,b)},d(z){z&&X(n)}}}function Uy(d){let n,c,l=d[0],h=[];for(let _=0;_<l.length;_+=1)h[_]=Jf(Kf(d,l,_));return{c(){n=xe("table"),c=xe("tbody");for(let _=0;_<h.length;_+=1)h[_].c();this.h()},l(_){n=be(_,"TABLE",{class:!0});var x=Se(n);c=be(x,"TBODY",{});var s=Se(c);for(let b=0;b<h.length;b+=1)h[b].l(s);s.forEach(X),x.forEach(X),this.h()},h(){ie(n,"class","table-rank text-small svelte-1diepvv")},m(_,x){ge(_,n,x),he(n,c);for(let s=0;s<h.length;s+=1)h[s]&&h[s].m(c,null)},p(_,[x]){if(x&1){l=_[0];let s;for(s=0;s<l.length;s+=1){const b=Kf(_,l,s);h[s]?h[s].p(b,x):(h[s]=Jf(b),h[s].c(),h[s].m(c,null))}for(;s<h.length;s+=1)h[s].d(1);h.length=l.length}},i:Bt,o:Bt,d(_){_&&X(n),$i(h,_)}}}function Ny(d,n,c){let{data:l}=n,{offset:h=1}=n;return d.$$set=_=>{"data"in _&&c(0,l=_.data),"offset"in _&&c(1,h=_.offset)},[l,h]}class Mp extends fi{constructor(n){super(),di(this,n,Ny,Uy,pi,{data:0,offset:1})}}function jy(d){let n,c;return{c(){n=xe("p"),c=st("This map shows people with the selected characteristics as a percentage of each area's total population."),this.h()},l(l){n=be(l,"P",{class:!0});var h=Se(n);c=at(h,"This map shows people with the selected characteristics as a percentage of each area's total population."),h.forEach(X),this.h()},h(){ie(n,"class","subtitle svelte-1womhxv")},m(l,h){ge(l,n,h),he(n,c)},p:Bt,d(l){l&&X(n)}}}function Yf(d){let n,c;return n=new Dy({props:{id:"lad",type:"geojson",data:d[0].geojson,promoteId:d[2].code,$$slots:{default:[Gy]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=l[0].geojson),h&4&&(_.promoteId=l[2].code),h&1089&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Gy(d){let n,c,l,h,_;function x(b){d[7](b)}let s={id:"lad-fill",data:d[0].geoPerc,idKey:"code",nameKey:"name",valueKey:"value",hover:!0,tooltip:!0,type:"fill",paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"],"fill-opacity":.8},order:"highway_name_other"};return d[6]!==void 0&&(s.hovered=d[6]),n=new qf({props:s}),oc.push(()=>Iu(n,"hovered",x)),h=new qf({props:{id:"lad-line",type:"line",paint:{"line-color":"orange","line-width":2,"line-opacity":["case",["==",["feature-state","hovered"],!0],1,0]},order:"highway_name_other"}}),{c(){Et(n.$$.fragment),l=Ze(),Et(h.$$.fragment)},l(b){At(n.$$.fragment,b),l=Xe(b),At(h.$$.fragment,b)},m(b,S){St(n,b,S),ge(b,l,S),St(h,b,S),_=!0},p(b,S){const I={};S&1&&(I.data=b[0].geoPerc),!c&&S&64&&(c=!0,I.hovered=b[6],Cu(()=>c=!1)),n.$set(I)},i(b){_||(Ee(n.$$.fragment,b),Ee(h.$$.fragment,b),_=!0)},o(b){Le(n.$$.fragment,b),Le(h.$$.fragment,b),_=!1},d(b){It(n,b),b&&X(l),It(h,b)}}}function qy(d){let n,c,l=d[0].geojson&&d[0].geoPerc&&Yf(d);return{c(){l&&l.c(),n=bt()},l(h){l&&l.l(h),n=bt()},m(h,_){l&&l.m(h,_),ge(h,n,_),c=!0},p(h,_){h[0].geojson&&h[0].geoPerc?l?(l.p(h,_),_&1&&Ee(l,1)):(l=Yf(h),l.c(),Ee(l,1),l.m(n.parentNode,n)):l&&(ci(),Le(l,1,1,()=>{l=null}),ui())},i(h){c||(Ee(l),c=!0)},o(h){Le(l),c=!1},d(h){l&&l.d(h),h&&X(n)}}}function Qf(d){let n,c,l;return c=new Vy({props:{breaks:d[0].geoBreaks,hovered:d[6]&&d[0].geoPerc.find(d[8])?d[0].geoPerc.find(d[9]).value:null,colors:d[0].geoBreaks[1]==100?[d[5].seq[4]]:d[5].seq}}),{c(){n=xe("div"),Et(c.$$.fragment),this.h()},l(h){n=be(h,"DIV",{});var _=Se(n);At(c.$$.fragment,_),_.forEach(X),this.h()},h(){qe(n,"height","38px"),qe(n,"width","100%")},m(h,_){ge(h,n,_),St(c,n,null),l=!0},p(h,_){const x={};_&1&&(x.breaks=h[0].geoBreaks),_&65&&(x.hovered=h[6]&&h[0].geoPerc.find(h[8])?h[0].geoPerc.find(h[9]).value:null),_&33&&(x.colors=h[0].geoBreaks[1]==100?[h[5].seq[4]]:h[5].seq),c.$set(x)},i(h){l||(Ee(c.$$.fragment,h),l=!0)},o(h){Le(c.$$.fragment,h),l=!1},d(h){h&&X(n),It(c)}}}function Zy(d){let n,c,l,h,_;c=new Ay({props:{style:d[1],location:{bounds:d[3]},$$slots:{default:[qy]},$$scope:{ctx:d}}});let x=d[0].geoBreaks&&d[0].geoPerc&&Qf(d);return{c(){n=xe("div"),Et(c.$$.fragment),l=Ze(),x&&x.c(),h=bt(),this.h()},l(s){n=be(s,"DIV",{});var b=Se(n);At(c.$$.fragment,b),b.forEach(X),l=Xe(s),x&&x.l(s),h=bt(),this.h()},h(){qe(n,"height","450px")},m(s,b){ge(s,n,b),St(c,n,null),ge(s,l,b),x&&x.m(s,b),ge(s,h,b),_=!0},p(s,b){const S={};b&2&&(S.style=s[1]),b&8&&(S.location={bounds:s[3]}),b&1093&&(S.$$scope={dirty:b,ctx:s}),c.$set(S),s[0].geoBreaks&&s[0].geoPerc?x?(x.p(s,b),b&1&&Ee(x,1)):(x=Qf(s),x.c(),Ee(x,1),x.m(h.parentNode,h)):x&&(ci(),Le(x,1,1,()=>{x=null}),ui())},i(s){_||(Ee(c.$$.fragment,s),Ee(x),_=!0)},o(s){Le(c.$$.fragment,s),Le(x),_=!1},d(s){s&&X(n),It(c),s&&X(l),x&&x.d(s),s&&X(h)}}}function Xy(d){let n,c;return{c(){n=xe("span"),c=st("Make a selection to see rankings."),this.h()},l(l){n=be(l,"SPAN",{class:!0});var h=Se(n);c=at(h,"Make a selection to see rankings."),h.forEach(X),this.h()},h(){ie(n,"class","muted svelte-1womhxv")},m(l,h){ge(l,n,h),he(n,c)},p:Bt,i:Bt,o:Bt,d(l){l&&X(n)}}}function Hy(d){let n,c;return n=new Mp({props:{data:[...d[0].geoPerc].filter($f).sort(ed).slice(0,5)}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=[...l[0].geoPerc].filter($f).sort(ed).slice(0,5)),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Wy(d){let n,c,l,h;const _=[Hy,Xy],x=[];function s(b,S){return b[0].geoPerc&&b[4][0]?0:1}return n=s(d),c=x[n]=_[n](d),{c(){c.c(),l=bt()},l(b){c.l(b),l=bt()},m(b,S){x[n].m(b,S),ge(b,l,S),h=!0},p(b,S){let I=n;n=s(b),n===I?x[n].p(b,S):(ci(),Le(x[I],1,1,()=>{x[I]=null}),ui(),c=x[n],c?c.p(b,S):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Le(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function Ky(d){let n,c;return{c(){n=xe("span"),c=st("Make a selection to see rankings."),this.h()},l(l){n=be(l,"SPAN",{class:!0});var h=Se(n);c=at(h,"Make a selection to see rankings."),h.forEach(X),this.h()},h(){ie(n,"class","muted svelte-1womhxv")},m(l,h){ge(l,n,h),he(n,c)},p:Bt,i:Bt,o:Bt,d(l){l&&X(n)}}}function Jy(d){let n,c;return n=new Mp({props:{data:d[0].geoPerc.filter(td).sort(id).slice(-5),offset:d[0].geoPerc.filter(rd).length-4}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=l[0].geoPerc.filter(td).sort(id).slice(-5)),h&1&&(_.offset=l[0].geoPerc.filter(rd).length-4),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Yy(d){let n,c,l,h;const _=[Jy,Ky],x=[];function s(b,S){return b[0].geoPerc&&b[4][0]?0:1}return n=s(d),c=x[n]=_[n](d),{c(){c.c(),l=bt()},l(b){c.l(b),l=bt()},m(b,S){x[n].m(b,S),ge(b,l,S),h=!0},p(b,S){let I=n;n=s(b),n===I?x[n].p(b,S):(ci(),Le(x[I],1,1,()=>{x[I]=null}),ui(),c=x[n],c?c.p(b,S):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Le(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function Qy(d){let n,c,l,h,_,x,s,b;return n=new Qn({props:{colspan:3,rowspan:1,noBackground:!0,$$slots:{default:[jy]},$$scope:{ctx:d}}}),l=new Qn({props:{colspan:2,rowspan:2,noBackground:!0,$$slots:{default:[Zy]},$$scope:{ctx:d}}}),_=new Qn({props:{title:"Areas with high %",$$slots:{default:[Wy]},$$scope:{ctx:d}}}),s=new Qn({props:{title:"Areas with low %",$$slots:{default:[Yy]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment),c=Ze(),Et(l.$$.fragment),h=Ze(),Et(_.$$.fragment),x=Ze(),Et(s.$$.fragment)},l(S){At(n.$$.fragment,S),c=Xe(S),At(l.$$.fragment,S),h=Xe(S),At(_.$$.fragment,S),x=Xe(S),At(s.$$.fragment,S)},m(S,I){St(n,S,I),ge(S,c,I),St(l,S,I),ge(S,h,I),St(_,S,I),ge(S,x,I),St(s,S,I),b=!0},p(S,I){const P={};I&1024&&(P.$$scope={dirty:I,ctx:S}),n.$set(P);const z={};I&1135&&(z.$$scope={dirty:I,ctx:S}),l.$set(z);const V={};I&1041&&(V.$$scope={dirty:I,ctx:S}),_.$set(V);const N={};I&1041&&(N.$$scope={dirty:I,ctx:S}),s.$set(N)},i(S){b||(Ee(n.$$.fragment,S),Ee(l.$$.fragment,S),Ee(_.$$.fragment,S),Ee(s.$$.fragment,S),b=!0)},o(S){Le(n.$$.fragment,S),Le(l.$$.fragment,S),Le(_.$$.fragment,S),Le(s.$$.fragment,S),b=!1},d(S){It(n,S),S&&X(c),It(l,S),S&&X(h),It(_,S),S&&X(x),It(s,S)}}}function $y(d){let n,c;return n=new Au({props:{title:"Population by area",height:"auto",$$slots:{default:[Qy]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,[h]){const _={};h&1151&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}const $f=d=>d.value!=null,ed=(d,n)=>n.value-d.value,td=d=>d.value!=null,id=(d,n)=>n.value-d.value,rd=d=>d.value!=null;function e1(d,n,c){let{data:l}=n,{mapStyle:h}=n,{ladBounds:_}=n,{mapBounds:x}=n,{selected:s}=n,{colors:b}=n,S;function I(V){S=V,c(6,S)}const P=V=>V.code==S,z=V=>V.code==S;return d.$$set=V=>{"data"in V&&c(0,l=V.data),"mapStyle"in V&&c(1,h=V.mapStyle),"ladBounds"in V&&c(2,_=V.ladBounds),"mapBounds"in V&&c(3,x=V.mapBounds),"selected"in V&&c(4,s=V.selected),"colors"in V&&c(5,b=V.colors)},[l,h,_,x,s,b,S,I,P,z]}class t1 extends fi{constructor(n){super(),di(this,n,e1,$y,pi,{data:0,mapStyle:1,ladBounds:2,mapBounds:3,selected:4,colors:5})}}function nd(d){let n,c;return n=new Qn({props:{title:d[0],$$slots:{default:[s1]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.title=l[0]),h&30&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function i1(d){let n,c,l;var h=d[3];function _(x){return{props:{data:x[2].selected&&rc("residents",x[1].code,x[2]),showLegend:!1}}}return h&&(n=nf(h,_(d))),{c(){n&&Et(n.$$.fragment),c=bt()},l(x){n&&At(n.$$.fragment,x),c=bt()},m(x,s){n&&St(n,x,s),ge(x,c,s),l=!0},p(x,s){const b={};if(s&6&&(b.data=x[2].selected&&rc("residents",x[1].code,x[2])),s&8&&h!==(h=x[3])){if(n){ci();const S=n;Le(S.$$.fragment,1,0,()=>{It(S,1)}),ui()}h?(n=nf(h,_(x)),Et(n.$$.fragment),Ee(n.$$.fragment,1),St(n,c.parentNode,c)):n=null}else h&&n.$set(b)},i(x){l||(n&&Ee(n.$$.fragment,x),l=!0)},o(x){n&&Le(n.$$.fragment,x),l=!1},d(x){x&&X(c),n&&It(n,x)}}}function r1(d){let n,c=qo.nodata+"",l;return{c(){n=xe("span"),l=st(c),this.h()},l(h){n=be(h,"SPAN",{class:!0});var _=Se(n);l=at(_,c),_.forEach(X),this.h()},h(){ie(n,"class","num-desc svelte-1yn8adz")},m(h,_){ge(h,n,_),he(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function n1(d){let n,c=qo.blocked+"",l;return{c(){n=xe("span"),l=st(c),this.h()},l(h){n=be(h,"SPAN",{class:!0});var _=Se(n);l=at(_,c),_.forEach(X),this.h()},h(){ie(n,"class","num-desc svelte-1yn8adz")},m(h,_){ge(h,n,_),he(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function s1(d){let n,c,l,h,_,x=rf[d[1].code]+"",s,b;const S=[n1,r1,i1],I=[];function P(z,V){return z[2].selected.residents[z[1].code].values==="blocked"?0:z[2].selected.residents[z[1].code].values.percent[0]==null?1:2}return n=P(d),c=I[n]=S[n](d),{c(){c.c(),l=Ze(),h=xe("span"),_=st("% of "),s=st(x),this.h()},l(z){c.l(z),l=Xe(z),h=be(z,"SPAN",{class:!0});var V=Se(h);_=at(V,"% of "),s=at(V,x),V.forEach(X),this.h()},h(){ie(h,"class","num-desc svelte-1yn8adz")},m(z,V){I[n].m(z,V),ge(z,l,V),ge(z,h,V),he(h,_),he(h,s),b=!0},p(z,V){let N=n;n=P(z),n===N?I[n].p(z,V):(ci(),Le(I[N],1,1,()=>{I[N]=null}),ui(),c=I[n],c?c.p(z,V):(c=I[n]=S[n](z),c.c()),Ee(c,1),c.m(l.parentNode,l)),(!b||V&2)&&x!==(x=rf[z[1].code]+"")&&jt(s,x)},i(z){b||(Ee(c),b=!0)},o(z){Le(c),b=!1},d(z){I[n].d(z),z&&X(l),z&&X(h)}}}function a1(d){var h,_;let n,c,l=((_=(h=d[2].selected.residents)==null?void 0:h[d[1].code])==null?void 0:_.values)&&nd(d);return{c(){l&&l.c(),n=bt()},l(x){l&&l.l(x),n=bt()},m(x,s){l&&l.m(x,s),ge(x,n,s),c=!0},p(x,[s]){var b,S;(S=(b=x[2].selected.residents)==null?void 0:b[x[1].code])!=null&&S.values?l?(l.p(x,s),s&6&&Ee(l,1)):(l=nd(x),l.c(),Ee(l,1),l.m(n.parentNode,n)):l&&(ci(),Le(l,1,1,()=>{l=null}),ui())},i(x){c||(Ee(l),c=!0)},o(x){Le(l),c=!1},d(x){l&&l.d(x),x&&X(n)}}}function o1(d,n,c){let{title:l}=n,{table:h}=n,{data:_}=n,{chart_type:x}=n;return d.$$set=s=>{"title"in s&&c(0,l=s.title),"table"in s&&c(1,h=s.table),"data"in s&&c(2,_=s.data),"chart_type"in s&&c(3,x=s.chart_type)},[l,h,_,x]}class Pp extends fi{constructor(n){super(),di(this,n,o1,a1,pi,{title:0,table:1,data:2,chart_type:3})}}function l1(d){let n,c;const l=d[5].default,h=ar(l,d,d[4],null);return{c(){n=xe("mark"),h&&h.c(),this.h()},l(_){n=be(_,"MARK",{class:!0,style:!0,role:!0});var x=Se(n);h&&h.l(x),x.forEach(X),this.h()},h(){ie(n,"class","em svelte-1602h77"),qe(n,"background-color",d[0]),qe(n,"color",d[2]),ie(n,"role","presentation"),_t(n,"nowrap",d[1])},m(_,x){ge(_,n,x),h&&h.m(n,null),c=!0},p(_,[x]){h&&h.p&&(!c||x&16)&&or(h,l,_,_[4],c?cr(l,_[4],x,null):lr(_[4]),null),(!c||x&1)&&qe(n,"background-color",_[0]),(!c||x&4)&&qe(n,"color",_[2]),(!c||x&2)&&_t(n,"nowrap",_[1])},i(_){c||(Ee(h,_),c=!0)},o(_){Le(h,_),c=!1},d(_){_&&X(n),h&&h.d(_)}}}function c1(d,n,c){let l,{$$slots:h={},$$scope:_}=n,{color:x="lightgrey"}=n,{nowrap:s=!0}=n;function b(I){return(I[0]*299+I[1]*587+I[2]*114)/1e3>125?"black":"white"}let S="black";return d.$$set=I=>{"color"in I&&c(0,x=I.color),"nowrap"in I&&c(1,s=I.nowrap),"$$scope"in I&&c(4,_=I.$$scope)},d.$$.update=()=>{d.$$.dirty&1&&c(3,l=z_(x).rgb),d.$$.dirty&8&&l&&c(2,S=b(l))},[x,s,S,l,_,h]}class u1 extends fi{constructor(n){super(),di(this,n,c1,l1,pi,{color:0,nowrap:1})}}function h1(d){let n,c=d[0].selected.total_pop.count.toLocaleString()+"",l,h,_,x,s,b,S,I=Rf(d[0].selected.total_pop.percent)+"",P,z,V;return S=new u1({props:{color:"lightgrey"}}),{c(){n=xe("div"),l=st(c),h=Ze(),_=xe("div"),x=st("people"),s=Ze(),b=xe("div"),Et(S.$$.fragment),P=st(I),z=st("% of the total population of England and Wales"),this.h()},l(N){n=be(N,"DIV",{class:!0});var R=Se(n);l=at(R,c),R.forEach(X),h=Xe(N),_=be(N,"DIV",{class:!0});var K=Se(_);x=at(K,"people"),K.forEach(X),s=Xe(N),b=be(N,"DIV",{class:!0});var ce=Se(b);At(S.$$.fragment,ce),P=at(ce,I),z=at(ce,"% of the total population of England and Wales"),ce.forEach(X),this.h()},h(){ie(n,"class","num-big svelte-12pd6wz"),ie(_,"class","num-suffix svelte-12pd6wz"),ie(b,"class","num-desc svelte-12pd6wz")},m(N,R){ge(N,n,R),he(n,l),ge(N,h,R),ge(N,_,R),he(_,x),ge(N,s,R),ge(N,b,R),St(S,b,null),he(b,P),he(b,z),V=!0},p(N,R){(!V||R&1)&&c!==(c=N[0].selected.total_pop.count.toLocaleString()+"")&&jt(l,c),(!V||R&1)&&I!==(I=Rf(N[0].selected.total_pop.percent)+"")&&jt(P,I)},i(N){V||(Ee(S.$$.fragment,N),V=!0)},o(N){Le(S.$$.fragment,N),V=!1},d(N){N&&X(n),N&&X(h),N&&X(_),N&&X(s),N&&X(b),It(S)}}}function f1(d){let n,c=qo.nodata+"",l;return{c(){n=xe("div"),l=st(c),this.h()},l(h){n=be(h,"DIV",{class:!0});var _=Se(n);l=at(_,c),_.forEach(X),this.h()},h(){ie(n,"class","num-desc svelte-12pd6wz")},m(h,_){ge(h,n,_),he(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function d1(d){let n,c,l,h;const _=[f1,h1],x=[];function s(b,S){return b[0].selected.total_pop.count==null?0:1}return n=s(d),c=x[n]=_[n](d),{c(){c.c(),l=bt()},l(b){c.l(b),l=bt()},m(b,S){x[n].m(b,S),ge(b,l,S),h=!0},p(b,S){let I=n;n=s(b),n===I?x[n].p(b,S):(ci(),Le(x[I],1,1,()=>{x[I]=null}),ui(),c=x[n],c?c.p(b,S):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Le(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function p1(d){let n,c;return n=new Qn({props:{title:"Population",$$slots:{default:[d1]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,[h]){const _={};h&3&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function m1(d,n,c){let{data:l}=n;return d.$$set=h=>{"data"in h&&c(0,l=h.data)},[l]}class g1 extends fi{constructor(n){super(),di(this,n,m1,p1,pi,{data:0})}}function _1(d){let n,c,l,h,_=`translateX(${d[3]/d[1]+(d[1]-d[4])}px)`,x,s=`${d[2]}px`,b=`${d[4]}px`;return{c(){n=xe("div"),c=st(d[0]),l=Ze(),h=xe("div"),this.h()},l(S){n=be(S,"DIV",{class:!0});var I=Se(n);c=at(I,d[0]),l=Xe(I),h=be(I,"DIV",{class:!0}),Se(h).forEach(X),I.forEach(X),this.h()},h(){ie(h,"class","caret svelte-1491tb3"),qe(h,"transform",_),ie(n,"class","tooltip svelte-1491tb3"),ap(()=>d[6].call(n)),qe(n,"top",s),qe(n,"left",b)},m(S,I){ge(S,n,I),he(n,c),he(n,l),he(n,h),x=op(n,d[6].bind(n))},p(S,[I]){I&1&&jt(c,S[0]),I&26&&_!==(_=`translateX(${S[3]/S[1]+(S[1]-S[4])}px)`)&&qe(h,"transform",_),I&4&&s!==(s=`${S[2]}px`)&&qe(n,"top",s),I&16&&b!==(b=`${S[4]}px`)&&qe(n,"left",b)},i:Bt,o:Bt,d(S){S&&X(n),x()}}}const $l=4;function y1(d,n,c){let l,{title:h}=n,{x:_}=n,{y:x}=n,{width:s}=n,b;function S(){b=this.clientWidth,c(3,b)}return d.$$set=I=>{"title"in I&&c(0,h=I.title),"x"in I&&c(1,_=I.x),"y"in I&&c(2,x=I.y),"width"in I&&c(5,s=I.width)},d.$$.update=()=>{d.$$.dirty&42&&c(4,l=b&&_+b/2>s-$l?s-b/2-$l:b&&_-b/2<0+$l?b/2+$l:_)},[h,_,x,b,l,s,S]}class v1 extends fi{constructor(n){super(),di(this,n,y1,_1,pi,{title:0,x:1,y:2,width:5})}}function x1(d){let n,c;function l(_){n=d.getAttribute("title"),d.removeAttribute("title");let x=document.body.getBoundingClientRect(),s=d.getBoundingClientRect(),b=s.bottom,S=(s.left+s.right)/2;c=new v1({props:{title:n,x:S,y:b-x.y,width:x.width},target:document.body})}function h(){c.$destroy(),d.setAttribute("title",n)}return d.addEventListener("mouseover",l),d.addEventListener("mouseout",h),{destroy(){c&&c.$destroy(),d.removeEventListener("mouseover",l),d.removeEventListener("mouseout",h)}}}function sd(d,n,c){const l=d.slice();return l[20]=n[c],l[22]=c,l}function ad(d,n,c){const l=d.slice();return l[23]=n[c],l[25]=c,l}function od(d,n,c){const l=d.slice();return l[23]=n[c],l[25]=c,l}function ld(d,n,c){const l=d.slice();return l[27]=n[c],l[22]=c,l}function cd(d){let n,c=d[12],l=[];for(let h=0;h<c.length;h+=1)l[h]=ud(ld(d,c,h));return{c(){n=xe("ul");for(let h=0;h<l.length;h+=1)l[h].c();this.h()},l(h){n=be(h,"UL",{class:!0});var _=Se(n);for(let x=0;x<l.length;x+=1)l[x].l(_);_.forEach(X),this.h()},h(){ie(n,"class","legend-block svelte-h6j55z")},m(h,_){ge(h,n,_);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(n,null)},p(h,_){if(_&4112){c=h[12];let x;for(x=0;x<c.length;x+=1){const s=ld(h,c,x);l[x]?l[x].p(s,_):(l[x]=ud(s),l[x].c(),l[x].m(n,null))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){h&&X(n),$i(l,h)}}}function ud(d){let n,c,l=`${d[22]==0?0:d[4]}px`,h,_,x=d[27]+"",s,b;return{c(){n=xe("li"),c=xe("div"),h=Ze(),_=xe("span"),s=st(x),b=Ze(),this.h()},l(S){n=be(S,"LI",{class:!0});var I=Se(n);c=be(I,"DIV",{class:!0}),Se(c).forEach(X),h=Xe(I),_=be(I,"SPAN",{class:!0});var P=Se(_);s=at(P,x),P.forEach(X),b=Xe(I),I.forEach(X),this.h()},h(){ie(c,"class","legend-vis "+(d[22]==0?"bar":"marker-vis")+" svelte-h6j55z"),qe(c,"border-bottom-width",l),ie(_,"class",tc(d[22]==0?"bold":"brackets")+" svelte-h6j55z"),ie(n,"class","svelte-h6j55z")},m(S,I){ge(S,n,I),he(n,c),he(n,h),he(n,_),he(_,s),he(n,b)},p(S,I){I&16&&l!==(l=`${S[22]==0?0:S[4]}px`)&&qe(c,"border-bottom-width",l),I&4096&&x!==(x=S[27]+"")&&jt(s,x)},d(S){S&&X(n)}}}function b1(d){let n,c=d[20].values,l=[];for(let h=0;h<c.length;h+=1)l[h]=hd(ad(d,c,h));return{c(){for(let h=0;h<l.length;h+=1)l[h].c();n=bt()},l(h){for(let _=0;_<l.length;_+=1)l[_].l(h);n=bt()},m(h,_){for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(h,_);ge(h,n,_)},p(h,_){if(_&11282){c=h[20].values;let x;for(x=0;x<c.length;x+=1){const s=ad(h,c,x);l[x]?l[x].p(s,_):(l[x]=hd(s),l[x].c(),l[x].m(n.parentNode,n))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){$i(l,h),h&&X(n)}}}function w1(d){let n,c=d[20].values,l=[];for(let h=0;h<c.length;h+=1)l[h]=fd(od(d,c,h));return{c(){for(let h=0;h<l.length;h+=1)l[h].c();n=bt()},l(h){for(let _=0;_<l.length;_+=1)l[_].l(h);n=bt()},m(h,_){for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(h,_);ge(h,n,_)},p(h,_){if(_&11271){c=h[20].values;let x;for(x=0;x<c.length;x+=1){const s=od(h,c,x);l[x]?l[x].p(s,_):(l[x]=fd(s),l[x].c(),l[x].m(n.parentNode,n))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){$i(l,h),h&&X(n)}}}function hd(d){let n,c=`calc(${d[11](d[23][d[1]])}% - ${d[4]/2}px)`,l=`${d[25]/d[13].length*100}%`,h=`calc(${1/d[13].length*100}% - 2px)`,_=`${d[4]}px`;return{c(){n=xe("div"),this.h()},l(x){n=be(x,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","marker svelte-h6j55z"),qe(n,"bottom",c),qe(n,"height","0px"),qe(n,"left",l),qe(n,"width",h),qe(n,"border-bottom-width",_)},m(x,s){ge(x,n,s)},p(x,s){s&3090&&c!==(c=`calc(${x[11](x[23][x[1]])}% - ${x[4]/2}px)`)&&qe(n,"bottom",c),s&8192&&l!==(l=`${x[25]/x[13].length*100}%`)&&qe(n,"left",l),s&8192&&h!==(h=`calc(${1/x[13].length*100}% - 2px)`)&&qe(n,"width",h),s&16&&_!==(_=`${x[4]}px`)&&qe(n,"border-bottom-width",_)},d(x){x&&X(n)}}}function fd(d){let n,c,l=`${d[11](d[23][d[1]])}%`,h=`calc(${d[25]/d[13].length*100}%)`,_=`calc(${1/d[13].length*100}% - 2px)`,x,s;return{c(){n=xe("div"),this.h()},l(b){n=be(b,"DIV",{title:!0,class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"title",c=`${d[23][d[0]]}: ${d[2](d[23][d[1]])}%`+(d[10].length>1?` (${d[2](d[10][d[22]+1].values[d[25]][d[1]])}%)`:"")),ie(n,"class","bar svelte-h6j55z"),qe(n,"bottom","0"),qe(n,"height",l),qe(n,"left",h),qe(n,"width",_)},m(b,S){ge(b,n,S),x||(s=zg(x1.call(null,n)),x=!0)},p(b,S){S&1031&&c!==(c=`${b[23][b[0]]}: ${b[2](b[23][b[1]])}%`+(b[10].length>1?` (${b[2](b[10][b[22]+1].values[b[25]][b[1]])}%)`:""))&&ie(n,"title",c),S&3074&&l!==(l=`${b[11](b[23][b[1]])}%`)&&qe(n,"height",l),S&8192&&h!==(h=`calc(${b[25]/b[13].length*100}%)`)&&qe(n,"left",h),S&8192&&_!==(_=`calc(${1/b[13].length*100}% - 2px)`)&&qe(n,"width",_)},d(b){b&&X(n),x=!1,s()}}}function dd(d){let n;function c(_,x){return _[22]==0?w1:b1}let h=c(d)(d);return{c(){h.c(),n=bt()},l(_){h.l(_),n=bt()},m(_,x){h.m(_,x),ge(_,n,x)},p(_,x){h.p(_,x)},d(_){h.d(_),_&&X(n)}}}function pd(d){let n,c,l=d[6][0]!=0&&md(d),h=d[6][1]!=18&&gd(d);return{c(){l&&l.c(),n=Ze(),h&&h.c(),c=bt()},l(_){l&&l.l(_),n=Xe(_),h&&h.l(_),c=bt()},m(_,x){l&&l.m(_,x),ge(_,n,x),h&&h.m(_,x),ge(_,c,x)},p(_,x){_[6][0]!=0?l?l.p(_,x):(l=md(_),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null),_[6][1]!=18?h?h.p(_,x):(h=gd(_),h.c(),h.m(c.parentNode,c)):h&&(h.d(1),h=null)},d(_){l&&l.d(_),_&&X(n),h&&h.d(_),_&&X(c)}}}function md(d){let n,c=`${d[15](d[10])}%`;return{c(){n=xe("div"),this.h()},l(l){n=be(l,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","mask svelte-h6j55z"),qe(n,"bottom","0"),qe(n,"height",c),qe(n,"left","0"),qe(n,"width",d[14](d[6][0]))},m(l,h){ge(l,n,h)},p(l,h){h&1024&&c!==(c=`${l[15](l[10])}%`)&&qe(n,"height",c),h&64&&qe(n,"width",l[14](l[6][0]))},d(l){l&&X(n)}}}function gd(d){let n,c=`${d[15](d[10])}%`;return{c(){n=xe("div"),this.h()},l(l){n=be(l,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","mask svelte-h6j55z"),qe(n,"bottom","0"),qe(n,"height",c),qe(n,"left",d[14](d[6][1])),qe(n,"right","2px")},m(l,h){ge(l,n,h)},p(l,h){h&1024&&c!==(c=`${l[15](l[10])}%`)&&qe(n,"height",c),h&64&&qe(n,"left",l[14](l[6][1]))},d(l){l&&X(n)}}}function _d(d){let n,c,l;return{c(){n=xe("small"),c=st(d[7]),l=st(d[8]),this.h()},l(h){n=be(h,"SMALL",{class:!0});var _=Se(n);c=at(_,d[7]),l=at(_,d[8]),_.forEach(X),this.h()},h(){ie(n,"class","svelte-h6j55z")},m(h,_){ge(h,n,_),he(n,c),he(n,l)},p(h,_){_&128&&jt(c,h[7]),_&256&&jt(l,h[8])},d(h){h&&X(n)}}}function T1(d){let n,c,l,h=`${d[3]}px`,_,x,s,b=d[5][0]+"",S,I,P,z=d[5][1]+"",V,N,R,K=d[9]&&d[12][1]&&cd(d),ce=d[10],ae=[];for(let ke=0;ke<ce.length;ke+=1)ae[ke]=dd(sd(d,ce,ke));let Be=d[6]!=null&&pd(d),Oe=d[7]&&_d(d);return{c(){K&&K.c(),n=Ze(),c=xe("div");for(let ke=0;ke<ae.length;ke+=1)ae[ke].c();l=Ze(),Be&&Be.c(),_=Ze(),x=xe("div"),s=xe("div"),S=st(b),I=Ze(),P=xe("div"),V=st(z),N=Ze(),Oe&&Oe.c(),R=bt(),this.h()},l(ke){K&&K.l(ke),n=Xe(ke),c=be(ke,"DIV",{class:!0});var Ve=Se(c);for(let dt=0;dt<ae.length;dt+=1)ae[dt].l(Ve);l=Xe(Ve),Be&&Be.l(Ve),Ve.forEach(X),_=Xe(ke),x=be(ke,"DIV",{class:!0});var ze=Se(x);s=be(ze,"DIV",{class:!0});var Ne=Se(s);S=at(Ne,b),Ne.forEach(X),I=Xe(ze),P=be(ze,"DIV",{class:!0});var Ct=Se(P);V=at(Ct,z),Ct.forEach(X),ze.forEach(X),N=Xe(ke),Oe&&Oe.l(ke),R=bt(),this.h()},h(){ie(c,"class","bar-group svelte-h6j55z"),qe(c,"height",h),ie(s,"class","svelte-h6j55z"),qe(s,"left","0"),ie(P,"class","svelte-h6j55z"),qe(P,"right","0"),ie(x,"class","x-scale svelte-h6j55z"),qe(x,"height","1rem")},m(ke,Ve){K&&K.m(ke,Ve),ge(ke,n,Ve),ge(ke,c,Ve);for(let ze=0;ze<ae.length;ze+=1)ae[ze]&&ae[ze].m(c,null);he(c,l),Be&&Be.m(c,null),ge(ke,_,Ve),ge(ke,x,Ve),he(x,s),he(s,S),he(x,I),he(x,P),he(P,V),ge(ke,N,Ve),Oe&&Oe.m(ke,Ve),ge(ke,R,Ve)},p(ke,[Ve]){if(ke[9]&&ke[12][1]?K?K.p(ke,Ve):(K=cd(ke),K.c(),K.m(n.parentNode,n)):K&&(K.d(1),K=null),Ve&11287){ce=ke[10];let ze;for(ze=0;ze<ce.length;ze+=1){const Ne=sd(ke,ce,ze);ae[ze]?ae[ze].p(Ne,Ve):(ae[ze]=dd(Ne),ae[ze].c(),ae[ze].m(c,l))}for(;ze<ae.length;ze+=1)ae[ze].d(1);ae.length=ce.length}ke[6]!=null?Be?Be.p(ke,Ve):(Be=pd(ke),Be.c(),Be.m(c,null)):Be&&(Be.d(1),Be=null),Ve&8&&h!==(h=`${ke[3]}px`)&&qe(c,"height",h),Ve&32&&b!==(b=ke[5][0]+"")&&jt(S,b),Ve&32&&z!==(z=ke[5][1]+"")&&jt(V,z),ke[7]?Oe?Oe.p(ke,Ve):(Oe=_d(ke),Oe.c(),Oe.m(R.parentNode,R)):Oe&&(Oe.d(1),Oe=null)},i:Bt,o:Bt,d(ke){K&&K.d(ke),ke&&X(n),ke&&X(c),$i(ae,ke),Be&&Be.d(),ke&&X(_),ke&&X(x),ke&&X(N),Oe&&Oe.d(ke),ke&&X(R)}}}function k1(d,n,c){let l,h,_,x,s,{data:b}=n,{xKey:S="category"}=n,{yKey:I="value"}=n,{zKey:P="areanm"}=n,{formatTick:z=ze=>ze.toFixed(1)}=n,{height:V=100}=n,{markerWidth:N=2.5}=n,{minmax:R=["0 years","85+"]}=n,{maskRange:K=null}=n,{base:ce=null}=n,{base_ext:ae=", 5 year age bands"}=n,{showLegend:Be=!0}=n;function Oe(ze,Ne){let Ct={};for(const yi of ze)Ct[yi[Ne]]||(Ct[yi[Ne]]={label:yi[Ne],values:[]}),Ct[yi[Ne]].values.push(yi);let dt=[];for(const yi in Ct)dt.push(Ct[yi]);return dt}function ke(ze){return ze%1===0?`calc(${ze/l.length*100}% - 1px)`:`calc(${Math.floor(ze)/l.length*100}% +(${1/l.length*100}% - 2px) * ${ze%1})`}function Ve(ze){return Math.max(...ze.map(Ne=>Math.max(...Ne.values.map(Ct=>x(Ct[I])))))}return d.$$set=ze=>{"data"in ze&&c(16,b=ze.data),"xKey"in ze&&c(0,S=ze.xKey),"yKey"in ze&&c(1,I=ze.yKey),"zKey"in ze&&c(17,P=ze.zKey),"formatTick"in ze&&c(2,z=ze.formatTick),"height"in ze&&c(3,V=ze.height),"markerWidth"in ze&&c(4,N=ze.markerWidth),"minmax"in ze&&c(5,R=ze.minmax),"maskRange"in ze&&c(6,K=ze.maskRange),"base"in ze&&c(7,ce=ze.base),"base_ext"in ze&&c(8,ae=ze.base_ext),"showLegend"in ze&&c(9,Be=ze.showLegend)},d.$$.update=()=>{d.$$.dirty&65537&&c(13,l=b.map(ze=>ze[S]).filter((ze,Ne,Ct)=>Ct.indexOf(ze)===Ne)),d.$$.dirty&65538&&c(18,h=[0,Math.max(...b.map(ze=>ze[I]))]),d.$$.dirty&196608&&c(12,_=b.map(ze=>ze[P]).filter((ze,Ne,Ct)=>Ct.indexOf(ze)===Ne)),d.$$.dirty&262144&&c(11,x=ze=>Math.abs(ze/h[1])*100),d.$$.dirty&196608&&c(10,s=Oe(b,P))},[S,I,z,V,N,R,K,ce,ae,Be,s,x,_,l,ke,Ve,b,P,h]}class E1 extends fi{constructor(n){super(),di(this,n,k1,T1,pi,{data:16,xKey:0,yKey:1,zKey:17,formatTick:2,height:3,markerWidth:4,minmax:5,maskRange:6,base:7,base_ext:8,showLegend:9})}}function S1(d){let n,c;return n=new E1({props:{data:d[0].selected&&rc("residents","resident_age_18b",d[0]),zKey:"group",maskRange:Bf(d[1]),base:"% of all people",showLegend:!1}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=l[0].selected&&rc("residents","resident_age_18b",l[0])),h&2&&(_.maskRange=Bf(l[1])),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function I1(d){let n,c=qo.nodata+"",l;return{c(){n=xe("span"),l=st(c),this.h()},l(h){n=be(h,"SPAN",{class:!0});var _=Se(n);l=at(_,c),_.forEach(X),this.h()},h(){ie(n,"class","num-desc svelte-uj0r62")},m(h,_){ge(h,n,_),he(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function C1(d){let n,c=qo.nodata+"",l;return{c(){n=xe("span"),l=st(c),this.h()},l(h){n=be(h,"SPAN",{class:!0});var _=Se(n);l=at(_,c),_.forEach(X),this.h()},h(){ie(n,"class","num-desc svelte-uj0r62")},m(h,_){ge(h,n,_),he(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function A1(d){let n,c,l,h;const _=[C1,I1,S1],x=[];function s(b,S){return b[0].selected.residents.resident_age_18b.values==="blocked"?0:b[0].selected.residents.resident_age_18b.values.percent[0]==null?1:2}return n=s(d),c=x[n]=_[n](d),{c(){c.c(),l=bt()},l(b){c.l(b),l=bt()},m(b,S){x[n].m(b,S),ge(b,l,S),h=!0},p(b,S){let I=n;n=s(b),n===I?x[n].p(b,S):(ci(),Le(x[I],1,1,()=>{x[I]=null}),ui(),c=x[n],c?c.p(b,S):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Le(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function z1(d){let n,c;return n=new Qn({props:{title:"Age profile",$$slots:{default:[A1]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,[h]){const _={};h&7&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function M1(d,n,c){let{data:l}=n,{selected:h}=n;return d.$$set=_=>{"data"in _&&c(0,l=_.data),"selected"in _&&c(1,h=_.selected)},[l,h]}class P1 extends fi{constructor(n){super(),di(this,n,M1,z1,pi,{data:0,selected:1})}}function yd(d,n,c){const l=d.slice();return l[1]=n[c],l[3]=c,l}function vd(d){let n,c,l,h,_,x;return{c(){n=xe("li"),c=xe("div"),l=Ze(),h=xe("span"),_=st(d[1]),x=Ze(),this.h()},l(s){n=be(s,"LI",{class:!0});var b=Se(n);c=be(b,"DIV",{class:!0}),Se(c).forEach(X),l=Xe(b),h=be(b,"SPAN",{class:!0});var S=Se(h);_=at(S,d[1]),S.forEach(X),x=Xe(b),b.forEach(X),this.h()},h(){ie(c,"class","legend-vis "+(d[3]==0?"bar":"marker")+" svelte-1tlmpjc"),qe(c,"height","1rem"),qe(c,"width",d[3]==0?"1rem":d[0]+"px"),ie(h,"class",d[3]==0?"bold":"brackets"),ie(n,"class","svelte-1tlmpjc"),_t(n,"ew",d[3]!=0)},m(s,b){ge(s,n,b),he(n,c),he(n,l),he(n,h),he(h,_),he(n,x)},p(s,b){b&1&&qe(c,"width",s[3]==0?"1rem":s[0]+"px")},d(s){s&&X(n)}}}function D1(d){let n,c=["People with the selected characteristics","All people in England and Wales"],l=[];for(let h=0;h<2;h+=1)l[h]=vd(yd(d,c,h));return{c(){n=xe("ul");for(let h=0;h<2;h+=1)l[h].c();this.h()},l(h){n=be(h,"UL",{class:!0});var _=Se(n);for(let x=0;x<2;x+=1)l[x].l(_);_.forEach(X),this.h()},h(){ie(n,"class","legend-block svelte-1tlmpjc")},m(h,_){ge(h,n,_);for(let x=0;x<2;x+=1)l[x]&&l[x].m(n,null)},p(h,[_]){if(_&1){c=["People with the selected characteristics","All people in England and Wales"];let x;for(x=0;x<2;x+=1){const s=yd(h,c,x);l[x]?l[x].p(s,_):(l[x]=vd(s),l[x].c(),l[x].m(n,null))}for(;x<2;x+=1)l[x].d(1)}},i:Bt,o:Bt,d(h){h&&X(n),$i(l,h)}}}function L1(d,n,c){let{markerWidth:l=3}=n;return d.$$set=h=>{"markerWidth"in h&&c(0,l=h.markerWidth)},[l]}class Dp extends fi{constructor(n){super(),di(this,n,L1,D1,pi,{markerWidth:0})}}const B1=dp("goto"),R1=dp("after_navigate");function F1(d){return d.slice().sort(function(n,c){return n-c})}function xd(d,n){for(var c=[],l=0;l<d;l++){for(var h=[],_=0;_<n;_++)h.push(0);c.push(h)}return c}function O1(d){for(var n=0,c,l=0;l<d.length;l++)(l===0||d[l]!==c)&&(c=d[l],n++);return n}function xu(d,n,c,l){var h;if(d>0){var _=(c[n]-c[d-1])/(n-d+1);h=l[n]-l[d-1]-(n-d+1)*_*_}else h=l[n]-c[n]*c[n]/(n+1);return h<0?0:h}function bu(d,n,c,l,h,_,x){if(!(d>n)){var s=Math.floor((d+n)/2);l[c][s]=l[c-1][s-1],h[c][s]=s;var b=c;d>c&&(b=Math.max(b,h[c][d-1]||0)),b=Math.max(b,h[c-1][s]||0);var S=s-1;n<l[0].length-1&&(S=Math.min(S,h[c][n+1]||0));for(var I,P,z,V,N=S;N>=b&&(I=xu(N,s,_,x),!(I+l[c-1][b-1]>=l[c][s]));--N)P=xu(b,s,_,x),z=P+l[c-1][b-1],z<l[c][s]&&(l[c][s]=z,h[c][s]=b),b++,V=I+l[c-1][N-1],V<l[c][s]&&(l[c][s]=V,h[c][s]=N);bu(d,s-1,c,l,h,_,x),bu(s+1,n,c,l,h,_,x)}}function V1(d,n,c){for(var l=n[0].length,h=d[Math.floor(l/2)],_=[],x=[],s=0,b=void 0;s<l;++s)b=d[s]-h,s===0?(_.push(b),x.push(b*b)):(_.push(_[s-1]+b),x.push(x[s-1]+b*b)),n[0][s]=xu(0,s,_,x),c[0][s]=0;for(var S,I=1;I<n.length;++I)I<n.length-1?S=I:S=l-1,bu(S,l-1,I,n,c,_,x)}function U1(d,n){if(n>d.length)throw new Error("cannot generate more classes than there are data values");var c=F1(d),l=O1(c);if(l===1)return[c];var h=xd(n,c.length),_=xd(n,c.length);V1(c,h,_);for(var x=[],s=_[0].length-1,b=_.length-1;b>=0;b--){var S=_[b][s];x[b]=c.slice(S,s+1),b>0&&(s=S-1)}return x}function bd(d,n,c){const l=d.slice();return l[15]=n[c],l}function wd(d,n,c){const l=d.slice();return l[18]=n[c],l[20]=c,l}function Td(d,n,c){const l=d.slice();return l[18]=n[c],l[20]=c,l}function kd(d,n,c){const l=d.slice();return l[15]=n[c],l[20]=c,l}function Ed(d){let n,c=d[9],l=[];for(let h=0;h<c.length;h+=1)l[h]=Sd(kd(d,c,h));return{c(){n=xe("ul");for(let h=0;h<l.length;h+=1)l[h].c();this.h()},l(h){n=be(h,"UL",{class:!0});var _=Se(n);for(let x=0;x<l.length;x+=1)l[x].l(_);_.forEach(X),this.h()},h(){ie(n,"class","legend-block svelte-lmi12p")},m(h,_){ge(h,n,_);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(n,null)},p(h,_){if(_&544){c=h[9];let x;for(x=0;x<c.length;x+=1){const s=kd(h,c,x);l[x]?l[x].p(s,_):(l[x]=Sd(s),l[x].c(),l[x].m(n,null))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){h&&X(n),$i(l,h)}}}function Sd(d){let n,c,l,h,_=d[15]+"",x,s;return{c(){n=xe("li"),c=xe("div"),l=Ze(),h=xe("span"),x=st(_),s=Ze(),this.h()},l(b){n=be(b,"LI",{class:!0});var S=Se(n);c=be(S,"DIV",{class:!0}),Se(c).forEach(X),l=Xe(S),h=be(S,"SPAN",{class:!0});var I=Se(h);x=at(I,_),I.forEach(X),s=Xe(S),S.forEach(X),this.h()},h(){ie(c,"class","legend-vis "+(d[20]==0?"bar":"marker")+" svelte-lmi12p"),qe(c,"height","1rem"),qe(c,"width",d[20]==0?"1rem":d[5]+"px"),ie(h,"class",tc(d[20]==0?"bold":"brackets")+" svelte-lmi12p"),ie(n,"class","svelte-lmi12p"),_t(n,"ew",d[20]!=0)},m(b,S){ge(b,n,S),he(n,c),he(n,l),he(n,h),he(h,x),he(n,s)},p(b,S){S&32&&qe(c,"width",b[20]==0?"1rem":b[5]+"px"),S&512&&_!==(_=b[15]+"")&&jt(x,_)},d(b){b&&X(n)}}}function Id(d){let n,c=d[1](d[18][d[0]])+"",l,h;return{c(){n=xe("span"),l=st(c),h=st(d[2]),this.h()},l(_){n=be(_,"SPAN",{class:!0});var x=Se(n);l=at(x,c),h=at(x,d[2]),x.forEach(X),this.h()},h(){ie(n,"class","label "+(d[20]==0?"bold":"sml brackets")+" svelte-lmi12p")},m(_,x){ge(_,n,x),he(n,l),he(n,h)},p(_,x){x&131&&c!==(c=_[1](_[18][_[0]])+"")&&jt(l,c),x&4&&jt(h,_[2])},d(_){_&&X(n)}}}function N1(d){let n,c=`calc(${d[8](d[18][d[0]])}% - ${d[5]/2}px)`,l=`${d[5]}px`;return{c(){n=xe("div"),this.h()},l(h){n=be(h,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","marker svelte-lmi12p"),qe(n,"left",c),qe(n,"border-left-width",l)},m(h,_){ge(h,n,_)},p(h,_){_&417&&c!==(c=`calc(${h[8](h[18][h[0]])}% - ${h[5]/2}px)`)&&qe(n,"left",c),_&32&&l!==(l=`${h[5]}px`)&&qe(n,"border-left-width",l)},d(h){h&&X(n)}}}function j1(d){let n,c=`${d[8](d[18][d[0]])}%`;return{c(){n=xe("div"),this.h()},l(l){n=be(l,"DIV",{class:!0}),Se(n).forEach(X),this.h()},h(){ie(n,"class","bar svelte-lmi12p"),qe(n,"left","0"),qe(n,"width",c)},m(l,h){ge(l,n,h)},p(l,h){h&385&&c!==(c=`${l[8](l[18][l[0]])}%`)&&qe(n,"width",c)},d(l){l&&X(n)}}}function Cd(d){let n;function c(_,x){return _[20]==0?j1:N1}let h=c(d)(d);return{c(){h.c(),n=bt()},l(_){h.l(_),n=bt()},m(_,x){h.m(_,x),ge(_,n,x)},p(_,x){h.p(_,x)},d(_){h.d(_),_&&X(n)}}}function Ad(d){let n,c=d[15].label+"",l,h,_,x,s,b=`${d[4]}px`,S=d[15].values,I=[];for(let V=0;V<S.length;V+=1)I[V]=Id(Td(d,S,V));let P=d[15].values,z=[];for(let V=0;V<P.length;V+=1)z[V]=Cd(wd(d,P,V));return{c(){n=xe("div"),l=st(c),h=Ze(),_=xe("span");for(let V=0;V<I.length;V+=1)I[V].c();x=Ze(),s=xe("div");for(let V=0;V<z.length;V+=1)z[V].c();this.h()},l(V){n=be(V,"DIV",{class:!0});var N=Se(n);l=at(N,c),h=Xe(N),_=be(N,"SPAN",{class:!0});var R=Se(_);for(let ce=0;ce<I.length;ce+=1)I[ce].l(R);R.forEach(X),N.forEach(X),x=Xe(V),s=be(V,"DIV",{class:!0});var K=Se(s);for(let ce=0;ce<z.length;ce+=1)z[ce].l(K);K.forEach(X),this.h()},h(){ie(_,"class","nowrap svelte-lmi12p"),ie(n,"class","label-group svelte-lmi12p"),ie(s,"class","bar-group svelte-lmi12p"),qe(s,"height",b)},m(V,N){ge(V,n,N),he(n,l),he(n,h),he(n,_);for(let R=0;R<I.length;R+=1)I[R]&&I[R].m(_,null);ge(V,x,N),ge(V,s,N);for(let R=0;R<z.length;R+=1)z[R]&&z[R].m(s,null)},p(V,N){if(N&128&&c!==(c=V[15].label+"")&&jt(l,c),N&135){S=V[15].values;let R;for(R=0;R<S.length;R+=1){const K=Td(V,S,R);I[R]?I[R].p(K,N):(I[R]=Id(K),I[R].c(),I[R].m(_,null))}for(;R<I.length;R+=1)I[R].d(1);I.length=S.length}if(N&417){P=V[15].values;let R;for(R=0;R<P.length;R+=1){const K=wd(V,P,R);z[R]?z[R].p(K,N):(z[R]=Cd(K),z[R].c(),z[R].m(s,null))}for(;R<z.length;R+=1)z[R].d(1);z.length=P.length}N&16&&b!==(b=`${V[4]}px`)&&qe(s,"height",b)},d(V){V&&X(n),$i(I,V),V&&X(x),V&&X(s),$i(z,V)}}}function zd(d){let n,c;return{c(){n=xe("small"),c=st(d[3]),this.h()},l(l){n=be(l,"SMALL",{class:!0});var h=Se(n);c=at(h,d[3]),h.forEach(X),this.h()},h(){ie(n,"class","svelte-lmi12p")},m(l,h){ge(l,n,h),he(n,c)},p(l,h){h&8&&jt(c,l[3])},d(l){l&&X(n)}}}function G1(d){let n,c,l,h=d[6]&&d[9][1]&&Ed(d),_=d[7],x=[];for(let b=0;b<_.length;b+=1)x[b]=Ad(bd(d,_,b));let s=d[3]&&zd(d);return{c(){h&&h.c(),n=Ze();for(let b=0;b<x.length;b+=1)x[b].c();c=Ze(),s&&s.c(),l=bt()},l(b){h&&h.l(b),n=Xe(b);for(let S=0;S<x.length;S+=1)x[S].l(b);c=Xe(b),s&&s.l(b),l=bt()},m(b,S){h&&h.m(b,S),ge(b,n,S);for(let I=0;I<x.length;I+=1)x[I]&&x[I].m(b,S);ge(b,c,S),s&&s.m(b,S),ge(b,l,S)},p(b,[S]){if(b[6]&&b[9][1]?h?h.p(b,S):(h=Ed(b),h.c(),h.m(n.parentNode,n)):h&&(h.d(1),h=null),S&439){_=b[7];let I;for(I=0;I<_.length;I+=1){const P=bd(b,_,I);x[I]?x[I].p(P,S):(x[I]=Ad(P),x[I].c(),x[I].m(c.parentNode,c))}for(;I<x.length;I+=1)x[I].d(1);x.length=_.length}b[3]?s?s.p(b,S):(s=zd(b),s.c(),s.m(l.parentNode,l)):s&&(s.d(1),s=null)},i:Bt,o:Bt,d(b){h&&h.d(b),b&&X(n),$i(x,b),b&&X(c),s&&s.d(b),b&&X(l)}}}function q1(d,n,c){let l,h,_,x,{data:s}=n,{xKey:b="value"}=n,{yKey:S="category"}=n,{zKey:I="areanm"}=n,{formatTick:P=ae=>ae.toFixed(1)}=n,{suffix:z="%"}=n,{base:V=null}=n,{barHeight:N=25}=n,{markerWidth:R=3}=n,{showLegend:K=!0}=n;function ce(ae,Be){let Oe={},ke=[];for(const ze of ae)Oe[ze[Be]]||(Oe[ze[Be]]={label:ze[Be],values:[]},ke.push(ze[Be])),Oe[ze[Be]].values.push(ze);let Ve=[];return ke.forEach(ze=>{Ve.push(Oe[ze])}),Ve}return d.$$set=ae=>{"data"in ae&&c(10,s=ae.data),"xKey"in ae&&c(0,b=ae.xKey),"yKey"in ae&&c(11,S=ae.yKey),"zKey"in ae&&c(12,I=ae.zKey),"formatTick"in ae&&c(1,P=ae.formatTick),"suffix"in ae&&c(2,z=ae.suffix),"base"in ae&&c(3,V=ae.base),"barHeight"in ae&&c(4,N=ae.barHeight),"markerWidth"in ae&&c(5,R=ae.markerWidth),"showLegend"in ae&&c(6,K=ae.showLegend)},d.$$.update=()=>{d.$$.dirty&1025&&c(13,l=Math.max(...s.map(ae=>ae[b]))),d.$$.dirty&5120&&c(9,h=s.map(ae=>ae[I]).filter((ae,Be,Oe)=>Oe.indexOf(ae)===Be)),d.$$.dirty&8192&&c(8,_=ae=>ae/l*100),d.$$.dirty&3072&&c(7,x=ce(s,S))},[b,P,z,V,N,R,K,x,_,h,s,S,I,l]}class Z1 extends fi{constructor(n){super(),di(this,n,q1,G1,pi,{data:10,xKey:0,yKey:11,zKey:12,formatTick:1,suffix:2,base:3,barHeight:4,markerWidth:5,showLegend:6})}}function X1(d){let n,c,l;return{c(){n=ks("svg"),c=ks("path"),this.h()},l(h){n=Es(h,"svg",{class:!0,viewBox:!0,"fill-rule":!0,"clip-rule":!0,"aria-hidden":!0,focusable:!0,style:!0});var _=Se(n);c=Es(_,"path",{d:!0}),Se(c).forEach(X),_.forEach(X),this.h()},h(){ie(c,"d",l=d[4][d[0]]),ie(n,"class","ico svelte-175xtay"),ie(n,"viewBox","0 0 24 24"),ie(n,"fill-rule","evenodd"),ie(n,"clip-rule","evenodd"),ie(n,"aria-hidden","true"),ie(n,"focusable","false"),ie(n,"style",d[3]),_t(n,"margin",d[2]),_t(n,"noclick",!d[1])},m(h,_){ge(h,n,_),he(n,c)},p(h,[_]){_&1&&l!==(l=h[4][h[0]])&&ie(c,"d",l),_&8&&ie(n,"style",h[3]),_&4&&_t(n,"margin",h[2]),_&2&&_t(n,"noclick",!h[1])},i:Bt,o:Bt,d(h){h&&X(n)}}}function H1(d,n,c){let l,{type:h="compass"}=n,{rotation:_=0}=n,{position:x="inline"}=n,{clickable:s=!1}=n,{margin:b=!1}=n;const S={compass:"M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zm-10 1H8v-2h4V8l4 4-4 4v-3z",info:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z",chart:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 17c-.55 0-1-.45-1-1v-5c0-.55.45-1 1-1s1 .45 1 1v5c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v8c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1z",share:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",chevron:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",full:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",full_exit:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",shuffle:"M10.59 9.17 5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z",replay:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z",save:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z",tick:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z",cross:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z",arrow:"M5,13h11.2l-2.9,2.9c-0.4,0.4-0.4,1,0,1.4s1,0.4,1.4,0l4.6-4.6c0.4-0.4,0.4-1,0-1.4l-4.6-4.6c-0.4-0.4-1-0.4-1.4,0c0,0,0,0,0,0c-0.4,0.4-0.4,1,0,1.4l2.9,2.9H5c-0.6,0-1,0.4-1,1S4.4,13,5,13z",plus:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z",minus:"M18 13H6c-.55 0-1-.45-1-1s.45-1 1-1h12c.55 0 1 .45 1 1s-.45 1-1 1z",subdir:"m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9l6 6z",touch:"M9 11.24V7.5C9 6.12 10.12 5 11.5 5S14 6.12 14 7.5v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74c-3.6-.76-3.54-.75-3.67-.75-.31 0-.59.13-.79.33l-.79.8 4.94 4.94c.27.27.65.44 1.06.44h6.79c.75 0 1.33-.55 1.44-1.28l.75-5.27c.01-.07.02-.14.02-.2 0-.62-.38-1.16-.91-1.38z",launch:"M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.11 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1zM14 4c0 .55.45 1 1 1h2.59l-9.13 9.13c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V3h-6c-.55 0-1 .45-1 1z",close:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",error:"M 12 2 C 6.48 2 2 6.48 2 12 s 4.48 10 10 10 s 10 -4.48 10 -10 S 17.52 2 12 2 z m 1 15 h -2 v -2 h 2 v 2 z m 0 -4 h -2 V 7 h 2 v 6 z"};return d.$$set=I=>{"type"in I&&c(0,h=I.type),"rotation"in I&&c(5,_=I.rotation),"position"in I&&c(6,x=I.position),"clickable"in I&&c(1,s=I.clickable),"margin"in I&&c(2,b=I.margin)},d.$$.update=()=>{d.$$.dirty&96&&c(3,l=`transform: translate(0, 15%) scale(1.5) rotate(${-_}deg);${["left","right"].includes(x)?` position: absolute; ${x}: 10px;`:""}`)},[h,s,b,l,S,_,x]}class Pu extends fi{constructor(n){super(),di(this,n,H1,X1,pi,{type:0,rotation:5,position:6,clickable:1,margin:2})}}function Md(d,n,c){const l=d.slice();return l[11]=n[c],l}function Pd(d){let n,c,l,h;return{c(){n=xe("button"),c=st("Back"),this.h()},l(_){n=be(_,"BUTTON",{class:!0});var x=Se(n);c=at(x,"Back"),x.forEach(X),this.h()},h(){ie(n,"class","hidden-on-desktop svelte-133jwlr")},m(_,x){ge(_,n,x),he(n,c),l||(h=Ss(n,"click",function(){hp(d[3])&&d[3].apply(this,arguments)}),l=!0)},p(_,x){d=_},d(_){_&&X(n),l=!1,h()}}}function Dd(d){let n,c,l,h,_=sc(d[11],d[4])+"",x;return{c(){n=xe("br"),c=Ze(),l=xe("div"),h=st("Selected: "),x=st(_),this.h()},l(s){n=be(s,"BR",{}),c=Xe(s),l=be(s,"DIV",{class:!0});var b=Se(l);h=at(b,"Selected: "),x=at(b,_),b.forEach(X),this.h()},h(){ie(l,"class","svelte-133jwlr")},m(s,b){ge(s,n,b),ge(s,c,b),ge(s,l,b),he(l,h),he(l,x)},p(s,b){b&18&&_!==(_=sc(s[11],s[4])+"")&&jt(x,_)},d(s){s&&X(n),s&&X(c),s&&X(l)}}}function Ld(d){let n,c=d[6](d[11])+"",l,h,_,x,s,b=sc(d[11],d[4]),S,I,P;x=new Pu({props:{type:"chevron"}});let z=b&&Dd(d);function V(){return d[10](d[11])}return{c(){n=xe("button"),l=st(c),h=Ze(),_=xe("span"),Et(x.$$.fragment),s=Ze(),z&&z.c(),this.h()},l(N){n=be(N,"BUTTON",{class:!0});var R=Se(n);l=at(R,c),h=Xe(R),_=be(R,"SPAN",{class:!0});var K=Se(_);At(x.$$.fragment,K),K.forEach(X),s=Xe(R),z&&z.l(R),R.forEach(X),this.h()},h(){ie(_,"class","right-chevron svelte-133jwlr"),ie(n,"class","svelte-133jwlr"),_t(n,"plain-button",!0),_t(n,"selected",d[11]===d[0])},m(N,R){ge(N,n,R),he(n,l),he(n,h),he(n,_),St(x,_,null),he(n,s),z&&z.m(n,null),S=!0,I||(P=Ss(n,"click",V),I=!0)},p(N,R){d=N,(!S||R&66)&&c!==(c=d[6](d[11])+"")&&jt(l,c),R&18&&(b=sc(d[11],d[4])),b?z?z.p(d,R):(z=Dd(d),z.c(),z.m(n,null)):z&&(z.d(1),z=null),(!S||R&3)&&_t(n,"selected",d[11]===d[0])},i(N){S||(Ee(x.$$.fragment,N),S=!0)},o(N){Le(x.$$.fragment,N),S=!1},d(N){N&&X(n),It(x),z&&z.d(),I=!1,P()}}}function W1(d){let n,c,l,h,_,x,s,b=d[3]!=null&&Pd(d),S=d[1],I=[];for(let N=0;N<S.length;N+=1)I[N]=Ld(Md(d,S,N));const P=N=>Le(I[N],1,1,()=>{I[N]=null}),z=d[9].default,V=ar(z,d,d[8],null);return{c(){n=xe("div"),b&&b.c(),c=Ze(),l=xe("h5"),h=st(d[5]),_=Ze();for(let N=0;N<I.length;N+=1)I[N].c();x=Ze(),V&&V.c(),this.h()},l(N){n=be(N,"DIV",{class:!0});var R=Se(n);b&&b.l(R),c=Xe(R),l=be(R,"H5",{class:!0});var K=Se(l);h=at(K,d[5]),K.forEach(X),_=Xe(R);for(let ce=0;ce<I.length;ce+=1)I[ce].l(R);x=Xe(R),V&&V.l(R),R.forEach(X),this.h()},h(){ie(l,"class","column-title svelte-133jwlr"),ie(n,"class","column svelte-133jwlr"),_t(n,"hidden-first-column",d[7])},m(N,R){ge(N,n,R),b&&b.m(n,null),he(n,c),he(n,l),he(l,h),he(n,_);for(let K=0;K<I.length;K+=1)I[K]&&I[K].m(n,null);he(n,x),V&&V.m(n,null),s=!0},p(N,[R]){if(N[3]!=null?b?b.p(N,R):(b=Pd(N),b.c(),b.m(n,c)):b&&(b.d(1),b=null),(!s||R&32)&&jt(h,N[5]),R&87){S=N[1];let K;for(K=0;K<S.length;K+=1){const ce=Md(N,S,K);I[K]?(I[K].p(ce,R),Ee(I[K],1)):(I[K]=Ld(ce),I[K].c(),Ee(I[K],1),I[K].m(n,x))}for(ci(),K=S.length;K<I.length;K+=1)P(K);ui()}V&&V.p&&(!s||R&256)&&or(V,z,N,N[8],s?cr(z,N[8],R,null):lr(N[8]),null),(!s||R&128)&&_t(n,"hidden-first-column",N[7])},i(N){if(!s){for(let R=0;R<S.length;R+=1)Ee(I[R]);Ee(V,N),s=!0}},o(N){I=I.filter(Boolean);for(let R=0;R<I.length;R+=1)Le(I[R]);Le(V,N),s=!1},d(N){N&&X(n),b&&b.d(),$i(I,N),V&&V.d(N)}}}function K1(d){console.log("clicked",d)}function sc(d,n){for(let c of n)if(c.topic===d.label)return c.label;return!1}function J1(d,n,c){let{$$slots:l={},$$scope:h}=n,{options:_=[]}=n,{clickCallback:x=K1}=n,{backButtonCallback:s=null}=n,{globalSelectedCategories:b=[]}=n,{columnTitle:S="column title"}=n,{labeller:I=N=>N.label}=n,{selected:P=null}=n,{hiddenOnMobile:z=!1}=n;const V=N=>{c(0,P=N),x(N)};return d.$$set=N=>{"options"in N&&c(1,_=N.options),"clickCallback"in N&&c(2,x=N.clickCallback),"backButtonCallback"in N&&c(3,s=N.backButtonCallback),"globalSelectedCategories"in N&&c(4,b=N.globalSelectedCategories),"columnTitle"in N&&c(5,S=N.columnTitle),"labeller"in N&&c(6,I=N.labeller),"selected"in N&&c(0,P=N.selected),"hiddenOnMobile"in N&&c(7,z=N.hiddenOnMobile),"$$scope"in N&&c(8,h=N.$$scope)},[P,_,x,s,b,S,I,z,h,l,V]}class Y1 extends fi{constructor(n){super(),di(this,n,J1,W1,pi,{options:1,clickCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,selected:0,hiddenOnMobile:7})}}function Bd(d,n,c){const l=d.slice();return l[14]=n[c],l[16]=c,l}function Rd(d){let n,c;return n=new zu({props:{variant:"secondary",small:!0,$$slots:{default:[Q1]},$$scope:{ctx:d}}}),n.$on("click",function(){hp(d[3])&&d[3].apply(this,arguments)}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){d=l;const _={};h&8192&&(_.$$scope={dirty:h,ctx:d}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function Q1(d){let n;return{c(){n=st("Back")},l(c){n=at(c,"Back")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function Fd(d){let n,c;return n=new zu({props:{variant:"secondary",small:!0,disabled:d[7],$$slots:{default:[$1]},$$scope:{ctx:d}}}),n.$on("click",d[11]),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&128&&(_.disabled=l[7]),h&8192&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function $1(d){let n;return{c(){n=st("Clear selection")},l(c){n=at(c,"Clear selection")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function e0(d){let n,c,l=d[0],h=[];for(let s=0;s<l.length;s+=1)h[s]=Od(Bd(d,l,s));const _=d[10].default,x=ar(_,d,d[13],null);return{c(){for(let s=0;s<h.length;s+=1)h[s].c();n=Ze(),x&&x.c()},l(s){for(let b=0;b<h.length;b+=1)h[b].l(s);n=Xe(s),x&&x.l(s)},m(s,b){for(let S=0;S<h.length;S+=1)h[S]&&h[S].m(s,b);ge(s,n,b),x&&x.m(s,b),c=!0},p(s,b){if(b&211){l=s[0];let S;for(S=0;S<l.length;S+=1){const I=Bd(s,l,S);h[S]?h[S].p(I,b):(h[S]=Od(I),h[S].c(),h[S].m(n.parentNode,n))}for(;S<h.length;S+=1)h[S].d(1);h.length=l.length}x&&x.p&&(!c||b&8192)&&or(x,_,s,s[13],c?cr(_,s[13],b,null):lr(s[13]),null)},i(s){c||(Ee(x,s),c=!0)},o(s){Le(x,s),c=!1},d(s){$i(h,s),s&&X(n),x&&x.d(s)}}}function t0(d){let n;return{c(){n=st(`At most three characteristics can be selected. To add another
      characteristic, please remove one of the three selected ones.`)},l(c){n=at(c,`At most three characteristics can be selected. To add another
      characteristic, please remove one of the three selected ones.`)},m(c,l){ge(c,n,l)},p:Bt,i:Bt,o:Bt,d(c){c&&X(n)}}}function Od(d){let n,c,l,h,_,x,s=d[6](d[14])+"",b,S,I;function P(){return d[12](d[14])}return{c(){n=xe("span"),c=xe("span"),l=xe("input"),_=Ze(),x=xe("label"),b=st(s),this.h()},l(z){n=be(z,"SPAN",{class:!0});var V=Se(n);c=be(V,"SPAN",{class:!0});var N=Se(c);l=be(N,"INPUT",{type:!0,id:!0,name:!0,class:!0}),_=Xe(N),x=be(N,"LABEL",{for:!0,class:!0});var R=Se(x);b=at(R,s),R.forEach(X),N.forEach(X),V.forEach(X),this.h()},h(){ie(l,"type","radio"),ie(l,"id","category-option-"+d[16]),ie(l,"name","selected-category"),ie(l,"class","ons-radio__input ons-js-radio svelte-16byfl"),l.checked=h=Ud(d[14],d[4]),l.disabled=d[7],ie(x,"for","category-option-"+d[16]),ie(x,"class","ons-radio__label svelte-16byfl"),ie(c,"class","ons-radio ons-radio--no-border"),ie(n,"class","ons-radios__item ons-radios__item--no-border svelte-16byfl")},m(z,V){ge(z,n,V),he(n,c),he(c,l),he(c,_),he(c,x),he(x,b),S||(I=Ss(l,"click",P),S=!0)},p(z,V){d=z,V&17&&h!==(h=Ud(d[14],d[4]))&&(l.checked=h),V&128&&(l.disabled=d[7]),V&65&&s!==(s=d[6](d[14])+"")&&jt(b,s)},d(z){z&&X(n),S=!1,I()}}}function i0(d){let n,c,l,h,_,x,s,b=_u(d[9],d[4]),S,I,P,z,V,N,R=d[3]!=null&&Rd(d),K=b&&Fd(d);const ce=[t0,e0],ae=[];function Be(Oe,ke){return ke&528&&(P=null),P==null&&(P=Oe[4].length===3&&!_u(Oe[9],Oe[4])),P?0:1}return z=Be(d,-1),V=ae[z]=ce[z](d),{c(){n=xe("div"),c=xe("div"),R&&R.c(),l=Ze(),h=xe("div"),_=xe("h5"),x=st(d[5]),s=Ze(),K&&K.c(),S=Ze(),I=xe("div"),V.c(),this.h()},l(Oe){n=be(Oe,"DIV",{class:!0});var ke=Se(n);c=be(ke,"DIV",{class:!0});var Ve=Se(c);R&&R.l(Ve),Ve.forEach(X),l=Xe(ke),h=be(ke,"DIV",{class:!0});var ze=Se(h);_=be(ze,"H5",{class:!0});var Ne=Se(_);x=at(Ne,d[5]),Ne.forEach(X),s=Xe(ze),K&&K.l(ze),ze.forEach(X),S=Xe(ke),I=be(ke,"DIV",{class:!0});var Ct=Se(I);V.l(Ct),Ct.forEach(X),ke.forEach(X),this.h()},h(){ie(c,"class","svelte-16byfl"),_t(c,"hidden-on-desktop",!0),ie(_,"class","column-title svelte-16byfl"),ie(h,"class","title-container svelte-16byfl"),ie(I,"class","ons-radios__items"),ie(n,"class","column svelte-16byfl"),_t(n,"hidden-first-column",d[8])},m(Oe,ke){ge(Oe,n,ke),he(n,c),R&&R.m(c,null),he(n,l),he(n,h),he(h,_),he(_,x),he(h,s),K&&K.m(h,null),he(n,S),he(n,I),ae[z].m(I,null),N=!0},p(Oe,[ke]){Oe[3]!=null?R?(R.p(Oe,ke),ke&8&&Ee(R,1)):(R=Rd(Oe),R.c(),Ee(R,1),R.m(c,null)):R&&(ci(),Le(R,1,1,()=>{R=null}),ui()),(!N||ke&32)&&jt(x,Oe[5]),ke&528&&(b=_u(Oe[9],Oe[4])),b?K?(K.p(Oe,ke),ke&528&&Ee(K,1)):(K=Fd(Oe),K.c(),Ee(K,1),K.m(h,null)):K&&(ci(),Le(K,1,1,()=>{K=null}),ui());let Ve=z;z=Be(Oe,ke),z===Ve?ae[z].p(Oe,ke):(ci(),Le(ae[Ve],1,1,()=>{ae[Ve]=null}),ui(),V=ae[z],V?V.p(Oe,ke):(V=ae[z]=ce[z](Oe),V.c()),Ee(V,1),V.m(I,null)),(!N||ke&256)&&_t(n,"hidden-first-column",Oe[8])},i(Oe){N||(Ee(R),Ee(K),Ee(V),N=!0)},o(Oe){Le(R),Le(K),Le(V),N=!1},d(Oe){Oe&&X(n),R&&R.d(),K&&K.d(),ae[z].d()}}}function Vd(d){console.log("clicked",d)}function _u(d,n){for(let c of n)if(c.topic===d.label)return c.label;return!1}function Ud(d,n){for(const c of n)if(c.var===d.var&&c.code===d.code)return!0;return!1}function r0(d,n,c){let{$$slots:l={},$$scope:h}=n,{options:_=[]}=n,{clickCallback:x=Vd}=n,{removeCatCallback:s=Vd}=n,{backButtonCallback:b=null}=n,{globalSelectedCategories:S=[]}=n,{columnTitle:I="column title"}=n,{labeller:P=ce=>ce.label}=n,{disabled:z=!1}=n,{hiddenOnMobile:V=!1}=n,{currentVar:N=null}=n;const R=()=>s(N),K=ce=>x(ce);return d.$$set=ce=>{"options"in ce&&c(0,_=ce.options),"clickCallback"in ce&&c(1,x=ce.clickCallback),"removeCatCallback"in ce&&c(2,s=ce.removeCatCallback),"backButtonCallback"in ce&&c(3,b=ce.backButtonCallback),"globalSelectedCategories"in ce&&c(4,S=ce.globalSelectedCategories),"columnTitle"in ce&&c(5,I=ce.columnTitle),"labeller"in ce&&c(6,P=ce.labeller),"disabled"in ce&&c(7,z=ce.disabled),"hiddenOnMobile"in ce&&c(8,V=ce.hiddenOnMobile),"currentVar"in ce&&c(9,N=ce.currentVar),"$$scope"in ce&&c(13,h=ce.$$scope)},[_,x,s,b,S,I,P,z,V,N,l,R,K,h]}class n0 extends fi{constructor(n){super(),di(this,n,r0,i0,pi,{options:0,clickCallback:1,removeCatCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,disabled:7,hiddenOnMobile:8,currentVar:9})}}function Nd(d,n,c){const l=d.slice();return l[25]=n[c],l}function jd(d){let n,c,l=[d[5].vars[d[7][d[5].label]]],h=[];for(let x=0;x<1;x+=1)h[x]=Zd(Nd(d,l,x));const _=x=>Le(h[x],1,1,()=>{h[x]=null});return{c(){for(let x=0;x<1;x+=1)h[x].c();n=bt()},l(x){for(let s=0;s<1;s+=1)h[s].l(x);n=bt()},m(x,s){for(let b=0;b<1;b+=1)h[b]&&h[b].m(x,s);ge(x,n,s),c=!0},p(x,s){if(s&1022){l=[x[5].vars[x[7][x[5].label]]];let b;for(b=0;b<1;b+=1){const S=Nd(x,l,b);h[b]?(h[b].p(S,s),Ee(h[b],1)):(h[b]=Zd(S),h[b].c(),Ee(h[b],1),h[b].m(n.parentNode,n))}for(ci(),b=1;b<1;b+=1)_(b);ui()}},i(x){if(!c){for(let s=0;s<1;s+=1)Ee(h[s]);c=!0}},o(x){h=h.filter(Boolean);for(let s=0;s<1;s+=1)Le(h[s]);c=!1},d(x){$i(h,x),x&&X(n)}}}function Gd(d){let n,c,l,h,_,x;return c=new Pu({props:{type:"chevron",rotation:90}}),{c(){n=xe("button"),Et(c.$$.fragment),l=st(" Show fewer"),this.h()},l(s){n=be(s,"BUTTON",{class:!0});var b=Se(n);At(c.$$.fragment,b),l=at(b," Show fewer"),b.forEach(X),this.h()},h(){ie(n,"class","btn-link")},m(s,b){ge(s,n,b),St(c,n,null),he(n,l),h=!0,_||(x=Ss(n,"click",d[9]),_=!0)},p:Bt,i(s){h||(Ee(c.$$.fragment,s),h=!0)},o(s){Le(c.$$.fragment,s),h=!1},d(s){s&&X(n),It(c),_=!1,x()}}}function qd(d){let n,c,l,h,_,x;return c=new Pu({props:{type:"chevron",rotation:-90}}),{c(){n=xe("button"),Et(c.$$.fragment),l=st(" Show more"),this.h()},l(s){n=be(s,"BUTTON",{class:!0});var b=Se(n);At(c.$$.fragment,b),l=at(b," Show more"),b.forEach(X),this.h()},h(){ie(n,"class","btn-link")},m(s,b){ge(s,n,b),St(c,n,null),he(n,l),h=!0,_||(x=Ss(n,"click",d[8]),_=!0)},p:Bt,i(s){h||(Ee(c.$$.fragment,s),h=!0)},o(s){Le(c.$$.fragment,s),h=!1},d(s){s&&X(n),It(c),_=!1,x()}}}function s0(d){let n,c,l,h=d[7][d[5].label]>0&&Gd(d),_=d[7][d[5].label]<d[5].vars.length-1&&qd(d);return{c(){h&&h.c(),n=Ze(),_&&_.c(),c=Ze()},l(x){h&&h.l(x),n=Xe(x),_&&_.l(x),c=Xe(x)},m(x,s){h&&h.m(x,s),ge(x,n,s),_&&_.m(x,s),ge(x,c,s),l=!0},p(x,s){x[7][x[5].label]>0?h?(h.p(x,s),s&160&&Ee(h,1)):(h=Gd(x),h.c(),Ee(h,1),h.m(n.parentNode,n)):h&&(ci(),Le(h,1,1,()=>{h=null}),ui()),x[7][x[5].label]<x[5].vars.length-1?_?(_.p(x,s),s&160&&Ee(_,1)):(_=qd(x),_.c(),Ee(_,1),_.m(c.parentNode,c)):_&&(ci(),Le(_,1,1,()=>{_=null}),ui())},i(x){l||(Ee(h),Ee(_),l=!0)},o(x){Le(h),Le(_),l=!1},d(x){h&&h.d(x),x&&X(n),_&&_.d(x),x&&X(c)}}}function Zd(d){let n,c,l;function h(...b){return d[11](d[25],...b)}function _(...b){return d[12](d[25],...b)}function x(b){d[14](b)}let s={columnTitle:d[5].label,options:d[25].cats,clickCallback:h,removeCatCallback:_,backButtonCallback:d[13],globalSelectedCategories:d[3],currentVar:d[5],disabled:d[4],$$slots:{default:[s0]},$$scope:{ctx:d}};return d[6]!==void 0&&(s.selected=d[6]),n=new n0({props:s}),oc.push(()=>Iu(n,"selected",x)),{c(){Et(n.$$.fragment)},l(b){At(n.$$.fragment,b)},m(b,S){St(n,b,S),l=!0},p(b,S){d=b;const I={};S&32&&(I.columnTitle=d[5].label),S&160&&(I.options=d[25].cats),S&162&&(I.clickCallback=h),S&164&&(I.removeCatCallback=_),S&32&&(I.backButtonCallback=d[13]),S&8&&(I.globalSelectedCategories=d[3]),S&32&&(I.currentVar=d[5]),S&16&&(I.disabled=d[4]),S&268435616&&(I.$$scope={dirty:S,ctx:d}),!c&&S&64&&(c=!0,I.selected=d[6],Cu(()=>c=!1)),n.$set(I)},i(b){l||(Ee(n.$$.fragment,b),l=!0)},o(b){Le(n.$$.fragment,b),l=!1},d(b){It(n,b)}}}function a0(d){let n,c,l,h,_,x,s;function b(P){d[10](P)}let S={columnTitle:"Select a variable",clickCallback:c0,options:d[0],globalSelectedCategories:d[3],hiddenOnMobile:d[5]!=null};d[5]!==void 0&&(S.selected=d[5]),c=new Y1({props:S}),oc.push(()=>Iu(c,"selected",b));let I=d[5]!=null&&jd(d);return{c(){n=xe("div"),Et(c.$$.fragment),h=Ze(),I&&I.c(),_=Ze(),x=bt(),this.h()},l(P){n=be(P,"DIV",{class:!0});var z=Se(n);At(c.$$.fragment,z),h=Xe(z),I&&I.l(z),z.forEach(X),_=Xe(P),x=bt(),this.h()},h(){ie(n,"class","container svelte-9mqv54")},m(P,z){ge(P,n,z),St(c,n,null),he(n,h),I&&I.m(n,null),ge(P,_,z),ge(P,x,z),s=!0},p(P,[z]){const V={};z&1&&(V.options=P[0]),z&8&&(V.globalSelectedCategories=P[3]),z&32&&(V.hiddenOnMobile=P[5]!=null),!l&&z&32&&(l=!0,V.selected=P[5],Cu(()=>l=!1)),c.$set(V),P[5]!=null?I?(I.p(P,z),z&32&&Ee(I,1)):(I=jd(P),I.c(),Ee(I,1),I.m(n,null)):I&&(ci(),Le(I,1,1,()=>{I=null}),ui())},i(P){s||(Ee(c.$$.fragment,P),Ee(I),s=!0)},o(P){Le(c.$$.fragment,P),Le(I),s=!1},d(P){P&&X(n),It(c),I&&I.d(),P&&X(_),P&&X(x)}}}function o0(d,n){console.log(d,n)}function l0(d,n){console.log(d,n)}const c0=()=>{};function u0(d,n,c){let l,{options:h=[]}=n,{clickCallback:_=o0}=n,{removeCatCallback:x=l0}=n,{globalSelectedCategories:s=[]}=n,{disabled:b=!1}=n,S=null,I=null;function P(){c(7,++l[S.label],l)}function z(){c(7,--l[S.label],l)}function V(Be){S=Be,c(5,S)}const N=(Be,Oe)=>_(Be,Oe),R=(Be,Oe)=>x(Be,Oe),K=()=>c(5,S=null);function ce(Be){I=Be,c(6,I)}const ae=(Be,Oe)=>_(Be,Oe);return d.$$set=Be=>{"options"in Be&&c(0,h=Be.options),"clickCallback"in Be&&c(1,_=Be.clickCallback),"removeCatCallback"in Be&&c(2,x=Be.removeCatCallback),"globalSelectedCategories"in Be&&c(3,s=Be.globalSelectedCategories),"disabled"in Be&&c(4,b=Be.disabled)},d.$$.update=()=>{d.$$.dirty&1&&c(7,l=function(){let Be={};return h.forEach(Oe=>Be[Oe.label]=0),Be}())},[h,_,x,s,b,S,I,l,P,z,V,N,R,K,ce,ae]}class h0 extends fi{constructor(n){super(),di(this,n,u0,a0,pi,{options:0,clickCallback:1,removeCatCallback:2,globalSelectedCategories:3,disabled:4})}}function Xd(d,n,c){const l=d.slice();return l[18]=n[c],l}function Hd(d,n,c){const l=d.slice();return l[21]=n[c],l}function Wd(d,n,c){const l=d.slice();return l[24]=n[c],l[26]=c,l}function f0(d){let n;return{c(){n=st("Close menu")},l(c){n=at(c,"Close menu")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function d0(d){let n,c,l,h;return n=new h0({props:{options:Cg,clickCallback:d[5],removeCatCallback:d[6],globalSelectedCategories:d[1],disabled:d[2]==="loading"}}),l=new zu({props:{variant:"secondary",small:!0,$$slots:{default:[f0]},$$scope:{ctx:d}}}),l.$on("click",z0),{c(){Et(n.$$.fragment),c=Ze(),Et(l.$$.fragment)},l(_){At(n.$$.fragment,_),c=Xe(_),At(l.$$.fragment,_)},m(_,x){St(n,_,x),ge(_,c,x),St(l,_,x),h=!0},p(_,x){const s={};x&2&&(s.globalSelectedCategories=_[1]),x&4&&(s.disabled=_[2]==="loading"),n.$set(s);const b={};x&134217728&&(b.$$scope={dirty:x,ctx:_}),l.$set(b)},i(_){h||(Ee(n.$$.fragment,_),Ee(l.$$.fragment,_),h=!0)},o(_){Le(n.$$.fragment,_),Le(l.$$.fragment,_),h=!1},d(_){It(n,_),_&&X(c),It(l,_)}}}function Kd(d){let n,c;return n=new o_({props:{mode:d[2]=="failed"||d[3]==!0?"pending":"info",$$slots:{default:[x0]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&12&&(_.mode=l[2]=="failed"||l[3]==!0?"pending":"info"),h&134217742&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function p0(d){let n,c;function l(x,s){return x[1].length===2?_0:g0}let h=l(d),_=h(d);return{c(){n=st("The profile below is for people with "),_.c(),c=st(`
            of the following characteristics:`)},l(x){n=at(x,"The profile below is for people with "),_.l(x),c=at(x,`
            of the following characteristics:`)},m(x,s){ge(x,n,s),_.m(x,s),ge(x,c,s)},p(x,s){h!==(h=l(x))&&(_.d(1),_=h(x),_&&(_.c(),_.m(c.parentNode,c)))},d(x){x&&X(n),_.d(x),x&&X(c)}}}function m0(d){let n;return{c(){n=st("The profile below is for people with the following characteristic:")},l(c){n=at(c,"The profile below is for people with the following characteristic:")},m(c,l){ge(c,n,l)},p:Bt,d(c){c&&X(n)}}}function g0(d){let n;return{c(){n=st("all")},l(c){n=at(c,"all")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function _0(d){let n;return{c(){n=st("both")},l(c){n=at(c,"both")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function y0(d){let n,c,l=Ts(d[24].topic)+"",h,_,x=Ts(ac(d[24].label))+"",s,b,S,I,P;function z(){return d[8](d[24])}return{c(){n=xe("div"),c=xe("span"),h=st(l),_=st(": "),s=st(x),b=Ze(),S=xe("button"),this.h()},l(V){n=be(V,"DIV",{class:!0});var N=Se(n);c=be(N,"SPAN",{class:!0});var R=Se(c);h=at(R,l),_=at(R,": "),s=at(R,x),R.forEach(X),b=Xe(N),S=be(N,"BUTTON",{class:!0}),Se(S).forEach(X),N.forEach(X),this.h()},h(){ie(c,"class","svelte-10xvmal"),ie(S,"class","svelte-10xvmal"),ie(n,"class","chip svelte-10xvmal")},m(V,N){ge(V,n,N),he(n,c),he(c,h),he(c,_),he(c,s),he(n,b),he(n,S),I||(P=Ss(S,"click",z),I=!0)},p(V,N){d=V,N&2&&l!==(l=Ts(d[24].topic)+"")&&jt(h,l),N&2&&x!==(x=Ts(ac(d[24].label))+"")&&jt(s,x)},d(V){V&&X(n),I=!1,P()}}}function v0(d){let n,c,l=Ts(d[24].topic)+"",h,_,x=Ts(ac(d[24].label))+"",s,b,S;return{c(){n=xe("div"),c=xe("span"),h=st(l),_=st(": "),s=st(x),b=Ze(),S=xe("div"),this.h()},l(I){n=be(I,"DIV",{class:!0});var P=Se(n);c=be(P,"SPAN",{class:!0});var z=Se(c);h=at(z,l),_=at(z,": "),s=at(z,x),z.forEach(X),b=Xe(P),S=be(P,"DIV",{class:!0}),Se(S).forEach(X),P.forEach(X),this.h()},h(){ie(c,"class","svelte-10xvmal"),ie(S,"class","chip-loader svelte-10xvmal"),ie(n,"class","chip chip-pending svelte-10xvmal")},m(I,P){ge(I,n,P),he(n,c),he(c,h),he(c,_),he(c,s),he(n,b),he(n,S)},p(I,P){P&2&&l!==(l=Ts(I[24].topic)+"")&&jt(h,l),P&2&&x!==(x=Ts(ac(I[24].label))+"")&&jt(s,x)},d(I){I&&X(n)}}}function Jd(d){let n;function c(_,x){return _[2]=="loading"?v0:y0}let l=c(d),h=l(d);return{c(){h.c(),n=bt()},l(_){h.l(_),n=bt()},m(_,x){h.m(_,x),ge(_,n,x)},p(_,x){l===(l=c(_))&&h?h.p(_,x):(h.d(1),h=l(_),h&&(h.c(),h.m(n.parentNode,n)))},d(_){h.d(_),_&&X(n)}}}function Yd(d){let n,c,l,h=d[2]=="failed"&&Qd(),_=d[3]==!0&&$d();return{c(){n=xe("p"),c=st(`Some datasets not available for selected variables.
            `),h&&h.c(),l=Ze(),_&&_.c(),this.h()},l(x){n=be(x,"P",{});var s=Se(n);c=at(s,`Some datasets not available for selected variables.
            `),h&&h.l(s),l=Xe(s),_&&_.l(s),s.forEach(X),this.h()},h(){qe(n,"margin","1rem 0 0")},m(x,s){ge(x,n,s),he(n,c),h&&h.m(n,null),he(n,l),_&&_.m(n,null)},p(x,s){x[2]=="failed"?h||(h=Qd(),h.c(),h.m(n,l)):h&&(h.d(1),h=null),x[3]==!0?_||(_=$d(),_.c(),_.m(n,null)):_&&(_.d(1),_=null)},d(x){x&&X(n),h&&h.d(),_&&_.d()}}}function Qd(d){let n;return{c(){n=st("Try removing a variable to see more datasets.")},l(c){n=at(c,"Try removing a variable to see more datasets.")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function $d(d){let n;return{c(){n=st(`Economic indicators (employment, social status etc) not available for
              ages 0 to 15.`)},l(c){n=at(c,`Economic indicators (employment, social status etc) not available for
              ages 0 to 15.`)},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function x0(d){let n,c,l,h;function _(P,z){return P[1].length===1?m0:p0}let x=_(d),s=x(d),b=d[1],S=[];for(let P=0;P<b.length;P+=1)S[P]=Jd(Wd(d,b,P));let I=(d[2]=="failed"||d[3]==!0)&&Yd(d);return{c(){n=xe("p"),s.c(),c=Ze();for(let P=0;P<S.length;P+=1)S[P].c();l=Ze(),I&&I.c(),h=bt()},l(P){n=be(P,"P",{});var z=Se(n);s.l(z),z.forEach(X),c=Xe(P);for(let V=0;V<S.length;V+=1)S[V].l(P);l=Xe(P),I&&I.l(P),h=bt()},m(P,z){ge(P,n,z),s.m(n,null),ge(P,c,z);for(let V=0;V<S.length;V+=1)S[V]&&S[V].m(P,z);ge(P,l,z),I&&I.m(P,z),ge(P,h,z)},p(P,z){if(x===(x=_(P))&&s?s.p(P,z):(s.d(1),s=x(P),s&&(s.c(),s.m(n,null))),z&134){b=P[1];let V;for(V=0;V<b.length;V+=1){const N=Wd(P,b,V);S[V]?S[V].p(N,z):(S[V]=Jd(N),S[V].c(),S[V].m(l.parentNode,l))}for(;V<S.length;V+=1)S[V].d(1);S.length=b.length}P[2]=="failed"||P[3]==!0?I?I.p(P,z):(I=Yd(P),I.c(),I.m(h.parentNode,h)):I&&(I.d(1),I=null)},d(P){P&&X(n),s.d(),P&&X(c),$i(S,P),P&&X(l),I&&I.d(P),P&&X(h)}}}function b0(d){let n,c,l,h,_,x,s,b,S,I,P,z,V;P=new w_({props:{title:"Select characteristics",open:C0,$$slots:{default:[d0]},$$scope:{ctx:d}}});let N=d[1][0]&&Kd(d);return{c(){n=xe("div"),c=xe("p"),l=st(`Select one or more identity characteristics to define a population group, for example
      `),h=xe("a"),_=st("Sikhs born in the UK"),x=st(`
      or
      `),s=xe("a"),b=st("people aged 65+ born in Ireland"),S=st(`.
      Once selected, you will see how this group compares to the whole population of England and Wales based on Census 2021 data.`),I=Ze(),Et(P.$$.fragment),z=Ze(),N&&N.c(),this.h()},l(R){n=be(R,"DIV",{slot:!0});var K=Se(n);c=be(K,"P",{class:!0});var ce=Se(c);l=at(ce,`Select one or more identity characteristics to define a population group, for example
      `),h=be(ce,"A",{href:!0,class:!0});var ae=Se(h);_=at(ae,"Sikhs born in the UK"),ae.forEach(X),x=at(ce,`
      or
      `),s=be(ce,"A",{href:!0,class:!0});var Be=Se(s);b=at(Be,"people aged 65+ born in Ireland"),Be.forEach(X),S=at(ce,`.
      Once selected, you will see how this group compares to the whole population of England and Wales based on Census 2021 data.`),ce.forEach(X),I=Xe(K),At(P.$$.fragment,K),z=Xe(K),N&&N.l(K),K.forEach(X),this.h()},h(){ie(h,"href","?religion_tb=7&country_of_birth_3a=1"),ie(h,"class","svelte-10xvmal"),ie(s,"href","?resident_age_3a=3&country_of_birth_8a=2"),ie(s,"class","svelte-10xvmal"),ie(c,"class","subtitle svelte-10xvmal"),ie(n,"slot","after")},m(R,K){ge(R,n,K),he(n,c),he(c,l),he(c,h),he(h,_),he(c,x),he(c,s),he(s,b),he(c,S),he(n,I),St(P,n,null),he(n,z),N&&N.m(n,null),V=!0},p(R,K){const ce={};K&134217734&&(ce.$$scope={dirty:K,ctx:R}),P.$set(ce),R[1][0]?N?(N.p(R,K),K&2&&Ee(N,1)):(N=Kd(R),N.c(),Ee(N,1),N.m(n,null)):N&&(ci(),Le(N,1,1,()=>{N=null}),ui())},i(R){V||(Ee(P.$$.fragment,R),Ee(N),V=!0)},o(R){Le(P.$$.fragment,R),Le(N),V=!1},d(R){R&&X(n),It(P),N&&N.d()}}}function ep(d){let n,c,l,h,_,x;n=new Au({props:{title:"Demographics",height:"auto",$$slots:{default:[T0]},$$scope:{ctx:d}}}),l=new t1({props:{data:d[0],mapStyle:kg,mapBounds:Eg,ladBounds:No,selected:d[1],colors:Fa}});let s=ec[0].tablesCategorised,b=[];for(let I=0;I<s.length;I+=1)b[I]=rp(Xd(d,s,I));const S=I=>Le(b[I],1,1,()=>{b[I]=null});return{c(){Et(n.$$.fragment),c=Ze(),Et(l.$$.fragment),h=Ze();for(let I=0;I<b.length;I+=1)b[I].c();_=bt()},l(I){At(n.$$.fragment,I),c=Xe(I),At(l.$$.fragment,I),h=Xe(I);for(let P=0;P<b.length;P+=1)b[P].l(I);_=bt()},m(I,P){St(n,I,P),ge(I,c,P),St(l,I,P),ge(I,h,P);for(let z=0;z<b.length;z+=1)b[z]&&b[z].m(I,P);ge(I,_,P),x=!0},p(I,P){const z={};P&134217731&&(z.$$scope={dirty:P,ctx:I}),n.$set(z);const V={};if(P&1&&(V.data=I[0]),P&2&&(V.selected=I[1]),l.$set(V),P&17){s=ec[0].tablesCategorised;let N;for(N=0;N<s.length;N+=1){const R=Xd(I,s,N);b[N]?(b[N].p(R,P),Ee(b[N],1)):(b[N]=rp(R),b[N].c(),Ee(b[N],1),b[N].m(_.parentNode,_))}for(ci(),N=s.length;N<b.length;N+=1)S(N);ui()}},i(I){if(!x){Ee(n.$$.fragment,I),Ee(l.$$.fragment,I);for(let P=0;P<s.length;P+=1)Ee(b[P]);x=!0}},o(I){Le(n.$$.fragment,I),Le(l.$$.fragment,I),b=b.filter(Boolean);for(let P=0;P<b.length;P+=1)Le(b[P]);x=!1},d(I){It(n,I),I&&X(c),It(l,I),I&&X(h),$i(b,I),I&&X(_)}}}function w0(d){let n,c;return n=new Dp({}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function tp(d){let n,c;return n=new Pp({props:{title:"Sex",table:{code:"sex",key:"Sex"},data:d[0],chart_type:d[4]}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=l[0]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function T0(d){let n,c,l,h,_,x,s=!d[1].map(np).includes("sex"),b,S;n=new Qn({props:{colspan:3,noBackground:!0,$$slots:{default:[w0]},$$scope:{ctx:d}}}),l=new g1({props:{data:d[0]}}),_=new P1({props:{data:d[0],selected:d[1]}});let I=s&&tp(d);return{c(){Et(n.$$.fragment),c=Ze(),Et(l.$$.fragment),h=Ze(),Et(_.$$.fragment),x=Ze(),I&&I.c(),b=bt()},l(P){At(n.$$.fragment,P),c=Xe(P),At(l.$$.fragment,P),h=Xe(P),At(_.$$.fragment,P),x=Xe(P),I&&I.l(P),b=bt()},m(P,z){St(n,P,z),ge(P,c,z),St(l,P,z),ge(P,h,z),St(_,P,z),ge(P,x,z),I&&I.m(P,z),ge(P,b,z),S=!0},p(P,z){const V={};z&134217728&&(V.$$scope={dirty:z,ctx:P}),n.$set(V);const N={};z&1&&(N.data=P[0]),l.$set(N);const R={};z&1&&(R.data=P[0]),z&2&&(R.selected=P[1]),_.$set(R),z&2&&(s=!P[1].map(np).includes("sex")),s?I?(I.p(P,z),z&2&&Ee(I,1)):(I=tp(P),I.c(),Ee(I,1),I.m(b.parentNode,b)):I&&(ci(),Le(I,1,1,()=>{I=null}),ui())},i(P){S||(Ee(n.$$.fragment,P),Ee(l.$$.fragment,P),Ee(_.$$.fragment,P),Ee(I),S=!0)},o(P){Le(n.$$.fragment,P),Le(l.$$.fragment,P),Le(_.$$.fragment,P),Le(I),S=!1},d(P){It(n,P),P&&X(c),It(l,P),P&&X(h),It(_,P),P&&X(x),I&&I.d(P),P&&X(b)}}}function k0(d){let n,c;return n=new Dp({}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function ip(d){let n,c;return n=new Pp({props:{title:Lf(d[21].key),table:d[21],data:d[0],chart_type:d[4]}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.title=Lf(l[21].key)),h&1&&(_.table=l[21]),h&1&&(_.data=l[0]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function E0(d){let n,c,l,h;n=new Qn({props:{colspan:3,noBackground:!0,$$slots:{default:[k0]},$$scope:{ctx:d}}});let _=d[18].tables.filter(d[9]),x=[];for(let b=0;b<_.length;b+=1)x[b]=ip(Hd(d,_,b));const s=b=>Le(x[b],1,1,()=>{x[b]=null});return{c(){Et(n.$$.fragment),c=Ze();for(let b=0;b<x.length;b+=1)x[b].c();l=Ze()},l(b){At(n.$$.fragment,b),c=Xe(b);for(let S=0;S<x.length;S+=1)x[S].l(b);l=Xe(b)},m(b,S){St(n,b,S),ge(b,c,S);for(let I=0;I<x.length;I+=1)x[I]&&x[I].m(b,S);ge(b,l,S),h=!0},p(b,S){const I={};if(S&134217728&&(I.$$scope={dirty:S,ctx:b}),n.$set(I),S&17){_=b[18].tables.filter(b[9]);let P;for(P=0;P<_.length;P+=1){const z=Hd(b,_,P);x[P]?(x[P].p(z,S),Ee(x[P],1)):(x[P]=ip(z),x[P].c(),Ee(x[P],1),x[P].m(l.parentNode,l))}for(ci(),P=_.length;P<x.length;P+=1)s(P);ui()}},i(b){if(!h){Ee(n.$$.fragment,b);for(let S=0;S<_.length;S+=1)Ee(x[S]);h=!0}},o(b){Le(n.$$.fragment,b),x=x.filter(Boolean);for(let S=0;S<x.length;S+=1)Le(x[S]);h=!1},d(b){It(n,b),b&&X(c),$i(x,b),b&&X(l)}}}function rp(d){let n,c;return n=new Au({props:{title:d[18].categoryName,height:"auto",$$slots:{default:[E0]},$$scope:{ctx:d}}}),{c(){Et(n.$$.fragment)},l(l){At(n.$$.fragment,l)},m(l,h){St(n,l,h),c=!0},p(l,h){const _={};h&134217729&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Le(n.$$.fragment,l),c=!1},d(l){It(n,l)}}}function S0(d){let n,c,l,h,_,x,s,b,S,I,P,z,V,N;S=new qg({props:{links:[{label:"Census",href:"/census"},{label:"Create a population group profile"}]}}),P=new v_({props:{title:"Create a population group profile",$$slots:{after:[b0]},$$scope:{ctx:d}}});let R=d[2]=="success"&&d[1].length>0&&ep(d);return{c(){n=xe("meta"),c=xe("meta"),l=xe("meta"),h=xe("meta"),_=xe("meta"),x=xe("meta"),s=xe("meta"),b=Ze(),Et(S.$$.fragment),I=Ze(),Et(P.$$.fragment),z=Ze(),R&&R.c(),V=bt(),this.h()},l(K){const ce=up("svelte-1fzc9rl",document.head);n=be(ce,"META",{name:!0,content:!0}),c=be(ce,"META",{property:!0,content:!0}),l=be(ce,"META",{property:!0,content:!0}),h=be(ce,"META",{property:!0,content:!0}),_=be(ce,"META",{property:!0,content:!0}),x=be(ce,"META",{property:!0,content:!0}),s=be(ce,"META",{name:!0,content:!0}),ce.forEach(X),b=Xe(K),At(S.$$.fragment,K),I=Xe(K),At(P.$$.fragment,K),z=Xe(K),R&&R.l(K),V=bt(),this.h()},h(){document.title="Create a population group profile",ie(n,"name","description"),ie(n,"content",""),ie(c,"property","og:title"),ie(c,"content","Create a population group profile"),ie(l,"property","og:type"),ie(l,"content","website"),ie(h,"property","og:url"),ie(h,"content",wu),ie(_,"property","og:image:type"),ie(_,"content","image/jpeg"),ie(x,"property","og:description"),ie(x,"content",""),ie(s,"name","description"),ie(s,"content","")},m(K,ce){he(document.head,n),he(document.head,c),he(document.head,l),he(document.head,h),he(document.head,_),he(document.head,x),he(document.head,s),ge(K,b,ce),St(S,K,ce),ge(K,I,ce),St(P,K,ce),ge(K,z,ce),R&&R.m(K,ce),ge(K,V,ce),N=!0},p(K,[ce]){const ae={};ce&134217742&&(ae.$$scope={dirty:ce,ctx:K}),P.$set(ae),K[2]=="success"&&K[1].length>0?R?(R.p(K,ce),ce&6&&Ee(R,1)):(R=ep(K),R.c(),Ee(R,1),R.m(V.parentNode,V)):R&&(ci(),Le(R,1,1,()=>{R=null}),ui())},i(K){N||(Ee(S.$$.fragment,K),Ee(P.$$.fragment,K),Ee(R),N=!0)},o(K){Le(S.$$.fragment,K),Le(P.$$.fragment,K),Le(R),N=!1},d(K){X(n),X(c),X(l),X(h),X(_),X(x),X(s),K&&X(b),It(S,K),K&&X(I),It(P,K),K&&X(z),R&&R.d(K),K&&X(V)}}}let I0="light",C0=!0;function A0(d){let n=[];d.forEach(l=>n.push(l[0]));const c=d.flat().pop();return(d.length===1||c!=n[n.length-1])&&n.push(c),n}function ac(d){return d.split(": ").slice(-1)[0]}const np=d=>d.key,z0=d=>d.detail.target.parentElement.parentElement.removeAttribute("open");function M0(d,n,c){let l;Tu(d,Mg,ae=>c(11,l=ae));let{data:h}=n;sa("theme",Sg[I0]);let _=[],x="success",s=!1,b=Z1;function S(){B1(`${wu}?${_.map(ae=>`${ae.key}=${ae.code}`).join("&")}`,{noScroll:!0})}function I(ae,Be){c(1,_=[..._.filter(Oe=>Oe.topic!==ae.shortLabel),{topic:ae.shortLabel,key:ae.key,...Be}]),S()}function P(ae){c(1,_=_.filter(Be=>Be.topic!==ae.shortLabel)),S()}function z(ae){c(1,_=_.filter(Be=>Be.topic!=ae)),S()}function V(ae){c(0,h.selected=ae.data,h),c(0,h.selected.total_pop=ae.total_pop,h),c(0,h.geoPerc=[],h);let Be=null;{h.geoCodesAndNames.forEach(({code:ke,name:Ve})=>{let ze=_.length===0?100:ae.mapData[ke]!=null?ae.mapData[ke][1]:null;h.geoPerc.push({code:ke,name:Ve,value:ze})});let Oe=h.geoPerc.map(ke=>ke.value).filter(ke=>ke!=null);Be=Oe.length===0?null:U1(Oe,Math.min(5,Oe.length))}if(Be==null)h.geoPerc.forEach(Oe=>Oe.color=Fa.nodata),c(0,h.geoBreaks=[0,100],h);else if(_.length===0)h.geoPerc.forEach(Oe=>Oe.color=Fa.seq[4]),c(0,h.geoBreaks=[100,100],h);else{let Oe=A0(Be);h.geoPerc.forEach(ke=>ke.color=ke.value!=null?F_(ke.value,Oe,Fa.seq):Fa.nodata),c(0,h.geoBreaks=Oe,h)}_.length,c(2,x="success")}function N(){c(2,x="loading"),c(3,s=_&&_.some(ae=>["Aged 4 years and under","Aged 5 to 9 years","Aged 10 to 14 years","Aged 15 years and under"].includes(ae.label))),mp(ec,_).then(V)}function R(){c(1,_=[]);for(let ae of l.url.searchParams.entries()){let Be=Ig.find(ke=>ke.key==ae[0]);if(!Be)continue;let Oe=Be.cats.find(ke=>ke.code==ae[1]);Oe&&_.push({topic:Be.shortLabel,key:Be.key,...Oe})}N()}R1(R);const K=ae=>z(ae.topic),ce=ae=>h.selected.residents[ae.code].values!=="blocked"&&h.selected.residents[ae.code].values!==void 0;return d.$$set=ae=>{"data"in ae&&c(0,h=ae.data)},d.$$.update=()=>{d.$$.dirty&2&&console.log("selected",_)},[h,_,x,s,b,I,P,z,K,ce]}class U0 extends fi{constructor(n){super(),di(this,n,M0,S0,pi,{data:0})}}export{U0 as component,O0 as universal};
