import{T as Gm,c as Sy,m as wd,a as ch,l as ol,b as $o,d as go,p as kd,e as hl,f as Ey,g as Ty,t as Ay,v as Sd,h as Cy}from"../chunks/Table.svelte_svelte_type_style_lang.0248e4df.js";import{b as Nh}from"../chunks/paths.baec0777.js";import{S as Vi,i as Gi,s as Li,e as jt,b as Ie,v as Ii,d as Xe,f as Pi,g as De,h as Q,y as Kt,z as ei,A as Jt,B as Yt,C as An,k as Be,a as ft,l as Re,m as Ne,c as dt,n as fe,N as qt,K as ke,D as Cn,E as In,F as Pn,Q as zn,I as qr,J as Zr,q as xt,r as wt,u as _i,V as jm,W as qm,U as _o,p as yt,M as zc,G as yo,H as Nc,X as Mc,L as ci,Y as Zm,Z as Hm,_ as Uh,O as ms,$ as Wm,a0 as Xm,R as Iy,w as Uc,a1 as Vh,a2 as Gh,T as Km,o as jh,a3 as Vc,a4 as Jm,x as Ed}from"../chunks/index.ba35b81f.js";import{p as Py}from"../chunks/stores.fb17dcd0.js";import{w as Ym,h as Qm}from"../chunks/singletons.d3c94369.js";function zy(u){let r,o;return r=new Gm({props:{id:u[0],cls:u[1],theme:u[6],background:u[8],overrides:u[7],$$slots:{default:[Dy]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&1&&(f.id=l[0]),c&2&&(f.cls=l[1]),c&64&&(f.theme=l[6]),c&256&&(f.background=l[8]),c&128&&(f.overrides=l[7]),c&5692&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function My(u){let r,o;return r=new Gm({props:{id:u[0],cls:u[1],theme:u[6],background:u[8],overrides:u[7],$$slots:{default:[Ly]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&1&&(f.id=l[0]),c&2&&(f.cls=l[1]),c&64&&(f.theme=l[6]),c&256&&(f.background=l[8]),c&128&&(f.overrides=l[7]),c&5692&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Td(u){let r;return{c(){r=Be("div"),this.h()},l(o){r=Re(o,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","ons-spacer")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function Ad(u){let r;return{c(){r=Be("div"),this.h()},l(o){r=Re(o,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","ons-spacer")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function Dy(u){let r,o,l,c,f,d=u[4]&&Td();const n=u[11].default,m=An(n,u,u[12],null);let v=u[5]&&Ad();return{c(){r=Be("div"),d&&d.c(),o=ft(),m&&m.c(),l=ft(),v&&v.c(),this.h()},l(w){r=Re(w,"DIV",{id:!0,class:!0});var A=Ne(r);d&&d.l(A),o=dt(A),m&&m.l(A),l=dt(A),v&&v.l(A),A.forEach(Q),this.h()},h(){fe(r,"id",u[10]),fe(r,"class",c="ons-page__container ons-container "+u[9]+" svelte-1i9f2l"),qt(r,"ons-page__container--wider",u[2]==="wider"),qt(r,"ons-page__container--full",u[2]==="full"),qt(r,"ons-page__container--tall-height",u[3]==="tall"),qt(r,"ons-page__container--full-height",u[3]==="full")},m(w,A){Ie(w,r,A),d&&d.m(r,null),ke(r,o),m&&m.m(r,null),ke(r,l),v&&v.m(r,null),f=!0},p(w,A){w[4]?d||(d=Td(),d.c(),d.m(r,o)):d&&(d.d(1),d=null),m&&m.p&&(!f||A&4096)&&Cn(m,n,w,w[12],f?Pn(n,w[12],A,null):In(w[12]),null),w[5]?v||(v=Ad(),v.c(),v.m(r,null)):v&&(v.d(1),v=null),(!f||A&1024)&&fe(r,"id",w[10]),(!f||A&512&&c!==(c="ons-page__container ons-container "+w[9]+" svelte-1i9f2l"))&&fe(r,"class",c),(!f||A&516)&&qt(r,"ons-page__container--wider",w[2]==="wider"),(!f||A&516)&&qt(r,"ons-page__container--full",w[2]==="full"),(!f||A&520)&&qt(r,"ons-page__container--tall-height",w[3]==="tall"),(!f||A&520)&&qt(r,"ons-page__container--full-height",w[3]==="full")},i(w){f||(De(m,w),f=!0)},o(w){Xe(m,w),f=!1},d(w){w&&Q(r),d&&d.d(),m&&m.d(w),v&&v.d()}}}function Cd(u){let r;return{c(){r=Be("div"),this.h()},l(o){r=Re(o,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","ons-spacer")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function Id(u){let r;return{c(){r=Be("div"),this.h()},l(o){r=Re(o,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","ons-spacer")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function Ly(u){let r,o,l,c,f,d,n=u[4]&&Cd();const m=u[11].default,v=An(m,u,u[12],null);let w=u[5]&&Id();return{c(){r=Be("div"),n&&n.c(),o=ft(),l=Be("div"),v&&v.c(),c=ft(),w&&w.c(),this.h()},l(A){r=Re(A,"DIV",{id:!0,class:!0});var b=Ne(r);n&&n.l(b),o=dt(b),l=Re(b,"DIV",{class:!0});var E=Ne(l);v&&v.l(E),E.forEach(Q),c=dt(b),w&&w.l(b),b.forEach(Q),this.h()},h(){fe(l,"class","svelte-1i9f2l"),qt(l,"ons-page__container--narrow",u[2]==="narrow"),qt(l,"ons-page__container--medium",u[2]==="medium"),fe(r,"id",u[10]),fe(r,"class",f="ons-page__container ons-container "+u[9]+" svelte-1i9f2l"),qt(r,"ons-page__container--tall-height",u[3]==="tall"),qt(r,"ons-page__container--full-height",u[3]==="full")},m(A,b){Ie(A,r,b),n&&n.m(r,null),ke(r,o),ke(r,l),v&&v.m(l,null),ke(r,c),w&&w.m(r,null),d=!0},p(A,b){A[4]?n||(n=Cd(),n.c(),n.m(r,o)):n&&(n.d(1),n=null),v&&v.p&&(!d||b&4096)&&Cn(v,m,A,A[12],d?Pn(m,A[12],b,null):In(A[12]),null),(!d||b&4)&&qt(l,"ons-page__container--narrow",A[2]==="narrow"),(!d||b&4)&&qt(l,"ons-page__container--medium",A[2]==="medium"),A[5]?w||(w=Id(),w.c(),w.m(r,null)):w&&(w.d(1),w=null),(!d||b&1024)&&fe(r,"id",A[10]),(!d||b&512&&f!==(f="ons-page__container ons-container "+A[9]+" svelte-1i9f2l"))&&fe(r,"class",f),(!d||b&520)&&qt(r,"ons-page__container--tall-height",A[3]==="tall"),(!d||b&520)&&qt(r,"ons-page__container--full-height",A[3]==="full")},i(A){d||(De(v,A),d=!0)},o(A){Xe(v,A),d=!1},d(A){A&&Q(r),n&&n.d(),v&&v.d(A),w&&w.d()}}}function By(u){let r,o,l,c,f;const d=[My,zy],n=[];function m(v,w){return w&4&&(r=null),r==null&&(r=!!["narrow","medium"].includes(v[2])),r?0:1}return o=m(u,-1),l=n[o]=d[o](u),{c(){l.c(),c=jt()},l(v){l.l(v),c=jt()},m(v,w){n[o].m(v,w),Ie(v,c,w),f=!0},p(v,[w]){let A=o;o=m(v,w),o===A?n[o].p(v,w):(Ii(),Xe(n[A],1,1,()=>{n[A]=null}),Pi(),l=n[o],l?l.p(v,w):(l=n[o]=d[o](v),l.c()),De(l,1),l.m(c.parentNode,c))},i(v){f||(De(l),f=!0)},o(v){Xe(l),f=!1},d(v){n[o].d(v),v&&Q(c)}}}function Ry(u,r,o){let l,c,{$$slots:f={},$$scope:d}=r,{id:n=null}=r,{cls:m=null}=r,{width:v="wide"}=r,{height:w="auto"}=r,{marginTop:A=!1}=r,{marginBottom:b=!1}=r,{theme:E=null}=r,{themeOverrides:T=null}=r,{background:C=null}=r;return u.$$set=z=>{"id"in z&&o(0,n=z.id),"cls"in z&&o(1,m=z.cls),"width"in z&&o(2,v=z.width),"height"in z&&o(3,w=z.height),"marginTop"in z&&o(4,A=z.marginTop),"marginBottom"in z&&o(5,b=z.marginBottom),"theme"in z&&o(6,E=z.theme),"themeOverrides"in z&&o(7,T=z.themeOverrides),"background"in z&&o(8,C=z.background),"$$scope"in z&&o(12,d=z.$$scope)},u.$$.update=()=>{u.$$.dirty&321&&o(10,l=n&&!(E||C)?n:null),u.$$.dirty&322&&o(9,c=m&&!(E||C)?m:"")},[n,m,v,w,A,b,E,T,C,c,l,f,d]}class fl extends Vi{constructor(r){super(),Gi(this,r,Ry,By,Li,{id:0,cls:1,width:2,height:3,marginTop:4,marginBottom:5,theme:6,themeOverrides:7,background:8})}}var al=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gc(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}function Pd(u,r,o){const l=u.slice();return l[5]=r[o],l}function Oy(u){let r=u[5].label+"",o;return{c(){o=xt(r)},l(l){o=wt(l,r)},m(l,c){Ie(l,o,c)},p(l,c){c&1&&r!==(r=l[5].label+"")&&_i(o,r)},d(l){l&&Q(o)}}}function Fy(u){let r,o=u[5].label+"",l,c;return{c(){r=Be("a"),l=xt(o),this.h()},l(f){r=Re(f,"A",{class:!0,href:!0});var d=Ne(r);l=wt(d,o),d.forEach(Q),this.h()},h(){fe(r,"class","ons-breadcrumb__link"),fe(r,"href",c=u[5].href)},m(f,d){Ie(f,r,d),ke(r,l)},p(f,d){d&1&&o!==(o=f[5].label+"")&&_i(l,o),d&1&&c!==(c=f[5].href)&&fe(r,"href",c)},d(f){f&&Q(r)}}}function zd(u){let r,o,l,c,f;function d(v,w){return v[5].href?Fy:Oy}let n=d(u),m=n(u);return{c(){r=Be("li"),m.c(),o=ft(),l=qr("svg"),c=qr("path"),f=ft(),this.h()},l(v){r=Re(v,"LI",{class:!0});var w=Ne(r);m.l(w),o=dt(w),l=Zr(w,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0});var A=Ne(l);c=Zr(A,"path",{d:!0,transform:!0}),Ne(c).forEach(Q),A.forEach(Q),f=dt(w),w.forEach(Q),this.h()},h(){fe(c,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),fe(c,"transform","translate(-5.02 -1.59)"),fe(l,"class","ons-svg-icon svelte-w4p0hu"),fe(l,"viewBox","0 0 8 13"),fe(l,"xmlns","http://www.w3.org/2000/svg"),fe(l,"focusable","false"),fe(r,"class","ons-breadcrumb__item ons-u-p-no")},m(v,w){Ie(v,r,w),m.m(r,null),ke(r,o),ke(r,l),ke(l,c),ke(r,f)},p(v,w){n===(n=d(v))&&m?m.p(v,w):(m.d(1),m=n(v),m&&(m.c(),m.m(r,o)))},d(v){v&&Q(r),m.d()}}}function Ny(u){let r,o,l=u[0],c=[];for(let f=0;f<l.length;f+=1)c[f]=zd(Pd(u,l,f));return{c(){r=Be("nav"),o=Be("ol");for(let f=0;f<c.length;f+=1)c[f].c();this.h()},l(f){r=Re(f,"NAV",{class:!0,"aria-label":!0});var d=Ne(r);o=Re(d,"OL",{class:!0});var n=Ne(o);for(let m=0;m<c.length;m+=1)c[m].l(n);n.forEach(Q),d.forEach(Q),this.h()},h(){fe(o,"class","ons-breadcrumb__items ons-u-fs-s"),fe(r,"class","ons-breadcrumb print--hide"),fe(r,"aria-label","Breadcrumbs")},m(f,d){Ie(f,r,d),ke(r,o);for(let n=0;n<c.length;n+=1)c[n]&&c[n].m(o,null)},p(f,d){if(d&1){l=f[0];let n;for(n=0;n<l.length;n+=1){const m=Pd(f,l,n);c[n]?c[n].p(m,d):(c[n]=zd(m),c[n].c(),c[n].m(o,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=l.length}},d(f){f&&Q(r),zn(c,f)}}}function Uy(u){let r,o;return r=new fl({props:{theme:u[2],themeOverrides:u[3],width:u[1],background:u[4],$$slots:{default:[Ny]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,[c]){const f={};c&4&&(f.theme=l[2]),c&8&&(f.themeOverrides=l[3]),c&2&&(f.width=l[1]),c&16&&(f.background=l[4]),c&257&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Vy(u,r,o){let{links:l=[]}=r,{width:c="wide"}=r,{theme:f=null}=r,{themeOverrides:d=null}=r,{background:n=null}=r;return u.$$set=m=>{"links"in m&&o(0,l=m.links),"width"in m&&o(1,c=m.width),"theme"in m&&o(2,f=m.theme),"themeOverrides"in m&&o(3,d=m.themeOverrides),"background"in m&&o(4,n=m.background)},[l,c,f,d,n]}class Gy extends Vi{constructor(r){super(),Gi(this,r,Vy,Uy,Li,{links:0,width:1,theme:2,themeOverrides:3,background:4})}}function Md(u){let r,o;return{c(){r=Be("h2"),o=xt(u[3]),this.h()},l(l){r=Re(l,"H2",{class:!0});var c=Ne(r);o=wt(c,u[3]),c.forEach(Q),this.h()},h(){fe(r,"class","section-title"),qt(r,"ons-u-vh",u[4])},m(l,c){Ie(l,r,c),ke(r,o)},p(l,c){c&8&&_i(o,l[3]),c&16&&qt(r,"ons-u-vh",l[4])},d(l){l&&Q(r)}}}function jy(u){let r,o,l,c=u[3]&&Md(u);const f=u[18].default,d=An(f,u,u[20],null);return{c(){c&&c.c(),r=ft(),o=Be("div"),d&&d.c(),this.h()},l(n){c&&c.l(n),r=dt(n),o=Re(n,"DIV",{class:!0});var m=Ne(o);d&&d.l(m),m.forEach(Q),this.h()},h(){fe(o,"class","grid "+u[12]+" svelte-1og4gya"),yt(o,"grid-gap",u[14]),yt(o,"min-height",u[13])},m(n,m){c&&c.m(n,m),Ie(n,r,m),Ie(n,o,m),d&&d.m(o,null),l=!0},p(n,m){n[3]?c?c.p(n,m):(c=Md(n),c.c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null),d&&d.p&&(!l||m&1048576)&&Cn(d,f,n,n[20],l?Pn(f,n[20],m,null):In(n[20]),null)},i(n){l||(De(d,n),l=!0)},o(n){Xe(d,n),l=!1},d(n){c&&c.d(n),n&&Q(r),n&&Q(o),d&&d.d(n)}}}function Dd(u){let r,o,l;return o=new fl({props:{cls:u[1],theme:u[5],themeOverrides:u[6],width:"narrow",marginBottom:u[8],$$slots:{default:[qy]},$$scope:{ctx:u}}}),{c(){r=Be("figcaption"),Kt(o.$$.fragment),this.h()},l(c){r=Re(c,"FIGCAPTION",{class:!0});var f=Ne(r);ei(o.$$.fragment,f),f.forEach(Q),this.h()},h(){fe(r,"class","svelte-1og4gya")},m(c,f){Ie(c,r,f),Jt(o,r,null),l=!0},p(c,f){const d={};f&2&&(d.cls=c[1]),f&32&&(d.theme=c[5]),f&64&&(d.themeOverrides=c[6]),f&256&&(d.marginBottom=c[8]),f&1049088&&(d.$$scope={dirty:f,ctx:c}),o.$set(d)},i(c){l||(De(o.$$.fragment,c),l=!0)},o(c){Xe(o.$$.fragment,c),l=!1},d(c){c&&Q(r),Yt(o)}}}function qy(u){let r;return{c(){r=Be("span"),this.h()},l(o){r=Re(o,"SPAN",{class:!0});var l=Ne(r);l.forEach(Q),this.h()},h(){fe(r,"class","ons-figure__caption")},m(o,l){Ie(o,r,l),r.innerHTML=u[9]},p(o,l){l&512&&(r.innerHTML=o[9])},d(o){o&&Q(r)}}}function Zy(u){let r,o,l,c,f;o=new fl({props:{id:u[0],cls:u[1],theme:u[5],themeOverrides:u[6],width:u[2],height:["tall","full"].includes(u[10])?u[10]:"auto",marginTop:u[7],marginBottom:u[9]?!1:u[8],$$slots:{default:[jy]},$$scope:{ctx:u}}});let d=u[9]&&Dd(u);return{c(){r=Be("figure"),Kt(o.$$.fragment),l=ft(),d&&d.c(),this.h()},l(n){r=Re(n,"FIGURE",{"aria-label":!0,class:!0});var m=Ne(r);ei(o.$$.fragment,m),l=dt(m),d&&d.l(m),m.forEach(Q),this.h()},h(){fe(r,"aria-label",u[9]),fe(r,"class","svelte-1og4gya"),jm(()=>u[19].call(r))},m(n,m){Ie(n,r,m),Jt(o,r,null),ke(r,l),d&&d.m(r,null),c=qm(r,u[19].bind(r)),f=!0},p(n,[m]){const v={};m&1&&(v.id=n[0]),m&2&&(v.cls=n[1]),m&32&&(v.theme=n[5]),m&64&&(v.themeOverrides=n[6]),m&4&&(v.width=n[2]),m&1024&&(v.height=["tall","full"].includes(n[10])?n[10]:"auto"),m&128&&(v.marginTop=n[7]),m&768&&(v.marginBottom=n[9]?!1:n[8]),m&1048600&&(v.$$scope={dirty:m,ctx:n}),o.$set(v),n[9]?d?(d.p(n,m),m&512&&De(d,1)):(d=Dd(n),d.c(),De(d,1),d.m(r,null)):d&&(Ii(),Xe(d,1,1,()=>{d=null}),Pi()),(!f||m&512)&&fe(r,"aria-label",n[9])},i(n){f||(De(o.$$.fragment,n),De(d),f=!0)},o(n){Xe(o.$$.fragment,n),Xe(d),f=!1},d(n){n&&Q(r),Yt(o),d&&d.d(),c()}}}function Hy(u,r,o){let l,{$$slots:c={},$$scope:f}=r,{id:d=null}=r,{cls:n=null}=r,{width:m="medium"}=r,{title:v=""}=r,{hideTitle:w=!1}=r,{theme:A=null}=r,{themeOverrides:b=null}=r,{marginTop:E=!1}=r,{marginBottom:T=!0}=r,{colwidth:C="medium"}=r,{caption:z=""}=r,{height:B=200}=r,{gap:O=12}=r,W=!C||C==="full"?"":`grid-${C}`,q=B==="full"?"100vh":Number.isNaN(B)?B:B+"px",Z=Number.isNaN(O)?O:O+"px";const ae={narrow:{w:180,c:4},medium:{w:280,c:3},wide:{w:400,c:2},full:{w:"100%",c:1}};let J;const he=Ym(ae[C].c);_o("cols",he);function we(){J=this.clientWidth,o(11,J)}return u.$$set=Se=>{"id"in Se&&o(0,d=Se.id),"cls"in Se&&o(1,n=Se.cls),"width"in Se&&o(2,m=Se.width),"title"in Se&&o(3,v=Se.title),"hideTitle"in Se&&o(4,w=Se.hideTitle),"theme"in Se&&o(5,A=Se.theme),"themeOverrides"in Se&&o(6,b=Se.themeOverrides),"marginTop"in Se&&o(7,E=Se.marginTop),"marginBottom"in Se&&o(8,T=Se.marginBottom),"colwidth"in Se&&o(15,C=Se.colwidth),"caption"in Se&&o(9,z=Se.caption),"height"in Se&&o(10,B=Se.height),"gap"in Se&&o(16,O=Se.gap),"$$scope"in Se&&o(20,f=Se.$$scope)},u.$$.update=()=>{u.$$.dirty&100352&&o(17,l=C=="full"?1:J?Math.floor((J+O)/(ae[C].w+O)):ae[C].c),u.$$.dirty&131072&&he.set(l)},[d,n,m,v,w,A,b,E,T,z,B,J,W,q,Z,C,O,l,c,we,f]}class Wy extends Vi{constructor(r){super(),Gi(this,r,Hy,Zy,Li,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:15,caption:9,height:10,gap:16})}}function Xy(u){let r;const o=u[13].default,l=An(o,u,u[14],null);return{c(){l&&l.c()},l(c){l&&l.l(c)},m(c,f){l&&l.m(c,f),r=!0},p(c,f){l&&l.p&&(!r||f&16384)&&Cn(l,o,c,c[14],r?Pn(o,c[14],f,null):In(c[14]),null)},i(c){r||(De(l,c),r=!0)},o(c){Xe(l,c),r=!1},d(c){l&&l.d(c)}}}function Ky(u){let r,o;return r=new Wy({props:{id:u[0],cls:u[1],width:u[2],height:u[10],title:u[3],hideTitle:u[4],theme:u[5],themeOverrides:u[6],marginTop:u[7],marginBottom:u[8],colwidth:u[9],gap:u[11],$$slots:{default:[Xy]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,[c]){const f={};c&1&&(f.id=l[0]),c&2&&(f.cls=l[1]),c&4&&(f.width=l[2]),c&1024&&(f.height=l[10]),c&8&&(f.title=l[3]),c&16&&(f.hideTitle=l[4]),c&32&&(f.theme=l[5]),c&64&&(f.themeOverrides=l[6]),c&128&&(f.marginTop=l[7]),c&256&&(f.marginBottom=l[8]),c&512&&(f.colwidth=l[9]),c&2048&&(f.gap=l[11]),c&16384&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Jy(u,r,o){let{$$slots:l={},$$scope:c}=r,{id:f=null}=r,{cls:d="ons-cards"}=r,{width:n="wide"}=r,{title:m=""}=r,{hideTitle:v=!1}=r,{theme:w=null}=r,{themeOverrides:A=null}=r,{marginTop:b=!1}=r,{marginBottom:E=!0}=r,{colwidth:T="medium"}=r,{height:C=200}=r,{noBackground:z=!1}=r,{gap:B=z?36:16}=r;return _o("noBackground",z),u.$$set=O=>{"id"in O&&o(0,f=O.id),"cls"in O&&o(1,d=O.cls),"width"in O&&o(2,n=O.width),"title"in O&&o(3,m=O.title),"hideTitle"in O&&o(4,v=O.hideTitle),"theme"in O&&o(5,w=O.theme),"themeOverrides"in O&&o(6,A=O.themeOverrides),"marginTop"in O&&o(7,b=O.marginTop),"marginBottom"in O&&o(8,E=O.marginBottom),"colwidth"in O&&o(9,T=O.colwidth),"height"in O&&o(10,C=O.height),"noBackground"in O&&o(12,z=O.noBackground),"gap"in O&&o(11,B=O.gap),"$$scope"in O&&o(14,c=O.$$scope)},[f,d,n,m,v,w,A,b,E,T,C,B,z,l,c]}class qh extends Vi{constructor(r){super(),Gi(this,r,Jy,Ky,Li,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:9,height:10,noBackground:12,gap:11})}}const Ld=()=>Math.random().toString(16).slice(2,8),Yy=(u,r=!1)=>typeof u=="string"?u.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").concat(r?`-${Ld()}`:""):Ld(),Qy=u=>{if(!u)return!1;const r=new Date(u);return!isNaN(r)},Bd=(u,r="en-GB",o={year:"numeric",month:"long",day:"2-digit"})=>new Date(u).toLocaleDateString(r,o);function $y(u){let r,o;return{c(){r=Be("h3"),o=xt(u[0]),this.h()},l(l){r=Re(l,"H3",{class:!0});var c=Ne(r);o=wt(c,u[0]),c.forEach(Q),this.h()},h(){fe(r,"class","ons-card__title ons-u-fs-m"),qt(r,"ons-u-vh",u[2]),yt(r,"padding",u[8]?"":"8px 16px 0"),yt(r,"margin-bottom","5px")},m(l,c){Ie(l,r,c),ke(r,o)},p(l,c){c&1&&_i(o,l[0]),c&4&&qt(r,"ons-u-vh",l[2]),c&256&&yt(r,"padding",l[8]?"":"8px 16px 0")},d(l){l&&Q(r)}}}function e1(u){let r,o,l,c,f=u[3]&&Rd(u);return{c(){r=Be("a"),f&&f.c(),o=ft(),l=Be("h3"),c=xt(u[0]),this.h()},l(d){r=Re(d,"A",{href:!0,class:!0});var n=Ne(r);f&&f.l(n),o=dt(n),l=Re(n,"H3",{class:!0});var m=Ne(l);c=wt(m,u[0]),m.forEach(Q),n.forEach(Q),this.h()},h(){fe(l,"class","ons-card__title ons-u-fs-m"),yt(l,"padding",!u[8]&&!u[3]?"12px 16px 0":u[8]?"":"0 16px"),fe(r,"href",u[5]),fe(r,"class","ons-card__link ons-u-db"),qt(r,"ons-u-vh",u[2])},m(d,n){Ie(d,r,n),f&&f.m(r,null),ke(r,o),ke(r,l),ke(l,c)},p(d,n){d[3]?f?f.p(d,n):(f=Rd(d),f.c(),f.m(r,o)):f&&(f.d(1),f=null),n&1&&_i(c,d[0]),n&264&&yt(l,"padding",!d[8]&&!d[3]?"12px 16px 0":d[8]?"":"0 16px"),n&32&&fe(r,"href",d[5]),n&4&&qt(r,"ons-u-vh",d[2])},d(d){d&&Q(r),f&&f.d()}}}function Rd(u){let r,o;return{c(){r=Be("img"),this.h()},l(l){r=Re(l,"IMG",{class:!0,src:!0,alt:!0,loading:!0}),this.h()},h(){fe(r,"class","ons-card__image ons-u-mb-s svelte-k1nrya"),Mc(r.src,o=u[3])||fe(r,"src",o),fe(r,"alt",u[4]),fe(r,"loading","lazy"),yt(r,"width","100%")},m(l,c){Ie(l,r,c)},p(l,c){c&8&&!Mc(r.src,o=l[3])&&fe(r,"src",o),c&16&&fe(r,"alt",l[4])},d(l){l&&Q(r)}}}function t1(u){let r,o,l,c,f,d,n,m=`span ${u[9]&&u[10]<3?u[10]:u[6]==1?1:u[6]>u[10]?u[10]:u[6]}`,v;function w(C,z){if(C[5]&&C[0])return e1;if(C[0])return $y}let A=w(u),b=A&&A(u);const E=u[13].default,T=An(E,u,u[12],null);return{c(){r=Be("div"),o=Be("div"),b&&b.c(),l=ft(),c=Be("div"),T&&T.c(),this.h()},l(C){r=Re(C,"DIV",{class:!0});var z=Ne(r);o=Re(z,"DIV",{id:!0,class:!0,"aria-describedby":!0});var B=Ne(o);b&&b.l(B),l=dt(B),c=Re(B,"DIV",{id:!0,class:!0});var O=Ne(c);T&&T.l(O),O.forEach(Q),B.forEach(Q),z.forEach(Q),this.h()},h(){fe(c,"id",f=u[1]+"_text"),fe(c,"class","svelte-k1nrya"),qt(c,"tile__body",!u[8]),fe(o,"id",u[1]),fe(o,"class","ons-card"),fe(o,"aria-describedby",d=u[1]+"_text"),fe(r,"class",n=zc(u[8]?"":"tile tile__content")+" svelte-k1nrya"),yt(r,"grid-column",m),yt(r,"grid-column-end",u[9]?u[10]+1:null),yt(r,"grid-row",u[7]>1?`span ${u[7]}`:null)},m(C,z){Ie(C,r,z),ke(r,o),b&&b.m(o,null),ke(o,l),ke(o,c),T&&T.m(c,null),v=!0},p(C,[z]){A===(A=w(C))&&b?b.p(C,z):(b&&b.d(1),b=A&&A(C),b&&(b.c(),b.m(o,l))),T&&T.p&&(!v||z&4096)&&Cn(T,E,C,C[12],v?Pn(E,C[12],z,null):In(C[12]),null),(!v||z&2&&f!==(f=C[1]+"_text"))&&fe(c,"id",f),(!v||z&256)&&qt(c,"tile__body",!C[8]),(!v||z&2)&&fe(o,"id",C[1]),(!v||z&2&&d!==(d=C[1]+"_text"))&&fe(o,"aria-describedby",d),(!v||z&256&&n!==(n=zc(C[8]?"":"tile tile__content")+" svelte-k1nrya"))&&fe(r,"class",n),z&1600&&m!==(m=`span ${C[9]&&C[10]<3?C[10]:C[6]==1?1:C[6]>C[10]?C[10]:C[6]}`)&&yt(r,"grid-column",m),z&1536&&yt(r,"grid-column-end",C[9]?C[10]+1:null),z&128&&yt(r,"grid-row",C[7]>1?`span ${C[7]}`:null)},i(C){v||(De(T,C),v=!0)},o(C){Xe(T,C),v=!1},d(C){C&&Q(r),b&&b.d(),T&&T.d(C)}}}function i1(u,r,o){let l,{$$slots:c={},$$scope:f}=r,{title:d=null}=r,{id:n=Yy(d)}=r,{hideTitle:m=!1}=r,{image:v=null}=r,{imageAlt:w=null}=r,{href:A=null}=r,{colspan:b=1}=r,{rowspan:E=1}=r,{noBackground:T=yo("noBackground")||!1}=r,{grow:C=!1}=r;const z=yo("cols");return Nc(u,z,B=>o(10,l=B)),u.$$set=B=>{"title"in B&&o(0,d=B.title),"id"in B&&o(1,n=B.id),"hideTitle"in B&&o(2,m=B.hideTitle),"image"in B&&o(3,v=B.image),"imageAlt"in B&&o(4,w=B.imageAlt),"href"in B&&o(5,A=B.href),"colspan"in B&&o(6,b=B.colspan),"rowspan"in B&&o(7,E=B.rowspan),"noBackground"in B&&o(8,T=B.noBackground),"grow"in B&&o(9,C=B.grow),"$$scope"in B&&o(12,f=B.$$scope)},[d,n,m,v,w,A,b,E,T,C,l,z,f,c]}class ps extends Vi{constructor(r){super(),Gi(this,r,i1,t1,Li,{title:0,id:1,hideTitle:2,image:3,imageAlt:4,href:5,colspan:6,rowspan:7,noBackground:8,grow:9})}}function Od(u){let r,o;return{c(){r=Be("div"),o=xt("!"),this.h()},l(l){r=Re(l,"DIV",{class:!0,"aria-hidden":!0});var c=Ne(r);o=wt(c,"!"),c.forEach(Q),this.h()},h(){fe(r,"class","ons-panel__icon"),fe(r,"aria-hidden","true")},m(l,c){Ie(l,r,c),ke(r,o)},d(l){l&&Q(r)}}}function Fd(u){let r,o,l;return{c(){r=Be("p"),o=Be("strong"),l=xt(u[0])},l(c){r=Re(c,"P",{});var f=Ne(r);o=Re(f,"STRONG",{});var d=Ne(o);l=wt(d,u[0]),d.forEach(Q),f.forEach(Q)},m(c,f){Ie(c,r,f),ke(r,o),ke(o,l)},p(c,f){f&1&&_i(l,c[0])},d(c){c&&Q(r)}}}function n1(u){let r,o,l,c,f,d,n,m,v,w,A,b=u[1]&&Od(),E=u[0]&&Fd(u);const T=u[5].default,C=An(T,u,u[4],null);return{c(){r=Be("div"),o=Be("div"),b&&b.c(),l=ft(),c=Be("span"),f=xt("Important information:"),d=ft(),n=Be("div"),m=Be("div"),E&&E.c(),v=ft(),w=Be("p"),C&&C.c(),this.h()},l(z){r=Re(z,"DIV",{class:!0,style:!0});var B=Ne(r);o=Re(B,"DIV",{class:!0});var O=Ne(o);b&&b.l(O),l=dt(O),c=Re(O,"SPAN",{class:!0});var W=Ne(c);f=wt(W,"Important information:"),W.forEach(Q),d=dt(O),n=Re(O,"DIV",{class:!0});var q=Ne(n);m=Re(q,"DIV",{class:!0});var Z=Ne(m);E&&E.l(Z),v=dt(Z),w=Re(Z,"P",{class:!0});var ae=Ne(w);C&&C.l(ae),ae.forEach(Q),Z.forEach(Q),q.forEach(Q),O.forEach(Q),B.forEach(Q),this.h()},h(){fe(c,"class","ons-panel__assistive-text ons-u-vh"),fe(w,"class","ons-u-mb-no"),fe(m,"class","ons-u-fs-r default-line-height"),fe(n,"class","ons-panel__body"),fe(o,"class","ons-u-bg--tr"),qt(o,"ons-panel--warn",u[1]),fe(r,"class","ons-panel ons-panel--info ons-panel--no-title ons-u-mt-m ons-u-mb-l svelte-g4zlbx"),fe(r,"style",u[2])},m(z,B){Ie(z,r,B),ke(r,o),b&&b.m(o,null),ke(o,l),ke(o,c),ke(c,f),ke(o,d),ke(o,n),ke(n,m),E&&E.m(m,null),ke(m,v),ke(m,w),C&&C.m(w,null),A=!0},p(z,[B]){z[1]?b||(b=Od(),b.c(),b.m(o,l)):b&&(b.d(1),b=null),z[0]?E?E.p(z,B):(E=Fd(z),E.c(),E.m(m,v)):E&&(E.d(1),E=null),C&&C.p&&(!A||B&16)&&Cn(C,T,z,z[4],A?Pn(T,z[4],B,null):In(z[4]),null),(!A||B&2)&&qt(o,"ons-panel--warn",z[1]),(!A||B&4)&&fe(r,"style",z[2])},i(z){A||(De(C,z),A=!0)},o(z){Xe(C,z),A=!1},d(z){z&&Q(r),b&&b.d(),E&&E.d(),C&&C.d(z)}}}function r1(u,r,o){let l,{$$slots:c={},$$scope:f}=r,{title:d=null}=r,{important:n=!1}=r,{mode:m="info"}=r;return u.$$set=v=>{"title"in v&&o(0,d=v.title),"important"in v&&o(1,n=v.important),"mode"in v&&o(3,m=v.mode),"$$scope"in v&&o(4,f=v.$$scope)},u.$$.update=()=>{u.$$.dirty&8&&o(2,l=m==="success"?"background: var(--ons-color-success-tint); border-color: var(--ons-color-success);":m==="pending"?"background: var(--ons-color-pending-tint); border-color: var(--ons-color-pending);":m==="error"?"background: var(--ons-color-errors-tint); border-color: var(--ons-color-errors);":null)},[d,n,l,m,f,c]}class $m extends Vi{constructor(r){super(),Gi(this,r,r1,n1,Li,{title:0,important:1,mode:3})}}function Nd(u,r,o){const l=u.slice();return l[1]=r[o],l[3]=o,l}function Ud(u){let r,o=u[0],l=[];for(let c=0;c<o.length;c+=1)l[c]=Gd(Nd(u,o,c));return{c(){r=Be("dl");for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){r=Re(c,"DL",{class:!0,title:!0,"aria-label":!0});var f=Ne(r);for(let d=0;d<l.length;d+=1)l[d].l(f);f.forEach(Q),this.h()},h(){fe(r,"class","ons-metadata metadata__list ons-grid ons-grid--gutterless ons-u-cf ons-u-mb-m"),fe(r,"title","Dataset ID and release date information"),fe(r,"aria-label","Dataset ID and release date information")},m(c,f){Ie(c,r,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(r,null)},p(c,f){if(f&1){o=c[0];let d;for(d=0;d<o.length;d+=1){const n=Nd(c,o,d);l[d]?l[d].p(n,f):(l[d]=Gd(n),l[d].c(),l[d].m(r,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=o.length}},d(c){c&&Q(r),zn(l,c)}}}function s1(u){let r,o=u[1].value+"",l;return{c(){r=new Zm(!1),l=jt(),this.h()},l(c){r=Hm(c,!1),l=jt(),this.h()},h(){r.a=l},m(c,f){r.m(o,c,f),Ie(c,l,f)},p(c,f){f&1&&o!==(o=c[1].value+"")&&r.p(o)},d(c){c&&Q(l),c&&r.d()}}}function o1(u){let r,o=Bd(u[1].value)+"",l,c,f,d,n=u[1].extra&&Vd(u);return{c(){r=Be("time"),l=xt(o),f=ft(),n&&n.c(),d=jt(),this.h()},l(m){r=Re(m,"TIME",{datetime:!0});var v=Ne(r);l=wt(v,o),v.forEach(Q),f=dt(m),n&&n.l(m),d=jt(),this.h()},h(){fe(r,"datetime",c=new Date(u[1].value).toISOString())},m(m,v){Ie(m,r,v),ke(r,l),Ie(m,f,v),n&&n.m(m,v),Ie(m,d,v)},p(m,v){v&1&&o!==(o=Bd(m[1].value)+"")&&_i(l,o),v&1&&c!==(c=new Date(m[1].value).toISOString())&&fe(r,"datetime",c),m[1].extra?n?n.p(m,v):(n=Vd(m),n.c(),n.m(d.parentNode,d)):n&&(n.d(1),n=null)},d(m){m&&Q(r),m&&Q(f),n&&n.d(m),m&&Q(d)}}}function Vd(u){let r,o=u[1].extra+"",l;return{c(){r=new Zm(!1),l=jt(),this.h()},l(c){r=Hm(c,!1),l=jt(),this.h()},h(){r.a=l},m(c,f){r.m(o,c,f),Ie(c,l,f)},p(c,f){f&1&&o!==(o=c[1].extra+"")&&r.p(o)},d(c){c&&Q(l),c&&r.d()}}}function Gd(u){let r,o,l=u[1].key+"",c,f,d,n,m,v,w;function A(T,C){return C&1&&(m=null),m==null&&(m=!!Qy(T[1].value)),m?o1:s1}let b=A(u,-1),E=b(u);return{c(){r=Be("div"),o=Be("dt"),c=xt(l),f=xt(":"),d=ft(),n=Be("dd"),E.c(),v=ft(),this.h()},l(T){r=Re(T,"DIV",{class:!0});var C=Ne(r);o=Re(C,"DT",{class:!0});var z=Ne(o);c=wt(z,l),f=wt(z,":"),z.forEach(Q),d=dt(C),n=Re(C,"DD",{class:!0});var B=Ne(n);E.l(B),B.forEach(Q),v=dt(C),C.forEach(Q),this.h()},h(){fe(o,"class","ons-metadata__term ons-u-mr-xs"),fe(n,"class","ons-metadata__value ons-u-f-no"),fe(r,"class",w="ons-grid__col ons-col-"+(u[1].col?u[1].col:12)+"@m"),qt(r,"ons-u-mt-xs",u[3]!==0)},m(T,C){Ie(T,r,C),ke(r,o),ke(o,c),ke(o,f),ke(r,d),ke(r,n),E.m(n,null),ke(r,v)},p(T,C){C&1&&l!==(l=T[1].key+"")&&_i(c,l),b===(b=A(T,C))&&E?E.p(T,C):(E.d(1),E=b(T),E&&(E.c(),E.m(n,null))),C&1&&w!==(w="ons-grid__col ons-col-"+(T[1].col?T[1].col:12)+"@m")&&fe(r,"class",w),C&1&&qt(r,"ons-u-mt-xs",T[3]!==0)},d(T){T&&Q(r),E.d()}}}function a1(u){let r=Array.isArray(u[0]),o,l=r&&Ud(u);return{c(){l&&l.c(),o=jt()},l(c){l&&l.l(c),o=jt()},m(c,f){l&&l.m(c,f),Ie(c,o,f)},p(c,[f]){f&1&&(r=Array.isArray(c[0])),r?l?l.p(c,f):(l=Ud(c),l.c(),l.m(o.parentNode,o)):l&&(l.d(1),l=null)},i:ci,o:ci,d(c){l&&l.d(c),c&&Q(o)}}}function l1(u,r,o){let{meta:l=null}=r;return u.$$set=c=>{"meta"in c&&o(0,l=c.meta)},[l]}class c1 extends Vi{constructor(r){super(),Gi(this,r,l1,a1,Li,{meta:0})}}const u1=u=>({}),jd=u=>({}),h1=u=>({}),qd=u=>({}),f1=u=>({}),Zd=u=>({});function Hd(u){let r,o,l,c,f;return{c(){r=Be("div"),o=Be("div"),l=Be("a"),c=Be("img"),this.h()},l(d){r=Re(d,"DIV",{class:!0});var n=Ne(r);o=Re(n,"DIV",{class:!0});var m=Ne(o);l=Re(m,"A",{href:!0,class:!0});var v=Ne(l);c=Re(v,"IMG",{src:!0,alt:!0,class:!0}),v.forEach(Q),m.forEach(Q),n.forEach(Q),this.h()},h(){Mc(c.src,f="//cdn.ons.gov.uk/assets/images/ons-logo/kitemark/uksa-kitemark.svg")||fe(c,"src",f),fe(c,"alt","UK Statistics Authority Kitemark"),fe(c,"class","national-statistics__logo"),fe(l,"href","https://uksa.statisticsauthority.gov.uk/about-the-authority/uk-statistical-system/types-of-official-statistics/"),fe(l,"class","national-statistics__link ons-u-fs-xxxl"),fe(o,"class","ons-grid--flex ons-grid--between@m ons-u-mt-s@m ons-u-mb-m@xxs ons-u-flex-jc-fe@m"),fe(r,"class","ons-grid__col ons-col-2@m svelte-lohx48")},m(d,n){Ie(d,r,n),ke(r,o),ke(o,l),ke(l,c)},d(d){d&&Q(r)}}}function Wd(u){let r,o,l,c;return{c(){r=Be("div"),o=Be("div"),l=Be("img"),this.h()},l(f){r=Re(f,"DIV",{class:!0});var d=Ne(r);o=Re(d,"DIV",{class:!0});var n=Ne(o);l=Re(n,"IMG",{src:!0,title:!0,alt:!0,class:!0,focusable:!0,width:!0,height:!0}),n.forEach(Q),d.forEach(Q),this.h()},h(){Mc(l.src,c="https://cdn.ons.gov.uk/assets/images/census-logo/logo-census-2021-purple-landscape.svg")||fe(l,"src",c),fe(l,"title","Census 2021"),fe(l,"alt","Census 2021"),fe(l,"class","header__svg-logo margin-right--1"),fe(l,"focusable","false"),fe(l,"width","167"),fe(l,"height","32"),fe(o,"class","ons-grid__col svelte-lohx48"),fe(r,"class","ons-grid ons-u-mb-m")},m(f,d){Ie(f,r,d),ke(r,o),ke(o,l)},d(f){f&&Q(r)}}}function d1(u){let r,o,l,c,f,d,n,m,v,w,A,b,E;const T=u[7].before,C=An(T,u,u[8],Zd);let z=u[1]&&Hd();const B=u[7].brand,O=An(B,u,u[8],qd);let W=u[2]&&Wd();A=new c1({props:{meta:u[3]}});const q=u[7].after,Z=An(q,u,u[8],jd);return{c(){r=Be("section"),C&&C.c(),o=ft(),l=Be("div"),c=Be("div"),f=Be("h1"),d=xt(u[0]),n=ft(),z&&z.c(),m=ft(),O&&O.c(),v=ft(),W&&W.c(),w=ft(),Kt(A.$$.fragment),b=ft(),Z&&Z.c(),this.h()},l(ae){r=Re(ae,"SECTION",{class:!0});var J=Ne(r);C&&C.l(J),o=dt(J),l=Re(J,"DIV",{class:!0});var he=Ne(l);c=Re(he,"DIV",{class:!0});var we=Ne(c);f=Re(we,"H1",{class:!0});var Se=Ne(f);d=wt(Se,u[0]),Se.forEach(Q),we.forEach(Q),n=dt(he),z&&z.l(he),he.forEach(Q),m=dt(J),O&&O.l(J),v=dt(J),W&&W.l(J),w=dt(J),ei(A.$$.fragment,J),b=dt(J),Z&&Z.l(J),J.forEach(Q),this.h()},h(){fe(f,"class","ons-u-fs-xxxl ons-u-mt-s ons-u-mb-m ons-u-pb-no ons-u-pt-no"),fe(c,"class","ons-grid__col ons-col-10@m svelte-lohx48"),fe(l,"class","ons-grid"),fe(r,"class","ons-u-mb-xl")},m(ae,J){Ie(ae,r,J),C&&C.m(r,null),ke(r,o),ke(r,l),ke(l,c),ke(c,f),ke(f,d),ke(l,n),z&&z.m(l,null),ke(r,m),O&&O.m(r,null),ke(r,v),W&&W.m(r,null),ke(r,w),Jt(A,r,null),ke(r,b),Z&&Z.m(r,null),E=!0},p(ae,J){C&&C.p&&(!E||J&256)&&Cn(C,T,ae,ae[8],E?Pn(T,ae[8],J,f1):In(ae[8]),Zd),(!E||J&1)&&_i(d,ae[0]),ae[1]?z||(z=Hd(),z.c(),z.m(l,null)):z&&(z.d(1),z=null),O&&O.p&&(!E||J&256)&&Cn(O,B,ae,ae[8],E?Pn(B,ae[8],J,h1):In(ae[8]),qd),ae[2]?W||(W=Wd(),W.c(),W.m(r,w)):W&&(W.d(1),W=null);const he={};J&8&&(he.meta=ae[3]),A.$set(he),Z&&Z.p&&(!E||J&256)&&Cn(Z,q,ae,ae[8],E?Pn(q,ae[8],J,u1):In(ae[8]),jd)},i(ae){E||(De(C,ae),De(O,ae),De(A.$$.fragment,ae),De(Z,ae),E=!0)},o(ae){Xe(C,ae),Xe(O,ae),Xe(A.$$.fragment,ae),Xe(Z,ae),E=!1},d(ae){ae&&Q(r),C&&C.d(ae),z&&z.d(),O&&O.d(ae),W&&W.d(),Yt(A),Z&&Z.d(ae)}}}function p1(u){let r,o;return r=new fl({props:{theme:u[4],themeOverrides:u[5],background:u[6],$$slots:{default:[d1]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,[c]){const f={};c&16&&(f.theme=l[4]),c&32&&(f.themeOverrides=l[5]),c&64&&(f.background=l[6]),c&271&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function m1(u,r,o){let{$$slots:l={},$$scope:c}=r,{title:f="Page title"}=r,{natStatBadge:d=!1}=r,{censusLogo:n=!1}=r,{meta:m=null}=r,{theme:v=null}=r,{themeOverrides:w=null}=r,{background:A=null}=r;return u.$$set=b=>{"title"in b&&o(0,f=b.title),"natStatBadge"in b&&o(1,d=b.natStatBadge),"censusLogo"in b&&o(2,n=b.censusLogo),"meta"in b&&o(3,m=b.meta),"theme"in b&&o(4,v=b.theme),"themeOverrides"in b&&o(5,w=b.themeOverrides),"background"in b&&o(6,A=b.background),"$$scope"in b&&o(8,c=b.$$scope)},[f,d,n,m,v,w,A,l,c]}class g1 extends Vi{constructor(r){super(),Gi(this,r,m1,p1,Li,{title:0,natStatBadge:1,censusLogo:2,meta:3,theme:4,themeOverrides:5,background:6})}}function _1(u){let r,o,l,c,f,d,n,m,v,w,A,b;const E=u[3].default,T=An(E,u,u[2],null);return{c(){r=Be("details"),o=Be("summary"),l=Be("h3"),c=xt(u[0]),f=ft(),d=Be("span"),n=qr("svg"),m=qr("path"),w=ft(),A=Be("div"),T&&T.c(),this.h()},l(C){r=Re(C,"DETAILS",{class:!0});var z=Ne(r);o=Re(z,"SUMMARY",{class:!0,"data-ga-action":!0});var B=Ne(o);l=Re(B,"H3",{class:!0});var O=Ne(l);c=wt(O,u[0]),O.forEach(Q),f=dt(B),d=Re(B,"SPAN",{class:!0});var W=Ne(d);n=Zr(W,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0});var q=Ne(n);m=Zr(q,"path",{d:!0,transform:!0}),Ne(m).forEach(Q),q.forEach(Q),W.forEach(Q),B.forEach(Q),w=dt(z),A=Re(z,"DIV",{class:!0});var Z=Ne(A);T&&T.l(Z),Z.forEach(Q),z.forEach(Q),this.h()},h(){fe(l,"class","ons-collapsible__title"),fe(m,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),fe(m,"transform","translate(-5.02 -1.59)"),fe(n,"class","ons-svg-icon svelte-1uv81ck"),fe(n,"viewBox","0 0 8 13"),fe(n,"xmlns","http://www.w3.org/2000/svg"),fe(n,"focusable","false"),fe(d,"class","ons-collapsible__icon"),fe(o,"class","ons-collapsible__heading ons-js-collapsible-heading svelte-1uv81ck"),fe(o,"data-ga-action",v=u[1]?"Close panel":"Open panel"),fe(A,"class","ons-collapsible__content ons-js-collapsible-content"),fe(r,"class","ons-collapsible ons-js-collapsible"),r.open=u[1]},m(C,z){Ie(C,r,z),ke(r,o),ke(o,l),ke(l,c),ke(o,f),ke(o,d),ke(d,n),ke(n,m),ke(r,w),ke(r,A),T&&T.m(A,null),b=!0},p(C,[z]){(!b||z&1)&&_i(c,C[0]),(!b||z&2&&v!==(v=C[1]?"Close panel":"Open panel"))&&fe(o,"data-ga-action",v),T&&T.p&&(!b||z&4)&&Cn(T,E,C,C[2],b?Pn(E,C[2],z,null):In(C[2]),null),(!b||z&2)&&(r.open=C[1])},i(C){b||(De(T,C),b=!0)},o(C){Xe(T,C),b=!1},d(C){C&&Q(r),T&&T.d(C)}}}function y1(u,r,o){let{$$slots:l={},$$scope:c}=r,{title:f="Title"}=r,{open:d=!1}=r;return u.$$set=n=>{"title"in n&&o(0,f=n.title),"open"in n&&o(1,d=n.open),"$$scope"in n&&o(2,c=n.$$scope)},[f,d,c,l]}class v1 extends Vi{constructor(r){super(),Gi(this,r,y1,_1,Li,{title:0,open:1})}}function Xd(u){let r,o,l,c;return{c(){r=qr("svg"),o=qr("path"),this.h()},l(f){r=Zr(f,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var d=Ne(r);o=Zr(d,"path",{d:!0}),Ne(o).forEach(Q),d.forEach(Q),this.h()},h(){fe(o,"d",l=u[3][u[0]].d),fe(r,"class","ons-svg-icon"),fe(r,"viewBox",c=u[3][u[0]].viewBox),fe(r,"xmlns","http://www.w3.org/2000/svg"),fe(r,"focusable","false"),fe(r,"fill","currentColor"),qt(r,"ons-u-ml-xs",u[1]),qt(r,"ons-u-mr-xs",u[2])},m(f,d){Ie(f,r,d),ke(r,o)},p(f,d){d&1&&l!==(l=f[3][f[0]].d)&&fe(o,"d",l),d&1&&c!==(c=f[3][f[0]].viewBox)&&fe(r,"viewBox",c),d&2&&qt(r,"ons-u-ml-xs",f[1]),d&4&&qt(r,"ons-u-mr-xs",f[2])},d(f){f&&Q(r)}}}function b1(u){let r,o=u[3][u[0]]&&Xd(u);return{c(){o&&o.c(),r=jt()},l(l){o&&o.l(l),r=jt()},m(l,c){o&&o.m(l,c),Ie(l,r,c)},p(l,[c]){l[3][l[0]]?o?o.p(l,c):(o=Xd(l),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},i:ci,o:ci,d(l){o&&o.d(l),l&&Q(r)}}}function x1(u,r,o){let{type:l="arrow"}=r,{marginLeft:c=!1}=r,{marginRight:f=!1}=r;const d={arrow:{d:"m10 .2-.9.9c-.1.1-.1.4 0 .5l4 4H.6c-.2 0-.4.2-.4.4v1.2c0 .2.2.4.4.4h12.5l-3.9 3.7c-.2.2-.2.4 0 .6l.8.9c.2.2.4.2.6 0L16.8 7c.2-.2.2-.4 0-.6L10.7.3c-.3-.2-.5-.2-.7-.1z",viewBox:"0 0 17 13"},externalLink:{d:"M13.5,9H13a.5.5,0,0,0-.5.5v3h-9v-9h3A.5.5,0,0,0,7,3V2.5A.5.5,0,0,0,6.5,2h-4a.5.5,0,0,0-.5.5v11a.5.5,0,0,0,.5.5h11a.5.5,0,0,0,.5-.5v-4A.5.5,0,0,0,13.5,9Z M8.83,7.88a.51.51,0,0,0,.71,0l2.31-2.32,1.28,1.28A.51.51,0,0,0,14,6.49v-4a.52.52,0,0,0-.5-.5h-4A.51.51,0,0,0,9,2.52a.58.58,0,0,0,.14.33l1.28,1.28L8.12,6.46a.51.51,0,0,0,0,.71Z",viewBox:"2 2 12 12"},signout:{d:"M13.85,7.65l-2.5-2.5a.5.5,0,0,0-.71,0,.48.48,0,0,0-.15.36V7h-3a.5.5,0,0,0-.5.5v1a.5.5,0,0,0,.5.5h3v1.5A.49.49,0,0,0,11,11a.48.48,0,0,0,.34-.14l2.51-2.5a.49.49,0,0,0,0-.68Z M8.5,14h-6a.5.5,0,0,1-.5-.5V2.5A.5.5,0,0,1,2.5,2h6a.5.5,0,0,1,.5.5V3a.5.5,0,0,1-.5.5h-5v9h5A.5.5,0,0,1,9,13v.5A.5.5,0,0,1,8.5,14Z",viewBox:"0 0 12 12"},print:{d:"M17 4H3C1.3 4 0 5.2 0 6.8v5.5h4V16h12v-3.7h4V6.8C20 5.2 18.7 4 17 4zm-3 10H6V9h8v5zm3-6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-1-8H4v3h12V0z",viewBox:"0 0 20 16"},download:{d:"M5.6 9a.48.48 0 0 0 .7 0l3-3.2a.48.48 0 0 0 0-.7C9.3 5 9.2 5 9 5H7.5V.5A.47.47 0 0 0 7 0H5a.47.47 0 0 0-.5.5V5H3a.47.47 0 0 0-.5.5.37.37 0 0 0 .1.3Z M11.5 9H11a.47.47 0 0 0-.5.5v1h-9v-1A.47.47 0 0 0 1 9H.5a.47.47 0 0 0-.5.5v2a.47.47 0 0 0 .5.5h11a.47.47 0 0 0 .5-.5v-2a.47.47 0 0 0-.5-.5Z",viewBox:"0 0 12 12"},tick:{d:"M14.35,3.9l-.71-.71a.5.5,0,0,0-.71,0h0L5.79,10.34,3.07,7.61a.51.51,0,0,0-.71,0l-.71.71a.51.51,0,0,0,0,.71l3.78,3.78a.5.5,0,0,0,.71,0h0L14.35,4.6A.5.5,0,0,0,14.35,3.9Z",viewBox:"1.5 3 13 10"},search:{d:"M11.86 10.23 8.62 6.99a4.63 4.63 0 1 0-6.34 1.64 4.55 4.55 0 0 0 2.36.64 4.65 4.65 0 0 0 2.33-.65l3.24 3.23a.46.46 0 0 0 .65 0l1-1a.48.48 0 0 0 0-.62Zm-5-3.32a3.28 3.28 0 0 1-2.31.93 3.22 3.22 0 1 1 2.35-.93Z",viewBox:"0 0 12 12"}};return u.$$set=n=>{"type"in n&&o(0,l=n.type),"marginLeft"in n&&o(1,c=n.marginLeft),"marginRight"in n&&o(2,f=n.marginRight)},[l,c,f,d]}let jc=class extends Vi{constructor(r){super(),Gi(this,r,x1,b1,Li,{type:0,marginLeft:1,marginRight:2})}};function w1(u){let r,o,l,c,f,d,n,m,v=u[4]&&u[5]==="before"&&Kd(u);const w=u[9].default,A=An(w,u,u[8],null);let b=u[4]&&u[5]==="after"&&Jd(u);return{c(){r=Be("button"),o=Be("span"),v&&v.c(),l=ft(),c=Be("span"),A&&A.c(),f=ft(),b&&b.c(),this.h()},l(E){r=Re(E,"BUTTON",{type:!0,class:!0});var T=Ne(r);o=Re(T,"SPAN",{class:!0});var C=Ne(o);v&&v.l(C),l=dt(C),c=Re(C,"SPAN",{class:!0});var z=Ne(c);A&&A.l(z),z.forEach(Q),f=dt(C),b&&b.l(C),C.forEach(Q),T.forEach(Q),this.h()},h(){fe(c,"class","ons-btn__text"),fe(o,"class","ons-btn__inner"),fe(r,"type",u[0]),fe(r,"class","ons-btn"),r.disabled=u[6],qt(r,"ons-btn--small",u[3]),qt(r,"ons-btn--secondary",u[1]==="secondary"),qt(r,"ons-btn--ghost",u[1]==="ghost"),qt(r,"ons-btn--disabled",u[6])},m(E,T){Ie(E,r,T),ke(r,o),v&&v.m(o,null),ke(o,l),ke(o,c),A&&A.m(c,null),ke(o,f),b&&b.m(o,null),d=!0,n||(m=ms(r,"click",u[11]),n=!0)},p(E,T){E[4]&&E[5]==="before"?v?(v.p(E,T),T&48&&De(v,1)):(v=Kd(E),v.c(),De(v,1),v.m(o,l)):v&&(Ii(),Xe(v,1,1,()=>{v=null}),Pi()),A&&A.p&&(!d||T&256)&&Cn(A,w,E,E[8],d?Pn(w,E[8],T,null):In(E[8]),null),E[4]&&E[5]==="after"?b?(b.p(E,T),T&48&&De(b,1)):(b=Jd(E),b.c(),De(b,1),b.m(o,null)):b&&(Ii(),Xe(b,1,1,()=>{b=null}),Pi()),(!d||T&1)&&fe(r,"type",E[0]),(!d||T&64)&&(r.disabled=E[6]),(!d||T&8)&&qt(r,"ons-btn--small",E[3]),(!d||T&2)&&qt(r,"ons-btn--secondary",E[1]==="secondary"),(!d||T&2)&&qt(r,"ons-btn--ghost",E[1]==="ghost"),(!d||T&64)&&qt(r,"ons-btn--disabled",E[6])},i(E){d||(De(v),De(A,E),De(b),d=!0)},o(E){Xe(v),Xe(A,E),Xe(b),d=!1},d(E){E&&Q(r),v&&v.d(),A&&A.d(E),b&&b.d(),n=!1,m()}}}function k1(u){let r,o,l,c,f,d,n,m,v,w=u[4]&&u[5]==="before"&&Yd(u);const A=u[9].default,b=An(A,u,u[8],null);let E=u[4]&&u[5]==="after"&&Qd(u);return{c(){r=Be("a"),o=Be("span"),w&&w.c(),l=ft(),c=Be("span"),b&&b.c(),f=ft(),E&&E.c(),this.h()},l(T){r=Re(T,"A",{href:!0,role:!0,class:!0,disabled:!0});var C=Ne(r);o=Re(C,"SPAN",{class:!0});var z=Ne(o);w&&w.l(z),l=dt(z),c=Re(z,"SPAN",{class:!0});var B=Ne(c);b&&b.l(B),B.forEach(Q),f=dt(z),E&&E.l(z),z.forEach(Q),C.forEach(Q),this.h()},h(){fe(c,"class","ons-btn__text"),fe(o,"class","ons-btn__inner"),fe(r,"href",d=u[6]?null:u[2]),fe(r,"role","button"),fe(r,"class","ons-btn ons-btn--link ons-js-submit-btn"),fe(r,"disabled",u[6]),qt(r,"ons-btn--small",u[3]),qt(r,"ons-btn--secondary",u[1]==="secondary"),qt(r,"ons-btn--ghost",u[1]==="ghost"),qt(r,"ons-btn--disabled",u[6])},m(T,C){Ie(T,r,C),ke(r,o),w&&w.m(o,null),ke(o,l),ke(o,c),b&&b.m(c,null),ke(o,f),E&&E.m(o,null),n=!0,m||(v=ms(r,"click",u[10]),m=!0)},p(T,C){T[4]&&T[5]==="before"?w?(w.p(T,C),C&48&&De(w,1)):(w=Yd(T),w.c(),De(w,1),w.m(o,l)):w&&(Ii(),Xe(w,1,1,()=>{w=null}),Pi()),b&&b.p&&(!n||C&256)&&Cn(b,A,T,T[8],n?Pn(A,T[8],C,null):In(T[8]),null),T[4]&&T[5]==="after"?E?(E.p(T,C),C&48&&De(E,1)):(E=Qd(T),E.c(),De(E,1),E.m(o,null)):E&&(Ii(),Xe(E,1,1,()=>{E=null}),Pi()),(!n||C&68&&d!==(d=T[6]?null:T[2]))&&fe(r,"href",d),(!n||C&64)&&fe(r,"disabled",T[6]),(!n||C&8)&&qt(r,"ons-btn--small",T[3]),(!n||C&2)&&qt(r,"ons-btn--secondary",T[1]==="secondary"),(!n||C&2)&&qt(r,"ons-btn--ghost",T[1]==="ghost"),(!n||C&64)&&qt(r,"ons-btn--disabled",T[6])},i(T){n||(De(w),De(b,T),De(E),n=!0)},o(T){Xe(w),Xe(b,T),Xe(E),n=!1},d(T){T&&Q(r),w&&w.d(),b&&b.d(T),E&&E.d(),m=!1,v()}}}function Kd(u){let r,o;return r=new jc({props:{type:u[4],marginRight:!0}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&16&&(f.type=l[4]),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Jd(u){let r,o;return r=new jc({props:{type:u[4],marginLeft:!0}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&16&&(f.type=l[4]),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Yd(u){let r,o;return r=new jc({props:{type:u[4],marginRight:!0}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&16&&(f.type=l[4]),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Qd(u){let r,o;return r=new jc({props:{type:u[4],marginLeft:!0}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&16&&(f.type=l[4]),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function S1(u){let r,o,l,c;const f=[k1,w1],d=[];function n(m,v){return m[2]?0:1}return r=n(u),o=d[r]=f[r](u),{c(){o.c(),l=jt()},l(m){o.l(m),l=jt()},m(m,v){d[r].m(m,v),Ie(m,l,v),c=!0},p(m,[v]){let w=r;r=n(m),r===w?d[r].p(m,v):(Ii(),Xe(d[w],1,1,()=>{d[w]=null}),Pi(),o=d[r],o?o.p(m,v):(o=d[r]=f[r](m),o.c()),De(o,1),o.m(l.parentNode,l))},i(m){c||(De(o),c=!0)},o(m){Xe(o),c=!1},d(m){d[r].d(m),m&&Q(l)}}}function E1(u,r,o){let{$$slots:l={},$$scope:c}=r;const f=Uh();let{type:d="button"}=r,{variant:n="primary"}=r,{href:m=""}=r,{small:v=!1}=r,{icon:w=""}=r,{iconPosition:A="before"}=r,{disabled:b=!1}=r;const E=C=>f("click",C),T=C=>f("click",C);return u.$$set=C=>{"type"in C&&o(0,d=C.type),"variant"in C&&o(1,n=C.variant),"href"in C&&o(2,m=C.href),"small"in C&&o(3,v=C.small),"icon"in C&&o(4,w=C.icon),"iconPosition"in C&&o(5,A=C.iconPosition),"disabled"in C&&o(6,b=C.disabled),"$$scope"in C&&o(8,c=C.$$scope)},[d,n,m,v,w,A,b,f,c,l,E,T]}class Dc extends Vi{constructor(r){super(),Gi(this,r,E1,S1,Li,{type:0,variant:1,href:2,small:3,icon:4,iconPosition:5,disabled:6})}}var Xu=Sy,T1=function(u){var r,o,l,c;if(r=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(u)){var f=r[1],d=f.replace(/a$/,""),n=d==="cmyk"?4:3;o=Xu[d],l=r[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(v,w){return/%$/.test(v)&&w===n?parseFloat(v)/100:(/%$/.test(v),parseFloat(v))}),f===d&&l.push(1),c=l[n]===void 0?1:l[n],l=l.slice(0,n),o[d]=function(){return l}}else if(/^#[A-Fa-f0-9]+$/.test(u)){var d=u.replace(/^#/,""),n=d.length;o=Xu.rgb,l=d.split(n===3?/(.)/:/(..)/),l=l.filter(Boolean).map(function(A){return parseInt(n===3?A+A:A,16)}),c=1,o.rgb=function(){return l},l[0]||(l[0]=0),l[1]||(l[1]=0),l[2]||(l[2]=0)}else o=Xu.keyword,o.keyword=function(){return u},l=u,c=1;var m={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{m.rgb=o.rgb(l)}catch{}try{m.hsl=o.hsl(l)}catch{}try{m.hsv=o.hsv(l)}catch{}try{m.cmyk=o.cmyk(l)}catch{}try{m.keyword=o.keyword(l)}catch{}return m.rgb&&(m.hex="#"+m.rgb.map(function(v){var w=v.toString(16);return w.length===1?"0"+w:w}).join("")),m.rgb&&(m.rgba=m.rgb.concat(c)),m.hsl&&(m.hsla=m.hsl.concat(c)),m.hsv&&(m.hsva=m.hsv.concat(c)),m.cmyk&&(m.cmyka=m.cmyk.concat(c)),m};const A1=Gc(T1);function C1(u){return u}function I1(u){if(u==null)return C1;var r,o,l=u.scale[0],c=u.scale[1],f=u.translate[0],d=u.translate[1];return function(n,m){m||(r=o=0);var v=2,w=n.length,A=new Array(w);for(A[0]=(r+=n[0])*l+f,A[1]=(o+=n[1])*c+d;v<w;)A[v]=n[v],++v;return A}}function P1(u,r){for(var o,l=u.length,c=l-r;c<--l;)o=u[c],u[c++]=u[l],u[l]=o}function z1(u,r){return typeof r=="string"&&(r=u.objects[r]),r.type==="GeometryCollection"?{type:"FeatureCollection",features:r.geometries.map(function(o){return $d(u,o)})}:$d(u,r)}function $d(u,r){var o=r.id,l=r.bbox,c=r.properties==null?{}:r.properties,f=M1(u,r);return o==null&&l==null?{type:"Feature",properties:c,geometry:f}:l==null?{type:"Feature",id:o,properties:c,geometry:f}:{type:"Feature",id:o,bbox:l,properties:c,geometry:f}}function M1(u,r){var o=I1(u.transform),l=u.arcs;function c(w,A){A.length&&A.pop();for(var b=l[w<0?~w:w],E=0,T=b.length;E<T;++E)A.push(o(b[E],E));w<0&&P1(A,T)}function f(w){return o(w)}function d(w){for(var A=[],b=0,E=w.length;b<E;++b)c(w[b],A);return A.length<2&&A.push(A[0]),A}function n(w){for(var A=d(w);A.length<4;)A.push(A[0]);return A}function m(w){return w.map(n)}function v(w){var A=w.type,b;switch(A){case"GeometryCollection":return{type:A,geometries:w.geometries.map(v)};case"Point":b=f(w.coordinates);break;case"MultiPoint":b=w.coordinates.map(f);break;case"LineString":b=d(w.arcs);break;case"MultiLineString":b=w.arcs.map(d);break;case"Polygon":b=m(w.arcs);break;case"MultiPolygon":b=w.arcs.map(m);break;default:return null}return{type:A,coordinates:b}}return v(r)}const ep="https://raw.githubusercontent.com/jtrim-ons/key-pop-api-downloader/main/generated/";function D1(u){let r=[...u].sort((l,c)=>l.key.localeCompare(c.key));return{selString:u.length==0?"data":r.map((l,c)=>c<r.length-1?`${l.key}-${l.code}`:`${l.key}`).join("/"),lastCode:u.length>0?r[r.length-1].code:null}}async function eg(u,r=[],o=window.fetch){if(r.length>0&&!r[0].newFormat)throw new Error("OLD FORMAT!");let{selString:l,lastCode:c}=D1(r),f={data:{}},d;if(r.length===0){let n=`${ep}${r.length}var_percent/${l}.json`;d=await(await o(n)).json(),f.total_pop={count:d.sex.count[0]+d.sex.count[1],percent:100}}else{let n=`${ep}${r.length}var-combined_percent/${l}.json`,v=await(await o(n)).json();d=v.bar_chart_data[c],f.mapData=v.map_data[c],f.total_pop=d.total_pop}for(let n of u){f.data[n.key]={};for(let m of n.tables)f.data[n.key][m.code]={values:d[m.code]}}return f}function L1(u,r,o){for(let l=1;l<r.length;l++)if(u<=r[l])return o[l-1]}async function B1(u,r,o=window.fetch){let c=await(await o(u)).json();return await z1(c,r)}function Os(u){return u.charAt(0).toUpperCase()+u.slice(1)}function tp(u){return u.replace(new RegExp(" \\([0-9]* categories\\)"),"")}function ip(u){for(const r of u)if(r.var in wd)return wd[r.var][r.code];return null}function Lc(u,r,o){let l=o.all[u][r].values,c=o.selected[u][r].values,f=[];return ch[r].forEach((d,n)=>{let m=d.label,v=l.percent[n],w=c.percent[n];o.selected.total_pop!=o.all.total_pop&&f.push({group:"This group",category:m,value:w}),f.push({group:"Whole population",category:m,value:v})}),f}function np(u){if(u===100)return"100";const r=u.toFixed(1);return r!=="0.0"?r:"Less than 0.05"}function ia(u){return u.split(": ").slice(-1)[0]}async function R1({fetch:u}){let r=await B1(Nh+ol.url,ol.layer,u),o=(await eg(go,[],u)).data,l=[],c={},f=[];return r.features.forEach(d=>{const n=d.properties[ol.code],m=d.properties[ol.name],v={code:n,name:m};l.push(v),c[n]=v,f.push({...v,value:100,color:$o.seq[4]})}),{geojson:r,geoCodesAndNames:l,geoCodesLookup:c,geoPerc:f,all:o,selected:null}}const iw=Object.freeze(Object.defineProperty({__proto__:null,load:R1},Symbol.toStringTag,{value:"Module"})),O1=Qm("goto"),F1=Qm("after_navigate");function N1(u){return u.slice().sort(function(r,o){return r-o})}function rp(u,r){for(var o=[],l=0;l<u;l++){for(var c=[],f=0;f<r;f++)c.push(0);o.push(c)}return o}function U1(u){for(var r=0,o,l=0;l<u.length;l++)(l===0||u[l]!==o)&&(o=u[l],r++);return r}function uh(u,r,o,l){var c;if(u>0){var f=(o[r]-o[u-1])/(r-u+1);c=l[r]-l[u-1]-(r-u+1)*f*f}else c=l[r]-o[r]*o[r]/(r+1);return c<0?0:c}function hh(u,r,o,l,c,f,d){if(!(u>r)){var n=Math.floor((u+r)/2);l[o][n]=l[o-1][n-1],c[o][n]=n;var m=o;u>o&&(m=Math.max(m,c[o][u-1]||0)),m=Math.max(m,c[o-1][n]||0);var v=n-1;r<l[0].length-1&&(v=Math.min(v,c[o][r+1]||0));for(var w,A,b,E,T=v;T>=m&&(w=uh(T,n,f,d),!(w+l[o-1][m-1]>=l[o][n]));--T)A=uh(m,n,f,d),b=A+l[o-1][m-1],b<l[o][n]&&(l[o][n]=b,c[o][n]=m),m++,E=w+l[o-1][T-1],E<l[o][n]&&(l[o][n]=E,c[o][n]=T);hh(u,n-1,o,l,c,f,d),hh(n+1,r,o,l,c,f,d)}}function V1(u,r,o){for(var l=r[0].length,c=u[Math.floor(l/2)],f=[],d=[],n=0,m=void 0;n<l;++n)m=u[n]-c,n===0?(f.push(m),d.push(m*m)):(f.push(f[n-1]+m),d.push(d[n-1]+m*m)),r[0][n]=uh(0,n,f,d),o[0][n]=0;for(var v,w=1;w<r.length;++w)w<r.length-1?v=w:v=l-1,hh(v,l-1,w,r,o,f,d)}function G1(u,r){if(r>u.length)throw new Error("cannot generate more classes than there are data values");var o=N1(u),l=U1(o);if(l===1)return[o];var c=rp(r,o.length),f=rp(r,o.length);V1(o,c,f);for(var d=[],n=f[0].length-1,m=f.length-1;m>=0;m--){var v=f[m][n];d[m]=o.slice(v,n+1),m>0&&(n=v-1)}return d}function sp(u,r,o){const l=u.slice();return l[15]=r[o],l}function op(u,r,o){const l=u.slice();return l[18]=r[o],l[20]=o,l}function ap(u,r,o){const l=u.slice();return l[18]=r[o],l[20]=o,l}function lp(u,r,o){const l=u.slice();return l[15]=r[o],l[20]=o,l}function cp(u){let r,o=u[9],l=[];for(let c=0;c<o.length;c+=1)l[c]=up(lp(u,o,c));return{c(){r=Be("ul");for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){r=Re(c,"UL",{class:!0});var f=Ne(r);for(let d=0;d<l.length;d+=1)l[d].l(f);f.forEach(Q),this.h()},h(){fe(r,"class","legend-block svelte-lmi12p")},m(c,f){Ie(c,r,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(r,null)},p(c,f){if(f&544){o=c[9];let d;for(d=0;d<o.length;d+=1){const n=lp(c,o,d);l[d]?l[d].p(n,f):(l[d]=up(n),l[d].c(),l[d].m(r,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=o.length}},d(c){c&&Q(r),zn(l,c)}}}function up(u){let r,o,l,c,f=u[15]+"",d,n;return{c(){r=Be("li"),o=Be("div"),l=ft(),c=Be("span"),d=xt(f),n=ft(),this.h()},l(m){r=Re(m,"LI",{class:!0});var v=Ne(r);o=Re(v,"DIV",{class:!0}),Ne(o).forEach(Q),l=dt(v),c=Re(v,"SPAN",{class:!0});var w=Ne(c);d=wt(w,f),w.forEach(Q),n=dt(v),v.forEach(Q),this.h()},h(){fe(o,"class","legend-vis "+(u[20]==0?"bar":"marker")+" svelte-lmi12p"),yt(o,"height","1rem"),yt(o,"width",u[20]==0?"1rem":u[5]+"px"),fe(c,"class",zc(u[20]==0?"bold":"brackets")+" svelte-lmi12p"),fe(r,"class","svelte-lmi12p"),qt(r,"ew",u[20]!=0)},m(m,v){Ie(m,r,v),ke(r,o),ke(r,l),ke(r,c),ke(c,d),ke(r,n)},p(m,v){v&32&&yt(o,"width",m[20]==0?"1rem":m[5]+"px"),v&512&&f!==(f=m[15]+"")&&_i(d,f)},d(m){m&&Q(r)}}}function hp(u){let r,o=u[1](u[18][u[0]])+"",l,c;return{c(){r=Be("span"),l=xt(o),c=xt(u[2]),this.h()},l(f){r=Re(f,"SPAN",{class:!0});var d=Ne(r);l=wt(d,o),c=wt(d,u[2]),d.forEach(Q),this.h()},h(){fe(r,"class","label "+(u[20]==0?"bold":"sml brackets")+" svelte-lmi12p")},m(f,d){Ie(f,r,d),ke(r,l),ke(r,c)},p(f,d){d&131&&o!==(o=f[1](f[18][f[0]])+"")&&_i(l,o),d&4&&_i(c,f[2])},d(f){f&&Q(r)}}}function j1(u){let r,o=`calc(${u[8](u[18][u[0]])}% - ${u[5]/2}px)`,l=`${u[5]}px`;return{c(){r=Be("div"),this.h()},l(c){r=Re(c,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","marker svelte-lmi12p"),yt(r,"left",o),yt(r,"border-left-width",l)},m(c,f){Ie(c,r,f)},p(c,f){f&417&&o!==(o=`calc(${c[8](c[18][c[0]])}% - ${c[5]/2}px)`)&&yt(r,"left",o),f&32&&l!==(l=`${c[5]}px`)&&yt(r,"border-left-width",l)},d(c){c&&Q(r)}}}function q1(u){let r,o=`${u[8](u[18][u[0]])}%`;return{c(){r=Be("div"),this.h()},l(l){r=Re(l,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","bar svelte-lmi12p"),yt(r,"left","0"),yt(r,"width",o)},m(l,c){Ie(l,r,c)},p(l,c){c&385&&o!==(o=`${l[8](l[18][l[0]])}%`)&&yt(r,"width",o)},d(l){l&&Q(r)}}}function fp(u){let r;function o(f,d){return f[20]==0?q1:j1}let c=o(u)(u);return{c(){c.c(),r=jt()},l(f){c.l(f),r=jt()},m(f,d){c.m(f,d),Ie(f,r,d)},p(f,d){c.p(f,d)},d(f){c.d(f),f&&Q(r)}}}function dp(u){let r,o=u[15].label+"",l,c,f,d,n,m=`${u[4]}px`,v=u[15].values,w=[];for(let E=0;E<v.length;E+=1)w[E]=hp(ap(u,v,E));let A=u[15].values,b=[];for(let E=0;E<A.length;E+=1)b[E]=fp(op(u,A,E));return{c(){r=Be("div"),l=xt(o),c=ft(),f=Be("span");for(let E=0;E<w.length;E+=1)w[E].c();d=ft(),n=Be("div");for(let E=0;E<b.length;E+=1)b[E].c();this.h()},l(E){r=Re(E,"DIV",{class:!0});var T=Ne(r);l=wt(T,o),c=dt(T),f=Re(T,"SPAN",{class:!0});var C=Ne(f);for(let B=0;B<w.length;B+=1)w[B].l(C);C.forEach(Q),T.forEach(Q),d=dt(E),n=Re(E,"DIV",{class:!0});var z=Ne(n);for(let B=0;B<b.length;B+=1)b[B].l(z);z.forEach(Q),this.h()},h(){fe(f,"class","nowrap svelte-lmi12p"),fe(r,"class","label-group svelte-lmi12p"),fe(n,"class","bar-group svelte-lmi12p"),yt(n,"height",m)},m(E,T){Ie(E,r,T),ke(r,l),ke(r,c),ke(r,f);for(let C=0;C<w.length;C+=1)w[C]&&w[C].m(f,null);Ie(E,d,T),Ie(E,n,T);for(let C=0;C<b.length;C+=1)b[C]&&b[C].m(n,null)},p(E,T){if(T&128&&o!==(o=E[15].label+"")&&_i(l,o),T&135){v=E[15].values;let C;for(C=0;C<v.length;C+=1){const z=ap(E,v,C);w[C]?w[C].p(z,T):(w[C]=hp(z),w[C].c(),w[C].m(f,null))}for(;C<w.length;C+=1)w[C].d(1);w.length=v.length}if(T&417){A=E[15].values;let C;for(C=0;C<A.length;C+=1){const z=op(E,A,C);b[C]?b[C].p(z,T):(b[C]=fp(z),b[C].c(),b[C].m(n,null))}for(;C<b.length;C+=1)b[C].d(1);b.length=A.length}T&16&&m!==(m=`${E[4]}px`)&&yt(n,"height",m)},d(E){E&&Q(r),zn(w,E),E&&Q(d),E&&Q(n),zn(b,E)}}}function pp(u){let r,o;return{c(){r=Be("small"),o=xt(u[3]),this.h()},l(l){r=Re(l,"SMALL",{class:!0});var c=Ne(r);o=wt(c,u[3]),c.forEach(Q),this.h()},h(){fe(r,"class","svelte-lmi12p")},m(l,c){Ie(l,r,c),ke(r,o)},p(l,c){c&8&&_i(o,l[3])},d(l){l&&Q(r)}}}function Z1(u){let r,o,l,c=u[6]&&u[9][1]&&cp(u),f=u[7],d=[];for(let m=0;m<f.length;m+=1)d[m]=dp(sp(u,f,m));let n=u[3]&&pp(u);return{c(){c&&c.c(),r=ft();for(let m=0;m<d.length;m+=1)d[m].c();o=ft(),n&&n.c(),l=jt()},l(m){c&&c.l(m),r=dt(m);for(let v=0;v<d.length;v+=1)d[v].l(m);o=dt(m),n&&n.l(m),l=jt()},m(m,v){c&&c.m(m,v),Ie(m,r,v);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(m,v);Ie(m,o,v),n&&n.m(m,v),Ie(m,l,v)},p(m,[v]){if(m[6]&&m[9][1]?c?c.p(m,v):(c=cp(m),c.c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null),v&439){f=m[7];let w;for(w=0;w<f.length;w+=1){const A=sp(m,f,w);d[w]?d[w].p(A,v):(d[w]=dp(A),d[w].c(),d[w].m(o.parentNode,o))}for(;w<d.length;w+=1)d[w].d(1);d.length=f.length}m[3]?n?n.p(m,v):(n=pp(m),n.c(),n.m(l.parentNode,l)):n&&(n.d(1),n=null)},i:ci,o:ci,d(m){c&&c.d(m),m&&Q(r),zn(d,m),m&&Q(o),n&&n.d(m),m&&Q(l)}}}function H1(u,r,o){let l,c,f,d,{data:n}=r,{xKey:m="value"}=r,{yKey:v="category"}=r,{zKey:w="areanm"}=r,{formatTick:A=O=>O.toFixed(1)}=r,{suffix:b="%"}=r,{base:E=null}=r,{barHeight:T=25}=r,{markerWidth:C=3}=r,{showLegend:z=!0}=r;function B(O,W){let q={},Z=[];for(const J of O)q[J[W]]||(q[J[W]]={label:J[W],values:[]},Z.push(J[W])),q[J[W]].values.push(J);let ae=[];return Z.forEach(J=>{ae.push(q[J])}),ae}return u.$$set=O=>{"data"in O&&o(10,n=O.data),"xKey"in O&&o(0,m=O.xKey),"yKey"in O&&o(11,v=O.yKey),"zKey"in O&&o(12,w=O.zKey),"formatTick"in O&&o(1,A=O.formatTick),"suffix"in O&&o(2,b=O.suffix),"base"in O&&o(3,E=O.base),"barHeight"in O&&o(4,T=O.barHeight),"markerWidth"in O&&o(5,C=O.markerWidth),"showLegend"in O&&o(6,z=O.showLegend)},u.$$.update=()=>{u.$$.dirty&1025&&o(13,l=Math.max(...n.map(O=>O[m]))),u.$$.dirty&5120&&o(9,c=n.map(O=>O[w]).filter((O,W,q)=>q.indexOf(O)===W)),u.$$.dirty&8192&&o(8,f=O=>O/l*100),u.$$.dirty&3072&&o(7,d=B(n,v))},[m,A,b,E,T,C,z,d,f,c,n,v,w,l]}class W1 extends Vi{constructor(r){super(),Gi(this,r,H1,Z1,Li,{data:10,xKey:0,yKey:11,zKey:12,formatTick:1,suffix:2,base:3,barHeight:4,markerWidth:5,showLegend:6})}}function X1(u){let r,o,l;return{c(){r=qr("svg"),o=qr("path"),this.h()},l(c){r=Zr(c,"svg",{class:!0,viewBox:!0,"fill-rule":!0,"clip-rule":!0,"aria-hidden":!0,focusable:!0,style:!0});var f=Ne(r);o=Zr(f,"path",{d:!0}),Ne(o).forEach(Q),f.forEach(Q),this.h()},h(){fe(o,"d",l=u[4][u[0]]),fe(r,"class","ico svelte-175xtay"),fe(r,"viewBox","0 0 24 24"),fe(r,"fill-rule","evenodd"),fe(r,"clip-rule","evenodd"),fe(r,"aria-hidden","true"),fe(r,"focusable","false"),fe(r,"style",u[3]),qt(r,"margin",u[2]),qt(r,"noclick",!u[1])},m(c,f){Ie(c,r,f),ke(r,o)},p(c,[f]){f&1&&l!==(l=c[4][c[0]])&&fe(o,"d",l),f&8&&fe(r,"style",c[3]),f&4&&qt(r,"margin",c[2]),f&2&&qt(r,"noclick",!c[1])},i:ci,o:ci,d(c){c&&Q(r)}}}function K1(u,r,o){let l,{type:c="compass"}=r,{rotation:f=0}=r,{position:d="inline"}=r,{clickable:n=!1}=r,{margin:m=!1}=r;const v={compass:"M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zm-10 1H8v-2h4V8l4 4-4 4v-3z",info:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z",chart:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 17c-.55 0-1-.45-1-1v-5c0-.55.45-1 1-1s1 .45 1 1v5c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v8c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1z",share:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",chevron:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",full:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",full_exit:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",shuffle:"M10.59 9.17 5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z",replay:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z",save:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z",tick:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z",cross:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z",arrow:"M5,13h11.2l-2.9,2.9c-0.4,0.4-0.4,1,0,1.4s1,0.4,1.4,0l4.6-4.6c0.4-0.4,0.4-1,0-1.4l-4.6-4.6c-0.4-0.4-1-0.4-1.4,0c0,0,0,0,0,0c-0.4,0.4-0.4,1,0,1.4l2.9,2.9H5c-0.6,0-1,0.4-1,1S4.4,13,5,13z",plus:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z",minus:"M18 13H6c-.55 0-1-.45-1-1s.45-1 1-1h12c.55 0 1 .45 1 1s-.45 1-1 1z",subdir:"m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9l6 6z",touch:"M9 11.24V7.5C9 6.12 10.12 5 11.5 5S14 6.12 14 7.5v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74c-3.6-.76-3.54-.75-3.67-.75-.31 0-.59.13-.79.33l-.79.8 4.94 4.94c.27.27.65.44 1.06.44h6.79c.75 0 1.33-.55 1.44-1.28l.75-5.27c.01-.07.02-.14.02-.2 0-.62-.38-1.16-.91-1.38z",launch:"M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.11 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1zM14 4c0 .55.45 1 1 1h2.59l-9.13 9.13c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V3h-6c-.55 0-1 .45-1 1z",close:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",error:"M 12 2 C 6.48 2 2 6.48 2 12 s 4.48 10 10 10 s 10 -4.48 10 -10 S 17.52 2 12 2 z m 1 15 h -2 v -2 h 2 v 2 z m 0 -4 h -2 V 7 h 2 v 6 z"};return u.$$set=w=>{"type"in w&&o(0,c=w.type),"rotation"in w&&o(5,f=w.rotation),"position"in w&&o(6,d=w.position),"clickable"in w&&o(1,n=w.clickable),"margin"in w&&o(2,m=w.margin)},u.$$.update=()=>{u.$$.dirty&96&&o(3,l=`transform: translate(0, 15%) scale(1.5) rotate(${-f}deg);${["left","right"].includes(d)?` position: absolute; ${d}: 10px;`:""}`)},[c,n,m,l,v,f,d]}class Zh extends Vi{constructor(r){super(),Gi(this,r,K1,X1,Li,{type:0,rotation:5,position:6,clickable:1,margin:2})}}function mp(u,r,o){const l=u.slice();return l[11]=r[o],l}function gp(u){let r,o,l,c;return{c(){r=Be("button"),o=xt("Back"),this.h()},l(f){r=Re(f,"BUTTON",{class:!0});var d=Ne(r);o=wt(d,"Back"),d.forEach(Q),this.h()},h(){fe(r,"class","hidden-on-desktop svelte-1iovvug")},m(f,d){Ie(f,r,d),ke(r,o),l||(c=ms(r,"click",function(){Wm(u[3])&&u[3].apply(this,arguments)}),l=!0)},p(f,d){u=f},d(f){f&&Q(r),l=!1,c()}}}function _p(u){let r,o,l,c,f=ia(Bc(u[11],u[4]))+"",d;return{c(){r=Be("br"),o=ft(),l=Be("div"),c=xt("Selected: "),d=xt(f),this.h()},l(n){r=Re(n,"BR",{}),o=dt(n),l=Re(n,"DIV",{class:!0});var m=Ne(l);c=wt(m,"Selected: "),d=wt(m,f),m.forEach(Q),this.h()},h(){fe(l,"class","selected-item-label svelte-1iovvug")},m(n,m){Ie(n,r,m),Ie(n,o,m),Ie(n,l,m),ke(l,c),ke(l,d)},p(n,m){m&18&&f!==(f=ia(Bc(n[11],n[4]))+"")&&_i(d,f)},d(n){n&&Q(r),n&&Q(o),n&&Q(l)}}}function yp(u){let r,o=u[6](u[11])+"",l,c,f,d,n,m=Bc(u[11],u[4]),v,w,A;d=new Zh({props:{type:"chevron"}});let b=m&&_p(u);function E(){return u[10](u[11])}return{c(){r=Be("button"),l=xt(o),c=ft(),f=Be("span"),Kt(d.$$.fragment),n=ft(),b&&b.c(),this.h()},l(T){r=Re(T,"BUTTON",{class:!0});var C=Ne(r);l=wt(C,o),c=dt(C),f=Re(C,"SPAN",{class:!0});var z=Ne(f);ei(d.$$.fragment,z),z.forEach(Q),n=dt(C),b&&b.l(C),C.forEach(Q),this.h()},h(){fe(f,"class","right-chevron svelte-1iovvug"),fe(r,"class","svelte-1iovvug"),qt(r,"plain-button",!0),qt(r,"selected",u[11]===u[0])},m(T,C){Ie(T,r,C),ke(r,l),ke(r,c),ke(r,f),Jt(d,f,null),ke(r,n),b&&b.m(r,null),v=!0,w||(A=ms(r,"click",E),w=!0)},p(T,C){u=T,(!v||C&66)&&o!==(o=u[6](u[11])+"")&&_i(l,o),C&18&&(m=Bc(u[11],u[4])),m?b?b.p(u,C):(b=_p(u),b.c(),b.m(r,null)):b&&(b.d(1),b=null),(!v||C&3)&&qt(r,"selected",u[11]===u[0])},i(T){v||(De(d.$$.fragment,T),v=!0)},o(T){Xe(d.$$.fragment,T),v=!1},d(T){T&&Q(r),Yt(d),b&&b.d(),w=!1,A()}}}function J1(u){let r,o,l,c,f,d,n,m=u[3]!=null&&gp(u),v=u[1],w=[];for(let T=0;T<v.length;T+=1)w[T]=yp(mp(u,v,T));const A=T=>Xe(w[T],1,1,()=>{w[T]=null}),b=u[9].default,E=An(b,u,u[8],null);return{c(){r=Be("div"),m&&m.c(),o=ft(),l=Be("h5"),c=xt(u[5]),f=ft();for(let T=0;T<w.length;T+=1)w[T].c();d=ft(),E&&E.c(),this.h()},l(T){r=Re(T,"DIV",{class:!0});var C=Ne(r);m&&m.l(C),o=dt(C),l=Re(C,"H5",{class:!0});var z=Ne(l);c=wt(z,u[5]),z.forEach(Q),f=dt(C);for(let B=0;B<w.length;B+=1)w[B].l(C);d=dt(C),E&&E.l(C),C.forEach(Q),this.h()},h(){fe(l,"class","column-title svelte-1iovvug"),fe(r,"class","column svelte-1iovvug"),qt(r,"hidden-first-column",u[7])},m(T,C){Ie(T,r,C),m&&m.m(r,null),ke(r,o),ke(r,l),ke(l,c),ke(r,f);for(let z=0;z<w.length;z+=1)w[z]&&w[z].m(r,null);ke(r,d),E&&E.m(r,null),n=!0},p(T,[C]){if(T[3]!=null?m?m.p(T,C):(m=gp(T),m.c(),m.m(r,o)):m&&(m.d(1),m=null),(!n||C&32)&&_i(c,T[5]),C&87){v=T[1];let z;for(z=0;z<v.length;z+=1){const B=mp(T,v,z);w[z]?(w[z].p(B,C),De(w[z],1)):(w[z]=yp(B),w[z].c(),De(w[z],1),w[z].m(r,d))}for(Ii(),z=v.length;z<w.length;z+=1)A(z);Pi()}E&&E.p&&(!n||C&256)&&Cn(E,b,T,T[8],n?Pn(b,T[8],C,null):In(T[8]),null),(!n||C&128)&&qt(r,"hidden-first-column",T[7])},i(T){if(!n){for(let C=0;C<v.length;C+=1)De(w[C]);De(E,T),n=!0}},o(T){w=w.filter(Boolean);for(let C=0;C<w.length;C+=1)Xe(w[C]);Xe(E,T),n=!1},d(T){T&&Q(r),m&&m.d(),zn(w,T),E&&E.d(T)}}}function Y1(u){console.log("clicked",u)}function Bc(u,r){for(let o of r)if(o.topic===u.label)return o.label;return!1}function Q1(u,r,o){let{$$slots:l={},$$scope:c}=r,{options:f=[]}=r,{clickCallback:d=Y1}=r,{backButtonCallback:n=null}=r,{globalSelectedCategories:m=[]}=r,{columnTitle:v="column title"}=r,{labeller:w=T=>T.label}=r,{selected:A=null}=r,{hiddenOnMobile:b=!1}=r;const E=T=>{o(0,A=T),d(T)};return u.$$set=T=>{"options"in T&&o(1,f=T.options),"clickCallback"in T&&o(2,d=T.clickCallback),"backButtonCallback"in T&&o(3,n=T.backButtonCallback),"globalSelectedCategories"in T&&o(4,m=T.globalSelectedCategories),"columnTitle"in T&&o(5,v=T.columnTitle),"labeller"in T&&o(6,w=T.labeller),"selected"in T&&o(0,A=T.selected),"hiddenOnMobile"in T&&o(7,b=T.hiddenOnMobile),"$$scope"in T&&o(8,c=T.$$scope)},[A,f,d,n,m,v,w,b,c,l,E]}class $1 extends Vi{constructor(r){super(),Gi(this,r,Q1,J1,Li,{options:1,clickCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,selected:0,hiddenOnMobile:7})}}function vp(u,r,o){const l=u.slice();return l[14]=r[o],l[16]=o,l}function bp(u){let r,o,l,c,f,d,n,m,v;return{c(){r=Be("ol"),o=Be("li"),l=Be("button"),c=xt("Back"),f=ft(),d=qr("svg"),n=qr("path"),this.h()},l(w){r=Re(w,"OL",{class:!0});var A=Ne(r);o=Re(A,"LI",{class:!0,id:!0});var b=Ne(o);l=Re(b,"BUTTON",{class:!0});var E=Ne(l);c=wt(E,"Back"),E.forEach(Q),f=dt(b),d=Zr(b,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var T=Ne(d);n=Zr(T,"path",{d:!0,transform:!0}),Ne(n).forEach(Q),T.forEach(Q),b.forEach(Q),A.forEach(Q),this.h()},h(){fe(l,"class","btn-link ons-breadcrumb__link"),fe(n,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),fe(n,"transform","translate(-5.02 -1.59)"),fe(d,"class","ons-svg-icon svelte-w4p0hu"),fe(d,"viewBox","0 0 8 13"),fe(d,"xmlns","http://www.w3.org/2000/svg"),fe(d,"focusable","false"),fe(d,"fill","currentColor"),fe(o,"class","ons-breadcrumb__item"),fe(o,"id","breadcrumb-1"),fe(r,"class","ons-breadcrumb__items ons-u-fs-s")},m(w,A){Ie(w,r,A),ke(r,o),ke(o,l),ke(l,c),ke(o,f),ke(o,d),ke(d,n),m||(v=ms(l,"click",function(){Wm(u[3])&&u[3].apply(this,arguments)}),m=!0)},p(w,A){u=w},d(w){w&&Q(r),m=!1,v()}}}function xp(u){let r,o;return r=new Dc({props:{variant:"secondary",small:!0,disabled:u[7],$$slots:{default:[e0]},$$scope:{ctx:u}}}),r.$on("click",u[11]),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&128&&(f.disabled=l[7]),c&8192&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function e0(u){let r;return{c(){r=xt("Remove selection")},l(o){r=wt(o,"Remove selection")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function t0(u){let r,o=u[0],l,c,f=kp(u);const d=u[10].default,n=An(d,u,u[13],null);return{c(){r=Be("div"),f.c(),l=ft(),n&&n.c(),this.h()},l(m){r=Re(m,"DIV",{class:!0});var v=Ne(r);f.l(v),v.forEach(Q),l=dt(m),n&&n.l(m),this.h()},h(){fe(r,"class","ons-radios__items")},m(m,v){Ie(m,r,v),f.m(r,null),Ie(m,l,v),n&&n.m(m,v),c=!0},p(m,v){v&1&&Li(o,o=m[0])?(f.d(1),f=kp(m),f.c(),f.m(r,null)):f.p(m,v),n&&n.p&&(!c||v&8192)&&Cn(n,d,m,m[13],c?Pn(d,m[13],v,null):In(m[13]),null)},i(m){c||(De(n,m),c=!0)},o(m){Xe(n,m),c=!1},d(m){m&&Q(r),f.d(m),m&&Q(l),n&&n.d(m)}}}function i0(u){let r;return{c(){r=xt(`At most three characteristics can be selected. To add another
      characteristic, please remove one of the three selected ones.`)},l(o){r=wt(o,`At most three characteristics can be selected. To add another
      characteristic, please remove one of the three selected ones.`)},m(o,l){Ie(o,r,l)},p:ci,i:ci,o:ci,d(o){o&&Q(r)}}}function wp(u){let r,o,l,c,f,d=u[6](u[14])+"",n,m,v,w;function A(){return u[12](u[14])}return{c(){r=Be("button"),o=Be("span"),l=Be("span"),c=ft(),f=Be("span"),n=xt(d),m=ft(),this.h()},l(b){r=Re(b,"BUTTON",{class:!0});var E=Ne(r);o=Re(E,"SPAN",{class:!0});var T=Ne(o);l=Re(T,"SPAN",{class:!0}),Ne(l).forEach(Q),c=dt(T),f=Re(T,"SPAN",{class:!0});var C=Ne(f);n=wt(C,d),C.forEach(Q),T.forEach(Q),m=dt(E),E.forEach(Q),this.h()},h(){fe(l,"class","ons-radio__input ons-js-radio svelte-1cwdic4"),fe(f,"class","ons-radio__label svelte-1cwdic4"),fe(o,"class","ons-radio ons-radio--no-border"),fe(r,"class","ons-radios__item ons-radios__item--no-border svelte-1cwdic4"),r.disabled=u[7],qt(r,"ons-radio__checked",Ep(u[14],u[4]))},m(b,E){Ie(b,r,E),ke(r,o),ke(o,l),ke(o,c),ke(o,f),ke(f,n),ke(r,m),v||(w=[Xm(r0.call(null,r,u[16]===0)),ms(r,"click",A)],v=!0)},p(b,E){u=b,E&65&&d!==(d=u[6](u[14])+"")&&_i(n,d),E&128&&(r.disabled=u[7]),E&17&&qt(r,"ons-radio__checked",Ep(u[14],u[4]))},d(b){b&&Q(r),v=!1,Iy(w)}}}function kp(u){let r,o=u[0],l=[];for(let c=0;c<o.length;c+=1)l[c]=wp(vp(u,o,c));return{c(){for(let c=0;c<l.length;c+=1)l[c].c();r=jt()},l(c){for(let f=0;f<l.length;f+=1)l[f].l(c);r=jt()},m(c,f){for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(c,f);Ie(c,r,f)},p(c,f){if(f&211){o=c[0];let d;for(d=0;d<o.length;d+=1){const n=vp(c,o,d);l[d]?l[d].p(n,f):(l[d]=wp(n),l[d].c(),l[d].m(r.parentNode,r))}for(;d<l.length;d+=1)l[d].d(1);l.length=o.length}},d(c){zn(l,c),c&&Q(r)}}}function n0(u){let r,o,l,c,f,d,n,m=Ku(u[9],u[4]),v,w,A,b,E,T=u[3]!=null&&bp(u),C=m&&xp(u);const z=[i0,t0],B=[];function O(W,q){return q&528&&(w=null),w==null&&(w=W[4].length===3&&!Ku(W[9],W[4])),w?0:1}return A=O(u,-1),b=B[A]=z[A](u),{c(){r=Be("div"),o=Be("div"),T&&T.c(),l=ft(),c=Be("div"),f=Be("h5"),d=xt(u[5]),n=ft(),C&&C.c(),v=ft(),b.c(),this.h()},l(W){r=Re(W,"DIV",{class:!0});var q=Ne(r);o=Re(q,"DIV",{class:!0});var Z=Ne(o);T&&T.l(Z),Z.forEach(Q),l=dt(q),c=Re(q,"DIV",{class:!0});var ae=Ne(c);f=Re(ae,"H5",{class:!0});var J=Ne(f);d=wt(J,u[5]),J.forEach(Q),n=dt(ae),C&&C.l(ae),ae.forEach(Q),v=dt(q),b.l(q),q.forEach(Q),this.h()},h(){fe(o,"class","svelte-1cwdic4"),qt(o,"hidden-on-desktop",!0),fe(f,"class","column-title svelte-1cwdic4"),fe(c,"class","title-container svelte-1cwdic4"),fe(r,"class","column svelte-1cwdic4"),qt(r,"hidden-first-column",u[8])},m(W,q){Ie(W,r,q),ke(r,o),T&&T.m(o,null),ke(r,l),ke(r,c),ke(c,f),ke(f,d),ke(c,n),C&&C.m(c,null),ke(r,v),B[A].m(r,null),E=!0},p(W,[q]){W[3]!=null?T?T.p(W,q):(T=bp(W),T.c(),T.m(o,null)):T&&(T.d(1),T=null),(!E||q&32)&&_i(d,W[5]),q&528&&(m=Ku(W[9],W[4])),m?C?(C.p(W,q),q&528&&De(C,1)):(C=xp(W),C.c(),De(C,1),C.m(c,null)):C&&(Ii(),Xe(C,1,1,()=>{C=null}),Pi());let Z=A;A=O(W,q),A===Z?B[A].p(W,q):(Ii(),Xe(B[Z],1,1,()=>{B[Z]=null}),Pi(),b=B[A],b?b.p(W,q):(b=B[A]=z[A](W),b.c()),De(b,1),b.m(r,null)),(!E||q&256)&&qt(r,"hidden-first-column",W[8])},i(W){E||(De(C),De(b),E=!0)},o(W){Xe(C),Xe(b),E=!1},d(W){W&&Q(r),T&&T.d(),C&&C.d(),B[A].d()}}}function Sp(u){console.log("clicked",u)}function Ku(u,r){for(let o of r)if(o.topic===u.label)return o.label;return!1}function Ep(u,r){for(const o of r)if(o.var===u.var&&o.code===u.code)return!0;return!1}function r0(u,r){r&&u.focus()}function s0(u,r,o){let{$$slots:l={},$$scope:c}=r,{options:f=[]}=r,{clickCallback:d=Sp}=r,{removeCatCallback:n=Sp}=r,{backButtonCallback:m=null}=r,{globalSelectedCategories:v=[]}=r,{columnTitle:w="column title"}=r,{labeller:A=B=>B.label}=r,{disabled:b=!1}=r,{hiddenOnMobile:E=!1}=r,{currentVar:T=null}=r;const C=()=>n(T),z=B=>d(B);return u.$$set=B=>{"options"in B&&o(0,f=B.options),"clickCallback"in B&&o(1,d=B.clickCallback),"removeCatCallback"in B&&o(2,n=B.removeCatCallback),"backButtonCallback"in B&&o(3,m=B.backButtonCallback),"globalSelectedCategories"in B&&o(4,v=B.globalSelectedCategories),"columnTitle"in B&&o(5,w=B.columnTitle),"labeller"in B&&o(6,A=B.labeller),"disabled"in B&&o(7,b=B.disabled),"hiddenOnMobile"in B&&o(8,E=B.hiddenOnMobile),"currentVar"in B&&o(9,T=B.currentVar),"$$scope"in B&&o(13,c=B.$$scope)},[f,d,n,m,v,w,A,b,E,T,l,C,z,c]}class o0 extends Vi{constructor(r){super(),Gi(this,r,s0,n0,Li,{options:0,clickCallback:1,removeCatCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,disabled:7,hiddenOnMobile:8,currentVar:9})}}function Tp(u,r,o){const l=u.slice();return l[25]=r[o],l}function Ap(u){let r,o,l=[u[5].vars[u[7][u[5].label]]],c=[];for(let d=0;d<1;d+=1)c[d]=Pp(Tp(u,l,d));const f=d=>Xe(c[d],1,1,()=>{c[d]=null});return{c(){for(let d=0;d<1;d+=1)c[d].c();r=jt()},l(d){for(let n=0;n<1;n+=1)c[n].l(d);r=jt()},m(d,n){for(let m=0;m<1;m+=1)c[m]&&c[m].m(d,n);Ie(d,r,n),o=!0},p(d,n){if(n&1022){l=[d[5].vars[d[7][d[5].label]]];let m;for(m=0;m<1;m+=1){const v=Tp(d,l,m);c[m]?(c[m].p(v,n),De(c[m],1)):(c[m]=Pp(v),c[m].c(),De(c[m],1),c[m].m(r.parentNode,r))}for(Ii(),m=1;m<1;m+=1)f(m);Pi()}},i(d){if(!o){for(let n=0;n<1;n+=1)De(c[n]);o=!0}},o(d){c=c.filter(Boolean);for(let n=0;n<1;n+=1)Xe(c[n]);o=!1},d(d){zn(c,d),d&&Q(r)}}}function Cp(u){let r,o,l,c,f,d;return o=new Zh({props:{type:"chevron",rotation:90}}),{c(){r=Be("button"),Kt(o.$$.fragment),l=xt(" Show fewer"),this.h()},l(n){r=Re(n,"BUTTON",{class:!0});var m=Ne(r);ei(o.$$.fragment,m),l=wt(m," Show fewer"),m.forEach(Q),this.h()},h(){fe(r,"class","btn-link")},m(n,m){Ie(n,r,m),Jt(o,r,null),ke(r,l),c=!0,f||(d=ms(r,"click",u[9]),f=!0)},p:ci,i(n){c||(De(o.$$.fragment,n),c=!0)},o(n){Xe(o.$$.fragment,n),c=!1},d(n){n&&Q(r),Yt(o),f=!1,d()}}}function Ip(u){let r,o,l,c,f,d;return o=new Zh({props:{type:"chevron",rotation:-90}}),{c(){r=Be("button"),Kt(o.$$.fragment),l=xt(" Show more"),this.h()},l(n){r=Re(n,"BUTTON",{class:!0});var m=Ne(r);ei(o.$$.fragment,m),l=wt(m," Show more"),m.forEach(Q),this.h()},h(){fe(r,"class","btn-link")},m(n,m){Ie(n,r,m),Jt(o,r,null),ke(r,l),c=!0,f||(d=ms(r,"click",u[8]),f=!0)},p:ci,i(n){c||(De(o.$$.fragment,n),c=!0)},o(n){Xe(o.$$.fragment,n),c=!1},d(n){n&&Q(r),Yt(o),f=!1,d()}}}function a0(u){let r,o,l,c=u[7][u[5].label]>0&&Cp(u),f=u[7][u[5].label]<u[5].vars.length-1&&Ip(u);return{c(){c&&c.c(),r=ft(),f&&f.c(),o=ft()},l(d){c&&c.l(d),r=dt(d),f&&f.l(d),o=dt(d)},m(d,n){c&&c.m(d,n),Ie(d,r,n),f&&f.m(d,n),Ie(d,o,n),l=!0},p(d,n){d[7][d[5].label]>0?c?(c.p(d,n),n&160&&De(c,1)):(c=Cp(d),c.c(),De(c,1),c.m(r.parentNode,r)):c&&(Ii(),Xe(c,1,1,()=>{c=null}),Pi()),d[7][d[5].label]<d[5].vars.length-1?f?(f.p(d,n),n&160&&De(f,1)):(f=Ip(d),f.c(),De(f,1),f.m(o.parentNode,o)):f&&(Ii(),Xe(f,1,1,()=>{f=null}),Pi())},i(d){l||(De(c),De(f),l=!0)},o(d){Xe(c),Xe(f),l=!1},d(d){c&&c.d(d),d&&Q(r),f&&f.d(d),d&&Q(o)}}}function Pp(u){let r,o,l;function c(...m){return u[11](u[25],...m)}function f(...m){return u[12](u[25],...m)}function d(m){u[14](m)}let n={columnTitle:u[5].label,options:u[25].cats,clickCallback:c,removeCatCallback:f,backButtonCallback:u[13],globalSelectedCategories:u[3],currentVar:u[5],disabled:u[4],$$slots:{default:[a0]},$$scope:{ctx:u}};return u[6]!==void 0&&(n.selected=u[6]),r=new o0({props:n}),Uc.push(()=>Vh(r,"selected",d)),{c(){Kt(r.$$.fragment)},l(m){ei(r.$$.fragment,m)},m(m,v){Jt(r,m,v),l=!0},p(m,v){u=m;const w={};v&32&&(w.columnTitle=u[5].label),v&160&&(w.options=u[25].cats),v&162&&(w.clickCallback=c),v&164&&(w.removeCatCallback=f),v&32&&(w.backButtonCallback=u[13]),v&8&&(w.globalSelectedCategories=u[3]),v&32&&(w.currentVar=u[5]),v&16&&(w.disabled=u[4]),v&268435616&&(w.$$scope={dirty:v,ctx:u}),!o&&v&64&&(o=!0,w.selected=u[6],Gh(()=>o=!1)),r.$set(w)},i(m){l||(De(r.$$.fragment,m),l=!0)},o(m){Xe(r.$$.fragment,m),l=!1},d(m){Yt(r,m)}}}function zp(u){let r,o,l=u[5]!=null&&Ap(u);return{c(){l&&l.c(),r=jt()},l(c){l&&l.l(c),r=jt()},m(c,f){l&&l.m(c,f),Ie(c,r,f),o=!0},p(c,f){c[5]!=null?l?(l.p(c,f),f&32&&De(l,1)):(l=Ap(c),l.c(),De(l,1),l.m(r.parentNode,r)):l&&(Ii(),Xe(l,1,1,()=>{l=null}),Pi())},i(c){o||(De(l),o=!0)},o(c){Xe(l),o=!1},d(c){l&&l.d(c),c&&Q(r)}}}function l0(u){let r,o,l,c,f=u[5],d,n,m;function v(b){u[10](b)}let w={columnTitle:"Select a variable",clickCallback:h0,options:u[0],globalSelectedCategories:u[3],hiddenOnMobile:u[5]!=null};u[5]!==void 0&&(w.selected=u[5]),o=new $1({props:w}),Uc.push(()=>Vh(o,"selected",v));let A=zp(u);return{c(){r=Be("div"),Kt(o.$$.fragment),c=ft(),A.c(),d=ft(),n=jt(),this.h()},l(b){r=Re(b,"DIV",{class:!0});var E=Ne(r);ei(o.$$.fragment,E),c=dt(E),A.l(E),E.forEach(Q),d=dt(b),n=jt(),this.h()},h(){fe(r,"class","container svelte-9mqv54")},m(b,E){Ie(b,r,E),Jt(o,r,null),ke(r,c),A.m(r,null),Ie(b,d,E),Ie(b,n,E),m=!0},p(b,[E]){const T={};E&1&&(T.options=b[0]),E&8&&(T.globalSelectedCategories=b[3]),E&32&&(T.hiddenOnMobile=b[5]!=null),!l&&E&32&&(l=!0,T.selected=b[5],Gh(()=>l=!1)),o.$set(T),E&32&&Li(f,f=b[5])?(Ii(),Xe(A,1,1,ci),Pi(),A=zp(b),A.c(),De(A,1),A.m(r,null)):A.p(b,E)},i(b){m||(De(o.$$.fragment,b),De(A),m=!0)},o(b){Xe(o.$$.fragment,b),Xe(A),m=!1},d(b){b&&Q(r),Yt(o),A.d(b),b&&Q(d),b&&Q(n)}}}function c0(u,r){console.log(u,r)}function u0(u,r){console.log(u,r)}const h0=()=>{};function f0(u,r,o){let l,{options:c=[]}=r,{clickCallback:f=c0}=r,{removeCatCallback:d=u0}=r,{globalSelectedCategories:n=[]}=r,{disabled:m=!1}=r,v=null,w=null;function A(){o(7,++l[v.label],l)}function b(){o(7,--l[v.label],l)}function E(W){v=W,o(5,v)}const T=(W,q)=>f(W,q),C=(W,q)=>d(W,q),z=()=>o(5,v=null);function B(W){w=W,o(6,w)}const O=(W,q)=>f(W,q);return u.$$set=W=>{"options"in W&&o(0,c=W.options),"clickCallback"in W&&o(1,f=W.clickCallback),"removeCatCallback"in W&&o(2,d=W.removeCatCallback),"globalSelectedCategories"in W&&o(3,n=W.globalSelectedCategories),"disabled"in W&&o(4,m=W.disabled)},u.$$.update=()=>{u.$$.dirty&1&&o(7,l=function(){let W={};return c.forEach(q=>W[q.label]=0),W}())},[c,f,d,n,m,v,w,l,A,b,E,T,C,z,B,O]}class d0 extends Vi{constructor(r){super(),Gi(this,r,f0,l0,Li,{options:0,clickCallback:1,removeCatCallback:2,globalSelectedCategories:3,disabled:4})}}var tg={exports:{}};(function(u,r){(function(o,l){u.exports=l()})(al,function(){var o,l,c;function f(n,m){if(!o)o=m;else if(!l)l=m;else{var v="var sharedChunk = {}; ("+o+")(sharedChunk); ("+l+")(sharedChunk);",w={};o(w),c=m(w),typeof window<"u"&&(c.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}f(["exports"],function(n){var m=v;function v(i,e,s,h){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(h-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=s,this.p2y=h}function w(i,e,s,h){const _=new m(i,e,s,h);return function(x){return _.solve(x)}}v.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,h=0;h<8;h++){var _=this.sampleCurveX(s)-i;if(Math.abs(_)<e)return s;var x=this.sampleCurveDerivativeX(s);if(Math.abs(x)<1e-6)break;s-=_/x}var S=0,P=1;for(s=i,h=0;h<20&&(_=this.sampleCurveX(s),!(Math.abs(_-i)<e));h++)i>_?S=s:P=s,s=.5*(P-S)+S;return s},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const A=w(.25,.1,.25,1);function b(i,e,s){return Math.min(s,Math.max(e,i))}function E(i,e,s){const h=s-e,_=((i-e)%h+h)%h+e;return _===e?s:_}function T(i,...e){for(const s of e)for(const h in s)i[h]=s[h];return i}let C=1;function z(i,e){i.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function B(i,e,s){const h={};for(const _ in i)h[_]=e.call(s||this,i[_],_,i);return h}function O(i,e,s){const h={};for(const _ in i)e.call(s||this,i[_],_,i)&&(h[_]=i[_]);return h}function W(i){return Array.isArray(i)?i.map(W):typeof i=="object"&&i?B(i,W):i}const q={};function Z(i){q[i]||(typeof console<"u"&&console.warn(i),q[i]=!0)}function ae(i,e,s){return(s.y-i.y)*(e.x-i.x)>(e.y-i.y)*(s.x-i.x)}function J(i){let e=0;for(let s,h,_=0,x=i.length,S=x-1;_<x;S=_++)s=i[_],h=i[S],e+=(h.x-s.x)*(s.y+h.y);return e}function he(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function we(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,h,_,x)=>{const S=_||x;return e[h]=!S||S.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let Se,ot,oe=null;function Ve(i){if(oe==null){const e=i.navigator?i.navigator.userAgent:null;oe=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return oe}function K(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ke={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const s=window.document.createElement("canvas"),h=s.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return s.width=i.width,s.height=i.height,h.drawImage(i,0,0,i.width,i.height),h.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(Se||(Se=document.createElement("a")),Se.href=i,Se.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ot==null&&(ot=matchMedia("(prefers-reduced-motion: reduce)")),ot.matches)}};var ht=ct;function ct(i,e){this.x=i,this.y=e}ct.prototype={clone:function(){return new ct(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,s=i.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),s=Math.sin(i),h=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=h,this},_rotateAround:function(i,e){var s=Math.cos(i),h=Math.sin(i),_=e.y+h*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-h*(this.y-e.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ct.convert=function(i){return i instanceof ct?i:Array.isArray(i)?new ct(i[0],i[1]):i};const Zt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Qe="mapbox-tiles";let Ut,je,Oe=500,Vt=50;function Et(){typeof caches>"u"||Ut||(Ut=caches.open(Qe))}let mt=1/0;const bi={supported:!1,testSupport:function(i){!et&&si&&(oi?mi(i):zi=i)}};let zi,si,et=!1,oi=!1;function mi(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,si),i.isContextLost())return;bi.supported=!0}catch{}i.deleteTexture(e),et=!0}typeof document<"u"&&(si=document.createElement("img"),si.onload=function(){zi&&mi(zi),zi=null,oi=!0},si.onerror=function(){et=!0,zi=null},si.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const tn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(tn);class Hi extends Error{constructor(e,s,h,_){super(`AJAXError: ${s} (${e}): ${h}`),this.status=e,this.statusText=s,this.url=h,this.body=_}}const j=he()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function nt(i,e){const s=new AbortController,h=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:j(),signal:s.signal});let _=!1,x=!1;return i.type==="json"&&h.headers.set("Accept","application/json"),((S,P,M)=>{if(x)return;const R=Date.now();fetch(h).then(U=>U.ok?((G,Y,ee)=>{(i.type==="arrayBuffer"?G.arrayBuffer():i.type==="json"?G.json():G.text()).then(te=>{x||(Y&&ee&&function(ge,pe,Pe){if(Et(),!Ut)return;const qe={status:pe.status,statusText:pe.statusText,headers:new Headers};pe.headers.forEach((Fe,it)=>qe.headers.set(it,Fe));const Ce=we(pe.headers.get("Cache-Control")||"");Ce["no-store"]||(Ce["max-age"]&&qe.headers.set("Expires",new Date(Pe+1e3*Ce["max-age"]).toUTCString()),new Date(qe.headers.get("Expires")).getTime()-Pe<42e4||function(Fe,it){if(je===void 0)try{new Response(new ReadableStream),je=!0}catch{je=!1}je?it(Fe.body):Fe.blob().then(it)}(pe,Fe=>{const it=new Response(Fe,qe);Et(),Ut&&Ut.then(tt=>tt.put(function(Lt){const Ot=Lt.indexOf("?");return Ot<0?Lt:Lt.slice(0,Ot)}(ge.url),it)).catch(tt=>Z(tt.message))}))}(h,Y,ee),_=!0,e(null,te,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(te=>{x||e(new Error(te.message))})})(U,null,R):U.blob().then(G=>e(new Hi(U.status,U.statusText,i.url,G)))).catch(U=>{U.code!==20&&e(new Error(U.message))})})(),{cancel:()=>{x=!0,_||s.abort()}}}const Je=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(he()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!he()){const h=i.url.substring(0,i.url.indexOf("://"));return(Zt.REGISTERED_PROTOCOLS[h]||nt)(i,e)}}if(!(/^file:/.test(s=i.url)||/^file:/.test(j())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return nt(i,e);if(he()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var s;return function(h,_){const x=new XMLHttpRequest;x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const S in h.headers)x.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=()=>{_(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let S=x.response;if(h.type==="json")try{S=JSON.parse(x.response)}catch(P){return _(P)}_(null,S,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else{const S=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});_(new Hi(x.status,x.statusText,h.url,S))}},x.send(h.body),{cancel:()=>x.abort()}}(i,e)},me=function(i,e){return Je(T(i,{type:"arrayBuffer"}),e)};function ce(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let rt,at;rt=[],at=0;const Ue=function(i,e){if(bi.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),at>=Zt.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return rt.push(x),x}at++;let s=!1;const h=()=>{if(!s)for(s=!0,at--;rt.length&&at<Zt.MAX_PARALLEL_IMAGE_REQUESTS;){const x=rt.shift(),{requestParameters:S,callback:P,cancelled:M}=x;M||(x.cancel=Ue(S,P).cancel)}},_=me(i,(x,S,P,M)=>{h(),x?e(x):S&&function(R,U){typeof createImageBitmap=="function"?function(G,Y){const ee=new Blob([new Uint8Array(G)],{type:"image/png"});createImageBitmap(ee).then(te=>{Y(null,te)}).catch(te=>{Y(new Error(`Could not load image because of ${te.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(R,U):function(G,Y){const ee=new Image;ee.onload=()=>{Y(null,ee),URL.revokeObjectURL(ee.src),ee.onload=null,window.requestAnimationFrame(()=>{ee.src=xe})},ee.onerror=()=>Y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const te=new Blob([new Uint8Array(G)],{type:"image/png"});ee.src=G.byteLength?URL.createObjectURL(te):xe}(R,U)}(S,(R,U)=>{R!=null?e(R):U!=null&&e(null,U,{cacheControl:P,expires:M})})});return{cancel:()=>{_.cancel(),h()}}};function _t(i,e,s){s[i]&&s[i].indexOf(e)!==-1||(s[i]=s[i]||[],s[i].push(e))}function Mt(i,e,s){if(s&&s[i]){const h=s[i].indexOf(e);h!==-1&&s[i].splice(h,1)}}class gt{constructor(e,s={}){T(this,s),this.type=e}}class Xt extends gt{constructor(e,s={}){super("error",T({error:e},s))}}class xi{on(e,s){return this._listeners=this._listeners||{},_t(e,s,this._listeners),this}off(e,s){return Mt(e,s,this._listeners),Mt(e,s,this._oneTimeListeners),this}once(e,s){return this._oneTimeListeners=this._oneTimeListeners||{},_t(e,s,this._oneTimeListeners),this}fire(e,s){typeof e=="string"&&(e=new gt(e,s||{}));const h=e.type;if(this.listens(h)){e.target=this;const _=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const P of _)P.call(this,e);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const P of x)Mt(h,P,this._oneTimeListeners),P.call(this,e);const S=this._eventedParent;S&&(T(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(e))}else e instanceof Xt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class pt{constructor(e,s,h,_){this.message=(e?`${e}: `:"")+h,_&&(this.identifier=_),s!=null&&s.__line__&&(this.line=s.__line__)}}function Wn(i){const e=i.value;return e?[new pt(i.key,e,"constants have been deprecated as of v8")]:[]}function nn(i,...e){for(const s of e)for(const h in s)i[h]=s[h];return i}function di(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ei(i){if(Array.isArray(i))return i.map(Ei);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const s in i)e[s]=Ei(i[s]);return e}return di(i)}class mn extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class Sn{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[h,_]of s)this.bindings[h]=_}concat(e){return new Sn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const gn={kind:"null"},bt={kind:"number"},li={kind:"string"},ri={kind:"boolean"},hn={kind:"color"},ar={kind:"object"},ti={kind:"value"},Vn={kind:"collator"},_n={kind:"formatted"},gs={kind:"padding"},an={kind:"resolvedImage"};function On(i,e){return{kind:"array",itemType:i,N:e}}function Bi(i){if(i.kind==="array"){const e=Bi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const _s=[gn,bt,li,ri,hn,_n,ar,On(ti),gs,an];function gr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!gr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const s of _s)if(!gr(s,e))return null}}return`Expected ${Bi(i)} but found ${Bi(e)} instead.`}function Hr(i,e){return e.some(s=>s.kind===i.kind)}function Wr(i,e){return e.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}var ys,Xr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function re(i){return(i=Math.round(i))<0?0:i>255?255:i}function N(i){return re(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function H(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function ie(i,e,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?i+(e-i)*s*6:2*s<1?e:3*s<2?i+(e-i)*(2/3-s)*6:i}try{ys={}.parseCSSColor=function(i){var e,s=i.replace(/ /g,"").toLowerCase();if(s in Xr)return Xr[s].slice();if(s[0]==="#")return s.length===4?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:s.length===7&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var h=s.indexOf("("),_=s.indexOf(")");if(h!==-1&&_+1===s.length){var x=s.substr(0,h),S=s.substr(h+1,_-(h+1)).split(","),P=1;switch(x){case"rgba":if(S.length!==4)return null;P=H(S.pop());case"rgb":return S.length!==3?null:[N(S[0]),N(S[1]),N(S[2]),P];case"hsla":if(S.length!==4)return null;P=H(S.pop());case"hsl":if(S.length!==3)return null;var M=(parseFloat(S[0])%360+360)%360/360,R=H(S[1]),U=H(S[2]),G=U<=.5?U*(R+1):U+R-U*R,Y=2*U-G;return[re(255*ie(Y,G,M+1/3)),re(255*ie(Y,G,M)),re(255*ie(Y,G,M-1/3)),P];default:return null}}return null}}catch{}class ne{constructor(e,s,h,_=1){this.r=e,this.g=s,this.b=h,this.a=_}static parse(e){if(!e)return;if(e instanceof ne)return e;if(typeof e!="string")return;const s=ys(e);return s?new ne(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,h,_]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(h)},${_})`}toArray(){const{r:e,g:s,b:h,a:_}=this;return _===0?[0,0,0,0]:[255*e/_,255*s/_,255*h/_,_]}}ne.black=new ne(0,0,0,1),ne.white=new ne(1,1,1,1),ne.transparent=new ne(0,0,0,0),ne.red=new ne(1,0,0,1);class _e{constructor(e,s,h){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ee{constructor(e,s,h,_,x){this.text=e,this.image=s,this.scale=h,this.fontStack=_,this.textColor=x}}class ve{constructor(e){this.sections=e}static fromString(e){return new ve([new Ee(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ve?e:ve.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ye{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ye)return e;if(typeof e=="number")return new ye([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const s of e)if(typeof s!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ye(e)}}toString(){return JSON.stringify(this.values)}}class Te{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Te({name:e,available:!1}):null}}function He(i,e,s,h){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[i,e,s,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[i,e,s,h]:[i,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function st(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ne||i instanceof _e||i instanceof ve||i instanceof ye||i instanceof Te)return!0;if(Array.isArray(i)){for(const e of i)if(!st(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!st(i[e]))return!1;return!0}return!1}function Ze(i){if(i===null)return gn;if(typeof i=="string")return li;if(typeof i=="boolean")return ri;if(typeof i=="number")return bt;if(i instanceof ne)return hn;if(i instanceof _e)return Vn;if(i instanceof ve)return _n;if(i instanceof ye)return gs;if(i instanceof Te)return an;if(Array.isArray(i)){const e=i.length;let s;for(const h of i){const _=Ze(h);if(s){if(s===_)continue;s=ti;break}s=_}return On(s||ti,e)}return ar}function Rt(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof ne||i instanceof ve||i instanceof ye||i instanceof Te?i.toString():JSON.stringify(i)}class Ft{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!st(e[1]))return s.error("invalid value");const h=e[1];let _=Ze(h);const x=s.expectedType;return _.kind!=="array"||_.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(_=x),new Ft(_,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Pt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Qt={string:li,number:bt,boolean:ri,object:ar};class ii{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let h,_=1;const x=e[0];if(x==="array"){let P,M;if(e.length>2){const R=e[1];if(typeof R!="string"||!(R in Qt)||R==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);P=Qt[R],_++}else P=ti;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);M=e[2],_++}h=On(P,M)}else{if(!Qt[x])throw new Error(`Types doesn't contain name = ${x}`);h=Qt[x]}const S=[];for(;_<e.length;_++){const P=s.parse(e[_],_,ti);if(!P)return null;S.push(P)}return new ii(h,S)}evaluate(e){for(let s=0;s<this.args.length;s++){const h=this.args[s].evaluate(e);if(!gr(this.type,Ze(h)))return h;if(s===this.args.length-1)throw new Pt(`Expected value to be of type ${Bi(this.type)}, but found ${Bi(Ze(h))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const wi={"to-boolean":ri,"to-color":hn,"to-number":bt,"to-string":li};class ni{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const h=e[0];if(!wi[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&e.length!==2)return s.error("Expected one argument.");const _=wi[h],x=[];for(let S=1;S<e.length;S++){const P=s.parse(e[S],S,ti);if(!P)return null;x.push(P)}return new ni(_,x)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let s,h;for(const _ of this.args){if(s=_.evaluate(e),h=null,s instanceof ne)return s;if(typeof s=="string"){const x=e.parseColor(s);if(x)return x}else if(Array.isArray(s)&&(h=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:He(s[0],s[1],s[2],s[3]),!h))return new ne(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Pt(h||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}if(this.type.kind==="padding"){let s;for(const h of this.args){s=h.evaluate(e);const _=ye.parse(s);if(_)return _}throw new Pt(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}if(this.type.kind==="number"){let s=null;for(const h of this.args){if(s=h.evaluate(e),s===null)return 0;const _=Number(s);if(!isNaN(_))return _}throw new Pt(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?ve.fromString(Rt(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Te.fromString(Rt(this.args[0].evaluate(e))):Rt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ui=["Unknown","Point","LineString","Polygon"];class ki{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ui[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=ne.parse(e)),s}}class Oi{constructor(e,s,h,_){this.name=e,this.type=s,this._evaluate=h,this.args=_}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,s){const h=e[0],_=Oi.definitions[h];if(!_)return s.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(_)?_[0]:_.type,S=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,P=S.filter(([R])=>!Array.isArray(R)||R.length===e.length-1);let M=null;for(const[R,U]of P){M=new xs(s.registry,s.path,null,s.scope);const G=[];let Y=!1;for(let ee=1;ee<e.length;ee++){const te=e[ee],ge=Array.isArray(R)?R[ee-1]:R.type,pe=M.parse(te,1+G.length,ge);if(!pe){Y=!0;break}G.push(pe)}if(!Y)if(Array.isArray(R)&&R.length!==G.length)M.error(`Expected ${R.length} arguments, but found ${G.length} instead.`);else{for(let ee=0;ee<G.length;ee++){const te=Array.isArray(R)?R[ee]:R.type,ge=G[ee];M.concat(ee+1).checkSubtype(te,ge.type)}if(M.errors.length===0)return new Oi(h,x,U,G)}}if(P.length===1)s.errors.push(...M.errors);else{const R=(P.length?P:S).map(([G])=>{return Y=G,Array.isArray(Y)?`(${Y.map(Bi).join(", ")})`:`(${Bi(Y.type)}...)`;var Y}).join(" | "),U=[];for(let G=1;G<e.length;G++){const Y=s.parse(e[G],1+U.length);if(!Y)return null;U.push(Bi(Y.type))}s.error(`Expected arguments of type ${R}, but found (${U.join(", ")}) instead.`)}return null}static register(e,s){Oi.definitions=s;for(const h in s)e[h]=Oi}}class yn{constructor(e,s,h){this.type=Vn,this.locale=h,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const h=e[1];if(typeof h!="object"||Array.isArray(h))return s.error("Collator options argument must be an object.");const _=s.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,ri);if(!_)return null;const x=s.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,ri);if(!x)return null;let S=null;return h.locale&&(S=s.parse(h.locale,1,li),!S)?null:new yn(_,x,S)}evaluate(e){return new _e(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Wi=8192;function Mn(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function vs(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Ns(i,e){const s=(180+i[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,_=Math.pow(2,e.z);return[Math.round(s*_*Wi),Math.round(h*_*Wi)]}function Fi(i,e,s){const h=i[0]-e[0],_=i[1]-e[1],x=i[0]-s[0],S=i[1]-s[1];return h*S-x*_==0&&h*x<=0&&_*S<=0}function ra(i,e){let s=!1;for(let S=0,P=e.length;S<P;S++){const M=e[S];for(let R=0,U=M.length;R<U-1;R++){if(Fi(i,M[R],M[R+1]))return!1;(_=M[R])[1]>(h=i)[1]!=(x=M[R+1])[1]>h[1]&&h[0]<(x[0]-_[0])*(h[1]-_[1])/(x[1]-_[1])+_[0]&&(s=!s)}}var h,_,x;return s}function sa(i,e){for(let s=0;s<e.length;s++)if(ra(i,e[s]))return!0;return!1}function yl(i,e,s,h){const _=h[0]-s[0],x=h[1]-s[1],S=(i[0]-s[0])*x-_*(i[1]-s[1]),P=(e[0]-s[0])*x-_*(e[1]-s[1]);return S>0&&P<0||S<0&&P>0}function vl(i,e,s){for(const R of s)for(let U=0;U<R.length-1;++U)if((P=[(S=R[U+1])[0]-(x=R[U])[0],S[1]-x[1]])[0]*(M=[(_=e)[0]-(h=i)[0],_[1]-h[1]])[1]-P[1]*M[0]!=0&&yl(h,_,x,S)&&yl(x,S,h,_))return!0;var h,_,x,S,P,M;return!1}function oa(i,e){for(let s=0;s<i.length;++s)if(!ra(i[s],e))return!1;for(let s=0;s<i.length-1;++s)if(vl(i[s],i[s+1],e))return!1;return!0}function qc(i,e){for(let s=0;s<e.length;s++)if(oa(i,e[s]))return!0;return!1}function bo(i,e,s){const h=[];for(let _=0;_<i.length;_++){const x=[];for(let S=0;S<i[_].length;S++){const P=Ns(i[_][S],s);Mn(e,P),x.push(P)}h.push(x)}return h}function aa(i,e,s){const h=[];for(let _=0;_<i.length;_++){const x=bo(i[_],e,s);h.push(x)}return h}function bl(i,e,s,h){if(i[0]<s[0]||i[0]>s[2]){const _=.5*h;let x=i[0]-s[0]>_?-h:s[0]-i[0]>_?h:0;x===0&&(x=i[0]-s[2]>_?-h:s[2]-i[0]>_?h:0),i[0]+=x}Mn(e,i)}function xl(i,e,s,h){const _=Math.pow(2,h.z)*Wi,x=[h.x*Wi,h.y*Wi],S=[];for(const P of i)for(const M of P){const R=[M.x+x[0],M.y+x[1]];bl(R,e,s,_),S.push(R)}return S}function wl(i,e,s,h){const _=Math.pow(2,h.z)*Wi,x=[h.x*Wi,h.y*Wi],S=[];for(const M of i){const R=[];for(const U of M){const G=[U.x+x[0],U.y+x[1]];Mn(e,G),R.push(G)}S.push(R)}if(e[2]-e[0]<=_/2){(P=e)[0]=P[1]=1/0,P[2]=P[3]=-1/0;for(const M of S)for(const R of M)bl(R,e,s,_)}var P;return S}class Kr{constructor(e,s){this.type=ri,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(st(e[1])){const h=e[1];if(h.type==="FeatureCollection")for(let _=0;_<h.features.length;++_){const x=h.features[_].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Kr(h,h.features[_].geometry)}else if(h.type==="Feature"){const _=h.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Kr(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Kr(h,h)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,h){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(h.type==="Polygon"){const P=bo(h.coordinates,x,S),M=xl(s.geometry(),_,x,S);if(!vs(_,x))return!1;for(const R of M)if(!ra(R,P))return!1}if(h.type==="MultiPolygon"){const P=aa(h.coordinates,x,S),M=xl(s.geometry(),_,x,S);if(!vs(_,x))return!1;for(const R of M)if(!sa(R,P))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,h){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(h.type==="Polygon"){const P=bo(h.coordinates,x,S),M=wl(s.geometry(),_,x,S);if(!vs(_,x))return!1;for(const R of M)if(!oa(R,P))return!1}if(h.type==="MultiPolygon"){const P=aa(h.coordinates,x,S),M=wl(s.geometry(),_,x,S);if(!vs(_,x))return!1;for(const R of M)if(!qc(R,P))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Us(i){if(i instanceof Oi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Kr)return!1;let e=!0;return i.eachChild(s=>{e&&!Us(s)&&(e=!1)}),e}function bs(i){if(i instanceof Oi&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(s=>{e&&!bs(s)&&(e=!1)}),e}function xo(i,e){if(i instanceof Oi&&e.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(h=>{s&&!xo(h,e)&&(s=!1)}),s}class wo{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const h=e[1];return s.scope.has(h)?new wo(h,s.scope.get(h)):s.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class xs{constructor(e,s=[],h,_=new Sn,x=[]){this.registry=e,this.path=s,this.key=s.map(S=>`[${S}]`).join(""),this.scope=_,this.errors=x,this.expectedType=h}parse(e,s,h,_,x={}){return s?this.concat(s,h,_)._parse(e,x):this._parse(e,x)}_parse(e,s){function h(_,x,S){return S==="assert"?new ii(x,[_]):S==="coerce"?new ni(x,[_]):_}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=e[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[_];if(x){let S=x.parse(e,this);if(!S)return null;if(this.expectedType){const P=this.expectedType,M=S.type;if(P.kind!=="string"&&P.kind!=="number"&&P.kind!=="boolean"&&P.kind!=="object"&&P.kind!=="array"||M.kind!=="value")if(P.kind!=="color"&&P.kind!=="formatted"&&P.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(P.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array"){if(this.checkSubtype(P,M))return null}else S=h(S,P,s.typeAnnotation||"coerce");else S=h(S,P,s.typeAnnotation||"coerce");else S=h(S,P,s.typeAnnotation||"assert")}if(!(S instanceof Ft)&&S.type.kind!=="resolvedImage"&&la(S)){const P=new ki;try{S=new Ft(S.type,S.evaluate(P))}catch(M){return this.error(M.message),null}}return S}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,h){const _=typeof e=="number"?this.path.concat(e):this.path,x=h?this.scope.concat(h):this.scope;return new xs(this.registry,_,s||null,x,this.errors)}error(e,...s){const h=`${this.key}${s.map(_=>`[${_}]`).join("")}`;this.errors.push(new mn(h,e))}checkSubtype(e,s){const h=gr(e,s);return h&&this.error(h),h}}function la(i){if(i instanceof wo)return la(i.boundExpression);if(i instanceof Oi&&i.name==="error"||i instanceof yn||i instanceof Kr)return!1;const e=i instanceof ni||i instanceof ii;let s=!0;return i.eachChild(h=>{s=e?s&&la(h):s&&h instanceof Ft}),!!s&&Us(i)&&xo(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ko(i,e){const s=i.length-1;let h,_,x=0,S=s,P=0;for(;x<=S;)if(P=Math.floor((x+S)/2),h=i[P],_=i[P+1],h<=e){if(P===s||e<_)return P;x=P+1}else{if(!(h>e))throw new Pt("Input is not a number.");S=P-1}return 0}class Vs{constructor(e,s,h){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[_,x]of h)this.labels.push(_),this.outputs.push(x)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const h=s.parse(e[1],1,bt);if(!h)return null;const _=[];let x=null;s.expectedType&&s.expectedType.kind!=="value"&&(x=s.expectedType);for(let S=1;S<e.length;S+=2){const P=S===1?-1/0:e[S],M=e[S+1],R=S,U=S+1;if(typeof P!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(_.length&&_[_.length-1][0]>=P)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const G=s.parse(M,U,x);if(!G)return null;x=x||G.type,_.push([P,G])}return new Vs(x,h,_)}evaluate(e){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(e);const _=this.input.evaluate(e);if(_<=s[0])return h[0].evaluate(e);const x=s.length;return _>=s[x-1]?h[x-1].evaluate(e):h[ko(s,_)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Xi(i,e,s){return i*(1-s)+e*s}var Gs=Object.freeze({__proto__:null,number:Xi,color:function(i,e,s){return new ne(Xi(i.r,e.r,s),Xi(i.g,e.g,s),Xi(i.b,e.b,s),Xi(i.a,e.a,s))},array:function(i,e,s){return i.map((h,_)=>Xi(h,e[_],s))},padding:function(i,e,s){const h=i.values,_=e.values;return new ye([Xi(h[0],_[0],s),Xi(h[1],_[1],s),Xi(h[2],_[2],s),Xi(h[3],_[3],s)])}});const kl=.95047,Sl=1.08883,ca=4/29,So=6/29,El=3*So*So,Zc=Math.PI/180,Hc=180/Math.PI;function ua(i){return i>.008856451679035631?Math.pow(i,1/3):i/El+ca}function ha(i){return i>So?i*i*i:El*(i-ca)}function fa(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function da(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ti(i){const e=da(i.r),s=da(i.g),h=da(i.b),_=ua((.4124564*e+.3575761*s+.1804375*h)/kl),x=ua((.2126729*e+.7151522*s+.072175*h)/1);return{l:116*x-16,a:500*(_-x),b:200*(x-ua((.0193339*e+.119192*s+.9503041*h)/Sl)),alpha:i.a}}function Tl(i){let e=(i.l+16)/116,s=isNaN(i.a)?e:e+i.a/500,h=isNaN(i.b)?e:e-i.b/200;return e=1*ha(e),s=kl*ha(s),h=Sl*ha(h),new ne(fa(3.2404542*s-1.5371385*e-.4985314*h),fa(-.969266*s+1.8760108*e+.041556*h),fa(.0556434*s-.2040259*e+1.0572252*h),i.alpha)}function Wc(i,e,s){const h=e-i;return i+s*(h>180||h<-180?h-360*Math.round(h/360):h)}const js={forward:Ti,reverse:Tl,interpolate:function(i,e,s){return{l:Xi(i.l,e.l,s),a:Xi(i.a,e.a,s),b:Xi(i.b,e.b,s),alpha:Xi(i.alpha,e.alpha,s)}}},qs={forward:function(i){const{l:e,a:s,b:h}=Ti(i),_=Math.atan2(h,s)*Hc;return{h:_<0?_+360:_,c:Math.sqrt(s*s+h*h),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Zc,s=i.c;return Tl({l:i.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:i.alpha})},interpolate:function(i,e,s){return{h:Wc(i.h,e.h,s),c:Xi(i.c,e.c,s),l:Xi(i.l,e.l,s),alpha:Xi(i.alpha,e.alpha,s)}}};var Al=Object.freeze({__proto__:null,lab:js,hcl:qs});class Xn{constructor(e,s,h,_,x){this.type=e,this.operator=s,this.interpolation=h,this.input=_,this.labels=[],this.outputs=[];for(const[S,P]of x)this.labels.push(S),this.outputs.push(P)}static interpolationFactor(e,s,h,_){let x=0;if(e.name==="exponential")x=pa(s,e.base,h,_);else if(e.name==="linear")x=pa(s,1,h,_);else if(e.name==="cubic-bezier"){const S=e.controlPoints;x=new m(S[0],S[1],S[2],S[3]).solve(pa(s,1,h,_))}return x}static parse(e,s){let[h,_,x,...S]=e;if(!Array.isArray(_)||_.length===0)return s.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const R=_[1];if(typeof R!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:R}}else{if(_[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const R=_.slice(1);if(R.length!==4||R.some(U=>typeof U!="number"||U<0||U>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:R}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(x=s.parse(x,2,bt),!x)return null;const P=[];let M=null;h==="interpolate-hcl"||h==="interpolate-lab"?M=hn:s.expectedType&&s.expectedType.kind!=="value"&&(M=s.expectedType);for(let R=0;R<S.length;R+=2){const U=S[R],G=S[R+1],Y=R+3,ee=R+4;if(typeof U!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(P.length&&P[P.length-1][0]>=U)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const te=s.parse(G,ee,M);if(!te)return null;M=M||te.type,P.push([U,te])}return M.kind==="number"||M.kind==="color"||M.kind==="padding"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new Xn(M,h,_,x,P):s.error(`Type ${Bi(M)} is not interpolatable.`)}evaluate(e){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(e);const _=this.input.evaluate(e);if(_<=s[0])return h[0].evaluate(e);const x=s.length;if(_>=s[x-1])return h[x-1].evaluate(e);const S=ko(s,_),P=Xn.interpolationFactor(this.interpolation,_,s[S],s[S+1]),M=h[S].evaluate(e),R=h[S+1].evaluate(e);return this.operator==="interpolate"?Gs[this.type.kind.toLowerCase()](M,R,P):this.operator==="interpolate-hcl"?qs.reverse(qs.interpolate(qs.forward(M),qs.forward(R),P)):js.reverse(js.interpolate(js.forward(M),js.forward(R),P))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function pa(i,e,s,h){const _=h-s,x=i-s;return _===0?0:e===1?x/_:(Math.pow(e,x)-1)/(Math.pow(e,_)-1)}class Eo{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let h=null;const _=s.expectedType;_&&_.kind!=="value"&&(h=_);const x=[];for(const P of e.slice(1)){const M=s.parse(P,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!M)return null;h=h||M.type,x.push(M)}if(!h)throw new Error("No output type");const S=_&&x.some(P=>gr(_,P.type));return new Eo(S?ti:h,x)}evaluate(e){let s,h=null,_=0;for(const x of this.args)if(_++,h=x.evaluate(e),h&&h instanceof Te&&!h.available&&(s||(s=h.name),h=null,_===this.args.length&&(h=s)),h!==null)break;return h}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class To{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const h=[];for(let x=1;x<e.length-1;x+=2){const S=e[x];if(typeof S!="string")return s.error(`Expected string, but found ${typeof S} instead.`,x);if(/[^a-zA-Z0-9_]/.test(S))return s.error("Variable names must contain only alphanumeric characters or '_'.",x);const P=s.parse(e[x+1],x+1);if(!P)return null;h.push([S,P])}const _=s.parse(e[e.length-1],e.length-1,s.expectedType,h);return _?new To(h,_):null}outputDefined(){return this.result.outputDefined()}}class ma{constructor(e,s,h){this.type=e,this.index=s,this.input=h}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,bt),_=s.parse(e[2],2,On(s.expectedType||ti));return h&&_?new ma(_.type.itemType,h,_):null}evaluate(e){const s=this.index.evaluate(e),h=this.input.evaluate(e);if(s<0)throw new Pt(`Array index out of bounds: ${s} < 0.`);if(s>=h.length)throw new Pt(`Array index out of bounds: ${s} > ${h.length-1}.`);if(s!==Math.floor(s))throw new Pt(`Array index must be an integer, but found ${s} instead.`);return h[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ga{constructor(e,s){this.type=ri,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,ti),_=s.parse(e[2],2,ti);return h&&_?Hr(h.type,[ri,li,bt,gn,ti])?new ga(h,_):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(h.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!h)return!1;if(!Wr(s,["boolean","string","number","null"]))throw new Pt(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(Ze(s))} instead.`);if(!Wr(h,["string","array"]))throw new Pt(`Expected second argument to be of type array or string, but found ${Bi(Ze(h))} instead.`);return h.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ao{constructor(e,s,h){this.type=bt,this.needle=e,this.haystack=s,this.fromIndex=h}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,ti),_=s.parse(e[2],2,ti);if(!h||!_)return null;if(!Hr(h.type,[ri,li,bt,gn,ti]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(h.type)} instead`);if(e.length===4){const x=s.parse(e[3],3,bt);return x?new Ao(h,_,x):null}return new Ao(h,_)}evaluate(e){const s=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!Wr(s,["boolean","string","number","null"]))throw new Pt(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(Ze(s))} instead.`);if(!Wr(h,["string","array"]))throw new Pt(`Expected second argument to be of type array or string, but found ${Bi(Ze(h))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(e);return h.indexOf(s,_)}return h.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class _a{constructor(e,s,h,_,x,S){this.inputType=e,this.type=s,this.input=h,this.cases=_,this.outputs=x,this.otherwise=S}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let h,_;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);const x={},S=[];for(let R=2;R<e.length-1;R+=2){let U=e[R];const G=e[R+1];Array.isArray(U)||(U=[U]);const Y=s.concat(R);if(U.length===0)return Y.error("Expected at least one branch label.");for(const te of U){if(typeof te!="number"&&typeof te!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof te=="number"&&Math.floor(te)!==te)return Y.error("Numeric branch labels must be integer values.");if(h){if(Y.checkSubtype(h,Ze(te)))return null}else h=Ze(te);if(x[String(te)]!==void 0)return Y.error("Branch labels must be unique.");x[String(te)]=S.length}const ee=s.parse(G,R,_);if(!ee)return null;_=_||ee.type,S.push(ee)}const P=s.parse(e[1],1,ti);if(!P)return null;const M=s.parse(e[e.length-1],e.length-1,_);return M?P.type.kind!=="value"&&s.concat(1).checkSubtype(h,P.type)?null:new _a(h,_,P,x,S,M):null}evaluate(e){const s=this.input.evaluate(e);return(Ze(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class ya{constructor(e,s,h){this.type=e,this.branches=s,this.otherwise=h}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const _=[];for(let S=1;S<e.length-1;S+=2){const P=s.parse(e[S],S,ri);if(!P)return null;const M=s.parse(e[S+1],S+1,h);if(!M)return null;_.push([P,M]),h=h||M.type}const x=s.parse(e[e.length-1],e.length-1,h);if(!x)return null;if(!h)throw new Error("Can't infer output type");return new ya(h,_,x)}evaluate(e){for(const[s,h]of this.branches)if(s.evaluate(e))return h.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,h]of this.branches)e(s),e(h);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Co{constructor(e,s,h,_){this.type=e,this.input=s,this.beginIndex=h,this.endIndex=_}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,ti),_=s.parse(e[2],2,bt);if(!h||!_)return null;if(!Hr(h.type,[On(ti),li,ti]))return s.error(`Expected first argument to be of type array or string, but found ${Bi(h.type)} instead`);if(e.length===4){const x=s.parse(e[3],3,bt);return x?new Co(h.type,h,_,x):null}return new Co(h.type,h,_)}evaluate(e){const s=this.input.evaluate(e),h=this.beginIndex.evaluate(e);if(!Wr(s,["string","array"]))throw new Pt(`Expected first argument to be of type array or string, but found ${Bi(Ze(s))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(e);return s.slice(h,_)}return s.slice(h)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Cl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Il(i,e,s,h){return h.compare(e,s)===0}function ws(i,e,s){const h=i!=="=="&&i!=="!=";return class ig{constructor(x,S,P){this.type=ri,this.lhs=x,this.rhs=S,this.collator=P,this.hasUntypedArgument=x.type.kind==="value"||S.type.kind==="value"}static parse(x,S){if(x.length!==3&&x.length!==4)return S.error("Expected two or three arguments.");const P=x[0];let M=S.parse(x[1],1,ti);if(!M)return null;if(!Cl(P,M.type))return S.concat(1).error(`"${P}" comparisons are not supported for type '${Bi(M.type)}'.`);let R=S.parse(x[2],2,ti);if(!R)return null;if(!Cl(P,R.type))return S.concat(2).error(`"${P}" comparisons are not supported for type '${Bi(R.type)}'.`);if(M.type.kind!==R.type.kind&&M.type.kind!=="value"&&R.type.kind!=="value")return S.error(`Cannot compare types '${Bi(M.type)}' and '${Bi(R.type)}'.`);h&&(M.type.kind==="value"&&R.type.kind!=="value"?M=new ii(R.type,[M]):M.type.kind!=="value"&&R.type.kind==="value"&&(R=new ii(M.type,[R])));let U=null;if(x.length===4){if(M.type.kind!=="string"&&R.type.kind!=="string"&&M.type.kind!=="value"&&R.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(U=S.parse(x[3],3,Vn),!U)return null}return new ig(M,R,U)}evaluate(x){const S=this.lhs.evaluate(x),P=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const M=Ze(S),R=Ze(P);if(M.kind!==R.kind||M.kind!=="string"&&M.kind!=="number")throw new Pt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${M.kind}, ${R.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const M=Ze(S),R=Ze(P);if(M.kind!=="string"||R.kind!=="string")return e(x,S,P)}return this.collator?s(x,S,P,this.collator.evaluate(x)):e(x,S,P)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Xc=ws("==",function(i,e,s){return e===s},Il),Kc=ws("!=",function(i,e,s){return e!==s},function(i,e,s,h){return!Il(0,e,s,h)}),Jc=ws("<",function(i,e,s){return e<s},function(i,e,s,h){return h.compare(e,s)<0}),Yc=ws(">",function(i,e,s){return e>s},function(i,e,s,h){return h.compare(e,s)>0}),Qc=ws("<=",function(i,e,s){return e<=s},function(i,e,s,h){return h.compare(e,s)<=0}),$c=ws(">=",function(i,e,s){return e>=s},function(i,e,s,h){return h.compare(e,s)>=0});class va{constructor(e,s,h,_,x){this.type=li,this.number=e,this.locale=s,this.currency=h,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const h=s.parse(e[1],1,bt);if(!h)return null;const _=e[2];if(typeof _!="object"||Array.isArray(_))return s.error("NumberFormat options argument must be an object.");let x=null;if(_.locale&&(x=s.parse(_.locale,1,li),!x))return null;let S=null;if(_.currency&&(S=s.parse(_.currency,1,li),!S))return null;let P=null;if(_["min-fraction-digits"]&&(P=s.parse(_["min-fraction-digits"],1,bt),!P))return null;let M=null;return _["max-fraction-digits"]&&(M=s.parse(_["max-fraction-digits"],1,bt),!M)?null:new va(h,x,S,P,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Io{constructor(e){this.type=_n,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const h=e[1];if(!Array.isArray(h)&&typeof h=="object")return s.error("First argument must be an image or text section.");const _=[];let x=!1;for(let S=1;S<=e.length-1;++S){const P=e[S];if(x&&typeof P=="object"&&!Array.isArray(P)){x=!1;let M=null;if(P["font-scale"]&&(M=s.parse(P["font-scale"],1,bt),!M))return null;let R=null;if(P["text-font"]&&(R=s.parse(P["text-font"],1,On(li)),!R))return null;let U=null;if(P["text-color"]&&(U=s.parse(P["text-color"],1,hn),!U))return null;const G=_[_.length-1];G.scale=M,G.font=R,G.textColor=U}else{const M=s.parse(e[S],1,ti);if(!M)return null;const R=M.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,_.push({content:M,scale:null,font:null,textColor:null})}}return new Io(_)}evaluate(e){return new ve(this.sections.map(s=>{const h=s.content.evaluate(e);return Ze(h)===an?new Ee("",h,null,null,null):new Ee(Rt(h),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}}class ba{constructor(e){this.type=an,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const h=s.parse(e[1],1,li);return h?new ba(h):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),h=Te.fromString(s);return h&&e.availableImages&&(h.available=e.availableImages.indexOf(s)>-1),h}eachChild(e){e(this.input)}outputDefined(){return!1}}class xa{constructor(e){this.type=bt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const h=s.parse(e[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Bi(h.type)} instead.`):new xa(h):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Pt(`Expected value to be of type string or array, but found ${Bi(Ze(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ks={"==":Xc,"!=":Kc,">":Yc,"<":Jc,">=":$c,"<=":Qc,array:ii,at:ma,boolean:ii,case:ya,coalesce:Eo,collator:yn,format:Io,image:ba,in:ga,"index-of":Ao,interpolate:Xn,"interpolate-hcl":Xn,"interpolate-lab":Xn,length:xa,let:To,literal:Ft,match:_a,number:ii,"number-format":va,object:ii,slice:Co,step:Vs,string:ii,"to-boolean":ni,"to-color":ni,"to-number":ni,"to-string":ni,var:wo,within:Kr};function Pl(i,[e,s,h,_]){e=e.evaluate(i),s=s.evaluate(i),h=h.evaluate(i);const x=_?_.evaluate(i):1,S=He(e,s,h,x);if(S)throw new Pt(S);return new ne(e/255*x,s/255*x,h/255*x,x)}function zl(i,e){return i in e}function Po(i,e){const s=e[i];return s===void 0?null:s}function Jr(i){return{type:i}}function Ml(i){return{result:"success",value:i}}function Ss(i){return{result:"error",value:i}}function qi(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Dl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function yi(i){return!!i.expression&&i.expression.interpolated}function Ai(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ji(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Ki(i){return i}function Zs(i,e){const s=e.type==="color",h=i.stops&&typeof i.stops[0][0]=="object",_=h||!(h||i.property!==void 0),x=i.type||(yi(e)?"exponential":"interval");if(s||e.type==="padding"){const R=s?ne.parse:ye.parse;(i=nn({},i)).stops&&(i.stops=i.stops.map(U=>[U[0],R(U[1])])),i.default=R(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!Al[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let S,P,M;if(x==="exponential")S=Ll;else if(x==="interval")S=tu;else if(x==="categorical"){S=eu,P=Object.create(null);for(const R of i.stops)P[R[0]]=R[1];M=typeof i.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);S=iu}if(h){const R={},U=[];for(let ee=0;ee<i.stops.length;ee++){const te=i.stops[ee],ge=te[0].zoom;R[ge]===void 0&&(R[ge]={zoom:ge,type:i.type,property:i.property,default:i.default,stops:[]},U.push(ge)),R[ge].stops.push([te[0].value,te[1]])}const G=[];for(const ee of U)G.push([R[ee].zoom,Zs(R[ee],e)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:Xn.interpolationFactor.bind(void 0,Y),zoomStops:G.map(ee=>ee[0]),evaluate:({zoom:ee},te)=>Ll({stops:G,base:i.base},e,ee).evaluate(ee,te)}}if(_){const R=x==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Xn.interpolationFactor.bind(void 0,R),zoomStops:i.stops.map(U=>U[0]),evaluate:({zoom:U})=>S(i,e,U,P,M)}}return{kind:"source",evaluate(R,U){const G=U&&U.properties?U.properties[i.property]:void 0;return G===void 0?Es(i.default,e.default):S(i,e,G,P,M)}}}function Es(i,e,s){return i!==void 0?i:e!==void 0?e:s!==void 0?s:void 0}function eu(i,e,s,h,_){return Es(typeof s===_?h[s]:void 0,i.default,e.default)}function tu(i,e,s){if(Ai(s)!=="number")return Es(i.default,e.default);const h=i.stops.length;if(h===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const _=ko(i.stops.map(x=>x[0]),s);return i.stops[_][1]}function Ll(i,e,s){const h=i.base!==void 0?i.base:1;if(Ai(s)!=="number")return Es(i.default,e.default);const _=i.stops.length;if(_===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[_-1][0])return i.stops[_-1][1];const x=ko(i.stops.map(U=>U[0]),s),S=function(U,G,Y,ee){const te=ee-Y,ge=U-Y;return te===0?0:G===1?ge/te:(Math.pow(G,ge)-1)/(Math.pow(G,te)-1)}(s,h,i.stops[x][0],i.stops[x+1][0]),P=i.stops[x][1],M=i.stops[x+1][1];let R=Gs[e.type]||Ki;if(i.colorSpace&&i.colorSpace!=="rgb"){const U=Al[i.colorSpace];R=(G,Y)=>U.reverse(U.interpolate(U.forward(G),U.forward(Y),S))}return typeof P.evaluate=="function"?{evaluate(...U){const G=P.evaluate.apply(void 0,U),Y=M.evaluate.apply(void 0,U);if(G!==void 0&&Y!==void 0)return R(G,Y,S)}}:R(P,M,S)}function iu(i,e,s){switch(e.type){case"color":s=ne.parse(s);break;case"formatted":s=ve.fromString(s.toString());break;case"resolvedImage":s=Te.fromString(s.toString());break;case"padding":s=ye.parse(s);break;default:Ai(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0)}return Es(s,i.default,e.default)}Oi.register(ks,{error:[{kind:"error"},[li],(i,[e])=>{throw new Pt(e.evaluate(i))}],typeof:[li,[ti],(i,[e])=>Bi(Ze(e.evaluate(i)))],"to-rgba":[On(bt,4),[hn],(i,[e])=>e.evaluate(i).toArray()],rgb:[hn,[bt,bt,bt],Pl],rgba:[hn,[bt,bt,bt,bt],Pl],has:{type:ri,overloads:[[[li],(i,[e])=>zl(e.evaluate(i),i.properties())],[[li,ar],(i,[e,s])=>zl(e.evaluate(i),s.evaluate(i))]]},get:{type:ti,overloads:[[[li],(i,[e])=>Po(e.evaluate(i),i.properties())],[[li,ar],(i,[e,s])=>Po(e.evaluate(i),s.evaluate(i))]]},"feature-state":[ti,[li],(i,[e])=>Po(e.evaluate(i),i.featureState||{})],properties:[ar,[],i=>i.properties()],"geometry-type":[li,[],i=>i.geometryType()],id:[ti,[],i=>i.id()],zoom:[bt,[],i=>i.globals.zoom],"heatmap-density":[bt,[],i=>i.globals.heatmapDensity||0],"line-progress":[bt,[],i=>i.globals.lineProgress||0],accumulated:[ti,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[bt,Jr(bt),(i,e)=>{let s=0;for(const h of e)s+=h.evaluate(i);return s}],"*":[bt,Jr(bt),(i,e)=>{let s=1;for(const h of e)s*=h.evaluate(i);return s}],"-":{type:bt,overloads:[[[bt,bt],(i,[e,s])=>e.evaluate(i)-s.evaluate(i)],[[bt],(i,[e])=>-e.evaluate(i)]]},"/":[bt,[bt,bt],(i,[e,s])=>e.evaluate(i)/s.evaluate(i)],"%":[bt,[bt,bt],(i,[e,s])=>e.evaluate(i)%s.evaluate(i)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(i,[e,s])=>Math.pow(e.evaluate(i),s.evaluate(i))],sqrt:[bt,[bt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[bt,[bt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[bt,[bt],(i,[e])=>Math.log(e.evaluate(i))],log2:[bt,[bt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[bt,[bt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[bt,[bt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[bt,[bt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[bt,[bt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[bt,[bt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[bt,[bt],(i,[e])=>Math.atan(e.evaluate(i))],min:[bt,Jr(bt),(i,e)=>Math.min(...e.map(s=>s.evaluate(i)))],max:[bt,Jr(bt),(i,e)=>Math.max(...e.map(s=>s.evaluate(i)))],abs:[bt,[bt],(i,[e])=>Math.abs(e.evaluate(i))],round:[bt,[bt],(i,[e])=>{const s=e.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[bt,[bt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[bt,[bt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ri,[li,ti],(i,[e,s])=>i.properties()[e.value]===s.value],"filter-id-==":[ri,[ti],(i,[e])=>i.id()===e.value],"filter-type-==":[ri,[li],(i,[e])=>i.geometryType()===e.value],"filter-<":[ri,[li,ti],(i,[e,s])=>{const h=i.properties()[e.value],_=s.value;return typeof h==typeof _&&h<_}],"filter-id-<":[ri,[ti],(i,[e])=>{const s=i.id(),h=e.value;return typeof s==typeof h&&s<h}],"filter->":[ri,[li,ti],(i,[e,s])=>{const h=i.properties()[e.value],_=s.value;return typeof h==typeof _&&h>_}],"filter-id->":[ri,[ti],(i,[e])=>{const s=i.id(),h=e.value;return typeof s==typeof h&&s>h}],"filter-<=":[ri,[li,ti],(i,[e,s])=>{const h=i.properties()[e.value],_=s.value;return typeof h==typeof _&&h<=_}],"filter-id-<=":[ri,[ti],(i,[e])=>{const s=i.id(),h=e.value;return typeof s==typeof h&&s<=h}],"filter->=":[ri,[li,ti],(i,[e,s])=>{const h=i.properties()[e.value],_=s.value;return typeof h==typeof _&&h>=_}],"filter-id->=":[ri,[ti],(i,[e])=>{const s=i.id(),h=e.value;return typeof s==typeof h&&s>=h}],"filter-has":[ri,[ti],(i,[e])=>e.value in i.properties()],"filter-has-id":[ri,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ri,[On(li)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ri,[On(ti)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ri,[li,On(ti)],(i,[e,s])=>s.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ri,[li,On(ti)],(i,[e,s])=>function(h,_,x,S){for(;x<=S;){const P=x+S>>1;if(_[P]===h)return!0;_[P]>h?S=P-1:x=P+1}return!1}(i.properties()[e.value],s.value,0,s.value.length-1)],all:{type:ri,overloads:[[[ri,ri],(i,[e,s])=>e.evaluate(i)&&s.evaluate(i)],[Jr(ri),(i,e)=>{for(const s of e)if(!s.evaluate(i))return!1;return!0}]]},any:{type:ri,overloads:[[[ri,ri],(i,[e,s])=>e.evaluate(i)||s.evaluate(i)],[Jr(ri),(i,e)=>{for(const s of e)if(s.evaluate(i))return!0;return!1}]]},"!":[ri,[ri],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ri,[li],(i,[e])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(e.evaluate(i))}],upcase:[li,[li],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[li,[li],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[li,Jr(ti),(i,e)=>e.map(s=>Rt(s.evaluate(i))).join("")],"resolved-locale":[li,[Vn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class zo{constructor(e,s){this.expression=e,this._warningHistory={},this._evaluator=new ki,this._defaultValue=s?function(h){return h.type==="color"&&ji(h.default)?new ne(0,0,0,0):h.type==="color"?ne.parse(h.default)||null:h.type==="padding"?ye.parse(h.default)||null:h.default===void 0?null:h.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,h,_,x,S){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=h,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(e,s,h,_,x,S){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=h||null,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=S||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Pt(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function Hs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ks}function Ws(i,e){const s=new xs(ks,[],e?function(_){const x={color:hn,string:li,number:bt,enum:li,boolean:ri,formatted:_n,padding:gs,resolvedImage:an};return _.type==="array"?On(x[_.value]||ti,_.length):x[_.type]}(e):void 0),h=s.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Ml(new zo(h,e)):Ss(s.errors)}class Xs{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!bs(s.expression)}evaluateWithoutErrorHandling(e,s,h,_,x,S){return this._styleExpression.evaluateWithoutErrorHandling(e,s,h,_,x,S)}evaluate(e,s,h,_,x,S){return this._styleExpression.evaluate(e,s,h,_,x,S)}}class wa{constructor(e,s,h,_){this.kind=e,this.zoomStops=h,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!bs(s.expression),this.interpolationType=_}evaluateWithoutErrorHandling(e,s,h,_,x,S){return this._styleExpression.evaluateWithoutErrorHandling(e,s,h,_,x,S)}evaluate(e,s,h,_,x,S){return this._styleExpression.evaluate(e,s,h,_,x,S)}interpolationFactor(e,s,h){return this.interpolationType?Xn.interpolationFactor(this.interpolationType,e,s,h):0}}function Bl(i,e){const s=Ws(i,e);if(s.result==="error")return s;const h=s.value.expression,_=Us(h);if(!_&&!qi(e))return Ss([new mn("","data expressions not supported")]);const x=xo(h,["zoom"]);if(!x&&!Dl(e))return Ss([new mn("","zoom expressions not supported")]);const S=Do(h);return S||x?S instanceof mn?Ss([S]):S instanceof Xn&&!yi(e)?Ss([new mn("",'"interpolate" expressions cannot be used with this property')]):Ml(S?new wa(_?"camera":"composite",s.value,S.labels,S instanceof Xn?S.interpolation:void 0):new Xs(_?"constant":"source",s.value)):Ss([new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Mo{constructor(e,s){this._parameters=e,this._specification=s,nn(this,Zs(this._parameters,this._specification))}static deserialize(e){return new Mo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Do(i){let e=null;if(i instanceof To)e=Do(i.result);else if(i instanceof Eo){for(const s of i.args)if(e=Do(s),e)break}else(i instanceof Vs||i instanceof Xn)&&i.input instanceof Oi&&i.input.name==="zoom"&&(e=i);return e instanceof mn||i.eachChild(s=>{const h=Do(s);h instanceof mn?e=h:!e&&h?e=new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&h&&e!==h&&(e=new mn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function lr(i){const e=i.key,s=i.value,h=i.valueSpec||{},_=i.objectElementValidators||{},x=i.style,S=i.styleSpec;let P=[];const M=Ai(s);if(M!=="object")return[new pt(e,s,`object expected, ${M} found`)];for(const R in s){const U=R.split(".")[0],G=h[U]||h["*"];let Y;if(_[U])Y=_[U];else if(h[U])Y=Jn;else if(_["*"])Y=_["*"];else{if(!h["*"]){P.push(new pt(e,s[R],`unknown property "${R}"`));continue}Y=Jn}P=P.concat(Y({key:(e&&`${e}.`)+R,value:s[R],valueSpec:G,style:x,styleSpec:S,object:s,objectKey:R},s))}for(const R in h)_[R]||h[R].required&&h[R].default===void 0&&s[R]===void 0&&P.push(new pt(e,s,`missing required property "${R}"`));return P}function Rl(i){const e=i.value,s=i.valueSpec,h=i.style,_=i.styleSpec,x=i.key,S=i.arrayElementValidator||Jn;if(Ai(e)!=="array")return[new pt(x,e,`array expected, ${Ai(e)} found`)];if(s.length&&e.length!==s.length)return[new pt(x,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new pt(x,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let P={type:s.value,values:s.values};_.$version<7&&(P.function=s.function),Ai(s.value)==="object"&&(P=s.value);let M=[];for(let R=0;R<e.length;R++)M=M.concat(S({array:e,arrayIndex:R,value:e[R],valueSpec:P,style:h,styleSpec:_,key:`${x}[${R}]`}));return M}function ka(i){const e=i.key,s=i.value,h=i.valueSpec;let _=Ai(s);return _==="number"&&s!=s&&(_="NaN"),_!=="number"?[new pt(e,s,`number expected, ${_} found`)]:"minimum"in h&&s<h.minimum?[new pt(e,s,`${s} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&s>h.maximum?[new pt(e,s,`${s} is greater than the maximum value ${h.maximum}`)]:[]}function Ol(i){const e=i.valueSpec,s=di(i.value.type);let h,_,x,S={};const P=s!=="categorical"&&i.value.property===void 0,M=!P,R=Ai(i.value.stops)==="array"&&Ai(i.value.stops[0])==="array"&&Ai(i.value.stops[0][0])==="object",U=lr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(ee){if(s==="identity")return[new pt(ee.key,ee.value,'identity function may not have a "stops" property')];let te=[];const ge=ee.value;return te=te.concat(Rl({key:ee.key,value:ge,valueSpec:ee.valueSpec,style:ee.style,styleSpec:ee.styleSpec,arrayElementValidator:G})),Ai(ge)==="array"&&ge.length===0&&te.push(new pt(ee.key,ge,"array must have at least one stop")),te},default:function(ee){return Jn({key:ee.key,value:ee.value,valueSpec:e,style:ee.style,styleSpec:ee.styleSpec})}}});return s==="identity"&&P&&U.push(new pt(i.key,i.value,'missing required property "property"')),s==="identity"||i.value.stops||U.push(new pt(i.key,i.value,'missing required property "stops"')),s==="exponential"&&i.valueSpec.expression&&!yi(i.valueSpec)&&U.push(new pt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(M&&!qi(i.valueSpec)?U.push(new pt(i.key,i.value,"property functions not supported")):P&&!Dl(i.valueSpec)&&U.push(new pt(i.key,i.value,"zoom functions not supported"))),s!=="categorical"&&!R||i.value.property!==void 0||U.push(new pt(i.key,i.value,'"property" property is required')),U;function G(ee){let te=[];const ge=ee.value,pe=ee.key;if(Ai(ge)!=="array")return[new pt(pe,ge,`array expected, ${Ai(ge)} found`)];if(ge.length!==2)return[new pt(pe,ge,`array length 2 expected, length ${ge.length} found`)];if(R){if(Ai(ge[0])!=="object")return[new pt(pe,ge,`object expected, ${Ai(ge[0])} found`)];if(ge[0].zoom===void 0)return[new pt(pe,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new pt(pe,ge,"object stop key must have value")];if(x&&x>di(ge[0].zoom))return[new pt(pe,ge[0].zoom,"stop zoom values must appear in ascending order")];di(ge[0].zoom)!==x&&(x=di(ge[0].zoom),_=void 0,S={}),te=te.concat(lr({key:`${pe}[0]`,value:ge[0],valueSpec:{zoom:{}},style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{zoom:ka,value:Y}}))}else te=te.concat(Y({key:`${pe}[0]`,value:ge[0],valueSpec:{},style:ee.style,styleSpec:ee.styleSpec},ge));return Hs(Ei(ge[1]))?te.concat([new pt(`${pe}[1]`,ge[1],"expressions are not allowed in function stops.")]):te.concat(Jn({key:`${pe}[1]`,value:ge[1],valueSpec:e,style:ee.style,styleSpec:ee.styleSpec}))}function Y(ee,te){const ge=Ai(ee.value),pe=di(ee.value),Pe=ee.value!==null?ee.value:te;if(h){if(ge!==h)return[new pt(ee.key,Pe,`${ge} stop domain type must match previous stop domain type ${h}`)]}else h=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean")return[new pt(ee.key,Pe,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&s!=="categorical"){let qe=`number expected, ${ge} found`;return qi(e)&&s===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(ee.key,Pe,qe)]}return s!=="categorical"||ge!=="number"||isFinite(pe)&&Math.floor(pe)===pe?s!=="categorical"&&ge==="number"&&_!==void 0&&pe<_?[new pt(ee.key,Pe,"stop domain values must appear in ascending order")]:(_=pe,s==="categorical"&&pe in S?[new pt(ee.key,Pe,"stop domain values must be unique")]:(S[pe]=!0,[])):[new pt(ee.key,Pe,`integer expected, found ${pe}`)]}}function Yr(i){const e=(i.expressionContext==="property"?Bl:Ws)(Ei(i.value),i.valueSpec);if(e.result==="error")return e.value.map(h=>new pt(`${i.key}${h.key}`,i.value,h.message));const s=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!s.outputDefined())return[new pt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!bs(s))return[new pt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!bs(s))return[new pt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!xo(s,["zoom","feature-state"]))return[new pt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Us(s))return[new pt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ks(i){const e=i.key,s=i.value,h=i.valueSpec,_=[];return Array.isArray(h.values)?h.values.indexOf(di(s))===-1&&_.push(new pt(e,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(di(s))===-1&&_.push(new pt(e,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),_}function Ts(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ts(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const nu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Lo(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ts(i)||(i=Js(i));const e=Ws(i,nu);if(e.result==="error")throw new Error(e.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,h,_)=>e.value.evaluate(s,h,{},_),needGeometry:Nl(i)}}function Fl(i,e){return i<e?-1:i>e?1:0}function Nl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Nl(i[e]))return!0;return!1}function Js(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Sa(i[1],i[2],"=="):e==="!="?As(Sa(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Sa(i[1],i[2],e):e==="any"?(s=i.slice(1),["any"].concat(s.map(Js))):e==="all"?["all"].concat(i.slice(1).map(Js)):e==="none"?["all"].concat(i.slice(1).map(Js).map(As)):e==="in"?Bo(i[1],i.slice(2)):e==="!in"?As(Bo(i[1],i.slice(2))):e==="has"?Ys(i[1]):e==="!has"?As(Ys(i[1])):e!=="within"||i;var s}function Sa(i,e,s){switch(i){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,i,e]}}function Bo(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Fl)]]:["filter-in-small",i,["literal",e]]}}function Ys(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function As(i){return["!",i]}function Qs(i){return Ts(Ei(i.value))?Yr(nn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ul(i)}function Ul(i){const e=i.value,s=i.key;if(Ai(e)!=="array")return[new pt(s,e,`array expected, ${Ai(e)} found`)];const h=i.styleSpec;let _,x=[];if(e.length<1)return[new pt(s,e,"filter array must have at least 1 element")];switch(x=x.concat(Ks({key:`${s}[0]`,value:e[0],valueSpec:h.filter_operator,style:i.style,styleSpec:i.styleSpec})),di(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&di(e[1])==="$type"&&x.push(new pt(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&x.push(new pt(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(_=Ai(e[1]),_!=="string"&&x.push(new pt(`${s}[1]`,e[1],`string expected, ${_} found`)));for(let S=2;S<e.length;S++)_=Ai(e[S]),di(e[1])==="$type"?x=x.concat(Ks({key:`${s}[${S}]`,value:e[S],valueSpec:h.geometry_type,style:i.style,styleSpec:i.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new pt(`${s}[${S}]`,e[S],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let S=1;S<e.length;S++)x=x.concat(Ul({key:`${s}[${S}]`,value:e[S],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":_=Ai(e[1]),e.length!==2?x.push(new pt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new pt(`${s}[1]`,e[1],`string expected, ${_} found`));break;case"within":_=Ai(e[1]),e.length!==2?x.push(new pt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):_!=="object"&&x.push(new pt(`${s}[1]`,e[1],`object expected, ${_} found`))}return x}function $s(i,e){const s=i.key,h=i.style,_=i.styleSpec,x=i.value,S=i.objectKey,P=_[`${e}_${i.layerType}`];if(!P)return[];const M=S.match(/^(.*)-transition$/);if(e==="paint"&&M&&P[M[1]]&&P[M[1]].transition)return Jn({key:s,value:x,valueSpec:_.transition,style:h,styleSpec:_});const R=i.valueSpec||P[S];if(!R)return[new pt(s,x,`unknown property "${S}"`)];let U;if(Ai(x)==="string"&&qi(R)&&!R.tokens&&(U=/^{([^}]+)}$/.exec(x)))return[new pt(s,x,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const G=[];return i.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&G.push(new pt(s,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&ji(Ei(x))&&di(x.type)==="identity"&&G.push(new pt(s,x,'"text-font" does not support identity functions'))),G.concat(Jn({key:i.key,value:x,valueSpec:R,style:h,styleSpec:_,expressionContext:"property",propertyType:e,propertyKey:S}))}function Vl(i){return $s(i,"paint")}function Gl(i){return $s(i,"layout")}function jl(i){let e=[];const s=i.value,h=i.key,_=i.style,x=i.styleSpec;s.type||s.ref||e.push(new pt(h,s,'either "type" or "ref" is required'));let S=di(s.type);const P=di(s.ref);if(s.id){const M=di(s.id);for(let R=0;R<i.arrayIndex;R++){const U=_.layers[R];di(U.id)===M&&e.push(new pt(h,s.id,`duplicate layer id "${s.id}", previously used at line ${U.id.__line__}`))}}if("ref"in s){let M;["type","source","source-layer","filter","layout"].forEach(R=>{R in s&&e.push(new pt(h,s[R],`"${R}" is prohibited for ref layers`))}),_.layers.forEach(R=>{di(R.id)===P&&(M=R)}),M?M.ref?e.push(new pt(h,s.ref,"ref cannot reference another ref layer")):S=di(M.type):e.push(new pt(h,s.ref,`ref layer "${P}" not found`))}else if(S!=="background")if(s.source){const M=_.sources&&_.sources[s.source],R=M&&di(M.type);M?R==="vector"&&S==="raster"?e.push(new pt(h,s.source,`layer "${s.id}" requires a raster source`)):R==="raster"&&S!=="raster"?e.push(new pt(h,s.source,`layer "${s.id}" requires a vector source`)):R!=="vector"||s["source-layer"]?R==="raster-dem"&&S!=="hillshade"?e.push(new pt(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!s.paint||!s.paint["line-gradient"]||R==="geojson"&&M.lineMetrics||e.push(new pt(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new pt(h,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new pt(h,s.source,`source "${s.source}" not found`))}else e.push(new pt(h,s,'missing required property "source"'));return e=e.concat(lr({key:h,value:s,valueSpec:x.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Jn({key:`${h}.type`,value:s.type,valueSpec:x.layer.type,style:i.style,styleSpec:i.styleSpec,object:s,objectKey:"type"}),filter:Qs,layout:M=>lr({layer:s,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":R=>Gl(nn({layerType:S},R))}}),paint:M=>lr({layer:s,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":R=>Vl(nn({layerType:S},R))}})}})),e}function Cs(i){const e=i.value,s=i.key,h=Ai(e);return h!=="string"?[new pt(s,e,`string expected, ${h} found`)]:[]}const ql={promoteId:function({key:i,value:e}){if(Ai(e)==="string")return Cs({key:i,value:e});{const s=[];for(const h in e)s.push(...Cs({key:`${i}.${h}`,value:e[h]}));return s}}};function eo(i){const e=i.value,s=i.key,h=i.styleSpec,_=i.style;if(!e.type)return[new pt(s,e,'"type" is required')];const x=di(e.type);let S;switch(x){case"vector":case"raster":case"raster-dem":return S=lr({key:s,value:e,valueSpec:h[`source_${x.replace("-","_")}`],style:i.style,styleSpec:h,objectElementValidators:ql}),S;case"geojson":if(S=lr({key:s,value:e,valueSpec:h.source_geojson,style:_,styleSpec:h,objectElementValidators:ql}),e.cluster)for(const P in e.clusterProperties){const[M,R]=e.clusterProperties[P],U=typeof M=="string"?[M,["accumulated"],["get",P]]:M;S.push(...Yr({key:`${s}.${P}.map`,value:R,expressionContext:"cluster-map"})),S.push(...Yr({key:`${s}.${P}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return S;case"video":return lr({key:s,value:e,valueSpec:h.source_video,style:_,styleSpec:h});case"image":return lr({key:s,value:e,valueSpec:h.source_image,style:_,styleSpec:h});case"canvas":return[new pt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ks({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:h})}}function to(i){const e=i.value,s=i.styleSpec,h=s.light,_=i.style;let x=[];const S=Ai(e);if(e===void 0)return x;if(S!=="object")return x=x.concat([new pt("light",e,`object expected, ${S} found`)]),x;for(const P in e){const M=P.match(/^(.*)-transition$/);x=x.concat(M&&h[M[1]]&&h[M[1]].transition?Jn({key:P,value:e[P],valueSpec:s.transition,style:_,styleSpec:s}):h[P]?Jn({key:P,value:e[P],valueSpec:h[P],style:_,styleSpec:s}):[new pt(P,e[P],`unknown property "${P}"`)])}return x}function Kn(i){const e=i.value,s=i.styleSpec,h=s.terrain,_=i.style;let x=[];const S=Ai(e);if(e===void 0)return x;if(S!=="object")return x=x.concat([new pt("terrain",e,`object expected, ${S} found`)]),x;for(const P in e)x=x.concat(h[P]?Jn({key:P,value:e[P],valueSpec:h[P],style:_,styleSpec:s}):[new pt(P,e[P],`unknown property "${P}"`)]);return x}const io={"*":()=>[],array:Rl,boolean:function(i){const e=i.value,s=i.key,h=Ai(e);return h!=="boolean"?[new pt(s,e,`boolean expected, ${h} found`)]:[]},number:ka,color:function(i){const e=i.key,s=i.value,h=Ai(s);return h!=="string"?[new pt(e,s,`color expected, ${h} found`)]:ys(s)===null?[new pt(e,s,`color expected, "${s}" found`)]:[]},constants:Wn,enum:Ks,filter:Qs,function:Ol,layer:jl,object:lr,source:eo,light:to,terrain:Kn,string:Cs,formatted:function(i){return Cs(i).length===0?[]:Yr(i)},resolvedImage:function(i){return Cs(i).length===0?[]:Yr(i)},padding:function(i){const e=i.key,s=i.value;if(Ai(s)==="array"){if(s.length<1||s.length>4)return[new pt(e,s,`padding requires 1 to 4 values; ${s.length} values found`)];const h={type:"number"};let _=[];for(let x=0;x<s.length;x++)_=_.concat(Jn({key:`${e}[${x}]`,value:s[x],valueSpec:h}));return _}return ka({key:e,value:s,valueSpec:{}})}};function Jn(i){const e=i.value,s=i.valueSpec,h=i.styleSpec;return s.expression&&ji(di(e))?Ol(i):s.expression&&Hs(Ei(e))?Yr(i):s.type&&io[s.type]?io[s.type](i):lr(nn({},i,{valueSpec:s.type?h[s.type]:s}))}function ru(i){const e=i.value,s=i.key,h=Cs(i);return h.length||(e.indexOf("{fontstack}")===-1&&h.push(new pt(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&h.push(new pt(s,e,'"glyphs" url must include a "{range}" token'))),h}function Br(i,e=Me){let s=[];return s=s.concat(Jn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:ru,"*":()=>[]}})),i.constants&&(s=s.concat(Wn({key:"constants",value:i.constants,style:i,styleSpec:e}))),Zl(s)}function Zl(i){return[].concat(i).sort((e,s)=>e.line-s.line)}function Er(i){return function(...e){return Zl(i.apply(this,e))}}Br.source=Er(eo),Br.light=Er(to),Br.terrain=Er(Kn),Br.layer=Er(jl),Br.filter=Er(Qs),Br.paintProperty=Er(Vl),Br.layoutProperty=Er(Gl);const no=Br,Ea=no.light,su=no.paintProperty,ou=no.layoutProperty;function Ro(i,e){let s=!1;if(e&&e.length)for(const h of e)i.fire(new Xt(new Error(h.message))),s=!0;return s}class ro{constructor(e,s,h){const _=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const S=new Int32Array(this.arrayBuffer);e=S[0],this.d=(s=S[1])+2*(h=S[2]);for(let M=0;M<this.d*this.d;M++){const R=S[3+M],U=S[3+M+1];_.push(R===U?null:S.subarray(R,U))}const P=S[3+_.length+1];this.keys=S.subarray(S[3+_.length],P),this.bboxes=S.subarray(P),this.insert=this._insertReadonly}else{this.d=s+2*h;for(let S=0;S<this.d*this.d;S++)_.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=e,this.padding=h,this.scale=s/e,this.uid=0;const x=h/s*e;this.min=-x,this.max=e+x}insert(e,s,h,_,x){this._forEachCell(s,h,_,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,s,h,_,x,S){this.cells[x].push(S)}query(e,s,h,_,x){const S=this.min,P=this.max;if(e<=S&&s<=S&&P<=h&&P<=_&&!x)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(e,s,h,_,this._queryCell,M,{},x),M}}_queryCell(e,s,h,_,x,S,P,M){const R=this.cells[x];if(R!==null){const U=this.keys,G=this.bboxes;for(let Y=0;Y<R.length;Y++){const ee=R[Y];if(P[ee]===void 0){const te=4*ee;(M?M(G[te+0],G[te+1],G[te+2],G[te+3]):e<=G[te+2]&&s<=G[te+3]&&h>=G[te+0]&&_>=G[te+1])?(P[ee]=!0,S.push(U[ee])):P[ee]=!1}}}}_forEachCell(e,s,h,_,x,S,P,M){const R=this._convertToCellCoord(e),U=this._convertToCellCoord(s),G=this._convertToCellCoord(h),Y=this._convertToCellCoord(_);for(let ee=R;ee<=G;ee++)for(let te=U;te<=Y;te++){const ge=this.d*te+ee;if((!M||M(this._convertFromCellCoord(ee),this._convertFromCellCoord(te),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(te+1)))&&x.call(this,e,s,h,_,ge,S,P,M))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,s=3+this.cells.length+1+1;let h=0;for(let S=0;S<this.cells.length;S++)h+=this.cells[S].length;const _=new Int32Array(s+h+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let x=s;for(let S=0;S<e.length;S++){const P=e[S];_[3+S]=x,_.set(P,x),x+=P.length}return _[3+e.length]=x,_.set(this.keys,x),x+=this.keys.length,_[3+e.length+1]=x,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer}static serialize(e,s){const h=e.toArrayBuffer();return s&&s.push(h),{buffer:h}}static deserialize(e){return new ro(e.buffer)}}const Tr={};function Bt(i,e,s={}){if(Tr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Tr[i]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}Bt("Object",Object),Bt("TransferableGridIndex",ro),Bt("Color",ne),Bt("Error",Error),Bt("AJAXError",Hi),Bt("ResolvedImage",Te),Bt("StylePropertyFunction",Mo),Bt("StyleExpression",zo,{omit:["_evaluator"]}),Bt("ZoomDependentExpression",wa),Bt("ZoomConstantExpression",Xs),Bt("CompoundExpression",Oi,{omit:["_evaluate"]});for(const i in ks)ks[i]._classRegistryKey||Bt(`Expression_${i}`,ks[i]);function Hl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Qr(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Hl(i)||K(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return e&&e.push(s.buffer),s}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const h of i)s.push(Qr(h,e));return s}if(typeof i=="object"){const s=i.constructor,h=s._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!Tr[h])throw new Error(`${h} is not registered.`);const _=s.serialize?s.serialize(i,e):{};if(s.serialize){if(e&&_===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in i){if(!i.hasOwnProperty(x)||Tr[h].omit.indexOf(x)>=0)continue;const S=i[x];_[x]=Tr[h].shallow.indexOf(x)>=0?S:Qr(S,e)}i instanceof Error&&(_.message=i.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(_.$name=h),_}throw new Error("can't serialize object of type "+typeof i)}function Rr(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Hl(i)||K(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Rr);if(typeof i=="object"){const e=i.$name||"Object";if(!Tr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:s}=Tr[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(i);const h=Object.create(s.prototype);for(const _ of Object.keys(i)){if(_==="$name")continue;const x=i[_];h[_]=Tr[e].shallow.indexOf(_)>=0?x:Rr(x)}return h}throw new Error("can't deserialize object of type "+typeof i)}class Ta{constructor(){this.first=!0}update(e,s){const h=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=h,!0))}}const At={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Oo(i){for(const e of i)if(Ca(e.charCodeAt(0)))return!0;return!1}function au(i){for(const e of i)if(!Aa(e.charCodeAt(0)))return!1;return!0}function Aa(i){return!(At.Arabic(i)||At["Arabic Supplement"](i)||At["Arabic Extended-A"](i)||At["Arabic Presentation Forms-A"](i)||At["Arabic Presentation Forms-B"](i))}function Ca(i){return!(i!==746&&i!==747&&(i<4352||!(At["Bopomofo Extended"](i)||At.Bopomofo(i)||At["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||At["CJK Compatibility Ideographs"](i)||At["CJK Compatibility"](i)||At["CJK Radicals Supplement"](i)||At["CJK Strokes"](i)||!(!At["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||At["CJK Unified Ideographs Extension A"](i)||At["CJK Unified Ideographs"](i)||At["Enclosed CJK Letters and Months"](i)||At["Hangul Compatibility Jamo"](i)||At["Hangul Jamo Extended-A"](i)||At["Hangul Jamo Extended-B"](i)||At["Hangul Jamo"](i)||At["Hangul Syllables"](i)||At.Hiragana(i)||At["Ideographic Description Characters"](i)||At.Kanbun(i)||At["Kangxi Radicals"](i)||At["Katakana Phonetic Extensions"](i)||At.Katakana(i)&&i!==12540||!(!At["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!At["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||At["Unified Canadian Aboriginal Syllabics"](i)||At["Unified Canadian Aboriginal Syllabics Extended"](i)||At["Vertical Forms"](i)||At["Yijing Hexagram Symbols"](i)||At["Yi Syllables"](i)||At["Yi Radicals"](i))))}function Wl(i){return!(Ca(i)||function(e){return!!(At["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||At["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||At["Letterlike Symbols"](e)||At["Number Forms"](e)||At["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||At["Control Pictures"](e)&&e!==9251||At["Optical Character Recognition"](e)||At["Enclosed Alphanumerics"](e)||At["Geometric Shapes"](e)||At["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||At["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||At["CJK Symbols and Punctuation"](e)||At.Katakana(e)||At["Private Use Area"](e)||At["CJK Compatibility Forms"](e)||At["Small Form Variants"](e)||At["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Xl(i){return i>=1424&&i<=2303||At["Arabic Presentation Forms-A"](i)||At["Arabic Presentation Forms-B"](i)}function lu(i,e){return!(!e&&Xl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||At.Khmer(i))}function Kl(i){for(const e of i)if(Xl(e.charCodeAt(0)))return!0;return!1}const Ia="deferred",Pa="loading",za="loaded";let Ma=null,Gn="unavailable",Or=null;const Jl=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Gn="error"),Ma&&Ma(i)};function Is(){Da.fire(new gt("pluginStateChange",{pluginStatus:Gn,pluginURL:Or}))}const Da=new xi,so=function(){return Gn},Yl=function(){if(Gn!==Ia||!Or)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gn=Pa,Is(),Or&&me({url:Or},i=>{i?Jl(i):(Gn=za,Is())})},nr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gn===za||nr.applyArabicShaping!=null,isLoading:()=>Gn===Pa,setState(i){if(!he())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Gn=i.pluginStatus,Or=i.pluginURL},isParsed(){if(!he())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return nr.applyArabicShaping!=null&&nr.processBidirectionalText!=null&&nr.processStyledBidirectionalText!=null},getPluginURL(){if(!he())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Or}};class Ji{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ta,this.transition={})}isSupportedScript(e){return function(s,h){for(const _ of s)if(!lu(_.charCodeAt(0),h))return!1;return!0}(e,nr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),h=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*s}}}class oo{constructor(e,s){this.property=e,this.value=s,this.expression=function(h,_){if(ji(h))return new Mo(h,_);if(Hs(h)){const x=Bl(h,_);if(x.result==="error")throw new Error(x.value.map(S=>`${S.key}: ${S.message}`).join(", "));return x.value}{let x=h;return _.type==="color"&&typeof h=="string"?x=ne.parse(h):_.type!=="padding"||typeof h!="number"&&!Array.isArray(h)||(x=ye.parse(h)),{kind:"constant",evaluate:()=>x}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,h){return this.property.possiblyEvaluate(this,e,s,h)}}class Fo{constructor(e){this.property=e,this.value=new oo(e,void 0)}transitioned(e,s){return new $l(this.property,this.value,s,T({},e.transition,this.transition),e.now)}untransitioned(){return new $l(this.property,this.value,null,{},0)}}class Ql{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return W(this._values[e].value.value)}setValue(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fo(this._values[e].property)),this._values[e].value=new oo(this._values[e].property,s===null?void 0:W(s))}getTransition(e){return W(this._values[e].transition)}setTransition(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Fo(this._values[e].property)),this._values[e].transition=W(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(e[s]=h);const _=this.getTransition(s);_!==void 0&&(e[`${s}-transition`]=_)}return e}transitioned(e,s){const h=new ec(this._properties);for(const _ of Object.keys(this._values))h._values[_]=this._values[_].transitioned(e,s._values[_]);return h}untransitioned(){const e=new ec(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class $l{constructor(e,s,h,_,x){this.property=e,this.value=s,this.begin=x+_.delay||0,this.end=this.begin+_.duration||0,e.specification.transition&&(_.delay||_.duration)&&(this.prior=h)}possiblyEvaluate(e,s,h){const _=e.now||0,x=this.value.possiblyEvaluate(e,s,h),S=this.prior;if(S){if(_>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(_<this.begin)return S.possiblyEvaluate(e,s,h);{const P=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(e,s,h),x,function(M){if(M<=0)return 0;if(M>=1)return 1;const R=M*M,U=R*M;return 4*(M<.5?U:3*(M-R)+U-.75)}(P))}}return x}}class ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,h){const _=new ao(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(e,s,h);return _}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class cu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return W(this._values[e].value)}setValue(e,s){this._values[e]=new oo(this._values[e].property,s===null?void 0:W(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(e[s]=h)}return e}possiblyEvaluate(e,s,h){const _=new ao(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(e,s,h);return _}}class _r{constructor(e,s,h){this.property=e,this.value=s,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,h,_){return this.property.evaluate(this.value,this.parameters,e,s,h,_)}}class ao{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Nt{constructor(e){this.specification=e}possiblyEvaluate(e,s){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(s)}interpolate(e,s,h){const _=Gs[this.specification.type];return _?_(e,s,h):e}}class $t{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,h,_){return new _r(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},h,_)}:e.expression,s)}interpolate(e,s,h){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new _r(this,{kind:"constant",value:void 0},e.parameters);const _=Gs[this.specification.type];return _?new _r(this,{kind:"constant",value:_(e.value.value,s.value.value,h)},e.parameters):e}evaluate(e,s,h,_,x,S){return e.kind==="constant"?e.value:e.evaluate(s,h,_,x,S)}}class Ps extends $t{possiblyEvaluate(e,s,h,_){if(e.value===void 0)return new _r(this,{kind:"constant",value:void 0},s);if(e.expression.kind==="constant"){const x=e.expression.evaluate(s,null,{},h,_),S=e.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,P=this._calculate(S,S,S,s);return new _r(this,{kind:"constant",value:P},s)}if(e.expression.kind==="camera"){const x=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new _r(this,{kind:"constant",value:x},s)}return new _r(this,e.expression,s)}evaluate(e,s,h,_,x,S){if(e.kind==="source"){const P=e.evaluate(s,h,_,x,S);return this._calculate(P,P,P,s)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},h,_),e.evaluate({zoom:Math.floor(s.zoom)},h,_),e.evaluate({zoom:Math.floor(s.zoom)+1},h,_),s):e.value}_calculate(e,s,h,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:h,to:s}}interpolate(e){return e}}class La{constructor(e){this.specification=e}possiblyEvaluate(e,s,h,_){if(e.value!==void 0){if(e.expression.kind==="constant"){const x=e.expression.evaluate(s,null,{},h,_);return this._calculate(x,x,x,s)}return this._calculate(e.expression.evaluate(new Ji(Math.floor(s.zoom-1),s)),e.expression.evaluate(new Ji(Math.floor(s.zoom),s)),e.expression.evaluate(new Ji(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,h,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:h,to:s}}interpolate(e){return e}}class Fr{constructor(e){this.specification=e}possiblyEvaluate(e,s,h,_){return!!e.expression.evaluate(s,null,{},h,_)}interpolate(){return!1}}class En{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const _=this.defaultPropertyValues[s]=new oo(h,void 0),x=this.defaultTransitionablePropertyValues[s]=new Fo(h);this.defaultTransitioningPropertyValues[s]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=_.possiblyEvaluate({})}}}Bt("DataDrivenProperty",$t),Bt("DataConstantProperty",Nt),Bt("CrossFadedDataDrivenProperty",Ps),Bt("CrossFadedProperty",La),Bt("ColorRampProperty",Fr);const Nr="-transition";class yr extends xi{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new cu(s.layout)),s.paint)){this._transitionablePaint=new Ql(s.paint);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ao(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,h={}){s!=null&&this._validate(ou,`layers.${this.id}.layout.${e}`,e,s,h)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return e.endsWith(Nr)?this._transitionablePaint.getTransition(e.slice(0,-Nr.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,h={}){if(s!=null&&this._validate(su,`layers.${this.id}.paint.${e}`,e,s,h))return!1;if(e.endsWith(Nr))return this._transitionablePaint.setTransition(e.slice(0,-Nr.length),s||void 0),!1;{const _=this._transitionablePaint._values[e],x=_.property.specification["property-type"]==="cross-faded-data-driven",S=_.value.isDataDriven(),P=_.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const M=this._transitionablePaint._values[e].value;return M.isDataDriven()||S||x||this._handleOverridablePaintPropertyUpdate(e,P,M)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,s,h){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),O(e,(s,h)=>!(s===void 0||h==="layout"&&!Object.keys(s).length||h==="paint"&&!Object.keys(s).length))}_validate(e,s,h,_,x={}){return(!x||x.validate!==!1)&&Ro(this,e.call(no,{key:s,layerType:this.type,objectKey:h,value:_,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof _r&&qi(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const tc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ur{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ln(i,e=1){let s=0,h=0;return{members:i.map(_=>{const x=tc[_.type].BYTES_PER_ELEMENT,S=s=Ba(s,Math.max(e,x)),P=_.components||1;return h=Math.max(h,x),s+=x*P,{name:_.name,type:_.type,components:P,offset:S}}),size:Ba(s,Math.max(h,e)),alignment:e}}function Ba(i,e){return Math.ceil(i/e)*e}class $r extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const _=2*e;return this.int16[_+0]=s,this.int16[_+1]=h,e}}$r.prototype.bytesPerElement=4,Bt("StructArrayLayout2i4",$r);class g extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,h,_)}emplace(e,s,h,_,x){const S=4*e;return this.int16[S+0]=s,this.int16[S+1]=h,this.int16[S+2]=_,this.int16[S+3]=x,e}}g.prototype.bytesPerElement=8,Bt("StructArrayLayout4i8",g);class t extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x,S){const P=this.length;return this.resize(P+1),this.emplace(P,e,s,h,_,x,S)}emplace(e,s,h,_,x,S,P){const M=6*e;return this.int16[M+0]=s,this.int16[M+1]=h,this.int16[M+2]=_,this.int16[M+3]=x,this.int16[M+4]=S,this.int16[M+5]=P,e}}t.prototype.bytesPerElement=12,Bt("StructArrayLayout2i4i12",t);class a extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x,S){const P=this.length;return this.resize(P+1),this.emplace(P,e,s,h,_,x,S)}emplace(e,s,h,_,x,S,P){const M=4*e,R=8*e;return this.int16[M+0]=s,this.int16[M+1]=h,this.uint8[R+4]=_,this.uint8[R+5]=x,this.uint8[R+6]=S,this.uint8[R+7]=P,e}}a.prototype.bytesPerElement=8,Bt("StructArrayLayout2i4ub8",a);class p extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const _=2*e;return this.float32[_+0]=s,this.float32[_+1]=h,e}}p.prototype.bytesPerElement=8,Bt("StructArrayLayout2f8",p);class y extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x,S,P,M,R,U){const G=this.length;return this.resize(G+1),this.emplace(G,e,s,h,_,x,S,P,M,R,U)}emplace(e,s,h,_,x,S,P,M,R,U,G){const Y=10*e;return this.uint16[Y+0]=s,this.uint16[Y+1]=h,this.uint16[Y+2]=_,this.uint16[Y+3]=x,this.uint16[Y+4]=S,this.uint16[Y+5]=P,this.uint16[Y+6]=M,this.uint16[Y+7]=R,this.uint16[Y+8]=U,this.uint16[Y+9]=G,e}}y.prototype.bytesPerElement=20,Bt("StructArrayLayout10ui20",y);class k extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x,S,P,M,R,U,G,Y){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,s,h,_,x,S,P,M,R,U,G,Y)}emplace(e,s,h,_,x,S,P,M,R,U,G,Y,ee){const te=12*e;return this.int16[te+0]=s,this.int16[te+1]=h,this.int16[te+2]=_,this.int16[te+3]=x,this.uint16[te+4]=S,this.uint16[te+5]=P,this.uint16[te+6]=M,this.uint16[te+7]=R,this.int16[te+8]=U,this.int16[te+9]=G,this.int16[te+10]=Y,this.int16[te+11]=ee,e}}k.prototype.bytesPerElement=24,Bt("StructArrayLayout4i4ui4i24",k);class I extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,h)}emplace(e,s,h,_){const x=3*e;return this.float32[x+0]=s,this.float32[x+1]=h,this.float32[x+2]=_,e}}I.prototype.bytesPerElement=12,Bt("StructArrayLayout3f12",I);class D extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}D.prototype.bytesPerElement=4,Bt("StructArrayLayout1ul4",D);class L extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x,S,P,M,R){const U=this.length;return this.resize(U+1),this.emplace(U,e,s,h,_,x,S,P,M,R)}emplace(e,s,h,_,x,S,P,M,R,U){const G=10*e,Y=5*e;return this.int16[G+0]=s,this.int16[G+1]=h,this.int16[G+2]=_,this.int16[G+3]=x,this.int16[G+4]=S,this.int16[G+5]=P,this.uint32[Y+3]=M,this.uint16[G+8]=R,this.uint16[G+9]=U,e}}L.prototype.bytesPerElement=20,Bt("StructArrayLayout6i1ul2ui20",L);class F extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x,S){const P=this.length;return this.resize(P+1),this.emplace(P,e,s,h,_,x,S)}emplace(e,s,h,_,x,S,P){const M=6*e;return this.int16[M+0]=s,this.int16[M+1]=h,this.int16[M+2]=_,this.int16[M+3]=x,this.int16[M+4]=S,this.int16[M+5]=P,e}}F.prototype.bytesPerElement=12,Bt("StructArrayLayout2i2i2i12",F);class V extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,h,_,x)}emplace(e,s,h,_,x,S){const P=4*e,M=8*e;return this.float32[P+0]=s,this.float32[P+1]=h,this.float32[P+2]=_,this.int16[M+6]=x,this.int16[M+7]=S,e}}V.prototype.bytesPerElement=16,Bt("StructArrayLayout2f1f2i16",V);class X extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,h,_)}emplace(e,s,h,_,x){const S=12*e,P=3*e;return this.uint8[S+0]=s,this.uint8[S+1]=h,this.float32[P+1]=_,this.float32[P+2]=x,e}}X.prototype.bytesPerElement=12,Bt("StructArrayLayout2ub2f12",X);class $ extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,h)}emplace(e,s,h,_){const x=3*e;return this.uint16[x+0]=s,this.uint16[x+1]=h,this.uint16[x+2]=_,e}}$.prototype.bytesPerElement=6,Bt("StructArrayLayout3ui6",$);class ue extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x,S,P,M,R,U,G,Y,ee,te,ge,pe,Pe){const qe=this.length;return this.resize(qe+1),this.emplace(qe,e,s,h,_,x,S,P,M,R,U,G,Y,ee,te,ge,pe,Pe)}emplace(e,s,h,_,x,S,P,M,R,U,G,Y,ee,te,ge,pe,Pe,qe){const Ce=24*e,Fe=12*e,it=48*e;return this.int16[Ce+0]=s,this.int16[Ce+1]=h,this.uint16[Ce+2]=_,this.uint16[Ce+3]=x,this.uint32[Fe+2]=S,this.uint32[Fe+3]=P,this.uint32[Fe+4]=M,this.uint16[Ce+10]=R,this.uint16[Ce+11]=U,this.uint16[Ce+12]=G,this.float32[Fe+7]=Y,this.float32[Fe+8]=ee,this.uint8[it+36]=te,this.uint8[it+37]=ge,this.uint8[it+38]=pe,this.uint32[Fe+10]=Pe,this.int16[Ce+22]=qe,e}}ue.prototype.bytesPerElement=48,Bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ue);class se extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,_,x,S,P,M,R,U,G,Y,ee,te,ge,pe,Pe,qe,Ce,Fe,it,tt,Lt,Ot,Ct,St,vt,It){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,e,s,h,_,x,S,P,M,R,U,G,Y,ee,te,ge,pe,Pe,qe,Ce,Fe,it,tt,Lt,Ot,Ct,St,vt,It)}emplace(e,s,h,_,x,S,P,M,R,U,G,Y,ee,te,ge,pe,Pe,qe,Ce,Fe,it,tt,Lt,Ot,Ct,St,vt,It,Tt){const ut=34*e,Wt=17*e;return this.int16[ut+0]=s,this.int16[ut+1]=h,this.int16[ut+2]=_,this.int16[ut+3]=x,this.int16[ut+4]=S,this.int16[ut+5]=P,this.int16[ut+6]=M,this.int16[ut+7]=R,this.uint16[ut+8]=U,this.uint16[ut+9]=G,this.uint16[ut+10]=Y,this.uint16[ut+11]=ee,this.uint16[ut+12]=te,this.uint16[ut+13]=ge,this.uint16[ut+14]=pe,this.uint16[ut+15]=Pe,this.uint16[ut+16]=qe,this.uint16[ut+17]=Ce,this.uint16[ut+18]=Fe,this.uint16[ut+19]=it,this.uint16[ut+20]=tt,this.uint16[ut+21]=Lt,this.uint16[ut+22]=Ot,this.uint32[Wt+12]=Ct,this.float32[Wt+13]=St,this.float32[Wt+14]=vt,this.float32[Wt+15]=It,this.float32[Wt+16]=Tt,e}}se.prototype.bytesPerElement=68,Bt("StructArrayLayout8i15ui1ul4f68",se);class le extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}le.prototype.bytesPerElement=4,Bt("StructArrayLayout1f4",le);class be extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,h)}emplace(e,s,h,_){const x=3*e;return this.int16[x+0]=s,this.int16[x+1]=h,this.int16[x+2]=_,e}}be.prototype.bytesPerElement=6,Bt("StructArrayLayout3i6",be);class Ae extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,h)}emplace(e,s,h,_){const x=4*e;return this.uint32[2*e+0]=s,this.uint16[x+2]=h,this.uint16[x+3]=_,e}}Ae.prototype.bytesPerElement=8,Bt("StructArrayLayout1ul2ui8",Ae);class ze extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const _=2*e;return this.uint16[_+0]=s,this.uint16[_+1]=h,e}}ze.prototype.bytesPerElement=4,Bt("StructArrayLayout2ui4",ze);class de extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}de.prototype.bytesPerElement=2,Bt("StructArrayLayout1ui2",de);class Ge extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,h,_)}emplace(e,s,h,_,x){const S=4*e;return this.float32[S+0]=s,this.float32[S+1]=h,this.float32[S+2]=_,this.float32[S+3]=x,e}}Ge.prototype.bytesPerElement=16,Bt("StructArrayLayout4f16",Ge);class Le extends Ur{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ht(this.anchorPointX,this.anchorPointY)}}Le.prototype.size=20;class Ye extends L{get(e){return new Le(this,e)}}Bt("CollisionBoxArray",Ye);class $e extends Ur{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$e.prototype.size=48;class lt extends ue{get(e){return new $e(this,e)}}Bt("PlacedSymbolArray",lt);class We extends Ur{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}We.prototype.size=68;class zt extends se{get(e){return new We(this,e)}}Bt("SymbolInstanceArray",zt);class kt extends le{getoffsetX(e){return this.float32[1*e+0]}}Bt("GlyphOffsetArray",kt);class Dt extends be{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Bt("SymbolLineVertexArray",Dt);class ai extends Ur{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ai.prototype.size=8;class hi extends Ae{get(e){return new ai(this,e)}}Bt("FeatureIndexArray",hi);class Ht extends $r{}class Mi extends $r{}class Di extends $r{}class vi extends t{}class Si extends a{}class Ri extends p{}class vn extends y{}class vr extends k{}class cr extends I{}class br extends D{}class Vr extends F{}class rr extends X{}class jn extends ${}class Ar extends ze{}const No=ln([{name:"a_pos",components:2,type:"Int16"}],4),{members:fn}=No;class pi{constructor(e=[]){this.segments=e}prepareSegment(e,s,h,_){let x=this.segments[this.segments.length-1];return e>pi.MAX_VERTEX_ARRAY_LENGTH&&Z(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!x||x.vertexLength+e>pi.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==_)&&(x={vertexOffset:s.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},_!==void 0&&(x.sortKey=_),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,h,_){return new pi([{vertexOffset:e,primitiveOffset:s,vertexLength:h,primitiveLength:_,vaos:{},sortKey:0}])}}function Ci(i,e){return 256*(i=b(Math.floor(i),0,255))+b(Math.floor(e),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt("SegmentVector",pi);const bn=ln([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xn={exports:{}},Yi={exports:{}};Yi.exports=function(i,e){var s,h,_,x,S,P,M,R;for(h=i.length-(s=3&i.length),_=e,S=3432918353,P=461845907,R=0;R<h;)M=255&i.charCodeAt(R)|(255&i.charCodeAt(++R))<<8|(255&i.charCodeAt(++R))<<16|(255&i.charCodeAt(++R))<<24,++R,_=27492+(65535&(x=5*(65535&(_=(_^=M=(65535&(M=(M=(65535&M)*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*P+(((M>>>16)*P&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(M=0,s){case 3:M^=(255&i.charCodeAt(R+2))<<16;case 2:M^=(255&i.charCodeAt(R+1))<<8;case 1:_^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(R)))*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*P+(((M>>>16)*P&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var sr={exports:{}};sr.exports=function(i,e){for(var s,h=i.length,_=e^h,x=0;h>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(s>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:_^=(255&i.charCodeAt(x+2))<<16;case 2:_^=(255&i.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var es=Yi.exports,Ra=sr.exports;xn.exports=es,xn.exports.murmur3=es,xn.exports.murmur2=Ra;class zs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,h,_){this.ids.push(ic(e)),this.positions.push(s,h,_)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=ic(e);let h=0,_=this.ids.length-1;for(;h<_;){const S=h+_>>1;this.ids[S]>=s?_=S:h=S+1}const x=[];for(;this.ids[h]===s;)x.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return x}static serialize(e,s){const h=new Float64Array(e.ids),_=new Uint32Array(e.positions);return Oa(h,_,0,h.length-1),s&&s.push(h.buffer,_.buffer),{ids:h,positions:_}}static deserialize(e){const s=new zs;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function ic(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:xn.exports(String(i))}function Oa(i,e,s,h){for(;s<h;){const _=i[s+h>>1];let x=s-1,S=h+1;for(;;){do x++;while(i[x]<_);do S--;while(i[S]>_);if(x>=S)break;Gr(i,x,S),Gr(e,3*x,3*S),Gr(e,3*x+1,3*S+1),Gr(e,3*x+2,3*S+2)}S-s<h-S?(Oa(i,e,s,S),s=S+1):(Oa(i,e,S+1,h),h=S)}}function Gr(i,e,s){const h=i[e];i[e]=i[s],i[s]=h}Bt("FeaturePositionMap",zs);class ts{constructor(e,s){this.gl=e.gl,this.location=s}}class is extends ts{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Uo extends ts{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class $h extends ts{constructor(e,s){super(e,s),this.current=ne.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Rg=new Float32Array(16);function uu(i){return[Ci(255*i.r,255*i.g),Ci(255*i.b,255*i.a)]}class Fa{constructor(e,s,h){this.value=e,this.uniformNames=s.map(_=>`u_${_}`),this.type=h}setUniform(e,s,h){e.set(h.constantOr(this.value))}getBinding(e,s,h){return this.type==="color"?new $h(e,s):new is(e,s)}}class Vo{constructor(e,s){this.uniformNames=s.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=e.tlbr}setUniform(e,s,h,_){const x=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&e.set(x)}getBinding(e,s,h){return h.substr(0,9)==="u_pattern"?new Uo(e,s):new is(e,s)}}class ns{constructor(e,s,h,_){this.expression=e,this.type=h,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,s,h,_,x){const S=this.paintVertexArray.length,P=this.expression.evaluate(new Ji(0),s,{},_,[],x);this.paintVertexArray.resize(e),this._setPaintValue(S,e,P)}updatePaintArray(e,s,h,_){const x=this.expression.evaluate({zoom:0},h,_);this._setPaintValue(e,s,x)}_setPaintValue(e,s,h){if(this.type==="color"){const _=uu(h);for(let x=e;x<s;x++)this.paintVertexArray.emplace(x,_[0],_[1])}else{for(let _=e;_<s;_++)this.paintVertexArray.emplace(_,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cr{constructor(e,s,h,_,x,S){this.expression=e,this.uniformNames=s.map(P=>`u_${P}_t`),this.type=h,this.useIntegerZoom=_,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=s.map(P=>({name:`a_${P}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(e,s,h,_,x){const S=this.expression.evaluate(new Ji(this.zoom),s,{},_,[],x),P=this.expression.evaluate(new Ji(this.zoom+1),s,{},_,[],x),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,S,P)}updatePaintArray(e,s,h,_){const x=this.expression.evaluate({zoom:this.zoom},h,_),S=this.expression.evaluate({zoom:this.zoom+1},h,_);this._setPaintValue(e,s,x,S)}_setPaintValue(e,s,h,_){if(this.type==="color"){const x=uu(h),S=uu(_);for(let P=e;P<s;P++)this.paintVertexArray.emplace(P,x[0],x[1],S[0],S[1])}else{for(let x=e;x<s;x++)this.paintVertexArray.emplace(x,h,_);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(_))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,_=b(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);e.set(_)}getBinding(e,s,h){return new is(e,s)}}class Ms{constructor(e,s,h,_,x,S){this.expression=e,this.type=s,this.useIntegerZoom=h,this.zoom=_,this.layerId=S,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(e,s,h){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(_,e,s.patterns&&s.patterns[this.layerId],h)}updatePaintArray(e,s,h,_,x){this._setPaintValues(e,s,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(e,s,h,_){if(!_||!h)return;const{min:x,mid:S,max:P}=h,M=_[x],R=_[S],U=_[P];if(M&&R&&U)for(let G=e;G<s;G++)this.zoomInPaintVertexArray.emplace(G,R.tl[0],R.tl[1],R.br[0],R.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],R.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,R.tl[0],R.tl[1],R.br[0],R.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],R.pixelRatio,U.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,bn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,bn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ef{constructor(e,s,h){this.binders={},this._buffers=[];const _=[];for(const x in e.paint._values){if(!h(x))continue;const S=e.paint.get(x);if(!(S instanceof _r&&qi(S.property.specification)))continue;const P=Og(x,e.type),M=S.value,R=S.property.specification.type,U=S.property.useIntegerZoom,G=S.property.specification["property-type"],Y=G==="cross-faded"||G==="cross-faded-data-driven";if(M.kind==="constant")this.binders[x]=Y?new Vo(M.value,P):new Fa(M.value,P,R),_.push(`/u_${x}`);else if(M.kind==="source"||Y){const ee=tf(x,R,"source");this.binders[x]=Y?new Ms(M,R,U,s,ee,e.id):new ns(M,P,R,ee),_.push(`/a_${x}`)}else{const ee=tf(x,R,"composite");this.binders[x]=new Cr(M,P,R,U,s,ee),_.push(`/z_${x}`)}}this.cacheKey=_.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof ns||s instanceof Cr?s.maxValue:0}populatePaintArrays(e,s,h,_,x){for(const S in this.binders){const P=this.binders[S];(P instanceof ns||P instanceof Cr||P instanceof Ms)&&P.populatePaintArray(e,s,h,_,x)}}setConstantPatternPositions(e,s){for(const h in this.binders){const _=this.binders[h];_ instanceof Vo&&_.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,h,_,x){let S=!1;for(const P in e){const M=s.getPositions(P);for(const R of M){const U=h.feature(R.index);for(const G in this.binders){const Y=this.binders[G];if((Y instanceof ns||Y instanceof Cr||Y instanceof Ms)&&Y.expression.isStateDependent===!0){const ee=_.paint.get(G);Y.expression=ee.value,Y.updatePaintArray(R.start,R.end,U,e[P],x),S=!0}}}}return S}defines(){const e=[];for(const s in this.binders){const h=this.binders[s];(h instanceof Fa||h instanceof Vo)&&e.push(...h.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof ns||h instanceof Cr)for(let _=0;_<h.paintVertexAttributes.length;_++)e.push(h.paintVertexAttributes[_].name);else if(h instanceof Ms)for(let _=0;_<bn.members.length;_++)e.push(bn.members[_].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Fa||h instanceof Vo||h instanceof Cr)for(const _ of h.uniformNames)e.push(_)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const h=[];for(const _ in this.binders){const x=this.binders[_];if(x instanceof Fa||x instanceof Vo||x instanceof Cr){for(const S of x.uniformNames)if(s[S]){const P=x.getBinding(e,s[S],S);h.push({name:S,property:_,binding:P})}}}return h}setUniforms(e,s,h,_){for(const{name:x,property:S,binding:P}of s)this.binders[S].setUniform(P,_,h.get(S),x)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const h=this.binders[s];if(e&&h instanceof Ms){const _=e.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(h instanceof ns||h instanceof Cr)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(e){for(const s in this.binders){const h=this.binders[s];(h instanceof ns||h instanceof Cr||h instanceof Ms)&&h.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof ns||s instanceof Cr||s instanceof Ms)&&s.destroy()}}}class lo{constructor(e,s,h=()=>!0){this.programConfigurations={};for(const _ of e)this.programConfigurations[_.id]=new ef(_,s,h);this.needsUpload=!1,this._featureMap=new zs,this._bufferOffset=0}populatePaintArrays(e,s,h,_,x,S){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(e,s,_,x,S);s.id!==void 0&&this._featureMap.add(s.id,h,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,h,_){for(const x of h)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,s,x,_)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Og(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function tf(i,e,s){const h={color:{source:p,composite:Ge},number:{source:le,composite:p}},_=function(x){return{"line-pattern":{source:vn,composite:vn},"fill-pattern":{source:vn,composite:vn},"fill-extrusion-pattern":{source:vn,composite:vn}}[x]}(i);return _&&_[s]||h[e][s]}Bt("ConstantBinder",Fa),Bt("CrossFadedConstantBinder",Vo),Bt("SourceExpressionBinder",ns),Bt("CrossFadedCompositeBinder",Ms),Bt("CompositeExpressionBinder",Cr),Bt("ProgramConfiguration",ef,{omit:["_buffers"]}),Bt("ProgramConfigurationSet",lo);var dn=8192;const hu=Math.pow(2,14)-1,nf=-hu-1;function co(i){const e=dn/i.extent,s=i.loadGeometry();for(let h=0;h<s.length;h++){const _=s[h];for(let x=0;x<_.length;x++){const S=_[x],P=Math.round(S.x*e),M=Math.round(S.y*e);S.x=b(P,nf,hu),S.y=b(M,nf,hu),(P<S.x||P>S.x+1||M<S.y||M>S.y+1)&&Z("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function uo(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?co(i):[]}}function nc(i,e,s,h,_){i.emplaceBack(2*e+(h+1)/2,2*s+(_+1)/2)}class fu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Mi,this.indexArray=new jn,this.segments=new pi,this.programConfigurations=new lo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){const _=this.layers[0],x=[];let S=null,P=!1;_.type==="circle"&&(S=_.layout.get("circle-sort-key"),P=!S.isConstant());for(const{feature:M,id:R,index:U,sourceLayerIndex:G}of e){const Y=this.layers[0]._featureFilter.needGeometry,ee=uo(M,Y);if(!this.layers[0]._featureFilter.filter(new Ji(this.zoom),ee,h))continue;const te=P?S.evaluate(ee,{},h):void 0,ge={id:R,properties:M.properties,type:M.type,sourceLayerIndex:G,index:U,geometry:Y?ee.geometry:co(M),patterns:{},sortKey:te};x.push(ge)}P&&x.sort((M,R)=>M.sortKey-R.sortKey);for(const M of x){const{geometry:R,index:U,sourceLayerIndex:G}=M,Y=e[U].feature;this.addFeature(M,R,U,h),s.featureIndex.insert(Y,R,U,G,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,h,_){for(const x of s)for(const S of x){const P=S.x,M=S.y;if(P<0||P>=dn||M<0||M>=dn)continue;const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=R.vertexLength;nc(this.layoutVertexArray,P,M,-1,-1),nc(this.layoutVertexArray,P,M,1,-1),nc(this.layoutVertexArray,P,M,1,1),nc(this.layoutVertexArray,P,M,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,{},_)}}function rf(i,e){for(let s=0;s<i.length;s++)if(Go(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(Go(i,e[s]))return!0;return!!du(i,e)}function Fg(i,e,s){return!!Go(i,e)||!!pu(e,i,s)}function sf(i,e){if(i.length===1)return af(e,i[0]);for(let s=0;s<e.length;s++){const h=e[s];for(let _=0;_<h.length;_++)if(Go(i,h[_]))return!0}for(let s=0;s<i.length;s++)if(af(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(du(i,e[s]))return!0;return!1}function Ng(i,e,s){if(i.length>1){if(du(i,e))return!0;for(let h=0;h<e.length;h++)if(pu(e[h],i,s))return!0}for(let h=0;h<i.length;h++)if(pu(i[h],e,s))return!0;return!1}function du(i,e){if(i.length===0||e.length===0)return!1;for(let s=0;s<i.length-1;s++){const h=i[s],_=i[s+1];for(let x=0;x<e.length-1;x++)if(Ug(h,_,e[x],e[x+1]))return!0}return!1}function Ug(i,e,s,h){return ae(i,s,h)!==ae(e,s,h)&&ae(i,e,s)!==ae(i,e,h)}function pu(i,e,s){const h=s*s;if(e.length===1)return i.distSqr(e[0])<h;for(let _=1;_<e.length;_++)if(of(i,e[_-1],e[_])<h)return!0;return!1}function of(i,e,s){const h=e.distSqr(s);if(h===0)return i.distSqr(e);const _=((i.x-e.x)*(s.x-e.x)+(i.y-e.y)*(s.y-e.y))/h;return i.distSqr(_<0?e:_>1?s:s.sub(e)._mult(_)._add(e))}function af(i,e){let s,h,_,x=!1;for(let S=0;S<i.length;S++){s=i[S];for(let P=0,M=s.length-1;P<s.length;M=P++)h=s[P],_=s[M],h.y>e.y!=_.y>e.y&&e.x<(_.x-h.x)*(e.y-h.y)/(_.y-h.y)+h.x&&(x=!x)}return x}function Go(i,e){let s=!1;for(let h=0,_=i.length-1;h<i.length;_=h++){const x=i[h],S=i[_];x.y>e.y!=S.y>e.y&&e.x<(S.x-x.x)*(e.y-x.y)/(S.y-x.y)+x.x&&(s=!s)}return s}function Vg(i,e,s){const h=s[0],_=s[2];if(i.x<h.x&&e.x<h.x||i.x>_.x&&e.x>_.x||i.y<h.y&&e.y<h.y||i.y>_.y&&e.y>_.y)return!1;const x=ae(i,e,s[0]);return x!==ae(i,e,s[1])||x!==ae(i,e,s[2])||x!==ae(i,e,s[3])}function Na(i,e,s){const h=e.paint.get(i).value;return h.kind==="constant"?h.value:s.programConfigurations.get(e.id).getMaxValue(i)}function rc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function sc(i,e,s,h,_){if(!e[0]&&!e[1])return i;const x=ht.convert(e)._mult(_);s==="viewport"&&x._rotate(-h);const S=[];for(let P=0;P<i.length;P++)S.push(i[P].sub(x));return S}Bt("CircleBucket",fu,{omit:["layers"]});const Gg=new En({"circle-sort-key":new $t(Me.layout_circle["circle-sort-key"])});var jg={paint:new En({"circle-radius":new $t(Me.paint_circle["circle-radius"]),"circle-color":new $t(Me.paint_circle["circle-color"]),"circle-blur":new $t(Me.paint_circle["circle-blur"]),"circle-opacity":new $t(Me.paint_circle["circle-opacity"]),"circle-translate":new Nt(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(Me.paint_circle["circle-stroke-opacity"])}),layout:Gg},qn=1e-6,Zn=typeof Float32Array<"u"?Float32Array:Array;function lf(){var i=new Zn(9);return Zn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function mu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function cf(i,e,s){var h=e[0],_=e[1],x=e[2],S=e[3],P=e[4],M=e[5],R=e[6],U=e[7],G=e[8],Y=e[9],ee=e[10],te=e[11],ge=e[12],pe=e[13],Pe=e[14],qe=e[15],Ce=s[0],Fe=s[1],it=s[2],tt=s[3];return i[0]=Ce*h+Fe*P+it*G+tt*ge,i[1]=Ce*_+Fe*M+it*Y+tt*pe,i[2]=Ce*x+Fe*R+it*ee+tt*Pe,i[3]=Ce*S+Fe*U+it*te+tt*qe,i[4]=(Ce=s[4])*h+(Fe=s[5])*P+(it=s[6])*G+(tt=s[7])*ge,i[5]=Ce*_+Fe*M+it*Y+tt*pe,i[6]=Ce*x+Fe*R+it*ee+tt*Pe,i[7]=Ce*S+Fe*U+it*te+tt*qe,i[8]=(Ce=s[8])*h+(Fe=s[9])*P+(it=s[10])*G+(tt=s[11])*ge,i[9]=Ce*_+Fe*M+it*Y+tt*pe,i[10]=Ce*x+Fe*R+it*ee+tt*Pe,i[11]=Ce*S+Fe*U+it*te+tt*qe,i[12]=(Ce=s[12])*h+(Fe=s[13])*P+(it=s[14])*G+(tt=s[15])*ge,i[13]=Ce*_+Fe*M+it*Y+tt*pe,i[14]=Ce*x+Fe*R+it*ee+tt*Pe,i[15]=Ce*S+Fe*U+it*te+tt*qe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Ua,qg=cf;function uf(){var i=new Zn(3);return Zn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function hf(i,e,s){var h=new Zn(3);return h[0]=i,h[1]=e,h[2]=s,h}function oc(i,e,s){var h=e[0],_=e[1],x=e[2],S=e[3];return i[0]=s[0]*h+s[4]*_+s[8]*x+s[12]*S,i[1]=s[1]*h+s[5]*_+s[9]*x+s[13]*S,i[2]=s[2]*h+s[6]*_+s[10]*x+s[14]*S,i[3]=s[3]*h+s[7]*_+s[11]*x+s[15]*S,i}function ff(){var i=new Zn(4);return Zn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function df(i,e){const s=oc([],[i.x,i.y,0,1],e);return new ht(s[0]/s[3],s[1]/s[3])}uf(),Ua=new Zn(4),Zn!=Float32Array&&(Ua[0]=0,Ua[1]=0,Ua[2]=0,Ua[3]=0),uf(),hf(1,0,0),hf(0,1,0),ff(),ff(),lf(),function(){var i;i=new Zn(2),Zn!=Float32Array&&(i[0]=0,i[1]=0)}();class pf extends fu{}Bt("HeatmapBucket",pf,{omit:["layers"]});var Zg={paint:new En({"heatmap-radius":new $t(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fr(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(Me.paint_heatmap["heatmap-opacity"])})};function gu(i,{width:e,height:s},h,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==e*s*h)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${e*s*h}`)}else _=new Uint8Array(e*s*h);return i.width=e,i.height=s,i.data=_,i}function mf(i,{width:e,height:s},h){if(e===i.width&&s===i.height)return;const _=gu({},{width:e,height:s},h);_u(i,_,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,s)},h),i.width=e,i.height=s,i.data=_.data}function _u(i,e,s,h,_,x){if(_.width===0||_.height===0)return e;if(_.width>i.width||_.height>i.height||s.x>i.width-_.width||s.y>i.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>e.width||_.height>e.height||h.x>e.width-_.width||h.y>e.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const S=i.data,P=e.data;if(S===P)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<_.height;M++){const R=((s.y+M)*i.width+s.x)*x,U=((h.y+M)*e.width+h.x)*x;for(let G=0;G<_.width*x;G++)P[U+G]=S[R+G]}return e}class Va{constructor(e,s){gu(this,e,1,s)}resize(e){mf(this,e,1)}clone(){return new Va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,h,_,x){_u(e,s,h,_,x,1)}}class ur{constructor(e,s){gu(this,e,4,s)}resize(e){mf(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ur({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,h,_,x){_u(e,s,h,_,x,4)}}function gf(i){const e={},s=i.resolution||256,h=i.clips?i.clips.length:1,_=i.image||new ur({width:s,height:h});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const x=(S,P,M)=>{e[i.evaluationKey]=M;const R=i.expression.evaluate(e);_.data[S+P+0]=Math.floor(255*R.r/R.a),_.data[S+P+1]=Math.floor(255*R.g/R.a),_.data[S+P+2]=Math.floor(255*R.b/R.a),_.data[S+P+3]=Math.floor(255*R.a)};if(i.clips)for(let S=0,P=0;S<h;++S,P+=4*s)for(let M=0,R=0;M<s;M++,R+=4){const U=M/(s-1),{start:G,end:Y}=i.clips[S];x(P,R,G*(1-U)+Y*U)}else for(let S=0,P=0;S<s;S++,P+=4)x(0,P,S/(s-1));return _}Bt("AlphaImage",Va),Bt("RGBAImage",ur);var Hg={paint:new En({"hillshade-illumination-direction":new Nt(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(Me.paint_hillshade["hillshade-accent-color"])})};const Wg=ln([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xg}=Wg;var ac={exports:{}};function lc(i,e,s){s=s||2;var h,_,x,S,P,M,R,U=e&&e.length,G=U?e[0]*s:i.length,Y=_f(i,0,G,s,!0),ee=[];if(!Y||Y.next===Y.prev)return ee;if(U&&(Y=function(ge,pe,Pe,qe){var Ce,Fe,it,tt=[];for(Ce=0,Fe=pe.length;Ce<Fe;Ce++)(it=_f(ge,pe[Ce]*qe,Ce<Fe-1?pe[Ce+1]*qe:ge.length,qe,!1))===it.next&&(it.steiner=!0),tt.push(i_(it));for(tt.sort($g),Ce=0;Ce<tt.length;Ce++)Pe=e_(tt[Ce],Pe);return Pe}(i,e,Y,s)),i.length>80*s){h=x=i[0],_=S=i[1];for(var te=s;te<G;te+=s)(P=i[te])<h&&(h=P),(M=i[te+1])<_&&(_=M),P>x&&(x=P),M>S&&(S=M);R=(R=Math.max(x-h,S-_))!==0?32767/R:0}return Ga(Y,ee,s,h,_,R,0),ee}function _f(i,e,s,h,_){var x,S;if(_===bu(i,e,s,h)>0)for(x=e;x<s;x+=h)S=bf(x,i[x],i[x+1],S);else for(x=s-h;x>=e;x-=h)S=bf(x,i[x],i[x+1],S);return S&&cc(S,S.next)&&(qa(S),S=S.next),S}function ho(i,e){if(!i)return i;e||(e=i);var s,h=i;do if(s=!1,h.steiner||!cc(h,h.next)&&on(h.prev,h,h.next)!==0)h=h.next;else{if(qa(h),(h=e=h.prev)===h.next)break;s=!0}while(s||h!==e);return e}function Ga(i,e,s,h,_,x,S){if(i){!S&&x&&function(U,G,Y,ee){var te=U;do te.z===0&&(te.z=yu(te.x,te.y,G,Y,ee)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==U);te.prevZ.nextZ=null,te.prevZ=null,function(ge){var pe,Pe,qe,Ce,Fe,it,tt,Lt,Ot=1;do{for(Pe=ge,ge=null,Fe=null,it=0;Pe;){for(it++,qe=Pe,tt=0,pe=0;pe<Ot&&(tt++,qe=qe.nextZ);pe++);for(Lt=Ot;tt>0||Lt>0&&qe;)tt!==0&&(Lt===0||!qe||Pe.z<=qe.z)?(Ce=Pe,Pe=Pe.nextZ,tt--):(Ce=qe,qe=qe.nextZ,Lt--),Fe?Fe.nextZ=Ce:ge=Ce,Ce.prevZ=Fe,Fe=Ce;Pe=qe}Fe.nextZ=null,Ot*=2}while(it>1)}(te)}(i,h,_,x);for(var P,M,R=i;i.prev!==i.next;)if(P=i.prev,M=i.next,x?Jg(i,h,_,x):Kg(i))e.push(P.i/s|0),e.push(i.i/s|0),e.push(M.i/s|0),qa(i),i=M.next,R=M.next;else if((i=M)===R){S?S===1?Ga(i=Yg(ho(i),e,s),e,s,h,_,x,2):S===2&&Qg(i,e,s,h,_,x):Ga(ho(i),e,s,h,_,x,1);break}}}function Kg(i){var e=i.prev,s=i,h=i.next;if(on(e,s,h)>=0)return!1;for(var _=e.x,x=s.x,S=h.x,P=e.y,M=s.y,R=h.y,U=_<x?_<S?_:S:x<S?x:S,G=P<M?P<R?P:R:M<R?M:R,Y=_>x?_>S?_:S:x>S?x:S,ee=P>M?P>R?P:R:M>R?M:R,te=h.next;te!==e;){if(te.x>=U&&te.x<=Y&&te.y>=G&&te.y<=ee&&jo(_,P,x,M,S,R,te.x,te.y)&&on(te.prev,te,te.next)>=0)return!1;te=te.next}return!0}function Jg(i,e,s,h){var _=i.prev,x=i,S=i.next;if(on(_,x,S)>=0)return!1;for(var P=_.x,M=x.x,R=S.x,U=_.y,G=x.y,Y=S.y,ee=P<M?P<R?P:R:M<R?M:R,te=U<G?U<Y?U:Y:G<Y?G:Y,ge=P>M?P>R?P:R:M>R?M:R,pe=U>G?U>Y?U:Y:G>Y?G:Y,Pe=yu(ee,te,e,s,h),qe=yu(ge,pe,e,s,h),Ce=i.prevZ,Fe=i.nextZ;Ce&&Ce.z>=Pe&&Fe&&Fe.z<=qe;){if(Ce.x>=ee&&Ce.x<=ge&&Ce.y>=te&&Ce.y<=pe&&Ce!==_&&Ce!==S&&jo(P,U,M,G,R,Y,Ce.x,Ce.y)&&on(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,Fe.x>=ee&&Fe.x<=ge&&Fe.y>=te&&Fe.y<=pe&&Fe!==_&&Fe!==S&&jo(P,U,M,G,R,Y,Fe.x,Fe.y)&&on(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;Ce&&Ce.z>=Pe;){if(Ce.x>=ee&&Ce.x<=ge&&Ce.y>=te&&Ce.y<=pe&&Ce!==_&&Ce!==S&&jo(P,U,M,G,R,Y,Ce.x,Ce.y)&&on(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;Fe&&Fe.z<=qe;){if(Fe.x>=ee&&Fe.x<=ge&&Fe.y>=te&&Fe.y<=pe&&Fe!==_&&Fe!==S&&jo(P,U,M,G,R,Y,Fe.x,Fe.y)&&on(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function Yg(i,e,s){var h=i;do{var _=h.prev,x=h.next.next;!cc(_,x)&&yf(_,h,h.next,x)&&ja(_,x)&&ja(x,_)&&(e.push(_.i/s|0),e.push(h.i/s|0),e.push(x.i/s|0),qa(h),qa(h.next),h=i=x),h=h.next}while(h!==i);return ho(h)}function Qg(i,e,s,h,_,x){var S=i;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&n_(S,P)){var M=vf(S,P);return S=ho(S,S.next),M=ho(M,M.next),Ga(S,e,s,h,_,x,0),void Ga(M,e,s,h,_,x,0)}P=P.next}S=S.next}while(S!==i)}function $g(i,e){return i.x-e.x}function e_(i,e){var s=function(_,x){var S,P=x,M=_.x,R=_.y,U=-1/0;do{if(R<=P.y&&R>=P.next.y&&P.next.y!==P.y){var G=P.x+(R-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(G<=M&&G>U&&(U=G,S=P.x<P.next.x?P:P.next,G===M))return S}P=P.next}while(P!==x);if(!S)return null;var Y,ee=S,te=S.x,ge=S.y,pe=1/0;P=S;do M>=P.x&&P.x>=te&&M!==P.x&&jo(R<ge?M:U,R,te,ge,R<ge?U:M,R,P.x,P.y)&&(Y=Math.abs(R-P.y)/(M-P.x),ja(P,_)&&(Y<pe||Y===pe&&(P.x>S.x||P.x===S.x&&t_(S,P)))&&(S=P,pe=Y)),P=P.next;while(P!==ee);return S}(i,e);if(!s)return e;var h=vf(s,i);return ho(h,h.next),ho(s,s.next)}function t_(i,e){return on(i.prev,i,e.prev)<0&&on(e.next,i,i.next)<0}function yu(i,e,s,h,_){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*_|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-h)*_|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function i_(i){var e=i,s=i;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==i);return s}function jo(i,e,s,h,_,x,S,P){return(_-S)*(e-P)>=(i-S)*(x-P)&&(i-S)*(h-P)>=(s-S)*(e-P)&&(s-S)*(x-P)>=(_-S)*(h-P)}function n_(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(s,h){var _=s;do{if(_.i!==s.i&&_.next.i!==s.i&&_.i!==h.i&&_.next.i!==h.i&&yf(_,_.next,s,h))return!0;_=_.next}while(_!==s);return!1}(i,e)&&(ja(i,e)&&ja(e,i)&&function(s,h){var _=s,x=!1,S=(s.x+h.x)/2,P=(s.y+h.y)/2;do _.y>P!=_.next.y>P&&_.next.y!==_.y&&S<(_.next.x-_.x)*(P-_.y)/(_.next.y-_.y)+_.x&&(x=!x),_=_.next;while(_!==s);return x}(i,e)&&(on(i.prev,i,e.prev)||on(i,e.prev,e))||cc(i,e)&&on(i.prev,i,i.next)>0&&on(e.prev,e,e.next)>0)}function on(i,e,s){return(e.y-i.y)*(s.x-e.x)-(e.x-i.x)*(s.y-e.y)}function cc(i,e){return i.x===e.x&&i.y===e.y}function yf(i,e,s,h){var _=hc(on(i,e,s)),x=hc(on(i,e,h)),S=hc(on(s,h,i)),P=hc(on(s,h,e));return _!==x&&S!==P||!(_!==0||!uc(i,s,e))||!(x!==0||!uc(i,h,e))||!(S!==0||!uc(s,i,h))||!(P!==0||!uc(s,e,h))}function uc(i,e,s){return e.x<=Math.max(i.x,s.x)&&e.x>=Math.min(i.x,s.x)&&e.y<=Math.max(i.y,s.y)&&e.y>=Math.min(i.y,s.y)}function hc(i){return i>0?1:i<0?-1:0}function ja(i,e){return on(i.prev,i,i.next)<0?on(i,e,i.next)>=0&&on(i,i.prev,e)>=0:on(i,e,i.prev)<0||on(i,i.next,e)<0}function vf(i,e){var s=new vu(i.i,i.x,i.y),h=new vu(e.i,e.x,e.y),_=i.next,x=e.prev;return i.next=e,e.prev=i,s.next=_,_.prev=s,h.next=s,s.prev=h,x.next=h,h.prev=x,h}function bf(i,e,s,h){var _=new vu(i,e,s);return h?(_.next=h.next,_.prev=h,h.next.prev=_,h.next=_):(_.prev=_,_.next=_),_}function qa(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function vu(i,e,s){this.i=i,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bu(i,e,s,h){for(var _=0,x=e,S=s-h;x<s;x+=h)_+=(i[S]-i[x])*(i[x+1]+i[S+1]),S=x;return _}function r_(i,e,s,h,_){xf(i,e,s||0,h||i.length-1,_||s_)}function xf(i,e,s,h,_){for(;h>s;){if(h-s>600){var x=h-s+1,S=e-s+1,P=Math.log(x),M=.5*Math.exp(2*P/3),R=.5*Math.sqrt(P*M*(x-M)/x)*(S-x/2<0?-1:1);xf(i,e,Math.max(s,Math.floor(e-S*M/x+R)),Math.min(h,Math.floor(e+(x-S)*M/x+R)),_)}var U=i[e],G=s,Y=h;for(Za(i,s,e),_(i[h],U)>0&&Za(i,s,h);G<Y;){for(Za(i,G,Y),G++,Y--;_(i[G],U)<0;)G++;for(;_(i[Y],U)>0;)Y--}_(i[s],U)===0?Za(i,s,Y):Za(i,++Y,h),Y<=e&&(s=Y+1),e<=Y&&(h=Y-1)}}function Za(i,e,s){var h=i[e];i[e]=i[s],i[s]=h}function s_(i,e){return i<e?-1:i>e?1:0}function xu(i,e){const s=i.length;if(s<=1)return[i];const h=[];let _,x;for(let S=0;S<s;S++){const P=J(i[S]);P!==0&&(i[S].area=Math.abs(P),x===void 0&&(x=P<0),x===P<0?(_&&h.push(_),_=[i[S]]):_.push(i[S]))}if(_&&h.push(_),e>1)for(let S=0;S<h.length;S++)h[S].length<=e||(r_(h[S],e,1,h[S].length-1,o_),h[S]=h[S].slice(0,e));return h}function o_(i,e){return e.area-i.area}function wu(i,e,s){const h=s.patternDependencies;let _=!1;for(const x of e){const S=x.paint.get(`${i}-pattern`);S.isConstant()||(_=!0);const P=S.constantOr(null);P&&(_=!0,h[P.to]=!0,h[P.from]=!0)}return _}function ku(i,e,s,h,_){const x=_.patternDependencies;for(const S of e){const P=S.paint.get(`${i}-pattern`).value;if(P.kind!=="constant"){let M=P.evaluate({zoom:h-1},s,{},_.availableImages),R=P.evaluate({zoom:h},s,{},_.availableImages),U=P.evaluate({zoom:h+1},s,{},_.availableImages);M=M&&M.name?M.name:M,R=R&&R.name?R.name:R,U=U&&U.name?U.name:U,x[M]=!0,x[R]=!0,x[U]=!0,s.patterns[S.id]={min:M,mid:R,max:U}}}return s}ac.exports=lc,ac.exports.default=lc,lc.deviation=function(i,e,s,h){var _=e&&e.length,x=Math.abs(bu(i,0,_?e[0]*s:i.length,s));if(_)for(var S=0,P=e.length;S<P;S++)x-=Math.abs(bu(i,e[S]*s,S<P-1?e[S+1]*s:i.length,s));var M=0;for(S=0;S<h.length;S+=3){var R=h[S]*s,U=h[S+1]*s,G=h[S+2]*s;M+=Math.abs((i[R]-i[G])*(i[U+1]-i[R+1])-(i[R]-i[U])*(i[G+1]-i[R+1]))}return x===0&&M===0?0:Math.abs((M-x)/x)},lc.flatten=function(i){for(var e=i[0][0].length,s={vertices:[],holes:[],dimensions:e},h=0,_=0;_<i.length;_++){for(var x=0;x<i[_].length;x++)for(var S=0;S<e;S++)s.vertices.push(i[_][x][S]);_>0&&s.holes.push(h+=i[_-1].length)}return s};class Su{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Di,this.indexArray=new jn,this.indexArray2=new Ar,this.programConfigurations=new lo(e.layers,e.zoom),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.hasPattern=wu("fill",this.layers,s);const _=this.layers[0].layout.get("fill-sort-key"),x=!_.isConstant(),S=[];for(const{feature:P,id:M,index:R,sourceLayerIndex:U}of e){const G=this.layers[0]._featureFilter.needGeometry,Y=uo(P,G);if(!this.layers[0]._featureFilter.filter(new Ji(this.zoom),Y,h))continue;const ee=x?_.evaluate(Y,{},h,s.availableImages):void 0,te={id:M,properties:P.properties,type:P.type,sourceLayerIndex:U,index:R,geometry:G?Y.geometry:co(P),patterns:{},sortKey:ee};S.push(te)}x&&S.sort((P,M)=>P.sortKey-M.sortKey);for(const P of S){const{geometry:M,index:R,sourceLayerIndex:U}=P;if(this.hasPattern){const G=ku("fill",this.layers,P,this.zoom,s);this.patternFeatures.push(G)}else this.addFeature(P,M,R,h,{});s.featureIndex.insert(e[R].feature,M,R,U,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}addFeatures(e,s,h){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,h,_,x){for(const S of xu(s,500)){let P=0;for(const ee of S)P+=ee.length;const M=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),R=M.vertexLength,U=[],G=[];for(const ee of S){if(ee.length===0)continue;ee!==S[0]&&G.push(U.length/2);const te=this.segments2.prepareSegment(ee.length,this.layoutVertexArray,this.indexArray2),ge=te.vertexLength;this.layoutVertexArray.emplaceBack(ee[0].x,ee[0].y),this.indexArray2.emplaceBack(ge+ee.length-1,ge),U.push(ee[0].x),U.push(ee[0].y);for(let pe=1;pe<ee.length;pe++)this.layoutVertexArray.emplaceBack(ee[pe].x,ee[pe].y),this.indexArray2.emplaceBack(ge+pe-1,ge+pe),U.push(ee[pe].x),U.push(ee[pe].y);te.vertexLength+=ee.length,te.primitiveLength+=ee.length}const Y=ac.exports(U,G);for(let ee=0;ee<Y.length;ee+=3)this.indexArray.emplaceBack(R+Y[ee],R+Y[ee+1],R+Y[ee+2]);M.vertexLength+=P,M.primitiveLength+=Y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,x,_)}}Bt("FillBucket",Su,{omit:["layers","patternFeatures"]});const a_=new En({"fill-sort-key":new $t(Me.layout_fill["fill-sort-key"])});var l_={paint:new En({"fill-antialias":new Nt(Me.paint_fill["fill-antialias"]),"fill-opacity":new $t(Me.paint_fill["fill-opacity"]),"fill-color":new $t(Me.paint_fill["fill-color"]),"fill-outline-color":new $t(Me.paint_fill["fill-outline-color"]),"fill-translate":new Nt(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ps(Me.paint_fill["fill-pattern"])}),layout:a_};const c_=ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),u_=ln([{name:"a_centroid",components:2,type:"Int16"}],4),{members:h_}=c_;var Ds={},f_=ht,wf=qo;function qo(i,e,s,h,_){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=h,this._values=_,i.readFields(d_,this,e)}function d_(i,e,s){i==1?e.id=s.readVarint():i==2?function(h,_){for(var x=h.readVarint()+h.pos;h.pos<x;){var S=_._keys[h.readVarint()],P=_._values[h.readVarint()];_.properties[S]=P}}(s,e):i==3?e.type=s.readVarint():i==4&&(e._geometry=s.pos)}function p_(i){for(var e,s,h=0,_=0,x=i.length,S=x-1;_<x;S=_++)h+=((s=i[S]).x-(e=i[_]).x)*(e.y+s.y);return h}qo.types=["Unknown","Point","LineString","Polygon"],qo.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,s=i.readVarint()+i.pos,h=1,_=0,x=0,S=0,P=[];i.pos<s;){if(_<=0){var M=i.readVarint();h=7&M,_=M>>3}if(_--,h===1||h===2)x+=i.readSVarint(),S+=i.readSVarint(),h===1&&(e&&P.push(e),e=[]),e.push(new f_(x,S));else{if(h!==7)throw new Error("unknown command "+h);e&&e.push(e[0].clone())}}return e&&P.push(e),P},qo.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,s=1,h=0,_=0,x=0,S=1/0,P=-1/0,M=1/0,R=-1/0;i.pos<e;){if(h<=0){var U=i.readVarint();s=7&U,h=U>>3}if(h--,s===1||s===2)(_+=i.readSVarint())<S&&(S=_),_>P&&(P=_),(x+=i.readSVarint())<M&&(M=x),x>R&&(R=x);else if(s!==7)throw new Error("unknown command "+s)}return[S,M,P,R]},qo.prototype.toGeoJSON=function(i,e,s){var h,_,x=this.extent*Math.pow(2,s),S=this.extent*i,P=this.extent*e,M=this.loadGeometry(),R=qo.types[this.type];function U(ee){for(var te=0;te<ee.length;te++){var ge=ee[te];ee[te]=[360*(ge.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(ge.y+P)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<M.length;h++)G[h]=M[h][0];U(M=G);break;case 2:for(h=0;h<M.length;h++)U(M[h]);break;case 3:for(M=function(ee){var te=ee.length;if(te<=1)return[ee];for(var ge,pe,Pe=[],qe=0;qe<te;qe++){var Ce=p_(ee[qe]);Ce!==0&&(pe===void 0&&(pe=Ce<0),pe===Ce<0?(ge&&Pe.push(ge),ge=[ee[qe]]):ge.push(ee[qe]))}return ge&&Pe.push(ge),Pe}(M),h=0;h<M.length;h++)for(_=0;_<M[h].length;_++)U(M[h][_])}M.length===1?M=M[0]:R="Multi"+R;var Y={type:"Feature",geometry:{type:R,coordinates:M},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var m_=wf,kf=Sf;function Sf(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(g_,this,e),this.length=this._features.length}function g_(i,e,s){i===15?e.version=s.readVarint():i===1?e.name=s.readString():i===5?e.extent=s.readVarint():i===2?e._features.push(s.pos):i===3?e._keys.push(s.readString()):i===4&&e._values.push(function(h){for(var _=null,x=h.readVarint()+h.pos;h.pos<x;){var S=h.readVarint()>>3;_=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return _}(s))}Sf.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new m_(this._pbf,e,this.extent,this._keys,this._values)};var __=kf;function y_(i,e,s){if(i===3){var h=new __(s,s.readVarint()+s.pos);h.length&&(e[h.name]=h)}}Ds.VectorTile=function(i,e){this.layers=i.readFields(y_,{},e)},Ds.VectorTileFeature=wf,Ds.VectorTileLayer=kf;const v_=Ds.VectorTileFeature.types,Eu=Math.pow(2,13);function Ha(i,e,s,h,_,x,S,P){i.emplaceBack(e,s,2*Math.floor(h*Eu)+S,_*Eu*2,x*Eu*2,Math.round(P))}class Tu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new vi,this.centroidVertexArray=new Ht,this.indexArray=new jn,this.programConfigurations=new lo(e.layers,e.zoom),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.features=[],this.hasPattern=wu("fill-extrusion",this.layers,s);for(const{feature:_,id:x,index:S,sourceLayerIndex:P}of e){const M=this.layers[0]._featureFilter.needGeometry,R=uo(_,M);if(!this.layers[0]._featureFilter.filter(new Ji(this.zoom),R,h))continue;const U={id:x,sourceLayerIndex:P,index:S,geometry:M?R.geometry:co(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(ku("fill-extrusion",this.layers,U,this.zoom,s)):this.addFeature(U,U.geometry,S,h,{}),s.featureIndex.insert(_,U.geometry,S,P,this.index,!0)}}addFeatures(e,s,h){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,s,h)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,h_),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,u_.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,s,h,_,x){const S={x:0,y:0,vertexCount:0};for(const P of xu(s,500)){let M=0;for(const te of P)M+=te.length;let R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const te of P){if(te.length===0||x_(te))continue;let ge=0;for(let pe=0;pe<te.length;pe++){const Pe=te[pe];if(pe>=1){const qe=te[pe-1];if(!b_(Pe,qe)){R.vertexLength+4>pi.MAX_VERTEX_ARRAY_LENGTH&&(R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ce=Pe.sub(qe)._perp()._unit(),Fe=qe.dist(Pe);ge+Fe>32768&&(ge=0),Ha(this.layoutVertexArray,Pe.x,Pe.y,Ce.x,Ce.y,0,0,ge),Ha(this.layoutVertexArray,Pe.x,Pe.y,Ce.x,Ce.y,0,1,ge),S.x+=2*Pe.x,S.y+=2*Pe.y,S.vertexCount+=2,ge+=Fe,Ha(this.layoutVertexArray,qe.x,qe.y,Ce.x,Ce.y,0,0,ge),Ha(this.layoutVertexArray,qe.x,qe.y,Ce.x,Ce.y,0,1,ge),S.x+=2*qe.x,S.y+=2*qe.y,S.vertexCount+=2;const it=R.vertexLength;this.indexArray.emplaceBack(it,it+2,it+1),this.indexArray.emplaceBack(it+1,it+2,it+3),R.vertexLength+=4,R.primitiveLength+=2}}}}if(R.vertexLength+M>pi.MAX_VERTEX_ARRAY_LENGTH&&(R=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),v_[e.type]!=="Polygon")continue;const U=[],G=[],Y=R.vertexLength;for(const te of P)if(te.length!==0){te!==P[0]&&G.push(U.length/2);for(let ge=0;ge<te.length;ge++){const pe=te[ge];Ha(this.layoutVertexArray,pe.x,pe.y,0,0,1,1,0),S.x+=pe.x,S.y+=pe.y,S.vertexCount+=1,U.push(pe.x),U.push(pe.y)}}const ee=ac.exports(U,G);for(let te=0;te<ee.length;te+=3)this.indexArray.emplaceBack(Y+ee[te],Y+ee[te+2],Y+ee[te+1]);R.primitiveLength+=ee.length/3,R.vertexLength+=M}for(let P=0;P<S.vertexCount;P++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,x,_)}}function b_(i,e){return i.x===e.x&&(i.x<0||i.x>dn)||i.y===e.y&&(i.y<0||i.y>dn)}function x_(i){return i.every(e=>e.x<0)||i.every(e=>e.x>dn)||i.every(e=>e.y<0)||i.every(e=>e.y>dn)}Bt("FillExtrusionBucket",Tu,{omit:["layers","features"]});var w_={paint:new En({"fill-extrusion-opacity":new Nt(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ps(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $t(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Nt(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Wa(i,e){return i.x*e.x+i.y*e.y}function Ef(i,e){if(i.length===1){let s=0;const h=e[s++];let _;for(;!_||h.equals(_);)if(_=e[s++],!_)return 1/0;for(;s<e.length;s++){const x=e[s],S=i[0],P=_.sub(h),M=x.sub(h),R=S.sub(h),U=Wa(P,P),G=Wa(P,M),Y=Wa(M,M),ee=Wa(R,P),te=Wa(R,M),ge=U*Y-G*G,pe=(Y*ee-G*te)/ge,Pe=(U*te-G*ee)/ge,qe=h.z*(1-pe-Pe)+_.z*pe+x.z*Pe;if(isFinite(qe))return qe}return 1/0}{let s=1/0;for(const h of e)s=Math.min(s,h.z);return s}}const k_=ln([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:S_}=k_,E_=ln([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:T_}=E_,A_=Ds.VectorTileFeature.types,C_=Math.cos(Math.PI/180*37.5),Tf=Math.pow(2,14)/.5;class Au{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Si,this.layoutVertexArray2=new Ri,this.indexArray=new jn,this.programConfigurations=new lo(e.layers,e.zoom),this.segments=new pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.hasPattern=wu("line",this.layers,s);const _=this.layers[0].layout.get("line-sort-key"),x=!_.isConstant(),S=[];for(const{feature:P,id:M,index:R,sourceLayerIndex:U}of e){const G=this.layers[0]._featureFilter.needGeometry,Y=uo(P,G);if(!this.layers[0]._featureFilter.filter(new Ji(this.zoom),Y,h))continue;const ee=x?_.evaluate(Y,{},h):void 0,te={id:M,properties:P.properties,type:P.type,sourceLayerIndex:U,index:R,geometry:G?Y.geometry:co(P),patterns:{},sortKey:ee};S.push(te)}x&&S.sort((P,M)=>P.sortKey-M.sortKey);for(const P of S){const{geometry:M,index:R,sourceLayerIndex:U}=P;if(this.hasPattern){const G=ku("line",this.layers,P,this.zoom,s);this.patternFeatures.push(G)}else this.addFeature(P,M,R,h,{});s.featureIndex.insert(e[R].feature,M,R,U,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}addFeatures(e,s,h){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,T_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,h,_,x){const S=this.layers[0].layout,P=S.get("line-join").evaluate(e,{}),M=S.get("line-cap"),R=S.get("line-miter-limit"),U=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const G of s)this.addLine(G,e,P,M,R,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,x,_)}addLine(e,s,h,_,x,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<e.length-1;Pe++)this.totalDistance+=e[Pe].dist(e[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=A_[s.type]==="Polygon";let M=e.length;for(;M>=2&&e[M-1].equals(e[M-2]);)M--;let R=0;for(;R<M-1&&e[R].equals(e[R+1]);)R++;if(M<(P?3:2))return;h==="bevel"&&(x=1.05);const U=this.overscaling<=16?122880/(512*this.overscaling):0,G=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let Y,ee,te,ge,pe;this.e1=this.e2=-1,P&&(Y=e[M-2],pe=e[R].sub(Y)._unit()._perp());for(let Pe=R;Pe<M;Pe++){if(te=Pe===M-1?P?e[R+1]:void 0:e[Pe+1],te&&e[Pe].equals(te))continue;pe&&(ge=pe),Y&&(ee=Y),Y=e[Pe],pe=te?te.sub(Y)._unit()._perp():ge,ge=ge||pe;let qe=ge.add(pe);qe.x===0&&qe.y===0||qe._unit();const Ce=ge.x*pe.x+ge.y*pe.y,Fe=qe.x*pe.x+qe.y*pe.y,it=Fe!==0?1/Fe:1/0,tt=2*Math.sqrt(2-2*Fe),Lt=Fe<C_&&ee&&te,Ot=ge.x*pe.y-ge.y*pe.x>0;if(Lt&&Pe>R){const vt=Y.dist(ee);if(vt>2*U){const It=Y.sub(Y.sub(ee)._mult(U/vt)._round());this.updateDistance(ee,It),this.addCurrentVertex(It,ge,0,0,G),ee=It}}const Ct=ee&&te;let St=Ct?h:P?"butt":_;if(Ct&&St==="round"&&(it<S?St="miter":it<=2&&(St="fakeround")),St==="miter"&&it>x&&(St="bevel"),St==="bevel"&&(it>2&&(St="flipbevel"),it<x&&(St="miter")),ee&&this.updateDistance(ee,Y),St==="miter")qe._mult(it),this.addCurrentVertex(Y,qe,0,0,G);else if(St==="flipbevel"){if(it>100)qe=pe.mult(-1);else{const vt=it*ge.add(pe).mag()/ge.sub(pe).mag();qe._perp()._mult(vt*(Ot?-1:1))}this.addCurrentVertex(Y,qe,0,0,G),this.addCurrentVertex(Y,qe.mult(-1),0,0,G)}else if(St==="bevel"||St==="fakeround"){const vt=-Math.sqrt(it*it-1),It=Ot?vt:0,Tt=Ot?0:vt;if(ee&&this.addCurrentVertex(Y,ge,It,Tt,G),St==="fakeround"){const ut=Math.round(180*tt/Math.PI/20);for(let Wt=1;Wt<ut;Wt++){let Gt=Wt/ut;if(Gt!==.5){const Zi=Gt-.5;Gt+=Gt*Zi*(Gt-1)*((1.0904+Ce*(Ce*(3.55645-1.43519*Ce)-3.2452))*Zi*Zi+(.848013+Ce*(.215638*Ce-1.06021)))}const fi=pe.sub(ge)._mult(Gt)._add(ge)._unit()._mult(Ot?-1:1);this.addHalfVertex(Y,fi.x,fi.y,!1,Ot,0,G)}}te&&this.addCurrentVertex(Y,pe,-It,-Tt,G)}else if(St==="butt")this.addCurrentVertex(Y,qe,0,0,G);else if(St==="square"){const vt=ee?1:-1;this.addCurrentVertex(Y,qe,vt,vt,G)}else St==="round"&&(ee&&(this.addCurrentVertex(Y,ge,0,0,G),this.addCurrentVertex(Y,ge,1,1,G,!0)),te&&(this.addCurrentVertex(Y,pe,-1,-1,G,!0),this.addCurrentVertex(Y,pe,0,0,G)));if(Lt&&Pe<M-1){const vt=Y.dist(te);if(vt>2*U){const It=Y.add(te.sub(Y)._mult(U/vt)._round());this.updateDistance(Y,It),this.addCurrentVertex(It,pe,0,0,G),Y=It}}}}addCurrentVertex(e,s,h,_,x,S=!1){const P=s.y*_-s.x,M=-s.y-s.x*_;this.addHalfVertex(e,s.x+s.y*h,s.y-s.x*h,S,!1,h,x),this.addHalfVertex(e,P,M,S,!0,-_,x),this.distance>Tf/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,s,h,_,x,S))}addHalfVertex({x:e,y:s},h,_,x,S,P,M){const R=.5*(this.lineClips?this.scaledDistance*(Tf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(x?1:0),(s<<1)+(S?1:0),Math.round(63*h)+128,Math.round(63*_)+128,1+(P===0?0:P<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const U=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),M.primitiveLength++),S?this.e2=U:this.e1=U}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}Bt("LineBucket",Au,{omit:["layers","patternFeatures"]});const I_=new En({"line-cap":new Nt(Me.layout_line["line-cap"]),"line-join":new $t(Me.layout_line["line-join"]),"line-miter-limit":new Nt(Me.layout_line["line-miter-limit"]),"line-round-limit":new Nt(Me.layout_line["line-round-limit"]),"line-sort-key":new $t(Me.layout_line["line-sort-key"])});var Af={paint:new En({"line-opacity":new $t(Me.paint_line["line-opacity"]),"line-color":new $t(Me.paint_line["line-color"]),"line-translate":new Nt(Me.paint_line["line-translate"]),"line-translate-anchor":new Nt(Me.paint_line["line-translate-anchor"]),"line-width":new $t(Me.paint_line["line-width"]),"line-gap-width":new $t(Me.paint_line["line-gap-width"]),"line-offset":new $t(Me.paint_line["line-offset"]),"line-blur":new $t(Me.paint_line["line-blur"]),"line-dasharray":new La(Me.paint_line["line-dasharray"]),"line-pattern":new Ps(Me.paint_line["line-pattern"]),"line-gradient":new Fr(Me.paint_line["line-gradient"])}),layout:I_};const Cf=new class extends $t{possiblyEvaluate(i,e){return e=new Ji(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,s,h){return e=T({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,s,h)}}(Af.paint.properties["line-width"].specification);function If(i,e){return e>0?e+2*i:i}Cf.useIntegerZoom=!0;const P_=ln([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),z_=ln([{name:"a_projected_pos",components:3,type:"Float32"}],4);ln([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const M_=ln([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ln([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Pf=ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),D_=ln([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function L_(i,e,s){return i.sections.forEach(h=>{h.text=function(_,x,S){const P=x.layout.get("text-transform").evaluate(S,{});return P==="uppercase"?_=_.toLocaleUpperCase():P==="lowercase"&&(_=_.toLocaleLowerCase()),nr.applyArabicShaping&&(_=nr.applyArabicShaping(_)),_}(h.text,e,s)}),i}ln([{name:"triangle",components:3,type:"Uint16"}]),ln([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ln([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ln([{type:"Float32",name:"offsetX"}]),ln([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Xa={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Tn=24,Cu=Ni,zf=function(i,e,s,h,_){var x,S,P=8*_-h-1,M=(1<<P)-1,R=M>>1,U=-7,G=s?_-1:0,Y=s?-1:1,ee=i[e+G];for(G+=Y,x=ee&(1<<-U)-1,ee>>=-U,U+=P;U>0;x=256*x+i[e+G],G+=Y,U-=8);for(S=x&(1<<-U)-1,x>>=-U,U+=h;U>0;S=256*S+i[e+G],G+=Y,U-=8);if(x===0)x=1-R;else{if(x===M)return S?NaN:1/0*(ee?-1:1);S+=Math.pow(2,h),x-=R}return(ee?-1:1)*S*Math.pow(2,x-h)},Mf=function(i,e,s,h,_,x){var S,P,M,R=8*x-_-1,U=(1<<R)-1,G=U>>1,Y=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,ee=h?0:x-1,te=h?1:-1,ge=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(P=isNaN(e)?1:0,S=U):(S=Math.floor(Math.log(e)/Math.LN2),e*(M=Math.pow(2,-S))<1&&(S--,M*=2),(e+=S+G>=1?Y/M:Y*Math.pow(2,1-G))*M>=2&&(S++,M/=2),S+G>=U?(P=0,S=U):S+G>=1?(P=(e*M-1)*Math.pow(2,_),S+=G):(P=e*Math.pow(2,G-1)*Math.pow(2,_),S=0));_>=8;i[s+ee]=255&P,ee+=te,P/=256,_-=8);for(S=S<<_|P,R+=_;R>0;i[s+ee]=255&S,ee+=te,S/=256,R-=8);i[s+ee-te]|=128*ge};function Ni(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ni.Varint=0,Ni.Fixed64=1,Ni.Bytes=2,Ni.Fixed32=5;var Ls,Iu=4294967296,Df=1/Iu,Lf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function rs(i){return i.type===Ni.Bytes?i.readVarint()+i.pos:i.pos+1}function Zo(i,e,s){return s?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Bf(i,e,s){var h=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(h);for(var _=s.pos-1;_>=i;_--)s.buf[_+h]=s.buf[_]}function B_(i,e){for(var s=0;s<i.length;s++)e.writeVarint(i[s])}function R_(i,e){for(var s=0;s<i.length;s++)e.writeSVarint(i[s])}function O_(i,e){for(var s=0;s<i.length;s++)e.writeFloat(i[s])}function F_(i,e){for(var s=0;s<i.length;s++)e.writeDouble(i[s])}function N_(i,e){for(var s=0;s<i.length;s++)e.writeBoolean(i[s])}function U_(i,e){for(var s=0;s<i.length;s++)e.writeFixed32(i[s])}function V_(i,e){for(var s=0;s<i.length;s++)e.writeSFixed32(i[s])}function G_(i,e){for(var s=0;s<i.length;s++)e.writeFixed64(i[s])}function j_(i,e){for(var s=0;s<i.length;s++)e.writeSFixed64(i[s])}function fc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ho(i,e,s){i[s]=e,i[s+1]=e>>>8,i[s+2]=e>>>16,i[s+3]=e>>>24}function Rf(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function q_(i,e,s){i===1&&s.readMessage(Z_,e)}function Z_(i,e,s){if(i===3){const{id:h,bitmap:_,width:x,height:S,left:P,top:M,advance:R}=s.readMessage(H_,{});e.push({id:h,bitmap:new Va({width:x+6,height:S+6},_),metrics:{width:x,height:S,left:P,top:M,advance:R}})}}function H_(i,e,s){i===1?e.id=s.readVarint():i===2?e.bitmap=s.readBytes():i===3?e.width=s.readVarint():i===4?e.height=s.readVarint():i===5?e.left=s.readSVarint():i===6?e.top=s.readSVarint():i===7&&(e.advance=s.readVarint())}function Of(i){let e=0,s=0;for(const S of i)e+=S.w*S.h,s=Math.max(s,S.w);i.sort((S,P)=>P.h-S.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let _=0,x=0;for(const S of i)for(let P=h.length-1;P>=0;P--){const M=h[P];if(!(S.w>M.w||S.h>M.h)){if(S.x=M.x,S.y=M.y,x=Math.max(x,S.y+S.h),_=Math.max(_,S.x+S.w),S.w===M.w&&S.h===M.h){const R=h.pop();P<h.length&&(h[P]=R)}else S.h===M.h?(M.x+=S.w,M.w-=S.w):S.w===M.w?(M.y+=S.h,M.h-=S.h):(h.push({x:M.x+S.w,y:M.y,w:M.w-S.w,h:S.h}),M.y+=S.h,M.h-=S.h);break}}return{w:_,h:x,fill:e/(_*x)||0}}Ni.prototype={destroy:function(){this.buf=null},readFields:function(i,e,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),_=h>>3,x=this.pos;this.type=7&h,i(_,e,this),this.pos===x&&this.skip(h)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=fc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Rf(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=fc(this.buf,this.pos)+fc(this.buf,this.pos+4)*Iu;return this.pos+=8,i},readSFixed64:function(){var i=fc(this.buf,this.pos)+Rf(this.buf,this.pos+4)*Iu;return this.pos+=8,i},readFloat:function(){var i=zf(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=zf(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,s,h=this.buf;return e=127&(s=h[this.pos++]),s<128?e:(e|=(127&(s=h[this.pos++]))<<7,s<128?e:(e|=(127&(s=h[this.pos++]))<<14,s<128?e:(e|=(127&(s=h[this.pos++]))<<21,s<128?e:function(_,x,S){var P,M,R=S.buf;if(P=(112&(M=R[S.pos++]))>>4,M<128||(P|=(127&(M=R[S.pos++]))<<3,M<128)||(P|=(127&(M=R[S.pos++]))<<10,M<128)||(P|=(127&(M=R[S.pos++]))<<17,M<128)||(P|=(127&(M=R[S.pos++]))<<24,M<128)||(P|=(1&(M=R[S.pos++]))<<31,M<128))return Zo(_,P,x);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=h[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Lf?function(s,h,_){return Lf.decode(s.subarray(h,_))}(this.buf,e,i):function(s,h,_){for(var x="",S=h;S<_;){var P,M,R,U=s[S],G=null,Y=U>239?4:U>223?3:U>191?2:1;if(S+Y>_)break;Y===1?U<128&&(G=U):Y===2?(192&(P=s[S+1]))==128&&(G=(31&U)<<6|63&P)<=127&&(G=null):Y===3?(M=s[S+2],(192&(P=s[S+1]))==128&&(192&M)==128&&((G=(15&U)<<12|(63&P)<<6|63&M)<=2047||G>=55296&&G<=57343)&&(G=null)):Y===4&&(M=s[S+2],R=s[S+3],(192&(P=s[S+1]))==128&&(192&M)==128&&(192&R)==128&&((G=(15&U)<<18|(63&P)<<12|(63&M)<<6|63&R)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,Y=1):G>65535&&(G-=65536,x+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),x+=String.fromCharCode(G),S+=Y}return x}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ni.Bytes)return i.push(this.readVarint(e));var s=rs(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSVarint());var e=rs(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ni.Bytes)return i.push(this.readBoolean());var e=rs(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFloat());var e=rs(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ni.Bytes)return i.push(this.readDouble());var e=rs(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFixed32());var e=rs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSFixed32());var e=rs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFixed64());var e=rs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSFixed64());var e=rs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ni.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ni.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ni.Fixed32)this.pos+=4;else{if(e!==Ni.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ho(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ho(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ho(this.buf,-1&i,this.pos),Ho(this.buf,Math.floor(i*Df),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ho(this.buf,-1&i,this.pos),Ho(this.buf,Math.floor(i*Df),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,s){var h,_;if(e>=0?(h=e%4294967296|0,_=e/4294967296|0):(_=~(-e/4294967296),4294967295^(h=~(-e%4294967296))?h=h+1|0:(h=0,_=_+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(x,S,P){P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,P.buf[P.pos]=127&(x>>>=7)}(h,0,s),function(x,S){var P=(7&x)<<4;S.buf[S.pos++]|=P|((x>>>=3)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x)))))}(_,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(h,_,x){for(var S,P,M=0;M<_.length;M++){if((S=_.charCodeAt(M))>55295&&S<57344){if(!P){S>56319||M+1===_.length?(h[x++]=239,h[x++]=191,h[x++]=189):P=S;continue}if(S<56320){h[x++]=239,h[x++]=191,h[x++]=189,P=S;continue}S=P-55296<<10|S-56320|65536,P=null}else P&&(h[x++]=239,h[x++]=191,h[x++]=189,P=null);S<128?h[x++]=S:(S<2048?h[x++]=S>>6|192:(S<65536?h[x++]=S>>12|224:(h[x++]=S>>18|240,h[x++]=S>>12&63|128),h[x++]=S>>6&63|128),h[x++]=63&S|128)}return x}(this.buf,i,this.pos);var s=this.pos-e;s>=128&&Bf(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),Mf(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Mf(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,e){this.pos++;var s=this.pos;i(e,this);var h=this.pos-s;h>=128&&Bf(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(i,e,s){this.writeTag(i,Ni.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,B_,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,R_,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,N_,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,O_,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,F_,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,U_,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,V_,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,G_,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,j_,e)},writeBytesField:function(i,e){this.writeTag(i,Ni.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ni.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ni.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ni.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ni.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ni.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ni.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ni.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ni.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ni.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};class Pu{constructor(e,{pixelRatio:s,version:h,stretchX:_,stretchY:x,content:S}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=_,this.stretchY=x,this.content=S,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ff{constructor(e,s){const h={},_={};this.haveRenderCallbacks=[];const x=[];this.addImages(e,h,x),this.addImages(s,_,x);const{w:S,h:P}=Of(x),M=new ur({width:S||1,height:P||1});for(const R in e){const U=e[R],G=h[R].paddedRect;ur.copy(U.data,M,{x:0,y:0},{x:G.x+1,y:G.y+1},U.data)}for(const R in s){const U=s[R],G=_[R].paddedRect,Y=G.x+1,ee=G.y+1,te=U.data.width,ge=U.data.height;ur.copy(U.data,M,{x:0,y:0},{x:Y,y:ee},U.data),ur.copy(U.data,M,{x:0,y:ge-1},{x:Y,y:ee-1},{width:te,height:1}),ur.copy(U.data,M,{x:0,y:0},{x:Y,y:ee+ge},{width:te,height:1}),ur.copy(U.data,M,{x:te-1,y:0},{x:Y-1,y:ee},{width:1,height:ge}),ur.copy(U.data,M,{x:0,y:0},{x:Y+te,y:ee},{width:1,height:ge})}this.image=M,this.iconPositions=h,this.patternPositions=_}addImages(e,s,h){for(const _ in e){const x=e[_],S={x:0,y:0,w:x.data.width+2,h:x.data.height+2};h.push(S),s[_]=new Pu(S,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in e.updatedImages)this.patchUpdatedImage(this.iconPositions[h],e.getImage(h),s),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h),s)}patchUpdatedImage(e,s,h){if(!e||!s||e.version===s.version)return;e.version=s.version;const[_,x]=e.tl;h.update(s.data,void 0,{x:_,y:x})}}Bt("ImagePosition",Pu),Bt("ImageAtlas",Ff),n.WritingMode=void 0,(Ls=n.WritingMode||(n.WritingMode={}))[Ls.none=0]="none",Ls[Ls.horizontal=1]="horizontal",Ls[Ls.vertical=2]="vertical",Ls[Ls.horizontalOnly=3]="horizontalOnly";const dc=-17;class Ka{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const h=new Ka;return h.scale=e||1,h.fontStack=s,h}static forImage(e){const s=new Ka;return s.imageName=e,s}}class Wo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const h=new Wo;for(let _=0;_<e.sections.length;_++){const x=e.sections[_];x.image?h.addImageSection(x):h.addTextSection(x,s)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let s="";for(let h=0;h<e.length;h++){const _=e.charCodeAt(h+1)||null,x=e.charCodeAt(h-1)||null;s+=_&&Wl(_)&&!Xa[e[h+1]]||x&&Wl(x)&&!Xa[e[h-1]]||!Xa[e[h]]?e[h]:Xa[e[h]]}return s}(this.text)}trim(){let e=0;for(let h=0;h<this.text.length&&mc[this.text.charCodeAt(h)];h++)e++;let s=this.text.length;for(let h=this.text.length-1;h>=0&&h>=e&&mc[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const h=new Wo;return h.text=this.text.substring(e,s),h.sectionIndex=this.sectionIndex.slice(e,s),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(Ka.forText(e.scale,e.fontStack||s));const h=this.sections.length-1;for(let _=0;_<e.text.length;++_)this.sectionIndex.push(h)}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void Z("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Ka.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Z("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pc(i,e,s,h,_,x,S,P,M,R,U,G,Y,ee,te,ge){const pe=Wo.fromFeature(i,_);let Pe;G===n.WritingMode.vertical&&pe.verticalizePunctuation();const{processBidirectionalText:qe,processStyledBidirectionalText:Ce}=nr;if(qe&&pe.sections.length===1){Pe=[];const tt=qe(pe.toString(),zu(pe,R,x,e,h,ee,te));for(const Lt of tt){const Ot=new Wo;Ot.text=Lt,Ot.sections=pe.sections;for(let Ct=0;Ct<Lt.length;Ct++)Ot.sectionIndex.push(0);Pe.push(Ot)}}else if(Ce){Pe=[];const tt=Ce(pe.text,pe.sectionIndex,zu(pe,R,x,e,h,ee,te));for(const Lt of tt){const Ot=new Wo;Ot.text=Lt[0],Ot.sectionIndex=Lt[1],Ot.sections=pe.sections,Pe.push(Ot)}}else Pe=function(tt,Lt){const Ot=[],Ct=tt.text;let St=0;for(const vt of Lt)Ot.push(tt.substring(St,vt)),St=vt;return St<Ct.length&&Ot.push(tt.substring(St,Ct.length)),Ot}(pe,zu(pe,R,x,e,h,ee,te));const Fe=[],it={positionedLines:Fe,text:pe.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(tt,Lt,Ot,Ct,St,vt,It,Tt,ut,Wt,Gt,fi){let Zi=0,Qi=dc,pn=0,fr=0;const Dn=Tt==="right"?1:Tt==="left"?0:.5;let cn=0;for(const un of St){un.trim();const Bn=un.getMaxScale(),Nn=(Bn-1)*Tn,Hn={positionedGlyphs:[],lineOffset:0};tt.positionedLines[cn]=Hn;const Qn=Hn.positionedGlyphs;let $n=0;if(!un.length()){Qi+=vt,++cn;continue}for(let kn=0;kn<un.length();kn++){const gi=un.getSection(kn),or=un.getSectionIndex(kn),Rn=un.getCharCode(kn);let Un=0,xr=null,Ir=null,Pr=null,os=Tn;const wr=!(ut===n.WritingMode.horizontal||!Gt&&!Ca(Rn)||Gt&&(mc[Rn]||(wn=Rn,At.Arabic(wn)||At["Arabic Supplement"](wn)||At["Arabic Extended-A"](wn)||At["Arabic Presentation Forms-A"](wn)||At["Arabic Presentation Forms-B"](wn))));if(gi.imageName){const dr=Ct[gi.imageName];if(!dr)continue;Pr=gi.imageName,tt.iconsInText=tt.iconsInText||!0,Ir=dr.paddedRect;const er=dr.displaySize;gi.scale=gi.scale*Tn/fi,xr={width:er[0],height:er[1],left:1,top:-3,advance:wr?er[1]:er[0]},Un=Nn+(Tn-er[1]*gi.scale),os=xr.advance;const as=wr?er[0]*gi.scale-Tn*Bn:er[1]*gi.scale-Tn*Bn;as>0&&as>$n&&($n=as)}else{const dr=Ot[gi.fontStack],er=dr&&dr[Rn];if(er&&er.rect)Ir=er.rect,xr=er.metrics;else{const as=Lt[gi.fontStack],Qa=as&&as[Rn];if(!Qa)continue;xr=Qa.metrics}Un=(Bn-gi.scale)*Tn}wr?(tt.verticalizable=!0,Qn.push({glyph:Rn,imageName:Pr,x:Zi,y:Qi+Un,vertical:wr,scale:gi.scale,fontStack:gi.fontStack,sectionIndex:or,metrics:xr,rect:Ir}),Zi+=os*gi.scale+Wt):(Qn.push({glyph:Rn,imageName:Pr,x:Zi,y:Qi+Un,vertical:wr,scale:gi.scale,fontStack:gi.fontStack,sectionIndex:or,metrics:xr,rect:Ir}),Zi+=xr.advance*gi.scale+Wt)}Qn.length!==0&&(pn=Math.max(Zi-Wt,pn),K_(Qn,0,Qn.length-1,Dn,$n)),Zi=0;const $i=vt*Bn+$n;Hn.lineOffset=Math.max($n,Nn),Qi+=$i,fr=Math.max($i,fr),++cn}var wn;const Ln=Qi-dc,{horizontalAlign:Fn,verticalAlign:Yn}=Mu(It);(function(un,Bn,Nn,Hn,Qn,$n,$i,kn,gi){const or=(Bn-Nn)*Qn;let Rn=0;Rn=$n!==$i?-kn*Hn-dc:(-Hn*gi+.5)*$i;for(const Un of un)for(const xr of Un.positionedGlyphs)xr.x+=or,xr.y+=Rn})(tt.positionedLines,Dn,Fn,Yn,pn,fr,vt,Ln,St.length),tt.top+=-Yn*Ln,tt.bottom=tt.top+Ln,tt.left+=-Fn*pn,tt.right=tt.left+pn}(it,e,s,h,Pe,S,P,M,G,R,Y,ge),!function(tt){for(const Lt of tt)if(Lt.positionedGlyphs.length!==0)return!1;return!0}(Fe)&&it}const mc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},W_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Nf(i,e,s,h,_,x){if(e.imageName){const S=h[e.imageName];return S?S.displaySize[0]*e.scale*Tn/x+_:0}{const S=s[e.fontStack],P=S&&S[i];return P?P.metrics.advance*e.scale+_:0}}function Uf(i,e,s,h){const _=Math.pow(i-e,2);return h?i<e?_/2:2*_:_+Math.abs(s)*s}function X_(i,e,s){let h=0;return i===10&&(h-=1e4),s&&(h+=150),i!==40&&i!==65288||(h+=50),e!==41&&e!==65289||(h+=50),h}function Vf(i,e,s,h,_,x){let S=null,P=Uf(e,s,_,x);for(const M of h){const R=Uf(e-M.x,s,_,x)+M.badness;R<=P&&(S=M,P=R)}return{index:i,x:e,priorBreak:S,badness:P}}function Gf(i){return i?Gf(i.priorBreak).concat(i.index):[]}function zu(i,e,s,h,_,x,S){if(x!=="point")return[];if(!i)return[];const P=[],M=function(Y,ee,te,ge,pe,Pe){let qe=0;for(let Ce=0;Ce<Y.length();Ce++){const Fe=Y.getSection(Ce);qe+=Nf(Y.getCharCode(Ce),Fe,ge,pe,ee,Pe)}return qe/Math.max(1,Math.ceil(qe/te))}(i,e,s,h,_,S),R=i.text.indexOf("​")>=0;let U=0;for(let Y=0;Y<i.length();Y++){const ee=i.getSection(Y),te=i.getCharCode(Y);if(mc[te]||(U+=Nf(te,ee,h,_,e,S)),Y<i.length()-1){const ge=!((G=te)<11904||!(At["Bopomofo Extended"](G)||At.Bopomofo(G)||At["CJK Compatibility Forms"](G)||At["CJK Compatibility Ideographs"](G)||At["CJK Compatibility"](G)||At["CJK Radicals Supplement"](G)||At["CJK Strokes"](G)||At["CJK Symbols and Punctuation"](G)||At["CJK Unified Ideographs Extension A"](G)||At["CJK Unified Ideographs"](G)||At["Enclosed CJK Letters and Months"](G)||At["Halfwidth and Fullwidth Forms"](G)||At.Hiragana(G)||At["Ideographic Description Characters"](G)||At["Kangxi Radicals"](G)||At["Katakana Phonetic Extensions"](G)||At.Katakana(G)||At["Vertical Forms"](G)||At["Yi Radicals"](G)||At["Yi Syllables"](G)));(W_[te]||ge||ee.imageName)&&P.push(Vf(Y+1,U,M,P,X_(te,i.getCharCode(Y+1),ge&&R),!1))}}var G;return Gf(Vf(i.length(),U,M,P,0,!0))}function Mu(i){let e=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function K_(i,e,s,h,_){if(!h&&!_)return;const x=i[s],S=(i[s].x+x.metrics.advance*x.scale)*h;for(let P=e;P<=s;P++)i[P].x-=S,i[P].y+=_}function J_(i,e,s){const{horizontalAlign:h,verticalAlign:_}=Mu(s),x=e[0]-i.displaySize[0]*h,S=e[1]-i.displaySize[1]*_;return{image:i,top:S,bottom:S+i.displaySize[1],left:x,right:x+i.displaySize[0]}}function jf(i,e,s,h,_,x){const S=i.image;let P;if(S.content){const pe=S.content,Pe=S.pixelRatio||1;P=[pe[0]/Pe,pe[1]/Pe,S.displaySize[0]-pe[2]/Pe,S.displaySize[1]-pe[3]/Pe]}const M=e.left*x,R=e.right*x;let U,G,Y,ee;s==="width"||s==="both"?(ee=_[0]+M-h[3],G=_[0]+R+h[1]):(ee=_[0]+(M+R-S.displaySize[0])/2,G=ee+S.displaySize[0]);const te=e.top*x,ge=e.bottom*x;return s==="height"||s==="both"?(U=_[1]+te-h[0],Y=_[1]+ge+h[2]):(U=_[1]+(te+ge-S.displaySize[1])/2,Y=U+S.displaySize[1]),{image:S,top:U,right:G,bottom:Y,left:ee,collisionPadding:P}}const ss=128;function qf(i,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Ji(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:_}=s;let x=0;for(;x<h.length&&h[x]<=i;)x++;x=Math.max(0,x-1);let S=x;for(;S<h.length&&h[S]<i+1;)S++;S=Math.min(h.length-1,S);const P=h[x],M=h[S];return s.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:M,interpolationType:_}:{kind:"camera",minZoom:P,maxZoom:M,minSize:s.evaluate(new Ji(P)),maxSize:s.evaluate(new Ji(M)),interpolationType:_}}}class Bs extends ht{constructor(e,s,h,_){super(e,s),this.angle=h,_!==void 0&&(this.segment=_)}clone(){return new Bs(this.x,this.y,this.angle,this.segment)}}function Zf(i,e,s,h,_){if(e.segment===void 0)return!0;let x=e,S=e.segment+1,P=0;for(;P>-s/2;){if(S--,S<0)return!1;P-=i[S].dist(x),x=i[S]}P+=i[S].dist(i[S+1]),S++;const M=[];let R=0;for(;P<s/2;){const U=i[S],G=i[S+1];if(!G)return!1;let Y=i[S-1].angleTo(U)-U.angleTo(G);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:P,angleDelta:Y}),R+=Y;P-M[0].distance>h;)R-=M.shift().angleDelta;if(R>_)return!1;S++,P+=U.dist(G)}return!0}function Hf(i){let e=0;for(let s=0;s<i.length-1;s++)e+=i[s].dist(i[s+1]);return e}function Wf(i,e,s){return i?.6*e*s:0}function Xf(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Y_(i,e,s,h,_,x){const S=Wf(s,_,x),P=Xf(s,h)*x;let M=0;const R=Hf(i)/2;for(let U=0;U<i.length-1;U++){const G=i[U],Y=i[U+1],ee=G.dist(Y);if(M+ee>R){const te=(R-M)/ee,ge=Xi(G.x,Y.x,te),pe=Xi(G.y,Y.y,te),Pe=new Bs(ge,pe,Y.angleTo(G),U);return Pe._round(),!S||Zf(i,Pe,P,S,e)?Pe:void 0}M+=ee}}function Q_(i,e,s,h,_,x,S,P,M){const R=Wf(h,x,S),U=Xf(h,_),G=U*S,Y=i[0].x===0||i[0].x===M||i[0].y===0||i[0].y===M;return e-G<e/4&&(e=G+e/4),Kf(i,Y?e/2*P%e:(U/2+2*x)*S*P%e,e,R,s,G,Y,!1,M)}function Kf(i,e,s,h,_,x,S,P,M){const R=x/2,U=Hf(i);let G=0,Y=e-s,ee=[];for(let te=0;te<i.length-1;te++){const ge=i[te],pe=i[te+1],Pe=ge.dist(pe),qe=pe.angleTo(ge);for(;Y+s<G+Pe;){Y+=s;const Ce=(Y-G)/Pe,Fe=Xi(ge.x,pe.x,Ce),it=Xi(ge.y,pe.y,Ce);if(Fe>=0&&Fe<M&&it>=0&&it<M&&Y-R>=0&&Y+R<=U){const tt=new Bs(Fe,it,qe,te);tt._round(),h&&!Zf(i,tt,x,h,_)||ee.push(tt)}}G+=Pe}return P||ee.length||S||(ee=Kf(i,G/2,s,h,_,x,S,!0,M)),ee}function Jf(i,e,s,h,_){const x=[];for(let S=0;S<i.length;S++){const P=i[S];let M;for(let R=0;R<P.length-1;R++){let U=P[R],G=P[R+1];U.x<e&&G.x<e||(U.x<e?U=new ht(e,U.y+(e-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x<e&&(G=new ht(e,U.y+(e-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y<s&&G.y<s||(U.y<s?U=new ht(U.x+(s-U.y)/(G.y-U.y)*(G.x-U.x),s)._round():G.y<s&&(G=new ht(U.x+(s-U.y)/(G.y-U.y)*(G.x-U.x),s)._round()),U.x>=h&&G.x>=h||(U.x>=h?U=new ht(h,U.y+(h-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x>=h&&(G=new ht(h,U.y+(h-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y>=_&&G.y>=_||(U.y>=_?U=new ht(U.x+(_-U.y)/(G.y-U.y)*(G.x-U.x),_)._round():G.y>=_&&(G=new ht(U.x+(_-U.y)/(G.y-U.y)*(G.x-U.x),_)._round()),M&&U.equals(M[M.length-1])||(M=[U],x.push(M)),M.push(G)))))}}return x}function Yf(i,e,s,h){const _=[],x=i.image,S=x.pixelRatio,P=x.paddedRect.w-2,M=x.paddedRect.h-2,R=i.right-i.left,U=i.bottom-i.top,G=x.stretchX||[[0,P]],Y=x.stretchY||[[0,M]],ee=(vt,It)=>vt+It[1]-It[0],te=G.reduce(ee,0),ge=Y.reduce(ee,0),pe=P-te,Pe=M-ge;let qe=0,Ce=te,Fe=0,it=ge,tt=0,Lt=pe,Ot=0,Ct=Pe;if(x.content&&h){const vt=x.content;qe=gc(G,0,vt[0]),Fe=gc(Y,0,vt[1]),Ce=gc(G,vt[0],vt[2]),it=gc(Y,vt[1],vt[3]),tt=vt[0]-qe,Ot=vt[1]-Fe,Lt=vt[2]-vt[0]-Ce,Ct=vt[3]-vt[1]-it}const St=(vt,It,Tt,ut)=>{const Wt=_c(vt.stretch-qe,Ce,R,i.left),Gt=yc(vt.fixed-tt,Lt,vt.stretch,te),fi=_c(It.stretch-Fe,it,U,i.top),Zi=yc(It.fixed-Ot,Ct,It.stretch,ge),Qi=_c(Tt.stretch-qe,Ce,R,i.left),pn=yc(Tt.fixed-tt,Lt,Tt.stretch,te),fr=_c(ut.stretch-Fe,it,U,i.top),Dn=yc(ut.fixed-Ot,Ct,ut.stretch,ge),cn=new ht(Wt,fi),wn=new ht(Qi,fi),Ln=new ht(Qi,fr),Fn=new ht(Wt,fr),Yn=new ht(Gt/S,Zi/S),un=new ht(pn/S,Dn/S),Bn=e*Math.PI/180;if(Bn){const Qn=Math.sin(Bn),$n=Math.cos(Bn),$i=[$n,-Qn,Qn,$n];cn._matMult($i),wn._matMult($i),Fn._matMult($i),Ln._matMult($i)}const Nn=vt.stretch+vt.fixed,Hn=It.stretch+It.fixed;return{tl:cn,tr:wn,bl:Fn,br:Ln,tex:{x:x.paddedRect.x+1+Nn,y:x.paddedRect.y+1+Hn,w:Tt.stretch+Tt.fixed-Nn,h:ut.stretch+ut.fixed-Hn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yn,pixelOffsetBR:un,minFontScaleX:Lt/S/R,minFontScaleY:Ct/S/U,isSDF:s}};if(h&&(x.stretchX||x.stretchY)){const vt=Qf(G,pe,te),It=Qf(Y,Pe,ge);for(let Tt=0;Tt<vt.length-1;Tt++){const ut=vt[Tt],Wt=vt[Tt+1];for(let Gt=0;Gt<It.length-1;Gt++)_.push(St(ut,It[Gt],Wt,It[Gt+1]))}}else _.push(St({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:M+1}));return _}function gc(i,e,s){let h=0;for(const _ of i)h+=Math.max(e,Math.min(s,_[1]))-Math.max(e,Math.min(s,_[0]));return h}function Qf(i,e,s){const h=[{fixed:-1,stretch:0}];for(const[_,x]of i){const S=h[h.length-1];h.push({fixed:_-S.stretch,stretch:S.stretch}),h.push({fixed:_-S.stretch,stretch:S.stretch+(x-_)})}return h.push({fixed:e+1,stretch:s}),h}function _c(i,e,s,h){return i/e*s+h}function yc(i,e,s,h){return i-e*s/h}Bt("Anchor",Bs);class vc{constructor(e,s,h,_,x,S,P,M,R,U){if(this.boxStartIndex=e.length,R){let G=S.top,Y=S.bottom;const ee=S.collisionPadding;ee&&(G-=ee[1],Y+=ee[3]);let te=Y-G;te>0&&(te=Math.max(10,te),this.circleDiameter=te)}else{let G=S.top*P-M[0],Y=S.bottom*P+M[2],ee=S.left*P-M[3],te=S.right*P+M[1];const ge=S.collisionPadding;if(ge&&(ee-=ge[0]*P,G-=ge[1]*P,te+=ge[2]*P,Y+=ge[3]*P),U){const pe=new ht(ee,G),Pe=new ht(te,G),qe=new ht(ee,Y),Ce=new ht(te,Y),Fe=U*Math.PI/180;pe._rotate(Fe),Pe._rotate(Fe),qe._rotate(Fe),Ce._rotate(Fe),ee=Math.min(pe.x,Pe.x,qe.x,Ce.x),te=Math.max(pe.x,Pe.x,qe.x,Ce.x),G=Math.min(pe.y,Pe.y,qe.y,Ce.y),Y=Math.max(pe.y,Pe.y,qe.y,Ce.y)}e.emplaceBack(s.x,s.y,ee,G,te,Y,h,_,x)}this.boxEndIndex=e.length}}class $_{constructor(e=[],s=ey){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:h}=this,_=s[e];for(;e>0;){const x=e-1>>1,S=s[x];if(h(_,S)>=0)break;s[e]=S,e=x}s[e]=_}_down(e){const{data:s,compare:h}=this,_=this.length>>1,x=s[e];for(;e<_;){let S=1+(e<<1),P=s[S];const M=S+1;if(M<this.length&&h(s[M],P)<0&&(S=M,P=s[M]),h(P,x)>=0)break;s[e]=P,e=S}s[e]=x}}function ey(i,e){return i<e?-1:i>e?1:0}function ty(i,e=1,s=!1){let h=1/0,_=1/0,x=-1/0,S=-1/0;const P=i[0];for(let ee=0;ee<P.length;ee++){const te=P[ee];(!ee||te.x<h)&&(h=te.x),(!ee||te.y<_)&&(_=te.y),(!ee||te.x>x)&&(x=te.x),(!ee||te.y>S)&&(S=te.y)}const M=Math.min(x-h,S-_);let R=M/2;const U=new $_([],iy);if(M===0)return new ht(h,_);for(let ee=h;ee<x;ee+=M)for(let te=_;te<S;te+=M)U.push(new Xo(ee+R,te+R,R,i));let G=function(ee){let te=0,ge=0,pe=0;const Pe=ee[0];for(let qe=0,Ce=Pe.length,Fe=Ce-1;qe<Ce;Fe=qe++){const it=Pe[qe],tt=Pe[Fe],Lt=it.x*tt.y-tt.x*it.y;ge+=(it.x+tt.x)*Lt,pe+=(it.y+tt.y)*Lt,te+=3*Lt}return new Xo(ge/te,pe/te,0,ee)}(i),Y=U.length;for(;U.length;){const ee=U.pop();(ee.d>G.d||!G.d)&&(G=ee,s&&console.log("found best %d after %d probes",Math.round(1e4*ee.d)/1e4,Y)),ee.max-G.d<=e||(R=ee.h/2,U.push(new Xo(ee.p.x-R,ee.p.y-R,R,i)),U.push(new Xo(ee.p.x+R,ee.p.y-R,R,i)),U.push(new Xo(ee.p.x-R,ee.p.y+R,R,i)),U.push(new Xo(ee.p.x+R,ee.p.y+R,R,i)),Y+=4)}return s&&(console.log(`num probes: ${Y}`),console.log(`best distance: ${G.d}`)),G.p}function iy(i,e){return e.max-i.max}function Xo(i,e,s,h){this.p=new ht(i,e),this.h=s,this.d=function(_,x){let S=!1,P=1/0;for(let M=0;M<x.length;M++){const R=x[M];for(let U=0,G=R.length,Y=G-1;U<G;Y=U++){const ee=R[U],te=R[Y];ee.y>_.y!=te.y>_.y&&_.x<(te.x-ee.x)*(_.y-ee.y)/(te.y-ee.y)+ee.x&&(S=!S),P=Math.min(P,of(_,ee,te))}}return(S?1:-1)*Math.sqrt(P)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const Du=Number.POSITIVE_INFINITY;function $f(i,e){return e[1]!==Du?function(s,h,_){let x=0,S=0;switch(h=Math.abs(h),_=Math.abs(_),s){case"top-right":case"top-left":case"top":S=_-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-_}switch(s){case"top-right":case"bottom-right":case"right":x=-h;break;case"top-left":case"bottom-left":case"left":x=h}return[x,S]}(i,e[0],e[1]):function(s,h){let _=0,x=0;h<0&&(h=0);const S=h/Math.sqrt(2);switch(s){case"top-right":case"top-left":x=S-7;break;case"bottom-right":case"bottom-left":x=7-S;break;case"bottom":x=7-h;break;case"top":x=h-7}switch(s){case"top-right":case"bottom-right":_=-S;break;case"top-left":case"bottom-left":_=S;break;case"left":_=h;break;case"right":_=-h}return[_,x]}(i,e[0])}function Lu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ny(i,e,s,h,_,x,S,P,M,R,U){let G=x.textMaxSize.evaluate(e,{});G===void 0&&(G=S);const Y=i.layers[0].layout,ee=Y.get("icon-offset").evaluate(e,{},U),te=td(s.horizontal),ge=S/24,pe=i.tilePixelRatio*ge,Pe=i.tilePixelRatio*G/24,qe=i.tilePixelRatio*P,Ce=i.tilePixelRatio*Y.get("symbol-spacing"),Fe=Y.get("text-padding")*i.tilePixelRatio,it=function(ut,Wt,Gt,fi=1){const Zi=ut.get("icon-padding").evaluate(Wt,{},Gt),Qi=Zi&&Zi.values;return[Qi[0]*fi,Qi[1]*fi,Qi[2]*fi,Qi[3]*fi]}(Y,e,U,i.tilePixelRatio),tt=Y.get("text-max-angle")/180*Math.PI,Lt=Y.get("text-rotation-alignment")!=="viewport"&&Y.get("symbol-placement")!=="point",Ot=Y.get("icon-rotation-alignment")==="map"&&Y.get("symbol-placement")!=="point",Ct=Y.get("symbol-placement"),St=Ce/2,vt=Y.get("icon-text-fit");let It;h&&vt!=="none"&&(i.allowVerticalPlacement&&s.vertical&&(It=jf(h,s.vertical,vt,Y.get("icon-text-fit-padding"),ee,ge)),te&&(h=jf(h,te,vt,Y.get("icon-text-fit-padding"),ee,ge)));const Tt=(ut,Wt)=>{Wt.x<0||Wt.x>=dn||Wt.y<0||Wt.y>=dn||function(Gt,fi,Zi,Qi,pn,fr,Dn,cn,wn,Ln,Fn,Yn,un,Bn,Nn,Hn,Qn,$n,$i,kn,gi,or,Rn,Un,xr){const Ir=Gt.addToLineVertexArray(fi,Zi);let Pr,os,wr,dr,er=0,as=0,Qa=0,_d=0,qu=-1,Zu=-1;const ls={};let yd=xn.exports(""),Hu=0,Wu=0;if(cn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Hu,Wu]=cn.layout.get("text-offset").evaluate(gi,{},Un).map(tr=>tr*Tn):(Hu=cn.layout.get("text-radial-offset").evaluate(gi,{},Un)*Tn,Wu=Du),Gt.allowVerticalPlacement&&Qi.vertical){const tr=cn.layout.get("text-rotate").evaluate(gi,{},Un)+90;wr=new vc(wn,fi,Ln,Fn,Yn,Qi.vertical,un,Bn,Nn,tr),Dn&&(dr=new vc(wn,fi,Ln,Fn,Yn,Dn,Qn,$n,Nn,tr))}if(pn){const tr=cn.layout.get("icon-rotate").evaluate(gi,{}),jr=cn.layout.get("icon-text-fit")!=="none",$a=Yf(pn,tr,Rn,jr),el=Dn?Yf(Dn,tr,Rn,jr):void 0;os=new vc(wn,fi,Ln,Fn,Yn,pn,Qn,$n,!1,tr),er=4*$a.length;const xd=Gt.iconSizeData;let po=null;xd.kind==="source"?(po=[ss*cn.layout.get("icon-size").evaluate(gi,{})],po[0]>Rs&&Z(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):xd.kind==="composite"&&(po=[ss*or.compositeIconSizes[0].evaluate(gi,{},Un),ss*or.compositeIconSizes[1].evaluate(gi,{},Un)],(po[0]>Rs||po[1]>Rs)&&Z(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,$a,po,kn,$i,gi,n.WritingMode.none,fi,Ir.lineStartIndex,Ir.lineLength,-1,Un),qu=Gt.icon.placedSymbolArray.length-1,el&&(as=4*el.length,Gt.addSymbols(Gt.icon,el,po,kn,$i,gi,n.WritingMode.vertical,fi,Ir.lineStartIndex,Ir.lineLength,-1,Un),Zu=Gt.icon.placedSymbolArray.length-1)}const vd=Object.keys(Qi.horizontal);for(const tr of vd){const jr=Qi.horizontal[tr];if(!Pr){yd=xn.exports(jr.text);const el=cn.layout.get("text-rotate").evaluate(gi,{},Un);Pr=new vc(wn,fi,Ln,Fn,Yn,jr,un,Bn,Nn,el)}const $a=jr.positionedLines.length===1;if(Qa+=ed(Gt,fi,jr,fr,cn,Nn,gi,Hn,Ir,Qi.vertical?n.WritingMode.horizontal:n.WritingMode.horizontalOnly,$a?vd:[tr],ls,qu,or,Un),$a)break}Qi.vertical&&(_d+=ed(Gt,fi,Qi.vertical,fr,cn,Nn,gi,Hn,Ir,n.WritingMode.vertical,["vertical"],ls,Zu,or,Un));const gy=Pr?Pr.boxStartIndex:Gt.collisionBoxArray.length,_y=Pr?Pr.boxEndIndex:Gt.collisionBoxArray.length,yy=wr?wr.boxStartIndex:Gt.collisionBoxArray.length,vy=wr?wr.boxEndIndex:Gt.collisionBoxArray.length,by=os?os.boxStartIndex:Gt.collisionBoxArray.length,xy=os?os.boxEndIndex:Gt.collisionBoxArray.length,wy=dr?dr.boxStartIndex:Gt.collisionBoxArray.length,ky=dr?dr.boxEndIndex:Gt.collisionBoxArray.length;let zr=-1;const Sc=(tr,jr)=>tr&&tr.circleDiameter?Math.max(tr.circleDiameter,jr):jr;zr=Sc(Pr,zr),zr=Sc(wr,zr),zr=Sc(os,zr),zr=Sc(dr,zr);const bd=zr>-1?1:0;bd&&(zr*=xr/Tn),Gt.glyphOffsetArray.length>=Ko.MAX_GLYPHS&&Z("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gi.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,gi.sortKey),Gt.symbolInstances.emplaceBack(fi.x,fi.y,ls.right>=0?ls.right:-1,ls.center>=0?ls.center:-1,ls.left>=0?ls.left:-1,ls.vertical||-1,qu,Zu,yd,gy,_y,yy,vy,by,xy,wy,ky,Ln,Qa,_d,er,as,bd,0,un,Hu,Wu,zr)}(i,Wt,ut,s,h,_,It,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,pe,[Fe,Fe,Fe,Fe],Lt,M,qe,it,Ot,ee,e,x,R,U,S)};if(Ct==="line")for(const ut of Jf(e.geometry,0,0,dn,dn)){const Wt=Q_(ut,Ce,tt,s.vertical||te,h,24,Pe,i.overscaling,dn);for(const Gt of Wt){const fi=te;fi&&ry(i,fi.text,St,Gt)||Tt(ut,Gt)}}else if(Ct==="line-center"){for(const ut of e.geometry)if(ut.length>1){const Wt=Y_(ut,tt,s.vertical||te,h,24,Pe);Wt&&Tt(ut,Wt)}}else if(e.type==="Polygon")for(const ut of xu(e.geometry,0)){const Wt=ty(ut,16);Tt(ut[0],new Bs(Wt.x,Wt.y,0))}else if(e.type==="LineString")for(const ut of e.geometry)Tt(ut,new Bs(ut[0].x,ut[0].y,0));else if(e.type==="Point")for(const ut of e.geometry)for(const Wt of ut)Tt([Wt],new Bs(Wt.x,Wt.y,0))}const Rs=32640;function ed(i,e,s,h,_,x,S,P,M,R,U,G,Y,ee,te){const ge=function(qe,Ce,Fe,it,tt,Lt,Ot,Ct){const St=it.layout.get("text-rotate").evaluate(Lt,{})*Math.PI/180,vt=[];for(const It of Ce.positionedLines)for(const Tt of It.positionedGlyphs){if(!Tt.rect)continue;const ut=Tt.rect||{};let Wt=4,Gt=!0,fi=1,Zi=0;const Qi=(tt||Ct)&&Tt.vertical,pn=Tt.metrics.advance*Tt.scale/2;if(Ct&&Ce.verticalizable){const $i=(Tt.scale-1)*Tn,kn=(Tn-Tt.metrics.width*Tt.scale)/2;Zi=It.lineOffset/2-(Tt.imageName?-kn:$i)}if(Tt.imageName){const $i=Ot[Tt.imageName];Gt=$i.sdf,fi=$i.pixelRatio,Wt=1/fi}const fr=tt?[Tt.x+pn,Tt.y]:[0,0];let Dn=tt?[0,0]:[Tt.x+pn+Fe[0],Tt.y+Fe[1]-Zi],cn=[0,0];Qi&&(cn=Dn,Dn=[0,0]);const wn=(Tt.metrics.left-Wt)*Tt.scale-pn+Dn[0],Ln=(-Tt.metrics.top-Wt)*Tt.scale+Dn[1],Fn=wn+ut.w*Tt.scale/fi,Yn=Ln+ut.h*Tt.scale/fi,un=new ht(wn,Ln),Bn=new ht(Fn,Ln),Nn=new ht(wn,Yn),Hn=new ht(Fn,Yn);if(Qi){const $i=new ht(-pn,pn-dc),kn=-Math.PI/2,gi=12-pn,or=new ht(22-gi,-(Tt.imageName?gi:0)),Rn=new ht(...cn);un._rotateAround(kn,$i)._add(or)._add(Rn),Bn._rotateAround(kn,$i)._add(or)._add(Rn),Nn._rotateAround(kn,$i)._add(or)._add(Rn),Hn._rotateAround(kn,$i)._add(or)._add(Rn)}if(St){const $i=Math.sin(St),kn=Math.cos(St),gi=[kn,-$i,$i,kn];un._matMult(gi),Bn._matMult(gi),Nn._matMult(gi),Hn._matMult(gi)}const Qn=new ht(0,0),$n=new ht(0,0);vt.push({tl:un,tr:Bn,bl:Nn,br:Hn,tex:ut,writingMode:Ce.writingMode,glyphOffset:fr,sectionIndex:Tt.sectionIndex,isSDF:Gt,pixelOffsetTL:Qn,pixelOffsetBR:$n,minFontScaleX:0,minFontScaleY:0})}return vt}(0,s,P,_,x,S,h,i.allowVerticalPlacement),pe=i.textSizeData;let Pe=null;pe.kind==="source"?(Pe=[ss*_.layout.get("text-size").evaluate(S,{})],Pe[0]>Rs&&Z(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):pe.kind==="composite"&&(Pe=[ss*ee.compositeTextSizes[0].evaluate(S,{},te),ss*ee.compositeTextSizes[1].evaluate(S,{},te)],(Pe[0]>Rs||Pe[1]>Rs)&&Z(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ge,Pe,P,x,S,R,e,M.lineStartIndex,M.lineLength,Y,te);for(const qe of U)G[qe]=i.text.placedSymbolArray.length-1;return 4*ge.length}function td(i){for(const e in i)return i[e];return null}function ry(i,e,s,h){const _=i.compareText;if(e in _){const x=_[e];for(let S=x.length-1;S>=0;S--)if(h.dist(x[S])<s)return!0}else _[e]=[];return _[e].push(h),!1}const sy=Ds.VectorTileFeature.types,oy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bc(i,e,s,h,_,x,S,P,M,R,U,G,Y){const ee=P?Math.min(Rs,Math.round(P[0])):0,te=P?Math.min(Rs,Math.round(P[1])):0;i.emplaceBack(e,s,Math.round(32*h),Math.round(32*_),x,S,(ee<<1)+(M?1:0),te,16*R,16*U,256*G,256*Y)}function Bu(i,e,s){i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s)}function ay(i){for(const e of i.sections)if(Kl(e.text))return!0;return!1}class Ru{constructor(e){this.layoutVertexArray=new vr,this.indexArray=new jn,this.programConfigurations=e,this.segments=new pi,this.dynamicLayoutVertexArray=new cr,this.opacityVertexArray=new br,this.placedSymbolArray=new lt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,h,_){this.isEmpty()||(h&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,P_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,z_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,oy,!0),this.opacityVertexBuffer.itemSize=1),(h||_)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Bt("SymbolBuffers",Ru);class Ou{constructor(e,s,h){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new h,this.segments=new pi,this.collisionVertexArray=new rr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,M_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Bt("CollisionBuffers",Ou);class Ko{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(S=>S.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=mu([]),this.placementViewportMatrix=mu([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qf(this.zoom,s["text-size"]),this.iconSizeData=qf(this.zoom,s["icon-size"]);const h=this.layers[0].layout,_=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.canOverlap=Nu(h,"text-overlap","text-allow-overlap")!=="never"||Nu(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(S=>n.WritingMode[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=e.sourceID}createArrays(){this.text=new Ru(new lo(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ru(new lo(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new kt,this.lineVertexArray=new Dt,this.symbolInstances=new zt}calculateGlyphDependencies(e,s,h,_,x){for(let S=0;S<e.length;S++)if(s[e.charCodeAt(S)]=!0,(h||_)&&x){const P=Xa[e.charAt(S)];P&&(s[P.charCodeAt(0)]=!0)}}populate(e,s,h){const _=this.layers[0],x=_.layout,S=x.get("text-font"),P=x.get("text-field"),M=x.get("icon-image"),R=(P.value.kind!=="constant"||P.value.value instanceof ve&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),U=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,G=x.get("symbol-sort-key");if(this.features=[],!R&&!U)return;const Y=s.iconDependencies,ee=s.glyphDependencies,te=s.availableImages,ge=new Ji(this.zoom);for(const{feature:pe,id:Pe,index:qe,sourceLayerIndex:Ce}of e){const Fe=_._featureFilter.needGeometry,it=uo(pe,Fe);if(!_._featureFilter.filter(ge,it,h))continue;let tt,Lt;if(Fe||(it.geometry=co(pe)),R){const Ct=_.getValueAndResolveTokens("text-field",it,h,te),St=ve.factory(Ct);ay(St)&&(this.hasRTLText=!0),(!this.hasRTLText||so()==="unavailable"||this.hasRTLText&&nr.isParsed())&&(tt=L_(St,_,it))}if(U){const Ct=_.getValueAndResolveTokens("icon-image",it,h,te);Lt=Ct instanceof Te?Ct:Te.fromString(Ct)}if(!tt&&!Lt)continue;const Ot=this.sortFeaturesByKey?G.evaluate(it,{},h):void 0;if(this.features.push({id:Pe,text:tt,icon:Lt,index:qe,sourceLayerIndex:Ce,geometry:it.geometry,properties:pe.properties,type:sy[pe.type],sortKey:Ot}),Lt&&(Y[Lt.name]=!0),tt){const Ct=S.evaluate(it,{},h).join(","),St=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(n.WritingMode.vertical)>=0;for(const vt of tt.sections)if(vt.image)Y[vt.image.name]=!0;else{const It=Oo(tt.toString()),Tt=vt.fontStack||Ct,ut=ee[Tt]=ee[Tt]||{};this.calculateGlyphDependencies(vt.text,ut,St,this.allowVerticalPlacement,It)}}}x.get("symbol-placement")==="line"&&(this.features=function(pe){const Pe={},qe={},Ce=[];let Fe=0;function it(Ct){Ce.push(pe[Ct]),Fe++}function tt(Ct,St,vt){const It=qe[Ct];return delete qe[Ct],qe[St]=It,Ce[It].geometry[0].pop(),Ce[It].geometry[0]=Ce[It].geometry[0].concat(vt[0]),It}function Lt(Ct,St,vt){const It=Pe[St];return delete Pe[St],Pe[Ct]=It,Ce[It].geometry[0].shift(),Ce[It].geometry[0]=vt[0].concat(Ce[It].geometry[0]),It}function Ot(Ct,St,vt){const It=vt?St[0][St[0].length-1]:St[0][0];return`${Ct}:${It.x}:${It.y}`}for(let Ct=0;Ct<pe.length;Ct++){const St=pe[Ct],vt=St.geometry,It=St.text?St.text.toString():null;if(!It){it(Ct);continue}const Tt=Ot(It,vt),ut=Ot(It,vt,!0);if(Tt in qe&&ut in Pe&&qe[Tt]!==Pe[ut]){const Wt=Lt(Tt,ut,vt),Gt=tt(Tt,ut,Ce[Wt].geometry);delete Pe[Tt],delete qe[ut],qe[Ot(It,Ce[Gt].geometry,!0)]=Gt,Ce[Wt].geometry=null}else Tt in qe?tt(Tt,ut,vt):ut in Pe?Lt(Tt,ut,vt):(it(Ct),Pe[Tt]=Fe-1,qe[ut]=Fe-1)}return Ce.filter(Ct=>Ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,Pe)=>pe.sortKey-Pe.sortKey)}update(e,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,h),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const h=this.lineVertexArray.length;if(e.segment!==void 0){let _=e.dist(s[e.segment+1]),x=e.dist(s[e.segment]);const S={};for(let P=e.segment+1;P<s.length;P++)S[P]={x:s[P].x,y:s[P].y,tileUnitDistanceFromAnchor:_},P<s.length-1&&(_+=s[P+1].dist(s[P]));for(let P=e.segment||0;P>=0;P--)S[P]={x:s[P].x,y:s[P].y,tileUnitDistanceFromAnchor:x},P>0&&(x+=s[P-1].dist(s[P]));for(let P=0;P<s.length;P++){const M=S[P];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(e,s,h,_,x,S,P,M,R,U,G,Y){const ee=e.indexArray,te=e.layoutVertexArray,ge=e.segments.prepareSegment(4*s.length,te,ee,this.canOverlap?S.sortKey:void 0),pe=this.glyphOffsetArray.length,Pe=ge.vertexLength,qe=this.allowVerticalPlacement&&P===n.WritingMode.vertical?Math.PI/2:0,Ce=S.text&&S.text.sections;for(let Fe=0;Fe<s.length;Fe++){const{tl:it,tr:tt,bl:Lt,br:Ot,tex:Ct,pixelOffsetTL:St,pixelOffsetBR:vt,minFontScaleX:It,minFontScaleY:Tt,glyphOffset:ut,isSDF:Wt,sectionIndex:Gt}=s[Fe],fi=ge.vertexLength,Zi=ut[1];bc(te,M.x,M.y,it.x,Zi+it.y,Ct.x,Ct.y,h,Wt,St.x,St.y,It,Tt),bc(te,M.x,M.y,tt.x,Zi+tt.y,Ct.x+Ct.w,Ct.y,h,Wt,vt.x,St.y,It,Tt),bc(te,M.x,M.y,Lt.x,Zi+Lt.y,Ct.x,Ct.y+Ct.h,h,Wt,St.x,vt.y,It,Tt),bc(te,M.x,M.y,Ot.x,Zi+Ot.y,Ct.x+Ct.w,Ct.y+Ct.h,h,Wt,vt.x,vt.y,It,Tt),Bu(e.dynamicLayoutVertexArray,M,qe),ee.emplaceBack(fi,fi+1,fi+2),ee.emplaceBack(fi+1,fi+2,fi+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),Fe!==s.length-1&&Gt===s[Fe+1].sectionIndex||e.programConfigurations.populatePaintArrays(te.length,S,S.index,{},Y,Ce&&Ce[Gt])}e.placedSymbolArray.emplaceBack(M.x,M.y,pe,this.glyphOffsetArray.length-pe,Pe,R,U,M.segment,h?h[0]:0,h?h[1]:0,_[0],_[1],P,0,!1,0,G)}_addCollisionDebugVertex(e,s,h,_,x,S){return s.emplaceBack(0,0),e.emplaceBack(h.x,h.y,_,x,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(e,s,h,_,x,S,P){const M=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),R=M.vertexLength,U=x.layoutVertexArray,G=x.collisionVertexArray,Y=P.anchorX,ee=P.anchorY;this._addCollisionDebugVertex(U,G,S,Y,ee,new ht(e,s)),this._addCollisionDebugVertex(U,G,S,Y,ee,new ht(h,s)),this._addCollisionDebugVertex(U,G,S,Y,ee,new ht(h,_)),this._addCollisionDebugVertex(U,G,S,Y,ee,new ht(e,_)),M.vertexLength+=4;const te=x.indexArray;te.emplaceBack(R,R+1),te.emplaceBack(R+1,R+2),te.emplaceBack(R+2,R+3),te.emplaceBack(R+3,R),M.primitiveLength+=4}addDebugCollisionBoxes(e,s,h,_){for(let x=e;x<s;x++){const S=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,_?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ou(Vr,Pf.members,Ar),this.iconCollisionBox=new Ou(Vr,Pf.members,Ar);for(let e=0;e<this.symbolInstances.length;e++){const s=this.symbolInstances.get(e);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(e,s,h,_,x,S,P,M,R){const U={};for(let G=s;G<h;G++){const Y=e.get(G);U.textBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},U.textFeatureIndex=Y.featureIndex;break}for(let G=_;G<x;G++){const Y=e.get(G);U.verticalTextBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},U.verticalTextFeatureIndex=Y.featureIndex;break}for(let G=S;G<P;G++){const Y=e.get(G);U.iconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},U.iconFeatureIndex=Y.featureIndex;break}for(let G=M;G<R;G++){const Y=e.get(G);U.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},U.verticalIconFeatureIndex=Y.featureIndex;break}return U}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const h=e.placedSymbolArray.get(s),_=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<_;x+=4)e.indexArray.emplaceBack(x,x+1,x+2),e.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),h=Math.cos(e),_=[],x=[],S=[];for(let P=0;P<this.symbolInstances.length;++P){S.push(P);const M=this.symbolInstances.get(P);_.push(0|Math.round(s*M.anchorX+h*M.anchorY)),x.push(M.featureIndex)}return S.sort((P,M)=>_[P]-_[M]||x[M]-x[P]),S}addToSortKeyRanges(e,s){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===s?h.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const h=this.symbolInstances.get(s);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((_,x,S)=>{_>=0&&S.indexOf(_)===x&&this.addIndicesForPlacedSymbol(this.text,_)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt("SymbolBucket",Ko,{omit:["layers","collisionBoxArray","features","compareText"]}),Ko.MAX_GLYPHS=65535,Ko.addDynamicAttributes=Bu;const ly=new En({"symbol-placement":new Nt(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Nt(Me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Nt(Me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Nt(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(Me.layout_symbol["icon-size"]),"icon-text-fit":new Nt(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(Me.layout_symbol["icon-image"]),"icon-rotate":new $t(Me.layout_symbol["icon-rotate"]),"icon-padding":new $t(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(Me.layout_symbol["icon-offset"]),"icon-anchor":new $t(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(Me.layout_symbol["text-rotation-alignment"]),"text-field":new $t(Me.layout_symbol["text-field"]),"text-font":new $t(Me.layout_symbol["text-font"]),"text-size":new $t(Me.layout_symbol["text-size"]),"text-max-width":new $t(Me.layout_symbol["text-max-width"]),"text-line-height":new Nt(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(Me.layout_symbol["text-letter-spacing"]),"text-justify":new $t(Me.layout_symbol["text-justify"]),"text-radial-offset":new $t(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new $t(Me.layout_symbol["text-anchor"]),"text-max-angle":new Nt(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(Me.layout_symbol["text-writing-mode"]),"text-rotate":new $t(Me.layout_symbol["text-rotate"]),"text-padding":new Nt(Me.layout_symbol["text-padding"]),"text-keep-upright":new Nt(Me.layout_symbol["text-keep-upright"]),"text-transform":new $t(Me.layout_symbol["text-transform"]),"text-offset":new $t(Me.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(Me.layout_symbol["text-allow-overlap"]),"text-overlap":new Nt(Me.layout_symbol["text-overlap"]),"text-ignore-placement":new Nt(Me.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(Me.layout_symbol["text-optional"])});var Fu={paint:new En({"icon-opacity":new $t(Me.paint_symbol["icon-opacity"]),"icon-color":new $t(Me.paint_symbol["icon-color"]),"icon-halo-color":new $t(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new $t(Me.paint_symbol["text-opacity"]),"text-color":new $t(Me.paint_symbol["text-color"],{runtimeType:hn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new $t(Me.paint_symbol["text-halo-color"]),"text-halo-width":new $t(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(Me.paint_symbol["text-halo-blur"]),"text-translate":new Nt(Me.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(Me.paint_symbol["text-translate-anchor"])}),layout:ly};class id{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:gn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt("FormatSectionOverride",id,{omit:["defaultValue"]});class xc extends yr{constructor(e){super(e,Fu)}recalculate(e,s){if(super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const _=[];for(const x of h)_.indexOf(x)<0&&_.push(x);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,s,h,_){const x=this.layout.get(e).evaluate(s,{},h,_),S=this._unevaluatedLayout._values[e];return S.isDataDriven()||Hs(S.value)||!x?x:function(P,M){return M.replace(/{([^{}]+)}/g,(R,U)=>U in P?String(P[U]):"")}(s.properties,x)}createBucket(e){return new Ko(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Fu.paint.overridableProperties){if(!xc.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),h=new id(s),_=new zo(h,s.property.specification);let x=null;x=s.value.kind==="constant"||s.value.kind==="source"?new Xs("source",_):new wa("composite",_,s.value.zoomStops),this.paint._values[e]=new _r(s.property,x,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,h){return!(!this.layout||s.isDataDriven()||h.isDataDriven())&&xc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const h=e.get("text-field"),_=Fu.paint.properties[s];let x=!1;const S=P=>{for(const M of P)if(_.overrides&&_.overrides.hasOverride(M))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof ve)S(h.value.value.sections);else if(h.value.kind==="source"){const P=R=>{x||(R instanceof Ft&&Ze(R.value)===_n?S(R.value.sections):R instanceof Io?S(R.sections):R.eachChild(P))},M=h.value;M._styleExpression&&P(M._styleExpression.expression)}return x}}function Nu(i,e,s){let h="never";const _=i.get(e);return _?h=_:i.get(s)&&(h="always"),h}var cy={paint:new En({"background-color":new Nt(Me.paint_background["background-color"]),"background-pattern":new La(Me.paint_background["background-pattern"]),"background-opacity":new Nt(Me.paint_background["background-opacity"])})},uy={paint:new En({"raster-opacity":new Nt(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new Nt(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(Me.paint_raster["raster-saturation"]),"raster-contrast":new Nt(Me.paint_raster["raster-contrast"]),"raster-resampling":new Nt(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(Me.paint_raster["raster-fade-duration"])})};class hy extends yr{constructor(e){super(e,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const fy={circle:class extends yr{constructor(i){super(i,jg)}createBucket(i){return new fu(i)}queryRadius(i){const e=i;return Na("circle-radius",this,e)+Na("circle-stroke-width",this,e)+rc(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,s,h,_,x,S,P){const M=sc(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,S),R=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s),U=this.paint.get("circle-pitch-alignment")==="map",G=U?M:function(ee,te){return ee.map(ge=>df(ge,te))}(M,P),Y=U?R*S:R;for(const ee of h)for(const te of ee){const ge=U?te:df(te,P);let pe=Y;const Pe=oc([],[te.x,te.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?pe*=Pe[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(pe*=x.cameraToCenterDistance/Pe[3]),Fg(G,ge,pe))return!0}return!1}},heatmap:class extends yr{constructor(i){super(i,Zg),this._updateColorRamp()}createBucket(i){return new pf(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends yr{constructor(i){super(i,Hg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends yr{constructor(i){super(i,l_)}recalculate(i,e){super.recalculate(i,e);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Su(i)}queryRadius(){return rc(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,s,h,_,x,S){return sf(sc(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,S),h)}isTileClipped(){return!0}},"fill-extrusion":class extends yr{constructor(i){super(i,w_)}createBucket(i){return new Tu(i)}queryRadius(){return rc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,s,h,_,x,S,P){const M=sc(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,S),R=this.paint.get("fill-extrusion-height").evaluate(e,s),U=this.paint.get("fill-extrusion-base").evaluate(e,s),G=function(ee,te,ge,pe){const Pe=[];for(const qe of ee){const Ce=[qe.x,qe.y,0,1];oc(Ce,Ce,te),Pe.push(new ht(Ce[0]/Ce[3],Ce[1]/Ce[3]))}return Pe}(M,P),Y=function(ee,te,ge,pe){const Pe=[],qe=[],Ce=pe[8]*te,Fe=pe[9]*te,it=pe[10]*te,tt=pe[11]*te,Lt=pe[8]*ge,Ot=pe[9]*ge,Ct=pe[10]*ge,St=pe[11]*ge;for(const vt of ee){const It=[],Tt=[];for(const ut of vt){const Wt=ut.x,Gt=ut.y,fi=pe[0]*Wt+pe[4]*Gt+pe[12],Zi=pe[1]*Wt+pe[5]*Gt+pe[13],Qi=pe[2]*Wt+pe[6]*Gt+pe[14],pn=pe[3]*Wt+pe[7]*Gt+pe[15],fr=Qi+it,Dn=pn+tt,cn=fi+Lt,wn=Zi+Ot,Ln=Qi+Ct,Fn=pn+St,Yn=new ht((fi+Ce)/Dn,(Zi+Fe)/Dn);Yn.z=fr/Dn,It.push(Yn);const un=new ht(cn/Fn,wn/Fn);un.z=Ln/Fn,Tt.push(un)}Pe.push(It),qe.push(Tt)}return[Pe,qe]}(h,U,R,P);return function(ee,te,ge){let pe=1/0;sf(ge,te)&&(pe=Ef(ge,te[0]));for(let Pe=0;Pe<te.length;Pe++){const qe=te[Pe],Ce=ee[Pe];for(let Fe=0;Fe<qe.length-1;Fe++){const it=qe[Fe],tt=[it,qe[Fe+1],Ce[Fe+1],Ce[Fe],it];rf(ge,tt)&&(pe=Math.min(pe,Ef(ge,tt)))}}return pe!==1/0&&pe}(Y[0],Y[1],G)}},line:class extends yr{constructor(i){super(i,Af),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Vs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Cf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Au(i)}queryRadius(i){const e=i,s=If(Na("line-width",this,e),Na("line-gap-width",this,e)),h=Na("line-offset",this,e);return s/2+Math.abs(h)+rc(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,s,h,_,x,S){const P=sc(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,S),M=S/2*If(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),R=this.paint.get("line-offset").evaluate(e,s);return R&&(h=function(U,G){const Y=[];for(let ee=0;ee<U.length;ee++){const te=U[ee],ge=[];for(let pe=0;pe<te.length;pe++){const Pe=te[pe-1],qe=te[pe],Ce=te[pe+1],Fe=pe===0?new ht(0,0):qe.sub(Pe)._unit()._perp(),it=pe===te.length-1?new ht(0,0):Ce.sub(qe)._unit()._perp(),tt=Fe._add(it)._unit(),Lt=tt.x*it.x+tt.y*it.y;Lt!==0&&tt._mult(1/Lt),ge.push(tt._mult(G)._add(qe))}Y.push(ge)}return Y}(h,R*S)),function(U,G,Y){for(let ee=0;ee<G.length;ee++){const te=G[ee];if(U.length>=3){for(let ge=0;ge<te.length;ge++)if(Go(U,te[ge]))return!0}if(Ng(U,te,Y))return!0}return!1}(P,h,M)}isTileClipped(){return!0}},symbol:xc,background:class extends yr{constructor(i){super(i,cy)}},raster:class extends yr{constructor(i){super(i,uy)}}};class dy{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const nd=63710088e-1;class sn{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new sn(E(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,h=this.lat*s,_=e.lat*s,x=Math.sin(h)*Math.sin(_)+Math.cos(h)*Math.cos(_)*Math.cos((e.lng-this.lng)*s);return nd*Math.acos(Math.min(x,1))}toBounds(e=0){const s=360*e/40075017,h=s/Math.cos(Math.PI/180*this.lat);return new fo(new sn(this.lng-h,this.lat-s),new sn(this.lng+h,this.lat+s))}static convert(e){if(e instanceof sn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new sn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new sn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class fo{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof sn?new sn(e.lng,e.lat):sn.convert(e),this}setSouthWest(e){return this._sw=e instanceof sn?new sn(e.lng,e.lat):sn.convert(e),this}extend(e){const s=this._sw,h=this._ne;let _,x;if(e instanceof sn)_=e,x=e;else{if(!(e instanceof fo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(fo.convert(e)):this.extend(sn.convert(e)):this;if(_=e._sw,x=e._ne,!_||!x)return this}return s||h?(s.lng=Math.min(_.lng,s.lng),s.lat=Math.min(_.lat,s.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new sn(_.lng,_.lat),this._ne=new sn(x.lng,x.lat)),this}getCenter(){return new sn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new sn(this.getWest(),this.getNorth())}getSouthEast(){return new sn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:h}=sn.convert(e);let _=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&_}static convert(e){return e instanceof fo?e:e&&new fo(e)}}const rd=2*Math.PI*nd;function sd(i){return rd*Math.cos(i*Math.PI/180)}function od(i){return(180+i)/360}function ad(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ld(i,e){return i/sd(e)}function Uu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class wc{constructor(e,s,h=0){this.x=+e,this.y=+s,this.z=+h}static fromLngLat(e,s=0){const h=sn.convert(e);return new wc(od(h.lng),ad(h.lat),ld(s,h.lat))}toLngLat(){return new sn(360*this.x-180,Uu(this.y))}toAltitude(){return this.z*sd(Uu(this.y))}meterInMercatorCoordinateUnits(){return 1/rd*(e=Uu(this.y),1/Math.cos(e*Math.PI/180));var e}}function cd(i,e,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[i*h-2*Math.PI*6378137/2,e*h-2*Math.PI*6378137/2]}class Vu{constructor(e,s,h){if(e<0||e>25||h<0||h>=Math.pow(2,e)||s<0||s>=Math.pow(2,e))throw new Error(`x=${s}, y=${h}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=s,this.y=h,this.key=Ja(0,e,e,s,h)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s,h){const _=(S=this.y,P=this.z,M=cd(256*(x=this.x),256*(S=Math.pow(2,P)-S-1),P),R=cd(256*(x+1),256*(S+1),P),M[0]+","+M[1]+","+R[0]+","+R[1]);var x,S,P,M,R;const U=function(G,Y,ee){let te,ge="";for(let pe=G;pe>0;pe--)te=1<<pe-1,ge+=(Y&te?1:0)+(ee&te?2:0);return ge}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,U).replace(/{bbox-epsg-3857}/g,_)}isChildOf(e){const s=this.z-e.z;return s>0&&e.x===this.x>>s&&e.y===this.y>>s}getTilePoint(e){const s=Math.pow(2,this.z);return new ht((e.x*s-this.x)*dn,(e.y*s-this.y)*dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ud{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Ja(e,s.z,s.z,s.x,s.y)}}class hr{constructor(e,s,h,_,x){if(e<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${h}`);this.overscaledZ=e,this.wrap=s,this.canonical=new Vu(h,+_,+x),this.key=Ja(s,e,h,_,x)}clone(){return new hr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?new hr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hr(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-e;return e>this.canonical.z?Ja(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y):Ja(this.wrap*+s,e,e,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,h=2*this.canonical.x,_=2*this.canonical.y;return[new hr(s,this.wrap,s,h,_),new hr(s,this.wrap,s,h+1,_),new hr(s,this.wrap,s,h,_+1),new hr(s,this.wrap,s,h+1,_+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ud(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new wc(e.x-this.wrap,e.y))}}function Ja(i,e,s,h,_){(i*=2)<0&&(i=-1*i-1);const x=1<<s;return(x*x*i+x*_+h).toString(36)+s.toString(36)+e.toString(36)}Bt("CanonicalTileID",Vu),Bt("OverscaledTileID",hr,{omit:["posMatrix"]});class hd{constructor(e,s,h){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void Z(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=h||"mapbox";for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let x=0;x<_;x++)for(let S=0;S<_;S++){const P=this.get(x,S);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(e,s){const h=new Uint8Array(this.data.buffer),_=4*this._idx(e,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(h[_],h[_+1],h[_+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}_unpackMapbox(e,s,h){return(256*e*256+256*s+h)/10-1e4}_unpackTerrarium(e,s,h){return 256*e+s+h/256-32768}getPixels(){return new ur({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,h){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let _=s*this.dim,x=s*this.dim+this.dim,S=h*this.dim,P=h*this.dim+this.dim;switch(s){case-1:_=x-1;break;case 1:x=_+1}switch(h){case-1:S=P-1;break;case 1:P=S+1}const M=-s*this.dim,R=-h*this.dim;for(let U=S;U<P;U++)for(let G=_;G<x;G++)this.data[this._idx(G,U)]=e.data[this._idx(G+M,U+R)]}}Bt("DEMData",hd);class fd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const h=e[s];this._stringToNumber[h]=s,this._numberToString[s]=h}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class dd{constructor(e,s,h,_,x){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=h,e._y=_,this.properties=e.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(e[s]=this[s]);return e}}class pd{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ro(dn,16,0),this.grid3D=new ro(dn,16,0),this.featureIndexArray=new hi,this.promoteId=s}insert(e,s,h,_,x,S){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,_,x);const M=S?this.grid3D:this.grid;for(let R=0;R<s.length;R++){const U=s[R],G=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<U.length;Y++){const ee=U[Y];G[0]=Math.min(G[0],ee.x),G[1]=Math.min(G[1],ee.y),G[2]=Math.max(G[2],ee.x),G[3]=Math.max(G[3],ee.y)}G[0]<dn&&G[1]<dn&&G[2]>=0&&G[3]>=0&&M.insert(P,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ds.VectorTile(new Cu(this.rawTileData)).layers,this.sourceLayerCoder=new fd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,s,h,_){this.loadVTLayers();const x=e.params||{},S=dn/e.tileSize/e.scale,P=Lo(x.filter),M=e.queryGeometry,R=e.queryPadding*S,U=gd(M),G=this.grid.query(U.minX-R,U.minY-R,U.maxX+R,U.maxY+R),Y=gd(e.cameraQueryGeometry),ee=this.grid3D.query(Y.minX-R,Y.minY-R,Y.maxX+R,Y.maxY+R,(pe,Pe,qe,Ce)=>function(Fe,it,tt,Lt,Ot){for(const St of Fe)if(it<=St.x&&tt<=St.y&&Lt>=St.x&&Ot>=St.y)return!0;const Ct=[new ht(it,tt),new ht(it,Ot),new ht(Lt,Ot),new ht(Lt,tt)];if(Fe.length>2){for(const St of Ct)if(Go(Fe,St))return!0}for(let St=0;St<Fe.length-1;St++)if(Vg(Fe[St],Fe[St+1],Ct))return!0;return!1}(e.cameraQueryGeometry,pe-R,Pe-R,qe+R,Ce+R));for(const pe of ee)G.push(pe);G.sort(py);const te={};let ge;for(let pe=0;pe<G.length;pe++){const Pe=G[pe];if(Pe===ge)continue;ge=Pe;const qe=this.featureIndexArray.get(Pe);let Ce=null;this.loadMatchingFeature(te,qe.bucketIndex,qe.sourceLayerIndex,qe.featureIndex,P,x.layers,x.availableImages,s,h,_,(Fe,it,tt)=>(Ce||(Ce=co(Fe)),it.queryIntersectsFeature(M,Fe,tt,Ce,this.z,e.transform,S,e.pixelPosMatrix)))}return te}loadMatchingFeature(e,s,h,_,x,S,P,M,R,U,G){const Y=this.bucketLayerIDs[s];if(S&&!function(pe,Pe){for(let qe=0;qe<pe.length;qe++)if(Pe.indexOf(pe[qe])>=0)return!0;return!1}(S,Y))return;const ee=this.sourceLayerCoder.decode(h),te=this.vtLayers[ee].feature(_);if(x.needGeometry){const pe=uo(te,!0);if(!x.filter(new Ji(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!x.filter(new Ji(this.tileID.overscaledZ),te))return;const ge=this.getId(te,ee);for(let pe=0;pe<Y.length;pe++){const Pe=Y[pe];if(S&&S.indexOf(Pe)<0)continue;const qe=M[Pe];if(!qe)continue;let Ce={};ge&&U&&(Ce=U.getState(qe.sourceLayer||"_geojsonTileLayer",ge));const Fe=T({},R[Pe]);Fe.paint=md(Fe.paint,qe.paint,te,Ce,P),Fe.layout=md(Fe.layout,qe.layout,te,Ce,P);const it=!G||G(te,qe,Ce);if(!it)continue;const tt=new dd(te,this.z,this.x,this.y,ge);tt.layer=Fe;let Lt=e[Pe];Lt===void 0&&(Lt=e[Pe]=[]),Lt.push({featureIndex:_,feature:tt,intersectionZ:it})}}lookupSymbolFeatures(e,s,h,_,x,S,P,M){const R={};this.loadVTLayers();const U=Lo(x);for(const G of e)this.loadMatchingFeature(R,h,_,G,U,S,P,M,s);return R}hasLayer(e){for(const s of this.bucketLayerIDs)for(const h of s)if(e===h)return!0;return!1}getId(e,s){let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof h=="boolean"&&(h=Number(h))),h}}function md(i,e,s,h,_){return B(i,(x,S)=>{const P=e instanceof ao?e.get(S):null;return P&&P.evaluate?P.evaluate(s,h,_):P})}function gd(i){let e=1/0,s=1/0,h=-1/0,_=-1/0;for(const x of i)e=Math.min(e,x.x),s=Math.min(s,x.y),h=Math.max(h,x.x),_=Math.max(_,x.y);return{minX:e,minY:s,maxX:h,maxY:_}}function py(i,e){return e-i}var Gu;Bt("FeatureIndex",pd,{omit:["rawTileData","sourceLayerCoder"]}),n.PerformanceMarkers=void 0,(Gu=n.PerformanceMarkers||(n.PerformanceMarkers={})).create="create",Gu.load="load",Gu.fullLoad="fullLoad";let kc=null,Ya=[];const ju=1e3/30,my={mark(i){performance.mark(i)},frame(i){const e=i;kc!=null&&Ya.push(e-kc),kc=e},clearMetrics(){kc=null,Ya=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in n.PerformanceMarkers)performance.clearMarks(n.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",n.PerformanceMarkers.create,n.PerformanceMarkers.load),performance.measure("fullLoadTime",n.PerformanceMarkers.create,n.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,s=Ya.length,h=1/(Ya.reduce((x,S)=>x+S,0)/s/1e3),_=Ya.filter(x=>x>ju).reduce((x,S)=>x+(S-ju)/ju,0);return{loadTime:i,fullLoadTime:e,fps:h,percentDroppedFrames:_/(s+_)*100}}};n.AJAXError=Hi,n.ARRAY_TYPE=Zn,n.Actor=class{constructor(i,e,s){this.target=i,this.parent=e,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},z(["receive","process"],this),this.invoker=new dy(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=he()?i:window}send(i,e,s,h,_=!1){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[x]=s);const S=Ve(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:i,hasCallback:!!s,targetMapId:h,mustQueue:_,sourceMapId:this.mapId,data:Qr(e,S)},S),{cancel:()=>{s&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(i){const e=i.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[s];const h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h()}else he()||e.mustQueue?(this.tasks[s]=e,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const s=this.callbacks[i];delete this.callbacks[i],s&&(e.error?s(Rr(e.error)):s(null,Rr(e.data)))}else{let s=!1;const h=Ve(this.globalScope)?void 0:[],_=e.hasCallback?(P,M)=>{s=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:P?Qr(P):null,data:Qr(M,h)},h)}:P=>{s=!0};let x=null;const S=Rr(e.data);if(this.parent[e.type])x=this.parent[e.type](e.sourceMapId,S,_);else if(this.parent.getWorkerSource){const P=e.type.split(".");x=this.parent.getWorkerSource(e.sourceMapId,P[0],S.source)[P[1]](S,_)}else _(new Error(`Could not find function ${e.type}`));!s&&x&&x.cancel&&(this.cancelCallbacks[i]=x.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.AlphaImage=Va,n.CanonicalTileID=Vu,n.CollisionBoxArray=Ye,n.CollisionCircleLayoutArray=class extends V{},n.Color=ne,n.DEMData=hd,n.DataConstantProperty=Nt,n.DictionaryCoder=fd,n.EXTENT=dn,n.ErrorEvent=Xt,n.EvaluationParameters=Ji,n.Event=gt,n.Evented=xi,n.FeatureIndex=pd,n.FillBucket=Su,n.FillExtrusionBucket=Tu,n.GeoJSONFeature=dd,n.ImageAtlas=Ff,n.ImagePosition=Pu,n.LineBucket=Au,n.LineStripIndexArray=class extends de{},n.LngLat=sn,n.LngLatBounds=fo,n.MercatorCoordinate=wc,n.ONE_EM=Tn,n.OverscaledTileID=hr,n.PerformanceUtils=my,n.PosArray=Ht,n.Properties=En,n.QuadTriangleArray=class extends ${},n.RGBAImage=ur,n.RasterBoundsArray=class extends g{},n.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},n.ResourceType=tn,n.SegmentVector=pi,n.SymbolBucket=Ko,n.Transitionable=Ql,n.TriangleIndexArray=jn,n.Uniform1f=is,n.Uniform1i=class extends ts{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},n.Uniform2f=class extends ts{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},n.Uniform3f=class extends ts{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},n.Uniform4f=Uo,n.UniformColor=$h,n.UniformMatrix4f=class extends ts{constructor(i,e){super(i,e),this.current=Rg}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},n.UnwrappedTileID=ud,n.ValidationError=pt,n.ZoomHistory=Ta,n.add=function(i,e,s){return i[0]=e[0]+s[0],i[1]=e[1]+s[1],i[2]=e[2]+s[2],i},n.addDynamicAttributes=Bu,n.asyncAll=function(i,e,s){if(!i.length)return s(null,[]);let h=i.length;const _=new Array(i.length);let x=null;i.forEach((S,P)=>{e(S,(M,R)=>{M&&(x=M),_[P]=R,--h==0&&s(x,_)})})},n.bezier=w,n.bindAll=z,n.cacheEntryPossiblyAdded=function(i){mt++,mt>Vt&&(i.getActor().send("enforceCacheSizeLimit",Oe),mt=0)},n.clamp=b,n.clearTileCache=function(i){const e=caches.delete(Qe);i&&e.catch(i).then(()=>i())},n.clipLine=Jf,n.clone=function(i){var e=new Zn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},n.clone$1=W,n.clone$2=function(i){var e=new Zn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},n.collisionCircleLayout=D_,n.config=Zt,n.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},n.create=function(){var i=new Zn(16);return Zn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},n.create$1=lf,n.createExpression=Ws,n.createFilter=Lo,n.createLayout=ln,n.createStyleLayer=function(i){return i.type==="custom"?new hy(i):new fy[i.type](i)},n.cross=function(i,e,s){var h=e[0],_=e[1],x=e[2],S=s[0],P=s[1],M=s[2];return i[0]=_*M-x*P,i[1]=x*S-h*M,i[2]=h*P-_*S,i},n.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},n.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},n.ease=A,n.emitValidationErrors=Ro,n.enforceCacheSizeLimit=function(i){Et(),Ut&&Ut.then(e=>{e.keys().then(s=>{for(let h=0;h<s.length-i;h++)e.delete(s[h])})})},n.equals=function(i,e){var s=i[0],h=i[1],_=i[2],x=i[3],S=i[4],P=i[5],M=i[6],R=i[7],U=i[8],G=i[9],Y=i[10],ee=i[11],te=i[12],ge=i[13],pe=i[14],Pe=i[15],qe=e[0],Ce=e[1],Fe=e[2],it=e[3],tt=e[4],Lt=e[5],Ot=e[6],Ct=e[7],St=e[8],vt=e[9],It=e[10],Tt=e[11],ut=e[12],Wt=e[13],Gt=e[14],fi=e[15];return Math.abs(s-qe)<=qn*Math.max(1,Math.abs(s),Math.abs(qe))&&Math.abs(h-Ce)<=qn*Math.max(1,Math.abs(h),Math.abs(Ce))&&Math.abs(_-Fe)<=qn*Math.max(1,Math.abs(_),Math.abs(Fe))&&Math.abs(x-it)<=qn*Math.max(1,Math.abs(x),Math.abs(it))&&Math.abs(S-tt)<=qn*Math.max(1,Math.abs(S),Math.abs(tt))&&Math.abs(P-Lt)<=qn*Math.max(1,Math.abs(P),Math.abs(Lt))&&Math.abs(M-Ot)<=qn*Math.max(1,Math.abs(M),Math.abs(Ot))&&Math.abs(R-Ct)<=qn*Math.max(1,Math.abs(R),Math.abs(Ct))&&Math.abs(U-St)<=qn*Math.max(1,Math.abs(U),Math.abs(St))&&Math.abs(G-vt)<=qn*Math.max(1,Math.abs(G),Math.abs(vt))&&Math.abs(Y-It)<=qn*Math.max(1,Math.abs(Y),Math.abs(It))&&Math.abs(ee-Tt)<=qn*Math.max(1,Math.abs(ee),Math.abs(Tt))&&Math.abs(te-ut)<=qn*Math.max(1,Math.abs(te),Math.abs(ut))&&Math.abs(ge-Wt)<=qn*Math.max(1,Math.abs(ge),Math.abs(Wt))&&Math.abs(pe-Gt)<=qn*Math.max(1,Math.abs(pe),Math.abs(Gt))&&Math.abs(Pe-fi)<=qn*Math.max(1,Math.abs(Pe),Math.abs(fi))},n.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:s},{lowerSize:h,upperSize:_}){return i.kind==="source"?h/ss:i.kind==="composite"?Xi(h/ss,_/ss,s):e},n.evaluateSizeForZoom=function(i,e){let s=0,h=0;if(i.kind==="constant")h=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:_,minZoom:x,maxZoom:S}=i,P=_?b(Xn.interpolationFactor(_,e,x,S),0,1):0;i.kind==="camera"?h=Xi(i.minSize,i.maxSize,P):s=P}return{uSizeT:s,uSize:h}},n.evaluateVariableOffset=$f,n.evented=Da,n.exported=Ke,n.exported$1=bi,n.extend=T,n.filterObject=O,n.fromRotation=function(i,e){var s=Math.sin(e),h=Math.cos(e);return i[0]=h,i[1]=s,i[2]=0,i[3]=-s,i[4]=h,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},n.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},n.getAnchorAlignment=Mu,n.getAnchorJustification=Lu,n.getArrayBuffer=me,n.getImage=Ue,n.getJSON=function(i,e){return Je(T(i,{type:"json"}),e)},n.getOverlapMode=Nu,n.getRTLTextPluginStatus=so,n.getReferrer=j,n.getVideo=function(i,e){const s=window.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let h=0;h<i.length;h++){const _=window.document.createElement("source");ce(i[h])||(s.crossOrigin="Anonymous"),_.src=i[h],s.appendChild(_)}return{cancel:()=>{}}},n.identity=mu,n.invert=function(i,e){var s=e[0],h=e[1],_=e[2],x=e[3],S=e[4],P=e[5],M=e[6],R=e[7],U=e[8],G=e[9],Y=e[10],ee=e[11],te=e[12],ge=e[13],pe=e[14],Pe=e[15],qe=s*P-h*S,Ce=s*M-_*S,Fe=s*R-x*S,it=h*M-_*P,tt=h*R-x*P,Lt=_*R-x*M,Ot=U*ge-G*te,Ct=U*pe-Y*te,St=U*Pe-ee*te,vt=G*pe-Y*ge,It=G*Pe-ee*ge,Tt=Y*Pe-ee*pe,ut=qe*Tt-Ce*It+Fe*vt+it*St-tt*Ct+Lt*Ot;return ut?(i[0]=(P*Tt-M*It+R*vt)*(ut=1/ut),i[1]=(_*It-h*Tt-x*vt)*ut,i[2]=(ge*Lt-pe*tt+Pe*it)*ut,i[3]=(Y*tt-G*Lt-ee*it)*ut,i[4]=(M*St-S*Tt-R*Ct)*ut,i[5]=(s*Tt-_*St+x*Ct)*ut,i[6]=(pe*Fe-te*Lt-Pe*Ce)*ut,i[7]=(U*Lt-Y*Fe+ee*Ce)*ut,i[8]=(S*It-P*St+R*Ot)*ut,i[9]=(h*St-s*It-x*Ot)*ut,i[10]=(te*tt-ge*Fe+Pe*qe)*ut,i[11]=(G*Fe-U*tt-ee*qe)*ut,i[12]=(P*Ct-S*vt-M*Ot)*ut,i[13]=(s*vt-h*Ct+_*Ot)*ut,i[14]=(ge*Ce-te*it-pe*qe)*ut,i[15]=(U*it-G*Ce+Y*qe)*ut,i):null},n.isImageBitmap=K,n.isSafari=Ve,n.isWorker=he,n.keysDifference=function(i,e){const s=[];for(const h in i)h in e||s.push(h);return s},n.lazyLoadRTLTextPlugin=function(){nr.isLoading()||nr.isLoaded()||so()!=="deferred"||Yl()},n.makeRequest=Je,n.mapObject=B,n.mercatorXfromLng=od,n.mercatorYfromLat=ad,n.mercatorZfromAltitude=ld,n.mul=qg,n.mul$1=function(i,e,s){return i[0]=e[0]*s[0],i[1]=e[1]*s[1],i[2]=e[2]*s[2],i[3]=e[3]*s[3],i},n.multiply=cf,n.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},n.normalize=function(i,e){var s=e[0],h=e[1],_=e[2],x=s*s+h*h+_*_;return x>0&&(x=1/Math.sqrt(x)),i[0]=e[0]*x,i[1]=e[1]*x,i[2]=e[2]*x,i},n.number=Xi,n.ortho=function(i,e,s,h,_,x,S){var P=1/(e-s),M=1/(h-_),R=1/(x-S);return i[0]=-2*P,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*M,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*R,i[11]=0,i[12]=(e+s)*P,i[13]=(_+h)*M,i[14]=(S+x)*R,i[15]=1,i},n.parseCacheControl=we,n.parseGlyphPbf=function(i){return new Cu(i).readFields(q_,[])},n.pbf=Cu,n.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=dn/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,s=i.bucket.layers[0]._unevaluatedLayout._values,h={layoutIconSize:s["icon-size"].possiblyEvaluate(new Ji(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Ji(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Ji(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:R}=i.bucket.textSizeData;h.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Ji(M),i.canonical),s["text-size"].possiblyEvaluate(new Ji(R),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:R}=i.bucket.iconSizeData;h.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Ji(M),i.canonical),s["icon-size"].possiblyEvaluate(new Ji(R),i.canonical)]}const _=e.get("text-line-height")*Tn,x=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",S=e.get("text-keep-upright"),P=e.get("text-size");for(const M of i.bucket.features){const R=e.get("text-font").evaluate(M,{},i.canonical).join(","),U=P.evaluate(M,{},i.canonical),G=h.layoutTextSize.evaluate(M,{},i.canonical),Y=h.layoutIconSize.evaluate(M,{},i.canonical),ee={horizontal:{},vertical:void 0},te=M.text;let ge,pe=[0,0];if(te){const Ce=te.toString(),Fe=e.get("text-letter-spacing").evaluate(M,{},i.canonical)*Tn,it=au(Ce)?Fe:0,tt=e.get("text-anchor").evaluate(M,{},i.canonical),Lt=e.get("text-variable-anchor");if(!Lt){const It=e.get("text-radial-offset").evaluate(M,{},i.canonical);pe=It?$f(tt,[It*Tn,Du]):e.get("text-offset").evaluate(M,{},i.canonical).map(Tt=>Tt*Tn)}let Ot=x?"center":e.get("text-justify").evaluate(M,{},i.canonical);const Ct=e.get("symbol-placement"),St=Ct==="point"?e.get("text-max-width").evaluate(M,{},i.canonical)*Tn:0,vt=()=>{i.bucket.allowVerticalPlacement&&Oo(Ce)&&(ee.vertical=pc(te,i.glyphMap,i.glyphPositions,i.imagePositions,R,St,_,tt,"left",it,pe,n.WritingMode.vertical,!0,Ct,G,U))};if(!x&&Lt){const It=Ot==="auto"?Lt.map(ut=>Lu(ut)):[Ot];let Tt=!1;for(let ut=0;ut<It.length;ut++){const Wt=It[ut];if(!ee.horizontal[Wt])if(Tt)ee.horizontal[Wt]=ee.horizontal[0];else{const Gt=pc(te,i.glyphMap,i.glyphPositions,i.imagePositions,R,St,_,"center",Wt,it,pe,n.WritingMode.horizontal,!1,Ct,G,U);Gt&&(ee.horizontal[Wt]=Gt,Tt=Gt.positionedLines.length===1)}}vt()}else{Ot==="auto"&&(Ot=Lu(tt));const It=pc(te,i.glyphMap,i.glyphPositions,i.imagePositions,R,St,_,tt,Ot,it,pe,n.WritingMode.horizontal,!1,Ct,G,U);It&&(ee.horizontal[Ot]=It),vt(),Oo(Ce)&&x&&S&&(ee.vertical=pc(te,i.glyphMap,i.glyphPositions,i.imagePositions,R,St,_,tt,Ot,it,pe,n.WritingMode.vertical,!1,Ct,G,U))}}let Pe=!1;if(M.icon&&M.icon.name){const Ce=i.imageMap[M.icon.name];Ce&&(ge=J_(i.imagePositions[M.icon.name],e.get("icon-offset").evaluate(M,{},i.canonical),e.get("icon-anchor").evaluate(M,{},i.canonical)),Pe=!!Ce.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Pe:i.bucket.sdfIcons!==Pe&&Z("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ce.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const qe=td(ee.horizontal)||ee.vertical;i.bucket.iconsInText=!!qe&&qe.iconsInText,(qe||ge)&&ny(i.bucket,M,ee,ge,i.imageMap,h,G,Y,pe,Pe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},n.perspective=function(i,e,s,h,_){var x,S=1/Math.tan(e/2);return i[0]=S/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,_!=null&&_!==1/0?(i[10]=(_+h)*(x=1/(h-_)),i[14]=2*_*h*x):(i[10]=-1,i[14]=-2*h),i},n.pick=function(i,e){const s={};for(let h=0;h<e.length;h++){const _=e[h];_ in i&&(s[_]=i[_])}return s},n.plugin=nr,n.pointGeometry=ht,n.polygonIntersectsPolygon=rf,n.potpack=Of,n.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.register=Bt,n.registerForPluginStateChange=function(i){return i({pluginStatus:Gn,pluginURL:Or}),Da.on("pluginStateChange",i),i},n.renderColorRamp=gf,n.rotateX=function(i,e,s){var h=Math.sin(s),_=Math.cos(s),x=e[4],S=e[5],P=e[6],M=e[7],R=e[8],U=e[9],G=e[10],Y=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=x*_+R*h,i[5]=S*_+U*h,i[6]=P*_+G*h,i[7]=M*_+Y*h,i[8]=R*_-x*h,i[9]=U*_-S*h,i[10]=G*_-P*h,i[11]=Y*_-M*h,i},n.rotateZ=function(i,e,s){var h=Math.sin(s),_=Math.cos(s),x=e[0],S=e[1],P=e[2],M=e[3],R=e[4],U=e[5],G=e[6],Y=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=x*_+R*h,i[1]=S*_+U*h,i[2]=P*_+G*h,i[3]=M*_+Y*h,i[4]=R*_-x*h,i[5]=U*_-S*h,i[6]=G*_-P*h,i[7]=Y*_-M*h,i},n.scale=function(i,e,s){var h=s[0],_=s[1],x=s[2];return i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i[3]=e[3]*h,i[4]=e[4]*_,i[5]=e[5]*_,i[6]=e[6]*_,i[7]=e[7]*_,i[8]=e[8]*x,i[9]=e[9]*x,i[10]=e[10]*x,i[11]=e[11]*x,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},n.scale$1=function(i,e,s){return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i},n.setCacheLimits=function(i,e){Oe=i,Vt=e},n.setRTLTextPlugin=function(i,e,s=!1){if(Gn===Ia||Gn===Pa||Gn===za)throw new Error("setRTLTextPlugin cannot be called multiple times.");Or=Ke.resolveURL(i),Gn=Ia,Ma=e,Is(),s||Yl()},n.spec=Me,n.sphericalToCartesian=function([i,e,s]){return e+=90,e*=Math.PI/180,s*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(s),y:i*Math.sin(e)*Math.sin(s),z:i*Math.cos(s)}},n.sqrLen=function(i){var e=i[0],s=i[1];return e*e+s*s},n.sub=function(i,e,s){return i[0]=e[0]-s[0],i[1]=e[1]-s[1],i[2]=e[2]-s[2],i},n.toEvaluationFeature=uo,n.transformMat3=function(i,e,s){var h=e[0],_=e[1],x=e[2];return i[0]=h*s[0]+_*s[3]+x*s[6],i[1]=h*s[1]+_*s[4]+x*s[7],i[2]=h*s[2]+_*s[5]+x*s[8],i},n.transformMat4=oc,n.transformMat4$1=function(i,e,s){var h=e[0],_=e[1];return i[0]=s[0]*h+s[4]*_+s[12],i[1]=s[1]*h+s[5]*_+s[13],i},n.translate=function(i,e,s){var h,_,x,S,P,M,R,U,G,Y,ee,te,ge=s[0],pe=s[1],Pe=s[2];return e===i?(i[12]=e[0]*ge+e[4]*pe+e[8]*Pe+e[12],i[13]=e[1]*ge+e[5]*pe+e[9]*Pe+e[13],i[14]=e[2]*ge+e[6]*pe+e[10]*Pe+e[14],i[15]=e[3]*ge+e[7]*pe+e[11]*Pe+e[15]):(_=e[1],x=e[2],S=e[3],P=e[4],M=e[5],R=e[6],U=e[7],G=e[8],Y=e[9],ee=e[10],te=e[11],i[0]=h=e[0],i[1]=_,i[2]=x,i[3]=S,i[4]=P,i[5]=M,i[6]=R,i[7]=U,i[8]=G,i[9]=Y,i[10]=ee,i[11]=te,i[12]=h*ge+P*pe+G*Pe+e[12],i[13]=_*ge+M*pe+Y*Pe+e[13],i[14]=x*ge+R*pe+ee*Pe+e[14],i[15]=S*ge+U*pe+te*Pe+e[15]),i},n.triggerPluginCompletionEvent=Jl,n.unicodeBlockLookup=At,n.uniqueId=function(){return C++},n.validateCustomStyleLayer=function(i){const e=[],s=i.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateLight=Ea,n.validateStyle=no,n.vectorTile=Ds,n.warnOnce=Z,n.wrap=E}),f(["./shared"],function(n){function m(re){const N=typeof re;if(N==="number"||N==="boolean"||N==="string"||re==null)return JSON.stringify(re);if(Array.isArray(re)){let ne="[";for(const _e of re)ne+=`${m(_e)},`;return`${ne}]`}const H=Object.keys(re).sort();let ie="{";for(let ne=0;ne<H.length;ne++)ie+=`${JSON.stringify(H[ne])}:${m(re[H[ne]])},`;return`${ie}}`}function v(re){let N="";for(const H of n.refProperties)N+=`/${m(re[H])}`;return N}class w{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,H){for(const ne of N){this._layerConfigs[ne.id]=ne;const _e=this._layers[ne.id]=n.createStyleLayer(ne);_e._featureFilter=n.createFilter(_e.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of H)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const ie=function(ne,_e){const Ee={};for(let ye=0;ye<ne.length;ye++){const Te=_e&&_e[ne[ye].id]||v(ne[ye]);_e&&(_e[ne[ye].id]=Te);let He=Ee[Te];He||(He=Ee[Te]=[]),He.push(ne[ye])}const ve=[];for(const ye in Ee)ve.push(Ee[ye]);return ve}(Object.values(this._layerConfigs),this.keyCache);for(const ne of ie){const _e=ne.map(st=>this._layers[st.id]),Ee=_e[0];if(Ee.visibility==="none")continue;const ve=Ee.source||"";let ye=this.familiesBySource[ve];ye||(ye=this.familiesBySource[ve]={});const Te=Ee.sourceLayer||"_geojsonTileLayer";let He=ye[Te];He||(He=ye[Te]=[]),He.push(_e)}}}class A{constructor(N){const H={},ie=[];for(const ve in N){const ye=N[ve],Te=H[ve]={};for(const He in ye){const st=ye[+He];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const Ze={x:0,y:0,w:st.bitmap.width+2,h:st.bitmap.height+2};ie.push(Ze),Te[He]={rect:Ze,metrics:st.metrics}}}const{w:ne,h:_e}=n.potpack(ie),Ee=new n.AlphaImage({width:ne||1,height:_e||1});for(const ve in N){const ye=N[ve];for(const Te in ye){const He=ye[+Te];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const st=H[ve][Te].rect;n.AlphaImage.copy(He.bitmap,Ee,{x:0,y:0},{x:st.x+1,y:st.y+1},He.bitmap)}}this.image=Ee,this.positions=H}}n.register("GlyphAtlas",A);class b{constructor(N){this.tileID=new n.OverscaledTileID(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId}parse(N,H,ie,ne,_e){this.status="parsing",this.data=N,this.collisionBoxArray=new n.CollisionBoxArray;const Ee=new n.DictionaryCoder(Object.keys(N.layers).sort()),ve=new n.FeatureIndex(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const ye={},Te={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},He=H.familiesBySource[this.source];for(const ni in He){const ui=N.layers[ni];if(!ui)continue;ui.version===1&&n.warnOnce(`Vector tile source "${this.source}" layer "${ni}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ki=Ee.encode(ni),Oi=[];for(let yn=0;yn<ui.length;yn++){const Wi=ui.feature(yn),Mn=ve.getId(Wi,ni);Oi.push({feature:Wi,id:Mn,index:yn,sourceLayerIndex:ki})}for(const yn of He[ni]){const Wi=yn[0];Wi.source!==this.source&&n.warnOnce(`layer.source = ${Wi.source} does not equal this.source = ${this.source}`),Wi.minzoom&&this.zoom<Math.floor(Wi.minzoom)||Wi.maxzoom&&this.zoom>=Wi.maxzoom||Wi.visibility!=="none"&&(E(yn,this.zoom,ie),(ye[Wi.id]=Wi.createBucket({index:ve.bucketLayerIDs.length,layers:yn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ki,sourceID:this.source})).populate(Oi,Te,this.tileID.canonical),ve.bucketLayerIDs.push(yn.map(Mn=>Mn.id)))}}let st,Ze,Rt,Ft;const Pt=n.mapObject(Te.glyphDependencies,ni=>Object.keys(ni).map(Number));Object.keys(Pt).length?ne.send("getGlyphs",{uid:this.uid,stacks:Pt},(ni,ui)=>{st||(st=ni,Ze=ui,wi.call(this))}):Ze={};const Qt=Object.keys(Te.iconDependencies);Qt.length?ne.send("getImages",{icons:Qt,source:this.source,tileID:this.tileID,type:"icons"},(ni,ui)=>{st||(st=ni,Rt=ui,wi.call(this))}):Rt={};const ii=Object.keys(Te.patternDependencies);function wi(){if(st)return _e(st);if(Ze&&Rt&&Ft){const ni=new A(Ze),ui=new n.ImageAtlas(Rt,Ft);for(const ki in ye){const Oi=ye[ki];Oi instanceof n.SymbolBucket?(E(Oi.layers,this.zoom,ie),n.performSymbolLayout({bucket:Oi,glyphMap:Ze,glyphPositions:ni.positions,imageMap:Rt,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Oi.hasPattern&&(Oi instanceof n.LineBucket||Oi instanceof n.FillBucket||Oi instanceof n.FillExtrusionBucket)&&(E(Oi.layers,this.zoom,ie),Oi.addFeatures(Te,this.tileID.canonical,ui.patternPositions))}this.status="done",_e(null,{buckets:Object.values(ye).filter(ki=>!ki.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ni.image,imageAtlas:ui,glyphMap:this.returnDependencies?Ze:null,iconMap:this.returnDependencies?Rt:null,glyphPositions:this.returnDependencies?ni.positions:null})}}ii.length?ne.send("getImages",{icons:ii,source:this.source,tileID:this.tileID,type:"patterns"},(ni,ui)=>{st||(st=ni,Ft=ui,wi.call(this))}):Ft={},wi.call(this)}}function E(re,N,H){const ie=new n.EvaluationParameters(N);for(const ne of re)ne.recalculate(ie,H)}function T(re,N){const H=n.getArrayBuffer(re.request,(ie,ne,_e,Ee)=>{ie?N(ie):ne&&N(null,{vectorTile:new n.vectorTile.VectorTile(new n.pbf(ne)),rawData:ne,cacheControl:_e,expires:Ee})});return()=>{H.cancel(),N()}}class C{constructor(N,H,ie,ne){this.actor=N,this.layerIndex=H,this.availableImages=ie,this.loadVectorData=ne||T,this.loading={},this.loaded={}}loadTile(N,H){const ie=N.uid;this.loading||(this.loading={});const ne=!!(N&&N.request&&N.request.collectResourceTiming)&&new n.RequestPerformance(N.request),_e=this.loading[ie]=new b(N);_e.abort=this.loadVectorData(N,(Ee,ve)=>{if(delete this.loading[ie],Ee||!ve)return _e.status="done",this.loaded[ie]=_e,H(Ee);const ye=ve.rawData,Te={};ve.expires&&(Te.expires=ve.expires),ve.cacheControl&&(Te.cacheControl=ve.cacheControl);const He={};if(ne){const st=ne.finish();st&&(He.resourceTiming=JSON.parse(JSON.stringify(st)))}_e.vectorTile=ve.vectorTile,_e.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,(st,Ze)=>{if(st||!Ze)return H(st);H(null,n.extend({rawTileData:ye.slice(0)},Ze,Te,He))}),this.loaded=this.loaded||{},this.loaded[ie]=_e})}reloadTile(N,H){const ie=this.loaded,ne=N.uid,_e=this;if(ie&&ie[ne]){const Ee=ie[ne];Ee.showCollisionBoxes=N.showCollisionBoxes;const ve=(ye,Te)=>{const He=Ee.reloadCallback;He&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,_e.layerIndex,this.availableImages,_e.actor,He)),H(ye,Te)};Ee.status==="parsing"?Ee.reloadCallback=ve:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,ve):ve())}}abortTile(N,H){const ie=this.loading,ne=N.uid;ie&&ie[ne]&&ie[ne].abort&&(ie[ne].abort(),delete ie[ne]),H()}removeTile(N,H){const ie=this.loaded,ne=N.uid;ie&&ie[ne]&&delete ie[ne],H()}}class z{constructor(){this.loaded={}}loadTile(N,H){const{uid:ie,encoding:ne,rawImageData:_e}=N,Ee=n.isImageBitmap(_e)?this.getImageData(_e):_e,ve=new n.DEMData(ie,Ee,ne);this.loaded=this.loaded||{},this.loaded[ie]=ve,H(null,ve)}getImageData(N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const H=this.offscreenCanvasContext.getImageData(-1,-1,N.width+2,N.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new n.RGBAImage({width:H.width,height:H.height},H.data)}removeTile(N){const H=this.loaded,ie=N.uid;H&&H[ie]&&delete H[ie]}}var B=function re(N,H){var ie,ne=N&&N.type;if(ne==="FeatureCollection")for(ie=0;ie<N.features.length;ie++)re(N.features[ie],H);else if(ne==="GeometryCollection")for(ie=0;ie<N.geometries.length;ie++)re(N.geometries[ie],H);else if(ne==="Feature")re(N.geometry,H);else if(ne==="Polygon")O(N.coordinates,H);else if(ne==="MultiPolygon")for(ie=0;ie<N.coordinates.length;ie++)O(N.coordinates[ie],H);return N};function O(re,N){if(re.length!==0){W(re[0],N);for(var H=1;H<re.length;H++)W(re[H],!N)}}function W(re,N){for(var H=0,ie=0,ne=0,_e=re.length,Ee=_e-1;ne<_e;Ee=ne++){var ve=(re[ne][0]-re[Ee][0])*(re[Ee][1]+re[ne][1]),ye=H+ve;ie+=Math.abs(H)>=Math.abs(ve)?H-ye+ve:ve-ye+H,H=ye}H+ie>=0!=!!N&&re.reverse()}const q=n.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Z{constructor(N){this._feature=N,this.extent=n.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(this._feature.type===1){const N=[];for(const H of this._feature.geometry)N.push([new n.pointGeometry(H[0],H[1])]);return N}{const N=[];for(const H of this._feature.geometry){const ie=[];for(const ne of H)ie.push(new n.pointGeometry(ne[0],ne[1]));N.push(ie)}return N}}toGeoJSON(N,H,ie){return q.call(this,N,H,ie)}}class ae{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=N.length,this._features=N}feature(N){return new Z(this._features[N])}}var J={exports:{}},he=n.pointGeometry,we=n.vectorTile.VectorTileFeature,Se=ot;function ot(re,N){this.options=N||{},this.features=re,this.length=re.length}function oe(re,N){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=N||4096}ot.prototype.feature=function(re){return new oe(this.features[re],this.options.extent)},oe.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var N=0;N<re.length;N++){for(var H=re[N],ie=[],ne=0;ne<H.length;ne++)ie.push(new he(H[ne][0],H[ne][1]));this.geometry.push(ie)}return this.geometry},oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,N=1/0,H=-1/0,ie=1/0,ne=-1/0,_e=0;_e<re.length;_e++)for(var Ee=re[_e],ve=0;ve<Ee.length;ve++){var ye=Ee[ve];N=Math.min(N,ye.x),H=Math.max(H,ye.x),ie=Math.min(ie,ye.y),ne=Math.max(ne,ye.y)}return[N,ie,H,ne]},oe.prototype.toGeoJSON=we.prototype.toGeoJSON;var Ve=n.pbf,K=Se;function Ke(re){var N=new Ve;return function(H,ie){for(var ne in H.layers)ie.writeMessage(3,ht,H.layers[ne])}(re,N),N.finish()}function ht(re,N){var H;N.writeVarintField(15,re.version||1),N.writeStringField(1,re.name||""),N.writeVarintField(5,re.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<re.length;H++)ie.feature=re.feature(H),N.writeMessage(2,ct,ie);var ne=ie.keys;for(H=0;H<ne.length;H++)N.writeStringField(3,ne[H]);var _e=ie.values;for(H=0;H<_e.length;H++)N.writeMessage(4,Oe,_e[H])}function ct(re,N){var H=re.feature;H.id!==void 0&&N.writeVarintField(1,H.id),N.writeMessage(2,Zt,re),N.writeVarintField(3,H.type),N.writeMessage(4,je,H)}function Zt(re,N){var H=re.feature,ie=re.keys,ne=re.values,_e=re.keycache,Ee=re.valuecache;for(var ve in H.properties){var ye=H.properties[ve],Te=_e[ve];if(ye!==null){Te===void 0&&(ie.push(ve),_e[ve]=Te=ie.length-1),N.writeVarint(Te);var He=typeof ye;He!=="string"&&He!=="boolean"&&He!=="number"&&(ye=JSON.stringify(ye));var st=He+":"+ye,Ze=Ee[st];Ze===void 0&&(ne.push(ye),Ee[st]=Ze=ne.length-1),N.writeVarint(Ze)}}}function Qe(re,N){return(N<<3)+(7&re)}function Ut(re){return re<<1^re>>31}function je(re,N){for(var H=re.loadGeometry(),ie=re.type,ne=0,_e=0,Ee=H.length,ve=0;ve<Ee;ve++){var ye=H[ve],Te=1;ie===1&&(Te=ye.length),N.writeVarint(Qe(1,Te));for(var He=ie===3?ye.length-1:ye.length,st=0;st<He;st++){st===1&&ie!==1&&N.writeVarint(Qe(2,He-1));var Ze=ye[st].x-ne,Rt=ye[st].y-_e;N.writeVarint(Ut(Ze)),N.writeVarint(Ut(Rt)),ne+=Ze,_e+=Rt}ie===3&&N.writeVarint(Qe(7,1))}}function Oe(re,N){var H=typeof re;H==="string"?N.writeStringField(1,re):H==="boolean"?N.writeBooleanField(7,re):H==="number"&&(re%1!=0?N.writeDoubleField(3,re):re<0?N.writeSVarintField(6,re):N.writeVarintField(5,re))}function Vt(re,N,H,ie,ne,_e){if(ne-ie<=H)return;const Ee=ie+ne>>1;Et(re,N,Ee,ie,ne,_e%2),Vt(re,N,H,ie,Ee-1,_e+1),Vt(re,N,H,Ee+1,ne,_e+1)}function Et(re,N,H,ie,ne,_e){for(;ne>ie;){if(ne-ie>600){const Te=ne-ie+1,He=H-ie+1,st=Math.log(Te),Ze=.5*Math.exp(2*st/3),Rt=.5*Math.sqrt(st*Ze*(Te-Ze)/Te)*(He-Te/2<0?-1:1);Et(re,N,H,Math.max(ie,Math.floor(H-He*Ze/Te+Rt)),Math.min(ne,Math.floor(H+(Te-He)*Ze/Te+Rt)),_e)}const Ee=N[2*H+_e];let ve=ie,ye=ne;for(mt(re,N,ie,H),N[2*ne+_e]>Ee&&mt(re,N,ie,ne);ve<ye;){for(mt(re,N,ve,ye),ve++,ye--;N[2*ve+_e]<Ee;)ve++;for(;N[2*ye+_e]>Ee;)ye--}N[2*ie+_e]===Ee?mt(re,N,ie,ye):(ye++,mt(re,N,ye,ne)),ye<=H&&(ie=ye+1),H<=ye&&(ne=ye-1)}}function mt(re,N,H,ie){bi(re,H,ie),bi(N,2*H,2*ie),bi(N,2*H+1,2*ie+1)}function bi(re,N,H){const ie=re[N];re[N]=re[H],re[H]=ie}function zi(re,N,H,ie){const ne=re-H,_e=N-ie;return ne*ne+_e*_e}J.exports=Ke,J.exports.fromVectorTileJs=Ke,J.exports.fromGeojsonVt=function(re,N){N=N||{};var H={};for(var ie in re)H[ie]=new K(re[ie].features,N),H[ie].name=ie,H[ie].version=N.version,H[ie].extent=N.extent;return Ke({layers:H})},J.exports.GeoJSONWrapper=K;const si=re=>re[0],et=re=>re[1];class oi{constructor(N,H=si,ie=et,ne=64,_e=Float64Array){this.nodeSize=ne,this.points=N;const Ee=N.length<65536?Uint16Array:Uint32Array,ve=this.ids=new Ee(N.length),ye=this.coords=new _e(2*N.length);for(let Te=0;Te<N.length;Te++)ve[Te]=Te,ye[2*Te]=H(N[Te]),ye[2*Te+1]=ie(N[Te]);Vt(ve,ye,ne,0,ve.length-1,0)}range(N,H,ie,ne){return function(_e,Ee,ve,ye,Te,He,st){const Ze=[0,_e.length-1,0],Rt=[];let Ft,Pt;for(;Ze.length;){const Qt=Ze.pop(),ii=Ze.pop(),wi=Ze.pop();if(ii-wi<=st){for(let ki=wi;ki<=ii;ki++)Ft=Ee[2*ki],Pt=Ee[2*ki+1],Ft>=ve&&Ft<=Te&&Pt>=ye&&Pt<=He&&Rt.push(_e[ki]);continue}const ni=Math.floor((wi+ii)/2);Ft=Ee[2*ni],Pt=Ee[2*ni+1],Ft>=ve&&Ft<=Te&&Pt>=ye&&Pt<=He&&Rt.push(_e[ni]);const ui=(Qt+1)%2;(Qt===0?ve<=Ft:ye<=Pt)&&(Ze.push(wi),Ze.push(ni-1),Ze.push(ui)),(Qt===0?Te>=Ft:He>=Pt)&&(Ze.push(ni+1),Ze.push(ii),Ze.push(ui))}return Rt}(this.ids,this.coords,N,H,ie,ne,this.nodeSize)}within(N,H,ie){return function(ne,_e,Ee,ve,ye,Te){const He=[0,ne.length-1,0],st=[],Ze=ye*ye;for(;He.length;){const Rt=He.pop(),Ft=He.pop(),Pt=He.pop();if(Ft-Pt<=Te){for(let ui=Pt;ui<=Ft;ui++)zi(_e[2*ui],_e[2*ui+1],Ee,ve)<=Ze&&st.push(ne[ui]);continue}const Qt=Math.floor((Pt+Ft)/2),ii=_e[2*Qt],wi=_e[2*Qt+1];zi(ii,wi,Ee,ve)<=Ze&&st.push(ne[Qt]);const ni=(Rt+1)%2;(Rt===0?Ee-ye<=ii:ve-ye<=wi)&&(He.push(Pt),He.push(Qt-1),He.push(ni)),(Rt===0?Ee+ye>=ii:ve+ye>=wi)&&(He.push(Qt+1),He.push(Ft),He.push(ni))}return st}(this.ids,this.coords,N,H,ie,this.nodeSize)}}const mi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},tn=Math.fround||(Hi=new Float32Array(1),re=>(Hi[0]=+re,Hi[0]));var Hi;class j{constructor(N){this.options=Ue(Object.create(mi),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:H,minZoom:ie,maxZoom:ne,nodeSize:_e}=this.options;H&&console.time("total time");const Ee=`prepare ${N.length} points`;H&&console.time(Ee),this.points=N;let ve=[];for(let ye=0;ye<N.length;ye++)N[ye].geometry&&ve.push(Je(N[ye],ye));this.trees[ne+1]=new oi(ve,_t,Mt,_e,Float32Array),H&&console.timeEnd(Ee);for(let ye=ne;ye>=ie;ye--){const Te=+Date.now();ve=this._cluster(ve,ye),this.trees[ye]=new oi(ve,_t,Mt,_e,Float32Array),H&&console.log("z%d: %d clusters in %dms",ye,ve.length,+Date.now()-Te)}return H&&console.timeEnd("total time"),this}getClusters(N,H){let ie=((N[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,N[1]));let _e=N[2]===180?180:((N[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)ie=-180,_e=180;else if(ie>_e){const He=this.getClusters([ie,ne,180,Ee],H),st=this.getClusters([-180,ne,_e,Ee],H);return He.concat(st)}const ve=this.trees[this._limitZoom(H)],ye=ve.range(xe(ie),rt(Ee),xe(_e),rt(ne)),Te=[];for(const He of ye){const st=ve.points[He];Te.push(st.numPoints?me(st):this.points[st.index])}return Te}getChildren(N){const H=this._getOriginId(N),ie=this._getOriginZoom(N),ne="No cluster with the specified id.",_e=this.trees[ie];if(!_e)throw new Error(ne);const Ee=_e.points[H];if(!Ee)throw new Error(ne);const ve=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),ye=_e.within(Ee.x,Ee.y,ve),Te=[];for(const He of ye){const st=_e.points[He];st.parentId===N&&Te.push(st.numPoints?me(st):this.points[st.index])}if(Te.length===0)throw new Error(ne);return Te}getLeaves(N,H,ie){const ne=[];return this._appendLeaves(ne,N,H=H||10,ie=ie||0,0),ne}getTile(N,H,ie){const ne=this.trees[this._limitZoom(N)],_e=Math.pow(2,N),{extent:Ee,radius:ve}=this.options,ye=ve/Ee,Te=(ie-ye)/_e,He=(ie+1+ye)/_e,st={features:[]};return this._addTileFeatures(ne.range((H-ye)/_e,Te,(H+1+ye)/_e,He),ne.points,H,ie,_e,st),H===0&&this._addTileFeatures(ne.range(1-ye/_e,Te,1,He),ne.points,_e,ie,_e,st),H===_e-1&&this._addTileFeatures(ne.range(0,Te,ye/_e,He),ne.points,-1,ie,_e,st),st.features.length?st:null}getClusterExpansionZoom(N){let H=this._getOriginZoom(N)-1;for(;H<=this.options.maxZoom;){const ie=this.getChildren(N);if(H++,ie.length!==1)break;N=ie[0].properties.cluster_id}return H}_appendLeaves(N,H,ie,ne,_e){const Ee=this.getChildren(H);for(const ve of Ee){const ye=ve.properties;if(ye&&ye.cluster?_e+ye.point_count<=ne?_e+=ye.point_count:_e=this._appendLeaves(N,ye.cluster_id,ie,ne,_e):_e<ne?_e++:N.push(ve),N.length===ie)break}return _e}_addTileFeatures(N,H,ie,ne,_e,Ee){for(const ve of N){const ye=H[ve],Te=ye.numPoints;let He,st,Ze;if(Te)He=ce(ye),st=ye.x,Ze=ye.y;else{const Pt=this.points[ye.index];He=Pt.properties,st=xe(Pt.geometry.coordinates[0]),Ze=rt(Pt.geometry.coordinates[1])}const Rt={type:1,geometry:[[Math.round(this.options.extent*(st*_e-ie)),Math.round(this.options.extent*(Ze*_e-ne))]],tags:He};let Ft;Te?Ft=ye.id:this.options.generateId?Ft=ye.index:this.points[ye.index].id&&(Ft=this.points[ye.index].id),Ft!==void 0&&(Rt.id=Ft),Ee.features.push(Rt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,H){const ie=[],{radius:ne,extent:_e,reduce:Ee,minPoints:ve}=this.options,ye=ne/(_e*Math.pow(2,H));for(let Te=0;Te<N.length;Te++){const He=N[Te];if(He.zoom<=H)continue;He.zoom=H;const st=this.trees[H+1],Ze=st.within(He.x,He.y,ye),Rt=He.numPoints||1;let Ft=Rt;for(const Pt of Ze){const Qt=st.points[Pt];Qt.zoom>H&&(Ft+=Qt.numPoints||1)}if(Ft>Rt&&Ft>=ve){let Pt=He.x*Rt,Qt=He.y*Rt,ii=Ee&&Rt>1?this._map(He,!0):null;const wi=(Te<<5)+(H+1)+this.points.length;for(const ni of Ze){const ui=st.points[ni];if(ui.zoom<=H)continue;ui.zoom=H;const ki=ui.numPoints||1;Pt+=ui.x*ki,Qt+=ui.y*ki,ui.parentId=wi,Ee&&(ii||(ii=this._map(He,!0)),Ee(ii,this._map(ui)))}He.parentId=wi,ie.push(nt(Pt/Ft,Qt/Ft,wi,Ft,ii))}else if(ie.push(He),Ft>1)for(const Pt of Ze){const Qt=st.points[Pt];Qt.zoom<=H||(Qt.zoom=H,ie.push(Qt))}}return ie}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,H){if(N.numPoints)return H?Ue({},N.properties):N.properties;const ie=this.points[N.index].properties,ne=this.options.map(ie);return H&&ne===ie?Ue({},ne):ne}}function nt(re,N,H,ie,ne){return{x:tn(re),y:tn(N),zoom:1/0,id:H,parentId:-1,numPoints:ie,properties:ne}}function Je(re,N){const[H,ie]=re.geometry.coordinates;return{x:tn(xe(H)),y:tn(rt(ie)),zoom:1/0,index:N,parentId:-1}}function me(re){return{type:"Feature",id:re.id,properties:ce(re),geometry:{type:"Point",coordinates:[(N=re.x,360*(N-.5)),at(re.y)]}};var N}function ce(re){const N=re.numPoints,H=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return Ue(Ue({},re.properties),{cluster:!0,cluster_id:re.id,point_count:N,point_count_abbreviated:H})}function xe(re){return re/360+.5}function rt(re){const N=Math.sin(re*Math.PI/180),H=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return H<0?0:H>1?1:H}function at(re){const N=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Ue(re,N){for(const H in N)re[H]=N[H];return re}function _t(re){return re.x}function Mt(re){return re.y}function gt(re,N,H,ie){for(var ne,_e=ie,Ee=H-N>>1,ve=H-N,ye=re[N],Te=re[N+1],He=re[H],st=re[H+1],Ze=N+3;Ze<H;Ze+=3){var Rt=Xt(re[Ze],re[Ze+1],ye,Te,He,st);if(Rt>_e)ne=Ze,_e=Rt;else if(Rt===_e){var Ft=Math.abs(Ze-Ee);Ft<ve&&(ne=Ze,ve=Ft)}}_e>ie&&(ne-N>3&&gt(re,N,ne,ie),re[ne+2]=_e,H-ne>3&&gt(re,ne,H,ie))}function Xt(re,N,H,ie,ne,_e){var Ee=ne-H,ve=_e-ie;if(Ee!==0||ve!==0){var ye=((re-H)*Ee+(N-ie)*ve)/(Ee*Ee+ve*ve);ye>1?(H=ne,ie=_e):ye>0&&(H+=Ee*ye,ie+=ve*ye)}return(Ee=re-H)*Ee+(ve=N-ie)*ve}function xi(re,N,H,ie){var ne={id:re===void 0?null:re,type:N,geometry:H,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var Ee=_e.geometry,ve=_e.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Me(_e,Ee);else if(ve==="Polygon"||ve==="MultiLineString")for(var ye=0;ye<Ee.length;ye++)Me(_e,Ee[ye]);else if(ve==="MultiPolygon")for(ye=0;ye<Ee.length;ye++)for(var Te=0;Te<Ee[ye].length;Te++)Me(_e,Ee[ye][Te])}(ne),ne}function Me(re,N){for(var H=0;H<N.length;H+=3)re.minX=Math.min(re.minX,N[H]),re.minY=Math.min(re.minY,N[H+1]),re.maxX=Math.max(re.maxX,N[H]),re.maxY=Math.max(re.maxY,N[H+1])}function pt(re,N,H,ie){if(N.geometry){var ne=N.geometry.coordinates,_e=N.geometry.type,Ee=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),ve=[],ye=N.id;if(H.promoteId?ye=N.properties[H.promoteId]:H.generateId&&(ye=ie||0),_e==="Point")Wn(ne,ve);else if(_e==="MultiPoint")for(var Te=0;Te<ne.length;Te++)Wn(ne[Te],ve);else if(_e==="LineString")nn(ne,ve,Ee,!1);else if(_e==="MultiLineString"){if(H.lineMetrics){for(Te=0;Te<ne.length;Te++)nn(ne[Te],ve=[],Ee,!1),re.push(xi(ye,"LineString",ve,N.properties));return}di(ne,ve,Ee,!1)}else if(_e==="Polygon")di(ne,ve,Ee,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(Te=0;Te<N.geometry.geometries.length;Te++)pt(re,{id:ye,geometry:N.geometry.geometries[Te],properties:N.properties},H,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Te=0;Te<ne.length;Te++){var He=[];di(ne[Te],He,Ee,!0),ve.push(He)}}re.push(xi(ye,_e,ve,N.properties))}}function Wn(re,N){N.push(Ei(re[0])),N.push(mn(re[1])),N.push(0)}function nn(re,N,H,ie){for(var ne,_e,Ee=0,ve=0;ve<re.length;ve++){var ye=Ei(re[ve][0]),Te=mn(re[ve][1]);N.push(ye),N.push(Te),N.push(0),ve>0&&(Ee+=ie?(ne*Te-ye*_e)/2:Math.sqrt(Math.pow(ye-ne,2)+Math.pow(Te-_e,2))),ne=ye,_e=Te}var He=N.length-3;N[2]=1,gt(N,0,He,H),N[He+2]=1,N.size=Math.abs(Ee),N.start=0,N.end=N.size}function di(re,N,H,ie){for(var ne=0;ne<re.length;ne++){var _e=[];nn(re[ne],_e,H,ie),N.push(_e)}}function Ei(re){return re/360+.5}function mn(re){var N=Math.sin(re*Math.PI/180),H=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return H<0?0:H>1?1:H}function Sn(re,N,H,ie,ne,_e,Ee,ve){if(ie/=N,_e>=(H/=N)&&Ee<ie)return re;if(Ee<H||_e>=ie)return null;for(var ye=[],Te=0;Te<re.length;Te++){var He=re[Te],st=He.geometry,Ze=He.type,Rt=ne===0?He.minX:He.minY,Ft=ne===0?He.maxX:He.maxY;if(Rt>=H&&Ft<ie)ye.push(He);else if(!(Ft<H||Rt>=ie)){var Pt=[];if(Ze==="Point"||Ze==="MultiPoint")gn(st,Pt,H,ie,ne);else if(Ze==="LineString")bt(st,Pt,H,ie,ne,!1,ve.lineMetrics);else if(Ze==="MultiLineString")ri(st,Pt,H,ie,ne,!1);else if(Ze==="Polygon")ri(st,Pt,H,ie,ne,!0);else if(Ze==="MultiPolygon")for(var Qt=0;Qt<st.length;Qt++){var ii=[];ri(st[Qt],ii,H,ie,ne,!0),ii.length&&Pt.push(ii)}if(Pt.length){if(ve.lineMetrics&&Ze==="LineString"){for(Qt=0;Qt<Pt.length;Qt++)ye.push(xi(He.id,Ze,Pt[Qt],He.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Pt.length===1?(Ze="LineString",Pt=Pt[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Pt.length===3?"Point":"MultiPoint"),ye.push(xi(He.id,Ze,Pt,He.tags))}}}return ye.length?ye:null}function gn(re,N,H,ie,ne){for(var _e=0;_e<re.length;_e+=3){var Ee=re[_e+ne];Ee>=H&&Ee<=ie&&(N.push(re[_e]),N.push(re[_e+1]),N.push(re[_e+2]))}}function bt(re,N,H,ie,ne,_e,Ee){for(var ve,ye,Te=li(re),He=ne===0?ar:ti,st=re.start,Ze=0;Ze<re.length-3;Ze+=3){var Rt=re[Ze],Ft=re[Ze+1],Pt=re[Ze+2],Qt=re[Ze+3],ii=re[Ze+4],wi=ne===0?Rt:Ft,ni=ne===0?Qt:ii,ui=!1;Ee&&(ve=Math.sqrt(Math.pow(Rt-Qt,2)+Math.pow(Ft-ii,2))),wi<H?ni>H&&(ye=He(Te,Rt,Ft,Qt,ii,H),Ee&&(Te.start=st+ve*ye)):wi>ie?ni<ie&&(ye=He(Te,Rt,Ft,Qt,ii,ie),Ee&&(Te.start=st+ve*ye)):hn(Te,Rt,Ft,Pt),ni<H&&wi>=H&&(ye=He(Te,Rt,Ft,Qt,ii,H),ui=!0),ni>ie&&wi<=ie&&(ye=He(Te,Rt,Ft,Qt,ii,ie),ui=!0),!_e&&ui&&(Ee&&(Te.end=st+ve*ye),N.push(Te),Te=li(re)),Ee&&(st+=ve)}var ki=re.length-3;Rt=re[ki],Ft=re[ki+1],Pt=re[ki+2],(wi=ne===0?Rt:Ft)>=H&&wi<=ie&&hn(Te,Rt,Ft,Pt),ki=Te.length-3,_e&&ki>=3&&(Te[ki]!==Te[0]||Te[ki+1]!==Te[1])&&hn(Te,Te[0],Te[1],Te[2]),Te.length&&N.push(Te)}function li(re){var N=[];return N.size=re.size,N.start=re.start,N.end=re.end,N}function ri(re,N,H,ie,ne,_e){for(var Ee=0;Ee<re.length;Ee++)bt(re[Ee],N,H,ie,ne,_e,!1)}function hn(re,N,H,ie){re.push(N),re.push(H),re.push(ie)}function ar(re,N,H,ie,ne,_e){var Ee=(_e-N)/(ie-N);return re.push(_e),re.push(H+(ne-H)*Ee),re.push(1),Ee}function ti(re,N,H,ie,ne,_e){var Ee=(_e-H)/(ne-H);return re.push(N+(ie-N)*Ee),re.push(_e),re.push(1),Ee}function Vn(re,N){for(var H=[],ie=0;ie<re.length;ie++){var ne,_e=re[ie],Ee=_e.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")ne=_n(_e.geometry,N);else if(Ee==="MultiLineString"||Ee==="Polygon"){ne=[];for(var ve=0;ve<_e.geometry.length;ve++)ne.push(_n(_e.geometry[ve],N))}else if(Ee==="MultiPolygon")for(ne=[],ve=0;ve<_e.geometry.length;ve++){for(var ye=[],Te=0;Te<_e.geometry[ve].length;Te++)ye.push(_n(_e.geometry[ve][Te],N));ne.push(ye)}H.push(xi(_e.id,Ee,ne,_e.tags))}return H}function _n(re,N){var H=[];H.size=re.size,re.start!==void 0&&(H.start=re.start,H.end=re.end);for(var ie=0;ie<re.length;ie+=3)H.push(re[ie]+N,re[ie+1],re[ie+2]);return H}function gs(re,N){if(re.transformed)return re;var H,ie,ne,_e=1<<re.z,Ee=re.x,ve=re.y;for(H=0;H<re.features.length;H++){var ye=re.features[H],Te=ye.geometry,He=ye.type;if(ye.geometry=[],He===1)for(ie=0;ie<Te.length;ie+=2)ye.geometry.push(an(Te[ie],Te[ie+1],N,_e,Ee,ve));else for(ie=0;ie<Te.length;ie++){var st=[];for(ne=0;ne<Te[ie].length;ne+=2)st.push(an(Te[ie][ne],Te[ie][ne+1],N,_e,Ee,ve));ye.geometry.push(st)}}return re.transformed=!0,re}function an(re,N,H,ie,ne,_e){return[Math.round(H*(re*ie-ne)),Math.round(H*(N*ie-_e))]}function On(re,N,H,ie,ne){for(var _e=N===ne.maxZoom?0:ne.tolerance/((1<<N)*ne.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:ie,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ve=0;ve<re.length;ve++){Ee.numFeatures++,Bi(Ee,re[ve],_e,ne);var ye=re[ve].minX,Te=re[ve].minY,He=re[ve].maxX,st=re[ve].maxY;ye<Ee.minX&&(Ee.minX=ye),Te<Ee.minY&&(Ee.minY=Te),He>Ee.maxX&&(Ee.maxX=He),st>Ee.maxY&&(Ee.maxY=st)}return Ee}function Bi(re,N,H,ie){var ne=N.geometry,_e=N.type,Ee=[];if(_e==="Point"||_e==="MultiPoint")for(var ve=0;ve<ne.length;ve+=3)Ee.push(ne[ve]),Ee.push(ne[ve+1]),re.numPoints++,re.numSimplified++;else if(_e==="LineString")_s(Ee,ne,re,H,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(ve=0;ve<ne.length;ve++)_s(Ee,ne[ve],re,H,_e==="Polygon",ve===0);else if(_e==="MultiPolygon")for(var ye=0;ye<ne.length;ye++){var Te=ne[ye];for(ve=0;ve<Te.length;ve++)_s(Ee,Te[ve],re,H,!0,ve===0)}if(Ee.length){var He=N.tags||null;if(_e==="LineString"&&ie.lineMetrics){for(var st in He={},N.tags)He[st]=N.tags[st];He.mapbox_clip_start=ne.start/ne.size,He.mapbox_clip_end=ne.end/ne.size}var Ze={geometry:Ee,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:He};N.id!==null&&(Ze.id=N.id),re.features.push(Ze)}}function _s(re,N,H,ie,ne,_e){var Ee=ie*ie;if(ie>0&&N.size<(ne?Ee:ie))H.numPoints+=N.length/3;else{for(var ve=[],ye=0;ye<N.length;ye+=3)(ie===0||N[ye+2]>Ee)&&(H.numSimplified++,ve.push(N[ye]),ve.push(N[ye+1])),H.numPoints++;ne&&function(Te,He){for(var st=0,Ze=0,Rt=Te.length,Ft=Rt-2;Ze<Rt;Ft=Ze,Ze+=2)st+=(Te[Ze]-Te[Ft])*(Te[Ze+1]+Te[Ft+1]);if(st>0===He)for(Ze=0,Rt=Te.length;Ze<Rt/2;Ze+=2){var Pt=Te[Ze],Qt=Te[Ze+1];Te[Ze]=Te[Rt-2-Ze],Te[Ze+1]=Te[Rt-1-Ze],Te[Rt-2-Ze]=Pt,Te[Rt-1-Ze]=Qt}}(ve,_e),re.push(ve)}}function gr(re,N){var H=(N=this.options=function(ne,_e){for(var Ee in _e)ne[Ee]=_e[Ee];return ne}(Object.create(this.options),N)).debug;if(H&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var ie=function(ne,_e){var Ee=[];if(ne.type==="FeatureCollection")for(var ve=0;ve<ne.features.length;ve++)pt(Ee,ne.features[ve],_e,ve);else pt(Ee,ne.type==="Feature"?ne:{geometry:ne},_e);return Ee}(re,N);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=function(ne,_e){var Ee=_e.buffer/_e.extent,ve=ne,ye=Sn(ne,1,-1-Ee,Ee,0,-1,2,_e),Te=Sn(ne,1,1-Ee,2+Ee,0,-1,2,_e);return(ye||Te)&&(ve=Sn(ne,1,-Ee,1+Ee,0,-1,2,_e)||[],ye&&(ve=Vn(ye,1).concat(ve)),Te&&(ve=ve.concat(Vn(Te,-1)))),ve}(ie,N),ie.length&&this.splitTile(ie,0,0,0),H&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Hr(re,N,H){return 32*((1<<re)*H+N)+re}function Wr(re,N){const H=re.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const ie=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!ie)return N(null,null);const ne=new ae(ie.features);let _e=J.exports(ne);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),N(null,{vectorTile:ne,rawData:_e.buffer})}gr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gr.prototype.splitTile=function(re,N,H,ie,ne,_e,Ee){for(var ve=[re,N,H,ie],ye=this.options,Te=ye.debug;ve.length;){ie=ve.pop(),H=ve.pop(),N=ve.pop(),re=ve.pop();var He=1<<N,st=Hr(N,H,ie),Ze=this.tiles[st];if(!Ze&&(Te>1&&console.time("creation"),Ze=this.tiles[st]=On(re,N,H,ie,ye),this.tileCoords.push({z:N,x:H,y:ie}),Te)){Te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,H,ie,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));var Rt="z"+N;this.stats[Rt]=(this.stats[Rt]||0)+1,this.total++}if(Ze.source=re,ne){if(N===ye.maxZoom||N===ne)continue;var Ft=1<<ne-N;if(H!==Math.floor(_e/Ft)||ie!==Math.floor(Ee/Ft))continue}else if(N===ye.indexMaxZoom||Ze.numPoints<=ye.indexMaxPoints)continue;if(Ze.source=null,re.length!==0){Te>1&&console.time("clipping");var Pt,Qt,ii,wi,ni,ui,ki=.5*ye.buffer/ye.extent,Oi=.5-ki,yn=.5+ki,Wi=1+ki;Pt=Qt=ii=wi=null,ni=Sn(re,He,H-ki,H+yn,0,Ze.minX,Ze.maxX,ye),ui=Sn(re,He,H+Oi,H+Wi,0,Ze.minX,Ze.maxX,ye),re=null,ni&&(Pt=Sn(ni,He,ie-ki,ie+yn,1,Ze.minY,Ze.maxY,ye),Qt=Sn(ni,He,ie+Oi,ie+Wi,1,Ze.minY,Ze.maxY,ye),ni=null),ui&&(ii=Sn(ui,He,ie-ki,ie+yn,1,Ze.minY,Ze.maxY,ye),wi=Sn(ui,He,ie+Oi,ie+Wi,1,Ze.minY,Ze.maxY,ye),ui=null),Te>1&&console.timeEnd("clipping"),ve.push(Pt||[],N+1,2*H,2*ie),ve.push(Qt||[],N+1,2*H,2*ie+1),ve.push(ii||[],N+1,2*H+1,2*ie),ve.push(wi||[],N+1,2*H+1,2*ie+1)}}},gr.prototype.getTile=function(re,N,H){var ie=this.options,ne=ie.extent,_e=ie.debug;if(re<0||re>24)return null;var Ee=1<<re,ve=Hr(re,N=(N%Ee+Ee)%Ee,H);if(this.tiles[ve])return gs(this.tiles[ve],ne);_e>1&&console.log("drilling down to z%d-%d-%d",re,N,H);for(var ye,Te=re,He=N,st=H;!ye&&Te>0;)Te--,He=Math.floor(He/2),st=Math.floor(st/2),ye=this.tiles[Hr(Te,He,st)];return ye&&ye.source?(_e>1&&console.log("found parent tile z%d-%d-%d",Te,He,st),_e>1&&console.time("drilling down"),this.splitTile(ye.source,Te,He,st,re,N,H),_e>1&&console.timeEnd("drilling down"),this.tiles[ve]?gs(this.tiles[ve],ne):null):null};class ys extends C{constructor(N,H,ie,ne){super(N,H,ie,Wr),ne&&(this.loadGeoJSON=ne)}loadData(N,H){var ie;(ie=this._pendingRequest)===null||ie===void 0||ie.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const ne=!!(N&&N.request&&N.request.collectResourceTiming)&&new n.RequestPerformance(N.request);this._pendingCallback=H,this._pendingRequest=this.loadGeoJSON(N,(_e,Ee)=>{if(delete this._pendingCallback,delete this._pendingRequest,_e||!Ee)return H(_e);if(typeof Ee!="object")return H(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{B(Ee,!0);try{if(N.filter){const ye=n.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(He=>`${He.key}: ${He.message}`).join(", "));Ee={type:"FeatureCollection",features:Ee.features.filter(He=>ye.value.evaluate({zoom:0},He))}}this._geoJSONIndex=N.cluster?new j(function({superclusterOptions:ye,clusterProperties:Te}){if(!Te||!ye)return ye;const He={},st={},Ze={accumulated:null,zoom:0},Rt={properties:null},Ft=Object.keys(Te);for(const Pt of Ft){const[Qt,ii]=Te[Pt],wi=n.createExpression(ii),ni=n.createExpression(typeof Qt=="string"?[Qt,["accumulated"],["get",Pt]]:Qt);He[Pt]=wi.value,st[Pt]=ni.value}return ye.map=Pt=>{Rt.properties=Pt;const Qt={};for(const ii of Ft)Qt[ii]=He[ii].evaluate(Ze,Rt);return Qt},ye.reduce=(Pt,Qt)=>{Rt.properties=Qt;for(const ii of Ft)Ze.accumulated=Pt[ii],Pt[ii]=st[ii].evaluate(Ze,Rt)},ye}(N)).load(Ee.features):function(ye,Te){return new gr(ye,Te)}(Ee,N.geojsonVtOptions)}catch(ye){return H(ye)}this.loaded={};const ve={};if(ne){const ye=ne.finish();ye&&(ve.resourceTiming={},ve.resourceTiming[N.source]=JSON.parse(JSON.stringify(ye)))}H(null,ve)}})}reloadTile(N,H){const ie=this.loaded;return ie&&ie[N.uid]?super.reloadTile(N,H):this.loadTile(N,H)}loadGeoJSON(N,H){if(N.request)return n.getJSON(N.request,H);if(typeof N.data=="string")try{H(null,JSON.parse(N.data))}catch{H(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}else H(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(N,H){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),H()}getClusterExpansionZoom(N,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(ie){H(ie)}}getClusterChildren(N,H){try{H(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(ie){H(ie)}}getClusterLeaves(N,H){try{H(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(ie){H(ie)}}}class Xr{constructor(N){this.self=N,this.actor=new n.Actor(N,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:C,geojson:ys},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,ie)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=ie},this.self.registerRTLTextPlugin=H=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=H.applyArabicShaping,n.plugin.processBidirectionalText=H.processBidirectionalText,n.plugin.processStyledBidirectionalText=H.processStyledBidirectionalText}}setReferrer(N,H){this.referrer=H}setImages(N,H,ie){this.availableImages[N]=H;for(const ne in this.workerSources[N]){const _e=this.workerSources[N][ne];for(const Ee in _e)_e[Ee].availableImages=H}ie()}setLayers(N,H,ie){this.getLayerIndex(N).replace(H),ie()}updateLayers(N,H,ie){this.getLayerIndex(N).update(H.layers,H.removedIds),ie()}loadTile(N,H,ie){this.getWorkerSource(N,H.type,H.source).loadTile(H,ie)}loadDEMTile(N,H,ie){this.getDEMWorkerSource(N,H.source).loadTile(H,ie)}reloadTile(N,H,ie){this.getWorkerSource(N,H.type,H.source).reloadTile(H,ie)}abortTile(N,H,ie){this.getWorkerSource(N,H.type,H.source).abortTile(H,ie)}removeTile(N,H,ie){this.getWorkerSource(N,H.type,H.source).removeTile(H,ie)}removeDEMTile(N,H){this.getDEMWorkerSource(N,H.source).removeTile(H)}removeSource(N,H,ie){if(!this.workerSources[N]||!this.workerSources[N][H.type]||!this.workerSources[N][H.type][H.source])return;const ne=this.workerSources[N][H.type][H.source];delete this.workerSources[N][H.type][H.source],ne.removeSource!==void 0?ne.removeSource(H,ie):ie()}loadWorkerSource(N,H,ie){try{this.self.importScripts(H.url),ie()}catch(ne){ie(ne.toString())}}syncRTLPluginState(N,H,ie){try{n.plugin.setState(H);const ne=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const _e=n.plugin.isParsed();ie(_e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),_e)}}catch(ne){ie(ne.toString())}}getAvailableImages(N){let H=this.availableImages[N];return H||(H=[]),H}getLayerIndex(N){let H=this.layerIndexes[N];return H||(H=this.layerIndexes[N]=new w),H}getWorkerSource(N,H,ie){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][H]||(this.workerSources[N][H]={}),!this.workerSources[N][H][ie]){const ne={send:(_e,Ee,ve)=>{this.actor.send(_e,Ee,ve,N)}};this.workerSources[N][H][ie]=new this.workerSourceTypes[H](ne,this.getLayerIndex(N),this.getAvailableImages(N))}return this.workerSources[N][H][ie]}getDEMWorkerSource(N,H){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][H]||(this.demWorkerSources[N][H]=new z),this.demWorkerSources[N][H]}enforceCacheSizeLimit(N,H){n.enforceCacheSizeLimit(H)}}return n.isWorker()&&(self.worker=new Xr(self)),Xr}),f(["./shared"],function(n){var m=v;function v(g){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,y,k=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(k);try{y=new Worker(I),p=!0}catch{p=!1}return y&&y.terminate(),URL.revokeObjectURL(I),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var y=p.getContext("2d");if(!y)return!1;var k=y.getImageData(0,0,1,1);return k&&k.width===p.width}()?(w[a=t&&t.failIfMajorPerformanceCaveat]===void 0&&(w[a]=function(p){var y,k=function(I){var D=document.createElement("canvas"),L=Object.create(v.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=I,D.getContext("webgl",L)||D.getContext("experimental-webgl",L)}(p);if(!k)return!1;try{y=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!y||k.isContextLost())&&(k.shaderSource(y,"void main() {}"),k.compileShader(y),k.getShaderParameter(y,k.COMPILE_STATUS)===!0)}(a)),w[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(g)}var w={};function A(g,t){if(Array.isArray(g)){if(!Array.isArray(t)||g.length!==t.length)return!1;for(let a=0;a<g.length;a++)if(!A(g[a],t[a]))return!1;return!0}if(typeof g=="object"&&g!==null&&t!==null){if(typeof t!="object"||Object.keys(g).length!==Object.keys(t).length)return!1;for(const a in g)if(!A(g[a],t[a]))return!1;return!0}return g===t}v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class b{static testProp(t){if(!b.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in b.docStyle)return t[a];return t[0]}static create(t,a,p){const y=window.document.createElement(t);return a!==void 0&&(y.className=a),p&&p.appendChild(y),y}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){b.docStyle&&b.selectProp&&(b.userSelect=b.docStyle[b.selectProp],b.docStyle[b.selectProp]="none")}static enableDrag(){b.docStyle&&b.selectProp&&(b.docStyle[b.selectProp]=b.userSelect)}static setTransform(t,a){t.style[b.transformProp]=a}static addEventListener(t,a,p,y={}){t.addEventListener(a,p,"passive"in y?y:y.capture)}static removeEventListener(t,a,p,y={}){t.removeEventListener(a,p,"passive"in y?y:y.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",b.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",b.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",b.suppressClickInternal,!0)},0)}static mousePos(t,a){const p=t.getBoundingClientRect();return new n.pointGeometry(a.clientX-p.left-t.clientLeft,a.clientY-p.top-t.clientTop)}static touchPos(t,a){const p=t.getBoundingClientRect(),y=[];for(let k=0;k<a.length;k++)y.push(new n.pointGeometry(a[k].clientX-p.left-t.clientLeft,a[k].clientY-p.top-t.clientTop));return y}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}b.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,b.selectProp=b.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),b.transformProp=b.testProp(["transform","WebkitTransform"]);class E{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeSpriteURL(t,a,p){const y=function(k){const I=k.match(T);if(!I)throw new Error(`Unable to parse URL "${k}"`);return{protocol:I[1],authority:I[2],path:I[3]||"/",params:I[4]?I[4].split("&"):[]}}(t);return y.path+=`${a}${p}`,function(k){const I=k.params.length?`?${k.params.join("&")}`:"";return`${k.protocol}://${k.authority}${k.path}${I}`}(y)}setTransformRequest(t){this._transformRequestFn=t}}const T=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class C{constructor(t,a,p,y){this.context=t,this.format=p,this.texture=t.gl.createTexture(),this.update(a,y)}update(t,a,p){const{width:y,height:k}=t,I=!(this.size&&this.size[0]===y&&this.size[1]===k||p),{context:D}=this,{gl:L}=D;if(this.useMipmap=!!(a&&a.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!a||a.premultiply!==!1)),I)this.size=[y,k],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||n.isImageBitmap(t)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,t):L.texImage2D(L.TEXTURE_2D,0,this.format,y,k,0,this.format,L.UNSIGNED_BYTE,t.data);else{const{x:F,y:V}=p||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||n.isImageBitmap(t)?L.texSubImage2D(L.TEXTURE_2D,0,F,V,L.RGBA,L.UNSIGNED_BYTE,t):L.texSubImage2D(L.TEXTURE_2D,0,F,V,y,k,L.RGBA,L.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(t,a,p){const{context:y}=this,{gl:k}=y;k.bindTexture(k.TEXTURE_2D,this.texture),p!==k.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=k.LINEAR),t!==this.filter&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,t),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,p||t),this.filter=t),a!==this.wrap&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,a),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function z(g){const{userImage:t}=g;return!!(t&&t.render&&t.render())&&(g.data.replace(new Uint8Array(t.data.buffer)),!0)}class B extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:p}of this.requestors)this._notify(a,p);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let p=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(a.content,a)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,a){if(!t)return!0;let p=0;for(const y of t){if(y[0]<p||y[1]<y[0]||a<y[1])return!1;p=y[1]}return!0}_validateContent(t,a){return!(t&&(t.length!==4||t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,a){const p=this.images[t];if(p.data.width!==a.data.width||p.data.height!==a.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=p.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let p=!0;if(!this.isLoaded())for(const y of t)this.images[y]||(p=!1);this.isLoaded()||p?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const p={};for(const y of t){this.images[y]||this.fire(new n.Event("styleimagemissing",{id:y}));const k=this.images[y];k?p[y]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:!!(k.userImage&&k.userImage.render)}:n.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,p)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],p=this.getImage(t);if(!p)return null;if(a&&a.position.version===p.version)return a.position;if(a)a.position.version=p.version;else{const y={w:p.data.width+2,h:p.data.height+2,x:0,y:0},k=new n.ImagePosition(y,p);this.patterns[t]={bin:y,position:k}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new C(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const k in this.patterns)t.push(this.patterns[k].bin);const{w:a,h:p}=n.potpack(t),y=this.atlasImage;y.resize({width:a||1,height:p||1});for(const k in this.patterns){const{bin:I}=this.patterns[k],D=I.x+1,L=I.y+1,F=this.images[k].data,V=F.width,X=F.height;n.RGBAImage.copy(F,y,{x:0,y:0},{x:D,y:L},{width:V,height:X}),n.RGBAImage.copy(F,y,{x:0,y:X-1},{x:D,y:L-1},{width:V,height:1}),n.RGBAImage.copy(F,y,{x:0,y:0},{x:D,y:L+X},{width:V,height:1}),n.RGBAImage.copy(F,y,{x:V-1,y:0},{x:D-1,y:L},{width:1,height:X}),n.RGBAImage.copy(F,y,{x:0,y:0},{x:D+V,y:L},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const p=this.images[a];p||n.warnOnce(`Image with ID: "${a}" was not found`),z(p)&&this.updateImage(a,p)}}}const O=1e20;function W(g,t,a,p,y,k,I,D,L){for(let F=t;F<t+p;F++)q(g,a*k+F,k,y,I,D,L);for(let F=a;F<a+y;F++)q(g,F*k+t,1,p,I,D,L)}function q(g,t,a,p,y,k,I){k[0]=0,I[0]=-O,I[1]=O,y[0]=g[t];for(let D=1,L=0,F=0;D<p;D++){y[D]=g[t+D*a];const V=D*D;do{const X=k[L];F=(y[D]-y[X]+V-X*X)/(D-X)/2}while(F<=I[L]&&--L>-1);L++,k[L]=D,I[L]=F,I[L+1]=O}for(let D=0,L=0;D<p;D++){for(;I[L+1]<D;)L++;const F=k[L],V=D-F;g[t+D*a]=y[F]+V*V}}class Z{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t,a){const p=[];for(const y in t)for(const k of t[y])p.push({stack:y,id:k});n.asyncAll(p,({stack:y,id:k},I)=>{let D=this.entries[y];D||(D=this.entries[y]={glyphs:{},requests:{},ranges:{}});let L=D.glyphs[k];if(L!==void 0)return void I(null,{stack:y,id:k,glyph:L});if(L=this._tinySDF(D,y,k),L)return D.glyphs[k]=L,void I(null,{stack:y,id:k,glyph:L});const F=Math.floor(k/256);if(256*F>65535)return void I(new Error("glyphs > 65535 not supported"));if(D.ranges[F])return void I(null,{stack:y,id:k,glyph:L});let V=D.requests[F];V||(V=D.requests[F]=[],Z.loadGlyphRange(y,F,this.url,this.requestManager,(X,$)=>{if($){for(const ue in $)this._doesCharSupportLocalGlyph(+ue)||(D.glyphs[+ue]=$[+ue]);D.ranges[F]=!0}for(const ue of V)ue(X,$);delete D.requests[F]})),V.push((X,$)=>{X?I(X):$&&I(null,{stack:y,id:k,glyph:$[k]||null})})},(y,k)=>{if(y)a(y);else if(k){const I={};for(const{stack:D,id:L,glyph:F}of k)(I[D]||(I[D]={}))[L]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics};a(null,I)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(n.unicodeBlockLookup["CJK Unified Ideographs"](t)||n.unicodeBlockLookup["Hangul Syllables"](t)||n.unicodeBlockLookup.Hiragana(t)||n.unicodeBlockLookup.Katakana(t))}_tinySDF(t,a,p){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(p))return;let k=t.tinySDF;if(!k){let D="400";/bold/i.test(a)?D="900":/medium/i.test(a)?D="500":/light/i.test(a)&&(D="200"),k=t.tinySDF=new Z.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:y,fontWeight:D})}const I=k.draw(String.fromCharCode(p));return{id:p,bitmap:new n.AlphaImage({width:I.width||30,height:I.height||30},I.data),metrics:{width:I.glyphWidth||24,height:I.glyphHeight||24,left:I.glyphLeft||0,top:I.glyphTop-27||-8,advance:I.glyphAdvance||24}}}}Z.loadGlyphRange=function(g,t,a,p,y){const k=256*t,I=k+255,D=p.transformRequest(a.replace("{fontstack}",g).replace("{range}",`${k}-${I}`),n.ResourceType.Glyphs);n.getArrayBuffer(D,(L,F)=>{if(L)y(L);else if(F){const V={};for(const X of n.parseGlyphPbf(F))V[X.id]=X;y(null,V)}})},Z.TinySDF=class{constructor({fontSize:g=24,buffer:t=3,radius:a=8,cutoff:p=.25,fontFamily:y="sans-serif",fontWeight:k="normal",fontStyle:I="normal"}={}){this.buffer=t,this.cutoff=p,this.radius=a;const D=this.size=g+4*t,L=this._createCanvas(D),F=this.ctx=L.getContext("2d",{willReadFrequently:!0});F.font=`${I} ${k} ${g}px ${y}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(g){const t=document.createElement("canvas");return t.width=t.height=g,t}draw(g){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:p,actualBoundingBoxLeft:y,actualBoundingBoxRight:k}=this.ctx.measureText(g),I=Math.ceil(a),D=Math.min(this.size-this.buffer,Math.ceil(k-y)),L=Math.min(this.size-this.buffer,I+Math.ceil(p)),F=D+2*this.buffer,V=L+2*this.buffer,X=Math.max(F*V,0),$=new Uint8ClampedArray(X),ue={data:$,width:F,height:V,glyphWidth:D,glyphHeight:L,glyphTop:I,glyphLeft:0,glyphAdvance:t};if(D===0||L===0)return ue;const{ctx:se,buffer:le,gridInner:be,gridOuter:Ae}=this;se.clearRect(le,le,D,L),se.fillText(g,le,le+I);const ze=se.getImageData(le,le,D,L);Ae.fill(O,0,X),be.fill(0,0,X);for(let de=0;de<L;de++)for(let Ge=0;Ge<D;Ge++){const Le=ze.data[4*(de*D+Ge)+3]/255;if(Le===0)continue;const Ye=(de+le)*F+Ge+le;if(Le===1)Ae[Ye]=0,be[Ye]=O;else{const $e=.5-Le;Ae[Ye]=$e>0?$e*$e:0,be[Ye]=$e<0?$e*$e:0}}W(Ae,0,0,F,V,F,this.f,this.v,this.z),W(be,le,le,D,L,F,this.f,this.v,this.z);for(let de=0;de<X;de++){const Ge=Math.sqrt(Ae[de])-Math.sqrt(be[de]);$[de]=Math.round(255-255*(Ge/this.radius+this.cutoff))}return ue}};const ae=new n.Properties({anchor:new n.DataConstantProperty(n.spec.light.anchor),position:new class{constructor(){this.specification=n.spec.light.position}possiblyEvaluate(g,t){return n.sphericalToCartesian(g.expression.evaluate(t))}interpolate(g,t,a){return{x:n.number(g.x,t.x,a),y:n.number(g.y,t.y,a),z:n.number(g.z,t.z,a)}}},color:new n.DataConstantProperty(n.spec.light.color),intensity:new n.DataConstantProperty(n.spec.light.intensity)}),J="-transition";class he extends n.Evented{constructor(t){super(),this._transitionable=new n.Transitionable(ae),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(n.validateLight,t,a))for(const p in t){const y=t[p];p.endsWith(J)?this._transitionable.setTransition(p.slice(0,-J.length),y):this._transitionable.setValue(p,y)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,p){return(!p||p.validate!==!1)&&n.emitValidationErrors(this,t.call(n.validateStyle,n.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.spec})))}}class we{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const p=t.join(",")+String(a);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(t,a)),this.dashEntry[p]}getDashRanges(t,a,p){const y=[];let k=t.length%2==1?-t[t.length-1]*p:0,I=t[0]*p,D=!0;y.push({left:k,right:I,isDash:D,zeroLength:t[0]===0});let L=t[0];for(let F=1;F<t.length;F++){D=!D;const V=t[F];k=L*p,L+=V,I=L*p,y.push({left:k,right:I,isDash:D,zeroLength:V===0})}return y}addRoundDash(t,a,p){const y=a/2;for(let k=-p;k<=p;k++){const I=this.width*(this.nextRow+p+k);let D=0,L=t[D];for(let F=0;F<this.width;F++){F/L.right>1&&(L=t[++D]);const V=Math.abs(F-L.left),X=Math.abs(F-L.right),$=Math.min(V,X);let ue;const se=k/p*(y+1);if(L.isDash){const le=y-Math.abs(se);ue=Math.sqrt($*$+le*le)}else ue=y-Math.sqrt($*$+se*se);this.data[I+F]=Math.max(0,Math.min(255,ue+128))}}}addRegularDash(t){for(let D=t.length-1;D>=0;--D){const L=t[D],F=t[D+1];L.zeroLength?t.splice(D,1):F&&F.isDash===L.isDash&&(F.left=L.left,t.splice(D,1))}const a=t[0],p=t[t.length-1];a.isDash===p.isDash&&(a.left=p.left-this.width,p.right=a.right+this.width);const y=this.width*this.nextRow;let k=0,I=t[k];for(let D=0;D<this.width;D++){D/I.right>1&&(I=t[++k]);const L=Math.abs(D-I.left),F=Math.abs(D-I.right),V=Math.min(L,F);this.data[y+D]=Math.max(0,Math.min(255,(I.isDash?V:-V)+128))}}addDash(t,a){const p=a?7:0,y=2*p+1;if(this.nextRow+y>this.height)return n.warnOnce("LineAtlas out of space"),null;let k=0;for(let D=0;D<t.length;D++)k+=t[D];if(k!==0){const D=this.width/k,L=this.getDashRanges(t,this.width,D);a?this.addRoundDash(L,D,p):this.addRegularDash(L)}const I={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:k};return this.nextRow+=y,this.dirty=!0,I}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}class Se{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n.uniqueId();const p=this.workerPool.acquire(this.id);for(let y=0;y<p.length;y++){const k=new Se.Actor(p[y],a,this.id);k.name=`Worker ${y}`,this.actors.push(k)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a,p){n.asyncAll(this.actors,(y,k)=>{y.send(t,a,k)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ot(g,t,a){const p=function(y,k){if(y)return a(y);if(k){const I=n.pick(n.extend(k,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(I.vectorLayers=k.vector_layers,I.vectorLayerIds=I.vectorLayers.map(D=>D.id)),a(null,I)}};return g.url?n.getJSON(t.transformRequest(g.url,n.ResourceType.Source),p):n.exported.frame(()=>p(null,g))}Se.Actor=n.Actor;class oe{constructor(t,a,p){this.bounds=n.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),p=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*a),y=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*a),k=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*a),I=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*a);return t.x>=p&&t.x<k&&t.y>=y&&t.y<I}}class Ve extends n.Evented{constructor(t,a,p,y){if(super(),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(a,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ot(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new n.ErrorEvent(t)):a&&(n.extend(this,a),a.bounds&&(this.tileBounds=new oe(a.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}loadTile(t,a){const p=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(p,n.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function k(I,D){return delete t.request,t.aborted?a(null):I&&I.status!==404?a(I):(D&&D.resourceTiming&&(t.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&t.setExpiryData(D),t.loadVectorData(D,this.map.painter),n.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}y.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",y,k.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",y,k.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class K extends n.Evented{constructor(t,a,p,y){super(),this.id=t,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},a),n.extend(this,n.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ot(this._options,this.map._requestManager,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new n.ErrorEvent(t)):a&&(n.extend(this,a),a.bounds&&(this.tileBounds=new oe(a.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return n.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const p=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=n.getImage(this.map._requestManager.transformRequest(p,n.ResourceType.Tile),(y,k,I)=>{if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(y)t.state="errored",a(y);else if(k){this.map._refreshExpiredTiles&&t.setExpiryData(I);const D=this.map.painter.context,L=D.gl;t.texture=this.map.painter.getTileTexture(k.width),t.texture?t.texture.update(k,{useMipmap:!0}):(t.texture=new C(D,k,L.RGBA,{useMipmap:!0}),t.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),D.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax)),t.state="loaded",n.cacheEntryPossiblyAdded(this.dispatcher),a(null)}})}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}let Ke;class ht extends K{constructor(t,a,p,y){super(t,a,p,y),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,a){const p=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function y(k,I){k&&(t.state="errored",a(k)),I&&(t.dem=I,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",a(null))}t.request=n.getImage(this.map._requestManager.transformRequest(p,n.ResourceType.Tile),(function(k,I){if(delete t.request,t.aborted)t.state="unloaded",a(null);else if(k)t.state="errored",a(k);else if(I){this.map._refreshExpiredTiles&&t.setExpiryData(I),delete I.cacheControl,delete I.expires;const D=n.isImageBitmap(I)&&(Ke==null&&(Ke=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ke)?I:n.exported.getImageData(I,1),L={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:D,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",L,y.bind(this)))}}).bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const a=t.canonical,p=Math.pow(2,a.z),y=(a.x-1+p)%p,k=a.x===0?t.wrap-1:t.wrap,I=(a.x+1+p)%p,D=a.x+1===p?t.wrap+1:t.wrap,L={};return L[new n.OverscaledTileID(t.overscaledZ,k,a.z,y,a.y).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,D,a.z,I,a.y).key]={backfilled:!1},a.y>0&&(L[new n.OverscaledTileID(t.overscaledZ,k,a.z,y,a.y-1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,D,a.z,I,a.y-1).key]={backfilled:!1}),a.y+1<p&&(L[new n.OverscaledTileID(t.overscaledZ,k,a.z,y,a.y+1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,D,a.z,I,a.y+1).key]={backfilled:!1}),L}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class ct extends n.Evented{constructor(t,a,p,y){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(y),this._data=a.data,this._options=n.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const k=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*k,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*k,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:n.EXTENT,radius:(a.clusterRadius||50)*k,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},a),this}getClusterChildren(t,a){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},a),this}getClusterLeaves(t,a,p,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:a,offset:p},y),this}_updateWorkerData(t){const a=n.extend({},this.workerOptions),p=this._data;typeof p=="string"?(a.request=this.map._requestManager.transformRequest(n.exported.resolveURL(p),n.ResourceType.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(p),this._pendingLoads++,this.fire(new n.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,a,(y,k)=>{if(this._pendingLoads--,this._removed||k&&k.abandoned)return void this.fire(new n.Event("dataabort",{dataType:"source",sourceDataType:t}));let I=null;if(k&&k.resourceTiming&&k.resourceTiming[this.id]&&(I=k.resourceTiming[this.id].slice(0)),y)return void this.fire(new n.ErrorEvent(y));const D={dataType:"source",sourceDataType:t};this._collectResourceTiming&&I&&I.length>0&&n.extend(D,{resourceTiming:I}),this.fire(new n.Event("data",D))})}loaded(){return this._pendingLoads===0}loadTile(t,a){const p=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const y={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(p,y,(k,I)=>(delete t.request,t.unloadVectorData(),t.aborted?a(null):k?a(k):(t.loadVectorData(I,this.map.painter,p==="reloadTile"),a(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return n.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Zt=n.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qe extends n.Evented{constructor(t,a,p,y){super(),this.id=t,this.dispatcher=p,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=a}load(t,a){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,n.getImage(this.map._requestManager.transformRequest(this.url,n.ResourceType.Image),(p,y)=>{this._loaded=!0,p?this.fire(new n.ErrorEvent(p)):y&&(this.image=y,t&&(this.coordinates=t),a&&a(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const a=t.map(n.MercatorCoordinate.fromLngLat);this.tileID=function(y){let k=1/0,I=1/0,D=-1/0,L=-1/0;for(const $ of y)k=Math.min(k,$.x),I=Math.min(I,$.y),D=Math.max(D,$.x),L=Math.max(L,$.y);const F=Math.max(D-k,L-I),V=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),X=Math.pow(2,V);return new n.CanonicalTileID(V,Math.floor((k+D)/2*X),Math.floor((I+L)/2*X))}(a),this.minzoom=this.maxzoom=this.tileID.z;const p=a.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new n.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,n.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,n.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,n.EXTENT,n.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Zt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new C(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture)}}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ut extends Qe{constructor(t,a,p,y){super(t,a,p,y),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,n.ResourceType.Source).url);n.getVideo(this.urls,(a,p)=>{this._loaded=!0,a?this.fire(new n.ErrorEvent(a)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Zt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new C(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class je extends Qe{constructor(t,a,p,y){super(t,a,p,y),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(k=>!Array.isArray(k)||k.length!==2||k.some(I=>typeof I!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,p=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Zt.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new C(a,this.canvas,p.RGBA,{premultiply:!0});for(const y in this.tiles){const k=this.tiles[y];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Oe={vector:Ve,raster:K,"raster-dem":ht,geojson:ct,video:Ut,image:Qe,canvas:je};function Vt(g,t){const a=n.create();return n.translate(a,a,[1,1,0]),n.scale(a,a,[.5*g.width,.5*g.height,1]),n.multiply(a,a,g.calculatePosMatrix(t.toUnwrapped()))}function Et(g,t,a,p,y,k){const I=function(X,$,ue){if(X)for(const se of X){const le=$[se];if(le&&le.source===ue&&le.type==="fill-extrusion")return!0}else for(const se in $){const le=$[se];if(le.source===ue&&le.type==="fill-extrusion")return!0}return!1}(y&&y.layers,t,g.id),D=k.maxPitchScaleFactor(),L=g.tilesIn(p,D,I);L.sort(mt);const F=[];for(const X of L)F.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(t,a,g._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,y,k,D,Vt(g.transform,X.tileID))});const V=function(X){const $={},ue={};for(const se of X){const le=se.queryResults,be=se.wrappedTileID,Ae=ue[be]=ue[be]||{};for(const ze in le){const de=le[ze],Ge=Ae[ze]=Ae[ze]||{},Le=$[ze]=$[ze]||[];for(const Ye of de)Ge[Ye.featureIndex]||(Ge[Ye.featureIndex]=!0,Le.push(Ye))}}return $}(F);for(const X in V)V[X].forEach($=>{const ue=$.feature,se=g.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=se});return V}function mt(g,t){const a=g.tileID,p=t.tileID;return a.overscaledZ-p.overscaledZ||a.canonical.y-p.canonical.y||a.wrap-p.wrap||a.canonical.x-p.canonical.x}class bi{constructor(t,a){this.tileID=t,this.uid=n.uniqueId(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<n.exported.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(a=>t.saveTileTexture(a)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,a,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(y,k){const I={};if(!k)return I;for(const D of y){const L=D.layerIds.map(F=>k.getLayer(F)).filter(Boolean);if(L.length!==0){D.layers=L,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(F=>L.filter(V=>V.id===F)[0]));for(const F of L)I[F.id]=D}}return I}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const k=this.buckets[y];if(k instanceof n.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;k.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const k=this.buckets[y];if(k instanceof n.SymbolBucket&&k.hasRTLText){this.hasRTLText=!0,n.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const y in this.buckets){const k=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(y).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new n.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const p in this.buckets){const y=this.buckets[p];y.uploadPending()&&y.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new C(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new C(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,p,y,k,I,D,L,F,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:k,scale:I,tileSize:this.tileSize,pixelPosMatrix:V,transform:L,params:D,queryPadding:this.queryPadding*F},t,a,p):{}}querySourceFeatures(t,a){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),k=a?a.sourceLayer:"",I=y._geojsonTileLayer||y[k];if(!I)return;const D=n.createFilter(a&&a.filter),{z:L,x:F,y:V}=this.tileID.canonical,X={z:L,x:F,y:V};for(let $=0;$<I.length;$++){const ue=I.feature($);if(D.needGeometry){const be=n.toEvaluationFeature(ue,!0);if(!D.filter(new n.EvaluationParameters(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!D.filter(new n.EvaluationParameters(this.tileID.overscaledZ),ue))continue;const se=p.getId(ue,k),le=new n.GeoJSONFeature(ue,L,F,V,se);le.tile=X,t.push(le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const p=n.parseCacheControl(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(a)if(this.expirationTime<a)y=!0;else{const k=this.expirationTime-a;k?this.expirationTime=p+Math.max(k,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!a.style.hasLayer(y))continue;const k=this.buckets[y],I=k.layers[0].sourceLayer||"_geojsonTileLayer",D=p[I],L=t[I];if(!D||!L||Object.keys(L).length===0)continue;k.update(L,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=a&&a.style&&a.style.getLayer(y);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.exported.now()+t}setDependencies(t,a){const p={};for(const y of a)p[y]=!0;this.dependencies[t]=p}hasDependency(t,a){for(const p of t){const y=this.dependencies[p];if(y){for(const k of a)if(y[k])return!0}}return!1}}class zi{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,p){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const k={value:a,timeout:void 0};if(p!==void 0&&(k.timeout=setTimeout(()=>{this.remove(t,k)},p)),this.data[y].push(k),this.order.push(y),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const p=t.wrapped().key,y=a===void 0?0:this.data[p].indexOf(a),k=this.data[p][y];return this.data[p].splice(y,1),k.timeout&&clearTimeout(k.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(k.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const p in this.data)for(const y of this.data[p])t(y.value)||a.push(y);for(const p of a)this.remove(p.value.tileID,p)}}class si{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,p){const y=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},n.extend(this.stateChanges[t][y],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const k in this.state[t])k!==y&&(this.deletedStates[t][k]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const k in this.state[t][y])p[k]||(this.deletedStates[t][y][k]=null)}else for(const k in p)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][k]===null&&delete this.deletedStates[t][y][k]}removeFeatureState(t,a,p){if(this.deletedStates[t]===null)return;const y=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&a!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][p]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(p in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][p]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,a){const p=String(a),y=n.extend({},(this.state[t]||{})[p],(this.stateChanges[t]||{})[p]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const k=this.deletedStates[t][a];if(k===null)return{};for(const I in k)delete y[I]}return y}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const k={};for(const I in this.stateChanges[y])this.state[y][I]||(this.state[y][I]={}),n.extend(this.state[y][I],this.stateChanges[y][I]),k[I]=this.state[y][I];p[y]=k}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const k={};if(this.deletedStates[y]===null)for(const I in this.state[y])k[I]={},this.state[y][I]={};else for(const I in this.deletedStates[y]){if(this.deletedStates[y][I]===null)this.state[y][I]={};else for(const D of Object.keys(this.deletedStates[y][I]))delete this.state[y][I][D];k[I]=this.state[y][I]}p[y]=p[y]||{},n.extend(p[y],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const y in t)t[y].setFeatureState(p,a)}}class et extends n.Evented{constructor(t,a,p){super(),this.id=t,this.dispatcher=p,this.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(y,k,I,D){const L=new Oe[k.type](y,k,I,D);if(L.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${L.id}`);return n.bindAll(["load","abort","unload","serialize","prepare"],L),L}(t,a,p,this),this._tiles={},this._cache=new zi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new si}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a){return this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new n.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const p=this._tiles[a];p.upload(t),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(oi).map(t=>t.key)}getRenderableIds(t){const a=[];for(const p in this._tiles)this._isIdRenderable(p,t)&&a.push(this._tiles[p]);return t?a.sort((p,y)=>{const k=p.tileID,I=y.tileID,D=new n.pointGeometry(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),L=new n.pointGeometry(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-I.overscaledZ||L.y-D.y||L.x-D.x}).map(p=>p.tileID.key):a.map(p=>p.tileID).sort(oi).map(p=>p.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,a){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=a),this._loadTile(p,this._tileLoaded.bind(this,p,t,a)))}_tileLoaded(t,a,p,y){if(y)return t.state="errored",void(y.status!==404?this._source.fire(new n.ErrorEvent(y,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=n.exported.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new n.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let y=0;y<a.length;y++){const k=a[y];if(t.neighboringTiles&&t.neighboringTiles[k]){const I=this.getTileByID(k);p(t,I),p(I,t)}}function p(y,k){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let I=k.tileID.canonical.x-y.tileID.canonical.x;const D=k.tileID.canonical.y-y.tileID.canonical.y,L=Math.pow(2,y.tileID.canonical.z),F=k.tileID.key;I===0&&D===0||Math.abs(D)>1||(Math.abs(I)>1&&(Math.abs(I+L)===1?I+=L:Math.abs(I-L)===1&&(I-=L)),k.dem&&y.dem&&(y.dem.backfillBorder(k.dem,I,D),y.neighboringTiles&&y.neighboringTiles[F]&&(y.neighboringTiles[F].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,p,y){for(const k in this._tiles){let I=this._tiles[k];if(y[k]||!I.hasData()||I.tileID.overscaledZ<=a||I.tileID.overscaledZ>p)continue;let D=I.tileID;for(;I&&I.tileID.overscaledZ>a+1;){const F=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[F.key],I&&I.hasData()&&(D=F)}let L=D;for(;L.overscaledZ>a;)if(L=L.scaledTo(L.overscaledZ-1),t[L.key]){y[D.key]=D;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=a?p:null}for(let p=t.overscaledZ-1;p>=a;p--){const y=t.scaledTo(p),k=this._getLoadedTile(y);if(k)return k}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,p=Math.ceil(t.height/this._source.tileSize)+1,y=Math.floor(a*p*5),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(k)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const p={};for(const y in this._tiles){const k=this._tiles[y];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+a),p[k.tileID.key]=k}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}update(t,a){if(this.transform=t,this.terrain=a,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new n.OverscaledTileID(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(p=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(p=p.filter(F=>this._source.hasTile(F)))):p=[];const y=t.coveringZoomLevel(this._source),k=Math.max(y-et.maxOverzooming,this._source.minzoom),I=Math.max(y+et.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const V of p)if(V.canonical.z>this._source.minzoom){const X=V.scaledTo(V.canonical.z-1);F[X.key]=X;const $=V.scaledTo(Math.max(this._source.minzoom,Math.min(V.canonical.z,5)));F[$.key]=$}p=p.concat(Object.values(F))}const D=this._updateRetainedTiles(p,y);if(mi(this._source.type)){const F={},V={},X=Object.keys(D);for(const $ of X){const ue=D[$],se=this._tiles[$];if(!se||se.fadeEndTime&&se.fadeEndTime<=n.exported.now())continue;const le=this.findLoadedParent(ue,k);le&&(this._addTile(le.tileID),F[le.tileID.key]=le.tileID),V[$]=ue}this._retainLoadedChildren(V,y,I,D);for(const $ in F)D[$]||(this._coveredTiles[$]=!0,D[$]=F[$]);if(a){const $={},ue={};for(const se of p)this._tiles[se.key].hasData()?$[se.key]=se:ue[se.key]=se;for(const se in ue){const le=ue[se].children(this._source.maxzoom);this._tiles[le[0].key]&&this._tiles[le[1].key]&&this._tiles[le[2].key]&&this._tiles[le[3].key]&&($[le[0].key]=D[le[0].key]=le[0],$[le[1].key]=D[le[1].key]=le[1],$[le[2].key]=D[le[2].key]=le[2],$[le[3].key]=D[le[3].key]=le[3],delete ue[se])}for(const se in ue){const le=this.findLoadedParent(ue[se],this._source.minzoom);if(le){$[le.tileID.key]=D[le.tileID.key]=le.tileID;for(const be in $)$[be].isChildOf(le.tileID)&&delete $[be]}}for(const se in this._tiles)$[se]||(this._coveredTiles[se]=!0)}}for(const F in D)this._tiles[F].clearFadeHold();const L=n.keysDifference(this._tiles,D);for(const F of L){const V=this._tiles[F];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){const p={},y={},k=Math.max(a-et.maxOverzooming,this._source.minzoom),I=Math.max(a+et.maxUnderzooming,this._source.minzoom),D={};for(const L of t){const F=this._addTile(L);p[L.key]=L,F.hasData()||a<this._source.maxzoom&&(D[L.key]=L)}this._retainLoadedChildren(D,a,I,p);for(const L of t){let F=this._tiles[L.key];if(F.hasData())continue;if(a+1>this._source.maxzoom){const X=L.children(this._source.maxzoom)[0],$=this.getTile(X);if($&&$.hasData()){p[X.key]=X;continue}}else{const X=L.children(this._source.maxzoom);if(p[X[0].key]&&p[X[1].key]&&p[X[2].key]&&p[X[3].key])continue}let V=F.wasRequested();for(let X=L.overscaledZ-1;X>=k;--X){const $=L.scaledTo(X);if(y[$.key]||(y[$.key]=!0,F=this.getTile($),!F&&V&&(F=this._addTile($)),F&&(p[$.key]=$,V=F.wasRequested(),F.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let p,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}a.push(y.key);const k=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(k),p)break;y=k}for(const k of a)this._loadedParentTiles[k]=p}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const p=a;return a||(a=new bi(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))),a.uses++,this._tiles[t.key]=a,p||this._source.fire(new n.Event("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=a.getExpiryTimeout();p&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},p))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,p){const y=[],k=this.transform;if(!k)return y;const I=p?k.getCameraQueryGeometry(t):t,D=t.map(se=>k.pointCoordinate(se,this.terrain)),L=I.map(se=>k.pointCoordinate(se,this.terrain)),F=this.getIds();let V=1/0,X=1/0,$=-1/0,ue=-1/0;for(const se of L)V=Math.min(V,se.x),X=Math.min(X,se.y),$=Math.max($,se.x),ue=Math.max(ue,se.y);for(let se=0;se<F.length;se++){const le=this._tiles[F[se]];if(le.holdingForFade())continue;const be=le.tileID,Ae=Math.pow(2,k.zoom-le.tileID.overscaledZ),ze=a*le.queryPadding*n.EXTENT/le.tileSize/Ae,de=[be.getTilePoint(new n.MercatorCoordinate(V,X)),be.getTilePoint(new n.MercatorCoordinate($,ue))];if(de[0].x-ze<n.EXTENT&&de[0].y-ze<n.EXTENT&&de[1].x+ze>=0&&de[1].y+ze>=0){const Ge=D.map(Ye=>be.getTilePoint(Ye)),Le=L.map(Ye=>be.getTilePoint(Ye));y.push({tile:le,tileID:be,queryGeometry:Ge,cameraQueryGeometry:Le,scale:Ae})}}return y}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(p=>this._tiles[p].tileID);for(const p of a)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(mi(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=n.exported.now())return!0}return!1}setFeatureState(t,a,p){this._state.updateState(t=t||"_geojsonTileLayer",a,p)}removeFeatureState(t,a,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,p)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,p){const y=this._tiles[t];y&&y.setDependencies(a,p)}reloadTilesForDependencies(t,a){for(const p in this._tiles)this._tiles[p].hasDependency(t,a)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(t,a))}}function oi(g,t){const a=Math.abs(2*g.wrap)-+(g.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return g.overscaledZ-t.overscaledZ||p-a||t.canonical.y-g.canonical.y||t.canonical.x-g.canonical.x}function mi(g){return g==="raster"||g==="image"||g==="video"}et.maxOverzooming=10,et.maxUnderzooming=3;const tn="mapboxgl_preloaded_worker_pool";class Hi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Hi.workerCount;)this.workers.push(new Worker($r.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tn]}numActive(){return Object.keys(this.active).length}}const j=Math.floor(n.exported.hardwareConcurrency/2);let nt;function Je(){return nt||(nt=new Hi),nt}function me(g,t){const a={};for(const p in g)p!=="ref"&&(a[p]=g[p]);return n.refProperties.forEach(p=>{p in t&&(a[p]=t[p])}),a}function ce(g){g=g.slice();const t=Object.create(null);for(let a=0;a<g.length;a++)t[g[a].id]=g[a];for(let a=0;a<g.length;a++)"ref"in g[a]&&(g[a]=me(g[a],t[g[a].ref]));return g}Hi.workerCount=Math.max(Math.min(j,6),1);const xe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function rt(g,t,a){a.push({command:xe.addSource,args:[g,t[g]]})}function at(g,t,a){t.push({command:xe.removeSource,args:[g]}),a[g]=!0}function Ue(g,t,a,p){at(g,a,p),rt(g,t,a)}function _t(g,t,a){let p;for(p in g[a])if(Object.prototype.hasOwnProperty.call(g[a],p)&&p!=="data"&&!A(g[a][p],t[a][p]))return!1;for(p in t[a])if(Object.prototype.hasOwnProperty.call(t[a],p)&&p!=="data"&&!A(g[a][p],t[a][p]))return!1;return!0}function Mt(g,t,a,p,y,k){let I;for(I in t=t||{},g=g||{})Object.prototype.hasOwnProperty.call(g,I)&&(A(g[I],t[I])||a.push({command:k,args:[p,I,t[I],y]}));for(I in t)Object.prototype.hasOwnProperty.call(t,I)&&!Object.prototype.hasOwnProperty.call(g,I)&&(A(g[I],t[I])||a.push({command:k,args:[p,I,t[I],y]}))}function gt(g){return g.id}function Xt(g,t){return g[t.id]=t,g}class xi{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.clamp(t,0,1);let a=1,p=this._distances[a];const y=t*this.paddedLength+this.padding;for(;p<y&&a<this._distances.length;)p=this._distances[++a];const k=a-1,I=this._distances[k],D=p-I,L=D>0?(y-I)/D:0;return this.points[k].mult(1-L).add(this.points[a].mult(L))}}function Me(g,t){let a=!0;return g==="always"||g!=="never"&&t!=="never"||(a=!1),a}class pt{constructor(t,a,p){const y=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(a/p);for(let I=0;I<this.xCellCount*this.yCellCount;I++)y.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,p,y,k){this._forEachCell(a,p,y,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(k)}insertCircle(t,a,p,y){this._forEachCell(a-y,p-y,a+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(p),this.circles.push(y)}_insertBoxCell(t,a,p,y,k,I){this.boxCells[k].push(I)}_insertCircleCell(t,a,p,y,k,I){this.circleCells[k].push(I)}_query(t,a,p,y,k,I,D){if(p<0||t>this.width||y<0||a>this.height)return[];const L=[];if(t<=0&&a<=0&&this.width<=p&&this.height<=y){if(k)return[{key:null,x1:t,y1:a,x2:p,y2:y}];for(let F=0;F<this.boxKeys.length;F++)L.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],X=this.circles[3*F+1],$=this.circles[3*F+2];L.push({key:this.circleKeys[F],x1:V-$,y1:X-$,x2:V+$,y2:X+$})}}else this._forEachCell(t,a,p,y,this._queryCell,L,{hitTest:k,overlapMode:I,seenUids:{box:{},circle:{}}},D);return L}query(t,a,p,y){return this._query(t,a,p,y,!1,null)}hitTest(t,a,p,y,k,I){return this._query(t,a,p,y,!0,k,I).length>0}hitTestCircle(t,a,p,y,k){const I=t-p,D=t+p,L=a-p,F=a+p;if(D<0||I>this.width||F<0||L>this.height)return!1;const V=[];return this._forEachCell(I,L,D,F,this._queryCellCircle,V,{hitTest:!0,overlapMode:y,circle:{x:t,y:a,radius:p},seenUids:{box:{},circle:{}}},k),V.length>0}_queryCell(t,a,p,y,k,I,D,L){const{seenUids:F,hitTest:V,overlapMode:X}=D,$=this.boxCells[k];if($!==null){const se=this.bboxes;for(const le of $)if(!F.box[le]){F.box[le]=!0;const be=4*le,Ae=this.boxKeys[le];if(t<=se[be+2]&&a<=se[be+3]&&p>=se[be+0]&&y>=se[be+1]&&(!L||L(Ae))&&(!V||!Me(X,Ae.overlapMode))&&(I.push({key:Ae,x1:se[be],y1:se[be+1],x2:se[be+2],y2:se[be+3]}),V))return!0}}const ue=this.circleCells[k];if(ue!==null){const se=this.circles;for(const le of ue)if(!F.circle[le]){F.circle[le]=!0;const be=3*le,Ae=this.circleKeys[le];if(this._circleAndRectCollide(se[be],se[be+1],se[be+2],t,a,p,y)&&(!L||L(Ae))&&(!V||!Me(X,Ae.overlapMode))){const ze=se[be],de=se[be+1],Ge=se[be+2];if(I.push({key:Ae,x1:ze-Ge,y1:de-Ge,x2:ze+Ge,y2:de+Ge}),V)return!0}}}return!1}_queryCellCircle(t,a,p,y,k,I,D,L){const{circle:F,seenUids:V,overlapMode:X}=D,$=this.boxCells[k];if($!==null){const se=this.bboxes;for(const le of $)if(!V.box[le]){V.box[le]=!0;const be=4*le,Ae=this.boxKeys[le];if(this._circleAndRectCollide(F.x,F.y,F.radius,se[be+0],se[be+1],se[be+2],se[be+3])&&(!L||L(Ae))&&!Me(X,Ae.overlapMode))return I.push(!0),!0}}const ue=this.circleCells[k];if(ue!==null){const se=this.circles;for(const le of ue)if(!V.circle[le]){V.circle[le]=!0;const be=3*le,Ae=this.circleKeys[le];if(this._circlesCollide(se[be],se[be+1],se[be+2],F.x,F.y,F.radius)&&(!L||L(Ae))&&!Me(X,Ae.overlapMode))return I.push(!0),!0}}}_forEachCell(t,a,p,y,k,I,D,L){const F=this._convertToXCellCoord(t),V=this._convertToYCellCoord(a),X=this._convertToXCellCoord(p),$=this._convertToYCellCoord(y);for(let ue=F;ue<=X;ue++)for(let se=V;se<=$;se++)if(k.call(this,t,a,p,y,this.xCellCount*se+ue,I,D,L))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,p,y,k,I){const D=y-t,L=k-a,F=p+I;return F*F>D*D+L*L}_circleAndRectCollide(t,a,p,y,k,I,D){const L=(I-y)/2,F=Math.abs(t-(y+L));if(F>L+p)return!1;const V=(D-k)/2,X=Math.abs(a-(k+V));if(X>V+p)return!1;if(F<=L||X<=V)return!0;const $=F-L,ue=X-V;return $*$+ue*ue<=p*p}}function Wn(g,t,a,p,y){const k=n.create();return t?(n.scale(k,k,[1/y,1/y,1]),a||n.rotateZ(k,k,p.angle)):n.multiply(k,p.labelPlaneMatrix,g),k}function nn(g,t,a,p,y){if(t){const k=n.clone(g);return n.scale(k,k,[y,y,1]),a||n.rotateZ(k,k,-p.angle),k}return p.glCoordMatrix}function di(g,t,a){let p;a?(p=[g.x,g.y,a(g.x,g.y),1],n.transformMat4(p,p,t)):(p=[g.x,g.y,0,1],Vn(p,p,t));const y=p[3];return{point:new n.pointGeometry(p[0]/y,p[1]/y),signedDistanceFromCamera:y}}function Ei(g,t){return .5+g/t*.5}function mn(g,t){const a=g[0]/g[3],p=g[1]/g[3];return a>=-t[0]&&a<=t[0]&&p>=-t[1]&&p<=t[1]}function Sn(g,t,a,p,y,k,I,D,L,F){const V=p?g.textSizeData:g.iconSizeData,X=n.evaluateSizeForZoom(V,a.transform.zoom),$=[256/a.width*2+1,256/a.height*2+1],ue=p?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ue.clear();const se=g.lineVertexArray,le=p?g.text.placedSymbolArray:g.icon.placedSymbolArray,be=a.transform.width/a.transform.height;let Ae=!1;for(let ze=0;ze<le.length;ze++){const de=le.get(ze);if(de.hidden||de.writingMode===n.WritingMode.vertical&&!Ae){ti(de.numGlyphs,ue);continue}let Ge;if(Ae=!1,F?(Ge=[de.anchorX,de.anchorY,F(de.anchorX,de.anchorY),1],n.transformMat4(Ge,Ge,t)):(Ge=[de.anchorX,de.anchorY,0,1],Vn(Ge,Ge,t)),!mn(Ge,$)){ti(de.numGlyphs,ue);continue}const Le=Ei(a.transform.cameraToCenterDistance,Ge[3]),Ye=n.evaluateSizeForFeature(V,X,de),$e=I?Ye/Le:Ye*Le,lt=new n.pointGeometry(de.anchorX,de.anchorY),We=di(lt,y,F).point,zt={},kt=li(de,$e,!1,D,t,y,k,g.glyphOffsetArray,se,ue,We,lt,zt,be,L,F);Ae=kt.useVertical,(kt.notEnoughRoom||Ae||kt.needsFlipping&&li(de,$e,!0,D,t,y,k,g.glyphOffsetArray,se,ue,We,lt,zt,be,L,F).notEnoughRoom)&&ti(de.numGlyphs,ue)}p?g.text.dynamicLayoutVertexBuffer.updateData(ue):g.icon.dynamicLayoutVertexBuffer.updateData(ue)}function gn(g,t,a,p,y,k,I,D,L,F,V,X,$){const ue=D.glyphStartIndex+D.numGlyphs,se=D.lineStartIndex,le=D.lineStartIndex+D.lineLength,be=t.getoffsetX(D.glyphStartIndex),Ae=t.getoffsetX(ue-1),ze=hn(g*be,a,p,y,k,I,D.segment,se,le,L,F,V,X,$);if(!ze)return null;const de=hn(g*Ae,a,p,y,k,I,D.segment,se,le,L,F,V,X,$);return de?{first:ze,last:de}:null}function bt(g,t,a,p){return g===n.WritingMode.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*p?{useVertical:!0}:(g===n.WritingMode.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function li(g,t,a,p,y,k,I,D,L,F,V,X,$,ue,se,le){const be=t/24,Ae=g.lineOffsetX*be,ze=g.lineOffsetY*be;let de;if(g.numGlyphs>1){const Ge=g.glyphStartIndex+g.numGlyphs,Le=g.lineStartIndex,Ye=g.lineStartIndex+g.lineLength,$e=gn(be,D,Ae,ze,a,V,X,g,L,k,$,se,le);if(!$e)return{notEnoughRoom:!0};const lt=di($e.first.point,I,le).point,We=di($e.last.point,I,le).point;if(p&&!a){const zt=bt(g.writingMode,lt,We,ue);if(zt)return zt}de=[$e.first];for(let zt=g.glyphStartIndex+1;zt<Ge-1;zt++)de.push(hn(be*D.getoffsetX(zt),Ae,ze,a,V,X,g.segment,Le,Ye,L,k,$,se,le));de.push($e.last)}else{if(p&&!a){const Le=di(X,y,le).point,Ye=g.lineStartIndex+g.segment+1,$e=new n.pointGeometry(L.getx(Ye),L.gety(Ye)),lt=di($e,y,le),We=lt.signedDistanceFromCamera>0?lt.point:ri(X,$e,Le,1,y,le),zt=bt(g.writingMode,Le,We,ue);if(zt)return zt}const Ge=hn(be*D.getoffsetX(g.glyphStartIndex),Ae,ze,a,V,X,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,L,k,$,se,le);if(!Ge)return{notEnoughRoom:!0};de=[Ge]}for(const Ge of de)n.addDynamicAttributes(F,Ge.point,Ge.angle);return{}}function ri(g,t,a,p,y,k){const I=di(g.add(g.sub(t)._unit()),y,k).point,D=a.sub(I);return a.add(D._mult(p/D.mag()))}function hn(g,t,a,p,y,k,I,D,L,F,V,X,$,ue){const se=p?g-t:g+t;let le=se>0?1:-1,be=0;p&&(le*=-1,be=Math.PI),le<0&&(be+=Math.PI);let Ae=le>0?D+I:D+I+1,ze=y,de=y,Ge=0,Le=0;const Ye=Math.abs(se),$e=[];for(;Ge+Le<=Ye;){if(Ae+=le,Ae<D||Ae>=L)return null;if(de=ze,$e.push(ze),ze=X[Ae],ze===void 0){const Dt=new n.pointGeometry(F.getx(Ae),F.gety(Ae)),ai=di(Dt,V,ue);if(ai.signedDistanceFromCamera>0)ze=X[Ae]=ai.point;else{const hi=Ae-le;ze=ri(Ge===0?k:new n.pointGeometry(F.getx(hi),F.gety(hi)),Dt,de,Ye-Ge+1,V,ue)}}Ge+=Le,Le=de.dist(ze)}const lt=(Ye-Ge)/Le,We=ze.sub(de),zt=We.mult(lt)._add(de);zt._add(We._unit()._perp()._mult(a*le));const kt=be+Math.atan2(ze.y-de.y,ze.x-de.x);return $e.push(zt),{point:zt,angle:$?kt:0,path:$e}}const ar=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ti(g,t){for(let a=0;a<g;a++){const p=t.length;t.resize(p+4),t.float32.set(ar,3*p)}}function Vn(g,t,a){const p=t[0],y=t[1];return g[0]=a[0]*p+a[4]*y+a[12],g[1]=a[1]*p+a[5]*y+a[13],g[3]=a[3]*p+a[7]*y+a[15],g}const _n=100;class gs{constructor(t,a=new pt(t.width+200,t.height+200,25),p=new pt(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+_n,this.screenBottomBoundary=t.height+_n,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,p,y,k,I){const D=this.projectAndGetPerspectiveRatio(y,t.anchorPointX,t.anchorPointY,I),L=p*D.perspectiveRatio,F=t.x1*L+D.point.x,V=t.y1*L+D.point.y,X=t.x2*L+D.point.x,$=t.y2*L+D.point.y;return!this.isInsideGrid(F,V,X,$)||a!=="always"&&this.grid.hitTest(F,V,X,$,a,k)||D.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,V,X,$],offscreen:this.isOffscreen(F,V,X,$)}}placeCollisionCircles(t,a,p,y,k,I,D,L,F,V,X,$,ue,se){const le=[],be=new n.pointGeometry(a.anchorX,a.anchorY),Ae=di(be,I,se),ze=Ei(this.transform.cameraToCenterDistance,Ae.signedDistanceFromCamera),de=(V?k/ze:k*ze)/n.ONE_EM,Ge=di(be,D,se).point,Le=gn(de,y,a.lineOffsetX*de,a.lineOffsetY*de,!1,Ge,be,a,p,D,{},!1,se);let Ye=!1,$e=!1,lt=!0;if(Le){const We=.5*$*ze+ue,zt=new n.pointGeometry(-100,-100),kt=new n.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Dt=new xi,ai=Le.first,hi=Le.last;let Ht=[];for(let vi=ai.path.length-1;vi>=1;vi--)Ht.push(ai.path[vi]);for(let vi=1;vi<hi.path.length;vi++)Ht.push(hi.path[vi]);const Mi=2.5*We;if(L){const vi=Ht.map(Si=>di(Si,L,se));Ht=vi.some(Si=>Si.signedDistanceFromCamera<=0)?[]:vi.map(Si=>Si.point)}let Di=[];if(Ht.length>0){const vi=Ht[0].clone(),Si=Ht[0].clone();for(let Ri=1;Ri<Ht.length;Ri++)vi.x=Math.min(vi.x,Ht[Ri].x),vi.y=Math.min(vi.y,Ht[Ri].y),Si.x=Math.max(Si.x,Ht[Ri].x),Si.y=Math.max(Si.y,Ht[Ri].y);Di=vi.x>=zt.x&&Si.x<=kt.x&&vi.y>=zt.y&&Si.y<=kt.y?[Ht]:Si.x<zt.x||vi.x>kt.x||Si.y<zt.y||vi.y>kt.y?[]:n.clipLine([Ht],zt.x,zt.y,kt.x,kt.y)}for(const vi of Di){Dt.reset(vi,.25*We);let Si=0;Si=Dt.length<=.5*We?1:Math.ceil(Dt.paddedLength/Mi)+1;for(let Ri=0;Ri<Si;Ri++){const vn=Ri/Math.max(Si-1,1),vr=Dt.lerp(vn),cr=vr.x+_n,br=vr.y+_n;le.push(cr,br,We,0);const Vr=cr-We,rr=br-We,jn=cr+We,Ar=br+We;if(lt=lt&&this.isOffscreen(Vr,rr,jn,Ar),$e=$e||this.isInsideGrid(Vr,rr,jn,Ar),t!=="always"&&this.grid.hitTestCircle(cr,br,We,t,X)&&(Ye=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Ye}}}}return{circles:!F&&Ye||!$e||ze<this.perspectiveRatioCutoff?[]:le,offscreen:lt,collisionDetected:Ye}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let p=1/0,y=1/0,k=-1/0,I=-1/0;for(const V of t){const X=new n.pointGeometry(V.x+_n,V.y+_n);p=Math.min(p,X.x),y=Math.min(y,X.y),k=Math.max(k,X.x),I=Math.max(I,X.y),a.push(X)}const D=this.grid.query(p,y,k,I).concat(this.ignoredGrid.query(p,y,k,I)),L={},F={};for(const V of D){const X=V.key;if(L[X.bucketInstanceId]===void 0&&(L[X.bucketInstanceId]={}),L[X.bucketInstanceId][X.featureIndex])continue;const $=[new n.pointGeometry(V.x1,V.y1),new n.pointGeometry(V.x2,V.y1),new n.pointGeometry(V.x2,V.y2),new n.pointGeometry(V.x1,V.y2)];n.polygonIntersectsPolygon(a,$)&&(L[X.bucketInstanceId][X.featureIndex]=!0,F[X.bucketInstanceId]===void 0&&(F[X.bucketInstanceId]=[]),F[X.bucketInstanceId].push(X.featureIndex))}return F}insertCollisionBox(t,a,p,y,k,I){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:k,collisionGroupID:I,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,p,y,k,I){const D=p?this.ignoredGrid:this.grid,L={bucketInstanceId:y,featureIndex:k,collisionGroupID:I,overlapMode:a};for(let F=0;F<t.length;F+=4)D.insertCircle(L,t[F],t[F+1],t[F+2])}projectAndGetPerspectiveRatio(t,a,p,y){let k;return y?(k=[a,p,y(a,p),1],n.transformMat4(k,k,t)):(k=[a,p,0,1],Vn(k,k,t)),{point:new n.pointGeometry((k[0]/k[3]+1)/2*this.transform.width+_n,(-k[1]/k[3]+1)/2*this.transform.height+_n),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k[3]*.5}}isOffscreen(t,a,p,y){return p<_n||t>=this.screenRightBoundary||y<_n||a>this.screenBottomBoundary}isInsideGrid(t,a,p,y){return p>=0&&t<this.gridRightBoundary&&y>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=n.identity([]);return n.translate(t,t,[-100,-100,0]),t}}function an(g,t,a){return t*(n.EXTENT/(g.tileSize*Math.pow(2,a-g.tileID.overscaledZ)))}class On{constructor(t,a,p,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Bi{constructor(t,a,p,y,k){this.text=new On(t?t.text:null,a,p,k),this.icon=new On(t?t.icon:null,a,y,k)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _s{constructor(t,a,p){this.text=t,this.icon=a,this.skipFade=p}}class gr{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class Hr{constructor(t,a,p,y,k){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=k}}class Wr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:p=>p.collisionGroupID===a}}return this.collisionGroups[t]}}function ys(g,t,a,p,y){const{horizontalAlign:k,verticalAlign:I}=n.getAnchorAlignment(g),D=-(k-.5)*t,L=-(I-.5)*a,F=n.evaluateVariableOffset(g,p);return new n.pointGeometry(D+F[0]*y,L+F[1]*y)}function Xr(g,t,a,p,y,k){const{x1:I,x2:D,y1:L,y2:F,anchorPointX:V,anchorPointY:X}=g,$=new n.pointGeometry(t,a);return p&&$._rotate(y?k:-k),{x1:I+$.x,y1:L+$.y,x2:D+$.x,y2:F+$.y,anchorPointX:V,anchorPointY:X}}class re{constructor(t,a,p,y,k){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new gs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Wr(y),this.collisionCircleArrays={},this.prevPlacement=k,k&&(k.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,p,y){const k=p.getBucket(a),I=p.latestFeatureIndex;if(!k||!I||a.id!==k.layerIds[0])return;const D=p.collisionBoxArray,L=k.layers[0].layout,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/n.EXTENT,X=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),$=L.get("text-pitch-alignment")==="map",ue=L.get("text-rotation-alignment")==="map",se=an(p,1,this.transform.zoom),le=Wn(X,$,ue,this.transform,se);let be=null;if($){const ze=nn(X,$,ue,this.transform,se);be=n.multiply([],this.transform.labelPlaneMatrix,ze)}this.retainedQueryData[k.bucketInstanceId]=new Hr(k.bucketInstanceId,I,k.sourceLayerIndex,k.index,p.tileID);const Ae={bucket:k,layout:L,posMatrix:X,textLabelPlaneMatrix:le,labelToScreenMatrix:be,scale:F,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(k.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(y)for(const ze of k.sortKeyRanges){const{sortKey:de,symbolInstanceStart:Ge,symbolInstanceEnd:Le}=ze;t.push({sortKey:de,symbolInstanceStart:Ge,symbolInstanceEnd:Le,parameters:Ae})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(t,a,p,y,k,I,D,L,F,V,X,$,ue,se,le,be){const Ae=[$.textOffset0,$.textOffset1],ze=ys(t,p,y,Ae,k),de=this.collisionIndex.placeCollisionBox(Xr(a,ze.x,ze.y,I,D,this.transform.angle),X,L,F,V.predicate,be);if((!le||this.collisionIndex.placeCollisionBox(Xr(le,ze.x,ze.y,I,D,this.transform.angle),X,L,F,V.predicate,be).box.length!==0)&&de.box.length>0){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Ae,width:p,height:y,anchor:t,textBoxScale:k,prevAnchor:Ge},this.markUsedJustification(ue,t,$,se),ue.allowVerticalPlacement&&(this.markUsedOrientation(ue,se,$),this.placedOrientations[$.crossTileID]=se),{shift:ze,placedGlyphBoxes:de}}}placeLayerBucketPart(t,a,p){const{bucket:y,layout:k,posMatrix:I,textLabelPlaneMatrix:D,labelToScreenMatrix:L,textPixelRatio:F,holdingForFade:V,collisionBoxArray:X,partiallyEvaluatedTextSize:$,collisionGroup:ue}=t.parameters,se=k.get("text-optional"),le=k.get("icon-optional"),be=n.getOverlapMode(k,"text-overlap","text-allow-overlap"),Ae=be==="always",ze=n.getOverlapMode(k,"icon-overlap","icon-allow-overlap"),de=ze==="always",Ge=k.get("text-rotation-alignment")==="map",Le=k.get("text-pitch-alignment")==="map",Ye=k.get("icon-text-fit")!=="none",$e=k.get("symbol-z-order")==="viewport-y",lt=Ae&&(de||!y.hasIconData()||le),We=de&&(Ae||!y.hasTextData()||se);!y.collisionArrays&&X&&y.deserializeCollisionBoxes(X);const zt=(kt,Dt)=>{if(a[kt.crossTileID])return;if(V)return void(this.placements[kt.crossTileID]=new _s(!1,!1,!1));let ai=!1,hi=!1,Ht=!0,Mi=null,Di={box:null,offscreen:null},vi={box:null,offscreen:null},Si=null,Ri=null,vn=null,vr=0,cr=0,br=0;Dt.textFeatureIndex?vr=Dt.textFeatureIndex:kt.useRuntimeCollisionCircles&&(vr=kt.featureIndex),Dt.verticalTextFeatureIndex&&(cr=Dt.verticalTextFeatureIndex);const Vr=this.retainedQueryData[y.bucketInstanceId].tileID,rr=this.terrain?(fn,pi)=>this.terrain.getElevation(Vr,fn,pi):null;for(const fn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const pi=Dt[fn];pi&&(pi.elevation=rr?rr(pi.anchorPointX,pi.anchorPointY):0)}const jn=Dt.textBox;if(jn){const fn=Ci=>{let bn=n.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Ci&&this.prevPlacement){const xn=this.prevPlacement.placedOrientations[kt.crossTileID];xn&&(this.placedOrientations[kt.crossTileID]=xn,bn=xn,this.markUsedOrientation(y,bn,kt))}return bn},pi=(Ci,bn)=>{if(y.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&Dt.verticalTextBox){for(const xn of y.writingModes)if(xn===n.WritingMode.vertical?(Di=bn(),vi=Di):Di=Ci(),Di&&Di.box&&Di.box.length)break}else Di=Ci()};if(k.get("text-variable-anchor")){let Ci=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[kt.crossTileID]){const Yi=this.prevPlacement.variableOffsets[kt.crossTileID];Ci.indexOf(Yi.anchor)>0&&(Ci=Ci.filter(sr=>sr!==Yi.anchor),Ci.unshift(Yi.anchor))}const bn=(Yi,sr,es)=>{const Ra=Yi.x2-Yi.x1,zs=Yi.y2-Yi.y1,ic=kt.textBoxScale,Oa=Ye&&ze==="never"?sr:null;let Gr={box:[],offscreen:!1};const ts=be!=="never"?2*Ci.length:Ci.length;for(let is=0;is<ts;++is){const Uo=this.attemptAnchorPlacement(Ci[is%Ci.length],Yi,Ra,zs,ic,Ge,Le,F,I,ue,is>=Ci.length?be:"never",kt,y,es,Oa,rr);if(Uo&&(Gr=Uo.placedGlyphBoxes,Gr&&Gr.box&&Gr.box.length)){ai=!0,Mi=Uo.shift;break}}return Gr};pi(()=>bn(jn,Dt.iconBox,n.WritingMode.horizontal),()=>{const Yi=Dt.verticalTextBox;return y.allowVerticalPlacement&&!(Di&&Di.box&&Di.box.length)&&kt.numVerticalGlyphVertices>0&&Yi?bn(Yi,Dt.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null}}),Di&&(ai=Di.box,Ht=Di.offscreen);const xn=fn(Di&&Di.box);if(!ai&&this.prevPlacement){const Yi=this.prevPlacement.variableOffsets[kt.crossTileID];Yi&&(this.variableOffsets[kt.crossTileID]=Yi,this.markUsedJustification(y,Yi.anchor,kt,xn))}}else{const Ci=(bn,xn)=>{const Yi=this.collisionIndex.placeCollisionBox(bn,be,F,I,ue.predicate,rr);return Yi&&Yi.box&&Yi.box.length&&(this.markUsedOrientation(y,xn,kt),this.placedOrientations[kt.crossTileID]=xn),Yi};pi(()=>Ci(jn,n.WritingMode.horizontal),()=>{const bn=Dt.verticalTextBox;return y.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&bn?Ci(bn,n.WritingMode.vertical):{box:null,offscreen:null}}),fn(Di&&Di.box&&Di.box.length)}}if(Si=Di,ai=Si&&Si.box&&Si.box.length>0,Ht=Si&&Si.offscreen,kt.useRuntimeCollisionCircles){const fn=y.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex),pi=n.evaluateSizeForFeature(y.textSizeData,$,fn),Ci=k.get("text-padding");Ri=this.collisionIndex.placeCollisionCircles(be,fn,y.lineVertexArray,y.glyphOffsetArray,pi,I,D,L,p,Le,ue.predicate,kt.collisionCircleDiameter,Ci,rr),Ri.circles.length&&Ri.collisionDetected&&!p&&n.warnOnce("Collisions detected, but collision boxes are not shown"),ai=Ae||Ri.circles.length>0&&!Ri.collisionDetected,Ht=Ht&&Ri.offscreen}if(Dt.iconFeatureIndex&&(br=Dt.iconFeatureIndex),Dt.iconBox){const fn=pi=>{const Ci=Ye&&Mi?Xr(pi,Mi.x,Mi.y,Ge,Le,this.transform.angle):pi;return this.collisionIndex.placeCollisionBox(Ci,ze,F,I,ue.predicate,rr)};vi&&vi.box&&vi.box.length&&Dt.verticalIconBox?(vn=fn(Dt.verticalIconBox),hi=vn.box.length>0):(vn=fn(Dt.iconBox),hi=vn.box.length>0),Ht=Ht&&vn.offscreen}const Ar=se||kt.numHorizontalGlyphVertices===0&&kt.numVerticalGlyphVertices===0,No=le||kt.numIconVertices===0;if(Ar||No?No?Ar||(hi=hi&&ai):ai=hi&&ai:hi=ai=hi&&ai,ai&&Si&&Si.box&&this.collisionIndex.insertCollisionBox(Si.box,be,k.get("text-ignore-placement"),y.bucketInstanceId,vi&&vi.box&&cr?cr:vr,ue.ID),hi&&vn&&this.collisionIndex.insertCollisionBox(vn.box,ze,k.get("icon-ignore-placement"),y.bucketInstanceId,br,ue.ID),Ri&&(ai&&this.collisionIndex.insertCollisionCircles(Ri.circles,be,k.get("text-ignore-placement"),y.bucketInstanceId,vr,ue.ID),p)){const fn=y.bucketInstanceId;let pi=this.collisionCircleArrays[fn];pi===void 0&&(pi=this.collisionCircleArrays[fn]=new gr);for(let Ci=0;Ci<Ri.circles.length;Ci+=4)pi.circles.push(Ri.circles[Ci+0]),pi.circles.push(Ri.circles[Ci+1]),pi.circles.push(Ri.circles[Ci+2]),pi.circles.push(Ri.collisionDetected?1:0)}if(kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[kt.crossTileID]=new _s(ai||lt,hi||We,Ht||y.justReloaded),a[kt.crossTileID]=!0};if($e){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const kt=y.getSortedSymbolIndexes(this.transform.angle);for(let Dt=kt.length-1;Dt>=0;--Dt){const ai=kt[Dt];zt(y.symbolInstances.get(ai),y.collisionArrays[ai])}}else for(let kt=t.symbolInstanceStart;kt<t.symbolInstanceEnd;kt++)zt(y.symbolInstances.get(kt),y.collisionArrays[kt]);if(p&&y.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[y.bucketInstanceId];n.invert(kt.invProjMatrix,I),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(t,a,p,y){let k;k=y===n.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[n.getAnchorJustification(a)];const I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const D of I)D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=k>=0&&D!==k?0:p.crossTileID)}markUsedOrientation(t,a,p){const y=a===n.WritingMode.horizontal||a===n.WritingMode.horizontalOnly?a:0,k=a===n.WritingMode.vertical?a:0,I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const D of I)t.text.placedSymbolArray.get(D).placedOrientation=y;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=k)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let p=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const y=a?a.symbolFadeChange(t):1,k=a?a.opacities:{},I=a?a.variableOffsets:{},D=a?a.placedOrientations:{};for(const L in this.placements){const F=this.placements[L],V=k[L];V?(this.opacities[L]=new Bi(V,y,F.text,F.icon),p=p||F.text!==V.text.placed||F.icon!==V.icon.placed):(this.opacities[L]=new Bi(null,y,F.text,F.icon,F.skipFade),p=p||F.text||F.icon)}for(const L in k){const F=k[L];if(!this.opacities[L]){const V=new Bi(F,y,!1,!1);V.isHidden()||(this.opacities[L]=V,p=p||F.text.placed||F.icon.placed)}}for(const L in I)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=I[L]);for(const L in D)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=D[L]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const p={};for(const y of a){const k=y.getBucket(t);k&&y.latestFeatureIndex&&t.id===k.layerIds[0]&&this.updateBucketOpacities(k,p,y.collisionBoxArray)}}updateBucketOpacities(t,a,p){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const y=t.layers[0].layout,k=new Bi(null,0,!1,!1,!0),I=y.get("text-allow-overlap"),D=y.get("icon-allow-overlap"),L=y.get("text-variable-anchor"),F=y.get("text-rotation-alignment")==="map",V=y.get("text-pitch-alignment")==="map",X=y.get("icon-text-fit")!=="none",$=new Bi(null,0,I&&(D||!t.hasIconData()||y.get("icon-optional")),D&&(I||!t.hasTextData()||y.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const ue=(se,le,be)=>{for(let Ae=0;Ae<le/4;Ae++)se.opacityVertexArray.emplaceBack(be)};for(let se=0;se<t.symbolInstances.length;se++){const le=t.symbolInstances.get(se),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:Ae,crossTileID:ze}=le;let de=this.opacities[ze];a[ze]?de=k:de||(de=$,this.opacities[ze]=de),a[ze]=!0;const Ge=le.numIconVertices>0,Le=this.placedOrientations[le.crossTileID],Ye=Le===n.WritingMode.vertical,$e=Le===n.WritingMode.horizontal||Le===n.WritingMode.horizontalOnly;if(be>0||Ae>0){const lt=Te(de.text);ue(t.text,be,Ye?He:lt),ue(t.text,Ae,$e?He:lt);const We=de.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(Dt=>{Dt>=0&&(t.text.placedSymbolArray.get(Dt).hidden=We||Ye?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=We||$e?1:0);const zt=this.variableOffsets[le.crossTileID];zt&&this.markUsedJustification(t,zt.anchor,le,Le);const kt=this.placedOrientations[le.crossTileID];kt&&(this.markUsedJustification(t,"left",le,kt),this.markUsedOrientation(t,kt,le))}if(Ge){const lt=Te(de.icon),We=!(X&&le.verticalPlacedIconSymbolIndex&&Ye);le.placedIconSymbolIndex>=0&&(ue(t.icon,le.numIconVertices,We?lt:He),t.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=de.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(ue(t.icon,le.numVerticalIconVertices,We?He:lt),t.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const lt=t.collisionArrays[se];if(lt){let We=new n.pointGeometry(0,0);if(lt.textBox||lt.verticalTextBox){let kt=!0;if(L){const Dt=this.variableOffsets[ze];Dt?(We=ys(Dt.anchor,Dt.width,Dt.height,Dt.textOffset,Dt.textBoxScale),F&&We._rotate(V?this.transform.angle:-this.transform.angle)):kt=!1}lt.textBox&&N(t.textCollisionBox.collisionVertexArray,de.text.placed,!kt||Ye,We.x,We.y),lt.verticalTextBox&&N(t.textCollisionBox.collisionVertexArray,de.text.placed,!kt||$e,We.x,We.y)}const zt=!!(!$e&&lt.verticalIconBox);lt.iconBox&&N(t.iconCollisionBox.collisionVertexArray,de.icon.placed,zt,X?We.x:0,X?We.y:0),lt.verticalIconBox&&N(t.iconCollisionBox.collisionVertexArray,de.icon.placed,!zt,X?We.x:0,X?We.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=se.invProjMatrix,t.placementViewportMatrix=se.viewportMatrix,t.collisionCircleArray=se.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const p=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function N(g,t,a,p,y){g.emplaceBack(t?1:0,a?1:0,p||0,y||0),g.emplaceBack(t?1:0,a?1:0,p||0,y||0),g.emplaceBack(t?1:0,a?1:0,p||0,y||0),g.emplaceBack(t?1:0,a?1:0,p||0,y||0)}const H=Math.pow(2,25),ie=Math.pow(2,24),ne=Math.pow(2,17),_e=Math.pow(2,16),Ee=Math.pow(2,9),ve=Math.pow(2,8),ye=Math.pow(2,1);function Te(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const t=g.placed?1:0,a=Math.floor(127*g.opacity);return a*H+t*ie+a*ne+t*_e+a*Ee+t*ve+a*ye+t}const He=0;class st{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,p,y,k){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(I,y,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((D,L)=>D.sortKey-L.sortKey));this._currentPartIndex<I.length;)if(a.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,k())return!0;return!1}}class Ze{constructor(t,a,p,y,k,I,D,L){this.placement=new re(t,a,I,D,L),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=k,this._done=!1}isDone(){return this._done}continuePlacement(t,a,p){const y=n.exported.now(),k=()=>{const I=n.exported.now()-y;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=a[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=D)&&(!I.maxzoom||I.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new st(I)),this._inProgressLayer.continuePlacement(p[I.source],this.placement,this._showCollisionBoxes,I,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Rt=512/n.EXTENT/2;class Ft{constructor(t,a,p){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let y=0;y<a.length;y++){const k=a.get(y),I=k.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:k.crossTileID,coord:this.getScaledCoordinates(k,t)})}}getScaledCoordinates(t,a){const p=Rt/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*n.EXTENT+t.anchorX)*p),y:Math.floor((a.canonical.y*n.EXTENT+t.anchorY)*p)}}findMatches(t,a,p){const y=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let k=0;k<t.length;k++){const I=t.get(k);if(I.crossTileID)continue;const D=this.indexedSymbolInstances[I.key];if(!D)continue;const L=this.getScaledCoordinates(I,a);for(const F of D)if(Math.abs(F.coord.x-L.x)<=y&&Math.abs(F.coord.y-L.y)<=y&&!p[F.crossTileID]){p[F.crossTileID]=!0,I.crossTileID=F.crossTileID;break}}}}class Pt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const p in this.indexes){const y=this.indexes[p],k={};for(const I in y){const D=y[I];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+a),k[D.tileID.key]=D}this.indexes[p]=k}this.lng=t}addBucket(t,a,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let k=0;k<a.symbolInstances.length;k++)a.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const y=this.usedCrossTileIDs[t.overscaledZ];for(const k in this.indexes){const I=this.indexes[k];if(Number(k)>t.overscaledZ)for(const D in I){const L=I[D];L.tileID.isChildOf(t)&&L.findMatches(a.symbolInstances,t,y)}else{const D=I[t.scaledTo(Number(k)).key];D&&D.findMatches(a.symbolInstances,t,y)}}for(let k=0;k<a.symbolInstances.length;k++){const I=a.symbolInstances.get(k);I.crossTileID||(I.crossTileID=p.generate(),y[I.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ft(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const p in a.indexedSymbolInstances)for(const y of a.indexedSymbolInstances[p])delete this.usedCrossTileIDs[t][y.crossTileID]}removeStaleBuckets(t){let a=!1;for(const p in this.indexes){const y=this.indexes[p];for(const k in y)t[y[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[k]),delete y[k],a=!0)}return a}}class ii{constructor(){this.layerIndexes={},this.crossTileIDs=new Pt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,p){let y=this.layerIndexes[t.id];y===void 0&&(y=this.layerIndexes[t.id]=new Qt);let k=!1;const I={};y.handleWrapJump(p);for(const D of a){const L=D.getBucket(t);L&&t.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(D.tileID,L,this.crossTileIDs)&&(k=!0),I[L.bucketInstanceId]=!0)}return y.removeStaleBuckets(I)&&(k=!0),k}pruneUnusedLayers(t){const a={};t.forEach(p=>{a[p]=!0});for(const p in this.layerIndexes)a[p]||delete this.layerIndexes[p]}}var wi=n.createLayout([{name:"a_pos",type:"Int16",components:2}]);class ni extends n.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const a=this._tiles[t];a.textures.forEach(p=>p.destroy()),a.textures=[]}}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];for(const p of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),n.ortho(p.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),this._tiles[p.key]=new bi(p,this.tileSize))}removeOutdated(t){const a={};this.renderHistory=this.renderHistory.filter((p,y)=>this.renderHistory.indexOf(p)===y).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)a[p]=!0;for(const p of this.renderHistory)a[p]=!0;for(const p in this._tiles)a[p]||(this._tiles[p].clearTextures(t),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const a={};for(const p of this._renderableTilesKeys){const y=this._tiles[p].tileID;if(y.canonical.equals(t.canonical)){const k=t.clone();k.posMatrix=new Float64Array(16),n.ortho(k.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),a[p]=k}else if(y.canonical.isChildOf(t.canonical)){const k=t.clone();k.posMatrix=new Float64Array(16);const I=y.canonical.z-t.canonical.z,D=y.canonical.x-(y.canonical.x>>I<<I),L=y.canonical.y-(y.canonical.y>>I<<I),F=n.EXTENT>>I;n.ortho(k.posMatrix,0,F,0,F,0,1),n.translate(k.posMatrix,k.posMatrix,[-D*F,-L*F,0]),a[p]=k}else if(t.canonical.isChildOf(y.canonical)){const k=t.clone();k.posMatrix=new Float64Array(16);const I=t.canonical.z-y.canonical.z,D=t.canonical.x-(t.canonical.x>>I<<I),L=t.canonical.y-(t.canonical.y>>I<<I),F=n.EXTENT>>I;n.ortho(k.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),n.translate(k.posMatrix,k.posMatrix,[D*F,L*F,0]),n.scale(k.posMatrix,k.posMatrix,[1/2**I,1/2**I,0]),a[p]=k}}return a}getSourceTile(t,a){const p=this.sourceCache._source;let y=t.overscaledZ-this.deltaZoom;if(y>p.maxzoom&&(y=p.maxzoom),y<p.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(y).key);let k=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!k||!k.dem)&&a)for(;y>=p.minzoom&&(!k||!k.dem);)k=this.sourceCache.getTileByID(t.scaledTo(y--).key);return k}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(a=>a.timeLoaded>=t)}}class ui{constructor(t,a,p){this.style=t,this.sourceCache=new ni(a),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,a,p,y=n.EXTENT){if(!(a>=0&&a<y&&p>=0&&p<y))return this.elevationOffset;let k=0;const I=this.getTerrainData(t);if(I.tile&&I.tile.dem){const D=n.transformMat4$1([],[a/y*n.EXTENT,p/y*n.EXTENT],I.u_terrain_matrix),L=[D[0]*I.tile.dem.dim,D[1]*I.tile.dem.dim],F=[Math.floor(L[0]),Math.floor(L[1])],V=I.tile.dem.get(F[0],F[1]),X=I.tile.dem.get(F[0],F[1]+1),$=I.tile.dem.get(F[0]+1,F[1]),ue=I.tile.dem.get(F[0]+1,F[1]+1);k=n.number(n.number(V,X,L[0]-F[0]),n.number($,ue,L[0]-F[0]),L[1]-F[1])}return k}rememberForRerender(t,a){for(const p in this.sourceCache._tiles){const y=this.sourceCache._tiles[p];(y.tileID.equals(a)||y.tileID.isChildOf(a))&&(t===this.sourceCache.sourceCache.id&&(y.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][y.tileID.key]=!0)}}needsRerender(t,a){return this._rerender[t]&&this._rerender[t][a.key]}clearRerenderCache(){this._rerender={}}getElevation(t,a,p,y=n.EXTENT){return(this.getDEMElevation(t,a,p,y)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const y=this.style.map.painter.context,k=new n.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new C(y,k,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new C(y,new n.RGBAImage({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=n.identity([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const y=this.style.map.painter.context;a.demTexture=this.style.map.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new C(y,a.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),a.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const p=a&&a+a.tileID.key+t.key;if(p&&!this._demMatrixCache[p]){const y=this.sourceCache.sourceCache._source.maxzoom;let k=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=y?k=t.canonical.z-y:n.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=t.canonical.x-(t.canonical.x>>k<<k),D=t.canonical.y-(t.canonical.y>>k<<k),L=n.fromScaling(new Float64Array(16),[1/(n.EXTENT<<k),1/(n.EXTENT<<k),0]);n.translate(L,L,[I*n.EXTENT,D*n.EXTENT,0]),this._demMatrixCache[t.key]={matrix:L,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const a=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(a,a,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,a,a))}return this._rttFramebuffer}getFramebuffer(t){const a=this.style.map.painter,p=a.width/devicePixelRatio,y=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new C(a.context,{width:p,height:y,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new C(a.context,{width:p,height:y,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(p,y,!0),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,p,y))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let k=0,I=0;k<this._coordsTextureSize;k++)for(let D=0;D<this._coordsTextureSize;D++,I+=4)a[I+0]=255&D,a[I+1]=255&k,a[I+2]=D>>8<<4|k>>8,a[I+3]=0;const p=new n.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),y=new C(t,p,t.gl.RGBA,{premultiply:!1});return y.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(t){const a=new Uint8Array(4),p=this.style.map.painter,y=p.context,k=y.gl;y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),k.readPixels(t.x,p.height/devicePixelRatio-t.y-1,1,1,k.RGBA,k.UNSIGNED_BYTE,a),y.bindFramebuffer.set(null);const I=a[0]+(a[2]>>4<<8),D=a[1]+((15&a[2])<<8),L=this.coordsIndex[255-a[3]],F=L&&this.sourceCache.getTileByID(L);if(!F)return null;const V=this._coordsTextureSize,X=(1<<F.tileID.canonical.z)*V;return new n.MercatorCoordinate((F.tileID.canonical.x*V+I)/X,(F.tileID.canonical.y*V+D)/X,this.getElevation(F.tileID,I,D,V))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,a=new n.PosArray,p=new n.TriangleIndexArray,y=this.meshSize,k=n.EXTENT/y,I=y*y;for(let D=0;D<=y;D++)for(let L=0;L<=y;L++)a.emplaceBack(L*k,D*k);for(let D=0;D<I;D+=y+1)for(let L=0;L<y;L++)p.emplaceBack(L+D,y+L+D+1,y+L+D+2),p.emplaceBack(L+D,y+L+D+2,L+D+1);return this._mesh={indexBuffer:t.createIndexBuffer(p),vertexBuffer:t.createVertexBuffer(a,wi.members),segments:n.SegmentVector.simpleSegment(0,0,a.length,p.length)},this._mesh}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,p={minElevation:null,maxElevation:null};return a&&a.dem&&(p.minElevation=(a.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(a.dem.max+this.elevationOffset)*this.exaggeration),p}}const ki=(g,t)=>n.emitValidationErrors(g,t&&t.filter(a=>a.identifier!=="source.canvas")),Oi=n.pick(xe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),yn=n.pick(xe,["setCenter","setZoom","setBearing","setPitch"]),Wi=function(){const g={},t=n.spec.$version;for(const a in n.spec.$root){const p=n.spec.$root[a];if(p.required){let y=null;y=a==="version"?t:p.type==="array"?[]:{},y!=null&&(g[a]=y)}}return g}();class Mn extends n.Evented{constructor(t,a={}){super(),this.map=t,this.dispatcher=new Se(Je(),this),this.imageManager=new B,this.imageManager.setEventedParent(this),this.glyphManager=new Z(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new we(256,512),this.crossTileSymbolIndex=new ii,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new n.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const p=this;this._rtlTextPluginCallback=Mn.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(k,I)=>{if(n.triggerPluginCompletionEvent(k),I&&I.every(D=>D))for(const D in p.sourceCaches)p.sourceCaches[D].reload()})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const k=this.sourceCaches[y.sourceId];if(!k)return;const I=k.getSource();if(I&&I.vectorLayerIds)for(const D in this._layers){const L=this._layers[D];L.source===I.id&&this._validateLayer(L)}})}loadURL(t,a={}){this.fire(new n.Event("dataloading",{dataType:"style"}));const p=typeof a.validate!="boolean"||a.validate,y=this.map._requestManager.transformRequest(t,n.ResourceType.Style);this._request=n.getJSON(y,(k,I)=>{this._request=null,k?this.fire(new n.ErrorEvent(k)):I&&this._load(I,p)})}loadJSON(t,a={}){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.exported.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(Wi,!1)}_load(t,a){if(a&&ki(this,n.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const y in t.sources)this.addSource(y,t.sources[y],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const p=ce(this.stylesheet.layers);this._order=p.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of p)y=n.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new he(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(a,p,y,k){let I,D,L;const F=y>1?"@2x":"";let V=n.getJSON(p.transformRequest(p.normalizeSpriteURL(a,F,".json"),n.ResourceType.SpriteJSON),(ue,se)=>{V=null,L||(L=ue,I=se,$())}),X=n.getImage(p.transformRequest(p.normalizeSpriteURL(a,F,".png"),n.ResourceType.SpriteImage),(ue,se)=>{X=null,L||(L=ue,D=se,$())});function $(){if(L)k(L);else if(I&&D){const ue=n.exported.getImageData(D),se={};for(const le in I){const{width:be,height:Ae,x:ze,y:de,sdf:Ge,pixelRatio:Le,stretchX:Ye,stretchY:$e,content:lt}=I[le],We=new n.RGBAImage({width:be,height:Ae});n.RGBAImage.copy(ue,We,{x:ze,y:de},{x:0,y:0},{width:be,height:Ae}),se[le]={data:We,pixelRatio:Le,sdf:Ge,stretchX:Ye,stretchY:$e,content:lt}}k(null,se)}}return{cancel(){V&&(V.cancel(),V=null),X&&(X.cancel(),X=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(a,p)=>{if(this._spriteRequest=null,a)this.fire(new n.ErrorEvent(a));else if(p)for(const y in p)this.imageManager.addImage(y,p[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))})}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const p=t.sourceLayer;if(!p)return;const y=a.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(p)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${y.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const a=[];for(const p of t){const y=this._layers[p];y.type!=="custom"&&a.push(y.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(y.length||k.length)&&this._updateWorkerLayers(y,k);for(const I in this._updatedSources){const D=this._updatedSources[I];if(D==="reload")this._reloadSource(I);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(I)}}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const p={};for(const y in this.sourceCaches){const k=this.sourceCaches[y];p[y]=k.used,k.used=!1}for(const y of this._order){const k=this._layers[y];k.recalculate(t,this._availableImages),!k.isHidden(t.zoom)&&k.source&&(this.sourceCaches[k.source].used=!0)}for(const y in p){const k=this.sourceCaches[y];p[y]!==k.used&&k.fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(t),this.z=t.zoom,a&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const a=this.sourceCaches[t.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new ui(this,a,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new n.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),ki(this,n.validateStyle(t)))return!1;(t=n.clone$1(t)).layers=ce(t.layers);const a=function(y,k){if(!y)return[{command:xe.setStyle,args:[k]}];let I=[];try{if(!A(y.version,k.version))return[{command:xe.setStyle,args:[k]}];A(y.center,k.center)||I.push({command:xe.setCenter,args:[k.center]}),A(y.zoom,k.zoom)||I.push({command:xe.setZoom,args:[k.zoom]}),A(y.bearing,k.bearing)||I.push({command:xe.setBearing,args:[k.bearing]}),A(y.pitch,k.pitch)||I.push({command:xe.setPitch,args:[k.pitch]}),A(y.sprite,k.sprite)||I.push({command:xe.setSprite,args:[k.sprite]}),A(y.glyphs,k.glyphs)||I.push({command:xe.setGlyphs,args:[k.glyphs]}),A(y.transition,k.transition)||I.push({command:xe.setTransition,args:[k.transition]}),A(y.light,k.light)||I.push({command:xe.setLight,args:[k.light]});const D={},L=[];(function(V,X,$,ue){let se;for(se in X=X||{},V=V||{})Object.prototype.hasOwnProperty.call(V,se)&&(Object.prototype.hasOwnProperty.call(X,se)||at(se,$,ue));for(se in X)Object.prototype.hasOwnProperty.call(X,se)&&(Object.prototype.hasOwnProperty.call(V,se)?A(V[se],X[se])||(V[se].type==="geojson"&&X[se].type==="geojson"&&_t(V,X,se)?$.push({command:xe.setGeoJSONSourceData,args:[se,X[se].data]}):Ue(se,X,$,ue)):rt(se,X,$))})(y.sources,k.sources,L,D);const F=[];y.layers&&y.layers.forEach(V=>{D[V.source]?I.push({command:xe.removeLayer,args:[V.id]}):F.push(V)}),I=I.concat(L),function(V,X,$){X=X||[];const ue=(V=V||[]).map(gt),se=X.map(gt),le=V.reduce(Xt,{}),be=X.reduce(Xt,{}),Ae=ue.slice(),ze=Object.create(null);let de,Ge,Le,Ye,$e,lt,We;for(de=0,Ge=0;de<ue.length;de++)Le=ue[de],Object.prototype.hasOwnProperty.call(be,Le)?Ge++:($.push({command:xe.removeLayer,args:[Le]}),Ae.splice(Ae.indexOf(Le,Ge),1));for(de=0,Ge=0;de<se.length;de++)Le=se[se.length-1-de],Ae[Ae.length-1-de]!==Le&&(Object.prototype.hasOwnProperty.call(le,Le)?($.push({command:xe.removeLayer,args:[Le]}),Ae.splice(Ae.lastIndexOf(Le,Ae.length-Ge),1)):Ge++,lt=Ae[Ae.length-de],$.push({command:xe.addLayer,args:[be[Le],lt]}),Ae.splice(Ae.length-de,0,Le),ze[Le]=!0);for(de=0;de<se.length;de++)if(Le=se[de],Ye=le[Le],$e=be[Le],!ze[Le]&&!A(Ye,$e))if(A(Ye.source,$e.source)&&A(Ye["source-layer"],$e["source-layer"])&&A(Ye.type,$e.type)){for(We in Mt(Ye.layout,$e.layout,$,Le,null,xe.setLayoutProperty),Mt(Ye.paint,$e.paint,$,Le,null,xe.setPaintProperty),A(Ye.filter,$e.filter)||$.push({command:xe.setFilter,args:[Le,$e.filter]}),A(Ye.minzoom,$e.minzoom)&&A(Ye.maxzoom,$e.maxzoom)||$.push({command:xe.setLayerZoomRange,args:[Le,$e.minzoom,$e.maxzoom]}),Ye)Object.prototype.hasOwnProperty.call(Ye,We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&(We.indexOf("paint.")===0?Mt(Ye[We],$e[We],$,Le,We.slice(6),xe.setPaintProperty):A(Ye[We],$e[We])||$.push({command:xe.setLayerProperty,args:[Le,We,$e[We]]}));for(We in $e)Object.prototype.hasOwnProperty.call($e,We)&&!Object.prototype.hasOwnProperty.call(Ye,We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&(We.indexOf("paint.")===0?Mt(Ye[We],$e[We],$,Le,We.slice(6),xe.setPaintProperty):A(Ye[We],$e[We])||$.push({command:xe.setLayerProperty,args:[Le,We,$e[We]]}))}else $.push({command:xe.removeLayer,args:[Le]}),lt=Ae[Ae.lastIndexOf(Le)+1],$.push({command:xe.addLayer,args:[$e,lt]})}(F,k.layers,I)}catch(D){console.warn("Unable to compute style diff:",D),I=[{command:xe.setStyle,args:[k]}]}return I}(this.serialize(),t).filter(y=>!(y.command in yn));if(a.length===0)return!1;const p=a.filter(y=>!(y.command in Oi));if(p.length>0)throw new Error(`Unimplemented: ${p.map(y=>y.command).join(", ")}.`);return a.forEach(y=>{y.command!=="setTransition"&&this[y.command].apply(this,y.args)}),this.stylesheet=t,!0}addImage(t,a){if(this.getImage(t))return this.fire(new n.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new n.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,p={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(n.validateStyle.source,`sources.${t}`,a,null,p))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const y=this.sourceCaches[t]=new et(t,a,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:t})),y.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new n.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const p=this.sourceCaches[t].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,p={}){this._checkLoaded();const y=t.id;if(this.getLayer(y))return void this.fire(new n.ErrorEvent(new Error(`Layer "${y}" already exists on this map.`)));let k;if(t.type==="custom"){if(ki(this,n.validateCustomStyleLayer(t)))return;k=n.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=n.clone$1(t),t=n.extend(t,{source:y})),this._validate(n.validateStyle.layer,`layers.${y}`,t,{arrayIndex:-1},p))return;k=n.createStyleLayer(t),this._validateLayer(k),k.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[k.id]=k.serialize()}const I=a?this._order.indexOf(a):this._order.length;if(a&&I===-1)this.fire(new n.ErrorEvent(new Error(`Cannot add layer "${y}" before non-existing layer "${a}".`)));else{if(this._order.splice(I,0,y),this._layerOrderChanged=!0,this._layers[y]=k,this._removedLayers[y]&&k.source&&k.type!=="custom"){const D=this._removedLayers[y];delete this._removedLayers[y],D.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const p=this._order.indexOf(t);this._order.splice(p,1);const y=a?this._order.indexOf(a):this._order.length;a&&y===-1?this.fire(new n.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(y,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new n.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,p){this._checkLoaded();const y=this.getLayer(t);y?y.minzoom===a&&y.maxzoom===p||(a!=null&&(y.minzoom=a),p!=null&&(y.maxzoom=p),this._updateLayer(y)):this.fire(new n.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,p={}){this._checkLoaded();const y=this.getLayer(t);if(y){if(!A(y.filter,a))return a==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(n.validateStyle.filter,`layers.${y.id}.filter`,a,null,p)||(y.filter=n.clone$1(a),this._updateLayer(y)))}else this.fire(new n.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return n.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,a,p,y={}){this._checkLoaded();const k=this.getLayer(t);k?A(k.getLayoutProperty(a),p)||(k.setLayoutProperty(a,p,y),this._updateLayer(k)):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const p=this.getLayer(t);if(p)return p.getLayoutProperty(a);this.fire(new n.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,p,y={}){this._checkLoaded();const k=this.getLayer(t);k?A(k.getPaintProperty(a),p)||(k.setPaintProperty(a,p,y)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const p=t.source,y=t.sourceLayer,k=this.sourceCaches[p];if(k===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const I=k.getSource().type;I==="geojson"&&y?this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||y?(t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),k.setFeatureState(y,t.id,a)):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const p=t.source,y=this.sourceCaches[p];if(y===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const k=y.getSource().type,I=k==="vector"?t.sourceLayer:void 0;k!=="vector"||I?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(I,t.id,a):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,p=t.sourceLayer,y=this.sourceCaches[a];if(y!==void 0)return y.getSource().type!=="vector"||p?(t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),y.getFeatureState(p,t.id)):void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new n.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return n.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:n.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=I=>this._layers[I].type==="fill-extrusion",p={},y=[];for(let I=this._order.length-1;I>=0;I--){const D=this._order[I];if(a(D)){p[D]=I;for(const L of t){const F=L[D];if(F)for(const V of F)y.push(V)}}}y.sort((I,D)=>D.intersectionZ-I.intersectionZ);const k=[];for(let I=this._order.length-1;I>=0;I--){const D=this._order[I];if(a(D))for(let L=y.length-1;L>=0;L--){const F=y[L].feature;if(p[F.layer.id]<I)break;k.push(F),y.pop()}else for(const L of t){const F=L[D];if(F)for(const V of F)k.push(V.feature)}}return k}queryRenderedFeatures(t,a,p){a&&a.filter&&this._validate(n.validateStyle.filter,"queryRenderedFeatures.filter",a.filter,null,a);const y={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of a.layers){const D=this._layers[I];if(!D)return this.fire(new n.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];y[D.source]=!0}}const k=[];a.availableImages=this._availableImages;for(const I in this.sourceCaches)a.layers&&!y[I]||k.push(Et(this.sourceCaches[I],this._layers,this._serializedLayers,t,a,p));return this.placement&&k.push(function(I,D,L,F,V,X,$){const ue={},se=X.queryRenderedSymbols(F),le=[];for(const be of Object.keys(se).map(Number))le.push($[be]);le.sort(mt);for(const be of le){const Ae=be.featureIndex.lookupSymbolFeatures(se[be.bucketInstanceId],D,be.bucketIndex,be.sourceLayerIndex,V.filter,V.layers,V.availableImages,I);for(const ze in Ae){const de=ue[ze]=ue[ze]||[],Ge=Ae[ze];Ge.sort((Le,Ye)=>{const $e=be.featureSortOrder;if($e){const lt=$e.indexOf(Le.featureIndex);return $e.indexOf(Ye.featureIndex)-lt}return Ye.featureIndex-Le.featureIndex});for(const Le of Ge)de.push(Le)}}for(const be in ue)ue[be].forEach(Ae=>{const ze=Ae.feature,de=L[I[be].source].getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=de});return ue}(this._layers,this._serializedLayers,this.sourceCaches,t,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(t,a){a&&a.filter&&this._validate(n.validateStyle.filter,"querySourceFeatures.filter",a.filter,null,a);const p=this.sourceCaches[t];return p?function(y,k){const I=y.getRenderableIds().map(F=>y.getTileByID(F)),D=[],L={};for(let F=0;F<I.length;F++){const V=I[F],X=V.tileID.canonical.key;L[X]||(L[X]=!0,V.querySourceFeatures(D,k))}return D}(p,a):[]}addSourceType(t,a,p){return Mn.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(Mn.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const p=this.light.getLight();let y=!1;for(const I in t)if(!A(t[I],p[I])){y=!0;break}if(!y)return;const k={now:n.exported.now(),transition:n.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(k)}_validate(t,a,p,y,k={}){return(!k||k.validate!==!1)&&ki(this,t.call(n.validateStyle,n.extend({key:a,style:this.serialize(),value:p,styleSpec:n.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const a=this.sourceCaches[t];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,p,y,k=!1){let I=!1,D=!1;const L={};for(const F of this._order){const V=this._layers[F];if(V.type!=="symbol")continue;if(!L[V.source]){const $=this.sourceCaches[V.source];L[V.source]=$.getRenderableIds(!0).map(ue=>$.getTileByID(ue)).sort((ue,se)=>se.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(se.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(V,L[V.source],t.center.lng);I=I||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.exported.now(),t.zoom))&&(this.pauseablePlacement=new Ze(t,this.terrain,this._order,k,a,p,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.exported.now()),D=!0),I&&this.pauseablePlacement.placement.setStale()),D||I)for(const F of this._order){const V=this._layers[F];V.type==="symbol"&&this.placement.updateLayerOpacities(V,L[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,p){this.imageManager.getImages(a.icons,p),this._updateTilesForChangedImages();const y=this.sourceCaches[a.source];y&&y.setDependencies(a.tileID.key,a.type,a.icons)}getGlyphs(t,a,p){this.glyphManager.getGlyphs(a.stacks,p)}getResource(t,a,p){return n.makeRequest(a,p)}}Mn.getSourceType=function(g){return Oe[g]},Mn.setSourceType=function(g,t){Oe[g]=t},Mn.registerForPluginStateChange=n.registerForPluginStateChange;var vs="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ns={prelude:Fi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Fi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Fi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Fi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Fi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Fi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Fi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Fi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Fi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Fi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Fi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Fi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Fi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Fi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Fi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Fi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Fi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Fi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Fi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Fi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Fi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Fi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Fi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",vs),terrainDepth:Fi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",vs),terrainCoords:Fi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",vs)};function Fi(g,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=t.match(/attribute ([\w]+) ([\w]+)/g),y=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=k?k.concat(y):y,D={};return{fragmentSource:g=g.replace(a,(L,F,V,X,$)=>(D[$]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${V} ${X} ${$};
#else
uniform ${V} ${X} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${V} ${X} ${$} = u_${$};
#endif
`)),vertexSource:t=t.replace(a,(L,F,V,X,$)=>{const ue=X==="float"?"vec2":"vec4",se=$.match(/color/)?"color":ue;return D[$]?F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${V} ${ue} a_${$};
varying ${V} ${X} ${$};
#else
uniform ${V} ${X} u_${$};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${V} ${X} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${se}(a_${$}, u_${$}_t);
#else
    ${V} ${X} ${$} = u_${$};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${V} ${ue} a_${$};
#else
uniform ${V} ${X} u_${$};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${V} ${X} ${$} = a_${$};
#else
    ${V} ${X} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${V} ${X} ${$} = unpack_mix_${se}(a_${$}, u_${$}_t);
#else
    ${V} ${X} ${$} = u_${$};
#endif
`}),staticAttributes:p,staticUniforms:I}}class ra{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,p,y,k,I,D,L,F){this.context=t;let V=this.boundPaintVertexBuffers.length!==y.length;for(let X=0;!V&&X<y.length;X++)this.boundPaintVertexBuffers[X]!==y[X]&&(V=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===a&&this.boundLayoutVertexBuffer===p&&!V&&this.boundIndexBuffer===k&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===D&&this.boundDynamicVertexBuffer2===L&&this.boundDynamicVertexBuffer3===F?(t.bindVertexArrayOES.set(this.vao),D&&D.bind(),k&&k.dynamicDraw&&k.bind(),L&&L.bind(),F&&F.bind()):this.freshBind(a,p,y,k,I,D,L,F)}freshBind(t,a,p,y,k,I,D,L){let F;const V=t.numAttributes,X=this.context,$=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=k,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=L;else{F=X.currentNumAttributes||0;for(let ue=V;ue<F;ue++)$.disableVertexAttribArray(ue)}a.enableAttributes($,t);for(const ue of p)ue.enableAttributes($,t);I&&I.enableAttributes($,t),D&&D.enableAttributes($,t),L&&L.enableAttributes($,t),a.bind(),a.setVertexAttribPointers($,t,k);for(const ue of p)ue.bind(),ue.setVertexAttribPointers($,t,k);I&&(I.bind(),I.setVertexAttribPointers($,t,k)),y&&y.bind(),D&&(D.bind(),D.setVertexAttribPointers($,t,k)),L&&(L.bind(),L.setVertexAttribPointers($,t,k)),X.currentNumAttributes=V}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function sa(g){const t=[];for(let a=0;a<g.length;a++){if(g[a]===null)continue;const p=g[a].split(" ");t.push(p.pop())}return t}class yl{constructor(t,a,p,y,k,I,D){const L=t.gl;this.program=L.createProgram();const F=sa(p.staticAttributes),V=y?y.getBinderAttributes():[],X=F.concat(V),$=Ns.prelude.staticUniforms?sa(Ns.prelude.staticUniforms):[],ue=p.staticUniforms?sa(p.staticUniforms):[],se=y?y.getBinderUniforms():[],le=$.concat(ue).concat(se),be=[];for(const $e of le)be.indexOf($e)<0&&be.push($e);const Ae=y?y.defines():[];I&&Ae.push("#define OVERDRAW_INSPECTOR;"),D&&Ae.push("#define TERRAIN3D;");const ze=Ae.concat(Ns.prelude.fragmentSource,p.fragmentSource).join(`
`),de=Ae.concat(Ns.prelude.vertexSource,p.vertexSource).join(`
`),Ge=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(Ge,ze),L.compileShader(Ge),L.attachShader(this.program,Ge);const Le=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(Le,de),L.compileShader(Le),L.attachShader(this.program,Le),this.attributes={};const Ye={};this.numAttributes=X.length;for(let $e=0;$e<this.numAttributes;$e++)X[$e]&&(L.bindAttribLocation(this.program,$e,X[$e]),this.attributes[X[$e]]=$e);L.linkProgram(this.program),L.deleteShader(Le),L.deleteShader(Ge);for(let $e=0;$e<be.length;$e++){const lt=be[$e];if(lt&&!Ye[lt]){const We=L.getUniformLocation(this.program,lt);We&&(Ye[lt]=We)}}this.fixedUniforms=k(t,Ye),this.terrainUniforms=(($e,lt)=>({u_depth:new n.Uniform1i($e,lt.u_depth),u_terrain:new n.Uniform1i($e,lt.u_terrain),u_terrain_dim:new n.Uniform1f($e,lt.u_terrain_dim),u_terrain_matrix:new n.UniformMatrix4f($e,lt.u_terrain_matrix),u_terrain_unpack:new n.Uniform4f($e,lt.u_terrain_unpack),u_terrain_offset:new n.Uniform1f($e,lt.u_terrain_offset),u_terrain_exaggeration:new n.Uniform1f($e,lt.u_terrain_exaggeration)}))(t,Ye),this.binderUniforms=y?y.getUniforms(t,Ye):[]}draw(t,a,p,y,k,I,D,L,F,V,X,$,ue,se,le,be,Ae,ze){const de=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(y),t.setColorMode(k),t.setCullFace(I),L){t.activeTexture.set(de.TEXTURE2),de.bindTexture(de.TEXTURE_2D,L.depthTexture),t.activeTexture.set(de.TEXTURE3),de.bindTexture(de.TEXTURE_2D,L.texture);for(const Le in this.terrainUniforms)this.terrainUniforms[Le].set(L[Le])}for(const Le in this.fixedUniforms)this.fixedUniforms[Le].set(D[Le]);le&&le.setUniforms(t,this.binderUniforms,ue,{zoom:se});let Ge=0;switch(a){case de.LINES:Ge=2;break;case de.TRIANGLES:Ge=3;break;case de.LINE_STRIP:Ge=1}for(const Le of $.get()){const Ye=Le.vaos||(Le.vaos={});(Ye[F]||(Ye[F]=new ra)).bind(t,this,V,le?le.getPaintVertexBuffers():[],X,Le.vertexOffset,be,Ae,ze),de.drawElements(a,Le.primitiveLength*Ge,de.UNSIGNED_SHORT,Le.primitiveOffset*Ge*2)}}}function vl(g,t,a){const p=1/an(a,1,t.transform.tileZoom),y=Math.pow(2,a.tileID.overscaledZ),k=a.tileSize*Math.pow(2,t.transform.tileZoom)/y,I=k*(a.tileID.canonical.x+a.tileID.wrap*y),D=k*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[p,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[I>>16,D>>16],u_pixel_coord_lower:[65535&I,65535&D]}}const oa=(g,t,a,p)=>{const y=t.style.light,k=y.properties.get("position"),I=[k.x,k.y,k.z],D=n.create$1();y.properties.get("anchor")==="viewport"&&n.fromRotation(D,-t.transform.angle),n.transformMat3(I,I,D);const L=y.properties.get("color");return{u_matrix:g,u_lightpos:I,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+a,u_opacity:p}},qc=(g,t,a,p,y,k,I)=>n.extend(oa(g,t,a,p),vl(k,t,I),{u_height_factor:-Math.pow(2,y.overscaledZ)/I.tileSize/8}),bo=g=>({u_matrix:g}),aa=(g,t,a,p)=>n.extend(bo(g),vl(a,t,p)),bl=(g,t)=>({u_matrix:g,u_world:t}),xl=(g,t,a,p,y)=>n.extend(aa(g,t,a,p),{u_world:y}),wl=(g,t,a,p)=>{const y=g.transform;let k,I;if(p.paint.get("circle-pitch-alignment")==="map"){const D=an(a,1,y.zoom);k=!0,I=[D,D]}else k=!1,I=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(t.posMatrix,a,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+k,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:I}},Kr=(g,t,a)=>{const p=an(a,1,t.zoom),y=Math.pow(2,t.zoom-a.tileID.overscaledZ),k=a.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[t.pixelsToGLUnits[0]/(p*y),t.pixelsToGLUnits[1]/(p*y)],u_overscale_factor:k}},Us=(g,t,a=1)=>({u_matrix:g,u_color:t,u_overlay:0,u_overlay_scale:a}),bs=g=>({u_matrix:g}),xo=(g,t,a,p)=>({u_matrix:g,u_extrude_scale:an(t,1,a),u_intensity:p});function wo(g,t){const a=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new n.MercatorCoordinate(0,p/a).toLngLat().lat,new n.MercatorCoordinate(0,(p+1)/a).toLngLat().lat]}const xs=(g,t,a,p)=>{const y=g.transform;return{u_matrix:Gs(g,t,a,p),u_ratio:1/an(t,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},la=(g,t,a,p,y)=>n.extend(xs(g,t,a,y),{u_image:0,u_image_height:p}),ko=(g,t,a,p,y)=>{const k=g.transform,I=Xi(t,k);return{u_matrix:Gs(g,t,a,y),u_texsize:t.imageAtlasTexture.size,u_ratio:1/an(t,1,k.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[I,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},Vs=(g,t,a,p,y,k)=>{const I=g.lineAtlas,D=Xi(t,g.transform),L=a.layout.get("line-cap")==="round",F=I.getDash(p.from,L),V=I.getDash(p.to,L),X=F.width*y.fromScale,$=V.width*y.toScale;return n.extend(xs(g,t,a,k),{u_patternscale_a:[D/X,-F.height/2],u_patternscale_b:[D/$,-V.height/2],u_sdfgamma:I.width/(256*Math.min(X,$)*g.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:V.y,u_mix:y.t})};function Xi(g,t){return 1/an(g,1,t.tileZoom)}function Gs(g,t,a,p){return g.translatePosMatrix(p?p.posMatrix:t.tileID.posMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const kl=(g,t,a,p,y)=>{return{u_matrix:g,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(I=y.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(k=y.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:Sl(y.paint.get("raster-hue-rotate"))};var k,I};function Sl(g){g*=Math.PI/180;const t=Math.sin(g),a=Math.cos(g);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const ca=(g,t,a,p,y,k,I,D,L,F)=>{const V=y.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:V.width/V.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:I,u_coord_matrix:D,u_is_text:+L,u_pitch_with_map:+p,u_texsize:F,u_texture:0}},So=(g,t,a,p,y,k,I,D,L,F,V)=>{const X=y.transform;return n.extend(ca(g,t,a,p,y,k,I,D,L,F),{u_gamma_scale:p?Math.cos(X._pitch)*X.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:+V})},El=(g,t,a,p,y,k,I,D,L,F)=>n.extend(So(g,t,a,p,y,k,I,D,!0,L,!0),{u_texsize_icon:F,u_texture_icon:1}),Zc=(g,t,a)=>({u_matrix:g,u_opacity:t,u_color:a}),Hc=(g,t,a,p,y,k)=>n.extend(function(I,D,L,F){const V=L.imageManager.getPattern(I.from.toString()),X=L.imageManager.getPattern(I.to.toString()),{width:$,height:ue}=L.imageManager.getPixelSize(),se=Math.pow(2,F.tileID.overscaledZ),le=F.tileSize*Math.pow(2,L.transform.tileZoom)/se,be=le*(F.tileID.canonical.x+F.tileID.wrap*se),Ae=le*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[$,ue],u_mix:D.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/an(F,1,L.transform.tileZoom),u_pixel_coord_upper:[be>>16,Ae>>16],u_pixel_coord_lower:[65535&be,65535&Ae]}}(p,k,a,y),{u_matrix:g,u_opacity:t}),ua={fillExtrusion:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_lightpos:new n.Uniform3f(g,t.u_lightpos),u_lightintensity:new n.Uniform1f(g,t.u_lightintensity),u_lightcolor:new n.Uniform3f(g,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(g,t.u_vertical_gradient),u_opacity:new n.Uniform1f(g,t.u_opacity)}),fillExtrusionPattern:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_lightpos:new n.Uniform3f(g,t.u_lightpos),u_lightintensity:new n.Uniform1f(g,t.u_lightintensity),u_lightcolor:new n.Uniform3f(g,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(g,t.u_vertical_gradient),u_height_factor:new n.Uniform1f(g,t.u_height_factor),u_image:new n.Uniform1i(g,t.u_image),u_texsize:new n.Uniform2f(g,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(g,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(g,t.u_scale),u_fade:new n.Uniform1f(g,t.u_fade),u_opacity:new n.Uniform1f(g,t.u_opacity)}),fill:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix)}),fillPattern:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_image:new n.Uniform1i(g,t.u_image),u_texsize:new n.Uniform2f(g,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(g,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(g,t.u_scale),u_fade:new n.Uniform1f(g,t.u_fade)}),fillOutline:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_world:new n.Uniform2f(g,t.u_world)}),fillOutlinePattern:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_world:new n.Uniform2f(g,t.u_world),u_image:new n.Uniform1i(g,t.u_image),u_texsize:new n.Uniform2f(g,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(g,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(g,t.u_scale),u_fade:new n.Uniform1f(g,t.u_fade)}),circle:(g,t)=>({u_camera_to_center_distance:new n.Uniform1f(g,t.u_camera_to_center_distance),u_scale_with_map:new n.Uniform1i(g,t.u_scale_with_map),u_pitch_with_map:new n.Uniform1i(g,t.u_pitch_with_map),u_extrude_scale:new n.Uniform2f(g,t.u_extrude_scale),u_device_pixel_ratio:new n.Uniform1f(g,t.u_device_pixel_ratio),u_matrix:new n.UniformMatrix4f(g,t.u_matrix)}),collisionBox:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_camera_to_center_distance:new n.Uniform1f(g,t.u_camera_to_center_distance),u_pixels_to_tile_units:new n.Uniform1f(g,t.u_pixels_to_tile_units),u_extrude_scale:new n.Uniform2f(g,t.u_extrude_scale),u_overscale_factor:new n.Uniform1f(g,t.u_overscale_factor)}),collisionCircle:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_inv_matrix:new n.UniformMatrix4f(g,t.u_inv_matrix),u_camera_to_center_distance:new n.Uniform1f(g,t.u_camera_to_center_distance),u_viewport_size:new n.Uniform2f(g,t.u_viewport_size)}),debug:(g,t)=>({u_color:new n.UniformColor(g,t.u_color),u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_overlay:new n.Uniform1i(g,t.u_overlay),u_overlay_scale:new n.Uniform1f(g,t.u_overlay_scale)}),clippingMask:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix)}),heatmap:(g,t)=>({u_extrude_scale:new n.Uniform1f(g,t.u_extrude_scale),u_intensity:new n.Uniform1f(g,t.u_intensity),u_matrix:new n.UniformMatrix4f(g,t.u_matrix)}),heatmapTexture:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_world:new n.Uniform2f(g,t.u_world),u_image:new n.Uniform1i(g,t.u_image),u_color_ramp:new n.Uniform1i(g,t.u_color_ramp),u_opacity:new n.Uniform1f(g,t.u_opacity)}),hillshade:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_image:new n.Uniform1i(g,t.u_image),u_latrange:new n.Uniform2f(g,t.u_latrange),u_light:new n.Uniform2f(g,t.u_light),u_shadow:new n.UniformColor(g,t.u_shadow),u_highlight:new n.UniformColor(g,t.u_highlight),u_accent:new n.UniformColor(g,t.u_accent)}),hillshadePrepare:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_image:new n.Uniform1i(g,t.u_image),u_dimension:new n.Uniform2f(g,t.u_dimension),u_zoom:new n.Uniform1f(g,t.u_zoom),u_unpack:new n.Uniform4f(g,t.u_unpack)}),line:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_ratio:new n.Uniform1f(g,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(g,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(g,t.u_units_to_pixels)}),lineGradient:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_ratio:new n.Uniform1f(g,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(g,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(g,t.u_units_to_pixels),u_image:new n.Uniform1i(g,t.u_image),u_image_height:new n.Uniform1f(g,t.u_image_height)}),linePattern:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_texsize:new n.Uniform2f(g,t.u_texsize),u_ratio:new n.Uniform1f(g,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(g,t.u_device_pixel_ratio),u_image:new n.Uniform1i(g,t.u_image),u_units_to_pixels:new n.Uniform2f(g,t.u_units_to_pixels),u_scale:new n.Uniform3f(g,t.u_scale),u_fade:new n.Uniform1f(g,t.u_fade)}),lineSDF:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_ratio:new n.Uniform1f(g,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(g,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(g,t.u_units_to_pixels),u_patternscale_a:new n.Uniform2f(g,t.u_patternscale_a),u_patternscale_b:new n.Uniform2f(g,t.u_patternscale_b),u_sdfgamma:new n.Uniform1f(g,t.u_sdfgamma),u_image:new n.Uniform1i(g,t.u_image),u_tex_y_a:new n.Uniform1f(g,t.u_tex_y_a),u_tex_y_b:new n.Uniform1f(g,t.u_tex_y_b),u_mix:new n.Uniform1f(g,t.u_mix)}),raster:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_tl_parent:new n.Uniform2f(g,t.u_tl_parent),u_scale_parent:new n.Uniform1f(g,t.u_scale_parent),u_buffer_scale:new n.Uniform1f(g,t.u_buffer_scale),u_fade_t:new n.Uniform1f(g,t.u_fade_t),u_opacity:new n.Uniform1f(g,t.u_opacity),u_image0:new n.Uniform1i(g,t.u_image0),u_image1:new n.Uniform1i(g,t.u_image1),u_brightness_low:new n.Uniform1f(g,t.u_brightness_low),u_brightness_high:new n.Uniform1f(g,t.u_brightness_high),u_saturation_factor:new n.Uniform1f(g,t.u_saturation_factor),u_contrast_factor:new n.Uniform1f(g,t.u_contrast_factor),u_spin_weights:new n.Uniform3f(g,t.u_spin_weights)}),symbolIcon:(g,t)=>({u_is_size_zoom_constant:new n.Uniform1i(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(g,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(g,t.u_size_t),u_size:new n.Uniform1f(g,t.u_size),u_camera_to_center_distance:new n.Uniform1f(g,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(g,t.u_pitch),u_rotate_symbol:new n.Uniform1i(g,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(g,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(g,t.u_fade_change),u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(g,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(g,t.u_coord_matrix),u_is_text:new n.Uniform1i(g,t.u_is_text),u_pitch_with_map:new n.Uniform1i(g,t.u_pitch_with_map),u_texsize:new n.Uniform2f(g,t.u_texsize),u_texture:new n.Uniform1i(g,t.u_texture)}),symbolSDF:(g,t)=>({u_is_size_zoom_constant:new n.Uniform1i(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(g,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(g,t.u_size_t),u_size:new n.Uniform1f(g,t.u_size),u_camera_to_center_distance:new n.Uniform1f(g,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(g,t.u_pitch),u_rotate_symbol:new n.Uniform1i(g,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(g,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(g,t.u_fade_change),u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(g,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(g,t.u_coord_matrix),u_is_text:new n.Uniform1i(g,t.u_is_text),u_pitch_with_map:new n.Uniform1i(g,t.u_pitch_with_map),u_texsize:new n.Uniform2f(g,t.u_texsize),u_texture:new n.Uniform1i(g,t.u_texture),u_gamma_scale:new n.Uniform1f(g,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(g,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(g,t.u_is_halo)}),symbolTextAndIcon:(g,t)=>({u_is_size_zoom_constant:new n.Uniform1i(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(g,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(g,t.u_size_t),u_size:new n.Uniform1f(g,t.u_size),u_camera_to_center_distance:new n.Uniform1f(g,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(g,t.u_pitch),u_rotate_symbol:new n.Uniform1i(g,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(g,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(g,t.u_fade_change),u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(g,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(g,t.u_coord_matrix),u_is_text:new n.Uniform1i(g,t.u_is_text),u_pitch_with_map:new n.Uniform1i(g,t.u_pitch_with_map),u_texsize:new n.Uniform2f(g,t.u_texsize),u_texsize_icon:new n.Uniform2f(g,t.u_texsize_icon),u_texture:new n.Uniform1i(g,t.u_texture),u_texture_icon:new n.Uniform1i(g,t.u_texture_icon),u_gamma_scale:new n.Uniform1f(g,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(g,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(g,t.u_is_halo)}),background:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_opacity:new n.Uniform1f(g,t.u_opacity),u_color:new n.UniformColor(g,t.u_color)}),backgroundPattern:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_opacity:new n.Uniform1f(g,t.u_opacity),u_image:new n.Uniform1i(g,t.u_image),u_pattern_tl_a:new n.Uniform2f(g,t.u_pattern_tl_a),u_pattern_br_a:new n.Uniform2f(g,t.u_pattern_br_a),u_pattern_tl_b:new n.Uniform2f(g,t.u_pattern_tl_b),u_pattern_br_b:new n.Uniform2f(g,t.u_pattern_br_b),u_texsize:new n.Uniform2f(g,t.u_texsize),u_mix:new n.Uniform1f(g,t.u_mix),u_pattern_size_a:new n.Uniform2f(g,t.u_pattern_size_a),u_pattern_size_b:new n.Uniform2f(g,t.u_pattern_size_b),u_scale_a:new n.Uniform1f(g,t.u_scale_a),u_scale_b:new n.Uniform1f(g,t.u_scale_b),u_pixel_coord_upper:new n.Uniform2f(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(g,t.u_pixel_coord_lower),u_tile_units_to_pixels:new n.Uniform1f(g,t.u_tile_units_to_pixels)}),terrain:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_texture:new n.Uniform1i(g,t.u_texture)}),terrainDepth:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix)}),terrainCoords:(g,t)=>({u_matrix:new n.UniformMatrix4f(g,t.u_matrix),u_texture:new n.Uniform1i(g,t.u_texture),u_terrain_coords_id:new n.Uniform1f(g,t.u_terrain_coords_id)})};class ha{constructor(t,a,p){this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class da{constructor(t,a,p,y){this.length=a.length,this.attributes=p,this.itemSize=a.bytesPerElement,this.dynamicDraw=y,this.context=t;const k=t.gl;this.buffer=k.createBuffer(),t.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let p=0;p<this.attributes.length;p++){const y=a.attributes[this.attributes[p].name];y!==void 0&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,a,p){for(let y=0;y<this.attributes.length;y++){const k=this.attributes[y],I=a.attributes[k.name];I!==void 0&&t.vertexAttribPointer(I,k.components,t[fa[k.type]],!1,this.itemSize,k.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ti{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Tl extends Ti{getDefault(){return n.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wc extends Ti{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class js extends Ti{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class qs extends Ti{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Al extends Ti{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Xn extends Ti{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class pa extends Ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Eo extends Ti{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class To extends Ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class ma extends Ti{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ga extends Ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ao extends Ti{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class _a extends Ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class ya extends Ti{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Co extends Ti{getDefault(){return n.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Cl extends Ti{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Il extends Ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class ws extends Ti{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Xc extends Ti{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Kc extends Ti{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Jc extends Ti{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Yc extends Ti{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Qc extends Ti{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class $c extends Ti{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class va extends Ti{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Io extends Ti{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ba extends Ti{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xa extends Ti{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class ks extends Ti{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Pl extends Ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class zl extends Ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Po extends Ti{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Jr extends Po{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ml extends Po{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ss{constructor(t,a,p,y){this.context=t,this.width=a,this.height=p;const k=t.gl,I=this.framebuffer=k.createFramebuffer();if(this.colorAttachment=new Jr(t,I),y&&(this.depthAttachment=new Ml(t,I)),k.checkFramebufferStatus(k.FRAMEBUFFER)!==k.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class qi{constructor(t,a,p){this.blendFunction=t,this.blendColor=a,this.mask=p}}qi.Replace=[1,0],qi.disabled=new qi(qi.Replace,n.Color.transparent,[!1,!1,!1,!1]),qi.unblended=new qi(qi.Replace,n.Color.transparent,[!0,!0,!0,!0]),qi.alphaBlended=new qi([1,771],n.Color.transparent,[!0,!0,!0,!0]);class Dl{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Tl(this),this.clearDepth=new Wc(this),this.clearStencil=new js(this),this.colorMask=new qs(this),this.depthMask=new Al(this),this.stencilMask=new Xn(this),this.stencilFunc=new pa(this),this.stencilOp=new Eo(this),this.stencilTest=new To(this),this.depthRange=new ma(this),this.depthTest=new ga(this),this.depthFunc=new Ao(this),this.blend=new _a(this),this.blendFunc=new ya(this),this.blendColor=new Co(this),this.blendEquation=new Cl(this),this.cullFace=new Il(this),this.cullFaceSide=new ws(this),this.frontFace=new Xc(this),this.program=new Kc(this),this.activeTexture=new Jc(this),this.viewport=new Yc(this),this.bindFramebuffer=new Qc(this),this.bindRenderbuffer=new $c(this),this.bindTexture=new va(this),this.bindVertexBuffer=new Io(this),this.bindElementBuffer=new ba(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new xa(this),this.pixelStoreUnpack=new ks(this),this.pixelStoreUnpackPremultiplyAlpha=new Pl(this),this.pixelStoreUnpackFlipY=new zl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new ha(this,t,a)}createVertexBuffer(t,a,p){return new da(this,t,a,p)}createRenderbuffer(t,a,p){const y=this.gl,k=y.createRenderbuffer();return this.bindRenderbuffer.set(k),y.renderbufferStorage(y.RENDERBUFFER,t,a,p),this.bindRenderbuffer.set(null),k}createFramebuffer(t,a,p){return new Ss(this,t,a,p)}clear({color:t,depth:a}){const p=this.gl;let y=0;t&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),p.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){A(t.blendFunction,qi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class yi{constructor(t,a,p){this.func=t,this.mask=a,this.range=p}}yi.ReadOnly=!1,yi.ReadWrite=!0,yi.disabled=new yi(519,yi.ReadOnly,[0,1]);const Ai=7680;class ji{constructor(t,a,p,y,k,I){this.test=t,this.ref=a,this.mask=p,this.fail=y,this.depthFail=k,this.pass=I}}ji.disabled=new ji({func:519,mask:0},0,0,Ai,Ai,Ai);class Ki{constructor(t,a,p){this.enable=t,this.mode=a,this.frontFace=p}}let Zs;function Es(g,t,a,p,y,k,I){const D=g.context,L=D.gl,F=g.useProgram("collisionBox"),V=[];let X=0,$=0;for(let de=0;de<p.length;de++){const Ge=p[de],Le=t.getTile(Ge),Ye=Le.getBucket(a);if(!Ye)continue;let $e=Ge.posMatrix;y[0]===0&&y[1]===0||($e=g.translatePosMatrix(Ge.posMatrix,Le,y,k));const lt=I?Ye.textCollisionBox:Ye.iconCollisionBox,We=Ye.collisionCircleArray;if(We.length>0){const zt=n.create(),kt=$e;n.mul(zt,Ye.placementInvProjMatrix,g.transform.glCoordMatrix),n.mul(zt,zt,Ye.placementViewportMatrix),V.push({circleArray:We,circleOffset:$,transform:kt,invTransform:zt,coord:Ge}),X+=We.length/4,$=X}lt&&F.draw(D,L.LINES,yi.disabled,ji.disabled,g.colorModeForRenderPass(),Ki.disabled,Kr($e,g.transform,Le),g.style.terrain&&g.style.terrain.getTerrainData(Ge),a.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,null,g.transform.zoom,null,null,lt.collisionVertexBuffer)}if(!I||!V.length)return;const ue=g.useProgram("collisionCircle"),se=new n.CollisionCircleLayoutArray;se.resize(4*X),se._trim();let le=0;for(const de of V)for(let Ge=0;Ge<de.circleArray.length/4;Ge++){const Le=4*Ge,Ye=de.circleArray[Le+0],$e=de.circleArray[Le+1],lt=de.circleArray[Le+2],We=de.circleArray[Le+3];se.emplace(le++,Ye,$e,lt,We,0),se.emplace(le++,Ye,$e,lt,We,1),se.emplace(le++,Ye,$e,lt,We,2),se.emplace(le++,Ye,$e,lt,We,3)}(!Zs||Zs.length<2*X)&&(Zs=function(de){const Ge=2*de,Le=new n.QuadTriangleArray;Le.resize(Ge),Le._trim();for(let Ye=0;Ye<Ge;Ye++){const $e=6*Ye;Le.uint16[$e+0]=4*Ye+0,Le.uint16[$e+1]=4*Ye+1,Le.uint16[$e+2]=4*Ye+2,Le.uint16[$e+3]=4*Ye+2,Le.uint16[$e+4]=4*Ye+3,Le.uint16[$e+5]=4*Ye+0}return Le}(X));const be=D.createIndexBuffer(Zs,!0),Ae=D.createVertexBuffer(se,n.collisionCircleLayout.members,!0);for(const de of V){const Ge={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(ze=g.transform).cameraToCenterDistance,u_viewport_size:[ze.width,ze.height]};ue.draw(D,L.TRIANGLES,yi.disabled,ji.disabled,g.colorModeForRenderPass(),Ki.disabled,Ge,g.style.terrain&&g.style.terrain.getTerrainData(de.coord),a.id,Ae,be,n.SegmentVector.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,g.transform.zoom,null,null,null)}var ze;Ae.destroy(),be.destroy()}Ki.disabled=new Ki(!1,1029,2305),Ki.backCCW=new Ki(!0,1029,2305);const eu=n.identity(new Float32Array(16));function tu(g,t,a,p,y,k){const{horizontalAlign:I,verticalAlign:D}=n.getAnchorAlignment(g),L=-(I-.5)*t,F=-(D-.5)*a,V=n.evaluateVariableOffset(g,p);return new n.pointGeometry((L/y+V[0])*k,(F/y+V[1])*k)}function Ll(g,t,a,p,y,k,I,D,L,F,V){const X=g.text.placedSymbolArray,$=g.text.dynamicLayoutVertexArray,ue=g.icon.dynamicLayoutVertexArray,se={};$.clear();for(let le=0;le<X.length;le++){const be=X.get(le),Ae=g.allowVerticalPlacement&&!be.placedOrientation,ze=be.hidden||!be.crossTileID||Ae?null:p[be.crossTileID];if(ze){const de=new n.pointGeometry(be.anchorX,be.anchorY),Ge=di(de,a?I:k,V),Le=Ei(y.cameraToCenterDistance,Ge.signedDistanceFromCamera);let Ye=n.evaluateSizeForFeature(g.textSizeData,L,be)*Le/n.ONE_EM;a&&(Ye*=g.tilePixelRatio/D);const{width:$e,height:lt,anchor:We,textOffset:zt,textBoxScale:kt}=ze,Dt=tu(We,$e,lt,zt,kt,Ye),ai=a?di(de.add(Dt),k,V).point:Ge.point.add(t?Dt.rotate(-y.angle):Dt),hi=g.allowVerticalPlacement&&be.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let Ht=0;Ht<be.numGlyphs;Ht++)n.addDynamicAttributes($,ai,hi);F&&be.associatedIconIndex>=0&&(se[be.associatedIconIndex]={shiftedAnchor:ai,angle:hi})}else ti(be.numGlyphs,$)}if(F){ue.clear();const le=g.icon.placedSymbolArray;for(let be=0;be<le.length;be++){const Ae=le.get(be);if(Ae.hidden)ti(Ae.numGlyphs,ue);else{const ze=se[be];if(ze)for(let de=0;de<Ae.numGlyphs;de++)n.addDynamicAttributes(ue,ze.shiftedAnchor,ze.angle);else ti(Ae.numGlyphs,ue)}}g.icon.dynamicLayoutVertexBuffer.updateData(ue)}g.text.dynamicLayoutVertexBuffer.updateData($)}function iu(g,t,a){return a.iconsInText&&t?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function zo(g,t,a,p,y,k,I,D,L,F,V,X){const $=g.context,ue=$.gl,se=g.transform,le=D==="map",be=L==="map",Ae=D!=="viewport"&&a.layout.get("symbol-placement")!=="point",ze=le&&!be&&!Ae,de=!a.layout.get("symbol-sort-key").isConstant();let Ge=!1;const Le=g.depthModeForSublayer(0,yi.ReadOnly),Ye=a.layout.get("text-variable-anchor"),$e=[];for(const lt of p){const We=t.getTile(lt),zt=We.getBucket(a);if(!zt)continue;const kt=y?zt.text:zt.icon;if(!kt||!kt.segments.get().length)continue;const Dt=kt.programConfigurations.get(a.id),ai=y||zt.sdfIcons,hi=y?zt.textSizeData:zt.iconSizeData,Ht=be||se.pitch!==0,Mi=g.useProgram(iu(ai,y,zt),Dt),Di=n.evaluateSizeForZoom(hi,se.zoom),vi=g.style.terrain&&g.style.terrain.getTerrainData(lt);let Si,Ri,vn,vr,cr=[0,0],br=null;if(y){if(Ri=We.glyphAtlasTexture,vn=ue.LINEAR,Si=We.glyphAtlasTexture.size,zt.iconsInText){cr=We.imageAtlasTexture.size,br=We.imageAtlasTexture;const sr=hi.kind==="composite"||hi.kind==="camera";vr=Ht||g.options.rotating||g.options.zooming||sr?ue.LINEAR:ue.NEAREST}}else{const sr=a.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear;Ri=We.imageAtlasTexture,vn=ai||g.options.rotating||g.options.zooming||sr||Ht?ue.LINEAR:ue.NEAREST,Si=We.imageAtlasTexture.size}const Vr=an(We,1,g.transform.zoom),rr=Wn(lt.posMatrix,be,le,g.transform,Vr),jn=nn(lt.posMatrix,be,le,g.transform,Vr),Ar=Ye&&zt.hasTextData(),No=a.layout.get("icon-text-fit")!=="none"&&Ar&&zt.hasIconData();if(Ae){const sr=g.style.terrain?(Ra,zs)=>g.style.terrain.getElevation(lt,Ra,zs):null,es=a.layout.get("text-rotation-alignment")==="map";Sn(zt,lt.posMatrix,g,y,rr,jn,be,F,es,sr)}const fn=g.translatePosMatrix(lt.posMatrix,We,k,I),pi=Ae||y&&Ye||No?eu:rr,Ci=g.translatePosMatrix(jn,We,k,I,!0),bn=ai&&a.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xn;xn=ai?zt.iconsInText?El(hi.kind,Di,ze,be,g,fn,pi,Ci,Si,cr):So(hi.kind,Di,ze,be,g,fn,pi,Ci,y,Si,!0):ca(hi.kind,Di,ze,be,g,fn,pi,Ci,y,Si);const Yi={program:Mi,buffers:kt,uniformValues:xn,atlasTexture:Ri,atlasTextureIcon:br,atlasInterpolation:vn,atlasInterpolationIcon:vr,isSDF:ai,hasHalo:bn};if(de&&zt.canOverlap){Ge=!0;const sr=kt.segments.get();for(const es of sr)$e.push({segments:new n.SegmentVector([es]),sortKey:es.sortKey,state:Yi,terrainData:vi})}else $e.push({segments:kt.segments,sortKey:0,state:Yi,terrainData:vi})}Ge&&$e.sort((lt,We)=>lt.sortKey-We.sortKey);for(const lt of $e){const We=lt.state;if($.activeTexture.set(ue.TEXTURE0),We.atlasTexture.bind(We.atlasInterpolation,ue.CLAMP_TO_EDGE),We.atlasTextureIcon&&($.activeTexture.set(ue.TEXTURE1),We.atlasTextureIcon&&We.atlasTextureIcon.bind(We.atlasInterpolationIcon,ue.CLAMP_TO_EDGE)),We.isSDF){const zt=We.uniformValues;We.hasHalo&&(zt.u_is_halo=1,Hs(We.buffers,lt.segments,a,g,We.program,Le,V,X,zt,lt.terrainData)),zt.u_is_halo=0}Hs(We.buffers,lt.segments,a,g,We.program,Le,V,X,We.uniformValues,lt.terrainData)}}function Hs(g,t,a,p,y,k,I,D,L,F){const V=p.context;y.draw(V,V.gl.TRIANGLES,k,I,D,Ki.disabled,L,F,a.id,g.layoutVertexBuffer,g.indexBuffer,t,a.paint,p.transform.zoom,g.programConfigurations.get(a.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Ws(g,t,a,p,y,k,I){const D=g.context.gl,L=a.paint.get("fill-pattern"),F=L&&L.constantOr(1),V=a.getCrossfadeParameters();let X,$,ue,se,le;I?($=F&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=D.LINES):($=F?"fillPattern":"fill",X=D.TRIANGLES);for(const be of p){const Ae=t.getTile(be);if(F&&!Ae.patternsLoaded())continue;const ze=Ae.getBucket(a);if(!ze)continue;const de=ze.programConfigurations.get(a.id),Ge=g.useProgram($,de),Le=g.style.terrain&&g.style.terrain.getTerrainData(be);F&&(g.context.activeTexture.set(D.TEXTURE0),Ae.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),de.updatePaintBuffers(V));const Ye=L.constantOr(null);if(Ye&&Ae.imageAtlas){const We=Ae.imageAtlas,zt=We.patternPositions[Ye.to.toString()],kt=We.patternPositions[Ye.from.toString()];zt&&kt&&de.setConstantPatternPositions(zt,kt)}const $e=Le?be:null,lt=g.translatePosMatrix($e?$e.posMatrix:be.posMatrix,Ae,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(I){se=ze.indexBuffer2,le=ze.segments2;const We=[D.drawingBufferWidth,D.drawingBufferHeight];ue=$==="fillOutlinePattern"&&F?xl(lt,g,V,Ae,We):bl(lt,We)}else se=ze.indexBuffer,le=ze.segments,ue=F?aa(lt,g,V,Ae):bo(lt);Ge.draw(g.context,X,y,g.stencilModeForClipping(be),k,Ki.disabled,ue,Le,a.id,ze.layoutVertexBuffer,se,le,a.paint,g.transform.zoom,de)}}function Xs(g,t,a,p,y,k,I){const D=g.context,L=D.gl,F=a.paint.get("fill-extrusion-pattern"),V=F.constantOr(1),X=a.getCrossfadeParameters(),$=a.paint.get("fill-extrusion-opacity");for(const ue of p){const se=t.getTile(ue),le=se.getBucket(a);if(!le)continue;const be=g.style.terrain&&g.style.terrain.getTerrainData(ue),Ae=le.programConfigurations.get(a.id),ze=g.useProgram(V?"fillExtrusionPattern":"fillExtrusion",Ae);V&&(g.context.activeTexture.set(L.TEXTURE0),se.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ae.updatePaintBuffers(X));const de=F.constantOr(null);if(de&&se.imageAtlas){const $e=se.imageAtlas,lt=$e.patternPositions[de.to.toString()],We=$e.patternPositions[de.from.toString()];lt&&We&&Ae.setConstantPatternPositions(lt,We)}const Ge=g.translatePosMatrix(ue.posMatrix,se,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Le=a.paint.get("fill-extrusion-vertical-gradient"),Ye=V?qc(Ge,g,Le,$,ue,X,se):oa(Ge,g,Le,$);ze.draw(D,D.gl.TRIANGLES,y,k,I,Ki.backCCW,Ye,be,a.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,a.paint,g.transform.zoom,Ae,g.style.terrain&&le.centroidVertexBuffer)}}function wa(g,t,a,p,y,k,I){const D=g.context,L=D.gl,F=a.fbo;if(!F)return;const V=g.useProgram("hillshade"),X=g.style.terrain&&g.style.terrain.getTerrainData(t);D.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.colorAttachment.get()),V.draw(D,L.TRIANGLES,y,k,I,Ki.disabled,(($,ue,se,le)=>{const be=se.paint.get("hillshade-shadow-color"),Ae=se.paint.get("hillshade-highlight-color"),ze=se.paint.get("hillshade-accent-color");let de=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(de-=$.transform.angle);const Ge=!$.options.moving;return{u_matrix:le?le.posMatrix:$.transform.calculatePosMatrix(ue.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:wo(0,ue.tileID),u_light:[se.paint.get("hillshade-exaggeration"),de],u_shadow:be,u_highlight:Ae,u_accent:ze}})(g,a,p,X?t:null),X,p.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function Bl(g,t,a,p,y,k){const I=g.context,D=I.gl,L=t.dem;if(L&&L.data){const F=L.dim,V=L.stride,X=L.getPixels();if(I.activeTexture.set(D.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||g.getTileTexture(V),t.demTexture){const ue=t.demTexture;ue.update(X,{premultiply:!1}),ue.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else t.demTexture=new C(I,X,D.RGBA,{premultiply:!1}),t.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);I.activeTexture.set(D.TEXTURE0);let $=t.fbo;if(!$){const ue=new C(I,{width:F,height:F,data:null},D.RGBA);ue.bind(D.LINEAR,D.CLAMP_TO_EDGE),$=t.fbo=I.createFramebuffer(F,F,!0),$.colorAttachment.set(ue.texture)}I.bindFramebuffer.set($.framebuffer),I.viewport.set([0,0,F,F]),g.useProgram("hillshadePrepare").draw(I,D.TRIANGLES,p,y,k,Ki.disabled,((ue,se)=>{const le=se.stride,be=n.create();return n.ortho(be,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(be,be,[0,-n.EXTENT,0]),{u_matrix:be,u_image:1,u_dimension:[le,le],u_zoom:ue.overscaledZ,u_unpack:se.getUnpackVector()}})(t.tileID,L),null,a.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Mo(g,t,a,p,y,k){const I=p.paint.get("raster-fade-duration");if(!k&&I>0){const D=n.exported.now(),L=(D-g.timeAdded)/I,F=t?(D-t.timeAdded)/I:-1,V=a.getSource(),X=y.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),$=!t||Math.abs(t.tileID.overscaledZ-X)>Math.abs(g.tileID.overscaledZ-X),ue=$&&g.refreshedUponExpiration?1:n.clamp($?L:1-F,0,1);return g.refreshedUponExpiration&&L>=1&&(g.refreshedUponExpiration=!1),t?{opacity:1,mix:1-ue}:{opacity:ue,mix:0}}return{opacity:1,mix:0}}const Do=new n.Color(1,0,0,1),lr=new n.Color(0,1,0,1),Rl=new n.Color(0,0,1,1),ka=new n.Color(1,0,1,1),Ol=new n.Color(0,1,1,1);function Yr(g,t,a,p){Ts(g,0,t+a/2,g.transform.width,a,p)}function Ks(g,t,a,p){Ts(g,t-a/2,0,a,g.transform.height,p)}function Ts(g,t,a,p,y,k){const I=g.context,D=I.gl;D.enable(D.SCISSOR_TEST),D.scissor(t*g.pixelRatio,a*g.pixelRatio,p*g.pixelRatio,y*g.pixelRatio),I.clear({color:k}),D.disable(D.SCISSOR_TEST)}function nu(g,t,a){const p=g.context,y=p.gl,k=a.posMatrix,I=g.useProgram("debug"),D=yi.disabled,L=ji.disabled,F=g.colorModeForRenderPass(),V="$debug",X=g.style.terrain&&g.style.terrain.getTerrainData(a);p.activeTexture.set(y.TEXTURE0),g.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE);const $=t.getTileByID(a.key).latestRawTileData,ue=Math.floor(($&&$.byteLength||0)/1024),se=t.getTile(a).tileSize,le=512/Math.min(se,512)*(a.overscaledZ/g.transform.zoom)*.5;let be=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(be+=` => ${a.overscaledZ}`),function(Ae,ze){Ae.initDebugOverlayCanvas();const de=Ae.debugOverlayCanvas,Ge=Ae.context.gl,Le=Ae.debugOverlayCanvas.getContext("2d");Le.clearRect(0,0,de.width,de.height),Le.shadowColor="white",Le.shadowBlur=2,Le.lineWidth=1.5,Le.strokeStyle="white",Le.textBaseline="top",Le.font="bold 36px Open Sans, sans-serif",Le.fillText(ze,5,5),Le.strokeText(ze,5,5),Ae.debugOverlayTexture.update(de),Ae.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(g,`${be} ${ue}kB`),I.draw(p,y.TRIANGLES,D,L,qi.alphaBlended,Ki.disabled,Us(k,n.Color.transparent,le),null,V,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),I.draw(p,y.LINE_STRIP,D,L,F,Ki.disabled,Us(k,n.Color.red),X,V,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Lo(g,t,a){const p=g.context,y=p.gl,k=g.colorModeForRenderPass(),I=new yi(y.LEQUAL,yi.ReadWrite,g.depthRangeFor3D),D=g.useProgram("terrain"),L=t.getTerrainMesh(),F=t.getTerrainData(a.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,g.width,g.height]),p.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const V=g.transform.calculatePosMatrix(a.tileID.toUnwrapped());D.draw(p,y.TRIANGLES,I,ji.disabled,k,Ki.backCCW,{u_matrix:V,u_texture:0},F,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}function Fl(g,t,a,p){const y=g.context,k=a.tileSize*t.qualityFactor;a.textures[p]||(a.textures[p]=g.getTileTexture(k)||new C(y,{width:k,height:k,data:null},y.gl.RGBA),a.textures[p].bind(y.gl.LINEAR,y.gl.CLAMP_TO_EDGE),p===0&&t.sourceCache.renderHistory.unshift(a.tileID.key));const I=t.getRTTFramebuffer();I.colorAttachment.set(a.textures[p].texture),y.bindFramebuffer.set(I.framebuffer),y.viewport.set([0,0,k,k])}class Nl{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,a=t.terrain;for(const p in t.sourceCaches){this._coordsDescendingInv[p]={};const y=t.sourceCaches[p].getVisibleCoordinates();for(const k of y){const I=a.sourceCache.getTerrainCoords(k);for(const D in I)this._coordsDescendingInv[p][D]||(this._coordsDescendingInv[p][D]=[]),this._coordsDescendingInv[p][D].push(I[D])}}for(const p of t._order){const y=t._layers[p],k=y.source;if(this._renderToTexture[y.type]&&!this._coordsDescendingInvStr[k]){this._coordsDescendingInvStr[k]={};for(const I in this._coordsDescendingInv[k])this._coordsDescendingInvStr[k][I]=this._coordsDescendingInv[k][I].map(D=>D.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const y in this._coordsDescendingInvStr){const k=this._coordsDescendingInvStr[y][p.tileID.key];k&&k!==p.textureCoords[y]&&p.clearTextures(this.painter),a.needsRerender(y,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),a.clearRerenderCache(),a.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const a=t.type,p=this.painter,y=p.style._order,k=p.currentLayer,I=k+1===y.length;if(this._renderToTexture[a]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(y[k]),!I))return!0;if(this._renderToTexture[this._prevType]||a==="hillshade"||this._renderToTexture[a]&&I){this._prevType=a;const D=this._stacks.length-1,L=this._stacks[D]||[];for(const F of this._renderableTiles){if(Fl(p,p.style.terrain,F,D),this._rerender[F.tileID.key]){p.context.clear({color:n.Color.transparent});for(let V=0;V<L.length;V++){const X=p.style._layers[L[V]],$=X.source?this._coordsDescendingInv[X.source][F.tileID.key]:[F.tileID];p._renderTileClippingMasks(X,$),p.renderLayer(p,p.style.sourceCaches[X.source],X,$),X.source&&(F.textureCoords[X.source]=this._coordsDescendingInvStr[X.source][F.tileID.key])}}Lo(p,p.style.terrain,F)}if(a==="hillshade"){this._stacks.push([y[k]]);for(const F of this._renderableTiles){const V=this._coordsDescendingInv[t.source][F.tileID.key];Fl(p,p.style.terrain,F,this._stacks.length-1),p.context.clear({color:n.Color.transparent}),p._renderTileClippingMasks(t,V),p.renderLayer(p,p.style.sourceCaches[t.source],t,V),Lo(p,p.style.terrain,F)}return!0}return this._renderToTexture[a]}return!1}}const Js={symbol:function(g,t,a,p,y){if(g.renderPass!=="translucent")return;const k=ji.disabled,I=g.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(D,L,F,V,X,$,ue){const se=L.transform,le=X==="map",be=$==="map";for(const Ae of D){const ze=V.getTile(Ae),de=ze.getBucket(F);if(!de||!de.text||!de.text.segments.get().length)continue;const Ge=n.evaluateSizeForZoom(de.textSizeData,se.zoom),Le=an(ze,1,L.transform.zoom),Ye=Wn(Ae.posMatrix,be,le,L.transform,Le),$e=F.layout.get("icon-text-fit")!=="none"&&de.hasIconData();if(Ge){const lt=Math.pow(2,se.zoom-ze.tileID.overscaledZ);Ll(de,le,be,ue,se,Ye,Ae.posMatrix,lt,Ge,$e,L.style.terrain?(We,zt)=>L.style.terrain.getElevation(Ae,We,zt):null)}}}(p,g,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),y),a.paint.get("icon-opacity").constantOr(1)!==0&&zo(g,t,a,p,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),k,I),a.paint.get("text-opacity").constantOr(1)!==0&&zo(g,t,a,p,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),k,I),t.map.showCollisionBoxes&&(Es(g,t,a,p,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Es(g,t,a,p,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(g,t,a,p){if(g.renderPass!=="translucent")return;const y=a.paint.get("circle-opacity"),k=a.paint.get("circle-stroke-width"),I=a.paint.get("circle-stroke-opacity"),D=!a.layout.get("circle-sort-key").isConstant();if(y.constantOr(1)===0&&(k.constantOr(1)===0||I.constantOr(1)===0))return;const L=g.context,F=L.gl,V=g.depthModeForSublayer(0,yi.ReadOnly),X=ji.disabled,$=g.colorModeForRenderPass(),ue=[];for(let se=0;se<p.length;se++){const le=p[se],be=t.getTile(le),Ae=be.getBucket(a);if(!Ae)continue;const ze=Ae.programConfigurations.get(a.id),de=g.useProgram("circle",ze),Ge=Ae.layoutVertexBuffer,Le=Ae.indexBuffer,Ye=g.style.terrain&&g.style.terrain.getTerrainData(le),$e={programConfiguration:ze,program:de,layoutVertexBuffer:Ge,indexBuffer:Le,uniformValues:wl(g,le,be,a),terrainData:Ye};if(D){const lt=Ae.segments.get();for(const We of lt)ue.push({segments:new n.SegmentVector([We]),sortKey:We.sortKey,state:$e})}else ue.push({segments:Ae.segments,sortKey:0,state:$e})}D&&ue.sort((se,le)=>se.sortKey-le.sortKey);for(const se of ue){const{programConfiguration:le,program:be,layoutVertexBuffer:Ae,indexBuffer:ze,uniformValues:de,terrainData:Ge}=se.state;be.draw(L,F.TRIANGLES,V,X,$,Ki.disabled,de,Ge,a.id,Ae,ze,se.segments,a.paint,g.transform.zoom,le)}},heatmap:function(g,t,a,p){if(a.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const y=g.context,k=y.gl,I=ji.disabled,D=new qi([k.ONE,k.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(L,F,V){const X=L.gl;L.activeTexture.set(X.TEXTURE1),L.viewport.set([0,0,F.width/4,F.height/4]);let $=V.heatmapFbo;if($)X.bindTexture(X.TEXTURE_2D,$.colorAttachment.get()),L.bindFramebuffer.set($.framebuffer);else{const ue=X.createTexture();X.bindTexture(X.TEXTURE_2D,ue),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),$=V.heatmapFbo=L.createFramebuffer(F.width/4,F.height/4,!1),function(se,le,be,Ae){const ze=se.gl;ze.texImage2D(ze.TEXTURE_2D,0,ze.RGBA,le.width/4,le.height/4,0,ze.RGBA,se.extRenderToTextureHalfFloat?se.extTextureHalfFloat.HALF_FLOAT_OES:ze.UNSIGNED_BYTE,null),Ae.colorAttachment.set(be)}(L,F,ue,$)}})(y,g,a),y.clear({color:n.Color.transparent});for(let L=0;L<p.length;L++){const F=p[L];if(t.hasRenderableParent(F))continue;const V=t.getTile(F),X=V.getBucket(a);if(!X)continue;const $=X.programConfigurations.get(a.id),ue=g.useProgram("heatmap",$),{zoom:se}=g.transform;ue.draw(y,k.TRIANGLES,yi.disabled,I,D,Ki.disabled,xo(F.posMatrix,V,se,a.paint.get("heatmap-intensity")),null,a.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,a.paint,g.transform.zoom,$)}y.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(y,k){const I=y.context,D=I.gl,L=k.heatmapFbo;if(!L)return;I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,L.colorAttachment.get()),I.activeTexture.set(D.TEXTURE1);let F=k.colorRampTexture;F||(F=k.colorRampTexture=new C(I,k.colorRamp,D.RGBA)),F.bind(D.LINEAR,D.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(I,D.TRIANGLES,yi.disabled,ji.disabled,y.colorModeForRenderPass(),Ki.disabled,((V,X,$,ue)=>{const se=n.create();n.ortho(se,0,V.width,V.height,0,0,1);const le=V.context.gl;return{u_matrix:se,u_world:[le.drawingBufferWidth,le.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}})(y,k),null,k.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,k.paint,y.transform.zoom)}(g,a))},line:function(g,t,a,p){if(g.renderPass!=="translucent")return;const y=a.paint.get("line-opacity"),k=a.paint.get("line-width");if(y.constantOr(1)===0||k.constantOr(1)===0)return;const I=g.depthModeForSublayer(0,yi.ReadOnly),D=g.colorModeForRenderPass(),L=a.paint.get("line-dasharray"),F=a.paint.get("line-pattern"),V=F.constantOr(1),X=a.paint.get("line-gradient"),$=a.getCrossfadeParameters(),ue=V?"linePattern":L?"lineSDF":X?"lineGradient":"line",se=g.context,le=se.gl;let be=!0;for(const Ae of p){const ze=t.getTile(Ae);if(V&&!ze.patternsLoaded())continue;const de=ze.getBucket(a);if(!de)continue;const Ge=de.programConfigurations.get(a.id),Le=g.context.program.get(),Ye=g.useProgram(ue,Ge),$e=be||Ye.program!==Le,lt=g.style.terrain&&g.style.terrain.getTerrainData(Ae),We=F.constantOr(null);if(We&&ze.imageAtlas){const Dt=ze.imageAtlas,ai=Dt.patternPositions[We.to.toString()],hi=Dt.patternPositions[We.from.toString()];ai&&hi&&Ge.setConstantPatternPositions(ai,hi)}const zt=lt?Ae:null,kt=V?ko(g,ze,a,$,zt):L?Vs(g,ze,a,L,$,zt):X?la(g,ze,a,de.lineClipsArray.length,zt):xs(g,ze,a,zt);if(V)se.activeTexture.set(le.TEXTURE0),ze.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Ge.updatePaintBuffers($);else if(L&&($e||g.lineAtlas.dirty))se.activeTexture.set(le.TEXTURE0),g.lineAtlas.bind(se);else if(X){const Dt=de.gradients[a.id];let ai=Dt.texture;if(a.gradientVersion!==Dt.version){let hi=256;if(a.stepInterpolant){const Ht=t.getSource().maxzoom,Mi=Ae.canonical.z===Ht?Math.ceil(1<<g.transform.maxZoom-Ae.canonical.z):1;hi=n.clamp(n.nextPowerOfTwo(de.maxLineLength/n.EXTENT*1024*Mi),256,se.maxTextureSize)}Dt.gradient=n.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:hi,image:Dt.gradient||void 0,clips:de.lineClipsArray}),Dt.texture?Dt.texture.update(Dt.gradient):Dt.texture=new C(se,Dt.gradient,le.RGBA),Dt.version=a.gradientVersion,ai=Dt.texture}se.activeTexture.set(le.TEXTURE0),ai.bind(a.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}Ye.draw(se,le.TRIANGLES,I,g.stencilModeForClipping(Ae),D,Ki.disabled,kt,lt,a.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,a.paint,g.transform.zoom,Ge,de.layoutVertexBuffer2),be=!1}},fill:function(g,t,a,p){const y=a.paint.get("fill-color"),k=a.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const I=g.colorModeForRenderPass(),D=a.paint.get("fill-pattern"),L=g.opaquePassEnabledForLayer()&&!D.constantOr(1)&&y.constantOr(n.Color.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===L){const F=g.depthModeForSublayer(1,g.renderPass==="opaque"?yi.ReadWrite:yi.ReadOnly);Ws(g,t,a,p,F,I,!1)}if(g.renderPass==="translucent"&&a.paint.get("fill-antialias")){const F=g.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,yi.ReadOnly);Ws(g,t,a,p,F,I,!0)}},"fill-extrusion":function(g,t,a,p){const y=a.paint.get("fill-extrusion-opacity");if(y!==0&&g.renderPass==="translucent"){const k=new yi(g.context.gl.LEQUAL,yi.ReadWrite,g.depthRangeFor3D);if(y!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Xs(g,t,a,p,k,ji.disabled,qi.disabled),Xs(g,t,a,p,k,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const I=g.colorModeForRenderPass();Xs(g,t,a,p,k,ji.disabled,I)}}},hillshade:function(g,t,a,p){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const y=g.context,k=g.depthModeForSublayer(0,yi.ReadOnly),I=g.colorModeForRenderPass(),[D,L]=g.renderPass==="translucent"?g.stencilConfigForOverlap(p):[{},p];for(const F of L){const V=t.getTile(F);V.needsHillshadePrepare!==void 0&&V.needsHillshadePrepare&&g.renderPass==="offscreen"?Bl(g,V,a,k,ji.disabled,I):g.renderPass==="translucent"&&wa(g,F,V,a,k,D[F.overscaledZ],I)}y.viewport.set([0,0,g.width,g.height])},raster:function(g,t,a,p){if(g.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!p.length)return;const y=g.context,k=y.gl,I=t.getSource(),D=g.useProgram("raster"),L=g.colorModeForRenderPass(),[F,V]=I instanceof Qe?[{},p]:g.stencilConfigForOverlap(p),X=V[V.length-1].overscaledZ,$=!g.options.moving;for(const ue of V){const se=g.depthModeForSublayer(ue.overscaledZ-X,a.paint.get("raster-opacity")===1?yi.ReadWrite:yi.ReadOnly,k.LESS),le=t.getTile(ue);le.registerFadeDuration(a.paint.get("raster-fade-duration"));const be=t.findLoadedParent(ue,0),Ae=Mo(le,be,t,a,g.transform,g.style.terrain);let ze,de;const Ge=a.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;y.activeTexture.set(k.TEXTURE0),le.texture.bind(Ge,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(k.TEXTURE1),be?(be.texture.bind(Ge,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,be.tileID.overscaledZ-le.tileID.overscaledZ),de=[le.tileID.canonical.x*ze%1,le.tileID.canonical.y*ze%1]):le.texture.bind(Ge,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const Le=g.style.terrain&&g.style.terrain.getTerrainData(ue),Ye=Le?ue:null,$e=Ye?Ye.posMatrix:g.transform.calculatePosMatrix(ue.toUnwrapped(),$),lt=kl($e,de||[0,0],ze||1,Ae,a);I instanceof Qe?D.draw(y,k.TRIANGLES,se,ji.disabled,L,Ki.disabled,lt,Le,a.id,I.boundsBuffer,g.quadTriangleIndexBuffer,I.boundsSegments):D.draw(y,k.TRIANGLES,se,F[ue.overscaledZ],L,Ki.disabled,lt,Le,a.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}},background:function(g,t,a,p){const y=a.paint.get("background-color"),k=a.paint.get("background-opacity");if(k===0)return;const I=g.context,D=I.gl,L=g.transform,F=L.tileSize,V=a.paint.get("background-pattern");if(g.isPatternMissing(V))return;const X=!V&&y.a===1&&k===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==X)return;const $=ji.disabled,ue=g.depthModeForSublayer(0,X==="opaque"?yi.ReadWrite:yi.ReadOnly),se=g.colorModeForRenderPass(),le=g.useProgram(V?"backgroundPattern":"background"),be=p||L.coveringTiles({tileSize:F,terrain:g.style.terrain});V&&(I.activeTexture.set(D.TEXTURE0),g.imageManager.bind(g.context));const Ae=a.getCrossfadeParameters();for(const ze of be){const de=p?ze.posMatrix:g.transform.calculatePosMatrix(ze.toUnwrapped()),Ge=V?Hc(de,k,g,V,{tileID:ze,tileSize:F},Ae):Zc(de,k,y),Le=g.style.terrain&&g.style.terrain.getTerrainData(ze);le.draw(I,D.TRIANGLES,ue,$,se,Ki.disabled,Ge,Le,a.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}},debug:function(g,t,a){for(let p=0;p<a.length;p++)nu(g,t,a[p])},custom:function(g,t,a){const p=g.context,y=a.implementation;if(g.renderPass==="offscreen"){const k=y.prerender;k&&(g.setCustomLayerDefaults(),p.setColorMode(g.colorModeForRenderPass()),k.call(y,p.gl,g.transform.customLayerMatrix()),p.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),p.setColorMode(g.colorModeForRenderPass()),p.setStencilMode(ji.disabled);const k=y.renderingMode==="3d"?new yi(g.context.gl.LEQUAL,yi.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,yi.ReadOnly);p.setDepthMode(k),y.render(p.gl,g.transform.customLayerMatrix()),p.setDirty(),g.setBaseState(),p.bindFramebuffer.set(null)}}};class Sa{constructor(t,a){this.context=new Dl(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:n.create(),renderTime:0},this.setup(),this.numSublayers=et.maxUnderzooming+et.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ii,this.gpuTimers={}}resize(t,a,p){if(this.width=t*p,this.height=a*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const t=this.context,a=new n.PosArray;a.emplaceBack(0,0),a.emplaceBack(n.EXTENT,0),a.emplaceBack(0,n.EXTENT),a.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(a,wi.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const p=new n.PosArray;p.emplaceBack(0,0),p.emplaceBack(n.EXTENT,0),p.emplaceBack(0,n.EXTENT),p.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=t.createVertexBuffer(p,wi.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const y=new n.RasterBoundsArray;y.emplaceBack(0,0,0,0),y.emplaceBack(n.EXTENT,0,n.EXTENT,0),y.emplaceBack(0,n.EXTENT,0,n.EXTENT),y.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(y,Zt.members),this.rasterBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const k=new n.PosArray;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(k,wi.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const I=new n.LineStripIndexArray;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(I);const D=new n.TriangleIndexArray;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D),this.emptyTexture=new C(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const L=this.context.gl;this.stencilClearMode=new ji({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=n.create();n.ortho(p,0,this.width,this.height,0,0,1),n.scale(p,p,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,a.TRIANGLES,yi.disabled,this.stencilClearMode,qi.disabled,Ki.disabled,bs(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source;const p=this.context,y=p.gl;this.nextStencilID+a.length>256&&this.clearStencil(),p.setColorMode(qi.disabled),p.setDepthMode(yi.disabled);const k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of a){const D=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,L=this.style.terrain&&this.style.terrain.getTerrainData(I);k.draw(p,y.TRIANGLES,yi.disabled,new ji({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),qi.disabled,Ki.disabled,bs(I.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new ji({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new ji({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,p=t.sort((I,D)=>D.overscaledZ-I.overscaledZ),y=p[p.length-1].overscaledZ,k=p[0].overscaledZ-y+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const I={};for(let D=0;D<k;D++)I[D+y]=new ji({func:a.GEQUAL,mask:255},D+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=k,[I,p]}return[{[y]:ji.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new qi([t.CONSTANT_COLOR,t.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qi.unblended:qi.alphaBlended}depthModeForSublayer(t,a,p){if(!this.opaquePassEnabledForLayer())return yi.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new yi(p||this.context.gl.LEQUAL,a,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.exported.now()),this.imageManager.beginFrame();const p=this.style._order,y=this.style.sourceCaches,k=this.style.terrain&&new Nl(this);for(const F in y){const V=y[F];V.used&&V.prepare(this.context)}const I={},D={},L={};for(const F in y){const V=y[F];I[F]=V.getVisibleCoordinates(),D[F]=I[F].slice().reverse(),L[F]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<p.length;F++)if(this.style._layers[p[F]].is3D()){this.opaquePassCutoff=F;break}if(k){this.opaquePassCutoff=0;const F=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!n.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||F.length)&&(n.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(V,X){const $=V.context,ue=$.gl,se=qi.unblended,le=new yi(ue.LEQUAL,yi.ReadWrite,[0,1]),be=X.getTerrainMesh(),Ae=X.sourceCache.getRenderableTiles(),ze=V.useProgram("terrainDepth");$.bindFramebuffer.set(X.getFramebuffer("depth").framebuffer),$.viewport.set([0,0,V.width/devicePixelRatio,V.height/devicePixelRatio]),$.clear({color:n.Color.transparent,depth:1});for(const de of Ae){const Ge=X.getTerrainData(de.tileID),Le=V.transform.calculatePosMatrix(de.tileID.toUnwrapped());ze.draw($,ue.TRIANGLES,le,ji.disabled,se,Ki.backCCW,{u_matrix:Le},Ge,"terrain",be.vertexBuffer,be.indexBuffer,be.segments)}$.bindFramebuffer.set(null),$.viewport.set([0,0,V.width,V.height])}(this,this.style.terrain),function(V,X){const $=V.context,ue=$.gl,se=qi.unblended,le=new yi(ue.LEQUAL,yi.ReadWrite,[0,1]),be=X.getTerrainMesh(),Ae=X.getCoordsTexture(),ze=X.sourceCache.getRenderableTiles(),de=V.useProgram("terrainCoords");$.bindFramebuffer.set(X.getFramebuffer("coords").framebuffer),$.viewport.set([0,0,V.width/devicePixelRatio,V.height/devicePixelRatio]),$.clear({color:n.Color.transparent,depth:1}),X.coordsIndex=[];for(const Ge of ze){const Le=X.getTerrainData(Ge.tileID);$.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,Ae.texture);const Ye=V.transform.calculatePosMatrix(Ge.tileID.toUnwrapped());de.draw($,ue.TRIANGLES,le,ji.disabled,se,Ki.backCCW,{u_matrix:Ye,u_terrain_coords_id:(255-X.coordsIndex.length)/255,u_texture:0},Le,"terrain",be.vertexBuffer,be.indexBuffer,be.segments),X.coordsIndex.push(Ge.tileID.key)}$.bindFramebuffer.set(null),$.viewport.set([0,0,V.width,V.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const F of p){const V=this.style._layers[F];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const X=D[V.source];(V.type==="custom"||X.length)&&this.renderLayer(this,y[V.source],V,X)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!k)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[p[this.currentLayer]],V=y[F.source],X=I[F.source];this._renderTileClippingMasks(F,X),this.renderLayer(this,V,F,X)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const F=this.style._layers[p[this.currentLayer]],V=y[F.source];if(k&&k.renderLayer(F))continue;const X=(F.type==="symbol"?L:D)[F.source];this._renderTileClippingMasks(F,I[F.source]),this.renderLayer(this,V,F,X)}if(this.options.showTileBoundaries){let F,V;Object.values(this.style._layers).forEach(X=>{X.source&&!X.isHidden(this.transform.zoom)&&(X.source!==(V&&V.id)&&(V=this.style.sourceCaches[X.source]),(!F||F.getSource().maxzoom<V.getSource().maxzoom)&&(F=V))}),F&&Js.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const V=F.transform.padding;Yr(F,F.transform.height-(V.top||0),3,Do),Yr(F,V.bottom||0,3,lr),Ks(F,V.left||0,3,Rl),Ks(F,F.transform.width-(V.right||0),3,ka);const X=F.transform.centerPoint;(function($,ue,se,le){Ts($,ue-1,se-10,2,20,le),Ts($,ue-10,se-1,20,2,le)})(F,X.x,F.transform.height-X.y,Ol)}(this),this.context.setDefault()}renderLayer(t,a,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(y||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),Js[p.type](t,a,p,y,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),p.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const a={};for(const p in t){const y=t[p],k=this.context.extTimerQuery,I=k.getQueryObjectEXT(y.query,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(y.query),a[p]=I}return a}translatePosMatrix(t,a,p,y,k){if(!p[0]&&!p[1])return t;const I=k?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(I){const F=Math.sin(I),V=Math.cos(I);p=[p[0]*V-p[1]*F,p[0]*F+p[1]*V]}const D=[k?p[0]:an(a,p[0],this.transform.zoom),k?p[1]:an(a,p[1],this.transform.zoom),0],L=new Float32Array(16);return n.translate(L,t,D),L}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!a||!p}useProgram(t,a){this.cache=this.cache||{};const p=t+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new yl(this.context,t,Ns[t],a,ua[t],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new C(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Bo{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,p){const y=Math.pow(2,p),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const L=1/(D=n.transformMat4([],D,t))[3]/a*y;return n.mul$1(D,D,[L,L,1/D[3],L])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const L=n.sub([],k[D[0]],k[D[1]]),F=n.sub([],k[D[2]],k[D[1]]),V=n.normalize([],n.cross([],L,F)),X=-n.dot(V,k[D[1]]);return V.concat(X)});return new Bo(k,I)}}class Ys{constructor(t,a){this.min=t,this.max=a,this.center=n.scale$1([],n.add([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],p=n.clone$2(this.min),y=n.clone$2(this.max);for(let k=0;k<a.length;k++)p[k]=a[k]?this.min[k]:this.center[k],y[k]=a[k]?this.center[k]:this.max[k];return y[2]=this.max[2],new Ys(p,y)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let y=0;y<t.planes.length;y++){const k=t.planes[y];let I=0;for(let D=0;D<a.length;D++)n.dot$1(k,a[D])>=0&&I++;if(I===0)return 0;I!==a.length&&(p=!1)}if(p)return 2;for(let y=0;y<3;y++){let k=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let D=0;D<t.points.length;D++){const L=t.points[D][y]-this.min[y];k=Math.min(k,L),I=Math.max(I,L)}if(I<0||k>this.max[y]-this.min[y])return 0}return 1}}class As{constructor(t=0,a=0,p=0,y=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=p,this.right=y}interpolate(t,a,p){return a.top!=null&&t.top!=null&&(this.top=n.number(t.top,a.top,p)),a.bottom!=null&&t.bottom!=null&&(this.bottom=n.number(t.bottom,a.bottom,p)),a.left!=null&&t.left!=null&&(this.left=n.number(t.left,a.left,p)),a.right!=null&&t.right!=null&&(this.right=n.number(t.right,a.right,p)),this}getCenter(t,a){const p=n.clamp((this.left+t-this.right)/2,0,t),y=n.clamp((this.top+a-this.bottom)/2,0,a);return new n.pointGeometry(p,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new As(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Qs{constructor(t,a,p,y,k){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=k===void 0||!!k,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=p??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new As,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Qs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const a=-n.wrap(t,-180,180)*Math.PI/180;var p;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(p=new n.ARRAY_TYPE(4),n.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(y,k,I){var D=k[0],L=k[1],F=k[2],V=k[3],X=Math.sin(I),$=Math.cos(I);y[0]=D*$+F*X,y[1]=L*$+V*X,y[2]=D*-X+F*$,y[3]=L*-X+V*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=n.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,p){this._unmodified=!1,this._edgeInsets.interpolate(t,a,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new n.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const p=this.pointCoordinate(new n.pointGeometry(0,0)),y=this.pointCoordinate(new n.pointGeometry(this.width,0)),k=this.pointCoordinate(new n.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new n.pointGeometry(0,this.height)),D=Math.floor(Math.min(p.x,y.x,k.x,I.x)),L=Math.floor(Math.max(p.x,y.x,k.x,I.x)),F=1;for(let V=D-F;V<=L+F;V++)V!==0&&a.push(new n.UnwrappedTileID(V,t))}return a}coveringTiles(t){var a,p;let y=this.coveringZoomLevel(t);const k=y;if(t.minzoom!==void 0&&y<t.minzoom)return[];t.maxzoom!==void 0&&y>t.maxzoom&&(y=t.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),D=n.MercatorCoordinate.fromLngLat(this.center),L=Math.pow(2,y),F=[L*I.x,L*I.y,0],V=[L*D.x,L*D.y,0],X=Bo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,y);let $=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=y);const ue=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,se=de=>({aabb:new Ys([de*L,0,0],[(de+1)*L,L,0]),zoom:0,x:0,y:0,wrap:de,fullyVisible:!1}),le=[],be=[],Ae=y,ze=t.reparseOverscaled?k:y;if(this._renderWorldCopies)for(let de=1;de<=3;de++)le.push(se(-de)),le.push(se(de));for(le.push(se(0));le.length>0;){const de=le.pop(),Ge=de.x,Le=de.y;let Ye=de.fullyVisible;if(!Ye){const Dt=de.aabb.intersects(X);if(Dt===0)continue;Ye=Dt===2}const $e=t.terrain?F:V,lt=de.aabb.distanceX($e),We=de.aabb.distanceY($e),zt=Math.max(Math.abs(lt),Math.abs(We)),kt=ue+(1<<Ae-de.zoom)-2;if(de.zoom===Ae||zt>kt&&de.zoom>=$){const Dt=Ae-de.zoom,ai=F[0]-.5-(Ge<<Dt),hi=F[1]-.5-(Le<<Dt);be.push({tileID:new n.OverscaledTileID(de.zoom===Ae?ze:de.zoom,de.wrap,de.zoom,Ge,Le),distanceSq:n.sqrLen([V[0]-.5-Ge,V[1]-.5-Le]),tileDistanceToCamera:Math.sqrt(ai*ai+hi*hi)})}else for(let Dt=0;Dt<4;Dt++){const ai=(Ge<<1)+Dt%2,hi=(Le<<1)+(Dt>>1),Ht=de.zoom+1;let Mi=de.aabb.quadrant(Dt);if(t.terrain){const Di=new n.OverscaledTileID(Ht,de.wrap,Ht,ai,hi),vi=t.terrain.getMinMaxElevation(Di),Si=(a=vi.minElevation)!==null&&a!==void 0?a:this.elevation,Ri=(p=vi.maxElevation)!==null&&p!==void 0?p:this.elevation;Mi=new Ys([Mi.min[0],Mi.min[1],Si],[Mi.max[0],Mi.max[1],Ri])}le.push({aabb:Mi,zoom:Ht,x:ai,y:hi,wrap:de.wrap,fullyVisible:Ye})}}return be.sort((de,Ge)=>de.distanceSq-Ge.distanceSq).map(de=>de.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=n.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new n.pointGeometry(n.mercatorXfromLng(t.lng)*this.worldSize,n.mercatorYfromLat(a)*this.worldSize)}unproject(t){return new n.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,a){const p=n.MercatorCoordinate.fromLngLat(t),y=(1<<this.tileZoom)*n.EXTENT,k=p.x*y,I=p.y*y,D=Math.floor(k/n.EXTENT),L=Math.floor(I/n.EXTENT),F=new n.OverscaledTileID(this.tileZoom,0,this.tileZoom,D,L);return a.getElevation(F,k%n.EXTENT,I%n.EXTENT,n.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const a=this.pointLocation(this.centerPoint,t),p=this.getElevation(a,t);if(!(this.elevation-p))return;const y=this.getCameraPosition(),k=n.MercatorCoordinate.fromLngLat(y.lngLat,y.altitude),I=n.MercatorCoordinate.fromLngLat(a,p),D=k.x-I.x,L=k.y-I.y,F=k.z-I.z,V=Math.sqrt(D*D+L*L+F*F),X=this.scaleZoom(this.cameraToCenterDistance/V/this.tileSize);this._elevation=p,this._center=a,this.zoom=X}setLocationAtPoint(t,a){const p=this.pointCoordinate(a),y=this.pointCoordinate(this.centerPoint),k=this.locationCoordinate(t),I=new n.MercatorCoordinate(k.x-(p.x-y.x),k.y-(p.y-y.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,a){return a?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,a),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,a){return this.coordinateLocation(this.pointCoordinate(t,a))}locationCoordinate(t){return n.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,a){if(a){const $=a.pointCoordinate(t);if($!=null)return $}const p=[t.x,t.y,0,1],y=[t.x,t.y,1,1];n.transformMat4(p,p,this.pixelMatrixInverse),n.transformMat4(y,y,this.pixelMatrixInverse);const k=p[3],I=y[3],D=p[1]/k,L=y[1]/I,F=p[2]/k,V=y[2]/I,X=F===V?0:(0-F)/(V-F);return new n.MercatorCoordinate(n.number(p[0]/k,y[0]/I,X)/this.worldSize,n.number(D,L,X)/this.worldSize)}coordinatePoint(t,a=0,p=this.pixelMatrix){const y=[t.x*this.worldSize,t.y*this.worldSize,a,1];return n.transformMat4(y,y,p),new n.pointGeometry(y[0]/y[3],y[1]/y[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new n.LngLatBounds().extend(this.pointLocation(new n.pointGeometry(0,t))).extend(this.pointLocation(new n.pointGeometry(this.width,t))).extend(this.pointLocation(new n.pointGeometry(this.width,this.height))).extend(this.pointLocation(new n.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new n.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,a=!1){const p=t.key,y=a?this._alignedPosMatrixCache:this._posMatrixCache;if(y[p])return y[p];const k=t.canonical,I=this.worldSize/this.zoomScale(k.z),D=k.x+Math.pow(2,k.z)*t.wrap,L=n.identity(new Float64Array(16));return n.translate(L,L,[D*I,k.y*I,0]),n.scale(L,L,[I/n.EXTENT,I/n.EXTENT,1]),n.multiply(L,a?this.alignedProjMatrix:this.projMatrix,L),y[p]=new Float32Array(L),y[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,a,p,y,k=-90,I=90,D=-180,L=180;const F=this.size,V=this._unmodified;if(this.latRange){const ue=this.latRange;k=n.mercatorYfromLat(ue[1])*this.worldSize,I=n.mercatorYfromLat(ue[0])*this.worldSize,t=I-k<F.y?F.y/(I-k):0}if(this.lngRange){const ue=this.lngRange;D=n.wrap(n.mercatorXfromLng(ue[0])*this.worldSize,0,this.worldSize),L=n.wrap(n.mercatorXfromLng(ue[1])*this.worldSize,0,this.worldSize),L<D&&(L+=this.worldSize),a=L-D<F.x?F.x/(L-D):0}const X=this.point,$=Math.max(a||0,t||0);if($)return this.center=this.unproject(new n.pointGeometry(a?(L+D)/2:X.x,t?(I+k)/2:X.y)),this.zoom+=this.scaleZoom($),this._unmodified=V,void(this._constraining=!1);if(this.latRange){const ue=X.y,se=F.y/2;ue-se<k&&(y=k+se),ue+se>I&&(y=I-se)}if(this.lngRange){const ue=(D+L)/2,se=n.wrap(X.x,ue-this.worldSize/2,ue+this.worldSize/2),le=F.x/2;se-le<D&&(p=D+le),se+le>L&&(p=L-le)}p===void 0&&y===void 0||(this.center=this.unproject(new n.pointGeometry(p!==void 0?p:X.x,y!==void 0?y:X.y)).wrap()),this._unmodified=V,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=n.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let y=n.identity(new Float64Array(16));n.scale(y,y,[this.width/2,-this.height/2,1]),n.translate(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=n.identity(new Float64Array(16)),n.scale(y,y,[1,-1,1]),n.translate(y,y,[-1,-1,0]),n.scale(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const k=Math.PI/2+this._pitch,I=this._fov*(.5+t.y/this.height),D=Math.sin(I)*this.cameraToSeaLevelDistance/Math.sin(n.clamp(Math.PI-k-I,.01,Math.PI-.01)),L=this.getHorizon(),F=2*Math.atan(L/this.cameraToCenterDistance)*(.5+t.y/(2*L)),V=Math.sin(F)*this.cameraToSeaLevelDistance/Math.sin(n.clamp(Math.PI-k-F,.01,Math.PI-.01)),X=Math.cos(Math.PI/2-this._pitch)*D+this.cameraToSeaLevelDistance,$=Math.cos(Math.PI/2-this._pitch)*V+this.cameraToSeaLevelDistance,ue=1.01*Math.min(X,$),se=this.height/50;y=new Float64Array(16),n.perspective(y,this._fov,this.width/this.height,se,ue),y[8]=2*-t.x/this.width,y[9]=2*t.y/this.height,n.scale(y,y,[1,-1,1]),n.translate(y,y,[0,0,-this.cameraToCenterDistance]),n.rotateX(y,y,this._pitch),n.rotateZ(y,y,this.angle),n.translate(y,y,[-a,-p,0]),this.mercatorMatrix=n.scale([],y,[this.worldSize,this.worldSize,this.worldSize]),n.scale(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,y),n.translate(y,y,[0,0,-this.elevation]),this.projMatrix=y,this.invProjMatrix=n.invert([],y),this.pixelMatrix3D=n.multiply(new Float64Array(16),this.labelPlaneMatrix,y);const le=this.width%2/2,be=this.height%2/2,Ae=Math.cos(this.angle),ze=Math.sin(this.angle),de=a-Math.round(a)+Ae*le+ze*be,Ge=p-Math.round(p)+Ae*be+ze*le,Le=new Float64Array(y);if(n.translate(Le,Le,[de>.5?de-1:de,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=Le,y=n.invert(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new n.pointGeometry(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return n.transformMat4(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.pointGeometry(0,t))}getCameraQueryGeometry(t){const a=this.getCameraPoint();if(t.length===1)return[t[0],a];{let p=a.x,y=a.y,k=a.x,I=a.y;for(const D of t)p=Math.min(p,D.x),y=Math.min(y,D.y),k=Math.max(k,D.x),I=Math.max(I,D.y);return[new n.pointGeometry(p,y),new n.pointGeometry(k,y),new n.pointGeometry(k,I),new n.pointGeometry(p,I),new n.pointGeometry(p,y)]}}}class Ul{constructor(t){this._hashName=t&&encodeURIComponent(t),n.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(a,p){let y=!1,k=null;const I=()=>{k=null,y&&(a(),k=setTimeout(I,300),y=!1)};return()=>(y=!0,k||I(),k)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,y),I=Math.round(a.lng*k)/k,D=Math.round(a.lat*k)/k,L=this._map.getBearing(),F=this._map.getPitch();let V="";if(V+=t?`/${I}/${D}/${p}`:`${p}/${D}/${I}`,(L||F)&&(V+="/"+Math.round(10*L)/10),F&&(V+=`/${Math.round(F)}`),this._hashName){const X=this._hashName;let $=!1;const ue=window.location.hash.slice(1).split("&").map(se=>{const le=se.split("=")[0];return le===X?($=!0,`${le}=${V}`):se}).filter(se=>se);return $||ue.push(`${X}=${V}`),`#${ue.join("&")}`}return`#${V}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(a=p)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:a,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const $s={linearity:.3,easing:n.bezier(0,0,.3,1)},Vl=n.extend({deceleration:2500,maxSpeed:1400},$s),Gl=n.extend({deceleration:20,maxSpeed:1400},$s),jl=n.extend({deceleration:1e3,maxSpeed:360},$s),Cs=n.extend({deceleration:1e3,maxSpeed:90},$s);class ql{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=n.exported.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new n.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)a.zoom+=k.zoomDelta||0,a.bearing+=k.bearingDelta||0,a.pitch+=k.pitchDelta||0,k.panDelta&&a.pan._add(k.panDelta),k.around&&(a.around=k.around),k.pinchAround&&(a.pinchAround=k.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(a.pan.mag()){const k=to(a.pan.mag(),p,n.extend({},Vl,t||{}));y.offset=a.pan.mult(k.amount/a.pan.mag()),y.center=this._map.transform.center,eo(y,k)}if(a.zoom){const k=to(a.zoom,p,Gl);y.zoom=this._map.transform.zoom+k.amount,eo(y,k)}if(a.bearing){const k=to(a.bearing,p,jl);y.bearing=this._map.transform.bearing+n.clamp(k.amount,-179,179),eo(y,k)}if(a.pitch){const k=to(a.pitch,p,Cs);y.pitch=this._map.transform.pitch+k.amount,eo(y,k)}if(y.zoom||y.bearing){const k=a.pinchAround===void 0?a.around:a.pinchAround;y.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),n.extend(y,{noMoveStart:!0})}}function eo(g,t){(!g.duration||g.duration<t.duration)&&(g.duration=t.duration,g.easing=t.easing)}function to(g,t,a){const{maxSpeed:p,linearity:y,deceleration:k}=a,I=n.clamp(g*y/(t/1e3),-p,p),D=Math.abs(I)/(k*y);return{easing:a.easing,duration:1e3*D,amount:I*(D/2)}}class Kn extends n.Event{constructor(t,a,p,y={}){const k=b.mousePos(a.getCanvasContainer(),p),I=a.unproject(k);super(t,n.extend({point:k,lngLat:I,originalEvent:p},y)),this._defaultPrevented=!1,this.target=a}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class io extends n.Event{constructor(t,a,p){const y=t==="touchend"?p.changedTouches:p.touches,k=b.touchPos(a.getCanvasContainer(),y),I=k.map(L=>a.unproject(L)),D=k.reduce((L,F,V,X)=>L.add(F.div(X.length)),new n.pointGeometry(0,0));super(t,{points:k,point:D,lngLats:I,lngLat:a.unproject(D),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Jn extends n.Event{constructor(t,a,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ru{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Jn(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Kn(t.type,this._map,t))}mouseup(t){this._map.fire(new Kn(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Kn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Kn(t.type,this._map,t))}mouseover(t){this._map.fire(new Kn(t.type,this._map,t))}mouseout(t){this._map.fire(new Kn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new io(t.type,this._map,t))}touchmove(t){this._map.fire(new io(t.type,this._map,t))}touchend(t){this._map.fire(new io(t.type,this._map,t))}touchcancel(t){this._map.fire(new io(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Br{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Kn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Kn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Kn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zl{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(b.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const p=a;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=p,this._box||(this._box=b.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const k=Math.min(y.x,p.x),I=Math.max(y.x,p.x),D=Math.min(y.y,p.y),L=Math.max(y.y,p.y);b.setTransform(this._box,`translate(${k}px,${D}px)`),this._box.style.width=I-k+"px",this._box.style.height=L-D+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const p=this._startPos,y=a;if(this.reset(),b.suppressClick(),p.x!==y.x||p.y!==y.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:k=>k.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(b.remove(this._box),this._box=null),b.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new n.Event(t,{originalEvent:a}))}}function Er(g,t){if(g.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${t.length}`);const a={};for(let p=0;p<g.length;p++)a[g[p].identifier]=t[p];return a}class no{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const k=new n.pointGeometry(0,0);for(const I of y)k._add(I);return k.div(y.length)}(a),this.touches=Er(p,a)))}touchmove(t,a,p){if(this.aborted||!this.centroid)return;const y=Er(p,a);for(const k in this.touches){const I=this.touches[k],D=y[k];(!D||D.dist(I)>30)&&(this.aborted=!0)}}touchend(t,a,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Ea{constructor(t){this.singleTap=new no(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,p){this.singleTap.touchstart(t,a,p)}touchmove(t,a,p){this.singleTap.touchmove(t,a,p)}touchend(t,a,p){const y=this.singleTap.touchend(t,a,p);if(y){const k=t.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(y)<30;if(k&&I||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class su{constructor(){this._zoomIn=new Ea({numTouches:1,numTaps:2}),this._zoomOut=new Ea({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,p){this._zoomIn.touchstart(t,a,p),this._zoomOut.touchstart(t,a,p)}touchmove(t,a,p){this._zoomIn.touchmove(t,a,p),this._zoomOut.touchmove(t,a,p)}touchend(t,a,p){const y=this._zoomIn.touchend(t,a,p),k=this._zoomOut.touchend(t,a,p);return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(y)},{originalEvent:t})}):k?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(k)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ou={0:1,2:2};class Ro{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const p=b.mouseButton(t);this._correctButton(t,p)&&(this._lastPoint=a,this._eventButton=p)}mousemoveWindow(t,a){const p=this._lastPoint;if(p){if(t.preventDefault(),function(y,k){const I=ou[k];return y.buttons===void 0||(y.buttons&I)!==I}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(p,a)}}mouseupWindow(t){this._lastPoint&&b.mouseButton(t)===this._eventButton&&(this._moved&&b.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ro extends Ro{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Tr extends Ro{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const p=.8*(a.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){t.preventDefault()}}class Bt extends Ro{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const p=-.5*(a.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){t.preventDefault()}}class Hl{constructor(t,a){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new n.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,a,p){return this._calculateTransform(t,a,p)}touchmove(t,a,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,a,p)}touchend(t,a,p){this._calculateTransform(t,a,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,p){p.length>0&&(this._active=!0);const y=Er(p,a),k=new n.pointGeometry(0,0),I=new n.pointGeometry(0,0);let D=0;for(const F in y){const V=y[F],X=this._touches[F];X&&(k._add(V),I._add(V.sub(X)),D++,y[F]=V)}if(this._touches=y,D<this._minTouches||!I.mag())return;const L=I.div(D);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(D),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,a,p){return{}}touchstart(t,a,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,p){if(!this._firstTwoTouches)return;t.preventDefault();const[y,k]=this._firstTwoTouches,I=Rr(p,a,y),D=Rr(p,a,k);if(!I||!D)return;const L=this._aroundCenter?null:I.add(D).div(2);return this._move([I,D],L,t)}touchend(t,a,p){if(!this._firstTwoTouches)return;const[y,k]=this._firstTwoTouches,I=Rr(p,a,y),D=Rr(p,a,k);I&&D||(this._active&&b.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Rr(g,t,a){for(let p=0;p<g.length;p++)if(g[p].identifier===a)return t[p]}function Ta(g,t){return Math.log(g/t)/Math.LN2}class At extends Qr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ta(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ta(this._distance,p),pinchAround:a}}}function Oo(g,t){return 180*g.angleWith(t)/Math.PI}class au extends Qr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Oo(this._vector,p),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,p=Oo(t,this._startVector);return Math.abs(p)<a}}function Aa(g){return Math.abs(g.y)>Math.abs(g.x)}class Ca extends Qr{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,p){super.touchstart(t,a,p),this._currentTouchCount=p.length}_start(t){this._lastPoints=t,Aa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const y=t[0].sub(this._lastPoints[0]),k=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,k,p.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+k.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,p){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,k=a.mag()>=2;if(!y&&!k)return;if(!y||!k)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const I=t.y>0==a.y>0;return Aa(t)&&Aa(a)&&I}}const Wl={panStep:100,bearingStep:15,pitchStep:10};class Xl{constructor(){const t=Wl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,p=0,y=0,k=0,I=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),k=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),k=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),I=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:D=>{const L=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:lu,zoom:a?Math.round(L)+a*(t.shiftKey?2:1):L,bearing:D.getBearing()+p*this._bearingStep,pitch:D.getPitch()+y*this._pitchStep,offset:[-k*this._panStep,-I*this._panStep],center:D.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function lu(g){return g*(2-g)}const Kl=4.000244140625;class Ia{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,n.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=n.exported.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,a!==0&&a%Kl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=b.mousePos(this._el,t);this._around=n.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(a)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Kl?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*L))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,p=this._startZoom,y=this._easing;let k,I=!1;if(this._type==="wheel"&&p&&y){const D=Math.min((n.exported.now()-this._lastWheelEventTime)/200,1),L=y(D);k=n.number(p,a,L),D<1?this._frameId||(this._frameId=!0):I=!0}else k=a,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:k-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=n.ease;if(this._prevEase){const p=this._prevEase,y=(n.exported.now()-p.start)/p.duration,k=p.easing(y+.01)-p.easing(y),I=.27/Math.sqrt(k*k+1e-4)*.01,D=Math.sqrt(.0729-I*I);a=n.bezier(I,D,.25,1)}return this._prevEase={start:n.exported.now(),duration:t,easing:a},a}reset(){this._active=!1}}class Pa{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class za{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ma{constructor(){this._tap=new Ea({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,a,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=a[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,a,p))}touchmove(t,a,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=a[0],k=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(t,a,p)}touchend(t,a,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,a,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gn{constructor(t,a,p){this._el=t,this._mousePan=a,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Or{constructor(t,a,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jl{constructor(t,a,p,y){this._el=t,this._touchZoom=a,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Is=g=>g.zoom||g.drag||g.pitch||g.rotate;class Da extends n.Event{}function so(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Yl{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ql(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a),n.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,k,I]of this._listeners)b.addEventListener(y,k,y===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[t,a,p]of this._listeners)b.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const a=this._map,p=a.getCanvasContainer();this._add("mapEvent",new ru(a,t));const y=a.boxZoom=new Zl(a,t);this._add("boxZoom",y);const k=new su,I=new za;a.doubleClickZoom=new Pa(I,k),this._add("tapZoom",k),this._add("clickZoom",I);const D=new Ma;this._add("tapDragZoom",D);const L=a.touchPitch=new Ca(a);this._add("touchPitch",L);const F=new Tr(t),V=new Bt(t);a.dragRotate=new Or(t,F,V),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const X=new ro(t),$=new Hl(t,a);a.dragPan=new Gn(p,X,$),this._add("mousePan",X),this._add("touchPan",$,["touchZoom","touchRotate"]);const ue=new au,se=new At;a.touchZoomRotate=new Jl(p,se,ue,D),this._add("touchRotate",ue,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]);const le=a.scrollZoom=new Ia(a,this);this._add("scrollZoom",le,["mousePan"]);const be=a.keyboard=new Xl;this._add("keyboard",be),this._add("blockableMapEvent",new Br(a));for(const Ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Ae]&&a[Ae].enable(t[Ae])}_add(t,a,p){this._handlers.push({handlerName:t,handler:a,allowed:p}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Is(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,p){for(const y in t)if(y!==p&&(!a||a.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const p of t)this._el.contains(p.target)&&a.push(p);return a}handleEvent(t,a){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=t.type==="renderFrame"?void 0:t,y={needsRenderFrame:!1},k={},I={},D=t.touches,L=D?this._getMapTouches(D):void 0,F=L?b.touchPos(this._el,L):b.mousePos(this._el,t);for(const{handlerName:$,handler:ue,allowed:se}of this._handlers){if(!ue.isEnabled())continue;let le;this._blockedByActive(I,se,$)?ue.reset():ue[a||t.type]&&(le=ue[a||t.type](t,F,L),this.mergeHandlerResult(y,k,le,$,p),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||ue.isActive())&&(I[$]=ue)}const V={};for(const $ in this._previousActiveHandlers)I[$]||(V[$]=p);this._previousActiveHandlers=I,(Object.keys(V).length||so(y))&&(this._changes.push([y,k,V]),this._triggerRenderFrame()),(Object.keys(I).length||so(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=y;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(t,a,p,y,k){if(!p)return;n.extend(t,p);const I={handlerName:y,originalEvent:p.originalEvent||k};p.zoomDelta!==void 0&&(a.zoom=I),p.panDelta!==void 0&&(a.drag=I),p.pitchDelta!==void 0&&(a.pitch=I),p.bearingDelta!==void 0&&(a.rotate=I)}_applyChanges(){const t={},a={},p={};for(const[y,k,I]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new n.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),n.extend(a,k),n.extend(p,I);this._updateMapTransform(t,a,p),this._changes=[]}_updateMapTransform(t,a,p){const y=this._map,k=y.transform,I=y.style&&y.style.terrain;if(!(so(t)||I&&this._drag))return this._fireEvents(a,p,!0);let{panDelta:D,zoomDelta:L,bearingDelta:F,pitchDelta:V,around:X,pinchAround:$}=t;$!==void 0&&(X=$),y._stop(!0),X=X||y.transform.centerPoint;const ue=k.pointLocation(D?X.sub(D):X);F&&(k.bearing+=F),V&&(k.pitch+=V),L&&(k.zoom+=L),I?a.drag&&!this._drag?(this._drag={center:k.centerPoint,lngLat:k.pointLocation(X),point:X,handlerName:a.drag.handlerName},y.fire(new n.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(y.fire(new n.Event("freezeElevation",{freeze:!1})),this._drag=null):a.drag&&this._drag&&(k.center=k.pointLocation(k.centerPoint.sub(D))):k.setLocationAtPoint(ue,X),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,p,!0)}_fireEvents(t,a,p){const y=Is(this._eventsInProgress),k=Is(t),I={};for(const V in t){const{originalEvent:X}=t[V];this._eventsInProgress[V]||(I[`${V}start`]=X),this._eventsInProgress[V]=t[V]}!y&&k&&this._fireEvent("movestart",k.originalEvent);for(const V in I)this._fireEvent(V,I[V]);k&&this._fireEvent("move",k.originalEvent);for(const V in t){const{originalEvent:X}=t[V];this._fireEvent(V,X)}const D={};let L;for(const V in this._eventsInProgress){const{handlerName:X,originalEvent:$}=this._eventsInProgress[V];this._handlersById[X].isActive()||(delete this._eventsInProgress[V],L=a[X]||$,D[`${V}end`]=L)}for(const V in D)this._fireEvent(V,D[V]);const F=Is(this._eventsInProgress);if(p&&(y||k)&&!F){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;V?(X(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:L})):(this._map.fire(new n.Event("moveend",{originalEvent:L})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new n.Event(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Da("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const nr={extend:(g,...t)=>n.extend(g,...t),run(g){g()},logToElement(g,t=!1,a="log"){const p=window.document.getElementById(a);p&&(t&&(p.innerHTML=""),p.innerHTML+=`<br>${g}`)}};class Ji extends n.Evented{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,n.bindAll(["_renderFrameCallback"],this)}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,p){return t=n.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,n.extend({offset:t},a),p)}panTo(t,a,p){return this.easeTo(n.extend({center:t},a),p)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,p){return this.easeTo(n.extend({zoom:t},a),p)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,p){return this.easeTo(n.extend({bearing:t},a),p)}resetNorth(t,a){return this.rotateTo(0,n.extend({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=n.LngLatBounds.convert(t);const p=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,a)}_cameraForBoxAndBearing(t,a,p,y){const k={top:0,bottom:0,right:0,left:0};if(typeof(y=n.extend({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const Le=y.padding;y.padding={top:Le,bottom:Le,right:Le,left:Le}}y.padding=n.extend(k,y.padding);const I=this.transform,D=I.padding,L=I.project(n.LngLat.convert(t)),F=I.project(n.LngLat.convert(a)),V=L.rotate(-p*Math.PI/180),X=F.rotate(-p*Math.PI/180),$=new n.pointGeometry(Math.max(V.x,X.x),Math.max(V.y,X.y)),ue=new n.pointGeometry(Math.min(V.x,X.x),Math.min(V.y,X.y)),se=$.sub(ue),le=(I.width-(D.left+D.right+y.padding.left+y.padding.right))/se.x,be=(I.height-(D.top+D.bottom+y.padding.top+y.padding.bottom))/se.y;if(be<0||le<0)return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ae=Math.min(I.scaleZoom(I.scale*Math.min(le,be)),y.maxZoom),ze=n.pointGeometry.convert(y.offset),de=new n.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(p*Math.PI/180),Ge=ze.add(de).mult(I.scale/I.zoomScale(Ae));return{center:I.unproject(L.add(F).div(2).sub(Ge)),zoom:Ae,bearing:p}}fitBounds(t,a,p){return this._fitInternal(this.cameraForBounds(t,a),a,p)}fitScreenCoordinates(t,a,p,y,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(n.pointGeometry.convert(t)),this.transform.pointLocation(n.pointGeometry.convert(a)),p,y),y,k)}_fitInternal(t,a,p){return t?(delete(a=n.extend(t,a)).padding,a.linear?this.easeTo(a,p):this.flyTo(a,p)):this}jumpTo(t,a){this.stop();const p=this.transform;let y=!1,k=!1,I=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(y=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=n.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(k=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(I=!0,p.pitch=+t.pitch),t.padding==null||p.isPaddingEqual(t.padding)||(p.padding=t.padding),this.fire(new n.Event("movestart",a)).fire(new n.Event("move",a)),y&&this.fire(new n.Event("zoomstart",a)).fire(new n.Event("zoom",a)).fire(new n.Event("zoomend",a)),k&&this.fire(new n.Event("rotatestart",a)).fire(new n.Event("rotate",a)).fire(new n.Event("rotateend",a)),I&&this.fire(new n.Event("pitchstart",a)).fire(new n.Event("pitch",a)).fire(new n.Event("pitchend",a)),this.fire(new n.Event("moveend",a))}calculateCameraOptionsFromTo(t,a,p,y=0){const k=n.MercatorCoordinate.fromLngLat(t,a),I=n.MercatorCoordinate.fromLngLat(p,y),D=I.x-k.x,L=I.y-k.y,F=I.z-k.z,V=Math.hypot(D,L,F);if(V===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(D,L),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/V/this.transform.tileSize),ue=180*Math.atan2(D,-L)/Math.PI;let se=180*Math.acos(X/V)/Math.PI;return se=F<0?90-se:90+se,{center:I.toLngLat(),zoom:$,pitch:se,bearing:ue}}easeTo(t,a){this._stop(!1,t.easeId),((t=n.extend({offset:[0,0],duration:500,easing:n.ease},t)).animate===!1||!t.essential&&n.exported.prefersReducedMotion)&&(t.duration=0);const p=this.transform,y=this.getZoom(),k=this.getBearing(),I=this.getPitch(),D=this.getPadding(),L="zoom"in t?+t.zoom:y,F="bearing"in t?this._normalizeBearing(t.bearing,k):k,V="pitch"in t?+t.pitch:I,X="padding"in t?t.padding:p.padding,$=n.pointGeometry.convert(t.offset);let ue=p.centerPoint.add($);const se=p.pointLocation(ue),le=n.LngLat.convert(t.center||se);this._normalizeCenter(le);const be=p.project(se),Ae=p.project(le).sub(be),ze=p.zoomScale(L-y);let de,Ge;t.around&&(de=n.LngLat.convert(t.around),Ge=p.locationPoint(de));const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||L!==y,this._rotating=this._rotating||k!==F,this._pitching=this._pitching||V!==I,this._padding=!p.isPaddingEqual(X),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Le),this._ease(Ye=>{if(this._zooming&&(p.zoom=n.number(y,L,Ye)),this._rotating&&(p.bearing=n.number(k,F,Ye)),this._pitching&&(p.pitch=n.number(I,V,Ye)),this._padding&&(p.interpolatePadding(D,X,Ye),ue=p.centerPoint.add($)),de)p.setLocationAtPoint(de,Ge);else{const $e=p.zoomScale(p.zoom-y),lt=L>y?Math.min(2,ze):Math.max(.5,ze),We=Math.pow(lt,1-Ye),zt=p.unproject(be.add(Ae.mult(Ye*We)).mult($e));p.setLocationAtPoint(p.renderWorldCopies?zt.wrap():zt,ue)}this._fireMoveEvents(a)},Ye=>{this._afterEase(a,Ye)},t),this}_prepareEase(t,a,p={}){this._moving=!0,this.fire(new n.Event("freezeElevation",{freeze:!0})),a||p.moving||this.fire(new n.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new n.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new n.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new n.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.Event("move",t)),this._zooming&&this.fire(new n.Event("zoom",t)),this._rotating&&this.fire(new n.Event("rotate",t)),this._pitching&&this.fire(new n.Event("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId,this.fire(new n.Event("freezeElevation",{freeze:!1}));const p=this._zooming,y=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new n.Event("zoomend",t)),y&&this.fire(new n.Event("rotateend",t)),k&&this.fire(new n.Event("pitchend",t)),this.fire(new n.Event("moveend",t))}flyTo(t,a){if(!t.essential&&n.exported.prefersReducedMotion){const Ht=n.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ht,a)}this.stop(),t=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},t);const p=this.transform,y=this.getZoom(),k=this.getBearing(),I=this.getPitch(),D=this.getPadding(),L="zoom"in t?n.clamp(+t.zoom,p.minZoom,p.maxZoom):y,F="bearing"in t?this._normalizeBearing(t.bearing,k):k,V="pitch"in t?+t.pitch:I,X="padding"in t?t.padding:p.padding,$=p.zoomScale(L-y),ue=n.pointGeometry.convert(t.offset);let se=p.centerPoint.add(ue);const le=p.pointLocation(se),be=n.LngLat.convert(t.center||le);this._normalizeCenter(be);const Ae=p.project(le),ze=p.project(be).sub(Ae);let de=t.curve;const Ge=Math.max(p.width,p.height),Le=Ge/$,Ye=ze.mag();if("minZoom"in t){const Ht=n.clamp(Math.min(t.minZoom,y,L),p.minZoom,p.maxZoom),Mi=Ge/p.zoomScale(Ht-y);de=Math.sqrt(Mi/Ye*2)}const $e=de*de;function lt(Ht){const Mi=(Le*Le-Ge*Ge+(Ht?-1:1)*$e*$e*Ye*Ye)/(2*(Ht?Le:Ge)*$e*Ye);return Math.log(Math.sqrt(Mi*Mi+1)-Mi)}function We(Ht){return(Math.exp(Ht)-Math.exp(-Ht))/2}function zt(Ht){return(Math.exp(Ht)+Math.exp(-Ht))/2}const kt=lt(0);let Dt=function(Ht){return zt(kt)/zt(kt+de*Ht)},ai=function(Ht){return Ge*((zt(kt)*(We(Mi=kt+de*Ht)/zt(Mi))-We(kt))/$e)/Ye;var Mi},hi=(lt(1)-kt)/de;if(Math.abs(Ye)<1e-6||!isFinite(hi)){if(Math.abs(Ge-Le)<1e-6)return this.easeTo(t,a);const Ht=Le<Ge?-1:1;hi=Math.abs(Math.log(Le/Ge))/de,ai=function(){return 0},Dt=function(Mi){return Math.exp(Ht*de*Mi)}}return t.duration="duration"in t?+t.duration:1e3*hi/("screenSpeed"in t?+t.screenSpeed/de:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=k!==F,this._pitching=V!==I,this._padding=!p.isPaddingEqual(X),this._prepareEase(a,!1),this._ease(Ht=>{const Mi=Ht*hi,Di=1/Dt(Mi);p.zoom=Ht===1?L:y+p.scaleZoom(Di),this._rotating&&(p.bearing=n.number(k,F,Ht)),this._pitching&&(p.pitch=n.number(I,V,Ht)),this._padding&&(p.interpolatePadding(D,X,Ht),se=p.centerPoint.add(ue));const vi=Ht===1?be:p.unproject(Ae.add(ze.mult(ai(Mi))).mult(Di));p.setLocationAtPoint(p.renderWorldCopies?vi.wrap():vi,se),this._fireMoveEvents(a)},()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,a)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,a,p){p.animate===!1||p.duration===0?(t(1),a()):(this._easeStart=n.exported.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=n.wrap(t,-180,180);const p=Math.abs(t-a);return Math.abs(t-360-a)<p&&(t-=360),Math.abs(t+360-a)<p&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const p=t.lng-a.center.lng;t.lng+=p>180?-360:p<-180?360:0}}class oo{constructor(t={}){this.options=t,n.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=b.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=b.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=b.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const p=this._map._getUIString(`AttributionControl.${a}`);t.title=p,t.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const a=this._map.style.sourceCaches;for(const y in a){const k=a[y];if(k.used||k.usedForTerrain){const I=k.getSource();I.attribution&&t.indexOf(I.attribution)<0&&t.push(I.attribution)}}t=t.filter(y=>String(y).trim()),t.sort((y,k)=>y.length-k.length),t=t.filter((y,k)=>{for(let I=k+1;I<t.length;I++)if(t[I].indexOf(y)>=0)return!1;return!0});const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Fo{constructor(t={}){this.options=t,n.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=b.create("div","maplibregl-ctrl mapboxgl-ctrl");const a=b.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){b.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact","mapboxgl-compact"):a.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Ql{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,p=a?this._queue.concat(a):this._queue;for(const y of p)if(y.id===t)return void(y.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const p of a)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const $l={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},ec={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},cu={showCompass:!0,showZoom:!0,visualizePitch:!1};class _r{constructor(t,a,p=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Tr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new Bt({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),b.addEventListener(a,"mousedown",this.mousedown),b.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),b.addEventListener(a,"touchmove",this.touchmove),b.addEventListener(a,"touchend",this.touchend),b.addEventListener(a,"touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),b.disableDrag()}move(t,a){const p=this.map,y=this.mouseRotate.mousemoveWindow(t,a);if(y&&y.bearingDelta&&p.setBearing(p.getBearing()+y.bearingDelta),this.mousePitch){const k=this.mousePitch.mousemoveWindow(t,a);k&&k.pitchDelta&&p.setPitch(p.getPitch()+k.pitchDelta)}}off(){const t=this.element;b.removeEventListener(t,"mousedown",this.mousedown),b.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),b.removeEventListener(t,"touchmove",this.touchmove),b.removeEventListener(t,"touchend",this.touchend),b.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){b.enableDrag(),b.removeEventListener(window,"mousemove",this.mousemove),b.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(n.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),b.mousePos(this.element,t)),b.addEventListener(window,"mousemove",this.mousemove),b.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,b.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=b.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=b.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ao(g,t,a){if(g=new n.LngLat(g.lng,g.lat),t){const p=new n.LngLat(g.lng-360,g.lat),y=new n.LngLat(g.lng+360,g.lat),k=a.locationPoint(g).distSqr(t);a.locationPoint(p).distSqr(t)<k?g=p:a.locationPoint(y).distSqr(t)<k&&(g=y)}for(;Math.abs(g.lng-a.center.lng)>180;){const p=a.locationPoint(g);if(p.x>=0&&p.y>=0&&p.x<=a.width&&p.y<=a.height)break;g.lng>a.center.lng?g.lng-=360:g.lng+=360}return g}const Nt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $t(g,t,a){const p=g.classList;for(const y in Nt)p.remove(`maplibregl-${a}-anchor-${y}`,`mapboxgl-${a}-anchor-${y}`);p.add(`maplibregl-${a}-anchor-${t}`,`mapboxgl-${a}-anchor-${t}`)}class Ps extends n.Evented{constructor(t,a){if(super(),(t instanceof HTMLElement||a)&&(t=n.extend({element:t},a)),n.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=n.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=b.create("div"),this._element.setAttribute("aria-label","Map marker");const p=b.createNS("http://www.w3.org/2000/svg","svg"),y=41,k=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${y}px`),p.setAttributeNS(null,"width",`${k}px`),p.setAttributeNS(null,"viewBox",`0 0 ${k} ${y}`);const I=b.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");const D=b.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill-rule","nonzero");const L=b.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const F=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ze of F){const de=b.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",ze.rx),de.setAttributeNS(null,"ry",ze.ry),L.appendChild(de)}const V=b.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"fill",this._color);const X=b.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),V.appendChild(X);const $=b.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const ue=b.createNS("http://www.w3.org/2000/svg","path");ue.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(ue);const se=b.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),se.setAttributeNS(null,"fill","#FFFFFF");const le=b.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"transform","translate(8.0, 8.0)");const be=b.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#000000"),be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962");const Ae=b.createNS("http://www.w3.org/2000/svg","circle");Ae.setAttributeNS(null,"fill","#FFFFFF"),Ae.setAttributeNS(null,"cx","5.5"),Ae.setAttributeNS(null,"cy","5.5"),Ae.setAttributeNS(null,"r","5.4999962"),le.appendChild(be),le.appendChild(Ae),D.appendChild(L),D.appendChild(V),D.appendChild($),D.appendChild(se),D.appendChild(le),p.appendChild(D),p.setAttributeNS(null,"height",y*this._scale+"px"),p.setAttributeNS(null,"width",k*this._scale+"px"),this._element.appendChild(p),this._offset=n.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),$t(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),b.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const a=t.code,p=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,p=this._element;this._popup&&(a===p||p.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ao(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let a="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?a=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(a=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),b.setTransform(this._element,`${Nt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${a}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const y=this._map.unproject(this._pos),k=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=y.distanceTo(this._lngLat)>20*k?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=n.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const La={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Fr,En=0,Nr=!1;const yr={maxWidth:100,unit:"metric"};function tc(g,t,a){const p=a&&a.maxWidth||100,y=g._container.clientHeight/2,k=g.unproject([0,y]),I=g.unproject([p,y]),D=k.distanceTo(I);if(a&&a.unit==="imperial"){const L=3.2808*D;L>5280?Ur(t,p,L/5280,g._getUIString("ScaleControl.Miles")):Ur(t,p,L,g._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Ur(t,p,D/1852,g._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Ur(t,p,D/1e3,g._getUIString("ScaleControl.Kilometers")):Ur(t,p,D,g._getUIString("ScaleControl.Meters"))}function Ur(g,t,a,p){const y=function(k){const I=Math.pow(10,`${Math.floor(k)}`.length-1);let D=k/I;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(L){const F=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*F)/F}(D),I*D}(a);g.style.width=t*(y/a)+"px",g.innerHTML=`${y}&nbsp;${p}`}const rn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ln=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ba(g){if(g){if(typeof g=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(g,2)));return{center:new n.pointGeometry(0,0),top:new n.pointGeometry(0,g),"top-left":new n.pointGeometry(t,t),"top-right":new n.pointGeometry(-t,t),bottom:new n.pointGeometry(0,-g),"bottom-left":new n.pointGeometry(t,-t),"bottom-right":new n.pointGeometry(-t,-t),left:new n.pointGeometry(g,0),right:new n.pointGeometry(-g,0)}}if(g instanceof n.pointGeometry||Array.isArray(g)){const t=n.pointGeometry.convert(g);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:n.pointGeometry.convert(g.center||[0,0]),top:n.pointGeometry.convert(g.top||[0,0]),"top-left":n.pointGeometry.convert(g["top-left"]||[0,0]),"top-right":n.pointGeometry.convert(g["top-right"]||[0,0]),bottom:n.pointGeometry.convert(g.bottom||[0,0]),"bottom-left":n.pointGeometry.convert(g["bottom-left"]||[0,0]),"bottom-right":n.pointGeometry.convert(g["bottom-right"]||[0,0]),left:n.pointGeometry.convert(g.left||[0,0]),right:n.pointGeometry.convert(g.right||[0,0])}}return Ba(new n.pointGeometry(0,0))}const $r={supported:m,setRTLTextPlugin:n.setRTLTextPlugin,getRTLTextPluginStatus:n.getRTLTextPluginStatus,Map:class extends Ji{constructor(g){var t;if(n.PerformanceUtils.mark(n.PerformanceMarkers.create),(g=n.extend({},ec,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Qs(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._interactive=g.interactive,this._cooperativeGestures=g.cooperativeGestures,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Ql,this._controls=[],this._mapId=n.uniqueId(),this._locale=n.extend({},$l,g.locale),this._clickTolerance=g.clickTolerance,this._pixelRatio=(t=g.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new E(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),n.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Yl(this,g),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=g.hash&&new Ul(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,n.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new oo({customAttribution:g.customAttribution})),g.maplibreLogo&&this.addControl(new Fo,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new n.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new n.Event(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new n.Event("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(g,t){if(t===void 0&&(t=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=g.onAdd(this);this._controls.push(g);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(a,p.firstChild):p.appendChild(a),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(g);return t>-1&&this._controls.splice(t,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,t,a,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(a,this.style.terrain)),super.calculateCameraOptionsFromTo(g,t,a,p)}resize(g){const t=this._containerDimensions(),a=t[0],p=t[1];this._resizeCanvas(a,p,this.getPixelRatio()),this.transform.resize(a,p),this.painter.resize(a,p,this.getPixelRatio());const y=!this._moving;return y&&(this.stop(),this.fire(new n.Event("movestart",g)).fire(new n.Event("move",g))),this.fire(new n.Event("resize",g)),y&&this.fire(new n.Event("moveend",g)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(g){const[t,a]=this._containerDimensions();this._pixelRatio=g,this._resizeCanvas(t,a,g),this.painter.resize(t,a,g)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(n.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(n.LngLat.convert(g),this.style&&this.style.terrain)}unproject(g){return this.transform.pointLocation(n.pointGeometry.convert(g),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(g,t,a){if(g==="mouseenter"||g==="mouseover"){let p=!1;return{layer:t,listener:a,delegates:{mousemove:k=>{const I=this.getLayer(t)?this.queryRenderedFeatures(k.point,{layers:[t]}):[];I.length?p||(p=!0,a.call(this,new Kn(g,this,k.originalEvent,{features:I}))):p=!1},mouseout:()=>{p=!1}}}}if(g==="mouseleave"||g==="mouseout"){let p=!1;return{layer:t,listener:a,delegates:{mousemove:I=>{(this.getLayer(t)?this.queryRenderedFeatures(I.point,{layers:[t]}):[]).length?p=!0:p&&(p=!1,a.call(this,new Kn(g,this,I.originalEvent)))},mouseout:I=>{p&&(p=!1,a.call(this,new Kn(g,this,I.originalEvent)))}}}}{const p=y=>{const k=this.getLayer(t)?this.queryRenderedFeatures(y.point,{layers:[t]}):[];k.length&&(y.features=k,a.call(this,y),delete y.features)};return{layer:t,listener:a,delegates:{[g]:p}}}}on(g,t,a){if(a===void 0)return super.on(g,t);const p=this._createDelegatedListener(g,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(g,t,a){if(a===void 0)return super.once(g,t);const p=this._createDelegatedListener(g,t,a);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(g,t,a){return a===void 0?super.off(g,t):(this._delegatedListeners&&this._delegatedListeners[g]&&(p=>{const y=this._delegatedListeners[g];for(let k=0;k<y.length;k++){const I=y[k];if(I.layer===t&&I.listener===a){for(const D in I.delegates)this.off(D,I.delegates[D]);return y.splice(k,1),this}}})(),this)}queryRenderedFeatures(g,t){if(!this.style)return[];let a;if(t!==void 0||g===void 0||g instanceof n.pointGeometry||Array.isArray(g)||(t=g,g=void 0),t=t||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof n.pointGeometry||typeof g[0]=="number")a=[n.pointGeometry.convert(g)];else{const p=n.pointGeometry.convert(g[0]),y=n.pointGeometry.convert(g[1]);a=[p,new n.pointGeometry(y.x,p.y),y,new n.pointGeometry(p.x,y.y),p]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(g,t){return this.style.querySourceFeatures(g,t)}setStyle(g,t){return(t=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(g,t))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const t=this._locale[g];if(t==null)throw new Error(`Missing UI string '${g}'`);return t}_updateStyle(g,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Mn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Mn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,t){if(typeof g=="string"){const a=this._requestManager.transformRequest(g,n.ResourceType.Style);n.getJSON(a,(p,y)=>{p?this.fire(new n.ErrorEvent(p)):y&&this._updateDiff(y,t)})}else typeof g=="object"&&this._updateDiff(g,t)}_updateDiff(g,t){try{this.style.setState(g)&&this._update(!0)}catch(a){n.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(g,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():n.warnOnce("There is no style added to the map.")}addSource(g,t){return this._lazyInitEmptyStyle(),this.style.addSource(g,t),this._update(!0)}isSourceLoaded(g){const t=this.style&&this.style.sourceCaches[g];if(t!==void 0)return t.loaded();this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){return this.style.setTerrain(g),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const t in g){const a=g[t]._tiles;for(const p in a){const y=a[p];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(g,t,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,t,a)}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,t,{pixelRatio:a=1,sdf:p=!1,stretchX:y,stretchY:k,content:I}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||n.isImageBitmap(t)){const{width:D,height:L,data:F}=n.exported.getImageData(t);this.style.addImage(g,{data:new n.RGBAImage({width:D,height:L},F),pixelRatio:a,stretchX:y,stretchY:k,content:I,sdf:p,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:L,data:F}=t,V=t;this.style.addImage(g,{data:new n.RGBAImage({width:D,height:L},new Uint8Array(F)),pixelRatio:a,stretchX:y,stretchY:k,content:I,sdf:p,version:0,userImage:V}),V.onAdd&&V.onAdd(this,g)}}}updateImage(g,t){const a=this.style.getImage(g);if(!a)return this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||n.isImageBitmap(t)?n.exported.getImageData(t):t,{width:y,height:k,data:I}=p;if(y===void 0||k===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==a.data.width||k!==a.data.height)return this.fire(new n.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(t instanceof HTMLImageElement||n.isImageBitmap(t));a.data.replace(I,D),this.style.updateImage(g,a)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,t){n.getImage(this._requestManager.transformRequest(g,n.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(g,t){return this._lazyInitEmptyStyle(),this.style.addLayer(g,t),this._update(!0)}moveLayer(g,t){return this.style.moveLayer(g,t),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,t,a){return this.style.setLayerZoomRange(g,t,a),this._update(!0)}setFilter(g,t,a={}){return this.style.setFilter(g,t,a),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,t,a,p={}){return this.style.setPaintProperty(g,t,a,p),this._update(!0)}getPaintProperty(g,t){return this.style.getPaintProperty(g,t)}setLayoutProperty(g,t,a,p={}){return this.style.setLayoutProperty(g,t,a,p),this._update(!0)}getLayoutProperty(g,t){return this.style.getLayoutProperty(g,t)}setLight(g,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,t){return this.style.setFeatureState(g,t),this._update()}removeFeatureState(g,t){return this.style.removeFeatureState(g,t),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,t=0;return this._container&&(g=this._container.clientWidth||400,t=this._container.clientHeight||300),[g,t]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=b.create("div","maplibregl-canvas-container mapboxgl-canvas-container",g);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=b.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions();this._resizeCanvas(a[0],a[1],this.getPixelRatio());const p=this._controlContainer=b.create("div","maplibregl-control-container mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(k=>{y[k]=b.create("div",`maplibregl-ctrl-${k} mapboxgl-ctrl-${k}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const g=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=b.create("div","maplibregl-cooperative-gesture-screen",g);let t="Control",a=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(a=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${a}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(g,t,a){this._canvas.width=a*g,this._canvas.height=a*t,this._canvas.style.width=`${g}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const g=n.extend({},m.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);t?(this.painter=new Sa(t,this.transform),n.exported$1.testSupport(t)):this.fire(new n.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(g,t,a){return!t&&a<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){let t,a=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,t),a=n.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,D=n.exported.now();this.style.zoomHistory.update(I,D);const L=new n.EvaluationParameters(I,{now:D,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),F=L.crossFadingFactor();F===1&&F===this._crossFadingFactor||(y=!0,this._crossFadingFactor=F),this.style.update(L)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.load),this.fire(new n.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const I=n.exported.now()-a;p.endQueryEXT(p.TIME_ELAPSED_EXT,t),setTimeout(()=>{const D=p.getQueryObjectEXT(t,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(t),this.fire(new n.Event("gpu-timing-frame",{cpuTime:I,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(I);this.fire(new n.Event("gpu-timing-layer",{layerTimes:D}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty;return k||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new n.Event("idle")),!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),b.remove(this._canvasContainer),b.remove(this._controlContainer),this._cooperativeGestures&&b.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),n.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=n.exported.frame(g=>{n.PerformanceUtils.frame(g),this._frame=null,this._render(g)}))}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}_setCacheLimits(g,t){n.setCacheLimits(g,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(g){this.options=n.extend({},cu,g),this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),b.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),b.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=b.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map.getZoom(),t=g===this._map.getMaxZoom(),a=g===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const g=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=g}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _r(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){b.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,t){const a=b.create("button",g,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(g,t){const a=this._map._getUIString(`NavigationControl.${t}`);g.title=a,g.setAttribute("aria-label",a)}},GeolocateControl:class extends n.Evented{constructor(g){super(),this.options=n.extend({},La,g),n.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(g){var t;return this._map=g,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Fr!==void 0?t(Fr):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(a=>{Fr=a.state!=="denied",t(Fr)}):(Fr=!!window.navigator.geolocation,t(Fr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),b.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,En=0,Nr=!1}_isOutOfMapMaxBounds(g){const t=this._map.getMaxBounds(),a=g.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new n.Event("geolocate",g)),this._finish()}}_updateCamera(g){const t=new n.LngLat(g.coords.longitude,g.coords.latitude),a=g.coords.accuracy,p=this._map.getBearing(),y=n.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),y,{geolocateSource:!0})}_updateMarker(g){if(g){const t=new n.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map._container.clientHeight/2,t=this._map.unproject([0,g]),a=this._map.unproject([1,g]),p=t.distanceTo(a),y=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&Nr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new n.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=b.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),b.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=b.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ps(this._dotElement),this._circleElement=b.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ps({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":En--,Nr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),En++,En>1?(g={maximumAge:6e5,timeout:0},Nr=!0):(g=this.options.positionOptions,Nr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:oo,LogoControl:Fo,ScaleControl:class{constructor(g){this.options=n.extend({},yr,g),n.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){tc(this._map,this._container,this.options)}onAdd(g){return this._map=g,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){b.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(g){this.options.unit=g,tc(this._map,this._container,this.options)}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),n.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=b.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){b.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=b.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);b.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(g){this.options=g,n.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(g){return this._map=g,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=b.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),b.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){b.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends n.Evented{constructor(g){super(),this.options=n.extend(Object.create(rn),g),n.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&b.remove(this._content),this._container&&(b.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new n.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=n.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const t=document.createDocumentFragment(),a=document.createElement("body");let p;for(a.innerHTML=g;p=a.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=b.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}_createCloseButton(){this.options.closeButton&&(this._closeButton=b.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(g){this._update(g.point)}_onMouseMove(g){this._update(g.point)}_onDrag(g){this._update(g.point)}_update(g){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=b.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=b.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(k=>this._container.classList.add(k)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ao(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!g))return;const t=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat);let a=this.options.anchor;const p=Ba(this.options.offset);if(!a){const k=this._container.offsetWidth,I=this._container.offsetHeight;let D;D=t.y+p.bottom.y<I?["top"]:t.y>this._map.transform.height-I?["bottom"]:[],t.x<k/2?D.push("left"):t.x>this._map.transform.width-k/2&&D.push("right"),a=D.length===0?"bottom":D.join("-")}const y=t.add(p[a]).round();b.setTransform(this._container,`${Nt[a]} translate(${y.x}px,${y.y}px)`),$t(this._container,a,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(ln);g&&g.focus()}_onClose(){this.remove()}},Marker:Ps,Style:Mn,LngLat:n.LngLat,LngLatBounds:n.LngLatBounds,Point:n.pointGeometry,MercatorCoordinate:n.MercatorCoordinate,Evented:n.Evented,AJAXError:n.AJAXError,config:n.config,CanvasSource:je,GeoJSONSource:ct,ImageSource:Qe,RasterDEMTileSource:ht,RasterTileSource:K,VectorTileSource:Ve,VideoSource:Ut,prewarm:function(){Je().acquire(tn)},clearPrewarmedResources:function(){const g=nt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(tn),nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Hi.workerCount},set workerCount(g){Hi.workerCount=g},get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){n.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){n.clearTileCache(g)},workerUrl:"",addProtocol(g,t){n.config.REGISTERED_PROTOCOLS[g]=t},removeProtocol(g){delete n.config.REGISTERED_PROTOCOLS[g]}};return nr.extend($r,{isSafari:n.isSafari,getPerformanceMetrics:n.PerformanceUtils.getPerformanceMetrics}),$r});var d=c;return d})})(tg);var p0=tg.exports;const Qo=Gc(p0);var ir=(u,r,o)=>new Promise((l,c)=>{var f=m=>{try{n(o.next(m))}catch(v){c(v)}},d=m=>{try{n(o.throw(m))}catch(v){c(v)}},n=m=>m.done?l(m.value):Promise.resolve(m.value).then(f,d);n((o=o.apply(u,r)).next())}),mr=Uint8Array,ea=Uint16Array,m0=Int32Array,ng=new mr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rg=new mr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g0=new mr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sg=function(u,r){for(var o=new ea(31),l=0;l<31;++l)o[l]=r+=1<<u[l-1];for(var c=new m0(o[30]),l=1;l<30;++l)for(var f=o[l];f<o[l+1];++f)c[f]=f-o[l]<<5|l;return{b:o,r:c}},og=sg(ng,2),ag=og.b,_0=og.r;ag[28]=258,_0[258]=28;var y0=sg(rg,0),v0=y0.b,fh=new ea(32768);for(Ui=0;Ui<32768;++Ui)cs=(Ui&43690)>>1|(Ui&21845)<<1,cs=(cs&52428)>>2|(cs&13107)<<2,cs=(cs&61680)>>4|(cs&3855)<<4,fh[Ui]=((cs&65280)>>8|(cs&255)<<8)>>1;var cs,Ui,ll=function(u,r,o){for(var l=u.length,c=0,f=new ea(r);c<l;++c)u[c]&&++f[u[c]-1];var d=new ea(r);for(c=1;c<r;++c)d[c]=d[c-1]+f[c-1]<<1;var n;if(o){n=new ea(1<<r);var m=15-r;for(c=0;c<l;++c)if(u[c])for(var v=c<<4|u[c],w=r-u[c],A=d[u[c]-1]++<<w,b=A|(1<<w)-1;A<=b;++A)n[fh[A]>>m]=v}else for(n=new ea(l),c=0;c<l;++c)u[c]&&(n[c]=fh[d[u[c]-1]++]>>15-u[c]);return n},dl=new mr(288);for(Ui=0;Ui<144;++Ui)dl[Ui]=8;var Ui;for(Ui=144;Ui<256;++Ui)dl[Ui]=9;var Ui;for(Ui=256;Ui<280;++Ui)dl[Ui]=7;var Ui;for(Ui=280;Ui<288;++Ui)dl[Ui]=8;var Ui,lg=new mr(32);for(Ui=0;Ui<32;++Ui)lg[Ui]=5;var Ui,b0=ll(dl,9,1),x0=ll(lg,5,1),Ju=function(u){for(var r=u[0],o=1;o<u.length;++o)u[o]>r&&(r=u[o]);return r},Mr=function(u,r,o){var l=r/8|0;return(u[l]|u[l+1]<<8)>>(r&7)&o},Yu=function(u,r){var o=r/8|0;return(u[o]|u[o+1]<<8|u[o+2]<<16)>>(r&7)},w0=function(u){return(u+7)/8|0},k0=function(u,r,o){(r==null||r<0)&&(r=0),(o==null||o>u.length)&&(o=u.length);var l=new mr(o-r);return l.set(u.subarray(r,o)),l},S0=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],pr=function(u,r,o){var l=new Error(r||S0[u]);if(l.code=u,Error.captureStackTrace&&Error.captureStackTrace(l,pr),!o)throw l;return l},Hh=function(u,r,o,l){var c=u.length,f=l?l.length:0;if(!c||r.f&&!r.l)return o||new mr(0);var d=!o||r.i!=2,n=r.i;o||(o=new mr(c*3));var m=function(oi){var mi=o.length;if(oi>mi){var tn=new mr(Math.max(mi*2,oi));tn.set(o),o=tn}},v=r.f||0,w=r.p||0,A=r.b||0,b=r.l,E=r.d,T=r.m,C=r.n,z=c*8;do{if(!b){v=Mr(u,w,1);var B=Mr(u,w+1,3);if(w+=3,B)if(B==1)b=b0,E=x0,T=9,C=5;else if(B==2){var Z=Mr(u,w,31)+257,ae=Mr(u,w+10,15)+4,J=Z+Mr(u,w+5,31)+1;w+=14;for(var he=new mr(J),we=new mr(19),Se=0;Se<ae;++Se)we[g0[Se]]=Mr(u,w+Se*3,7);w+=ae*3;for(var ot=Ju(we),oe=(1<<ot)-1,Ve=ll(we,ot,1),Se=0;Se<J;){var K=Ve[Mr(u,w,oe)];w+=K&15;var O=K>>4;if(O<16)he[Se++]=O;else{var Ke=0,ht=0;for(O==16?(ht=3+Mr(u,w,3),w+=2,Ke=he[Se-1]):O==17?(ht=3+Mr(u,w,7),w+=3):O==18&&(ht=11+Mr(u,w,127),w+=7);ht--;)he[Se++]=Ke}}var ct=he.subarray(0,Z),Zt=he.subarray(Z);T=Ju(ct),C=Ju(Zt),b=ll(ct,T,1),E=ll(Zt,C,1)}else pr(1);else{var O=w0(w)+4,W=u[O-4]|u[O-3]<<8,q=O+W;if(q>c){n&&pr(0);break}d&&m(A+W),o.set(u.subarray(O,q),A),r.b=A+=W,r.p=w=q*8,r.f=v;continue}if(w>z){n&&pr(0);break}}d&&m(A+131072);for(var Qe=(1<<T)-1,Ut=(1<<C)-1,je=w;;je=w){var Ke=b[Yu(u,w)&Qe],Oe=Ke>>4;if(w+=Ke&15,w>z){n&&pr(0);break}if(Ke||pr(2),Oe<256)o[A++]=Oe;else if(Oe==256){je=w,b=null;break}else{var Vt=Oe-254;if(Oe>264){var Se=Oe-257,Et=ng[Se];Vt=Mr(u,w,(1<<Et)-1)+ag[Se],w+=Et}var mt=E[Yu(u,w)&Ut],bi=mt>>4;mt||pr(3),w+=mt&15;var Zt=v0[bi];if(bi>3){var Et=rg[bi];Zt+=Yu(u,w)&(1<<Et)-1,w+=Et}if(w>z){n&&pr(0);break}d&&m(A+131072);var zi=A+Vt;if(A<Zt){var si=f-Zt,et=Math.min(Zt,zi);for(si+A<0&&pr(3);A<et;++A)o[A]=l[si+A]}for(;A<zi;A+=4)o[A]=o[A-Zt],o[A+1]=o[A+1-Zt],o[A+2]=o[A+2-Zt],o[A+3]=o[A+3-Zt];A=zi}}r.l=b,r.p=je,r.b=A,r.f=v,b&&(v=1,r.m=T,r.d=E,r.n=C)}while(!v);return A==o.length?o:k0(o,0,A)},E0=new mr(0),T0=function(u){(u[0]!=31||u[1]!=139||u[2]!=8)&&pr(6,"invalid gzip data");var r=u[3],o=10;r&4&&(o+=(u[10]|u[11]<<8)+2);for(var l=(r>>3&1)+(r>>4&1);l>0;l-=!u[o++]);return o+(r&2)},A0=function(u){var r=u.length;return(u[r-4]|u[r-3]<<8|u[r-2]<<16|u[r-1]<<24)>>>0},C0=function(u,r){return((u[0]&15)!=8||u[0]>>4>7||(u[0]<<8|u[1])%31)&&pr(6,"invalid zlib data"),(u[1]>>5&1)==+!r&&pr(6,"invalid zlib data: "+(u[1]&32?"need":"unexpected")+" dictionary"),(u[1]>>3&4)+2};function I0(u,r){return Hh(u,{i:2},r&&r.out,r&&r.dictionary)}function P0(u,r){var o=T0(u);return o+8>u.length&&pr(6,"invalid gzip data"),Hh(u.subarray(o,-8),{i:2},r&&r.out||new mr(A0(u)),r&&r.dictionary)}function z0(u,r){return Hh(u.subarray(C0(u,r&&r.dictionary),-4),{i:2},r&&r.out,r&&r.dictionary)}function dh(u,r){return u[0]==31&&u[1]==139&&u[2]==8?P0(u,r):(u[0]&15)!=8||u[0]>>4>7||(u[0]<<8|u[1])%31?I0(u,r):z0(u,r)}var M0=typeof TextDecoder<"u"&&new TextDecoder,D0=0;try{M0.decode(E0,{stream:!0}),D0=1}catch{}var cg=(u,r)=>u*Math.pow(2,r),tl=(u,r)=>Math.floor(u/Math.pow(2,r)),Rc=(u,r)=>cg(u.getUint16(r+1,!0),8)+u.getUint8(r),ug=(u,r)=>cg(u.getUint32(r+2,!0),16)+u.getUint16(r,!0),L0=(u,r,o,l,c)=>{if(u!=l.getUint8(c))return u-l.getUint8(c);const f=Rc(l,c+1);if(r!=f)return r-f;const d=Rc(l,c+4);return o!=d?o-d:0},B0=(u,r,o,l)=>{const c=hg(u,r|128,o,l);return c?{z:r,x:o,y:l,offset:c[0],length:c[1],is_dir:!0}:null},Mp=(u,r,o,l)=>{const c=hg(u,r,o,l);return c?{z:r,x:o,y:l,offset:c[0],length:c[1],is_dir:!1}:null},hg=(u,r,o,l)=>{let c=0,f=u.byteLength/17-1;for(;c<=f;){const d=f+c>>1,n=L0(r,o,l,u,d*17);if(n>0)c=d+1;else if(n<0)f=d-1;else return[ug(u,d*17+7),u.getUint32(d*17+13,!0)]}return null},R0=(u,r)=>u.is_dir&&!r.is_dir?1:!u.is_dir&&r.is_dir?-1:u.z!==r.z?u.z-r.z:u.x!==r.x?u.x-r.x:u.y-r.y,fg=(u,r)=>{const o=u.getUint8(r*17);return{z:o&127,x:Rc(u,r*17+1),y:Rc(u,r*17+4),offset:ug(u,r*17+7),length:u.getUint32(r*17+13,!0),is_dir:o>>7===1}},Dp=u=>{const r=[],o=new DataView(u);for(let l=0;l<o.byteLength/17;l++)r.push(fg(o,l));return O0(r)},O0=u=>{u.sort(R0);const r=new ArrayBuffer(17*u.length),o=new Uint8Array(r);for(let l=0;l<u.length;l++){const c=u[l];let f=c.z;c.is_dir&&(f=f|128),o[l*17]=f,o[l*17+1]=c.x&255,o[l*17+2]=c.x>>8&255,o[l*17+3]=c.x>>16&255,o[l*17+4]=c.y&255,o[l*17+5]=c.y>>8&255,o[l*17+6]=c.y>>16&255,o[l*17+7]=c.offset&255,o[l*17+8]=tl(c.offset,8)&255,o[l*17+9]=tl(c.offset,16)&255,o[l*17+10]=tl(c.offset,24)&255,o[l*17+11]=tl(c.offset,32)&255,o[l*17+12]=tl(c.offset,48)&255,o[l*17+13]=c.length&255,o[l*17+14]=c.length>>8&255,o[l*17+15]=c.length>>16&255,o[l*17+16]=c.length>>24&255}return r},F0=(u,r)=>{if(u.byteLength<17)return null;const o=u.byteLength/17,l=fg(u,o-1);if(l.is_dir){const c=l.z,f=r.z-c,d=Math.trunc(r.x/(1<<f)),n=Math.trunc(r.y/(1<<f));return{z:c,x:d,y:n}}return null};function N0(u){return ir(this,null,function*(){const r=yield u.getBytes(0,512e3),o=new DataView(r.data),l=o.getUint32(4,!0),c=o.getUint16(8,!0),f=new TextDecoder("utf-8"),d=JSON.parse(f.decode(new DataView(r.data,10,l)));let n=0;d.compression==="gzip"&&(n=2);let m=0;"minzoom"in d&&(m=+d.minzoom);let v=0;"maxzoom"in d&&(v=+d.maxzoom);let w=0,A=0,b=0,E=-180,T=-85,C=180,z=85;if(d.bounds){const O=d.bounds.split(",");E=+O[0],T=+O[1],C=+O[2],z=+O[3]}if(d.center){const O=d.center.split(",");w=+O[0],A=+O[1],b=+O[2]}return{specVersion:o.getUint16(2,!0),rootDirectoryOffset:10+l,rootDirectoryLength:c*17,jsonMetadataOffset:10,jsonMetadataLength:l,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:n,tileType:1,minZoom:m,maxZoom:v,minLon:E,minLat:T,maxLon:C,maxLat:z,centerZoom:b,centerLon:w,centerLat:A,etag:r.etag}})}function U0(u,r,o,l,c,f,d){return ir(this,null,function*(){let n=yield o.getArrayBuffer(r,u.rootDirectoryOffset,u.rootDirectoryLength,u);u.specVersion===1&&(n=Dp(n));const m=Mp(new DataView(n),l,c,f);if(m){let A=(yield r.getBytes(m.offset,m.length,d)).data;const b=new DataView(A);return b.getUint8(0)==31&&b.getUint8(1)==139&&(A=dh(new Uint8Array(A))),{data:A}}const v=F0(new DataView(n),{z:l,x:c,y:f});if(v){const w=B0(new DataView(n),v.z,v.x,v.y);if(w){let A=yield o.getArrayBuffer(r,w.offset,w.length,u);u.specVersion===1&&(A=Dp(A));const b=Mp(new DataView(A),l,c,f);if(b){let T=(yield r.getBytes(b.offset,b.length,d)).data;const C=new DataView(T);return C.getUint8(0)==31&&C.getUint8(1)==139&&(T=dh(new Uint8Array(T))),{data:T}}}}})}var dg={getHeader:N0,getZxy:U0},V0=class{constructor(){this.tile=(u,r)=>{if(u.type=="json"){const o=u.url.substr(10);let l=this.tiles.get(o);return l||(l=new Lp(o),this.tiles.set(o,l)),l.getHeader().then(c=>{const f={tiles:[u.url+"/{z}/{x}/{y}"],minzoom:c.minZoom,maxzoom:c.maxZoom,bounds:[c.minLon,c.minLat,c.maxLon,c.maxLat]};r(null,f,null,null)}).catch(c=>{r(c,null,null,null)}),{cancel:()=>{}}}else{const o=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),l=u.url.match(o);if(!l)throw new Error("Invalid PMTiles protocol URL");const c=l[1];let f=this.tiles.get(c);f||(f=new Lp(c),this.tiles.set(c,f));const d=l[2],n=l[3],m=l[4],v=new AbortController,w=v.signal;let A=()=>{v.abort()};return f.getHeader().then(b=>{f.getZxy(+d,+n,+m,w).then(E=>{E?r(null,new Uint8Array(E.data),E.cacheControl,E.expires):b.tileType==1?r(null,new Uint8Array,null,null):r(null,null,null,null)}).catch(E=>{E.name!=="AbortError"&&r(E,null,null,null)})}),{cancel:A}}},this.tiles=new Map}add(u){this.tiles.set(u.source.getKey(),u)}get(u){return this.tiles.get(u)}};function Jo(u,r){return(r>>>0)*4294967296+(u>>>0)}function G0(u,r){const o=r.buf;let l,c;if(c=o[r.pos++],l=(c&112)>>4,c<128||(c=o[r.pos++],l|=(c&127)<<3,c<128)||(c=o[r.pos++],l|=(c&127)<<10,c<128)||(c=o[r.pos++],l|=(c&127)<<17,c<128)||(c=o[r.pos++],l|=(c&127)<<24,c<128)||(c=o[r.pos++],l|=(c&1)<<31,c<128))return Jo(u,l);throw new Error("Expected varint not more than 10 bytes")}function il(u){const r=u.buf;let o,l;return l=r[u.pos++],o=l&127,l<128||(l=r[u.pos++],o|=(l&127)<<7,l<128)||(l=r[u.pos++],o|=(l&127)<<14,l<128)||(l=r[u.pos++],o|=(l&127)<<21,l<128)?o:(l=r[u.pos],o|=(l&15)<<28,G0(o,u))}function j0(u,r,o,l){if(l==0){o==1&&(r[0]=u-1-r[0],r[1]=u-1-r[1]);const c=r[0];r[0]=r[1],r[1]=c}}var q0=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Z0(u,r,o){if(u>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(r>Math.pow(2,u)-1||o>Math.pow(2,u)-1)throw Error("tile x/y outside zoom level bounds");const l=q0[u],c=Math.pow(2,u);let f=0,d=0,n=0;const m=[r,o];let v=c/2;for(;v>0;)f=(m[0]&v)>0?1:0,d=(m[1]&v)>0?1:0,n+=v*v*(3*f^d),j0(v,m,f,d),v=v/2;return l+n}function pg(u,r){return ir(this,null,function*(){if(r===1||r===0)return u;if(r===2){if(typeof globalThis.DecompressionStream>"u")return dh(new Uint8Array(u));{let l=new Response(u).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(l).arrayBuffer()}}else throw Error("Compression method not supported")})}var H0=127;function W0(u,r){let o=0,l=u.length-1;for(;o<=l;){const c=l+o>>1,f=r-u[c].tileId;if(f>0)o=c+1;else if(f<0)l=c-1;else return u[c]}return l>=0&&(u[l].runLength===0||r-u[l].tileId<u[l].runLength)?u[l]:null}var X0=class{constructor(u){this.url=u}getKey(){return this.url}getBytes(u,r,o){return ir(this,null,function*(){let l;o||(l=new AbortController,o=l.signal);let c=yield fetch(this.url,{signal:o,headers:{Range:"bytes="+u+"-"+(u+r-1)}});if(c.status===416&&u===0){const n=c.headers.get("Content-Range");if(!n||!n.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const m=+n.substr(8);c=yield fetch(this.url,{signal:o,headers:{Range:"bytes=0-"+(m-1)}})}if(c.status>=300)throw Error("Bad response code: "+c.status);const f=c.headers.get("Content-Length");if(c.status===200&&(!f||+f>r))throw l&&l.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:c.headers.get("ETag")||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};function Dr(u,r){const o=u.getUint32(r+4,!0),l=u.getUint32(r+0,!0);return o*Math.pow(2,32)+l}function K0(u,r){const o=new DataView(u),l=o.getUint8(7);if(l>3)throw Error(`Archive is spec version ${l} but this library supports up to spec version 3`);return{specVersion:l,rootDirectoryOffset:Dr(o,8),rootDirectoryLength:Dr(o,16),jsonMetadataOffset:Dr(o,24),jsonMetadataLength:Dr(o,32),leafDirectoryOffset:Dr(o,40),leafDirectoryLength:Dr(o,48),tileDataOffset:Dr(o,56),tileDataLength:Dr(o,64),numAddressedTiles:Dr(o,72),numTileEntries:Dr(o,80),numTileContents:Dr(o,88),clustered:o.getUint8(96)===1,internalCompression:o.getUint8(97),tileCompression:o.getUint8(98),tileType:o.getUint8(99),minZoom:o.getUint8(100),maxZoom:o.getUint8(101),minLon:o.getInt32(102,!0)/1e7,minLat:o.getInt32(106,!0)/1e7,maxLon:o.getInt32(110,!0)/1e7,maxLat:o.getInt32(114,!0)/1e7,centerZoom:o.getUint8(118),centerLon:o.getInt32(119,!0)/1e7,centerLat:o.getInt32(123,!0)/1e7,etag:r}}function mg(u){const r={buf:new Uint8Array(u),pos:0},o=il(r),l=[];let c=0;for(let f=0;f<o;f++){const d=il(r);l.push({tileId:c+d,offset:0,length:0,runLength:1}),c+=d}for(let f=0;f<o;f++)l[f].runLength=il(r);for(let f=0;f<o;f++)l[f].length=il(r);for(let f=0;f<o;f++){const d=il(r);d===0&&f>0?l[f].offset=l[f-1].offset+l[f-1].length:l[f].offset=d-1}return l}function J0(u){const r=new DataView(u);return r.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):r.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ta=class extends Error{};function Y0(u,r,o,l){return ir(this,null,function*(){const c=yield u.getBytes(0,16384);if(new DataView(c.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(J0(c.data)<3)return[yield dg.getHeader(u)];const d=c.data.slice(0,H0);let n=c.etag;l&&c.etag!=l&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+u.getKey()),n=void 0);const m=K0(d,n);if(o){const v=c.data.slice(m.rootDirectoryOffset,m.rootDirectoryOffset+m.rootDirectoryLength),w=u.getKey()+"|"+(m.etag||"")+"|"+m.rootDirectoryOffset+"|"+m.rootDirectoryLength,A=mg(yield r(v,m.internalCompression));return[m,[w,A.length,A]]}return[m,void 0]})}function Q0(u,r,o,l,c){return ir(this,null,function*(){const f=yield u.getBytes(o,l);if(c.etag&&c.etag!==f.etag)throw new ta(f.etag);const d=yield r(f.data,c.internalCompression),n=mg(d);if(n.length===0)throw new Error("Empty directory is invalid");return n})}var $0=class{constructor(u=100,r=!0,o=pg){this.cache=new Map,this.maxCacheEntries=u,this.counter=1,this.prefetch=r,this.decompress=o}getHeader(u,r){return ir(this,null,function*(){const o=u.getKey();if(this.cache.has(o))return this.cache.get(o).lastUsed=this.counter++,yield this.cache.get(o).data;const l=new Promise((c,f)=>{Y0(u,this.decompress,this.prefetch,r).then(d=>{d[1]&&this.cache.set(d[1][0],{lastUsed:this.counter++,data:Promise.resolve(d[1][2])}),c(d[0]),this.prune()}).catch(d=>{f(d)})});return this.cache.set(o,{lastUsed:this.counter++,data:l}),l})}getDirectory(u,r,o,l){return ir(this,null,function*(){const c=u.getKey()+"|"+(l.etag||"")+"|"+r+"|"+o;if(this.cache.has(c))return this.cache.get(c).lastUsed=this.counter++,yield this.cache.get(c).data;const f=new Promise((d,n)=>{Q0(u,this.decompress,r,o,l).then(m=>{d(m),this.prune()}).catch(m=>{n(m)})});return this.cache.set(c,{lastUsed:this.counter++,data:f}),f})}getArrayBuffer(u,r,o,l){return ir(this,null,function*(){const c=u.getKey()+"|"+(l.etag||"")+"|"+r+"|"+o;if(this.cache.has(c))return this.cache.get(c).lastUsed=this.counter++,yield this.cache.get(c).data;const f=new Promise((d,n)=>{u.getBytes(r,o).then(m=>{if(l.etag&&l.etag!==m.etag)throw new ta(m.etag);d(m.data),this.cache.has(c),this.prune()}).catch(m=>{n(m)})});return this.cache.set(c,{lastUsed:this.counter++,data:f}),f})}prune(){if(this.cache.size>=this.maxCacheEntries){let u=1/0,r;this.cache.forEach((o,l)=>{o.lastUsed<u&&(u=o.lastUsed,r=l)}),r&&this.cache.delete(r)}}invalidate(u,r){return ir(this,null,function*(){this.cache.delete(u.getKey()),yield this.getHeader(u,r)})}},Lp=class{constructor(u,r,o){typeof u=="string"?this.source=new X0(u):this.source=u,o?this.decompress=o:this.decompress=pg,r?this.cache=r:this.cache=new $0}getHeader(){return ir(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(u,r,o,l){return ir(this,null,function*(){const c=Z0(u,r,o),f=yield this.cache.getHeader(this.source);if(f.specVersion<3)return dg.getZxy(f,this.source,this.cache,u,r,o,l);if(u<f.minZoom||u>f.maxZoom)return;let d=f.rootDirectoryOffset,n=f.rootDirectoryLength;for(let m=0;m<=3;m++){const v=yield this.cache.getDirectory(this.source,d,n,f),w=W0(v,c);if(w)if(w.runLength>0){const A=yield this.source.getBytes(f.tileDataOffset+w.offset,w.length,l);if(f.etag&&f.etag!==A.etag)throw new ta(A.etag);return{data:yield this.decompress(A.data,f.tileCompression),cacheControl:A.cacheControl,expires:A.expires}}else d=f.leafDirectoryOffset+w.offset,n=w.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(u,r,o,l){return ir(this,null,function*(){try{return yield this.getZxyAttempt(u,r,o,l)}catch(c){if(c instanceof ta)return this.cache.invalidate(this.source,c.message),yield this.getZxyAttempt(u,r,o,l);throw c}})}getMetadataAttempt(){return ir(this,null,function*(){const u=yield this.cache.getHeader(this.source),r=yield this.source.getBytes(u.jsonMetadataOffset,u.jsonMetadataLength);if(u.etag&&u.etag!==r.etag)throw new ta(r.etag);const o=yield this.decompress(r.data,u.internalCompression),l=new TextDecoder("utf-8");return JSON.parse(l.decode(o))})}getMetadata(){return ir(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(u){if(u instanceof ta)return this.cache.invalidate(this.source,u.message),yield this.getMetadataAttempt();throw u}})}};const{document:Bp}=Jm;function Rp(u){let r;const o=u[20].default,l=An(o,u,u[19],null);return{c(){l&&l.c()},l(c){l&&l.l(c)},m(c,f){l&&l.m(c,f),r=!0},p(c,f){l&&l.p&&(!r||f&524288)&&Cn(l,o,c,c[19],r?Pn(o,c[19],f,null):In(c[19]),null)},i(c){r||(De(l,c),r=!0)},o(c){Xe(l,c),r=!1},d(c){l&&l.d(c)}}}function ev(u){let r,o,l,c,f,d=u[3]&&Rp(u);return{c(){r=Be("link"),l=ft(),c=Be("div"),d&&d.c(),this.h()},l(n){const m=Km("svelte-19mu9pj",Bp.head);r=Re(m,"LINK",{rel:!0,href:!0}),m.forEach(Q),l=dt(n),c=Re(n,"DIV",{id:!0,class:!0});var v=Ne(c);d&&d.l(v),v.forEach(Q),this.h()},h(){fe(r,"rel","stylesheet"),fe(r,"href",o=u[1]?u[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"),fe(c,"id",u[0]),fe(c,"class","map svelte-1tna482")},m(n,m){ke(Bp.head,r),Ie(n,l,m),Ie(n,c,m),d&&d.m(c,null),u[21](c),f=!0},p(n,[m]){(!f||m&2&&o!==(o=n[1]?n[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"))&&fe(r,"href",o),n[3]?d?(d.p(n,m),m&8&&De(d,1)):(d=Rp(n),d.c(),De(d,1),d.m(c,null)):d&&(Ii(),Xe(d,1,1,()=>{d=null}),Pi()),(!f||m&1)&&fe(c,"id",n[0])},i(n){f||(De(d),f=!0)},o(n){Xe(d),f=!1},d(n){Q(r),n&&Q(l),n&&Q(c),d&&d.d(),u[21](null)}}}function tv(u=1e3){return new Promise(r=>setTimeout(r,u))}function iv(u,r,o){let{$$slots:l={},$$scope:c}=r;const f=Uh();let{map:d}=r,{id:n="map"}=r,{location:m={lng:15,lat:45,zoom:1}}=r,{style:v={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=r,{css:w=null}=r,{pmtiles:A=!1}=r,{options:b={}}=r,{minzoom:E=0}=r,{maxzoom:T=14}=r,{controls:C=!1}=r,{tabbable:z=!1}=r,{zoom:B=null}=r,{center:O=null}=r,{pitch:W=null}=r,{bearing:q=null}=r,{interactive:Z=!0}=r,{attribution:ae=!0}=r,J,he={},we=!1;_o("map",{getMap:()=>d}),m.bounds?he.bounds=m.bounds:m.lng&&m.lat&&(he.center=[+m.lng,+m.lat],m.zoom&&(he.zoom=+m.zoom),m.pitch&&(he.pitch=+m.pitch),m.bearing&&(he.bearing=+m.bearing)),ae||(he.attributionControl=!1),he={...he,...b},jh(()=>{if(A){let oe=new V0;Qo.addProtocol("pmtiles",oe.tile)}o(4,d=new Qo.Map({container:J,style:v,minZoom:E,maxZoom:T,interactive:Z,...he})),C&&!Array.isArray(C)?d.addControl(new Qo.NavigationControl({showCompass:!1})):Array.isArray(C)&&C!=["locate"]&&d.addControl(new Qo.NavigationControl({showCompass:C.includes("compass"),visualizePitch:C.includes("pitch")})),Array.isArray(C)&&C.includes("locate")&&d.addControl(new Qo.GeolocateControl),d.on("load",oe=>{o(5,B=d.getZoom()),o(6,O=d.getCenter()),o(7,W=d.getPitch()),o(8,q=d.getBearing()),o(3,we=!0),!z&&document.querySelector(`#${n} canvas`)&&(document.querySelector(`#${n} canvas`).tabIndex="-1"),f("load",{event:oe})}),d.on("moveend",()=>{o(5,B=d.getZoom()),o(6,O=d.getCenter()),o(7,W=d.getPitch()),o(8,q=d.getBearing())})}),Vc(async()=>{await tv(250),d&&d.remove(),o(4,d=null)});function Se(oe){d&&d.setStyle(oe),f("style",{style:oe})}function ot(oe){Uc[oe?"unshift":"push"](()=>{J=oe,o(2,J)})}return u.$$set=oe=>{"map"in oe&&o(4,d=oe.map),"id"in oe&&o(0,n=oe.id),"location"in oe&&o(9,m=oe.location),"style"in oe&&o(10,v=oe.style),"css"in oe&&o(1,w=oe.css),"pmtiles"in oe&&o(11,A=oe.pmtiles),"options"in oe&&o(12,b=oe.options),"minzoom"in oe&&o(13,E=oe.minzoom),"maxzoom"in oe&&o(14,T=oe.maxzoom),"controls"in oe&&o(15,C=oe.controls),"tabbable"in oe&&o(16,z=oe.tabbable),"zoom"in oe&&o(5,B=oe.zoom),"center"in oe&&o(6,O=oe.center),"pitch"in oe&&o(7,W=oe.pitch),"bearing"in oe&&o(8,q=oe.bearing),"interactive"in oe&&o(17,Z=oe.interactive),"attribution"in oe&&o(18,ae=oe.attribution),"$$scope"in oe&&o(19,c=oe.$$scope)},u.$$.update=()=>{u.$$.dirty&1024&&Se(v)},[n,w,J,we,d,B,O,W,q,m,v,A,b,E,T,C,z,Z,ae,c,l,ot]}let nv=class extends Vi{constructor(r){super(),Gi(this,r,iv,ev,Li,{map:4,id:0,location:9,style:10,css:1,pmtiles:11,options:12,minzoom:13,maxzoom:14,controls:15,tabbable:16,zoom:5,center:6,pitch:7,bearing:8,interactive:17,attribution:18})}};function Op(u){let r;const o=u[12].default,l=An(o,u,u[11],null);return{c(){l&&l.c()},l(c){l&&l.l(c)},m(c,f){l&&l.m(c,f),r=!0},p(c,f){l&&l.p&&(!r||f&2048)&&Cn(l,o,c,c[11],r?Pn(o,c[11],f,null):In(c[11]),null)},i(c){r||(De(l,c),r=!0)},o(c){Xe(l,c),r=!1},d(c){l&&l.d(c)}}}function rv(u){let r,o,l=u[0]&&Op(u);return{c(){l&&l.c(),r=jt()},l(c){l&&l.l(c),r=jt()},m(c,f){l&&l.m(c,f),Ie(c,r,f),o=!0},p(c,[f]){c[0]?l?(l.p(c,f),f&1&&De(l,1)):(l=Op(c),l.c(),De(l,1),l.m(r.parentNode,r)):l&&(Ii(),Xe(l,1,1,()=>{l=null}),Pi())},i(c){o||(De(l),o=!0)},o(c){Xe(l),o=!1},d(c){l&&l.d(c),c&&Q(r)}}}function sv(u=1e3){return new Promise(r=>setTimeout(r,u))}function ov(u,r,o){let{$$slots:l={},$$scope:c}=r,{id:f}=r,{type:d}=r,{url:n=null}=r,{props:m={}}=r,{data:v=null}=r,{layer:w=null}=r,{promoteId:A=null}=r,{minzoom:b=null}=r,{maxzoom:E=null}=r,{tilesize:T=256}=r,C=!1,z=n;const{getMap:B}=yo("map"),O=B();_o("source",{source:f,layer:w,promoteId:A}),O.getSource(f)&&O.removeSource(f);async function W(){await sv(100),O.isSourceLoaded(f)?(o(0,C=!0),console.log(f+" map source loaded!")):(console.log("..."),W())}b&&(m.minzoom=b),E&&(m.maxzoom=E),w&&A?(m.promoteId={},m.promoteId[w]=A):A&&(m.promoteId=A);function q(){console.log(f+" map source loading...");let he;d=="geojson"?v?he={type:d,data:v,...m}:n&&(he={type:d,data:n,...m}):d=="vector"?(he={type:d,...m},n.slice(0,7)==="pmtiles"?he.url=n:he.tiles=[n]):d=="raster"?he={type:d,tiles:[n],tileSize:T,...m}:d=="raster-dem"&&(he={type:d,tiles:[n],tileSize:T,...m}),he&&(console.log(he),O.addSource(f,he),W())}function Z(he){let we=O.getSource(f);we&&we.setData(he)}function ae(he){if(he!==z){let we=O.getSource(f);we&&(he.slice(0,7)==="pmtiles"?we.setUrl(he):we.setTiles([he])),z=he}}function J(he){he!==z&&(O.getSource(f).tiles=[he],O.style.sourceCaches[f].clearTiles(),O.style.sourceCaches[f].update(O.transform),O.triggerRepaint(),z=he)}return jh(q),Vc(async()=>{O&&O.getSource(f)&&(O.getStyle().layers.filter(we=>we.source==f).forEach(we=>{O.removeLayer(we.id)}),O.removeSource(f))}),u.$$set=he=>{"id"in he&&o(2,f=he.id),"type"in he&&o(3,d=he.type),"url"in he&&o(4,n=he.url),"props"in he&&o(1,m=he.props),"data"in he&&o(5,v=he.data),"layer"in he&&o(6,w=he.layer),"promoteId"in he&&o(7,A=he.promoteId),"minzoom"in he&&o(8,b=he.minzoom),"maxzoom"in he&&o(9,E=he.maxzoom),"tilesize"in he&&o(10,T=he.tilesize),"$$scope"in he&&o(11,c=he.$$scope)},u.$$.update=()=>{u.$$.dirty&41&&d=="geojson"&&C&&Z(v),u.$$.dirty&25&&d=="vector"&&C&&ae(n),u.$$.dirty&25&&d=="raster"&&C&&J(n)},[C,m,f,d,n,v,w,A,b,E,T,c,l]}class av extends Vi{constructor(r){super(),Gi(this,r,ov,rv,Li,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const lv=u=>({hovered:u[0]&1}),Fp=u=>({hovered:u[0]});function cv(u){let r;const o=u[30].default,l=An(o,u,u[29],Fp);return{c(){l&&l.c()},l(c){l&&l.l(c)},m(c,f){l&&l.m(c,f),r=!0},p(c,f){l&&l.p&&(!r||f[0]&536870913)&&Cn(l,o,c,c[29],r?Pn(o,c[29],f,lv):In(c[29]),Fp)},i(c){r||(De(l,c),r=!0)},o(c){Xe(l,c),r=!1},d(c){l&&l.d(c)}}}function uv(u,r,o){let l,{$$slots:c={},$$scope:f}=r;const d=Uh();let{id:n}=r,{type:m}=r,{filter:v=null}=r,{layout:w={}}=r,{paint:A={}}=r,{data:b=null}=r,{colorKey:E="color"}=r,{nameKey:T=null}=r,{valueKey:C=null}=r,{idKey:z=null}=r,{select:B=!1}=r,{clickIgnore:O=!1}=r,{clickCenter:W=!1}=r,{selected:q=null}=r,{hover:Z=!1}=r,{hovered:ae=null}=r,{highlight:J=!1}=r,{highlightKey:he="highlighted"}=r,{highlighted:we=[]}=r,{order:Se=null}=r,{maxzoom:ot=null}=r,{minzoom:oe=null}=r,{sourceLayer:Ve=null}=r,{visible:K=!0}=r;const{source:Ke,layer:ht,promoteId:ct}=yo("source"),{getMap:Zt}=yo("map"),Qe=Zt();_o("layer",{layer:n});const Ut=Ym({id:null,feature:null,event:null});Nc(u,Ut,et=>o(32,l=et)),_o("hover",Ut),z=z||ct,Ve=Ve||ht;let je=null,Oe=null,Vt=[];w.visibility=K?"visible":"none";let Et={id:n,type:m,source:Ke,paint:A,layout:w};v&&(Et.filter=v),Ve&&(Et["source-layer"]=Ve),ot&&(Et.maxzoom=ot),oe&&(Et.minzoom=oe),jh(()=>{Qe.getLayer(n)&&Qe.removeLayer(n),Qe.addLayer(Et,Se)});function mt(et,oi=E){if(console.log("updating colors..."),T||C)for(const mi of et)Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:mi[z]},{color:oi?mi[oi]:null,name:T?mi[T]:null,value:C?mi[C]:null});else for(const mi of et)Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:mi[z]},{color:mi[oi]})}function bi(et){Qe.getLayer(n)&&Qe.setFilter(n,et)}function zi(et){if(Qe.getLayer(n))for(const oi in et)Qe.setPaintProperty(n,oi,et[oi])}function si(et){Qe.getLayer(n)&&Qe.setLayoutProperty(n,"visibility",et?"visible":"none")}return B&&Qe.on("click",n,et=>{if(et.features.length>0&&!O){let oi=et.features[0];if(o(2,q=oi.id),d("select",{id:q,feature:oi,event:et}),je&&Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:je},{selected:!1}),Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:q},{selected:!0}),W){let mi=centroid(et.features[0].toJSON().geometry);Qe.flyTo({center:mi.geometry.coordinates})}o(26,je=q)}}),Z&&(Qe.on("mousemove",n,et=>{if(et.features.length>0){ae&&Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:ae},{hovered:!1});let oi=et.features[0];o(0,ae=o(27,Oe=oi.id)),Ut.set({id:ae,feature:oi,event:et}),d("hover",l),Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:ae},{hovered:!0}),Qe.getCanvas().style.cursor="pointer"}}),Qe.on("mouseleave",n,et=>{ae&&Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:ae},{hovered:!1}),o(0,ae=o(27,Oe=null)),Ut.set({id:null,feature:null,event:et}),d("hover",l),Qe.getCanvas().style.cursor=""})),Vc(async()=>{Qe&&Qe.getLayer(n)&&Qe.removeLayer(n)}),u.$$set=et=>{"id"in et&&o(6,n=et.id),"type"in et&&o(7,m=et.type),"filter"in et&&o(8,v=et.filter),"layout"in et&&o(4,w=et.layout),"paint"in et&&o(9,A=et.paint),"data"in et&&o(10,b=et.data),"colorKey"in et&&o(11,E=et.colorKey),"nameKey"in et&&o(12,T=et.nameKey),"valueKey"in et&&o(13,C=et.valueKey),"idKey"in et&&o(5,z=et.idKey),"select"in et&&o(14,B=et.select),"clickIgnore"in et&&o(15,O=et.clickIgnore),"clickCenter"in et&&o(16,W=et.clickCenter),"selected"in et&&o(2,q=et.selected),"hover"in et&&o(17,Z=et.hover),"hovered"in et&&o(0,ae=et.hovered),"highlight"in et&&o(18,J=et.highlight),"highlightKey"in et&&o(19,he=et.highlightKey),"highlighted"in et&&o(20,we=et.highlighted),"order"in et&&o(21,Se=et.order),"maxzoom"in et&&o(22,ot=et.maxzoom),"minzoom"in et&&o(23,oe=et.minzoom),"sourceLayer"in et&&o(3,Ve=et.sourceLayer),"visible"in et&&o(24,K=et.visible),"$$scope"in et&&o(29,f=et.$$scope)},u.$$.update=()=>{if(u.$$.dirty[0]&3072&&b&&mt(b,E),u.$$.dirty[0]&256&&bi(v),u.$$.dirty[0]&512&&zi(A),u.$$.dirty[0]&16777216&&si(K),u.$$.dirty[0]&270270472&&J&&we!=Vt){if(Vt[0])for(const et of Vt){let oi={};oi[he]=!1,Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:et},oi)}if(o(28,Vt=we),we[0])for(const et of we){let oi={};oi[he]=!0,Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:et},oi)}}u.$$.dirty[0]&67125260&&B&&q!=je&&(je&&Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:je},{selected:!1}),q&&Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:q},{selected:!0}),o(26,je=q)),u.$$.dirty[0]&134348809&&Z&&ae!=Oe&&(Oe&&Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:Oe},{hovered:!1}),ae&&Qe.setFeatureState({source:Ke,sourceLayer:Ve,id:ae},{hovered:!0}),o(27,Oe=ae))},[ae,Ut,q,Ve,w,z,n,m,v,A,b,E,T,C,B,O,W,Z,J,he,we,Se,ot,oe,K,mt,je,Oe,Vt,f,c]}class Qu extends Vi{constructor(r){super(),Gi(this,r,uv,cv,Li,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function hv(u,r,o){let l,{content:c}=r;const f=new Qo.Popup({closeButton:!1,closeOnClick:!1}),{getMap:d}=yo("map"),n=d(),m=yo("hover");Nc(u,m,w=>o(2,l=w));function v(w,A){w.id?f.setLngLat(w.event.lngLat).setHTML(A||w.code).addTo(n):f.remove()}return Vc(()=>f.remove()),u.$$set=w=>{"content"in w&&o(1,c=w.content)},u.$$.update=()=>{u.$$.dirty&6&&v(l,c)},[m,c,l]}class fv extends Vi{constructor(r){super(),Gi(this,r,hv,null,Li,{content:1})}}function Np(u,r,o){const l=u.slice();return l[9]=r[o],l[11]=o,l}function Up(u){let r,o,l,c,f,d=u[4](u[2][u[11]])+"",n;return{c(){r=Be("div"),o=ft(),l=Be("div"),c=ft(),f=Be("div"),n=xt(d),this.h()},l(m){r=Re(m,"DIV",{class:!0,style:!0}),Ne(r).forEach(Q),o=dt(m),l=Re(m,"DIV",{class:!0,style:!0}),Ne(l).forEach(Q),c=dt(m),f=Re(m,"DIV",{class:!0,style:!0});var v=Ne(f);n=wt(v,d),v.forEach(Q),this.h()},h(){fe(r,"class","block svelte-xjas6d"),yt(r,"width",100/(u[2].length-1)+"%"),yt(r,"left",u[11]*(100/(u[2].length-1))+"%"),yt(r,"background-color",u[3][u[11]]),fe(l,"class","line svelte-xjas6d"),yt(l,"left",u[11]*(100/(u[2].length-1))+"%"),fe(f,"class","tick svelte-xjas6d"),yt(f,"left",u[11]*(100/(u[2].length-1))+"%"),qt(f,"tick-start",u[11]==0)},m(m,v){Ie(m,r,v),Ie(m,o,v),Ie(m,l,v),Ie(m,c,v),Ie(m,f,v),ke(f,n)},p(m,v){v&4&&yt(r,"width",100/(m[2].length-1)+"%"),v&4&&yt(r,"left",m[11]*(100/(m[2].length-1))+"%"),v&8&&yt(r,"background-color",m[3][m[11]]),v&4&&yt(l,"left",m[11]*(100/(m[2].length-1))+"%"),v&20&&d!==(d=m[4](m[2][m[11]])+"")&&_i(n,d),v&4&&yt(f,"left",m[11]*(100/(m[2].length-1))+"%")},d(m){m&&Q(r),m&&Q(o),m&&Q(l),m&&Q(c),m&&Q(f)}}}function Vp(u){let r,o=`${u[7](u[0],u[2])}%`,l,c,f=u[5](u[0])+"",d,n;return{c(){r=Be("div"),l=ft(),c=Be("div"),d=xt(f),n=xt(u[6]),this.h()},l(m){r=Re(m,"DIV",{class:!0}),Ne(r).forEach(Q),l=dt(m),c=Re(m,"DIV",{class:!0,style:!0});var v=Ne(c);d=wt(v,f),n=wt(v,u[6]),v.forEach(Q),this.h()},h(){fe(r,"class","marker  svelte-xjas6d"),yt(r,"left",o),fe(c,"class","value svelte-xjas6d"),yt(c,"left",u[7](u[0],u[2])+"%")},m(m,v){Ie(m,r,v),Ie(m,l,v),Ie(m,c,v),ke(c,d),ke(c,n)},p(m,v){v&5&&o!==(o=`${m[7](m[0],m[2])}%`)&&yt(r,"left",o),v&33&&f!==(f=m[5](m[0])+"")&&_i(d,f),v&64&&_i(n,m[6]),v&5&&yt(c,"left",m[7](m[0],m[2])+"%")},d(m){m&&Q(r),m&&Q(l),m&&Q(c)}}}function dv(u){let r,o,l,c,f,d=u[4](u[2][u[2].length-1])+"",n,m,v,w=u[2].slice(1),A=[];for(let E=0;E<w.length;E+=1)A[E]=Up(Np(u,w,E));let b=typeof u[0]=="number"&&Vp(u);return{c(){r=Be("div");for(let E=0;E<A.length;E+=1)A[E].c();o=ft(),l=Be("div"),c=ft(),f=Be("div"),n=xt(d),m=xt(u[6]),v=ft(),b&&b.c(),this.h()},l(E){r=Re(E,"DIV",{class:!0,style:!0});var T=Ne(r);for(let z=0;z<A.length;z+=1)A[z].l(T);o=dt(T),l=Re(T,"DIV",{class:!0,style:!0}),Ne(l).forEach(Q),c=dt(T),f=Re(T,"DIV",{class:!0,style:!0});var C=Ne(f);n=wt(C,d),m=wt(C,u[6]),C.forEach(Q),v=dt(T),b&&b.l(T),T.forEach(Q),this.h()},h(){fe(l,"class","line svelte-xjas6d"),yt(l,"left","100%"),fe(f,"class","tick tick-end svelte-xjas6d"),yt(f,"left","100%"),fe(r,"class","container svelte-xjas6d"),yt(r,"height",u[1]+"px")},m(E,T){Ie(E,r,T);for(let C=0;C<A.length;C+=1)A[C]&&A[C].m(r,null);ke(r,o),ke(r,l),ke(r,c),ke(r,f),ke(f,n),ke(f,m),ke(r,v),b&&b.m(r,null)},p(E,[T]){if(T&28){w=E[2].slice(1);let C;for(C=0;C<w.length;C+=1){const z=Np(E,w,C);A[C]?A[C].p(z,T):(A[C]=Up(z),A[C].c(),A[C].m(r,o))}for(;C<A.length;C+=1)A[C].d(1);A.length=w.length}T&20&&d!==(d=E[4](E[2][E[2].length-1])+"")&&_i(n,d),T&64&&_i(m,E[6]),typeof E[0]=="number"?b?b.p(E,T):(b=Vp(E),b.c(),b.m(r,null)):b&&(b.d(1),b=null),T&2&&yt(r,"height",E[1]+"px")},i:ci,o:ci,d(E){E&&Q(r),zn(A,E),b&&b.d()}}}function pv(u,r,o){let{hovered:l=null}=r,{lineWidth:c=3}=r,{height:f=15}=r,{breaks:d=[0,20,40,60,80,100]}=r,{colors:n=["rgba(234,236,177,.8)","rgba(169,216,145,.8)","rgba(0,167,186,.8)","rgba(0,78,166,.8)","rgba(0,13,84,.8)"]}=r,{formatTick:m=b=>b.toFixed(1)}=r,{formatVal:v=b=>b.toFixed(1)}=r,{suffix:w="%"}=r;const A=(b,E)=>{let T=0;for(;b>E[T+1];)T+=1;let C=100/(E.length-1),z=(b-E[T])/(E[T+1]-E[T]);return(T+z)*C};return u.$$set=b=>{"hovered"in b&&o(0,l=b.hovered),"lineWidth"in b&&o(8,c=b.lineWidth),"height"in b&&o(1,f=b.height),"breaks"in b&&o(2,d=b.breaks),"colors"in b&&o(3,n=b.colors),"formatTick"in b&&o(4,m=b.formatTick),"formatVal"in b&&o(5,v=b.formatVal),"suffix"in b&&o(6,w=b.suffix)},[l,f,d,n,m,v,w,A,c]}class mv extends Vi{constructor(r){super(),Gi(this,r,pv,dv,Li,{hovered:0,lineWidth:8,height:1,breaks:2,colors:3,formatTick:4,formatVal:5,suffix:6})}}function Gp(u,r,o){const l=u.slice();return l[2]=r[o],l[4]=o,l}function jp(u){let r,o,l,c=u[2].name+"",f,d,n,m=u[2].value.toFixed(1)+"",v,w,A;return{c(){r=Be("tr"),o=Be("td"),l=Be("strong"),f=xt(c),d=ft(),n=Be("td"),v=xt(m),w=xt("%"),A=ft(),this.h()},l(b){r=Re(b,"TR",{});var E=Ne(r);o=Re(E,"TD",{class:!0});var T=Ne(o);l=Re(T,"STRONG",{});var C=Ne(l);f=wt(C,c),C.forEach(Q),T.forEach(Q),d=dt(E),n=Re(E,"TD",{class:!0});var z=Ne(n);v=wt(z,m),w=wt(z,"%"),z.forEach(Q),A=dt(E),E.forEach(Q),this.h()},h(){fe(o,"class","svelte-1i52e02"),fe(n,"class","text-right svelte-1i52e02")},m(b,E){Ie(b,r,E),ke(r,o),ke(o,l),ke(l,f),ke(r,d),ke(r,n),ke(n,v),ke(n,w),ke(r,A)},p(b,E){E&1&&c!==(c=b[2].name+"")&&_i(f,c),E&1&&m!==(m=b[2].value.toFixed(1)+"")&&_i(v,m)},d(b){b&&Q(r)}}}function gv(u){let r,o,l=u[0],c=[];for(let f=0;f<l.length;f+=1)c[f]=jp(Gp(u,l,f));return{c(){r=Be("table"),o=Be("tbody");for(let f=0;f<c.length;f+=1)c[f].c();this.h()},l(f){r=Re(f,"TABLE",{class:!0});var d=Ne(r);o=Re(d,"TBODY",{});var n=Ne(o);for(let m=0;m<c.length;m+=1)c[m].l(n);n.forEach(Q),d.forEach(Q),this.h()},h(){fe(r,"class","table-rank text-small svelte-1i52e02")},m(f,d){Ie(f,r,d),ke(r,o);for(let n=0;n<c.length;n+=1)c[n]&&c[n].m(o,null)},p(f,[d]){if(d&1){l=f[0];let n;for(n=0;n<l.length;n+=1){const m=Gp(f,l,n);c[n]?c[n].p(m,d):(c[n]=jp(m),c[n].c(),c[n].m(o,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=l.length}},i:ci,o:ci,d(f){f&&Q(r),zn(c,f)}}}function _v(u,r,o){let{data:l}=r,{offset:c=1}=r;return u.$$set=f=>{"data"in f&&o(0,l=f.data),"offset"in f&&o(1,c=f.offset)},[l,c]}class gg extends Vi{constructor(r){super(),Gi(this,r,_v,gv,Li,{data:0,offset:1})}}function yv(u){let r,o;return{c(){r=Be("p"),o=xt("People with the selected characteristics as a proportion of whole population."),this.h()},l(l){r=Re(l,"P",{class:!0});var c=Ne(r);o=wt(c,"People with the selected characteristics as a proportion of whole population."),c.forEach(Q),this.h()},h(){fe(r,"class","subtitle svelte-12ieinf")},m(l,c){Ie(l,r,c),ke(r,o)},p:ci,d(l){l&&Q(r)}}}function qp(u){let r,o;return r=new av({props:{id:"lad",type:"geojson",data:u[0].geojson,promoteId:u[2].code,$$slots:{default:[bv]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&1&&(f.data=l[0].geojson),c&4&&(f.promoteId=l[2].code),c&1089&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function vv(u){let r,o;return r=new fv({props:{content:u[6]?u[0].geoCodesLookup[u[6]].name:""}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&65&&(f.content=l[6]?l[0].geoCodesLookup[l[6]].name:""),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function bv(u){let r,o,l,c,f,d,n;function m(w){u[7](w)}let v={id:"lad-fill",data:u[0].geoPerc,idKey:"code",nameKey:"name",valueKey:"value",hover:!0,tooltip:!0,type:"fill",paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"],"fill-opacity":.8},order:"place_other",$$slots:{default:[vv]},$$scope:{ctx:u}};return u[6]!==void 0&&(v.hovered=u[6]),r=new Qu({props:v}),Uc.push(()=>Vh(r,"hovered",m)),c=new Qu({props:{id:"lad-line",type:"line",paint:{"line-color":"white","line-width":.3},order:"place_other"}}),d=new Qu({props:{id:"lad-hover",type:"line",paint:{"line-color":"black","line-width":2,"line-opacity":["case",["==",["feature-state","hovered"],!0],1,0]},order:"place_other"}}),{c(){Kt(r.$$.fragment),l=ft(),Kt(c.$$.fragment),f=ft(),Kt(d.$$.fragment)},l(w){ei(r.$$.fragment,w),l=dt(w),ei(c.$$.fragment,w),f=dt(w),ei(d.$$.fragment,w)},m(w,A){Jt(r,w,A),Ie(w,l,A),Jt(c,w,A),Ie(w,f,A),Jt(d,w,A),n=!0},p(w,A){const b={};A&1&&(b.data=w[0].geoPerc),A&1089&&(b.$$scope={dirty:A,ctx:w}),!o&&A&64&&(o=!0,b.hovered=w[6],Gh(()=>o=!1)),r.$set(b)},i(w){n||(De(r.$$.fragment,w),De(c.$$.fragment,w),De(d.$$.fragment,w),n=!0)},o(w){Xe(r.$$.fragment,w),Xe(c.$$.fragment,w),Xe(d.$$.fragment,w),n=!1},d(w){Yt(r,w),w&&Q(l),Yt(c,w),w&&Q(f),Yt(d,w)}}}function xv(u){let r,o,l=u[0].geojson&&u[0].geoPerc&&qp(u);return{c(){l&&l.c(),r=jt()},l(c){l&&l.l(c),r=jt()},m(c,f){l&&l.m(c,f),Ie(c,r,f),o=!0},p(c,f){c[0].geojson&&c[0].geoPerc?l?(l.p(c,f),f&1&&De(l,1)):(l=qp(c),l.c(),De(l,1),l.m(r.parentNode,r)):l&&(Ii(),Xe(l,1,1,()=>{l=null}),Pi())},i(c){o||(De(l),o=!0)},o(c){Xe(l),o=!1},d(c){l&&l.d(c),c&&Q(r)}}}function Zp(u){let r,o,l;return o=new mv({props:{breaks:u[0].geoBreaks,hovered:u[6]&&u[0].geoPerc.find(u[8])?u[0].geoPerc.find(u[9]).value:null,colors:u[0].geoBreaks[1]==100?[u[5].seq[4]]:u[5].seq}}),{c(){r=Be("div"),Kt(o.$$.fragment),this.h()},l(c){r=Re(c,"DIV",{});var f=Ne(r);ei(o.$$.fragment,f),f.forEach(Q),this.h()},h(){yt(r,"height","38px"),yt(r,"width","100%")},m(c,f){Ie(c,r,f),Jt(o,r,null),l=!0},p(c,f){const d={};f&1&&(d.breaks=c[0].geoBreaks),f&65&&(d.hovered=c[6]&&c[0].geoPerc.find(c[8])?c[0].geoPerc.find(c[9]).value:null),f&33&&(d.colors=c[0].geoBreaks[1]==100?[c[5].seq[4]]:c[5].seq),o.$set(d)},i(c){l||(De(o.$$.fragment,c),l=!0)},o(c){Xe(o.$$.fragment,c),l=!1},d(c){c&&Q(r),Yt(o)}}}function wv(u){let r,o,l,c,f;o=new nv({props:{style:u[1],location:{bounds:u[3]},$$slots:{default:[xv]},$$scope:{ctx:u}}});let d=u[0].geoBreaks&&u[0].geoPerc&&Zp(u);return{c(){r=Be("div"),Kt(o.$$.fragment),l=ft(),d&&d.c(),c=jt(),this.h()},l(n){r=Re(n,"DIV",{});var m=Ne(r);ei(o.$$.fragment,m),m.forEach(Q),l=dt(n),d&&d.l(n),c=jt(),this.h()},h(){yt(r,"height","450px")},m(n,m){Ie(n,r,m),Jt(o,r,null),Ie(n,l,m),d&&d.m(n,m),Ie(n,c,m),f=!0},p(n,m){const v={};m&2&&(v.style=n[1]),m&8&&(v.location={bounds:n[3]}),m&1093&&(v.$$scope={dirty:m,ctx:n}),o.$set(v),n[0].geoBreaks&&n[0].geoPerc?d?(d.p(n,m),m&1&&De(d,1)):(d=Zp(n),d.c(),De(d,1),d.m(c.parentNode,c)):d&&(Ii(),Xe(d,1,1,()=>{d=null}),Pi())},i(n){f||(De(o.$$.fragment,n),De(d),f=!0)},o(n){Xe(o.$$.fragment,n),Xe(d),f=!1},d(n){n&&Q(r),Yt(o),n&&Q(l),d&&d.d(n),n&&Q(c)}}}function kv(u){let r,o;return{c(){r=Be("span"),o=xt("Make a selection to see rankings."),this.h()},l(l){r=Re(l,"SPAN",{class:!0});var c=Ne(r);o=wt(c,"Make a selection to see rankings."),c.forEach(Q),this.h()},h(){fe(r,"class","muted svelte-12ieinf")},m(l,c){Ie(l,r,c),ke(r,o)},p:ci,i:ci,o:ci,d(l){l&&Q(r)}}}function Sv(u){let r,o;return r=new gg({props:{data:[...u[0].geoPerc].filter(Hp).sort(Wp).slice(0,5)}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&1&&(f.data=[...l[0].geoPerc].filter(Hp).sort(Wp).slice(0,5)),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Ev(u){let r,o,l,c;const f=[Sv,kv],d=[];function n(m,v){return m[0].geoPerc&&m[4][0]?0:1}return r=n(u),o=d[r]=f[r](u),{c(){o.c(),l=jt()},l(m){o.l(m),l=jt()},m(m,v){d[r].m(m,v),Ie(m,l,v),c=!0},p(m,v){let w=r;r=n(m),r===w?d[r].p(m,v):(Ii(),Xe(d[w],1,1,()=>{d[w]=null}),Pi(),o=d[r],o?o.p(m,v):(o=d[r]=f[r](m),o.c()),De(o,1),o.m(l.parentNode,l))},i(m){c||(De(o),c=!0)},o(m){Xe(o),c=!1},d(m){d[r].d(m),m&&Q(l)}}}function Tv(u){let r,o;return{c(){r=Be("span"),o=xt("Make a selection to see rankings."),this.h()},l(l){r=Re(l,"SPAN",{class:!0});var c=Ne(r);o=wt(c,"Make a selection to see rankings."),c.forEach(Q),this.h()},h(){fe(r,"class","muted svelte-12ieinf")},m(l,c){Ie(l,r,c),ke(r,o)},p:ci,i:ci,o:ci,d(l){l&&Q(r)}}}function Av(u){let r,o;return r=new gg({props:{data:u[0].geoPerc.filter(Xp).sort(Kp).slice(-5),offset:u[0].geoPerc.filter(Jp).length-4}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&1&&(f.data=l[0].geoPerc.filter(Xp).sort(Kp).slice(-5)),c&1&&(f.offset=l[0].geoPerc.filter(Jp).length-4),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Cv(u){let r,o,l,c;const f=[Av,Tv],d=[];function n(m,v){return m[0].geoPerc&&m[4][0]?0:1}return r=n(u),o=d[r]=f[r](u),{c(){o.c(),l=jt()},l(m){o.l(m),l=jt()},m(m,v){d[r].m(m,v),Ie(m,l,v),c=!0},p(m,v){let w=r;r=n(m),r===w?d[r].p(m,v):(Ii(),Xe(d[w],1,1,()=>{d[w]=null}),Pi(),o=d[r],o?o.p(m,v):(o=d[r]=f[r](m),o.c()),De(o,1),o.m(l.parentNode,l))},i(m){c||(De(o),c=!0)},o(m){Xe(o),c=!1},d(m){d[r].d(m),m&&Q(l)}}}function Iv(u){let r,o,l,c,f,d,n,m;return r=new ps({props:{colspan:3,rowspan:1,noBackground:!0,$$slots:{default:[yv]},$$scope:{ctx:u}}}),l=new ps({props:{colspan:2,rowspan:2,noBackground:!0,$$slots:{default:[wv]},$$scope:{ctx:u}}}),f=new ps({props:{title:"Areas with high %",$$slots:{default:[Ev]},$$scope:{ctx:u}}}),n=new ps({props:{title:"Areas with low %",$$slots:{default:[Cv]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment),o=ft(),Kt(l.$$.fragment),c=ft(),Kt(f.$$.fragment),d=ft(),Kt(n.$$.fragment)},l(v){ei(r.$$.fragment,v),o=dt(v),ei(l.$$.fragment,v),c=dt(v),ei(f.$$.fragment,v),d=dt(v),ei(n.$$.fragment,v)},m(v,w){Jt(r,v,w),Ie(v,o,w),Jt(l,v,w),Ie(v,c,w),Jt(f,v,w),Ie(v,d,w),Jt(n,v,w),m=!0},p(v,w){const A={};w&1024&&(A.$$scope={dirty:w,ctx:v}),r.$set(A);const b={};w&1135&&(b.$$scope={dirty:w,ctx:v}),l.$set(b);const E={};w&1041&&(E.$$scope={dirty:w,ctx:v}),f.$set(E);const T={};w&1041&&(T.$$scope={dirty:w,ctx:v}),n.$set(T)},i(v){m||(De(r.$$.fragment,v),De(l.$$.fragment,v),De(f.$$.fragment,v),De(n.$$.fragment,v),m=!0)},o(v){Xe(r.$$.fragment,v),Xe(l.$$.fragment,v),Xe(f.$$.fragment,v),Xe(n.$$.fragment,v),m=!1},d(v){Yt(r,v),v&&Q(o),Yt(l,v),v&&Q(c),Yt(f,v),v&&Q(d),Yt(n,v)}}}function Pv(u){let r,o;return r=new qh({props:{title:"Population by area",height:"auto",$$slots:{default:[Iv]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,[c]){const f={};c&1151&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}const Hp=u=>u.value!=null,Wp=(u,r)=>r.value-u.value,Xp=u=>u.value!=null,Kp=(u,r)=>r.value-u.value,Jp=u=>u.value!=null;function zv(u,r,o){let{data:l}=r,{mapStyle:c}=r,{ladBounds:f}=r,{mapBounds:d}=r,{selected:n}=r,{colors:m}=r,v;function w(E){v=E,o(6,v)}const A=E=>E.code==v,b=E=>E.code==v;return u.$$set=E=>{"data"in E&&o(0,l=E.data),"mapStyle"in E&&o(1,c=E.mapStyle),"ladBounds"in E&&o(2,f=E.ladBounds),"mapBounds"in E&&o(3,d=E.mapBounds),"selected"in E&&o(4,n=E.selected),"colors"in E&&o(5,m=E.colors)},[l,c,f,d,n,m,v,w,A,b]}class Mv extends Vi{constructor(r){super(),Gi(this,r,zv,Pv,Li,{data:0,mapStyle:1,ladBounds:2,mapBounds:3,selected:4,colors:5})}}function Yp(u){let r,o;return r=new ps({props:{title:u[0],$$slots:{default:[Rv]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&1&&(f.title=l[0]),c&30&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Dv(u){let r,o,l;var c=u[3];function f(d){return{props:{data:d[2].selected&&Lc("residents",d[1].code,d[2]),showLegend:!1}}}return c&&(r=Ed(c,f(u))),{c(){r&&Kt(r.$$.fragment),o=jt()},l(d){r&&ei(r.$$.fragment,d),o=jt()},m(d,n){r&&Jt(r,d,n),Ie(d,o,n),l=!0},p(d,n){const m={};if(n&6&&(m.data=d[2].selected&&Lc("residents",d[1].code,d[2])),n&8&&c!==(c=d[3])){if(r){Ii();const v=r;Xe(v.$$.fragment,1,0,()=>{Yt(v,1)}),Pi()}c?(r=Ed(c,f(d)),Kt(r.$$.fragment),De(r.$$.fragment,1),Jt(r,o.parentNode,o)):r=null}else c&&r.$set(m)},i(d){l||(r&&De(r.$$.fragment,d),l=!0)},o(d){r&&Xe(r.$$.fragment,d),l=!1},d(d){d&&Q(o),r&&Yt(r,d)}}}function Lv(u){let r,o=hl.nodata+"",l;return{c(){r=Be("span"),l=xt(o),this.h()},l(c){r=Re(c,"SPAN",{class:!0});var f=Ne(r);l=wt(f,o),f.forEach(Q),this.h()},h(){fe(r,"class","num-desc svelte-1yn8adz")},m(c,f){Ie(c,r,f),ke(r,l)},p:ci,i:ci,o:ci,d(c){c&&Q(r)}}}function Bv(u){let r,o=hl.blocked+"",l;return{c(){r=Be("span"),l=xt(o),this.h()},l(c){r=Re(c,"SPAN",{class:!0});var f=Ne(r);l=wt(f,o),f.forEach(Q),this.h()},h(){fe(r,"class","num-desc svelte-1yn8adz")},m(c,f){Ie(c,r,f),ke(r,l)},p:ci,i:ci,o:ci,d(c){c&&Q(r)}}}function Rv(u){let r,o,l,c,f,d=kd[u[1].code]+"",n,m;const v=[Bv,Lv,Dv],w=[];function A(b,E){return b[2].selected.residents[b[1].code].values==="blocked"?0:b[2].selected.residents[b[1].code].values.percent[0]==null?1:2}return r=A(u),o=w[r]=v[r](u),{c(){o.c(),l=ft(),c=Be("span"),f=xt("% of "),n=xt(d),this.h()},l(b){o.l(b),l=dt(b),c=Re(b,"SPAN",{class:!0});var E=Ne(c);f=wt(E,"% of "),n=wt(E,d),E.forEach(Q),this.h()},h(){fe(c,"class","num-desc svelte-1yn8adz")},m(b,E){w[r].m(b,E),Ie(b,l,E),Ie(b,c,E),ke(c,f),ke(c,n),m=!0},p(b,E){let T=r;r=A(b),r===T?w[r].p(b,E):(Ii(),Xe(w[T],1,1,()=>{w[T]=null}),Pi(),o=w[r],o?o.p(b,E):(o=w[r]=v[r](b),o.c()),De(o,1),o.m(l.parentNode,l)),(!m||E&2)&&d!==(d=kd[b[1].code]+"")&&_i(n,d)},i(b){m||(De(o),m=!0)},o(b){Xe(o),m=!1},d(b){w[r].d(b),b&&Q(l),b&&Q(c)}}}function Ov(u){var c,f;let r,o,l=((f=(c=u[2].selected.residents)==null?void 0:c[u[1].code])==null?void 0:f.values)&&Yp(u);return{c(){l&&l.c(),r=jt()},l(d){l&&l.l(d),r=jt()},m(d,n){l&&l.m(d,n),Ie(d,r,n),o=!0},p(d,[n]){var m,v;(v=(m=d[2].selected.residents)==null?void 0:m[d[1].code])!=null&&v.values?l?(l.p(d,n),n&6&&De(l,1)):(l=Yp(d),l.c(),De(l,1),l.m(r.parentNode,r)):l&&(Ii(),Xe(l,1,1,()=>{l=null}),Pi())},i(d){o||(De(l),o=!0)},o(d){Xe(l),o=!1},d(d){l&&l.d(d),d&&Q(r)}}}function Fv(u,r,o){let{title:l}=r,{table:c}=r,{data:f}=r,{chart_type:d}=r;return u.$$set=n=>{"title"in n&&o(0,l=n.title),"table"in n&&o(1,c=n.table),"data"in n&&o(2,f=n.data),"chart_type"in n&&o(3,d=n.chart_type)},[l,c,f,d]}class _g extends Vi{constructor(r){super(),Gi(this,r,Fv,Ov,Li,{title:0,table:1,data:2,chart_type:3})}}function Nv(u){let r,o;const l=u[5].default,c=An(l,u,u[4],null);return{c(){r=Be("mark"),c&&c.c(),this.h()},l(f){r=Re(f,"MARK",{class:!0,style:!0,role:!0});var d=Ne(r);c&&c.l(d),d.forEach(Q),this.h()},h(){fe(r,"class","em svelte-1602h77"),yt(r,"background-color",u[0]),yt(r,"color",u[2]),fe(r,"role","presentation"),qt(r,"nowrap",u[1])},m(f,d){Ie(f,r,d),c&&c.m(r,null),o=!0},p(f,[d]){c&&c.p&&(!o||d&16)&&Cn(c,l,f,f[4],o?Pn(l,f[4],d,null):In(f[4]),null),(!o||d&1)&&yt(r,"background-color",f[0]),(!o||d&4)&&yt(r,"color",f[2]),(!o||d&2)&&qt(r,"nowrap",f[1])},i(f){o||(De(c,f),o=!0)},o(f){Xe(c,f),o=!1},d(f){f&&Q(r),c&&c.d(f)}}}function Uv(u,r,o){let l,{$$slots:c={},$$scope:f}=r,{color:d="lightgrey"}=r,{nowrap:n=!0}=r;function m(w){return(w[0]*299+w[1]*587+w[2]*114)/1e3>125?"black":"white"}let v="black";return u.$$set=w=>{"color"in w&&o(0,d=w.color),"nowrap"in w&&o(1,n=w.nowrap),"$$scope"in w&&o(4,f=w.$$scope)},u.$$.update=()=>{u.$$.dirty&1&&o(3,l=A1(d).rgb),u.$$.dirty&8&&l&&o(2,v=m(l))},[d,n,v,l,f,c]}class Vv extends Vi{constructor(r){super(),Gi(this,r,Uv,Nv,Li,{color:0,nowrap:1})}}function Gv(u){let r,o=u[0].selected.total_pop.count.toLocaleString()+"",l,c,f,d,n,m,v,w,A;return v=new Vv({props:{color:"lightgrey",$$slots:{default:[qv]},$$scope:{ctx:u}}}),{c(){r=Be("div"),l=xt(o),c=ft(),f=Be("div"),d=xt("people"),n=ft(),m=Be("div"),Kt(v.$$.fragment),w=xt(" of the total population of England and Wales"),this.h()},l(b){r=Re(b,"DIV",{class:!0});var E=Ne(r);l=wt(E,o),E.forEach(Q),c=dt(b),f=Re(b,"DIV",{class:!0});var T=Ne(f);d=wt(T,"people"),T.forEach(Q),n=dt(b),m=Re(b,"DIV",{class:!0});var C=Ne(m);ei(v.$$.fragment,C),w=wt(C," of the total population of England and Wales"),C.forEach(Q),this.h()},h(){fe(r,"class","num-big svelte-c46qp4"),fe(f,"class","num-suffix svelte-c46qp4"),fe(m,"class","num-desc svelte-c46qp4")},m(b,E){Ie(b,r,E),ke(r,l),Ie(b,c,E),Ie(b,f,E),ke(f,d),Ie(b,n,E),Ie(b,m,E),Jt(v,m,null),ke(m,w),A=!0},p(b,E){(!A||E&1)&&o!==(o=b[0].selected.total_pop.count.toLocaleString()+"")&&_i(l,o);const T={};E&3&&(T.$$scope={dirty:E,ctx:b}),v.$set(T)},i(b){A||(De(v.$$.fragment,b),A=!0)},o(b){Xe(v.$$.fragment,b),A=!1},d(b){b&&Q(r),b&&Q(c),b&&Q(f),b&&Q(n),b&&Q(m),Yt(v)}}}function jv(u){let r,o=hl.nodata+"",l;return{c(){r=Be("div"),l=xt(o),this.h()},l(c){r=Re(c,"DIV",{class:!0});var f=Ne(r);l=wt(f,o),f.forEach(Q),this.h()},h(){fe(r,"class","num-desc svelte-c46qp4")},m(c,f){Ie(c,r,f),ke(r,l)},p:ci,i:ci,o:ci,d(c){c&&Q(r)}}}function qv(u){let r=np(u[0].selected.total_pop.percent)+"",o,l;return{c(){o=xt(r),l=xt("%")},l(c){o=wt(c,r),l=wt(c,"%")},m(c,f){Ie(c,o,f),Ie(c,l,f)},p(c,f){f&1&&r!==(r=np(c[0].selected.total_pop.percent)+"")&&_i(o,r)},d(c){c&&Q(o),c&&Q(l)}}}function Zv(u){let r,o,l,c;const f=[jv,Gv],d=[];function n(m,v){return m[0].selected.total_pop.count==null?0:1}return r=n(u),o=d[r]=f[r](u),{c(){o.c(),l=jt()},l(m){o.l(m),l=jt()},m(m,v){d[r].m(m,v),Ie(m,l,v),c=!0},p(m,v){let w=r;r=n(m),r===w?d[r].p(m,v):(Ii(),Xe(d[w],1,1,()=>{d[w]=null}),Pi(),o=d[r],o?o.p(m,v):(o=d[r]=f[r](m),o.c()),De(o,1),o.m(l.parentNode,l))},i(m){c||(De(o),c=!0)},o(m){Xe(o),c=!1},d(m){d[r].d(m),m&&Q(l)}}}function Hv(u){let r,o;return r=new ps({props:{title:"Population",$$slots:{default:[Zv]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,[c]){const f={};c&3&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Wv(u,r,o){let{data:l}=r;return u.$$set=c=>{"data"in c&&o(0,l=c.data)},[l]}class Xv extends Vi{constructor(r){super(),Gi(this,r,Wv,Hv,Li,{data:0})}}function Kv(u){let r,o,l,c,f=`translateX(${u[3]/u[1]+(u[1]-u[4])}px)`,d,n=`${u[2]}px`,m=`${u[4]}px`;return{c(){r=Be("div"),o=xt(u[0]),l=ft(),c=Be("div"),this.h()},l(v){r=Re(v,"DIV",{class:!0});var w=Ne(r);o=wt(w,u[0]),l=dt(w),c=Re(w,"DIV",{class:!0}),Ne(c).forEach(Q),w.forEach(Q),this.h()},h(){fe(c,"class","caret svelte-1491tb3"),yt(c,"transform",f),fe(r,"class","tooltip svelte-1491tb3"),jm(()=>u[6].call(r)),yt(r,"top",n),yt(r,"left",m)},m(v,w){Ie(v,r,w),ke(r,o),ke(r,l),ke(r,c),d=qm(r,u[6].bind(r))},p(v,[w]){w&1&&_i(o,v[0]),w&26&&f!==(f=`translateX(${v[3]/v[1]+(v[1]-v[4])}px)`)&&yt(c,"transform",f),w&4&&n!==(n=`${v[2]}px`)&&yt(r,"top",n),w&16&&m!==(m=`${v[4]}px`)&&yt(r,"left",m)},i:ci,o:ci,d(v){v&&Q(r),d()}}}const Ec=4;function Jv(u,r,o){let l,{title:c}=r,{x:f}=r,{y:d}=r,{width:n}=r,m;function v(){m=this.clientWidth,o(3,m)}return u.$$set=w=>{"title"in w&&o(0,c=w.title),"x"in w&&o(1,f=w.x),"y"in w&&o(2,d=w.y),"width"in w&&o(5,n=w.width)},u.$$.update=()=>{u.$$.dirty&42&&o(4,l=m&&f+m/2>n-Ec?n-m/2-Ec:m&&f-m/2<0+Ec?m/2+Ec:f)},[c,f,d,m,l,n,v]}class Yv extends Vi{constructor(r){super(),Gi(this,r,Jv,Kv,Li,{title:0,x:1,y:2,width:5})}}function Qv(u){let r,o;function l(f){r=u.getAttribute("title"),u.removeAttribute("title");let d=document.body.getBoundingClientRect(),n=u.getBoundingClientRect(),m=n.bottom,v=(n.left+n.right)/2;o=new Yv({props:{title:r,x:v,y:m-d.y,width:d.width},target:document.body})}function c(){o.$destroy(),u.setAttribute("title",r)}return u.addEventListener("mouseover",l),u.addEventListener("mouseout",c),{destroy(){o&&o.$destroy(),u.removeEventListener("mouseover",l),u.removeEventListener("mouseout",c)}}}function Qp(u,r,o){const l=u.slice();return l[20]=r[o],l[22]=o,l}function $p(u,r,o){const l=u.slice();return l[23]=r[o],l[25]=o,l}function em(u,r,o){const l=u.slice();return l[23]=r[o],l[25]=o,l}function tm(u,r,o){const l=u.slice();return l[27]=r[o],l[22]=o,l}function im(u){let r,o=u[12],l=[];for(let c=0;c<o.length;c+=1)l[c]=nm(tm(u,o,c));return{c(){r=Be("ul");for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){r=Re(c,"UL",{class:!0});var f=Ne(r);for(let d=0;d<l.length;d+=1)l[d].l(f);f.forEach(Q),this.h()},h(){fe(r,"class","legend-block svelte-h6j55z")},m(c,f){Ie(c,r,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(r,null)},p(c,f){if(f&4112){o=c[12];let d;for(d=0;d<o.length;d+=1){const n=tm(c,o,d);l[d]?l[d].p(n,f):(l[d]=nm(n),l[d].c(),l[d].m(r,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=o.length}},d(c){c&&Q(r),zn(l,c)}}}function nm(u){let r,o,l=`${u[22]==0?0:u[4]}px`,c,f,d=u[27]+"",n,m;return{c(){r=Be("li"),o=Be("div"),c=ft(),f=Be("span"),n=xt(d),m=ft(),this.h()},l(v){r=Re(v,"LI",{class:!0});var w=Ne(r);o=Re(w,"DIV",{class:!0}),Ne(o).forEach(Q),c=dt(w),f=Re(w,"SPAN",{class:!0});var A=Ne(f);n=wt(A,d),A.forEach(Q),m=dt(w),w.forEach(Q),this.h()},h(){fe(o,"class","legend-vis "+(u[22]==0?"bar":"marker-vis")+" svelte-h6j55z"),yt(o,"border-bottom-width",l),fe(f,"class",zc(u[22]==0?"bold":"brackets")+" svelte-h6j55z"),fe(r,"class","svelte-h6j55z")},m(v,w){Ie(v,r,w),ke(r,o),ke(r,c),ke(r,f),ke(f,n),ke(r,m)},p(v,w){w&16&&l!==(l=`${v[22]==0?0:v[4]}px`)&&yt(o,"border-bottom-width",l),w&4096&&d!==(d=v[27]+"")&&_i(n,d)},d(v){v&&Q(r)}}}function $v(u){let r,o=u[20].values,l=[];for(let c=0;c<o.length;c+=1)l[c]=rm($p(u,o,c));return{c(){for(let c=0;c<l.length;c+=1)l[c].c();r=jt()},l(c){for(let f=0;f<l.length;f+=1)l[f].l(c);r=jt()},m(c,f){for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(c,f);Ie(c,r,f)},p(c,f){if(f&11282){o=c[20].values;let d;for(d=0;d<o.length;d+=1){const n=$p(c,o,d);l[d]?l[d].p(n,f):(l[d]=rm(n),l[d].c(),l[d].m(r.parentNode,r))}for(;d<l.length;d+=1)l[d].d(1);l.length=o.length}},d(c){zn(l,c),c&&Q(r)}}}function eb(u){let r,o=u[20].values,l=[];for(let c=0;c<o.length;c+=1)l[c]=sm(em(u,o,c));return{c(){for(let c=0;c<l.length;c+=1)l[c].c();r=jt()},l(c){for(let f=0;f<l.length;f+=1)l[f].l(c);r=jt()},m(c,f){for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(c,f);Ie(c,r,f)},p(c,f){if(f&11271){o=c[20].values;let d;for(d=0;d<o.length;d+=1){const n=em(c,o,d);l[d]?l[d].p(n,f):(l[d]=sm(n),l[d].c(),l[d].m(r.parentNode,r))}for(;d<l.length;d+=1)l[d].d(1);l.length=o.length}},d(c){zn(l,c),c&&Q(r)}}}function rm(u){let r,o=`calc(${u[11](u[23][u[1]])}% - ${u[4]/2}px)`,l=`${u[25]/u[13].length*100}%`,c=`calc(${1/u[13].length*100}% - 2px)`,f=`${u[4]}px`;return{c(){r=Be("div"),this.h()},l(d){r=Re(d,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","marker svelte-h6j55z"),yt(r,"bottom",o),yt(r,"height","0px"),yt(r,"left",l),yt(r,"width",c),yt(r,"border-bottom-width",f)},m(d,n){Ie(d,r,n)},p(d,n){n&3090&&o!==(o=`calc(${d[11](d[23][d[1]])}% - ${d[4]/2}px)`)&&yt(r,"bottom",o),n&8192&&l!==(l=`${d[25]/d[13].length*100}%`)&&yt(r,"left",l),n&8192&&c!==(c=`calc(${1/d[13].length*100}% - 2px)`)&&yt(r,"width",c),n&16&&f!==(f=`${d[4]}px`)&&yt(r,"border-bottom-width",f)},d(d){d&&Q(r)}}}function sm(u){let r,o,l=`${u[11](u[23][u[1]])}%`,c=`calc(${u[25]/u[13].length*100}%)`,f=`calc(${1/u[13].length*100}% - 2px)`,d,n;return{c(){r=Be("div"),this.h()},l(m){r=Re(m,"DIV",{title:!0,class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"title",o=`${u[23][u[0]]}: ${u[2](u[23][u[1]])}%`+(u[10].length>1?` (${u[2](u[10][u[22]+1].values[u[25]][u[1]])}%)`:"")),fe(r,"class","bar svelte-h6j55z"),yt(r,"bottom","0"),yt(r,"height",l),yt(r,"left",c),yt(r,"width",f)},m(m,v){Ie(m,r,v),d||(n=Xm(Qv.call(null,r)),d=!0)},p(m,v){v&1031&&o!==(o=`${m[23][m[0]]}: ${m[2](m[23][m[1]])}%`+(m[10].length>1?` (${m[2](m[10][m[22]+1].values[m[25]][m[1]])}%)`:""))&&fe(r,"title",o),v&3074&&l!==(l=`${m[11](m[23][m[1]])}%`)&&yt(r,"height",l),v&8192&&c!==(c=`calc(${m[25]/m[13].length*100}%)`)&&yt(r,"left",c),v&8192&&f!==(f=`calc(${1/m[13].length*100}% - 2px)`)&&yt(r,"width",f)},d(m){m&&Q(r),d=!1,n()}}}function om(u){let r;function o(f,d){return f[22]==0?eb:$v}let c=o(u)(u);return{c(){c.c(),r=jt()},l(f){c.l(f),r=jt()},m(f,d){c.m(f,d),Ie(f,r,d)},p(f,d){c.p(f,d)},d(f){c.d(f),f&&Q(r)}}}function am(u){let r,o,l=u[6][0]!=0&&lm(u),c=u[6][1]!=18&&cm(u);return{c(){l&&l.c(),r=ft(),c&&c.c(),o=jt()},l(f){l&&l.l(f),r=dt(f),c&&c.l(f),o=jt()},m(f,d){l&&l.m(f,d),Ie(f,r,d),c&&c.m(f,d),Ie(f,o,d)},p(f,d){f[6][0]!=0?l?l.p(f,d):(l=lm(f),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null),f[6][1]!=18?c?c.p(f,d):(c=cm(f),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(f){l&&l.d(f),f&&Q(r),c&&c.d(f),f&&Q(o)}}}function lm(u){let r,o=`${u[15](u[10])}%`;return{c(){r=Be("div"),this.h()},l(l){r=Re(l,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","mask svelte-h6j55z"),yt(r,"bottom","0"),yt(r,"height",o),yt(r,"left","0"),yt(r,"width",u[14](u[6][0]))},m(l,c){Ie(l,r,c)},p(l,c){c&1024&&o!==(o=`${l[15](l[10])}%`)&&yt(r,"height",o),c&64&&yt(r,"width",l[14](l[6][0]))},d(l){l&&Q(r)}}}function cm(u){let r,o=`${u[15](u[10])}%`;return{c(){r=Be("div"),this.h()},l(l){r=Re(l,"DIV",{class:!0}),Ne(r).forEach(Q),this.h()},h(){fe(r,"class","mask svelte-h6j55z"),yt(r,"bottom","0"),yt(r,"height",o),yt(r,"left",u[14](u[6][1])),yt(r,"right","2px")},m(l,c){Ie(l,r,c)},p(l,c){c&1024&&o!==(o=`${l[15](l[10])}%`)&&yt(r,"height",o),c&64&&yt(r,"left",l[14](l[6][1]))},d(l){l&&Q(r)}}}function um(u){let r,o,l;return{c(){r=Be("small"),o=xt(u[7]),l=xt(u[8]),this.h()},l(c){r=Re(c,"SMALL",{class:!0});var f=Ne(r);o=wt(f,u[7]),l=wt(f,u[8]),f.forEach(Q),this.h()},h(){fe(r,"class","svelte-h6j55z")},m(c,f){Ie(c,r,f),ke(r,o),ke(r,l)},p(c,f){f&128&&_i(o,c[7]),f&256&&_i(l,c[8])},d(c){c&&Q(r)}}}function tb(u){let r,o,l,c=`${u[3]}px`,f,d,n,m=u[5][0]+"",v,w,A,b=u[5][1]+"",E,T,C,z=u[9]&&u[12][1]&&im(u),B=u[10],O=[];for(let Z=0;Z<B.length;Z+=1)O[Z]=om(Qp(u,B,Z));let W=u[6]!=null&&am(u),q=u[7]&&um(u);return{c(){z&&z.c(),r=ft(),o=Be("div");for(let Z=0;Z<O.length;Z+=1)O[Z].c();l=ft(),W&&W.c(),f=ft(),d=Be("div"),n=Be("div"),v=xt(m),w=ft(),A=Be("div"),E=xt(b),T=ft(),q&&q.c(),C=jt(),this.h()},l(Z){z&&z.l(Z),r=dt(Z),o=Re(Z,"DIV",{class:!0});var ae=Ne(o);for(let Se=0;Se<O.length;Se+=1)O[Se].l(ae);l=dt(ae),W&&W.l(ae),ae.forEach(Q),f=dt(Z),d=Re(Z,"DIV",{class:!0});var J=Ne(d);n=Re(J,"DIV",{class:!0});var he=Ne(n);v=wt(he,m),he.forEach(Q),w=dt(J),A=Re(J,"DIV",{class:!0});var we=Ne(A);E=wt(we,b),we.forEach(Q),J.forEach(Q),T=dt(Z),q&&q.l(Z),C=jt(),this.h()},h(){fe(o,"class","bar-group svelte-h6j55z"),yt(o,"height",c),fe(n,"class","svelte-h6j55z"),yt(n,"left","0"),fe(A,"class","svelte-h6j55z"),yt(A,"right","0"),fe(d,"class","x-scale svelte-h6j55z"),yt(d,"height","1rem")},m(Z,ae){z&&z.m(Z,ae),Ie(Z,r,ae),Ie(Z,o,ae);for(let J=0;J<O.length;J+=1)O[J]&&O[J].m(o,null);ke(o,l),W&&W.m(o,null),Ie(Z,f,ae),Ie(Z,d,ae),ke(d,n),ke(n,v),ke(d,w),ke(d,A),ke(A,E),Ie(Z,T,ae),q&&q.m(Z,ae),Ie(Z,C,ae)},p(Z,[ae]){if(Z[9]&&Z[12][1]?z?z.p(Z,ae):(z=im(Z),z.c(),z.m(r.parentNode,r)):z&&(z.d(1),z=null),ae&11287){B=Z[10];let J;for(J=0;J<B.length;J+=1){const he=Qp(Z,B,J);O[J]?O[J].p(he,ae):(O[J]=om(he),O[J].c(),O[J].m(o,l))}for(;J<O.length;J+=1)O[J].d(1);O.length=B.length}Z[6]!=null?W?W.p(Z,ae):(W=am(Z),W.c(),W.m(o,null)):W&&(W.d(1),W=null),ae&8&&c!==(c=`${Z[3]}px`)&&yt(o,"height",c),ae&32&&m!==(m=Z[5][0]+"")&&_i(v,m),ae&32&&b!==(b=Z[5][1]+"")&&_i(E,b),Z[7]?q?q.p(Z,ae):(q=um(Z),q.c(),q.m(C.parentNode,C)):q&&(q.d(1),q=null)},i:ci,o:ci,d(Z){z&&z.d(Z),Z&&Q(r),Z&&Q(o),zn(O,Z),W&&W.d(),Z&&Q(f),Z&&Q(d),Z&&Q(T),q&&q.d(Z),Z&&Q(C)}}}function ib(u,r,o){let l,c,f,d,n,{data:m}=r,{xKey:v="category"}=r,{yKey:w="value"}=r,{zKey:A="areanm"}=r,{formatTick:b=J=>J.toFixed(1)}=r,{height:E=100}=r,{markerWidth:T=2.5}=r,{minmax:C=["0 years","85+"]}=r,{maskRange:z=null}=r,{base:B=null}=r,{base_ext:O=", 5 year age bands"}=r,{showLegend:W=!0}=r;function q(J,he){let we={};for(const ot of J)we[ot[he]]||(we[ot[he]]={label:ot[he],values:[]}),we[ot[he]].values.push(ot);let Se=[];for(const ot in we)Se.push(we[ot]);return Se}function Z(J){return J%1===0?`calc(${J/l.length*100}% - 1px)`:`calc(${Math.floor(J)/l.length*100}% +(${1/l.length*100}% - 2px) * ${J%1})`}function ae(J){return Math.max(...J.map(he=>Math.max(...he.values.map(we=>d(we[w])))))}return u.$$set=J=>{"data"in J&&o(16,m=J.data),"xKey"in J&&o(0,v=J.xKey),"yKey"in J&&o(1,w=J.yKey),"zKey"in J&&o(17,A=J.zKey),"formatTick"in J&&o(2,b=J.formatTick),"height"in J&&o(3,E=J.height),"markerWidth"in J&&o(4,T=J.markerWidth),"minmax"in J&&o(5,C=J.minmax),"maskRange"in J&&o(6,z=J.maskRange),"base"in J&&o(7,B=J.base),"base_ext"in J&&o(8,O=J.base_ext),"showLegend"in J&&o(9,W=J.showLegend)},u.$$.update=()=>{u.$$.dirty&65537&&o(13,l=m.map(J=>J[v]).filter((J,he,we)=>we.indexOf(J)===he)),u.$$.dirty&65538&&o(18,c=[0,Math.max(...m.map(J=>J[w]))]),u.$$.dirty&196608&&o(12,f=m.map(J=>J[A]).filter((J,he,we)=>we.indexOf(J)===he)),u.$$.dirty&262144&&o(11,d=J=>Math.abs(J/c[1])*100),u.$$.dirty&196608&&o(10,n=q(m,A))},[v,w,b,E,T,C,z,B,O,W,n,d,f,l,Z,ae,m,A,c]}class nb extends Vi{constructor(r){super(),Gi(this,r,ib,tb,Li,{data:16,xKey:0,yKey:1,zKey:17,formatTick:2,height:3,markerWidth:4,minmax:5,maskRange:6,base:7,base_ext:8,showLegend:9})}}function rb(u){let r,o;return r=new nb({props:{data:u[0].selected&&Lc("residents","resident_age_18b",u[0]),zKey:"group",maskRange:ip(u[1]),base:"% of all people",showLegend:!1}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c&1&&(f.data=l[0].selected&&Lc("residents","resident_age_18b",l[0])),c&2&&(f.maskRange=ip(l[1])),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function sb(u){let r,o=hl.nodata+"",l;return{c(){r=Be("span"),l=xt(o),this.h()},l(c){r=Re(c,"SPAN",{class:!0});var f=Ne(r);l=wt(f,o),f.forEach(Q),this.h()},h(){fe(r,"class","num-desc svelte-uj0r62")},m(c,f){Ie(c,r,f),ke(r,l)},p:ci,i:ci,o:ci,d(c){c&&Q(r)}}}function ob(u){let r,o=hl.nodata+"",l;return{c(){r=Be("span"),l=xt(o),this.h()},l(c){r=Re(c,"SPAN",{class:!0});var f=Ne(r);l=wt(f,o),f.forEach(Q),this.h()},h(){fe(r,"class","num-desc svelte-uj0r62")},m(c,f){Ie(c,r,f),ke(r,l)},p:ci,i:ci,o:ci,d(c){c&&Q(r)}}}function ab(u){let r,o,l,c;const f=[ob,sb,rb],d=[];function n(m,v){return m[0].selected.residents.resident_age_18b.values==="blocked"?0:m[0].selected.residents.resident_age_18b.values.percent[0]==null?1:2}return r=n(u),o=d[r]=f[r](u),{c(){o.c(),l=jt()},l(m){o.l(m),l=jt()},m(m,v){d[r].m(m,v),Ie(m,l,v),c=!0},p(m,v){let w=r;r=n(m),r===w?d[r].p(m,v):(Ii(),Xe(d[w],1,1,()=>{d[w]=null}),Pi(),o=d[r],o?o.p(m,v):(o=d[r]=f[r](m),o.c()),De(o,1),o.m(l.parentNode,l))},i(m){c||(De(o),c=!0)},o(m){Xe(o),c=!1},d(m){d[r].d(m),m&&Q(l)}}}function lb(u){let r,o;return r=new ps({props:{title:"Age profile",$$slots:{default:[ab]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,[c]){const f={};c&7&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function cb(u,r,o){let{data:l}=r,{selected:c}=r;return u.$$set=f=>{"data"in f&&o(0,l=f.data),"selected"in f&&o(1,c=f.selected)},[l,c]}class ub extends Vi{constructor(r){super(),Gi(this,r,cb,lb,Li,{data:0,selected:1})}}function hb(u,r,o){const l=u.slice();return l[2]=r[o],l[4]=o,l}function fb(u){let r,o,l,c,f,d;return{c(){r=Be("li"),o=Be("div"),l=ft(),c=Be("span"),f=xt(u[2]),d=ft(),this.h()},l(n){r=Re(n,"LI",{class:!0});var m=Ne(r);o=Re(m,"DIV",{class:!0}),Ne(o).forEach(Q),l=dt(m),c=Re(m,"SPAN",{class:!0});var v=Ne(c);f=wt(v,u[2]),v.forEach(Q),d=dt(m),m.forEach(Q),this.h()},h(){fe(o,"class","legend-vis "+(u[4]==0?"bar":"marker")+" svelte-npejzx"),fe(c,"class",u[4]==0?"bold":"brackets"),fe(r,"class","svelte-npejzx"),qt(r,"ew",u[4]!=0)},m(n,m){Ie(n,r,m),ke(r,o),ke(r,l),ke(r,c),ke(c,f),ke(r,d)},p:ci,d(n){n&&Q(r)}}}function db(u){let r,o,l,c;const f=u[1].default,d=An(f,u,u[0],null);let n=["People with the selected characteristics","All people in England and Wales"],m=[];for(let v=0;v<2;v+=1)m[v]=fb(hb(u,n,v));return{c(){r=Be("p"),d&&d.c(),o=ft(),l=Be("ul");for(let v=0;v<2;v+=1)m[v].c();this.h()},l(v){r=Re(v,"P",{class:!0});var w=Ne(r);d&&d.l(w),w.forEach(Q),o=dt(v),l=Re(v,"UL",{class:!0});var A=Ne(l);for(let b=0;b<2;b+=1)m[b].l(A);A.forEach(Q),this.h()},h(){fe(r,"class","legend-text svelte-npejzx"),fe(l,"class","legend-block svelte-npejzx")},m(v,w){Ie(v,r,w),d&&d.m(r,null),Ie(v,o,w),Ie(v,l,w);for(let A=0;A<2;A+=1)m[A]&&m[A].m(l,null);c=!0},p(v,[w]){d&&d.p&&(!c||w&1)&&Cn(d,f,v,v[0],c?Pn(f,v[0],w,null):In(v[0]),null)},i(v){c||(De(d,v),c=!0)},o(v){Xe(d,v),c=!1},d(v){v&&Q(r),d&&d.d(v),v&&Q(o),v&&Q(l),zn(m,v)}}}function pb(u,r,o){let{$$slots:l={},$$scope:c}=r;return u.$$set=f=>{"$$scope"in f&&o(0,c=f.$$scope)},[c,l]}class yg extends Vi{constructor(r){super(),Gi(this,r,pb,db,Li,{})}}var ph={exports:{}},mh={exports:{}},kr={},en={};en.__esModule=!0;en.extend=vg;en.indexOf=vb;en.escapeExpression=bb;en.isEmpty=xb;en.createFrame=wb;en.blockParams=kb;en.appendContextPath=Sb;var mb={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},gb=/[&<>"'`=]/g,_b=/[&<>"'`=]/;function yb(u){return mb[u]}function vg(u){for(var r=1;r<arguments.length;r++)for(var o in arguments[r])Object.prototype.hasOwnProperty.call(arguments[r],o)&&(u[o]=arguments[r][o]);return u}var Wh=Object.prototype.toString;en.toString=Wh;var gh=function(r){return typeof r=="function"};gh(/x/)&&(en.isFunction=gh=function(u){return typeof u=="function"&&Wh.call(u)==="[object Function]"});en.isFunction=gh;var bg=Array.isArray||function(u){return u&&typeof u=="object"?Wh.call(u)==="[object Array]":!1};en.isArray=bg;function vb(u,r){for(var o=0,l=u.length;o<l;o++)if(u[o]===r)return o;return-1}function bb(u){if(typeof u!="string"){if(u&&u.toHTML)return u.toHTML();if(u==null)return"";if(!u)return u+"";u=""+u}return _b.test(u)?u.replace(gb,yb):u}function xb(u){return!u&&u!==0?!0:!!(bg(u)&&u.length===0)}function wb(u){var r=vg({},u);return r._parent=u,r}function kb(u,r){return u.path=r,u}function Sb(u,r){return(u?u+".":"")+r}var _h={exports:{}};(function(u,r){r.__esModule=!0;var o=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function l(c,f){var d=f&&f.loc,n=void 0,m=void 0,v=void 0,w=void 0;d&&(n=d.start.line,m=d.end.line,v=d.start.column,w=d.end.column,c+=" - "+n+":"+v);for(var A=Error.prototype.constructor.call(this,c),b=0;b<o.length;b++)this[o[b]]=A[o[b]];Error.captureStackTrace&&Error.captureStackTrace(this,l);try{d&&(this.lineNumber=n,this.endLineNumber=m,Object.defineProperty?(Object.defineProperty(this,"column",{value:v,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:w,enumerable:!0})):(this.column=v,this.endColumn=w))}catch{}}l.prototype=new Error,r.default=l,u.exports=r.default})(_h,_h.exports);var Lr=_h.exports,pl={},yh={exports:{}};(function(u,r){r.__esModule=!0;var o=en;r.default=function(l){l.registerHelper("blockHelperMissing",function(c,f){var d=f.inverse,n=f.fn;if(c===!0)return n(this);if(c===!1||c==null)return d(this);if(o.isArray(c))return c.length>0?(f.ids&&(f.ids=[f.name]),l.helpers.each(c,f)):d(this);if(f.data&&f.ids){var m=o.createFrame(f.data);m.contextPath=o.appendContextPath(f.data.contextPath,f.name),f={data:m}}return n(c,f)})},u.exports=r.default})(yh,yh.exports);var Eb=yh.exports,vh={exports:{}};(function(u,r){r.__esModule=!0;function o(d){return d&&d.__esModule?d:{default:d}}var l=en,c=Lr,f=o(c);r.default=function(d){d.registerHelper("each",function(n,m){if(!m)throw new f.default("Must pass iterator to #each");var v=m.fn,w=m.inverse,A=0,b="",E=void 0,T=void 0;m.data&&m.ids&&(T=l.appendContextPath(m.data.contextPath,m.ids[0])+"."),l.isFunction(n)&&(n=n.call(this)),m.data&&(E=l.createFrame(m.data));function C(q,Z,ae){E&&(E.key=q,E.index=Z,E.first=Z===0,E.last=!!ae,T&&(E.contextPath=T+q)),b=b+v(n[q],{data:E,blockParams:l.blockParams([n[q],q],[T+q,null])})}if(n&&typeof n=="object")if(l.isArray(n))for(var z=n.length;A<z;A++)A in n&&C(A,A,A===n.length-1);else if(typeof Symbol=="function"&&n[Symbol.iterator]){for(var B=[],O=n[Symbol.iterator](),W=O.next();!W.done;W=O.next())B.push(W.value);n=B;for(var z=n.length;A<z;A++)C(A,A,A===n.length-1)}else(function(){var q=void 0;Object.keys(n).forEach(function(Z){q!==void 0&&C(q,A-1),q=Z,A++}),q!==void 0&&C(q,A-1,!0)})();return A===0&&(b=w(this)),b})},u.exports=r.default})(vh,vh.exports);var Tb=vh.exports,bh={exports:{}};(function(u,r){r.__esModule=!0;function o(f){return f&&f.__esModule?f:{default:f}}var l=Lr,c=o(l);r.default=function(f){f.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new c.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},u.exports=r.default})(bh,bh.exports);var Ab=bh.exports,xh={exports:{}};(function(u,r){r.__esModule=!0;function o(d){return d&&d.__esModule?d:{default:d}}var l=en,c=Lr,f=o(c);r.default=function(d){d.registerHelper("if",function(n,m){if(arguments.length!=2)throw new f.default("#if requires exactly one argument");return l.isFunction(n)&&(n=n.call(this)),!m.hash.includeZero&&!n||l.isEmpty(n)?m.inverse(this):m.fn(this)}),d.registerHelper("unless",function(n,m){if(arguments.length!=2)throw new f.default("#unless requires exactly one argument");return d.helpers.if.call(this,n,{fn:m.inverse,inverse:m.fn,hash:m.hash})})},u.exports=r.default})(xh,xh.exports);var Cb=xh.exports,wh={exports:{}};(function(u,r){r.__esModule=!0,r.default=function(o){o.registerHelper("log",function(){for(var l=[void 0],c=arguments[arguments.length-1],f=0;f<arguments.length-1;f++)l.push(arguments[f]);var d=1;c.hash.level!=null?d=c.hash.level:c.data&&c.data.level!=null&&(d=c.data.level),l[0]=d,o.log.apply(o,l)})},u.exports=r.default})(wh,wh.exports);var Ib=wh.exports,kh={exports:{}};(function(u,r){r.__esModule=!0,r.default=function(o){o.registerHelper("lookup",function(l,c,f){return l&&f.lookupProperty(l,c)})},u.exports=r.default})(kh,kh.exports);var Pb=kh.exports,Sh={exports:{}};(function(u,r){r.__esModule=!0;function o(d){return d&&d.__esModule?d:{default:d}}var l=en,c=Lr,f=o(c);r.default=function(d){d.registerHelper("with",function(n,m){if(arguments.length!=2)throw new f.default("#with requires exactly one argument");l.isFunction(n)&&(n=n.call(this));var v=m.fn;if(l.isEmpty(n))return m.inverse(this);var w=m.data;return m.data&&m.ids&&(w=l.createFrame(m.data),w.contextPath=l.appendContextPath(m.data.contextPath,m.ids[0])),v(n,{data:w,blockParams:l.blockParams([n],[w&&w.contextPath])})})},u.exports=r.default})(Sh,Sh.exports);var zb=Sh.exports;pl.__esModule=!0;pl.registerDefaultHelpers=Hb;pl.moveHelperToHooks=Wb;function vo(u){return u&&u.__esModule?u:{default:u}}var Mb=Eb,Db=vo(Mb),Lb=Tb,Bb=vo(Lb),Rb=Ab,Ob=vo(Rb),Fb=Cb,Nb=vo(Fb),Ub=Ib,Vb=vo(Ub),Gb=Pb,jb=vo(Gb),qb=zb,Zb=vo(qb);function Hb(u){Db.default(u),Bb.default(u),Ob.default(u),Nb.default(u),Vb.default(u),jb.default(u),Zb.default(u)}function Wb(u,r,o){u.helpers[r]&&(u.hooks[r]=u.helpers[r],o||delete u.helpers[r])}var Xh={},Eh={exports:{}};(function(u,r){r.__esModule=!0;var o=en;r.default=function(l){l.registerDecorator("inline",function(c,f,d,n){var m=c;return f.partials||(f.partials={},m=function(v,w){var A=d.partials;d.partials=o.extend({},A,f.partials);var b=c(v,w);return d.partials=A,b}),f.partials[n.args[0]]=n.fn,m})},u.exports=r.default})(Eh,Eh.exports);var Xb=Eh.exports;Xh.__esModule=!0;Xh.registerDefaultDecorators=Qb;function Kb(u){return u&&u.__esModule?u:{default:u}}var Jb=Xb,Yb=Kb(Jb);function Qb(u){Yb.default(u)}var Th={exports:{}};(function(u,r){r.__esModule=!0;var o=en,l={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(f){if(typeof f=="string"){var d=o.indexOf(l.methodMap,f.toLowerCase());d>=0?f=d:f=parseInt(f,10)}return f},log:function(f){if(f=l.lookupLevel(f),typeof console<"u"&&l.lookupLevel(l.level)<=f){var d=l.methodMap[f];console[d]||(d="log");for(var n=arguments.length,m=Array(n>1?n-1:0),v=1;v<n;v++)m[v-1]=arguments[v];console[d].apply(console,m)}}};r.default=l,u.exports=r.default})(Th,Th.exports);var xg=Th.exports,na={},Kh={};Kh.__esModule=!0;Kh.createNewLookupObject=ex;var $b=en;function ex(){for(var u=arguments.length,r=Array(u),o=0;o<u;o++)r[o]=arguments[o];return $b.extend.apply(void 0,[Object.create(null)].concat(r))}na.__esModule=!0;na.createProtoAccessControl=rx;na.resultIsAllowed=sx;na.resetLoggedProperties=ax;function tx(u){return u&&u.__esModule?u:{default:u}}var hm=Kh,ix=xg,nx=tx(ix),Oc=Object.create(null);function rx(u){var r=Object.create(null);r.constructor=!1,r.__defineGetter__=!1,r.__defineSetter__=!1,r.__lookupGetter__=!1;var o=Object.create(null);return o.__proto__=!1,{properties:{whitelist:hm.createNewLookupObject(o,u.allowedProtoProperties),defaultValue:u.allowProtoPropertiesByDefault},methods:{whitelist:hm.createNewLookupObject(r,u.allowedProtoMethods),defaultValue:u.allowProtoMethodsByDefault}}}function sx(u,r,o){return fm(typeof u=="function"?r.methods:r.properties,o)}function fm(u,r){return u.whitelist[r]!==void 0?u.whitelist[r]===!0:u.defaultValue!==void 0?u.defaultValue:(ox(r),!1)}function ox(u){Oc[u]!==!0&&(Oc[u]=!0,nx.default.log("error",'Handlebars: Access has been denied to resolve the property "'+u+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function ax(){Object.keys(Oc).forEach(function(u){delete Oc[u]})}kr.__esModule=!0;kr.HandlebarsEnvironment=Ah;function wg(u){return u&&u.__esModule?u:{default:u}}var mo=en,lx=Lr,$u=wg(lx),cx=pl,ux=Xh,hx=xg,Fc=wg(hx),fx=na,dx="4.7.8";kr.VERSION=dx;var px=8;kr.COMPILER_REVISION=px;var mx=7;kr.LAST_COMPATIBLE_COMPILER_REVISION=mx;var gx={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};kr.REVISION_CHANGES=gx;var eh="[object Object]";function Ah(u,r,o){this.helpers=u||{},this.partials=r||{},this.decorators=o||{},cx.registerDefaultHelpers(this),ux.registerDefaultDecorators(this)}Ah.prototype={constructor:Ah,logger:Fc.default,log:Fc.default.log,registerHelper:function(r,o){if(mo.toString.call(r)===eh){if(o)throw new $u.default("Arg not supported with multiple helpers");mo.extend(this.helpers,r)}else this.helpers[r]=o},unregisterHelper:function(r){delete this.helpers[r]},registerPartial:function(r,o){if(mo.toString.call(r)===eh)mo.extend(this.partials,r);else{if(typeof o>"u")throw new $u.default('Attempting to register a partial called "'+r+'" as undefined');this.partials[r]=o}},unregisterPartial:function(r){delete this.partials[r]},registerDecorator:function(r,o){if(mo.toString.call(r)===eh){if(o)throw new $u.default("Arg not supported with multiple decorators");mo.extend(this.decorators,r)}else this.decorators[r]=o},unregisterDecorator:function(r){delete this.decorators[r]},resetLoggedPropertyAccesses:function(){fx.resetLoggedProperties()}};var _x=Fc.default.log;kr.log=_x;kr.createFrame=mo.createFrame;kr.logger=Fc.default;var Ch={exports:{}};(function(u,r){r.__esModule=!0;function o(l){this.string=l}o.prototype.toString=o.prototype.toHTML=function(){return""+this.string},r.default=o,u.exports=r.default})(Ch,Ch.exports);var yx=Ch.exports,Fs={},Jh={};Jh.__esModule=!0;Jh.wrapHelper=vx;function vx(u,r){if(typeof u!="function")return u;var o=function(){var c=arguments[arguments.length-1];return arguments[arguments.length-1]=r(c),u.apply(this,arguments)};return o}Fs.__esModule=!0;Fs.checkRevision=Ex;Fs.template=Tx;Fs.wrapProgram=Ic;Fs.resolvePartial=Ax;Fs.invokePartial=Cx;Fs.noop=kg;function bx(u){return u&&u.__esModule?u:{default:u}}function xx(u){if(u&&u.__esModule)return u;var r={};if(u!=null)for(var o in u)Object.prototype.hasOwnProperty.call(u,o)&&(r[o]=u[o]);return r.default=u,r}var wx=en,hs=xx(wx),kx=Lr,fs=bx(kx),ds=kr,dm=pl,Sx=Jh,pm=na;function Ex(u){var r=u&&u[0]||1,o=ds.COMPILER_REVISION;if(!(r>=ds.LAST_COMPATIBLE_COMPILER_REVISION&&r<=ds.COMPILER_REVISION))if(r<ds.LAST_COMPATIBLE_COMPILER_REVISION){var l=ds.REVISION_CHANGES[o],c=ds.REVISION_CHANGES[r];throw new fs.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+l+") or downgrade your runtime to an older version ("+c+").")}else throw new fs.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+u[1]+").")}function Tx(u,r){if(!r)throw new fs.default("No environment passed to template");if(!u||!u.main)throw new fs.default("Unknown template object: "+typeof u);u.main.decorator=u.main_d,r.VM.checkRevision(u.compiler);var o=u.compiler&&u.compiler[0]===7;function l(d,n,m){m.hash&&(n=hs.extend({},n,m.hash),m.ids&&(m.ids[0]=!0)),d=r.VM.resolvePartial.call(this,d,n,m);var v=hs.extend({},m,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),w=r.VM.invokePartial.call(this,d,n,v);if(w==null&&r.compile&&(m.partials[m.name]=r.compile(d,u.compilerOptions,r),w=m.partials[m.name](n,v)),w!=null){if(m.indent){for(var A=w.split(`
`),b=0,E=A.length;b<E&&!(!A[b]&&b+1===E);b++)A[b]=m.indent+A[b];w=A.join(`
`)}return w}else throw new fs.default("The partial "+m.name+" could not be compiled when running in runtime-only mode")}var c={strict:function(n,m,v){if(!n||!(m in n))throw new fs.default('"'+m+'" not defined in '+n,{loc:v});return c.lookupProperty(n,m)},lookupProperty:function(n,m){var v=n[m];if(v==null||Object.prototype.hasOwnProperty.call(n,m)||pm.resultIsAllowed(v,c.protoAccessControl,m))return v},lookup:function(n,m){for(var v=n.length,w=0;w<v;w++){var A=n[w]&&c.lookupProperty(n[w],m);if(A!=null)return n[w][m]}},lambda:function(n,m){return typeof n=="function"?n.call(m):n},escapeExpression:hs.escapeExpression,invokePartial:l,fn:function(n){var m=u[n];return m.decorator=u[n+"_d"],m},programs:[],program:function(n,m,v,w,A){var b=this.programs[n],E=this.fn(n);return m||A||w||v?b=Ic(this,n,E,m,v,w,A):b||(b=this.programs[n]=Ic(this,n,E)),b},data:function(n,m){for(;n&&m--;)n=n._parent;return n},mergeIfNeeded:function(n,m){var v=n||m;return n&&m&&n!==m&&(v=hs.extend({},m,n)),v},nullContext:Object.seal({}),noop:r.VM.noop,compilerInfo:u.compiler};function f(d){var n=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],m=n.data;f._setup(n),!n.partial&&u.useData&&(m=Ix(d,m));var v=void 0,w=u.useBlockParams?[]:void 0;u.useDepths&&(n.depths?v=d!=n.depths[0]?[d].concat(n.depths):n.depths:v=[d]);function A(b){return""+u.main(c,b,c.helpers,c.partials,m,w,v)}return A=Sg(u.main,A,c,n.depths||[],m,w),A(d,n)}return f.isTop=!0,f._setup=function(d){if(d.partial)c.protoAccessControl=d.protoAccessControl,c.helpers=d.helpers,c.partials=d.partials,c.decorators=d.decorators,c.hooks=d.hooks;else{var n=hs.extend({},r.helpers,d.helpers);Px(n,c),c.helpers=n,u.usePartial&&(c.partials=c.mergeIfNeeded(d.partials,r.partials)),(u.usePartial||u.useDecorators)&&(c.decorators=hs.extend({},r.decorators,d.decorators)),c.hooks={},c.protoAccessControl=pm.createProtoAccessControl(d);var m=d.allowCallsToHelperMissing||o;dm.moveHelperToHooks(c,"helperMissing",m),dm.moveHelperToHooks(c,"blockHelperMissing",m)}},f._child=function(d,n,m,v){if(u.useBlockParams&&!m)throw new fs.default("must pass block params");if(u.useDepths&&!v)throw new fs.default("must pass parent depths");return Ic(c,d,u[d],n,0,m,v)},f}function Ic(u,r,o,l,c,f,d){function n(m){var v=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],w=d;return d&&m!=d[0]&&!(m===u.nullContext&&d[0]===null)&&(w=[m].concat(d)),o(u,m,u.helpers,u.partials,v.data||l,f&&[v.blockParams].concat(f),w)}return n=Sg(o,n,u,d,l,f),n.program=r,n.depth=d?d.length:0,n.blockParams=c||0,n}function Ax(u,r,o){return u?!u.call&&!o.name&&(o.name=u,u=o.partials[u]):o.name==="@partial-block"?u=o.data["partial-block"]:u=o.partials[o.name],u}function Cx(u,r,o){var l=o.data&&o.data["partial-block"];o.partial=!0,o.ids&&(o.data.contextPath=o.ids[0]||o.data.contextPath);var c=void 0;if(o.fn&&o.fn!==kg&&function(){o.data=ds.createFrame(o.data);var f=o.fn;c=o.data["partial-block"]=function(n){var m=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return m.data=ds.createFrame(m.data),m.data["partial-block"]=l,f(n,m)},f.partials&&(o.partials=hs.extend({},o.partials,f.partials))}(),u===void 0&&c&&(u=c),u===void 0)throw new fs.default("The partial "+o.name+" could not be found");if(u instanceof Function)return u(r,o)}function kg(){return""}function Ix(u,r){return(!r||!("root"in r))&&(r=r?ds.createFrame(r):{},r.root=u),r}function Sg(u,r,o,l,c,f){if(u.decorator){var d={};r=u.decorator(r,d,o,l&&l[0],c,f,l),hs.extend(r,d)}return r}function Px(u,r){Object.keys(u).forEach(function(o){var l=u[o];u[o]=zx(l,r)})}function zx(u,r){var o=r.lookupProperty;return Sx.wrapHelper(u,function(l){return hs.extend({lookupProperty:o},l)})}var Ih={exports:{}};(function(u,r){r.__esModule=!0,r.default=function(o){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var l=globalThis.Handlebars;o.noConflict=function(){return globalThis.Handlebars===o&&(globalThis.Handlebars=l),o}},u.exports=r.default})(Ih,Ih.exports);var Eg=Ih.exports;(function(u,r){r.__esModule=!0;function o(O){return O&&O.__esModule?O:{default:O}}function l(O){if(O&&O.__esModule)return O;var W={};if(O!=null)for(var q in O)Object.prototype.hasOwnProperty.call(O,q)&&(W[q]=O[q]);return W.default=O,W}var c=kr,f=l(c),d=yx,n=o(d),m=Lr,v=o(m),w=en,A=l(w),b=Fs,E=l(b),T=Eg,C=o(T);function z(){var O=new f.HandlebarsEnvironment;return A.extend(O,f),O.SafeString=n.default,O.Exception=v.default,O.Utils=A,O.escapeExpression=A.escapeExpression,O.VM=E,O.template=function(W){return E.template(W,O)},O}var B=z();B.create=z,C.default(B),B.default=B,r.default=B,u.exports=r.default})(mh,mh.exports);var Mx=mh.exports,Ph={exports:{}};(function(u,r){r.__esModule=!0;var o={helpers:{helperExpression:function(c){return c.type==="SubExpression"||(c.type==="MustacheStatement"||c.type==="BlockStatement")&&!!(c.params&&c.params.length||c.hash)},scopedId:function(c){return/^\.|this\b/.test(c.original)},simpleId:function(c){return c.parts.length===1&&!o.helpers.scopedId(c)&&!c.depth}}};r.default=o,u.exports=r.default})(Ph,Ph.exports);var Tg=Ph.exports,ml={},zh={exports:{}};(function(u,r){r.__esModule=!0;var o=function(){var l={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(n,m,v,w,A,b,E){var T=b.length-1;switch(A){case 1:return b[T-1];case 2:this.$=w.prepareProgram(b[T]);break;case 3:this.$=b[T];break;case 4:this.$=b[T];break;case 5:this.$=b[T];break;case 6:this.$=b[T];break;case 7:this.$=b[T];break;case 8:this.$=b[T];break;case 9:this.$={type:"CommentStatement",value:w.stripComment(b[T]),strip:w.stripFlags(b[T],b[T]),loc:w.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:b[T],value:b[T],loc:w.locInfo(this._$)};break;case 11:this.$=w.prepareRawBlock(b[T-2],b[T-1],b[T],this._$);break;case 12:this.$={path:b[T-3],params:b[T-2],hash:b[T-1]};break;case 13:this.$=w.prepareBlock(b[T-3],b[T-2],b[T-1],b[T],!1,this._$);break;case 14:this.$=w.prepareBlock(b[T-3],b[T-2],b[T-1],b[T],!0,this._$);break;case 15:this.$={open:b[T-5],path:b[T-4],params:b[T-3],hash:b[T-2],blockParams:b[T-1],strip:w.stripFlags(b[T-5],b[T])};break;case 16:this.$={path:b[T-4],params:b[T-3],hash:b[T-2],blockParams:b[T-1],strip:w.stripFlags(b[T-5],b[T])};break;case 17:this.$={path:b[T-4],params:b[T-3],hash:b[T-2],blockParams:b[T-1],strip:w.stripFlags(b[T-5],b[T])};break;case 18:this.$={strip:w.stripFlags(b[T-1],b[T-1]),program:b[T]};break;case 19:var C=w.prepareBlock(b[T-2],b[T-1],b[T],b[T],!1,this._$),z=w.prepareProgram([C],b[T-1].loc);z.chained=!0,this.$={strip:b[T-2].strip,program:z,chain:!0};break;case 20:this.$=b[T];break;case 21:this.$={path:b[T-1],strip:w.stripFlags(b[T-2],b[T])};break;case 22:this.$=w.prepareMustache(b[T-3],b[T-2],b[T-1],b[T-4],w.stripFlags(b[T-4],b[T]),this._$);break;case 23:this.$=w.prepareMustache(b[T-3],b[T-2],b[T-1],b[T-4],w.stripFlags(b[T-4],b[T]),this._$);break;case 24:this.$={type:"PartialStatement",name:b[T-3],params:b[T-2],hash:b[T-1],indent:"",strip:w.stripFlags(b[T-4],b[T]),loc:w.locInfo(this._$)};break;case 25:this.$=w.preparePartialBlock(b[T-2],b[T-1],b[T],this._$);break;case 26:this.$={path:b[T-3],params:b[T-2],hash:b[T-1],strip:w.stripFlags(b[T-4],b[T])};break;case 27:this.$=b[T];break;case 28:this.$=b[T];break;case 29:this.$={type:"SubExpression",path:b[T-3],params:b[T-2],hash:b[T-1],loc:w.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:b[T],loc:w.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:w.id(b[T-2]),value:b[T],loc:w.locInfo(this._$)};break;case 32:this.$=w.id(b[T-1]);break;case 33:this.$=b[T];break;case 34:this.$=b[T];break;case 35:this.$={type:"StringLiteral",value:b[T],original:b[T],loc:w.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(b[T]),original:Number(b[T]),loc:w.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:b[T]==="true",original:b[T]==="true",loc:w.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:w.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:w.locInfo(this._$)};break;case 40:this.$=b[T];break;case 41:this.$=b[T];break;case 42:this.$=w.preparePath(!0,b[T],this._$);break;case 43:this.$=w.preparePath(!1,b[T],this._$);break;case 44:b[T-2].push({part:w.id(b[T]),original:b[T],separator:b[T-1]}),this.$=b[T-2];break;case 45:this.$=[{part:w.id(b[T]),original:b[T]}];break;case 46:this.$=[];break;case 47:b[T-1].push(b[T]);break;case 48:this.$=[];break;case 49:b[T-1].push(b[T]);break;case 50:this.$=[];break;case 51:b[T-1].push(b[T]);break;case 58:this.$=[];break;case 59:b[T-1].push(b[T]);break;case 64:this.$=[];break;case 65:b[T-1].push(b[T]);break;case 70:this.$=[];break;case 71:b[T-1].push(b[T]);break;case 78:this.$=[];break;case 79:b[T-1].push(b[T]);break;case 82:this.$=[];break;case 83:b[T-1].push(b[T]);break;case 86:this.$=[];break;case 87:b[T-1].push(b[T]);break;case 90:this.$=[];break;case 91:b[T-1].push(b[T]);break;case 94:this.$=[];break;case 95:b[T-1].push(b[T]);break;case 98:this.$=[b[T]];break;case 99:b[T-1].push(b[T]);break;case 100:this.$=[b[T]];break;case 101:b[T-1].push(b[T]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(n,m){throw new Error(n)},parse:function(n){var m=this,v=[0],w=[null],A=[],b=this.table,E="",T=0,C=0;this.lexer.setInput(n),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc>"u"&&(this.lexer.yylloc={});var z=this.lexer.yylloc;A.push(z);var B=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function O(){var Ve;return Ve=m.lexer.lex()||1,typeof Ve!="number"&&(Ve=m.symbols_[Ve]||Ve),Ve}for(var W,q,Z,ae,J={},he,we,Se,ot;;){if(q=v[v.length-1],this.defaultActions[q]?Z=this.defaultActions[q]:((W===null||typeof W>"u")&&(W=O()),Z=b[q]&&b[q][W]),typeof Z>"u"||!Z.length||!Z[0]){var oe="";{ot=[];for(he in b[q])this.terminals_[he]&&he>2&&ot.push("'"+this.terminals_[he]+"'");this.lexer.showPosition?oe="Parse error on line "+(T+1)+`:
`+this.lexer.showPosition()+`
Expecting `+ot.join(", ")+", got '"+(this.terminals_[W]||W)+"'":oe="Parse error on line "+(T+1)+": Unexpected "+(W==1?"end of input":"'"+(this.terminals_[W]||W)+"'"),this.parseError(oe,{text:this.lexer.match,token:this.terminals_[W]||W,line:this.lexer.yylineno,loc:z,expected:ot})}}if(Z[0]instanceof Array&&Z.length>1)throw new Error("Parse Error: multiple actions possible at state: "+q+", token: "+W);switch(Z[0]){case 1:v.push(W),w.push(this.lexer.yytext),A.push(this.lexer.yylloc),v.push(Z[1]),W=null,C=this.lexer.yyleng,E=this.lexer.yytext,T=this.lexer.yylineno,z=this.lexer.yylloc;break;case 2:if(we=this.productions_[Z[1]][1],J.$=w[w.length-we],J._$={first_line:A[A.length-(we||1)].first_line,last_line:A[A.length-1].last_line,first_column:A[A.length-(we||1)].first_column,last_column:A[A.length-1].last_column},B&&(J._$.range=[A[A.length-(we||1)].range[0],A[A.length-1].range[1]]),ae=this.performAction.call(J,E,C,T,this.yy,Z[1],w,A),typeof ae<"u")return ae;we&&(v=v.slice(0,-1*we*2),w=w.slice(0,-1*we),A=A.slice(0,-1*we)),v.push(this.productions_[Z[1]][0]),w.push(J.$),A.push(J._$),Se=b[v[v.length-2]][v[v.length-1]],v.push(Se);break;case 3:return!0}}return!0}},c=function(){var d={EOF:1,parseError:function(m,v){if(this.yy.parser)this.yy.parser.parseError(m,v);else throw new Error(m)},setInput:function(m){return this._input=m,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var m=this._input[0];this.yytext+=m,this.yyleng++,this.offset++,this.match+=m,this.matched+=m;var v=m.match(/(?:\r\n?|\n).*/g);return v?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),m},unput:function(m){var v=m.length,w=m.split(/(?:\r\n?|\n)/g);this._input=m+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-v-1),this.offset-=v;var A=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),w.length-1&&(this.yylineno-=w.length-1);var b=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:w?(w.length===A.length?this.yylloc.first_column:0)+A[A.length-w.length].length-w[0].length:this.yylloc.first_column-v},this.options.ranges&&(this.yylloc.range=[b[0],b[0]+this.yyleng-v]),this},more:function(){return this._more=!0,this},less:function(m){this.unput(this.match.slice(m))},pastInput:function(){var m=this.matched.substr(0,this.matched.length-this.match.length);return(m.length>20?"...":"")+m.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var m=this.match;return m.length<20&&(m+=this._input.substr(0,20-m.length)),(m.substr(0,20)+(m.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var m=this.pastInput(),v=new Array(m.length+1).join("-");return m+this.upcomingInput()+`
`+v+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var m,v,w,A,b;this._more||(this.yytext="",this.match="");for(var E=this._currentRules(),T=0;T<E.length&&(w=this._input.match(this.rules[E[T]]),!(w&&(!v||w[0].length>v[0].length)&&(v=w,A=T,!this.options.flex)));T++);return v?(b=v[0].match(/(?:\r\n?|\n).*/g),b&&(this.yylineno+=b.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:b?b[b.length-1].length-b[b.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+v[0].length},this.yytext+=v[0],this.match+=v[0],this.matches=v,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(v[0].length),this.matched+=v[0],m=this.performAction.call(this,this.yy,this,E[A],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),m||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var m=this.next();return typeof m<"u"?m:this.lex()},begin:function(m){this.conditionStack.push(m)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(m){this.begin(m)}};return d.options={},d.performAction=function(m,v,w,A){function b(E,T){return v.yytext=v.yytext.substring(E,v.yyleng-T+E)}switch(w){case 0:if(v.yytext.slice(-2)==="\\\\"?(b(0,1),this.begin("mu")):v.yytext.slice(-1)==="\\"?(b(0,1),this.begin("emu")):this.begin("mu"),v.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(b(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(v.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return v.yytext=b(1,2).replace(/\\"/g,'"'),80;case 32:return v.yytext=b(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return v.yytext=v.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},d.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],d.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},d}();l.lexer=c;function f(){this.yy={}}return f.prototype=l,l.Parser=f,new f}();r.default=o,u.exports=r.default})(zh,zh.exports);var Dx=zh.exports,Mh={exports:{}},Dh={exports:{}};(function(u,r){r.__esModule=!0;function o(v){return v&&v.__esModule?v:{default:v}}var l=Lr,c=o(l);function f(){this.parents=[]}f.prototype={constructor:f,mutating:!1,acceptKey:function(w,A){var b=this.accept(w[A]);if(this.mutating){if(b&&!f.prototype[b.type])throw new c.default('Unexpected node type "'+b.type+'" found when accepting '+A+" on "+w.type);w[A]=b}},acceptRequired:function(w,A){if(this.acceptKey(w,A),!w[A])throw new c.default(w.type+" requires "+A)},acceptArray:function(w){for(var A=0,b=w.length;A<b;A++)this.acceptKey(w,A),w[A]||(w.splice(A,1),A--,b--)},accept:function(w){if(w){if(!this[w.type])throw new c.default("Unknown type: "+w.type,w);this.current&&this.parents.unshift(this.current),this.current=w;var A=this[w.type](w);if(this.current=this.parents.shift(),!this.mutating||A)return A;if(A!==!1)return w}},Program:function(w){this.acceptArray(w.body)},MustacheStatement:d,Decorator:d,BlockStatement:n,DecoratorBlock:n,PartialStatement:m,PartialBlockStatement:function(w){m.call(this,w),this.acceptKey(w,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:d,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(w){this.acceptArray(w.pairs)},HashPair:function(w){this.acceptRequired(w,"value")}};function d(v){this.acceptRequired(v,"path"),this.acceptArray(v.params),this.acceptKey(v,"hash")}function n(v){d.call(this,v),this.acceptKey(v,"program"),this.acceptKey(v,"inverse")}function m(v){this.acceptRequired(v,"name"),this.acceptArray(v.params),this.acceptKey(v,"hash")}r.default=f,u.exports=r.default})(Dh,Dh.exports);var Ag=Dh.exports;(function(u,r){r.__esModule=!0;function o(w){return w&&w.__esModule?w:{default:w}}var l=Ag,c=o(l);function f(){var w=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=w}f.prototype=new c.default,f.prototype.Program=function(w){var A=!this.options.ignoreStandalone,b=!this.isRootSeen;this.isRootSeen=!0;for(var E=w.body,T=0,C=E.length;T<C;T++){var z=E[T],B=this.accept(z);if(B){var O=d(E,T,b),W=n(E,T,b),q=B.openStandalone&&O,Z=B.closeStandalone&&W,ae=B.inlineStandalone&&O&&W;B.close&&m(E,T,!0),B.open&&v(E,T,!0),A&&ae&&(m(E,T),v(E,T)&&z.type==="PartialStatement"&&(z.indent=/([ \t]+$)/.exec(E[T-1].original)[1])),A&&q&&(m((z.program||z.inverse).body),v(E,T)),A&&Z&&(m(E,T),v((z.inverse||z.program).body))}}return w},f.prototype.BlockStatement=f.prototype.DecoratorBlock=f.prototype.PartialBlockStatement=function(w){this.accept(w.program),this.accept(w.inverse);var A=w.program||w.inverse,b=w.program&&w.inverse,E=b,T=b;if(b&&b.chained)for(E=b.body[0].program;T.chained;)T=T.body[T.body.length-1].program;var C={open:w.openStrip.open,close:w.closeStrip.close,openStandalone:n(A.body),closeStandalone:d((E||A).body)};if(w.openStrip.close&&m(A.body,null,!0),b){var z=w.inverseStrip;z.open&&v(A.body,null,!0),z.close&&m(E.body,null,!0),w.closeStrip.open&&v(T.body,null,!0),!this.options.ignoreStandalone&&d(A.body)&&n(E.body)&&(v(A.body),m(E.body))}else w.closeStrip.open&&v(A.body,null,!0);return C},f.prototype.Decorator=f.prototype.MustacheStatement=function(w){return w.strip},f.prototype.PartialStatement=f.prototype.CommentStatement=function(w){var A=w.strip||{};return{inlineStandalone:!0,open:A.open,close:A.close}};function d(w,A,b){A===void 0&&(A=w.length);var E=w[A-1],T=w[A-2];if(!E)return b;if(E.type==="ContentStatement")return(T||!b?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(E.original)}function n(w,A,b){A===void 0&&(A=-1);var E=w[A+1],T=w[A+2];if(!E)return b;if(E.type==="ContentStatement")return(T||!b?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(E.original)}function m(w,A,b){var E=w[A==null?0:A+1];if(!(!E||E.type!=="ContentStatement"||!b&&E.rightStripped)){var T=E.value;E.value=E.value.replace(b?/^\s+/:/^[ \t]*\r?\n?/,""),E.rightStripped=E.value!==T}}function v(w,A,b){var E=w[A==null?w.length-1:A-1];if(!(!E||E.type!=="ContentStatement"||!b&&E.leftStripped)){var T=E.value;return E.value=E.value.replace(b?/\s+$/:/[ \t]+$/,""),E.leftStripped=E.value!==T,E.leftStripped}}r.default=f,u.exports=r.default})(Mh,Mh.exports);var Lx=Mh.exports,Sr={};Sr.__esModule=!0;Sr.SourceLocation=Ox;Sr.id=Fx;Sr.stripFlags=Nx;Sr.stripComment=Ux;Sr.preparePath=Vx;Sr.prepareMustache=Gx;Sr.prepareRawBlock=jx;Sr.prepareBlock=qx;Sr.prepareProgram=Zx;Sr.preparePartialBlock=Hx;function Bx(u){return u&&u.__esModule?u:{default:u}}var Rx=Lr,Yh=Bx(Rx);function Qh(u,r){if(r=r.path?r.path.original:r,u.path.original!==r){var o={loc:u.path.loc};throw new Yh.default(u.path.original+" doesn't match "+r,o)}}function Ox(u,r){this.source=u,this.start={line:r.first_line,column:r.first_column},this.end={line:r.last_line,column:r.last_column}}function Fx(u){return/^\[.*\]$/.test(u)?u.substring(1,u.length-1):u}function Nx(u,r){return{open:u.charAt(2)==="~",close:r.charAt(r.length-3)==="~"}}function Ux(u){return u.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function Vx(u,r,o){o=this.locInfo(o);for(var l=u?"@":"",c=[],f=0,d=0,n=r.length;d<n;d++){var m=r[d].part,v=r[d].original!==m;if(l+=(r[d].separator||"")+m,!v&&(m===".."||m==="."||m==="this")){if(c.length>0)throw new Yh.default("Invalid path: "+l,{loc:o});m===".."&&f++}else c.push(m)}return{type:"PathExpression",data:u,depth:f,parts:c,original:l,loc:o}}function Gx(u,r,o,l,c,f){var d=l.charAt(3)||l.charAt(2),n=d!=="{"&&d!=="&",m=/\*/.test(l);return{type:m?"Decorator":"MustacheStatement",path:u,params:r,hash:o,escaped:n,strip:c,loc:this.locInfo(f)}}function jx(u,r,o,l){Qh(u,o),l=this.locInfo(l);var c={type:"Program",body:r,strip:{},loc:l};return{type:"BlockStatement",path:u.path,params:u.params,hash:u.hash,program:c,openStrip:{},inverseStrip:{},closeStrip:{},loc:l}}function qx(u,r,o,l,c,f){l&&l.path&&Qh(u,l);var d=/\*/.test(u.open);r.blockParams=u.blockParams;var n=void 0,m=void 0;if(o){if(d)throw new Yh.default("Unexpected inverse block on decorator",o);o.chain&&(o.program.body[0].closeStrip=l.strip),m=o.strip,n=o.program}return c&&(c=n,n=r,r=c),{type:d?"DecoratorBlock":"BlockStatement",path:u.path,params:u.params,hash:u.hash,program:r,inverse:n,openStrip:u.strip,inverseStrip:m,closeStrip:l&&l.strip,loc:this.locInfo(f)}}function Zx(u,r){if(!r&&u.length){var o=u[0].loc,l=u[u.length-1].loc;o&&l&&(r={source:o.source,start:{line:o.start.line,column:o.start.column},end:{line:l.end.line,column:l.end.column}})}return{type:"Program",body:u,strip:{},loc:r}}function Hx(u,r,o,l){return Qh(u,o),{type:"PartialBlockStatement",name:u.path,params:u.params,hash:u.hash,program:r,openStrip:u.strip,closeStrip:o&&o.strip,loc:this.locInfo(l)}}ml.__esModule=!0;ml.parseWithoutProcessing=Ig;ml.parse=e2;function Wx(u){if(u&&u.__esModule)return u;var r={};if(u!=null)for(var o in u)Object.prototype.hasOwnProperty.call(u,o)&&(r[o]=u[o]);return r.default=u,r}function Cg(u){return u&&u.__esModule?u:{default:u}}var Xx=Dx,Lh=Cg(Xx),Kx=Lx,Jx=Cg(Kx),Yx=Sr,Qx=Wx(Yx),$x=en;ml.parser=Lh.default;var Pc={};$x.extend(Pc,Qx);function Ig(u,r){if(u.type==="Program")return u;Lh.default.yy=Pc,Pc.locInfo=function(l){return new Pc.SourceLocation(r&&r.srcName,l)};var o=Lh.default.parse(u);return o}function e2(u,r){var o=Ig(u,r),l=new Jx.default(r);return l.accept(o)}var gl={};gl.__esModule=!0;gl.Compiler=Bh;gl.precompile=r2;gl.compile=s2;function Pg(u){return u&&u.__esModule?u:{default:u}}var t2=Lr,cl=Pg(t2),ul=en,i2=Tg,nl=Pg(i2),n2=[].slice;function Bh(){}Bh.prototype={compiler:Bh,equals:function(r){var o=this.opcodes.length;if(r.opcodes.length!==o)return!1;for(var l=0;l<o;l++){var c=this.opcodes[l],f=r.opcodes[l];if(c.opcode!==f.opcode||!zg(c.args,f.args))return!1}o=this.children.length;for(var l=0;l<o;l++)if(!this.children[l].equals(r.children[l]))return!1;return!0},guid:0,compile:function(r,o){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=o,this.stringParams=o.stringParams,this.trackIds=o.trackIds,o.blockParams=o.blockParams||[],o.knownHelpers=ul.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},o.knownHelpers),this.accept(r)},compileProgram:function(r){var o=new this.compiler,l=o.compile(r,this.options),c=this.guid++;return this.usePartial=this.usePartial||l.usePartial,this.children[c]=l,this.useDepths=this.useDepths||l.useDepths,c},accept:function(r){if(!this[r.type])throw new cl.default("Unknown type: "+r.type,r);this.sourceNode.unshift(r);var o=this[r.type](r);return this.sourceNode.shift(),o},Program:function(r){this.options.blockParams.unshift(r.blockParams);for(var o=r.body,l=o.length,c=0;c<l;c++)this.accept(o[c]);return this.options.blockParams.shift(),this.isSimple=l===1,this.blockParams=r.blockParams?r.blockParams.length:0,this},BlockStatement:function(r){mm(r);var o=r.program,l=r.inverse;o=o&&this.compileProgram(o),l=l&&this.compileProgram(l);var c=this.classifySexpr(r);c==="helper"?this.helperSexpr(r,o,l):c==="simple"?(this.simpleSexpr(r),this.opcode("pushProgram",o),this.opcode("pushProgram",l),this.opcode("emptyHash"),this.opcode("blockValue",r.path.original)):(this.ambiguousSexpr(r,o,l),this.opcode("pushProgram",o),this.opcode("pushProgram",l),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(r){var o=r.program&&this.compileProgram(r.program),l=this.setupFullMustacheParams(r,o,void 0),c=r.path;this.useDecorators=!0,this.opcode("registerDecorator",l.length,c.original)},PartialStatement:function(r){this.usePartial=!0;var o=r.program;o&&(o=this.compileProgram(r.program));var l=r.params;if(l.length>1)throw new cl.default("Unsupported number of partial arguments: "+l.length,r);l.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):l.push({type:"PathExpression",parts:[],depth:0}));var c=r.name.original,f=r.name.type==="SubExpression";f&&this.accept(r.name),this.setupFullMustacheParams(r,o,void 0,!0);var d=r.indent||"";this.options.preventIndent&&d&&(this.opcode("appendContent",d),d=""),this.opcode("invokePartial",f,c,d),this.opcode("append")},PartialBlockStatement:function(r){this.PartialStatement(r)},MustacheStatement:function(r){this.SubExpression(r),r.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(r){this.DecoratorBlock(r)},ContentStatement:function(r){r.value&&this.opcode("appendContent",r.value)},CommentStatement:function(){},SubExpression:function(r){mm(r);var o=this.classifySexpr(r);o==="simple"?this.simpleSexpr(r):o==="helper"?this.helperSexpr(r):this.ambiguousSexpr(r)},ambiguousSexpr:function(r,o,l){var c=r.path,f=c.parts[0],d=o!=null||l!=null;this.opcode("getContext",c.depth),this.opcode("pushProgram",o),this.opcode("pushProgram",l),c.strict=!0,this.accept(c),this.opcode("invokeAmbiguous",f,d)},simpleSexpr:function(r){var o=r.path;o.strict=!0,this.accept(o),this.opcode("resolvePossibleLambda")},helperSexpr:function(r,o,l){var c=this.setupFullMustacheParams(r,o,l),f=r.path,d=f.parts[0];if(this.options.knownHelpers[d])this.opcode("invokeKnownHelper",c.length,d);else{if(this.options.knownHelpersOnly)throw new cl.default("You specified knownHelpersOnly, but used the unknown helper "+d,r);f.strict=!0,f.falsy=!0,this.accept(f),this.opcode("invokeHelper",c.length,f.original,nl.default.helpers.simpleId(f))}},PathExpression:function(r){this.addDepth(r.depth),this.opcode("getContext",r.depth);var o=r.parts[0],l=nl.default.helpers.scopedId(r),c=!r.depth&&!l&&this.blockParamIndex(o);c?this.opcode("lookupBlockParam",c,r.parts):o?r.data?(this.options.data=!0,this.opcode("lookupData",r.depth,r.parts,r.strict)):this.opcode("lookupOnContext",r.parts,r.falsy,r.strict,l):this.opcode("pushContext")},StringLiteral:function(r){this.opcode("pushString",r.value)},NumberLiteral:function(r){this.opcode("pushLiteral",r.value)},BooleanLiteral:function(r){this.opcode("pushLiteral",r.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(r){var o=r.pairs,l=0,c=o.length;for(this.opcode("pushHash");l<c;l++)this.pushParam(o[l].value);for(;l--;)this.opcode("assignToHash",o[l].key);this.opcode("popHash")},opcode:function(r){this.opcodes.push({opcode:r,args:n2.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(r){r&&(this.useDepths=!0)},classifySexpr:function(r){var o=nl.default.helpers.simpleId(r.path),l=o&&!!this.blockParamIndex(r.path.parts[0]),c=!l&&nl.default.helpers.helperExpression(r),f=!l&&(c||o);if(f&&!c){var d=r.path.parts[0],n=this.options;n.knownHelpers[d]?c=!0:n.knownHelpersOnly&&(f=!1)}return c?"helper":f?"ambiguous":"simple"},pushParams:function(r){for(var o=0,l=r.length;o<l;o++)this.pushParam(r[o])},pushParam:function(r){var o=r.value!=null?r.value:r.original||"";if(this.stringParams)o.replace&&(o=o.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),r.depth&&this.addDepth(r.depth),this.opcode("getContext",r.depth||0),this.opcode("pushStringParam",o,r.type),r.type==="SubExpression"&&this.accept(r);else{if(this.trackIds){var l=void 0;if(r.parts&&!nl.default.helpers.scopedId(r)&&!r.depth&&(l=this.blockParamIndex(r.parts[0])),l){var c=r.parts.slice(1).join(".");this.opcode("pushId","BlockParam",l,c)}else o=r.original||o,o.replace&&(o=o.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",r.type,o)}this.accept(r)}},setupFullMustacheParams:function(r,o,l,c){var f=r.params;return this.pushParams(f),this.opcode("pushProgram",o),this.opcode("pushProgram",l),r.hash?this.accept(r.hash):this.opcode("emptyHash",c),f},blockParamIndex:function(r){for(var o=0,l=this.options.blockParams.length;o<l;o++){var c=this.options.blockParams[o],f=c&&ul.indexOf(c,r);if(c&&f>=0)return[o,f]}}};function r2(u,r,o){if(u==null||typeof u!="string"&&u.type!=="Program")throw new cl.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+u);r=r||{},"data"in r||(r.data=!0),r.compat&&(r.useDepths=!0);var l=o.parse(u,r),c=new o.Compiler().compile(l,r);return new o.JavaScriptCompiler().compile(c,r)}function s2(u,r,o){if(r===void 0&&(r={}),u==null||typeof u!="string"&&u.type!=="Program")throw new cl.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+u);r=ul.extend({},r),"data"in r||(r.data=!0),r.compat&&(r.useDepths=!0);var l=void 0;function c(){var d=o.parse(u,r),n=new o.Compiler().compile(d,r),m=new o.JavaScriptCompiler().compile(n,r,void 0,!0);return o.template(m)}function f(d,n){return l||(l=c()),l.call(this,d,n)}return f._setup=function(d){return l||(l=c()),l._setup(d)},f._child=function(d,n,m,v){return l||(l=c()),l._child(d,n,m,v)},f}function zg(u,r){if(u===r)return!0;if(ul.isArray(u)&&ul.isArray(r)&&u.length===r.length){for(var o=0;o<u.length;o++)if(!zg(u[o],r[o]))return!1;return!0}}function mm(u){if(!u.path.parts){var r=u.path;u.path={type:"PathExpression",data:!1,depth:0,parts:[r.original+""],original:r.original+"",loc:r.loc}}}var Rh={exports:{}},Oh={exports:{}},rl={},th={},Tc={},Ac={},gm;function o2(){if(gm)return Ac;gm=1;var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return Ac.encode=function(r){if(0<=r&&r<u.length)return u[r];throw new TypeError("Must be between 0 and 63: "+r)},Ac.decode=function(r){var o=65,l=90,c=97,f=122,d=48,n=57,m=43,v=47,w=26,A=52;return o<=r&&r<=l?r-o:c<=r&&r<=f?r-c+w:d<=r&&r<=n?r-d+A:r==m?62:r==v?63:-1},Ac}var _m;function Mg(){if(_m)return Tc;_m=1;var u=o2(),r=5,o=1<<r,l=o-1,c=o;function f(n){return n<0?(-n<<1)+1:(n<<1)+0}function d(n){var m=(n&1)===1,v=n>>1;return m?-v:v}return Tc.encode=function(m){var v="",w,A=f(m);do w=A&l,A>>>=r,A>0&&(w|=c),v+=u.encode(w);while(A>0);return v},Tc.decode=function(m,v,w){var A=m.length,b=0,E=0,T,C;do{if(v>=A)throw new Error("Expected more digits in base 64 VLQ value.");if(C=u.decode(m.charCodeAt(v++)),C===-1)throw new Error("Invalid base64 digit: "+m.charAt(v-1));T=!!(C&c),C&=l,b=b+(C<<E),E+=r}while(T);w.value=d(b),w.rest=v},Tc}var ih={},ym;function _l(){return ym||(ym=1,function(u){function r(q,Z,ae){if(Z in q)return q[Z];if(arguments.length===3)return ae;throw new Error('"'+Z+'" is a required argument.')}u.getArg=r;var o=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,l=/^data:.+\,.+$/;function c(q){var Z=q.match(o);return Z?{scheme:Z[1],auth:Z[2],host:Z[3],port:Z[4],path:Z[5]}:null}u.urlParse=c;function f(q){var Z="";return q.scheme&&(Z+=q.scheme+":"),Z+="//",q.auth&&(Z+=q.auth+"@"),q.host&&(Z+=q.host),q.port&&(Z+=":"+q.port),q.path&&(Z+=q.path),Z}u.urlGenerate=f;function d(q){var Z=q,ae=c(q);if(ae){if(!ae.path)return q;Z=ae.path}for(var J=u.isAbsolute(Z),he=Z.split(/\/+/),we,Se=0,ot=he.length-1;ot>=0;ot--)we=he[ot],we==="."?he.splice(ot,1):we===".."?Se++:Se>0&&(we===""?(he.splice(ot+1,Se),Se=0):(he.splice(ot,2),Se--));return Z=he.join("/"),Z===""&&(Z=J?"/":"."),ae?(ae.path=Z,f(ae)):Z}u.normalize=d;function n(q,Z){q===""&&(q="."),Z===""&&(Z=".");var ae=c(Z),J=c(q);if(J&&(q=J.path||"/"),ae&&!ae.scheme)return J&&(ae.scheme=J.scheme),f(ae);if(ae||Z.match(l))return Z;if(J&&!J.host&&!J.path)return J.host=Z,f(J);var he=Z.charAt(0)==="/"?Z:d(q.replace(/\/+$/,"")+"/"+Z);return J?(J.path=he,f(J)):he}u.join=n,u.isAbsolute=function(q){return q.charAt(0)==="/"||o.test(q)};function m(q,Z){q===""&&(q="."),q=q.replace(/\/$/,"");for(var ae=0;Z.indexOf(q+"/")!==0;){var J=q.lastIndexOf("/");if(J<0||(q=q.slice(0,J),q.match(/^([^\/]+:\/)?\/*$/)))return Z;++ae}return Array(ae+1).join("../")+Z.substr(q.length+1)}u.relative=m;var v=function(){var q=Object.create(null);return!("__proto__"in q)}();function w(q){return q}function A(q){return E(q)?"$"+q:q}u.toSetString=v?w:A;function b(q){return E(q)?q.slice(1):q}u.fromSetString=v?w:b;function E(q){if(!q)return!1;var Z=q.length;if(Z<9||q.charCodeAt(Z-1)!==95||q.charCodeAt(Z-2)!==95||q.charCodeAt(Z-3)!==111||q.charCodeAt(Z-4)!==116||q.charCodeAt(Z-5)!==111||q.charCodeAt(Z-6)!==114||q.charCodeAt(Z-7)!==112||q.charCodeAt(Z-8)!==95||q.charCodeAt(Z-9)!==95)return!1;for(var ae=Z-10;ae>=0;ae--)if(q.charCodeAt(ae)!==36)return!1;return!0}function T(q,Z,ae){var J=z(q.source,Z.source);return J!==0||(J=q.originalLine-Z.originalLine,J!==0)||(J=q.originalColumn-Z.originalColumn,J!==0||ae)||(J=q.generatedColumn-Z.generatedColumn,J!==0)||(J=q.generatedLine-Z.generatedLine,J!==0)?J:z(q.name,Z.name)}u.compareByOriginalPositions=T;function C(q,Z,ae){var J=q.generatedLine-Z.generatedLine;return J!==0||(J=q.generatedColumn-Z.generatedColumn,J!==0||ae)||(J=z(q.source,Z.source),J!==0)||(J=q.originalLine-Z.originalLine,J!==0)||(J=q.originalColumn-Z.originalColumn,J!==0)?J:z(q.name,Z.name)}u.compareByGeneratedPositionsDeflated=C;function z(q,Z){return q===Z?0:q===null?1:Z===null?-1:q>Z?1:-1}function B(q,Z){var ae=q.generatedLine-Z.generatedLine;return ae!==0||(ae=q.generatedColumn-Z.generatedColumn,ae!==0)||(ae=z(q.source,Z.source),ae!==0)||(ae=q.originalLine-Z.originalLine,ae!==0)||(ae=q.originalColumn-Z.originalColumn,ae!==0)?ae:z(q.name,Z.name)}u.compareByGeneratedPositionsInflated=B;function O(q){return JSON.parse(q.replace(/^\)]}'[^\n]*\n/,""))}u.parseSourceMapInput=O;function W(q,Z,ae){if(Z=Z||"",q&&(q[q.length-1]!=="/"&&Z[0]!=="/"&&(q+="/"),Z=q+Z),ae){var J=c(ae);if(!J)throw new Error("sourceMapURL could not be parsed");if(J.path){var he=J.path.lastIndexOf("/");he>=0&&(J.path=J.path.substring(0,he+1))}Z=n(f(J),Z)}return d(Z)}u.computeSourceURL=W}(ih)),ih}var nh={},vm;function Dg(){if(vm)return nh;vm=1;var u=_l(),r=Object.prototype.hasOwnProperty,o=typeof Map<"u";function l(){this._array=[],this._set=o?new Map:Object.create(null)}return l.fromArray=function(f,d){for(var n=new l,m=0,v=f.length;m<v;m++)n.add(f[m],d);return n},l.prototype.size=function(){return o?this._set.size:Object.getOwnPropertyNames(this._set).length},l.prototype.add=function(f,d){var n=o?f:u.toSetString(f),m=o?this.has(f):r.call(this._set,n),v=this._array.length;(!m||d)&&this._array.push(f),m||(o?this._set.set(f,v):this._set[n]=v)},l.prototype.has=function(f){if(o)return this._set.has(f);var d=u.toSetString(f);return r.call(this._set,d)},l.prototype.indexOf=function(f){if(o){var d=this._set.get(f);if(d>=0)return d}else{var n=u.toSetString(f);if(r.call(this._set,n))return this._set[n]}throw new Error('"'+f+'" is not in the set.')},l.prototype.at=function(f){if(f>=0&&f<this._array.length)return this._array[f];throw new Error("No element indexed by "+f)},l.prototype.toArray=function(){return this._array.slice()},nh.ArraySet=l,nh}var rh={},bm;function a2(){if(bm)return rh;bm=1;var u=_l();function r(l,c){var f=l.generatedLine,d=c.generatedLine,n=l.generatedColumn,m=c.generatedColumn;return d>f||d==f&&m>=n||u.compareByGeneratedPositionsInflated(l,c)<=0}function o(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return o.prototype.unsortedForEach=function(c,f){this._array.forEach(c,f)},o.prototype.add=function(c){r(this._last,c)?(this._last=c,this._array.push(c)):(this._sorted=!1,this._array.push(c))},o.prototype.toArray=function(){return this._sorted||(this._array.sort(u.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},rh.MappingList=o,rh}var xm;function Lg(){if(xm)return th;xm=1;var u=Mg(),r=_l(),o=Dg().ArraySet,l=a2().MappingList;function c(f){f||(f={}),this._file=r.getArg(f,"file",null),this._sourceRoot=r.getArg(f,"sourceRoot",null),this._skipValidation=r.getArg(f,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new l,this._sourcesContents=null}return c.prototype._version=3,c.fromSourceMap=function(d){var n=d.sourceRoot,m=new c({file:d.file,sourceRoot:n});return d.eachMapping(function(v){var w={generated:{line:v.generatedLine,column:v.generatedColumn}};v.source!=null&&(w.source=v.source,n!=null&&(w.source=r.relative(n,w.source)),w.original={line:v.originalLine,column:v.originalColumn},v.name!=null&&(w.name=v.name)),m.addMapping(w)}),d.sources.forEach(function(v){var w=v;n!==null&&(w=r.relative(n,v)),m._sources.has(w)||m._sources.add(w);var A=d.sourceContentFor(v);A!=null&&m.setSourceContent(v,A)}),m},c.prototype.addMapping=function(d){var n=r.getArg(d,"generated"),m=r.getArg(d,"original",null),v=r.getArg(d,"source",null),w=r.getArg(d,"name",null);this._skipValidation||this._validateMapping(n,m,v,w),v!=null&&(v=String(v),this._sources.has(v)||this._sources.add(v)),w!=null&&(w=String(w),this._names.has(w)||this._names.add(w)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:m!=null&&m.line,originalColumn:m!=null&&m.column,source:v,name:w})},c.prototype.setSourceContent=function(d,n){var m=d;this._sourceRoot!=null&&(m=r.relative(this._sourceRoot,m)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[r.toSetString(m)]=n):this._sourcesContents&&(delete this._sourcesContents[r.toSetString(m)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},c.prototype.applySourceMap=function(d,n,m){var v=n;if(n==null){if(d.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);v=d.file}var w=this._sourceRoot;w!=null&&(v=r.relative(w,v));var A=new o,b=new o;this._mappings.unsortedForEach(function(E){if(E.source===v&&E.originalLine!=null){var T=d.originalPositionFor({line:E.originalLine,column:E.originalColumn});T.source!=null&&(E.source=T.source,m!=null&&(E.source=r.join(m,E.source)),w!=null&&(E.source=r.relative(w,E.source)),E.originalLine=T.line,E.originalColumn=T.column,T.name!=null&&(E.name=T.name))}var C=E.source;C!=null&&!A.has(C)&&A.add(C);var z=E.name;z!=null&&!b.has(z)&&b.add(z)},this),this._sources=A,this._names=b,d.sources.forEach(function(E){var T=d.sourceContentFor(E);T!=null&&(m!=null&&(E=r.join(m,E)),w!=null&&(E=r.relative(w,E)),this.setSourceContent(E,T))},this)},c.prototype._validateMapping=function(d,n,m,v){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(d&&"line"in d&&"column"in d&&d.line>0&&d.column>=0&&!n&&!m&&!v)){if(d&&"line"in d&&"column"in d&&n&&"line"in n&&"column"in n&&d.line>0&&d.column>=0&&n.line>0&&n.column>=0&&m)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:d,source:m,original:n,name:v}))}},c.prototype._serializeMappings=function(){for(var d=0,n=1,m=0,v=0,w=0,A=0,b="",E,T,C,z,B=this._mappings.toArray(),O=0,W=B.length;O<W;O++){if(T=B[O],E="",T.generatedLine!==n)for(d=0;T.generatedLine!==n;)E+=";",n++;else if(O>0){if(!r.compareByGeneratedPositionsInflated(T,B[O-1]))continue;E+=","}E+=u.encode(T.generatedColumn-d),d=T.generatedColumn,T.source!=null&&(z=this._sources.indexOf(T.source),E+=u.encode(z-A),A=z,E+=u.encode(T.originalLine-1-v),v=T.originalLine-1,E+=u.encode(T.originalColumn-m),m=T.originalColumn,T.name!=null&&(C=this._names.indexOf(T.name),E+=u.encode(C-w),w=C)),b+=E}return b},c.prototype._generateSourcesContent=function(d,n){return d.map(function(m){if(!this._sourcesContents)return null;n!=null&&(m=r.relative(n,m));var v=r.toSetString(m);return Object.prototype.hasOwnProperty.call(this._sourcesContents,v)?this._sourcesContents[v]:null},this)},c.prototype.toJSON=function(){var d={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(d.file=this._file),this._sourceRoot!=null&&(d.sourceRoot=this._sourceRoot),this._sourcesContents&&(d.sourcesContent=this._generateSourcesContent(d.sources,d.sourceRoot)),d},c.prototype.toString=function(){return JSON.stringify(this.toJSON())},th.SourceMapGenerator=c,th}var sl={},sh={},wm;function l2(){return wm||(wm=1,function(u){u.GREATEST_LOWER_BOUND=1,u.LEAST_UPPER_BOUND=2;function r(o,l,c,f,d,n){var m=Math.floor((l-o)/2)+o,v=d(c,f[m],!0);return v===0?m:v>0?l-m>1?r(m,l,c,f,d,n):n==u.LEAST_UPPER_BOUND?l<f.length?l:-1:m:m-o>1?r(o,m,c,f,d,n):n==u.LEAST_UPPER_BOUND?m:o<0?-1:o}u.search=function(l,c,f,d){if(c.length===0)return-1;var n=r(-1,c.length,l,c,f,d||u.GREATEST_LOWER_BOUND);if(n<0)return-1;for(;n-1>=0&&f(c[n],c[n-1],!0)===0;)--n;return n}}(sh)),sh}var oh={},km;function c2(){if(km)return oh;km=1;function u(l,c,f){var d=l[c];l[c]=l[f],l[f]=d}function r(l,c){return Math.round(l+Math.random()*(c-l))}function o(l,c,f,d){if(f<d){var n=r(f,d),m=f-1;u(l,n,d);for(var v=l[d],w=f;w<d;w++)c(l[w],v)<=0&&(m+=1,u(l,m,w));u(l,m+1,w);var A=m+1;o(l,c,f,A-1),o(l,c,A+1,d)}}return oh.quickSort=function(l,c){o(l,c,0,l.length-1)},oh}var Sm;function u2(){if(Sm)return sl;Sm=1;var u=_l(),r=l2(),o=Dg().ArraySet,l=Mg(),c=c2().quickSort;function f(v,w){var A=v;return typeof v=="string"&&(A=u.parseSourceMapInput(v)),A.sections!=null?new m(A,w):new d(A,w)}f.fromSourceMap=function(v,w){return d.fromSourceMap(v,w)},f.prototype._version=3,f.prototype.__generatedMappings=null,Object.defineProperty(f.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),f.prototype.__originalMappings=null,Object.defineProperty(f.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),f.prototype._charIsMappingSeparator=function(w,A){var b=w.charAt(A);return b===";"||b===","},f.prototype._parseMappings=function(w,A){throw new Error("Subclasses must implement _parseMappings")},f.GENERATED_ORDER=1,f.ORIGINAL_ORDER=2,f.GREATEST_LOWER_BOUND=1,f.LEAST_UPPER_BOUND=2,f.prototype.eachMapping=function(w,A,b){var E=A||null,T=b||f.GENERATED_ORDER,C;switch(T){case f.GENERATED_ORDER:C=this._generatedMappings;break;case f.ORIGINAL_ORDER:C=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var z=this.sourceRoot;C.map(function(B){var O=B.source===null?null:this._sources.at(B.source);return O=u.computeSourceURL(z,O,this._sourceMapURL),{source:O,generatedLine:B.generatedLine,generatedColumn:B.generatedColumn,originalLine:B.originalLine,originalColumn:B.originalColumn,name:B.name===null?null:this._names.at(B.name)}},this).forEach(w,E)},f.prototype.allGeneratedPositionsFor=function(w){var A=u.getArg(w,"line"),b={source:u.getArg(w,"source"),originalLine:A,originalColumn:u.getArg(w,"column",0)};if(b.source=this._findSourceIndex(b.source),b.source<0)return[];var E=[],T=this._findMapping(b,this._originalMappings,"originalLine","originalColumn",u.compareByOriginalPositions,r.LEAST_UPPER_BOUND);if(T>=0){var C=this._originalMappings[T];if(w.column===void 0)for(var z=C.originalLine;C&&C.originalLine===z;)E.push({line:u.getArg(C,"generatedLine",null),column:u.getArg(C,"generatedColumn",null),lastColumn:u.getArg(C,"lastGeneratedColumn",null)}),C=this._originalMappings[++T];else for(var B=C.originalColumn;C&&C.originalLine===A&&C.originalColumn==B;)E.push({line:u.getArg(C,"generatedLine",null),column:u.getArg(C,"generatedColumn",null),lastColumn:u.getArg(C,"lastGeneratedColumn",null)}),C=this._originalMappings[++T]}return E},sl.SourceMapConsumer=f;function d(v,w){var A=v;typeof v=="string"&&(A=u.parseSourceMapInput(v));var b=u.getArg(A,"version"),E=u.getArg(A,"sources"),T=u.getArg(A,"names",[]),C=u.getArg(A,"sourceRoot",null),z=u.getArg(A,"sourcesContent",null),B=u.getArg(A,"mappings"),O=u.getArg(A,"file",null);if(b!=this._version)throw new Error("Unsupported version: "+b);C&&(C=u.normalize(C)),E=E.map(String).map(u.normalize).map(function(W){return C&&u.isAbsolute(C)&&u.isAbsolute(W)?u.relative(C,W):W}),this._names=o.fromArray(T.map(String),!0),this._sources=o.fromArray(E,!0),this._absoluteSources=this._sources.toArray().map(function(W){return u.computeSourceURL(C,W,w)}),this.sourceRoot=C,this.sourcesContent=z,this._mappings=B,this._sourceMapURL=w,this.file=O}d.prototype=Object.create(f.prototype),d.prototype.consumer=f,d.prototype._findSourceIndex=function(v){var w=v;if(this.sourceRoot!=null&&(w=u.relative(this.sourceRoot,w)),this._sources.has(w))return this._sources.indexOf(w);var A;for(A=0;A<this._absoluteSources.length;++A)if(this._absoluteSources[A]==v)return A;return-1},d.fromSourceMap=function(w,A){var b=Object.create(d.prototype),E=b._names=o.fromArray(w._names.toArray(),!0),T=b._sources=o.fromArray(w._sources.toArray(),!0);b.sourceRoot=w._sourceRoot,b.sourcesContent=w._generateSourcesContent(b._sources.toArray(),b.sourceRoot),b.file=w._file,b._sourceMapURL=A,b._absoluteSources=b._sources.toArray().map(function(ae){return u.computeSourceURL(b.sourceRoot,ae,A)});for(var C=w._mappings.toArray().slice(),z=b.__generatedMappings=[],B=b.__originalMappings=[],O=0,W=C.length;O<W;O++){var q=C[O],Z=new n;Z.generatedLine=q.generatedLine,Z.generatedColumn=q.generatedColumn,q.source&&(Z.source=T.indexOf(q.source),Z.originalLine=q.originalLine,Z.originalColumn=q.originalColumn,q.name&&(Z.name=E.indexOf(q.name)),B.push(Z)),z.push(Z)}return c(b.__originalMappings,u.compareByOriginalPositions),b},d.prototype._version=3,Object.defineProperty(d.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function n(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}d.prototype._parseMappings=function(w,A){for(var b=1,E=0,T=0,C=0,z=0,B=0,O=w.length,W=0,q={},Z={},ae=[],J=[],he,we,Se,ot,oe;W<O;)if(w.charAt(W)===";")b++,W++,E=0;else if(w.charAt(W)===",")W++;else{for(he=new n,he.generatedLine=b,ot=W;ot<O&&!this._charIsMappingSeparator(w,ot);ot++);if(we=w.slice(W,ot),Se=q[we],Se)W+=we.length;else{for(Se=[];W<ot;)l.decode(w,W,Z),oe=Z.value,W=Z.rest,Se.push(oe);if(Se.length===2)throw new Error("Found a source, but no line and column");if(Se.length===3)throw new Error("Found a source and line, but no column");q[we]=Se}he.generatedColumn=E+Se[0],E=he.generatedColumn,Se.length>1&&(he.source=z+Se[1],z+=Se[1],he.originalLine=T+Se[2],T=he.originalLine,he.originalLine+=1,he.originalColumn=C+Se[3],C=he.originalColumn,Se.length>4&&(he.name=B+Se[4],B+=Se[4])),J.push(he),typeof he.originalLine=="number"&&ae.push(he)}c(J,u.compareByGeneratedPositionsDeflated),this.__generatedMappings=J,c(ae,u.compareByOriginalPositions),this.__originalMappings=ae},d.prototype._findMapping=function(w,A,b,E,T,C){if(w[b]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+w[b]);if(w[E]<0)throw new TypeError("Column must be greater than or equal to 0, got "+w[E]);return r.search(w,A,T,C)},d.prototype.computeColumnSpans=function(){for(var w=0;w<this._generatedMappings.length;++w){var A=this._generatedMappings[w];if(w+1<this._generatedMappings.length){var b=this._generatedMappings[w+1];if(A.generatedLine===b.generatedLine){A.lastGeneratedColumn=b.generatedColumn-1;continue}}A.lastGeneratedColumn=1/0}},d.prototype.originalPositionFor=function(w){var A={generatedLine:u.getArg(w,"line"),generatedColumn:u.getArg(w,"column")},b=this._findMapping(A,this._generatedMappings,"generatedLine","generatedColumn",u.compareByGeneratedPositionsDeflated,u.getArg(w,"bias",f.GREATEST_LOWER_BOUND));if(b>=0){var E=this._generatedMappings[b];if(E.generatedLine===A.generatedLine){var T=u.getArg(E,"source",null);T!==null&&(T=this._sources.at(T),T=u.computeSourceURL(this.sourceRoot,T,this._sourceMapURL));var C=u.getArg(E,"name",null);return C!==null&&(C=this._names.at(C)),{source:T,line:u.getArg(E,"originalLine",null),column:u.getArg(E,"originalColumn",null),name:C}}}return{source:null,line:null,column:null,name:null}},d.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(w){return w==null}):!1},d.prototype.sourceContentFor=function(w,A){if(!this.sourcesContent)return null;var b=this._findSourceIndex(w);if(b>=0)return this.sourcesContent[b];var E=w;this.sourceRoot!=null&&(E=u.relative(this.sourceRoot,E));var T;if(this.sourceRoot!=null&&(T=u.urlParse(this.sourceRoot))){var C=E.replace(/^file:\/\//,"");if(T.scheme=="file"&&this._sources.has(C))return this.sourcesContent[this._sources.indexOf(C)];if((!T.path||T.path=="/")&&this._sources.has("/"+E))return this.sourcesContent[this._sources.indexOf("/"+E)]}if(A)return null;throw new Error('"'+E+'" is not in the SourceMap.')},d.prototype.generatedPositionFor=function(w){var A=u.getArg(w,"source");if(A=this._findSourceIndex(A),A<0)return{line:null,column:null,lastColumn:null};var b={source:A,originalLine:u.getArg(w,"line"),originalColumn:u.getArg(w,"column")},E=this._findMapping(b,this._originalMappings,"originalLine","originalColumn",u.compareByOriginalPositions,u.getArg(w,"bias",f.GREATEST_LOWER_BOUND));if(E>=0){var T=this._originalMappings[E];if(T.source===b.source)return{line:u.getArg(T,"generatedLine",null),column:u.getArg(T,"generatedColumn",null),lastColumn:u.getArg(T,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},sl.BasicSourceMapConsumer=d;function m(v,w){var A=v;typeof v=="string"&&(A=u.parseSourceMapInput(v));var b=u.getArg(A,"version"),E=u.getArg(A,"sections");if(b!=this._version)throw new Error("Unsupported version: "+b);this._sources=new o,this._names=new o;var T={line:-1,column:0};this._sections=E.map(function(C){if(C.url)throw new Error("Support for url field in sections not implemented.");var z=u.getArg(C,"offset"),B=u.getArg(z,"line"),O=u.getArg(z,"column");if(B<T.line||B===T.line&&O<T.column)throw new Error("Section offsets must be ordered and non-overlapping.");return T=z,{generatedOffset:{generatedLine:B+1,generatedColumn:O+1},consumer:new f(u.getArg(C,"map"),w)}})}return m.prototype=Object.create(f.prototype),m.prototype.constructor=f,m.prototype._version=3,Object.defineProperty(m.prototype,"sources",{get:function(){for(var v=[],w=0;w<this._sections.length;w++)for(var A=0;A<this._sections[w].consumer.sources.length;A++)v.push(this._sections[w].consumer.sources[A]);return v}}),m.prototype.originalPositionFor=function(w){var A={generatedLine:u.getArg(w,"line"),generatedColumn:u.getArg(w,"column")},b=r.search(A,this._sections,function(T,C){var z=T.generatedLine-C.generatedOffset.generatedLine;return z||T.generatedColumn-C.generatedOffset.generatedColumn}),E=this._sections[b];return E?E.consumer.originalPositionFor({line:A.generatedLine-(E.generatedOffset.generatedLine-1),column:A.generatedColumn-(E.generatedOffset.generatedLine===A.generatedLine?E.generatedOffset.generatedColumn-1:0),bias:w.bias}):{source:null,line:null,column:null,name:null}},m.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(w){return w.consumer.hasContentsOfAllSources()})},m.prototype.sourceContentFor=function(w,A){for(var b=0;b<this._sections.length;b++){var E=this._sections[b],T=E.consumer.sourceContentFor(w,!0);if(T)return T}if(A)return null;throw new Error('"'+w+'" is not in the SourceMap.')},m.prototype.generatedPositionFor=function(w){for(var A=0;A<this._sections.length;A++){var b=this._sections[A];if(b.consumer._findSourceIndex(u.getArg(w,"source"))!==-1){var E=b.consumer.generatedPositionFor(w);if(E){var T={line:E.line+(b.generatedOffset.generatedLine-1),column:E.column+(b.generatedOffset.generatedLine===E.line?b.generatedOffset.generatedColumn-1:0)};return T}}}return{line:null,column:null}},m.prototype._parseMappings=function(w,A){this.__generatedMappings=[],this.__originalMappings=[];for(var b=0;b<this._sections.length;b++)for(var E=this._sections[b],T=E.consumer._generatedMappings,C=0;C<T.length;C++){var z=T[C],B=E.consumer._sources.at(z.source);B=u.computeSourceURL(E.consumer.sourceRoot,B,this._sourceMapURL),this._sources.add(B),B=this._sources.indexOf(B);var O=null;z.name&&(O=E.consumer._names.at(z.name),this._names.add(O),O=this._names.indexOf(O));var W={source:B,generatedLine:z.generatedLine+(E.generatedOffset.generatedLine-1),generatedColumn:z.generatedColumn+(E.generatedOffset.generatedLine===z.generatedLine?E.generatedOffset.generatedColumn-1:0),originalLine:z.originalLine,originalColumn:z.originalColumn,name:O};this.__generatedMappings.push(W),typeof W.originalLine=="number"&&this.__originalMappings.push(W)}c(this.__generatedMappings,u.compareByGeneratedPositionsDeflated),c(this.__originalMappings,u.compareByOriginalPositions)},sl.IndexedSourceMapConsumer=m,sl}var ah={},Em;function h2(){if(Em)return ah;Em=1;var u=Lg().SourceMapGenerator,r=_l(),o=/(\r?\n)/,l=10,c="$$$isSourceNode$$$";function f(d,n,m,v,w){this.children=[],this.sourceContents={},this.line=d??null,this.column=n??null,this.source=m??null,this.name=w??null,this[c]=!0,v!=null&&this.add(v)}return f.fromStringWithSourceMap=function(n,m,v){var w=new f,A=n.split(o),b=0,E=function(){var O=q(),W=q()||"";return O+W;function q(){return b<A.length?A[b++]:void 0}},T=1,C=0,z=null;return m.eachMapping(function(O){if(z!==null)if(T<O.generatedLine)B(z,E()),T++,C=0;else{var W=A[b]||"",q=W.substr(0,O.generatedColumn-C);A[b]=W.substr(O.generatedColumn-C),C=O.generatedColumn,B(z,q),z=O;return}for(;T<O.generatedLine;)w.add(E()),T++;if(C<O.generatedColumn){var W=A[b]||"";w.add(W.substr(0,O.generatedColumn)),A[b]=W.substr(O.generatedColumn),C=O.generatedColumn}z=O},this),b<A.length&&(z&&B(z,E()),w.add(A.splice(b).join(""))),m.sources.forEach(function(O){var W=m.sourceContentFor(O);W!=null&&(v!=null&&(O=r.join(v,O)),w.setSourceContent(O,W))}),w;function B(O,W){if(O===null||O.source===void 0)w.add(W);else{var q=v?r.join(v,O.source):O.source;w.add(new f(O.originalLine,O.originalColumn,q,W,O.name))}}},f.prototype.add=function(n){if(Array.isArray(n))n.forEach(function(m){this.add(m)},this);else if(n[c]||typeof n=="string")n&&this.children.push(n);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+n);return this},f.prototype.prepend=function(n){if(Array.isArray(n))for(var m=n.length-1;m>=0;m--)this.prepend(n[m]);else if(n[c]||typeof n=="string")this.children.unshift(n);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+n);return this},f.prototype.walk=function(n){for(var m,v=0,w=this.children.length;v<w;v++)m=this.children[v],m[c]?m.walk(n):m!==""&&n(m,{source:this.source,line:this.line,column:this.column,name:this.name})},f.prototype.join=function(n){var m,v,w=this.children.length;if(w>0){for(m=[],v=0;v<w-1;v++)m.push(this.children[v]),m.push(n);m.push(this.children[v]),this.children=m}return this},f.prototype.replaceRight=function(n,m){var v=this.children[this.children.length-1];return v[c]?v.replaceRight(n,m):typeof v=="string"?this.children[this.children.length-1]=v.replace(n,m):this.children.push("".replace(n,m)),this},f.prototype.setSourceContent=function(n,m){this.sourceContents[r.toSetString(n)]=m},f.prototype.walkSourceContents=function(n){for(var m=0,v=this.children.length;m<v;m++)this.children[m][c]&&this.children[m].walkSourceContents(n);for(var w=Object.keys(this.sourceContents),m=0,v=w.length;m<v;m++)n(r.fromSetString(w[m]),this.sourceContents[w[m]])},f.prototype.toString=function(){var n="";return this.walk(function(m){n+=m}),n},f.prototype.toStringWithSourceMap=function(n){var m={code:"",line:1,column:0},v=new u(n),w=!1,A=null,b=null,E=null,T=null;return this.walk(function(C,z){m.code+=C,z.source!==null&&z.line!==null&&z.column!==null?((A!==z.source||b!==z.line||E!==z.column||T!==z.name)&&v.addMapping({source:z.source,original:{line:z.line,column:z.column},generated:{line:m.line,column:m.column},name:z.name}),A=z.source,b=z.line,E=z.column,T=z.name,w=!0):w&&(v.addMapping({generated:{line:m.line,column:m.column}}),A=null,w=!1);for(var B=0,O=C.length;B<O;B++)C.charCodeAt(B)===l?(m.line++,m.column=0,B+1===O?(A=null,w=!1):w&&v.addMapping({source:z.source,original:{line:z.line,column:z.column},generated:{line:m.line,column:m.column},name:z.name})):m.column++}),this.walkSourceContents(function(C,z){v.setSourceContent(C,z)}),{code:m.code,map:v}},ah.SourceNode=f,ah}var Tm;function f2(){return Tm||(Tm=1,rl.SourceMapGenerator=Lg().SourceMapGenerator,rl.SourceMapConsumer=u2().SourceMapConsumer,rl.SourceNode=h2().SourceNode),rl}(function(u,r){r.__esModule=!0;var o=en,l=void 0;try{var c=f2();l=c.SourceNode}catch{}l||(l=function(n,m,v,w){this.src="",w&&this.add(w)},l.prototype={add:function(m){o.isArray(m)&&(m=m.join("")),this.src+=m},prepend:function(m){o.isArray(m)&&(m=m.join("")),this.src=m+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function f(n,m,v){if(o.isArray(n)){for(var w=[],A=0,b=n.length;A<b;A++)w.push(m.wrap(n[A],v));return w}else if(typeof n=="boolean"||typeof n=="number")return n+"";return n}function d(n){this.srcFile=n,this.source=[]}d.prototype={isEmpty:function(){return!this.source.length},prepend:function(m,v){this.source.unshift(this.wrap(m,v))},push:function(m,v){this.source.push(this.wrap(m,v))},merge:function(){var m=this.empty();return this.each(function(v){m.add(["  ",v,`
`])}),m},each:function(m){for(var v=0,w=this.source.length;v<w;v++)m(this.source[v])},empty:function(){var m=this.currentLocation||{start:{}};return new l(m.start.line,m.start.column,this.srcFile)},wrap:function(m){var v=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return m instanceof l?m:(m=f(m,this,v),new l(v.start.line,v.start.column,this.srcFile,m))},functionCall:function(m,v,w){return w=this.generateList(w),this.wrap([m,v?"."+v+"(":"(",w,")"])},quotedString:function(m){return'"'+(m+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(m){var v=this,w=[];Object.keys(m).forEach(function(b){var E=f(m[b],v);E!=="undefined"&&w.push([v.quotedString(b),":",E])});var A=this.generateList(w);return A.prepend("{"),A.add("}"),A},generateList:function(m){for(var v=this.empty(),w=0,A=m.length;w<A;w++)w&&v.add(","),v.add(f(m[w],this));return v},generateArray:function(m){var v=this.generateList(m);return v.prepend("["),v.add("]"),v}},r.default=d,u.exports=r.default})(Oh,Oh.exports);var d2=Oh.exports;(function(u,r){r.__esModule=!0;function o(b){return b&&b.__esModule?b:{default:b}}var l=kr,c=Lr,f=o(c),d=en,n=d2,m=o(n);function v(b){this.value=b}function w(){}w.prototype={nameLookup:function(E,T){return this.internalNameLookup(E,T)},depthedLookup:function(E){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(E),")"]},compilerInfo:function(){var E=l.COMPILER_REVISION,T=l.REVISION_CHANGES[E];return[E,T]},appendToBuffer:function(E,T,C){return d.isArray(E)||(E=[E]),E=this.source.wrap(E,T),this.environment.isSimple?["return ",E,";"]:C?["buffer += ",E,";"]:(E.appendToBuffer=!0,E)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(E,T){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",E,",",JSON.stringify(T),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(E,T,C,z){this.environment=E,this.options=T,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!z,this.name=this.environment.name,this.isChild=!!C,this.context=C||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(E,T),this.useDepths=this.useDepths||E.useDepths||E.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||E.useBlockParams;var B=E.opcodes,O=void 0,W=void 0,q=void 0,Z=void 0;for(q=0,Z=B.length;q<Z;q++)O=B[q],this.source.currentLocation=O.loc,W=W||O.loc,this[O.opcode].apply(this,O.args);if(this.source.currentLocation=W,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new f.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),z?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var ae=this.createFunctionContext(z);if(this.isChild)return ae;var J={compiler:this.compilerInfo(),main:ae};this.decorators&&(J.main_d=this.decorators,J.useDecorators=!0);var he=this.context,we=he.programs,Se=he.decorators;for(q=0,Z=we.length;q<Z;q++)we[q]&&(J[q]=we[q],Se[q]&&(J[q+"_d"]=Se[q],J.useDecorators=!0));return this.environment.usePartial&&(J.usePartial=!0),this.options.data&&(J.useData=!0),this.useDepths&&(J.useDepths=!0),this.useBlockParams&&(J.useBlockParams=!0),this.options.compat&&(J.compat=!0),z?J.compilerOptions=this.options:(J.compiler=JSON.stringify(J.compiler),this.source.currentLocation={start:{line:1,column:0}},J=this.objectLiteral(J),T.srcName?(J=J.toStringWithSourceMap({file:T.destName}),J.map=J.map&&J.map.toString()):J=J.toString()),J},preamble:function(){this.lastContext=0,this.source=new m.default(this.options.srcName),this.decorators=new m.default(this.options.srcName)},createFunctionContext:function(E){var T=this,C="",z=this.stackVars.concat(this.registers.list);z.length>0&&(C+=", "+z.join(", "));var B=0;Object.keys(this.aliases).forEach(function(q){var Z=T.aliases[q];Z.children&&Z.referenceCount>1&&(C+=", alias"+ ++B+"="+q,Z.children[0]="alias"+B)}),this.lookupPropertyFunctionIsUsed&&(C+=", "+this.lookupPropertyFunctionVarDeclaration());var O=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&O.push("blockParams"),this.useDepths&&O.push("depths");var W=this.mergeSource(C);return E?(O.push(W),Function.apply(this,O)):this.source.wrap(["function(",O.join(","),`) {
  `,W,"}"])},mergeSource:function(E){var T=this.environment.isSimple,C=!this.forceBuffer,z=void 0,B=void 0,O=void 0,W=void 0;return this.source.each(function(q){q.appendToBuffer?(O?q.prepend("  + "):O=q,W=q):(O&&(B?O.prepend("buffer += "):z=!0,W.add(";"),O=W=void 0),B=!0,T||(C=!1))}),C?O?(O.prepend("return "),W.add(";")):B||this.source.push('return "";'):(E+=", buffer = "+(z?"":this.initializeBuffer()),O?(O.prepend("return buffer + "),W.add(";")):this.source.push("return buffer;")),E&&this.source.prepend("var "+E.substring(2)+(z?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(E){var T=this.aliasable("container.hooks.blockHelperMissing"),C=[this.contextName(0)];this.setupHelperArgs(E,0,C);var z=this.popStack();C.splice(1,0,z),this.push(this.source.functionCall(T,"call",C))},ambiguousBlockValue:function(){var E=this.aliasable("container.hooks.blockHelperMissing"),T=[this.contextName(0)];this.setupHelperArgs("",0,T,!0),this.flushInline();var C=this.topStack();T.splice(1,0,C),this.pushSource(["if (!",this.lastHelper,") { ",C," = ",this.source.functionCall(E,"call",T),"}"])},appendContent:function(E){this.pendingContent?E=this.pendingContent+E:this.pendingLocation=this.source.currentLocation,this.pendingContent=E},append:function(){if(this.isInline())this.replaceStack(function(T){return[" != null ? ",T,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var E=this.popStack();this.pushSource(["if (",E," != null) { ",this.appendToBuffer(E,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(E){this.lastContext=E},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(E,T,C,z){var B=0;!z&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(E[B++])):this.pushContext(),this.resolvePath("context",E,B,T,C)},lookupBlockParam:function(E,T){this.useBlockParams=!0,this.push(["blockParams[",E[0],"][",E[1],"]"]),this.resolvePath("context",T,1)},lookupData:function(E,T,C){E?this.pushStackLiteral("container.data(data, "+E+")"):this.pushStackLiteral("data"),this.resolvePath("data",T,0,!0,C)},resolvePath:function(E,T,C,z,B){var O=this;if(this.options.strict||this.options.assumeObjects){this.push(A(this.options.strict&&B,this,T,C,E));return}for(var W=T.length;C<W;C++)this.replaceStack(function(q){var Z=O.nameLookup(q,T[C],E);return z?[" && ",Z]:[" != null ? ",Z," : ",q]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(E,T){this.pushContext(),this.pushString(T),T!=="SubExpression"&&(typeof E=="string"?this.pushString(E):this.pushStackLiteral(E))},emptyHash:function(E){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(E?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var E=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(E.ids)),this.stringParams&&(this.push(this.objectLiteral(E.contexts)),this.push(this.objectLiteral(E.types))),this.push(this.objectLiteral(E.values))},pushString:function(E){this.pushStackLiteral(this.quotedString(E))},pushLiteral:function(E){this.pushStackLiteral(E)},pushProgram:function(E){E!=null?this.pushStackLiteral(this.programExpression(E)):this.pushStackLiteral(null)},registerDecorator:function(E,T){var C=this.nameLookup("decorators",T,"decorator"),z=this.setupHelperArgs(T,E);this.decorators.push(["fn = ",this.decorators.functionCall(C,"",["fn","props","container",z])," || fn;"])},invokeHelper:function(E,T,C){var z=this.popStack(),B=this.setupHelper(E,T),O=[];C&&O.push(B.name),O.push(z),this.options.strict||O.push(this.aliasable("container.hooks.helperMissing"));var W=["(",this.itemsSeparatedBy(O,"||"),")"],q=this.source.functionCall(W,"call",B.callParams);this.push(q)},itemsSeparatedBy:function(E,T){var C=[];C.push(E[0]);for(var z=1;z<E.length;z++)C.push(T,E[z]);return C},invokeKnownHelper:function(E,T){var C=this.setupHelper(E,T);this.push(this.source.functionCall(C.name,"call",C.callParams))},invokeAmbiguous:function(E,T){this.useRegister("helper");var C=this.popStack();this.emptyHash();var z=this.setupHelper(0,E,T),B=this.lastHelper=this.nameLookup("helpers",E,"helper"),O=["(","(helper = ",B," || ",C,")"];this.options.strict||(O[0]="(helper = ",O.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",O,z.paramsInit?["),(",z.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",z.callParams)," : helper))"])},invokePartial:function(E,T,C){var z=[],B=this.setupParams(T,1,z);E&&(T=this.popStack(),delete B.name),C&&(B.indent=JSON.stringify(C)),B.helpers="helpers",B.partials="partials",B.decorators="container.decorators",E?z.unshift(T):z.unshift(this.nameLookup("partials",T,"partial")),this.options.compat&&(B.depths="depths"),B=this.objectLiteral(B),z.push(B),this.push(this.source.functionCall("container.invokePartial","",z))},assignToHash:function(E){var T=this.popStack(),C=void 0,z=void 0,B=void 0;this.trackIds&&(B=this.popStack()),this.stringParams&&(z=this.popStack(),C=this.popStack());var O=this.hash;C&&(O.contexts[E]=C),z&&(O.types[E]=z),B&&(O.ids[E]=B),O.values[E]=T},pushId:function(E,T,C){E==="BlockParam"?this.pushStackLiteral("blockParams["+T[0]+"].path["+T[1]+"]"+(C?" + "+JSON.stringify("."+C):"")):E==="PathExpression"?this.pushString(T):E==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:w,compileChildren:function(E,T){for(var C=E.children,z=void 0,B=void 0,O=0,W=C.length;O<W;O++){z=C[O],B=new this.compiler;var q=this.matchExistingProgram(z);if(q==null){this.context.programs.push("");var Z=this.context.programs.length;z.index=Z,z.name="program"+Z,this.context.programs[Z]=B.compile(z,T,this.context,!this.precompile),this.context.decorators[Z]=B.decorators,this.context.environments[Z]=z,this.useDepths=this.useDepths||B.useDepths,this.useBlockParams=this.useBlockParams||B.useBlockParams,z.useDepths=this.useDepths,z.useBlockParams=this.useBlockParams}else z.index=q.index,z.name="program"+q.index,this.useDepths=this.useDepths||q.useDepths,this.useBlockParams=this.useBlockParams||q.useBlockParams}},matchExistingProgram:function(E){for(var T=0,C=this.context.environments.length;T<C;T++){var z=this.context.environments[T];if(z&&z.equals(E))return z}},programExpression:function(E){var T=this.environment.children[E],C=[T.index,"data",T.blockParams];return(this.useBlockParams||this.useDepths)&&C.push("blockParams"),this.useDepths&&C.push("depths"),"container.program("+C.join(", ")+")"},useRegister:function(E){this.registers[E]||(this.registers[E]=!0,this.registers.list.push(E))},push:function(E){return E instanceof v||(E=this.source.wrap(E)),this.inlineStack.push(E),E},pushStackLiteral:function(E){this.push(new v(E))},pushSource:function(E){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),E&&this.source.push(E)},replaceStack:function(E){var T=["("],C=void 0,z=void 0,B=void 0;if(!this.isInline())throw new f.default("replaceStack on non-inline");var O=this.popStack(!0);if(O instanceof v)C=[O.value],T=["(",C],B=!0;else{z=!0;var W=this.incrStack();T=["((",this.push(W)," = ",O,")"],C=this.topStack()}var q=E.call(this,C);B||this.popStack(),z&&this.stackSlot--,this.push(T.concat(q,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var E=this.inlineStack;this.inlineStack=[];for(var T=0,C=E.length;T<C;T++){var z=E[T];if(z instanceof v)this.compileStack.push(z);else{var B=this.incrStack();this.pushSource([B," = ",z,";"]),this.compileStack.push(B)}}},isInline:function(){return this.inlineStack.length},popStack:function(E){var T=this.isInline(),C=(T?this.inlineStack:this.compileStack).pop();if(!E&&C instanceof v)return C.value;if(!T){if(!this.stackSlot)throw new f.default("Invalid stack pop");this.stackSlot--}return C},topStack:function(){var E=this.isInline()?this.inlineStack:this.compileStack,T=E[E.length-1];return T instanceof v?T.value:T},contextName:function(E){return this.useDepths&&E?"depths["+E+"]":"depth"+E},quotedString:function(E){return this.source.quotedString(E)},objectLiteral:function(E){return this.source.objectLiteral(E)},aliasable:function(E){var T=this.aliases[E];return T?(T.referenceCount++,T):(T=this.aliases[E]=this.source.wrap(E),T.aliasable=!0,T.referenceCount=1,T)},setupHelper:function(E,T,C){var z=[],B=this.setupHelperArgs(T,E,z,C),O=this.nameLookup("helpers",T,"helper"),W=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:z,paramsInit:B,name:O,callParams:[W].concat(z)}},setupParams:function(E,T,C){var z={},B=[],O=[],W=[],q=!C,Z=void 0;q&&(C=[]),z.name=this.quotedString(E),z.hash=this.popStack(),this.trackIds&&(z.hashIds=this.popStack()),this.stringParams&&(z.hashTypes=this.popStack(),z.hashContexts=this.popStack());var ae=this.popStack(),J=this.popStack();(J||ae)&&(z.fn=J||"container.noop",z.inverse=ae||"container.noop");for(var he=T;he--;)Z=this.popStack(),C[he]=Z,this.trackIds&&(W[he]=this.popStack()),this.stringParams&&(O[he]=this.popStack(),B[he]=this.popStack());return q&&(z.args=this.source.generateArray(C)),this.trackIds&&(z.ids=this.source.generateArray(W)),this.stringParams&&(z.types=this.source.generateArray(O),z.contexts=this.source.generateArray(B)),this.options.data&&(z.data="data"),this.useBlockParams&&(z.blockParams="blockParams"),z},setupHelperArgs:function(E,T,C,z){var B=this.setupParams(E,T,C);return B.loc=JSON.stringify(this.source.currentLocation),B=this.objectLiteral(B),z?(this.useRegister("options"),C.push("options"),["options=",B]):C?(C.push(B),""):B}},function(){for(var b="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),E=w.RESERVED_WORDS={},T=0,C=b.length;T<C;T++)E[b[T]]=!0}(),w.isValidJavaScriptVariableName=function(b){return!w.RESERVED_WORDS[b]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(b)};function A(b,E,T,C,z){var B=E.popStack(),O=T.length;for(b&&O--;C<O;C++)B=E.nameLookup(B,T[C],z);return b?[E.aliasable("container.strict"),"(",B,", ",E.quotedString(T[C]),", ",JSON.stringify(E.source.currentLocation)," )"]:B}r.default=w,u.exports=r.default})(Rh,Rh.exports);var p2=Rh.exports;(function(u,r){r.__esModule=!0;function o(O){return O&&O.__esModule?O:{default:O}}var l=Mx,c=o(l),f=Tg,d=o(f),n=ml,m=gl,v=p2,w=o(v),A=Ag,b=o(A),E=Eg,T=o(E),C=c.default.create;function z(){var O=C();return O.compile=function(W,q){return m.compile(W,q,O)},O.precompile=function(W,q){return m.precompile(W,q,O)},O.AST=d.default,O.Compiler=m.Compiler,O.JavaScriptCompiler=w.default,O.Parser=n.parser,O.parse=n.parse,O.parseWithoutProcessing=n.parseWithoutProcessing,O}var B=z();B.create=z,T.default(B),B.Visitor=b.default,B.default=B,r.default=B,u.exports=r.default})(ph,ph.exports);var m2=ph.exports;const g2=Gc(m2);function Cc(u){throw new Error('Could not dynamically require "'+u+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bg={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(u,r){(function(o){u.exports=o()})(function(){return function o(l,c,f){function d(v,w){if(!c[v]){if(!l[v]){var A=typeof Cc=="function"&&Cc;if(!w&&A)return A(v,!0);if(n)return n(v,!0);var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b}var E=c[v]={exports:{}};l[v][0].call(E.exports,function(T){var C=l[v][1][T];return d(C||T)},E,E.exports,o,l,c,f)}return c[v].exports}for(var n=typeof Cc=="function"&&Cc,m=0;m<f.length;m++)d(f[m]);return d}({1:[function(o,l,c){var f=o("./utils"),d=o("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(m){for(var v,w,A,b,E,T,C,z=[],B=0,O=m.length,W=O,q=f.getTypeOf(m)!=="string";B<m.length;)W=O-B,A=q?(v=m[B++],w=B<O?m[B++]:0,B<O?m[B++]:0):(v=m.charCodeAt(B++),w=B<O?m.charCodeAt(B++):0,B<O?m.charCodeAt(B++):0),b=v>>2,E=(3&v)<<4|w>>4,T=1<W?(15&w)<<2|A>>6:64,C=2<W?63&A:64,z.push(n.charAt(b)+n.charAt(E)+n.charAt(T)+n.charAt(C));return z.join("")},c.decode=function(m){var v,w,A,b,E,T,C=0,z=0,B="data:";if(m.substr(0,B.length)===B)throw new Error("Invalid base64 input, it looks like a data url.");var O,W=3*(m=m.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(m.charAt(m.length-1)===n.charAt(64)&&W--,m.charAt(m.length-2)===n.charAt(64)&&W--,W%1!=0)throw new Error("Invalid base64 input, bad content length.");for(O=d.uint8array?new Uint8Array(0|W):new Array(0|W);C<m.length;)v=n.indexOf(m.charAt(C++))<<2|(b=n.indexOf(m.charAt(C++)))>>4,w=(15&b)<<4|(E=n.indexOf(m.charAt(C++)))>>2,A=(3&E)<<6|(T=n.indexOf(m.charAt(C++))),O[z++]=v,E!==64&&(O[z++]=w),T!==64&&(O[z++]=A);return O}},{"./support":30,"./utils":32}],2:[function(o,l,c){var f=o("./external"),d=o("./stream/DataWorker"),n=o("./stream/Crc32Probe"),m=o("./stream/DataLengthProbe");function v(w,A,b,E,T){this.compressedSize=w,this.uncompressedSize=A,this.crc32=b,this.compression=E,this.compressedContent=T}v.prototype={getContentWorker:function(){var w=new d(f.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new m("data_length")),A=this;return w.on("end",function(){if(this.streamInfo.data_length!==A.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),w},getCompressedWorker:function(){return new d(f.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},v.createWorkerFrom=function(w,A,b){return w.pipe(new n).pipe(new m("uncompressedSize")).pipe(A.compressWorker(b)).pipe(new m("compressedSize")).withStreamInfo("compression",A)},l.exports=v},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(o,l,c){var f=o("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(){return new f("STORE compression")},uncompressWorker:function(){return new f("STORE decompression")}},c.DEFLATE=o("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(o,l,c){var f=o("./utils"),d=function(){for(var n,m=[],v=0;v<256;v++){n=v;for(var w=0;w<8;w++)n=1&n?3988292384^n>>>1:n>>>1;m[v]=n}return m}();l.exports=function(n,m){return n!==void 0&&n.length?f.getTypeOf(n)!=="string"?function(v,w,A,b){var E=d,T=b+A;v^=-1;for(var C=b;C<T;C++)v=v>>>8^E[255&(v^w[C])];return-1^v}(0|m,n,n.length,0):function(v,w,A,b){var E=d,T=b+A;v^=-1;for(var C=b;C<T;C++)v=v>>>8^E[255&(v^w.charCodeAt(C))];return-1^v}(0|m,n,n.length,0):0}},{"./utils":32}],5:[function(o,l,c){c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(o,l,c){var f=null;f=typeof Promise<"u"?Promise:o("lie"),l.exports={Promise:f}},{lie:37}],7:[function(o,l,c){var f=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",d=o("pako"),n=o("./utils"),m=o("./stream/GenericWorker"),v=f?"uint8array":"array";function w(A,b){m.call(this,"FlateWorker/"+A),this._pako=null,this._pakoAction=A,this._pakoOptions=b,this.meta={}}c.magic="\b\0",n.inherits(w,m),w.prototype.processChunk=function(A){this.meta=A.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(v,A.data),!1)},w.prototype.flush=function(){m.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},w.prototype.cleanUp=function(){m.prototype.cleanUp.call(this),this._pako=null},w.prototype._createPako=function(){this._pako=new d[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var A=this;this._pako.onData=function(b){A.push({data:b,meta:A.meta})}},c.compressWorker=function(A){return new w("Deflate",A)},c.uncompressWorker=function(){return new w("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(o,l,c){function f(E,T){var C,z="";for(C=0;C<T;C++)z+=String.fromCharCode(255&E),E>>>=8;return z}function d(E,T,C,z,B,O){var W,q,Z=E.file,ae=E.compression,J=O!==v.utf8encode,he=n.transformTo("string",O(Z.name)),we=n.transformTo("string",v.utf8encode(Z.name)),Se=Z.comment,ot=n.transformTo("string",O(Se)),oe=n.transformTo("string",v.utf8encode(Se)),Ve=we.length!==Z.name.length,K=oe.length!==Se.length,Ke="",ht="",ct="",Zt=Z.dir,Qe=Z.date,Ut={crc32:0,compressedSize:0,uncompressedSize:0};T&&!C||(Ut.crc32=E.crc32,Ut.compressedSize=E.compressedSize,Ut.uncompressedSize=E.uncompressedSize);var je=0;T&&(je|=8),J||!Ve&&!K||(je|=2048);var Oe=0,Vt=0;Zt&&(Oe|=16),B==="UNIX"?(Vt=798,Oe|=function(mt,bi){var zi=mt;return mt||(zi=bi?16893:33204),(65535&zi)<<16}(Z.unixPermissions,Zt)):(Vt=20,Oe|=function(mt){return 63&(mt||0)}(Z.dosPermissions)),W=Qe.getUTCHours(),W<<=6,W|=Qe.getUTCMinutes(),W<<=5,W|=Qe.getUTCSeconds()/2,q=Qe.getUTCFullYear()-1980,q<<=4,q|=Qe.getUTCMonth()+1,q<<=5,q|=Qe.getUTCDate(),Ve&&(ht=f(1,1)+f(w(he),4)+we,Ke+="up"+f(ht.length,2)+ht),K&&(ct=f(1,1)+f(w(ot),4)+oe,Ke+="uc"+f(ct.length,2)+ct);var Et="";return Et+=`
\0`,Et+=f(je,2),Et+=ae.magic,Et+=f(W,2),Et+=f(q,2),Et+=f(Ut.crc32,4),Et+=f(Ut.compressedSize,4),Et+=f(Ut.uncompressedSize,4),Et+=f(he.length,2),Et+=f(Ke.length,2),{fileRecord:A.LOCAL_FILE_HEADER+Et+he+Ke,dirRecord:A.CENTRAL_FILE_HEADER+f(Vt,2)+Et+f(ot.length,2)+"\0\0\0\0"+f(Oe,4)+f(z,4)+he+Ke+ot}}var n=o("../utils"),m=o("../stream/GenericWorker"),v=o("../utf8"),w=o("../crc32"),A=o("../signature");function b(E,T,C,z){m.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=T,this.zipPlatform=C,this.encodeFileName=z,this.streamFiles=E,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(b,m),b.prototype.push=function(E){var T=E.meta.percent||0,C=this.entriesCount,z=this._sources.length;this.accumulate?this.contentBuffer.push(E):(this.bytesWritten+=E.data.length,m.prototype.push.call(this,{data:E.data,meta:{currentFile:this.currentFile,percent:C?(T+100*(C-z-1))/C:100}}))},b.prototype.openedSource=function(E){this.currentSourceOffset=this.bytesWritten,this.currentFile=E.file.name;var T=this.streamFiles&&!E.file.dir;if(T){var C=d(E,T,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:C.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(E){this.accumulate=!1;var T=this.streamFiles&&!E.file.dir,C=d(E,T,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(C.dirRecord),T)this.push({data:function(z){return A.DATA_DESCRIPTOR+f(z.crc32,4)+f(z.compressedSize,4)+f(z.uncompressedSize,4)}(E),meta:{percent:100}});else for(this.push({data:C.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var E=this.bytesWritten,T=0;T<this.dirRecords.length;T++)this.push({data:this.dirRecords[T],meta:{percent:100}});var C=this.bytesWritten-E,z=function(B,O,W,q,Z){var ae=n.transformTo("string",Z(q));return A.CENTRAL_DIRECTORY_END+"\0\0\0\0"+f(B,2)+f(B,2)+f(O,4)+f(W,4)+f(ae.length,2)+ae}(this.dirRecords.length,C,E,this.zipComment,this.encodeFileName);this.push({data:z,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(E){this._sources.push(E);var T=this;return E.on("data",function(C){T.processChunk(C)}),E.on("end",function(){T.closedSource(T.previous.streamInfo),T._sources.length?T.prepareNextSource():T.end()}),E.on("error",function(C){T.error(C)}),this},b.prototype.resume=function(){return!!m.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(E){var T=this._sources;if(!m.prototype.error.call(this,E))return!1;for(var C=0;C<T.length;C++)try{T[C].error(E)}catch{}return!0},b.prototype.lock=function(){m.prototype.lock.call(this);for(var E=this._sources,T=0;T<E.length;T++)E[T].lock()},l.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(o,l,c){var f=o("../compressions"),d=o("./ZipFileWorker");c.generateWorker=function(n,m,v){var w=new d(m.streamFiles,v,m.platform,m.encodeFileName),A=0;try{n.forEach(function(b,E){A++;var T=function(O,W){var q=O||W,Z=f[q];if(!Z)throw new Error(q+" is not a valid compression method !");return Z}(E.options.compression,m.compression),C=E.options.compressionOptions||m.compressionOptions||{},z=E.dir,B=E.date;E._compressWorker(T,C).withStreamInfo("file",{name:b,dir:z,date:B,comment:E.comment||"",unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions}).pipe(w)}),w.entriesCount=A}catch(b){w.error(b)}return w}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(o,l,c){function f(){if(!(this instanceof f))return new f;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var d=new f;for(var n in this)typeof this[n]!="function"&&(d[n]=this[n]);return d}}(f.prototype=o("./object")).loadAsync=o("./load"),f.support=o("./support"),f.defaults=o("./defaults"),f.version="3.10.1",f.loadAsync=function(d,n){return new f().loadAsync(d,n)},f.external=o("./external"),l.exports=f},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(o,l,c){var f=o("./utils"),d=o("./external"),n=o("./utf8"),m=o("./zipEntries"),v=o("./stream/Crc32Probe"),w=o("./nodejsUtils");function A(b){return new d.Promise(function(E,T){var C=b.decompressed.getContentWorker().pipe(new v);C.on("error",function(z){T(z)}).on("end",function(){C.streamInfo.crc32!==b.decompressed.crc32?T(new Error("Corrupted zip : CRC32 mismatch")):E()}).resume()})}l.exports=function(b,E){var T=this;return E=f.extend(E||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),w.isNode&&w.isStream(b)?d.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):f.prepareContent("the loaded zip file",b,!0,E.optimizedBinaryString,E.base64).then(function(C){var z=new m(E);return z.load(C),z}).then(function(C){var z=[d.Promise.resolve(C)],B=C.files;if(E.checkCRC32)for(var O=0;O<B.length;O++)z.push(A(B[O]));return d.Promise.all(z)}).then(function(C){for(var z=C.shift(),B=z.files,O=0;O<B.length;O++){var W=B[O],q=W.fileNameStr,Z=f.resolve(W.fileNameStr);T.file(Z,W.decompressed,{binary:!0,optimizedBinaryString:!0,date:W.date,dir:W.dir,comment:W.fileCommentStr.length?W.fileCommentStr:null,unixPermissions:W.unixPermissions,dosPermissions:W.dosPermissions,createFolders:E.createFolders}),W.dir||(T.file(Z).unsafeOriginalName=q)}return z.zipComment.length&&(T.comment=z.zipComment),T})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(o,l,c){var f=o("../utils"),d=o("../stream/GenericWorker");function n(m,v){d.call(this,"Nodejs stream input adapter for "+m),this._upstreamEnded=!1,this._bindStream(v)}f.inherits(n,d),n.prototype._bindStream=function(m){var v=this;(this._stream=m).pause(),m.on("data",function(w){v.push({data:w,meta:{percent:0}})}).on("error",function(w){v.isPaused?this.generatedError=w:v.error(w)}).on("end",function(){v.isPaused?v._upstreamEnded=!0:v.end()})},n.prototype.pause=function(){return!!d.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},l.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(o,l,c){var f=o("readable-stream").Readable;function d(n,m,v){f.call(this,m),this._helper=n;var w=this;n.on("data",function(A,b){w.push(A)||w._helper.pause(),v&&v(b)}).on("error",function(A){w.emit("error",A)}).on("end",function(){w.push(null)})}o("../utils").inherits(d,f),d.prototype._read=function(){this._helper.resume()},l.exports=d},{"../utils":32,"readable-stream":16}],14:[function(o,l,c){l.exports={isNode:typeof Buffer<"u",newBufferFrom:function(f,d){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(f,d);if(typeof f=="number")throw new Error('The "data" argument must not be a number');return new Buffer(f,d)},allocBuffer:function(f){if(Buffer.alloc)return Buffer.alloc(f);var d=new Buffer(f);return d.fill(0),d},isBuffer:function(f){return Buffer.isBuffer(f)},isStream:function(f){return f&&typeof f.on=="function"&&typeof f.pause=="function"&&typeof f.resume=="function"}}},{}],15:[function(o,l,c){function f(Z,ae,J){var he,we=n.getTypeOf(ae),Se=n.extend(J||{},w);Se.date=Se.date||new Date,Se.compression!==null&&(Se.compression=Se.compression.toUpperCase()),typeof Se.unixPermissions=="string"&&(Se.unixPermissions=parseInt(Se.unixPermissions,8)),Se.unixPermissions&&16384&Se.unixPermissions&&(Se.dir=!0),Se.dosPermissions&&16&Se.dosPermissions&&(Se.dir=!0),Se.dir&&(Z=B(Z)),Se.createFolders&&(he=z(Z))&&O.call(this,he,!0);var ot=we==="string"&&Se.binary===!1&&Se.base64===!1;J&&J.binary!==void 0||(Se.binary=!ot),(ae instanceof A&&ae.uncompressedSize===0||Se.dir||!ae||ae.length===0)&&(Se.base64=!1,Se.binary=!0,ae="",Se.compression="STORE",we="string");var oe=null;oe=ae instanceof A||ae instanceof m?ae:T.isNode&&T.isStream(ae)?new C(Z,ae):n.prepareContent(Z,ae,Se.binary,Se.optimizedBinaryString,Se.base64);var Ve=new b(Z,oe,Se);this.files[Z]=Ve}var d=o("./utf8"),n=o("./utils"),m=o("./stream/GenericWorker"),v=o("./stream/StreamHelper"),w=o("./defaults"),A=o("./compressedObject"),b=o("./zipObject"),E=o("./generate"),T=o("./nodejsUtils"),C=o("./nodejs/NodejsStreamInputAdapter"),z=function(Z){Z.slice(-1)==="/"&&(Z=Z.substring(0,Z.length-1));var ae=Z.lastIndexOf("/");return 0<ae?Z.substring(0,ae):""},B=function(Z){return Z.slice(-1)!=="/"&&(Z+="/"),Z},O=function(Z,ae){return ae=ae!==void 0?ae:w.createFolders,Z=B(Z),this.files[Z]||f.call(this,Z,null,{dir:!0,createFolders:ae}),this.files[Z]};function W(Z){return Object.prototype.toString.call(Z)==="[object RegExp]"}var q={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(Z){var ae,J,he;for(ae in this.files)he=this.files[ae],(J=ae.slice(this.root.length,ae.length))&&ae.slice(0,this.root.length)===this.root&&Z(J,he)},filter:function(Z){var ae=[];return this.forEach(function(J,he){Z(J,he)&&ae.push(he)}),ae},file:function(Z,ae,J){if(arguments.length!==1)return Z=this.root+Z,f.call(this,Z,ae,J),this;if(W(Z)){var he=Z;return this.filter(function(Se,ot){return!ot.dir&&he.test(Se)})}var we=this.files[this.root+Z];return we&&!we.dir?we:null},folder:function(Z){if(!Z)return this;if(W(Z))return this.filter(function(we,Se){return Se.dir&&Z.test(we)});var ae=this.root+Z,J=O.call(this,ae),he=this.clone();return he.root=J.name,he},remove:function(Z){Z=this.root+Z;var ae=this.files[Z];if(ae||(Z.slice(-1)!=="/"&&(Z+="/"),ae=this.files[Z]),ae&&!ae.dir)delete this.files[Z];else for(var J=this.filter(function(we,Se){return Se.name.slice(0,Z.length)===Z}),he=0;he<J.length;he++)delete this.files[J[he].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(Z){var ae,J={};try{if((J=n.extend(Z||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:d.utf8encode})).type=J.type.toLowerCase(),J.compression=J.compression.toUpperCase(),J.type==="binarystring"&&(J.type="string"),!J.type)throw new Error("No output type specified.");n.checkSupport(J.type),J.platform!=="darwin"&&J.platform!=="freebsd"&&J.platform!=="linux"&&J.platform!=="sunos"||(J.platform="UNIX"),J.platform==="win32"&&(J.platform="DOS");var he=J.comment||this.comment||"";ae=E.generateWorker(this,J,he)}catch(we){(ae=new m("error")).error(we)}return new v(ae,J.type||"string",J.mimeType)},generateAsync:function(Z,ae){return this.generateInternalStream(Z).accumulate(ae)},generateNodeStream:function(Z,ae){return(Z=Z||{}).type||(Z.type="nodebuffer"),this.generateInternalStream(Z).toNodejsStream(ae)}};l.exports=q},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(o,l,c){l.exports=o("stream")},{stream:void 0}],17:[function(o,l,c){var f=o("./DataReader");function d(n){f.call(this,n);for(var m=0;m<this.data.length;m++)n[m]=255&n[m]}o("../utils").inherits(d,f),d.prototype.byteAt=function(n){return this.data[this.zero+n]},d.prototype.lastIndexOfSignature=function(n){for(var m=n.charCodeAt(0),v=n.charCodeAt(1),w=n.charCodeAt(2),A=n.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===m&&this.data[b+1]===v&&this.data[b+2]===w&&this.data[b+3]===A)return b-this.zero;return-1},d.prototype.readAndCheckSignature=function(n){var m=n.charCodeAt(0),v=n.charCodeAt(1),w=n.charCodeAt(2),A=n.charCodeAt(3),b=this.readData(4);return m===b[0]&&v===b[1]&&w===b[2]&&A===b[3]},d.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var m=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,m},l.exports=d},{"../utils":32,"./DataReader":18}],18:[function(o,l,c){var f=o("../utils");function d(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}d.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(){},readInt:function(n){var m,v=0;for(this.checkOffset(n),m=this.index+n-1;m>=this.index;m--)v=(v<<8)+this.byteAt(m);return this.index+=n,v},readString:function(n){return f.transformTo("string",this.readData(n))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},l.exports=d},{"../utils":32}],19:[function(o,l,c){var f=o("./Uint8ArrayReader");function d(n){f.call(this,n)}o("../utils").inherits(d,f),d.prototype.readData=function(n){this.checkOffset(n);var m=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,m},l.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(o,l,c){var f=o("./DataReader");function d(n){f.call(this,n)}o("../utils").inherits(d,f),d.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},d.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},d.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},d.prototype.readData=function(n){this.checkOffset(n);var m=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,m},l.exports=d},{"../utils":32,"./DataReader":18}],21:[function(o,l,c){var f=o("./ArrayReader");function d(n){f.call(this,n)}o("../utils").inherits(d,f),d.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var m=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,m},l.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(o,l,c){var f=o("../utils"),d=o("../support"),n=o("./ArrayReader"),m=o("./StringReader"),v=o("./NodeBufferReader"),w=o("./Uint8ArrayReader");l.exports=function(A){var b=f.getTypeOf(A);return f.checkSupport(b),b!=="string"||d.uint8array?b==="nodebuffer"?new v(A):d.uint8array?new w(f.transformTo("uint8array",A)):new n(f.transformTo("array",A)):new m(A)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(o,l,c){c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(o,l,c){var f=o("./GenericWorker"),d=o("../utils");function n(m){f.call(this,"ConvertWorker to "+m),this.destType=m}d.inherits(n,f),n.prototype.processChunk=function(m){this.push({data:d.transformTo(this.destType,m.data),meta:m.meta})},l.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(o,l,c){var f=o("./GenericWorker"),d=o("../crc32");function n(){f.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o("../utils").inherits(n,f),n.prototype.processChunk=function(m){this.streamInfo.crc32=d(m.data,this.streamInfo.crc32||0),this.push(m)},l.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(o,l,c){var f=o("../utils"),d=o("./GenericWorker");function n(m){d.call(this,"DataLengthProbe for "+m),this.propName=m,this.withStreamInfo(m,0)}f.inherits(n,d),n.prototype.processChunk=function(m){if(m){var v=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=v+m.data.length}d.prototype.processChunk.call(this,m)},l.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(o,l,c){var f=o("../utils"),d=o("./GenericWorker");function n(m){d.call(this,"DataWorker");var v=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,m.then(function(w){v.dataIsReady=!0,v.data=w,v.max=w&&w.length||0,v.type=f.getTypeOf(w),v.isPaused||v._tickAndRepeat()},function(w){v.error(w)})}f.inherits(n,d),n.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,f.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(f.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var m=null,v=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":m=this.data.substring(this.index,v);break;case"uint8array":m=this.data.subarray(this.index,v);break;case"array":case"nodebuffer":m=this.data.slice(this.index,v)}return this.index=v,this.push({data:m,meta:{percent:this.max?this.index/this.max*100:0}})},l.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(o,l,c){function f(d){this.name=d||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}f.prototype={push:function(d){this.emit("data",d)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(d){this.emit("error",d)}return!0},error:function(d){return!this.isFinished&&(this.isPaused?this.generatedError=d:(this.isFinished=!0,this.emit("error",d),this.previous&&this.previous.error(d),this.cleanUp()),!0)},on:function(d,n){return this._listeners[d].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(d,n){if(this._listeners[d])for(var m=0;m<this._listeners[d].length;m++)this._listeners[d][m].call(this,n)},pipe:function(d){return d.registerPrevious(this)},registerPrevious:function(d){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=d.streamInfo,this.mergeStreamInfo(),this.previous=d;var n=this;return d.on("data",function(m){n.processChunk(m)}),d.on("end",function(){n.end()}),d.on("error",function(m){n.error(m)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var d=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),d=!0),this.previous&&this.previous.resume(),!d},flush:function(){},processChunk:function(d){this.push(d)},withStreamInfo:function(d,n){return this.extraStreamInfo[d]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var d in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,d)&&(this.streamInfo[d]=this.extraStreamInfo[d])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var d="Worker "+this.name;return this.previous?this.previous+" -> "+d:d}},l.exports=f},{}],29:[function(o,l,c){var f=o("../utils"),d=o("./ConvertWorker"),n=o("./GenericWorker"),m=o("../base64"),v=o("../support"),w=o("../external"),A=null;if(v.nodestream)try{A=o("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(T,C){return new w.Promise(function(z,B){var O=[],W=T._internalType,q=T._outputType,Z=T._mimeType;T.on("data",function(ae,J){O.push(ae),C&&C(J)}).on("error",function(ae){O=[],B(ae)}).on("end",function(){try{var ae=function(J,he,we){switch(J){case"blob":return f.newBlob(f.transformTo("arraybuffer",he),we);case"base64":return m.encode(he);default:return f.transformTo(J,he)}}(q,function(J,he){var we,Se=0,ot=null,oe=0;for(we=0;we<he.length;we++)oe+=he[we].length;switch(J){case"string":return he.join("");case"array":return Array.prototype.concat.apply([],he);case"uint8array":for(ot=new Uint8Array(oe),we=0;we<he.length;we++)ot.set(he[we],Se),Se+=he[we].length;return ot;case"nodebuffer":return Buffer.concat(he);default:throw new Error("concat : unsupported type '"+J+"'")}}(W,O),Z);z(ae)}catch(J){B(J)}O=[]}).resume()})}function E(T,C,z){var B=C;switch(C){case"blob":case"arraybuffer":B="uint8array";break;case"base64":B="string"}try{this._internalType=B,this._outputType=C,this._mimeType=z,f.checkSupport(B),this._worker=T.pipe(new d(B)),T.lock()}catch(O){this._worker=new n("error"),this._worker.error(O)}}E.prototype={accumulate:function(T){return b(this,T)},on:function(T,C){var z=this;return T==="data"?this._worker.on(T,function(B){C.call(z,B.data,B.meta)}):this._worker.on(T,function(){f.delay(C,arguments,z)}),this},resume:function(){return f.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(T){if(f.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new A(this,{objectMode:this._outputType!=="nodebuffer"},T)}},l.exports=E},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(o,l,c){if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",c.nodebuffer=typeof Buffer<"u",c.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")c.blob=!1;else{var f=new ArrayBuffer(0);try{c.blob=new Blob([f],{type:"application/zip"}).size===0}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);d.append(f),c.blob=d.getBlob("application/zip").size===0}catch{c.blob=!1}}}try{c.nodestream=!!o("readable-stream").Readable}catch{c.nodestream=!1}},{"readable-stream":16}],31:[function(o,l,c){for(var f=o("./utils"),d=o("./support"),n=o("./nodejsUtils"),m=o("./stream/GenericWorker"),v=new Array(256),w=0;w<256;w++)v[w]=252<=w?6:248<=w?5:240<=w?4:224<=w?3:192<=w?2:1;v[254]=v[254]=1;function A(){m.call(this,"utf-8 decode"),this.leftOver=null}function b(){m.call(this,"utf-8 encode")}c.utf8encode=function(E){return d.nodebuffer?n.newBufferFrom(E,"utf-8"):function(T){var C,z,B,O,W,q=T.length,Z=0;for(O=0;O<q;O++)(64512&(z=T.charCodeAt(O)))==55296&&O+1<q&&(64512&(B=T.charCodeAt(O+1)))==56320&&(z=65536+(z-55296<<10)+(B-56320),O++),Z+=z<128?1:z<2048?2:z<65536?3:4;for(C=d.uint8array?new Uint8Array(Z):new Array(Z),O=W=0;W<Z;O++)(64512&(z=T.charCodeAt(O)))==55296&&O+1<q&&(64512&(B=T.charCodeAt(O+1)))==56320&&(z=65536+(z-55296<<10)+(B-56320),O++),z<128?C[W++]=z:(z<2048?C[W++]=192|z>>>6:(z<65536?C[W++]=224|z>>>12:(C[W++]=240|z>>>18,C[W++]=128|z>>>12&63),C[W++]=128|z>>>6&63),C[W++]=128|63&z);return C}(E)},c.utf8decode=function(E){return d.nodebuffer?f.transformTo("nodebuffer",E).toString("utf-8"):function(T){var C,z,B,O,W=T.length,q=new Array(2*W);for(C=z=0;C<W;)if((B=T[C++])<128)q[z++]=B;else if(4<(O=v[B]))q[z++]=65533,C+=O-1;else{for(B&=O===2?31:O===3?15:7;1<O&&C<W;)B=B<<6|63&T[C++],O--;1<O?q[z++]=65533:B<65536?q[z++]=B:(B-=65536,q[z++]=55296|B>>10&1023,q[z++]=56320|1023&B)}return q.length!==z&&(q.subarray?q=q.subarray(0,z):q.length=z),f.applyFromCharCode(q)}(E=f.transformTo(d.uint8array?"uint8array":"array",E))},f.inherits(A,m),A.prototype.processChunk=function(E){var T=f.transformTo(d.uint8array?"uint8array":"array",E.data);if(this.leftOver&&this.leftOver.length){if(d.uint8array){var C=T;(T=new Uint8Array(C.length+this.leftOver.length)).set(this.leftOver,0),T.set(C,this.leftOver.length)}else T=this.leftOver.concat(T);this.leftOver=null}var z=function(O,W){var q;for((W=W||O.length)>O.length&&(W=O.length),q=W-1;0<=q&&(192&O[q])==128;)q--;return q<0||q===0?W:q+v[O[q]]>W?q:W}(T),B=T;z!==T.length&&(d.uint8array?(B=T.subarray(0,z),this.leftOver=T.subarray(z,T.length)):(B=T.slice(0,z),this.leftOver=T.slice(z,T.length))),this.push({data:c.utf8decode(B),meta:E.meta})},A.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=A,f.inherits(b,m),b.prototype.processChunk=function(E){this.push({data:c.utf8encode(E.data),meta:E.meta})},c.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(o,l,c){var f=o("./support"),d=o("./base64"),n=o("./nodejsUtils"),m=o("./external");function v(C){return C}function w(C,z){for(var B=0;B<C.length;++B)z[B]=255&C.charCodeAt(B);return z}o("setimmediate"),c.newBlob=function(C,z){c.checkSupport("blob");try{return new Blob([C],{type:z})}catch{try{var B=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return B.append(C),B.getBlob(z)}catch{throw new Error("Bug : can't construct the Blob.")}}};var A={stringifyByChunk:function(C,z,B){var O=[],W=0,q=C.length;if(q<=B)return String.fromCharCode.apply(null,C);for(;W<q;)z==="array"||z==="nodebuffer"?O.push(String.fromCharCode.apply(null,C.slice(W,Math.min(W+B,q)))):O.push(String.fromCharCode.apply(null,C.subarray(W,Math.min(W+B,q)))),W+=B;return O.join("")},stringifyByChar:function(C){for(var z="",B=0;B<C.length;B++)z+=String.fromCharCode(C[B]);return z},applyCanBeUsed:{uint8array:function(){try{return f.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return f.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}}()}};function b(C){var z=65536,B=c.getTypeOf(C),O=!0;if(B==="uint8array"?O=A.applyCanBeUsed.uint8array:B==="nodebuffer"&&(O=A.applyCanBeUsed.nodebuffer),O)for(;1<z;)try{return A.stringifyByChunk(C,B,z)}catch{z=Math.floor(z/2)}return A.stringifyByChar(C)}function E(C,z){for(var B=0;B<C.length;B++)z[B]=C[B];return z}c.applyFromCharCode=b;var T={};T.string={string:v,array:function(C){return w(C,new Array(C.length))},arraybuffer:function(C){return T.string.uint8array(C).buffer},uint8array:function(C){return w(C,new Uint8Array(C.length))},nodebuffer:function(C){return w(C,n.allocBuffer(C.length))}},T.array={string:b,array:v,arraybuffer:function(C){return new Uint8Array(C).buffer},uint8array:function(C){return new Uint8Array(C)},nodebuffer:function(C){return n.newBufferFrom(C)}},T.arraybuffer={string:function(C){return b(new Uint8Array(C))},array:function(C){return E(new Uint8Array(C),new Array(C.byteLength))},arraybuffer:v,uint8array:function(C){return new Uint8Array(C)},nodebuffer:function(C){return n.newBufferFrom(new Uint8Array(C))}},T.uint8array={string:b,array:function(C){return E(C,new Array(C.length))},arraybuffer:function(C){return C.buffer},uint8array:v,nodebuffer:function(C){return n.newBufferFrom(C)}},T.nodebuffer={string:b,array:function(C){return E(C,new Array(C.length))},arraybuffer:function(C){return T.nodebuffer.uint8array(C).buffer},uint8array:function(C){return E(C,new Uint8Array(C.length))},nodebuffer:v},c.transformTo=function(C,z){if(z=z||"",!C)return z;c.checkSupport(C);var B=c.getTypeOf(z);return T[B][C](z)},c.resolve=function(C){for(var z=C.split("/"),B=[],O=0;O<z.length;O++){var W=z[O];W==="."||W===""&&O!==0&&O!==z.length-1||(W===".."?B.pop():B.push(W))}return B.join("/")},c.getTypeOf=function(C){return typeof C=="string"?"string":Object.prototype.toString.call(C)==="[object Array]"?"array":f.nodebuffer&&n.isBuffer(C)?"nodebuffer":f.uint8array&&C instanceof Uint8Array?"uint8array":f.arraybuffer&&C instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(C){if(!f[C.toLowerCase()])throw new Error(C+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(C){var z,B,O="";for(B=0;B<(C||"").length;B++)O+="\\x"+((z=C.charCodeAt(B))<16?"0":"")+z.toString(16).toUpperCase();return O},c.delay=function(C,z,B){setImmediate(function(){C.apply(B||null,z||[])})},c.inherits=function(C,z){function B(){}B.prototype=z.prototype,C.prototype=new B},c.extend=function(){var C,z,B={};for(C=0;C<arguments.length;C++)for(z in arguments[C])Object.prototype.hasOwnProperty.call(arguments[C],z)&&B[z]===void 0&&(B[z]=arguments[C][z]);return B},c.prepareContent=function(C,z,B,O,W){return m.Promise.resolve(z).then(function(q){return f.blob&&(q instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(q))!==-1)&&typeof FileReader<"u"?new m.Promise(function(Z,ae){var J=new FileReader;J.onload=function(he){Z(he.target.result)},J.onerror=function(he){ae(he.target.error)},J.readAsArrayBuffer(q)}):q}).then(function(q){var Z=c.getTypeOf(q);return Z?(Z==="arraybuffer"?q=c.transformTo("uint8array",q):Z==="string"&&(W?q=d.decode(q):B&&O!==!0&&(q=function(ae){return w(ae,f.uint8array?new Uint8Array(ae.length):new Array(ae.length))}(q))),q):m.Promise.reject(new Error("Can't read the data of '"+C+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(o,l,c){var f=o("./reader/readerFor"),d=o("./utils"),n=o("./signature"),m=o("./zipEntry"),v=o("./support");function w(A){this.files=[],this.loadOptions=A}w.prototype={checkSignature:function(A){if(!this.reader.readAndCheckSignature(A)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+d.pretty(b)+", expected "+d.pretty(A)+")")}},isSignature:function(A,b){var E=this.reader.index;this.reader.setIndex(A);var T=this.reader.readString(4)===b;return this.reader.setIndex(E),T},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var A=this.reader.readData(this.zipCommentLength),b=v.uint8array?"uint8array":"array",E=d.transformTo(b,A);this.zipComment=this.loadOptions.decodeFileName(E)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var A,b,E,T=this.zip64EndOfCentralSize-44;0<T;)A=this.reader.readInt(2),b=this.reader.readInt(4),E=this.reader.readData(b),this.zip64ExtensibleData[A]={id:A,length:b,value:E}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var A,b;for(A=0;A<this.files.length;A++)b=this.files[A],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var A;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(A=new m({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(A);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var A=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(A<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(A);var b=A;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===d.MAX_VALUE_16BITS||this.diskWithCentralDirStart===d.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===d.MAX_VALUE_16BITS||this.centralDirRecords===d.MAX_VALUE_16BITS||this.centralDirSize===d.MAX_VALUE_32BITS||this.centralDirOffset===d.MAX_VALUE_32BITS){if(this.zip64=!0,(A=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(A),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var E=this.centralDirOffset+this.centralDirSize;this.zip64&&(E+=20,E+=12+this.zip64EndOfCentralSize);var T=b-E;if(0<T)this.isSignature(b,n.CENTRAL_FILE_HEADER)||(this.reader.zero=T);else if(T<0)throw new Error("Corrupted zip: missing "+Math.abs(T)+" bytes.")},prepareReader:function(A){this.reader=f(A)},load:function(A){this.prepareReader(A),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},l.exports=w},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(o,l,c){var f=o("./reader/readerFor"),d=o("./utils"),n=o("./compressedObject"),m=o("./crc32"),v=o("./utf8"),w=o("./compressions"),A=o("./support");function b(E,T){this.options=E,this.loadOptions=T}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(E){var T,C;if(E.skip(22),this.fileNameLength=E.readInt(2),C=E.readInt(2),this.fileName=E.readData(this.fileNameLength),E.skip(C),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((T=function(z){for(var B in w)if(Object.prototype.hasOwnProperty.call(w,B)&&w[B].magic===z)return w[B];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+d.pretty(this.compressionMethod)+" unknown (inner file : "+d.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,T,E.readData(this.compressedSize))},readCentralPart:function(E){this.versionMadeBy=E.readInt(2),E.skip(2),this.bitFlag=E.readInt(2),this.compressionMethod=E.readString(2),this.date=E.readDate(),this.crc32=E.readInt(4),this.compressedSize=E.readInt(4),this.uncompressedSize=E.readInt(4);var T=E.readInt(2);if(this.extraFieldsLength=E.readInt(2),this.fileCommentLength=E.readInt(2),this.diskNumberStart=E.readInt(2),this.internalFileAttributes=E.readInt(2),this.externalFileAttributes=E.readInt(4),this.localHeaderOffset=E.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");E.skip(T),this.readExtraFields(E),this.parseZIP64ExtraField(E),this.fileComment=E.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var E=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),E==0&&(this.dosPermissions=63&this.externalFileAttributes),E==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var E=f(this.extraFields[1].value);this.uncompressedSize===d.MAX_VALUE_32BITS&&(this.uncompressedSize=E.readInt(8)),this.compressedSize===d.MAX_VALUE_32BITS&&(this.compressedSize=E.readInt(8)),this.localHeaderOffset===d.MAX_VALUE_32BITS&&(this.localHeaderOffset=E.readInt(8)),this.diskNumberStart===d.MAX_VALUE_32BITS&&(this.diskNumberStart=E.readInt(4))}},readExtraFields:function(E){var T,C,z,B=E.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});E.index+4<B;)T=E.readInt(2),C=E.readInt(2),z=E.readData(C),this.extraFields[T]={id:T,length:C,value:z};E.setIndex(B)},handleUTF8:function(){var E=A.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=v.utf8decode(this.fileName),this.fileCommentStr=v.utf8decode(this.fileComment);else{var T=this.findExtraFieldUnicodePath();if(T!==null)this.fileNameStr=T;else{var C=d.transformTo(E,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(C)}var z=this.findExtraFieldUnicodeComment();if(z!==null)this.fileCommentStr=z;else{var B=d.transformTo(E,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(B)}}},findExtraFieldUnicodePath:function(){var E=this.extraFields[28789];if(E){var T=f(E.value);return T.readInt(1)!==1||m(this.fileName)!==T.readInt(4)?null:v.utf8decode(T.readData(E.length-5))}return null},findExtraFieldUnicodeComment:function(){var E=this.extraFields[25461];if(E){var T=f(E.value);return T.readInt(1)!==1||m(this.fileComment)!==T.readInt(4)?null:v.utf8decode(T.readData(E.length-5))}return null}},l.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(o,l,c){function f(T,C,z){this.name=T,this.dir=z.dir,this.date=z.date,this.comment=z.comment,this.unixPermissions=z.unixPermissions,this.dosPermissions=z.dosPermissions,this._data=C,this._dataBinary=z.binary,this.options={compression:z.compression,compressionOptions:z.compressionOptions}}var d=o("./stream/StreamHelper"),n=o("./stream/DataWorker"),m=o("./utf8"),v=o("./compressedObject"),w=o("./stream/GenericWorker");f.prototype={internalStream:function(T){var C=null,z="string";try{if(!T)throw new Error("No output type specified.");var B=(z=T.toLowerCase())==="string"||z==="text";z!=="binarystring"&&z!=="text"||(z="string"),C=this._decompressWorker();var O=!this._dataBinary;O&&!B&&(C=C.pipe(new m.Utf8EncodeWorker)),!O&&B&&(C=C.pipe(new m.Utf8DecodeWorker))}catch(W){(C=new w("error")).error(W)}return new d(C,z,"")},async:function(T,C){return this.internalStream(T).accumulate(C)},nodeStream:function(T,C){return this.internalStream(T||"nodebuffer").toNodejsStream(C)},_compressWorker:function(T,C){if(this._data instanceof v&&this._data.compression.magic===T.magic)return this._data.getCompressedWorker();var z=this._decompressWorker();return this._dataBinary||(z=z.pipe(new m.Utf8EncodeWorker)),v.createWorkerFrom(z,T,C)},_decompressWorker:function(){return this._data instanceof v?this._data.getContentWorker():this._data instanceof w?this._data:new n(this._data)}};for(var A=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},E=0;E<A.length;E++)f.prototype[A[E]]=b;l.exports=f},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(o,l,c){(function(f){var d,n,m=f.MutationObserver||f.WebKitMutationObserver;if(m){var v=0,w=new m(T),A=f.document.createTextNode("");w.observe(A,{characterData:!0}),d=function(){A.data=v=++v%2}}else if(f.setImmediate||f.MessageChannel===void 0)d="document"in f&&"onreadystatechange"in f.document.createElement("script")?function(){var C=f.document.createElement("script");C.onreadystatechange=function(){T(),C.onreadystatechange=null,C.parentNode.removeChild(C),C=null},f.document.documentElement.appendChild(C)}:function(){setTimeout(T,0)};else{var b=new f.MessageChannel;b.port1.onmessage=T,d=function(){b.port2.postMessage(0)}}var E=[];function T(){var C,z;n=!0;for(var B=E.length;B;){for(z=E,E=[],C=-1;++C<B;)z[C]();B=E.length}n=!1}l.exports=function(C){E.push(C)!==1||n||d()}}).call(this,typeof al<"u"?al:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(o,l,c){var f=o("immediate");function d(){}var n={},m=["REJECTED"],v=["FULFILLED"],w=["PENDING"];function A(B){if(typeof B!="function")throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,B!==d&&C(this,B)}function b(B,O,W){this.promise=B,typeof O=="function"&&(this.onFulfilled=O,this.callFulfilled=this.otherCallFulfilled),typeof W=="function"&&(this.onRejected=W,this.callRejected=this.otherCallRejected)}function E(B,O,W){f(function(){var q;try{q=O(W)}catch(Z){return n.reject(B,Z)}q===B?n.reject(B,new TypeError("Cannot resolve promise with itself")):n.resolve(B,q)})}function T(B){var O=B&&B.then;if(B&&(typeof B=="object"||typeof B=="function")&&typeof O=="function")return function(){O.apply(B,arguments)}}function C(B,O){var W=!1;function q(J){W||(W=!0,n.reject(B,J))}function Z(J){W||(W=!0,n.resolve(B,J))}var ae=z(function(){O(Z,q)});ae.status==="error"&&q(ae.value)}function z(B,O){var W={};try{W.value=B(O),W.status="success"}catch(q){W.status="error",W.value=q}return W}(l.exports=A).prototype.finally=function(B){if(typeof B!="function")return this;var O=this.constructor;return this.then(function(W){return O.resolve(B()).then(function(){return W})},function(W){return O.resolve(B()).then(function(){throw W})})},A.prototype.catch=function(B){return this.then(null,B)},A.prototype.then=function(B,O){if(typeof B!="function"&&this.state===v||typeof O!="function"&&this.state===m)return this;var W=new this.constructor(d);return this.state!==w?E(W,this.state===v?B:O,this.outcome):this.queue.push(new b(W,B,O)),W},b.prototype.callFulfilled=function(B){n.resolve(this.promise,B)},b.prototype.otherCallFulfilled=function(B){E(this.promise,this.onFulfilled,B)},b.prototype.callRejected=function(B){n.reject(this.promise,B)},b.prototype.otherCallRejected=function(B){E(this.promise,this.onRejected,B)},n.resolve=function(B,O){var W=z(T,O);if(W.status==="error")return n.reject(B,W.value);var q=W.value;if(q)C(B,q);else{B.state=v,B.outcome=O;for(var Z=-1,ae=B.queue.length;++Z<ae;)B.queue[Z].callFulfilled(O)}return B},n.reject=function(B,O){B.state=m,B.outcome=O;for(var W=-1,q=B.queue.length;++W<q;)B.queue[W].callRejected(O);return B},A.resolve=function(B){return B instanceof this?B:n.resolve(new this(d),B)},A.reject=function(B){var O=new this(d);return n.reject(O,B)},A.all=function(B){var O=this;if(Object.prototype.toString.call(B)!=="[object Array]")return this.reject(new TypeError("must be an array"));var W=B.length,q=!1;if(!W)return this.resolve([]);for(var Z=new Array(W),ae=0,J=-1,he=new this(d);++J<W;)we(B[J],J);return he;function we(Se,ot){O.resolve(Se).then(function(oe){Z[ot]=oe,++ae!==W||q||(q=!0,n.resolve(he,Z))},function(oe){q||(q=!0,n.reject(he,oe))})}},A.race=function(B){var O=this;if(Object.prototype.toString.call(B)!=="[object Array]")return this.reject(new TypeError("must be an array"));var W=B.length,q=!1;if(!W)return this.resolve([]);for(var Z=-1,ae=new this(d);++Z<W;)J=B[Z],O.resolve(J).then(function(he){q||(q=!0,n.resolve(ae,he))},function(he){q||(q=!0,n.reject(ae,he))});var J;return ae}},{immediate:36}],38:[function(o,l,c){var f={};(0,o("./lib/utils/common").assign)(f,o("./lib/deflate"),o("./lib/inflate"),o("./lib/zlib/constants")),l.exports=f},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(o,l,c){var f=o("./zlib/deflate"),d=o("./utils/common"),n=o("./utils/strings"),m=o("./zlib/messages"),v=o("./zlib/zstream"),w=Object.prototype.toString,A=0,b=-1,E=0,T=8;function C(B){if(!(this instanceof C))return new C(B);this.options=d.assign({level:b,method:T,chunkSize:16384,windowBits:15,memLevel:8,strategy:E,to:""},B||{});var O=this.options;O.raw&&0<O.windowBits?O.windowBits=-O.windowBits:O.gzip&&0<O.windowBits&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var W=f.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(W!==A)throw new Error(m[W]);if(O.header&&f.deflateSetHeader(this.strm,O.header),O.dictionary){var q;if(q=typeof O.dictionary=="string"?n.string2buf(O.dictionary):w.call(O.dictionary)==="[object ArrayBuffer]"?new Uint8Array(O.dictionary):O.dictionary,(W=f.deflateSetDictionary(this.strm,q))!==A)throw new Error(m[W]);this._dict_set=!0}}function z(B,O){var W=new C(O);if(W.push(B,!0),W.err)throw W.msg||m[W.err];return W.result}C.prototype.push=function(B,O){var W,q,Z=this.strm,ae=this.options.chunkSize;if(this.ended)return!1;q=O===~~O?O:O===!0?4:0,typeof B=="string"?Z.input=n.string2buf(B):w.call(B)==="[object ArrayBuffer]"?Z.input=new Uint8Array(B):Z.input=B,Z.next_in=0,Z.avail_in=Z.input.length;do{if(Z.avail_out===0&&(Z.output=new d.Buf8(ae),Z.next_out=0,Z.avail_out=ae),(W=f.deflate(Z,q))!==1&&W!==A)return this.onEnd(W),!(this.ended=!0);Z.avail_out!==0&&(Z.avail_in!==0||q!==4&&q!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(d.shrinkBuf(Z.output,Z.next_out))):this.onData(d.shrinkBuf(Z.output,Z.next_out)))}while((0<Z.avail_in||Z.avail_out===0)&&W!==1);return q===4?(W=f.deflateEnd(this.strm),this.onEnd(W),this.ended=!0,W===A):q!==2||(this.onEnd(A),!(Z.avail_out=0))},C.prototype.onData=function(B){this.chunks.push(B)},C.prototype.onEnd=function(B){B===A&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.msg=this.strm.msg},c.Deflate=C,c.deflate=z,c.deflateRaw=function(B,O){return(O=O||{}).raw=!0,z(B,O)},c.gzip=function(B,O){return(O=O||{}).gzip=!0,z(B,O)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(o,l,c){var f=o("./zlib/inflate"),d=o("./utils/common"),n=o("./utils/strings"),m=o("./zlib/constants"),v=o("./zlib/messages"),w=o("./zlib/zstream"),A=o("./zlib/gzheader"),b=Object.prototype.toString;function E(C){if(!(this instanceof E))return new E(C);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},C||{});var z=this.options;z.raw&&0<=z.windowBits&&z.windowBits<16&&(z.windowBits=-z.windowBits,z.windowBits===0&&(z.windowBits=-15)),!(0<=z.windowBits&&z.windowBits<16)||C&&C.windowBits||(z.windowBits+=32),15<z.windowBits&&z.windowBits<48&&!(15&z.windowBits)&&(z.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;var B=f.inflateInit2(this.strm,z.windowBits);if(B!==m.Z_OK)throw new Error(v[B]);this.header=new A,f.inflateGetHeader(this.strm,this.header)}function T(C,z){var B=new E(z);if(B.push(C,!0),B.err)throw B.msg||v[B.err];return B.result}E.prototype.push=function(C,z){var B,O,W,q,Z,ae,J=this.strm,he=this.options.chunkSize,we=this.options.dictionary,Se=!1;if(this.ended)return!1;O=z===~~z?z:z===!0?m.Z_FINISH:m.Z_NO_FLUSH,typeof C=="string"?J.input=n.binstring2buf(C):b.call(C)==="[object ArrayBuffer]"?J.input=new Uint8Array(C):J.input=C,J.next_in=0,J.avail_in=J.input.length;do{if(J.avail_out===0&&(J.output=new d.Buf8(he),J.next_out=0,J.avail_out=he),(B=f.inflate(J,m.Z_NO_FLUSH))===m.Z_NEED_DICT&&we&&(ae=typeof we=="string"?n.string2buf(we):b.call(we)==="[object ArrayBuffer]"?new Uint8Array(we):we,B=f.inflateSetDictionary(this.strm,ae)),B===m.Z_BUF_ERROR&&Se===!0&&(B=m.Z_OK,Se=!1),B!==m.Z_STREAM_END&&B!==m.Z_OK)return this.onEnd(B),!(this.ended=!0);J.next_out&&(J.avail_out!==0&&B!==m.Z_STREAM_END&&(J.avail_in!==0||O!==m.Z_FINISH&&O!==m.Z_SYNC_FLUSH)||(this.options.to==="string"?(W=n.utf8border(J.output,J.next_out),q=J.next_out-W,Z=n.buf2string(J.output,W),J.next_out=q,J.avail_out=he-q,q&&d.arraySet(J.output,J.output,W,q,0),this.onData(Z)):this.onData(d.shrinkBuf(J.output,J.next_out)))),J.avail_in===0&&J.avail_out===0&&(Se=!0)}while((0<J.avail_in||J.avail_out===0)&&B!==m.Z_STREAM_END);return B===m.Z_STREAM_END&&(O=m.Z_FINISH),O===m.Z_FINISH?(B=f.inflateEnd(this.strm),this.onEnd(B),this.ended=!0,B===m.Z_OK):O!==m.Z_SYNC_FLUSH||(this.onEnd(m.Z_OK),!(J.avail_out=0))},E.prototype.onData=function(C){this.chunks.push(C)},E.prototype.onEnd=function(C){C===m.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},c.Inflate=E,c.inflate=T,c.inflateRaw=function(C,z){return(z=z||{}).raw=!0,T(C,z)},c.ungzip=T},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(o,l,c){var f=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";c.assign=function(m){for(var v=Array.prototype.slice.call(arguments,1);v.length;){var w=v.shift();if(w){if(typeof w!="object")throw new TypeError(w+"must be non-object");for(var A in w)w.hasOwnProperty(A)&&(m[A]=w[A])}}return m},c.shrinkBuf=function(m,v){return m.length===v?m:m.subarray?m.subarray(0,v):(m.length=v,m)};var d={arraySet:function(m,v,w,A,b){if(v.subarray&&m.subarray)m.set(v.subarray(w,w+A),b);else for(var E=0;E<A;E++)m[b+E]=v[w+E]},flattenChunks:function(m){var v,w,A,b,E,T;for(v=A=0,w=m.length;v<w;v++)A+=m[v].length;for(T=new Uint8Array(A),v=b=0,w=m.length;v<w;v++)E=m[v],T.set(E,b),b+=E.length;return T}},n={arraySet:function(m,v,w,A,b){for(var E=0;E<A;E++)m[b+E]=v[w+E]},flattenChunks:function(m){return[].concat.apply([],m)}};c.setTyped=function(m){m?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,d)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,n))},c.setTyped(f)},{}],42:[function(o,l,c){var f=o("./common"),d=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{d=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var m=new f.Buf8(256),v=0;v<256;v++)m[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;function w(A,b){if(b<65537&&(A.subarray&&n||!A.subarray&&d))return String.fromCharCode.apply(null,f.shrinkBuf(A,b));for(var E="",T=0;T<b;T++)E+=String.fromCharCode(A[T]);return E}m[254]=m[254]=1,c.string2buf=function(A){var b,E,T,C,z,B=A.length,O=0;for(C=0;C<B;C++)(64512&(E=A.charCodeAt(C)))==55296&&C+1<B&&(64512&(T=A.charCodeAt(C+1)))==56320&&(E=65536+(E-55296<<10)+(T-56320),C++),O+=E<128?1:E<2048?2:E<65536?3:4;for(b=new f.Buf8(O),C=z=0;z<O;C++)(64512&(E=A.charCodeAt(C)))==55296&&C+1<B&&(64512&(T=A.charCodeAt(C+1)))==56320&&(E=65536+(E-55296<<10)+(T-56320),C++),E<128?b[z++]=E:(E<2048?b[z++]=192|E>>>6:(E<65536?b[z++]=224|E>>>12:(b[z++]=240|E>>>18,b[z++]=128|E>>>12&63),b[z++]=128|E>>>6&63),b[z++]=128|63&E);return b},c.buf2binstring=function(A){return w(A,A.length)},c.binstring2buf=function(A){for(var b=new f.Buf8(A.length),E=0,T=b.length;E<T;E++)b[E]=A.charCodeAt(E);return b},c.buf2string=function(A,b){var E,T,C,z,B=b||A.length,O=new Array(2*B);for(E=T=0;E<B;)if((C=A[E++])<128)O[T++]=C;else if(4<(z=m[C]))O[T++]=65533,E+=z-1;else{for(C&=z===2?31:z===3?15:7;1<z&&E<B;)C=C<<6|63&A[E++],z--;1<z?O[T++]=65533:C<65536?O[T++]=C:(C-=65536,O[T++]=55296|C>>10&1023,O[T++]=56320|1023&C)}return w(O,T)},c.utf8border=function(A,b){var E;for((b=b||A.length)>A.length&&(b=A.length),E=b-1;0<=E&&(192&A[E])==128;)E--;return E<0||E===0?b:E+m[A[E]]>b?E:b}},{"./common":41}],43:[function(o,l,c){l.exports=function(f,d,n,m){for(var v=65535&f|0,w=f>>>16&65535|0,A=0;n!==0;){for(n-=A=2e3<n?2e3:n;w=w+(v=v+d[m++]|0)|0,--A;);v%=65521,w%=65521}return v|w<<16|0}},{}],44:[function(o,l,c){l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(o,l,c){var f=function(){for(var d,n=[],m=0;m<256;m++){d=m;for(var v=0;v<8;v++)d=1&d?3988292384^d>>>1:d>>>1;n[m]=d}return n}();l.exports=function(d,n,m,v){var w=f,A=v+m;d^=-1;for(var b=v;b<A;b++)d=d>>>8^w[255&(d^n[b])];return-1^d}},{}],46:[function(o,l,c){var f,d=o("../utils/common"),n=o("./trees"),m=o("./adler32"),v=o("./crc32"),w=o("./messages"),A=0,b=4,E=0,T=-2,C=-1,z=4,B=2,O=8,W=9,q=286,Z=30,ae=19,J=2*q+1,he=15,we=3,Se=258,ot=Se+we+1,oe=42,Ve=113,K=1,Ke=2,ht=3,ct=4;function Zt(j,nt){return j.msg=w[nt],nt}function Qe(j){return(j<<1)-(4<j?9:0)}function Ut(j){for(var nt=j.length;0<=--nt;)j[nt]=0}function je(j){var nt=j.state,Je=nt.pending;Je>j.avail_out&&(Je=j.avail_out),Je!==0&&(d.arraySet(j.output,nt.pending_buf,nt.pending_out,Je,j.next_out),j.next_out+=Je,nt.pending_out+=Je,j.total_out+=Je,j.avail_out-=Je,nt.pending-=Je,nt.pending===0&&(nt.pending_out=0))}function Oe(j,nt){n._tr_flush_block(j,0<=j.block_start?j.block_start:-1,j.strstart-j.block_start,nt),j.block_start=j.strstart,je(j.strm)}function Vt(j,nt){j.pending_buf[j.pending++]=nt}function Et(j,nt){j.pending_buf[j.pending++]=nt>>>8&255,j.pending_buf[j.pending++]=255&nt}function mt(j,nt){var Je,me,ce=j.max_chain_length,xe=j.strstart,rt=j.prev_length,at=j.nice_match,Ue=j.strstart>j.w_size-ot?j.strstart-(j.w_size-ot):0,_t=j.window,Mt=j.w_mask,gt=j.prev,Xt=j.strstart+Se,xi=_t[xe+rt-1],Me=_t[xe+rt];j.prev_length>=j.good_match&&(ce>>=2),at>j.lookahead&&(at=j.lookahead);do if(_t[(Je=nt)+rt]===Me&&_t[Je+rt-1]===xi&&_t[Je]===_t[xe]&&_t[++Je]===_t[xe+1]){xe+=2,Je++;do;while(_t[++xe]===_t[++Je]&&_t[++xe]===_t[++Je]&&_t[++xe]===_t[++Je]&&_t[++xe]===_t[++Je]&&_t[++xe]===_t[++Je]&&_t[++xe]===_t[++Je]&&_t[++xe]===_t[++Je]&&_t[++xe]===_t[++Je]&&xe<Xt);if(me=Se-(Xt-xe),xe=Xt-Se,rt<me){if(j.match_start=nt,at<=(rt=me))break;xi=_t[xe+rt-1],Me=_t[xe+rt]}}while((nt=gt[nt&Mt])>Ue&&--ce!=0);return rt<=j.lookahead?rt:j.lookahead}function bi(j){var nt,Je,me,ce,xe,rt,at,Ue,_t,Mt,gt=j.w_size;do{if(ce=j.window_size-j.lookahead-j.strstart,j.strstart>=gt+(gt-ot)){for(d.arraySet(j.window,j.window,gt,gt,0),j.match_start-=gt,j.strstart-=gt,j.block_start-=gt,nt=Je=j.hash_size;me=j.head[--nt],j.head[nt]=gt<=me?me-gt:0,--Je;);for(nt=Je=gt;me=j.prev[--nt],j.prev[nt]=gt<=me?me-gt:0,--Je;);ce+=gt}if(j.strm.avail_in===0)break;if(rt=j.strm,at=j.window,Ue=j.strstart+j.lookahead,_t=ce,Mt=void 0,Mt=rt.avail_in,_t<Mt&&(Mt=_t),Je=Mt===0?0:(rt.avail_in-=Mt,d.arraySet(at,rt.input,rt.next_in,Mt,Ue),rt.state.wrap===1?rt.adler=m(rt.adler,at,Mt,Ue):rt.state.wrap===2&&(rt.adler=v(rt.adler,at,Mt,Ue)),rt.next_in+=Mt,rt.total_in+=Mt,Mt),j.lookahead+=Je,j.lookahead+j.insert>=we)for(xe=j.strstart-j.insert,j.ins_h=j.window[xe],j.ins_h=(j.ins_h<<j.hash_shift^j.window[xe+1])&j.hash_mask;j.insert&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[xe+we-1])&j.hash_mask,j.prev[xe&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=xe,xe++,j.insert--,!(j.lookahead+j.insert<we)););}while(j.lookahead<ot&&j.strm.avail_in!==0)}function zi(j,nt){for(var Je,me;;){if(j.lookahead<ot){if(bi(j),j.lookahead<ot&&nt===A)return K;if(j.lookahead===0)break}if(Je=0,j.lookahead>=we&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+we-1])&j.hash_mask,Je=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),Je!==0&&j.strstart-Je<=j.w_size-ot&&(j.match_length=mt(j,Je)),j.match_length>=we)if(me=n._tr_tally(j,j.strstart-j.match_start,j.match_length-we),j.lookahead-=j.match_length,j.match_length<=j.max_lazy_match&&j.lookahead>=we){for(j.match_length--;j.strstart++,j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+we-1])&j.hash_mask,Je=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart,--j.match_length!=0;);j.strstart++}else j.strstart+=j.match_length,j.match_length=0,j.ins_h=j.window[j.strstart],j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+1])&j.hash_mask;else me=n._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++;if(me&&(Oe(j,!1),j.strm.avail_out===0))return K}return j.insert=j.strstart<we-1?j.strstart:we-1,nt===b?(Oe(j,!0),j.strm.avail_out===0?ht:ct):j.last_lit&&(Oe(j,!1),j.strm.avail_out===0)?K:Ke}function si(j,nt){for(var Je,me,ce;;){if(j.lookahead<ot){if(bi(j),j.lookahead<ot&&nt===A)return K;if(j.lookahead===0)break}if(Je=0,j.lookahead>=we&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+we-1])&j.hash_mask,Je=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),j.prev_length=j.match_length,j.prev_match=j.match_start,j.match_length=we-1,Je!==0&&j.prev_length<j.max_lazy_match&&j.strstart-Je<=j.w_size-ot&&(j.match_length=mt(j,Je),j.match_length<=5&&(j.strategy===1||j.match_length===we&&4096<j.strstart-j.match_start)&&(j.match_length=we-1)),j.prev_length>=we&&j.match_length<=j.prev_length){for(ce=j.strstart+j.lookahead-we,me=n._tr_tally(j,j.strstart-1-j.prev_match,j.prev_length-we),j.lookahead-=j.prev_length-1,j.prev_length-=2;++j.strstart<=ce&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+we-1])&j.hash_mask,Je=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),--j.prev_length!=0;);if(j.match_available=0,j.match_length=we-1,j.strstart++,me&&(Oe(j,!1),j.strm.avail_out===0))return K}else if(j.match_available){if((me=n._tr_tally(j,0,j.window[j.strstart-1]))&&Oe(j,!1),j.strstart++,j.lookahead--,j.strm.avail_out===0)return K}else j.match_available=1,j.strstart++,j.lookahead--}return j.match_available&&(me=n._tr_tally(j,0,j.window[j.strstart-1]),j.match_available=0),j.insert=j.strstart<we-1?j.strstart:we-1,nt===b?(Oe(j,!0),j.strm.avail_out===0?ht:ct):j.last_lit&&(Oe(j,!1),j.strm.avail_out===0)?K:Ke}function et(j,nt,Je,me,ce){this.good_length=j,this.max_lazy=nt,this.nice_length=Je,this.max_chain=me,this.func=ce}function oi(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=O,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*J),this.dyn_dtree=new d.Buf16(2*(2*Z+1)),this.bl_tree=new d.Buf16(2*(2*ae+1)),Ut(this.dyn_ltree),Ut(this.dyn_dtree),Ut(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16(he+1),this.heap=new d.Buf16(2*q+1),Ut(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*q+1),Ut(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function mi(j){var nt;return j&&j.state?(j.total_in=j.total_out=0,j.data_type=B,(nt=j.state).pending=0,nt.pending_out=0,nt.wrap<0&&(nt.wrap=-nt.wrap),nt.status=nt.wrap?oe:Ve,j.adler=nt.wrap===2?0:1,nt.last_flush=A,n._tr_init(nt),E):Zt(j,T)}function tn(j){var nt=mi(j);return nt===E&&function(Je){Je.window_size=2*Je.w_size,Ut(Je.head),Je.max_lazy_match=f[Je.level].max_lazy,Je.good_match=f[Je.level].good_length,Je.nice_match=f[Je.level].nice_length,Je.max_chain_length=f[Je.level].max_chain,Je.strstart=0,Je.block_start=0,Je.lookahead=0,Je.insert=0,Je.match_length=Je.prev_length=we-1,Je.match_available=0,Je.ins_h=0}(j.state),nt}function Hi(j,nt,Je,me,ce,xe){if(!j)return T;var rt=1;if(nt===C&&(nt=6),me<0?(rt=0,me=-me):15<me&&(rt=2,me-=16),ce<1||W<ce||Je!==O||me<8||15<me||nt<0||9<nt||xe<0||z<xe)return Zt(j,T);me===8&&(me=9);var at=new oi;return(j.state=at).strm=j,at.wrap=rt,at.gzhead=null,at.w_bits=me,at.w_size=1<<at.w_bits,at.w_mask=at.w_size-1,at.hash_bits=ce+7,at.hash_size=1<<at.hash_bits,at.hash_mask=at.hash_size-1,at.hash_shift=~~((at.hash_bits+we-1)/we),at.window=new d.Buf8(2*at.w_size),at.head=new d.Buf16(at.hash_size),at.prev=new d.Buf16(at.w_size),at.lit_bufsize=1<<ce+6,at.pending_buf_size=4*at.lit_bufsize,at.pending_buf=new d.Buf8(at.pending_buf_size),at.d_buf=1*at.lit_bufsize,at.l_buf=3*at.lit_bufsize,at.level=nt,at.strategy=xe,at.method=Je,tn(j)}f=[new et(0,0,0,0,function(j,nt){var Je=65535;for(Je>j.pending_buf_size-5&&(Je=j.pending_buf_size-5);;){if(j.lookahead<=1){if(bi(j),j.lookahead===0&&nt===A)return K;if(j.lookahead===0)break}j.strstart+=j.lookahead,j.lookahead=0;var me=j.block_start+Je;if((j.strstart===0||j.strstart>=me)&&(j.lookahead=j.strstart-me,j.strstart=me,Oe(j,!1),j.strm.avail_out===0)||j.strstart-j.block_start>=j.w_size-ot&&(Oe(j,!1),j.strm.avail_out===0))return K}return j.insert=0,nt===b?(Oe(j,!0),j.strm.avail_out===0?ht:ct):(j.strstart>j.block_start&&(Oe(j,!1),j.strm.avail_out),K)}),new et(4,4,8,4,zi),new et(4,5,16,8,zi),new et(4,6,32,32,zi),new et(4,4,16,16,si),new et(8,16,32,32,si),new et(8,16,128,128,si),new et(8,32,128,256,si),new et(32,128,258,1024,si),new et(32,258,258,4096,si)],c.deflateInit=function(j,nt){return Hi(j,nt,O,15,8,0)},c.deflateInit2=Hi,c.deflateReset=tn,c.deflateResetKeep=mi,c.deflateSetHeader=function(j,nt){return j&&j.state?j.state.wrap!==2?T:(j.state.gzhead=nt,E):T},c.deflate=function(j,nt){var Je,me,ce,xe;if(!j||!j.state||5<nt||nt<0)return j?Zt(j,T):T;if(me=j.state,!j.output||!j.input&&j.avail_in!==0||me.status===666&&nt!==b)return Zt(j,j.avail_out===0?-5:T);if(me.strm=j,Je=me.last_flush,me.last_flush=nt,me.status===oe)if(me.wrap===2)j.adler=0,Vt(me,31),Vt(me,139),Vt(me,8),me.gzhead?(Vt(me,(me.gzhead.text?1:0)+(me.gzhead.hcrc?2:0)+(me.gzhead.extra?4:0)+(me.gzhead.name?8:0)+(me.gzhead.comment?16:0)),Vt(me,255&me.gzhead.time),Vt(me,me.gzhead.time>>8&255),Vt(me,me.gzhead.time>>16&255),Vt(me,me.gzhead.time>>24&255),Vt(me,me.level===9?2:2<=me.strategy||me.level<2?4:0),Vt(me,255&me.gzhead.os),me.gzhead.extra&&me.gzhead.extra.length&&(Vt(me,255&me.gzhead.extra.length),Vt(me,me.gzhead.extra.length>>8&255)),me.gzhead.hcrc&&(j.adler=v(j.adler,me.pending_buf,me.pending,0)),me.gzindex=0,me.status=69):(Vt(me,0),Vt(me,0),Vt(me,0),Vt(me,0),Vt(me,0),Vt(me,me.level===9?2:2<=me.strategy||me.level<2?4:0),Vt(me,3),me.status=Ve);else{var rt=O+(me.w_bits-8<<4)<<8;rt|=(2<=me.strategy||me.level<2?0:me.level<6?1:me.level===6?2:3)<<6,me.strstart!==0&&(rt|=32),rt+=31-rt%31,me.status=Ve,Et(me,rt),me.strstart!==0&&(Et(me,j.adler>>>16),Et(me,65535&j.adler)),j.adler=1}if(me.status===69)if(me.gzhead.extra){for(ce=me.pending;me.gzindex<(65535&me.gzhead.extra.length)&&(me.pending!==me.pending_buf_size||(me.gzhead.hcrc&&me.pending>ce&&(j.adler=v(j.adler,me.pending_buf,me.pending-ce,ce)),je(j),ce=me.pending,me.pending!==me.pending_buf_size));)Vt(me,255&me.gzhead.extra[me.gzindex]),me.gzindex++;me.gzhead.hcrc&&me.pending>ce&&(j.adler=v(j.adler,me.pending_buf,me.pending-ce,ce)),me.gzindex===me.gzhead.extra.length&&(me.gzindex=0,me.status=73)}else me.status=73;if(me.status===73)if(me.gzhead.name){ce=me.pending;do{if(me.pending===me.pending_buf_size&&(me.gzhead.hcrc&&me.pending>ce&&(j.adler=v(j.adler,me.pending_buf,me.pending-ce,ce)),je(j),ce=me.pending,me.pending===me.pending_buf_size)){xe=1;break}xe=me.gzindex<me.gzhead.name.length?255&me.gzhead.name.charCodeAt(me.gzindex++):0,Vt(me,xe)}while(xe!==0);me.gzhead.hcrc&&me.pending>ce&&(j.adler=v(j.adler,me.pending_buf,me.pending-ce,ce)),xe===0&&(me.gzindex=0,me.status=91)}else me.status=91;if(me.status===91)if(me.gzhead.comment){ce=me.pending;do{if(me.pending===me.pending_buf_size&&(me.gzhead.hcrc&&me.pending>ce&&(j.adler=v(j.adler,me.pending_buf,me.pending-ce,ce)),je(j),ce=me.pending,me.pending===me.pending_buf_size)){xe=1;break}xe=me.gzindex<me.gzhead.comment.length?255&me.gzhead.comment.charCodeAt(me.gzindex++):0,Vt(me,xe)}while(xe!==0);me.gzhead.hcrc&&me.pending>ce&&(j.adler=v(j.adler,me.pending_buf,me.pending-ce,ce)),xe===0&&(me.status=103)}else me.status=103;if(me.status===103&&(me.gzhead.hcrc?(me.pending+2>me.pending_buf_size&&je(j),me.pending+2<=me.pending_buf_size&&(Vt(me,255&j.adler),Vt(me,j.adler>>8&255),j.adler=0,me.status=Ve)):me.status=Ve),me.pending!==0){if(je(j),j.avail_out===0)return me.last_flush=-1,E}else if(j.avail_in===0&&Qe(nt)<=Qe(Je)&&nt!==b)return Zt(j,-5);if(me.status===666&&j.avail_in!==0)return Zt(j,-5);if(j.avail_in!==0||me.lookahead!==0||nt!==A&&me.status!==666){var at=me.strategy===2?function(Ue,_t){for(var Mt;;){if(Ue.lookahead===0&&(bi(Ue),Ue.lookahead===0)){if(_t===A)return K;break}if(Ue.match_length=0,Mt=n._tr_tally(Ue,0,Ue.window[Ue.strstart]),Ue.lookahead--,Ue.strstart++,Mt&&(Oe(Ue,!1),Ue.strm.avail_out===0))return K}return Ue.insert=0,_t===b?(Oe(Ue,!0),Ue.strm.avail_out===0?ht:ct):Ue.last_lit&&(Oe(Ue,!1),Ue.strm.avail_out===0)?K:Ke}(me,nt):me.strategy===3?function(Ue,_t){for(var Mt,gt,Xt,xi,Me=Ue.window;;){if(Ue.lookahead<=Se){if(bi(Ue),Ue.lookahead<=Se&&_t===A)return K;if(Ue.lookahead===0)break}if(Ue.match_length=0,Ue.lookahead>=we&&0<Ue.strstart&&(gt=Me[Xt=Ue.strstart-1])===Me[++Xt]&&gt===Me[++Xt]&&gt===Me[++Xt]){xi=Ue.strstart+Se;do;while(gt===Me[++Xt]&&gt===Me[++Xt]&&gt===Me[++Xt]&&gt===Me[++Xt]&&gt===Me[++Xt]&&gt===Me[++Xt]&&gt===Me[++Xt]&&gt===Me[++Xt]&&Xt<xi);Ue.match_length=Se-(xi-Xt),Ue.match_length>Ue.lookahead&&(Ue.match_length=Ue.lookahead)}if(Ue.match_length>=we?(Mt=n._tr_tally(Ue,1,Ue.match_length-we),Ue.lookahead-=Ue.match_length,Ue.strstart+=Ue.match_length,Ue.match_length=0):(Mt=n._tr_tally(Ue,0,Ue.window[Ue.strstart]),Ue.lookahead--,Ue.strstart++),Mt&&(Oe(Ue,!1),Ue.strm.avail_out===0))return K}return Ue.insert=0,_t===b?(Oe(Ue,!0),Ue.strm.avail_out===0?ht:ct):Ue.last_lit&&(Oe(Ue,!1),Ue.strm.avail_out===0)?K:Ke}(me,nt):f[me.level].func(me,nt);if(at!==ht&&at!==ct||(me.status=666),at===K||at===ht)return j.avail_out===0&&(me.last_flush=-1),E;if(at===Ke&&(nt===1?n._tr_align(me):nt!==5&&(n._tr_stored_block(me,0,0,!1),nt===3&&(Ut(me.head),me.lookahead===0&&(me.strstart=0,me.block_start=0,me.insert=0))),je(j),j.avail_out===0))return me.last_flush=-1,E}return nt!==b?E:me.wrap<=0?1:(me.wrap===2?(Vt(me,255&j.adler),Vt(me,j.adler>>8&255),Vt(me,j.adler>>16&255),Vt(me,j.adler>>24&255),Vt(me,255&j.total_in),Vt(me,j.total_in>>8&255),Vt(me,j.total_in>>16&255),Vt(me,j.total_in>>24&255)):(Et(me,j.adler>>>16),Et(me,65535&j.adler)),je(j),0<me.wrap&&(me.wrap=-me.wrap),me.pending!==0?E:1)},c.deflateEnd=function(j){var nt;return j&&j.state?(nt=j.state.status)!==oe&&nt!==69&&nt!==73&&nt!==91&&nt!==103&&nt!==Ve&&nt!==666?Zt(j,T):(j.state=null,nt===Ve?Zt(j,-3):E):T},c.deflateSetDictionary=function(j,nt){var Je,me,ce,xe,rt,at,Ue,_t,Mt=nt.length;if(!j||!j.state||(xe=(Je=j.state).wrap)===2||xe===1&&Je.status!==oe||Je.lookahead)return T;for(xe===1&&(j.adler=m(j.adler,nt,Mt,0)),Je.wrap=0,Mt>=Je.w_size&&(xe===0&&(Ut(Je.head),Je.strstart=0,Je.block_start=0,Je.insert=0),_t=new d.Buf8(Je.w_size),d.arraySet(_t,nt,Mt-Je.w_size,Je.w_size,0),nt=_t,Mt=Je.w_size),rt=j.avail_in,at=j.next_in,Ue=j.input,j.avail_in=Mt,j.next_in=0,j.input=nt,bi(Je);Je.lookahead>=we;){for(me=Je.strstart,ce=Je.lookahead-(we-1);Je.ins_h=(Je.ins_h<<Je.hash_shift^Je.window[me+we-1])&Je.hash_mask,Je.prev[me&Je.w_mask]=Je.head[Je.ins_h],Je.head[Je.ins_h]=me,me++,--ce;);Je.strstart=me,Je.lookahead=we-1,bi(Je)}return Je.strstart+=Je.lookahead,Je.block_start=Je.strstart,Je.insert=Je.lookahead,Je.lookahead=0,Je.match_length=Je.prev_length=we-1,Je.match_available=0,j.next_in=at,j.input=Ue,j.avail_in=rt,Je.wrap=xe,E},c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(o,l,c){l.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(o,l,c){l.exports=function(f,d){var n,m,v,w,A,b,E,T,C,z,B,O,W,q,Z,ae,J,he,we,Se,ot,oe,Ve,K,Ke;n=f.state,m=f.next_in,K=f.input,v=m+(f.avail_in-5),w=f.next_out,Ke=f.output,A=w-(d-f.avail_out),b=w+(f.avail_out-257),E=n.dmax,T=n.wsize,C=n.whave,z=n.wnext,B=n.window,O=n.hold,W=n.bits,q=n.lencode,Z=n.distcode,ae=(1<<n.lenbits)-1,J=(1<<n.distbits)-1;e:do{W<15&&(O+=K[m++]<<W,W+=8,O+=K[m++]<<W,W+=8),he=q[O&ae];t:for(;;){if(O>>>=we=he>>>24,W-=we,(we=he>>>16&255)===0)Ke[w++]=65535&he;else{if(!(16&we)){if(!(64&we)){he=q[(65535&he)+(O&(1<<we)-1)];continue t}if(32&we){n.mode=12;break e}f.msg="invalid literal/length code",n.mode=30;break e}Se=65535&he,(we&=15)&&(W<we&&(O+=K[m++]<<W,W+=8),Se+=O&(1<<we)-1,O>>>=we,W-=we),W<15&&(O+=K[m++]<<W,W+=8,O+=K[m++]<<W,W+=8),he=Z[O&J];i:for(;;){if(O>>>=we=he>>>24,W-=we,!(16&(we=he>>>16&255))){if(!(64&we)){he=Z[(65535&he)+(O&(1<<we)-1)];continue i}f.msg="invalid distance code",n.mode=30;break e}if(ot=65535&he,W<(we&=15)&&(O+=K[m++]<<W,(W+=8)<we&&(O+=K[m++]<<W,W+=8)),E<(ot+=O&(1<<we)-1)){f.msg="invalid distance too far back",n.mode=30;break e}if(O>>>=we,W-=we,(we=w-A)<ot){if(C<(we=ot-we)&&n.sane){f.msg="invalid distance too far back",n.mode=30;break e}if(Ve=B,(oe=0)===z){if(oe+=T-we,we<Se){for(Se-=we;Ke[w++]=B[oe++],--we;);oe=w-ot,Ve=Ke}}else if(z<we){if(oe+=T+z-we,(we-=z)<Se){for(Se-=we;Ke[w++]=B[oe++],--we;);if(oe=0,z<Se){for(Se-=we=z;Ke[w++]=B[oe++],--we;);oe=w-ot,Ve=Ke}}}else if(oe+=z-we,we<Se){for(Se-=we;Ke[w++]=B[oe++],--we;);oe=w-ot,Ve=Ke}for(;2<Se;)Ke[w++]=Ve[oe++],Ke[w++]=Ve[oe++],Ke[w++]=Ve[oe++],Se-=3;Se&&(Ke[w++]=Ve[oe++],1<Se&&(Ke[w++]=Ve[oe++]))}else{for(oe=w-ot;Ke[w++]=Ke[oe++],Ke[w++]=Ke[oe++],Ke[w++]=Ke[oe++],2<(Se-=3););Se&&(Ke[w++]=Ke[oe++],1<Se&&(Ke[w++]=Ke[oe++]))}break}}break}}while(m<v&&w<b);m-=Se=W>>3,O&=(1<<(W-=Se<<3))-1,f.next_in=m,f.next_out=w,f.avail_in=m<v?v-m+5:5-(m-v),f.avail_out=w<b?b-w+257:257-(w-b),n.hold=O,n.bits=W}},{}],49:[function(o,l,c){var f=o("../utils/common"),d=o("./adler32"),n=o("./crc32"),m=o("./inffast"),v=o("./inftrees"),w=1,A=2,b=0,E=-2,T=1,C=852,z=592;function B(oe){return(oe>>>24&255)+(oe>>>8&65280)+((65280&oe)<<8)+((255&oe)<<24)}function O(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new f.Buf16(320),this.work=new f.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function W(oe){var Ve;return oe&&oe.state?(Ve=oe.state,oe.total_in=oe.total_out=Ve.total=0,oe.msg="",Ve.wrap&&(oe.adler=1&Ve.wrap),Ve.mode=T,Ve.last=0,Ve.havedict=0,Ve.dmax=32768,Ve.head=null,Ve.hold=0,Ve.bits=0,Ve.lencode=Ve.lendyn=new f.Buf32(C),Ve.distcode=Ve.distdyn=new f.Buf32(z),Ve.sane=1,Ve.back=-1,b):E}function q(oe){var Ve;return oe&&oe.state?((Ve=oe.state).wsize=0,Ve.whave=0,Ve.wnext=0,W(oe)):E}function Z(oe,Ve){var K,Ke;return oe&&oe.state?(Ke=oe.state,Ve<0?(K=0,Ve=-Ve):(K=1+(Ve>>4),Ve<48&&(Ve&=15)),Ve&&(Ve<8||15<Ve)?E:(Ke.window!==null&&Ke.wbits!==Ve&&(Ke.window=null),Ke.wrap=K,Ke.wbits=Ve,q(oe))):E}function ae(oe,Ve){var K,Ke;return oe?(Ke=new O,(oe.state=Ke).window=null,(K=Z(oe,Ve))!==b&&(oe.state=null),K):E}var J,he,we=!0;function Se(oe){if(we){var Ve;for(J=new f.Buf32(512),he=new f.Buf32(32),Ve=0;Ve<144;)oe.lens[Ve++]=8;for(;Ve<256;)oe.lens[Ve++]=9;for(;Ve<280;)oe.lens[Ve++]=7;for(;Ve<288;)oe.lens[Ve++]=8;for(v(w,oe.lens,0,288,J,0,oe.work,{bits:9}),Ve=0;Ve<32;)oe.lens[Ve++]=5;v(A,oe.lens,0,32,he,0,oe.work,{bits:5}),we=!1}oe.lencode=J,oe.lenbits=9,oe.distcode=he,oe.distbits=5}function ot(oe,Ve,K,Ke){var ht,ct=oe.state;return ct.window===null&&(ct.wsize=1<<ct.wbits,ct.wnext=0,ct.whave=0,ct.window=new f.Buf8(ct.wsize)),Ke>=ct.wsize?(f.arraySet(ct.window,Ve,K-ct.wsize,ct.wsize,0),ct.wnext=0,ct.whave=ct.wsize):(Ke<(ht=ct.wsize-ct.wnext)&&(ht=Ke),f.arraySet(ct.window,Ve,K-Ke,ht,ct.wnext),(Ke-=ht)?(f.arraySet(ct.window,Ve,K-Ke,Ke,0),ct.wnext=Ke,ct.whave=ct.wsize):(ct.wnext+=ht,ct.wnext===ct.wsize&&(ct.wnext=0),ct.whave<ct.wsize&&(ct.whave+=ht))),0}c.inflateReset=q,c.inflateReset2=Z,c.inflateResetKeep=W,c.inflateInit=function(oe){return ae(oe,15)},c.inflateInit2=ae,c.inflate=function(oe,Ve){var K,Ke,ht,ct,Zt,Qe,Ut,je,Oe,Vt,Et,mt,bi,zi,si,et,oi,mi,tn,Hi,j,nt,Je,me,ce=0,xe=new f.Buf8(4),rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!oe||!oe.state||!oe.output||!oe.input&&oe.avail_in!==0)return E;(K=oe.state).mode===12&&(K.mode=13),Zt=oe.next_out,ht=oe.output,Ut=oe.avail_out,ct=oe.next_in,Ke=oe.input,Qe=oe.avail_in,je=K.hold,Oe=K.bits,Vt=Qe,Et=Ut,nt=b;e:for(;;)switch(K.mode){case T:if(K.wrap===0){K.mode=13;break}for(;Oe<16;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(2&K.wrap&&je===35615){xe[K.check=0]=255&je,xe[1]=je>>>8&255,K.check=n(K.check,xe,2,0),Oe=je=0,K.mode=2;break}if(K.flags=0,K.head&&(K.head.done=!1),!(1&K.wrap)||(((255&je)<<8)+(je>>8))%31){oe.msg="incorrect header check",K.mode=30;break}if((15&je)!=8){oe.msg="unknown compression method",K.mode=30;break}if(Oe-=4,j=8+(15&(je>>>=4)),K.wbits===0)K.wbits=j;else if(j>K.wbits){oe.msg="invalid window size",K.mode=30;break}K.dmax=1<<j,oe.adler=K.check=1,K.mode=512&je?10:12,Oe=je=0;break;case 2:for(;Oe<16;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(K.flags=je,(255&K.flags)!=8){oe.msg="unknown compression method",K.mode=30;break}if(57344&K.flags){oe.msg="unknown header flags set",K.mode=30;break}K.head&&(K.head.text=je>>8&1),512&K.flags&&(xe[0]=255&je,xe[1]=je>>>8&255,K.check=n(K.check,xe,2,0)),Oe=je=0,K.mode=3;case 3:for(;Oe<32;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}K.head&&(K.head.time=je),512&K.flags&&(xe[0]=255&je,xe[1]=je>>>8&255,xe[2]=je>>>16&255,xe[3]=je>>>24&255,K.check=n(K.check,xe,4,0)),Oe=je=0,K.mode=4;case 4:for(;Oe<16;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}K.head&&(K.head.xflags=255&je,K.head.os=je>>8),512&K.flags&&(xe[0]=255&je,xe[1]=je>>>8&255,K.check=n(K.check,xe,2,0)),Oe=je=0,K.mode=5;case 5:if(1024&K.flags){for(;Oe<16;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}K.length=je,K.head&&(K.head.extra_len=je),512&K.flags&&(xe[0]=255&je,xe[1]=je>>>8&255,K.check=n(K.check,xe,2,0)),Oe=je=0}else K.head&&(K.head.extra=null);K.mode=6;case 6:if(1024&K.flags&&(Qe<(mt=K.length)&&(mt=Qe),mt&&(K.head&&(j=K.head.extra_len-K.length,K.head.extra||(K.head.extra=new Array(K.head.extra_len)),f.arraySet(K.head.extra,Ke,ct,mt,j)),512&K.flags&&(K.check=n(K.check,Ke,mt,ct)),Qe-=mt,ct+=mt,K.length-=mt),K.length))break e;K.length=0,K.mode=7;case 7:if(2048&K.flags){if(Qe===0)break e;for(mt=0;j=Ke[ct+mt++],K.head&&j&&K.length<65536&&(K.head.name+=String.fromCharCode(j)),j&&mt<Qe;);if(512&K.flags&&(K.check=n(K.check,Ke,mt,ct)),Qe-=mt,ct+=mt,j)break e}else K.head&&(K.head.name=null);K.length=0,K.mode=8;case 8:if(4096&K.flags){if(Qe===0)break e;for(mt=0;j=Ke[ct+mt++],K.head&&j&&K.length<65536&&(K.head.comment+=String.fromCharCode(j)),j&&mt<Qe;);if(512&K.flags&&(K.check=n(K.check,Ke,mt,ct)),Qe-=mt,ct+=mt,j)break e}else K.head&&(K.head.comment=null);K.mode=9;case 9:if(512&K.flags){for(;Oe<16;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(je!==(65535&K.check)){oe.msg="header crc mismatch",K.mode=30;break}Oe=je=0}K.head&&(K.head.hcrc=K.flags>>9&1,K.head.done=!0),oe.adler=K.check=0,K.mode=12;break;case 10:for(;Oe<32;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}oe.adler=K.check=B(je),Oe=je=0,K.mode=11;case 11:if(K.havedict===0)return oe.next_out=Zt,oe.avail_out=Ut,oe.next_in=ct,oe.avail_in=Qe,K.hold=je,K.bits=Oe,2;oe.adler=K.check=1,K.mode=12;case 12:if(Ve===5||Ve===6)break e;case 13:if(K.last){je>>>=7&Oe,Oe-=7&Oe,K.mode=27;break}for(;Oe<3;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}switch(K.last=1&je,Oe-=1,3&(je>>>=1)){case 0:K.mode=14;break;case 1:if(Se(K),K.mode=20,Ve!==6)break;je>>>=2,Oe-=2;break e;case 2:K.mode=17;break;case 3:oe.msg="invalid block type",K.mode=30}je>>>=2,Oe-=2;break;case 14:for(je>>>=7&Oe,Oe-=7&Oe;Oe<32;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if((65535&je)!=(je>>>16^65535)){oe.msg="invalid stored block lengths",K.mode=30;break}if(K.length=65535&je,Oe=je=0,K.mode=15,Ve===6)break e;case 15:K.mode=16;case 16:if(mt=K.length){if(Qe<mt&&(mt=Qe),Ut<mt&&(mt=Ut),mt===0)break e;f.arraySet(ht,Ke,ct,mt,Zt),Qe-=mt,ct+=mt,Ut-=mt,Zt+=mt,K.length-=mt;break}K.mode=12;break;case 17:for(;Oe<14;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(K.nlen=257+(31&je),je>>>=5,Oe-=5,K.ndist=1+(31&je),je>>>=5,Oe-=5,K.ncode=4+(15&je),je>>>=4,Oe-=4,286<K.nlen||30<K.ndist){oe.msg="too many length or distance symbols",K.mode=30;break}K.have=0,K.mode=18;case 18:for(;K.have<K.ncode;){for(;Oe<3;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}K.lens[rt[K.have++]]=7&je,je>>>=3,Oe-=3}for(;K.have<19;)K.lens[rt[K.have++]]=0;if(K.lencode=K.lendyn,K.lenbits=7,Je={bits:K.lenbits},nt=v(0,K.lens,0,19,K.lencode,0,K.work,Je),K.lenbits=Je.bits,nt){oe.msg="invalid code lengths set",K.mode=30;break}K.have=0,K.mode=19;case 19:for(;K.have<K.nlen+K.ndist;){for(;et=(ce=K.lencode[je&(1<<K.lenbits)-1])>>>16&255,oi=65535&ce,!((si=ce>>>24)<=Oe);){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(oi<16)je>>>=si,Oe-=si,K.lens[K.have++]=oi;else{if(oi===16){for(me=si+2;Oe<me;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(je>>>=si,Oe-=si,K.have===0){oe.msg="invalid bit length repeat",K.mode=30;break}j=K.lens[K.have-1],mt=3+(3&je),je>>>=2,Oe-=2}else if(oi===17){for(me=si+3;Oe<me;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}Oe-=si,j=0,mt=3+(7&(je>>>=si)),je>>>=3,Oe-=3}else{for(me=si+7;Oe<me;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}Oe-=si,j=0,mt=11+(127&(je>>>=si)),je>>>=7,Oe-=7}if(K.have+mt>K.nlen+K.ndist){oe.msg="invalid bit length repeat",K.mode=30;break}for(;mt--;)K.lens[K.have++]=j}}if(K.mode===30)break;if(K.lens[256]===0){oe.msg="invalid code -- missing end-of-block",K.mode=30;break}if(K.lenbits=9,Je={bits:K.lenbits},nt=v(w,K.lens,0,K.nlen,K.lencode,0,K.work,Je),K.lenbits=Je.bits,nt){oe.msg="invalid literal/lengths set",K.mode=30;break}if(K.distbits=6,K.distcode=K.distdyn,Je={bits:K.distbits},nt=v(A,K.lens,K.nlen,K.ndist,K.distcode,0,K.work,Je),K.distbits=Je.bits,nt){oe.msg="invalid distances set",K.mode=30;break}if(K.mode=20,Ve===6)break e;case 20:K.mode=21;case 21:if(6<=Qe&&258<=Ut){oe.next_out=Zt,oe.avail_out=Ut,oe.next_in=ct,oe.avail_in=Qe,K.hold=je,K.bits=Oe,m(oe,Et),Zt=oe.next_out,ht=oe.output,Ut=oe.avail_out,ct=oe.next_in,Ke=oe.input,Qe=oe.avail_in,je=K.hold,Oe=K.bits,K.mode===12&&(K.back=-1);break}for(K.back=0;et=(ce=K.lencode[je&(1<<K.lenbits)-1])>>>16&255,oi=65535&ce,!((si=ce>>>24)<=Oe);){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(et&&!(240&et)){for(mi=si,tn=et,Hi=oi;et=(ce=K.lencode[Hi+((je&(1<<mi+tn)-1)>>mi)])>>>16&255,oi=65535&ce,!(mi+(si=ce>>>24)<=Oe);){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}je>>>=mi,Oe-=mi,K.back+=mi}if(je>>>=si,Oe-=si,K.back+=si,K.length=oi,et===0){K.mode=26;break}if(32&et){K.back=-1,K.mode=12;break}if(64&et){oe.msg="invalid literal/length code",K.mode=30;break}K.extra=15&et,K.mode=22;case 22:if(K.extra){for(me=K.extra;Oe<me;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}K.length+=je&(1<<K.extra)-1,je>>>=K.extra,Oe-=K.extra,K.back+=K.extra}K.was=K.length,K.mode=23;case 23:for(;et=(ce=K.distcode[je&(1<<K.distbits)-1])>>>16&255,oi=65535&ce,!((si=ce>>>24)<=Oe);){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(!(240&et)){for(mi=si,tn=et,Hi=oi;et=(ce=K.distcode[Hi+((je&(1<<mi+tn)-1)>>mi)])>>>16&255,oi=65535&ce,!(mi+(si=ce>>>24)<=Oe);){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}je>>>=mi,Oe-=mi,K.back+=mi}if(je>>>=si,Oe-=si,K.back+=si,64&et){oe.msg="invalid distance code",K.mode=30;break}K.offset=oi,K.extra=15&et,K.mode=24;case 24:if(K.extra){for(me=K.extra;Oe<me;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}K.offset+=je&(1<<K.extra)-1,je>>>=K.extra,Oe-=K.extra,K.back+=K.extra}if(K.offset>K.dmax){oe.msg="invalid distance too far back",K.mode=30;break}K.mode=25;case 25:if(Ut===0)break e;if(mt=Et-Ut,K.offset>mt){if((mt=K.offset-mt)>K.whave&&K.sane){oe.msg="invalid distance too far back",K.mode=30;break}bi=mt>K.wnext?(mt-=K.wnext,K.wsize-mt):K.wnext-mt,mt>K.length&&(mt=K.length),zi=K.window}else zi=ht,bi=Zt-K.offset,mt=K.length;for(Ut<mt&&(mt=Ut),Ut-=mt,K.length-=mt;ht[Zt++]=zi[bi++],--mt;);K.length===0&&(K.mode=21);break;case 26:if(Ut===0)break e;ht[Zt++]=K.length,Ut--,K.mode=21;break;case 27:if(K.wrap){for(;Oe<32;){if(Qe===0)break e;Qe--,je|=Ke[ct++]<<Oe,Oe+=8}if(Et-=Ut,oe.total_out+=Et,K.total+=Et,Et&&(oe.adler=K.check=K.flags?n(K.check,ht,Et,Zt-Et):d(K.check,ht,Et,Zt-Et)),Et=Ut,(K.flags?je:B(je))!==K.check){oe.msg="incorrect data check",K.mode=30;break}Oe=je=0}K.mode=28;case 28:if(K.wrap&&K.flags){for(;Oe<32;){if(Qe===0)break e;Qe--,je+=Ke[ct++]<<Oe,Oe+=8}if(je!==(4294967295&K.total)){oe.msg="incorrect length check",K.mode=30;break}Oe=je=0}K.mode=29;case 29:nt=1;break e;case 30:nt=-3;break e;case 31:return-4;case 32:default:return E}return oe.next_out=Zt,oe.avail_out=Ut,oe.next_in=ct,oe.avail_in=Qe,K.hold=je,K.bits=Oe,(K.wsize||Et!==oe.avail_out&&K.mode<30&&(K.mode<27||Ve!==4))&&ot(oe,oe.output,oe.next_out,Et-oe.avail_out)?(K.mode=31,-4):(Vt-=oe.avail_in,Et-=oe.avail_out,oe.total_in+=Vt,oe.total_out+=Et,K.total+=Et,K.wrap&&Et&&(oe.adler=K.check=K.flags?n(K.check,ht,Et,oe.next_out-Et):d(K.check,ht,Et,oe.next_out-Et)),oe.data_type=K.bits+(K.last?64:0)+(K.mode===12?128:0)+(K.mode===20||K.mode===15?256:0),(Vt==0&&Et===0||Ve===4)&&nt===b&&(nt=-5),nt)},c.inflateEnd=function(oe){if(!oe||!oe.state)return E;var Ve=oe.state;return Ve.window&&(Ve.window=null),oe.state=null,b},c.inflateGetHeader=function(oe,Ve){var K;return oe&&oe.state&&2&(K=oe.state).wrap?((K.head=Ve).done=!1,b):E},c.inflateSetDictionary=function(oe,Ve){var K,Ke=Ve.length;return oe&&oe.state?(K=oe.state).wrap!==0&&K.mode!==11?E:K.mode===11&&d(1,Ve,Ke,0)!==K.check?-3:ot(oe,Ve,Ke,Ke)?(K.mode=31,-4):(K.havedict=1,b):E},c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,l,c){var f=o("../utils/common"),d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],v=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(w,A,b,E,T,C,z,B){var O,W,q,Z,ae,J,he,we,Se,ot=B.bits,oe=0,Ve=0,K=0,Ke=0,ht=0,ct=0,Zt=0,Qe=0,Ut=0,je=0,Oe=null,Vt=0,Et=new f.Buf16(16),mt=new f.Buf16(16),bi=null,zi=0;for(oe=0;oe<=15;oe++)Et[oe]=0;for(Ve=0;Ve<E;Ve++)Et[A[b+Ve]]++;for(ht=ot,Ke=15;1<=Ke&&Et[Ke]===0;Ke--);if(Ke<ht&&(ht=Ke),Ke===0)return T[C++]=20971520,T[C++]=20971520,B.bits=1,0;for(K=1;K<Ke&&Et[K]===0;K++);for(ht<K&&(ht=K),oe=Qe=1;oe<=15;oe++)if(Qe<<=1,(Qe-=Et[oe])<0)return-1;if(0<Qe&&(w===0||Ke!==1))return-1;for(mt[1]=0,oe=1;oe<15;oe++)mt[oe+1]=mt[oe]+Et[oe];for(Ve=0;Ve<E;Ve++)A[b+Ve]!==0&&(z[mt[A[b+Ve]]++]=Ve);if(J=w===0?(Oe=bi=z,19):w===1?(Oe=d,Vt-=257,bi=n,zi-=257,256):(Oe=m,bi=v,-1),oe=K,ae=C,Zt=Ve=je=0,q=-1,Z=(Ut=1<<(ct=ht))-1,w===1&&852<Ut||w===2&&592<Ut)return 1;for(;;){for(he=oe-Zt,Se=z[Ve]<J?(we=0,z[Ve]):z[Ve]>J?(we=bi[zi+z[Ve]],Oe[Vt+z[Ve]]):(we=96,0),O=1<<oe-Zt,K=W=1<<ct;T[ae+(je>>Zt)+(W-=O)]=he<<24|we<<16|Se|0,W!==0;);for(O=1<<oe-1;je&O;)O>>=1;if(O!==0?(je&=O-1,je+=O):je=0,Ve++,--Et[oe]==0){if(oe===Ke)break;oe=A[b+z[Ve]]}if(ht<oe&&(je&Z)!==q){for(Zt===0&&(Zt=ht),ae+=K,Qe=1<<(ct=oe-Zt);ct+Zt<Ke&&!((Qe-=Et[ct+Zt])<=0);)ct++,Qe<<=1;if(Ut+=1<<ct,w===1&&852<Ut||w===2&&592<Ut)return 1;T[q=je&Z]=ht<<24|ct<<16|ae-C|0}}return je!==0&&(T[ae+je]=oe-Zt<<24|64<<16|0),B.bits=ht,0}},{"../utils/common":41}],51:[function(o,l,c){l.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(o,l,c){var f=o("../utils/common"),d=0,n=1;function m(ce){for(var xe=ce.length;0<=--xe;)ce[xe]=0}var v=0,w=29,A=256,b=A+1+w,E=30,T=19,C=2*b+1,z=15,B=16,O=7,W=256,q=16,Z=17,ae=18,J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],he=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],we=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ot=new Array(2*(b+2));m(ot);var oe=new Array(2*E);m(oe);var Ve=new Array(512);m(Ve);var K=new Array(256);m(K);var Ke=new Array(w);m(Ke);var ht,ct,Zt,Qe=new Array(E);function Ut(ce,xe,rt,at,Ue){this.static_tree=ce,this.extra_bits=xe,this.extra_base=rt,this.elems=at,this.max_length=Ue,this.has_stree=ce&&ce.length}function je(ce,xe){this.dyn_tree=ce,this.max_code=0,this.stat_desc=xe}function Oe(ce){return ce<256?Ve[ce]:Ve[256+(ce>>>7)]}function Vt(ce,xe){ce.pending_buf[ce.pending++]=255&xe,ce.pending_buf[ce.pending++]=xe>>>8&255}function Et(ce,xe,rt){ce.bi_valid>B-rt?(ce.bi_buf|=xe<<ce.bi_valid&65535,Vt(ce,ce.bi_buf),ce.bi_buf=xe>>B-ce.bi_valid,ce.bi_valid+=rt-B):(ce.bi_buf|=xe<<ce.bi_valid&65535,ce.bi_valid+=rt)}function mt(ce,xe,rt){Et(ce,rt[2*xe],rt[2*xe+1])}function bi(ce,xe){for(var rt=0;rt|=1&ce,ce>>>=1,rt<<=1,0<--xe;);return rt>>>1}function zi(ce,xe,rt){var at,Ue,_t=new Array(z+1),Mt=0;for(at=1;at<=z;at++)_t[at]=Mt=Mt+rt[at-1]<<1;for(Ue=0;Ue<=xe;Ue++){var gt=ce[2*Ue+1];gt!==0&&(ce[2*Ue]=bi(_t[gt]++,gt))}}function si(ce){var xe;for(xe=0;xe<b;xe++)ce.dyn_ltree[2*xe]=0;for(xe=0;xe<E;xe++)ce.dyn_dtree[2*xe]=0;for(xe=0;xe<T;xe++)ce.bl_tree[2*xe]=0;ce.dyn_ltree[2*W]=1,ce.opt_len=ce.static_len=0,ce.last_lit=ce.matches=0}function et(ce){8<ce.bi_valid?Vt(ce,ce.bi_buf):0<ce.bi_valid&&(ce.pending_buf[ce.pending++]=ce.bi_buf),ce.bi_buf=0,ce.bi_valid=0}function oi(ce,xe,rt,at){var Ue=2*xe,_t=2*rt;return ce[Ue]<ce[_t]||ce[Ue]===ce[_t]&&at[xe]<=at[rt]}function mi(ce,xe,rt){for(var at=ce.heap[rt],Ue=rt<<1;Ue<=ce.heap_len&&(Ue<ce.heap_len&&oi(xe,ce.heap[Ue+1],ce.heap[Ue],ce.depth)&&Ue++,!oi(xe,at,ce.heap[Ue],ce.depth));)ce.heap[rt]=ce.heap[Ue],rt=Ue,Ue<<=1;ce.heap[rt]=at}function tn(ce,xe,rt){var at,Ue,_t,Mt,gt=0;if(ce.last_lit!==0)for(;at=ce.pending_buf[ce.d_buf+2*gt]<<8|ce.pending_buf[ce.d_buf+2*gt+1],Ue=ce.pending_buf[ce.l_buf+gt],gt++,at===0?mt(ce,Ue,xe):(mt(ce,(_t=K[Ue])+A+1,xe),(Mt=J[_t])!==0&&Et(ce,Ue-=Ke[_t],Mt),mt(ce,_t=Oe(--at),rt),(Mt=he[_t])!==0&&Et(ce,at-=Qe[_t],Mt)),gt<ce.last_lit;);mt(ce,W,xe)}function Hi(ce,xe){var rt,at,Ue,_t=xe.dyn_tree,Mt=xe.stat_desc.static_tree,gt=xe.stat_desc.has_stree,Xt=xe.stat_desc.elems,xi=-1;for(ce.heap_len=0,ce.heap_max=C,rt=0;rt<Xt;rt++)_t[2*rt]!==0?(ce.heap[++ce.heap_len]=xi=rt,ce.depth[rt]=0):_t[2*rt+1]=0;for(;ce.heap_len<2;)_t[2*(Ue=ce.heap[++ce.heap_len]=xi<2?++xi:0)]=1,ce.depth[Ue]=0,ce.opt_len--,gt&&(ce.static_len-=Mt[2*Ue+1]);for(xe.max_code=xi,rt=ce.heap_len>>1;1<=rt;rt--)mi(ce,_t,rt);for(Ue=Xt;rt=ce.heap[1],ce.heap[1]=ce.heap[ce.heap_len--],mi(ce,_t,1),at=ce.heap[1],ce.heap[--ce.heap_max]=rt,ce.heap[--ce.heap_max]=at,_t[2*Ue]=_t[2*rt]+_t[2*at],ce.depth[Ue]=(ce.depth[rt]>=ce.depth[at]?ce.depth[rt]:ce.depth[at])+1,_t[2*rt+1]=_t[2*at+1]=Ue,ce.heap[1]=Ue++,mi(ce,_t,1),2<=ce.heap_len;);ce.heap[--ce.heap_max]=ce.heap[1],function(Me,pt){var Wn,nn,di,Ei,mn,Sn,gn=pt.dyn_tree,bt=pt.max_code,li=pt.stat_desc.static_tree,ri=pt.stat_desc.has_stree,hn=pt.stat_desc.extra_bits,ar=pt.stat_desc.extra_base,ti=pt.stat_desc.max_length,Vn=0;for(Ei=0;Ei<=z;Ei++)Me.bl_count[Ei]=0;for(gn[2*Me.heap[Me.heap_max]+1]=0,Wn=Me.heap_max+1;Wn<C;Wn++)ti<(Ei=gn[2*gn[2*(nn=Me.heap[Wn])+1]+1]+1)&&(Ei=ti,Vn++),gn[2*nn+1]=Ei,bt<nn||(Me.bl_count[Ei]++,mn=0,ar<=nn&&(mn=hn[nn-ar]),Sn=gn[2*nn],Me.opt_len+=Sn*(Ei+mn),ri&&(Me.static_len+=Sn*(li[2*nn+1]+mn)));if(Vn!==0){do{for(Ei=ti-1;Me.bl_count[Ei]===0;)Ei--;Me.bl_count[Ei]--,Me.bl_count[Ei+1]+=2,Me.bl_count[ti]--,Vn-=2}while(0<Vn);for(Ei=ti;Ei!==0;Ei--)for(nn=Me.bl_count[Ei];nn!==0;)bt<(di=Me.heap[--Wn])||(gn[2*di+1]!==Ei&&(Me.opt_len+=(Ei-gn[2*di+1])*gn[2*di],gn[2*di+1]=Ei),nn--)}}(ce,xe),zi(_t,xi,ce.bl_count)}function j(ce,xe,rt){var at,Ue,_t=-1,Mt=xe[1],gt=0,Xt=7,xi=4;for(Mt===0&&(Xt=138,xi=3),xe[2*(rt+1)+1]=65535,at=0;at<=rt;at++)Ue=Mt,Mt=xe[2*(at+1)+1],++gt<Xt&&Ue===Mt||(gt<xi?ce.bl_tree[2*Ue]+=gt:Ue!==0?(Ue!==_t&&ce.bl_tree[2*Ue]++,ce.bl_tree[2*q]++):gt<=10?ce.bl_tree[2*Z]++:ce.bl_tree[2*ae]++,_t=Ue,xi=(gt=0)===Mt?(Xt=138,3):Ue===Mt?(Xt=6,3):(Xt=7,4))}function nt(ce,xe,rt){var at,Ue,_t=-1,Mt=xe[1],gt=0,Xt=7,xi=4;for(Mt===0&&(Xt=138,xi=3),at=0;at<=rt;at++)if(Ue=Mt,Mt=xe[2*(at+1)+1],!(++gt<Xt&&Ue===Mt)){if(gt<xi)for(;mt(ce,Ue,ce.bl_tree),--gt!=0;);else Ue!==0?(Ue!==_t&&(mt(ce,Ue,ce.bl_tree),gt--),mt(ce,q,ce.bl_tree),Et(ce,gt-3,2)):gt<=10?(mt(ce,Z,ce.bl_tree),Et(ce,gt-3,3)):(mt(ce,ae,ce.bl_tree),Et(ce,gt-11,7));_t=Ue,xi=(gt=0)===Mt?(Xt=138,3):Ue===Mt?(Xt=6,3):(Xt=7,4)}}m(Qe);var Je=!1;function me(ce,xe,rt,at){Et(ce,(v<<1)+(at?1:0),3),function(Ue,_t,Mt,gt){et(Ue),gt&&(Vt(Ue,Mt),Vt(Ue,~Mt)),f.arraySet(Ue.pending_buf,Ue.window,_t,Mt,Ue.pending),Ue.pending+=Mt}(ce,xe,rt,!0)}c._tr_init=function(ce){Je||(function(){var xe,rt,at,Ue,_t,Mt=new Array(z+1);for(Ue=at=0;Ue<w-1;Ue++)for(Ke[Ue]=at,xe=0;xe<1<<J[Ue];xe++)K[at++]=Ue;for(K[at-1]=Ue,Ue=_t=0;Ue<16;Ue++)for(Qe[Ue]=_t,xe=0;xe<1<<he[Ue];xe++)Ve[_t++]=Ue;for(_t>>=7;Ue<E;Ue++)for(Qe[Ue]=_t<<7,xe=0;xe<1<<he[Ue]-7;xe++)Ve[256+_t++]=Ue;for(rt=0;rt<=z;rt++)Mt[rt]=0;for(xe=0;xe<=143;)ot[2*xe+1]=8,xe++,Mt[8]++;for(;xe<=255;)ot[2*xe+1]=9,xe++,Mt[9]++;for(;xe<=279;)ot[2*xe+1]=7,xe++,Mt[7]++;for(;xe<=287;)ot[2*xe+1]=8,xe++,Mt[8]++;for(zi(ot,b+1,Mt),xe=0;xe<E;xe++)oe[2*xe+1]=5,oe[2*xe]=bi(xe,5);ht=new Ut(ot,J,A+1,b,z),ct=new Ut(oe,he,0,E,z),Zt=new Ut(new Array(0),we,0,T,O)}(),Je=!0),ce.l_desc=new je(ce.dyn_ltree,ht),ce.d_desc=new je(ce.dyn_dtree,ct),ce.bl_desc=new je(ce.bl_tree,Zt),ce.bi_buf=0,ce.bi_valid=0,si(ce)},c._tr_stored_block=me,c._tr_flush_block=function(ce,xe,rt,at){var Ue,_t,Mt=0;0<ce.level?(ce.strm.data_type===2&&(ce.strm.data_type=function(gt){var Xt,xi=4093624447;for(Xt=0;Xt<=31;Xt++,xi>>>=1)if(1&xi&&gt.dyn_ltree[2*Xt]!==0)return d;if(gt.dyn_ltree[18]!==0||gt.dyn_ltree[20]!==0||gt.dyn_ltree[26]!==0)return n;for(Xt=32;Xt<A;Xt++)if(gt.dyn_ltree[2*Xt]!==0)return n;return d}(ce)),Hi(ce,ce.l_desc),Hi(ce,ce.d_desc),Mt=function(gt){var Xt;for(j(gt,gt.dyn_ltree,gt.l_desc.max_code),j(gt,gt.dyn_dtree,gt.d_desc.max_code),Hi(gt,gt.bl_desc),Xt=T-1;3<=Xt&&gt.bl_tree[2*Se[Xt]+1]===0;Xt--);return gt.opt_len+=3*(Xt+1)+5+5+4,Xt}(ce),Ue=ce.opt_len+3+7>>>3,(_t=ce.static_len+3+7>>>3)<=Ue&&(Ue=_t)):Ue=_t=rt+5,rt+4<=Ue&&xe!==-1?me(ce,xe,rt,at):ce.strategy===4||_t===Ue?(Et(ce,2+(at?1:0),3),tn(ce,ot,oe)):(Et(ce,4+(at?1:0),3),function(gt,Xt,xi,Me){var pt;for(Et(gt,Xt-257,5),Et(gt,xi-1,5),Et(gt,Me-4,4),pt=0;pt<Me;pt++)Et(gt,gt.bl_tree[2*Se[pt]+1],3);nt(gt,gt.dyn_ltree,Xt-1),nt(gt,gt.dyn_dtree,xi-1)}(ce,ce.l_desc.max_code+1,ce.d_desc.max_code+1,Mt+1),tn(ce,ce.dyn_ltree,ce.dyn_dtree)),si(ce),at&&et(ce)},c._tr_tally=function(ce,xe,rt){return ce.pending_buf[ce.d_buf+2*ce.last_lit]=xe>>>8&255,ce.pending_buf[ce.d_buf+2*ce.last_lit+1]=255&xe,ce.pending_buf[ce.l_buf+ce.last_lit]=255&rt,ce.last_lit++,xe===0?ce.dyn_ltree[2*rt]++:(ce.matches++,xe--,ce.dyn_ltree[2*(K[rt]+A+1)]++,ce.dyn_dtree[2*Oe(xe)]++),ce.last_lit===ce.lit_bufsize-1},c._tr_align=function(ce){Et(ce,2,3),mt(ce,W,ot),function(xe){xe.bi_valid===16?(Vt(xe,xe.bi_buf),xe.bi_buf=0,xe.bi_valid=0):8<=xe.bi_valid&&(xe.pending_buf[xe.pending++]=255&xe.bi_buf,xe.bi_buf>>=8,xe.bi_valid-=8)}(ce)}},{"../utils/common":41}],53:[function(o,l,c){l.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(o,l,c){(function(f){(function(d,n){if(!d.setImmediate){var m,v,w,A,b=1,E={},T=!1,C=d.document,z=Object.getPrototypeOf&&Object.getPrototypeOf(d);z=z&&z.setTimeout?z:d,m={}.toString.call(d.process)==="[object process]"?function(q){process.nextTick(function(){O(q)})}:function(){if(d.postMessage&&!d.importScripts){var q=!0,Z=d.onmessage;return d.onmessage=function(){q=!1},d.postMessage("","*"),d.onmessage=Z,q}}()?(A="setImmediate$"+Math.random()+"$",d.addEventListener?d.addEventListener("message",W,!1):d.attachEvent("onmessage",W),function(q){d.postMessage(A+q,"*")}):d.MessageChannel?((w=new MessageChannel).port1.onmessage=function(q){O(q.data)},function(q){w.port2.postMessage(q)}):C&&"onreadystatechange"in C.createElement("script")?(v=C.documentElement,function(q){var Z=C.createElement("script");Z.onreadystatechange=function(){O(q),Z.onreadystatechange=null,v.removeChild(Z),Z=null},v.appendChild(Z)}):function(q){setTimeout(O,0,q)},z.setImmediate=function(q){typeof q!="function"&&(q=new Function(""+q));for(var Z=new Array(arguments.length-1),ae=0;ae<Z.length;ae++)Z[ae]=arguments[ae+1];var J={callback:q,args:Z};return E[b]=J,m(b),b++},z.clearImmediate=B}function B(q){delete E[q]}function O(q){if(T)setTimeout(O,0,q);else{var Z=E[q];if(Z){T=!0;try{(function(ae){var J=ae.callback,he=ae.args;switch(he.length){case 0:J();break;case 1:J(he[0]);break;case 2:J(he[0],he[1]);break;case 3:J(he[0],he[1],he[2]);break;default:J.apply(n,he)}})(Z)}finally{B(q),T=!1}}}}function W(q){q.source===d&&typeof q.data=="string"&&q.data.indexOf(A)===0&&O(+q.data.slice(A.length))}})(typeof self>"u"?f===void 0?this:f:self)}).call(this,typeof al<"u"?al:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Bg);var _2=Bg.exports;const y2=Gc(_2),v2=[{filename:"settings.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-settings xmlns:config="urn:oasis:names:tc:opendocument:xmlns:config:1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ooo="http://openoffice.org/2004/office" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:settings>
    <config:config-item-set config:name="ooo:view-settings">
      <config:config-item config:name="VisibleAreaTop" config:type="int">0</config:config-item>
      <config:config-item config:name="VisibleAreaLeft" config:type="int">0</config:config-item>
      <config:config-item config:name="VisibleAreaWidth" config:type="int">4515</config:config-item>
      <config:config-item config:name="VisibleAreaHeight" config:type="int">2894</config:config-item>
      <config:config-item-map-indexed config:name="Views">
        <config:config-item-map-entry>
          <config:config-item config:name="ViewId" config:type="string">view1</config:config-item>
          <config:config-item-map-named config:name="Tables">
{{#each sheets}}
            <config:config-item-map-entry config:name="{{this.sheetName}}">
              <config:config-item config:name="CursorPositionX" config:type="int">0</config:config-item>
              <config:config-item config:name="CursorPositionY" config:type="int">0</config:config-item>
              <config:config-item config:name="HorizontalSplitMode" config:type="short">0</config:config-item>
              <config:config-item config:name="VerticalSplitMode" config:type="short">0</config:config-item>
              <config:config-item config:name="HorizontalSplitPosition" config:type="int">0</config:config-item>
              <config:config-item config:name="VerticalSplitPosition" config:type="int">0</config:config-item>
              <config:config-item config:name="ActiveSplitRange" config:type="short">2</config:config-item>
              <config:config-item config:name="PositionLeft" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionRight" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionTop" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionBottom" config:type="int">0</config:config-item>
              <config:config-item config:name="ZoomType" config:type="short">0</config:config-item>
              <config:config-item config:name="ZoomValue" config:type="int">100</config:config-item>
              <config:config-item config:name="PageViewZoomValue" config:type="int">60</config:config-item>
              <config:config-item config:name="ShowGrid" config:type="boolean">true</config:config-item>
              <config:config-item config:name="AnchoredTextOverflowLegacy" config:type="boolean">false</config:config-item>
            </config:config-item-map-entry>
{{/each}}
            <config:config-item-map-entry config:name="Contents">
              <config:config-item config:name="CursorPositionX" config:type="int">0</config:config-item>
              <config:config-item config:name="CursorPositionY" config:type="int">0</config:config-item>
              <config:config-item config:name="HorizontalSplitMode" config:type="short">0</config:config-item>
              <config:config-item config:name="VerticalSplitMode" config:type="short">0</config:config-item>
              <config:config-item config:name="HorizontalSplitPosition" config:type="int">0</config:config-item>
              <config:config-item config:name="VerticalSplitPosition" config:type="int">0</config:config-item>
              <config:config-item config:name="ActiveSplitRange" config:type="short">2</config:config-item>
              <config:config-item config:name="PositionLeft" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionRight" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionTop" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionBottom" config:type="int">0</config:config-item>
              <config:config-item config:name="ZoomType" config:type="short">0</config:config-item>
              <config:config-item config:name="ZoomValue" config:type="int">100</config:config-item>
              <config:config-item config:name="PageViewZoomValue" config:type="int">60</config:config-item>
              <config:config-item config:name="ShowGrid" config:type="boolean">true</config:config-item>
              <config:config-item config:name="AnchoredTextOverflowLegacy" config:type="boolean">false</config:config-item>
            </config:config-item-map-entry>
            <config:config-item-map-entry config:name="Cover sheet">
              <config:config-item config:name="CursorPositionX" config:type="int">0</config:config-item>
              <config:config-item config:name="CursorPositionY" config:type="int">0</config:config-item>
              <config:config-item config:name="HorizontalSplitMode" config:type="short">0</config:config-item>
              <config:config-item config:name="VerticalSplitMode" config:type="short">0</config:config-item>
              <config:config-item config:name="HorizontalSplitPosition" config:type="int">0</config:config-item>
              <config:config-item config:name="VerticalSplitPosition" config:type="int">0</config:config-item>
              <config:config-item config:name="ActiveSplitRange" config:type="short">2</config:config-item>
              <config:config-item config:name="PositionLeft" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionRight" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionTop" config:type="int">0</config:config-item>
              <config:config-item config:name="PositionBottom" config:type="int">0</config:config-item>
              <config:config-item config:name="ZoomType" config:type="short">0</config:config-item>
              <config:config-item config:name="ZoomValue" config:type="int">100</config:config-item>
              <config:config-item config:name="PageViewZoomValue" config:type="int">60</config:config-item>
              <config:config-item config:name="ShowGrid" config:type="boolean">true</config:config-item>
              <config:config-item config:name="AnchoredTextOverflowLegacy" config:type="boolean">false</config:config-item>
            </config:config-item-map-entry>
          </config:config-item-map-named>
          <config:config-item config:name="ActiveTable" config:type="string">Cover sheet</config:config-item>
          <config:config-item config:name="HorizontalScrollbarWidth" config:type="int">1376</config:config-item>
          <config:config-item config:name="ZoomType" config:type="short">0</config:config-item>
          <config:config-item config:name="ZoomValue" config:type="int">100</config:config-item>
          <config:config-item config:name="PageViewZoomValue" config:type="int">60</config:config-item>
          <config:config-item config:name="ShowPageBreakPreview" config:type="boolean">false</config:config-item>
          <config:config-item config:name="ShowZeroValues" config:type="boolean">true</config:config-item>
          <config:config-item config:name="ShowNotes" config:type="boolean">true</config:config-item>
          <config:config-item config:name="ShowGrid" config:type="boolean">true</config:config-item>
          <config:config-item config:name="GridColor" config:type="int">12632256</config:config-item>
          <config:config-item config:name="ShowPageBreaks" config:type="boolean">true</config:config-item>
          <config:config-item config:name="HasColumnRowHeaders" config:type="boolean">true</config:config-item>
          <config:config-item config:name="HasSheetTabs" config:type="boolean">true</config:config-item>
          <config:config-item config:name="IsOutlineSymbolsSet" config:type="boolean">true</config:config-item>
          <config:config-item config:name="IsValueHighlightingEnabled" config:type="boolean">false</config:config-item>
          <config:config-item config:name="IsSnapToRaster" config:type="boolean">false</config:config-item>
          <config:config-item config:name="RasterIsVisible" config:type="boolean">false</config:config-item>
          <config:config-item config:name="RasterResolutionX" config:type="int">1000</config:config-item>
          <config:config-item config:name="RasterResolutionY" config:type="int">1000</config:config-item>
          <config:config-item config:name="RasterSubdivisionX" config:type="int">1</config:config-item>
          <config:config-item config:name="RasterSubdivisionY" config:type="int">1</config:config-item>
          <config:config-item config:name="IsRasterAxisSynchronized" config:type="boolean">true</config:config-item>
          <config:config-item config:name="AnchoredTextOverflowLegacy" config:type="boolean">false</config:config-item>
        </config:config-item-map-entry>
      </config:config-item-map-indexed>
    </config:config-item-set>
    <config:config-item-set config:name="ooo:configuration-settings">
      <config:config-item config:name="ShowZeroValues" config:type="boolean">true</config:config-item>
      <config:config-item config:name="ShowGrid" config:type="boolean">true</config:config-item>
      <config:config-item config:name="ShowNotes" config:type="boolean">true</config:config-item>
      <config:config-item config:name="ShowPageBreaks" config:type="boolean">true</config:config-item>
      <config:config-item config:name="HasSheetTabs" config:type="boolean">true</config:config-item>
      <config:config-item config:name="IsRasterAxisSynchronized" config:type="boolean">true</config:config-item>
      <config:config-item config:name="RasterResolutionY" config:type="int">1000</config:config-item>
      <config:config-item config:name="RasterResolutionX" config:type="int">1000</config:config-item>
      <config:config-item config:name="EmbedFonts" config:type="boolean">false</config:config-item>
      <config:config-item config:name="IsSnapToRaster" config:type="boolean">false</config:config-item>
      <config:config-item config:name="RasterIsVisible" config:type="boolean">false</config:config-item>
      <config:config-item config:name="SaveVersionOnClose" config:type="boolean">false</config:config-item>
      <config:config-item config:name="GridColor" config:type="int">12632256</config:config-item>
      <config:config-item config:name="PrinterName" config:type="string">HP Officejet 4500 G510a-f</config:config-item>
      <config:config-item config:name="RasterSubdivisionX" config:type="int">1</config:config-item>
      <config:config-item config:name="LinkUpdateMode" config:type="short">3</config:config-item>
      <config:config-item config:name="HasColumnRowHeaders" config:type="boolean">true</config:config-item>
      <config:config-item config:name="RasterSubdivisionY" config:type="int">1</config:config-item>
      <config:config-item config:name="AutoCalculate" config:type="boolean">true</config:config-item>
      <config:config-item config:name="PrinterSetup" config:type="base64Binary">5wD+/0hQIE9mZmljZWpldCA0NTAwIEc1MTBhLWYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAR2VuZXJpYyBQQ0wgTGFzZXIgUHJpbnRlcgAAAAAAAAAWAAQABAAAAAAAAAAEAAhSAAAEdAAAAAAAABIAQ09NUEFUX0RVUExFWF9NT0RFEwBEdXBsZXhNb2RlOjpVbmtub3du</config:config-item>
      <config:config-item config:name="IsOutlineSymbolsSet" config:type="boolean">true</config:config-item>
      <config:config-item config:name="PrinterPaperFromSetup" config:type="boolean">false</config:config-item>
      <config:config-item config:name="SaveThumbnail" config:type="boolean">true</config:config-item>
      <config:config-item config:name="IsKernAsianPunctuation" config:type="boolean">false</config:config-item>
      <config:config-item config:name="CharacterCompressionType" config:type="short">0</config:config-item>
      <config:config-item config:name="IsDocumentShared" config:type="boolean">false</config:config-item>
      <config:config-item config:name="LoadReadonly" config:type="boolean">false</config:config-item>
      <config:config-item config:name="EmbedLatinScriptFonts" config:type="boolean">true</config:config-item>
      <config:config-item config:name="UpdateFromTemplate" config:type="boolean">true</config:config-item>
      <config:config-item config:name="AllowPrintJobCancel" config:type="boolean">true</config:config-item>
      <config:config-item config:name="EmbedOnlyUsedFonts" config:type="boolean">false</config:config-item>
      <config:config-item config:name="EmbedAsianScriptFonts" config:type="boolean">true</config:config-item>
      <config:config-item config:name="EmbedComplexScriptFonts" config:type="boolean">true</config:config-item>
      <config:config-item config:name="SyntaxStringRef" config:type="short">7</config:config-item>
      <config:config-item config:name="ApplyUserData" config:type="boolean">true</config:config-item>
    </config:config-item-set>
  </office:settings>
</office:document-settings>
`},{filename:"content.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-content xmlns:presentation="urn:oasis:names:tc:opendocument:xmlns:presentation:1.0" xmlns:css3t="http://www.w3.org/TR/css3-text/" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:rpt="http://openoffice.org/2005/report" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:formx="urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:scripts/>
  <office:font-face-decls>
    <style:font-face style:name="Arial" svg:font-family="Arial" style:font-adornments="Regular" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Liberation Sans" svg:font-family="'Liberation Sans'" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Arial Unicode MS" svg:font-family="'Arial Unicode MS'" style:font-family-generic="system" style:font-pitch="variable"/>
    <style:font-face style:name="PingFang SC" svg:font-family="'PingFang SC'" style:font-family-generic="system" style:font-pitch="variable"/>
  </office:font-face-decls>
  <office:automatic-styles>
    <style:style style:name="co1" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="2.258cm"/>
    </style:style>
{{#each sheets}}
    <style:style style:name="{{firstColumnStyleName}}" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="{{firstColumnWidthCm}}cm"/>
    </style:style>
{{/each}}
    <style:style style:name="ro1" style:family="table-row">
      <style:table-row-properties style:row-height="0.778cm" fo:break-before="auto" style:use-optimal-row-height="true"/>
    </style:style>
    <style:style style:name="ro2" style:family="table-row">
      <style:table-row-properties style:row-height="0.529cm" fo:break-before="auto" style:use-optimal-row-height="true"/>
    </style:style>
    <style:style style:name="ta1" style:family="table" style:master-page-name="Default">
      <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
    </style:style>
    <style:style style:name="ce3" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N111"/>
  </office:automatic-styles>
  <office:body>
    <office:spreadsheet>
      <table:calculation-settings table:automatic-find-labels="false" table:use-regular-expressions="false" table:use-wildcards="true"/>
      <table:table table:name="Cover sheet" table:style-name="ta1">
        <table:table-column table:style-name="co1" table:number-columns-repeated="2" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>Cover sheet title</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:number-columns-repeated="2"/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>a</text:p>
          </table:table-cell>
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>b</text:p>
          </table:table-cell>
        </table:table-row>
{{#each selectedCharacteristics}}
        <table:table-row table:style-name="ro2">
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{variable}}</text:p>
          </table:table-cell>
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{category}}</text:p>
          </table:table-cell>
        </table:table-row>
{{/each}}
      </table:table>
      <table:table table:name="Contents" table:style-name="ta1">
        <table:table-column table:style-name="co1" table:number-columns-repeated="2" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>Contents</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:number-columns-repeated="2"/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>a</text:p>
          </table:table-cell>
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>b</text:p>
          </table:table-cell>
        </table:table-row>
{{#each sheets}}
        <table:table-row table:style-name="ro2">
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{sheetName}}</text:p>
          </table:table-cell>
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>
              <text:a xlink:href="#{{sheetName}}" xlink:type="simple">{{sheetName}}</text:a>
            </text:p>
          </table:table-cell>
        </table:table-row>
{{/each}}
      </table:table>
{{#each sheets}}
      <table:table table:name="{{sheetName}}" table:style-name="ta1">
        <table:table-column table:style-name="{{firstColumnStyleName}}" table:default-cell-style-name="Default"/>
        <table:table-column table:style-name="co1" table:number-columns-repeated="2" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>{{sheetName}} (generated title)</text:p>
          </table:table-cell>
          <table:table-cell table:number-columns-repeated="2"/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:number-columns-repeated="3"/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
{{#each ../tableHeadings}}
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{this}}</text:p>
          </table:table-cell>
{{/each}}
        </table:table-row>
{{#each rowData}}
        <table:table-row table:style-name="ro2">
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{name}}</text:p>
          </table:table-cell>
{{#each values}}
          <table:table-cell table:style-name="ce3" office:value-type="float" office:value="{{this}}" calcext:value-type="float">
            <text:p>{{this}}</text:p>
          </table:table-cell>
{{/each}}
        </table:table-row>
{{/each}}
      </table:table>
{{/each}}
      <table:named-expressions/>
      <table:database-ranges>
        <table:database-range table:name="selected_characteristics" table:target-range-address="'Cover sheet'.{{firstCharacteristicsCell}}:'Cover sheet'.{{lastCharacteristicsCell}}" table:on-update-keep-styles="true" table:on-update-keep-size="false" table:orientation="column"/>
        <table:database-range table:name="table_of_contents" table:target-range-address="'Contents'.{{firstTocCell}}:'Contents'.{{lastTocCell}}" table:on-update-keep-styles="true" table:on-update-keep-size="false" table:orientation="column"/>
{{#each sheets}}
        <table:database-range table:name="{{tableName}}" table:target-range-address="'{{sheetName}}'.{{firstTableCell}}:'{{sheetName}}'.{{lastTableCell}}" table:on-update-keep-styles="true" table:on-update-keep-size="false" table:orientation="column"/>
{{/each}}
      </table:database-ranges>
    </office:spreadsheet>
  </office:body>
</office:document-content>
`},{filename:"meta.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-meta xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:meta>
    <meta:creation-date>2023-09-21T12:53:29.924750298</meta:creation-date>
    <dc:date>2023-09-28T11:47:04.527514513</dc:date>
    <meta:editing-duration>PT6M31S</meta:editing-duration>
    <meta:editing-cycles>8</meta:editing-cycles>
    <meta:generator>LibreOffice/7.0.6.2$MacOSX_X86_64 LibreOffice_project/144abb84a525d8e30c9dbbefa69cbbf2d8d4ae3b</meta:generator>
    <meta:document-statistic meta:table-count="{{tableCount}}" meta:object-count="0"/>
  </office:meta>
</office:document-meta>
`},{filename:"META-INF/manifest.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" manifest:version="1.3">
  <manifest:file-entry manifest:full-path="/" manifest:version="1.3" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
  <manifest:file-entry manifest:full-path="meta.xml" manifest:media-type="text/xml"/>
  <manifest:file-entry manifest:full-path="styles.xml" manifest:media-type="text/xml"/>
  <manifest:file-entry manifest:full-path="Configurations2/" manifest:media-type="application/vnd.sun.xml.ui.configuration"/>
  <manifest:file-entry manifest:full-path="manifest.rdf" manifest:media-type="application/rdf+xml"/>
  <manifest:file-entry manifest:full-path="content.xml" manifest:media-type="text/xml"/>
  <manifest:file-entry manifest:full-path="settings.xml" manifest:media-type="text/xml"/>
  <manifest:file-entry manifest:full-path="Thumbnails/thumbnail.png" manifest:media-type="image/png"/>
</manifest:manifest>
`},{filename:"styles.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-styles xmlns:presentation="urn:oasis:names:tc:opendocument:xmlns:presentation:1.0" xmlns:css3t="http://www.w3.org/TR/css3-text/" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:rpt="http://openoffice.org/2005/report" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:font-face-decls>
    <style:font-face style:name="Arial" svg:font-family="Arial" style:font-adornments="Regular" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Liberation Sans" svg:font-family="'Liberation Sans'" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Arial Unicode MS" svg:font-family="'Arial Unicode MS'" style:font-family-generic="system" style:font-pitch="variable"/>
    <style:font-face style:name="PingFang SC" svg:font-family="'PingFang SC'" style:font-family-generic="system" style:font-pitch="variable"/>
  </office:font-face-decls>
  <office:styles>
    <style:default-style style:family="table-cell">
      <style:paragraph-properties style:tab-stop-distance="1.25cm"/>
      <style:text-properties style:font-name="Liberation Sans" fo:language="en" fo:country="GB" style:font-name-asian="PingFang SC" style:language-asian="zh" style:country-asian="CN" style:font-name-complex="Arial Unicode MS" style:language-complex="hi" style:country-complex="IN"/>
    </style:default-style>
    <number:number-style style:name="N0">
      <number:number number:min-integer-digits="1"/>
    </number:number-style>
    <number:number-style style:name="N111">
      <number:number number:decimal-places="1" number:min-decimal-places="1" number:min-integer-digits="1"/>
    </number:number-style>
    <style:style style:name="Default" style:family="table-cell">
      <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-style-name="Regular" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="12pt"/>
    </style:style>
    <style:style style:name="Heading" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="24pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Heading_20_1" style:display-name="Heading 1" style:family="table-cell" style:parent-style-name="Heading">
      <style:text-properties fo:color="#000000" fo:font-size="18pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Heading_20_2" style:display-name="Heading 2" style:family="table-cell" style:parent-style-name="Heading">
      <style:text-properties fo:color="#000000" fo:font-size="14pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Text" style:family="table-cell" style:parent-style-name="Default"/>
    <style:style style:name="Note" style:family="table-cell" style:parent-style-name="Text">
      <style:table-cell-properties fo:background-color="#ffffcc" style:diagonal-bl-tr="none" style:diagonal-tl-br="none" fo:border="0.74pt solid #808080"/>
      <style:text-properties fo:color="#333333" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Footnote" style:family="table-cell" style:parent-style-name="Text">
      <style:text-properties fo:color="#808080" fo:font-size="10pt" fo:font-style="italic" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Hyperlink" style:family="table-cell" style:parent-style-name="Text">
      <style:text-properties fo:color="#0000ee" fo:font-size="10pt" fo:font-style="normal" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="#0000ee" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Status" style:family="table-cell" style:parent-style-name="Default"/>
    <style:style style:name="Good" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ccffcc"/>
      <style:text-properties fo:color="#006600" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Neutral" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ffffcc"/>
      <style:text-properties fo:color="#996600" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Bad" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ffcccc"/>
      <style:text-properties fo:color="#cc0000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Warning" style:family="table-cell" style:parent-style-name="Status">
      <style:text-properties fo:color="#cc0000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Error" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#cc0000"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Accent" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Accent_20_1" style:display-name="Accent 1" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#000000"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Accent_20_2" style:display-name="Accent 2" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#808080"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Accent_20_3" style:display-name="Accent 3" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#dddddd"/>
    </style:style>
    <style:style style:name="Result" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="10pt" fo:font-style="italic" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="#000000" fo:font-weight="bold"/>
    </style:style>
  </office:styles>
  <office:automatic-styles>
    <style:page-layout style:name="Mpm1">
      <style:page-layout-properties style:writing-mode="lr-tb"/>
      <style:header-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-bottom="0.25cm"/>
      </style:header-style>
      <style:footer-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-top="0.25cm"/>
      </style:footer-style>
    </style:page-layout>
    <style:page-layout style:name="Mpm2">
      <style:page-layout-properties style:writing-mode="lr-tb"/>
      <style:header-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-bottom="0.25cm" fo:border="2.49pt solid #000000" fo:padding="0.018cm" fo:background-color="#c0c0c0">
          <style:background-image/>
        </style:header-footer-properties>
      </style:header-style>
      <style:footer-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-top="0.25cm" fo:border="2.49pt solid #000000" fo:padding="0.018cm" fo:background-color="#c0c0c0">
          <style:background-image/>
        </style:header-footer-properties>
      </style:footer-style>
    </style:page-layout>
  </office:automatic-styles>
  <office:master-styles>
    <style:master-page style:name="Default" style:page-layout-name="Mpm1">
      <style:header>
        <text:p>
          <text:sheet-name>???</text:sheet-name>
        </text:p>
      </style:header>
      <style:header-left style:display="false"/>
      <style:footer>
        <text:p>Page <text:page-number>1</text:page-number></text:p>
      </style:footer>
      <style:footer-left style:display="false"/>
    </style:master-page>
    <style:master-page style:name="Report" style:page-layout-name="Mpm2">
      <style:header>
        <style:region-left>
          <text:p><text:sheet-name>???</text:sheet-name><text:s/>(<text:title>???</text:title>)</text:p>
        </style:region-left>
        <style:region-right>
          <text:p><text:date style:data-style-name="N2" text:date-value="2023-09-28">00/00/0000</text:date>, <text:time style:data-style-name="N2" text:time-value="11:46:49.533334484">00:00:00</text:time></text:p>
        </style:region-right>
      </style:header>
      <style:header-left style:display="false"/>
      <style:footer>
        <text:p>Page <text:page-number>1</text:page-number><text:s/>/ <text:page-count>99</text:page-count></text:p>
      </style:footer>
      <style:footer-left style:display="false"/>
    </style:master-page>
  </office:master-styles>
</office:document-styles>
`},{filename:"mimetype",contents:"application/vnd.oasis.opendocument.spreadsheet"},{filename:"manifest.rdf",contents:`<?xml version="1.0" encoding="utf-8"?>
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
  <rdf:Description rdf:about="styles.xml">
    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/odf#StylesFile"/>
  </rdf:Description>
  <rdf:Description rdf:about="">
    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="styles.xml"/>
  </rdf:Description>
  <rdf:Description rdf:about="content.xml">
    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/odf#ContentFile"/>
  </rdf:Description>
  <rdf:Description rdf:about="">
    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="content.xml"/>
  </rdf:Description>
  <rdf:Description rdf:about="">
    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#Document"/>
  </rdf:Description>
</rdf:RDF>
`}];function Yo(u,r){return String.fromCodePoint("A".codePointAt(0)-1+u)+r}function b2(u,r){u.tableCount=u.sheets.length+1,u.firstTocCell=Yo(1,3),u.lastTocCell=Yo(2,5),u.firstCharacteristicsCell=Yo(1,3),u.lastCharacteristicsCell=Yo(2,5);let o=0;for(const c of u.sheets)c.firstTableCell=Yo(1,3),c.lastTableCell=Yo(1+c.rowData[0].values.length,3+c.rowData.length),c.firstColumnStyleName="firstColStyle"+o,c.firstColumnWidthCm=(Math.max(...c.rowData.map(f=>x2(f.name)))/37.8+.5).toFixed(2),o++;const l=[];for(const c of v2){const f=r.compile(c.contents);l.push({filename:c.filename,contents:f(u)})}return l}function x2(u){let r=0;for(const o of u)r+=o in lh?lh[o]:lh.AVERAGE;return r}const lh={0:8.9,1:8.9,2:8.9,3:8.9,4:8.9,5:8.9,6:8.9,7:8.9,8:8.9,9:8.9,a:8.9,b:8.9,c:8,d:8.9,e:8.9,f:4.43,g:8.9,h:8.9,i:3.57,j:3.57,k:8,l:3.57,m:13.33,n:8.9,o:8.9,p:8.9,q:8.9,r:5.33,s:8,t:4.43,u:8.9,v:8,w:11.57,x:8,y:8,z:8,A:10.67,B:10.67,C:11.57,D:11.57,E:10.67,F:9.77,G:12.43,H:11.57,I:4.43,J:8,K:10.67,L:8.9,M:13.33,N:11.57,O:12.43,P:10.67,Q:12.43,R:11.57,S:10.67,T:9.77,U:11.57,V:10.67,W:15.1,X:10.67,Y:10.67,Z:9.77," ":4.43,"!":4.43,'"':5.67,"#":8.9,$:8.9,"%":14.23,"&":10.67,"'":3.07,"(":5.33,")":5.33,"*":6.23,"+":9.33,",":4.43,"-":5.33,".":4.43,"/":4.43,":":4.43,";":4.43,"<":9.33,"=":9.33,">":9.33,"?":8.9,"@":16.23,"[":4.43,"]":4.43,"^":7.5,_:8.9,"`":5.33,"{":5.33,"|":4.17,"}":5.33,"~":9.33,AVERAGE:8.472340340309955};const{document:us}=Jm;function Am(u,r,o){const l=u.slice();return l[23]=r[o],l}function Cm(u,r,o){const l=u.slice();return l[26]=r[o],l}function Im(u,r,o){const l=u.slice();return l[29]=r[o],l[31]=o,l}function w2(u){let r;return{c(){r=xt("Close menu")},l(o){r=wt(o,"Close menu")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function k2(u){let r,o,l,c;return r=new d0({props:{options:Cy,clickCallback:u[5],removeCatCallback:u[6],globalSelectedCategories:u[1],disabled:u[2]==="loading"}}),l=new Dc({props:{variant:"secondary",small:!0,$$slots:{default:[w2]},$$scope:{ctx:u}}}),l.$on("click",X2),{c(){Kt(r.$$.fragment),o=ft(),Kt(l.$$.fragment)},l(f){ei(r.$$.fragment,f),o=dt(f),ei(l.$$.fragment,f)},m(f,d){Jt(r,f,d),Ie(f,o,d),Jt(l,f,d),c=!0},p(f,d){const n={};d[0]&2&&(n.globalSelectedCategories=f[1]),d[0]&4&&(n.disabled=f[2]==="loading"),r.$set(n);const m={};d[1]&2&&(m.$$scope={dirty:d,ctx:f}),l.$set(m)},i(f){c||(De(r.$$.fragment,f),De(l.$$.fragment,f),c=!0)},o(f){Xe(r.$$.fragment,f),Xe(l.$$.fragment,f),c=!1},d(f){Yt(r,f),f&&Q(o),Yt(l,f)}}}function Pm(u){let r,o,l=u[0].selected!=null&&u[8](u[0]).missing>0&&u[0].selected.total_pop.count!=null&&u[0].selected.total_pop.count>=100,c,f;r=new $m({props:{mode:u[2]=="failed"?"error":"info",$$slots:{default:[M2]},$$scope:{ctx:u}}});let d=l&&Dm(u);return{c(){Kt(r.$$.fragment),o=ft(),d&&d.c(),c=jt()},l(n){ei(r.$$.fragment,n),o=dt(n),d&&d.l(n),c=jt()},m(n,m){Jt(r,n,m),Ie(n,o,m),d&&d.m(n,m),Ie(n,c,m),f=!0},p(n,m){const v={};m[0]&4&&(v.mode=n[2]=="failed"?"error":"info"),m[0]&14|m[1]&2&&(v.$$scope={dirty:m,ctx:n}),r.$set(v),m[0]&1&&(l=n[0].selected!=null&&n[8](n[0]).missing>0&&n[0].selected.total_pop.count!=null&&n[0].selected.total_pop.count>=100),l?d?(d.p(n,m),m[0]&1&&De(d,1)):(d=Dm(n),d.c(),De(d,1),d.m(c.parentNode,c)):d&&(Ii(),Xe(d,1,1,()=>{d=null}),Pi())},i(n){f||(De(r.$$.fragment,n),De(d),f=!0)},o(n){Xe(r.$$.fragment,n),Xe(d),f=!1},d(n){Yt(r,n),n&&Q(o),d&&d.d(n),n&&Q(c)}}}function zm(u){let r;function o(f,d){return f[1].length===1?E2:S2}let l=o(u),c=l(u);return{c(){r=Be("p"),c.c()},l(f){r=Re(f,"P",{});var d=Ne(r);c.l(d),d.forEach(Q)},m(f,d){Ie(f,r,d),c.m(r,null)},p(f,d){l===(l=o(f))&&c?c.p(f,d):(c.d(1),c=l(f),c&&(c.c(),c.m(r,null)))},d(f){f&&Q(r),c.d()}}}function S2(u){let r,o;function l(d,n){return d[1].length===2?A2:T2}let c=l(u),f=c(u);return{c(){r=xt("The profile below is for people with "),f.c(),o=xt(`
                of the following characteristics:`)},l(d){r=wt(d,"The profile below is for people with "),f.l(d),o=wt(d,`
                of the following characteristics:`)},m(d,n){Ie(d,r,n),f.m(d,n),Ie(d,o,n)},p(d,n){c!==(c=l(d))&&(f.d(1),f=c(d),f&&(f.c(),f.m(o.parentNode,o)))},d(d){d&&Q(r),f.d(d),d&&Q(o)}}}function E2(u){let r;return{c(){r=xt(`The profile below is for people with the following
                characteristic:`)},l(o){r=wt(o,`The profile below is for people with the following
                characteristic:`)},m(o,l){Ie(o,r,l)},p:ci,d(o){o&&Q(r)}}}function T2(u){let r;return{c(){r=xt("all")},l(o){r=wt(o,"all")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function A2(u){let r;return{c(){r=xt("both")},l(o){r=wt(o,"both")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function C2(u){let r,o,l=Os(u[29].topic)+"",c,f,d=Os(ia(u[29].label))+"",n,m,v,w,A;function b(){return u[11](u[29])}return{c(){r=Be("button"),o=Be("span"),c=xt(l),f=xt(": "),n=xt(d),m=ft(),v=Be("span"),this.h()},l(E){r=Re(E,"BUTTON",{class:!0});var T=Ne(r);o=Re(T,"SPAN",{class:!0});var C=Ne(o);c=wt(C,l),f=wt(C,": "),n=wt(C,d),C.forEach(Q),m=dt(T),v=Re(T,"SPAN",{class:!0}),Ne(v).forEach(Q),T.forEach(Q),this.h()},h(){fe(o,"class","chip-text svelte-hd3bon"),fe(v,"class","chip-ready svelte-hd3bon"),fe(r,"class","chip svelte-hd3bon")},m(E,T){Ie(E,r,T),ke(r,o),ke(o,c),ke(o,f),ke(o,n),ke(r,m),ke(r,v),w||(A=ms(r,"click",b),w=!0)},p(E,T){u=E,T[0]&2&&l!==(l=Os(u[29].topic)+"")&&_i(c,l),T[0]&2&&d!==(d=Os(ia(u[29].label))+"")&&_i(n,d)},d(E){E&&Q(r),w=!1,A()}}}function I2(u){let r,o,l=Os(u[29].topic)+"",c,f,d=Os(ia(u[29].label))+"",n,m,v;return{c(){r=Be("div"),o=Be("span"),c=xt(l),f=xt(": "),n=xt(d),m=ft(),v=Be("div"),this.h()},l(w){r=Re(w,"DIV",{class:!0});var A=Ne(r);o=Re(A,"SPAN",{class:!0});var b=Ne(o);c=wt(b,l),f=wt(b,": "),n=wt(b,d),b.forEach(Q),m=dt(A),v=Re(A,"DIV",{class:!0}),Ne(v).forEach(Q),A.forEach(Q),this.h()},h(){fe(o,"class","chip-text svelte-hd3bon"),fe(v,"class","chip-loader svelte-hd3bon"),fe(r,"class","chip chip-pending svelte-hd3bon")},m(w,A){Ie(w,r,A),ke(r,o),ke(o,c),ke(o,f),ke(o,n),ke(r,m),ke(r,v)},p(w,A){A[0]&2&&l!==(l=Os(w[29].topic)+"")&&_i(c,l),A[0]&2&&d!==(d=Os(ia(w[29].label))+"")&&_i(n,d)},d(w){w&&Q(r)}}}function Mm(u){let r;function o(f,d){return f[2]=="loading"?I2:C2}let l=o(u),c=l(u);return{c(){c.c(),r=jt()},l(f){c.l(f),r=jt()},m(f,d){c.m(f,d),Ie(f,r,d)},p(f,d){l===(l=o(f))&&c?c.p(f,d):(c.d(1),c=l(f),c&&(c.c(),c.m(r.parentNode,r)))},d(f){c.d(f),f&&Q(r)}}}function P2(u){let r,o;return{c(){r=Be("p"),o=xt(`Economic indicators (employment, social status etc) are not
              available for ages 0 to 15.`),this.h()},l(l){r=Re(l,"P",{});var c=Ne(r);o=wt(c,`Economic indicators (employment, social status etc) are not
              available for ages 0 to 15.`),c.forEach(Q),this.h()},h(){yt(r,"margin","1rem 0 0")},m(l,c){Ie(l,r,c),ke(r,o)},d(l){l&&Q(r)}}}function z2(u){let r,o;return{c(){r=Be("p"),o=xt(`No data is available for the selected variables. Try removing a
              variable to see more datasets.`),this.h()},l(l){r=Re(l,"P",{});var c=Ne(r);o=wt(c,`No data is available for the selected variables. Try removing a
              variable to see more datasets.`),c.forEach(Q),this.h()},h(){yt(r,"margin","1rem 0 0")},m(l,c){Ie(l,r,c),ke(r,o)},d(l){l&&Q(r)}}}function M2(u){let r,o,l,c=u[2]!="failed"&&zm(u),f=u[1],d=[];for(let w=0;w<f.length;w+=1)d[w]=Mm(Im(u,f,w));function n(w,A){if(w[2]=="failed")return z2;if(w[3]==!0)return P2}let m=n(u),v=m&&m(u);return{c(){r=Be("div"),c&&c.c(),o=ft();for(let w=0;w<d.length;w+=1)d[w].c();l=ft(),v&&v.c(),this.h()},l(w){r=Re(w,"DIV",{"aria-live":!0});var A=Ne(r);c&&c.l(A),o=dt(A);for(let b=0;b<d.length;b+=1)d[b].l(A);l=dt(A),v&&v.l(A),A.forEach(Q),this.h()},h(){fe(r,"aria-live","polite")},m(w,A){Ie(w,r,A),c&&c.m(r,null),ke(r,o);for(let b=0;b<d.length;b+=1)d[b]&&d[b].m(r,null);ke(r,l),v&&v.m(r,null)},p(w,A){if(w[2]!="failed"?c?c.p(w,A):(c=zm(w),c.c(),c.m(r,o)):c&&(c.d(1),c=null),A[0]&134){f=w[1];let b;for(b=0;b<f.length;b+=1){const E=Im(w,f,b);d[b]?d[b].p(E,A):(d[b]=Mm(E),d[b].c(),d[b].m(r,l))}for(;b<d.length;b+=1)d[b].d(1);d.length=f.length}m!==(m=n(w))&&(v&&v.d(1),v=m&&m(w),v&&(v.c(),v.m(r,null)))},d(w){w&&Q(r),c&&c.d(),zn(d,w),v&&v.d()}}}function Dm(u){let r,o;return r=new $m({props:{mode:"info",$$slots:{default:[D2]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c[0]&1|c[1]&2&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function D2(u){let r,o=u[8](u[0]).available+"",l,c,f=u[8](u[0]).missing+u[8](u[0]).available+"",d,n,m,v,w,A,b;return{c(){r=Be("strong"),l=xt(o),c=xt(`
            of `),d=xt(f),n=xt(` charts available.
          `),m=Be("br"),v=ft(),w=Be("a"),A=xt("Protecting personal data"),b=xt(`
          prevents some datasets from being included.`),this.h()},l(E){r=Re(E,"STRONG",{});var T=Ne(r);l=wt(T,o),c=wt(T,`
            of `),d=wt(T,f),n=wt(T,` charts available.
          `),T.forEach(Q),m=Re(E,"BR",{}),v=dt(E),w=Re(E,"A",{href:!0,class:!0});var C=Ne(w);A=wt(C,"Protecting personal data"),C.forEach(Q),b=wt(E,`
          prevents some datasets from being included.`),this.h()},h(){fe(w,"href","https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/methodologies/protectingpersonaldataincensus2021results"),fe(w,"class","svelte-hd3bon")},m(E,T){Ie(E,r,T),ke(r,l),ke(r,c),ke(r,d),ke(r,n),Ie(E,m,T),Ie(E,v,T),Ie(E,w,T),ke(w,A),Ie(E,b,T)},p(E,T){T[0]&1&&o!==(o=E[8](E[0]).available+"")&&_i(l,o),T[0]&1&&f!==(f=E[8](E[0]).missing+E[8](E[0]).available+"")&&_i(d,f)},d(E){E&&Q(r),E&&Q(m),E&&Q(v),E&&Q(w),E&&Q(b)}}}function L2(u){let r,o,l,c,f,d,n,m,v,w,A,b,E;A=new v1({props:{title:"Select characteristics",open:H2,$$slots:{default:[k2]},$$scope:{ctx:u}}});let T=u[1][0]&&Pm(u);return{c(){r=Be("div"),o=Be("p"),l=xt(`Select one or more identity characteristics to define a population group,
      for example
      `),c=Be("a"),f=xt("Sikhs born in the UK"),d=xt(`
      or
      `),n=Be("a"),m=xt("people aged 65+ born in Ireland"),v=xt(`. Once selected, you will see how this group compares to the whole
      population of England and Wales based on Census 2021 data.`),w=ft(),Kt(A.$$.fragment),b=ft(),T&&T.c(),this.h()},l(C){r=Re(C,"DIV",{slot:!0});var z=Ne(r);o=Re(z,"P",{class:!0});var B=Ne(o);l=wt(B,`Select one or more identity characteristics to define a population group,
      for example
      `),c=Re(B,"A",{href:!0,class:!0});var O=Ne(c);f=wt(O,"Sikhs born in the UK"),O.forEach(Q),d=wt(B,`
      or
      `),n=Re(B,"A",{href:!0,class:!0});var W=Ne(n);m=wt(W,"people aged 65+ born in Ireland"),W.forEach(Q),v=wt(B,`. Once selected, you will see how this group compares to the whole
      population of England and Wales based on Census 2021 data.`),B.forEach(Q),w=dt(z),ei(A.$$.fragment,z),b=dt(z),T&&T.l(z),z.forEach(Q),this.h()},h(){fe(c,"href","?religion_tb=7&country_of_birth_3a=1"),fe(c,"class","svelte-hd3bon"),fe(n,"href","?resident_age_3a=3&country_of_birth_8a=2"),fe(n,"class","svelte-hd3bon"),fe(o,"class","subtitle svelte-hd3bon"),fe(r,"slot","after")},m(C,z){Ie(C,r,z),ke(r,o),ke(o,l),ke(o,c),ke(c,f),ke(o,d),ke(o,n),ke(n,m),ke(o,v),ke(r,w),Jt(A,r,null),ke(r,b),T&&T.m(r,null),E=!0},p(C,z){const B={};z[0]&6|z[1]&2&&(B.$$scope={dirty:z,ctx:C}),A.$set(B),C[1][0]?T?(T.p(C,z),z[0]&2&&De(T,1)):(T=Pm(C),T.c(),De(T,1),T.m(r,null)):T&&(Ii(),Xe(T,1,1,()=>{T=null}),Pi())},i(C){E||(De(A.$$.fragment,C),De(T),E=!0)},o(C){Xe(A.$$.fragment,C),Xe(T),E=!1},d(C){C&&Q(r),Yt(A),T&&T.d()}}}function Lm(u){let r,o,l,c,f,d;r=new fl({props:{cls:"show-overflow",width:"wide",$$slots:{default:[O2]},$$scope:{ctx:u}}}),l=new qh({props:{title:"Demographics",height:"auto",$$slots:{default:[U2]},$$scope:{ctx:u}}});let n=u[0].selected.total_pop.count!=null&&u[0].selected.total_pop.count>=100&&Rm(u);return{c(){Kt(r.$$.fragment),o=ft(),Kt(l.$$.fragment),c=ft(),n&&n.c(),f=jt()},l(m){ei(r.$$.fragment,m),o=dt(m),ei(l.$$.fragment,m),c=dt(m),n&&n.l(m),f=jt()},m(m,v){Jt(r,m,v),Ie(m,o,v),Jt(l,m,v),Ie(m,c,v),n&&n.m(m,v),Ie(m,f,v),d=!0},p(m,v){const w={};v[0]&1|v[1]&2&&(w.$$scope={dirty:v,ctx:m}),r.$set(w);const A={};v[0]&3|v[1]&2&&(A.$$scope={dirty:v,ctx:m}),l.$set(A),m[0].selected.total_pop.count!=null&&m[0].selected.total_pop.count>=100?n?(n.p(m,v),v[0]&1&&De(n,1)):(n=Rm(m),n.c(),De(n,1),n.m(f.parentNode,f)):n&&(Ii(),Xe(n,1,1,()=>{n=null}),Pi())},i(m){d||(De(r.$$.fragment,m),De(l.$$.fragment,m),De(n),d=!0)},o(m){Xe(r.$$.fragment,m),Xe(l.$$.fragment,m),Xe(n),d=!1},d(m){Yt(r,m),m&&Q(o),Yt(l,m),m&&Q(c),n&&n.d(m),m&&Q(f)}}}function B2(u){let r;return{c(){r=xt("Download profile")},l(o){r=wt(o,"Download profile")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function R2(u){let r;return{c(){r=xt("Print profile")},l(o){r=wt(o,"Print profile")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function O2(u){let r,o,l,c,f;return o=new Dc({props:{variant:"secondary",icon:"download",small:!0,$$slots:{default:[B2]},$$scope:{ctx:u}}}),o.$on("click",u[12]),c=new Dc({props:{variant:"secondary",icon:"print",small:!0,$$slots:{default:[R2]},$$scope:{ctx:u}}}),c.$on("click",u[13]),{c(){r=Be("div"),Kt(o.$$.fragment),l=ft(),Kt(c.$$.fragment),this.h()},l(d){r=Re(d,"DIV",{class:!0});var n=Ne(r);ei(o.$$.fragment,n),l=dt(n),ei(c.$$.fragment,n),n.forEach(Q),this.h()},h(){fe(r,"class","action-buttons svelte-hd3bon")},m(d,n){Ie(d,r,n),Jt(o,r,null),ke(r,l),Jt(c,r,null),f=!0},p(d,n){const m={};n[1]&2&&(m.$$scope={dirty:n,ctx:d}),o.$set(m);const v={};n[1]&2&&(v.$$scope={dirty:n,ctx:d}),c.$set(v)},i(d){f||(De(o.$$.fragment,d),De(c.$$.fragment,d),f=!0)},o(d){Xe(o.$$.fragment,d),Xe(c.$$.fragment,d),f=!1},d(d){d&&Q(r),Yt(o),Yt(c)}}}function F2(u){let r;return{c(){r=xt("Number of people, age and sex compared to the population as a whole.")},l(o){r=wt(o,"Number of people, age and sex compared to the population as a whole.")},m(o,l){Ie(o,r,l)},d(o){o&&Q(r)}}}function N2(u){let r,o;return r=new yg({props:{$$slots:{default:[F2]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c[1]&2&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Bm(u){let r,o;return r=new _g({props:{title:"Sex",table:{code:"sex",key:"Sex"},data:u[0],chart_type:u[4]}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c[0]&1&&(f.data=l[0]),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function U2(u){let r,o,l,c,f,d,n=!u[1].map(Vm).includes("sex")&&u[0].selected.residents.sex.values!=="blocked",m,v;r=new ps({props:{colspan:3,noBackground:!0,$$slots:{default:[N2]},$$scope:{ctx:u}}}),l=new Xv({props:{data:u[0]}}),f=new ub({props:{data:u[0],selected:u[1]}});let w=n&&Bm(u);return{c(){Kt(r.$$.fragment),o=ft(),Kt(l.$$.fragment),c=ft(),Kt(f.$$.fragment),d=ft(),w&&w.c(),m=jt()},l(A){ei(r.$$.fragment,A),o=dt(A),ei(l.$$.fragment,A),c=dt(A),ei(f.$$.fragment,A),d=dt(A),w&&w.l(A),m=jt()},m(A,b){Jt(r,A,b),Ie(A,o,b),Jt(l,A,b),Ie(A,c,b),Jt(f,A,b),Ie(A,d,b),w&&w.m(A,b),Ie(A,m,b),v=!0},p(A,b){const E={};b[1]&2&&(E.$$scope={dirty:b,ctx:A}),r.$set(E);const T={};b[0]&1&&(T.data=A[0]),l.$set(T);const C={};b[0]&1&&(C.data=A[0]),b[0]&2&&(C.selected=A[1]),f.$set(C),b[0]&3&&(n=!A[1].map(Vm).includes("sex")&&A[0].selected.residents.sex.values!=="blocked"),n?w?(w.p(A,b),b[0]&3&&De(w,1)):(w=Bm(A),w.c(),De(w,1),w.m(m.parentNode,m)):w&&(Ii(),Xe(w,1,1,()=>{w=null}),Pi())},i(A){v||(De(r.$$.fragment,A),De(l.$$.fragment,A),De(f.$$.fragment,A),De(w),v=!0)},o(A){Xe(r.$$.fragment,A),Xe(l.$$.fragment,A),Xe(f.$$.fragment,A),Xe(w),v=!1},d(A){Yt(r,A),A&&Q(o),Yt(l,A),A&&Q(c),Yt(f,A),A&&Q(d),w&&w.d(A),A&&Q(m)}}}function Rm(u){let r,o,l,c;r=new Mv({props:{data:u[0],mapStyle:Ey,mapBounds:Ty,ladBounds:ol,selected:u[1],colors:$o}});let f=go[0].tablesCategorised,d=[];for(let m=0;m<f.length;m+=1)d[m]=Nm(Am(u,f,m));const n=m=>Xe(d[m],1,1,()=>{d[m]=null});return{c(){Kt(r.$$.fragment),o=ft();for(let m=0;m<d.length;m+=1)d[m].c();l=jt()},l(m){ei(r.$$.fragment,m),o=dt(m);for(let v=0;v<d.length;v+=1)d[v].l(m);l=jt()},m(m,v){Jt(r,m,v),Ie(m,o,v);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(m,v);Ie(m,l,v),c=!0},p(m,v){const w={};if(v[0]&1&&(w.data=m[0]),v[0]&2&&(w.selected=m[1]),r.$set(w),v[0]&17){f=go[0].tablesCategorised;let A;for(A=0;A<f.length;A+=1){const b=Am(m,f,A);d[A]?(d[A].p(b,v),De(d[A],1)):(d[A]=Nm(b),d[A].c(),De(d[A],1),d[A].m(l.parentNode,l))}for(Ii(),A=f.length;A<d.length;A+=1)n(A);Pi()}},i(m){if(!c){De(r.$$.fragment,m);for(let v=0;v<f.length;v+=1)De(d[v]);c=!0}},o(m){Xe(r.$$.fragment,m),d=d.filter(Boolean);for(let v=0;v<d.length;v+=1)Xe(d[v]);c=!1},d(m){Yt(r,m),m&&Q(o),zn(d,m),m&&Q(l)}}}function Om(u){let r,o;return r=new qh({props:{title:u[23].categoryName,height:"auto",$$slots:{default:[j2]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c[0]&1|c[1]&2&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function V2(u){let r=u[23].categoryDescription+"",o;return{c(){o=xt(r)},l(l){o=wt(l,r)},m(l,c){Ie(l,o,c)},p:ci,d(l){l&&Q(o)}}}function G2(u){let r,o;return r=new yg({props:{$$slots:{default:[V2]},$$scope:{ctx:u}}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c[1]&2&&(f.$$scope={dirty:c,ctx:l}),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function Fm(u){let r,o;return r=new _g({props:{title:tp(u[26].key),table:u[26],data:u[0],chart_type:u[4]}}),{c(){Kt(r.$$.fragment)},l(l){ei(r.$$.fragment,l)},m(l,c){Jt(r,l,c),o=!0},p(l,c){const f={};c[0]&1&&(f.title=tp(l[26].key)),c[0]&1&&(f.table=l[26]),c[0]&1&&(f.data=l[0]),r.$set(f)},i(l){o||(De(r.$$.fragment,l),o=!0)},o(l){Xe(r.$$.fragment,l),o=!1},d(l){Yt(r,l)}}}function j2(u){let r,o,l,c;r=new ps({props:{colspan:3,noBackground:!0,$$slots:{default:[G2]},$$scope:{ctx:u}}});let f=u[23].tables.filter(u[14]),d=[];for(let m=0;m<f.length;m+=1)d[m]=Fm(Cm(u,f,m));const n=m=>Xe(d[m],1,1,()=>{d[m]=null});return{c(){Kt(r.$$.fragment),o=ft();for(let m=0;m<d.length;m+=1)d[m].c();l=ft()},l(m){ei(r.$$.fragment,m),o=dt(m);for(let v=0;v<d.length;v+=1)d[v].l(m);l=dt(m)},m(m,v){Jt(r,m,v),Ie(m,o,v);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(m,v);Ie(m,l,v),c=!0},p(m,v){const w={};if(v[1]&2&&(w.$$scope={dirty:v,ctx:m}),r.$set(w),v[0]&17){f=m[23].tables.filter(m[14]);let A;for(A=0;A<f.length;A+=1){const b=Cm(m,f,A);d[A]?(d[A].p(b,v),De(d[A],1)):(d[A]=Fm(b),d[A].c(),De(d[A],1),d[A].m(l.parentNode,l))}for(Ii(),A=f.length;A<d.length;A+=1)n(A);Pi()}},i(m){if(!c){De(r.$$.fragment,m);for(let v=0;v<f.length;v+=1)De(d[v]);c=!0}},o(m){Xe(r.$$.fragment,m),d=d.filter(Boolean);for(let v=0;v<d.length;v+=1)Xe(d[v]);c=!1},d(m){Yt(r,m),m&&Q(o),zn(d,m),m&&Q(l)}}}function Nm(u){let r=u[23].tables.some(u[10]),o,l,c=r&&Om(u);return{c(){c&&c.c(),o=jt()},l(f){c&&c.l(f),o=jt()},m(f,d){c&&c.m(f,d),Ie(f,o,d),l=!0},p(f,d){d[0]&1&&(r=f[23].tables.some(f[10])),r?c?(c.p(f,d),d[0]&1&&De(c,1)):(c=Om(f),c.c(),De(c,1),c.m(o.parentNode,o)):c&&(Ii(),Xe(c,1,1,()=>{c=null}),Pi())},i(f){l||(De(c),l=!0)},o(f){Xe(c),l=!1},d(f){c&&c.d(f),f&&Q(o)}}}function q2(u){let r,o,l,c,f,d,n,m,v,w,A,b,E,T;v=new Gy({props:{links:[{label:"Census",href:"/census"},{label:"Create a population group profile"}]}}),A=new g1({props:{title:"Create a population group profile",$$slots:{after:[L2]},$$scope:{ctx:u}}});let C=u[2]=="success"&&u[1].length>0&&Lm(u);return{c(){r=Be("meta"),o=Be("meta"),l=Be("meta"),c=Be("meta"),f=Be("meta"),d=Be("meta"),n=Be("meta"),m=ft(),Kt(v.$$.fragment),w=ft(),Kt(A.$$.fragment),b=ft(),C&&C.c(),E=jt(),this.h()},l(z){const B=Km("svelte-1fzc9rl",us.head);r=Re(B,"META",{name:!0,content:!0}),o=Re(B,"META",{property:!0,content:!0}),l=Re(B,"META",{property:!0,content:!0}),c=Re(B,"META",{property:!0,content:!0}),f=Re(B,"META",{property:!0,content:!0}),d=Re(B,"META",{property:!0,content:!0}),n=Re(B,"META",{name:!0,content:!0}),B.forEach(Q),m=dt(z),ei(v.$$.fragment,z),w=dt(z),ei(A.$$.fragment,z),b=dt(z),C&&C.l(z),E=jt(),this.h()},h(){us.title="Create a population group profile",fe(r,"name","description"),fe(r,"content",""),fe(o,"property","og:title"),fe(o,"content","Create a population group profile"),fe(l,"property","og:type"),fe(l,"content","website"),fe(c,"property","og:url"),fe(c,"content",Nh),fe(f,"property","og:image:type"),fe(f,"content","image/jpeg"),fe(d,"property","og:description"),fe(d,"content",""),fe(n,"name","description"),fe(n,"content","")},m(z,B){ke(us.head,r),ke(us.head,o),ke(us.head,l),ke(us.head,c),ke(us.head,f),ke(us.head,d),ke(us.head,n),Ie(z,m,B),Jt(v,z,B),Ie(z,w,B),Jt(A,z,B),Ie(z,b,B),C&&C.m(z,B),Ie(z,E,B),T=!0},p(z,B){const O={};B[0]&15|B[1]&2&&(O.$$scope={dirty:B,ctx:z}),A.$set(O),z[2]=="success"&&z[1].length>0?C?(C.p(z,B),B[0]&6&&De(C,1)):(C=Lm(z),C.c(),De(C,1),C.m(E.parentNode,E)):C&&(Ii(),Xe(C,1,1,()=>{C=null}),Pi())},i(z){T||(De(v.$$.fragment,z),De(A.$$.fragment,z),De(C),T=!0)},o(z){Xe(v.$$.fragment,z),Xe(A.$$.fragment,z),Xe(C),T=!1},d(z){Q(r),Q(o),Q(l),Q(c),Q(f),Q(d),Q(n),z&&Q(m),Yt(v,z),z&&Q(w),Yt(A,z),z&&Q(b),C&&C.d(z),z&&Q(E)}}}let Z2="light",H2=!0;function W2(u){let r=[];u.forEach(l=>r.push(l[0]));const o=u.flat().pop();return(u.length===1||o!=r[r.length-1])&&r.push(o),r}function Fh(u,r){const o=r.selected.residents[u].values;return o!=="blocked"&&o!==void 0}function Um(u,r,o){for(const l of r)Fh(l,u)?++o.available:u.selected.residents[l].values!==void 0&&++o.missing}const Vm=u=>u.key,X2=u=>u.detail.target.parentElement.parentElement.removeAttribute("open");function K2(u,r,o){let l;Nc(u,Py,J=>o(16,l=J));let{data:c}=r;_o("theme",Ay[Z2]);let f=[],d="success",n=!1,m=W1;function v(){O1(`${Nh}?${f.map(J=>`${J.key}=${J.code}`).join("&")}`,{noScroll:!0,keepFocus:!0})}function w(J,he){o(1,f=[...f.filter(we=>we.topic!==J.shortLabel),{topic:J.shortLabel,key:J.key,...he}]),v()}function A(J){o(1,f=f.filter(he=>he.topic!==J.shortLabel)),v()}function b(J){o(1,f=f.filter(he=>he.topic!=J)),v()}function E(J){let he={available:0,missing:0};for(const we of go[0].tablesCategorised)Um(J,we.tables.map(Se=>Se.code),he);return Um(J,["sex","resident_age_18b"],he),he}function T(J){const he={selectedCharacteristics:[{variable:"Placeholder variable 1",category:"Placeholder category 1"},{variable:"Placeholder variable 2",category:"Placeholder category 2"}],tableHeadings:["Category","Selected group","England and Wales"],sheets:[]};for(let ot of go[0].tables){if(ot.code==="resident_age_23a"||J.selected.residents[ot.code].values==null)continue;let oe={sheetName:ot.key,tableName:ot.code,rowData:ch[ot.code].map((Ve,K)=>({name:Ve.label,values:[J.selected.residents[ot.code].values.percent[K],J.all.residents[ot.code].values.percent[K]]}))};he.sheets.push(oe)}console.log({data:J,vars:Sd,datasets:go,codes:ch,odsData:he});let we=b2(he,g2);const Se=new y2;for(let{filename:ot,contents:oe}of we)Se.file(ot,oe);Se.generateAsync({type:"blob",compression:"DEFLATE"}).then(ot=>{let oe=new Blob([ot],{type:"application/vnd.oasis.opendocument.spreadsheet"}),Ve=URL.createObjectURL(oe);var K=document.createElement("a");K.setAttribute("href",Ve),K.setAttribute("download","data-download.ods"),K.style.display="none",document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(Ve)})}function C(J){o(0,c.selected=J.data,c),o(0,c.selected.total_pop=J.total_pop,c),o(0,c.geoPerc=[],c);let he;c.geoCodesAndNames.forEach(({code:Se,name:ot})=>{let oe=f.length===0?100:J.mapData[Se]!=null?J.mapData[Se][1]:null;c.geoPerc.push({code:Se,name:ot,value:oe})});let we=c.geoPerc.map(Se=>Se.value).filter(Se=>Se!=null);if(he=we.length===0?null:G1(we,Math.min(5,we.length)),!he)c.geoPerc.forEach(Se=>Se.color=$o.nodata),o(0,c.geoBreaks=[0,100],c);else if(f.length===0)c.geoPerc.forEach(Se=>Se.color=$o.seq[4]),o(0,c.geoBreaks=[100,100],c);else{let Se=W2(he);c.geoPerc.forEach(ot=>ot.color=ot.value!=null?L1(ot.value,Se,$o.seq):$o.nodata),o(0,c.geoBreaks=Se,c)}f.length,o(2,d=c.selected.total_pop.count==null?"failed":"success")}function z(){o(2,d="loading"),o(3,n=f&&f.some(J=>["Aged 4 years and under","Aged 5 to 9 years","Aged 10 to 14 years","Aged 15 years and under"].includes(J.label))),eg(go,f).then(C)}function B(){o(1,f=[]);for(let J of l.url.searchParams.entries()){let he=Sd.find(Se=>Se.key==J[0]);if(!he)continue;let we=he.cats.find(Se=>Se.code==J[1]);we&&f.push({topic:he.shortLabel,key:he.key,...we})}z()}F1(B);const O=J=>Fh(J.code,c),W=J=>b(J.topic),q=()=>T(c),Z=()=>print(),ae=J=>Fh(J.code,c);return u.$$set=J=>{"data"in J&&o(0,c=J.data)},u.$$.update=()=>{u.$$.dirty[0]&2&&console.log("selected",f)},[c,f,d,n,m,w,A,b,E,T,O,W,q,Z,ae]}class rw extends Vi{constructor(r){super(),Gi(this,r,K2,q2,Li,{data:0},null,[-1,-1])}}export{rw as component,iw as universal};
