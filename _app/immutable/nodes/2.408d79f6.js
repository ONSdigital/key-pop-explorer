import{T as Ly,c as Jv,m as Gm,a as qf,l as tc,b as Vo,d as Qa,p as Zm,e as dc,f as Yv,g as Qv,t as eb,v as Hm,h as tb}from"../chunks/Table.svelte_svelte_type_style_lang.2848e358.js";import{b as Td}from"../chunks/paths.4dc005b5.js";import{S as Wr,i as Kr,s as jr,e as Qt,b as Oe,v as Vr,d as it,f as $r,g as Ge,h as ie,y as ir,z as cr,A as nr,B as sr,C as Bi,k as Ve,a as St,l as $e,m as Ze,c as kt,n as ve,N as Kt,K as Me,D as Ni,E as Fi,F as Ui,Q as Vi,I as ma,J as ga,q as Mt,r as zt,u as Cr,V as Ry,W as Oy,U as eo,p as Ct,M as Xu,G as to,H as lh,X as Ju,L as _r,Y as By,Z as Ny,_ as Cd,O as Ss,$ as Fy,a0 as Uy,R as rb,w as pc,a1 as ch,a2 as uh,T as Vy,o as Id,a3 as hh,a4 as $y,x as Wm}from"../chunks/index.ba35b81f.js";import{p as ib}from"../chunks/stores.80800620.js";import{w as jy,h as qy}from"../chunks/singletons.fb069d3e.js";function nb(s){let e,a;return e=new Ly({props:{id:s[0],cls:s[1],theme:s[6],background:s[8],overrides:s[7],$$slots:{default:[ab]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&1&&(h.id=o[0]),c&2&&(h.cls=o[1]),c&64&&(h.theme=o[6]),c&256&&(h.background=o[8]),c&128&&(h.overrides=o[7]),c&5692&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function sb(s){let e,a;return e=new Ly({props:{id:s[0],cls:s[1],theme:s[6],background:s[8],overrides:s[7],$$slots:{default:[ob]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&1&&(h.id=o[0]),c&2&&(h.cls=o[1]),c&64&&(h.theme=o[6]),c&256&&(h.background=o[8]),c&128&&(h.overrides=o[7]),c&5692&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function Km(s){let e;return{c(){e=Ve("div"),this.h()},l(a){e=$e(a,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","ons-spacer")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function Xm(s){let e;return{c(){e=Ve("div"),this.h()},l(a){e=$e(a,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","ons-spacer")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function ab(s){let e,a,o,c,h,f=s[4]&&Km();const i=s[11].default,d=Bi(i,s,s[12],null);let g=s[5]&&Xm();return{c(){e=Ve("div"),f&&f.c(),a=St(),d&&d.c(),o=St(),g&&g.c(),this.h()},l(b){e=$e(b,"DIV",{id:!0,class:!0});var k=Ze(e);f&&f.l(k),a=kt(k),d&&d.l(k),o=kt(k),g&&g.l(k),k.forEach(ie),this.h()},h(){ve(e,"id",s[10]),ve(e,"class",c="ons-page__container ons-container "+s[9]+" svelte-1i9f2l"),Kt(e,"ons-page__container--wider",s[2]==="wider"),Kt(e,"ons-page__container--full",s[2]==="full"),Kt(e,"ons-page__container--tall-height",s[3]==="tall"),Kt(e,"ons-page__container--full-height",s[3]==="full")},m(b,k){Oe(b,e,k),f&&f.m(e,null),Me(e,a),d&&d.m(e,null),Me(e,o),g&&g.m(e,null),h=!0},p(b,k){b[4]?f||(f=Km(),f.c(),f.m(e,a)):f&&(f.d(1),f=null),d&&d.p&&(!h||k&4096)&&Ni(d,i,b,b[12],h?Ui(i,b[12],k,null):Fi(b[12]),null),b[5]?g||(g=Xm(),g.c(),g.m(e,null)):g&&(g.d(1),g=null),(!h||k&1024)&&ve(e,"id",b[10]),(!h||k&512&&c!==(c="ons-page__container ons-container "+b[9]+" svelte-1i9f2l"))&&ve(e,"class",c),(!h||k&516)&&Kt(e,"ons-page__container--wider",b[2]==="wider"),(!h||k&516)&&Kt(e,"ons-page__container--full",b[2]==="full"),(!h||k&520)&&Kt(e,"ons-page__container--tall-height",b[3]==="tall"),(!h||k&520)&&Kt(e,"ons-page__container--full-height",b[3]==="full")},i(b){h||(Ge(d,b),h=!0)},o(b){it(d,b),h=!1},d(b){b&&ie(e),f&&f.d(),d&&d.d(b),g&&g.d()}}}function Jm(s){let e;return{c(){e=Ve("div"),this.h()},l(a){e=$e(a,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","ons-spacer")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function Ym(s){let e;return{c(){e=Ve("div"),this.h()},l(a){e=$e(a,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","ons-spacer")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function ob(s){let e,a,o,c,h,f,i=s[4]&&Jm();const d=s[11].default,g=Bi(d,s,s[12],null);let b=s[5]&&Ym();return{c(){e=Ve("div"),i&&i.c(),a=St(),o=Ve("div"),g&&g.c(),c=St(),b&&b.c(),this.h()},l(k){e=$e(k,"DIV",{id:!0,class:!0});var x=Ze(e);i&&i.l(x),a=kt(x),o=$e(x,"DIV",{class:!0});var S=Ze(o);g&&g.l(S),S.forEach(ie),c=kt(x),b&&b.l(x),x.forEach(ie),this.h()},h(){ve(o,"class","svelte-1i9f2l"),Kt(o,"ons-page__container--narrow",s[2]==="narrow"),Kt(o,"ons-page__container--medium",s[2]==="medium"),ve(e,"id",s[10]),ve(e,"class",h="ons-page__container ons-container "+s[9]+" svelte-1i9f2l"),Kt(e,"ons-page__container--tall-height",s[3]==="tall"),Kt(e,"ons-page__container--full-height",s[3]==="full")},m(k,x){Oe(k,e,x),i&&i.m(e,null),Me(e,a),Me(e,o),g&&g.m(o,null),Me(e,c),b&&b.m(e,null),f=!0},p(k,x){k[4]?i||(i=Jm(),i.c(),i.m(e,a)):i&&(i.d(1),i=null),g&&g.p&&(!f||x&4096)&&Ni(g,d,k,k[12],f?Ui(d,k[12],x,null):Fi(k[12]),null),(!f||x&4)&&Kt(o,"ons-page__container--narrow",k[2]==="narrow"),(!f||x&4)&&Kt(o,"ons-page__container--medium",k[2]==="medium"),k[5]?b||(b=Ym(),b.c(),b.m(e,null)):b&&(b.d(1),b=null),(!f||x&1024)&&ve(e,"id",k[10]),(!f||x&512&&h!==(h="ons-page__container ons-container "+k[9]+" svelte-1i9f2l"))&&ve(e,"class",h),(!f||x&520)&&Kt(e,"ons-page__container--tall-height",k[3]==="tall"),(!f||x&520)&&Kt(e,"ons-page__container--full-height",k[3]==="full")},i(k){f||(Ge(g,k),f=!0)},o(k){it(g,k),f=!1},d(k){k&&ie(e),i&&i.d(),g&&g.d(k),b&&b.d()}}}function lb(s){let e,a,o,c,h;const f=[sb,nb],i=[];function d(g,b){return b&4&&(e=null),e==null&&(e=!!["narrow","medium"].includes(g[2])),e?0:1}return a=d(s,-1),o=i[a]=f[a](s),{c(){o.c(),c=Qt()},l(g){o.l(g),c=Qt()},m(g,b){i[a].m(g,b),Oe(g,c,b),h=!0},p(g,[b]){let k=a;a=d(g,b),a===k?i[a].p(g,b):(Vr(),it(i[k],1,1,()=>{i[k]=null}),$r(),o=i[a],o?o.p(g,b):(o=i[a]=f[a](g),o.c()),Ge(o,1),o.m(c.parentNode,c))},i(g){h||(Ge(o),h=!0)},o(g){it(o),h=!1},d(g){i[a].d(g),g&&ie(c)}}}function cb(s,e,a){let o,c,{$$slots:h={},$$scope:f}=e,{id:i=null}=e,{cls:d=null}=e,{width:g="wide"}=e,{height:b="auto"}=e,{marginTop:k=!1}=e,{marginBottom:x=!1}=e,{theme:S=null}=e,{themeOverrides:E=null}=e,{background:T=null}=e;return s.$$set=A=>{"id"in A&&a(0,i=A.id),"cls"in A&&a(1,d=A.cls),"width"in A&&a(2,g=A.width),"height"in A&&a(3,b=A.height),"marginTop"in A&&a(4,k=A.marginTop),"marginBottom"in A&&a(5,x=A.marginBottom),"theme"in A&&a(6,S=A.theme),"themeOverrides"in A&&a(7,E=A.themeOverrides),"background"in A&&a(8,T=A.background),"$$scope"in A&&a(12,f=A.$$scope)},s.$$.update=()=>{s.$$.dirty&321&&a(10,o=i&&!(S||T)?i:null),s.$$.dirty&322&&a(9,c=d&&!(S||T)?d:"")},[i,d,g,b,k,x,S,E,T,c,o,h,f]}class mc extends Wr{constructor(e){super(),Kr(this,e,cb,lb,jr,{id:0,cls:1,width:2,height:3,marginTop:4,marginBottom:5,theme:6,themeOverrides:7,background:8})}}var $o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fh(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Qm(s,e,a){const o=s.slice();return o[5]=e[a],o}function ub(s){let e=s[5].label+"",a;return{c(){a=Mt(e)},l(o){a=zt(o,e)},m(o,c){Oe(o,a,c)},p(o,c){c&1&&e!==(e=o[5].label+"")&&Cr(a,e)},d(o){o&&ie(a)}}}function hb(s){let e,a=s[5].label+"",o,c;return{c(){e=Ve("a"),o=Mt(a),this.h()},l(h){e=$e(h,"A",{class:!0,href:!0});var f=Ze(e);o=zt(f,a),f.forEach(ie),this.h()},h(){ve(e,"class","ons-breadcrumb__link"),ve(e,"href",c=s[5].href)},m(h,f){Oe(h,e,f),Me(e,o)},p(h,f){f&1&&a!==(a=h[5].label+"")&&Cr(o,a),f&1&&c!==(c=h[5].href)&&ve(e,"href",c)},d(h){h&&ie(e)}}}function eg(s){let e,a,o,c,h;function f(g,b){return g[5].href?hb:ub}let i=f(s),d=i(s);return{c(){e=Ve("li"),d.c(),a=St(),o=ma("svg"),c=ma("path"),h=St(),this.h()},l(g){e=$e(g,"LI",{class:!0});var b=Ze(e);d.l(b),a=kt(b),o=ga(b,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0});var k=Ze(o);c=ga(k,"path",{d:!0,transform:!0}),Ze(c).forEach(ie),k.forEach(ie),h=kt(b),b.forEach(ie),this.h()},h(){ve(c,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),ve(c,"transform","translate(-5.02 -1.59)"),ve(o,"class","ons-svg-icon svelte-w4p0hu"),ve(o,"viewBox","0 0 8 13"),ve(o,"xmlns","http://www.w3.org/2000/svg"),ve(o,"focusable","false"),ve(e,"class","ons-breadcrumb__item ons-u-p-no")},m(g,b){Oe(g,e,b),d.m(e,null),Me(e,a),Me(e,o),Me(o,c),Me(e,h)},p(g,b){i===(i=f(g))&&d?d.p(g,b):(d.d(1),d=i(g),d&&(d.c(),d.m(e,a)))},d(g){g&&ie(e),d.d()}}}function fb(s){let e,a,o=s[0],c=[];for(let h=0;h<o.length;h+=1)c[h]=eg(Qm(s,o,h));return{c(){e=Ve("nav"),a=Ve("ol");for(let h=0;h<c.length;h+=1)c[h].c();this.h()},l(h){e=$e(h,"NAV",{class:!0,"aria-label":!0});var f=Ze(e);a=$e(f,"OL",{class:!0});var i=Ze(a);for(let d=0;d<c.length;d+=1)c[d].l(i);i.forEach(ie),f.forEach(ie),this.h()},h(){ve(a,"class","ons-breadcrumb__items ons-u-fs-s"),ve(e,"class","ons-breadcrumb print--hide"),ve(e,"aria-label","Breadcrumbs")},m(h,f){Oe(h,e,f),Me(e,a);for(let i=0;i<c.length;i+=1)c[i]&&c[i].m(a,null)},p(h,f){if(f&1){o=h[0];let i;for(i=0;i<o.length;i+=1){const d=Qm(h,o,i);c[i]?c[i].p(d,f):(c[i]=eg(d),c[i].c(),c[i].m(a,null))}for(;i<c.length;i+=1)c[i].d(1);c.length=o.length}},d(h){h&&ie(e),Vi(c,h)}}}function db(s){let e,a;return e=new mc({props:{theme:s[2],themeOverrides:s[3],width:s[1],background:s[4],$$slots:{default:[fb]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,[c]){const h={};c&4&&(h.theme=o[2]),c&8&&(h.themeOverrides=o[3]),c&2&&(h.width=o[1]),c&16&&(h.background=o[4]),c&257&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function pb(s,e,a){let{links:o=[]}=e,{width:c="wide"}=e,{theme:h=null}=e,{themeOverrides:f=null}=e,{background:i=null}=e;return s.$$set=d=>{"links"in d&&a(0,o=d.links),"width"in d&&a(1,c=d.width),"theme"in d&&a(2,h=d.theme),"themeOverrides"in d&&a(3,f=d.themeOverrides),"background"in d&&a(4,i=d.background)},[o,c,h,f,i]}class mb extends Wr{constructor(e){super(),Kr(this,e,pb,db,jr,{links:0,width:1,theme:2,themeOverrides:3,background:4})}}function tg(s){let e,a;return{c(){e=Ve("h2"),a=Mt(s[3]),this.h()},l(o){e=$e(o,"H2",{class:!0});var c=Ze(e);a=zt(c,s[3]),c.forEach(ie),this.h()},h(){ve(e,"class","section-title"),Kt(e,"ons-u-vh",s[4])},m(o,c){Oe(o,e,c),Me(e,a)},p(o,c){c&8&&Cr(a,o[3]),c&16&&Kt(e,"ons-u-vh",o[4])},d(o){o&&ie(e)}}}function gb(s){let e,a,o,c=s[3]&&tg(s);const h=s[18].default,f=Bi(h,s,s[20],null);return{c(){c&&c.c(),e=St(),a=Ve("div"),f&&f.c(),this.h()},l(i){c&&c.l(i),e=kt(i),a=$e(i,"DIV",{class:!0});var d=Ze(a);f&&f.l(d),d.forEach(ie),this.h()},h(){ve(a,"class","grid "+s[12]+" svelte-1og4gya"),Ct(a,"grid-gap",s[14]),Ct(a,"min-height",s[13])},m(i,d){c&&c.m(i,d),Oe(i,e,d),Oe(i,a,d),f&&f.m(a,null),o=!0},p(i,d){i[3]?c?c.p(i,d):(c=tg(i),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null),f&&f.p&&(!o||d&1048576)&&Ni(f,h,i,i[20],o?Ui(h,i[20],d,null):Fi(i[20]),null)},i(i){o||(Ge(f,i),o=!0)},o(i){it(f,i),o=!1},d(i){c&&c.d(i),i&&ie(e),i&&ie(a),f&&f.d(i)}}}function rg(s){let e,a,o;return a=new mc({props:{cls:s[1],theme:s[5],themeOverrides:s[6],width:"narrow",marginBottom:s[8],$$slots:{default:[_b]},$$scope:{ctx:s}}}),{c(){e=Ve("figcaption"),ir(a.$$.fragment),this.h()},l(c){e=$e(c,"FIGCAPTION",{class:!0});var h=Ze(e);cr(a.$$.fragment,h),h.forEach(ie),this.h()},h(){ve(e,"class","svelte-1og4gya")},m(c,h){Oe(c,e,h),nr(a,e,null),o=!0},p(c,h){const f={};h&2&&(f.cls=c[1]),h&32&&(f.theme=c[5]),h&64&&(f.themeOverrides=c[6]),h&256&&(f.marginBottom=c[8]),h&1049088&&(f.$$scope={dirty:h,ctx:c}),a.$set(f)},i(c){o||(Ge(a.$$.fragment,c),o=!0)},o(c){it(a.$$.fragment,c),o=!1},d(c){c&&ie(e),sr(a)}}}function _b(s){let e;return{c(){e=Ve("span"),this.h()},l(a){e=$e(a,"SPAN",{class:!0});var o=Ze(e);o.forEach(ie),this.h()},h(){ve(e,"class","ons-figure__caption")},m(a,o){Oe(a,e,o),e.innerHTML=s[9]},p(a,o){o&512&&(e.innerHTML=a[9])},d(a){a&&ie(e)}}}function yb(s){let e,a,o,c,h;a=new mc({props:{id:s[0],cls:s[1],theme:s[5],themeOverrides:s[6],width:s[2],height:["tall","full"].includes(s[10])?s[10]:"auto",marginTop:s[7],marginBottom:s[9]?!1:s[8],$$slots:{default:[gb]},$$scope:{ctx:s}}});let f=s[9]&&rg(s);return{c(){e=Ve("figure"),ir(a.$$.fragment),o=St(),f&&f.c(),this.h()},l(i){e=$e(i,"FIGURE",{"aria-label":!0,class:!0});var d=Ze(e);cr(a.$$.fragment,d),o=kt(d),f&&f.l(d),d.forEach(ie),this.h()},h(){ve(e,"aria-label",s[9]),ve(e,"class","svelte-1og4gya"),Ry(()=>s[19].call(e))},m(i,d){Oe(i,e,d),nr(a,e,null),Me(e,o),f&&f.m(e,null),c=Oy(e,s[19].bind(e)),h=!0},p(i,[d]){const g={};d&1&&(g.id=i[0]),d&2&&(g.cls=i[1]),d&32&&(g.theme=i[5]),d&64&&(g.themeOverrides=i[6]),d&4&&(g.width=i[2]),d&1024&&(g.height=["tall","full"].includes(i[10])?i[10]:"auto"),d&128&&(g.marginTop=i[7]),d&768&&(g.marginBottom=i[9]?!1:i[8]),d&1048600&&(g.$$scope={dirty:d,ctx:i}),a.$set(g),i[9]?f?(f.p(i,d),d&512&&Ge(f,1)):(f=rg(i),f.c(),Ge(f,1),f.m(e,null)):f&&(Vr(),it(f,1,1,()=>{f=null}),$r()),(!h||d&512)&&ve(e,"aria-label",i[9])},i(i){h||(Ge(a.$$.fragment,i),Ge(f),h=!0)},o(i){it(a.$$.fragment,i),it(f),h=!1},d(i){i&&ie(e),sr(a),f&&f.d(),c()}}}function vb(s,e,a){let o,{$$slots:c={},$$scope:h}=e,{id:f=null}=e,{cls:i=null}=e,{width:d="medium"}=e,{title:g=""}=e,{hideTitle:b=!1}=e,{theme:k=null}=e,{themeOverrides:x=null}=e,{marginTop:S=!1}=e,{marginBottom:E=!0}=e,{colwidth:T="medium"}=e,{caption:A=""}=e,{height:z=200}=e,{gap:D=12}=e,F=!T||T==="full"?"":`grid-${T}`,$=z==="full"?"100vh":Number.isNaN(z)?z:z+"px",q=Number.isNaN(D)?D:D+"px";const J={narrow:{w:180,c:4},medium:{w:280,c:3},wide:{w:400,c:2},full:{w:"100%",c:1}};let G;const oe=jy(J[T].c);eo("cols",oe);function de(){G=this.clientWidth,a(11,G)}return s.$$set=Ee=>{"id"in Ee&&a(0,f=Ee.id),"cls"in Ee&&a(1,i=Ee.cls),"width"in Ee&&a(2,d=Ee.width),"title"in Ee&&a(3,g=Ee.title),"hideTitle"in Ee&&a(4,b=Ee.hideTitle),"theme"in Ee&&a(5,k=Ee.theme),"themeOverrides"in Ee&&a(6,x=Ee.themeOverrides),"marginTop"in Ee&&a(7,S=Ee.marginTop),"marginBottom"in Ee&&a(8,E=Ee.marginBottom),"colwidth"in Ee&&a(15,T=Ee.colwidth),"caption"in Ee&&a(9,A=Ee.caption),"height"in Ee&&a(10,z=Ee.height),"gap"in Ee&&a(16,D=Ee.gap),"$$scope"in Ee&&a(20,h=Ee.$$scope)},s.$$.update=()=>{s.$$.dirty&100352&&a(17,o=T=="full"?1:G?Math.floor((G+D)/(J[T].w+D)):J[T].c),s.$$.dirty&131072&&oe.set(o)},[f,i,d,g,b,k,x,S,E,A,z,G,F,$,q,T,D,o,c,de,h]}class bb extends Wr{constructor(e){super(),Kr(this,e,vb,yb,jr,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:15,caption:9,height:10,gap:16})}}function xb(s){let e;const a=s[13].default,o=Bi(a,s,s[14],null);return{c(){o&&o.c()},l(c){o&&o.l(c)},m(c,h){o&&o.m(c,h),e=!0},p(c,h){o&&o.p&&(!e||h&16384)&&Ni(o,a,c,c[14],e?Ui(a,c[14],h,null):Fi(c[14]),null)},i(c){e||(Ge(o,c),e=!0)},o(c){it(o,c),e=!1},d(c){o&&o.d(c)}}}function wb(s){let e,a;return e=new bb({props:{id:s[0],cls:s[1],width:s[2],height:s[10],title:s[3],hideTitle:s[4],theme:s[5],themeOverrides:s[6],marginTop:s[7],marginBottom:s[8],colwidth:s[9],gap:s[11],$$slots:{default:[xb]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,[c]){const h={};c&1&&(h.id=o[0]),c&2&&(h.cls=o[1]),c&4&&(h.width=o[2]),c&1024&&(h.height=o[10]),c&8&&(h.title=o[3]),c&16&&(h.hideTitle=o[4]),c&32&&(h.theme=o[5]),c&64&&(h.themeOverrides=o[6]),c&128&&(h.marginTop=o[7]),c&256&&(h.marginBottom=o[8]),c&512&&(h.colwidth=o[9]),c&2048&&(h.gap=o[11]),c&16384&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function Sb(s,e,a){let{$$slots:o={},$$scope:c}=e,{id:h=null}=e,{cls:f="ons-cards"}=e,{width:i="wide"}=e,{title:d=""}=e,{hideTitle:g=!1}=e,{theme:b=null}=e,{themeOverrides:k=null}=e,{marginTop:x=!1}=e,{marginBottom:S=!0}=e,{colwidth:E="medium"}=e,{height:T=200}=e,{noBackground:A=!1}=e,{gap:z=A?36:16}=e;return eo("noBackground",A),s.$$set=D=>{"id"in D&&a(0,h=D.id),"cls"in D&&a(1,f=D.cls),"width"in D&&a(2,i=D.width),"title"in D&&a(3,d=D.title),"hideTitle"in D&&a(4,g=D.hideTitle),"theme"in D&&a(5,b=D.theme),"themeOverrides"in D&&a(6,k=D.themeOverrides),"marginTop"in D&&a(7,x=D.marginTop),"marginBottom"in D&&a(8,S=D.marginBottom),"colwidth"in D&&a(9,E=D.colwidth),"height"in D&&a(10,T=D.height),"noBackground"in D&&a(12,A=D.noBackground),"gap"in D&&a(11,z=D.gap),"$$scope"in D&&a(14,c=D.$$scope)},[h,f,i,d,g,b,k,x,S,E,T,z,A,o,c]}class Ad extends Wr{constructor(e){super(),Kr(this,e,Sb,wb,jr,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:9,height:10,noBackground:12,gap:11})}}const ig=()=>Math.random().toString(16).slice(2,8),kb=(s,e=!1)=>typeof s=="string"?s.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").concat(e?`-${ig()}`:""):ig(),Eb=s=>{if(!s)return!1;const e=new Date(s);return!isNaN(e)},ng=(s,e="en-GB",a={year:"numeric",month:"long",day:"2-digit"})=>new Date(s).toLocaleDateString(e,a);function Tb(s){let e,a;return{c(){e=Ve("h3"),a=Mt(s[0]),this.h()},l(o){e=$e(o,"H3",{class:!0});var c=Ze(e);a=zt(c,s[0]),c.forEach(ie),this.h()},h(){ve(e,"class","ons-card__title ons-u-fs-m"),Kt(e,"ons-u-vh",s[2]),Ct(e,"padding",s[8]?"":"8px 16px 0"),Ct(e,"margin-bottom","5px")},m(o,c){Oe(o,e,c),Me(e,a)},p(o,c){c&1&&Cr(a,o[0]),c&4&&Kt(e,"ons-u-vh",o[2]),c&256&&Ct(e,"padding",o[8]?"":"8px 16px 0")},d(o){o&&ie(e)}}}function Cb(s){let e,a,o,c,h=s[3]&&sg(s);return{c(){e=Ve("a"),h&&h.c(),a=St(),o=Ve("h3"),c=Mt(s[0]),this.h()},l(f){e=$e(f,"A",{href:!0,class:!0});var i=Ze(e);h&&h.l(i),a=kt(i),o=$e(i,"H3",{class:!0});var d=Ze(o);c=zt(d,s[0]),d.forEach(ie),i.forEach(ie),this.h()},h(){ve(o,"class","ons-card__title ons-u-fs-m"),Ct(o,"padding",!s[8]&&!s[3]?"12px 16px 0":s[8]?"":"0 16px"),ve(e,"href",s[5]),ve(e,"class","ons-card__link ons-u-db"),Kt(e,"ons-u-vh",s[2])},m(f,i){Oe(f,e,i),h&&h.m(e,null),Me(e,a),Me(e,o),Me(o,c)},p(f,i){f[3]?h?h.p(f,i):(h=sg(f),h.c(),h.m(e,a)):h&&(h.d(1),h=null),i&1&&Cr(c,f[0]),i&264&&Ct(o,"padding",!f[8]&&!f[3]?"12px 16px 0":f[8]?"":"0 16px"),i&32&&ve(e,"href",f[5]),i&4&&Kt(e,"ons-u-vh",f[2])},d(f){f&&ie(e),h&&h.d()}}}function sg(s){let e,a;return{c(){e=Ve("img"),this.h()},l(o){e=$e(o,"IMG",{class:!0,src:!0,alt:!0,loading:!0}),this.h()},h(){ve(e,"class","ons-card__image ons-u-mb-s svelte-k1nrya"),Ju(e.src,a=s[3])||ve(e,"src",a),ve(e,"alt",s[4]),ve(e,"loading","lazy"),Ct(e,"width","100%")},m(o,c){Oe(o,e,c)},p(o,c){c&8&&!Ju(e.src,a=o[3])&&ve(e,"src",a),c&16&&ve(e,"alt",o[4])},d(o){o&&ie(e)}}}function Ib(s){let e,a,o,c,h,f,i,d=`span ${s[9]&&s[10]<3?s[10]:s[6]==1?1:s[6]>s[10]?s[10]:s[6]}`,g;function b(T,A){if(T[5]&&T[0])return Cb;if(T[0])return Tb}let k=b(s),x=k&&k(s);const S=s[13].default,E=Bi(S,s,s[12],null);return{c(){e=Ve("div"),a=Ve("div"),x&&x.c(),o=St(),c=Ve("div"),E&&E.c(),this.h()},l(T){e=$e(T,"DIV",{class:!0});var A=Ze(e);a=$e(A,"DIV",{id:!0,class:!0,"aria-describedby":!0});var z=Ze(a);x&&x.l(z),o=kt(z),c=$e(z,"DIV",{id:!0,class:!0});var D=Ze(c);E&&E.l(D),D.forEach(ie),z.forEach(ie),A.forEach(ie),this.h()},h(){ve(c,"id",h=s[1]+"_text"),ve(c,"class","svelte-k1nrya"),Kt(c,"tile__body",!s[8]),ve(a,"id",s[1]),ve(a,"class","ons-card"),ve(a,"aria-describedby",f=s[1]+"_text"),ve(e,"class",i=Xu(s[8]?"":"tile tile__content")+" svelte-k1nrya"),Ct(e,"grid-column",d),Ct(e,"grid-column-end",s[9]?s[10]+1:null),Ct(e,"grid-row",s[7]>1?`span ${s[7]}`:null)},m(T,A){Oe(T,e,A),Me(e,a),x&&x.m(a,null),Me(a,o),Me(a,c),E&&E.m(c,null),g=!0},p(T,[A]){k===(k=b(T))&&x?x.p(T,A):(x&&x.d(1),x=k&&k(T),x&&(x.c(),x.m(a,o))),E&&E.p&&(!g||A&4096)&&Ni(E,S,T,T[12],g?Ui(S,T[12],A,null):Fi(T[12]),null),(!g||A&2&&h!==(h=T[1]+"_text"))&&ve(c,"id",h),(!g||A&256)&&Kt(c,"tile__body",!T[8]),(!g||A&2)&&ve(a,"id",T[1]),(!g||A&2&&f!==(f=T[1]+"_text"))&&ve(a,"aria-describedby",f),(!g||A&256&&i!==(i=Xu(T[8]?"":"tile tile__content")+" svelte-k1nrya"))&&ve(e,"class",i),A&1600&&d!==(d=`span ${T[9]&&T[10]<3?T[10]:T[6]==1?1:T[6]>T[10]?T[10]:T[6]}`)&&Ct(e,"grid-column",d),A&1536&&Ct(e,"grid-column-end",T[9]?T[10]+1:null),A&128&&Ct(e,"grid-row",T[7]>1?`span ${T[7]}`:null)},i(T){g||(Ge(E,T),g=!0)},o(T){it(E,T),g=!1},d(T){T&&ie(e),x&&x.d(),E&&E.d(T)}}}function Ab(s,e,a){let o,{$$slots:c={},$$scope:h}=e,{title:f=null}=e,{id:i=kb(f)}=e,{hideTitle:d=!1}=e,{image:g=null}=e,{imageAlt:b=null}=e,{href:k=null}=e,{colspan:x=1}=e,{rowspan:S=1}=e,{noBackground:E=to("noBackground")||!1}=e,{grow:T=!1}=e;const A=to("cols");return lh(s,A,z=>a(10,o=z)),s.$$set=z=>{"title"in z&&a(0,f=z.title),"id"in z&&a(1,i=z.id),"hideTitle"in z&&a(2,d=z.hideTitle),"image"in z&&a(3,g=z.image),"imageAlt"in z&&a(4,b=z.imageAlt),"href"in z&&a(5,k=z.href),"colspan"in z&&a(6,x=z.colspan),"rowspan"in z&&a(7,S=z.rowspan),"noBackground"in z&&a(8,E=z.noBackground),"grow"in z&&a(9,T=z.grow),"$$scope"in z&&a(12,h=z.$$scope)},[f,i,d,g,b,k,x,S,E,T,o,A,h,c]}class qs extends Wr{constructor(e){super(),Kr(this,e,Ab,Ib,jr,{title:0,id:1,hideTitle:2,image:3,imageAlt:4,href:5,colspan:6,rowspan:7,noBackground:8,grow:9})}}function ag(s){let e,a;return{c(){e=Ve("div"),a=Mt("!"),this.h()},l(o){e=$e(o,"DIV",{class:!0,"aria-hidden":!0});var c=Ze(e);a=zt(c,"!"),c.forEach(ie),this.h()},h(){ve(e,"class","ons-panel__icon"),ve(e,"aria-hidden","true")},m(o,c){Oe(o,e,c),Me(e,a)},d(o){o&&ie(e)}}}function og(s){let e,a,o;return{c(){e=Ve("p"),a=Ve("strong"),o=Mt(s[0])},l(c){e=$e(c,"P",{});var h=Ze(e);a=$e(h,"STRONG",{});var f=Ze(a);o=zt(f,s[0]),f.forEach(ie),h.forEach(ie)},m(c,h){Oe(c,e,h),Me(e,a),Me(a,o)},p(c,h){h&1&&Cr(o,c[0])},d(c){c&&ie(e)}}}function Pb(s){let e,a,o,c,h,f,i,d,g,b,k,x=s[1]&&ag(),S=s[0]&&og(s);const E=s[5].default,T=Bi(E,s,s[4],null);return{c(){e=Ve("div"),a=Ve("div"),x&&x.c(),o=St(),c=Ve("span"),h=Mt("Important information:"),f=St(),i=Ve("div"),d=Ve("div"),S&&S.c(),g=St(),b=Ve("p"),T&&T.c(),this.h()},l(A){e=$e(A,"DIV",{class:!0,style:!0});var z=Ze(e);a=$e(z,"DIV",{class:!0});var D=Ze(a);x&&x.l(D),o=kt(D),c=$e(D,"SPAN",{class:!0});var F=Ze(c);h=zt(F,"Important information:"),F.forEach(ie),f=kt(D),i=$e(D,"DIV",{class:!0});var $=Ze(i);d=$e($,"DIV",{class:!0});var q=Ze(d);S&&S.l(q),g=kt(q),b=$e(q,"P",{class:!0});var J=Ze(b);T&&T.l(J),J.forEach(ie),q.forEach(ie),$.forEach(ie),D.forEach(ie),z.forEach(ie),this.h()},h(){ve(c,"class","ons-panel__assistive-text ons-u-vh"),ve(b,"class","ons-u-mb-no"),ve(d,"class","ons-u-fs-r default-line-height"),ve(i,"class","ons-panel__body"),ve(a,"class","ons-u-bg--tr"),Kt(a,"ons-panel--warn",s[1]),ve(e,"class","ons-panel ons-panel--info ons-panel--no-title ons-u-mt-m ons-u-mb-l svelte-g4zlbx"),ve(e,"style",s[2])},m(A,z){Oe(A,e,z),Me(e,a),x&&x.m(a,null),Me(a,o),Me(a,c),Me(c,h),Me(a,f),Me(a,i),Me(i,d),S&&S.m(d,null),Me(d,g),Me(d,b),T&&T.m(b,null),k=!0},p(A,[z]){A[1]?x||(x=ag(),x.c(),x.m(a,o)):x&&(x.d(1),x=null),A[0]?S?S.p(A,z):(S=og(A),S.c(),S.m(d,g)):S&&(S.d(1),S=null),T&&T.p&&(!k||z&16)&&Ni(T,E,A,A[4],k?Ui(E,A[4],z,null):Fi(A[4]),null),(!k||z&2)&&Kt(a,"ons-panel--warn",A[1]),(!k||z&4)&&ve(e,"style",A[2])},i(A){k||(Ge(T,A),k=!0)},o(A){it(T,A),k=!1},d(A){A&&ie(e),x&&x.d(),S&&S.d(),T&&T.d(A)}}}function Mb(s,e,a){let o,{$$slots:c={},$$scope:h}=e,{title:f=null}=e,{important:i=!1}=e,{mode:d="info"}=e;return s.$$set=g=>{"title"in g&&a(0,f=g.title),"important"in g&&a(1,i=g.important),"mode"in g&&a(3,d=g.mode),"$$scope"in g&&a(4,h=g.$$scope)},s.$$.update=()=>{s.$$.dirty&8&&a(2,o=d==="success"?"background: var(--ons-color-success-tint); border-color: var(--ons-color-success);":d==="pending"?"background: var(--ons-color-pending-tint); border-color: var(--ons-color-pending);":d==="error"?"background: var(--ons-color-errors-tint); border-color: var(--ons-color-errors);":null)},[f,i,o,d,h,c]}class Gy extends Wr{constructor(e){super(),Kr(this,e,Mb,Pb,jr,{title:0,important:1,mode:3})}}function lg(s,e,a){const o=s.slice();return o[1]=e[a],o[3]=a,o}function cg(s){let e,a=s[0],o=[];for(let c=0;c<a.length;c+=1)o[c]=hg(lg(s,a,c));return{c(){e=Ve("dl");for(let c=0;c<o.length;c+=1)o[c].c();this.h()},l(c){e=$e(c,"DL",{class:!0,title:!0,"aria-label":!0});var h=Ze(e);for(let f=0;f<o.length;f+=1)o[f].l(h);h.forEach(ie),this.h()},h(){ve(e,"class","ons-metadata metadata__list ons-grid ons-grid--gutterless ons-u-cf ons-u-mb-m"),ve(e,"title","Dataset ID and release date information"),ve(e,"aria-label","Dataset ID and release date information")},m(c,h){Oe(c,e,h);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(e,null)},p(c,h){if(h&1){a=c[0];let f;for(f=0;f<a.length;f+=1){const i=lg(c,a,f);o[f]?o[f].p(i,h):(o[f]=hg(i),o[f].c(),o[f].m(e,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=a.length}},d(c){c&&ie(e),Vi(o,c)}}}function zb(s){let e,a=s[1].value+"",o;return{c(){e=new By(!1),o=Qt(),this.h()},l(c){e=Ny(c,!1),o=Qt(),this.h()},h(){e.a=o},m(c,h){e.m(a,c,h),Oe(c,o,h)},p(c,h){h&1&&a!==(a=c[1].value+"")&&e.p(a)},d(c){c&&ie(o),c&&e.d()}}}function Db(s){let e,a=ng(s[1].value)+"",o,c,h,f,i=s[1].extra&&ug(s);return{c(){e=Ve("time"),o=Mt(a),h=St(),i&&i.c(),f=Qt(),this.h()},l(d){e=$e(d,"TIME",{datetime:!0});var g=Ze(e);o=zt(g,a),g.forEach(ie),h=kt(d),i&&i.l(d),f=Qt(),this.h()},h(){ve(e,"datetime",c=new Date(s[1].value).toISOString())},m(d,g){Oe(d,e,g),Me(e,o),Oe(d,h,g),i&&i.m(d,g),Oe(d,f,g)},p(d,g){g&1&&a!==(a=ng(d[1].value)+"")&&Cr(o,a),g&1&&c!==(c=new Date(d[1].value).toISOString())&&ve(e,"datetime",c),d[1].extra?i?i.p(d,g):(i=ug(d),i.c(),i.m(f.parentNode,f)):i&&(i.d(1),i=null)},d(d){d&&ie(e),d&&ie(h),i&&i.d(d),d&&ie(f)}}}function ug(s){let e,a=s[1].extra+"",o;return{c(){e=new By(!1),o=Qt(),this.h()},l(c){e=Ny(c,!1),o=Qt(),this.h()},h(){e.a=o},m(c,h){e.m(a,c,h),Oe(c,o,h)},p(c,h){h&1&&a!==(a=c[1].extra+"")&&e.p(a)},d(c){c&&ie(o),c&&e.d()}}}function hg(s){let e,a,o=s[1].key+"",c,h,f,i,d,g,b;function k(E,T){return T&1&&(d=null),d==null&&(d=!!Eb(E[1].value)),d?Db:zb}let x=k(s,-1),S=x(s);return{c(){e=Ve("div"),a=Ve("dt"),c=Mt(o),h=Mt(":"),f=St(),i=Ve("dd"),S.c(),g=St(),this.h()},l(E){e=$e(E,"DIV",{class:!0});var T=Ze(e);a=$e(T,"DT",{class:!0});var A=Ze(a);c=zt(A,o),h=zt(A,":"),A.forEach(ie),f=kt(T),i=$e(T,"DD",{class:!0});var z=Ze(i);S.l(z),z.forEach(ie),g=kt(T),T.forEach(ie),this.h()},h(){ve(a,"class","ons-metadata__term ons-u-mr-xs"),ve(i,"class","ons-metadata__value ons-u-f-no"),ve(e,"class",b="ons-grid__col ons-col-"+(s[1].col?s[1].col:12)+"@m"),Kt(e,"ons-u-mt-xs",s[3]!==0)},m(E,T){Oe(E,e,T),Me(e,a),Me(a,c),Me(a,h),Me(e,f),Me(e,i),S.m(i,null),Me(e,g)},p(E,T){T&1&&o!==(o=E[1].key+"")&&Cr(c,o),x===(x=k(E,T))&&S?S.p(E,T):(S.d(1),S=x(E),S&&(S.c(),S.m(i,null))),T&1&&b!==(b="ons-grid__col ons-col-"+(E[1].col?E[1].col:12)+"@m")&&ve(e,"class",b),T&1&&Kt(e,"ons-u-mt-xs",E[3]!==0)},d(E){E&&ie(e),S.d()}}}function Lb(s){let e=Array.isArray(s[0]),a,o=e&&cg(s);return{c(){o&&o.c(),a=Qt()},l(c){o&&o.l(c),a=Qt()},m(c,h){o&&o.m(c,h),Oe(c,a,h)},p(c,[h]){h&1&&(e=Array.isArray(c[0])),e?o?o.p(c,h):(o=cg(c),o.c(),o.m(a.parentNode,a)):o&&(o.d(1),o=null)},i:_r,o:_r,d(c){o&&o.d(c),c&&ie(a)}}}function Rb(s,e,a){let{meta:o=null}=e;return s.$$set=c=>{"meta"in c&&a(0,o=c.meta)},[o]}class Ob extends Wr{constructor(e){super(),Kr(this,e,Rb,Lb,jr,{meta:0})}}const Bb=s=>({}),fg=s=>({}),Nb=s=>({}),dg=s=>({}),Fb=s=>({}),pg=s=>({});function mg(s){let e,a,o,c,h;return{c(){e=Ve("div"),a=Ve("div"),o=Ve("a"),c=Ve("img"),this.h()},l(f){e=$e(f,"DIV",{class:!0});var i=Ze(e);a=$e(i,"DIV",{class:!0});var d=Ze(a);o=$e(d,"A",{href:!0,class:!0});var g=Ze(o);c=$e(g,"IMG",{src:!0,alt:!0,class:!0}),g.forEach(ie),d.forEach(ie),i.forEach(ie),this.h()},h(){Ju(c.src,h="//cdn.ons.gov.uk/assets/images/ons-logo/kitemark/uksa-kitemark.svg")||ve(c,"src",h),ve(c,"alt","UK Statistics Authority Kitemark"),ve(c,"class","national-statistics__logo"),ve(o,"href","https://uksa.statisticsauthority.gov.uk/about-the-authority/uk-statistical-system/types-of-official-statistics/"),ve(o,"class","national-statistics__link ons-u-fs-xxxl"),ve(a,"class","ons-grid--flex ons-grid--between@m ons-u-mt-s@m ons-u-mb-m@xxs ons-u-flex-jc-fe@m"),ve(e,"class","ons-grid__col ons-col-2@m svelte-lohx48")},m(f,i){Oe(f,e,i),Me(e,a),Me(a,o),Me(o,c)},d(f){f&&ie(e)}}}function gg(s){let e,a,o,c;return{c(){e=Ve("div"),a=Ve("div"),o=Ve("img"),this.h()},l(h){e=$e(h,"DIV",{class:!0});var f=Ze(e);a=$e(f,"DIV",{class:!0});var i=Ze(a);o=$e(i,"IMG",{src:!0,title:!0,alt:!0,class:!0,focusable:!0,width:!0,height:!0}),i.forEach(ie),f.forEach(ie),this.h()},h(){Ju(o.src,c="https://cdn.ons.gov.uk/assets/images/census-logo/logo-census-2021-purple-landscape.svg")||ve(o,"src",c),ve(o,"title","Census 2021"),ve(o,"alt","Census 2021"),ve(o,"class","header__svg-logo margin-right--1"),ve(o,"focusable","false"),ve(o,"width","167"),ve(o,"height","32"),ve(a,"class","ons-grid__col svelte-lohx48"),ve(e,"class","ons-grid ons-u-mb-m")},m(h,f){Oe(h,e,f),Me(e,a),Me(a,o)},d(h){h&&ie(e)}}}function Ub(s){let e,a,o,c,h,f,i,d,g,b,k,x,S;const E=s[7].before,T=Bi(E,s,s[8],pg);let A=s[1]&&mg();const z=s[7].brand,D=Bi(z,s,s[8],dg);let F=s[2]&&gg();k=new Ob({props:{meta:s[3]}});const $=s[7].after,q=Bi($,s,s[8],fg);return{c(){e=Ve("section"),T&&T.c(),a=St(),o=Ve("div"),c=Ve("div"),h=Ve("h1"),f=Mt(s[0]),i=St(),A&&A.c(),d=St(),D&&D.c(),g=St(),F&&F.c(),b=St(),ir(k.$$.fragment),x=St(),q&&q.c(),this.h()},l(J){e=$e(J,"SECTION",{class:!0});var G=Ze(e);T&&T.l(G),a=kt(G),o=$e(G,"DIV",{class:!0});var oe=Ze(o);c=$e(oe,"DIV",{class:!0});var de=Ze(c);h=$e(de,"H1",{class:!0});var Ee=Ze(h);f=zt(Ee,s[0]),Ee.forEach(ie),de.forEach(ie),i=kt(oe),A&&A.l(oe),oe.forEach(ie),d=kt(G),D&&D.l(G),g=kt(G),F&&F.l(G),b=kt(G),cr(k.$$.fragment,G),x=kt(G),q&&q.l(G),G.forEach(ie),this.h()},h(){ve(h,"class","ons-u-fs-xxxl ons-u-mt-s ons-u-mb-m ons-u-pb-no ons-u-pt-no"),ve(c,"class","ons-grid__col ons-col-10@m svelte-lohx48"),ve(o,"class","ons-grid"),ve(e,"class","ons-u-mb-xl")},m(J,G){Oe(J,e,G),T&&T.m(e,null),Me(e,a),Me(e,o),Me(o,c),Me(c,h),Me(h,f),Me(o,i),A&&A.m(o,null),Me(e,d),D&&D.m(e,null),Me(e,g),F&&F.m(e,null),Me(e,b),nr(k,e,null),Me(e,x),q&&q.m(e,null),S=!0},p(J,G){T&&T.p&&(!S||G&256)&&Ni(T,E,J,J[8],S?Ui(E,J[8],G,Fb):Fi(J[8]),pg),(!S||G&1)&&Cr(f,J[0]),J[1]?A||(A=mg(),A.c(),A.m(o,null)):A&&(A.d(1),A=null),D&&D.p&&(!S||G&256)&&Ni(D,z,J,J[8],S?Ui(z,J[8],G,Nb):Fi(J[8]),dg),J[2]?F||(F=gg(),F.c(),F.m(e,b)):F&&(F.d(1),F=null);const oe={};G&8&&(oe.meta=J[3]),k.$set(oe),q&&q.p&&(!S||G&256)&&Ni(q,$,J,J[8],S?Ui($,J[8],G,Bb):Fi(J[8]),fg)},i(J){S||(Ge(T,J),Ge(D,J),Ge(k.$$.fragment,J),Ge(q,J),S=!0)},o(J){it(T,J),it(D,J),it(k.$$.fragment,J),it(q,J),S=!1},d(J){J&&ie(e),T&&T.d(J),A&&A.d(),D&&D.d(J),F&&F.d(),sr(k),q&&q.d(J)}}}function Vb(s){let e,a;return e=new mc({props:{theme:s[4],themeOverrides:s[5],background:s[6],$$slots:{default:[Ub]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,[c]){const h={};c&16&&(h.theme=o[4]),c&32&&(h.themeOverrides=o[5]),c&64&&(h.background=o[6]),c&271&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function $b(s,e,a){let{$$slots:o={},$$scope:c}=e,{title:h="Page title"}=e,{natStatBadge:f=!1}=e,{censusLogo:i=!1}=e,{meta:d=null}=e,{theme:g=null}=e,{themeOverrides:b=null}=e,{background:k=null}=e;return s.$$set=x=>{"title"in x&&a(0,h=x.title),"natStatBadge"in x&&a(1,f=x.natStatBadge),"censusLogo"in x&&a(2,i=x.censusLogo),"meta"in x&&a(3,d=x.meta),"theme"in x&&a(4,g=x.theme),"themeOverrides"in x&&a(5,b=x.themeOverrides),"background"in x&&a(6,k=x.background),"$$scope"in x&&a(8,c=x.$$scope)},[h,f,i,d,g,b,k,o,c]}class jb extends Wr{constructor(e){super(),Kr(this,e,$b,Vb,jr,{title:0,natStatBadge:1,censusLogo:2,meta:3,theme:4,themeOverrides:5,background:6})}}function _g(s){let e,a,o,c;return{c(){e=ma("svg"),a=ma("path"),this.h()},l(h){e=ga(h,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var f=Ze(e);a=ga(f,"path",{d:!0}),Ze(a).forEach(ie),f.forEach(ie),this.h()},h(){ve(a,"d",o=s[3][s[0]].d),ve(e,"class","ons-svg-icon"),ve(e,"viewBox",c=s[3][s[0]].viewBox),ve(e,"xmlns","http://www.w3.org/2000/svg"),ve(e,"focusable","false"),ve(e,"fill","currentColor"),Kt(e,"ons-u-ml-xs",s[1]),Kt(e,"ons-u-mr-xs",s[2])},m(h,f){Oe(h,e,f),Me(e,a)},p(h,f){f&1&&o!==(o=h[3][h[0]].d)&&ve(a,"d",o),f&1&&c!==(c=h[3][h[0]].viewBox)&&ve(e,"viewBox",c),f&2&&Kt(e,"ons-u-ml-xs",h[1]),f&4&&Kt(e,"ons-u-mr-xs",h[2])},d(h){h&&ie(e)}}}function qb(s){let e,a=s[3][s[0]]&&_g(s);return{c(){a&&a.c(),e=Qt()},l(o){a&&a.l(o),e=Qt()},m(o,c){a&&a.m(o,c),Oe(o,e,c)},p(o,[c]){o[3][o[0]]?a?a.p(o,c):(a=_g(o),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null)},i:_r,o:_r,d(o){a&&a.d(o),o&&ie(e)}}}function Gb(s,e,a){let{type:o="arrow"}=e,{marginLeft:c=!1}=e,{marginRight:h=!1}=e;const f={arrow:{d:"m10 .2-.9.9c-.1.1-.1.4 0 .5l4 4H.6c-.2 0-.4.2-.4.4v1.2c0 .2.2.4.4.4h12.5l-3.9 3.7c-.2.2-.2.4 0 .6l.8.9c.2.2.4.2.6 0L16.8 7c.2-.2.2-.4 0-.6L10.7.3c-.3-.2-.5-.2-.7-.1z",viewBox:"0 0 17 13"},externalLink:{d:"M13.5,9H13a.5.5,0,0,0-.5.5v3h-9v-9h3A.5.5,0,0,0,7,3V2.5A.5.5,0,0,0,6.5,2h-4a.5.5,0,0,0-.5.5v11a.5.5,0,0,0,.5.5h11a.5.5,0,0,0,.5-.5v-4A.5.5,0,0,0,13.5,9Z M8.83,7.88a.51.51,0,0,0,.71,0l2.31-2.32,1.28,1.28A.51.51,0,0,0,14,6.49v-4a.52.52,0,0,0-.5-.5h-4A.51.51,0,0,0,9,2.52a.58.58,0,0,0,.14.33l1.28,1.28L8.12,6.46a.51.51,0,0,0,0,.71Z",viewBox:"2 2 12 12"},signout:{d:"M13.85,7.65l-2.5-2.5a.5.5,0,0,0-.71,0,.48.48,0,0,0-.15.36V7h-3a.5.5,0,0,0-.5.5v1a.5.5,0,0,0,.5.5h3v1.5A.49.49,0,0,0,11,11a.48.48,0,0,0,.34-.14l2.51-2.5a.49.49,0,0,0,0-.68Z M8.5,14h-6a.5.5,0,0,1-.5-.5V2.5A.5.5,0,0,1,2.5,2h6a.5.5,0,0,1,.5.5V3a.5.5,0,0,1-.5.5h-5v9h5A.5.5,0,0,1,9,13v.5A.5.5,0,0,1,8.5,14Z",viewBox:"0 0 12 12"},print:{d:"M17 4H3C1.3 4 0 5.2 0 6.8v5.5h4V16h12v-3.7h4V6.8C20 5.2 18.7 4 17 4zm-3 10H6V9h8v5zm3-6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-1-8H4v3h12V0z",viewBox:"0 0 20 16"},download:{d:"M5.6 9a.48.48 0 0 0 .7 0l3-3.2a.48.48 0 0 0 0-.7C9.3 5 9.2 5 9 5H7.5V.5A.47.47 0 0 0 7 0H5a.47.47 0 0 0-.5.5V5H3a.47.47 0 0 0-.5.5.37.37 0 0 0 .1.3Z M11.5 9H11a.47.47 0 0 0-.5.5v1h-9v-1A.47.47 0 0 0 1 9H.5a.47.47 0 0 0-.5.5v2a.47.47 0 0 0 .5.5h11a.47.47 0 0 0 .5-.5v-2a.47.47 0 0 0-.5-.5Z",viewBox:"0 0 12 12"},tick:{d:"M14.35,3.9l-.71-.71a.5.5,0,0,0-.71,0h0L5.79,10.34,3.07,7.61a.51.51,0,0,0-.71,0l-.71.71a.51.51,0,0,0,0,.71l3.78,3.78a.5.5,0,0,0,.71,0h0L14.35,4.6A.5.5,0,0,0,14.35,3.9Z",viewBox:"1.5 3 13 10"},search:{d:"M11.86 10.23 8.62 6.99a4.63 4.63 0 1 0-6.34 1.64 4.55 4.55 0 0 0 2.36.64 4.65 4.65 0 0 0 2.33-.65l3.24 3.23a.46.46 0 0 0 .65 0l1-1a.48.48 0 0 0 0-.62Zm-5-3.32a3.28 3.28 0 0 1-2.31.93 3.22 3.22 0 1 1 2.35-.93Z",viewBox:"0 0 12 12"}};return s.$$set=i=>{"type"in i&&a(0,o=i.type),"marginLeft"in i&&a(1,c=i.marginLeft),"marginRight"in i&&a(2,h=i.marginRight)},[o,c,h,f]}let dh=class extends Wr{constructor(e){super(),Kr(this,e,Gb,qb,jr,{type:0,marginLeft:1,marginRight:2})}};function Zb(s){let e,a,o,c,h,f,i,d,g=s[4]&&s[5]==="before"&&yg(s);const b=s[9].default,k=Bi(b,s,s[8],null);let x=s[4]&&s[5]==="after"&&vg(s);return{c(){e=Ve("button"),a=Ve("span"),g&&g.c(),o=St(),c=Ve("span"),k&&k.c(),h=St(),x&&x.c(),this.h()},l(S){e=$e(S,"BUTTON",{type:!0,class:!0});var E=Ze(e);a=$e(E,"SPAN",{class:!0});var T=Ze(a);g&&g.l(T),o=kt(T),c=$e(T,"SPAN",{class:!0});var A=Ze(c);k&&k.l(A),A.forEach(ie),h=kt(T),x&&x.l(T),T.forEach(ie),E.forEach(ie),this.h()},h(){ve(c,"class","ons-btn__text"),ve(a,"class","ons-btn__inner"),ve(e,"type",s[0]),ve(e,"class","ons-btn"),e.disabled=s[6],Kt(e,"ons-btn--small",s[3]),Kt(e,"ons-btn--secondary",s[1]==="secondary"),Kt(e,"ons-btn--ghost",s[1]==="ghost"),Kt(e,"ons-btn--disabled",s[6])},m(S,E){Oe(S,e,E),Me(e,a),g&&g.m(a,null),Me(a,o),Me(a,c),k&&k.m(c,null),Me(a,h),x&&x.m(a,null),f=!0,i||(d=Ss(e,"click",s[11]),i=!0)},p(S,E){S[4]&&S[5]==="before"?g?(g.p(S,E),E&48&&Ge(g,1)):(g=yg(S),g.c(),Ge(g,1),g.m(a,o)):g&&(Vr(),it(g,1,1,()=>{g=null}),$r()),k&&k.p&&(!f||E&256)&&Ni(k,b,S,S[8],f?Ui(b,S[8],E,null):Fi(S[8]),null),S[4]&&S[5]==="after"?x?(x.p(S,E),E&48&&Ge(x,1)):(x=vg(S),x.c(),Ge(x,1),x.m(a,null)):x&&(Vr(),it(x,1,1,()=>{x=null}),$r()),(!f||E&1)&&ve(e,"type",S[0]),(!f||E&64)&&(e.disabled=S[6]),(!f||E&8)&&Kt(e,"ons-btn--small",S[3]),(!f||E&2)&&Kt(e,"ons-btn--secondary",S[1]==="secondary"),(!f||E&2)&&Kt(e,"ons-btn--ghost",S[1]==="ghost"),(!f||E&64)&&Kt(e,"ons-btn--disabled",S[6])},i(S){f||(Ge(g),Ge(k,S),Ge(x),f=!0)},o(S){it(g),it(k,S),it(x),f=!1},d(S){S&&ie(e),g&&g.d(),k&&k.d(S),x&&x.d(),i=!1,d()}}}function Hb(s){let e,a,o,c,h,f,i,d,g,b=s[4]&&s[5]==="before"&&bg(s);const k=s[9].default,x=Bi(k,s,s[8],null);let S=s[4]&&s[5]==="after"&&xg(s);return{c(){e=Ve("a"),a=Ve("span"),b&&b.c(),o=St(),c=Ve("span"),x&&x.c(),h=St(),S&&S.c(),this.h()},l(E){e=$e(E,"A",{href:!0,role:!0,class:!0,disabled:!0});var T=Ze(e);a=$e(T,"SPAN",{class:!0});var A=Ze(a);b&&b.l(A),o=kt(A),c=$e(A,"SPAN",{class:!0});var z=Ze(c);x&&x.l(z),z.forEach(ie),h=kt(A),S&&S.l(A),A.forEach(ie),T.forEach(ie),this.h()},h(){ve(c,"class","ons-btn__text"),ve(a,"class","ons-btn__inner"),ve(e,"href",f=s[6]?null:s[2]),ve(e,"role","button"),ve(e,"class","ons-btn ons-btn--link ons-js-submit-btn"),ve(e,"disabled",s[6]),Kt(e,"ons-btn--small",s[3]),Kt(e,"ons-btn--secondary",s[1]==="secondary"),Kt(e,"ons-btn--ghost",s[1]==="ghost"),Kt(e,"ons-btn--disabled",s[6])},m(E,T){Oe(E,e,T),Me(e,a),b&&b.m(a,null),Me(a,o),Me(a,c),x&&x.m(c,null),Me(a,h),S&&S.m(a,null),i=!0,d||(g=Ss(e,"click",s[10]),d=!0)},p(E,T){E[4]&&E[5]==="before"?b?(b.p(E,T),T&48&&Ge(b,1)):(b=bg(E),b.c(),Ge(b,1),b.m(a,o)):b&&(Vr(),it(b,1,1,()=>{b=null}),$r()),x&&x.p&&(!i||T&256)&&Ni(x,k,E,E[8],i?Ui(k,E[8],T,null):Fi(E[8]),null),E[4]&&E[5]==="after"?S?(S.p(E,T),T&48&&Ge(S,1)):(S=xg(E),S.c(),Ge(S,1),S.m(a,null)):S&&(Vr(),it(S,1,1,()=>{S=null}),$r()),(!i||T&68&&f!==(f=E[6]?null:E[2]))&&ve(e,"href",f),(!i||T&64)&&ve(e,"disabled",E[6]),(!i||T&8)&&Kt(e,"ons-btn--small",E[3]),(!i||T&2)&&Kt(e,"ons-btn--secondary",E[1]==="secondary"),(!i||T&2)&&Kt(e,"ons-btn--ghost",E[1]==="ghost"),(!i||T&64)&&Kt(e,"ons-btn--disabled",E[6])},i(E){i||(Ge(b),Ge(x,E),Ge(S),i=!0)},o(E){it(b),it(x,E),it(S),i=!1},d(E){E&&ie(e),b&&b.d(),x&&x.d(E),S&&S.d(),d=!1,g()}}}function yg(s){let e,a;return e=new dh({props:{type:s[4],marginRight:!0}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&16&&(h.type=o[4]),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function vg(s){let e,a;return e=new dh({props:{type:s[4],marginLeft:!0}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&16&&(h.type=o[4]),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function bg(s){let e,a;return e=new dh({props:{type:s[4],marginRight:!0}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&16&&(h.type=o[4]),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function xg(s){let e,a;return e=new dh({props:{type:s[4],marginLeft:!0}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&16&&(h.type=o[4]),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function Wb(s){let e,a,o,c;const h=[Hb,Zb],f=[];function i(d,g){return d[2]?0:1}return e=i(s),a=f[e]=h[e](s),{c(){a.c(),o=Qt()},l(d){a.l(d),o=Qt()},m(d,g){f[e].m(d,g),Oe(d,o,g),c=!0},p(d,[g]){let b=e;e=i(d),e===b?f[e].p(d,g):(Vr(),it(f[b],1,1,()=>{f[b]=null}),$r(),a=f[e],a?a.p(d,g):(a=f[e]=h[e](d),a.c()),Ge(a,1),a.m(o.parentNode,o))},i(d){c||(Ge(a),c=!0)},o(d){it(a),c=!1},d(d){f[e].d(d),d&&ie(o)}}}function Kb(s,e,a){let{$$slots:o={},$$scope:c}=e;const h=Cd();let{type:f="button"}=e,{variant:i="primary"}=e,{href:d=""}=e,{small:g=!1}=e,{icon:b=""}=e,{iconPosition:k="before"}=e,{disabled:x=!1}=e;const S=T=>h("click",T),E=T=>h("click",T);return s.$$set=T=>{"type"in T&&a(0,f=T.type),"variant"in T&&a(1,i=T.variant),"href"in T&&a(2,d=T.href),"small"in T&&a(3,g=T.small),"icon"in T&&a(4,b=T.icon),"iconPosition"in T&&a(5,k=T.iconPosition),"disabled"in T&&a(6,x=T.disabled),"$$scope"in T&&a(8,c=T.$$scope)},[f,i,d,g,b,k,x,h,c,o,S,E]}class Gf extends Wr{constructor(e){super(),Kr(this,e,Kb,Wb,jr,{type:0,variant:1,href:2,small:3,icon:4,iconPosition:5,disabled:6})}}var Sf=Jv,Xb=function(s){var e,a,o,c;if(e=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(s)){var h=e[1],f=h.replace(/a$/,""),i=f==="cmyk"?4:3;a=Sf[f],o=e[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(g,b){return/%$/.test(g)&&b===i?parseFloat(g)/100:(/%$/.test(g),parseFloat(g))}),h===f&&o.push(1),c=o[i]===void 0?1:o[i],o=o.slice(0,i),a[f]=function(){return o}}else if(/^#[A-Fa-f0-9]+$/.test(s)){var f=s.replace(/^#/,""),i=f.length;a=Sf.rgb,o=f.split(i===3?/(.)/:/(..)/),o=o.filter(Boolean).map(function(k){return parseInt(i===3?k+k:k,16)}),c=1,a.rgb=function(){return o},o[0]||(o[0]=0),o[1]||(o[1]=0),o[2]||(o[2]=0)}else a=Sf.keyword,a.keyword=function(){return s},o=s,c=1;var d={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{d.rgb=a.rgb(o)}catch{}try{d.hsl=a.hsl(o)}catch{}try{d.hsv=a.hsv(o)}catch{}try{d.cmyk=a.cmyk(o)}catch{}try{d.keyword=a.keyword(o)}catch{}return d.rgb&&(d.hex="#"+d.rgb.map(function(g){var b=g.toString(16);return b.length===1?"0"+b:b}).join("")),d.rgb&&(d.rgba=d.rgb.concat(c)),d.hsl&&(d.hsla=d.hsl.concat(c)),d.hsv&&(d.hsva=d.hsv.concat(c)),d.cmyk&&(d.cmyka=d.cmyk.concat(c)),d};const Jb=fh(Xb);function Yb(s){return s}function Qb(s){if(s==null)return Yb;var e,a,o=s.scale[0],c=s.scale[1],h=s.translate[0],f=s.translate[1];return function(i,d){d||(e=a=0);var g=2,b=i.length,k=new Array(b);for(k[0]=(e+=i[0])*o+h,k[1]=(a+=i[1])*c+f;g<b;)k[g]=i[g],++g;return k}}function ex(s,e){for(var a,o=s.length,c=o-e;c<--o;)a=s[c],s[c++]=s[o],s[o]=a}function tx(s,e){return typeof e=="string"&&(e=s.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(a){return wg(s,a)})}:wg(s,e)}function wg(s,e){var a=e.id,o=e.bbox,c=e.properties==null?{}:e.properties,h=rx(s,e);return a==null&&o==null?{type:"Feature",properties:c,geometry:h}:o==null?{type:"Feature",id:a,properties:c,geometry:h}:{type:"Feature",id:a,bbox:o,properties:c,geometry:h}}function rx(s,e){var a=Qb(s.transform),o=s.arcs;function c(b,k){k.length&&k.pop();for(var x=o[b<0?~b:b],S=0,E=x.length;S<E;++S)k.push(a(x[S],S));b<0&&ex(k,E)}function h(b){return a(b)}function f(b){for(var k=[],x=0,S=b.length;x<S;++x)c(b[x],k);return k.length<2&&k.push(k[0]),k}function i(b){for(var k=f(b);k.length<4;)k.push(k[0]);return k}function d(b){return b.map(i)}function g(b){var k=b.type,x;switch(k){case"GeometryCollection":return{type:k,geometries:b.geometries.map(g)};case"Point":x=h(b.coordinates);break;case"MultiPoint":x=b.coordinates.map(h);break;case"LineString":x=f(b.arcs);break;case"MultiLineString":x=b.arcs.map(f);break;case"Polygon":x=d(b.arcs);break;case"MultiPolygon":x=b.arcs.map(d);break;default:return null}return{type:k,coordinates:x}}return g(e)}const Sg="https://ons-dp-prod-cdn.s3.eu-west-2.amazonaws.com/maptiles/pgp-data/";function ix(s){let e=[...s].sort((o,c)=>o.key.localeCompare(c.key));return{selString:s.length==0?"data":e.map((o,c)=>c<e.length-1?`${o.key}-${o.code}`:`${o.key}`).join("/"),lastCode:s.length>0?e[e.length-1].code:null}}async function Zy(s,e=[],a=window.fetch){if(e.length>0&&!e[0].newFormat)throw new Error("OLD FORMAT!");let{selString:o,lastCode:c}=ix(e),h={data:{}},f;if(e.length===0){let i=`${Sg}${e.length}var_percent/${o}.json`;f=await(await a(i)).json(),h.total_pop={count:f.sex.count[0]+f.sex.count[1],percent:100}}else{let i=`${Sg}${e.length}var-combined_percent/${o}.json`,g=await(await a(i)).json();f=g.bar_chart_data[c],h.mapData=g.map_data[c],h.total_pop=f.total_pop}for(let i of s){h.data[i.key]={};for(let d of i.tables)h.data[i.key][d.code]={values:f[d.code]}}return h}function nx(s,e,a){for(let o=1;o<e.length;o++)if(s<=e[o])return a[o-1]}async function sx(s,e,a=window.fetch){let c=await(await a(s)).json();return await tx(c,e)}function fa(s){return s.charAt(0).toUpperCase()+s.slice(1)}function kg(s){return s.replace(new RegExp(" \\([0-9]* categories\\)"),"")}function Eg(s){for(const e of s)if(e.var in Gm)return Gm[e.var][e.code];return null}function Yu(s,e,a){let o=a.all[s][e].values,c=a.selected[s][e].values,h=[];return qf[e].forEach((f,i)=>{let d=f.label,g=o.percent[i],b=c.percent[i];a.selected.total_pop!=a.all.total_pop&&h.push({group:"This group",category:d,value:b}),h.push({group:"Whole population",category:d,value:g})}),h}function Tg(s){if(s===100)return"100";const e=s.toFixed(1);return e!=="0.0"?e:"Less than 0.05"}function Zo(s){return s.split(": ").slice(-1)[0]}async function ax({fetch:s}){let e=await sx(Td+tc.url,tc.layer,s),a=(await Zy(Qa,[],s)).data,o=[],c={},h=[];return e.features.forEach(f=>{const i=f.properties[tc.code],d=f.properties[tc.name],g={code:i,name:d};o.push(g),c[i]=g,h.push({...g,value:100,color:Vo.seq[4]})}),{geojson:e,geoCodesAndNames:o,geoCodesLookup:c,geoPerc:h,all:a,selected:null}}const VT=Object.freeze(Object.defineProperty({__proto__:null,load:ax},Symbol.toStringTag,{value:"Module"})),ox=qy("goto"),lx=qy("after_navigate");function cx(s){return s.slice().sort(function(e,a){return e-a})}function Cg(s,e){for(var a=[],o=0;o<s;o++){for(var c=[],h=0;h<e;h++)c.push(0);a.push(c)}return a}function ux(s){for(var e=0,a,o=0;o<s.length;o++)(o===0||s[o]!==a)&&(a=s[o],e++);return e}function Zf(s,e,a,o){var c;if(s>0){var h=(a[e]-a[s-1])/(e-s+1);c=o[e]-o[s-1]-(e-s+1)*h*h}else c=o[e]-a[e]*a[e]/(e+1);return c<0?0:c}function Hf(s,e,a,o,c,h,f){if(!(s>e)){var i=Math.floor((s+e)/2);o[a][i]=o[a-1][i-1],c[a][i]=i;var d=a;s>a&&(d=Math.max(d,c[a][s-1]||0)),d=Math.max(d,c[a-1][i]||0);var g=i-1;e<o[0].length-1&&(g=Math.min(g,c[a][e+1]||0));for(var b,k,x,S,E=g;E>=d&&(b=Zf(E,i,h,f),!(b+o[a-1][d-1]>=o[a][i]));--E)k=Zf(d,i,h,f),x=k+o[a-1][d-1],x<o[a][i]&&(o[a][i]=x,c[a][i]=d),d++,S=b+o[a-1][E-1],S<o[a][i]&&(o[a][i]=S,c[a][i]=E);Hf(s,i-1,a,o,c,h,f),Hf(i+1,e,a,o,c,h,f)}}function hx(s,e,a){for(var o=e[0].length,c=s[Math.floor(o/2)],h=[],f=[],i=0,d=void 0;i<o;++i)d=s[i]-c,i===0?(h.push(d),f.push(d*d)):(h.push(h[i-1]+d),f.push(f[i-1]+d*d)),e[0][i]=Zf(0,i,h,f),a[0][i]=0;for(var g,b=1;b<e.length;++b)b<e.length-1?g=b:g=o-1,Hf(g,o-1,b,e,a,h,f)}function fx(s,e){if(e>s.length)throw new Error("cannot generate more classes than there are data values");var a=cx(s),o=ux(a);if(o===1)return[a];var c=Cg(e,a.length),h=Cg(e,a.length);hx(a,c,h);for(var f=[],i=h[0].length-1,d=h.length-1;d>=0;d--){var g=h[d][i];f[d]=a.slice(g,i+1),d>0&&(i=g-1)}return f}function Ig(s,e,a){const o=s.slice();return o[15]=e[a],o}function Ag(s,e,a){const o=s.slice();return o[18]=e[a],o[20]=a,o}function Pg(s,e,a){const o=s.slice();return o[18]=e[a],o[20]=a,o}function Mg(s,e,a){const o=s.slice();return o[15]=e[a],o[20]=a,o}function zg(s){let e,a=s[9],o=[];for(let c=0;c<a.length;c+=1)o[c]=Dg(Mg(s,a,c));return{c(){e=Ve("ul");for(let c=0;c<o.length;c+=1)o[c].c();this.h()},l(c){e=$e(c,"UL",{class:!0});var h=Ze(e);for(let f=0;f<o.length;f+=1)o[f].l(h);h.forEach(ie),this.h()},h(){ve(e,"class","legend-block svelte-lmi12p")},m(c,h){Oe(c,e,h);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(e,null)},p(c,h){if(h&544){a=c[9];let f;for(f=0;f<a.length;f+=1){const i=Mg(c,a,f);o[f]?o[f].p(i,h):(o[f]=Dg(i),o[f].c(),o[f].m(e,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=a.length}},d(c){c&&ie(e),Vi(o,c)}}}function Dg(s){let e,a,o,c,h=s[15]+"",f,i;return{c(){e=Ve("li"),a=Ve("div"),o=St(),c=Ve("span"),f=Mt(h),i=St(),this.h()},l(d){e=$e(d,"LI",{class:!0});var g=Ze(e);a=$e(g,"DIV",{class:!0}),Ze(a).forEach(ie),o=kt(g),c=$e(g,"SPAN",{class:!0});var b=Ze(c);f=zt(b,h),b.forEach(ie),i=kt(g),g.forEach(ie),this.h()},h(){ve(a,"class","legend-vis "+(s[20]==0?"bar":"marker")+" svelte-lmi12p"),Ct(a,"height","1rem"),Ct(a,"width",s[20]==0?"1rem":s[5]+"px"),ve(c,"class",Xu(s[20]==0?"bold":"brackets")+" svelte-lmi12p"),ve(e,"class","svelte-lmi12p"),Kt(e,"ew",s[20]!=0)},m(d,g){Oe(d,e,g),Me(e,a),Me(e,o),Me(e,c),Me(c,f),Me(e,i)},p(d,g){g&32&&Ct(a,"width",d[20]==0?"1rem":d[5]+"px"),g&512&&h!==(h=d[15]+"")&&Cr(f,h)},d(d){d&&ie(e)}}}function Lg(s){let e,a=s[1](s[18][s[0]])+"",o,c;return{c(){e=Ve("span"),o=Mt(a),c=Mt(s[2]),this.h()},l(h){e=$e(h,"SPAN",{class:!0});var f=Ze(e);o=zt(f,a),c=zt(f,s[2]),f.forEach(ie),this.h()},h(){ve(e,"class","label "+(s[20]==0?"bold":"sml brackets")+" svelte-lmi12p")},m(h,f){Oe(h,e,f),Me(e,o),Me(e,c)},p(h,f){f&131&&a!==(a=h[1](h[18][h[0]])+"")&&Cr(o,a),f&4&&Cr(c,h[2])},d(h){h&&ie(e)}}}function dx(s){let e,a=`calc(${s[8](s[18][s[0]])}% - ${s[5]/2}px)`,o=`${s[5]}px`;return{c(){e=Ve("div"),this.h()},l(c){e=$e(c,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","marker svelte-lmi12p"),Ct(e,"left",a),Ct(e,"border-left-width",o)},m(c,h){Oe(c,e,h)},p(c,h){h&417&&a!==(a=`calc(${c[8](c[18][c[0]])}% - ${c[5]/2}px)`)&&Ct(e,"left",a),h&32&&o!==(o=`${c[5]}px`)&&Ct(e,"border-left-width",o)},d(c){c&&ie(e)}}}function px(s){let e,a=`${s[8](s[18][s[0]])}%`;return{c(){e=Ve("div"),this.h()},l(o){e=$e(o,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","bar svelte-lmi12p"),Ct(e,"left","0"),Ct(e,"width",a)},m(o,c){Oe(o,e,c)},p(o,c){c&385&&a!==(a=`${o[8](o[18][o[0]])}%`)&&Ct(e,"width",a)},d(o){o&&ie(e)}}}function Rg(s){let e;function a(h,f){return h[20]==0?px:dx}let c=a(s)(s);return{c(){c.c(),e=Qt()},l(h){c.l(h),e=Qt()},m(h,f){c.m(h,f),Oe(h,e,f)},p(h,f){c.p(h,f)},d(h){c.d(h),h&&ie(e)}}}function Og(s){let e,a=s[15].label+"",o,c,h,f,i,d=`${s[4]}px`,g=s[15].values,b=[];for(let S=0;S<g.length;S+=1)b[S]=Lg(Pg(s,g,S));let k=s[15].values,x=[];for(let S=0;S<k.length;S+=1)x[S]=Rg(Ag(s,k,S));return{c(){e=Ve("div"),o=Mt(a),c=St(),h=Ve("span");for(let S=0;S<b.length;S+=1)b[S].c();f=St(),i=Ve("div");for(let S=0;S<x.length;S+=1)x[S].c();this.h()},l(S){e=$e(S,"DIV",{class:!0});var E=Ze(e);o=zt(E,a),c=kt(E),h=$e(E,"SPAN",{class:!0});var T=Ze(h);for(let z=0;z<b.length;z+=1)b[z].l(T);T.forEach(ie),E.forEach(ie),f=kt(S),i=$e(S,"DIV",{class:!0});var A=Ze(i);for(let z=0;z<x.length;z+=1)x[z].l(A);A.forEach(ie),this.h()},h(){ve(h,"class","nowrap svelte-lmi12p"),ve(e,"class","label-group svelte-lmi12p"),ve(i,"class","bar-group svelte-lmi12p"),Ct(i,"height",d)},m(S,E){Oe(S,e,E),Me(e,o),Me(e,c),Me(e,h);for(let T=0;T<b.length;T+=1)b[T]&&b[T].m(h,null);Oe(S,f,E),Oe(S,i,E);for(let T=0;T<x.length;T+=1)x[T]&&x[T].m(i,null)},p(S,E){if(E&128&&a!==(a=S[15].label+"")&&Cr(o,a),E&135){g=S[15].values;let T;for(T=0;T<g.length;T+=1){const A=Pg(S,g,T);b[T]?b[T].p(A,E):(b[T]=Lg(A),b[T].c(),b[T].m(h,null))}for(;T<b.length;T+=1)b[T].d(1);b.length=g.length}if(E&417){k=S[15].values;let T;for(T=0;T<k.length;T+=1){const A=Ag(S,k,T);x[T]?x[T].p(A,E):(x[T]=Rg(A),x[T].c(),x[T].m(i,null))}for(;T<x.length;T+=1)x[T].d(1);x.length=k.length}E&16&&d!==(d=`${S[4]}px`)&&Ct(i,"height",d)},d(S){S&&ie(e),Vi(b,S),S&&ie(f),S&&ie(i),Vi(x,S)}}}function Bg(s){let e,a;return{c(){e=Ve("small"),a=Mt(s[3]),this.h()},l(o){e=$e(o,"SMALL",{class:!0});var c=Ze(e);a=zt(c,s[3]),c.forEach(ie),this.h()},h(){ve(e,"class","svelte-lmi12p")},m(o,c){Oe(o,e,c),Me(e,a)},p(o,c){c&8&&Cr(a,o[3])},d(o){o&&ie(e)}}}function mx(s){let e,a,o,c=s[6]&&s[9][1]&&zg(s),h=s[7],f=[];for(let d=0;d<h.length;d+=1)f[d]=Og(Ig(s,h,d));let i=s[3]&&Bg(s);return{c(){c&&c.c(),e=St();for(let d=0;d<f.length;d+=1)f[d].c();a=St(),i&&i.c(),o=Qt()},l(d){c&&c.l(d),e=kt(d);for(let g=0;g<f.length;g+=1)f[g].l(d);a=kt(d),i&&i.l(d),o=Qt()},m(d,g){c&&c.m(d,g),Oe(d,e,g);for(let b=0;b<f.length;b+=1)f[b]&&f[b].m(d,g);Oe(d,a,g),i&&i.m(d,g),Oe(d,o,g)},p(d,[g]){if(d[6]&&d[9][1]?c?c.p(d,g):(c=zg(d),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null),g&439){h=d[7];let b;for(b=0;b<h.length;b+=1){const k=Ig(d,h,b);f[b]?f[b].p(k,g):(f[b]=Og(k),f[b].c(),f[b].m(a.parentNode,a))}for(;b<f.length;b+=1)f[b].d(1);f.length=h.length}d[3]?i?i.p(d,g):(i=Bg(d),i.c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null)},i:_r,o:_r,d(d){c&&c.d(d),d&&ie(e),Vi(f,d),d&&ie(a),i&&i.d(d),d&&ie(o)}}}function gx(s,e,a){let o,c,h,f,{data:i}=e,{xKey:d="value"}=e,{yKey:g="category"}=e,{zKey:b="areanm"}=e,{formatTick:k=D=>D.toFixed(1)}=e,{suffix:x="%"}=e,{base:S=null}=e,{barHeight:E=25}=e,{markerWidth:T=3}=e,{showLegend:A=!0}=e;function z(D,F){let $={},q=[];for(const G of D)$[G[F]]||($[G[F]]={label:G[F],values:[]},q.push(G[F])),$[G[F]].values.push(G);let J=[];return q.forEach(G=>{J.push($[G])}),J}return s.$$set=D=>{"data"in D&&a(10,i=D.data),"xKey"in D&&a(0,d=D.xKey),"yKey"in D&&a(11,g=D.yKey),"zKey"in D&&a(12,b=D.zKey),"formatTick"in D&&a(1,k=D.formatTick),"suffix"in D&&a(2,x=D.suffix),"base"in D&&a(3,S=D.base),"barHeight"in D&&a(4,E=D.barHeight),"markerWidth"in D&&a(5,T=D.markerWidth),"showLegend"in D&&a(6,A=D.showLegend)},s.$$.update=()=>{s.$$.dirty&1025&&a(13,o=Math.max(...i.map(D=>D[d]))),s.$$.dirty&5120&&a(9,c=i.map(D=>D[b]).filter((D,F,$)=>$.indexOf(D)===F)),s.$$.dirty&8192&&a(8,h=D=>D/o*100),s.$$.dirty&3072&&a(7,f=z(i,g))},[d,k,x,S,E,T,A,f,h,c,i,g,b,o]}class _x extends Wr{constructor(e){super(),Kr(this,e,gx,mx,jr,{data:10,xKey:0,yKey:11,zKey:12,formatTick:1,suffix:2,base:3,barHeight:4,markerWidth:5,showLegend:6})}}function yx(s){let e,a,o;return{c(){e=ma("svg"),a=ma("path"),this.h()},l(c){e=ga(c,"svg",{class:!0,viewBox:!0,"fill-rule":!0,"clip-rule":!0,"aria-hidden":!0,focusable:!0,style:!0});var h=Ze(e);a=ga(h,"path",{d:!0}),Ze(a).forEach(ie),h.forEach(ie),this.h()},h(){ve(a,"d",o=s[4][s[0]]),ve(e,"class","ico svelte-175xtay"),ve(e,"viewBox","0 0 24 24"),ve(e,"fill-rule","evenodd"),ve(e,"clip-rule","evenodd"),ve(e,"aria-hidden","true"),ve(e,"focusable","false"),ve(e,"style",s[3]),Kt(e,"margin",s[2]),Kt(e,"noclick",!s[1])},m(c,h){Oe(c,e,h),Me(e,a)},p(c,[h]){h&1&&o!==(o=c[4][c[0]])&&ve(a,"d",o),h&8&&ve(e,"style",c[3]),h&4&&Kt(e,"margin",c[2]),h&2&&Kt(e,"noclick",!c[1])},i:_r,o:_r,d(c){c&&ie(e)}}}function vx(s,e,a){let o,{type:c="compass"}=e,{rotation:h=0}=e,{position:f="inline"}=e,{clickable:i=!1}=e,{margin:d=!1}=e;const g={compass:"M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zm-10 1H8v-2h4V8l4 4-4 4v-3z",info:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z",chart:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 17c-.55 0-1-.45-1-1v-5c0-.55.45-1 1-1s1 .45 1 1v5c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v8c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1z",share:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",chevron:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",full:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",full_exit:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",shuffle:"M10.59 9.17 5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z",replay:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z",save:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z",tick:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z",cross:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z",arrow:"M5,13h11.2l-2.9,2.9c-0.4,0.4-0.4,1,0,1.4s1,0.4,1.4,0l4.6-4.6c0.4-0.4,0.4-1,0-1.4l-4.6-4.6c-0.4-0.4-1-0.4-1.4,0c0,0,0,0,0,0c-0.4,0.4-0.4,1,0,1.4l2.9,2.9H5c-0.6,0-1,0.4-1,1S4.4,13,5,13z",plus:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z",minus:"M18 13H6c-.55 0-1-.45-1-1s.45-1 1-1h12c.55 0 1 .45 1 1s-.45 1-1 1z",subdir:"m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9l6 6z",touch:"M9 11.24V7.5C9 6.12 10.12 5 11.5 5S14 6.12 14 7.5v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74c-3.6-.76-3.54-.75-3.67-.75-.31 0-.59.13-.79.33l-.79.8 4.94 4.94c.27.27.65.44 1.06.44h6.79c.75 0 1.33-.55 1.44-1.28l.75-5.27c.01-.07.02-.14.02-.2 0-.62-.38-1.16-.91-1.38z",launch:"M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.11 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1zM14 4c0 .55.45 1 1 1h2.59l-9.13 9.13c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V3h-6c-.55 0-1 .45-1 1z",close:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",error:"M 12 2 C 6.48 2 2 6.48 2 12 s 4.48 10 10 10 s 10 -4.48 10 -10 S 17.52 2 12 2 z m 1 15 h -2 v -2 h 2 v 2 z m 0 -4 h -2 V 7 h 2 v 6 z"};return s.$$set=b=>{"type"in b&&a(0,c=b.type),"rotation"in b&&a(5,h=b.rotation),"position"in b&&a(6,f=b.position),"clickable"in b&&a(1,i=b.clickable),"margin"in b&&a(2,d=b.margin)},s.$$.update=()=>{s.$$.dirty&96&&a(3,o=`transform: translate(0, 15%) scale(1.5) rotate(${-h}deg);${["left","right"].includes(f)?` position: absolute; ${f}: 10px;`:""}`)},[c,i,d,o,g,h,f]}class Pd extends Wr{constructor(e){super(),Kr(this,e,vx,yx,jr,{type:0,rotation:5,position:6,clickable:1,margin:2})}}function Ng(s,e,a){const o=s.slice();return o[11]=e[a],o}function Fg(s){let e,a,o,c;return{c(){e=Ve("button"),a=Mt("Back"),this.h()},l(h){e=$e(h,"BUTTON",{class:!0});var f=Ze(e);a=zt(f,"Back"),f.forEach(ie),this.h()},h(){ve(e,"class","hidden-on-desktop svelte-1iovvug")},m(h,f){Oe(h,e,f),Me(e,a),o||(c=Ss(e,"click",function(){Fy(s[3])&&s[3].apply(this,arguments)}),o=!0)},p(h,f){s=h},d(h){h&&ie(e),o=!1,c()}}}function Ug(s){let e,a,o,c,h=Zo(Qu(s[11],s[4]))+"",f;return{c(){e=Ve("br"),a=St(),o=Ve("div"),c=Mt("Selected: "),f=Mt(h),this.h()},l(i){e=$e(i,"BR",{}),a=kt(i),o=$e(i,"DIV",{class:!0});var d=Ze(o);c=zt(d,"Selected: "),f=zt(d,h),d.forEach(ie),this.h()},h(){ve(o,"class","selected-item-label svelte-1iovvug")},m(i,d){Oe(i,e,d),Oe(i,a,d),Oe(i,o,d),Me(o,c),Me(o,f)},p(i,d){d&18&&h!==(h=Zo(Qu(i[11],i[4]))+"")&&Cr(f,h)},d(i){i&&ie(e),i&&ie(a),i&&ie(o)}}}function Vg(s){let e,a=s[6](s[11])+"",o,c,h,f,i,d=Qu(s[11],s[4]),g,b,k;f=new Pd({props:{type:"chevron"}});let x=d&&Ug(s);function S(){return s[10](s[11])}return{c(){e=Ve("button"),o=Mt(a),c=St(),h=Ve("span"),ir(f.$$.fragment),i=St(),x&&x.c(),this.h()},l(E){e=$e(E,"BUTTON",{class:!0});var T=Ze(e);o=zt(T,a),c=kt(T),h=$e(T,"SPAN",{class:!0});var A=Ze(h);cr(f.$$.fragment,A),A.forEach(ie),i=kt(T),x&&x.l(T),T.forEach(ie),this.h()},h(){ve(h,"class","right-chevron svelte-1iovvug"),ve(e,"class","svelte-1iovvug"),Kt(e,"plain-button",!0),Kt(e,"selected",s[11]===s[0])},m(E,T){Oe(E,e,T),Me(e,o),Me(e,c),Me(e,h),nr(f,h,null),Me(e,i),x&&x.m(e,null),g=!0,b||(k=Ss(e,"click",S),b=!0)},p(E,T){s=E,(!g||T&66)&&a!==(a=s[6](s[11])+"")&&Cr(o,a),T&18&&(d=Qu(s[11],s[4])),d?x?x.p(s,T):(x=Ug(s),x.c(),x.m(e,null)):x&&(x.d(1),x=null),(!g||T&3)&&Kt(e,"selected",s[11]===s[0])},i(E){g||(Ge(f.$$.fragment,E),g=!0)},o(E){it(f.$$.fragment,E),g=!1},d(E){E&&ie(e),sr(f),x&&x.d(),b=!1,k()}}}function bx(s){let e,a,o,c,h,f,i,d=s[3]!=null&&Fg(s),g=s[1],b=[];for(let E=0;E<g.length;E+=1)b[E]=Vg(Ng(s,g,E));const k=E=>it(b[E],1,1,()=>{b[E]=null}),x=s[9].default,S=Bi(x,s,s[8],null);return{c(){e=Ve("div"),d&&d.c(),a=St(),o=Ve("h5"),c=Mt(s[5]),h=St();for(let E=0;E<b.length;E+=1)b[E].c();f=St(),S&&S.c(),this.h()},l(E){e=$e(E,"DIV",{class:!0});var T=Ze(e);d&&d.l(T),a=kt(T),o=$e(T,"H5",{class:!0});var A=Ze(o);c=zt(A,s[5]),A.forEach(ie),h=kt(T);for(let z=0;z<b.length;z+=1)b[z].l(T);f=kt(T),S&&S.l(T),T.forEach(ie),this.h()},h(){ve(o,"class","column-title svelte-1iovvug"),ve(e,"class","column svelte-1iovvug"),Kt(e,"hidden-first-column",s[7])},m(E,T){Oe(E,e,T),d&&d.m(e,null),Me(e,a),Me(e,o),Me(o,c),Me(e,h);for(let A=0;A<b.length;A+=1)b[A]&&b[A].m(e,null);Me(e,f),S&&S.m(e,null),i=!0},p(E,[T]){if(E[3]!=null?d?d.p(E,T):(d=Fg(E),d.c(),d.m(e,a)):d&&(d.d(1),d=null),(!i||T&32)&&Cr(c,E[5]),T&87){g=E[1];let A;for(A=0;A<g.length;A+=1){const z=Ng(E,g,A);b[A]?(b[A].p(z,T),Ge(b[A],1)):(b[A]=Vg(z),b[A].c(),Ge(b[A],1),b[A].m(e,f))}for(Vr(),A=g.length;A<b.length;A+=1)k(A);$r()}S&&S.p&&(!i||T&256)&&Ni(S,x,E,E[8],i?Ui(x,E[8],T,null):Fi(E[8]),null),(!i||T&128)&&Kt(e,"hidden-first-column",E[7])},i(E){if(!i){for(let T=0;T<g.length;T+=1)Ge(b[T]);Ge(S,E),i=!0}},o(E){b=b.filter(Boolean);for(let T=0;T<b.length;T+=1)it(b[T]);it(S,E),i=!1},d(E){E&&ie(e),d&&d.d(),Vi(b,E),S&&S.d(E)}}}function xx(s){console.log("clicked",s)}function Qu(s,e){for(let a of e)if(a.topic===s.label)return a.label;return!1}function wx(s,e,a){let{$$slots:o={},$$scope:c}=e,{options:h=[]}=e,{clickCallback:f=xx}=e,{backButtonCallback:i=null}=e,{globalSelectedCategories:d=[]}=e,{columnTitle:g="column title"}=e,{labeller:b=E=>E.label}=e,{selected:k=null}=e,{hiddenOnMobile:x=!1}=e;const S=E=>{a(0,k=E),f(E)};return s.$$set=E=>{"options"in E&&a(1,h=E.options),"clickCallback"in E&&a(2,f=E.clickCallback),"backButtonCallback"in E&&a(3,i=E.backButtonCallback),"globalSelectedCategories"in E&&a(4,d=E.globalSelectedCategories),"columnTitle"in E&&a(5,g=E.columnTitle),"labeller"in E&&a(6,b=E.labeller),"selected"in E&&a(0,k=E.selected),"hiddenOnMobile"in E&&a(7,x=E.hiddenOnMobile),"$$scope"in E&&a(8,c=E.$$scope)},[k,h,f,i,d,g,b,x,c,o,S]}class Sx extends Wr{constructor(e){super(),Kr(this,e,wx,bx,jr,{options:1,clickCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,selected:0,hiddenOnMobile:7})}}function $g(s,e,a){const o=s.slice();return o[14]=e[a],o[16]=a,o}function jg(s){let e,a,o,c,h,f,i,d,g;return{c(){e=Ve("ol"),a=Ve("li"),o=Ve("button"),c=Mt("Back"),h=St(),f=ma("svg"),i=ma("path"),this.h()},l(b){e=$e(b,"OL",{class:!0});var k=Ze(e);a=$e(k,"LI",{class:!0,id:!0});var x=Ze(a);o=$e(x,"BUTTON",{class:!0});var S=Ze(o);c=zt(S,"Back"),S.forEach(ie),h=kt(x),f=ga(x,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var E=Ze(f);i=ga(E,"path",{d:!0,transform:!0}),Ze(i).forEach(ie),E.forEach(ie),x.forEach(ie),k.forEach(ie),this.h()},h(){ve(o,"class","btn-link ons-breadcrumb__link"),ve(i,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),ve(i,"transform","translate(-5.02 -1.59)"),ve(f,"class","ons-svg-icon svelte-w4p0hu"),ve(f,"viewBox","0 0 8 13"),ve(f,"xmlns","http://www.w3.org/2000/svg"),ve(f,"focusable","false"),ve(f,"fill","currentColor"),ve(a,"class","ons-breadcrumb__item"),ve(a,"id","breadcrumb-1"),ve(e,"class","ons-breadcrumb__items ons-u-fs-s")},m(b,k){Oe(b,e,k),Me(e,a),Me(a,o),Me(o,c),Me(a,h),Me(a,f),Me(f,i),d||(g=Ss(o,"click",function(){Fy(s[3])&&s[3].apply(this,arguments)}),d=!0)},p(b,k){s=b},d(b){b&&ie(e),d=!1,g()}}}function qg(s){let e,a;return e=new Gf({props:{variant:"secondary",small:!0,disabled:s[7],$$slots:{default:[kx]},$$scope:{ctx:s}}}),e.$on("click",s[11]),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&128&&(h.disabled=o[7]),c&8192&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function kx(s){let e;return{c(){e=Mt("Remove selection")},l(a){e=zt(a,"Remove selection")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function Ex(s){let e,a=s[0],o,c,h=Zg(s);const f=s[10].default,i=Bi(f,s,s[13],null);return{c(){e=Ve("div"),h.c(),o=St(),i&&i.c(),this.h()},l(d){e=$e(d,"DIV",{class:!0});var g=Ze(e);h.l(g),g.forEach(ie),o=kt(d),i&&i.l(d),this.h()},h(){ve(e,"class","ons-radios__items")},m(d,g){Oe(d,e,g),h.m(e,null),Oe(d,o,g),i&&i.m(d,g),c=!0},p(d,g){g&1&&jr(a,a=d[0])?(h.d(1),h=Zg(d),h.c(),h.m(e,null)):h.p(d,g),i&&i.p&&(!c||g&8192)&&Ni(i,f,d,d[13],c?Ui(f,d[13],g,null):Fi(d[13]),null)},i(d){c||(Ge(i,d),c=!0)},o(d){it(i,d),c=!1},d(d){d&&ie(e),h.d(d),d&&ie(o),i&&i.d(d)}}}function Tx(s){let e;return{c(){e=Mt(`At most three characteristics can be selected. To add another
      characteristic, please remove one of the three selected ones.`)},l(a){e=zt(a,`At most three characteristics can be selected. To add another
      characteristic, please remove one of the three selected ones.`)},m(a,o){Oe(a,e,o)},p:_r,i:_r,o:_r,d(a){a&&ie(e)}}}function Gg(s){let e,a,o,c,h,f=s[6](s[14])+"",i,d,g,b;function k(){return s[12](s[14])}return{c(){e=Ve("button"),a=Ve("span"),o=Ve("span"),c=St(),h=Ve("span"),i=Mt(f),d=St(),this.h()},l(x){e=$e(x,"BUTTON",{class:!0});var S=Ze(e);a=$e(S,"SPAN",{class:!0});var E=Ze(a);o=$e(E,"SPAN",{class:!0}),Ze(o).forEach(ie),c=kt(E),h=$e(E,"SPAN",{class:!0});var T=Ze(h);i=zt(T,f),T.forEach(ie),E.forEach(ie),d=kt(S),S.forEach(ie),this.h()},h(){ve(o,"class","ons-radio__input ons-js-radio svelte-1cwdic4"),ve(h,"class","ons-radio__label svelte-1cwdic4"),ve(a,"class","ons-radio ons-radio--no-border"),ve(e,"class","ons-radios__item ons-radios__item--no-border svelte-1cwdic4"),e.disabled=s[7],Kt(e,"ons-radio__checked",Wg(s[14],s[4]))},m(x,S){Oe(x,e,S),Me(e,a),Me(a,o),Me(a,c),Me(a,h),Me(h,i),Me(e,d),g||(b=[Uy(Ix.call(null,e,s[16]===0)),Ss(e,"click",k)],g=!0)},p(x,S){s=x,S&65&&f!==(f=s[6](s[14])+"")&&Cr(i,f),S&128&&(e.disabled=s[7]),S&17&&Kt(e,"ons-radio__checked",Wg(s[14],s[4]))},d(x){x&&ie(e),g=!1,rb(b)}}}function Zg(s){let e,a=s[0],o=[];for(let c=0;c<a.length;c+=1)o[c]=Gg($g(s,a,c));return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=Qt()},l(c){for(let h=0;h<o.length;h+=1)o[h].l(c);e=Qt()},m(c,h){for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(c,h);Oe(c,e,h)},p(c,h){if(h&211){a=c[0];let f;for(f=0;f<a.length;f+=1){const i=$g(c,a,f);o[f]?o[f].p(i,h):(o[f]=Gg(i),o[f].c(),o[f].m(e.parentNode,e))}for(;f<o.length;f+=1)o[f].d(1);o.length=a.length}},d(c){Vi(o,c),c&&ie(e)}}}function Cx(s){let e,a,o,c,h,f,i,d=kf(s[9],s[4]),g,b,k,x,S,E=s[3]!=null&&jg(s),T=d&&qg(s);const A=[Tx,Ex],z=[];function D(F,$){return $&528&&(b=null),b==null&&(b=F[4].length===3&&!kf(F[9],F[4])),b?0:1}return k=D(s,-1),x=z[k]=A[k](s),{c(){e=Ve("div"),a=Ve("div"),E&&E.c(),o=St(),c=Ve("div"),h=Ve("h5"),f=Mt(s[5]),i=St(),T&&T.c(),g=St(),x.c(),this.h()},l(F){e=$e(F,"DIV",{class:!0});var $=Ze(e);a=$e($,"DIV",{class:!0});var q=Ze(a);E&&E.l(q),q.forEach(ie),o=kt($),c=$e($,"DIV",{class:!0});var J=Ze(c);h=$e(J,"H5",{class:!0});var G=Ze(h);f=zt(G,s[5]),G.forEach(ie),i=kt(J),T&&T.l(J),J.forEach(ie),g=kt($),x.l($),$.forEach(ie),this.h()},h(){ve(a,"class","svelte-1cwdic4"),Kt(a,"hidden-on-desktop",!0),ve(h,"class","column-title svelte-1cwdic4"),ve(c,"class","title-container svelte-1cwdic4"),ve(e,"class","column svelte-1cwdic4"),Kt(e,"hidden-first-column",s[8])},m(F,$){Oe(F,e,$),Me(e,a),E&&E.m(a,null),Me(e,o),Me(e,c),Me(c,h),Me(h,f),Me(c,i),T&&T.m(c,null),Me(e,g),z[k].m(e,null),S=!0},p(F,[$]){F[3]!=null?E?E.p(F,$):(E=jg(F),E.c(),E.m(a,null)):E&&(E.d(1),E=null),(!S||$&32)&&Cr(f,F[5]),$&528&&(d=kf(F[9],F[4])),d?T?(T.p(F,$),$&528&&Ge(T,1)):(T=qg(F),T.c(),Ge(T,1),T.m(c,null)):T&&(Vr(),it(T,1,1,()=>{T=null}),$r());let q=k;k=D(F,$),k===q?z[k].p(F,$):(Vr(),it(z[q],1,1,()=>{z[q]=null}),$r(),x=z[k],x?x.p(F,$):(x=z[k]=A[k](F),x.c()),Ge(x,1),x.m(e,null)),(!S||$&256)&&Kt(e,"hidden-first-column",F[8])},i(F){S||(Ge(T),Ge(x),S=!0)},o(F){it(T),it(x),S=!1},d(F){F&&ie(e),E&&E.d(),T&&T.d(),z[k].d()}}}function Hg(s){console.log("clicked",s)}function kf(s,e){for(let a of e)if(a.topic===s.label)return a.label;return!1}function Wg(s,e){for(const a of e)if(a.var===s.var&&a.code===s.code)return!0;return!1}function Ix(s,e){e&&s.focus()}function Ax(s,e,a){let{$$slots:o={},$$scope:c}=e,{options:h=[]}=e,{clickCallback:f=Hg}=e,{removeCatCallback:i=Hg}=e,{backButtonCallback:d=null}=e,{globalSelectedCategories:g=[]}=e,{columnTitle:b="column title"}=e,{labeller:k=z=>z.label}=e,{disabled:x=!1}=e,{hiddenOnMobile:S=!1}=e,{currentVar:E=null}=e;const T=()=>i(E),A=z=>f(z);return s.$$set=z=>{"options"in z&&a(0,h=z.options),"clickCallback"in z&&a(1,f=z.clickCallback),"removeCatCallback"in z&&a(2,i=z.removeCatCallback),"backButtonCallback"in z&&a(3,d=z.backButtonCallback),"globalSelectedCategories"in z&&a(4,g=z.globalSelectedCategories),"columnTitle"in z&&a(5,b=z.columnTitle),"labeller"in z&&a(6,k=z.labeller),"disabled"in z&&a(7,x=z.disabled),"hiddenOnMobile"in z&&a(8,S=z.hiddenOnMobile),"currentVar"in z&&a(9,E=z.currentVar),"$$scope"in z&&a(13,c=z.$$scope)},[h,f,i,d,g,b,k,x,S,E,o,T,A,c]}class Px extends Wr{constructor(e){super(),Kr(this,e,Ax,Cx,jr,{options:0,clickCallback:1,removeCatCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,disabled:7,hiddenOnMobile:8,currentVar:9})}}function Kg(s,e,a){const o=s.slice();return o[25]=e[a],o}function Xg(s){let e,a,o=[s[5].vars[s[7][s[5].label]]],c=[];for(let f=0;f<1;f+=1)c[f]=Qg(Kg(s,o,f));const h=f=>it(c[f],1,1,()=>{c[f]=null});return{c(){for(let f=0;f<1;f+=1)c[f].c();e=Qt()},l(f){for(let i=0;i<1;i+=1)c[i].l(f);e=Qt()},m(f,i){for(let d=0;d<1;d+=1)c[d]&&c[d].m(f,i);Oe(f,e,i),a=!0},p(f,i){if(i&1022){o=[f[5].vars[f[7][f[5].label]]];let d;for(d=0;d<1;d+=1){const g=Kg(f,o,d);c[d]?(c[d].p(g,i),Ge(c[d],1)):(c[d]=Qg(g),c[d].c(),Ge(c[d],1),c[d].m(e.parentNode,e))}for(Vr(),d=1;d<1;d+=1)h(d);$r()}},i(f){if(!a){for(let i=0;i<1;i+=1)Ge(c[i]);a=!0}},o(f){c=c.filter(Boolean);for(let i=0;i<1;i+=1)it(c[i]);a=!1},d(f){Vi(c,f),f&&ie(e)}}}function Jg(s){let e,a,o,c,h,f;return a=new Pd({props:{type:"chevron",rotation:90}}),{c(){e=Ve("button"),ir(a.$$.fragment),o=Mt(" Show fewer"),this.h()},l(i){e=$e(i,"BUTTON",{class:!0});var d=Ze(e);cr(a.$$.fragment,d),o=zt(d," Show fewer"),d.forEach(ie),this.h()},h(){ve(e,"class","btn-link")},m(i,d){Oe(i,e,d),nr(a,e,null),Me(e,o),c=!0,h||(f=Ss(e,"click",s[9]),h=!0)},p:_r,i(i){c||(Ge(a.$$.fragment,i),c=!0)},o(i){it(a.$$.fragment,i),c=!1},d(i){i&&ie(e),sr(a),h=!1,f()}}}function Yg(s){let e,a,o,c,h,f;return a=new Pd({props:{type:"chevron",rotation:-90}}),{c(){e=Ve("button"),ir(a.$$.fragment),o=Mt(" Show more"),this.h()},l(i){e=$e(i,"BUTTON",{class:!0});var d=Ze(e);cr(a.$$.fragment,d),o=zt(d," Show more"),d.forEach(ie),this.h()},h(){ve(e,"class","btn-link")},m(i,d){Oe(i,e,d),nr(a,e,null),Me(e,o),c=!0,h||(f=Ss(e,"click",s[8]),h=!0)},p:_r,i(i){c||(Ge(a.$$.fragment,i),c=!0)},o(i){it(a.$$.fragment,i),c=!1},d(i){i&&ie(e),sr(a),h=!1,f()}}}function Mx(s){let e,a,o,c=s[7][s[5].label]>0&&Jg(s),h=s[7][s[5].label]<s[5].vars.length-1&&Yg(s);return{c(){c&&c.c(),e=St(),h&&h.c(),a=St()},l(f){c&&c.l(f),e=kt(f),h&&h.l(f),a=kt(f)},m(f,i){c&&c.m(f,i),Oe(f,e,i),h&&h.m(f,i),Oe(f,a,i),o=!0},p(f,i){f[7][f[5].label]>0?c?(c.p(f,i),i&160&&Ge(c,1)):(c=Jg(f),c.c(),Ge(c,1),c.m(e.parentNode,e)):c&&(Vr(),it(c,1,1,()=>{c=null}),$r()),f[7][f[5].label]<f[5].vars.length-1?h?(h.p(f,i),i&160&&Ge(h,1)):(h=Yg(f),h.c(),Ge(h,1),h.m(a.parentNode,a)):h&&(Vr(),it(h,1,1,()=>{h=null}),$r())},i(f){o||(Ge(c),Ge(h),o=!0)},o(f){it(c),it(h),o=!1},d(f){c&&c.d(f),f&&ie(e),h&&h.d(f),f&&ie(a)}}}function Qg(s){let e,a,o;function c(...d){return s[11](s[25],...d)}function h(...d){return s[12](s[25],...d)}function f(d){s[14](d)}let i={columnTitle:s[5].label,options:s[25].cats,clickCallback:c,removeCatCallback:h,backButtonCallback:s[13],globalSelectedCategories:s[3],currentVar:s[5],disabled:s[4],$$slots:{default:[Mx]},$$scope:{ctx:s}};return s[6]!==void 0&&(i.selected=s[6]),e=new Px({props:i}),pc.push(()=>ch(e,"selected",f)),{c(){ir(e.$$.fragment)},l(d){cr(e.$$.fragment,d)},m(d,g){nr(e,d,g),o=!0},p(d,g){s=d;const b={};g&32&&(b.columnTitle=s[5].label),g&160&&(b.options=s[25].cats),g&162&&(b.clickCallback=c),g&164&&(b.removeCatCallback=h),g&32&&(b.backButtonCallback=s[13]),g&8&&(b.globalSelectedCategories=s[3]),g&32&&(b.currentVar=s[5]),g&16&&(b.disabled=s[4]),g&268435616&&(b.$$scope={dirty:g,ctx:s}),!a&&g&64&&(a=!0,b.selected=s[6],uh(()=>a=!1)),e.$set(b)},i(d){o||(Ge(e.$$.fragment,d),o=!0)},o(d){it(e.$$.fragment,d),o=!1},d(d){sr(e,d)}}}function e_(s){let e,a,o=s[5]!=null&&Xg(s);return{c(){o&&o.c(),e=Qt()},l(c){o&&o.l(c),e=Qt()},m(c,h){o&&o.m(c,h),Oe(c,e,h),a=!0},p(c,h){c[5]!=null?o?(o.p(c,h),h&32&&Ge(o,1)):(o=Xg(c),o.c(),Ge(o,1),o.m(e.parentNode,e)):o&&(Vr(),it(o,1,1,()=>{o=null}),$r())},i(c){a||(Ge(o),a=!0)},o(c){it(o),a=!1},d(c){o&&o.d(c),c&&ie(e)}}}function zx(s){let e,a,o,c,h=s[5],f,i,d;function g(x){s[10](x)}let b={columnTitle:"Select a variable",clickCallback:Rx,options:s[0],globalSelectedCategories:s[3],hiddenOnMobile:s[5]!=null};s[5]!==void 0&&(b.selected=s[5]),a=new Sx({props:b}),pc.push(()=>ch(a,"selected",g));let k=e_(s);return{c(){e=Ve("div"),ir(a.$$.fragment),c=St(),k.c(),f=St(),i=Qt(),this.h()},l(x){e=$e(x,"DIV",{class:!0});var S=Ze(e);cr(a.$$.fragment,S),c=kt(S),k.l(S),S.forEach(ie),f=kt(x),i=Qt(),this.h()},h(){ve(e,"class","container svelte-9mqv54")},m(x,S){Oe(x,e,S),nr(a,e,null),Me(e,c),k.m(e,null),Oe(x,f,S),Oe(x,i,S),d=!0},p(x,[S]){const E={};S&1&&(E.options=x[0]),S&8&&(E.globalSelectedCategories=x[3]),S&32&&(E.hiddenOnMobile=x[5]!=null),!o&&S&32&&(o=!0,E.selected=x[5],uh(()=>o=!1)),a.$set(E),S&32&&jr(h,h=x[5])?(Vr(),it(k,1,1,_r),$r(),k=e_(x),k.c(),Ge(k,1),k.m(e,null)):k.p(x,S)},i(x){d||(Ge(a.$$.fragment,x),Ge(k),d=!0)},o(x){it(a.$$.fragment,x),it(k),d=!1},d(x){x&&ie(e),sr(a),k.d(x),x&&ie(f),x&&ie(i)}}}function Dx(s,e){console.log(s,e)}function Lx(s,e){console.log(s,e)}const Rx=()=>{};function Ox(s,e,a){let o,{options:c=[]}=e,{clickCallback:h=Dx}=e,{removeCatCallback:f=Lx}=e,{globalSelectedCategories:i=[]}=e,{disabled:d=!1}=e,g=null,b=null;function k(){a(7,++o[g.label],o)}function x(){a(7,--o[g.label],o)}function S(F){g=F,a(5,g)}const E=(F,$)=>h(F,$),T=(F,$)=>f(F,$),A=()=>a(5,g=null);function z(F){b=F,a(6,b)}const D=(F,$)=>h(F,$);return s.$$set=F=>{"options"in F&&a(0,c=F.options),"clickCallback"in F&&a(1,h=F.clickCallback),"removeCatCallback"in F&&a(2,f=F.removeCatCallback),"globalSelectedCategories"in F&&a(3,i=F.globalSelectedCategories),"disabled"in F&&a(4,d=F.disabled)},s.$$.update=()=>{s.$$.dirty&1&&a(7,o=function(){let F={};return c.forEach($=>F[$.label]=0),F}())},[c,h,f,i,d,g,b,o,k,x,S,E,T,A,z,D]}class Bx extends Wr{constructor(e){super(),Kr(this,e,Ox,zx,jr,{options:0,clickCallback:1,removeCatCallback:2,globalSelectedCategories:3,disabled:4})}}var Hy={exports:{}};(function(s,e){(function(a,o){s.exports=o()})($o,function(){var a,o,c;function h(i,d){if(!a)a=d;else if(!o)o=d;else{var g="var sharedChunk = {}; ("+a+")(sharedChunk); ("+o+")(sharedChunk);",b={};a(b),c=d(b),typeof window<"u"&&(c.workerUrl=window.URL.createObjectURL(new Blob([g],{type:"text/javascript"})))}}h(["exports"],function(i){var d=g;function g(n,t,l,p){this.cx=3*n,this.bx=3*(l-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(p-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=l,this.p2y=p}function b(n,t,l,p){const y=new d(n,t,l,p);return function(w){return y.solve(w)}}g.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var l=n,p=0;p<8;p++){var y=this.sampleCurveX(l)-n;if(Math.abs(y)<t)return l;var w=this.sampleCurveDerivativeX(l);if(Math.abs(w)<1e-6)break;l-=y/w}var I=0,M=1;for(l=n,p=0;p<20&&(y=this.sampleCurveX(l),!(Math.abs(y-n)<t));p++)n>y?I=l:M=l,l=.5*(M-I)+I;return l},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};const k=b(.25,.1,.25,1);function x(n,t,l){return Math.min(l,Math.max(t,n))}function S(n,t,l){const p=l-t,y=((n-t)%p+p)%p+t;return y===t?l:y}function E(n,...t){for(const l of t)for(const p in l)n[p]=l[p];return n}let T=1;function A(n,t){n.forEach(l=>{t[l]&&(t[l]=t[l].bind(t))})}function z(n,t,l){const p={};for(const y in n)p[y]=t.call(l||this,n[y],y,n);return p}function D(n,t,l){const p={};for(const y in n)t.call(l||this,n[y],y,n)&&(p[y]=n[y]);return p}function F(n){return Array.isArray(n)?n.map(F):typeof n=="object"&&n?z(n,F):n}const $={};function q(n){$[n]||(typeof console<"u"&&console.warn(n),$[n]=!0)}function J(n,t,l){return(l.y-n.y)*(t.x-n.x)>(t.y-n.y)*(l.x-n.x)}function G(n){let t=0;for(let l,p,y=0,w=n.length,I=w-1;y<w;I=y++)l=n[y],p=n[I],t+=(p.x-l.x)*(l.y+p.y);return t}function oe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function de(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,p,y,w)=>{const I=y||w;return t[p]=!I||I.toLowerCase(),""}),t["max-age"]){const l=parseInt(t["max-age"],10);isNaN(l)?delete t["max-age"]:t["max-age"]=l}return t}let Ee,ot,le=null;function Ne(n){if(le==null){const t=n.navigator?n.navigator.userAgent:null;le=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return le}function Y(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Qe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(n){const t=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(n,t=0){const l=window.document.createElement("canvas"),p=l.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return l.width=n.width,l.height=n.height,p.drawImage(n,0,0,n.width,n.height),p.getImageData(-t,-t,n.width+2*t,n.height+2*t)},resolveURL:n=>(Ee||(Ee=document.createElement("a")),Ee.href=n,Ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ot==null&&(ot=matchMedia("(prefers-reduced-motion: reduce)")),ot.matches)}};var pt=dt;function dt(n,t){this.x=n,this.y=t}dt.prototype={clone:function(){return new dt(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,l=n.y-this.y;return t*t+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),l=Math.sin(n),p=l*this.x+t*this.y;return this.x=t*this.x-l*this.y,this.y=p,this},_rotateAround:function(n,t){var l=Math.cos(n),p=Math.sin(n),y=t.y+p*(this.x-t.x)+l*(this.y-t.y);return this.x=t.x+l*(this.x-t.x)-p*(this.y-t.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},dt.convert=function(n){return n instanceof dt?n:Array.isArray(n)?new dt(n[0],n[1]):n};const Zt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},nt="mapbox-tiles";let tt,ce,_e=500,ze=50;function re(){typeof caches>"u"||tt||(tt=caches.open(nt))}let ue=1/0;const Xe={supported:!1,testSupport:function(n){!Ke&&mt&&(Ot?er(n):wt=n)}};let wt,mt,Ke=!1,Ot=!1;function er(n){const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,mt),n.isContextLost())return;Xe.supported=!0}catch{}n.deleteTexture(t),Ke=!0}typeof document<"u"&&(mt=document.createElement("img"),mt.onload=function(){wt&&er(wt),wt=null,Ot=!0},mt.onerror=function(){Ke=!0,wt=null},mt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Lr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Lr);class Fr extends Error{constructor(t,l,p,y){super(`AJAXError: ${l} (${t}): ${p}`),this.status=t,this.statusText=l,this.url=p,this.body=y}}const K=oe()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function ct(n,t){const l=new AbortController,p=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:K(),signal:l.signal});let y=!1,w=!1;return n.type==="json"&&p.headers.set("Accept","application/json"),((I,M,R)=>{if(w)return;const N=Date.now();fetch(p).then(Z=>Z.ok?((X,ee,se)=>{(n.type==="arrayBuffer"?X.arrayBuffer():n.type==="json"?X.json():X.text()).then(ae=>{w||(ee&&se&&function(ke,we,Be){if(re(),!tt)return;const Ye={status:we.status,statusText:we.statusText,headers:new Headers};we.headers.forEach((We,ht)=>Ye.headers.set(ht,We));const Re=de(we.headers.get("Cache-Control")||"");Re["no-store"]||(Re["max-age"]&&Ye.headers.set("Expires",new Date(Be+1e3*Re["max-age"]).toUTCString()),new Date(Ye.headers.get("Expires")).getTime()-Be<42e4||function(We,ht){if(ce===void 0)try{new Response(new ReadableStream),ce=!0}catch{ce=!1}ce?ht(We.body):We.blob().then(ht)}(we,We=>{const ht=new Response(We,Ye);re(),tt&&tt.then(ut=>ut.put(function(jt){const Gt=jt.indexOf("?");return Gt<0?jt:jt.slice(0,Gt)}(ke.url),ht)).catch(ut=>q(ut.message))}))}(p,ee,se),y=!0,t(null,ae,X.headers.get("Cache-Control"),X.headers.get("Expires")))}).catch(ae=>{w||t(new Error(ae.message))})})(Z,null,N):Z.blob().then(X=>t(new Fr(Z.status,Z.statusText,n.url,X)))).catch(Z=>{Z.code!==20&&t(new Error(Z.message))})})(),{cancel:()=>{w=!0,y||l.abort()}}}const et=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){if(oe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t);if(!oe()){const p=n.url.substring(0,n.url.indexOf("://"));return(Zt.REGISTERED_PROTOCOLS[p]||ct)(n,t)}}if(!(/^file:/.test(l=n.url)||/^file:/.test(K())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ct(n,t);if(oe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var l;return function(p,y){const w=new XMLHttpRequest;w.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(w.responseType="arraybuffer");for(const I in p.headers)w.setRequestHeader(I,p.headers[I]);return p.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=p.credentials==="include",w.onerror=()=>{y(new Error(w.statusText))},w.onload=()=>{if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let I=w.response;if(p.type==="json")try{I=JSON.parse(w.response)}catch(M){return y(M)}y(null,I,w.getResponseHeader("Cache-Control"),w.getResponseHeader("Expires"))}else{const I=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});y(new Fr(w.status,w.statusText,p.url,I))}},w.send(p.body),{cancel:()=>w.abort()}}(n,t)},be=function(n,t){return et(E(n,{type:"arrayBuffer"}),t)};function me(n){const t=window.document.createElement("a");return t.href=n,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}const Ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ft,gt;ft=[],gt=0;const je=function(n,t){if(Xe.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),gt>=Zt.MAX_PARALLEL_IMAGE_REQUESTS){const w={requestParameters:n,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return ft.push(w),w}gt++;let l=!1;const p=()=>{if(!l)for(l=!0,gt--;ft.length&&gt<Zt.MAX_PARALLEL_IMAGE_REQUESTS;){const w=ft.shift(),{requestParameters:I,callback:M,cancelled:R}=w;R||(w.cancel=je(I,M).cancel)}},y=be(n,(w,I,M,R)=>{p(),w?t(w):I&&function(N,Z){typeof createImageBitmap=="function"?function(X,ee){const se=new Blob([new Uint8Array(X)],{type:"image/png"});createImageBitmap(se).then(ae=>{ee(null,ae)}).catch(ae=>{ee(new Error(`Could not load image because of ${ae.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(N,Z):function(X,ee){const se=new Image;se.onload=()=>{ee(null,se),URL.revokeObjectURL(se.src),se.onload=null,window.requestAnimationFrame(()=>{se.src=Ie})},se.onerror=()=>ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ae=new Blob([new Uint8Array(X)],{type:"image/png"});se.src=X.byteLength?URL.createObjectURL(ae):Ie}(N,Z)}(I,(N,Z)=>{N!=null?t(N):Z!=null&&t(null,Z,{cacheControl:M,expires:R})})});return{cancel:()=>{y.cancel(),p()}}};function vt(n,t,l){l[n]&&l[n].indexOf(t)!==-1||(l[n]=l[n]||[],l[n].push(t))}function Bt(n,t,l){if(l&&l[n]){const p=l[n].indexOf(t);p!==-1&&l[n].splice(p,1)}}class Et{constructor(t,l={}){E(this,l),this.type=t}}class Ht extends Et{constructor(t,l={}){super("error",E({error:t},l))}}class wr{on(t,l){return this._listeners=this._listeners||{},vt(t,l,this._listeners),this}off(t,l){return Bt(t,l,this._listeners),Bt(t,l,this._oneTimeListeners),this}once(t,l){return this._oneTimeListeners=this._oneTimeListeners||{},vt(t,l,this._oneTimeListeners),this}fire(t,l){typeof t=="string"&&(t=new Et(t,l||{}));const p=t.type;if(this.listens(p)){t.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const M of y)M.call(this,t);const w=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const M of w)Bt(p,M,this._oneTimeListeners),M.call(this,t);const I=this._eventedParent;I&&(E(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(t))}else t instanceof Ht&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,l){return this._eventedParent=t,this._eventedParentData=l,this}}var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class _t{constructor(t,l,p,y){this.message=(t?`${t}: `:"")+p,y&&(this.identifier=y),l!=null&&l.__line__&&(this.line=l.__line__)}}function gi(n){const t=n.value;return t?[new _t(n.key,t,"constants have been deprecated as of v8")]:[]}function ri(n,...t){for(const l of t)for(const p in l)n[p]=l[p];return n}function yr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function kr(n){if(Array.isArray(n))return n.map(kr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const l in n)t[l]=kr(n[l]);return t}return yr(n)}class _i extends Error{constructor(t,l){super(l),this.message=l,this.key=t}}class ki{constructor(t,l=[]){this.parent=t,this.bindings={};for(const[p,y]of l)this.bindings[p]=y}concat(t){return new ki(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const yi={kind:"null"},Tt={kind:"number"},pr={kind:"string"},hr={kind:"boolean"},vi={kind:"color"},sn={kind:"object"},ar={kind:"value"},$i={kind:"collator"},ii={kind:"formatted"},ls={kind:"padding"},hi={kind:"resolvedImage"};function Li(n,t){return{kind:"array",itemType:n,N:t}}function Rr(n){if(n.kind==="array"){const t=Rr(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const jn=[yi,Tt,pr,hr,vi,ii,sn,Li(ar),ls,hi];function _n(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!_n(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const l of jn)if(!_n(l,t))return null}}return`Expected ${Rr(n)} but found ${Rr(t)} instead.`}function zn(n,t){return t.some(l=>l.kind===n.kind)}function qn(n,t){return t.some(l=>l==="null"?n===null:l==="array"?Array.isArray(n):l==="object"?n&&!Array.isArray(n)&&typeof n=="object":l===typeof n)}var Gn,Ae={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function U(n){return(n=Math.round(n))<0?0:n>255?255:n}function L(n){return U(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function V(n){return(t=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:t>1?1:t;var t}function H(n,t,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?n+(t-n)*l*6:2*l<1?t:3*l<2?n+(t-n)*(2/3-l)*6:n}try{Gn={}.parseCSSColor=function(n){var t,l=n.replace(/ /g,"").toLowerCase();if(l in Ae)return Ae[l].slice();if(l[0]==="#")return l.length===4?(t=parseInt(l.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:l.length===7&&(t=parseInt(l.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var p=l.indexOf("("),y=l.indexOf(")");if(p!==-1&&y+1===l.length){var w=l.substr(0,p),I=l.substr(p+1,y-(p+1)).split(","),M=1;switch(w){case"rgba":if(I.length!==4)return null;M=V(I.pop());case"rgb":return I.length!==3?null:[L(I[0]),L(I[1]),L(I[2]),M];case"hsla":if(I.length!==4)return null;M=V(I.pop());case"hsl":if(I.length!==3)return null;var R=(parseFloat(I[0])%360+360)%360/360,N=V(I[1]),Z=V(I[2]),X=Z<=.5?Z*(N+1):Z+N-Z*N,ee=2*Z-X;return[U(255*H(ee,X,R+1/3)),U(255*H(ee,X,R)),U(255*H(ee,X,R-1/3)),M];default:return null}}return null}}catch{}class te{constructor(t,l,p,y=1){this.r=t,this.g=l,this.b=p,this.a=y}static parse(t){if(!t)return;if(t instanceof te)return t;if(typeof t!="string")return;const l=Gn(t);return l?new te(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[t,l,p,y]=this.toArray();return`rgba(${Math.round(t)},${Math.round(l)},${Math.round(p)},${y})`}toArray(){const{r:t,g:l,b:p,a:y}=this;return y===0?[0,0,0,0]:[255*t/y,255*l/y,255*p/y,y]}}te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);class he{constructor(t,l,p){this.sensitivity=t?l?"variant":"case":l?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,l){return this.collator.compare(t,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Te{constructor(t,l,p,y,w){this.text=t,this.image=l,this.scale=p,this.fontStack=y,this.textColor=w}}class Se{constructor(t){this.sections=t}static fromString(t){return new Se([new Te(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Se?t:Se.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class ye{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ye)return t;if(typeof t=="number")return new ye([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const l of t)if(typeof l!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ye(t)}}toString(){return JSON.stringify(this.values)}}class Ce{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ce({name:t,available:!1}):null}}function qe(n,t,l,p){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof l=="number"&&l>=0&&l<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[n,t,l,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[n,t,l,p]:[n,t,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function at(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof te||n instanceof he||n instanceof Se||n instanceof ye||n instanceof Ce)return!0;if(Array.isArray(n)){for(const t of n)if(!at(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!at(n[t]))return!1;return!0}return!1}function Le(n){if(n===null)return yi;if(typeof n=="string")return pr;if(typeof n=="boolean")return hr;if(typeof n=="number")return Tt;if(n instanceof te)return vi;if(n instanceof he)return $i;if(n instanceof Se)return ii;if(n instanceof ye)return ls;if(n instanceof Ce)return hi;if(Array.isArray(n)){const t=n.length;let l;for(const p of n){const y=Le(p);if(l){if(l===y)continue;l=ar;break}l=y}return Li(l||ar,t)}return sn}function It(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof te||n instanceof Se||n instanceof ye||n instanceof Ce?n.toString():JSON.stringify(n)}class Pt{constructor(t,l){this.type=t,this.value=l}static parse(t,l){if(t.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!at(t[1]))return l.error("invalid value");const p=t[1];let y=Le(p);const w=l.expectedType;return y.kind!=="array"||y.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(y=w),new Pt(y,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class bt{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Xt={string:pr,number:Tt,boolean:hr,object:sn};class Yt{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let p,y=1;const w=t[0];if(w==="array"){let M,R;if(t.length>2){const N=t[1];if(typeof N!="string"||!(N in Xt)||N==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);M=Xt[N],y++}else M=ar;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return l.error('The length argument to "array" must be a positive integer literal',2);R=t[2],y++}p=Li(M,R)}else{if(!Xt[w])throw new Error(`Types doesn't contain name = ${w}`);p=Xt[w]}const I=[];for(;y<t.length;y++){const M=l.parse(t[y],y,ar);if(!M)return null;I.push(M)}return new Yt(p,I)}evaluate(t){for(let l=0;l<this.args.length;l++){const p=this.args[l].evaluate(t);if(!_n(this.type,Le(p)))return p;if(l===this.args.length-1)throw new bt(`Expected value to be of type ${Rr(this.type)}, but found ${Rr(Le(p))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const mr={"to-boolean":hr,"to-color":vi,"to-number":Tt,"to-string":pr};class or{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");const p=t[0];if(!mr[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&t.length!==2)return l.error("Expected one argument.");const y=mr[p],w=[];for(let I=1;I<t.length;I++){const M=l.parse(t[I],I,ar);if(!M)return null;w.push(M)}return new or(y,w)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let l,p;for(const y of this.args){if(l=y.evaluate(t),p=null,l instanceof te)return l;if(typeof l=="string"){const w=t.parseColor(l);if(w)return w}else if(Array.isArray(l)&&(p=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:qe(l[0],l[1],l[2],l[3]),!p))return new te(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new bt(p||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}if(this.type.kind==="padding"){let l;for(const p of this.args){l=p.evaluate(t);const y=ye.parse(l);if(y)return y}throw new bt(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}if(this.type.kind==="number"){let l=null;for(const p of this.args){if(l=p.evaluate(t),l===null)return 0;const y=Number(l);if(!isNaN(y))return y}throw new bt(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?Se.fromString(It(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ce.fromString(It(this.args[0].evaluate(t))):It(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const fr=["Unknown","Point","LineString","Polygon"];class dr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let l=this._parseColorCache[t];return l||(l=this._parseColorCache[t]=te.parse(t)),l}}class Er{constructor(t,l,p,y){this.name=t,this.type=l,this._evaluate=p,this.args=y}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,l){const p=t[0],y=Er.definitions[p];if(!y)return l.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(y)?y[0]:y.type,I=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,M=I.filter(([N])=>!Array.isArray(N)||N.length===t.length-1);let R=null;for(const[N,Z]of M){R=new Ws(l.registry,l.path,null,l.scope);const X=[];let ee=!1;for(let se=1;se<t.length;se++){const ae=t[se],ke=Array.isArray(N)?N[se-1]:N.type,we=R.parse(ae,1+X.length,ke);if(!we){ee=!0;break}X.push(we)}if(!ee)if(Array.isArray(N)&&N.length!==X.length)R.error(`Expected ${N.length} arguments, but found ${X.length} instead.`);else{for(let se=0;se<X.length;se++){const ae=Array.isArray(N)?N[se]:N.type,ke=X[se];R.concat(se+1).checkSubtype(ae,ke.type)}if(R.errors.length===0)return new Er(p,w,Z,X)}}if(M.length===1)l.errors.push(...R.errors);else{const N=(M.length?M:I).map(([X])=>{return ee=X,Array.isArray(ee)?`(${ee.map(Rr).join(", ")})`:`(${Rr(ee.type)}...)`;var ee}).join(" | "),Z=[];for(let X=1;X<t.length;X++){const ee=l.parse(t[X],1+Z.length);if(!ee)return null;Z.push(Rr(ee.type))}l.error(`Expected arguments of type ${N}, but found (${Z.join(", ")}) instead.`)}return null}static register(t,l){Er.definitions=l;for(const p in l)t[p]=Er}}class Qr{constructor(t,l,p){this.type=$i,this.locale=p,this.caseSensitive=t,this.diacriticSensitive=l}static parse(t,l){if(t.length!==2)return l.error("Expected one argument.");const p=t[1];if(typeof p!="object"||Array.isArray(p))return l.error("Collator options argument must be an object.");const y=l.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,hr);if(!y)return null;const w=l.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,hr);if(!w)return null;let I=null;return p.locale&&(I=l.parse(p.locale,1,pr),!I)?null:new Qr(y,w,I)}evaluate(t){return new he(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const Dr=8192;function di(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Zn(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function cs(n,t){const l=(180+n[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,y=Math.pow(2,t.z);return[Math.round(l*y*Dr),Math.round(p*y*Dr)]}function Or(n,t,l){const p=n[0]-t[0],y=n[1]-t[1],w=n[0]-l[0],I=n[1]-l[1];return p*I-w*y==0&&p*w<=0&&y*I<=0}function us(n,t){let l=!1;for(let I=0,M=t.length;I<M;I++){const R=t[I];for(let N=0,Z=R.length;N<Z-1;N++){if(Or(n,R[N],R[N+1]))return!1;(y=R[N])[1]>(p=n)[1]!=(w=R[N+1])[1]>p[1]&&p[0]<(w[0]-y[0])*(p[1]-y[1])/(w[1]-y[1])+y[0]&&(l=!l)}}var p,y,w;return l}function hs(n,t){for(let l=0;l<t.length;l++)if(us(n,t[l]))return!0;return!1}function ya(n,t,l,p){const y=p[0]-l[0],w=p[1]-l[1],I=(n[0]-l[0])*w-y*(n[1]-l[1]),M=(t[0]-l[0])*w-y*(t[1]-l[1]);return I>0&&M<0||I<0&&M>0}function va(n,t,l){for(const N of l)for(let Z=0;Z<N.length-1;++Z)if((M=[(I=N[Z+1])[0]-(w=N[Z])[0],I[1]-w[1]])[0]*(R=[(y=t)[0]-(p=n)[0],y[1]-p[1]])[1]-M[1]*R[0]!=0&&ya(p,y,w,I)&&ya(w,I,p,y))return!0;var p,y,w,I,M,R;return!1}function Hn(n,t){for(let l=0;l<n.length;++l)if(!us(n[l],t))return!1;for(let l=0;l<n.length-1;++l)if(va(n[l],n[l+1],t))return!1;return!0}function yh(n,t){for(let l=0;l<t.length;l++)if(Hn(n,t[l]))return!0;return!1}function so(n,t,l){const p=[];for(let y=0;y<n.length;y++){const w=[];for(let I=0;I<n[y].length;I++){const M=cs(n[y][I],l);di(t,M),w.push(M)}p.push(w)}return p}function el(n,t,l){const p=[];for(let y=0;y<n.length;y++){const w=so(n[y],t,l);p.push(w)}return p}function Cc(n,t,l,p){if(n[0]<l[0]||n[0]>l[2]){const y=.5*p;let w=n[0]-l[0]>y?-p:l[0]-n[0]>y?p:0;w===0&&(w=n[0]-l[2]>y?-p:l[2]-n[0]>y?p:0),n[0]+=w}di(t,n)}function Ic(n,t,l,p){const y=Math.pow(2,p.z)*Dr,w=[p.x*Dr,p.y*Dr],I=[];for(const M of n)for(const R of M){const N=[R.x+w[0],R.y+w[1]];Cc(N,t,l,y),I.push(N)}return I}function Ac(n,t,l,p){const y=Math.pow(2,p.z)*Dr,w=[p.x*Dr,p.y*Dr],I=[];for(const R of n){const N=[];for(const Z of R){const X=[Z.x+w[0],Z.y+w[1]];di(t,X),N.push(X)}I.push(N)}if(t[2]-t[0]<=y/2){(M=t)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const R of I)for(const N of R)Cc(N,t,l,y)}var M;return I}class Es{constructor(t,l){this.type=hr,this.geojson=t,this.geometries=l}static parse(t,l){if(t.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(at(t[1])){const p=t[1];if(p.type==="FeatureCollection")for(let y=0;y<p.features.length;++y){const w=p.features[y].geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new Es(p,p.features[y].geometry)}else if(p.type==="Feature"){const y=p.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Es(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Es(p,p)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(l,p){const y=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],I=l.canonicalID();if(p.type==="Polygon"){const M=so(p.coordinates,w,I),R=Ic(l.geometry(),y,w,I);if(!Zn(y,w))return!1;for(const N of R)if(!us(N,M))return!1}if(p.type==="MultiPolygon"){const M=el(p.coordinates,w,I),R=Ic(l.geometry(),y,w,I);if(!Zn(y,w))return!1;for(const N of R)if(!hs(N,M))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(l,p){const y=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],I=l.canonicalID();if(p.type==="Polygon"){const M=so(p.coordinates,w,I),R=Ac(l.geometry(),y,w,I);if(!Zn(y,w))return!1;for(const N of R)if(!Hn(N,M))return!1}if(p.type==="MultiPolygon"){const M=el(p.coordinates,w,I),R=Ac(l.geometry(),y,w,I);if(!Zn(y,w))return!1;for(const N of R)if(!yh(N,M))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function ba(n){if(n instanceof Er&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Es)return!1;let t=!0;return n.eachChild(l=>{t&&!ba(l)&&(t=!1)}),t}function Hs(n){if(n instanceof Er&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(l=>{t&&!Hs(l)&&(t=!1)}),t}function ao(n,t){if(n instanceof Er&&t.indexOf(n.name)>=0)return!1;let l=!0;return n.eachChild(p=>{l&&!ao(p,t)&&(l=!1)}),l}class oo{constructor(t,l){this.type=l.type,this.name=t,this.boundExpression=l}static parse(t,l){if(t.length!==2||typeof t[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const p=t[1];return l.scope.has(p)?new oo(p,l.scope.get(p)):l.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ws{constructor(t,l=[],p,y=new ki,w=[]){this.registry=t,this.path=l,this.key=l.map(I=>`[${I}]`).join(""),this.scope=y,this.errors=w,this.expectedType=p}parse(t,l,p,y,w={}){return l?this.concat(l,p,y)._parse(t,w):this._parse(t,w)}_parse(t,l){function p(y,w,I){return I==="assert"?new Yt(w,[y]):I==="coerce"?new or(w,[y]):y}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=t[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[y];if(w){let I=w.parse(t,this);if(!I)return null;if(this.expectedType){const M=this.expectedType,R=I.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||R.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(M.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array"){if(this.checkSubtype(M,R))return null}else I=p(I,M,l.typeAnnotation||"coerce");else I=p(I,M,l.typeAnnotation||"coerce");else I=p(I,M,l.typeAnnotation||"assert")}if(!(I instanceof Pt)&&I.type.kind!=="resolvedImage"&&tl(I)){const M=new dr;try{I=new Pt(I.type,I.evaluate(M))}catch(R){return this.error(R.message),null}}return I}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,l,p){const y=typeof t=="number"?this.path.concat(t):this.path,w=p?this.scope.concat(p):this.scope;return new Ws(this.registry,y,l||null,w,this.errors)}error(t,...l){const p=`${this.key}${l.map(y=>`[${y}]`).join("")}`;this.errors.push(new _i(p,t))}checkSubtype(t,l){const p=_n(t,l);return p&&this.error(p),p}}function tl(n){if(n instanceof oo)return tl(n.boundExpression);if(n instanceof Er&&n.name==="error"||n instanceof Qr||n instanceof Es)return!1;const t=n instanceof or||n instanceof Yt;let l=!0;return n.eachChild(p=>{l=t?l&&tl(p):l&&p instanceof Pt}),!!l&&ba(n)&&ao(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function lo(n,t){const l=n.length-1;let p,y,w=0,I=l,M=0;for(;w<=I;)if(M=Math.floor((w+I)/2),p=n[M],y=n[M+1],p<=t){if(M===l||t<y)return M;w=M+1}else{if(!(p>t))throw new bt("Input is not a number.");I=M-1}return 0}class xa{constructor(t,l,p){this.type=t,this.input=l,this.labels=[],this.outputs=[];for(const[y,w]of p)this.labels.push(y),this.outputs.push(w)}static parse(t,l){if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");const p=l.parse(t[1],1,Tt);if(!p)return null;const y=[];let w=null;l.expectedType&&l.expectedType.kind!=="value"&&(w=l.expectedType);for(let I=1;I<t.length;I+=2){const M=I===1?-1/0:t[I],R=t[I+1],N=I,Z=I+1;if(typeof M!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(y.length&&y[y.length-1][0]>=M)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const X=l.parse(R,Z,w);if(!X)return null;w=w||X.type,y.push([M,X])}return new xa(w,p,y)}evaluate(t){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(t);const y=this.input.evaluate(t);if(y<=l[0])return p[0].evaluate(t);const w=l.length;return y>=l[w-1]?p[w-1].evaluate(t):p[lo(l,y)].evaluate(t)}eachChild(t){t(this.input);for(const l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ni(n,t,l){return n*(1-l)+t*l}var wa=Object.freeze({__proto__:null,number:ni,color:function(n,t,l){return new te(ni(n.r,t.r,l),ni(n.g,t.g,l),ni(n.b,t.b,l),ni(n.a,t.a,l))},array:function(n,t,l){return n.map((p,y)=>ni(p,t[y],l))},padding:function(n,t,l){const p=n.values,y=t.values;return new ye([ni(p[0],y[0],l),ni(p[1],y[1],l),ni(p[2],y[2],l),ni(p[3],y[3],l)])}});const Pc=.95047,Mc=1.08883,rl=4/29,co=6/29,zc=3*co*co,vh=Math.PI/180,bh=180/Math.PI;function il(n){return n>.008856451679035631?Math.pow(n,1/3):n/zc+rl}function nl(n){return n>co?n*n*n:zc*(n-rl)}function sl(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function al(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Br(n){const t=al(n.r),l=al(n.g),p=al(n.b),y=il((.4124564*t+.3575761*l+.1804375*p)/Pc),w=il((.2126729*t+.7151522*l+.072175*p)/1);return{l:116*w-16,a:500*(y-w),b:200*(w-il((.0193339*t+.119192*l+.9503041*p)/Mc)),alpha:n.a}}function Dc(n){let t=(n.l+16)/116,l=isNaN(n.a)?t:t+n.a/500,p=isNaN(n.b)?t:t-n.b/200;return t=1*nl(t),l=Pc*nl(l),p=Mc*nl(p),new te(sl(3.2404542*l-1.5371385*t-.4985314*p),sl(-.969266*l+1.8760108*t+.041556*p),sl(.0556434*l-.2040259*t+1.0572252*p),n.alpha)}function xh(n,t,l){const p=t-n;return n+l*(p>180||p<-180?p-360*Math.round(p/360):p)}const Sa={forward:Br,reverse:Dc,interpolate:function(n,t,l){return{l:ni(n.l,t.l,l),a:ni(n.a,t.a,l),b:ni(n.b,t.b,l),alpha:ni(n.alpha,t.alpha,l)}}},ka={forward:function(n){const{l:t,a:l,b:p}=Br(n),y=Math.atan2(p,l)*bh;return{h:y<0?y+360:y,c:Math.sqrt(l*l+p*p),l:t,alpha:n.a}},reverse:function(n){const t=n.h*vh,l=n.c;return Dc({l:n.l,a:Math.cos(t)*l,b:Math.sin(t)*l,alpha:n.alpha})},interpolate:function(n,t,l){return{h:xh(n.h,t.h,l),c:ni(n.c,t.c,l),l:ni(n.l,t.l,l),alpha:ni(n.alpha,t.alpha,l)}}};var Lc=Object.freeze({__proto__:null,lab:Sa,hcl:ka});class an{constructor(t,l,p,y,w){this.type=t,this.operator=l,this.interpolation=p,this.input=y,this.labels=[],this.outputs=[];for(const[I,M]of w)this.labels.push(I),this.outputs.push(M)}static interpolationFactor(t,l,p,y){let w=0;if(t.name==="exponential")w=ol(l,t.base,p,y);else if(t.name==="linear")w=ol(l,1,p,y);else if(t.name==="cubic-bezier"){const I=t.controlPoints;w=new d(I[0],I[1],I[2],I[3]).solve(ol(l,1,p,y))}return w}static parse(t,l){let[p,y,w,...I]=t;if(!Array.isArray(y)||y.length===0)return l.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const N=y[1];if(typeof N!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:N}}else{if(y[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const N=y.slice(1);if(N.length!==4||N.some(Z=>typeof Z!="number"||Z<0||Z>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:N}}}if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(w=l.parse(w,2,Tt),!w)return null;const M=[];let R=null;p==="interpolate-hcl"||p==="interpolate-lab"?R=vi:l.expectedType&&l.expectedType.kind!=="value"&&(R=l.expectedType);for(let N=0;N<I.length;N+=2){const Z=I[N],X=I[N+1],ee=N+3,se=N+4;if(typeof Z!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(M.length&&M[M.length-1][0]>=Z)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const ae=l.parse(X,se,R);if(!ae)return null;R=R||ae.type,M.push([Z,ae])}return R.kind==="number"||R.kind==="color"||R.kind==="padding"||R.kind==="array"&&R.itemType.kind==="number"&&typeof R.N=="number"?new an(R,p,y,w,M):l.error(`Type ${Rr(R)} is not interpolatable.`)}evaluate(t){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(t);const y=this.input.evaluate(t);if(y<=l[0])return p[0].evaluate(t);const w=l.length;if(y>=l[w-1])return p[w-1].evaluate(t);const I=lo(l,y),M=an.interpolationFactor(this.interpolation,y,l[I],l[I+1]),R=p[I].evaluate(t),N=p[I+1].evaluate(t);return this.operator==="interpolate"?wa[this.type.kind.toLowerCase()](R,N,M):this.operator==="interpolate-hcl"?ka.reverse(ka.interpolate(ka.forward(R),ka.forward(N),M)):Sa.reverse(Sa.interpolate(Sa.forward(R),Sa.forward(N),M))}eachChild(t){t(this.input);for(const l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ol(n,t,l,p){const y=p-l,w=n-l;return y===0?0:t===1?w/y:(Math.pow(t,w)-1)/(Math.pow(t,y)-1)}class uo{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expectected at least one argument.");let p=null;const y=l.expectedType;y&&y.kind!=="value"&&(p=y);const w=[];for(const M of t.slice(1)){const R=l.parse(M,1+w.length,p,void 0,{typeAnnotation:"omit"});if(!R)return null;p=p||R.type,w.push(R)}if(!p)throw new Error("No output type");const I=y&&w.some(M=>_n(y,M.type));return new uo(I?ar:p,w)}evaluate(t){let l,p=null,y=0;for(const w of this.args)if(y++,p=w.evaluate(t),p&&p instanceof Ce&&!p.available&&(l||(l=p.name),p=null,y===this.args.length&&(p=l)),p!==null)break;return p}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class ho{constructor(t,l){this.type=l.type,this.bindings=[].concat(t),this.result=l}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const l of this.bindings)t(l[1]);t(this.result)}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const p=[];for(let w=1;w<t.length-1;w+=2){const I=t[w];if(typeof I!="string")return l.error(`Expected string, but found ${typeof I} instead.`,w);if(/[^a-zA-Z0-9_]/.test(I))return l.error("Variable names must contain only alphanumeric characters or '_'.",w);const M=l.parse(t[w+1],w+1);if(!M)return null;p.push([I,M])}const y=l.parse(t[t.length-1],t.length-1,l.expectedType,p);return y?new ho(p,y):null}outputDefined(){return this.result.outputDefined()}}class ll{constructor(t,l,p){this.type=t,this.index=l,this.input=p}static parse(t,l){if(t.length!==3)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const p=l.parse(t[1],1,Tt),y=l.parse(t[2],2,Li(l.expectedType||ar));return p&&y?new ll(y.type.itemType,p,y):null}evaluate(t){const l=this.index.evaluate(t),p=this.input.evaluate(t);if(l<0)throw new bt(`Array index out of bounds: ${l} < 0.`);if(l>=p.length)throw new bt(`Array index out of bounds: ${l} > ${p.length-1}.`);if(l!==Math.floor(l))throw new bt(`Array index must be an integer, but found ${l} instead.`);return p[l]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class cl{constructor(t,l){this.type=hr,this.needle=t,this.haystack=l}static parse(t,l){if(t.length!==3)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const p=l.parse(t[1],1,ar),y=l.parse(t[2],2,ar);return p&&y?zn(p.type,[hr,pr,Tt,yi,ar])?new cl(p,y):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(p.type)} instead`):null}evaluate(t){const l=this.needle.evaluate(t),p=this.haystack.evaluate(t);if(!p)return!1;if(!qn(l,["boolean","string","number","null"]))throw new bt(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(Le(l))} instead.`);if(!qn(p,["string","array"]))throw new bt(`Expected second argument to be of type array or string, but found ${Rr(Le(p))} instead.`);return p.indexOf(l)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class fo{constructor(t,l,p){this.type=Tt,this.needle=t,this.haystack=l,this.fromIndex=p}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const p=l.parse(t[1],1,ar),y=l.parse(t[2],2,ar);if(!p||!y)return null;if(!zn(p.type,[hr,pr,Tt,yi,ar]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(p.type)} instead`);if(t.length===4){const w=l.parse(t[3],3,Tt);return w?new fo(p,y,w):null}return new fo(p,y)}evaluate(t){const l=this.needle.evaluate(t),p=this.haystack.evaluate(t);if(!qn(l,["boolean","string","number","null"]))throw new bt(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(Le(l))} instead.`);if(!qn(p,["string","array"]))throw new bt(`Expected second argument to be of type array or string, but found ${Rr(Le(p))} instead.`);if(this.fromIndex){const y=this.fromIndex.evaluate(t);return p.indexOf(l,y)}return p.indexOf(l)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ul{constructor(t,l,p,y,w,I){this.inputType=t,this.type=l,this.input=p,this.cases=y,this.outputs=w,this.otherwise=I}static parse(t,l){if(t.length<5)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return l.error("Expected an even number of arguments.");let p,y;l.expectedType&&l.expectedType.kind!=="value"&&(y=l.expectedType);const w={},I=[];for(let N=2;N<t.length-1;N+=2){let Z=t[N];const X=t[N+1];Array.isArray(Z)||(Z=[Z]);const ee=l.concat(N);if(Z.length===0)return ee.error("Expected at least one branch label.");for(const ae of Z){if(typeof ae!="number"&&typeof ae!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof ae=="number"&&Math.abs(ae)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ae=="number"&&Math.floor(ae)!==ae)return ee.error("Numeric branch labels must be integer values.");if(p){if(ee.checkSubtype(p,Le(ae)))return null}else p=Le(ae);if(w[String(ae)]!==void 0)return ee.error("Branch labels must be unique.");w[String(ae)]=I.length}const se=l.parse(X,N,y);if(!se)return null;y=y||se.type,I.push(se)}const M=l.parse(t[1],1,ar);if(!M)return null;const R=l.parse(t[t.length-1],t.length-1,y);return R?M.type.kind!=="value"&&l.concat(1).checkSubtype(p,M.type)?null:new ul(p,y,M,w,I,R):null}evaluate(t){const l=this.input.evaluate(t);return(Le(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class hl{constructor(t,l,p){this.type=t,this.branches=l,this.otherwise=p}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return l.error("Expected an odd number of arguments.");let p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const y=[];for(let I=1;I<t.length-1;I+=2){const M=l.parse(t[I],I,hr);if(!M)return null;const R=l.parse(t[I+1],I+1,p);if(!R)return null;y.push([M,R]),p=p||R.type}const w=l.parse(t[t.length-1],t.length-1,p);if(!w)return null;if(!p)throw new Error("Can't infer output type");return new hl(p,y,w)}evaluate(t){for(const[l,p]of this.branches)if(l.evaluate(t))return p.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[l,p]of this.branches)t(l),t(p);t(this.otherwise)}outputDefined(){return this.branches.every(([t,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class po{constructor(t,l,p,y){this.type=t,this.input=l,this.beginIndex=p,this.endIndex=y}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const p=l.parse(t[1],1,ar),y=l.parse(t[2],2,Tt);if(!p||!y)return null;if(!zn(p.type,[Li(ar),pr,ar]))return l.error(`Expected first argument to be of type array or string, but found ${Rr(p.type)} instead`);if(t.length===4){const w=l.parse(t[3],3,Tt);return w?new po(p.type,p,y,w):null}return new po(p.type,p,y)}evaluate(t){const l=this.input.evaluate(t),p=this.beginIndex.evaluate(t);if(!qn(l,["string","array"]))throw new bt(`Expected first argument to be of type array or string, but found ${Rr(Le(l))} instead.`);if(this.endIndex){const y=this.endIndex.evaluate(t);return l.slice(p,y)}return l.slice(p)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Rc(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Oc(n,t,l,p){return p.compare(t,l)===0}function Ks(n,t,l){const p=n!=="=="&&n!=="!=";return class Wy{constructor(w,I,M){this.type=hr,this.lhs=w,this.rhs=I,this.collator=M,this.hasUntypedArgument=w.type.kind==="value"||I.type.kind==="value"}static parse(w,I){if(w.length!==3&&w.length!==4)return I.error("Expected two or three arguments.");const M=w[0];let R=I.parse(w[1],1,ar);if(!R)return null;if(!Rc(M,R.type))return I.concat(1).error(`"${M}" comparisons are not supported for type '${Rr(R.type)}'.`);let N=I.parse(w[2],2,ar);if(!N)return null;if(!Rc(M,N.type))return I.concat(2).error(`"${M}" comparisons are not supported for type '${Rr(N.type)}'.`);if(R.type.kind!==N.type.kind&&R.type.kind!=="value"&&N.type.kind!=="value")return I.error(`Cannot compare types '${Rr(R.type)}' and '${Rr(N.type)}'.`);p&&(R.type.kind==="value"&&N.type.kind!=="value"?R=new Yt(N.type,[R]):R.type.kind!=="value"&&N.type.kind==="value"&&(N=new Yt(R.type,[N])));let Z=null;if(w.length===4){if(R.type.kind!=="string"&&N.type.kind!=="string"&&R.type.kind!=="value"&&N.type.kind!=="value")return I.error("Cannot use collator to compare non-string types.");if(Z=I.parse(w[3],3,$i),!Z)return null}return new Wy(R,N,Z)}evaluate(w){const I=this.lhs.evaluate(w),M=this.rhs.evaluate(w);if(p&&this.hasUntypedArgument){const R=Le(I),N=Le(M);if(R.kind!==N.kind||R.kind!=="string"&&R.kind!=="number")throw new bt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${R.kind}, ${N.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const R=Le(I),N=Le(M);if(R.kind!=="string"||N.kind!=="string")return t(w,I,M)}return this.collator?l(w,I,M,this.collator.evaluate(w)):t(w,I,M)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const wh=Ks("==",function(n,t,l){return t===l},Oc),Sh=Ks("!=",function(n,t,l){return t!==l},function(n,t,l,p){return!Oc(0,t,l,p)}),kh=Ks("<",function(n,t,l){return t<l},function(n,t,l,p){return p.compare(t,l)<0}),Eh=Ks(">",function(n,t,l){return t>l},function(n,t,l,p){return p.compare(t,l)>0}),Th=Ks("<=",function(n,t,l){return t<=l},function(n,t,l,p){return p.compare(t,l)<=0}),Ch=Ks(">=",function(n,t,l){return t>=l},function(n,t,l,p){return p.compare(t,l)>=0});class fl{constructor(t,l,p,y,w){this.type=pr,this.number=t,this.locale=l,this.currency=p,this.minFractionDigits=y,this.maxFractionDigits=w}static parse(t,l){if(t.length!==3)return l.error("Expected two arguments.");const p=l.parse(t[1],1,Tt);if(!p)return null;const y=t[2];if(typeof y!="object"||Array.isArray(y))return l.error("NumberFormat options argument must be an object.");let w=null;if(y.locale&&(w=l.parse(y.locale,1,pr),!w))return null;let I=null;if(y.currency&&(I=l.parse(y.currency,1,pr),!I))return null;let M=null;if(y["min-fraction-digits"]&&(M=l.parse(y["min-fraction-digits"],1,Tt),!M))return null;let R=null;return y["max-fraction-digits"]&&(R=l.parse(y["max-fraction-digits"],1,Tt),!R)?null:new fl(p,w,I,M,R)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class mo{constructor(t){this.type=ii,this.sections=t}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");const p=t[1];if(!Array.isArray(p)&&typeof p=="object")return l.error("First argument must be an image or text section.");const y=[];let w=!1;for(let I=1;I<=t.length-1;++I){const M=t[I];if(w&&typeof M=="object"&&!Array.isArray(M)){w=!1;let R=null;if(M["font-scale"]&&(R=l.parse(M["font-scale"],1,Tt),!R))return null;let N=null;if(M["text-font"]&&(N=l.parse(M["text-font"],1,Li(pr)),!N))return null;let Z=null;if(M["text-color"]&&(Z=l.parse(M["text-color"],1,vi),!Z))return null;const X=y[y.length-1];X.scale=R,X.font=N,X.textColor=Z}else{const R=l.parse(t[I],1,ar);if(!R)return null;const N=R.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,y.push({content:R,scale:null,font:null,textColor:null})}}return new mo(y)}evaluate(t){return new Se(this.sections.map(l=>{const p=l.content.evaluate(t);return Le(p)===hi?new Te("",p,null,null,null):new Te(It(p),null,l.scale?l.scale.evaluate(t):null,l.font?l.font.evaluate(t).join(","):null,l.textColor?l.textColor.evaluate(t):null)}))}eachChild(t){for(const l of this.sections)t(l.content),l.scale&&t(l.scale),l.font&&t(l.font),l.textColor&&t(l.textColor)}outputDefined(){return!1}}class dl{constructor(t){this.type=hi,this.input=t}static parse(t,l){if(t.length!==2)return l.error("Expected two arguments.");const p=l.parse(t[1],1,pr);return p?new dl(p):l.error("No image name provided.")}evaluate(t){const l=this.input.evaluate(t),p=Ce.fromString(l);return p&&t.availableImages&&(p.available=t.availableImages.indexOf(l)>-1),p}eachChild(t){t(this.input)}outputDefined(){return!1}}class pl{constructor(t){this.type=Tt,this.input=t}static parse(t,l){if(t.length!==2)return l.error(`Expected 1 argument, but found ${t.length-1} instead.`);const p=l.parse(t[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Rr(p.type)} instead.`):new pl(p):null}evaluate(t){const l=this.input.evaluate(t);if(typeof l=="string"||Array.isArray(l))return l.length;throw new bt(`Expected value to be of type string or array, but found ${Rr(Le(l))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Xs={"==":wh,"!=":Sh,">":Eh,"<":kh,">=":Ch,"<=":Th,array:Yt,at:ll,boolean:Yt,case:hl,coalesce:uo,collator:Qr,format:mo,image:dl,in:cl,"index-of":fo,interpolate:an,"interpolate-hcl":an,"interpolate-lab":an,length:pl,let:ho,literal:Pt,match:ul,number:Yt,"number-format":fl,object:Yt,slice:po,step:xa,string:Yt,"to-boolean":or,"to-color":or,"to-number":or,"to-string":or,var:oo,within:Es};function Bc(n,[t,l,p,y]){t=t.evaluate(n),l=l.evaluate(n),p=p.evaluate(n);const w=y?y.evaluate(n):1,I=qe(t,l,p,w);if(I)throw new bt(I);return new te(t/255*w,l/255*w,p/255*w,w)}function Nc(n,t){return n in t}function go(n,t){const l=t[n];return l===void 0?null:l}function Ts(n){return{type:n}}function Fc(n){return{result:"success",value:n}}function Js(n){return{result:"error",value:n}}function ei(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Uc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ir(n){return!!n.expression&&n.expression.interpolated}function Nr(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Yr(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function si(n){return n}function Ea(n,t){const l=t.type==="color",p=n.stops&&typeof n.stops[0][0]=="object",y=p||!(p||n.property!==void 0),w=n.type||(Ir(t)?"exponential":"interval");if(l||t.type==="padding"){const N=l?te.parse:ye.parse;(n=ri({},n)).stops&&(n.stops=n.stops.map(Z=>[Z[0],N(Z[1])])),n.default=N(n.default?n.default:t.default)}if(n.colorSpace&&n.colorSpace!=="rgb"&&!Lc[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let I,M,R;if(w==="exponential")I=Vc;else if(w==="interval")I=Ah;else if(w==="categorical"){I=Ih,M=Object.create(null);for(const N of n.stops)M[N[0]]=N[1];R=typeof n.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);I=Ph}if(p){const N={},Z=[];for(let se=0;se<n.stops.length;se++){const ae=n.stops[se],ke=ae[0].zoom;N[ke]===void 0&&(N[ke]={zoom:ke,type:n.type,property:n.property,default:n.default,stops:[]},Z.push(ke)),N[ke].stops.push([ae[0].value,ae[1]])}const X=[];for(const se of Z)X.push([N[se].zoom,Ea(N[se],t)]);const ee={name:"linear"};return{kind:"composite",interpolationType:ee,interpolationFactor:an.interpolationFactor.bind(void 0,ee),zoomStops:X.map(se=>se[0]),evaluate:({zoom:se},ae)=>Vc({stops:X,base:n.base},t,se).evaluate(se,ae)}}if(y){const N=w==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:an.interpolationFactor.bind(void 0,N),zoomStops:n.stops.map(Z=>Z[0]),evaluate:({zoom:Z})=>I(n,t,Z,M,R)}}return{kind:"source",evaluate(N,Z){const X=Z&&Z.properties?Z.properties[n.property]:void 0;return X===void 0?Ys(n.default,t.default):I(n,t,X,M,R)}}}function Ys(n,t,l){return n!==void 0?n:t!==void 0?t:l!==void 0?l:void 0}function Ih(n,t,l,p,y){return Ys(typeof l===y?p[l]:void 0,n.default,t.default)}function Ah(n,t,l){if(Nr(l)!=="number")return Ys(n.default,t.default);const p=n.stops.length;if(p===1||l<=n.stops[0][0])return n.stops[0][1];if(l>=n.stops[p-1][0])return n.stops[p-1][1];const y=lo(n.stops.map(w=>w[0]),l);return n.stops[y][1]}function Vc(n,t,l){const p=n.base!==void 0?n.base:1;if(Nr(l)!=="number")return Ys(n.default,t.default);const y=n.stops.length;if(y===1||l<=n.stops[0][0])return n.stops[0][1];if(l>=n.stops[y-1][0])return n.stops[y-1][1];const w=lo(n.stops.map(Z=>Z[0]),l),I=function(Z,X,ee,se){const ae=se-ee,ke=Z-ee;return ae===0?0:X===1?ke/ae:(Math.pow(X,ke)-1)/(Math.pow(X,ae)-1)}(l,p,n.stops[w][0],n.stops[w+1][0]),M=n.stops[w][1],R=n.stops[w+1][1];let N=wa[t.type]||si;if(n.colorSpace&&n.colorSpace!=="rgb"){const Z=Lc[n.colorSpace];N=(X,ee)=>Z.reverse(Z.interpolate(Z.forward(X),Z.forward(ee),I))}return typeof M.evaluate=="function"?{evaluate(...Z){const X=M.evaluate.apply(void 0,Z),ee=R.evaluate.apply(void 0,Z);if(X!==void 0&&ee!==void 0)return N(X,ee,I)}}:N(M,R,I)}function Ph(n,t,l){switch(t.type){case"color":l=te.parse(l);break;case"formatted":l=Se.fromString(l.toString());break;case"resolvedImage":l=Ce.fromString(l.toString());break;case"padding":l=ye.parse(l);break;default:Nr(l)===t.type||t.type==="enum"&&t.values[l]||(l=void 0)}return Ys(l,n.default,t.default)}Er.register(Xs,{error:[{kind:"error"},[pr],(n,[t])=>{throw new bt(t.evaluate(n))}],typeof:[pr,[ar],(n,[t])=>Rr(Le(t.evaluate(n)))],"to-rgba":[Li(Tt,4),[vi],(n,[t])=>t.evaluate(n).toArray()],rgb:[vi,[Tt,Tt,Tt],Bc],rgba:[vi,[Tt,Tt,Tt,Tt],Bc],has:{type:hr,overloads:[[[pr],(n,[t])=>Nc(t.evaluate(n),n.properties())],[[pr,sn],(n,[t,l])=>Nc(t.evaluate(n),l.evaluate(n))]]},get:{type:ar,overloads:[[[pr],(n,[t])=>go(t.evaluate(n),n.properties())],[[pr,sn],(n,[t,l])=>go(t.evaluate(n),l.evaluate(n))]]},"feature-state":[ar,[pr],(n,[t])=>go(t.evaluate(n),n.featureState||{})],properties:[sn,[],n=>n.properties()],"geometry-type":[pr,[],n=>n.geometryType()],id:[ar,[],n=>n.id()],zoom:[Tt,[],n=>n.globals.zoom],"heatmap-density":[Tt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Tt,[],n=>n.globals.lineProgress||0],accumulated:[ar,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Tt,Ts(Tt),(n,t)=>{let l=0;for(const p of t)l+=p.evaluate(n);return l}],"*":[Tt,Ts(Tt),(n,t)=>{let l=1;for(const p of t)l*=p.evaluate(n);return l}],"-":{type:Tt,overloads:[[[Tt,Tt],(n,[t,l])=>t.evaluate(n)-l.evaluate(n)],[[Tt],(n,[t])=>-t.evaluate(n)]]},"/":[Tt,[Tt,Tt],(n,[t,l])=>t.evaluate(n)/l.evaluate(n)],"%":[Tt,[Tt,Tt],(n,[t,l])=>t.evaluate(n)%l.evaluate(n)],ln2:[Tt,[],()=>Math.LN2],pi:[Tt,[],()=>Math.PI],e:[Tt,[],()=>Math.E],"^":[Tt,[Tt,Tt],(n,[t,l])=>Math.pow(t.evaluate(n),l.evaluate(n))],sqrt:[Tt,[Tt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Tt,[Tt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Tt,[Tt],(n,[t])=>Math.log(t.evaluate(n))],log2:[Tt,[Tt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Tt,[Tt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Tt,[Tt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Tt,[Tt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Tt,[Tt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Tt,[Tt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Tt,[Tt],(n,[t])=>Math.atan(t.evaluate(n))],min:[Tt,Ts(Tt),(n,t)=>Math.min(...t.map(l=>l.evaluate(n)))],max:[Tt,Ts(Tt),(n,t)=>Math.max(...t.map(l=>l.evaluate(n)))],abs:[Tt,[Tt],(n,[t])=>Math.abs(t.evaluate(n))],round:[Tt,[Tt],(n,[t])=>{const l=t.evaluate(n);return l<0?-Math.round(-l):Math.round(l)}],floor:[Tt,[Tt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Tt,[Tt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[hr,[pr,ar],(n,[t,l])=>n.properties()[t.value]===l.value],"filter-id-==":[hr,[ar],(n,[t])=>n.id()===t.value],"filter-type-==":[hr,[pr],(n,[t])=>n.geometryType()===t.value],"filter-<":[hr,[pr,ar],(n,[t,l])=>{const p=n.properties()[t.value],y=l.value;return typeof p==typeof y&&p<y}],"filter-id-<":[hr,[ar],(n,[t])=>{const l=n.id(),p=t.value;return typeof l==typeof p&&l<p}],"filter->":[hr,[pr,ar],(n,[t,l])=>{const p=n.properties()[t.value],y=l.value;return typeof p==typeof y&&p>y}],"filter-id->":[hr,[ar],(n,[t])=>{const l=n.id(),p=t.value;return typeof l==typeof p&&l>p}],"filter-<=":[hr,[pr,ar],(n,[t,l])=>{const p=n.properties()[t.value],y=l.value;return typeof p==typeof y&&p<=y}],"filter-id-<=":[hr,[ar],(n,[t])=>{const l=n.id(),p=t.value;return typeof l==typeof p&&l<=p}],"filter->=":[hr,[pr,ar],(n,[t,l])=>{const p=n.properties()[t.value],y=l.value;return typeof p==typeof y&&p>=y}],"filter-id->=":[hr,[ar],(n,[t])=>{const l=n.id(),p=t.value;return typeof l==typeof p&&l>=p}],"filter-has":[hr,[ar],(n,[t])=>t.value in n.properties()],"filter-has-id":[hr,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[hr,[Li(pr)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[hr,[Li(ar)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[hr,[pr,Li(ar)],(n,[t,l])=>l.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[hr,[pr,Li(ar)],(n,[t,l])=>function(p,y,w,I){for(;w<=I;){const M=w+I>>1;if(y[M]===p)return!0;y[M]>p?I=M-1:w=M+1}return!1}(n.properties()[t.value],l.value,0,l.value.length-1)],all:{type:hr,overloads:[[[hr,hr],(n,[t,l])=>t.evaluate(n)&&l.evaluate(n)],[Ts(hr),(n,t)=>{for(const l of t)if(!l.evaluate(n))return!1;return!0}]]},any:{type:hr,overloads:[[[hr,hr],(n,[t,l])=>t.evaluate(n)||l.evaluate(n)],[Ts(hr),(n,t)=>{for(const l of t)if(l.evaluate(n))return!0;return!1}]]},"!":[hr,[hr],(n,[t])=>!t.evaluate(n)],"is-supported-script":[hr,[pr],(n,[t])=>{const l=n.globals&&n.globals.isSupportedScript;return!l||l(t.evaluate(n))}],upcase:[pr,[pr],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[pr,[pr],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[pr,Ts(ar),(n,t)=>t.map(l=>It(l.evaluate(n))).join("")],"resolved-locale":[pr,[$i],(n,[t])=>t.evaluate(n).resolvedLocale()]});class _o{constructor(t,l){this.expression=t,this._warningHistory={},this._evaluator=new dr,this._defaultValue=l?function(p){return p.type==="color"&&Yr(p.default)?new te(0,0,0,0):p.type==="color"?te.parse(p.default)||null:p.type==="padding"?ye.parse(p.default)||null:p.default===void 0?null:p.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(t,l,p,y,w,I){return this._evaluator.globals=t,this._evaluator.feature=l,this._evaluator.featureState=p,this._evaluator.canonical=y,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)}evaluate(t,l,p,y,w,I){this._evaluator.globals=t,this._evaluator.feature=l||null,this._evaluator.featureState=p||null,this._evaluator.canonical=y,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=I||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new bt(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function Ta(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Xs}function Ca(n,t){const l=new Ws(Xs,[],t?function(y){const w={color:vi,string:pr,number:Tt,enum:pr,boolean:hr,formatted:ii,padding:ls,resolvedImage:hi};return y.type==="array"?Li(w[y.value]||ar,y.length):w[y.type]}(t):void 0),p=l.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Fc(new _o(p,t)):Js(l.errors)}class Ia{constructor(t,l){this.kind=t,this._styleExpression=l,this.isStateDependent=t!=="constant"&&!Hs(l.expression)}evaluateWithoutErrorHandling(t,l,p,y,w,I){return this._styleExpression.evaluateWithoutErrorHandling(t,l,p,y,w,I)}evaluate(t,l,p,y,w,I){return this._styleExpression.evaluate(t,l,p,y,w,I)}}class ml{constructor(t,l,p,y){this.kind=t,this.zoomStops=p,this._styleExpression=l,this.isStateDependent=t!=="camera"&&!Hs(l.expression),this.interpolationType=y}evaluateWithoutErrorHandling(t,l,p,y,w,I){return this._styleExpression.evaluateWithoutErrorHandling(t,l,p,y,w,I)}evaluate(t,l,p,y,w,I){return this._styleExpression.evaluate(t,l,p,y,w,I)}interpolationFactor(t,l,p){return this.interpolationType?an.interpolationFactor(this.interpolationType,t,l,p):0}}function $c(n,t){const l=Ca(n,t);if(l.result==="error")return l;const p=l.value.expression,y=ba(p);if(!y&&!ei(t))return Js([new _i("","data expressions not supported")]);const w=ao(p,["zoom"]);if(!w&&!Uc(t))return Js([new _i("","zoom expressions not supported")]);const I=vo(p);return I||w?I instanceof _i?Js([I]):I instanceof an&&!Ir(t)?Js([new _i("",'"interpolate" expressions cannot be used with this property')]):Fc(I?new ml(y?"camera":"composite",l.value,I.labels,I instanceof an?I.interpolation:void 0):new Ia(y?"constant":"source",l.value)):Js([new _i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class yo{constructor(t,l){this._parameters=t,this._specification=l,ri(this,Ea(this._parameters,this._specification))}static deserialize(t){return new yo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function vo(n){let t=null;if(n instanceof ho)t=vo(n.result);else if(n instanceof uo){for(const l of n.args)if(t=vo(l),t)break}else(n instanceof xa||n instanceof an)&&n.input instanceof Er&&n.input.name==="zoom"&&(t=n);return t instanceof _i||n.eachChild(l=>{const p=vo(l);p instanceof _i?t=p:!t&&p?t=new _i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&p&&t!==p&&(t=new _i("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function kn(n){const t=n.key,l=n.value,p=n.valueSpec||{},y=n.objectElementValidators||{},w=n.style,I=n.styleSpec;let M=[];const R=Nr(l);if(R!=="object")return[new _t(t,l,`object expected, ${R} found`)];for(const N in l){const Z=N.split(".")[0],X=p[Z]||p["*"];let ee;if(y[Z])ee=y[Z];else if(p[Z])ee=ln;else if(y["*"])ee=y["*"];else{if(!p["*"]){M.push(new _t(t,l[N],`unknown property "${N}"`));continue}ee=ln}M=M.concat(ee({key:(t&&`${t}.`)+N,value:l[N],valueSpec:X,style:w,styleSpec:I,object:l,objectKey:N},l))}for(const N in p)y[N]||p[N].required&&p[N].default===void 0&&l[N]===void 0&&M.push(new _t(t,l,`missing required property "${N}"`));return M}function jc(n){const t=n.value,l=n.valueSpec,p=n.style,y=n.styleSpec,w=n.key,I=n.arrayElementValidator||ln;if(Nr(t)!=="array")return[new _t(w,t,`array expected, ${Nr(t)} found`)];if(l.length&&t.length!==l.length)return[new _t(w,t,`array length ${l.length} expected, length ${t.length} found`)];if(l["min-length"]&&t.length<l["min-length"])return[new _t(w,t,`array length at least ${l["min-length"]} expected, length ${t.length} found`)];let M={type:l.value,values:l.values};y.$version<7&&(M.function=l.function),Nr(l.value)==="object"&&(M=l.value);let R=[];for(let N=0;N<t.length;N++)R=R.concat(I({array:t,arrayIndex:N,value:t[N],valueSpec:M,style:p,styleSpec:y,key:`${w}[${N}]`}));return R}function gl(n){const t=n.key,l=n.value,p=n.valueSpec;let y=Nr(l);return y==="number"&&l!=l&&(y="NaN"),y!=="number"?[new _t(t,l,`number expected, ${y} found`)]:"minimum"in p&&l<p.minimum?[new _t(t,l,`${l} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&l>p.maximum?[new _t(t,l,`${l} is greater than the maximum value ${p.maximum}`)]:[]}function qc(n){const t=n.valueSpec,l=yr(n.value.type);let p,y,w,I={};const M=l!=="categorical"&&n.value.property===void 0,R=!M,N=Nr(n.value.stops)==="array"&&Nr(n.value.stops[0])==="array"&&Nr(n.value.stops[0][0])==="object",Z=kn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(se){if(l==="identity")return[new _t(se.key,se.value,'identity function may not have a "stops" property')];let ae=[];const ke=se.value;return ae=ae.concat(jc({key:se.key,value:ke,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:X})),Nr(ke)==="array"&&ke.length===0&&ae.push(new _t(se.key,ke,"array must have at least one stop")),ae},default:function(se){return ln({key:se.key,value:se.value,valueSpec:t,style:se.style,styleSpec:se.styleSpec})}}});return l==="identity"&&M&&Z.push(new _t(n.key,n.value,'missing required property "property"')),l==="identity"||n.value.stops||Z.push(new _t(n.key,n.value,'missing required property "stops"')),l==="exponential"&&n.valueSpec.expression&&!Ir(n.valueSpec)&&Z.push(new _t(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(R&&!ei(n.valueSpec)?Z.push(new _t(n.key,n.value,"property functions not supported")):M&&!Uc(n.valueSpec)&&Z.push(new _t(n.key,n.value,"zoom functions not supported"))),l!=="categorical"&&!N||n.value.property!==void 0||Z.push(new _t(n.key,n.value,'"property" property is required')),Z;function X(se){let ae=[];const ke=se.value,we=se.key;if(Nr(ke)!=="array")return[new _t(we,ke,`array expected, ${Nr(ke)} found`)];if(ke.length!==2)return[new _t(we,ke,`array length 2 expected, length ${ke.length} found`)];if(N){if(Nr(ke[0])!=="object")return[new _t(we,ke,`object expected, ${Nr(ke[0])} found`)];if(ke[0].zoom===void 0)return[new _t(we,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new _t(we,ke,"object stop key must have value")];if(w&&w>yr(ke[0].zoom))return[new _t(we,ke[0].zoom,"stop zoom values must appear in ascending order")];yr(ke[0].zoom)!==w&&(w=yr(ke[0].zoom),y=void 0,I={}),ae=ae.concat(kn({key:`${we}[0]`,value:ke[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:gl,value:ee}}))}else ae=ae.concat(ee({key:`${we}[0]`,value:ke[0],valueSpec:{},style:se.style,styleSpec:se.styleSpec},ke));return Ta(kr(ke[1]))?ae.concat([new _t(`${we}[1]`,ke[1],"expressions are not allowed in function stops.")]):ae.concat(ln({key:`${we}[1]`,value:ke[1],valueSpec:t,style:se.style,styleSpec:se.styleSpec}))}function ee(se,ae){const ke=Nr(se.value),we=yr(se.value),Be=se.value!==null?se.value:ae;if(p){if(ke!==p)return[new _t(se.key,Be,`${ke} stop domain type must match previous stop domain type ${p}`)]}else p=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new _t(se.key,Be,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&l!=="categorical"){let Ye=`number expected, ${ke} found`;return ei(t)&&l===void 0&&(Ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(se.key,Be,Ye)]}return l!=="categorical"||ke!=="number"||isFinite(we)&&Math.floor(we)===we?l!=="categorical"&&ke==="number"&&y!==void 0&&we<y?[new _t(se.key,Be,"stop domain values must appear in ascending order")]:(y=we,l==="categorical"&&we in I?[new _t(se.key,Be,"stop domain values must be unique")]:(I[we]=!0,[])):[new _t(se.key,Be,`integer expected, found ${we}`)]}}function Cs(n){const t=(n.expressionContext==="property"?$c:Ca)(kr(n.value),n.valueSpec);if(t.result==="error")return t.value.map(p=>new _t(`${n.key}${p.key}`,n.value,p.message));const l=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!l.outputDefined())return[new _t(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Hs(l))return[new _t(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Hs(l))return[new _t(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!ao(l,["zoom","feature-state"]))return[new _t(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ba(l))return[new _t(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Aa(n){const t=n.key,l=n.value,p=n.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(yr(l))===-1&&y.push(new _t(t,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(yr(l))===-1&&y.push(new _t(t,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),y}function Qs(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Qs(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Mh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function bo(n){if(n==null)return{filter:()=>!0,needGeometry:!1};Qs(n)||(n=Pa(n));const t=Ca(n,Mh);if(t.result==="error")throw new Error(t.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,p,y)=>t.value.evaluate(l,p,{},y),needGeometry:Zc(n)}}function Gc(n,t){return n<t?-1:n>t?1:0}function Zc(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let t=1;t<n.length;t++)if(Zc(n[t]))return!0;return!1}function Pa(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?_l(n[1],n[2],"=="):t==="!="?ea(_l(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?_l(n[1],n[2],t):t==="any"?(l=n.slice(1),["any"].concat(l.map(Pa))):t==="all"?["all"].concat(n.slice(1).map(Pa)):t==="none"?["all"].concat(n.slice(1).map(Pa).map(ea)):t==="in"?xo(n[1],n.slice(2)):t==="!in"?ea(xo(n[1],n.slice(2))):t==="has"?Ma(n[1]):t==="!has"?ea(Ma(n[1])):t!=="within"||n;var l}function _l(n,t,l){switch(n){case"$type":return[`filter-type-${l}`,t];case"$id":return[`filter-id-${l}`,t];default:return[`filter-${l}`,n,t]}}function xo(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(l=>typeof l!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Gc)]]:["filter-in-small",n,["literal",t]]}}function Ma(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ea(n){return["!",n]}function za(n){return Qs(kr(n.value))?Cs(ri({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Hc(n)}function Hc(n){const t=n.value,l=n.key;if(Nr(t)!=="array")return[new _t(l,t,`array expected, ${Nr(t)} found`)];const p=n.styleSpec;let y,w=[];if(t.length<1)return[new _t(l,t,"filter array must have at least 1 element")];switch(w=w.concat(Aa({key:`${l}[0]`,value:t[0],valueSpec:p.filter_operator,style:n.style,styleSpec:n.styleSpec})),yr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&yr(t[1])==="$type"&&w.push(new _t(l,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&w.push(new _t(l,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(y=Nr(t[1]),y!=="string"&&w.push(new _t(`${l}[1]`,t[1],`string expected, ${y} found`)));for(let I=2;I<t.length;I++)y=Nr(t[I]),yr(t[1])==="$type"?w=w.concat(Aa({key:`${l}[${I}]`,value:t[I],valueSpec:p.geometry_type,style:n.style,styleSpec:n.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&w.push(new _t(`${l}[${I}]`,t[I],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let I=1;I<t.length;I++)w=w.concat(Hc({key:`${l}[${I}]`,value:t[I],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":y=Nr(t[1]),t.length!==2?w.push(new _t(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):y!=="string"&&w.push(new _t(`${l}[1]`,t[1],`string expected, ${y} found`));break;case"within":y=Nr(t[1]),t.length!==2?w.push(new _t(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):y!=="object"&&w.push(new _t(`${l}[1]`,t[1],`object expected, ${y} found`))}return w}function Da(n,t){const l=n.key,p=n.style,y=n.styleSpec,w=n.value,I=n.objectKey,M=y[`${t}_${n.layerType}`];if(!M)return[];const R=I.match(/^(.*)-transition$/);if(t==="paint"&&R&&M[R[1]]&&M[R[1]].transition)return ln({key:l,value:w,valueSpec:y.transition,style:p,styleSpec:y});const N=n.valueSpec||M[I];if(!N)return[new _t(l,w,`unknown property "${I}"`)];let Z;if(Nr(w)==="string"&&ei(N)&&!N.tokens&&(Z=/^{([^}]+)}$/.exec(w)))return[new _t(l,w,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Z[1])} }\`.`)];const X=[];return n.layerType==="symbol"&&(I==="text-field"&&p&&!p.glyphs&&X.push(new _t(l,w,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Yr(kr(w))&&yr(w.type)==="identity"&&X.push(new _t(l,w,'"text-font" does not support identity functions'))),X.concat(ln({key:n.key,value:w,valueSpec:N,style:p,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:I}))}function Wc(n){return Da(n,"paint")}function Kc(n){return Da(n,"layout")}function Xc(n){let t=[];const l=n.value,p=n.key,y=n.style,w=n.styleSpec;l.type||l.ref||t.push(new _t(p,l,'either "type" or "ref" is required'));let I=yr(l.type);const M=yr(l.ref);if(l.id){const R=yr(l.id);for(let N=0;N<n.arrayIndex;N++){const Z=y.layers[N];yr(Z.id)===R&&t.push(new _t(p,l.id,`duplicate layer id "${l.id}", previously used at line ${Z.id.__line__}`))}}if("ref"in l){let R;["type","source","source-layer","filter","layout"].forEach(N=>{N in l&&t.push(new _t(p,l[N],`"${N}" is prohibited for ref layers`))}),y.layers.forEach(N=>{yr(N.id)===M&&(R=N)}),R?R.ref?t.push(new _t(p,l.ref,"ref cannot reference another ref layer")):I=yr(R.type):t.push(new _t(p,l.ref,`ref layer "${M}" not found`))}else if(I!=="background")if(l.source){const R=y.sources&&y.sources[l.source],N=R&&yr(R.type);R?N==="vector"&&I==="raster"?t.push(new _t(p,l.source,`layer "${l.id}" requires a raster source`)):N==="raster"&&I!=="raster"?t.push(new _t(p,l.source,`layer "${l.id}" requires a vector source`)):N!=="vector"||l["source-layer"]?N==="raster-dem"&&I!=="hillshade"?t.push(new _t(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!l.paint||!l.paint["line-gradient"]||N==="geojson"&&R.lineMetrics||t.push(new _t(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new _t(p,l,`layer "${l.id}" must specify a "source-layer"`)):t.push(new _t(p,l.source,`source "${l.source}" not found`))}else t.push(new _t(p,l,'missing required property "source"'));return t=t.concat(kn({key:p,value:l,valueSpec:w.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ln({key:`${p}.type`,value:l.type,valueSpec:w.layer.type,style:n.style,styleSpec:n.styleSpec,object:l,objectKey:"type"}),filter:za,layout:R=>kn({layer:l,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":N=>Kc(ri({layerType:I},N))}}),paint:R=>kn({layer:l,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":N=>Wc(ri({layerType:I},N))}})}})),t}function ta(n){const t=n.value,l=n.key,p=Nr(t);return p!=="string"?[new _t(l,t,`string expected, ${p} found`)]:[]}const Jc={promoteId:function({key:n,value:t}){if(Nr(t)==="string")return ta({key:n,value:t});{const l=[];for(const p in t)l.push(...ta({key:`${n}.${p}`,value:t[p]}));return l}}};function La(n){const t=n.value,l=n.key,p=n.styleSpec,y=n.style;if(!t.type)return[new _t(l,t,'"type" is required')];const w=yr(t.type);let I;switch(w){case"vector":case"raster":case"raster-dem":return I=kn({key:l,value:t,valueSpec:p[`source_${w.replace("-","_")}`],style:n.style,styleSpec:p,objectElementValidators:Jc}),I;case"geojson":if(I=kn({key:l,value:t,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Jc}),t.cluster)for(const M in t.clusterProperties){const[R,N]=t.clusterProperties[M],Z=typeof R=="string"?[R,["accumulated"],["get",M]]:R;I.push(...Cs({key:`${l}.${M}.map`,value:N,expressionContext:"cluster-map"})),I.push(...Cs({key:`${l}.${M}.reduce`,value:Z,expressionContext:"cluster-reduce"}))}return I;case"video":return kn({key:l,value:t,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return kn({key:l,value:t,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new _t(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Aa({key:`${l}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function Ra(n){const t=n.value,l=n.styleSpec,p=l.light,y=n.style;let w=[];const I=Nr(t);if(t===void 0)return w;if(I!=="object")return w=w.concat([new _t("light",t,`object expected, ${I} found`)]),w;for(const M in t){const R=M.match(/^(.*)-transition$/);w=w.concat(R&&p[R[1]]&&p[R[1]].transition?ln({key:M,value:t[M],valueSpec:l.transition,style:y,styleSpec:l}):p[M]?ln({key:M,value:t[M],valueSpec:p[M],style:y,styleSpec:l}):[new _t(M,t[M],`unknown property "${M}"`)])}return w}function on(n){const t=n.value,l=n.styleSpec,p=l.terrain,y=n.style;let w=[];const I=Nr(t);if(t===void 0)return w;if(I!=="object")return w=w.concat([new _t("terrain",t,`object expected, ${I} found`)]),w;for(const M in t)w=w.concat(p[M]?ln({key:M,value:t[M],valueSpec:p[M],style:y,styleSpec:l}):[new _t(M,t[M],`unknown property "${M}"`)]);return w}const Oa={"*":()=>[],array:jc,boolean:function(n){const t=n.value,l=n.key,p=Nr(t);return p!=="boolean"?[new _t(l,t,`boolean expected, ${p} found`)]:[]},number:gl,color:function(n){const t=n.key,l=n.value,p=Nr(l);return p!=="string"?[new _t(t,l,`color expected, ${p} found`)]:Gn(l)===null?[new _t(t,l,`color expected, "${l}" found`)]:[]},constants:gi,enum:Aa,filter:za,function:qc,layer:Xc,object:kn,source:La,light:Ra,terrain:on,string:ta,formatted:function(n){return ta(n).length===0?[]:Cs(n)},resolvedImage:function(n){return ta(n).length===0?[]:Cs(n)},padding:function(n){const t=n.key,l=n.value;if(Nr(l)==="array"){if(l.length<1||l.length>4)return[new _t(t,l,`padding requires 1 to 4 values; ${l.length} values found`)];const p={type:"number"};let y=[];for(let w=0;w<l.length;w++)y=y.concat(ln({key:`${t}[${w}]`,value:l[w],valueSpec:p}));return y}return gl({key:t,value:l,valueSpec:{}})}};function ln(n){const t=n.value,l=n.valueSpec,p=n.styleSpec;return l.expression&&Yr(yr(t))?qc(n):l.expression&&Ta(kr(t))?Cs(n):l.type&&Oa[l.type]?Oa[l.type](n):kn(ri({},n,{valueSpec:l.type?p[l.type]:l}))}function zh(n){const t=n.value,l=n.key,p=ta(n);return p.length||(t.indexOf("{fontstack}")===-1&&p.push(new _t(l,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&p.push(new _t(l,t,'"glyphs" url must include a "{range}" token'))),p}function fs(n,t=Fe){let l=[];return l=l.concat(ln({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,objectElementValidators:{glyphs:zh,"*":()=>[]}})),n.constants&&(l=l.concat(gi({key:"constants",value:n.constants,style:n,styleSpec:t}))),Yc(l)}function Yc(n){return[].concat(n).sort((t,l)=>t.line-l.line)}function Wn(n){return function(...t){return Yc(n.apply(this,t))}}fs.source=Wn(La),fs.light=Wn(Ra),fs.terrain=Wn(on),fs.layer=Wn(Xc),fs.filter=Wn(za),fs.paintProperty=Wn(Wc),fs.layoutProperty=Wn(Kc);const Ba=fs,yl=Ba.light,Dh=Ba.paintProperty,Lh=Ba.layoutProperty;function wo(n,t){let l=!1;if(t&&t.length)for(const p of t)n.fire(new Ht(new Error(p.message))),l=!0;return l}class Na{constructor(t,l,p){const y=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const I=new Int32Array(this.arrayBuffer);t=I[0],this.d=(l=I[1])+2*(p=I[2]);for(let R=0;R<this.d*this.d;R++){const N=I[3+R],Z=I[3+R+1];y.push(N===Z?null:I.subarray(N,Z))}const M=I[3+y.length+1];this.keys=I.subarray(I[3+y.length],M),this.bboxes=I.subarray(M),this.insert=this._insertReadonly}else{this.d=l+2*p;for(let I=0;I<this.d*this.d;I++)y.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=t,this.padding=p,this.scale=l/t,this.uid=0;const w=p/l*t;this.min=-w,this.max=t+w}insert(t,l,p,y,w){this._forEachCell(l,p,y,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,l,p,y,w,I){this.cells[w].push(I)}query(t,l,p,y,w){const I=this.min,M=this.max;if(t<=I&&l<=I&&M<=p&&M<=y&&!w)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(t,l,p,y,this._queryCell,R,{},w),R}}_queryCell(t,l,p,y,w,I,M,R){const N=this.cells[w];if(N!==null){const Z=this.keys,X=this.bboxes;for(let ee=0;ee<N.length;ee++){const se=N[ee];if(M[se]===void 0){const ae=4*se;(R?R(X[ae+0],X[ae+1],X[ae+2],X[ae+3]):t<=X[ae+2]&&l<=X[ae+3]&&p>=X[ae+0]&&y>=X[ae+1])?(M[se]=!0,I.push(Z[se])):M[se]=!1}}}}_forEachCell(t,l,p,y,w,I,M,R){const N=this._convertToCellCoord(t),Z=this._convertToCellCoord(l),X=this._convertToCellCoord(p),ee=this._convertToCellCoord(y);for(let se=N;se<=X;se++)for(let ae=Z;ae<=ee;ae++){const ke=this.d*ae+se;if((!R||R(this._convertFromCellCoord(se),this._convertFromCellCoord(ae),this._convertFromCellCoord(se+1),this._convertFromCellCoord(ae+1)))&&w.call(this,t,l,p,y,ke,I,M,R))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,l=3+this.cells.length+1+1;let p=0;for(let I=0;I<this.cells.length;I++)p+=this.cells[I].length;const y=new Int32Array(l+p+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let w=l;for(let I=0;I<t.length;I++){const M=t[I];y[3+I]=w,y.set(M,w),w+=M.length}return y[3+t.length]=w,y.set(this.keys,w),w+=this.keys.length,y[3+t.length+1]=w,y.set(this.bboxes,w),w+=this.bboxes.length,y.buffer}static serialize(t,l){const p=t.toArrayBuffer();return l&&l.push(p),{buffer:p}}static deserialize(t){return new Na(t.buffer)}}const Kn={};function qt(n,t,l={}){if(Kn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),Kn[n]={klass:t,omit:l.omit||[],shallow:l.shallow||[]}}qt("Object",Object),qt("TransferableGridIndex",Na),qt("Color",te),qt("Error",Error),qt("AJAXError",Fr),qt("ResolvedImage",Ce),qt("StylePropertyFunction",yo),qt("StyleExpression",_o,{omit:["_evaluator"]}),qt("ZoomDependentExpression",ml),qt("ZoomConstantExpression",Ia),qt("CompoundExpression",Er,{omit:["_evaluate"]});for(const n in Xs)Xs[n]._classRegistryKey||qt(`Expression_${n}`,Xs[n]);function Qc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Is(n,t){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob)return n;if(Qc(n)||Y(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const l=n;return t&&t.push(l.buffer),l}if(n instanceof ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const l=[];for(const p of n)l.push(Is(p,t));return l}if(typeof n=="object"){const l=n.constructor,p=l._classRegistryKey;if(!p)throw new Error("can't serialize object of unregistered class");if(!Kn[p])throw new Error(`${p} is not registered.`);const y=l.serialize?l.serialize(n,t):{};if(l.serialize){if(t&&y===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in n){if(!n.hasOwnProperty(w)||Kn[p].omit.indexOf(w)>=0)continue;const I=n[w];y[w]=Kn[p].shallow.indexOf(w)>=0?I:Is(I,t)}n instanceof Error&&(y.message=n.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(y.$name=p),y}throw new Error("can't serialize object of type "+typeof n)}function ds(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||Qc(n)||Y(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(ds);if(typeof n=="object"){const t=n.$name||"Object";if(!Kn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:l}=Kn[t];if(!l)throw new Error(`can't deserialize unregistered class ${t}`);if(l.deserialize)return l.deserialize(n);const p=Object.create(l.prototype);for(const y of Object.keys(n)){if(y==="$name")continue;const w=n[y];p[y]=Kn[t].shallow.indexOf(y)>=0?w:ds(w)}return p}throw new Error("can't deserialize object of type "+typeof n)}class vl{constructor(){this.first=!0}update(t,l){const p=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=l),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=p,!0))}}const Nt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function So(n){for(const t of n)if(xl(t.charCodeAt(0)))return!0;return!1}function Rh(n){for(const t of n)if(!bl(t.charCodeAt(0)))return!1;return!0}function bl(n){return!(Nt.Arabic(n)||Nt["Arabic Supplement"](n)||Nt["Arabic Extended-A"](n)||Nt["Arabic Presentation Forms-A"](n)||Nt["Arabic Presentation Forms-B"](n))}function xl(n){return!(n!==746&&n!==747&&(n<4352||!(Nt["Bopomofo Extended"](n)||Nt.Bopomofo(n)||Nt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Nt["CJK Compatibility Ideographs"](n)||Nt["CJK Compatibility"](n)||Nt["CJK Radicals Supplement"](n)||Nt["CJK Strokes"](n)||!(!Nt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Nt["CJK Unified Ideographs Extension A"](n)||Nt["CJK Unified Ideographs"](n)||Nt["Enclosed CJK Letters and Months"](n)||Nt["Hangul Compatibility Jamo"](n)||Nt["Hangul Jamo Extended-A"](n)||Nt["Hangul Jamo Extended-B"](n)||Nt["Hangul Jamo"](n)||Nt["Hangul Syllables"](n)||Nt.Hiragana(n)||Nt["Ideographic Description Characters"](n)||Nt.Kanbun(n)||Nt["Kangxi Radicals"](n)||Nt["Katakana Phonetic Extensions"](n)||Nt.Katakana(n)&&n!==12540||!(!Nt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Nt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Nt["Unified Canadian Aboriginal Syllabics"](n)||Nt["Unified Canadian Aboriginal Syllabics Extended"](n)||Nt["Vertical Forms"](n)||Nt["Yijing Hexagram Symbols"](n)||Nt["Yi Syllables"](n)||Nt["Yi Radicals"](n))))}function eu(n){return!(xl(n)||function(t){return!!(Nt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Nt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Nt["Letterlike Symbols"](t)||Nt["Number Forms"](t)||Nt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Nt["Control Pictures"](t)&&t!==9251||Nt["Optical Character Recognition"](t)||Nt["Enclosed Alphanumerics"](t)||Nt["Geometric Shapes"](t)||Nt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Nt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Nt["CJK Symbols and Punctuation"](t)||Nt.Katakana(t)||Nt["Private Use Area"](t)||Nt["CJK Compatibility Forms"](t)||Nt["Small Form Variants"](t)||Nt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}function tu(n){return n>=1424&&n<=2303||Nt["Arabic Presentation Forms-A"](n)||Nt["Arabic Presentation Forms-B"](n)}function Oh(n,t){return!(!t&&tu(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Nt.Khmer(n))}function ru(n){for(const t of n)if(tu(t.charCodeAt(0)))return!0;return!1}const wl="deferred",Sl="loading",kl="loaded";let El=null,Yi="unavailable",ps=null;const iu=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Yi="error"),El&&El(n)};function ra(){Tl.fire(new Et("pluginStateChange",{pluginStatus:Yi,pluginURL:ps}))}const Tl=new wr,Fa=function(){return Yi},nu=function(){if(Yi!==wl||!ps)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yi=Sl,ra(),ps&&be({url:ps},n=>{n?iu(n):(Yi=kl,ra())})},yn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yi===kl||yn.applyArabicShaping!=null,isLoading:()=>Yi===Sl,setState(n){if(!oe())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Yi=n.pluginStatus,ps=n.pluginURL},isParsed(){if(!oe())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return yn.applyArabicShaping!=null&&yn.processBidirectionalText!=null&&yn.processStyledBidirectionalText!=null},getPluginURL(){if(!oe())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ps}};class ai{constructor(t,l){this.zoom=t,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vl,this.transition={})}isSupportedScript(t){return function(l,p){for(const y of l)if(!Oh(y.charCodeAt(0),p))return!1;return!0}(t,yn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,l=t-Math.floor(t),p=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*l}}}class Ua{constructor(t,l){this.property=t,this.value=l,this.expression=function(p,y){if(Yr(p))return new yo(p,y);if(Ta(p)){const w=$c(p,y);if(w.result==="error")throw new Error(w.value.map(I=>`${I.key}: ${I.message}`).join(", "));return w.value}{let w=p;return y.type==="color"&&typeof p=="string"?w=te.parse(p):y.type!=="padding"||typeof p!="number"&&!Array.isArray(p)||(w=ye.parse(p)),{kind:"constant",evaluate:()=>w}}}(l===void 0?t.specification.default:l,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,l,p){return this.property.possiblyEvaluate(this,t,l,p)}}class ko{constructor(t){this.property=t,this.value=new Ua(t,void 0)}transitioned(t,l){return new au(this.property,this.value,l,E({},t.transition,this.transition),t.now)}untransitioned(){return new au(this.property,this.value,null,{},0)}}class su{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return F(this._values[t].value.value)}setValue(t,l){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ko(this._values[t].property)),this._values[t].value=new Ua(this._values[t].property,l===null?void 0:F(l))}getTransition(t){return F(this._values[t].transition)}setTransition(t,l){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ko(this._values[t].property)),this._values[t].transition=F(l)||void 0}serialize(){const t={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(t[l]=p);const y=this.getTransition(l);y!==void 0&&(t[`${l}-transition`]=y)}return t}transitioned(t,l){const p=new ou(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].transitioned(t,l._values[y]);return p}untransitioned(){const t=new ou(this._properties);for(const l of Object.keys(this._values))t._values[l]=this._values[l].untransitioned();return t}}class au{constructor(t,l,p,y,w){this.property=t,this.value=l,this.begin=w+y.delay||0,this.end=this.begin+y.duration||0,t.specification.transition&&(y.delay||y.duration)&&(this.prior=p)}possiblyEvaluate(t,l,p){const y=t.now||0,w=this.value.possiblyEvaluate(t,l,p),I=this.prior;if(I){if(y>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(y<this.begin)return I.possiblyEvaluate(t,l,p);{const M=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(t,l,p),w,function(R){if(R<=0)return 0;if(R>=1)return 1;const N=R*R,Z=N*R;return 4*(R<.5?Z:3*(R-N)+Z-.75)}(M))}}return w}}class ou{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,l,p){const y=new Va(this._properties);for(const w of Object.keys(this._values))y._values[w]=this._values[w].possiblyEvaluate(t,l,p);return y}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Bh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return F(this._values[t].value)}setValue(t,l){this._values[t]=new Ua(this._values[t].property,l===null?void 0:F(l))}serialize(){const t={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(t[l]=p)}return t}possiblyEvaluate(t,l,p){const y=new Va(this._properties);for(const w of Object.keys(this._values))y._values[w]=this._values[w].possiblyEvaluate(t,l,p);return y}}class Dn{constructor(t,l,p){this.property=t,this.value=l,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,l,p,y){return this.property.evaluate(this.value,this.parameters,t,l,p,y)}}class Va{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Wt{constructor(t){this.specification=t}possiblyEvaluate(t,l){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(l)}interpolate(t,l,p){const y=wa[this.specification.type];return y?y(t,l,p):t}}class lr{constructor(t,l){this.specification=t,this.overrides=l}possiblyEvaluate(t,l,p,y){return new Dn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(l,null,{},p,y)}:t.expression,l)}interpolate(t,l,p){if(t.value.kind!=="constant"||l.value.kind!=="constant")return t;if(t.value.value===void 0||l.value.value===void 0)return new Dn(this,{kind:"constant",value:void 0},t.parameters);const y=wa[this.specification.type];return y?new Dn(this,{kind:"constant",value:y(t.value.value,l.value.value,p)},t.parameters):t}evaluate(t,l,p,y,w,I){return t.kind==="constant"?t.value:t.evaluate(l,p,y,w,I)}}class ia extends lr{possiblyEvaluate(t,l,p,y){if(t.value===void 0)return new Dn(this,{kind:"constant",value:void 0},l);if(t.expression.kind==="constant"){const w=t.expression.evaluate(l,null,{},p,y),I=t.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,M=this._calculate(I,I,I,l);return new Dn(this,{kind:"constant",value:M},l)}if(t.expression.kind==="camera"){const w=this._calculate(t.expression.evaluate({zoom:l.zoom-1}),t.expression.evaluate({zoom:l.zoom}),t.expression.evaluate({zoom:l.zoom+1}),l);return new Dn(this,{kind:"constant",value:w},l)}return new Dn(this,t.expression,l)}evaluate(t,l,p,y,w,I){if(t.kind==="source"){const M=t.evaluate(l,p,y,w,I);return this._calculate(M,M,M,l)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(l.zoom)-1},p,y),t.evaluate({zoom:Math.floor(l.zoom)},p,y),t.evaluate({zoom:Math.floor(l.zoom)+1},p,y),l):t.value}_calculate(t,l,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:t,to:l}:{from:p,to:l}}interpolate(t){return t}}class Cl{constructor(t){this.specification=t}possiblyEvaluate(t,l,p,y){if(t.value!==void 0){if(t.expression.kind==="constant"){const w=t.expression.evaluate(l,null,{},p,y);return this._calculate(w,w,w,l)}return this._calculate(t.expression.evaluate(new ai(Math.floor(l.zoom-1),l)),t.expression.evaluate(new ai(Math.floor(l.zoom),l)),t.expression.evaluate(new ai(Math.floor(l.zoom+1),l)),l)}}_calculate(t,l,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:t,to:l}:{from:p,to:l}}interpolate(t){return t}}class ms{constructor(t){this.specification=t}possiblyEvaluate(t,l,p,y){return!!t.expression.evaluate(l,null,{},p,y)}interpolate(){return!1}}class Ri{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in t){const p=t[l];p.specification.overridable&&this.overridableProperties.push(l);const y=this.defaultPropertyValues[l]=new Ua(p,void 0),w=this.defaultTransitionablePropertyValues[l]=new ko(p);this.defaultTransitioningPropertyValues[l]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=y.possiblyEvaluate({})}}}qt("DataDrivenProperty",lr),qt("DataConstantProperty",Wt),qt("CrossFadedDataDrivenProperty",ia),qt("CrossFadedProperty",Cl),qt("ColorRampProperty",ms);const gs="-transition";class Ln extends wr{constructor(t,l){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),l.layout&&(this._unevaluatedLayout=new Bh(l.layout)),l.paint)){this._transitionablePaint=new su(l.paint);for(const p in t.paint)this.setPaintProperty(p,t.paint[p],{validate:!1});for(const p in t.layout)this.setLayoutProperty(p,t.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Va(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,l,p={}){l!=null&&this._validate(Lh,`layers.${this.id}.layout.${t}`,t,l,p)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,l):this.visibility=l)}getPaintProperty(t){return t.endsWith(gs)?this._transitionablePaint.getTransition(t.slice(0,-gs.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,l,p={}){if(l!=null&&this._validate(Dh,`layers.${this.id}.paint.${t}`,t,l,p))return!1;if(t.endsWith(gs))return this._transitionablePaint.setTransition(t.slice(0,-gs.length),l||void 0),!1;{const y=this._transitionablePaint._values[t],w=y.property.specification["property-type"]==="cross-faded-data-driven",I=y.value.isDataDriven(),M=y.value;this._transitionablePaint.setValue(t,l),this._handleSpecialPaintPropertyUpdate(t);const R=this._transitionablePaint._values[t].value;return R.isDataDriven()||I||w||this._handleOverridablePaintPropertyUpdate(t,M,R)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,l,p){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,l){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,l)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),D(t,(l,p)=>!(l===void 0||p==="layout"&&!Object.keys(l).length||p==="paint"&&!Object.keys(l).length))}_validate(t,l,p,y,w={}){return(!w||w.validate!==!1)&&wo(this,t.call(Ba,{key:l,layerType:this.type,objectKey:p,value:y,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const l=this.paint.get(t);if(l instanceof Dn&&ei(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const lu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _s{constructor(t,l){this._structArray=t,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,l){return t._trim(),l&&(t.isTransferred=!0,l.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const l=Object.create(this.prototype);return l.arrayBuffer=t.arrayBuffer,l.length=t.length,l.capacity=t.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function xi(n,t=1){let l=0,p=0;return{members:n.map(y=>{const w=lu[y.type].BYTES_PER_ELEMENT,I=l=Il(l,Math.max(t,w)),M=y.components||1;return p=Math.max(p,w),l+=w*M,{name:y.name,type:y.type,components:M,offset:I}}),size:Il(l,Math.max(p,t)),alignment:t}}function Il(n,t){return Math.ceil(n/t)*t}class As extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,l)}emplace(t,l,p){const y=2*t;return this.int16[y+0]=l,this.int16[y+1]=p,t}}As.prototype.bytesPerElement=4,qt("StructArrayLayout2i4",As);class _ extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,p,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,l,p,y)}emplace(t,l,p,y,w){const I=4*t;return this.int16[I+0]=l,this.int16[I+1]=p,this.int16[I+2]=y,this.int16[I+3]=w,t}}_.prototype.bytesPerElement=8,qt("StructArrayLayout4i8",_);class r extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w,I){const M=this.length;return this.resize(M+1),this.emplace(M,t,l,p,y,w,I)}emplace(t,l,p,y,w,I,M){const R=6*t;return this.int16[R+0]=l,this.int16[R+1]=p,this.int16[R+2]=y,this.int16[R+3]=w,this.int16[R+4]=I,this.int16[R+5]=M,t}}r.prototype.bytesPerElement=12,qt("StructArrayLayout2i4i12",r);class u extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w,I){const M=this.length;return this.resize(M+1),this.emplace(M,t,l,p,y,w,I)}emplace(t,l,p,y,w,I,M){const R=4*t,N=8*t;return this.int16[R+0]=l,this.int16[R+1]=p,this.uint8[N+4]=y,this.uint8[N+5]=w,this.uint8[N+6]=I,this.uint8[N+7]=M,t}}u.prototype.bytesPerElement=8,qt("StructArrayLayout2i4ub8",u);class m extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,l)}emplace(t,l,p){const y=2*t;return this.float32[y+0]=l,this.float32[y+1]=p,t}}m.prototype.bytesPerElement=8,qt("StructArrayLayout2f8",m);class v extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w,I,M,R,N,Z){const X=this.length;return this.resize(X+1),this.emplace(X,t,l,p,y,w,I,M,R,N,Z)}emplace(t,l,p,y,w,I,M,R,N,Z,X){const ee=10*t;return this.uint16[ee+0]=l,this.uint16[ee+1]=p,this.uint16[ee+2]=y,this.uint16[ee+3]=w,this.uint16[ee+4]=I,this.uint16[ee+5]=M,this.uint16[ee+6]=R,this.uint16[ee+7]=N,this.uint16[ee+8]=Z,this.uint16[ee+9]=X,t}}v.prototype.bytesPerElement=20,qt("StructArrayLayout10ui20",v);class C extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w,I,M,R,N,Z,X,ee){const se=this.length;return this.resize(se+1),this.emplace(se,t,l,p,y,w,I,M,R,N,Z,X,ee)}emplace(t,l,p,y,w,I,M,R,N,Z,X,ee,se){const ae=12*t;return this.int16[ae+0]=l,this.int16[ae+1]=p,this.int16[ae+2]=y,this.int16[ae+3]=w,this.uint16[ae+4]=I,this.uint16[ae+5]=M,this.uint16[ae+6]=R,this.uint16[ae+7]=N,this.int16[ae+8]=Z,this.int16[ae+9]=X,this.int16[ae+10]=ee,this.int16[ae+11]=se,t}}C.prototype.bytesPerElement=24,qt("StructArrayLayout4i4ui4i24",C);class P extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,l,p)}emplace(t,l,p,y){const w=3*t;return this.float32[w+0]=l,this.float32[w+1]=p,this.float32[w+2]=y,t}}P.prototype.bytesPerElement=12,qt("StructArrayLayout3f12",P);class O extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint32[1*t+0]=l,t}}O.prototype.bytesPerElement=4,qt("StructArrayLayout1ul4",O);class B extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w,I,M,R,N){const Z=this.length;return this.resize(Z+1),this.emplace(Z,t,l,p,y,w,I,M,R,N)}emplace(t,l,p,y,w,I,M,R,N,Z){const X=10*t,ee=5*t;return this.int16[X+0]=l,this.int16[X+1]=p,this.int16[X+2]=y,this.int16[X+3]=w,this.int16[X+4]=I,this.int16[X+5]=M,this.uint32[ee+3]=R,this.uint16[X+8]=N,this.uint16[X+9]=Z,t}}B.prototype.bytesPerElement=20,qt("StructArrayLayout6i1ul2ui20",B);class j extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w,I){const M=this.length;return this.resize(M+1),this.emplace(M,t,l,p,y,w,I)}emplace(t,l,p,y,w,I,M){const R=6*t;return this.int16[R+0]=l,this.int16[R+1]=p,this.int16[R+2]=y,this.int16[R+3]=w,this.int16[R+4]=I,this.int16[R+5]=M,t}}j.prototype.bytesPerElement=12,qt("StructArrayLayout2i2i2i12",j);class W extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w){const I=this.length;return this.resize(I+1),this.emplace(I,t,l,p,y,w)}emplace(t,l,p,y,w,I){const M=4*t,R=8*t;return this.float32[M+0]=l,this.float32[M+1]=p,this.float32[M+2]=y,this.int16[R+6]=w,this.int16[R+7]=I,t}}W.prototype.bytesPerElement=16,qt("StructArrayLayout2f1f2i16",W);class Q extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,p,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,l,p,y)}emplace(t,l,p,y,w){const I=12*t,M=3*t;return this.uint8[I+0]=l,this.uint8[I+1]=p,this.float32[M+1]=y,this.float32[M+2]=w,t}}Q.prototype.bytesPerElement=12,qt("StructArrayLayout2ub2f12",Q);class ne extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,l,p)}emplace(t,l,p,y){const w=3*t;return this.uint16[w+0]=l,this.uint16[w+1]=p,this.uint16[w+2]=y,t}}ne.prototype.bytesPerElement=6,qt("StructArrayLayout3ui6",ne);class ge extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w,I,M,R,N,Z,X,ee,se,ae,ke,we,Be){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,t,l,p,y,w,I,M,R,N,Z,X,ee,se,ae,ke,we,Be)}emplace(t,l,p,y,w,I,M,R,N,Z,X,ee,se,ae,ke,we,Be,Ye){const Re=24*t,We=12*t,ht=48*t;return this.int16[Re+0]=l,this.int16[Re+1]=p,this.uint16[Re+2]=y,this.uint16[Re+3]=w,this.uint32[We+2]=I,this.uint32[We+3]=M,this.uint32[We+4]=R,this.uint16[Re+10]=N,this.uint16[Re+11]=Z,this.uint16[Re+12]=X,this.float32[We+7]=ee,this.float32[We+8]=se,this.uint8[ht+36]=ae,this.uint8[ht+37]=ke,this.uint8[ht+38]=we,this.uint32[We+10]=Be,this.int16[Re+22]=Ye,t}}ge.prototype.bytesPerElement=48,qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ge);class fe extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,p,y,w,I,M,R,N,Z,X,ee,se,ae,ke,we,Be,Ye,Re,We,ht,ut,jt,Gt,Ft,Lt,At,Ut){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,t,l,p,y,w,I,M,R,N,Z,X,ee,se,ae,ke,we,Be,Ye,Re,We,ht,ut,jt,Gt,Ft,Lt,At,Ut)}emplace(t,l,p,y,w,I,M,R,N,Z,X,ee,se,ae,ke,we,Be,Ye,Re,We,ht,ut,jt,Gt,Ft,Lt,At,Ut,Rt){const xt=34*t,rr=17*t;return this.int16[xt+0]=l,this.int16[xt+1]=p,this.int16[xt+2]=y,this.int16[xt+3]=w,this.int16[xt+4]=I,this.int16[xt+5]=M,this.int16[xt+6]=R,this.int16[xt+7]=N,this.uint16[xt+8]=Z,this.uint16[xt+9]=X,this.uint16[xt+10]=ee,this.uint16[xt+11]=se,this.uint16[xt+12]=ae,this.uint16[xt+13]=ke,this.uint16[xt+14]=we,this.uint16[xt+15]=Be,this.uint16[xt+16]=Ye,this.uint16[xt+17]=Re,this.uint16[xt+18]=We,this.uint16[xt+19]=ht,this.uint16[xt+20]=ut,this.uint16[xt+21]=jt,this.uint16[xt+22]=Gt,this.uint32[rr+12]=Ft,this.float32[rr+13]=Lt,this.float32[rr+14]=At,this.float32[rr+15]=Ut,this.float32[rr+16]=Rt,t}}fe.prototype.bytesPerElement=68,qt("StructArrayLayout8i15ui1ul4f68",fe);class pe extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.float32[1*t+0]=l,t}}pe.prototype.bytesPerElement=4,qt("StructArrayLayout1f4",pe);class Pe extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,l,p)}emplace(t,l,p,y){const w=3*t;return this.int16[w+0]=l,this.int16[w+1]=p,this.int16[w+2]=y,t}}Pe.prototype.bytesPerElement=6,qt("StructArrayLayout3i6",Pe);class De extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,l,p)}emplace(t,l,p,y){const w=4*t;return this.uint32[2*t+0]=l,this.uint16[w+2]=p,this.uint16[w+3]=y,t}}De.prototype.bytesPerElement=8,qt("StructArrayLayout1ul2ui8",De);class Ue extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,l)}emplace(t,l,p){const y=2*t;return this.uint16[y+0]=l,this.uint16[y+1]=p,t}}Ue.prototype.bytesPerElement=4,qt("StructArrayLayout2ui4",Ue);class xe extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint16[1*t+0]=l,t}}xe.prototype.bytesPerElement=2,qt("StructArrayLayout1ui2",xe);class Je extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,p,y){const w=this.length;return this.resize(w+1),this.emplace(w,t,l,p,y)}emplace(t,l,p,y,w){const I=4*t;return this.float32[I+0]=l,this.float32[I+1]=p,this.float32[I+2]=y,this.float32[I+3]=w,t}}Je.prototype.bytesPerElement=16,qt("StructArrayLayout4f16",Je);class He extends _s{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new pt(this.anchorPointX,this.anchorPointY)}}He.prototype.size=20;class st extends B{get(t){return new He(this,t)}}qt("CollisionBoxArray",st);class lt extends _s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}lt.prototype.size=48;class yt extends ge{get(t){return new lt(this,t)}}qt("PlacedSymbolArray",yt);class rt extends _s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}rt.prototype.size=68;class Vt extends fe{get(t){return new rt(this,t)}}qt("SymbolInstanceArray",Vt);class Dt extends pe{getoffsetX(t){return this.float32[1*t+0]}}qt("GlyphOffsetArray",Dt);class $t extends Pe{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}qt("SymbolLineVertexArray",$t);class gr extends _s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}gr.prototype.size=8;class br extends De{get(t){return new gr(this,t)}}qt("FeatureIndexArray",br);class tr extends As{}class qr extends As{}class Gr extends As{}class Ar extends r{}class Pr extends u{}class Hr extends m{}class Ai extends v{}class Rn extends C{}class En extends P{}class On extends O{}class ys extends j{}class vn extends Q{}class Qi extends ne{}class Xn extends Ue{}const Eo=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ei}=Eo;class Sr{constructor(t=[]){this.segments=t}prepareSegment(t,l,p,y){let w=this.segments[this.segments.length-1];return t>Sr.MAX_VERTEX_ARRAY_LENGTH&&q(`Max vertices per segment is ${Sr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!w||w.vertexLength+t>Sr.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==y)&&(w={vertexOffset:l.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},y!==void 0&&(w.sortKey=y),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const t of this.segments)for(const l in t.vaos)t.vaos[l].destroy()}static simpleSegment(t,l,p,y){return new Sr([{vertexOffset:t,primitiveOffset:l,vertexLength:p,primitiveLength:y,vaos:{},sortKey:0}])}}function Ur(n,t){return 256*(n=x(Math.floor(n),0,255))+x(Math.floor(t),0,255)}Sr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt("SegmentVector",Sr);const Pi=xi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Mi={exports:{}},oi={exports:{}};oi.exports=function(n,t){var l,p,y,w,I,M,R,N;for(p=n.length-(l=3&n.length),y=t,I=3432918353,M=461845907,N=0;N<p;)R=255&n.charCodeAt(N)|(255&n.charCodeAt(++N))<<8|(255&n.charCodeAt(++N))<<16|(255&n.charCodeAt(++N))<<24,++N,y=27492+(65535&(w=5*(65535&(y=(y^=R=(65535&(R=(R=(65535&R)*I+(((R>>>16)*I&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(R=0,l){case 3:R^=(255&n.charCodeAt(N+2))<<16;case 2:R^=(255&n.charCodeAt(N+1))<<8;case 1:y^=R=(65535&(R=(R=(65535&(R^=255&n.charCodeAt(N)))*I+(((R>>>16)*I&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295}return y^=n.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0};var bn={exports:{}};bn.exports=function(n,t){for(var l,p=n.length,y=t^p,w=0;p>=4;)l=1540483477*(65535&(l=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(l>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),p-=4,++w;switch(p){case 3:y^=(255&n.charCodeAt(w+2))<<16;case 2:y^=(255&n.charCodeAt(w+1))<<8;case 1:y=1540483477*(65535&(y^=255&n.charCodeAt(w)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0};var Ps=oi.exports,Al=bn.exports;Mi.exports=Ps,Mi.exports.murmur3=Ps,Mi.exports.murmur2=Al;class na{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,l,p,y){this.ids.push(cu(t)),this.positions.push(l,p,y)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=cu(t);let p=0,y=this.ids.length-1;for(;p<y;){const I=p+y>>1;this.ids[I]>=l?y=I:p=I+1}const w=[];for(;this.ids[p]===l;)w.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return w}static serialize(t,l){const p=new Float64Array(t.ids),y=new Uint32Array(t.positions);return Pl(p,y,0,p.length-1),l&&l.push(p.buffer,y.buffer),{ids:p,positions:y}}static deserialize(t){const l=new na;return l.ids=t.ids,l.positions=t.positions,l.indexed=!0,l}}function cu(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Mi.exports(String(n))}function Pl(n,t,l,p){for(;l<p;){const y=n[l+p>>1];let w=l-1,I=p+1;for(;;){do w++;while(n[w]<y);do I--;while(n[I]>y);if(w>=I)break;vs(n,w,I),vs(t,3*w,3*I),vs(t,3*w+1,3*I+1),vs(t,3*w+2,3*I+2)}I-l<p-I?(Pl(n,t,l,I),l=I+1):(Pl(n,t,I+1,p),p=I)}}function vs(n,t,l){const p=n[t];n[t]=n[l],n[l]=p}qt("FeaturePositionMap",na);class Ms{constructor(t,l){this.gl=t.gl,this.location=l}}class zs extends Ms{constructor(t,l){super(t,l),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class To extends Ms{constructor(t,l){super(t,l),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Sp extends Ms{constructor(t,l){super(t,l),this.current=te.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const c0=new Float32Array(16);function Nh(n){return[Ur(255*n.r,255*n.g),Ur(255*n.b,255*n.a)]}class Ml{constructor(t,l,p){this.value=t,this.uniformNames=l.map(y=>`u_${y}`),this.type=p}setUniform(t,l,p){t.set(p.constantOr(this.value))}getBinding(t,l,p){return this.type==="color"?new Sp(t,l):new zs(t,l)}}class Co{constructor(t,l){this.uniformNames=l.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=t.tlbr}setUniform(t,l,p,y){const w=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&t.set(w)}getBinding(t,l,p){return p.substr(0,9)==="u_pattern"?new To(t,l):new zs(t,l)}}class Ds{constructor(t,l,p,y){this.expression=t,this.type=p,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,l,p,y,w){const I=this.paintVertexArray.length,M=this.expression.evaluate(new ai(0),l,{},y,[],w);this.paintVertexArray.resize(t),this._setPaintValue(I,t,M)}updatePaintArray(t,l,p,y){const w=this.expression.evaluate({zoom:0},p,y);this._setPaintValue(t,l,w)}_setPaintValue(t,l,p){if(this.type==="color"){const y=Nh(p);for(let w=t;w<l;w++)this.paintVertexArray.emplace(w,y[0],y[1])}else{for(let y=t;y<l;y++)this.paintVertexArray.emplace(y,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jn{constructor(t,l,p,y,w,I){this.expression=t,this.uniformNames=l.map(M=>`u_${M}_t`),this.type=p,this.useIntegerZoom=y,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=l.map(M=>({name:`a_${M}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new I}populatePaintArray(t,l,p,y,w){const I=this.expression.evaluate(new ai(this.zoom),l,{},y,[],w),M=this.expression.evaluate(new ai(this.zoom+1),l,{},y,[],w),R=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(R,t,I,M)}updatePaintArray(t,l,p,y){const w=this.expression.evaluate({zoom:this.zoom},p,y),I=this.expression.evaluate({zoom:this.zoom+1},p,y);this._setPaintValue(t,l,w,I)}_setPaintValue(t,l,p,y){if(this.type==="color"){const w=Nh(p),I=Nh(y);for(let M=t;M<l;M++)this.paintVertexArray.emplace(M,w[0],w[1],I[0],I[1])}else{for(let w=t;w<l;w++)this.paintVertexArray.emplace(w,p,y);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(y))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,l){const p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,y=x(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);t.set(y)}getBinding(t,l,p){return new zs(t,l)}}class sa{constructor(t,l,p,y,w,I){this.expression=t,this.type=l,this.useIntegerZoom=p,this.zoom=y,this.layerId=I,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(t,l,p){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(y,t,l.patterns&&l.patterns[this.layerId],p)}updatePaintArray(t,l,p,y,w){this._setPaintValues(t,l,p.patterns&&p.patterns[this.layerId],w)}_setPaintValues(t,l,p,y){if(!y||!p)return;const{min:w,mid:I,max:M}=p,R=y[w],N=y[I],Z=y[M];if(R&&N&&Z)for(let X=t;X<l;X++)this.zoomInPaintVertexArray.emplace(X,N.tl[0],N.tl[1],N.br[0],N.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],N.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(X,N.tl[0],N.tl[1],N.br[0],N.br[1],Z.tl[0],Z.tl[1],Z.br[0],Z.br[1],N.pixelRatio,Z.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Pi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Pi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class kp{constructor(t,l,p){this.binders={},this._buffers=[];const y=[];for(const w in t.paint._values){if(!p(w))continue;const I=t.paint.get(w);if(!(I instanceof Dn&&ei(I.property.specification)))continue;const M=u0(w,t.type),R=I.value,N=I.property.specification.type,Z=I.property.useIntegerZoom,X=I.property.specification["property-type"],ee=X==="cross-faded"||X==="cross-faded-data-driven";if(R.kind==="constant")this.binders[w]=ee?new Co(R.value,M):new Ml(R.value,M,N),y.push(`/u_${w}`);else if(R.kind==="source"||ee){const se=Ep(w,N,"source");this.binders[w]=ee?new sa(R,N,Z,l,se,t.id):new Ds(R,M,N,se),y.push(`/a_${w}`)}else{const se=Ep(w,N,"composite");this.binders[w]=new Jn(R,M,N,Z,l,se),y.push(`/z_${w}`)}}this.cacheKey=y.sort().join("")}getMaxValue(t){const l=this.binders[t];return l instanceof Ds||l instanceof Jn?l.maxValue:0}populatePaintArrays(t,l,p,y,w){for(const I in this.binders){const M=this.binders[I];(M instanceof Ds||M instanceof Jn||M instanceof sa)&&M.populatePaintArray(t,l,p,y,w)}}setConstantPatternPositions(t,l){for(const p in this.binders){const y=this.binders[p];y instanceof Co&&y.setConstantPatternPositions(t,l)}}updatePaintArrays(t,l,p,y,w){let I=!1;for(const M in t){const R=l.getPositions(M);for(const N of R){const Z=p.feature(N.index);for(const X in this.binders){const ee=this.binders[X];if((ee instanceof Ds||ee instanceof Jn||ee instanceof sa)&&ee.expression.isStateDependent===!0){const se=y.paint.get(X);ee.expression=se.value,ee.updatePaintArray(N.start,N.end,Z,t[M],w),I=!0}}}}return I}defines(){const t=[];for(const l in this.binders){const p=this.binders[l];(p instanceof Ml||p instanceof Co)&&t.push(...p.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return t}getBinderAttributes(){const t=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof Ds||p instanceof Jn)for(let y=0;y<p.paintVertexAttributes.length;y++)t.push(p.paintVertexAttributes[y].name);else if(p instanceof sa)for(let y=0;y<Pi.members.length;y++)t.push(Pi.members[y].name)}return t}getBinderUniforms(){const t=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof Ml||p instanceof Co||p instanceof Jn)for(const y of p.uniformNames)t.push(y)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,l){const p=[];for(const y in this.binders){const w=this.binders[y];if(w instanceof Ml||w instanceof Co||w instanceof Jn){for(const I of w.uniformNames)if(l[I]){const M=w.getBinding(t,l[I],I);p.push({name:I,property:y,binding:M})}}}return p}setUniforms(t,l,p,y){for(const{name:w,property:I,binding:M}of l)this.binders[I].setUniform(M,y,p.get(I),w)}updatePaintBuffers(t){this._buffers=[];for(const l in this.binders){const p=this.binders[l];if(t&&p instanceof sa){const y=t.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(p instanceof Ds||p instanceof Jn)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(t){for(const l in this.binders){const p=this.binders[l];(p instanceof Ds||p instanceof Jn||p instanceof sa)&&p.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const l=this.binders[t];(l instanceof Ds||l instanceof Jn||l instanceof sa)&&l.destroy()}}}class $a{constructor(t,l,p=()=>!0){this.programConfigurations={};for(const y of t)this.programConfigurations[y.id]=new kp(y,l,p);this.needsUpload=!1,this._featureMap=new na,this._bufferOffset=0}populatePaintArrays(t,l,p,y,w,I){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(t,l,y,w,I);l.id!==void 0&&this._featureMap.add(l.id,p,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,l,p,y){for(const w of p)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(t,this._featureMap,l,w,y)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function u0(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Ep(n,t,l){const p={color:{source:m,composite:Je},number:{source:pe,composite:m}},y=function(w){return{"line-pattern":{source:Ai,composite:Ai},"fill-pattern":{source:Ai,composite:Ai},"fill-extrusion-pattern":{source:Ai,composite:Ai}}[w]}(n);return y&&y[l]||p[t][l]}qt("ConstantBinder",Ml),qt("CrossFadedConstantBinder",Co),qt("SourceExpressionBinder",Ds),qt("CrossFadedCompositeBinder",sa),qt("CompositeExpressionBinder",Jn),qt("ProgramConfiguration",kp,{omit:["_buffers"]}),qt("ProgramConfigurationSet",$a);var Ti=8192;const Fh=Math.pow(2,14)-1,Tp=-Fh-1;function ja(n){const t=Ti/n.extent,l=n.loadGeometry();for(let p=0;p<l.length;p++){const y=l[p];for(let w=0;w<y.length;w++){const I=y[w],M=Math.round(I.x*t),R=Math.round(I.y*t);I.x=x(M,Tp,Fh),I.y=x(R,Tp,Fh),(M<I.x||M>I.x+1||R<I.y||R>I.y+1)&&q("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function qa(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?ja(n):[]}}function uu(n,t,l,p,y){n.emplaceBack(2*t+(p+1)/2,2*l+(y+1)/2)}class Uh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new qr,this.indexArray=new Qi,this.segments=new Sr,this.programConfigurations=new $a(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,p){const y=this.layers[0],w=[];let I=null,M=!1;y.type==="circle"&&(I=y.layout.get("circle-sort-key"),M=!I.isConstant());for(const{feature:R,id:N,index:Z,sourceLayerIndex:X}of t){const ee=this.layers[0]._featureFilter.needGeometry,se=qa(R,ee);if(!this.layers[0]._featureFilter.filter(new ai(this.zoom),se,p))continue;const ae=M?I.evaluate(se,{},p):void 0,ke={id:N,properties:R.properties,type:R.type,sourceLayerIndex:X,index:Z,geometry:ee?se.geometry:ja(R),patterns:{},sortKey:ae};w.push(ke)}M&&w.sort((R,N)=>R.sortKey-N.sortKey);for(const R of w){const{geometry:N,index:Z,sourceLayerIndex:X}=R,ee=t[Z].feature;this.addFeature(R,N,Z,p),l.featureIndex.insert(ee,N,Z,X,this.index)}}update(t,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ei),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,l,p,y){for(const w of l)for(const I of w){const M=I.x,R=I.y;if(M<0||M>=Ti||R<0||R>=Ti)continue;const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),Z=N.vertexLength;uu(this.layoutVertexArray,M,R,-1,-1),uu(this.layoutVertexArray,M,R,1,-1),uu(this.layoutVertexArray,M,R,1,1),uu(this.layoutVertexArray,M,R,-1,1),this.indexArray.emplaceBack(Z,Z+1,Z+2),this.indexArray.emplaceBack(Z,Z+3,Z+2),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,p,{},y)}}function Cp(n,t){for(let l=0;l<n.length;l++)if(Io(t,n[l]))return!0;for(let l=0;l<t.length;l++)if(Io(n,t[l]))return!0;return!!Vh(n,t)}function h0(n,t,l){return!!Io(n,t)||!!$h(t,n,l)}function Ip(n,t){if(n.length===1)return Pp(t,n[0]);for(let l=0;l<t.length;l++){const p=t[l];for(let y=0;y<p.length;y++)if(Io(n,p[y]))return!0}for(let l=0;l<n.length;l++)if(Pp(t,n[l]))return!0;for(let l=0;l<t.length;l++)if(Vh(n,t[l]))return!0;return!1}function f0(n,t,l){if(n.length>1){if(Vh(n,t))return!0;for(let p=0;p<t.length;p++)if($h(t[p],n,l))return!0}for(let p=0;p<n.length;p++)if($h(n[p],t,l))return!0;return!1}function Vh(n,t){if(n.length===0||t.length===0)return!1;for(let l=0;l<n.length-1;l++){const p=n[l],y=n[l+1];for(let w=0;w<t.length-1;w++)if(d0(p,y,t[w],t[w+1]))return!0}return!1}function d0(n,t,l,p){return J(n,l,p)!==J(t,l,p)&&J(n,t,l)!==J(n,t,p)}function $h(n,t,l){const p=l*l;if(t.length===1)return n.distSqr(t[0])<p;for(let y=1;y<t.length;y++)if(Ap(n,t[y-1],t[y])<p)return!0;return!1}function Ap(n,t,l){const p=t.distSqr(l);if(p===0)return n.distSqr(t);const y=((n.x-t.x)*(l.x-t.x)+(n.y-t.y)*(l.y-t.y))/p;return n.distSqr(y<0?t:y>1?l:l.sub(t)._mult(y)._add(t))}function Pp(n,t){let l,p,y,w=!1;for(let I=0;I<n.length;I++){l=n[I];for(let M=0,R=l.length-1;M<l.length;R=M++)p=l[M],y=l[R],p.y>t.y!=y.y>t.y&&t.x<(y.x-p.x)*(t.y-p.y)/(y.y-p.y)+p.x&&(w=!w)}return w}function Io(n,t){let l=!1;for(let p=0,y=n.length-1;p<n.length;y=p++){const w=n[p],I=n[y];w.y>t.y!=I.y>t.y&&t.x<(I.x-w.x)*(t.y-w.y)/(I.y-w.y)+w.x&&(l=!l)}return l}function p0(n,t,l){const p=l[0],y=l[2];if(n.x<p.x&&t.x<p.x||n.x>y.x&&t.x>y.x||n.y<p.y&&t.y<p.y||n.y>y.y&&t.y>y.y)return!1;const w=J(n,t,l[0]);return w!==J(n,t,l[1])||w!==J(n,t,l[2])||w!==J(n,t,l[3])}function zl(n,t,l){const p=t.paint.get(n).value;return p.kind==="constant"?p.value:l.programConfigurations.get(t.id).getMaxValue(n)}function hu(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function fu(n,t,l,p,y){if(!t[0]&&!t[1])return n;const w=pt.convert(t)._mult(y);l==="viewport"&&w._rotate(-p);const I=[];for(let M=0;M<n.length;M++)I.push(n[M].sub(w));return I}qt("CircleBucket",Uh,{omit:["layers"]});const m0=new Ri({"circle-sort-key":new lr(Fe.layout_circle["circle-sort-key"])});var g0={paint:new Ri({"circle-radius":new lr(Fe.paint_circle["circle-radius"]),"circle-color":new lr(Fe.paint_circle["circle-color"]),"circle-blur":new lr(Fe.paint_circle["circle-blur"]),"circle-opacity":new lr(Fe.paint_circle["circle-opacity"]),"circle-translate":new Wt(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Wt(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wt(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wt(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lr(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lr(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lr(Fe.paint_circle["circle-stroke-opacity"])}),layout:m0},en=1e-6,tn=typeof Float32Array<"u"?Float32Array:Array;function Mp(){var n=new tn(9);return tn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function jh(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function zp(n,t,l){var p=t[0],y=t[1],w=t[2],I=t[3],M=t[4],R=t[5],N=t[6],Z=t[7],X=t[8],ee=t[9],se=t[10],ae=t[11],ke=t[12],we=t[13],Be=t[14],Ye=t[15],Re=l[0],We=l[1],ht=l[2],ut=l[3];return n[0]=Re*p+We*M+ht*X+ut*ke,n[1]=Re*y+We*R+ht*ee+ut*we,n[2]=Re*w+We*N+ht*se+ut*Be,n[3]=Re*I+We*Z+ht*ae+ut*Ye,n[4]=(Re=l[4])*p+(We=l[5])*M+(ht=l[6])*X+(ut=l[7])*ke,n[5]=Re*y+We*R+ht*ee+ut*we,n[6]=Re*w+We*N+ht*se+ut*Be,n[7]=Re*I+We*Z+ht*ae+ut*Ye,n[8]=(Re=l[8])*p+(We=l[9])*M+(ht=l[10])*X+(ut=l[11])*ke,n[9]=Re*y+We*R+ht*ee+ut*we,n[10]=Re*w+We*N+ht*se+ut*Be,n[11]=Re*I+We*Z+ht*ae+ut*Ye,n[12]=(Re=l[12])*p+(We=l[13])*M+(ht=l[14])*X+(ut=l[15])*ke,n[13]=Re*y+We*R+ht*ee+ut*we,n[14]=Re*w+We*N+ht*se+ut*Be,n[15]=Re*I+We*Z+ht*ae+ut*Ye,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Dl,_0=zp;function Dp(){var n=new tn(3);return tn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Lp(n,t,l){var p=new tn(3);return p[0]=n,p[1]=t,p[2]=l,p}function du(n,t,l){var p=t[0],y=t[1],w=t[2],I=t[3];return n[0]=l[0]*p+l[4]*y+l[8]*w+l[12]*I,n[1]=l[1]*p+l[5]*y+l[9]*w+l[13]*I,n[2]=l[2]*p+l[6]*y+l[10]*w+l[14]*I,n[3]=l[3]*p+l[7]*y+l[11]*w+l[15]*I,n}function Rp(){var n=new tn(4);return tn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Op(n,t){const l=du([],[n.x,n.y,0,1],t);return new pt(l[0]/l[3],l[1]/l[3])}Dp(),Dl=new tn(4),tn!=Float32Array&&(Dl[0]=0,Dl[1]=0,Dl[2]=0,Dl[3]=0),Dp(),Lp(1,0,0),Lp(0,1,0),Rp(),Rp(),Mp(),function(){var n;n=new tn(2),tn!=Float32Array&&(n[0]=0,n[1]=0)}();class Bp extends Uh{}qt("HeatmapBucket",Bp,{omit:["layers"]});var y0={paint:new Ri({"heatmap-radius":new lr(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lr(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wt(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ms(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wt(Fe.paint_heatmap["heatmap-opacity"])})};function qh(n,{width:t,height:l},p,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==t*l*p)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${t*l*p}`)}else y=new Uint8Array(t*l*p);return n.width=t,n.height=l,n.data=y,n}function Np(n,{width:t,height:l},p){if(t===n.width&&l===n.height)return;const y=qh({},{width:t,height:l},p);Gh(n,y,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,l)},p),n.width=t,n.height=l,n.data=y.data}function Gh(n,t,l,p,y,w){if(y.width===0||y.height===0)return t;if(y.width>n.width||y.height>n.height||l.x>n.width-y.width||l.y>n.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>t.width||y.height>t.height||p.x>t.width-y.width||p.y>t.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const I=n.data,M=t.data;if(I===M)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<y.height;R++){const N=((l.y+R)*n.width+l.x)*w,Z=((p.y+R)*t.width+p.x)*w;for(let X=0;X<y.width*w;X++)M[Z+X]=I[N+X]}return t}class Ll{constructor(t,l){qh(this,t,1,l)}resize(t){Np(this,t,1)}clone(){return new Ll({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,p,y,w){Gh(t,l,p,y,w,1)}}class Tn{constructor(t,l){qh(this,t,4,l)}resize(t){Np(this,t,4)}replace(t,l){l?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Tn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,p,y,w){Gh(t,l,p,y,w,4)}}function Fp(n){const t={},l=n.resolution||256,p=n.clips?n.clips.length:1,y=n.image||new Tn({width:l,height:p});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const w=(I,M,R)=>{t[n.evaluationKey]=R;const N=n.expression.evaluate(t);y.data[I+M+0]=Math.floor(255*N.r/N.a),y.data[I+M+1]=Math.floor(255*N.g/N.a),y.data[I+M+2]=Math.floor(255*N.b/N.a),y.data[I+M+3]=Math.floor(255*N.a)};if(n.clips)for(let I=0,M=0;I<p;++I,M+=4*l)for(let R=0,N=0;R<l;R++,N+=4){const Z=R/(l-1),{start:X,end:ee}=n.clips[I];w(M,N,X*(1-Z)+ee*Z)}else for(let I=0,M=0;I<l;I++,M+=4)w(0,M,I/(l-1));return y}qt("AlphaImage",Ll),qt("RGBAImage",Tn);var v0={paint:new Ri({"hillshade-illumination-direction":new Wt(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Wt(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Wt(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Wt(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Wt(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Wt(Fe.paint_hillshade["hillshade-accent-color"])})};const b0=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:x0}=b0;var pu={exports:{}};function mu(n,t,l){l=l||2;var p,y,w,I,M,R,N,Z=t&&t.length,X=Z?t[0]*l:n.length,ee=Up(n,0,X,l,!0),se=[];if(!ee||ee.next===ee.prev)return se;if(Z&&(ee=function(ke,we,Be,Ye){var Re,We,ht,ut=[];for(Re=0,We=we.length;Re<We;Re++)(ht=Up(ke,we[Re]*Ye,Re<We-1?we[Re+1]*Ye:ke.length,Ye,!1))===ht.next&&(ht.steiner=!0),ut.push(A0(ht));for(ut.sort(T0),Re=0;Re<ut.length;Re++)Be=C0(ut[Re],Be);return Be}(n,t,ee,l)),n.length>80*l){p=w=n[0],y=I=n[1];for(var ae=l;ae<X;ae+=l)(M=n[ae])<p&&(p=M),(R=n[ae+1])<y&&(y=R),M>w&&(w=M),R>I&&(I=R);N=(N=Math.max(w-p,I-y))!==0?32767/N:0}return Rl(ee,se,l,p,y,N,0),se}function Up(n,t,l,p,y){var w,I;if(y===Wh(n,t,l,p)>0)for(w=t;w<l;w+=p)I=jp(w,n[w],n[w+1],I);else for(w=l-p;w>=t;w-=p)I=jp(w,n[w],n[w+1],I);return I&&gu(I,I.next)&&(Bl(I),I=I.next),I}function Ga(n,t){if(!n)return n;t||(t=n);var l,p=n;do if(l=!1,p.steiner||!gu(p,p.next)&&bi(p.prev,p,p.next)!==0)p=p.next;else{if(Bl(p),(p=t=p.prev)===p.next)break;l=!0}while(l||p!==t);return t}function Rl(n,t,l,p,y,w,I){if(n){!I&&w&&function(Z,X,ee,se){var ae=Z;do ae.z===0&&(ae.z=Zh(ae.x,ae.y,X,ee,se)),ae.prevZ=ae.prev,ae.nextZ=ae.next,ae=ae.next;while(ae!==Z);ae.prevZ.nextZ=null,ae.prevZ=null,function(ke){var we,Be,Ye,Re,We,ht,ut,jt,Gt=1;do{for(Be=ke,ke=null,We=null,ht=0;Be;){for(ht++,Ye=Be,ut=0,we=0;we<Gt&&(ut++,Ye=Ye.nextZ);we++);for(jt=Gt;ut>0||jt>0&&Ye;)ut!==0&&(jt===0||!Ye||Be.z<=Ye.z)?(Re=Be,Be=Be.nextZ,ut--):(Re=Ye,Ye=Ye.nextZ,jt--),We?We.nextZ=Re:ke=Re,Re.prevZ=We,We=Re;Be=Ye}We.nextZ=null,Gt*=2}while(ht>1)}(ae)}(n,p,y,w);for(var M,R,N=n;n.prev!==n.next;)if(M=n.prev,R=n.next,w?S0(n,p,y,w):w0(n))t.push(M.i/l|0),t.push(n.i/l|0),t.push(R.i/l|0),Bl(n),n=R.next,N=R.next;else if((n=R)===N){I?I===1?Rl(n=k0(Ga(n),t,l),t,l,p,y,w,2):I===2&&E0(n,t,l,p,y,w):Rl(Ga(n),t,l,p,y,w,1);break}}}function w0(n){var t=n.prev,l=n,p=n.next;if(bi(t,l,p)>=0)return!1;for(var y=t.x,w=l.x,I=p.x,M=t.y,R=l.y,N=p.y,Z=y<w?y<I?y:I:w<I?w:I,X=M<R?M<N?M:N:R<N?R:N,ee=y>w?y>I?y:I:w>I?w:I,se=M>R?M>N?M:N:R>N?R:N,ae=p.next;ae!==t;){if(ae.x>=Z&&ae.x<=ee&&ae.y>=X&&ae.y<=se&&Ao(y,M,w,R,I,N,ae.x,ae.y)&&bi(ae.prev,ae,ae.next)>=0)return!1;ae=ae.next}return!0}function S0(n,t,l,p){var y=n.prev,w=n,I=n.next;if(bi(y,w,I)>=0)return!1;for(var M=y.x,R=w.x,N=I.x,Z=y.y,X=w.y,ee=I.y,se=M<R?M<N?M:N:R<N?R:N,ae=Z<X?Z<ee?Z:ee:X<ee?X:ee,ke=M>R?M>N?M:N:R>N?R:N,we=Z>X?Z>ee?Z:ee:X>ee?X:ee,Be=Zh(se,ae,t,l,p),Ye=Zh(ke,we,t,l,p),Re=n.prevZ,We=n.nextZ;Re&&Re.z>=Be&&We&&We.z<=Ye;){if(Re.x>=se&&Re.x<=ke&&Re.y>=ae&&Re.y<=we&&Re!==y&&Re!==I&&Ao(M,Z,R,X,N,ee,Re.x,Re.y)&&bi(Re.prev,Re,Re.next)>=0||(Re=Re.prevZ,We.x>=se&&We.x<=ke&&We.y>=ae&&We.y<=we&&We!==y&&We!==I&&Ao(M,Z,R,X,N,ee,We.x,We.y)&&bi(We.prev,We,We.next)>=0))return!1;We=We.nextZ}for(;Re&&Re.z>=Be;){if(Re.x>=se&&Re.x<=ke&&Re.y>=ae&&Re.y<=we&&Re!==y&&Re!==I&&Ao(M,Z,R,X,N,ee,Re.x,Re.y)&&bi(Re.prev,Re,Re.next)>=0)return!1;Re=Re.prevZ}for(;We&&We.z<=Ye;){if(We.x>=se&&We.x<=ke&&We.y>=ae&&We.y<=we&&We!==y&&We!==I&&Ao(M,Z,R,X,N,ee,We.x,We.y)&&bi(We.prev,We,We.next)>=0)return!1;We=We.nextZ}return!0}function k0(n,t,l){var p=n;do{var y=p.prev,w=p.next.next;!gu(y,w)&&Vp(y,p,p.next,w)&&Ol(y,w)&&Ol(w,y)&&(t.push(y.i/l|0),t.push(p.i/l|0),t.push(w.i/l|0),Bl(p),Bl(p.next),p=n=w),p=p.next}while(p!==n);return Ga(p)}function E0(n,t,l,p,y,w){var I=n;do{for(var M=I.next.next;M!==I.prev;){if(I.i!==M.i&&P0(I,M)){var R=$p(I,M);return I=Ga(I,I.next),R=Ga(R,R.next),Rl(I,t,l,p,y,w,0),void Rl(R,t,l,p,y,w,0)}M=M.next}I=I.next}while(I!==n)}function T0(n,t){return n.x-t.x}function C0(n,t){var l=function(y,w){var I,M=w,R=y.x,N=y.y,Z=-1/0;do{if(N<=M.y&&N>=M.next.y&&M.next.y!==M.y){var X=M.x+(N-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(X<=R&&X>Z&&(Z=X,I=M.x<M.next.x?M:M.next,X===R))return I}M=M.next}while(M!==w);if(!I)return null;var ee,se=I,ae=I.x,ke=I.y,we=1/0;M=I;do R>=M.x&&M.x>=ae&&R!==M.x&&Ao(N<ke?R:Z,N,ae,ke,N<ke?Z:R,N,M.x,M.y)&&(ee=Math.abs(N-M.y)/(R-M.x),Ol(M,y)&&(ee<we||ee===we&&(M.x>I.x||M.x===I.x&&I0(I,M)))&&(I=M,we=ee)),M=M.next;while(M!==se);return I}(n,t);if(!l)return t;var p=$p(l,n);return Ga(p,p.next),Ga(l,l.next)}function I0(n,t){return bi(n.prev,n,t.prev)<0&&bi(t.next,n,n.next)<0}function Zh(n,t,l,p,y){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-l)*y|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-p)*y|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function A0(n){var t=n,l=n;do(t.x<l.x||t.x===l.x&&t.y<l.y)&&(l=t),t=t.next;while(t!==n);return l}function Ao(n,t,l,p,y,w,I,M){return(y-I)*(t-M)>=(n-I)*(w-M)&&(n-I)*(p-M)>=(l-I)*(t-M)&&(l-I)*(w-M)>=(y-I)*(p-M)}function P0(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(l,p){var y=l;do{if(y.i!==l.i&&y.next.i!==l.i&&y.i!==p.i&&y.next.i!==p.i&&Vp(y,y.next,l,p))return!0;y=y.next}while(y!==l);return!1}(n,t)&&(Ol(n,t)&&Ol(t,n)&&function(l,p){var y=l,w=!1,I=(l.x+p.x)/2,M=(l.y+p.y)/2;do y.y>M!=y.next.y>M&&y.next.y!==y.y&&I<(y.next.x-y.x)*(M-y.y)/(y.next.y-y.y)+y.x&&(w=!w),y=y.next;while(y!==l);return w}(n,t)&&(bi(n.prev,n,t.prev)||bi(n,t.prev,t))||gu(n,t)&&bi(n.prev,n,n.next)>0&&bi(t.prev,t,t.next)>0)}function bi(n,t,l){return(t.y-n.y)*(l.x-t.x)-(t.x-n.x)*(l.y-t.y)}function gu(n,t){return n.x===t.x&&n.y===t.y}function Vp(n,t,l,p){var y=yu(bi(n,t,l)),w=yu(bi(n,t,p)),I=yu(bi(l,p,n)),M=yu(bi(l,p,t));return y!==w&&I!==M||!(y!==0||!_u(n,l,t))||!(w!==0||!_u(n,p,t))||!(I!==0||!_u(l,n,p))||!(M!==0||!_u(l,t,p))}function _u(n,t,l){return t.x<=Math.max(n.x,l.x)&&t.x>=Math.min(n.x,l.x)&&t.y<=Math.max(n.y,l.y)&&t.y>=Math.min(n.y,l.y)}function yu(n){return n>0?1:n<0?-1:0}function Ol(n,t){return bi(n.prev,n,n.next)<0?bi(n,t,n.next)>=0&&bi(n,n.prev,t)>=0:bi(n,t,n.prev)<0||bi(n,n.next,t)<0}function $p(n,t){var l=new Hh(n.i,n.x,n.y),p=new Hh(t.i,t.x,t.y),y=n.next,w=t.prev;return n.next=t,t.prev=n,l.next=y,y.prev=l,p.next=l,l.prev=p,w.next=p,p.prev=w,p}function jp(n,t,l,p){var y=new Hh(n,t,l);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function Bl(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Hh(n,t,l){this.i=n,this.x=t,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wh(n,t,l,p){for(var y=0,w=t,I=l-p;w<l;w+=p)y+=(n[I]-n[w])*(n[w+1]+n[I+1]),I=w;return y}function M0(n,t,l,p,y){qp(n,t,l||0,p||n.length-1,y||z0)}function qp(n,t,l,p,y){for(;p>l;){if(p-l>600){var w=p-l+1,I=t-l+1,M=Math.log(w),R=.5*Math.exp(2*M/3),N=.5*Math.sqrt(M*R*(w-R)/w)*(I-w/2<0?-1:1);qp(n,t,Math.max(l,Math.floor(t-I*R/w+N)),Math.min(p,Math.floor(t+(w-I)*R/w+N)),y)}var Z=n[t],X=l,ee=p;for(Nl(n,l,t),y(n[p],Z)>0&&Nl(n,l,p);X<ee;){for(Nl(n,X,ee),X++,ee--;y(n[X],Z)<0;)X++;for(;y(n[ee],Z)>0;)ee--}y(n[l],Z)===0?Nl(n,l,ee):Nl(n,++ee,p),ee<=t&&(l=ee+1),t<=ee&&(p=ee-1)}}function Nl(n,t,l){var p=n[t];n[t]=n[l],n[l]=p}function z0(n,t){return n<t?-1:n>t?1:0}function Kh(n,t){const l=n.length;if(l<=1)return[n];const p=[];let y,w;for(let I=0;I<l;I++){const M=G(n[I]);M!==0&&(n[I].area=Math.abs(M),w===void 0&&(w=M<0),w===M<0?(y&&p.push(y),y=[n[I]]):y.push(n[I]))}if(y&&p.push(y),t>1)for(let I=0;I<p.length;I++)p[I].length<=t||(M0(p[I],t,1,p[I].length-1,D0),p[I]=p[I].slice(0,t));return p}function D0(n,t){return t.area-n.area}function Xh(n,t,l){const p=l.patternDependencies;let y=!1;for(const w of t){const I=w.paint.get(`${n}-pattern`);I.isConstant()||(y=!0);const M=I.constantOr(null);M&&(y=!0,p[M.to]=!0,p[M.from]=!0)}return y}function Jh(n,t,l,p,y){const w=y.patternDependencies;for(const I of t){const M=I.paint.get(`${n}-pattern`).value;if(M.kind!=="constant"){let R=M.evaluate({zoom:p-1},l,{},y.availableImages),N=M.evaluate({zoom:p},l,{},y.availableImages),Z=M.evaluate({zoom:p+1},l,{},y.availableImages);R=R&&R.name?R.name:R,N=N&&N.name?N.name:N,Z=Z&&Z.name?Z.name:Z,w[R]=!0,w[N]=!0,w[Z]=!0,l.patterns[I.id]={min:R,mid:N,max:Z}}}return l}pu.exports=mu,pu.exports.default=mu,mu.deviation=function(n,t,l,p){var y=t&&t.length,w=Math.abs(Wh(n,0,y?t[0]*l:n.length,l));if(y)for(var I=0,M=t.length;I<M;I++)w-=Math.abs(Wh(n,t[I]*l,I<M-1?t[I+1]*l:n.length,l));var R=0;for(I=0;I<p.length;I+=3){var N=p[I]*l,Z=p[I+1]*l,X=p[I+2]*l;R+=Math.abs((n[N]-n[X])*(n[Z+1]-n[N+1])-(n[N]-n[Z])*(n[X+1]-n[N+1]))}return w===0&&R===0?0:Math.abs((R-w)/w)},mu.flatten=function(n){for(var t=n[0][0].length,l={vertices:[],holes:[],dimensions:t},p=0,y=0;y<n.length;y++){for(var w=0;w<n[y].length;w++)for(var I=0;I<t;I++)l.vertices.push(n[y][w][I]);y>0&&l.holes.push(p+=n[y-1].length)}return l};class Yh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Gr,this.indexArray=new Qi,this.indexArray2=new Xn,this.programConfigurations=new $a(t.layers,t.zoom),this.segments=new Sr,this.segments2=new Sr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,p){this.hasPattern=Xh("fill",this.layers,l);const y=this.layers[0].layout.get("fill-sort-key"),w=!y.isConstant(),I=[];for(const{feature:M,id:R,index:N,sourceLayerIndex:Z}of t){const X=this.layers[0]._featureFilter.needGeometry,ee=qa(M,X);if(!this.layers[0]._featureFilter.filter(new ai(this.zoom),ee,p))continue;const se=w?y.evaluate(ee,{},p,l.availableImages):void 0,ae={id:R,properties:M.properties,type:M.type,sourceLayerIndex:Z,index:N,geometry:X?ee.geometry:ja(M),patterns:{},sortKey:se};I.push(ae)}w&&I.sort((M,R)=>M.sortKey-R.sortKey);for(const M of I){const{geometry:R,index:N,sourceLayerIndex:Z}=M;if(this.hasPattern){const X=Jh("fill",this.layers,M,this.zoom,l);this.patternFeatures.push(X)}else this.addFeature(M,R,N,p,{});l.featureIndex.insert(t[N].feature,R,N,Z,this.index)}}update(t,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,p)}addFeatures(t,l,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,x0),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,l,p,y,w){for(const I of Kh(l,500)){let M=0;for(const se of I)M+=se.length;const R=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),N=R.vertexLength,Z=[],X=[];for(const se of I){if(se.length===0)continue;se!==I[0]&&X.push(Z.length/2);const ae=this.segments2.prepareSegment(se.length,this.layoutVertexArray,this.indexArray2),ke=ae.vertexLength;this.layoutVertexArray.emplaceBack(se[0].x,se[0].y),this.indexArray2.emplaceBack(ke+se.length-1,ke),Z.push(se[0].x),Z.push(se[0].y);for(let we=1;we<se.length;we++)this.layoutVertexArray.emplaceBack(se[we].x,se[we].y),this.indexArray2.emplaceBack(ke+we-1,ke+we),Z.push(se[we].x),Z.push(se[we].y);ae.vertexLength+=se.length,ae.primitiveLength+=se.length}const ee=pu.exports(Z,X);for(let se=0;se<ee.length;se+=3)this.indexArray.emplaceBack(N+ee[se],N+ee[se+1],N+ee[se+2]);R.vertexLength+=M,R.primitiveLength+=ee.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,p,w,y)}}qt("FillBucket",Yh,{omit:["layers","patternFeatures"]});const L0=new Ri({"fill-sort-key":new lr(Fe.layout_fill["fill-sort-key"])});var R0={paint:new Ri({"fill-antialias":new Wt(Fe.paint_fill["fill-antialias"]),"fill-opacity":new lr(Fe.paint_fill["fill-opacity"]),"fill-color":new lr(Fe.paint_fill["fill-color"]),"fill-outline-color":new lr(Fe.paint_fill["fill-outline-color"]),"fill-translate":new Wt(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Wt(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ia(Fe.paint_fill["fill-pattern"])}),layout:L0};const O0=xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),B0=xi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:N0}=O0;var aa={},F0=pt,Gp=Po;function Po(n,t,l,p,y){this.properties={},this.extent=l,this.type=0,this._pbf=n,this._geometry=-1,this._keys=p,this._values=y,n.readFields(U0,this,t)}function U0(n,t,l){n==1?t.id=l.readVarint():n==2?function(p,y){for(var w=p.readVarint()+p.pos;p.pos<w;){var I=y._keys[p.readVarint()],M=y._values[p.readVarint()];y.properties[I]=M}}(l,t):n==3?t.type=l.readVarint():n==4&&(t._geometry=l.pos)}function V0(n){for(var t,l,p=0,y=0,w=n.length,I=w-1;y<w;I=y++)p+=((l=n[I]).x-(t=n[y]).x)*(t.y+l.y);return p}Po.types=["Unknown","Point","LineString","Polygon"],Po.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,l=n.readVarint()+n.pos,p=1,y=0,w=0,I=0,M=[];n.pos<l;){if(y<=0){var R=n.readVarint();p=7&R,y=R>>3}if(y--,p===1||p===2)w+=n.readSVarint(),I+=n.readSVarint(),p===1&&(t&&M.push(t),t=[]),t.push(new F0(w,I));else{if(p!==7)throw new Error("unknown command "+p);t&&t.push(t[0].clone())}}return t&&M.push(t),M},Po.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,l=1,p=0,y=0,w=0,I=1/0,M=-1/0,R=1/0,N=-1/0;n.pos<t;){if(p<=0){var Z=n.readVarint();l=7&Z,p=Z>>3}if(p--,l===1||l===2)(y+=n.readSVarint())<I&&(I=y),y>M&&(M=y),(w+=n.readSVarint())<R&&(R=w),w>N&&(N=w);else if(l!==7)throw new Error("unknown command "+l)}return[I,R,M,N]},Po.prototype.toGeoJSON=function(n,t,l){var p,y,w=this.extent*Math.pow(2,l),I=this.extent*n,M=this.extent*t,R=this.loadGeometry(),N=Po.types[this.type];function Z(se){for(var ae=0;ae<se.length;ae++){var ke=se[ae];se[ae]=[360*(ke.x+I)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+M)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(p=0;p<R.length;p++)X[p]=R[p][0];Z(R=X);break;case 2:for(p=0;p<R.length;p++)Z(R[p]);break;case 3:for(R=function(se){var ae=se.length;if(ae<=1)return[se];for(var ke,we,Be=[],Ye=0;Ye<ae;Ye++){var Re=V0(se[Ye]);Re!==0&&(we===void 0&&(we=Re<0),we===Re<0?(ke&&Be.push(ke),ke=[se[Ye]]):ke.push(se[Ye]))}return ke&&Be.push(ke),Be}(R),p=0;p<R.length;p++)for(y=0;y<R[p].length;y++)Z(R[p][y])}R.length===1?R=R[0]:N="Multi"+N;var ee={type:"Feature",geometry:{type:N,coordinates:R},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var $0=Gp,Zp=Hp;function Hp(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(j0,this,t),this.length=this._features.length}function j0(n,t,l){n===15?t.version=l.readVarint():n===1?t.name=l.readString():n===5?t.extent=l.readVarint():n===2?t._features.push(l.pos):n===3?t._keys.push(l.readString()):n===4&&t._values.push(function(p){for(var y=null,w=p.readVarint()+p.pos;p.pos<w;){var I=p.readVarint()>>3;y=I===1?p.readString():I===2?p.readFloat():I===3?p.readDouble():I===4?p.readVarint64():I===5?p.readVarint():I===6?p.readSVarint():I===7?p.readBoolean():null}return y}(l))}Hp.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new $0(this._pbf,t,this.extent,this._keys,this._values)};var q0=Zp;function G0(n,t,l){if(n===3){var p=new q0(l,l.readVarint()+l.pos);p.length&&(t[p.name]=p)}}aa.VectorTile=function(n,t){this.layers=n.readFields(G0,{},t)},aa.VectorTileFeature=Gp,aa.VectorTileLayer=Zp;const Z0=aa.VectorTileFeature.types,Qh=Math.pow(2,13);function Fl(n,t,l,p,y,w,I,M){n.emplaceBack(t,l,2*Math.floor(p*Qh)+I,y*Qh*2,w*Qh*2,Math.round(M))}class ef{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ar,this.centroidVertexArray=new tr,this.indexArray=new Qi,this.programConfigurations=new $a(t.layers,t.zoom),this.segments=new Sr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,p){this.features=[],this.hasPattern=Xh("fill-extrusion",this.layers,l);for(const{feature:y,id:w,index:I,sourceLayerIndex:M}of t){const R=this.layers[0]._featureFilter.needGeometry,N=qa(y,R);if(!this.layers[0]._featureFilter.filter(new ai(this.zoom),N,p))continue;const Z={id:w,sourceLayerIndex:M,index:I,geometry:R?N.geometry:ja(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(Jh("fill-extrusion",this.layers,Z,this.zoom,l)):this.addFeature(Z,Z.geometry,I,p,{}),l.featureIndex.insert(y,Z.geometry,I,M,this.index,!0)}}addFeatures(t,l,p){for(const y of this.features){const{geometry:w}=y;this.addFeature(y,w,y.index,l,p)}}update(t,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,N0),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,B0.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,l,p,y,w){const I={x:0,y:0,vertexCount:0};for(const M of Kh(l,500)){let R=0;for(const ae of M)R+=ae.length;let N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ae of M){if(ae.length===0||W0(ae))continue;let ke=0;for(let we=0;we<ae.length;we++){const Be=ae[we];if(we>=1){const Ye=ae[we-1];if(!H0(Be,Ye)){N.vertexLength+4>Sr.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Re=Be.sub(Ye)._perp()._unit(),We=Ye.dist(Be);ke+We>32768&&(ke=0),Fl(this.layoutVertexArray,Be.x,Be.y,Re.x,Re.y,0,0,ke),Fl(this.layoutVertexArray,Be.x,Be.y,Re.x,Re.y,0,1,ke),I.x+=2*Be.x,I.y+=2*Be.y,I.vertexCount+=2,ke+=We,Fl(this.layoutVertexArray,Ye.x,Ye.y,Re.x,Re.y,0,0,ke),Fl(this.layoutVertexArray,Ye.x,Ye.y,Re.x,Re.y,0,1,ke),I.x+=2*Ye.x,I.y+=2*Ye.y,I.vertexCount+=2;const ht=N.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+R>Sr.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),Z0[t.type]!=="Polygon")continue;const Z=[],X=[],ee=N.vertexLength;for(const ae of M)if(ae.length!==0){ae!==M[0]&&X.push(Z.length/2);for(let ke=0;ke<ae.length;ke++){const we=ae[ke];Fl(this.layoutVertexArray,we.x,we.y,0,0,1,1,0),I.x+=we.x,I.y+=we.y,I.vertexCount+=1,Z.push(we.x),Z.push(we.y)}}const se=pu.exports(Z,X);for(let ae=0;ae<se.length;ae+=3)this.indexArray.emplaceBack(ee+se[ae],ee+se[ae+2],ee+se[ae+1]);N.primitiveLength+=se.length/3,N.vertexLength+=R}for(let M=0;M<I.vertexCount;M++)this.centroidVertexArray.emplaceBack(Math.floor(I.x/I.vertexCount),Math.floor(I.y/I.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,p,w,y)}}function H0(n,t){return n.x===t.x&&(n.x<0||n.x>Ti)||n.y===t.y&&(n.y<0||n.y>Ti)}function W0(n){return n.every(t=>t.x<0)||n.every(t=>t.x>Ti)||n.every(t=>t.y<0)||n.every(t=>t.y>Ti)}qt("FillExtrusionBucket",ef,{omit:["layers","features"]});var K0={paint:new Ri({"fill-extrusion-opacity":new Wt(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lr(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wt(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wt(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ia(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new lr(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lr(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Wt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ul(n,t){return n.x*t.x+n.y*t.y}function Wp(n,t){if(n.length===1){let l=0;const p=t[l++];let y;for(;!y||p.equals(y);)if(y=t[l++],!y)return 1/0;for(;l<t.length;l++){const w=t[l],I=n[0],M=y.sub(p),R=w.sub(p),N=I.sub(p),Z=Ul(M,M),X=Ul(M,R),ee=Ul(R,R),se=Ul(N,M),ae=Ul(N,R),ke=Z*ee-X*X,we=(ee*se-X*ae)/ke,Be=(Z*ae-X*se)/ke,Ye=p.z*(1-we-Be)+y.z*we+w.z*Be;if(isFinite(Ye))return Ye}return 1/0}{let l=1/0;for(const p of t)l=Math.min(l,p.z);return l}}const X0=xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:J0}=X0,Y0=xi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Q0}=Y0,ev=aa.VectorTileFeature.types,tv=Math.cos(Math.PI/180*37.5),Kp=Math.pow(2,14)/.5;class tf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Pr,this.layoutVertexArray2=new Hr,this.indexArray=new Qi,this.programConfigurations=new $a(t.layers,t.zoom),this.segments=new Sr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,p){this.hasPattern=Xh("line",this.layers,l);const y=this.layers[0].layout.get("line-sort-key"),w=!y.isConstant(),I=[];for(const{feature:M,id:R,index:N,sourceLayerIndex:Z}of t){const X=this.layers[0]._featureFilter.needGeometry,ee=qa(M,X);if(!this.layers[0]._featureFilter.filter(new ai(this.zoom),ee,p))continue;const se=w?y.evaluate(ee,{},p):void 0,ae={id:R,properties:M.properties,type:M.type,sourceLayerIndex:Z,index:N,geometry:X?ee.geometry:ja(M),patterns:{},sortKey:se};I.push(ae)}w&&I.sort((M,R)=>M.sortKey-R.sortKey);for(const M of I){const{geometry:R,index:N,sourceLayerIndex:Z}=M;if(this.hasPattern){const X=Jh("line",this.layers,M,this.zoom,l);this.patternFeatures.push(X)}else this.addFeature(M,R,N,p,{});l.featureIndex.insert(t[N].feature,R,N,Z,this.index)}}update(t,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,p)}addFeatures(t,l,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Q0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,J0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,l,p,y,w){const I=this.layers[0].layout,M=I.get("line-join").evaluate(t,{}),R=I.get("line-cap"),N=I.get("line-miter-limit"),Z=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const X of l)this.addLine(X,t,M,R,N,Z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,p,w,y)}addLine(t,l,p,y,w,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Be=0;Be<t.length-1;Be++)this.totalDistance+=t[Be].dist(t[Be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=ev[l.type]==="Polygon";let R=t.length;for(;R>=2&&t[R-1].equals(t[R-2]);)R--;let N=0;for(;N<R-1&&t[N].equals(t[N+1]);)N++;if(R<(M?3:2))return;p==="bevel"&&(w=1.05);const Z=this.overscaling<=16?122880/(512*this.overscaling):0,X=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let ee,se,ae,ke,we;this.e1=this.e2=-1,M&&(ee=t[R-2],we=t[N].sub(ee)._unit()._perp());for(let Be=N;Be<R;Be++){if(ae=Be===R-1?M?t[N+1]:void 0:t[Be+1],ae&&t[Be].equals(ae))continue;we&&(ke=we),ee&&(se=ee),ee=t[Be],we=ae?ae.sub(ee)._unit()._perp():ke,ke=ke||we;let Ye=ke.add(we);Ye.x===0&&Ye.y===0||Ye._unit();const Re=ke.x*we.x+ke.y*we.y,We=Ye.x*we.x+Ye.y*we.y,ht=We!==0?1/We:1/0,ut=2*Math.sqrt(2-2*We),jt=We<tv&&se&&ae,Gt=ke.x*we.y-ke.y*we.x>0;if(jt&&Be>N){const At=ee.dist(se);if(At>2*Z){const Ut=ee.sub(ee.sub(se)._mult(Z/At)._round());this.updateDistance(se,Ut),this.addCurrentVertex(Ut,ke,0,0,X),se=Ut}}const Ft=se&&ae;let Lt=Ft?p:M?"butt":y;if(Ft&&Lt==="round"&&(ht<I?Lt="miter":ht<=2&&(Lt="fakeround")),Lt==="miter"&&ht>w&&(Lt="bevel"),Lt==="bevel"&&(ht>2&&(Lt="flipbevel"),ht<w&&(Lt="miter")),se&&this.updateDistance(se,ee),Lt==="miter")Ye._mult(ht),this.addCurrentVertex(ee,Ye,0,0,X);else if(Lt==="flipbevel"){if(ht>100)Ye=we.mult(-1);else{const At=ht*ke.add(we).mag()/ke.sub(we).mag();Ye._perp()._mult(At*(Gt?-1:1))}this.addCurrentVertex(ee,Ye,0,0,X),this.addCurrentVertex(ee,Ye.mult(-1),0,0,X)}else if(Lt==="bevel"||Lt==="fakeround"){const At=-Math.sqrt(ht*ht-1),Ut=Gt?At:0,Rt=Gt?0:At;if(se&&this.addCurrentVertex(ee,ke,Ut,Rt,X),Lt==="fakeround"){const xt=Math.round(180*ut/Math.PI/20);for(let rr=1;rr<xt;rr++){let Jt=rr/xt;if(Jt!==.5){const ti=Jt-.5;Jt+=Jt*ti*(Jt-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*ti*ti+(.848013+Re*(.215638*Re-1.06021)))}const xr=we.sub(ke)._mult(Jt)._add(ke)._unit()._mult(Gt?-1:1);this.addHalfVertex(ee,xr.x,xr.y,!1,Gt,0,X)}}ae&&this.addCurrentVertex(ee,we,-Ut,-Rt,X)}else if(Lt==="butt")this.addCurrentVertex(ee,Ye,0,0,X);else if(Lt==="square"){const At=se?1:-1;this.addCurrentVertex(ee,Ye,At,At,X)}else Lt==="round"&&(se&&(this.addCurrentVertex(ee,ke,0,0,X),this.addCurrentVertex(ee,ke,1,1,X,!0)),ae&&(this.addCurrentVertex(ee,we,-1,-1,X,!0),this.addCurrentVertex(ee,we,0,0,X)));if(jt&&Be<R-1){const At=ee.dist(ae);if(At>2*Z){const Ut=ee.add(ae.sub(ee)._mult(Z/At)._round());this.updateDistance(ee,Ut),this.addCurrentVertex(Ut,we,0,0,X),ee=Ut}}}}addCurrentVertex(t,l,p,y,w,I=!1){const M=l.y*y-l.x,R=-l.y-l.x*y;this.addHalfVertex(t,l.x+l.y*p,l.y-l.x*p,I,!1,p,w),this.addHalfVertex(t,M,R,I,!0,-y,w),this.distance>Kp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,l,p,y,w,I))}addHalfVertex({x:t,y:l},p,y,w,I,M,R){const N=.5*(this.lineClips?this.scaledDistance*(Kp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(w?1:0),(l<<1)+(I?1:0),Math.round(63*p)+128,Math.round(63*y)+128,1+(M===0?0:M<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Z=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Z),R.primitiveLength++),I?this.e2=Z:this.e1=Z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,l){this.distance+=t.dist(l),this.updateScaledDistance()}}qt("LineBucket",tf,{omit:["layers","patternFeatures"]});const rv=new Ri({"line-cap":new Wt(Fe.layout_line["line-cap"]),"line-join":new lr(Fe.layout_line["line-join"]),"line-miter-limit":new Wt(Fe.layout_line["line-miter-limit"]),"line-round-limit":new Wt(Fe.layout_line["line-round-limit"]),"line-sort-key":new lr(Fe.layout_line["line-sort-key"])});var Xp={paint:new Ri({"line-opacity":new lr(Fe.paint_line["line-opacity"]),"line-color":new lr(Fe.paint_line["line-color"]),"line-translate":new Wt(Fe.paint_line["line-translate"]),"line-translate-anchor":new Wt(Fe.paint_line["line-translate-anchor"]),"line-width":new lr(Fe.paint_line["line-width"]),"line-gap-width":new lr(Fe.paint_line["line-gap-width"]),"line-offset":new lr(Fe.paint_line["line-offset"]),"line-blur":new lr(Fe.paint_line["line-blur"]),"line-dasharray":new Cl(Fe.paint_line["line-dasharray"]),"line-pattern":new ia(Fe.paint_line["line-pattern"]),"line-gradient":new ms(Fe.paint_line["line-gradient"])}),layout:rv};const Jp=new class extends lr{possiblyEvaluate(n,t){return t=new ai(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(n,t)}evaluate(n,t,l,p){return t=E({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(n,t,l,p)}}(Xp.paint.properties["line-width"].specification);function Yp(n,t){return t>0?t+2*n:n}Jp.useIntegerZoom=!0;const iv=xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nv=xi([{name:"a_projected_pos",components:3,type:"Float32"}],4);xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const sv=xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);xi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Qp=xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),av=xi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ov(n,t,l){return n.sections.forEach(p=>{p.text=function(y,w,I){const M=w.layout.get("text-transform").evaluate(I,{});return M==="uppercase"?y=y.toLocaleUpperCase():M==="lowercase"&&(y=y.toLocaleLowerCase()),yn.applyArabicShaping&&(y=yn.applyArabicShaping(y)),y}(p.text,t,l)}),n}xi([{name:"triangle",components:3,type:"Uint16"}]),xi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),xi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xi([{type:"Float32",name:"offsetX"}]),xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Vl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Oi=24,rf=Xr,em=function(n,t,l,p,y){var w,I,M=8*y-p-1,R=(1<<M)-1,N=R>>1,Z=-7,X=l?y-1:0,ee=l?-1:1,se=n[t+X];for(X+=ee,w=se&(1<<-Z)-1,se>>=-Z,Z+=M;Z>0;w=256*w+n[t+X],X+=ee,Z-=8);for(I=w&(1<<-Z)-1,w>>=-Z,Z+=p;Z>0;I=256*I+n[t+X],X+=ee,Z-=8);if(w===0)w=1-N;else{if(w===R)return I?NaN:1/0*(se?-1:1);I+=Math.pow(2,p),w-=N}return(se?-1:1)*I*Math.pow(2,w-p)},tm=function(n,t,l,p,y,w){var I,M,R,N=8*w-y-1,Z=(1<<N)-1,X=Z>>1,ee=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,se=p?0:w-1,ae=p?1:-1,ke=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(M=isNaN(t)?1:0,I=Z):(I=Math.floor(Math.log(t)/Math.LN2),t*(R=Math.pow(2,-I))<1&&(I--,R*=2),(t+=I+X>=1?ee/R:ee*Math.pow(2,1-X))*R>=2&&(I++,R/=2),I+X>=Z?(M=0,I=Z):I+X>=1?(M=(t*R-1)*Math.pow(2,y),I+=X):(M=t*Math.pow(2,X-1)*Math.pow(2,y),I=0));y>=8;n[l+se]=255&M,se+=ae,M/=256,y-=8);for(I=I<<y|M,N+=y;N>0;n[l+se]=255&I,se+=ae,I/=256,N-=8);n[l+se-ae]|=128*ke};function Xr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Xr.Varint=0,Xr.Fixed64=1,Xr.Bytes=2,Xr.Fixed32=5;var oa,nf=4294967296,rm=1/nf,im=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ls(n){return n.type===Xr.Bytes?n.readVarint()+n.pos:n.pos+1}function Mo(n,t,l){return l?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function nm(n,t,l){var p=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));l.realloc(p);for(var y=l.pos-1;y>=n;y--)l.buf[y+p]=l.buf[y]}function lv(n,t){for(var l=0;l<n.length;l++)t.writeVarint(n[l])}function cv(n,t){for(var l=0;l<n.length;l++)t.writeSVarint(n[l])}function uv(n,t){for(var l=0;l<n.length;l++)t.writeFloat(n[l])}function hv(n,t){for(var l=0;l<n.length;l++)t.writeDouble(n[l])}function fv(n,t){for(var l=0;l<n.length;l++)t.writeBoolean(n[l])}function dv(n,t){for(var l=0;l<n.length;l++)t.writeFixed32(n[l])}function pv(n,t){for(var l=0;l<n.length;l++)t.writeSFixed32(n[l])}function mv(n,t){for(var l=0;l<n.length;l++)t.writeFixed64(n[l])}function gv(n,t){for(var l=0;l<n.length;l++)t.writeSFixed64(n[l])}function vu(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function zo(n,t,l){n[l]=t,n[l+1]=t>>>8,n[l+2]=t>>>16,n[l+3]=t>>>24}function sm(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}function _v(n,t,l){n===1&&l.readMessage(yv,t)}function yv(n,t,l){if(n===3){const{id:p,bitmap:y,width:w,height:I,left:M,top:R,advance:N}=l.readMessage(vv,{});t.push({id:p,bitmap:new Ll({width:w+6,height:I+6},y),metrics:{width:w,height:I,left:M,top:R,advance:N}})}}function vv(n,t,l){n===1?t.id=l.readVarint():n===2?t.bitmap=l.readBytes():n===3?t.width=l.readVarint():n===4?t.height=l.readVarint():n===5?t.left=l.readSVarint():n===6?t.top=l.readSVarint():n===7&&(t.advance=l.readVarint())}function am(n){let t=0,l=0;for(const I of n)t+=I.w*I.h,l=Math.max(l,I.w);n.sort((I,M)=>M.h-I.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),l),h:1/0}];let y=0,w=0;for(const I of n)for(let M=p.length-1;M>=0;M--){const R=p[M];if(!(I.w>R.w||I.h>R.h)){if(I.x=R.x,I.y=R.y,w=Math.max(w,I.y+I.h),y=Math.max(y,I.x+I.w),I.w===R.w&&I.h===R.h){const N=p.pop();M<p.length&&(p[M]=N)}else I.h===R.h?(R.x+=I.w,R.w-=I.w):I.w===R.w?(R.y+=I.h,R.h-=I.h):(p.push({x:R.x+I.w,y:R.y,w:R.w-I.w,h:I.h}),R.y+=I.h,R.h-=I.h);break}}return{w:y,h:w,fill:t/(y*w)||0}}Xr.prototype={destroy:function(){this.buf=null},readFields:function(n,t,l){for(l=l||this.length;this.pos<l;){var p=this.readVarint(),y=p>>3,w=this.pos;this.type=7&p,n(y,t,this),this.pos===w&&this.skip(p)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=vu(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=sm(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=vu(this.buf,this.pos)+vu(this.buf,this.pos+4)*nf;return this.pos+=8,n},readSFixed64:function(){var n=vu(this.buf,this.pos)+sm(this.buf,this.pos+4)*nf;return this.pos+=8,n},readFloat:function(){var n=em(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=em(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,l,p=this.buf;return t=127&(l=p[this.pos++]),l<128?t:(t|=(127&(l=p[this.pos++]))<<7,l<128?t:(t|=(127&(l=p[this.pos++]))<<14,l<128?t:(t|=(127&(l=p[this.pos++]))<<21,l<128?t:function(y,w,I){var M,R,N=I.buf;if(M=(112&(R=N[I.pos++]))>>4,R<128||(M|=(127&(R=N[I.pos++]))<<3,R<128)||(M|=(127&(R=N[I.pos++]))<<10,R<128)||(M|=(127&(R=N[I.pos++]))<<17,R<128)||(M|=(127&(R=N[I.pos++]))<<24,R<128)||(M|=(1&(R=N[I.pos++]))<<31,R<128))return Mo(y,M,w);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(l=p[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&im?function(l,p,y){return im.decode(l.subarray(p,y))}(this.buf,t,n):function(l,p,y){for(var w="",I=p;I<y;){var M,R,N,Z=l[I],X=null,ee=Z>239?4:Z>223?3:Z>191?2:1;if(I+ee>y)break;ee===1?Z<128&&(X=Z):ee===2?(192&(M=l[I+1]))==128&&(X=(31&Z)<<6|63&M)<=127&&(X=null):ee===3?(R=l[I+2],(192&(M=l[I+1]))==128&&(192&R)==128&&((X=(15&Z)<<12|(63&M)<<6|63&R)<=2047||X>=55296&&X<=57343)&&(X=null)):ee===4&&(R=l[I+2],N=l[I+3],(192&(M=l[I+1]))==128&&(192&R)==128&&(192&N)==128&&((X=(15&Z)<<18|(63&M)<<12|(63&R)<<6|63&N)<=65535||X>=1114112)&&(X=null)),X===null?(X=65533,ee=1):X>65535&&(X-=65536,w+=String.fromCharCode(X>>>10&1023|55296),X=56320|1023&X),w+=String.fromCharCode(X),I+=ee}return w}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==Xr.Bytes)return n.push(this.readVarint(t));var l=Ls(this);for(n=n||[];this.pos<l;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==Xr.Bytes)return n.push(this.readSVarint());var t=Ls(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Xr.Bytes)return n.push(this.readBoolean());var t=Ls(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Xr.Bytes)return n.push(this.readFloat());var t=Ls(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Xr.Bytes)return n.push(this.readDouble());var t=Ls(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Xr.Bytes)return n.push(this.readFixed32());var t=Ls(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Xr.Bytes)return n.push(this.readSFixed32());var t=Ls(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Xr.Bytes)return n.push(this.readFixed64());var t=Ls(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Xr.Bytes)return n.push(this.readSFixed64());var t=Ls(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===Xr.Varint)for(;this.buf[this.pos++]>127;);else if(t===Xr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Xr.Fixed32)this.pos+=4;else{if(t!==Xr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var l=new Uint8Array(t);l.set(this.buf),this.buf=l,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),zo(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),zo(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),zo(this.buf,-1&n,this.pos),zo(this.buf,Math.floor(n*rm),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),zo(this.buf,-1&n,this.pos),zo(this.buf,Math.floor(n*rm),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,l){var p,y;if(t>=0?(p=t%4294967296|0,y=t/4294967296|0):(y=~(-t/4294967296),4294967295^(p=~(-t%4294967296))?p=p+1|0:(p=0,y=y+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(w,I,M){M.buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,M.buf[M.pos]=127&(w>>>=7)}(p,0,l),function(w,I){var M=(7&w)<<4;I.buf[I.pos++]|=M|((w>>>=3)?128:0),w&&(I.buf[I.pos++]=127&w|((w>>>=7)?128:0),w&&(I.buf[I.pos++]=127&w|((w>>>=7)?128:0),w&&(I.buf[I.pos++]=127&w|((w>>>=7)?128:0),w&&(I.buf[I.pos++]=127&w|((w>>>=7)?128:0),w&&(I.buf[I.pos++]=127&w)))))}(y,l)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(p,y,w){for(var I,M,R=0;R<y.length;R++){if((I=y.charCodeAt(R))>55295&&I<57344){if(!M){I>56319||R+1===y.length?(p[w++]=239,p[w++]=191,p[w++]=189):M=I;continue}if(I<56320){p[w++]=239,p[w++]=191,p[w++]=189,M=I;continue}I=M-55296<<10|I-56320|65536,M=null}else M&&(p[w++]=239,p[w++]=191,p[w++]=189,M=null);I<128?p[w++]=I:(I<2048?p[w++]=I>>6|192:(I<65536?p[w++]=I>>12|224:(p[w++]=I>>18|240,p[w++]=I>>12&63|128),p[w++]=I>>6&63|128),p[w++]=63&I|128)}return w}(this.buf,n,this.pos);var l=this.pos-t;l>=128&&nm(t,l,this),this.pos=t-1,this.writeVarint(l),this.pos+=l},writeFloat:function(n){this.realloc(4),tm(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),tm(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var l=0;l<t;l++)this.buf[this.pos++]=n[l]},writeRawMessage:function(n,t){this.pos++;var l=this.pos;n(t,this);var p=this.pos-l;p>=128&&nm(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p},writeMessage:function(n,t,l){this.writeTag(n,Xr.Bytes),this.writeRawMessage(t,l)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,lv,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,cv,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,fv,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,uv,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,hv,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,dv,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,pv,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,mv,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,gv,t)},writeBytesField:function(n,t){this.writeTag(n,Xr.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,Xr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,Xr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,Xr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,Xr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,Xr.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,Xr.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,Xr.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,Xr.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,Xr.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};class sf{constructor(t,{pixelRatio:l,version:p,stretchX:y,stretchY:w,content:I}){this.paddedRect=t,this.pixelRatio=l,this.stretchX=y,this.stretchY=w,this.content=I,this.version=p}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class om{constructor(t,l){const p={},y={};this.haveRenderCallbacks=[];const w=[];this.addImages(t,p,w),this.addImages(l,y,w);const{w:I,h:M}=am(w),R=new Tn({width:I||1,height:M||1});for(const N in t){const Z=t[N],X=p[N].paddedRect;Tn.copy(Z.data,R,{x:0,y:0},{x:X.x+1,y:X.y+1},Z.data)}for(const N in l){const Z=l[N],X=y[N].paddedRect,ee=X.x+1,se=X.y+1,ae=Z.data.width,ke=Z.data.height;Tn.copy(Z.data,R,{x:0,y:0},{x:ee,y:se},Z.data),Tn.copy(Z.data,R,{x:0,y:ke-1},{x:ee,y:se-1},{width:ae,height:1}),Tn.copy(Z.data,R,{x:0,y:0},{x:ee,y:se+ke},{width:ae,height:1}),Tn.copy(Z.data,R,{x:ae-1,y:0},{x:ee-1,y:se},{width:1,height:ke}),Tn.copy(Z.data,R,{x:0,y:0},{x:ee+ae,y:se},{width:1,height:ke})}this.image=R,this.iconPositions=p,this.patternPositions=y}addImages(t,l,p){for(const y in t){const w=t[y],I={x:0,y:0,w:w.data.width+2,h:w.data.height+2};p.push(I),l[y]=new sf(I,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(t,l){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in t.updatedImages)this.patchUpdatedImage(this.iconPositions[p],t.getImage(p),l),this.patchUpdatedImage(this.patternPositions[p],t.getImage(p),l)}patchUpdatedImage(t,l,p){if(!t||!l||t.version===l.version)return;t.version=l.version;const[y,w]=t.tl;p.update(l.data,void 0,{x:y,y:w})}}qt("ImagePosition",sf),qt("ImageAtlas",om),i.WritingMode=void 0,(oa=i.WritingMode||(i.WritingMode={}))[oa.none=0]="none",oa[oa.horizontal=1]="horizontal",oa[oa.vertical=2]="vertical",oa[oa.horizontalOnly=3]="horizontalOnly";const bu=-17;class $l{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,l){const p=new $l;return p.scale=t||1,p.fontStack=l,p}static forImage(t){const l=new $l;return l.imageName=t,l}}class Do{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,l){const p=new Do;for(let y=0;y<t.sections.length;y++){const w=t.sections[y];w.image?p.addImageSection(w):p.addTextSection(w,l)}return p}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let l="";for(let p=0;p<t.length;p++){const y=t.charCodeAt(p+1)||null,w=t.charCodeAt(p-1)||null;l+=y&&eu(y)&&!Vl[t[p+1]]||w&&eu(w)&&!Vl[t[p-1]]||!Vl[t[p]]?t[p]:Vl[t[p]]}return l}(this.text)}trim(){let t=0;for(let p=0;p<this.text.length&&wu[this.text.charCodeAt(p)];p++)t++;let l=this.text.length;for(let p=this.text.length-1;p>=0&&p>=t&&wu[this.text.charCodeAt(p)];p--)l--;this.text=this.text.substring(t,l),this.sectionIndex=this.sectionIndex.slice(t,l)}substring(t,l){const p=new Do;return p.text=this.text.substring(t,l),p.sectionIndex=this.sectionIndex.slice(t,l),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,l)=>Math.max(t,this.sections[l].scale),0)}addTextSection(t,l){this.text+=t.text,this.sections.push($l.forText(t.scale,t.fontStack||l));const p=this.sections.length-1;for(let y=0;y<t.text.length;++y)this.sectionIndex.push(p)}addImageSection(t){const l=t.image?t.image.name:"";if(l.length===0)return void q("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push($l.forImage(l)),this.sectionIndex.push(this.sections.length-1)):q("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xu(n,t,l,p,y,w,I,M,R,N,Z,X,ee,se,ae,ke){const we=Do.fromFeature(n,y);let Be;X===i.WritingMode.vertical&&we.verticalizePunctuation();const{processBidirectionalText:Ye,processStyledBidirectionalText:Re}=yn;if(Ye&&we.sections.length===1){Be=[];const ut=Ye(we.toString(),af(we,N,w,t,p,se,ae));for(const jt of ut){const Gt=new Do;Gt.text=jt,Gt.sections=we.sections;for(let Ft=0;Ft<jt.length;Ft++)Gt.sectionIndex.push(0);Be.push(Gt)}}else if(Re){Be=[];const ut=Re(we.text,we.sectionIndex,af(we,N,w,t,p,se,ae));for(const jt of ut){const Gt=new Do;Gt.text=jt[0],Gt.sectionIndex=jt[1],Gt.sections=we.sections,Be.push(Gt)}}else Be=function(ut,jt){const Gt=[],Ft=ut.text;let Lt=0;for(const At of jt)Gt.push(ut.substring(Lt,At)),Lt=At;return Lt<Ft.length&&Gt.push(ut.substring(Lt,Ft.length)),Gt}(we,af(we,N,w,t,p,se,ae));const We=[],ht={positionedLines:We,text:we.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:X,iconsInText:!1,verticalizable:!1};return function(ut,jt,Gt,Ft,Lt,At,Ut,Rt,xt,rr,Jt,xr){let ti=0,li=bu,Ci=0,In=0;const ji=Rt==="right"?1:Rt==="left"?0:.5;let wi=0;for(const Si of Lt){Si.trim();const Gi=Si.getMaxScale(),Wi=(Gi-1)*Oi,rn={positionedGlyphs:[],lineOffset:0};ut.positionedLines[wi]=rn;const un=rn.positionedGlyphs;let hn=0;if(!Si.length()){li+=At,++wi;continue}for(let Di=0;Di<Si.length();Di++){const Tr=Si.getSection(Di),xn=Si.getSectionIndex(Di),Zi=Si.getCharCode(Di);let Ki=0,Bn=null,Yn=null,Qn=null,Os=Oi;const Nn=!(xt===i.WritingMode.horizontal||!Jt&&!xl(Zi)||Jt&&(wu[Zi]||(zi=Zi,Nt.Arabic(zi)||Nt["Arabic Supplement"](zi)||Nt["Arabic Extended-A"](zi)||Nt["Arabic Presentation Forms-A"](zi)||Nt["Arabic Presentation Forms-B"](zi))));if(Tr.imageName){const An=Ft[Tr.imageName];if(!An)continue;Qn=Tr.imageName,ut.iconsInText=ut.iconsInText||!0,Yn=An.paddedRect;const fn=An.displaySize;Tr.scale=Tr.scale*Oi/xr,Bn={width:fn[0],height:fn[1],left:1,top:-3,advance:Nn?fn[1]:fn[0]},Ki=Wi+(Oi-fn[1]*Tr.scale),Os=Bn.advance;const Bs=Nn?fn[0]*Tr.scale-Oi*Gi:fn[1]*Tr.scale-Oi*Gi;Bs>0&&Bs>hn&&(hn=Bs)}else{const An=Gt[Tr.fontStack],fn=An&&An[Zi];if(fn&&fn.rect)Yn=fn.rect,Bn=fn.metrics;else{const Bs=jt[Tr.fontStack],Gl=Bs&&Bs[Zi];if(!Gl)continue;Bn=Gl.metrics}Ki=(Gi-Tr.scale)*Oi}Nn?(ut.verticalizable=!0,un.push({glyph:Zi,imageName:Qn,x:ti,y:li+Ki,vertical:Nn,scale:Tr.scale,fontStack:Tr.fontStack,sectionIndex:xn,metrics:Bn,rect:Yn}),ti+=Os*Tr.scale+rr):(un.push({glyph:Zi,imageName:Qn,x:ti,y:li+Ki,vertical:Nn,scale:Tr.scale,fontStack:Tr.fontStack,sectionIndex:xn,metrics:Bn,rect:Yn}),ti+=Bn.advance*Tr.scale+rr)}un.length!==0&&(Ci=Math.max(ti-rr,Ci),wv(un,0,un.length-1,ji,hn)),ti=0;const ci=At*Gi+hn;rn.lineOffset=Math.max(hn,Wi),li+=ci,In=Math.max(ci,In),++wi}var zi;const qi=li-bu,{horizontalAlign:Hi,verticalAlign:cn}=of(Ut);(function(Si,Gi,Wi,rn,un,hn,ci,Di,Tr){const xn=(Gi-Wi)*un;let Zi=0;Zi=hn!==ci?-Di*rn-bu:(-rn*Tr+.5)*ci;for(const Ki of Si)for(const Bn of Ki.positionedGlyphs)Bn.x+=xn,Bn.y+=Zi})(ut.positionedLines,ji,Hi,cn,Ci,In,At,qi,Lt.length),ut.top+=-cn*qi,ut.bottom=ut.top+qi,ut.left+=-Hi*Ci,ut.right=ut.left+Ci}(ht,t,l,p,Be,I,M,R,X,N,ee,ke),!function(ut){for(const jt of ut)if(jt.positionedGlyphs.length!==0)return!1;return!0}(We)&&ht}const wu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function lm(n,t,l,p,y,w){if(t.imageName){const I=p[t.imageName];return I?I.displaySize[0]*t.scale*Oi/w+y:0}{const I=l[t.fontStack],M=I&&I[n];return M?M.metrics.advance*t.scale+y:0}}function cm(n,t,l,p){const y=Math.pow(n-t,2);return p?n<t?y/2:2*y:y+Math.abs(l)*l}function xv(n,t,l){let p=0;return n===10&&(p-=1e4),l&&(p+=150),n!==40&&n!==65288||(p+=50),t!==41&&t!==65289||(p+=50),p}function um(n,t,l,p,y,w){let I=null,M=cm(t,l,y,w);for(const R of p){const N=cm(t-R.x,l,y,w)+R.badness;N<=M&&(I=R,M=N)}return{index:n,x:t,priorBreak:I,badness:M}}function hm(n){return n?hm(n.priorBreak).concat(n.index):[]}function af(n,t,l,p,y,w,I){if(w!=="point")return[];if(!n)return[];const M=[],R=function(ee,se,ae,ke,we,Be){let Ye=0;for(let Re=0;Re<ee.length();Re++){const We=ee.getSection(Re);Ye+=lm(ee.getCharCode(Re),We,ke,we,se,Be)}return Ye/Math.max(1,Math.ceil(Ye/ae))}(n,t,l,p,y,I),N=n.text.indexOf("")>=0;let Z=0;for(let ee=0;ee<n.length();ee++){const se=n.getSection(ee),ae=n.getCharCode(ee);if(wu[ae]||(Z+=lm(ae,se,p,y,t,I)),ee<n.length()-1){const ke=!((X=ae)<11904||!(Nt["Bopomofo Extended"](X)||Nt.Bopomofo(X)||Nt["CJK Compatibility Forms"](X)||Nt["CJK Compatibility Ideographs"](X)||Nt["CJK Compatibility"](X)||Nt["CJK Radicals Supplement"](X)||Nt["CJK Strokes"](X)||Nt["CJK Symbols and Punctuation"](X)||Nt["CJK Unified Ideographs Extension A"](X)||Nt["CJK Unified Ideographs"](X)||Nt["Enclosed CJK Letters and Months"](X)||Nt["Halfwidth and Fullwidth Forms"](X)||Nt.Hiragana(X)||Nt["Ideographic Description Characters"](X)||Nt["Kangxi Radicals"](X)||Nt["Katakana Phonetic Extensions"](X)||Nt.Katakana(X)||Nt["Vertical Forms"](X)||Nt["Yi Radicals"](X)||Nt["Yi Syllables"](X)));(bv[ae]||ke||se.imageName)&&M.push(um(ee+1,Z,R,M,xv(ae,n.getCharCode(ee+1),ke&&N),!1))}}var X;return hm(um(n.length(),Z,R,M,0,!0))}function of(n){let t=.5,l=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:t,verticalAlign:l}}function wv(n,t,l,p,y){if(!p&&!y)return;const w=n[l],I=(n[l].x+w.metrics.advance*w.scale)*p;for(let M=t;M<=l;M++)n[M].x-=I,n[M].y+=y}function Sv(n,t,l){const{horizontalAlign:p,verticalAlign:y}=of(l),w=t[0]-n.displaySize[0]*p,I=t[1]-n.displaySize[1]*y;return{image:n,top:I,bottom:I+n.displaySize[1],left:w,right:w+n.displaySize[0]}}function fm(n,t,l,p,y,w){const I=n.image;let M;if(I.content){const we=I.content,Be=I.pixelRatio||1;M=[we[0]/Be,we[1]/Be,I.displaySize[0]-we[2]/Be,I.displaySize[1]-we[3]/Be]}const R=t.left*w,N=t.right*w;let Z,X,ee,se;l==="width"||l==="both"?(se=y[0]+R-p[3],X=y[0]+N+p[1]):(se=y[0]+(R+N-I.displaySize[0])/2,X=se+I.displaySize[0]);const ae=t.top*w,ke=t.bottom*w;return l==="height"||l==="both"?(Z=y[1]+ae-p[0],ee=y[1]+ke+p[2]):(Z=y[1]+(ae+ke-I.displaySize[1])/2,ee=Z+I.displaySize[1]),{image:I,top:Z,right:X,bottom:ee,left:se,collisionPadding:M}}const Rs=128;function dm(n,t){const{expression:l}=t;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ai(n+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:y}=l;let w=0;for(;w<p.length&&p[w]<=n;)w++;w=Math.max(0,w-1);let I=w;for(;I<p.length&&p[I]<n+1;)I++;I=Math.min(p.length-1,I);const M=p[w],R=p[I];return l.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:R,interpolationType:y}:{kind:"camera",minZoom:M,maxZoom:R,minSize:l.evaluate(new ai(M)),maxSize:l.evaluate(new ai(R)),interpolationType:y}}}class la extends pt{constructor(t,l,p,y){super(t,l),this.angle=p,y!==void 0&&(this.segment=y)}clone(){return new la(this.x,this.y,this.angle,this.segment)}}function pm(n,t,l,p,y){if(t.segment===void 0)return!0;let w=t,I=t.segment+1,M=0;for(;M>-l/2;){if(I--,I<0)return!1;M-=n[I].dist(w),w=n[I]}M+=n[I].dist(n[I+1]),I++;const R=[];let N=0;for(;M<l/2;){const Z=n[I],X=n[I+1];if(!X)return!1;let ee=n[I-1].angleTo(Z)-Z.angleTo(X);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:M,angleDelta:ee}),N+=ee;M-R[0].distance>p;)N-=R.shift().angleDelta;if(N>y)return!1;I++,M+=Z.dist(X)}return!0}function mm(n){let t=0;for(let l=0;l<n.length-1;l++)t+=n[l].dist(n[l+1]);return t}function gm(n,t,l){return n?.6*t*l:0}function _m(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function kv(n,t,l,p,y,w){const I=gm(l,y,w),M=_m(l,p)*w;let R=0;const N=mm(n)/2;for(let Z=0;Z<n.length-1;Z++){const X=n[Z],ee=n[Z+1],se=X.dist(ee);if(R+se>N){const ae=(N-R)/se,ke=ni(X.x,ee.x,ae),we=ni(X.y,ee.y,ae),Be=new la(ke,we,ee.angleTo(X),Z);return Be._round(),!I||pm(n,Be,M,I,t)?Be:void 0}R+=se}}function Ev(n,t,l,p,y,w,I,M,R){const N=gm(p,w,I),Z=_m(p,y),X=Z*I,ee=n[0].x===0||n[0].x===R||n[0].y===0||n[0].y===R;return t-X<t/4&&(t=X+t/4),ym(n,ee?t/2*M%t:(Z/2+2*w)*I*M%t,t,N,l,X,ee,!1,R)}function ym(n,t,l,p,y,w,I,M,R){const N=w/2,Z=mm(n);let X=0,ee=t-l,se=[];for(let ae=0;ae<n.length-1;ae++){const ke=n[ae],we=n[ae+1],Be=ke.dist(we),Ye=we.angleTo(ke);for(;ee+l<X+Be;){ee+=l;const Re=(ee-X)/Be,We=ni(ke.x,we.x,Re),ht=ni(ke.y,we.y,Re);if(We>=0&&We<R&&ht>=0&&ht<R&&ee-N>=0&&ee+N<=Z){const ut=new la(We,ht,Ye,ae);ut._round(),p&&!pm(n,ut,w,p,y)||se.push(ut)}}X+=Be}return M||se.length||I||(se=ym(n,X/2,l,p,y,w,I,!0,R)),se}function vm(n,t,l,p,y){const w=[];for(let I=0;I<n.length;I++){const M=n[I];let R;for(let N=0;N<M.length-1;N++){let Z=M[N],X=M[N+1];Z.x<t&&X.x<t||(Z.x<t?Z=new pt(t,Z.y+(t-Z.x)/(X.x-Z.x)*(X.y-Z.y))._round():X.x<t&&(X=new pt(t,Z.y+(t-Z.x)/(X.x-Z.x)*(X.y-Z.y))._round()),Z.y<l&&X.y<l||(Z.y<l?Z=new pt(Z.x+(l-Z.y)/(X.y-Z.y)*(X.x-Z.x),l)._round():X.y<l&&(X=new pt(Z.x+(l-Z.y)/(X.y-Z.y)*(X.x-Z.x),l)._round()),Z.x>=p&&X.x>=p||(Z.x>=p?Z=new pt(p,Z.y+(p-Z.x)/(X.x-Z.x)*(X.y-Z.y))._round():X.x>=p&&(X=new pt(p,Z.y+(p-Z.x)/(X.x-Z.x)*(X.y-Z.y))._round()),Z.y>=y&&X.y>=y||(Z.y>=y?Z=new pt(Z.x+(y-Z.y)/(X.y-Z.y)*(X.x-Z.x),y)._round():X.y>=y&&(X=new pt(Z.x+(y-Z.y)/(X.y-Z.y)*(X.x-Z.x),y)._round()),R&&Z.equals(R[R.length-1])||(R=[Z],w.push(R)),R.push(X)))))}}return w}function bm(n,t,l,p){const y=[],w=n.image,I=w.pixelRatio,M=w.paddedRect.w-2,R=w.paddedRect.h-2,N=n.right-n.left,Z=n.bottom-n.top,X=w.stretchX||[[0,M]],ee=w.stretchY||[[0,R]],se=(At,Ut)=>At+Ut[1]-Ut[0],ae=X.reduce(se,0),ke=ee.reduce(se,0),we=M-ae,Be=R-ke;let Ye=0,Re=ae,We=0,ht=ke,ut=0,jt=we,Gt=0,Ft=Be;if(w.content&&p){const At=w.content;Ye=Su(X,0,At[0]),We=Su(ee,0,At[1]),Re=Su(X,At[0],At[2]),ht=Su(ee,At[1],At[3]),ut=At[0]-Ye,Gt=At[1]-We,jt=At[2]-At[0]-Re,Ft=At[3]-At[1]-ht}const Lt=(At,Ut,Rt,xt)=>{const rr=ku(At.stretch-Ye,Re,N,n.left),Jt=Eu(At.fixed-ut,jt,At.stretch,ae),xr=ku(Ut.stretch-We,ht,Z,n.top),ti=Eu(Ut.fixed-Gt,Ft,Ut.stretch,ke),li=ku(Rt.stretch-Ye,Re,N,n.left),Ci=Eu(Rt.fixed-ut,jt,Rt.stretch,ae),In=ku(xt.stretch-We,ht,Z,n.top),ji=Eu(xt.fixed-Gt,Ft,xt.stretch,ke),wi=new pt(rr,xr),zi=new pt(li,xr),qi=new pt(li,In),Hi=new pt(rr,In),cn=new pt(Jt/I,ti/I),Si=new pt(Ci/I,ji/I),Gi=t*Math.PI/180;if(Gi){const un=Math.sin(Gi),hn=Math.cos(Gi),ci=[hn,-un,un,hn];wi._matMult(ci),zi._matMult(ci),Hi._matMult(ci),qi._matMult(ci)}const Wi=At.stretch+At.fixed,rn=Ut.stretch+Ut.fixed;return{tl:wi,tr:zi,bl:Hi,br:qi,tex:{x:w.paddedRect.x+1+Wi,y:w.paddedRect.y+1+rn,w:Rt.stretch+Rt.fixed-Wi,h:xt.stretch+xt.fixed-rn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cn,pixelOffsetBR:Si,minFontScaleX:jt/I/N,minFontScaleY:Ft/I/Z,isSDF:l}};if(p&&(w.stretchX||w.stretchY)){const At=xm(X,we,ae),Ut=xm(ee,Be,ke);for(let Rt=0;Rt<At.length-1;Rt++){const xt=At[Rt],rr=At[Rt+1];for(let Jt=0;Jt<Ut.length-1;Jt++)y.push(Lt(xt,Ut[Jt],rr,Ut[Jt+1]))}}else y.push(Lt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:R+1}));return y}function Su(n,t,l){let p=0;for(const y of n)p+=Math.max(t,Math.min(l,y[1]))-Math.max(t,Math.min(l,y[0]));return p}function xm(n,t,l){const p=[{fixed:-1,stretch:0}];for(const[y,w]of n){const I=p[p.length-1];p.push({fixed:y-I.stretch,stretch:I.stretch}),p.push({fixed:y-I.stretch,stretch:I.stretch+(w-y)})}return p.push({fixed:t+1,stretch:l}),p}function ku(n,t,l,p){return n/t*l+p}function Eu(n,t,l,p){return n-t*l/p}qt("Anchor",la);class Tu{constructor(t,l,p,y,w,I,M,R,N,Z){if(this.boxStartIndex=t.length,N){let X=I.top,ee=I.bottom;const se=I.collisionPadding;se&&(X-=se[1],ee+=se[3]);let ae=ee-X;ae>0&&(ae=Math.max(10,ae),this.circleDiameter=ae)}else{let X=I.top*M-R[0],ee=I.bottom*M+R[2],se=I.left*M-R[3],ae=I.right*M+R[1];const ke=I.collisionPadding;if(ke&&(se-=ke[0]*M,X-=ke[1]*M,ae+=ke[2]*M,ee+=ke[3]*M),Z){const we=new pt(se,X),Be=new pt(ae,X),Ye=new pt(se,ee),Re=new pt(ae,ee),We=Z*Math.PI/180;we._rotate(We),Be._rotate(We),Ye._rotate(We),Re._rotate(We),se=Math.min(we.x,Be.x,Ye.x,Re.x),ae=Math.max(we.x,Be.x,Ye.x,Re.x),X=Math.min(we.y,Be.y,Ye.y,Re.y),ee=Math.max(we.y,Be.y,Ye.y,Re.y)}t.emplaceBack(l.x,l.y,se,X,ae,ee,p,y,w)}this.boxEndIndex=t.length}}class Tv{constructor(t=[],l=Cv){if(this.data=t,this.length=this.data.length,this.compare=l,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:l,compare:p}=this,y=l[t];for(;t>0;){const w=t-1>>1,I=l[w];if(p(y,I)>=0)break;l[t]=I,t=w}l[t]=y}_down(t){const{data:l,compare:p}=this,y=this.length>>1,w=l[t];for(;t<y;){let I=1+(t<<1),M=l[I];const R=I+1;if(R<this.length&&p(l[R],M)<0&&(I=R,M=l[R]),p(M,w)>=0)break;l[t]=M,t=I}l[t]=w}}function Cv(n,t){return n<t?-1:n>t?1:0}function Iv(n,t=1,l=!1){let p=1/0,y=1/0,w=-1/0,I=-1/0;const M=n[0];for(let se=0;se<M.length;se++){const ae=M[se];(!se||ae.x<p)&&(p=ae.x),(!se||ae.y<y)&&(y=ae.y),(!se||ae.x>w)&&(w=ae.x),(!se||ae.y>I)&&(I=ae.y)}const R=Math.min(w-p,I-y);let N=R/2;const Z=new Tv([],Av);if(R===0)return new pt(p,y);for(let se=p;se<w;se+=R)for(let ae=y;ae<I;ae+=R)Z.push(new Lo(se+N,ae+N,N,n));let X=function(se){let ae=0,ke=0,we=0;const Be=se[0];for(let Ye=0,Re=Be.length,We=Re-1;Ye<Re;We=Ye++){const ht=Be[Ye],ut=Be[We],jt=ht.x*ut.y-ut.x*ht.y;ke+=(ht.x+ut.x)*jt,we+=(ht.y+ut.y)*jt,ae+=3*jt}return new Lo(ke/ae,we/ae,0,se)}(n),ee=Z.length;for(;Z.length;){const se=Z.pop();(se.d>X.d||!X.d)&&(X=se,l&&console.log("found best %d after %d probes",Math.round(1e4*se.d)/1e4,ee)),se.max-X.d<=t||(N=se.h/2,Z.push(new Lo(se.p.x-N,se.p.y-N,N,n)),Z.push(new Lo(se.p.x+N,se.p.y-N,N,n)),Z.push(new Lo(se.p.x-N,se.p.y+N,N,n)),Z.push(new Lo(se.p.x+N,se.p.y+N,N,n)),ee+=4)}return l&&(console.log(`num probes: ${ee}`),console.log(`best distance: ${X.d}`)),X.p}function Av(n,t){return t.max-n.max}function Lo(n,t,l,p){this.p=new pt(n,t),this.h=l,this.d=function(y,w){let I=!1,M=1/0;for(let R=0;R<w.length;R++){const N=w[R];for(let Z=0,X=N.length,ee=X-1;Z<X;ee=Z++){const se=N[Z],ae=N[ee];se.y>y.y!=ae.y>y.y&&y.x<(ae.x-se.x)*(y.y-se.y)/(ae.y-se.y)+se.x&&(I=!I),M=Math.min(M,Ap(y,se,ae))}}return(I?1:-1)*Math.sqrt(M)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}const lf=Number.POSITIVE_INFINITY;function wm(n,t){return t[1]!==lf?function(l,p,y){let w=0,I=0;switch(p=Math.abs(p),y=Math.abs(y),l){case"top-right":case"top-left":case"top":I=y-7;break;case"bottom-right":case"bottom-left":case"bottom":I=7-y}switch(l){case"top-right":case"bottom-right":case"right":w=-p;break;case"top-left":case"bottom-left":case"left":w=p}return[w,I]}(n,t[0],t[1]):function(l,p){let y=0,w=0;p<0&&(p=0);const I=p/Math.sqrt(2);switch(l){case"top-right":case"top-left":w=I-7;break;case"bottom-right":case"bottom-left":w=7-I;break;case"bottom":w=7-p;break;case"top":w=p-7}switch(l){case"top-right":case"bottom-right":y=-I;break;case"top-left":case"bottom-left":y=I;break;case"left":y=p;break;case"right":y=-p}return[y,w]}(n,t[0])}function cf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pv(n,t,l,p,y,w,I,M,R,N,Z){let X=w.textMaxSize.evaluate(t,{});X===void 0&&(X=I);const ee=n.layers[0].layout,se=ee.get("icon-offset").evaluate(t,{},Z),ae=km(l.horizontal),ke=I/24,we=n.tilePixelRatio*ke,Be=n.tilePixelRatio*X/24,Ye=n.tilePixelRatio*M,Re=n.tilePixelRatio*ee.get("symbol-spacing"),We=ee.get("text-padding")*n.tilePixelRatio,ht=function(xt,rr,Jt,xr=1){const ti=xt.get("icon-padding").evaluate(rr,{},Jt),li=ti&&ti.values;return[li[0]*xr,li[1]*xr,li[2]*xr,li[3]*xr]}(ee,t,Z,n.tilePixelRatio),ut=ee.get("text-max-angle")/180*Math.PI,jt=ee.get("text-rotation-alignment")!=="viewport"&&ee.get("symbol-placement")!=="point",Gt=ee.get("icon-rotation-alignment")==="map"&&ee.get("symbol-placement")!=="point",Ft=ee.get("symbol-placement"),Lt=Re/2,At=ee.get("icon-text-fit");let Ut;p&&At!=="none"&&(n.allowVerticalPlacement&&l.vertical&&(Ut=fm(p,l.vertical,At,ee.get("icon-text-fit-padding"),se,ke)),ae&&(p=fm(p,ae,At,ee.get("icon-text-fit-padding"),se,ke)));const Rt=(xt,rr)=>{rr.x<0||rr.x>=Ti||rr.y<0||rr.y>=Ti||function(Jt,xr,ti,li,Ci,In,ji,wi,zi,qi,Hi,cn,Si,Gi,Wi,rn,un,hn,ci,Di,Tr,xn,Zi,Ki,Bn){const Yn=Jt.addToLineVertexArray(xr,ti);let Qn,Os,Nn,An,fn=0,Bs=0,Gl=0,Um=0,vf=-1,bf=-1;const Ns={};let Vm=Mi.exports(""),xf=0,wf=0;if(wi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[xf,wf]=wi.layout.get("text-offset").evaluate(Tr,{},Ki).map(dn=>dn*Oi):(xf=wi.layout.get("text-radial-offset").evaluate(Tr,{},Ki)*Oi,wf=lf),Jt.allowVerticalPlacement&&li.vertical){const dn=wi.layout.get("text-rotate").evaluate(Tr,{},Ki)+90;Nn=new Tu(zi,xr,qi,Hi,cn,li.vertical,Si,Gi,Wi,dn),ji&&(An=new Tu(zi,xr,qi,Hi,cn,ji,un,hn,Wi,dn))}if(Ci){const dn=wi.layout.get("icon-rotate").evaluate(Tr,{}),bs=wi.layout.get("icon-text-fit")!=="none",Zl=bm(Ci,dn,Zi,bs),Hl=ji?bm(ji,dn,Zi,bs):void 0;Os=new Tu(zi,xr,qi,Hi,cn,Ci,un,hn,!1,dn),fn=4*Zl.length;const qm=Jt.iconSizeData;let Ha=null;qm.kind==="source"?(Ha=[Rs*wi.layout.get("icon-size").evaluate(Tr,{})],Ha[0]>ca&&q(`${Jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):qm.kind==="composite"&&(Ha=[Rs*xn.compositeIconSizes[0].evaluate(Tr,{},Ki),Rs*xn.compositeIconSizes[1].evaluate(Tr,{},Ki)],(Ha[0]>ca||Ha[1]>ca)&&q(`${Jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,Zl,Ha,Di,ci,Tr,i.WritingMode.none,xr,Yn.lineStartIndex,Yn.lineLength,-1,Ki),vf=Jt.icon.placedSymbolArray.length-1,Hl&&(Bs=4*Hl.length,Jt.addSymbols(Jt.icon,Hl,Ha,Di,ci,Tr,i.WritingMode.vertical,xr,Yn.lineStartIndex,Yn.lineLength,-1,Ki),bf=Jt.icon.placedSymbolArray.length-1)}const $m=Object.keys(li.horizontal);for(const dn of $m){const bs=li.horizontal[dn];if(!Qn){Vm=Mi.exports(bs.text);const Hl=wi.layout.get("text-rotate").evaluate(Tr,{},Ki);Qn=new Tu(zi,xr,qi,Hi,cn,bs,Si,Gi,Wi,Hl)}const Zl=bs.positionedLines.length===1;if(Gl+=Sm(Jt,xr,bs,In,wi,Wi,Tr,rn,Yn,li.vertical?i.WritingMode.horizontal:i.WritingMode.horizontalOnly,Zl?$m:[dn],Ns,vf,xn,Ki),Zl)break}li.vertical&&(Um+=Sm(Jt,xr,li.vertical,In,wi,Wi,Tr,rn,Yn,i.WritingMode.vertical,["vertical"],Ns,bf,xn,Ki));const jv=Qn?Qn.boxStartIndex:Jt.collisionBoxArray.length,qv=Qn?Qn.boxEndIndex:Jt.collisionBoxArray.length,Gv=Nn?Nn.boxStartIndex:Jt.collisionBoxArray.length,Zv=Nn?Nn.boxEndIndex:Jt.collisionBoxArray.length,Hv=Os?Os.boxStartIndex:Jt.collisionBoxArray.length,Wv=Os?Os.boxEndIndex:Jt.collisionBoxArray.length,Kv=An?An.boxStartIndex:Jt.collisionBoxArray.length,Xv=An?An.boxEndIndex:Jt.collisionBoxArray.length;let es=-1;const Mu=(dn,bs)=>dn&&dn.circleDiameter?Math.max(dn.circleDiameter,bs):bs;es=Mu(Qn,es),es=Mu(Nn,es),es=Mu(Os,es),es=Mu(An,es);const jm=es>-1?1:0;jm&&(es*=Bn/Oi),Jt.glyphOffsetArray.length>=Ro.MAX_GLYPHS&&q("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tr.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,Tr.sortKey),Jt.symbolInstances.emplaceBack(xr.x,xr.y,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical||-1,vf,bf,Vm,jv,qv,Gv,Zv,Hv,Wv,Kv,Xv,qi,Gl,Um,fn,Bs,jm,0,Si,xf,wf,es)}(n,rr,xt,l,p,y,Ut,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,we,[We,We,We,We],jt,R,Ye,ht,Gt,se,t,w,N,Z,I)};if(Ft==="line")for(const xt of vm(t.geometry,0,0,Ti,Ti)){const rr=Ev(xt,Re,ut,l.vertical||ae,p,24,Be,n.overscaling,Ti);for(const Jt of rr){const xr=ae;xr&&Mv(n,xr.text,Lt,Jt)||Rt(xt,Jt)}}else if(Ft==="line-center"){for(const xt of t.geometry)if(xt.length>1){const rr=kv(xt,ut,l.vertical||ae,p,24,Be);rr&&Rt(xt,rr)}}else if(t.type==="Polygon")for(const xt of Kh(t.geometry,0)){const rr=Iv(xt,16);Rt(xt[0],new la(rr.x,rr.y,0))}else if(t.type==="LineString")for(const xt of t.geometry)Rt(xt,new la(xt[0].x,xt[0].y,0));else if(t.type==="Point")for(const xt of t.geometry)for(const rr of xt)Rt([rr],new la(rr.x,rr.y,0))}const ca=32640;function Sm(n,t,l,p,y,w,I,M,R,N,Z,X,ee,se,ae){const ke=function(Ye,Re,We,ht,ut,jt,Gt,Ft){const Lt=ht.layout.get("text-rotate").evaluate(jt,{})*Math.PI/180,At=[];for(const Ut of Re.positionedLines)for(const Rt of Ut.positionedGlyphs){if(!Rt.rect)continue;const xt=Rt.rect||{};let rr=4,Jt=!0,xr=1,ti=0;const li=(ut||Ft)&&Rt.vertical,Ci=Rt.metrics.advance*Rt.scale/2;if(Ft&&Re.verticalizable){const ci=(Rt.scale-1)*Oi,Di=(Oi-Rt.metrics.width*Rt.scale)/2;ti=Ut.lineOffset/2-(Rt.imageName?-Di:ci)}if(Rt.imageName){const ci=Gt[Rt.imageName];Jt=ci.sdf,xr=ci.pixelRatio,rr=1/xr}const In=ut?[Rt.x+Ci,Rt.y]:[0,0];let ji=ut?[0,0]:[Rt.x+Ci+We[0],Rt.y+We[1]-ti],wi=[0,0];li&&(wi=ji,ji=[0,0]);const zi=(Rt.metrics.left-rr)*Rt.scale-Ci+ji[0],qi=(-Rt.metrics.top-rr)*Rt.scale+ji[1],Hi=zi+xt.w*Rt.scale/xr,cn=qi+xt.h*Rt.scale/xr,Si=new pt(zi,qi),Gi=new pt(Hi,qi),Wi=new pt(zi,cn),rn=new pt(Hi,cn);if(li){const ci=new pt(-Ci,Ci-bu),Di=-Math.PI/2,Tr=12-Ci,xn=new pt(22-Tr,-(Rt.imageName?Tr:0)),Zi=new pt(...wi);Si._rotateAround(Di,ci)._add(xn)._add(Zi),Gi._rotateAround(Di,ci)._add(xn)._add(Zi),Wi._rotateAround(Di,ci)._add(xn)._add(Zi),rn._rotateAround(Di,ci)._add(xn)._add(Zi)}if(Lt){const ci=Math.sin(Lt),Di=Math.cos(Lt),Tr=[Di,-ci,ci,Di];Si._matMult(Tr),Gi._matMult(Tr),Wi._matMult(Tr),rn._matMult(Tr)}const un=new pt(0,0),hn=new pt(0,0);At.push({tl:Si,tr:Gi,bl:Wi,br:rn,tex:xt,writingMode:Re.writingMode,glyphOffset:In,sectionIndex:Rt.sectionIndex,isSDF:Jt,pixelOffsetTL:un,pixelOffsetBR:hn,minFontScaleX:0,minFontScaleY:0})}return At}(0,l,M,y,w,I,p,n.allowVerticalPlacement),we=n.textSizeData;let Be=null;we.kind==="source"?(Be=[Rs*y.layout.get("text-size").evaluate(I,{})],Be[0]>ca&&q(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):we.kind==="composite"&&(Be=[Rs*se.compositeTextSizes[0].evaluate(I,{},ae),Rs*se.compositeTextSizes[1].evaluate(I,{},ae)],(Be[0]>ca||Be[1]>ca)&&q(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,ke,Be,M,w,I,N,t,R.lineStartIndex,R.lineLength,ee,ae);for(const Ye of Z)X[Ye]=n.text.placedSymbolArray.length-1;return 4*ke.length}function km(n){for(const t in n)return n[t];return null}function Mv(n,t,l,p){const y=n.compareText;if(t in y){const w=y[t];for(let I=w.length-1;I>=0;I--)if(p.dist(w[I])<l)return!0}else y[t]=[];return y[t].push(p),!1}const zv=aa.VectorTileFeature.types,Dv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cu(n,t,l,p,y,w,I,M,R,N,Z,X,ee){const se=M?Math.min(ca,Math.round(M[0])):0,ae=M?Math.min(ca,Math.round(M[1])):0;n.emplaceBack(t,l,Math.round(32*p),Math.round(32*y),w,I,(se<<1)+(R?1:0),ae,16*N,16*Z,256*X,256*ee)}function uf(n,t,l){n.emplaceBack(t.x,t.y,l),n.emplaceBack(t.x,t.y,l),n.emplaceBack(t.x,t.y,l),n.emplaceBack(t.x,t.y,l)}function Lv(n){for(const t of n.sections)if(ru(t.text))return!0;return!1}class hf{constructor(t){this.layoutVertexArray=new Rn,this.indexArray=new Qi,this.programConfigurations=t,this.segments=new Sr,this.dynamicLayoutVertexArray=new En,this.opacityVertexArray=new On,this.placedSymbolArray=new yt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,l,p,y){this.isEmpty()||(p&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iv.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,nv.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Dv,!0),this.opacityVertexBuffer.itemSize=1),(p||y)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qt("SymbolBuffers",hf);class ff{constructor(t,l,p){this.layoutVertexArray=new t,this.layoutAttributes=l,this.indexArray=new p,this.segments=new Sr,this.collisionVertexArray=new vn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,sv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qt("CollisionBuffers",ff);class Ro{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(I=>I.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=jh([]),this.placementViewportMatrix=jh([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dm(this.zoom,l["text-size"]),this.iconSizeData=dm(this.zoom,l["icon-size"]);const p=this.layers[0].layout,y=p.get("symbol-sort-key"),w=p.get("symbol-z-order");this.canOverlap=pf(p,"text-overlap","text-allow-overlap")!=="never"||pf(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(I=>i.WritingMode[I])),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.sourceID=t.sourceID}createArrays(){this.text=new hf(new $a(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new hf(new $a(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Dt,this.lineVertexArray=new $t,this.symbolInstances=new Vt}calculateGlyphDependencies(t,l,p,y,w){for(let I=0;I<t.length;I++)if(l[t.charCodeAt(I)]=!0,(p||y)&&w){const M=Vl[t.charAt(I)];M&&(l[M.charCodeAt(0)]=!0)}}populate(t,l,p){const y=this.layers[0],w=y.layout,I=w.get("text-font"),M=w.get("text-field"),R=w.get("icon-image"),N=(M.value.kind!=="constant"||M.value.value instanceof Se&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),Z=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,X=w.get("symbol-sort-key");if(this.features=[],!N&&!Z)return;const ee=l.iconDependencies,se=l.glyphDependencies,ae=l.availableImages,ke=new ai(this.zoom);for(const{feature:we,id:Be,index:Ye,sourceLayerIndex:Re}of t){const We=y._featureFilter.needGeometry,ht=qa(we,We);if(!y._featureFilter.filter(ke,ht,p))continue;let ut,jt;if(We||(ht.geometry=ja(we)),N){const Ft=y.getValueAndResolveTokens("text-field",ht,p,ae),Lt=Se.factory(Ft);Lv(Lt)&&(this.hasRTLText=!0),(!this.hasRTLText||Fa()==="unavailable"||this.hasRTLText&&yn.isParsed())&&(ut=ov(Lt,y,ht))}if(Z){const Ft=y.getValueAndResolveTokens("icon-image",ht,p,ae);jt=Ft instanceof Ce?Ft:Ce.fromString(Ft)}if(!ut&&!jt)continue;const Gt=this.sortFeaturesByKey?X.evaluate(ht,{},p):void 0;if(this.features.push({id:Be,text:ut,icon:jt,index:Ye,sourceLayerIndex:Re,geometry:ht.geometry,properties:we.properties,type:zv[we.type],sortKey:Gt}),jt&&(ee[jt.name]=!0),ut){const Ft=I.evaluate(ht,{},p).join(","),Lt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(i.WritingMode.vertical)>=0;for(const At of ut.sections)if(At.image)ee[At.image.name]=!0;else{const Ut=So(ut.toString()),Rt=At.fontStack||Ft,xt=se[Rt]=se[Rt]||{};this.calculateGlyphDependencies(At.text,xt,Lt,this.allowVerticalPlacement,Ut)}}}w.get("symbol-placement")==="line"&&(this.features=function(we){const Be={},Ye={},Re=[];let We=0;function ht(Ft){Re.push(we[Ft]),We++}function ut(Ft,Lt,At){const Ut=Ye[Ft];return delete Ye[Ft],Ye[Lt]=Ut,Re[Ut].geometry[0].pop(),Re[Ut].geometry[0]=Re[Ut].geometry[0].concat(At[0]),Ut}function jt(Ft,Lt,At){const Ut=Be[Lt];return delete Be[Lt],Be[Ft]=Ut,Re[Ut].geometry[0].shift(),Re[Ut].geometry[0]=At[0].concat(Re[Ut].geometry[0]),Ut}function Gt(Ft,Lt,At){const Ut=At?Lt[0][Lt[0].length-1]:Lt[0][0];return`${Ft}:${Ut.x}:${Ut.y}`}for(let Ft=0;Ft<we.length;Ft++){const Lt=we[Ft],At=Lt.geometry,Ut=Lt.text?Lt.text.toString():null;if(!Ut){ht(Ft);continue}const Rt=Gt(Ut,At),xt=Gt(Ut,At,!0);if(Rt in Ye&&xt in Be&&Ye[Rt]!==Be[xt]){const rr=jt(Rt,xt,At),Jt=ut(Rt,xt,Re[rr].geometry);delete Be[Rt],delete Ye[xt],Ye[Gt(Ut,Re[Jt].geometry,!0)]=Jt,Re[rr].geometry=null}else Rt in Ye?ut(Rt,xt,At):xt in Be?jt(Rt,xt,At):(ht(Ft),Be[Rt]=We-1,Ye[xt]=We-1)}return Re.filter(Ft=>Ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((we,Be)=>we.sortKey-Be.sortKey)}update(t,l,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,l,this.layers,p),this.icon.programConfigurations.updatePaintArrays(t,l,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,l){const p=this.lineVertexArray.length;if(t.segment!==void 0){let y=t.dist(l[t.segment+1]),w=t.dist(l[t.segment]);const I={};for(let M=t.segment+1;M<l.length;M++)I[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:y},M<l.length-1&&(y+=l[M+1].dist(l[M]));for(let M=t.segment||0;M>=0;M--)I[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:w},M>0&&(w+=l[M-1].dist(l[M]));for(let M=0;M<l.length;M++){const R=I[M];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(t,l,p,y,w,I,M,R,N,Z,X,ee){const se=t.indexArray,ae=t.layoutVertexArray,ke=t.segments.prepareSegment(4*l.length,ae,se,this.canOverlap?I.sortKey:void 0),we=this.glyphOffsetArray.length,Be=ke.vertexLength,Ye=this.allowVerticalPlacement&&M===i.WritingMode.vertical?Math.PI/2:0,Re=I.text&&I.text.sections;for(let We=0;We<l.length;We++){const{tl:ht,tr:ut,bl:jt,br:Gt,tex:Ft,pixelOffsetTL:Lt,pixelOffsetBR:At,minFontScaleX:Ut,minFontScaleY:Rt,glyphOffset:xt,isSDF:rr,sectionIndex:Jt}=l[We],xr=ke.vertexLength,ti=xt[1];Cu(ae,R.x,R.y,ht.x,ti+ht.y,Ft.x,Ft.y,p,rr,Lt.x,Lt.y,Ut,Rt),Cu(ae,R.x,R.y,ut.x,ti+ut.y,Ft.x+Ft.w,Ft.y,p,rr,At.x,Lt.y,Ut,Rt),Cu(ae,R.x,R.y,jt.x,ti+jt.y,Ft.x,Ft.y+Ft.h,p,rr,Lt.x,At.y,Ut,Rt),Cu(ae,R.x,R.y,Gt.x,ti+Gt.y,Ft.x+Ft.w,Ft.y+Ft.h,p,rr,At.x,At.y,Ut,Rt),uf(t.dynamicLayoutVertexArray,R,Ye),se.emplaceBack(xr,xr+1,xr+2),se.emplaceBack(xr+1,xr+2,xr+3),ke.vertexLength+=4,ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),We!==l.length-1&&Jt===l[We+1].sectionIndex||t.programConfigurations.populatePaintArrays(ae.length,I,I.index,{},ee,Re&&Re[Jt])}t.placedSymbolArray.emplaceBack(R.x,R.y,we,this.glyphOffsetArray.length-we,Be,N,Z,R.segment,p?p[0]:0,p?p[1]:0,y[0],y[1],M,0,!1,0,X)}_addCollisionDebugVertex(t,l,p,y,w,I){return l.emplaceBack(0,0),t.emplaceBack(p.x,p.y,y,w,Math.round(I.x),Math.round(I.y))}addCollisionDebugVertices(t,l,p,y,w,I,M){const R=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),N=R.vertexLength,Z=w.layoutVertexArray,X=w.collisionVertexArray,ee=M.anchorX,se=M.anchorY;this._addCollisionDebugVertex(Z,X,I,ee,se,new pt(t,l)),this._addCollisionDebugVertex(Z,X,I,ee,se,new pt(p,l)),this._addCollisionDebugVertex(Z,X,I,ee,se,new pt(p,y)),this._addCollisionDebugVertex(Z,X,I,ee,se,new pt(t,y)),R.vertexLength+=4;const ae=w.indexArray;ae.emplaceBack(N,N+1),ae.emplaceBack(N+1,N+2),ae.emplaceBack(N+2,N+3),ae.emplaceBack(N+3,N),R.primitiveLength+=4}addDebugCollisionBoxes(t,l,p,y){for(let w=t;w<l;w++){const I=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,y?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ff(ys,Qp.members,Xn),this.iconCollisionBox=new ff(ys,Qp.members,Xn);for(let t=0;t<this.symbolInstances.length;t++){const l=this.symbolInstances.get(t);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(t,l,p,y,w,I,M,R,N){const Z={};for(let X=l;X<p;X++){const ee=t.get(X);Z.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},Z.textFeatureIndex=ee.featureIndex;break}for(let X=y;X<w;X++){const ee=t.get(X);Z.verticalTextBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},Z.verticalTextFeatureIndex=ee.featureIndex;break}for(let X=I;X<M;X++){const ee=t.get(X);Z.iconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},Z.iconFeatureIndex=ee.featureIndex;break}for(let X=R;X<N;X++){const ee=t.get(X);Z.verticalIconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},Z.verticalIconFeatureIndex=ee.featureIndex;break}return Z}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const p=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,l){const p=t.placedSymbolArray.get(l),y=p.vertexStartIndex+4*p.numGlyphs;for(let w=p.vertexStartIndex;w<y;w+=4)t.indexArray.emplaceBack(w,w+1,w+2),t.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(t),p=Math.cos(t),y=[],w=[],I=[];for(let M=0;M<this.symbolInstances.length;++M){I.push(M);const R=this.symbolInstances.get(M);y.push(0|Math.round(l*R.anchorX+p*R.anchorY)),w.push(R.featureIndex)}return I.sort((M,R)=>y[M]-y[R]||w[R]-w[M]),I}addToSortKeyRanges(t,l){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===l?p.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const p=this.symbolInstances.get(l);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((y,w,I)=>{y>=0&&I.indexOf(y)===w&&this.addIndicesForPlacedSymbol(this.text,y)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}qt("SymbolBucket",Ro,{omit:["layers","collisionBoxArray","features","compareText"]}),Ro.MAX_GLYPHS=65535,Ro.addDynamicAttributes=uf;const Rv=new Ri({"symbol-placement":new Wt(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Wt(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wt(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lr(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wt(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Wt(Fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Wt(Fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Wt(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wt(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wt(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new lr(Fe.layout_symbol["icon-size"]),"icon-text-fit":new Wt(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Wt(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new lr(Fe.layout_symbol["icon-image"]),"icon-rotate":new lr(Fe.layout_symbol["icon-rotate"]),"icon-padding":new lr(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Wt(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new lr(Fe.layout_symbol["icon-offset"]),"icon-anchor":new lr(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wt(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wt(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wt(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new lr(Fe.layout_symbol["text-field"]),"text-font":new lr(Fe.layout_symbol["text-font"]),"text-size":new lr(Fe.layout_symbol["text-size"]),"text-max-width":new lr(Fe.layout_symbol["text-max-width"]),"text-line-height":new Wt(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new lr(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new lr(Fe.layout_symbol["text-justify"]),"text-radial-offset":new lr(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wt(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new lr(Fe.layout_symbol["text-anchor"]),"text-max-angle":new Wt(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Wt(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new lr(Fe.layout_symbol["text-rotate"]),"text-padding":new Wt(Fe.layout_symbol["text-padding"]),"text-keep-upright":new Wt(Fe.layout_symbol["text-keep-upright"]),"text-transform":new lr(Fe.layout_symbol["text-transform"]),"text-offset":new lr(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new Wt(Fe.layout_symbol["text-allow-overlap"]),"text-overlap":new Wt(Fe.layout_symbol["text-overlap"]),"text-ignore-placement":new Wt(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new Wt(Fe.layout_symbol["text-optional"])});var df={paint:new Ri({"icon-opacity":new lr(Fe.paint_symbol["icon-opacity"]),"icon-color":new lr(Fe.paint_symbol["icon-color"]),"icon-halo-color":new lr(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new lr(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lr(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Wt(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wt(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new lr(Fe.paint_symbol["text-opacity"]),"text-color":new lr(Fe.paint_symbol["text-color"],{runtimeType:vi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new lr(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new lr(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new lr(Fe.paint_symbol["text-halo-blur"]),"text-translate":new Wt(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new Wt(Fe.paint_symbol["text-translate-anchor"])}),layout:Rv};class Em{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:yi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(t.formattedSection))return l.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt("FormatSectionOverride",Em,{omit:["defaultValue"]});class Iu extends Ln{constructor(t){super(t,df)}recalculate(t,l){if(super.recalculate(t,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const y=[];for(const w of p)y.indexOf(w)<0&&y.push(w);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,l,p,y){const w=this.layout.get(t).evaluate(l,{},p,y),I=this._unevaluatedLayout._values[t];return I.isDataDriven()||Ta(I.value)||!w?w:function(M,R){return R.replace(/{([^{}]+)}/g,(N,Z)=>Z in M?String(M[Z]):"")}(l.properties,w)}createBucket(t){return new Ro(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of df.paint.overridableProperties){if(!Iu.hasPaintOverride(this.layout,t))continue;const l=this.paint.get(t),p=new Em(l),y=new _o(p,l.property.specification);let w=null;w=l.value.kind==="constant"||l.value.kind==="source"?new Ia("source",y):new ml("composite",y,l.value.zoomStops),this.paint._values[t]=new Dn(l.property,w,l.parameters)}}_handleOverridablePaintPropertyUpdate(t,l,p){return!(!this.layout||l.isDataDriven()||p.isDataDriven())&&Iu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,l){const p=t.get("text-field"),y=df.paint.properties[l];let w=!1;const I=M=>{for(const R of M)if(y.overrides&&y.overrides.hasOverride(R))return void(w=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Se)I(p.value.value.sections);else if(p.value.kind==="source"){const M=N=>{w||(N instanceof Pt&&Le(N.value)===ii?I(N.value.sections):N instanceof mo?I(N.sections):N.eachChild(M))},R=p.value;R._styleExpression&&M(R._styleExpression.expression)}return w}}function pf(n,t,l){let p="never";const y=n.get(t);return y?p=y:n.get(l)&&(p="always"),p}var Ov={paint:new Ri({"background-color":new Wt(Fe.paint_background["background-color"]),"background-pattern":new Cl(Fe.paint_background["background-pattern"]),"background-opacity":new Wt(Fe.paint_background["background-opacity"])})},Bv={paint:new Ri({"raster-opacity":new Wt(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Wt(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wt(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wt(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Wt(Fe.paint_raster["raster-saturation"]),"raster-contrast":new Wt(Fe.paint_raster["raster-contrast"]),"raster-resampling":new Wt(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Wt(Fe.paint_raster["raster-fade-duration"])})};class Nv extends Ln{constructor(t){super(t,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Fv={circle:class extends Ln{constructor(n){super(n,g0)}createBucket(n){return new Uh(n)}queryRadius(n){const t=n;return zl("circle-radius",this,t)+zl("circle-stroke-width",this,t)+hu(this.paint.get("circle-translate"))}queryIntersectsFeature(n,t,l,p,y,w,I,M){const R=fu(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,I),N=this.paint.get("circle-radius").evaluate(t,l)+this.paint.get("circle-stroke-width").evaluate(t,l),Z=this.paint.get("circle-pitch-alignment")==="map",X=Z?R:function(se,ae){return se.map(ke=>Op(ke,ae))}(R,M),ee=Z?N*I:N;for(const se of p)for(const ae of se){const ke=Z?ae:Op(ae,M);let we=ee;const Be=du([],[ae.x,ae.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?we*=Be[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(we*=w.cameraToCenterDistance/Be[3]),h0(X,ke,we))return!0}return!1}},heatmap:class extends Ln{constructor(n){super(n,y0),this._updateColorRamp()}createBucket(n){return new Bp(n)}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Ln{constructor(n){super(n,v0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Ln{constructor(n){super(n,R0)}recalculate(n,t){super.recalculate(n,t);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Yh(n)}queryRadius(){return hu(this.paint.get("fill-translate"))}queryIntersectsFeature(n,t,l,p,y,w,I){return Ip(fu(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,I),p)}isTileClipped(){return!0}},"fill-extrusion":class extends Ln{constructor(n){super(n,K0)}createBucket(n){return new ef(n)}queryRadius(){return hu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,t,l,p,y,w,I,M){const R=fu(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,I),N=this.paint.get("fill-extrusion-height").evaluate(t,l),Z=this.paint.get("fill-extrusion-base").evaluate(t,l),X=function(se,ae,ke,we){const Be=[];for(const Ye of se){const Re=[Ye.x,Ye.y,0,1];du(Re,Re,ae),Be.push(new pt(Re[0]/Re[3],Re[1]/Re[3]))}return Be}(R,M),ee=function(se,ae,ke,we){const Be=[],Ye=[],Re=we[8]*ae,We=we[9]*ae,ht=we[10]*ae,ut=we[11]*ae,jt=we[8]*ke,Gt=we[9]*ke,Ft=we[10]*ke,Lt=we[11]*ke;for(const At of se){const Ut=[],Rt=[];for(const xt of At){const rr=xt.x,Jt=xt.y,xr=we[0]*rr+we[4]*Jt+we[12],ti=we[1]*rr+we[5]*Jt+we[13],li=we[2]*rr+we[6]*Jt+we[14],Ci=we[3]*rr+we[7]*Jt+we[15],In=li+ht,ji=Ci+ut,wi=xr+jt,zi=ti+Gt,qi=li+Ft,Hi=Ci+Lt,cn=new pt((xr+Re)/ji,(ti+We)/ji);cn.z=In/ji,Ut.push(cn);const Si=new pt(wi/Hi,zi/Hi);Si.z=qi/Hi,Rt.push(Si)}Be.push(Ut),Ye.push(Rt)}return[Be,Ye]}(p,Z,N,M);return function(se,ae,ke){let we=1/0;Ip(ke,ae)&&(we=Wp(ke,ae[0]));for(let Be=0;Be<ae.length;Be++){const Ye=ae[Be],Re=se[Be];for(let We=0;We<Ye.length-1;We++){const ht=Ye[We],ut=[ht,Ye[We+1],Re[We+1],Re[We],ht];Cp(ke,ut)&&(we=Math.min(we,Wp(ke,ut)))}}return we!==1/0&&we}(ee[0],ee[1],X)}},line:class extends Ln{constructor(n){super(n,Xp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){n==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof xa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,t){super.recalculate(n,t),this.paint._values["line-floorwidth"]=Jp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new tf(n)}queryRadius(n){const t=n,l=Yp(zl("line-width",this,t),zl("line-gap-width",this,t)),p=zl("line-offset",this,t);return l/2+Math.abs(p)+hu(this.paint.get("line-translate"))}queryIntersectsFeature(n,t,l,p,y,w,I){const M=fu(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,I),R=I/2*Yp(this.paint.get("line-width").evaluate(t,l),this.paint.get("line-gap-width").evaluate(t,l)),N=this.paint.get("line-offset").evaluate(t,l);return N&&(p=function(Z,X){const ee=[];for(let se=0;se<Z.length;se++){const ae=Z[se],ke=[];for(let we=0;we<ae.length;we++){const Be=ae[we-1],Ye=ae[we],Re=ae[we+1],We=we===0?new pt(0,0):Ye.sub(Be)._unit()._perp(),ht=we===ae.length-1?new pt(0,0):Re.sub(Ye)._unit()._perp(),ut=We._add(ht)._unit(),jt=ut.x*ht.x+ut.y*ht.y;jt!==0&&ut._mult(1/jt),ke.push(ut._mult(X)._add(Ye))}ee.push(ke)}return ee}(p,N*I)),function(Z,X,ee){for(let se=0;se<X.length;se++){const ae=X[se];if(Z.length>=3){for(let ke=0;ke<ae.length;ke++)if(Io(Z,ae[ke]))return!0}if(f0(Z,ae,ee))return!0}return!1}(M,p,R)}isTileClipped(){return!0}},symbol:Iu,background:class extends Ln{constructor(n){super(n,Ov)}},raster:class extends Ln{constructor(n){super(n,Bv)}}};class Uv{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Tm=63710088e-1;class mi{constructor(t,l){if(isNaN(t)||isNaN(l))throw new Error(`Invalid LngLat object: (${t}, ${l})`);if(this.lng=+t,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mi(S(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const l=Math.PI/180,p=this.lat*l,y=t.lat*l,w=Math.sin(p)*Math.sin(y)+Math.cos(p)*Math.cos(y)*Math.cos((t.lng-this.lng)*l);return Tm*Math.acos(Math.min(w,1))}toBounds(t=0){const l=360*t/40075017,p=l/Math.cos(Math.PI/180*this.lat);return new Za(new mi(this.lng-p,this.lat-l),new mi(this.lng+p,this.lat+l))}static convert(t){if(t instanceof mi)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new mi(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new mi(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Za{constructor(t,l){t&&(l?this.setSouthWest(t).setNorthEast(l):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof mi?new mi(t.lng,t.lat):mi.convert(t),this}setSouthWest(t){return this._sw=t instanceof mi?new mi(t.lng,t.lat):mi.convert(t),this}extend(t){const l=this._sw,p=this._ne;let y,w;if(t instanceof mi)y=t,w=t;else{if(!(t instanceof Za))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Za.convert(t)):this.extend(mi.convert(t)):this;if(y=t._sw,w=t._ne,!y||!w)return this}return l||p?(l.lng=Math.min(y.lng,l.lng),l.lat=Math.min(y.lat,l.lat),p.lng=Math.max(w.lng,p.lng),p.lat=Math.max(w.lat,p.lat)):(this._sw=new mi(y.lng,y.lat),this._ne=new mi(w.lng,w.lat)),this}getCenter(){return new mi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mi(this.getWest(),this.getNorth())}getSouthEast(){return new mi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:l,lat:p}=mi.convert(t);let y=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y}static convert(t){return t instanceof Za?t:t&&new Za(t)}}const Cm=2*Math.PI*Tm;function Im(n){return Cm*Math.cos(n*Math.PI/180)}function Am(n){return(180+n)/360}function Pm(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Mm(n,t){return n/Im(t)}function mf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class Au{constructor(t,l,p=0){this.x=+t,this.y=+l,this.z=+p}static fromLngLat(t,l=0){const p=mi.convert(t);return new Au(Am(p.lng),Pm(p.lat),Mm(l,p.lat))}toLngLat(){return new mi(360*this.x-180,mf(this.y))}toAltitude(){return this.z*Im(mf(this.y))}meterInMercatorCoordinateUnits(){return 1/Cm*(t=mf(this.y),1/Math.cos(t*Math.PI/180));var t}}function zm(n,t,l){var p=2*Math.PI*6378137/256/Math.pow(2,l);return[n*p-2*Math.PI*6378137/2,t*p-2*Math.PI*6378137/2]}class gf{constructor(t,l,p){if(t<0||t>25||p<0||p>=Math.pow(2,t)||l<0||l>=Math.pow(2,t))throw new Error(`x=${l}, y=${p}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=l,this.y=p,this.key=jl(0,t,t,l,p)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,l,p){const y=(I=this.y,M=this.z,R=zm(256*(w=this.x),256*(I=Math.pow(2,M)-I-1),M),N=zm(256*(w+1),256*(I+1),M),R[0]+","+R[1]+","+N[0]+","+N[1]);var w,I,M,R,N;const Z=function(X,ee,se){let ae,ke="";for(let we=X;we>0;we--)ae=1<<we-1,ke+=(ee&ae?1:0)+(se&ae?2:0);return ke}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,Z).replace(/{bbox-epsg-3857}/g,y)}isChildOf(t){const l=this.z-t.z;return l>0&&t.x===this.x>>l&&t.y===this.y>>l}getTilePoint(t){const l=Math.pow(2,this.z);return new pt((t.x*l-this.x)*Ti,(t.y*l-this.y)*Ti)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dm{constructor(t,l){this.wrap=t,this.canonical=l,this.key=jl(t,l.z,l.z,l.x,l.y)}}class Cn{constructor(t,l,p,y,w){if(t<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${p}`);this.overscaledZ=t,this.wrap=l,this.canonical=new gf(p,+y,+w),this.key=jl(l,t,p,y,w)}clone(){return new Cn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?new Cn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cn(t,this.wrap,t,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(t,l){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-t;return t>this.canonical.z?jl(this.wrap*+l,t,this.canonical.z,this.canonical.x,this.canonical.y):jl(this.wrap*+l,t,t,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const l=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>l&&t.canonical.y===this.canonical.y>>l}children(t){if(this.overscaledZ>=t)return[new Cn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,p=2*this.canonical.x,y=2*this.canonical.y;return[new Cn(l,this.wrap,l,p,y),new Cn(l,this.wrap,l,p+1,y),new Cn(l,this.wrap,l,p,y+1),new Cn(l,this.wrap,l,p+1,y+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Cn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Cn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Au(t.x-this.wrap,t.y))}}function jl(n,t,l,p,y){(n*=2)<0&&(n=-1*n-1);const w=1<<l;return(w*w*n+w*y+p).toString(36)+l.toString(36)+t.toString(36)}qt("CanonicalTileID",gf),qt("OverscaledTileID",Cn,{omit:["posMatrix"]});class Lm{constructor(t,l,p){if(this.uid=t,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return void q(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const y=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=p||"mapbox";for(let w=0;w<y;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(y,w)]=this.data[this._idx(y-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,y)]=this.data[this._idx(w,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let w=0;w<y;w++)for(let I=0;I<y;I++){const M=this.get(w,I);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(t,l){const p=new Uint8Array(this.data.buffer),y=4*this._idx(t,l);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[y],p[y+1],p[y+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,l){if(t<-1||t>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(t+1)}_unpackMapbox(t,l,p){return(256*t*256+256*l+p)/10-1e4}_unpackTerrarium(t,l,p){return 256*t+l+p/256-32768}getPixels(){return new Tn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,l,p){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let y=l*this.dim,w=l*this.dim+this.dim,I=p*this.dim,M=p*this.dim+this.dim;switch(l){case-1:y=w-1;break;case 1:w=y+1}switch(p){case-1:I=M-1;break;case 1:M=I+1}const R=-l*this.dim,N=-p*this.dim;for(let Z=I;Z<M;Z++)for(let X=y;X<w;X++)this.data[this._idx(X,Z)]=t.data[this._idx(X+R,Z+N)]}}qt("DEMData",Lm);class Rm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let l=0;l<t.length;l++){const p=t[l];this._stringToNumber[p]=l,this._numberToString[l]=p}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Om{constructor(t,l,p,y,w){this.type="Feature",this._vectorTileFeature=t,t._z=l,t._x=p,t._y=y,this.properties=t.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(t[l]=this[l]);return t}}class Bm{constructor(t,l){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Na(Ti,16,0),this.grid3D=new Na(Ti,16,0),this.featureIndexArray=new br,this.promoteId=l}insert(t,l,p,y,w,I){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,y,w);const R=I?this.grid3D:this.grid;for(let N=0;N<l.length;N++){const Z=l[N],X=[1/0,1/0,-1/0,-1/0];for(let ee=0;ee<Z.length;ee++){const se=Z[ee];X[0]=Math.min(X[0],se.x),X[1]=Math.min(X[1],se.y),X[2]=Math.max(X[2],se.x),X[3]=Math.max(X[3],se.y)}X[0]<Ti&&X[1]<Ti&&X[2]>=0&&X[3]>=0&&R.insert(M,X[0],X[1],X[2],X[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new aa.VectorTile(new rf(this.rawTileData)).layers,this.sourceLayerCoder=new Rm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,l,p,y){this.loadVTLayers();const w=t.params||{},I=Ti/t.tileSize/t.scale,M=bo(w.filter),R=t.queryGeometry,N=t.queryPadding*I,Z=Fm(R),X=this.grid.query(Z.minX-N,Z.minY-N,Z.maxX+N,Z.maxY+N),ee=Fm(t.cameraQueryGeometry),se=this.grid3D.query(ee.minX-N,ee.minY-N,ee.maxX+N,ee.maxY+N,(we,Be,Ye,Re)=>function(We,ht,ut,jt,Gt){for(const Lt of We)if(ht<=Lt.x&&ut<=Lt.y&&jt>=Lt.x&&Gt>=Lt.y)return!0;const Ft=[new pt(ht,ut),new pt(ht,Gt),new pt(jt,Gt),new pt(jt,ut)];if(We.length>2){for(const Lt of Ft)if(Io(We,Lt))return!0}for(let Lt=0;Lt<We.length-1;Lt++)if(p0(We[Lt],We[Lt+1],Ft))return!0;return!1}(t.cameraQueryGeometry,we-N,Be-N,Ye+N,Re+N));for(const we of se)X.push(we);X.sort(Vv);const ae={};let ke;for(let we=0;we<X.length;we++){const Be=X[we];if(Be===ke)continue;ke=Be;const Ye=this.featureIndexArray.get(Be);let Re=null;this.loadMatchingFeature(ae,Ye.bucketIndex,Ye.sourceLayerIndex,Ye.featureIndex,M,w.layers,w.availableImages,l,p,y,(We,ht,ut)=>(Re||(Re=ja(We)),ht.queryIntersectsFeature(R,We,ut,Re,this.z,t.transform,I,t.pixelPosMatrix)))}return ae}loadMatchingFeature(t,l,p,y,w,I,M,R,N,Z,X){const ee=this.bucketLayerIDs[l];if(I&&!function(we,Be){for(let Ye=0;Ye<we.length;Ye++)if(Be.indexOf(we[Ye])>=0)return!0;return!1}(I,ee))return;const se=this.sourceLayerCoder.decode(p),ae=this.vtLayers[se].feature(y);if(w.needGeometry){const we=qa(ae,!0);if(!w.filter(new ai(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!w.filter(new ai(this.tileID.overscaledZ),ae))return;const ke=this.getId(ae,se);for(let we=0;we<ee.length;we++){const Be=ee[we];if(I&&I.indexOf(Be)<0)continue;const Ye=R[Be];if(!Ye)continue;let Re={};ke&&Z&&(Re=Z.getState(Ye.sourceLayer||"_geojsonTileLayer",ke));const We=E({},N[Be]);We.paint=Nm(We.paint,Ye.paint,ae,Re,M),We.layout=Nm(We.layout,Ye.layout,ae,Re,M);const ht=!X||X(ae,Ye,Re);if(!ht)continue;const ut=new Om(ae,this.z,this.x,this.y,ke);ut.layer=We;let jt=t[Be];jt===void 0&&(jt=t[Be]=[]),jt.push({featureIndex:y,feature:ut,intersectionZ:ht})}}lookupSymbolFeatures(t,l,p,y,w,I,M,R){const N={};this.loadVTLayers();const Z=bo(w);for(const X of t)this.loadMatchingFeature(N,p,y,X,Z,I,M,R,l);return N}hasLayer(t){for(const l of this.bucketLayerIDs)for(const p of l)if(t===p)return!0;return!1}getId(t,l){let p=t.id;return this.promoteId&&(p=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof p=="boolean"&&(p=Number(p))),p}}function Nm(n,t,l,p,y){return z(n,(w,I)=>{const M=t instanceof Va?t.get(I):null;return M&&M.evaluate?M.evaluate(l,p,y):M})}function Fm(n){let t=1/0,l=1/0,p=-1/0,y=-1/0;for(const w of n)t=Math.min(t,w.x),l=Math.min(l,w.y),p=Math.max(p,w.x),y=Math.max(y,w.y);return{minX:t,minY:l,maxX:p,maxY:y}}function Vv(n,t){return t-n}var _f;qt("FeatureIndex",Bm,{omit:["rawTileData","sourceLayerCoder"]}),i.PerformanceMarkers=void 0,(_f=i.PerformanceMarkers||(i.PerformanceMarkers={})).create="create",_f.load="load",_f.fullLoad="fullLoad";let Pu=null,ql=[];const yf=1e3/30,$v={mark(n){performance.mark(n)},frame(n){const t=n;Pu!=null&&ql.push(t-Pu),Pu=t},clearMetrics(){Pu=null,ql=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const n in i.PerformanceMarkers)performance.clearMarks(i.PerformanceMarkers[n])},getPerformanceMetrics(){performance.measure("loadTime",i.PerformanceMarkers.create,i.PerformanceMarkers.load),performance.measure("fullLoadTime",i.PerformanceMarkers.create,i.PerformanceMarkers.fullLoad);const n=performance.getEntriesByName("loadTime")[0].duration,t=performance.getEntriesByName("fullLoadTime")[0].duration,l=ql.length,p=1/(ql.reduce((w,I)=>w+I,0)/l/1e3),y=ql.filter(w=>w>yf).reduce((w,I)=>w+(I-yf)/yf,0);return{loadTime:n,fullLoadTime:t,fps:p,percentDroppedFrames:y/(l+y)*100}}};i.AJAXError=Fr,i.ARRAY_TYPE=tn,i.Actor=class{constructor(n,t,l){this.target=n,this.parent=t,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},A(["receive","process"],this),this.invoker=new Uv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=oe()?n:window}send(n,t,l,p,y=!1){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[w]=l);const I=Ne(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:n,hasCallback:!!l,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:Is(t,I)},I),{cancel:()=>{l&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(n){const t=n.data,l=t.id;if(l&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[l];const p=this.cancelCallbacks[l];delete this.cancelCallbacks[l],p&&p()}else oe()||t.mustQueue?(this.tasks[l]=t,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,t)}process(){if(!this.taskQueue.length)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){if(t.type==="<response>"){const l=this.callbacks[n];delete this.callbacks[n],l&&(t.error?l(ds(t.error)):l(null,ds(t.data)))}else{let l=!1;const p=Ne(this.globalScope)?void 0:[],y=t.hasCallback?(M,R)=>{l=!0,delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:M?Is(M):null,data:Is(R,p)},p)}:M=>{l=!0};let w=null;const I=ds(t.data);if(this.parent[t.type])w=this.parent[t.type](t.sourceMapId,I,y);else if(this.parent.getWorkerSource){const M=t.type.split(".");w=this.parent.getWorkerSource(t.sourceMapId,M[0],I.source)[M[1]](I,y)}else y(new Error(`Could not find function ${t.type}`));!l&&w&&w.cancel&&(this.cancelCallbacks[n]=w.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.AlphaImage=Ll,i.CanonicalTileID=gf,i.CollisionBoxArray=st,i.CollisionCircleLayoutArray=class extends W{},i.Color=te,i.DEMData=Lm,i.DataConstantProperty=Wt,i.DictionaryCoder=Rm,i.EXTENT=Ti,i.ErrorEvent=Ht,i.EvaluationParameters=ai,i.Event=Et,i.Evented=wr,i.FeatureIndex=Bm,i.FillBucket=Yh,i.FillExtrusionBucket=ef,i.GeoJSONFeature=Om,i.ImageAtlas=om,i.ImagePosition=sf,i.LineBucket=tf,i.LineStripIndexArray=class extends xe{},i.LngLat=mi,i.LngLatBounds=Za,i.MercatorCoordinate=Au,i.ONE_EM=Oi,i.OverscaledTileID=Cn,i.PerformanceUtils=$v,i.PosArray=tr,i.Properties=Ri,i.QuadTriangleArray=class extends ne{},i.RGBAImage=Tn,i.RasterBoundsArray=class extends _{},i.RequestPerformance=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},i.ResourceType=Lr,i.SegmentVector=Sr,i.SymbolBucket=Ro,i.Transitionable=su,i.TriangleIndexArray=Qi,i.Uniform1f=zs,i.Uniform1i=class extends Ms{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},i.Uniform2f=class extends Ms{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},i.Uniform3f=class extends Ms{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},i.Uniform4f=To,i.UniformColor=Sp,i.UniformMatrix4f=class extends Ms{constructor(n,t){super(n,t),this.current=c0}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},i.UnwrappedTileID=Dm,i.ValidationError=_t,i.ZoomHistory=vl,i.add=function(n,t,l){return n[0]=t[0]+l[0],n[1]=t[1]+l[1],n[2]=t[2]+l[2],n},i.addDynamicAttributes=uf,i.asyncAll=function(n,t,l){if(!n.length)return l(null,[]);let p=n.length;const y=new Array(n.length);let w=null;n.forEach((I,M)=>{t(I,(R,N)=>{R&&(w=R),y[M]=N,--p==0&&l(w,y)})})},i.bezier=b,i.bindAll=A,i.cacheEntryPossiblyAdded=function(n){ue++,ue>ze&&(n.getActor().send("enforceCacheSizeLimit",_e),ue=0)},i.clamp=x,i.clearTileCache=function(n){const t=caches.delete(nt);n&&t.catch(n).then(()=>n())},i.clipLine=vm,i.clone=function(n){var t=new tn(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},i.clone$1=F,i.clone$2=function(n){var t=new tn(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},i.collisionCircleLayout=av,i.config=Zt,i.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},i.create=function(){var n=new tn(16);return tn!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},i.create$1=Mp,i.createExpression=Ca,i.createFilter=bo,i.createLayout=xi,i.createStyleLayer=function(n){return n.type==="custom"?new Nv(n):new Fv[n.type](n)},i.cross=function(n,t,l){var p=t[0],y=t[1],w=t[2],I=l[0],M=l[1],R=l[2];return n[0]=y*R-w*M,n[1]=w*I-p*R,n[2]=p*M-y*I,n},i.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},i.dot$1=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},i.ease=k,i.emitValidationErrors=wo,i.enforceCacheSizeLimit=function(n){re(),tt&&tt.then(t=>{t.keys().then(l=>{for(let p=0;p<l.length-n;p++)t.delete(l[p])})})},i.equals=function(n,t){var l=n[0],p=n[1],y=n[2],w=n[3],I=n[4],M=n[5],R=n[6],N=n[7],Z=n[8],X=n[9],ee=n[10],se=n[11],ae=n[12],ke=n[13],we=n[14],Be=n[15],Ye=t[0],Re=t[1],We=t[2],ht=t[3],ut=t[4],jt=t[5],Gt=t[6],Ft=t[7],Lt=t[8],At=t[9],Ut=t[10],Rt=t[11],xt=t[12],rr=t[13],Jt=t[14],xr=t[15];return Math.abs(l-Ye)<=en*Math.max(1,Math.abs(l),Math.abs(Ye))&&Math.abs(p-Re)<=en*Math.max(1,Math.abs(p),Math.abs(Re))&&Math.abs(y-We)<=en*Math.max(1,Math.abs(y),Math.abs(We))&&Math.abs(w-ht)<=en*Math.max(1,Math.abs(w),Math.abs(ht))&&Math.abs(I-ut)<=en*Math.max(1,Math.abs(I),Math.abs(ut))&&Math.abs(M-jt)<=en*Math.max(1,Math.abs(M),Math.abs(jt))&&Math.abs(R-Gt)<=en*Math.max(1,Math.abs(R),Math.abs(Gt))&&Math.abs(N-Ft)<=en*Math.max(1,Math.abs(N),Math.abs(Ft))&&Math.abs(Z-Lt)<=en*Math.max(1,Math.abs(Z),Math.abs(Lt))&&Math.abs(X-At)<=en*Math.max(1,Math.abs(X),Math.abs(At))&&Math.abs(ee-Ut)<=en*Math.max(1,Math.abs(ee),Math.abs(Ut))&&Math.abs(se-Rt)<=en*Math.max(1,Math.abs(se),Math.abs(Rt))&&Math.abs(ae-xt)<=en*Math.max(1,Math.abs(ae),Math.abs(xt))&&Math.abs(ke-rr)<=en*Math.max(1,Math.abs(ke),Math.abs(rr))&&Math.abs(we-Jt)<=en*Math.max(1,Math.abs(we),Math.abs(Jt))&&Math.abs(Be-xr)<=en*Math.max(1,Math.abs(Be),Math.abs(xr))},i.evaluateSizeForFeature=function(n,{uSize:t,uSizeT:l},{lowerSize:p,upperSize:y}){return n.kind==="source"?p/Rs:n.kind==="composite"?ni(p/Rs,y/Rs,l):t},i.evaluateSizeForZoom=function(n,t){let l=0,p=0;if(n.kind==="constant")p=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:y,minZoom:w,maxZoom:I}=n,M=y?x(an.interpolationFactor(y,t,w,I),0,1):0;n.kind==="camera"?p=ni(n.minSize,n.maxSize,M):l=M}return{uSizeT:l,uSize:p}},i.evaluateVariableOffset=wm,i.evented=Tl,i.exported=Qe,i.exported$1=Xe,i.extend=E,i.filterObject=D,i.fromRotation=function(n,t){var l=Math.sin(t),p=Math.cos(t);return n[0]=p,n[1]=l,n[2]=0,n[3]=-l,n[4]=p,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},i.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},i.getAnchorAlignment=of,i.getAnchorJustification=cf,i.getArrayBuffer=be,i.getImage=je,i.getJSON=function(n,t){return et(E(n,{type:"json"}),t)},i.getOverlapMode=pf,i.getRTLTextPluginStatus=Fa,i.getReferrer=K,i.getVideo=function(n,t){const l=window.document.createElement("video");l.muted=!0,l.onloadstart=function(){t(null,l)};for(let p=0;p<n.length;p++){const y=window.document.createElement("source");me(n[p])||(l.crossOrigin="Anonymous"),y.src=n[p],l.appendChild(y)}return{cancel:()=>{}}},i.identity=jh,i.invert=function(n,t){var l=t[0],p=t[1],y=t[2],w=t[3],I=t[4],M=t[5],R=t[6],N=t[7],Z=t[8],X=t[9],ee=t[10],se=t[11],ae=t[12],ke=t[13],we=t[14],Be=t[15],Ye=l*M-p*I,Re=l*R-y*I,We=l*N-w*I,ht=p*R-y*M,ut=p*N-w*M,jt=y*N-w*R,Gt=Z*ke-X*ae,Ft=Z*we-ee*ae,Lt=Z*Be-se*ae,At=X*we-ee*ke,Ut=X*Be-se*ke,Rt=ee*Be-se*we,xt=Ye*Rt-Re*Ut+We*At+ht*Lt-ut*Ft+jt*Gt;return xt?(n[0]=(M*Rt-R*Ut+N*At)*(xt=1/xt),n[1]=(y*Ut-p*Rt-w*At)*xt,n[2]=(ke*jt-we*ut+Be*ht)*xt,n[3]=(ee*ut-X*jt-se*ht)*xt,n[4]=(R*Lt-I*Rt-N*Ft)*xt,n[5]=(l*Rt-y*Lt+w*Ft)*xt,n[6]=(we*We-ae*jt-Be*Re)*xt,n[7]=(Z*jt-ee*We+se*Re)*xt,n[8]=(I*Ut-M*Lt+N*Gt)*xt,n[9]=(p*Lt-l*Ut-w*Gt)*xt,n[10]=(ae*ut-ke*We+Be*Ye)*xt,n[11]=(X*We-Z*ut-se*Ye)*xt,n[12]=(M*Ft-I*At-R*Gt)*xt,n[13]=(l*At-p*Ft+y*Gt)*xt,n[14]=(ke*Re-ae*ht-we*Ye)*xt,n[15]=(Z*ht-X*Re+ee*Ye)*xt,n):null},i.isImageBitmap=Y,i.isSafari=Ne,i.isWorker=oe,i.keysDifference=function(n,t){const l=[];for(const p in n)p in t||l.push(p);return l},i.lazyLoadRTLTextPlugin=function(){yn.isLoading()||yn.isLoaded()||Fa()!=="deferred"||nu()},i.makeRequest=et,i.mapObject=z,i.mercatorXfromLng=Am,i.mercatorYfromLat=Pm,i.mercatorZfromAltitude=Mm,i.mul=_0,i.mul$1=function(n,t,l){return n[0]=t[0]*l[0],n[1]=t[1]*l[1],n[2]=t[2]*l[2],n[3]=t[3]*l[3],n},i.multiply=zp,i.nextPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},i.normalize=function(n,t){var l=t[0],p=t[1],y=t[2],w=l*l+p*p+y*y;return w>0&&(w=1/Math.sqrt(w)),n[0]=t[0]*w,n[1]=t[1]*w,n[2]=t[2]*w,n},i.number=ni,i.ortho=function(n,t,l,p,y,w,I){var M=1/(t-l),R=1/(p-y),N=1/(w-I);return n[0]=-2*M,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*R,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*N,n[11]=0,n[12]=(t+l)*M,n[13]=(y+p)*R,n[14]=(I+w)*N,n[15]=1,n},i.parseCacheControl=de,i.parseGlyphPbf=function(n){return new rf(n).readFields(_v,[])},i.pbf=rf,i.performSymbolLayout=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Ti/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0].layout,l=n.bucket.layers[0]._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new ai(n.bucket.zoom+1),n.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new ai(n.bucket.zoom+1),n.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new ai(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:R,maxZoom:N}=n.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new ai(R),n.canonical),l["text-size"].possiblyEvaluate(new ai(N),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:R,maxZoom:N}=n.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new ai(R),n.canonical),l["icon-size"].possiblyEvaluate(new ai(N),n.canonical)]}const y=t.get("text-line-height")*Oi,w=t.get("text-rotation-alignment")!=="viewport"&&t.get("symbol-placement")!=="point",I=t.get("text-keep-upright"),M=t.get("text-size");for(const R of n.bucket.features){const N=t.get("text-font").evaluate(R,{},n.canonical).join(","),Z=M.evaluate(R,{},n.canonical),X=p.layoutTextSize.evaluate(R,{},n.canonical),ee=p.layoutIconSize.evaluate(R,{},n.canonical),se={horizontal:{},vertical:void 0},ae=R.text;let ke,we=[0,0];if(ae){const Re=ae.toString(),We=t.get("text-letter-spacing").evaluate(R,{},n.canonical)*Oi,ht=Rh(Re)?We:0,ut=t.get("text-anchor").evaluate(R,{},n.canonical),jt=t.get("text-variable-anchor");if(!jt){const Ut=t.get("text-radial-offset").evaluate(R,{},n.canonical);we=Ut?wm(ut,[Ut*Oi,lf]):t.get("text-offset").evaluate(R,{},n.canonical).map(Rt=>Rt*Oi)}let Gt=w?"center":t.get("text-justify").evaluate(R,{},n.canonical);const Ft=t.get("symbol-placement"),Lt=Ft==="point"?t.get("text-max-width").evaluate(R,{},n.canonical)*Oi:0,At=()=>{n.bucket.allowVerticalPlacement&&So(Re)&&(se.vertical=xu(ae,n.glyphMap,n.glyphPositions,n.imagePositions,N,Lt,y,ut,"left",ht,we,i.WritingMode.vertical,!0,Ft,X,Z))};if(!w&&jt){const Ut=Gt==="auto"?jt.map(xt=>cf(xt)):[Gt];let Rt=!1;for(let xt=0;xt<Ut.length;xt++){const rr=Ut[xt];if(!se.horizontal[rr])if(Rt)se.horizontal[rr]=se.horizontal[0];else{const Jt=xu(ae,n.glyphMap,n.glyphPositions,n.imagePositions,N,Lt,y,"center",rr,ht,we,i.WritingMode.horizontal,!1,Ft,X,Z);Jt&&(se.horizontal[rr]=Jt,Rt=Jt.positionedLines.length===1)}}At()}else{Gt==="auto"&&(Gt=cf(ut));const Ut=xu(ae,n.glyphMap,n.glyphPositions,n.imagePositions,N,Lt,y,ut,Gt,ht,we,i.WritingMode.horizontal,!1,Ft,X,Z);Ut&&(se.horizontal[Gt]=Ut),At(),So(Re)&&w&&I&&(se.vertical=xu(ae,n.glyphMap,n.glyphPositions,n.imagePositions,N,Lt,y,ut,Gt,ht,we,i.WritingMode.vertical,!1,Ft,X,Z))}}let Be=!1;if(R.icon&&R.icon.name){const Re=n.imageMap[R.icon.name];Re&&(ke=Sv(n.imagePositions[R.icon.name],t.get("icon-offset").evaluate(R,{},n.canonical),t.get("icon-anchor").evaluate(R,{},n.canonical)),Be=!!Re.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Be:n.bucket.sdfIcons!==Be&&q("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Re.pixelRatio!==n.bucket.pixelRatio||t.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const Ye=km(se.horizontal)||se.vertical;n.bucket.iconsInText=!!Ye&&Ye.iconsInText,(Ye||ke)&&Pv(n.bucket,R,se,ke,n.imageMap,p,X,ee,we,Be,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},i.perspective=function(n,t,l,p,y){var w,I=1/Math.tan(t/2);return n[0]=I/l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=I,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,y!=null&&y!==1/0?(n[10]=(y+p)*(w=1/(p-y)),n[14]=2*y*p*w):(n[10]=-1,n[14]=-2*p),n},i.pick=function(n,t){const l={};for(let p=0;p<t.length;p++){const y=t[p];y in n&&(l[y]=n[y])}return l},i.plugin=yn,i.pointGeometry=pt,i.polygonIntersectsPolygon=Cp,i.potpack=am,i.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.register=qt,i.registerForPluginStateChange=function(n){return n({pluginStatus:Yi,pluginURL:ps}),Tl.on("pluginStateChange",n),n},i.renderColorRamp=Fp,i.rotateX=function(n,t,l){var p=Math.sin(l),y=Math.cos(l),w=t[4],I=t[5],M=t[6],R=t[7],N=t[8],Z=t[9],X=t[10],ee=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=w*y+N*p,n[5]=I*y+Z*p,n[6]=M*y+X*p,n[7]=R*y+ee*p,n[8]=N*y-w*p,n[9]=Z*y-I*p,n[10]=X*y-M*p,n[11]=ee*y-R*p,n},i.rotateZ=function(n,t,l){var p=Math.sin(l),y=Math.cos(l),w=t[0],I=t[1],M=t[2],R=t[3],N=t[4],Z=t[5],X=t[6],ee=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=w*y+N*p,n[1]=I*y+Z*p,n[2]=M*y+X*p,n[3]=R*y+ee*p,n[4]=N*y-w*p,n[5]=Z*y-I*p,n[6]=X*y-M*p,n[7]=ee*y-R*p,n},i.scale=function(n,t,l){var p=l[0],y=l[1],w=l[2];return n[0]=t[0]*p,n[1]=t[1]*p,n[2]=t[2]*p,n[3]=t[3]*p,n[4]=t[4]*y,n[5]=t[5]*y,n[6]=t[6]*y,n[7]=t[7]*y,n[8]=t[8]*w,n[9]=t[9]*w,n[10]=t[10]*w,n[11]=t[11]*w,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},i.scale$1=function(n,t,l){return n[0]=t[0]*l,n[1]=t[1]*l,n[2]=t[2]*l,n},i.setCacheLimits=function(n,t){_e=n,ze=t},i.setRTLTextPlugin=function(n,t,l=!1){if(Yi===wl||Yi===Sl||Yi===kl)throw new Error("setRTLTextPlugin cannot be called multiple times.");ps=Qe.resolveURL(n),Yi=wl,El=t,ra(),l||nu()},i.spec=Fe,i.sphericalToCartesian=function([n,t,l]){return t+=90,t*=Math.PI/180,l*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(l),y:n*Math.sin(t)*Math.sin(l),z:n*Math.cos(l)}},i.sqrLen=function(n){var t=n[0],l=n[1];return t*t+l*l},i.sub=function(n,t,l){return n[0]=t[0]-l[0],n[1]=t[1]-l[1],n[2]=t[2]-l[2],n},i.toEvaluationFeature=qa,i.transformMat3=function(n,t,l){var p=t[0],y=t[1],w=t[2];return n[0]=p*l[0]+y*l[3]+w*l[6],n[1]=p*l[1]+y*l[4]+w*l[7],n[2]=p*l[2]+y*l[5]+w*l[8],n},i.transformMat4=du,i.transformMat4$1=function(n,t,l){var p=t[0],y=t[1];return n[0]=l[0]*p+l[4]*y+l[12],n[1]=l[1]*p+l[5]*y+l[13],n},i.translate=function(n,t,l){var p,y,w,I,M,R,N,Z,X,ee,se,ae,ke=l[0],we=l[1],Be=l[2];return t===n?(n[12]=t[0]*ke+t[4]*we+t[8]*Be+t[12],n[13]=t[1]*ke+t[5]*we+t[9]*Be+t[13],n[14]=t[2]*ke+t[6]*we+t[10]*Be+t[14],n[15]=t[3]*ke+t[7]*we+t[11]*Be+t[15]):(y=t[1],w=t[2],I=t[3],M=t[4],R=t[5],N=t[6],Z=t[7],X=t[8],ee=t[9],se=t[10],ae=t[11],n[0]=p=t[0],n[1]=y,n[2]=w,n[3]=I,n[4]=M,n[5]=R,n[6]=N,n[7]=Z,n[8]=X,n[9]=ee,n[10]=se,n[11]=ae,n[12]=p*ke+M*we+X*Be+t[12],n[13]=y*ke+R*we+ee*Be+t[13],n[14]=w*ke+N*we+se*Be+t[14],n[15]=I*ke+Z*we+ae*Be+t[15]),n},i.triggerPluginCompletionEvent=iu,i.unicodeBlockLookup=Nt,i.uniqueId=function(){return T++},i.validateCustomStyleLayer=function(n){const t=[],l=n.id;return l===void 0&&t.push({message:`layers.${l}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${l}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),t},i.validateLight=yl,i.validateStyle=Ba,i.vectorTile=aa,i.warnOnce=q,i.wrap=S}),h(["./shared"],function(i){function d(U){const L=typeof U;if(L==="number"||L==="boolean"||L==="string"||U==null)return JSON.stringify(U);if(Array.isArray(U)){let te="[";for(const he of U)te+=`${d(he)},`;return`${te}]`}const V=Object.keys(U).sort();let H="{";for(let te=0;te<V.length;te++)H+=`${JSON.stringify(V[te])}:${d(U[V[te]])},`;return`${H}}`}function g(U){let L="";for(const V of i.refProperties)L+=`/${d(U[V])}`;return L}class b{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,V){for(const te of L){this._layerConfigs[te.id]=te;const he=this._layers[te.id]=i.createStyleLayer(te);he._featureFilter=i.createFilter(he.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of V)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const H=function(te,he){const Te={};for(let ye=0;ye<te.length;ye++){const Ce=he&&he[te[ye].id]||g(te[ye]);he&&(he[te[ye].id]=Ce);let qe=Te[Ce];qe||(qe=Te[Ce]=[]),qe.push(te[ye])}const Se=[];for(const ye in Te)Se.push(Te[ye]);return Se}(Object.values(this._layerConfigs),this.keyCache);for(const te of H){const he=te.map(at=>this._layers[at.id]),Te=he[0];if(Te.visibility==="none")continue;const Se=Te.source||"";let ye=this.familiesBySource[Se];ye||(ye=this.familiesBySource[Se]={});const Ce=Te.sourceLayer||"_geojsonTileLayer";let qe=ye[Ce];qe||(qe=ye[Ce]=[]),qe.push(he)}}}class k{constructor(L){const V={},H=[];for(const Se in L){const ye=L[Se],Ce=V[Se]={};for(const qe in ye){const at=ye[+qe];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Le={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};H.push(Le),Ce[qe]={rect:Le,metrics:at.metrics}}}const{w:te,h:he}=i.potpack(H),Te=new i.AlphaImage({width:te||1,height:he||1});for(const Se in L){const ye=L[Se];for(const Ce in ye){const qe=ye[+Ce];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const at=V[Se][Ce].rect;i.AlphaImage.copy(qe.bitmap,Te,{x:0,y:0},{x:at.x+1,y:at.y+1},qe.bitmap)}}this.image=Te,this.positions=V}}i.register("GlyphAtlas",k);class x{constructor(L){this.tileID=new i.OverscaledTileID(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId}parse(L,V,H,te,he){this.status="parsing",this.data=L,this.collisionBoxArray=new i.CollisionBoxArray;const Te=new i.DictionaryCoder(Object.keys(L.layers).sort()),Se=new i.FeatureIndex(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const ye={},Ce={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},qe=V.familiesBySource[this.source];for(const or in qe){const fr=L.layers[or];if(!fr)continue;fr.version===1&&i.warnOnce(`Vector tile source "${this.source}" layer "${or}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dr=Te.encode(or),Er=[];for(let Qr=0;Qr<fr.length;Qr++){const Dr=fr.feature(Qr),di=Se.getId(Dr,or);Er.push({feature:Dr,id:di,index:Qr,sourceLayerIndex:dr})}for(const Qr of qe[or]){const Dr=Qr[0];Dr.source!==this.source&&i.warnOnce(`layer.source = ${Dr.source} does not equal this.source = ${this.source}`),Dr.minzoom&&this.zoom<Math.floor(Dr.minzoom)||Dr.maxzoom&&this.zoom>=Dr.maxzoom||Dr.visibility!=="none"&&(S(Qr,this.zoom,H),(ye[Dr.id]=Dr.createBucket({index:Se.bucketLayerIDs.length,layers:Qr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dr,sourceID:this.source})).populate(Er,Ce,this.tileID.canonical),Se.bucketLayerIDs.push(Qr.map(di=>di.id)))}}let at,Le,It,Pt;const bt=i.mapObject(Ce.glyphDependencies,or=>Object.keys(or).map(Number));Object.keys(bt).length?te.send("getGlyphs",{uid:this.uid,stacks:bt},(or,fr)=>{at||(at=or,Le=fr,mr.call(this))}):Le={};const Xt=Object.keys(Ce.iconDependencies);Xt.length?te.send("getImages",{icons:Xt,source:this.source,tileID:this.tileID,type:"icons"},(or,fr)=>{at||(at=or,It=fr,mr.call(this))}):It={};const Yt=Object.keys(Ce.patternDependencies);function mr(){if(at)return he(at);if(Le&&It&&Pt){const or=new k(Le),fr=new i.ImageAtlas(It,Pt);for(const dr in ye){const Er=ye[dr];Er instanceof i.SymbolBucket?(S(Er.layers,this.zoom,H),i.performSymbolLayout({bucket:Er,glyphMap:Le,glyphPositions:or.positions,imageMap:It,imagePositions:fr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Er.hasPattern&&(Er instanceof i.LineBucket||Er instanceof i.FillBucket||Er instanceof i.FillExtrusionBucket)&&(S(Er.layers,this.zoom,H),Er.addFeatures(Ce,this.tileID.canonical,fr.patternPositions))}this.status="done",he(null,{buckets:Object.values(ye).filter(dr=>!dr.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:or.image,imageAtlas:fr,glyphMap:this.returnDependencies?Le:null,iconMap:this.returnDependencies?It:null,glyphPositions:this.returnDependencies?or.positions:null})}}Yt.length?te.send("getImages",{icons:Yt,source:this.source,tileID:this.tileID,type:"patterns"},(or,fr)=>{at||(at=or,Pt=fr,mr.call(this))}):Pt={},mr.call(this)}}function S(U,L,V){const H=new i.EvaluationParameters(L);for(const te of U)te.recalculate(H,V)}function E(U,L){const V=i.getArrayBuffer(U.request,(H,te,he,Te)=>{H?L(H):te&&L(null,{vectorTile:new i.vectorTile.VectorTile(new i.pbf(te)),rawData:te,cacheControl:he,expires:Te})});return()=>{V.cancel(),L()}}class T{constructor(L,V,H,te){this.actor=L,this.layerIndex=V,this.availableImages=H,this.loadVectorData=te||E,this.loading={},this.loaded={}}loadTile(L,V){const H=L.uid;this.loading||(this.loading={});const te=!!(L&&L.request&&L.request.collectResourceTiming)&&new i.RequestPerformance(L.request),he=this.loading[H]=new x(L);he.abort=this.loadVectorData(L,(Te,Se)=>{if(delete this.loading[H],Te||!Se)return he.status="done",this.loaded[H]=he,V(Te);const ye=Se.rawData,Ce={};Se.expires&&(Ce.expires=Se.expires),Se.cacheControl&&(Ce.cacheControl=Se.cacheControl);const qe={};if(te){const at=te.finish();at&&(qe.resourceTiming=JSON.parse(JSON.stringify(at)))}he.vectorTile=Se.vectorTile,he.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,(at,Le)=>{if(at||!Le)return V(at);V(null,i.extend({rawTileData:ye.slice(0)},Le,Ce,qe))}),this.loaded=this.loaded||{},this.loaded[H]=he})}reloadTile(L,V){const H=this.loaded,te=L.uid,he=this;if(H&&H[te]){const Te=H[te];Te.showCollisionBoxes=L.showCollisionBoxes;const Se=(ye,Ce)=>{const qe=Te.reloadCallback;qe&&(delete Te.reloadCallback,Te.parse(Te.vectorTile,he.layerIndex,this.availableImages,he.actor,qe)),V(ye,Ce)};Te.status==="parsing"?Te.reloadCallback=Se:Te.status==="done"&&(Te.vectorTile?Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.actor,Se):Se())}}abortTile(L,V){const H=this.loading,te=L.uid;H&&H[te]&&H[te].abort&&(H[te].abort(),delete H[te]),V()}removeTile(L,V){const H=this.loaded,te=L.uid;H&&H[te]&&delete H[te],V()}}class A{constructor(){this.loaded={}}loadTile(L,V){const{uid:H,encoding:te,rawImageData:he}=L,Te=i.isImageBitmap(he)?this.getImageData(he):he,Se=new i.DEMData(H,Te,te);this.loaded=this.loaded||{},this.loaded[H]=Se,V(null,Se)}getImageData(L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const V=this.offscreenCanvasContext.getImageData(-1,-1,L.width+2,L.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new i.RGBAImage({width:V.width,height:V.height},V.data)}removeTile(L){const V=this.loaded,H=L.uid;V&&V[H]&&delete V[H]}}var z=function U(L,V){var H,te=L&&L.type;if(te==="FeatureCollection")for(H=0;H<L.features.length;H++)U(L.features[H],V);else if(te==="GeometryCollection")for(H=0;H<L.geometries.length;H++)U(L.geometries[H],V);else if(te==="Feature")U(L.geometry,V);else if(te==="Polygon")D(L.coordinates,V);else if(te==="MultiPolygon")for(H=0;H<L.coordinates.length;H++)D(L.coordinates[H],V);return L};function D(U,L){if(U.length!==0){F(U[0],L);for(var V=1;V<U.length;V++)F(U[V],!L)}}function F(U,L){for(var V=0,H=0,te=0,he=U.length,Te=he-1;te<he;Te=te++){var Se=(U[te][0]-U[Te][0])*(U[Te][1]+U[te][1]),ye=V+Se;H+=Math.abs(V)>=Math.abs(Se)?V-ye+Se:Se-ye+V,V=ye}V+H>=0!=!!L&&U.reverse()}const $=i.vectorTile.VectorTileFeature.prototype.toGeoJSON;class q{constructor(L){this._feature=L,this.extent=i.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const V of this._feature.geometry)L.push([new i.pointGeometry(V[0],V[1])]);return L}{const L=[];for(const V of this._feature.geometry){const H=[];for(const te of V)H.push(new i.pointGeometry(te[0],te[1]));L.push(H)}return L}}toGeoJSON(L,V,H){return $.call(this,L,V,H)}}class J{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=L.length,this._features=L}feature(L){return new q(this._features[L])}}var G={exports:{}},oe=i.pointGeometry,de=i.vectorTile.VectorTileFeature,Ee=ot;function ot(U,L){this.options=L||{},this.features=U,this.length=U.length}function le(U,L){this.id=typeof U.id=="number"?U.id:void 0,this.type=U.type,this.rawGeometry=U.type===1?[U.geometry]:U.geometry,this.properties=U.tags,this.extent=L||4096}ot.prototype.feature=function(U){return new le(this.features[U],this.options.extent)},le.prototype.loadGeometry=function(){var U=this.rawGeometry;this.geometry=[];for(var L=0;L<U.length;L++){for(var V=U[L],H=[],te=0;te<V.length;te++)H.push(new oe(V[te][0],V[te][1]));this.geometry.push(H)}return this.geometry},le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var U=this.geometry,L=1/0,V=-1/0,H=1/0,te=-1/0,he=0;he<U.length;he++)for(var Te=U[he],Se=0;Se<Te.length;Se++){var ye=Te[Se];L=Math.min(L,ye.x),V=Math.max(V,ye.x),H=Math.min(H,ye.y),te=Math.max(te,ye.y)}return[L,H,V,te]},le.prototype.toGeoJSON=de.prototype.toGeoJSON;var Ne=i.pbf,Y=Ee;function Qe(U){var L=new Ne;return function(V,H){for(var te in V.layers)H.writeMessage(3,pt,V.layers[te])}(U,L),L.finish()}function pt(U,L){var V;L.writeVarintField(15,U.version||1),L.writeStringField(1,U.name||""),L.writeVarintField(5,U.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<U.length;V++)H.feature=U.feature(V),L.writeMessage(2,dt,H);var te=H.keys;for(V=0;V<te.length;V++)L.writeStringField(3,te[V]);var he=H.values;for(V=0;V<he.length;V++)L.writeMessage(4,_e,he[V])}function dt(U,L){var V=U.feature;V.id!==void 0&&L.writeVarintField(1,V.id),L.writeMessage(2,Zt,U),L.writeVarintField(3,V.type),L.writeMessage(4,ce,V)}function Zt(U,L){var V=U.feature,H=U.keys,te=U.values,he=U.keycache,Te=U.valuecache;for(var Se in V.properties){var ye=V.properties[Se],Ce=he[Se];if(ye!==null){Ce===void 0&&(H.push(Se),he[Se]=Ce=H.length-1),L.writeVarint(Ce);var qe=typeof ye;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(ye=JSON.stringify(ye));var at=qe+":"+ye,Le=Te[at];Le===void 0&&(te.push(ye),Te[at]=Le=te.length-1),L.writeVarint(Le)}}}function nt(U,L){return(L<<3)+(7&U)}function tt(U){return U<<1^U>>31}function ce(U,L){for(var V=U.loadGeometry(),H=U.type,te=0,he=0,Te=V.length,Se=0;Se<Te;Se++){var ye=V[Se],Ce=1;H===1&&(Ce=ye.length),L.writeVarint(nt(1,Ce));for(var qe=H===3?ye.length-1:ye.length,at=0;at<qe;at++){at===1&&H!==1&&L.writeVarint(nt(2,qe-1));var Le=ye[at].x-te,It=ye[at].y-he;L.writeVarint(tt(Le)),L.writeVarint(tt(It)),te+=Le,he+=It}H===3&&L.writeVarint(nt(7,1))}}function _e(U,L){var V=typeof U;V==="string"?L.writeStringField(1,U):V==="boolean"?L.writeBooleanField(7,U):V==="number"&&(U%1!=0?L.writeDoubleField(3,U):U<0?L.writeSVarintField(6,U):L.writeVarintField(5,U))}function ze(U,L,V,H,te,he){if(te-H<=V)return;const Te=H+te>>1;re(U,L,Te,H,te,he%2),ze(U,L,V,H,Te-1,he+1),ze(U,L,V,Te+1,te,he+1)}function re(U,L,V,H,te,he){for(;te>H;){if(te-H>600){const Ce=te-H+1,qe=V-H+1,at=Math.log(Ce),Le=.5*Math.exp(2*at/3),It=.5*Math.sqrt(at*Le*(Ce-Le)/Ce)*(qe-Ce/2<0?-1:1);re(U,L,V,Math.max(H,Math.floor(V-qe*Le/Ce+It)),Math.min(te,Math.floor(V+(Ce-qe)*Le/Ce+It)),he)}const Te=L[2*V+he];let Se=H,ye=te;for(ue(U,L,H,V),L[2*te+he]>Te&&ue(U,L,H,te);Se<ye;){for(ue(U,L,Se,ye),Se++,ye--;L[2*Se+he]<Te;)Se++;for(;L[2*ye+he]>Te;)ye--}L[2*H+he]===Te?ue(U,L,H,ye):(ye++,ue(U,L,ye,te)),ye<=V&&(H=ye+1),V<=ye&&(te=ye-1)}}function ue(U,L,V,H){Xe(U,V,H),Xe(L,2*V,2*H),Xe(L,2*V+1,2*H+1)}function Xe(U,L,V){const H=U[L];U[L]=U[V],U[V]=H}function wt(U,L,V,H){const te=U-V,he=L-H;return te*te+he*he}G.exports=Qe,G.exports.fromVectorTileJs=Qe,G.exports.fromGeojsonVt=function(U,L){L=L||{};var V={};for(var H in U)V[H]=new Y(U[H].features,L),V[H].name=H,V[H].version=L.version,V[H].extent=L.extent;return Qe({layers:V})},G.exports.GeoJSONWrapper=Y;const mt=U=>U[0],Ke=U=>U[1];class Ot{constructor(L,V=mt,H=Ke,te=64,he=Float64Array){this.nodeSize=te,this.points=L;const Te=L.length<65536?Uint16Array:Uint32Array,Se=this.ids=new Te(L.length),ye=this.coords=new he(2*L.length);for(let Ce=0;Ce<L.length;Ce++)Se[Ce]=Ce,ye[2*Ce]=V(L[Ce]),ye[2*Ce+1]=H(L[Ce]);ze(Se,ye,te,0,Se.length-1,0)}range(L,V,H,te){return function(he,Te,Se,ye,Ce,qe,at){const Le=[0,he.length-1,0],It=[];let Pt,bt;for(;Le.length;){const Xt=Le.pop(),Yt=Le.pop(),mr=Le.pop();if(Yt-mr<=at){for(let dr=mr;dr<=Yt;dr++)Pt=Te[2*dr],bt=Te[2*dr+1],Pt>=Se&&Pt<=Ce&&bt>=ye&&bt<=qe&&It.push(he[dr]);continue}const or=Math.floor((mr+Yt)/2);Pt=Te[2*or],bt=Te[2*or+1],Pt>=Se&&Pt<=Ce&&bt>=ye&&bt<=qe&&It.push(he[or]);const fr=(Xt+1)%2;(Xt===0?Se<=Pt:ye<=bt)&&(Le.push(mr),Le.push(or-1),Le.push(fr)),(Xt===0?Ce>=Pt:qe>=bt)&&(Le.push(or+1),Le.push(Yt),Le.push(fr))}return It}(this.ids,this.coords,L,V,H,te,this.nodeSize)}within(L,V,H){return function(te,he,Te,Se,ye,Ce){const qe=[0,te.length-1,0],at=[],Le=ye*ye;for(;qe.length;){const It=qe.pop(),Pt=qe.pop(),bt=qe.pop();if(Pt-bt<=Ce){for(let fr=bt;fr<=Pt;fr++)wt(he[2*fr],he[2*fr+1],Te,Se)<=Le&&at.push(te[fr]);continue}const Xt=Math.floor((bt+Pt)/2),Yt=he[2*Xt],mr=he[2*Xt+1];wt(Yt,mr,Te,Se)<=Le&&at.push(te[Xt]);const or=(It+1)%2;(It===0?Te-ye<=Yt:Se-ye<=mr)&&(qe.push(bt),qe.push(Xt-1),qe.push(or)),(It===0?Te+ye>=Yt:Se+ye>=mr)&&(qe.push(Xt+1),qe.push(Pt),qe.push(or))}return at}(this.ids,this.coords,L,V,H,this.nodeSize)}}const er={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:U=>U},Lr=Math.fround||(Fr=new Float32Array(1),U=>(Fr[0]=+U,Fr[0]));var Fr;class K{constructor(L){this.options=je(Object.create(er),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:V,minZoom:H,maxZoom:te,nodeSize:he}=this.options;V&&console.time("total time");const Te=`prepare ${L.length} points`;V&&console.time(Te),this.points=L;let Se=[];for(let ye=0;ye<L.length;ye++)L[ye].geometry&&Se.push(et(L[ye],ye));this.trees[te+1]=new Ot(Se,vt,Bt,he,Float32Array),V&&console.timeEnd(Te);for(let ye=te;ye>=H;ye--){const Ce=+Date.now();Se=this._cluster(Se,ye),this.trees[ye]=new Ot(Se,vt,Bt,he,Float32Array),V&&console.log("z%d: %d clusters in %dms",ye,Se.length,+Date.now()-Ce)}return V&&console.timeEnd("total time"),this}getClusters(L,V){let H=((L[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,L[1]));let he=L[2]===180?180:((L[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)H=-180,he=180;else if(H>he){const qe=this.getClusters([H,te,180,Te],V),at=this.getClusters([-180,te,he,Te],V);return qe.concat(at)}const Se=this.trees[this._limitZoom(V)],ye=Se.range(Ie(H),ft(Te),Ie(he),ft(te)),Ce=[];for(const qe of ye){const at=Se.points[qe];Ce.push(at.numPoints?be(at):this.points[at.index])}return Ce}getChildren(L){const V=this._getOriginId(L),H=this._getOriginZoom(L),te="No cluster with the specified id.",he=this.trees[H];if(!he)throw new Error(te);const Te=he.points[V];if(!Te)throw new Error(te);const Se=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ye=he.within(Te.x,Te.y,Se),Ce=[];for(const qe of ye){const at=he.points[qe];at.parentId===L&&Ce.push(at.numPoints?be(at):this.points[at.index])}if(Ce.length===0)throw new Error(te);return Ce}getLeaves(L,V,H){const te=[];return this._appendLeaves(te,L,V=V||10,H=H||0,0),te}getTile(L,V,H){const te=this.trees[this._limitZoom(L)],he=Math.pow(2,L),{extent:Te,radius:Se}=this.options,ye=Se/Te,Ce=(H-ye)/he,qe=(H+1+ye)/he,at={features:[]};return this._addTileFeatures(te.range((V-ye)/he,Ce,(V+1+ye)/he,qe),te.points,V,H,he,at),V===0&&this._addTileFeatures(te.range(1-ye/he,Ce,1,qe),te.points,he,H,he,at),V===he-1&&this._addTileFeatures(te.range(0,Ce,ye/he,qe),te.points,-1,H,he,at),at.features.length?at:null}getClusterExpansionZoom(L){let V=this._getOriginZoom(L)-1;for(;V<=this.options.maxZoom;){const H=this.getChildren(L);if(V++,H.length!==1)break;L=H[0].properties.cluster_id}return V}_appendLeaves(L,V,H,te,he){const Te=this.getChildren(V);for(const Se of Te){const ye=Se.properties;if(ye&&ye.cluster?he+ye.point_count<=te?he+=ye.point_count:he=this._appendLeaves(L,ye.cluster_id,H,te,he):he<te?he++:L.push(Se),L.length===H)break}return he}_addTileFeatures(L,V,H,te,he,Te){for(const Se of L){const ye=V[Se],Ce=ye.numPoints;let qe,at,Le;if(Ce)qe=me(ye),at=ye.x,Le=ye.y;else{const bt=this.points[ye.index];qe=bt.properties,at=Ie(bt.geometry.coordinates[0]),Le=ft(bt.geometry.coordinates[1])}const It={type:1,geometry:[[Math.round(this.options.extent*(at*he-H)),Math.round(this.options.extent*(Le*he-te))]],tags:qe};let Pt;Ce?Pt=ye.id:this.options.generateId?Pt=ye.index:this.points[ye.index].id&&(Pt=this.points[ye.index].id),Pt!==void 0&&(It.id=Pt),Te.features.push(It)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,V){const H=[],{radius:te,extent:he,reduce:Te,minPoints:Se}=this.options,ye=te/(he*Math.pow(2,V));for(let Ce=0;Ce<L.length;Ce++){const qe=L[Ce];if(qe.zoom<=V)continue;qe.zoom=V;const at=this.trees[V+1],Le=at.within(qe.x,qe.y,ye),It=qe.numPoints||1;let Pt=It;for(const bt of Le){const Xt=at.points[bt];Xt.zoom>V&&(Pt+=Xt.numPoints||1)}if(Pt>It&&Pt>=Se){let bt=qe.x*It,Xt=qe.y*It,Yt=Te&&It>1?this._map(qe,!0):null;const mr=(Ce<<5)+(V+1)+this.points.length;for(const or of Le){const fr=at.points[or];if(fr.zoom<=V)continue;fr.zoom=V;const dr=fr.numPoints||1;bt+=fr.x*dr,Xt+=fr.y*dr,fr.parentId=mr,Te&&(Yt||(Yt=this._map(qe,!0)),Te(Yt,this._map(fr)))}qe.parentId=mr,H.push(ct(bt/Pt,Xt/Pt,mr,Pt,Yt))}else if(H.push(qe),Pt>1)for(const bt of Le){const Xt=at.points[bt];Xt.zoom<=V||(Xt.zoom=V,H.push(Xt))}}return H}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,V){if(L.numPoints)return V?je({},L.properties):L.properties;const H=this.points[L.index].properties,te=this.options.map(H);return V&&te===H?je({},te):te}}function ct(U,L,V,H,te){return{x:Lr(U),y:Lr(L),zoom:1/0,id:V,parentId:-1,numPoints:H,properties:te}}function et(U,L){const[V,H]=U.geometry.coordinates;return{x:Lr(Ie(V)),y:Lr(ft(H)),zoom:1/0,index:L,parentId:-1}}function be(U){return{type:"Feature",id:U.id,properties:me(U),geometry:{type:"Point",coordinates:[(L=U.x,360*(L-.5)),gt(U.y)]}};var L}function me(U){const L=U.numPoints,V=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return je(je({},U.properties),{cluster:!0,cluster_id:U.id,point_count:L,point_count_abbreviated:V})}function Ie(U){return U/360+.5}function ft(U){const L=Math.sin(U*Math.PI/180),V=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return V<0?0:V>1?1:V}function gt(U){const L=(180-360*U)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function je(U,L){for(const V in L)U[V]=L[V];return U}function vt(U){return U.x}function Bt(U){return U.y}function Et(U,L,V,H){for(var te,he=H,Te=V-L>>1,Se=V-L,ye=U[L],Ce=U[L+1],qe=U[V],at=U[V+1],Le=L+3;Le<V;Le+=3){var It=Ht(U[Le],U[Le+1],ye,Ce,qe,at);if(It>he)te=Le,he=It;else if(It===he){var Pt=Math.abs(Le-Te);Pt<Se&&(te=Le,Se=Pt)}}he>H&&(te-L>3&&Et(U,L,te,H),U[te+2]=he,V-te>3&&Et(U,te,V,H))}function Ht(U,L,V,H,te,he){var Te=te-V,Se=he-H;if(Te!==0||Se!==0){var ye=((U-V)*Te+(L-H)*Se)/(Te*Te+Se*Se);ye>1?(V=te,H=he):ye>0&&(V+=Te*ye,H+=Se*ye)}return(Te=U-V)*Te+(Se=L-H)*Se}function wr(U,L,V,H){var te={id:U===void 0?null:U,type:L,geometry:V,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var Te=he.geometry,Se=he.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")Fe(he,Te);else if(Se==="Polygon"||Se==="MultiLineString")for(var ye=0;ye<Te.length;ye++)Fe(he,Te[ye]);else if(Se==="MultiPolygon")for(ye=0;ye<Te.length;ye++)for(var Ce=0;Ce<Te[ye].length;Ce++)Fe(he,Te[ye][Ce])}(te),te}function Fe(U,L){for(var V=0;V<L.length;V+=3)U.minX=Math.min(U.minX,L[V]),U.minY=Math.min(U.minY,L[V+1]),U.maxX=Math.max(U.maxX,L[V]),U.maxY=Math.max(U.maxY,L[V+1])}function _t(U,L,V,H){if(L.geometry){var te=L.geometry.coordinates,he=L.geometry.type,Te=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Se=[],ye=L.id;if(V.promoteId?ye=L.properties[V.promoteId]:V.generateId&&(ye=H||0),he==="Point")gi(te,Se);else if(he==="MultiPoint")for(var Ce=0;Ce<te.length;Ce++)gi(te[Ce],Se);else if(he==="LineString")ri(te,Se,Te,!1);else if(he==="MultiLineString"){if(V.lineMetrics){for(Ce=0;Ce<te.length;Ce++)ri(te[Ce],Se=[],Te,!1),U.push(wr(ye,"LineString",Se,L.properties));return}yr(te,Se,Te,!1)}else if(he==="Polygon")yr(te,Se,Te,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(Ce=0;Ce<L.geometry.geometries.length;Ce++)_t(U,{id:ye,geometry:L.geometry.geometries[Ce],properties:L.properties},V,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<te.length;Ce++){var qe=[];yr(te[Ce],qe,Te,!0),Se.push(qe)}}U.push(wr(ye,he,Se,L.properties))}}function gi(U,L){L.push(kr(U[0])),L.push(_i(U[1])),L.push(0)}function ri(U,L,V,H){for(var te,he,Te=0,Se=0;Se<U.length;Se++){var ye=kr(U[Se][0]),Ce=_i(U[Se][1]);L.push(ye),L.push(Ce),L.push(0),Se>0&&(Te+=H?(te*Ce-ye*he)/2:Math.sqrt(Math.pow(ye-te,2)+Math.pow(Ce-he,2))),te=ye,he=Ce}var qe=L.length-3;L[2]=1,Et(L,0,qe,V),L[qe+2]=1,L.size=Math.abs(Te),L.start=0,L.end=L.size}function yr(U,L,V,H){for(var te=0;te<U.length;te++){var he=[];ri(U[te],he,V,H),L.push(he)}}function kr(U){return U/360+.5}function _i(U){var L=Math.sin(U*Math.PI/180),V=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return V<0?0:V>1?1:V}function ki(U,L,V,H,te,he,Te,Se){if(H/=L,he>=(V/=L)&&Te<H)return U;if(Te<V||he>=H)return null;for(var ye=[],Ce=0;Ce<U.length;Ce++){var qe=U[Ce],at=qe.geometry,Le=qe.type,It=te===0?qe.minX:qe.minY,Pt=te===0?qe.maxX:qe.maxY;if(It>=V&&Pt<H)ye.push(qe);else if(!(Pt<V||It>=H)){var bt=[];if(Le==="Point"||Le==="MultiPoint")yi(at,bt,V,H,te);else if(Le==="LineString")Tt(at,bt,V,H,te,!1,Se.lineMetrics);else if(Le==="MultiLineString")hr(at,bt,V,H,te,!1);else if(Le==="Polygon")hr(at,bt,V,H,te,!0);else if(Le==="MultiPolygon")for(var Xt=0;Xt<at.length;Xt++){var Yt=[];hr(at[Xt],Yt,V,H,te,!0),Yt.length&&bt.push(Yt)}if(bt.length){if(Se.lineMetrics&&Le==="LineString"){for(Xt=0;Xt<bt.length;Xt++)ye.push(wr(qe.id,Le,bt[Xt],qe.tags));continue}Le!=="LineString"&&Le!=="MultiLineString"||(bt.length===1?(Le="LineString",bt=bt[0]):Le="MultiLineString"),Le!=="Point"&&Le!=="MultiPoint"||(Le=bt.length===3?"Point":"MultiPoint"),ye.push(wr(qe.id,Le,bt,qe.tags))}}}return ye.length?ye:null}function yi(U,L,V,H,te){for(var he=0;he<U.length;he+=3){var Te=U[he+te];Te>=V&&Te<=H&&(L.push(U[he]),L.push(U[he+1]),L.push(U[he+2]))}}function Tt(U,L,V,H,te,he,Te){for(var Se,ye,Ce=pr(U),qe=te===0?sn:ar,at=U.start,Le=0;Le<U.length-3;Le+=3){var It=U[Le],Pt=U[Le+1],bt=U[Le+2],Xt=U[Le+3],Yt=U[Le+4],mr=te===0?It:Pt,or=te===0?Xt:Yt,fr=!1;Te&&(Se=Math.sqrt(Math.pow(It-Xt,2)+Math.pow(Pt-Yt,2))),mr<V?or>V&&(ye=qe(Ce,It,Pt,Xt,Yt,V),Te&&(Ce.start=at+Se*ye)):mr>H?or<H&&(ye=qe(Ce,It,Pt,Xt,Yt,H),Te&&(Ce.start=at+Se*ye)):vi(Ce,It,Pt,bt),or<V&&mr>=V&&(ye=qe(Ce,It,Pt,Xt,Yt,V),fr=!0),or>H&&mr<=H&&(ye=qe(Ce,It,Pt,Xt,Yt,H),fr=!0),!he&&fr&&(Te&&(Ce.end=at+Se*ye),L.push(Ce),Ce=pr(U)),Te&&(at+=Se)}var dr=U.length-3;It=U[dr],Pt=U[dr+1],bt=U[dr+2],(mr=te===0?It:Pt)>=V&&mr<=H&&vi(Ce,It,Pt,bt),dr=Ce.length-3,he&&dr>=3&&(Ce[dr]!==Ce[0]||Ce[dr+1]!==Ce[1])&&vi(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&L.push(Ce)}function pr(U){var L=[];return L.size=U.size,L.start=U.start,L.end=U.end,L}function hr(U,L,V,H,te,he){for(var Te=0;Te<U.length;Te++)Tt(U[Te],L,V,H,te,he,!1)}function vi(U,L,V,H){U.push(L),U.push(V),U.push(H)}function sn(U,L,V,H,te,he){var Te=(he-L)/(H-L);return U.push(he),U.push(V+(te-V)*Te),U.push(1),Te}function ar(U,L,V,H,te,he){var Te=(he-V)/(te-V);return U.push(L+(H-L)*Te),U.push(he),U.push(1),Te}function $i(U,L){for(var V=[],H=0;H<U.length;H++){var te,he=U[H],Te=he.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")te=ii(he.geometry,L);else if(Te==="MultiLineString"||Te==="Polygon"){te=[];for(var Se=0;Se<he.geometry.length;Se++)te.push(ii(he.geometry[Se],L))}else if(Te==="MultiPolygon")for(te=[],Se=0;Se<he.geometry.length;Se++){for(var ye=[],Ce=0;Ce<he.geometry[Se].length;Ce++)ye.push(ii(he.geometry[Se][Ce],L));te.push(ye)}V.push(wr(he.id,Te,te,he.tags))}return V}function ii(U,L){var V=[];V.size=U.size,U.start!==void 0&&(V.start=U.start,V.end=U.end);for(var H=0;H<U.length;H+=3)V.push(U[H]+L,U[H+1],U[H+2]);return V}function ls(U,L){if(U.transformed)return U;var V,H,te,he=1<<U.z,Te=U.x,Se=U.y;for(V=0;V<U.features.length;V++){var ye=U.features[V],Ce=ye.geometry,qe=ye.type;if(ye.geometry=[],qe===1)for(H=0;H<Ce.length;H+=2)ye.geometry.push(hi(Ce[H],Ce[H+1],L,he,Te,Se));else for(H=0;H<Ce.length;H++){var at=[];for(te=0;te<Ce[H].length;te+=2)at.push(hi(Ce[H][te],Ce[H][te+1],L,he,Te,Se));ye.geometry.push(at)}}return U.transformed=!0,U}function hi(U,L,V,H,te,he){return[Math.round(V*(U*H-te)),Math.round(V*(L*H-he))]}function Li(U,L,V,H,te){for(var he=L===te.maxZoom?0:te.tolerance/((1<<L)*te.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:H,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Se=0;Se<U.length;Se++){Te.numFeatures++,Rr(Te,U[Se],he,te);var ye=U[Se].minX,Ce=U[Se].minY,qe=U[Se].maxX,at=U[Se].maxY;ye<Te.minX&&(Te.minX=ye),Ce<Te.minY&&(Te.minY=Ce),qe>Te.maxX&&(Te.maxX=qe),at>Te.maxY&&(Te.maxY=at)}return Te}function Rr(U,L,V,H){var te=L.geometry,he=L.type,Te=[];if(he==="Point"||he==="MultiPoint")for(var Se=0;Se<te.length;Se+=3)Te.push(te[Se]),Te.push(te[Se+1]),U.numPoints++,U.numSimplified++;else if(he==="LineString")jn(Te,te,U,V,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(Se=0;Se<te.length;Se++)jn(Te,te[Se],U,V,he==="Polygon",Se===0);else if(he==="MultiPolygon")for(var ye=0;ye<te.length;ye++){var Ce=te[ye];for(Se=0;Se<Ce.length;Se++)jn(Te,Ce[Se],U,V,!0,Se===0)}if(Te.length){var qe=L.tags||null;if(he==="LineString"&&H.lineMetrics){for(var at in qe={},L.tags)qe[at]=L.tags[at];qe.mapbox_clip_start=te.start/te.size,qe.mapbox_clip_end=te.end/te.size}var Le={geometry:Te,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:qe};L.id!==null&&(Le.id=L.id),U.features.push(Le)}}function jn(U,L,V,H,te,he){var Te=H*H;if(H>0&&L.size<(te?Te:H))V.numPoints+=L.length/3;else{for(var Se=[],ye=0;ye<L.length;ye+=3)(H===0||L[ye+2]>Te)&&(V.numSimplified++,Se.push(L[ye]),Se.push(L[ye+1])),V.numPoints++;te&&function(Ce,qe){for(var at=0,Le=0,It=Ce.length,Pt=It-2;Le<It;Pt=Le,Le+=2)at+=(Ce[Le]-Ce[Pt])*(Ce[Le+1]+Ce[Pt+1]);if(at>0===qe)for(Le=0,It=Ce.length;Le<It/2;Le+=2){var bt=Ce[Le],Xt=Ce[Le+1];Ce[Le]=Ce[It-2-Le],Ce[Le+1]=Ce[It-1-Le],Ce[It-2-Le]=bt,Ce[It-1-Le]=Xt}}(Se,he),U.push(Se)}}function _n(U,L){var V=(L=this.options=function(te,he){for(var Te in he)te[Te]=he[Te];return te}(Object.create(this.options),L)).debug;if(V&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(te,he){var Te=[];if(te.type==="FeatureCollection")for(var Se=0;Se<te.features.length;Se++)_t(Te,te.features[Se],he,Se);else _t(Te,te.type==="Feature"?te:{geometry:te},he);return Te}(U,L);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(te,he){var Te=he.buffer/he.extent,Se=te,ye=ki(te,1,-1-Te,Te,0,-1,2,he),Ce=ki(te,1,1-Te,2+Te,0,-1,2,he);return(ye||Ce)&&(Se=ki(te,1,-Te,1+Te,0,-1,2,he)||[],ye&&(Se=$i(ye,1).concat(Se)),Ce&&(Se=Se.concat($i(Ce,-1)))),Se}(H,L),H.length&&this.splitTile(H,0,0,0),V&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function zn(U,L,V){return 32*((1<<U)*V+L)+U}function qn(U,L){const V=U.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const H=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!H)return L(null,null);const te=new J(H.features);let he=G.exports(te);he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),L(null,{vectorTile:te,rawData:he.buffer})}_n.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_n.prototype.splitTile=function(U,L,V,H,te,he,Te){for(var Se=[U,L,V,H],ye=this.options,Ce=ye.debug;Se.length;){H=Se.pop(),V=Se.pop(),L=Se.pop(),U=Se.pop();var qe=1<<L,at=zn(L,V,H),Le=this.tiles[at];if(!Le&&(Ce>1&&console.time("creation"),Le=this.tiles[at]=Li(U,L,V,H,ye),this.tileCoords.push({z:L,x:V,y:H}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,V,H,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var It="z"+L;this.stats[It]=(this.stats[It]||0)+1,this.total++}if(Le.source=U,te){if(L===ye.maxZoom||L===te)continue;var Pt=1<<te-L;if(V!==Math.floor(he/Pt)||H!==Math.floor(Te/Pt))continue}else if(L===ye.indexMaxZoom||Le.numPoints<=ye.indexMaxPoints)continue;if(Le.source=null,U.length!==0){Ce>1&&console.time("clipping");var bt,Xt,Yt,mr,or,fr,dr=.5*ye.buffer/ye.extent,Er=.5-dr,Qr=.5+dr,Dr=1+dr;bt=Xt=Yt=mr=null,or=ki(U,qe,V-dr,V+Qr,0,Le.minX,Le.maxX,ye),fr=ki(U,qe,V+Er,V+Dr,0,Le.minX,Le.maxX,ye),U=null,or&&(bt=ki(or,qe,H-dr,H+Qr,1,Le.minY,Le.maxY,ye),Xt=ki(or,qe,H+Er,H+Dr,1,Le.minY,Le.maxY,ye),or=null),fr&&(Yt=ki(fr,qe,H-dr,H+Qr,1,Le.minY,Le.maxY,ye),mr=ki(fr,qe,H+Er,H+Dr,1,Le.minY,Le.maxY,ye),fr=null),Ce>1&&console.timeEnd("clipping"),Se.push(bt||[],L+1,2*V,2*H),Se.push(Xt||[],L+1,2*V,2*H+1),Se.push(Yt||[],L+1,2*V+1,2*H),Se.push(mr||[],L+1,2*V+1,2*H+1)}}},_n.prototype.getTile=function(U,L,V){var H=this.options,te=H.extent,he=H.debug;if(U<0||U>24)return null;var Te=1<<U,Se=zn(U,L=(L%Te+Te)%Te,V);if(this.tiles[Se])return ls(this.tiles[Se],te);he>1&&console.log("drilling down to z%d-%d-%d",U,L,V);for(var ye,Ce=U,qe=L,at=V;!ye&&Ce>0;)Ce--,qe=Math.floor(qe/2),at=Math.floor(at/2),ye=this.tiles[zn(Ce,qe,at)];return ye&&ye.source?(he>1&&console.log("found parent tile z%d-%d-%d",Ce,qe,at),he>1&&console.time("drilling down"),this.splitTile(ye.source,Ce,qe,at,U,L,V),he>1&&console.timeEnd("drilling down"),this.tiles[Se]?ls(this.tiles[Se],te):null):null};class Gn extends T{constructor(L,V,H,te){super(L,V,H,qn),te&&(this.loadGeoJSON=te)}loadData(L,V){var H;(H=this._pendingRequest)===null||H===void 0||H.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const te=!!(L&&L.request&&L.request.collectResourceTiming)&&new i.RequestPerformance(L.request);this._pendingCallback=V,this._pendingRequest=this.loadGeoJSON(L,(he,Te)=>{if(delete this._pendingCallback,delete this._pendingRequest,he||!Te)return V(he);if(typeof Te!="object")return V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{z(Te,!0);try{if(L.filter){const ye=i.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(qe=>`${qe.key}: ${qe.message}`).join(", "));Te={type:"FeatureCollection",features:Te.features.filter(qe=>ye.value.evaluate({zoom:0},qe))}}this._geoJSONIndex=L.cluster?new K(function({superclusterOptions:ye,clusterProperties:Ce}){if(!Ce||!ye)return ye;const qe={},at={},Le={accumulated:null,zoom:0},It={properties:null},Pt=Object.keys(Ce);for(const bt of Pt){const[Xt,Yt]=Ce[bt],mr=i.createExpression(Yt),or=i.createExpression(typeof Xt=="string"?[Xt,["accumulated"],["get",bt]]:Xt);qe[bt]=mr.value,at[bt]=or.value}return ye.map=bt=>{It.properties=bt;const Xt={};for(const Yt of Pt)Xt[Yt]=qe[Yt].evaluate(Le,It);return Xt},ye.reduce=(bt,Xt)=>{It.properties=Xt;for(const Yt of Pt)Le.accumulated=bt[Yt],bt[Yt]=at[Yt].evaluate(Le,It)},ye}(L)).load(Te.features):function(ye,Ce){return new _n(ye,Ce)}(Te,L.geojsonVtOptions)}catch(ye){return V(ye)}this.loaded={};const Se={};if(te){const ye=te.finish();ye&&(Se.resourceTiming={},Se.resourceTiming[L.source]=JSON.parse(JSON.stringify(ye)))}V(null,Se)}})}reloadTile(L,V){const H=this.loaded;return H&&H[L.uid]?super.reloadTile(L,V):this.loadTile(L,V)}loadGeoJSON(L,V){if(L.request)return i.getJSON(L.request,V);if(typeof L.data=="string")try{V(null,JSON.parse(L.data))}catch{V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}else V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(L,V){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),V()}getClusterExpansionZoom(L,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(H){V(H)}}getClusterChildren(L,V){try{V(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(H){V(H)}}getClusterLeaves(L,V){try{V(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(H){V(H)}}}class Ae{constructor(L){this.self=L,this.actor=new i.Actor(L,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:T,geojson:Gn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,H)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=H},this.self.registerRTLTextPlugin=V=>{if(i.plugin.isParsed())throw new Error("RTL text plugin already registered.");i.plugin.applyArabicShaping=V.applyArabicShaping,i.plugin.processBidirectionalText=V.processBidirectionalText,i.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}setReferrer(L,V){this.referrer=V}setImages(L,V,H){this.availableImages[L]=V;for(const te in this.workerSources[L]){const he=this.workerSources[L][te];for(const Te in he)he[Te].availableImages=V}H()}setLayers(L,V,H){this.getLayerIndex(L).replace(V),H()}updateLayers(L,V,H){this.getLayerIndex(L).update(V.layers,V.removedIds),H()}loadTile(L,V,H){this.getWorkerSource(L,V.type,V.source).loadTile(V,H)}loadDEMTile(L,V,H){this.getDEMWorkerSource(L,V.source).loadTile(V,H)}reloadTile(L,V,H){this.getWorkerSource(L,V.type,V.source).reloadTile(V,H)}abortTile(L,V,H){this.getWorkerSource(L,V.type,V.source).abortTile(V,H)}removeTile(L,V,H){this.getWorkerSource(L,V.type,V.source).removeTile(V,H)}removeDEMTile(L,V){this.getDEMWorkerSource(L,V.source).removeTile(V)}removeSource(L,V,H){if(!this.workerSources[L]||!this.workerSources[L][V.type]||!this.workerSources[L][V.type][V.source])return;const te=this.workerSources[L][V.type][V.source];delete this.workerSources[L][V.type][V.source],te.removeSource!==void 0?te.removeSource(V,H):H()}loadWorkerSource(L,V,H){try{this.self.importScripts(V.url),H()}catch(te){H(te.toString())}}syncRTLPluginState(L,V,H){try{i.plugin.setState(V);const te=i.plugin.getPluginURL();if(i.plugin.isLoaded()&&!i.plugin.isParsed()&&te!=null){this.self.importScripts(te);const he=i.plugin.isParsed();H(he?void 0:new Error(`RTL Text Plugin failed to import scripts from ${te}`),he)}}catch(te){H(te.toString())}}getAvailableImages(L){let V=this.availableImages[L];return V||(V=[]),V}getLayerIndex(L){let V=this.layerIndexes[L];return V||(V=this.layerIndexes[L]=new b),V}getWorkerSource(L,V,H){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][V]||(this.workerSources[L][V]={}),!this.workerSources[L][V][H]){const te={send:(he,Te,Se)=>{this.actor.send(he,Te,Se,L)}};this.workerSources[L][V][H]=new this.workerSourceTypes[V](te,this.getLayerIndex(L),this.getAvailableImages(L))}return this.workerSources[L][V][H]}getDEMWorkerSource(L,V){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][V]||(this.demWorkerSources[L][V]=new A),this.demWorkerSources[L][V]}enforceCacheSizeLimit(L,V){i.enforceCacheSizeLimit(V)}}return i.isWorker()&&(self.worker=new Ae(self)),Ae}),h(["./shared"],function(i){var d=g;function g(_){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,C=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(C);try{v=new Worker(P),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(P),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var C=v.getImageData(0,0,1,1);return C&&C.width===m.width}()?(b[u=r&&r.failIfMajorPerformanceCaveat]===void 0&&(b[u]=function(m){var v,C=function(P){var O=document.createElement("canvas"),B=Object.create(g.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=P,O.getContext("webgl",B)||O.getContext("experimental-webgl",B)}(m);if(!C)return!1;try{v=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!v||C.isContextLost())&&(C.shaderSource(v,"void main() {}"),C.compileShader(v),C.getShaderParameter(v,C.COMPILE_STATUS)===!0)}(u)),b[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var u}(_)}var b={};function k(_,r){if(Array.isArray(_)){if(!Array.isArray(r)||_.length!==r.length)return!1;for(let u=0;u<_.length;u++)if(!k(_[u],r[u]))return!1;return!0}if(typeof _=="object"&&_!==null&&r!==null){if(typeof r!="object"||Object.keys(_).length!==Object.keys(r).length)return!1;for(const u in _)if(!k(_[u],r[u]))return!1;return!0}return _===r}g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class x{static testProp(r){if(!x.docStyle)return r[0];for(let u=0;u<r.length;u++)if(r[u]in x.docStyle)return r[u];return r[0]}static create(r,u,m){const v=window.document.createElement(r);return u!==void 0&&(v.className=u),m&&m.appendChild(v),v}static createNS(r,u){return window.document.createElementNS(r,u)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(r,u){r.style[x.transformProp]=u}static addEventListener(r,u,m,v={}){r.addEventListener(u,m,"passive"in v?v:v.capture)}static removeEventListener(r,u,m,v={}){r.removeEventListener(u,m,"passive"in v?v:v.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static mousePos(r,u){const m=r.getBoundingClientRect();return new i.pointGeometry(u.clientX-m.left-r.clientLeft,u.clientY-m.top-r.clientTop)}static touchPos(r,u){const m=r.getBoundingClientRect(),v=[];for(let C=0;C<u.length;C++)v.push(new i.pointGeometry(u[C].clientX-m.left-r.clientLeft,u[C].clientY-m.top-r.clientTop));return v}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);class S{constructor(r){this._transformRequestFn=r}transformRequest(r,u){return this._transformRequestFn&&this._transformRequestFn(r,u)||{url:r}}normalizeSpriteURL(r,u,m){const v=function(C){const P=C.match(E);if(!P)throw new Error(`Unable to parse URL "${C}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(r);return v.path+=`${u}${m}`,function(C){const P=C.params.length?`?${C.params.join("&")}`:"";return`${C.protocol}://${C.authority}${C.path}${P}`}(v)}setTransformRequest(r){this._transformRequestFn=r}}const E=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class T{constructor(r,u,m,v){this.context=r,this.format=m,this.texture=r.gl.createTexture(),this.update(u,v)}update(r,u,m){const{width:v,height:C}=r,P=!(this.size&&this.size[0]===v&&this.size[1]===C||m),{context:O}=this,{gl:B}=O;if(this.useMipmap=!!(u&&u.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),O.pixelStoreUnpackFlipY.set(!1),O.pixelStoreUnpack.set(1),O.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!u||u.premultiply!==!1)),P)this.size=[v,C],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||i.isImageBitmap(r)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,r):B.texImage2D(B.TEXTURE_2D,0,this.format,v,C,0,this.format,B.UNSIGNED_BYTE,r.data);else{const{x:j,y:W}=m||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||i.isImageBitmap(r)?B.texSubImage2D(B.TEXTURE_2D,0,j,W,B.RGBA,B.UNSIGNED_BYTE,r):B.texSubImage2D(B.TEXTURE_2D,0,j,W,v,C,B.RGBA,B.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(r,u,m){const{context:v}=this,{gl:C}=v;C.bindTexture(C.TEXTURE_2D,this.texture),m!==C.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=C.LINEAR),r!==this.filter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,r),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,m||r),this.filter=r),u!==this.wrap&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,u),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function A(_){const{userImage:r}=_;return!!(r&&r.render&&r.render())&&(_.data.replace(new Uint8Array(r.data.buffer)),!0)}class z extends i.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,m);this.requestors=[]}}getImage(r){return this.images[r]}addImage(r,u){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,u)&&(this.images[r]=u)}_validate(r,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new i.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new i.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new i.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,u){if(!r)return!0;let m=0;for(const v of r){if(v[0]<m||v[1]<v[0]||u<v[1])return!1;m=v[1]}return!0}_validateContent(r,u){return!(r&&(r.length!==4||r[0]<0||u.data.width<r[0]||r[1]<0||u.data.height<r[1]||r[2]<0||u.data.width<r[2]||r[3]<0||u.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,u){const m=this.images[r];if(m.data.width!==u.data.width||m.data.height!==u.data.height)throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=m.version+1,this.images[r]=u,this.updatedImages[r]=!0}removeImage(r){const u=this.images[r];delete this.images[r],delete this.patterns[r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,u){let m=!0;if(!this.isLoaded())for(const v of r)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(r,u):this.requestors.push({ids:r,callback:u})}_notify(r,u){const m={};for(const v of r){this.images[v]||this.fire(new i.Event("styleimagemissing",{id:v}));const C=this.images[v];C?m[v]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)}:i.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,m)}getPixelSize(){const{width:r,height:u}=this.atlasImage;return{width:r,height:u}}getPattern(r){const u=this.patterns[r],m=this.getImage(r);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},C=new i.ImagePosition(v,m);this.patterns[r]={bin:v,position:C}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const u=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new T(r,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const C in this.patterns)r.push(this.patterns[C].bin);const{w:u,h:m}=i.potpack(r),v=this.atlasImage;v.resize({width:u||1,height:m||1});for(const C in this.patterns){const{bin:P}=this.patterns[C],O=P.x+1,B=P.y+1,j=this.images[C].data,W=j.width,Q=j.height;i.RGBAImage.copy(j,v,{x:0,y:0},{x:O,y:B},{width:W,height:Q}),i.RGBAImage.copy(j,v,{x:0,y:Q-1},{x:O,y:B-1},{width:W,height:1}),i.RGBAImage.copy(j,v,{x:0,y:0},{x:O,y:B+Q},{width:W,height:1}),i.RGBAImage.copy(j,v,{x:W-1,y:0},{x:O-1,y:B},{width:1,height:Q}),i.RGBAImage.copy(j,v,{x:0,y:0},{x:O+W,y:B},{width:1,height:Q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const u of r){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const m=this.images[u];m||i.warnOnce(`Image with ID: "${u}" was not found`),A(m)&&this.updateImage(u,m)}}}const D=1e20;function F(_,r,u,m,v,C,P,O,B){for(let j=r;j<r+m;j++)$(_,u*C+j,C,v,P,O,B);for(let j=u;j<u+v;j++)$(_,j*C+r,1,m,P,O,B)}function $(_,r,u,m,v,C,P){C[0]=0,P[0]=-D,P[1]=D,v[0]=_[r];for(let O=1,B=0,j=0;O<m;O++){v[O]=_[r+O*u];const W=O*O;do{const Q=C[B];j=(v[O]-v[Q]+W-Q*Q)/(O-Q)/2}while(j<=P[B]&&--B>-1);B++,C[B]=O,P[B]=j,P[B+1]=D}for(let O=0,B=0;O<m;O++){for(;P[B+1]<O;)B++;const j=C[B],W=O-j;_[r+O*u]=v[j]+W*W}}class q{constructor(r,u){this.requestManager=r,this.localIdeographFontFamily=u,this.entries={}}setURL(r){this.url=r}getGlyphs(r,u){const m=[];for(const v in r)for(const C of r[v])m.push({stack:v,id:C});i.asyncAll(m,({stack:v,id:C},P)=>{let O=this.entries[v];O||(O=this.entries[v]={glyphs:{},requests:{},ranges:{}});let B=O.glyphs[C];if(B!==void 0)return void P(null,{stack:v,id:C,glyph:B});if(B=this._tinySDF(O,v,C),B)return O.glyphs[C]=B,void P(null,{stack:v,id:C,glyph:B});const j=Math.floor(C/256);if(256*j>65535)return void P(new Error("glyphs > 65535 not supported"));if(O.ranges[j])return void P(null,{stack:v,id:C,glyph:B});let W=O.requests[j];W||(W=O.requests[j]=[],q.loadGlyphRange(v,j,this.url,this.requestManager,(Q,ne)=>{if(ne){for(const ge in ne)this._doesCharSupportLocalGlyph(+ge)||(O.glyphs[+ge]=ne[+ge]);O.ranges[j]=!0}for(const ge of W)ge(Q,ne);delete O.requests[j]})),W.push((Q,ne)=>{Q?P(Q):ne&&P(null,{stack:v,id:C,glyph:ne[C]||null})})},(v,C)=>{if(v)u(v);else if(C){const P={};for(const{stack:O,id:B,glyph:j}of C)(P[O]||(P[O]={}))[B]=j&&{id:j.id,bitmap:j.bitmap.clone(),metrics:j.metrics};u(null,P)}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(i.unicodeBlockLookup["CJK Unified Ideographs"](r)||i.unicodeBlockLookup["Hangul Syllables"](r)||i.unicodeBlockLookup.Hiragana(r)||i.unicodeBlockLookup.Katakana(r))}_tinySDF(r,u,m){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(m))return;let C=r.tinySDF;if(!C){let O="400";/bold/i.test(u)?O="900":/medium/i.test(u)?O="500":/light/i.test(u)&&(O="200"),C=r.tinySDF=new q.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:v,fontWeight:O})}const P=C.draw(String.fromCharCode(m));return{id:m,bitmap:new i.AlphaImage({width:P.width||30,height:P.height||30},P.data),metrics:{width:P.glyphWidth||24,height:P.glyphHeight||24,left:P.glyphLeft||0,top:P.glyphTop-27||-8,advance:P.glyphAdvance||24}}}}q.loadGlyphRange=function(_,r,u,m,v){const C=256*r,P=C+255,O=m.transformRequest(u.replace("{fontstack}",_).replace("{range}",`${C}-${P}`),i.ResourceType.Glyphs);i.getArrayBuffer(O,(B,j)=>{if(B)v(B);else if(j){const W={};for(const Q of i.parseGlyphPbf(j))W[Q.id]=Q;v(null,W)}})},q.TinySDF=class{constructor({fontSize:_=24,buffer:r=3,radius:u=8,cutoff:m=.25,fontFamily:v="sans-serif",fontWeight:C="normal",fontStyle:P="normal"}={}){this.buffer=r,this.cutoff=m,this.radius=u;const O=this.size=_+4*r,B=this._createCanvas(O),j=this.ctx=B.getContext("2d",{willReadFrequently:!0});j.font=`${P} ${C} ${_}px ${v}`,j.textBaseline="alphabetic",j.textAlign="left",j.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Uint16Array(O)}_createCanvas(_){const r=document.createElement("canvas");return r.width=r.height=_,r}draw(_){const{width:r,actualBoundingBoxAscent:u,actualBoundingBoxDescent:m,actualBoundingBoxLeft:v,actualBoundingBoxRight:C}=this.ctx.measureText(_),P=Math.ceil(u),O=Math.min(this.size-this.buffer,Math.ceil(C-v)),B=Math.min(this.size-this.buffer,P+Math.ceil(m)),j=O+2*this.buffer,W=B+2*this.buffer,Q=Math.max(j*W,0),ne=new Uint8ClampedArray(Q),ge={data:ne,width:j,height:W,glyphWidth:O,glyphHeight:B,glyphTop:P,glyphLeft:0,glyphAdvance:r};if(O===0||B===0)return ge;const{ctx:fe,buffer:pe,gridInner:Pe,gridOuter:De}=this;fe.clearRect(pe,pe,O,B),fe.fillText(_,pe,pe+P);const Ue=fe.getImageData(pe,pe,O,B);De.fill(D,0,Q),Pe.fill(0,0,Q);for(let xe=0;xe<B;xe++)for(let Je=0;Je<O;Je++){const He=Ue.data[4*(xe*O+Je)+3]/255;if(He===0)continue;const st=(xe+pe)*j+Je+pe;if(He===1)De[st]=0,Pe[st]=D;else{const lt=.5-He;De[st]=lt>0?lt*lt:0,Pe[st]=lt<0?lt*lt:0}}F(De,0,0,j,W,j,this.f,this.v,this.z),F(Pe,pe,pe,O,B,j,this.f,this.v,this.z);for(let xe=0;xe<Q;xe++){const Je=Math.sqrt(De[xe])-Math.sqrt(Pe[xe]);ne[xe]=Math.round(255-255*(Je/this.radius+this.cutoff))}return ge}};const J=new i.Properties({anchor:new i.DataConstantProperty(i.spec.light.anchor),position:new class{constructor(){this.specification=i.spec.light.position}possiblyEvaluate(_,r){return i.sphericalToCartesian(_.expression.evaluate(r))}interpolate(_,r,u){return{x:i.number(_.x,r.x,u),y:i.number(_.y,r.y,u),z:i.number(_.z,r.z,u)}}},color:new i.DataConstantProperty(i.spec.light.color),intensity:new i.DataConstantProperty(i.spec.light.intensity)}),G="-transition";class oe extends i.Evented{constructor(r){super(),this._transitionable=new i.Transitionable(J),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u={}){if(!this._validate(i.validateLight,r,u))for(const m in r){const v=r[m];m.endsWith(G)?this._transitionable.setTransition(m.slice(0,-G.length),v):this._transitionable.setValue(m,v)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||m.validate!==!1)&&i.emitValidationErrors(this,r.call(i.validateStyle,i.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}class de{constructor(r,u){this.width=r,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,u){const m=r.join(",")+String(u);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(r,u)),this.dashEntry[m]}getDashRanges(r,u,m){const v=[];let C=r.length%2==1?-r[r.length-1]*m:0,P=r[0]*m,O=!0;v.push({left:C,right:P,isDash:O,zeroLength:r[0]===0});let B=r[0];for(let j=1;j<r.length;j++){O=!O;const W=r[j];C=B*m,B+=W,P=B*m,v.push({left:C,right:P,isDash:O,zeroLength:W===0})}return v}addRoundDash(r,u,m){const v=u/2;for(let C=-m;C<=m;C++){const P=this.width*(this.nextRow+m+C);let O=0,B=r[O];for(let j=0;j<this.width;j++){j/B.right>1&&(B=r[++O]);const W=Math.abs(j-B.left),Q=Math.abs(j-B.right),ne=Math.min(W,Q);let ge;const fe=C/m*(v+1);if(B.isDash){const pe=v-Math.abs(fe);ge=Math.sqrt(ne*ne+pe*pe)}else ge=v-Math.sqrt(ne*ne+fe*fe);this.data[P+j]=Math.max(0,Math.min(255,ge+128))}}}addRegularDash(r){for(let O=r.length-1;O>=0;--O){const B=r[O],j=r[O+1];B.zeroLength?r.splice(O,1):j&&j.isDash===B.isDash&&(j.left=B.left,r.splice(O,1))}const u=r[0],m=r[r.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const v=this.width*this.nextRow;let C=0,P=r[C];for(let O=0;O<this.width;O++){O/P.right>1&&(P=r[++C]);const B=Math.abs(O-P.left),j=Math.abs(O-P.right),W=Math.min(B,j);this.data[v+O]=Math.max(0,Math.min(255,(P.isDash?W:-W)+128))}}addDash(r,u){const m=u?7:0,v=2*m+1;if(this.nextRow+v>this.height)return i.warnOnce("LineAtlas out of space"),null;let C=0;for(let O=0;O<r.length;O++)C+=r[O];if(C!==0){const O=this.width/C,B=this.getDashRanges(r,this.width,O);u?this.addRoundDash(B,O,m):this.addRegularDash(B)}const P={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:C};return this.nextRow+=v,this.dirty=!0,P}bind(r){const u=r.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}class Ee{constructor(r,u){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=i.uniqueId();const m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){const C=new Ee.Actor(m[v],u,this.id);C.name=`Worker ${v}`,this.actors.push(C)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,u,m){i.asyncAll(this.actors,(v,C)=>{v.send(r,u,C)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ot(_,r,u){const m=function(v,C){if(v)return u(v);if(C){const P=i.pick(i.extend(C,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(P.vectorLayers=C.vector_layers,P.vectorLayerIds=P.vectorLayers.map(O=>O.id)),u(null,P)}};return _.url?i.getJSON(r.transformRequest(_.url,i.ResourceType.Source),m):i.exported.frame(()=>m(null,_))}Ee.Actor=i.Actor;class le{constructor(r,u,m){this.bounds=i.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const u=Math.pow(2,r.z),m=Math.floor(i.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(i.mercatorYfromLat(this.bounds.getNorth())*u),C=Math.ceil(i.mercatorXfromLng(this.bounds.getEast())*u),P=Math.ceil(i.mercatorYfromLat(this.bounds.getSouth())*u);return r.x>=m&&r.x<C&&r.y>=v&&r.y<P}}class Ne extends i.Evented{constructor(r,u,m,v){if(super(),this.id=r,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.extend(this,i.pick(u,["url","scheme","tileSize","promoteId"])),this._options=i.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ot(this._options,this.map._requestManager,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r?this.fire(new i.ErrorEvent(r)):u&&(i.extend(this,u),u.bounds&&(this.tileBounds=new le(u.bounds,this.minzoom,this.maxzoom)),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return i.extend({},this._options)}loadTile(r,u){const m=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v={request:this.map._requestManager.transformRequest(m,i.ResourceType.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function C(P,O){return delete r.request,r.aborted?u(null):P&&P.status!==404?u(P):(O&&O.resourceTiming&&(r.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&r.setExpiryData(O),r.loadVectorData(O,this.map.painter),i.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}v.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired"?r.state==="loading"?r.reloadCallback=u:r.request=r.actor.send("reloadTile",v,C.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",v,C.bind(this)))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id},void 0)}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Y extends i.Evented{constructor(r,u,m,v){super(),this.id=r,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.extend({type:"raster"},u),i.extend(this,i.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ot(this._options,this.map._requestManager,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new i.ErrorEvent(r)):u&&(i.extend(this,u),u.bounds&&(this.tileBounds=new le(u.bounds,this.minzoom,this.maxzoom)),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return i.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,u){const m=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.request=i.getImage(this.map._requestManager.transformRequest(m,i.ResourceType.Tile),(v,C,P)=>{if(delete r.request,r.aborted)r.state="unloaded",u(null);else if(v)r.state="errored",u(v);else if(C){this.map._refreshExpiredTiles&&r.setExpiryData(P);const O=this.map.painter.context,B=O.gl;r.texture=this.map.painter.getTileTexture(C.width),r.texture?r.texture.update(C,{useMipmap:!0}):(r.texture=new T(O,C,B.RGBA,{useMipmap:!0}),r.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),O.extTextureFilterAnisotropic&&B.texParameterf(B.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax)),r.state="loaded",i.cacheEntryPossiblyAdded(this.dispatcher),u(null)}})}abortTile(r,u){r.request&&(r.request.cancel(),delete r.request),u()}unloadTile(r,u){r.texture&&this.map.painter.saveTileTexture(r.texture),u()}hasTransition(){return!1}}let Qe;class pt extends Y{constructor(r,u,m,v){super(r,u,m,v),this.type="raster-dem",this.maxzoom=22,this._options=i.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(r,u){const m=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function v(C,P){C&&(r.state="errored",u(C)),P&&(r.dem=P,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded",u(null))}r.request=i.getImage(this.map._requestManager.transformRequest(m,i.ResourceType.Tile),(function(C,P){if(delete r.request,r.aborted)r.state="unloaded",u(null);else if(C)r.state="errored",u(C);else if(P){this.map._refreshExpiredTiles&&r.setExpiryData(P),delete P.cacheControl,delete P.expires;const O=i.isImageBitmap(P)&&(Qe==null&&(Qe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Qe)?P:i.exported.getImageData(P,1),B={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:O,encoding:this.encoding};r.actor&&r.state!=="expired"||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",B,v.bind(this)))}}).bind(this)),r.neighboringTiles=this._getNeighboringTiles(r.tileID)}_getNeighboringTiles(r){const u=r.canonical,m=Math.pow(2,u.z),v=(u.x-1+m)%m,C=u.x===0?r.wrap-1:r.wrap,P=(u.x+1+m)%m,O=u.x+1===m?r.wrap+1:r.wrap,B={};return B[new i.OverscaledTileID(r.overscaledZ,C,u.z,v,u.y).key]={backfilled:!1},B[new i.OverscaledTileID(r.overscaledZ,O,u.z,P,u.y).key]={backfilled:!1},u.y>0&&(B[new i.OverscaledTileID(r.overscaledZ,C,u.z,v,u.y-1).key]={backfilled:!1},B[new i.OverscaledTileID(r.overscaledZ,r.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},B[new i.OverscaledTileID(r.overscaledZ,O,u.z,P,u.y-1).key]={backfilled:!1}),u.y+1<m&&(B[new i.OverscaledTileID(r.overscaledZ,C,u.z,v,u.y+1).key]={backfilled:!1},B[new i.OverscaledTileID(r.overscaledZ,r.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},B[new i.OverscaledTileID(r.overscaledZ,O,u.z,P,u.y+1).key]={backfilled:!1}),B}unloadTile(r){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&r.actor.send("removeDEMTile",{uid:r.uid,source:this.id})}}class dt extends i.Evented{constructor(r,u,m,v){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(v),this._data=u.data,this._options=i.extend({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const C=i.EXTENT/this.tileSize;this.workerOptions=i.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*C,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*C,extent:i.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:i.EXTENT,radius:(u.clusterRadius||50)*C,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData("content"),this}getClusterExpansionZoom(r,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:r,source:this.id},u),this}getClusterChildren(r,u){return this.actor.send("geojson.getClusterChildren",{clusterId:r,source:this.id},u),this}getClusterLeaves(r,u,m,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:r,limit:u,offset:m},v),this}_updateWorkerData(r){const u=i.extend({},this.workerOptions),m=this._data;typeof m=="string"?(u.request=this.map._requestManager.transformRequest(i.exported.resolveURL(m),i.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(m),this._pendingLoads++,this.fire(new i.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,u,(v,C)=>{if(this._pendingLoads--,this._removed||C&&C.abandoned)return void this.fire(new i.Event("dataabort",{dataType:"source",sourceDataType:r}));let P=null;if(C&&C.resourceTiming&&C.resourceTiming[this.id]&&(P=C.resourceTiming[this.id].slice(0)),v)return void this.fire(new i.ErrorEvent(v));const O={dataType:"source",sourceDataType:r};this._collectResourceTiming&&P&&P.length>0&&i.extend(O,{resourceTiming:P}),this.fire(new i.Event("data",O))})}loaded(){return this._pendingLoads===0}loadTile(r,u){const m=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const v={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.request=this.actor.send(m,v,(C,P)=>(delete r.request,r.unloadVectorData(),r.aborted?u(null):C?u(C):(r.loadVectorData(P,this.map.painter,m==="reloadTile"),u(null))))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.aborted=!0}unloadTile(r){r.unloadVectorData(),this.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return i.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Zt=i.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class nt extends i.Evented{constructor(r,u,m,v){super(),this.id=r,this.dispatcher=m,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(r,u){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this.url=this.options.url,i.getImage(this.map._requestManager.transformRequest(this.url,i.ResourceType.Image),(m,v)=>{this._loaded=!0,m?this.fire(new i.ErrorEvent(m)):v&&(this.image=v,r&&(this.coordinates=r),u&&u(),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}setCoordinates(r){this.coordinates=r;const u=r.map(i.MercatorCoordinate.fromLngLat);this.tileID=function(v){let C=1/0,P=1/0,O=-1/0,B=-1/0;for(const ne of v)C=Math.min(C,ne.x),P=Math.min(P,ne.y),O=Math.max(O,ne.x),B=Math.max(B,ne.y);const j=Math.max(O-C,B-P),W=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),Q=Math.pow(2,W);return new i.CanonicalTileID(W,Math.floor((C+O)/2*Q),Math.floor((P+B)/2*Q))}(u),this.minzoom=this.maxzoom=this.tileID.z;const m=u.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new i.RasterBoundsArray,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,i.EXTENT,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,i.EXTENT),this._boundsArray.emplaceBack(m[2].x,m[2].y,i.EXTENT,i.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,u=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,Zt.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new T(r,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}loadTile(r,u){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},u(null)):(r.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class tt extends nt{constructor(r,u,m,v){super(r,u,m,v),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const r=this.options;this.urls=[];for(const u of r.urls)this.urls.push(this.map._requestManager.transformRequest(u,i.ResourceType.Source).url);i.getVideo(this.urls,(u,m)=>{this._loaded=!0,u?this.fire(new i.ErrorEvent(u)):m&&(this.video=m,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const u=this.video.seekable;r<u.start(0)||r>u.end(0)?this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,u=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,Zt.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new T(r,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ce extends nt{constructor(r,u,m,v){super(r,u,m,v),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(C=>!Array.isArray(C)||C.length!==2||C.some(P=>typeof P!="number"))||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${r}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,m=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Zt.members)),this.boundsSegments||(this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new T(u,this.canvas,m.RGBA,{premultiply:!0});for(const v in this.tiles){const C=this.tiles[v];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const _e={vector:Ne,raster:Y,"raster-dem":pt,geojson:dt,video:tt,image:nt,canvas:ce};function ze(_,r){const u=i.create();return i.translate(u,u,[1,1,0]),i.scale(u,u,[.5*_.width,.5*_.height,1]),i.multiply(u,u,_.calculatePosMatrix(r.toUnwrapped()))}function re(_,r,u,m,v,C){const P=function(Q,ne,ge){if(Q)for(const fe of Q){const pe=ne[fe];if(pe&&pe.source===ge&&pe.type==="fill-extrusion")return!0}else for(const fe in ne){const pe=ne[fe];if(pe.source===ge&&pe.type==="fill-extrusion")return!0}return!1}(v&&v.layers,r,_.id),O=C.maxPitchScaleFactor(),B=_.tilesIn(m,O,P);B.sort(ue);const j=[];for(const Q of B)j.push({wrappedTileID:Q.tileID.wrapped().key,queryResults:Q.tile.queryRenderedFeatures(r,u,_._state,Q.queryGeometry,Q.cameraQueryGeometry,Q.scale,v,C,O,ze(_.transform,Q.tileID))});const W=function(Q){const ne={},ge={};for(const fe of Q){const pe=fe.queryResults,Pe=fe.wrappedTileID,De=ge[Pe]=ge[Pe]||{};for(const Ue in pe){const xe=pe[Ue],Je=De[Ue]=De[Ue]||{},He=ne[Ue]=ne[Ue]||[];for(const st of xe)Je[st.featureIndex]||(Je[st.featureIndex]=!0,He.push(st))}}return ne}(j);for(const Q in W)W[Q].forEach(ne=>{const ge=ne.feature,fe=_.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=fe});return W}function ue(_,r){const u=_.tileID,m=r.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}class Xe{constructor(r,u){this.tileID=r,this.uid=i.uniqueId(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const u=r+this.timeAdded;u<i.exported.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.textures.forEach(u=>r.saveTileTexture(u)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(r,u,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(v,C){const P={};if(!C)return P;for(const O of v){const B=O.layerIds.map(j=>C.getLayer(j)).filter(Boolean);if(B.length!==0){O.layers=B,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map(j=>B.filter(W=>W.id===j)[0]));for(const j of B)P[j.id]=O}}return P}(r.buckets,u.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const C=this.buckets[v];if(C instanceof i.SymbolBucket){if(this.hasSymbolBuckets=!0,!m)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const C=this.buckets[v];if(C instanceof i.SymbolBucket&&C.hasRTLText){this.hasRTLText=!0,i.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const v in this.buckets){const C=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(v).queryRadius(C))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new i.CollisionBoxArray}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const m in this.buckets){const v=this.buckets[m];v.uploadPending()&&v.upload(r)}const u=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new T(r,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new T(r,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,u,m,v,C,P,O,B,j,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:C,scale:P,tileSize:this.tileSize,pixelPosMatrix:W,transform:B,params:O,queryPadding:this.queryPadding*j},r,u,m):{}}querySourceFeatures(r,u){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),C=u?u.sourceLayer:"",P=v._geojsonTileLayer||v[C];if(!P)return;const O=i.createFilter(u&&u.filter),{z:B,x:j,y:W}=this.tileID.canonical,Q={z:B,x:j,y:W};for(let ne=0;ne<P.length;ne++){const ge=P.feature(ne);if(O.needGeometry){const Pe=i.toEvaluationFeature(ge,!0);if(!O.filter(new i.EvaluationParameters(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!O.filter(new i.EvaluationParameters(this.tileID.overscaledZ),ge))continue;const fe=m.getId(ge,C),pe=new i.GeoJSONFeature(ge,B,j,W,fe);pe.tile=Q,r.push(pe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const u=this.expirationTime;if(r.cacheControl){const m=i.parseCacheControl(r.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(u)if(this.expirationTime<u)v=!0;else{const C=this.expirationTime-u;C?this.expirationTime=m+Math.max(C,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!u.style.hasLayer(v))continue;const C=this.buckets[v],P=C.layers[0].sourceLayer||"_geojsonTileLayer",O=m[P],B=r[P];if(!O||!B||Object.keys(B).length===0)continue;C.update(B,O,this.imageAtlas&&this.imageAtlas.patternPositions||{});const j=u&&u.style&&u.style.getLayer(v);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=i.exported.now()+r}setDependencies(r,u){const m={};for(const v of u)m[v]=!0;this.dependencies[r]=m}hasDependency(r,u){for(const m of r){const v=this.dependencies[m];if(v){for(const C of u)if(v[C])return!0}}return!1}}class wt{constructor(r,u){this.max=r,this.onRemove=u,this.reset()}reset(){for(const r in this.data)for(const u of this.data[r])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(r,u,m){const v=r.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const C={value:u,timeout:void 0};if(m!==void 0&&(C.timeout=setTimeout(()=>{this.remove(r,C)},m)),this.data[v].push(C),this.order.push(v),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const u=this.data[r].shift();return u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),u.value}getByKey(r){const u=this.data[r];return u?u[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,u){if(!this.has(r))return this;const m=r.wrapped().key,v=u===void 0?0:this.data[m].indexOf(u),C=this.data[m][v];return this.data[m].splice(v,1),C.timeout&&clearTimeout(C.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(C.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(r){const u=[];for(const m in this.data)for(const v of this.data[m])r(v.value)||u.push(v);for(const m of u)this.remove(m.value.tileID,m)}}class mt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,u,m){const v=String(u);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][v]=this.stateChanges[r][v]||{},i.extend(this.stateChanges[r][v],m),this.deletedStates[r]===null){this.deletedStates[r]={};for(const C in this.state[r])C!==v&&(this.deletedStates[r][C]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][v]===null){this.deletedStates[r][v]={};for(const C in this.state[r][v])m[C]||(this.deletedStates[r][v][C]=null)}else for(const C in m)this.deletedStates[r]&&this.deletedStates[r][v]&&this.deletedStates[r][v][C]===null&&delete this.deletedStates[r][v][C]}removeFeatureState(r,u,m){if(this.deletedStates[r]===null)return;const v=String(u);if(this.deletedStates[r]=this.deletedStates[r]||{},m&&u!==void 0)this.deletedStates[r][v]!==null&&(this.deletedStates[r][v]=this.deletedStates[r][v]||{},this.deletedStates[r][v][m]=null);else if(u!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][v])for(m in this.deletedStates[r][v]={},this.stateChanges[r][v])this.deletedStates[r][v][m]=null;else this.deletedStates[r][v]=null;else this.deletedStates[r]=null}getState(r,u){const m=String(u),v=i.extend({},(this.state[r]||{})[m],(this.stateChanges[r]||{})[m]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const C=this.deletedStates[r][u];if(C===null)return{};for(const P in C)delete v[P]}return v}initializeTileState(r,u){r.setFeatureState(this.state,u)}coalesceChanges(r,u){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const C={};for(const P in this.stateChanges[v])this.state[v][P]||(this.state[v][P]={}),i.extend(this.state[v][P],this.stateChanges[v][P]),C[P]=this.state[v][P];m[v]=C}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const C={};if(this.deletedStates[v]===null)for(const P in this.state[v])C[P]={},this.state[v][P]={};else for(const P in this.deletedStates[v]){if(this.deletedStates[v][P]===null)this.state[v][P]={};else for(const O of Object.keys(this.deletedStates[v][P]))delete this.state[v][P][O];C[P]=this.state[v][P]}m[v]=m[v]||{},i.extend(m[v],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const v in r)r[v].setFeatureState(m,u)}}class Ke extends i.Evented{constructor(r,u,m){super(),this.id=r,this.dispatcher=m,this.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(v,C,P,O){const B=new _e[C.type](v,C,P,O);if(B.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${B.id}`);return i.bindAll(["load","abort","unload","serialize","prepare"],B),B}(r,u,m,this),this._tiles={},this._cache=new wt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new mt}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const u=this._tiles[r];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,u){return this._source.loadTile(r,u)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){this._source.abortTile&&this._source.abortTile(r,()=>{}),this._source.fire(new i.Event("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const m=this._tiles[u];m.upload(r),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Ot).map(r=>r.key)}getRenderableIds(r){const u=[];for(const m in this._tiles)this._isIdRenderable(m,r)&&u.push(this._tiles[m]);return r?u.sort((m,v)=>{const C=m.tileID,P=v.tileID,O=new i.pointGeometry(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),B=new i.pointGeometry(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-P.overscaledZ||B.y-O.y||B.x-O.x}).map(m=>m.tileID.key):u.map(m=>m.tileID).sort(Ot).map(m=>m.key)}hasRenderableParent(r){const u=this.findLoadedParent(r,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(r,u){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(u||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,u){const m=this._tiles[r];m&&(m.state!=="loading"&&(m.state=u),this._loadTile(m,this._tileLoaded.bind(this,m,r,u)))}_tileLoaded(r,u,m,v){if(v)return r.state="errored",void(v.status!==404?this._source.fire(new i.ErrorEvent(v,{tile:r})):this.update(this.transform,this.terrain));r.timeAdded=i.exported.now(),m==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(u,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new i.Event("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const u=this.getRenderableIds();for(let v=0;v<u.length;v++){const C=u[v];if(r.neighboringTiles&&r.neighboringTiles[C]){const P=this.getTileByID(C);m(r,P),m(P,r)}}function m(v,C){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let P=C.tileID.canonical.x-v.tileID.canonical.x;const O=C.tileID.canonical.y-v.tileID.canonical.y,B=Math.pow(2,v.tileID.canonical.z),j=C.tileID.key;P===0&&O===0||Math.abs(O)>1||(Math.abs(P)>1&&(Math.abs(P+B)===1?P+=B:Math.abs(P-B)===1&&(P-=B)),C.dem&&v.dem&&(v.dem.backfillBorder(C.dem,P,O),v.neighboringTiles&&v.neighboringTiles[j]&&(v.neighboringTiles[j].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,u,m,v){for(const C in this._tiles){let P=this._tiles[C];if(v[C]||!P.hasData()||P.tileID.overscaledZ<=u||P.tileID.overscaledZ>m)continue;let O=P.tileID;for(;P&&P.tileID.overscaledZ>u+1;){const j=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[j.key],P&&P.hasData()&&(O=j)}let B=O;for(;B.overscaledZ>u;)if(B=B.scaledTo(B.overscaledZ-1),r[B.key]){v[O.key]=O;break}}}findLoadedParent(r,u){if(r.key in this._loadedParentTiles){const m=this._loadedParentTiles[r.key];return m&&m.tileID.overscaledZ>=u?m:null}for(let m=r.overscaledZ-1;m>=u;m--){const v=r.scaledTo(m),C=this._getLoadedTile(v);if(C)return C}}_getLoadedTile(r){const u=this._tiles[r.key];return u&&u.hasData()?u:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const u=Math.ceil(r.width/this._source.tileSize)+1,m=Math.ceil(r.height/this._source.tileSize)+1,v=Math.floor(u*m*5),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(C)}handleWrapJump(r){const u=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,u){const m={};for(const v in this._tiles){const C=this._tiles[v];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+u),m[C.tileID.key]=C}this._tiles=m;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(r,u){if(this.transform=r,this.terrain=u,!this._sourceLoaded||this._paused)return;let m;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(j=>new i.OverscaledTileID(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y)):(m=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(m=m.filter(j=>this._source.hasTile(j)))):m=[];const v=r.coveringZoomLevel(this._source),C=Math.max(v-Ke.maxOverzooming,this._source.minzoom),P=Math.max(v+Ke.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const j={};for(const W of m)if(W.canonical.z>this._source.minzoom){const Q=W.scaledTo(W.canonical.z-1);j[Q.key]=Q;const ne=W.scaledTo(Math.max(this._source.minzoom,Math.min(W.canonical.z,5)));j[ne.key]=ne}m=m.concat(Object.values(j))}const O=this._updateRetainedTiles(m,v);if(er(this._source.type)){const j={},W={},Q=Object.keys(O);for(const ne of Q){const ge=O[ne],fe=this._tiles[ne];if(!fe||fe.fadeEndTime&&fe.fadeEndTime<=i.exported.now())continue;const pe=this.findLoadedParent(ge,C);pe&&(this._addTile(pe.tileID),j[pe.tileID.key]=pe.tileID),W[ne]=ge}this._retainLoadedChildren(W,v,P,O);for(const ne in j)O[ne]||(this._coveredTiles[ne]=!0,O[ne]=j[ne]);if(u){const ne={},ge={};for(const fe of m)this._tiles[fe.key].hasData()?ne[fe.key]=fe:ge[fe.key]=fe;for(const fe in ge){const pe=ge[fe].children(this._source.maxzoom);this._tiles[pe[0].key]&&this._tiles[pe[1].key]&&this._tiles[pe[2].key]&&this._tiles[pe[3].key]&&(ne[pe[0].key]=O[pe[0].key]=pe[0],ne[pe[1].key]=O[pe[1].key]=pe[1],ne[pe[2].key]=O[pe[2].key]=pe[2],ne[pe[3].key]=O[pe[3].key]=pe[3],delete ge[fe])}for(const fe in ge){const pe=this.findLoadedParent(ge[fe],this._source.minzoom);if(pe){ne[pe.tileID.key]=O[pe.tileID.key]=pe.tileID;for(const Pe in ne)ne[Pe].isChildOf(pe.tileID)&&delete ne[Pe]}}for(const fe in this._tiles)ne[fe]||(this._coveredTiles[fe]=!0)}}for(const j in O)this._tiles[j].clearFadeHold();const B=i.keysDifference(this._tiles,O);for(const j of B){const W=this._tiles[j];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(j)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,u){const m={},v={},C=Math.max(u-Ke.maxOverzooming,this._source.minzoom),P=Math.max(u+Ke.maxUnderzooming,this._source.minzoom),O={};for(const B of r){const j=this._addTile(B);m[B.key]=B,j.hasData()||u<this._source.maxzoom&&(O[B.key]=B)}this._retainLoadedChildren(O,u,P,m);for(const B of r){let j=this._tiles[B.key];if(j.hasData())continue;if(u+1>this._source.maxzoom){const Q=B.children(this._source.maxzoom)[0],ne=this.getTile(Q);if(ne&&ne.hasData()){m[Q.key]=Q;continue}}else{const Q=B.children(this._source.maxzoom);if(m[Q[0].key]&&m[Q[1].key]&&m[Q[2].key]&&m[Q[3].key])continue}let W=j.wasRequested();for(let Q=B.overscaledZ-1;Q>=C;--Q){const ne=B.scaledTo(Q);if(v[ne.key]||(v[ne.key]=!0,j=this.getTile(ne),!j&&W&&(j=this._addTile(ne)),j&&(m[ne.key]=ne,W=j.wasRequested(),j.hasData())))break}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const u=[];let m,v=this._tiles[r].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){m=this._loadedParentTiles[v.key];break}u.push(v.key);const C=v.scaledTo(v.overscaledZ-1);if(m=this._getLoadedTile(C),m)break;v=C}for(const C of u)this._loadedParentTiles[C]=m}}_addTile(r){let u=this._tiles[r.key];if(u)return u;u=this._cache.getAndRemove(r),u&&(this._setTileReloadTimer(r.key,u),u.tileID=r,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,u)));const m=u;return u||(u=new Xe(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(u,this._tileLoaded.bind(this,u,r.key,u.state))),u.uses++,this._tiles[r.key]=u,m||this._source.fire(new i.Event("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(r,u){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const m=u.getExpiryTimeout();m&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},m))}_removeTile(r){const u=this._tiles[r];u&&(u.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,u,m){const v=[],C=this.transform;if(!C)return v;const P=m?C.getCameraQueryGeometry(r):r,O=r.map(fe=>C.pointCoordinate(fe,this.terrain)),B=P.map(fe=>C.pointCoordinate(fe,this.terrain)),j=this.getIds();let W=1/0,Q=1/0,ne=-1/0,ge=-1/0;for(const fe of B)W=Math.min(W,fe.x),Q=Math.min(Q,fe.y),ne=Math.max(ne,fe.x),ge=Math.max(ge,fe.y);for(let fe=0;fe<j.length;fe++){const pe=this._tiles[j[fe]];if(pe.holdingForFade())continue;const Pe=pe.tileID,De=Math.pow(2,C.zoom-pe.tileID.overscaledZ),Ue=u*pe.queryPadding*i.EXTENT/pe.tileSize/De,xe=[Pe.getTilePoint(new i.MercatorCoordinate(W,Q)),Pe.getTilePoint(new i.MercatorCoordinate(ne,ge))];if(xe[0].x-Ue<i.EXTENT&&xe[0].y-Ue<i.EXTENT&&xe[1].x+Ue>=0&&xe[1].y+Ue>=0){const Je=O.map(st=>Pe.getTilePoint(st)),He=B.map(st=>Pe.getTilePoint(st));v.push({tile:pe,tileID:Pe,queryGeometry:Je,cameraQueryGeometry:He,scale:De})}}return v}getVisibleCoordinates(r){const u=this.getRenderableIds(r).map(m=>this._tiles[m].tileID);for(const m of u)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(er(this._source.type))for(const r in this._tiles){const u=this._tiles[r];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=i.exported.now())return!0}return!1}setFeatureState(r,u,m){this._state.updateState(r=r||"_geojsonTileLayer",u,m)}removeFeatureState(r,u,m){this._state.removeFeatureState(r=r||"_geojsonTileLayer",u,m)}getFeatureState(r,u){return this._state.getState(r=r||"_geojsonTileLayer",u)}setDependencies(r,u,m){const v=this._tiles[r];v&&v.setDependencies(u,m)}reloadTilesForDependencies(r,u){for(const m in this._tiles)this._tiles[m].hasDependency(r,u)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(r,u))}}function Ot(_,r){const u=Math.abs(2*_.wrap)-+(_.wrap<0),m=Math.abs(2*r.wrap)-+(r.wrap<0);return _.overscaledZ-r.overscaledZ||m-u||r.canonical.y-_.canonical.y||r.canonical.x-_.canonical.x}function er(_){return _==="raster"||_==="image"||_==="video"}Ke.maxOverzooming=10,Ke.maxUnderzooming=3;const Lr="mapboxgl_preloaded_worker_pool";class Fr{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Fr.workerCount;)this.workers.push(new Worker(As.workerUrl));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Lr]}numActive(){return Object.keys(this.active).length}}const K=Math.floor(i.exported.hardwareConcurrency/2);let ct;function et(){return ct||(ct=new Fr),ct}function be(_,r){const u={};for(const m in _)m!=="ref"&&(u[m]=_[m]);return i.refProperties.forEach(m=>{m in r&&(u[m]=r[m])}),u}function me(_){_=_.slice();const r=Object.create(null);for(let u=0;u<_.length;u++)r[_[u].id]=_[u];for(let u=0;u<_.length;u++)"ref"in _[u]&&(_[u]=be(_[u],r[_[u].ref]));return _}Fr.workerCount=Math.max(Math.min(K,6),1);const Ie={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ft(_,r,u){u.push({command:Ie.addSource,args:[_,r[_]]})}function gt(_,r,u){r.push({command:Ie.removeSource,args:[_]}),u[_]=!0}function je(_,r,u,m){gt(_,u,m),ft(_,r,u)}function vt(_,r,u){let m;for(m in _[u])if(Object.prototype.hasOwnProperty.call(_[u],m)&&m!=="data"&&!k(_[u][m],r[u][m]))return!1;for(m in r[u])if(Object.prototype.hasOwnProperty.call(r[u],m)&&m!=="data"&&!k(_[u][m],r[u][m]))return!1;return!0}function Bt(_,r,u,m,v,C){let P;for(P in r=r||{},_=_||{})Object.prototype.hasOwnProperty.call(_,P)&&(k(_[P],r[P])||u.push({command:C,args:[m,P,r[P],v]}));for(P in r)Object.prototype.hasOwnProperty.call(r,P)&&!Object.prototype.hasOwnProperty.call(_,P)&&(k(_[P],r[P])||u.push({command:C,args:[m,P,r[P],v]}))}function Et(_){return _.id}function Ht(_,r){return _[r.id]=r,_}class wr{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=i.clamp(r,0,1);let u=1,m=this._distances[u];const v=r*this.paddedLength+this.padding;for(;m<v&&u<this._distances.length;)m=this._distances[++u];const C=u-1,P=this._distances[C],O=m-P,B=O>0?(v-P)/O:0;return this.points[C].mult(1-B).add(this.points[u].mult(B))}}function Fe(_,r){let u=!0;return _==="always"||_!=="never"&&r!=="never"||(u=!1),u}class _t{constructor(r,u,m){const v=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(u/m);for(let P=0;P<this.xCellCount*this.yCellCount;P++)v.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,m,v,C){this._forEachCell(u,m,v,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(C)}insertCircle(r,u,m,v){this._forEachCell(u-v,m-v,u+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(m),this.circles.push(v)}_insertBoxCell(r,u,m,v,C,P){this.boxCells[C].push(P)}_insertCircleCell(r,u,m,v,C,P){this.circleCells[C].push(P)}_query(r,u,m,v,C,P,O){if(m<0||r>this.width||v<0||u>this.height)return[];const B=[];if(r<=0&&u<=0&&this.width<=m&&this.height<=v){if(C)return[{key:null,x1:r,y1:u,x2:m,y2:v}];for(let j=0;j<this.boxKeys.length;j++)B.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const W=this.circles[3*j],Q=this.circles[3*j+1],ne=this.circles[3*j+2];B.push({key:this.circleKeys[j],x1:W-ne,y1:Q-ne,x2:W+ne,y2:Q+ne})}}else this._forEachCell(r,u,m,v,this._queryCell,B,{hitTest:C,overlapMode:P,seenUids:{box:{},circle:{}}},O);return B}query(r,u,m,v){return this._query(r,u,m,v,!1,null)}hitTest(r,u,m,v,C,P){return this._query(r,u,m,v,!0,C,P).length>0}hitTestCircle(r,u,m,v,C){const P=r-m,O=r+m,B=u-m,j=u+m;if(O<0||P>this.width||j<0||B>this.height)return!1;const W=[];return this._forEachCell(P,B,O,j,this._queryCellCircle,W,{hitTest:!0,overlapMode:v,circle:{x:r,y:u,radius:m},seenUids:{box:{},circle:{}}},C),W.length>0}_queryCell(r,u,m,v,C,P,O,B){const{seenUids:j,hitTest:W,overlapMode:Q}=O,ne=this.boxCells[C];if(ne!==null){const fe=this.bboxes;for(const pe of ne)if(!j.box[pe]){j.box[pe]=!0;const Pe=4*pe,De=this.boxKeys[pe];if(r<=fe[Pe+2]&&u<=fe[Pe+3]&&m>=fe[Pe+0]&&v>=fe[Pe+1]&&(!B||B(De))&&(!W||!Fe(Q,De.overlapMode))&&(P.push({key:De,x1:fe[Pe],y1:fe[Pe+1],x2:fe[Pe+2],y2:fe[Pe+3]}),W))return!0}}const ge=this.circleCells[C];if(ge!==null){const fe=this.circles;for(const pe of ge)if(!j.circle[pe]){j.circle[pe]=!0;const Pe=3*pe,De=this.circleKeys[pe];if(this._circleAndRectCollide(fe[Pe],fe[Pe+1],fe[Pe+2],r,u,m,v)&&(!B||B(De))&&(!W||!Fe(Q,De.overlapMode))){const Ue=fe[Pe],xe=fe[Pe+1],Je=fe[Pe+2];if(P.push({key:De,x1:Ue-Je,y1:xe-Je,x2:Ue+Je,y2:xe+Je}),W)return!0}}}return!1}_queryCellCircle(r,u,m,v,C,P,O,B){const{circle:j,seenUids:W,overlapMode:Q}=O,ne=this.boxCells[C];if(ne!==null){const fe=this.bboxes;for(const pe of ne)if(!W.box[pe]){W.box[pe]=!0;const Pe=4*pe,De=this.boxKeys[pe];if(this._circleAndRectCollide(j.x,j.y,j.radius,fe[Pe+0],fe[Pe+1],fe[Pe+2],fe[Pe+3])&&(!B||B(De))&&!Fe(Q,De.overlapMode))return P.push(!0),!0}}const ge=this.circleCells[C];if(ge!==null){const fe=this.circles;for(const pe of ge)if(!W.circle[pe]){W.circle[pe]=!0;const Pe=3*pe,De=this.circleKeys[pe];if(this._circlesCollide(fe[Pe],fe[Pe+1],fe[Pe+2],j.x,j.y,j.radius)&&(!B||B(De))&&!Fe(Q,De.overlapMode))return P.push(!0),!0}}}_forEachCell(r,u,m,v,C,P,O,B){const j=this._convertToXCellCoord(r),W=this._convertToYCellCoord(u),Q=this._convertToXCellCoord(m),ne=this._convertToYCellCoord(v);for(let ge=j;ge<=Q;ge++)for(let fe=W;fe<=ne;fe++)if(C.call(this,r,u,m,v,this.xCellCount*fe+ge,P,O,B))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,m,v,C,P){const O=v-r,B=C-u,j=m+P;return j*j>O*O+B*B}_circleAndRectCollide(r,u,m,v,C,P,O){const B=(P-v)/2,j=Math.abs(r-(v+B));if(j>B+m)return!1;const W=(O-C)/2,Q=Math.abs(u-(C+W));if(Q>W+m)return!1;if(j<=B||Q<=W)return!0;const ne=j-B,ge=Q-W;return ne*ne+ge*ge<=m*m}}function gi(_,r,u,m,v){const C=i.create();return r?(i.scale(C,C,[1/v,1/v,1]),u||i.rotateZ(C,C,m.angle)):i.multiply(C,m.labelPlaneMatrix,_),C}function ri(_,r,u,m,v){if(r){const C=i.clone(_);return i.scale(C,C,[v,v,1]),u||i.rotateZ(C,C,-m.angle),C}return m.glCoordMatrix}function yr(_,r,u){let m;u?(m=[_.x,_.y,u(_.x,_.y),1],i.transformMat4(m,m,r)):(m=[_.x,_.y,0,1],$i(m,m,r));const v=m[3];return{point:new i.pointGeometry(m[0]/v,m[1]/v),signedDistanceFromCamera:v}}function kr(_,r){return .5+_/r*.5}function _i(_,r){const u=_[0]/_[3],m=_[1]/_[3];return u>=-r[0]&&u<=r[0]&&m>=-r[1]&&m<=r[1]}function ki(_,r,u,m,v,C,P,O,B,j){const W=m?_.textSizeData:_.iconSizeData,Q=i.evaluateSizeForZoom(W,u.transform.zoom),ne=[256/u.width*2+1,256/u.height*2+1],ge=m?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ge.clear();const fe=_.lineVertexArray,pe=m?_.text.placedSymbolArray:_.icon.placedSymbolArray,Pe=u.transform.width/u.transform.height;let De=!1;for(let Ue=0;Ue<pe.length;Ue++){const xe=pe.get(Ue);if(xe.hidden||xe.writingMode===i.WritingMode.vertical&&!De){ar(xe.numGlyphs,ge);continue}let Je;if(De=!1,j?(Je=[xe.anchorX,xe.anchorY,j(xe.anchorX,xe.anchorY),1],i.transformMat4(Je,Je,r)):(Je=[xe.anchorX,xe.anchorY,0,1],$i(Je,Je,r)),!_i(Je,ne)){ar(xe.numGlyphs,ge);continue}const He=kr(u.transform.cameraToCenterDistance,Je[3]),st=i.evaluateSizeForFeature(W,Q,xe),lt=P?st/He:st*He,yt=new i.pointGeometry(xe.anchorX,xe.anchorY),rt=yr(yt,v,j).point,Vt={},Dt=pr(xe,lt,!1,O,r,v,C,_.glyphOffsetArray,fe,ge,rt,yt,Vt,Pe,B,j);De=Dt.useVertical,(Dt.notEnoughRoom||De||Dt.needsFlipping&&pr(xe,lt,!0,O,r,v,C,_.glyphOffsetArray,fe,ge,rt,yt,Vt,Pe,B,j).notEnoughRoom)&&ar(xe.numGlyphs,ge)}m?_.text.dynamicLayoutVertexBuffer.updateData(ge):_.icon.dynamicLayoutVertexBuffer.updateData(ge)}function yi(_,r,u,m,v,C,P,O,B,j,W,Q,ne){const ge=O.glyphStartIndex+O.numGlyphs,fe=O.lineStartIndex,pe=O.lineStartIndex+O.lineLength,Pe=r.getoffsetX(O.glyphStartIndex),De=r.getoffsetX(ge-1),Ue=vi(_*Pe,u,m,v,C,P,O.segment,fe,pe,B,j,W,Q,ne);if(!Ue)return null;const xe=vi(_*De,u,m,v,C,P,O.segment,fe,pe,B,j,W,Q,ne);return xe?{first:Ue,last:xe}:null}function Tt(_,r,u,m){return _===i.WritingMode.horizontal&&Math.abs(u.y-r.y)>Math.abs(u.x-r.x)*m?{useVertical:!0}:(_===i.WritingMode.vertical?r.y<u.y:r.x>u.x)?{needsFlipping:!0}:null}function pr(_,r,u,m,v,C,P,O,B,j,W,Q,ne,ge,fe,pe){const Pe=r/24,De=_.lineOffsetX*Pe,Ue=_.lineOffsetY*Pe;let xe;if(_.numGlyphs>1){const Je=_.glyphStartIndex+_.numGlyphs,He=_.lineStartIndex,st=_.lineStartIndex+_.lineLength,lt=yi(Pe,O,De,Ue,u,W,Q,_,B,C,ne,fe,pe);if(!lt)return{notEnoughRoom:!0};const yt=yr(lt.first.point,P,pe).point,rt=yr(lt.last.point,P,pe).point;if(m&&!u){const Vt=Tt(_.writingMode,yt,rt,ge);if(Vt)return Vt}xe=[lt.first];for(let Vt=_.glyphStartIndex+1;Vt<Je-1;Vt++)xe.push(vi(Pe*O.getoffsetX(Vt),De,Ue,u,W,Q,_.segment,He,st,B,C,ne,fe,pe));xe.push(lt.last)}else{if(m&&!u){const He=yr(Q,v,pe).point,st=_.lineStartIndex+_.segment+1,lt=new i.pointGeometry(B.getx(st),B.gety(st)),yt=yr(lt,v,pe),rt=yt.signedDistanceFromCamera>0?yt.point:hr(Q,lt,He,1,v,pe),Vt=Tt(_.writingMode,He,rt,ge);if(Vt)return Vt}const Je=vi(Pe*O.getoffsetX(_.glyphStartIndex),De,Ue,u,W,Q,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,B,C,ne,fe,pe);if(!Je)return{notEnoughRoom:!0};xe=[Je]}for(const Je of xe)i.addDynamicAttributes(j,Je.point,Je.angle);return{}}function hr(_,r,u,m,v,C){const P=yr(_.add(_.sub(r)._unit()),v,C).point,O=u.sub(P);return u.add(O._mult(m/O.mag()))}function vi(_,r,u,m,v,C,P,O,B,j,W,Q,ne,ge){const fe=m?_-r:_+r;let pe=fe>0?1:-1,Pe=0;m&&(pe*=-1,Pe=Math.PI),pe<0&&(Pe+=Math.PI);let De=pe>0?O+P:O+P+1,Ue=v,xe=v,Je=0,He=0;const st=Math.abs(fe),lt=[];for(;Je+He<=st;){if(De+=pe,De<O||De>=B)return null;if(xe=Ue,lt.push(Ue),Ue=Q[De],Ue===void 0){const $t=new i.pointGeometry(j.getx(De),j.gety(De)),gr=yr($t,W,ge);if(gr.signedDistanceFromCamera>0)Ue=Q[De]=gr.point;else{const br=De-pe;Ue=hr(Je===0?C:new i.pointGeometry(j.getx(br),j.gety(br)),$t,xe,st-Je+1,W,ge)}}Je+=He,He=xe.dist(Ue)}const yt=(st-Je)/He,rt=Ue.sub(xe),Vt=rt.mult(yt)._add(xe);Vt._add(rt._unit()._perp()._mult(u*pe));const Dt=Pe+Math.atan2(Ue.y-xe.y,Ue.x-xe.x);return lt.push(Vt),{point:Vt,angle:ne?Dt:0,path:lt}}const sn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ar(_,r){for(let u=0;u<_;u++){const m=r.length;r.resize(m+4),r.float32.set(sn,3*m)}}function $i(_,r,u){const m=r[0],v=r[1];return _[0]=u[0]*m+u[4]*v+u[12],_[1]=u[1]*m+u[5]*v+u[13],_[3]=u[3]*m+u[7]*v+u[15],_}const ii=100;class ls{constructor(r,u=new _t(r.width+200,r.height+200,25),m=new _t(r.width+200,r.height+200,25)){this.transform=r,this.grid=u,this.ignoredGrid=m,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ii,this.screenBottomBoundary=r.height+ii,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,u,m,v,C,P){const O=this.projectAndGetPerspectiveRatio(v,r.anchorPointX,r.anchorPointY,P),B=m*O.perspectiveRatio,j=r.x1*B+O.point.x,W=r.y1*B+O.point.y,Q=r.x2*B+O.point.x,ne=r.y2*B+O.point.y;return!this.isInsideGrid(j,W,Q,ne)||u!=="always"&&this.grid.hitTest(j,W,Q,ne,u,C)||O.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[j,W,Q,ne],offscreen:this.isOffscreen(j,W,Q,ne)}}placeCollisionCircles(r,u,m,v,C,P,O,B,j,W,Q,ne,ge,fe){const pe=[],Pe=new i.pointGeometry(u.anchorX,u.anchorY),De=yr(Pe,P,fe),Ue=kr(this.transform.cameraToCenterDistance,De.signedDistanceFromCamera),xe=(W?C/Ue:C*Ue)/i.ONE_EM,Je=yr(Pe,O,fe).point,He=yi(xe,v,u.lineOffsetX*xe,u.lineOffsetY*xe,!1,Je,Pe,u,m,O,{},!1,fe);let st=!1,lt=!1,yt=!0;if(He){const rt=.5*ne*Ue+ge,Vt=new i.pointGeometry(-100,-100),Dt=new i.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),$t=new wr,gr=He.first,br=He.last;let tr=[];for(let Ar=gr.path.length-1;Ar>=1;Ar--)tr.push(gr.path[Ar]);for(let Ar=1;Ar<br.path.length;Ar++)tr.push(br.path[Ar]);const qr=2.5*rt;if(B){const Ar=tr.map(Pr=>yr(Pr,B,fe));tr=Ar.some(Pr=>Pr.signedDistanceFromCamera<=0)?[]:Ar.map(Pr=>Pr.point)}let Gr=[];if(tr.length>0){const Ar=tr[0].clone(),Pr=tr[0].clone();for(let Hr=1;Hr<tr.length;Hr++)Ar.x=Math.min(Ar.x,tr[Hr].x),Ar.y=Math.min(Ar.y,tr[Hr].y),Pr.x=Math.max(Pr.x,tr[Hr].x),Pr.y=Math.max(Pr.y,tr[Hr].y);Gr=Ar.x>=Vt.x&&Pr.x<=Dt.x&&Ar.y>=Vt.y&&Pr.y<=Dt.y?[tr]:Pr.x<Vt.x||Ar.x>Dt.x||Pr.y<Vt.y||Ar.y>Dt.y?[]:i.clipLine([tr],Vt.x,Vt.y,Dt.x,Dt.y)}for(const Ar of Gr){$t.reset(Ar,.25*rt);let Pr=0;Pr=$t.length<=.5*rt?1:Math.ceil($t.paddedLength/qr)+1;for(let Hr=0;Hr<Pr;Hr++){const Ai=Hr/Math.max(Pr-1,1),Rn=$t.lerp(Ai),En=Rn.x+ii,On=Rn.y+ii;pe.push(En,On,rt,0);const ys=En-rt,vn=On-rt,Qi=En+rt,Xn=On+rt;if(yt=yt&&this.isOffscreen(ys,vn,Qi,Xn),lt=lt||this.isInsideGrid(ys,vn,Qi,Xn),r!=="always"&&this.grid.hitTestCircle(En,On,rt,r,Q)&&(st=!0,!j))return{circles:[],offscreen:!1,collisionDetected:st}}}}return{circles:!j&&st||!lt||Ue<this.perspectiveRatioCutoff?[]:pe,offscreen:yt,collisionDetected:st}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let m=1/0,v=1/0,C=-1/0,P=-1/0;for(const W of r){const Q=new i.pointGeometry(W.x+ii,W.y+ii);m=Math.min(m,Q.x),v=Math.min(v,Q.y),C=Math.max(C,Q.x),P=Math.max(P,Q.y),u.push(Q)}const O=this.grid.query(m,v,C,P).concat(this.ignoredGrid.query(m,v,C,P)),B={},j={};for(const W of O){const Q=W.key;if(B[Q.bucketInstanceId]===void 0&&(B[Q.bucketInstanceId]={}),B[Q.bucketInstanceId][Q.featureIndex])continue;const ne=[new i.pointGeometry(W.x1,W.y1),new i.pointGeometry(W.x2,W.y1),new i.pointGeometry(W.x2,W.y2),new i.pointGeometry(W.x1,W.y2)];i.polygonIntersectsPolygon(u,ne)&&(B[Q.bucketInstanceId][Q.featureIndex]=!0,j[Q.bucketInstanceId]===void 0&&(j[Q.bucketInstanceId]=[]),j[Q.bucketInstanceId].push(Q.featureIndex))}return j}insertCollisionBox(r,u,m,v,C,P){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:C,collisionGroupID:P,overlapMode:u},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,m,v,C,P){const O=m?this.ignoredGrid:this.grid,B={bucketInstanceId:v,featureIndex:C,collisionGroupID:P,overlapMode:u};for(let j=0;j<r.length;j+=4)O.insertCircle(B,r[j],r[j+1],r[j+2])}projectAndGetPerspectiveRatio(r,u,m,v){let C;return v?(C=[u,m,v(u,m),1],i.transformMat4(C,C,r)):(C=[u,m,0,1],$i(C,C,r)),{point:new i.pointGeometry((C[0]/C[3]+1)/2*this.transform.width+ii,(-C[1]/C[3]+1)/2*this.transform.height+ii),perspectiveRatio:.5+this.transform.cameraToCenterDistance/C[3]*.5}}isOffscreen(r,u,m,v){return m<ii||r>=this.screenRightBoundary||v<ii||u>this.screenBottomBoundary}isInsideGrid(r,u,m,v){return m>=0&&r<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const r=i.identity([]);return i.translate(r,r,[-100,-100,0]),r}}function hi(_,r,u){return r*(i.EXTENT/(_.tileSize*Math.pow(2,u-_.tileID.overscaledZ)))}class Li{constructor(r,u,m,v){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Rr{constructor(r,u,m,v,C){this.text=new Li(r?r.text:null,u,m,C),this.icon=new Li(r?r.icon:null,u,v,C)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jn{constructor(r,u,m){this.text=r,this.icon=u,this.skipFade=m}}class _n{constructor(){this.invProjMatrix=i.create(),this.viewportMatrix=i.create(),this.circles=[]}}class zn{constructor(r,u,m,v,C){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=C}}class qn{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[r]}}function Gn(_,r,u,m,v){const{horizontalAlign:C,verticalAlign:P}=i.getAnchorAlignment(_),O=-(C-.5)*r,B=-(P-.5)*u,j=i.evaluateVariableOffset(_,m);return new i.pointGeometry(O+j[0]*v,B+j[1]*v)}function Ae(_,r,u,m,v,C){const{x1:P,x2:O,y1:B,y2:j,anchorPointX:W,anchorPointY:Q}=_,ne=new i.pointGeometry(r,u);return m&&ne._rotate(v?C:-C),{x1:P+ne.x,y1:B+ne.y,x2:O+ne.x,y2:j+ne.y,anchorPointX:W,anchorPointY:Q}}class U{constructor(r,u,m,v,C){this.transform=r.clone(),this.terrain=u,this.collisionIndex=new ls(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new qn(v),this.collisionCircleArrays={},this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,u,m,v){const C=m.getBucket(u),P=m.latestFeatureIndex;if(!C||!P||u.id!==C.layerIds[0])return;const O=m.collisionBoxArray,B=C.layers[0].layout,j=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),W=m.tileSize/i.EXTENT,Q=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),ne=B.get("text-pitch-alignment")==="map",ge=B.get("text-rotation-alignment")==="map",fe=hi(m,1,this.transform.zoom),pe=gi(Q,ne,ge,this.transform,fe);let Pe=null;if(ne){const Ue=ri(Q,ne,ge,this.transform,fe);Pe=i.multiply([],this.transform.labelPlaneMatrix,Ue)}this.retainedQueryData[C.bucketInstanceId]=new zn(C.bucketInstanceId,P,C.sourceLayerIndex,C.index,m.tileID);const De={bucket:C,layout:B,posMatrix:Q,textLabelPlaneMatrix:pe,labelToScreenMatrix:Pe,scale:j,textPixelRatio:W,holdingForFade:m.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:i.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(v)for(const Ue of C.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:Je,symbolInstanceEnd:He}=Ue;r.push({sortKey:xe,symbolInstanceStart:Je,symbolInstanceEnd:He,parameters:De})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:De})}attemptAnchorPlacement(r,u,m,v,C,P,O,B,j,W,Q,ne,ge,fe,pe,Pe){const De=[ne.textOffset0,ne.textOffset1],Ue=Gn(r,m,v,De,C),xe=this.collisionIndex.placeCollisionBox(Ae(u,Ue.x,Ue.y,P,O,this.transform.angle),Q,B,j,W.predicate,Pe);if((!pe||this.collisionIndex.placeCollisionBox(Ae(pe,Ue.x,Ue.y,P,O,this.transform.angle),Q,B,j,W.predicate,Pe).box.length!==0)&&xe.box.length>0){let Je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID].text&&(Je=this.prevPlacement.variableOffsets[ne.crossTileID].anchor),ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ne.crossTileID]={textOffset:De,width:m,height:v,anchor:r,textBoxScale:C,prevAnchor:Je},this.markUsedJustification(ge,r,ne,fe),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,fe,ne),this.placedOrientations[ne.crossTileID]=fe),{shift:Ue,placedGlyphBoxes:xe}}}placeLayerBucketPart(r,u,m){const{bucket:v,layout:C,posMatrix:P,textLabelPlaneMatrix:O,labelToScreenMatrix:B,textPixelRatio:j,holdingForFade:W,collisionBoxArray:Q,partiallyEvaluatedTextSize:ne,collisionGroup:ge}=r.parameters,fe=C.get("text-optional"),pe=C.get("icon-optional"),Pe=i.getOverlapMode(C,"text-overlap","text-allow-overlap"),De=Pe==="always",Ue=i.getOverlapMode(C,"icon-overlap","icon-allow-overlap"),xe=Ue==="always",Je=C.get("text-rotation-alignment")==="map",He=C.get("text-pitch-alignment")==="map",st=C.get("icon-text-fit")!=="none",lt=C.get("symbol-z-order")==="viewport-y",yt=De&&(xe||!v.hasIconData()||pe),rt=xe&&(De||!v.hasTextData()||fe);!v.collisionArrays&&Q&&v.deserializeCollisionBoxes(Q);const Vt=(Dt,$t)=>{if(u[Dt.crossTileID])return;if(W)return void(this.placements[Dt.crossTileID]=new jn(!1,!1,!1));let gr=!1,br=!1,tr=!0,qr=null,Gr={box:null,offscreen:null},Ar={box:null,offscreen:null},Pr=null,Hr=null,Ai=null,Rn=0,En=0,On=0;$t.textFeatureIndex?Rn=$t.textFeatureIndex:Dt.useRuntimeCollisionCircles&&(Rn=Dt.featureIndex),$t.verticalTextFeatureIndex&&(En=$t.verticalTextFeatureIndex);const ys=this.retainedQueryData[v.bucketInstanceId].tileID,vn=this.terrain?(Ei,Sr)=>this.terrain.getElevation(ys,Ei,Sr):null;for(const Ei of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Sr=$t[Ei];Sr&&(Sr.elevation=vn?vn(Sr.anchorPointX,Sr.anchorPointY):0)}const Qi=$t.textBox;if(Qi){const Ei=Ur=>{let Pi=i.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Ur&&this.prevPlacement){const Mi=this.prevPlacement.placedOrientations[Dt.crossTileID];Mi&&(this.placedOrientations[Dt.crossTileID]=Mi,Pi=Mi,this.markUsedOrientation(v,Pi,Dt))}return Pi},Sr=(Ur,Pi)=>{if(v.allowVerticalPlacement&&Dt.numVerticalGlyphVertices>0&&$t.verticalTextBox){for(const Mi of v.writingModes)if(Mi===i.WritingMode.vertical?(Gr=Pi(),Ar=Gr):Gr=Ur(),Gr&&Gr.box&&Gr.box.length)break}else Gr=Ur()};if(C.get("text-variable-anchor")){let Ur=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Dt.crossTileID]){const oi=this.prevPlacement.variableOffsets[Dt.crossTileID];Ur.indexOf(oi.anchor)>0&&(Ur=Ur.filter(bn=>bn!==oi.anchor),Ur.unshift(oi.anchor))}const Pi=(oi,bn,Ps)=>{const Al=oi.x2-oi.x1,na=oi.y2-oi.y1,cu=Dt.textBoxScale,Pl=st&&Ue==="never"?bn:null;let vs={box:[],offscreen:!1};const Ms=Pe!=="never"?2*Ur.length:Ur.length;for(let zs=0;zs<Ms;++zs){const To=this.attemptAnchorPlacement(Ur[zs%Ur.length],oi,Al,na,cu,Je,He,j,P,ge,zs>=Ur.length?Pe:"never",Dt,v,Ps,Pl,vn);if(To&&(vs=To.placedGlyphBoxes,vs&&vs.box&&vs.box.length)){gr=!0,qr=To.shift;break}}return vs};Sr(()=>Pi(Qi,$t.iconBox,i.WritingMode.horizontal),()=>{const oi=$t.verticalTextBox;return v.allowVerticalPlacement&&!(Gr&&Gr.box&&Gr.box.length)&&Dt.numVerticalGlyphVertices>0&&oi?Pi(oi,$t.verticalIconBox,i.WritingMode.vertical):{box:null,offscreen:null}}),Gr&&(gr=Gr.box,tr=Gr.offscreen);const Mi=Ei(Gr&&Gr.box);if(!gr&&this.prevPlacement){const oi=this.prevPlacement.variableOffsets[Dt.crossTileID];oi&&(this.variableOffsets[Dt.crossTileID]=oi,this.markUsedJustification(v,oi.anchor,Dt,Mi))}}else{const Ur=(Pi,Mi)=>{const oi=this.collisionIndex.placeCollisionBox(Pi,Pe,j,P,ge.predicate,vn);return oi&&oi.box&&oi.box.length&&(this.markUsedOrientation(v,Mi,Dt),this.placedOrientations[Dt.crossTileID]=Mi),oi};Sr(()=>Ur(Qi,i.WritingMode.horizontal),()=>{const Pi=$t.verticalTextBox;return v.allowVerticalPlacement&&Dt.numVerticalGlyphVertices>0&&Pi?Ur(Pi,i.WritingMode.vertical):{box:null,offscreen:null}}),Ei(Gr&&Gr.box&&Gr.box.length)}}if(Pr=Gr,gr=Pr&&Pr.box&&Pr.box.length>0,tr=Pr&&Pr.offscreen,Dt.useRuntimeCollisionCircles){const Ei=v.text.placedSymbolArray.get(Dt.centerJustifiedTextSymbolIndex),Sr=i.evaluateSizeForFeature(v.textSizeData,ne,Ei),Ur=C.get("text-padding");Hr=this.collisionIndex.placeCollisionCircles(Pe,Ei,v.lineVertexArray,v.glyphOffsetArray,Sr,P,O,B,m,He,ge.predicate,Dt.collisionCircleDiameter,Ur,vn),Hr.circles.length&&Hr.collisionDetected&&!m&&i.warnOnce("Collisions detected, but collision boxes are not shown"),gr=De||Hr.circles.length>0&&!Hr.collisionDetected,tr=tr&&Hr.offscreen}if($t.iconFeatureIndex&&(On=$t.iconFeatureIndex),$t.iconBox){const Ei=Sr=>{const Ur=st&&qr?Ae(Sr,qr.x,qr.y,Je,He,this.transform.angle):Sr;return this.collisionIndex.placeCollisionBox(Ur,Ue,j,P,ge.predicate,vn)};Ar&&Ar.box&&Ar.box.length&&$t.verticalIconBox?(Ai=Ei($t.verticalIconBox),br=Ai.box.length>0):(Ai=Ei($t.iconBox),br=Ai.box.length>0),tr=tr&&Ai.offscreen}const Xn=fe||Dt.numHorizontalGlyphVertices===0&&Dt.numVerticalGlyphVertices===0,Eo=pe||Dt.numIconVertices===0;if(Xn||Eo?Eo?Xn||(br=br&&gr):gr=br&&gr:br=gr=br&&gr,gr&&Pr&&Pr.box&&this.collisionIndex.insertCollisionBox(Pr.box,Pe,C.get("text-ignore-placement"),v.bucketInstanceId,Ar&&Ar.box&&En?En:Rn,ge.ID),br&&Ai&&this.collisionIndex.insertCollisionBox(Ai.box,Ue,C.get("icon-ignore-placement"),v.bucketInstanceId,On,ge.ID),Hr&&(gr&&this.collisionIndex.insertCollisionCircles(Hr.circles,Pe,C.get("text-ignore-placement"),v.bucketInstanceId,Rn,ge.ID),m)){const Ei=v.bucketInstanceId;let Sr=this.collisionCircleArrays[Ei];Sr===void 0&&(Sr=this.collisionCircleArrays[Ei]=new _n);for(let Ur=0;Ur<Hr.circles.length;Ur+=4)Sr.circles.push(Hr.circles[Ur+0]),Sr.circles.push(Hr.circles[Ur+1]),Sr.circles.push(Hr.circles[Ur+2]),Sr.circles.push(Hr.collisionDetected?1:0)}if(Dt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Dt.crossTileID]=new jn(gr||yt,br||rt,tr||v.justReloaded),u[Dt.crossTileID]=!0};if(lt){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Dt=v.getSortedSymbolIndexes(this.transform.angle);for(let $t=Dt.length-1;$t>=0;--$t){const gr=Dt[$t];Vt(v.symbolInstances.get(gr),v.collisionArrays[gr])}}else for(let Dt=r.symbolInstanceStart;Dt<r.symbolInstanceEnd;Dt++)Vt(v.symbolInstances.get(Dt),v.collisionArrays[Dt]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const Dt=this.collisionCircleArrays[v.bucketInstanceId];i.invert(Dt.invProjMatrix,P),Dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,u,m,v){let C;C=v===i.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[i.getAnchorJustification(u)];const P=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const O of P)O>=0&&(r.text.placedSymbolArray.get(O).crossTileID=C>=0&&O!==C?0:m.crossTileID)}markUsedOrientation(r,u,m){const v=u===i.WritingMode.horizontal||u===i.WritingMode.horizontalOnly?u:0,C=u===i.WritingMode.vertical?u:0,P=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const O of P)r.text.placedSymbolArray.get(O).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(r):1,C=u?u.opacities:{},P=u?u.variableOffsets:{},O=u?u.placedOrientations:{};for(const B in this.placements){const j=this.placements[B],W=C[B];W?(this.opacities[B]=new Rr(W,v,j.text,j.icon),m=m||j.text!==W.text.placed||j.icon!==W.icon.placed):(this.opacities[B]=new Rr(null,v,j.text,j.icon,j.skipFade),m=m||j.text||j.icon)}for(const B in C){const j=C[B];if(!this.opacities[B]){const W=new Rr(j,v,!1,!1);W.isHidden()||(this.opacities[B]=W,m=m||j.text.placed||j.icon.placed)}}for(const B in P)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=P[B]);for(const B in O)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=O[B]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u){const m={};for(const v of u){const C=v.getBucket(r);C&&v.latestFeatureIndex&&r.id===C.layerIds[0]&&this.updateBucketOpacities(C,m,v.collisionBoxArray)}}updateBucketOpacities(r,u,m){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const v=r.layers[0].layout,C=new Rr(null,0,!1,!1,!0),P=v.get("text-allow-overlap"),O=v.get("icon-allow-overlap"),B=v.get("text-variable-anchor"),j=v.get("text-rotation-alignment")==="map",W=v.get("text-pitch-alignment")==="map",Q=v.get("icon-text-fit")!=="none",ne=new Rr(null,0,P&&(O||!r.hasIconData()||v.get("icon-optional")),O&&(P||!r.hasTextData()||v.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const ge=(fe,pe,Pe)=>{for(let De=0;De<pe/4;De++)fe.opacityVertexArray.emplaceBack(Pe)};for(let fe=0;fe<r.symbolInstances.length;fe++){const pe=r.symbolInstances.get(fe),{numHorizontalGlyphVertices:Pe,numVerticalGlyphVertices:De,crossTileID:Ue}=pe;let xe=this.opacities[Ue];u[Ue]?xe=C:xe||(xe=ne,this.opacities[Ue]=xe),u[Ue]=!0;const Je=pe.numIconVertices>0,He=this.placedOrientations[pe.crossTileID],st=He===i.WritingMode.vertical,lt=He===i.WritingMode.horizontal||He===i.WritingMode.horizontalOnly;if(Pe>0||De>0){const yt=Ce(xe.text);ge(r.text,Pe,st?qe:yt),ge(r.text,De,lt?qe:yt);const rt=xe.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach($t=>{$t>=0&&(r.text.placedSymbolArray.get($t).hidden=rt||st?1:0)}),pe.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=rt||lt?1:0);const Vt=this.variableOffsets[pe.crossTileID];Vt&&this.markUsedJustification(r,Vt.anchor,pe,He);const Dt=this.placedOrientations[pe.crossTileID];Dt&&(this.markUsedJustification(r,"left",pe,Dt),this.markUsedOrientation(r,Dt,pe))}if(Je){const yt=Ce(xe.icon),rt=!(Q&&pe.verticalPlacedIconSymbolIndex&&st);pe.placedIconSymbolIndex>=0&&(ge(r.icon,pe.numIconVertices,rt?yt:qe),r.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=xe.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(ge(r.icon,pe.numVerticalIconVertices,rt?qe:yt),r.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=xe.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const yt=r.collisionArrays[fe];if(yt){let rt=new i.pointGeometry(0,0);if(yt.textBox||yt.verticalTextBox){let Dt=!0;if(B){const $t=this.variableOffsets[Ue];$t?(rt=Gn($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),j&&rt._rotate(W?this.transform.angle:-this.transform.angle)):Dt=!1}yt.textBox&&L(r.textCollisionBox.collisionVertexArray,xe.text.placed,!Dt||st,rt.x,rt.y),yt.verticalTextBox&&L(r.textCollisionBox.collisionVertexArray,xe.text.placed,!Dt||lt,rt.x,rt.y)}const Vt=!!(!lt&&yt.verticalIconBox);yt.iconBox&&L(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,Vt,Q?rt.x:0,Q?rt.y:0),yt.verticalIconBox&&L(r.iconCollisionBox.collisionVertexArray,xe.icon.placed,!Vt,Q?rt.x:0,Q?rt.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const fe=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=fe.invProjMatrix,r.placementViewportMatrix=fe.viewportMatrix,r.collisionCircleArray=fe.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function L(_,r,u,m,v){_.emplaceBack(r?1:0,u?1:0,m||0,v||0),_.emplaceBack(r?1:0,u?1:0,m||0,v||0),_.emplaceBack(r?1:0,u?1:0,m||0,v||0),_.emplaceBack(r?1:0,u?1:0,m||0,v||0)}const V=Math.pow(2,25),H=Math.pow(2,24),te=Math.pow(2,17),he=Math.pow(2,16),Te=Math.pow(2,9),Se=Math.pow(2,8),ye=Math.pow(2,1);function Ce(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const r=_.placed?1:0,u=Math.floor(127*_.opacity);return u*V+r*H+u*te+r*he+u*Te+r*Se+u*ye+r}const qe=0;class at{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,u,m,v,C){const P=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(P,v,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((O,B)=>O.sortKey-B.sortKey));this._currentPartIndex<P.length;)if(u.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,C())return!0;return!1}}class Le{constructor(r,u,m,v,C,P,O,B){this.placement=new U(r,u,P,O,B),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(r,u,m){const v=i.exported.now(),C=()=>{const P=i.exported.now()-v;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=u[r[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=O)&&(!P.maxzoom||P.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new at(P)),this._inProgressLayer.continuePlacement(m[P.source],this.placement,this._showCollisionBoxes,P,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const It=512/i.EXTENT/2;class Pt{constructor(r,u,m){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let v=0;v<u.length;v++){const C=u.get(v),P=C.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,r)})}}getScaledCoordinates(r,u){const m=It/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*i.EXTENT+r.anchorX)*m),y:Math.floor((u.canonical.y*i.EXTENT+r.anchorY)*m)}}findMatches(r,u,m){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let C=0;C<r.length;C++){const P=r.get(C);if(P.crossTileID)continue;const O=this.indexedSymbolInstances[P.key];if(!O)continue;const B=this.getScaledCoordinates(P,u);for(const j of O)if(Math.abs(j.coord.x-B.x)<=v&&Math.abs(j.coord.y-B.y)<=v&&!m[j.crossTileID]){m[j.crossTileID]=!0,P.crossTileID=j.crossTileID;break}}}}class bt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const u=Math.round((r-this.lng)/360);if(u!==0)for(const m in this.indexes){const v=this.indexes[m],C={};for(const P in v){const O=v[P];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+u),C[O.tileID.key]=O}this.indexes[m]=C}this.lng=r}addBucket(r,u,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let C=0;C<u.symbolInstances.length;C++)u.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const v=this.usedCrossTileIDs[r.overscaledZ];for(const C in this.indexes){const P=this.indexes[C];if(Number(C)>r.overscaledZ)for(const O in P){const B=P[O];B.tileID.isChildOf(r)&&B.findMatches(u.symbolInstances,r,v)}else{const O=P[r.scaledTo(Number(C)).key];O&&O.findMatches(u.symbolInstances,r,v)}}for(let C=0;C<u.symbolInstances.length;C++){const P=u.symbolInstances.get(C);P.crossTileID||(P.crossTileID=m.generate(),v[P.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Pt(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(const m in u.indexedSymbolInstances)for(const v of u.indexedSymbolInstances[m])delete this.usedCrossTileIDs[r][v.crossTileID]}removeStaleBuckets(r){let u=!1;for(const m in this.indexes){const v=this.indexes[m];for(const C in v)r[v[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[C]),delete v[C],u=!0)}return u}}class Yt{constructor(){this.layerIndexes={},this.crossTileIDs=new bt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,m){let v=this.layerIndexes[r.id];v===void 0&&(v=this.layerIndexes[r.id]=new Xt);let C=!1;const P={};v.handleWrapJump(m);for(const O of u){const B=O.getBucket(r);B&&r.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(O.tileID,B,this.crossTileIDs)&&(C=!0),P[B.bucketInstanceId]=!0)}return v.removeStaleBuckets(P)&&(C=!0),C}pruneUnusedLayers(r){const u={};r.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}var mr=i.createLayout([{name:"a_pos",type:"Int16",components:2}]);class or extends i.Evented{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=r._cache.max,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const r in this._tiles){const u=this._tiles[r];u.textures.forEach(m=>m.destroy()),u.textures=[]}}update(r,u){this.sourceCache.update(r,u),this._renderableTilesKeys=[];for(const m of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),i.ortho(m.posMatrix,0,i.EXTENT,0,i.EXTENT,0,1),this._tiles[m.key]=new Xe(m,this.tileSize))}removeOutdated(r){const u={};this.renderHistory=this.renderHistory.filter((m,v)=>this.renderHistory.indexOf(m)===v).slice(0,this.renderHistorySize);for(const m of this._renderableTilesKeys)u[m]=!0;for(const m of this.renderHistory)u[m]=!0;for(const m in this._tiles)u[m]||(this._tiles[m].clearTextures(r),delete this._tiles[m])}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const u={};for(const m of this._renderableTilesKeys){const v=this._tiles[m].tileID;if(v.canonical.equals(r.canonical)){const C=r.clone();C.posMatrix=new Float64Array(16),i.ortho(C.posMatrix,0,i.EXTENT,0,i.EXTENT,0,1),u[m]=C}else if(v.canonical.isChildOf(r.canonical)){const C=r.clone();C.posMatrix=new Float64Array(16);const P=v.canonical.z-r.canonical.z,O=v.canonical.x-(v.canonical.x>>P<<P),B=v.canonical.y-(v.canonical.y>>P<<P),j=i.EXTENT>>P;i.ortho(C.posMatrix,0,j,0,j,0,1),i.translate(C.posMatrix,C.posMatrix,[-O*j,-B*j,0]),u[m]=C}else if(r.canonical.isChildOf(v.canonical)){const C=r.clone();C.posMatrix=new Float64Array(16);const P=r.canonical.z-v.canonical.z,O=r.canonical.x-(r.canonical.x>>P<<P),B=r.canonical.y-(r.canonical.y>>P<<P),j=i.EXTENT>>P;i.ortho(C.posMatrix,0,i.EXTENT,0,i.EXTENT,0,1),i.translate(C.posMatrix,C.posMatrix,[O*j,B*j,0]),i.scale(C.posMatrix,C.posMatrix,[1/2**P,1/2**P,0]),u[m]=C}}return u}getSourceTile(r,u){const m=this.sourceCache._source;let v=r.overscaledZ-this.deltaZoom;if(v>m.maxzoom&&(v=m.maxzoom),v<m.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(v).key);let C=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!C||!C.dem)&&u)for(;v>=m.minzoom&&(!C||!C.dem);)C=this.sourceCache.getTileByID(r.scaledTo(v--).key);return C}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(u=>u.timeLoaded>=r)}}class fr{constructor(r,u,m){this.style=r,this.sourceCache=new or(u),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.elevationOffset=typeof m.elevationOffset=="number"?m.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(r,u,m,v=i.EXTENT){if(!(u>=0&&u<v&&m>=0&&m<v))return this.elevationOffset;let C=0;const P=this.getTerrainData(r);if(P.tile&&P.tile.dem){const O=i.transformMat4$1([],[u/v*i.EXTENT,m/v*i.EXTENT],P.u_terrain_matrix),B=[O[0]*P.tile.dem.dim,O[1]*P.tile.dem.dim],j=[Math.floor(B[0]),Math.floor(B[1])],W=P.tile.dem.get(j[0],j[1]),Q=P.tile.dem.get(j[0],j[1]+1),ne=P.tile.dem.get(j[0]+1,j[1]),ge=P.tile.dem.get(j[0]+1,j[1]+1);C=i.number(i.number(W,Q,B[0]-j[0]),i.number(ne,ge,B[0]-j[0]),B[1]-j[1])}return C}rememberForRerender(r,u){for(const m in this.sourceCache._tiles){const v=this.sourceCache._tiles[m];(v.tileID.equals(u)||v.tileID.isChildOf(u))&&(r===this.sourceCache.sourceCache.id&&(v.timeLoaded=Date.now()),this._rerender[r]=this._rerender[r]||{},this._rerender[r][v.tileID.key]=!0)}}needsRerender(r,u){return this._rerender[r]&&this._rerender[r][u.key]}clearRerenderCache(){this._rerender={}}getElevation(r,u,m,v=i.EXTENT){return(this.getDEMElevation(r,u,m,v)+this.elevationOffset)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const v=this.style.map.painter.context,C=new i.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new T(v,C,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new T(v,new i.RGBAImage({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=i.identity([])}const u=this.sourceCache.getSourceTile(r,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const v=this.style.map.painter.context;u.demTexture=this.style.map.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new T(v,u.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),u.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const m=u&&u+u.tileID.key+r.key;if(m&&!this._demMatrixCache[m]){const v=this.sourceCache.sourceCache._source.maxzoom;let C=r.canonical.z-u.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=v?C=r.canonical.z-v:i.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=r.canonical.x-(r.canonical.x>>C<<C),O=r.canonical.y-(r.canonical.y>>C<<C),B=i.fromScaling(new Float64Array(16),[1/(i.EXTENT<<C),1/(i.EXTENT<<C),0]);i.translate(B,B,[P*i.EXTENT,O*i.EXTENT,0]),this._demMatrixCache[r.key]={matrix:B,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getRTTFramebuffer(){const r=this.style.map.painter;if(!this._rttFramebuffer){const u=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=r.context.createFramebuffer(u,u,!0),this._rttFramebuffer.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,u,u))}return this._rttFramebuffer}getFramebuffer(r){const u=this.style.map.painter,m=u.width/devicePixelRatio,v=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new T(u.context,{width:m,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new T(u.context,{width:m,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(m,v,!0),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,m,v))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let C=0,P=0;C<this._coordsTextureSize;C++)for(let O=0;O<this._coordsTextureSize;O++,P+=4)u[P+0]=255&O,u[P+1]=255&C,u[P+2]=O>>8<<4|C>>8,u[P+3]=0;const m=new i.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),v=new T(r,m,r.gl.RGBA,{premultiply:!1});return v.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(r){const u=new Uint8Array(4),m=this.style.map.painter,v=m.context,C=v.gl;v.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),C.readPixels(r.x,m.height/devicePixelRatio-r.y-1,1,1,C.RGBA,C.UNSIGNED_BYTE,u),v.bindFramebuffer.set(null);const P=u[0]+(u[2]>>4<<8),O=u[1]+((15&u[2])<<8),B=this.coordsIndex[255-u[3]],j=B&&this.sourceCache.getTileByID(B);if(!j)return null;const W=this._coordsTextureSize,Q=(1<<j.tileID.canonical.z)*W;return new i.MercatorCoordinate((j.tileID.canonical.x*W+P)/Q,(j.tileID.canonical.y*W+O)/Q,this.getElevation(j.tileID,P,O,W))}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.style.map.painter.context,u=new i.PosArray,m=new i.TriangleIndexArray,v=this.meshSize,C=i.EXTENT/v,P=v*v;for(let O=0;O<=v;O++)for(let B=0;B<=v;B++)u.emplaceBack(B*C,O*C);for(let O=0;O<P;O+=v+1)for(let B=0;B<v;B++)m.emplaceBack(B+O,v+B+O+1,v+B+O+2),m.emplaceBack(B+O,v+B+O+2,B+O+1);return this._mesh={indexBuffer:r.createIndexBuffer(m),vertexBuffer:r.createVertexBuffer(u,mr.members),segments:i.SegmentVector.simpleSegment(0,0,u.length,m.length)},this._mesh}getMinMaxElevation(r){const u=this.getTerrainData(r).tile,m={minElevation:null,maxElevation:null};return u&&u.dem&&(m.minElevation=(u.dem.min+this.elevationOffset)*this.exaggeration,m.maxElevation=(u.dem.max+this.elevationOffset)*this.exaggeration),m}}const dr=(_,r)=>i.emitValidationErrors(_,r&&r.filter(u=>u.identifier!=="source.canvas")),Er=i.pick(Ie,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Qr=i.pick(Ie,["setCenter","setZoom","setBearing","setPitch"]),Dr=function(){const _={},r=i.spec.$version;for(const u in i.spec.$root){const m=i.spec.$root[u];if(m.required){let v=null;v=u==="version"?r:m.type==="array"?[]:{},v!=null&&(_[u]=v)}}return _}();class di extends i.Evented{constructor(r,u={}){super(),this.map=r,this.dispatcher=new Ee(et(),this),this.imageManager=new z,this.imageManager.setEventedParent(this),this.glyphManager=new q(r._requestManager,u.localIdeographFontFamily),this.lineAtlas=new de(256,512),this.crossTileSymbolIndex=new Yt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new i.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.getReferrer());const m=this;this._rtlTextPluginCallback=di.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(C,P)=>{if(i.triggerPluginCompletionEvent(C),P&&P.every(O=>O))for(const O in m.sourceCaches)m.sourceCaches[O].reload()})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const C=this.sourceCaches[v.sourceId];if(!C)return;const P=C.getSource();if(P&&P.vectorLayerIds)for(const O in this._layers){const B=this._layers[O];B.source===P.id&&this._validateLayer(B)}})}loadURL(r,u={}){this.fire(new i.Event("dataloading",{dataType:"style"}));const m=typeof u.validate!="boolean"||u.validate,v=this.map._requestManager.transformRequest(r,i.ResourceType.Style);this._request=i.getJSON(v,(C,P)=>{this._request=null,C?this.fire(new i.ErrorEvent(C)):P&&this._load(P,m)})}loadJSON(r,u={}){this.fire(new i.Event("dataloading",{dataType:"style"})),this._request=i.exported.frame(()=>{this._request=null,this._load(r,u.validate!==!1)})}loadEmpty(){this.fire(new i.Event("dataloading",{dataType:"style"})),this._load(Dr,!1)}_load(r,u){if(u&&dr(this,i.validateStyle(r)))return;this._loaded=!0,this.stylesheet=r;for(const v in r.sources)this.addSource(v,r.sources[v],{validate:!1});r.sprite?this._loadSprite(r.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(r.glyphs);const m=me(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of m)v=i.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new oe(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new i.Event("data",{dataType:"style"})),this.fire(new i.Event("style.load"))}_loadSprite(r){this._spriteRequest=function(u,m,v,C){let P,O,B;const j=v>1?"@2x":"";let W=i.getJSON(m.transformRequest(m.normalizeSpriteURL(u,j,".json"),i.ResourceType.SpriteJSON),(ge,fe)=>{W=null,B||(B=ge,P=fe,ne())}),Q=i.getImage(m.transformRequest(m.normalizeSpriteURL(u,j,".png"),i.ResourceType.SpriteImage),(ge,fe)=>{Q=null,B||(B=ge,O=fe,ne())});function ne(){if(B)C(B);else if(P&&O){const ge=i.exported.getImageData(O),fe={};for(const pe in P){const{width:Pe,height:De,x:Ue,y:xe,sdf:Je,pixelRatio:He,stretchX:st,stretchY:lt,content:yt}=P[pe],rt=new i.RGBAImage({width:Pe,height:De});i.RGBAImage.copy(ge,rt,{x:Ue,y:xe},{x:0,y:0},{width:Pe,height:De}),fe[pe]={data:rt,pixelRatio:He,sdf:Je,stretchX:st,stretchY:lt,content:yt}}C(null,fe)}}return{cancel(){W&&(W.cancel(),W=null),Q&&(Q.cancel(),Q=null)}}}(r,this.map._requestManager,this.map.getPixelRatio(),(u,m)=>{if(this._spriteRequest=null,u)this.fire(new i.ErrorEvent(u));else if(m)for(const v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))})}_validateLayer(r){const u=this.sourceCaches[r.source];if(!u)return;const m=r.sourceLayer;if(!m)return;const v=u.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(m)===-1)&&this.fire(new i.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${v.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const u=[];for(const m of r){const v=this._layers[m];v.type!=="custom"&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(v.length||C.length)&&this._updateWorkerLayers(v,C);for(const P in this._updatedSources){const O=this._updatedSources[P];if(O==="reload")this._reloadSource(P);else{if(O!=="clear")throw new Error(`Invalid action ${O}`);this._clearSource(P)}}this._updateTilesForChangedImages();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const m={};for(const v in this.sourceCaches){const C=this.sourceCaches[v];m[v]=C.used,C.used=!1}for(const v of this._order){const C=this._layers[v];C.recalculate(r,this._availableImages),!C.isHidden(r.zoom)&&C.source&&(this.sourceCaches[C.source].used=!0)}for(const v in m){const C=this.sourceCaches[v];m[v]!==C.used&&C.fire(new i.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(r),this.z=r.zoom,u&&this.fire(new i.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(r){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),r){const u=this.sourceCaches[r.source];if(!u)throw new Error(`cannot load terrain, because there exists no source with ID: ${r.source}`);this.terrain=new fr(this,u,r),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=m=>{m.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=m=>{m.tile&&(m.sourceId===r.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(m.sourceId,m.tile.tileID)):m.source.type==="geojson"&&this.terrain.rememberForRerender(m.sourceId,m.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new i.Event("terrain",{terrain:r}))}setState(r){if(this._checkLoaded(),dr(this,i.validateStyle(r)))return!1;(r=i.clone$1(r)).layers=me(r.layers);const u=function(v,C){if(!v)return[{command:Ie.setStyle,args:[C]}];let P=[];try{if(!k(v.version,C.version))return[{command:Ie.setStyle,args:[C]}];k(v.center,C.center)||P.push({command:Ie.setCenter,args:[C.center]}),k(v.zoom,C.zoom)||P.push({command:Ie.setZoom,args:[C.zoom]}),k(v.bearing,C.bearing)||P.push({command:Ie.setBearing,args:[C.bearing]}),k(v.pitch,C.pitch)||P.push({command:Ie.setPitch,args:[C.pitch]}),k(v.sprite,C.sprite)||P.push({command:Ie.setSprite,args:[C.sprite]}),k(v.glyphs,C.glyphs)||P.push({command:Ie.setGlyphs,args:[C.glyphs]}),k(v.transition,C.transition)||P.push({command:Ie.setTransition,args:[C.transition]}),k(v.light,C.light)||P.push({command:Ie.setLight,args:[C.light]});const O={},B=[];(function(W,Q,ne,ge){let fe;for(fe in Q=Q||{},W=W||{})Object.prototype.hasOwnProperty.call(W,fe)&&(Object.prototype.hasOwnProperty.call(Q,fe)||gt(fe,ne,ge));for(fe in Q)Object.prototype.hasOwnProperty.call(Q,fe)&&(Object.prototype.hasOwnProperty.call(W,fe)?k(W[fe],Q[fe])||(W[fe].type==="geojson"&&Q[fe].type==="geojson"&&vt(W,Q,fe)?ne.push({command:Ie.setGeoJSONSourceData,args:[fe,Q[fe].data]}):je(fe,Q,ne,ge)):ft(fe,Q,ne))})(v.sources,C.sources,B,O);const j=[];v.layers&&v.layers.forEach(W=>{O[W.source]?P.push({command:Ie.removeLayer,args:[W.id]}):j.push(W)}),P=P.concat(B),function(W,Q,ne){Q=Q||[];const ge=(W=W||[]).map(Et),fe=Q.map(Et),pe=W.reduce(Ht,{}),Pe=Q.reduce(Ht,{}),De=ge.slice(),Ue=Object.create(null);let xe,Je,He,st,lt,yt,rt;for(xe=0,Je=0;xe<ge.length;xe++)He=ge[xe],Object.prototype.hasOwnProperty.call(Pe,He)?Je++:(ne.push({command:Ie.removeLayer,args:[He]}),De.splice(De.indexOf(He,Je),1));for(xe=0,Je=0;xe<fe.length;xe++)He=fe[fe.length-1-xe],De[De.length-1-xe]!==He&&(Object.prototype.hasOwnProperty.call(pe,He)?(ne.push({command:Ie.removeLayer,args:[He]}),De.splice(De.lastIndexOf(He,De.length-Je),1)):Je++,yt=De[De.length-xe],ne.push({command:Ie.addLayer,args:[Pe[He],yt]}),De.splice(De.length-xe,0,He),Ue[He]=!0);for(xe=0;xe<fe.length;xe++)if(He=fe[xe],st=pe[He],lt=Pe[He],!Ue[He]&&!k(st,lt))if(k(st.source,lt.source)&&k(st["source-layer"],lt["source-layer"])&&k(st.type,lt.type)){for(rt in Bt(st.layout,lt.layout,ne,He,null,Ie.setLayoutProperty),Bt(st.paint,lt.paint,ne,He,null,Ie.setPaintProperty),k(st.filter,lt.filter)||ne.push({command:Ie.setFilter,args:[He,lt.filter]}),k(st.minzoom,lt.minzoom)&&k(st.maxzoom,lt.maxzoom)||ne.push({command:Ie.setLayerZoomRange,args:[He,lt.minzoom,lt.maxzoom]}),st)Object.prototype.hasOwnProperty.call(st,rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&(rt.indexOf("paint.")===0?Bt(st[rt],lt[rt],ne,He,rt.slice(6),Ie.setPaintProperty):k(st[rt],lt[rt])||ne.push({command:Ie.setLayerProperty,args:[He,rt,lt[rt]]}));for(rt in lt)Object.prototype.hasOwnProperty.call(lt,rt)&&!Object.prototype.hasOwnProperty.call(st,rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&(rt.indexOf("paint.")===0?Bt(st[rt],lt[rt],ne,He,rt.slice(6),Ie.setPaintProperty):k(st[rt],lt[rt])||ne.push({command:Ie.setLayerProperty,args:[He,rt,lt[rt]]}))}else ne.push({command:Ie.removeLayer,args:[He]}),yt=De[De.lastIndexOf(He)+1],ne.push({command:Ie.addLayer,args:[lt,yt]})}(j,C.layers,P)}catch(O){console.warn("Unable to compute style diff:",O),P=[{command:Ie.setStyle,args:[C]}]}return P}(this.serialize(),r).filter(v=>!(v.command in Qr));if(u.length===0)return!1;const m=u.filter(v=>!(v.command in Er));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{v.command!=="setTransition"&&this[v.command].apply(this,v.args)}),this.stylesheet=r,!0}addImage(r,u){if(this.getImage(r))return this.fire(new i.ErrorEvent(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,u),this._afterImageUpdated(r)}updateImage(r,u){this.imageManager.updateImage(r,u)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new i.ErrorEvent(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,u,m={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(i.validateStyle.source,`sources.${r}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=this.sourceCaches[r]=new Ke(r,u,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:v.serialize(),sourceId:r})),v.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===r)return this.fire(new i.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${m}" is using it.`)));const u=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],u.fire(new i.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,u){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const m=this.sourceCaches[r].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(u),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,u,m={}){this._checkLoaded();const v=r.id;if(this.getLayer(v))return void this.fire(new i.ErrorEvent(new Error(`Layer "${v}" already exists on this map.`)));let C;if(r.type==="custom"){if(dr(this,i.validateCustomStyleLayer(r)))return;C=i.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(v,r.source),r=i.clone$1(r),r=i.extend(r,{source:v})),this._validate(i.validateStyle.layer,`layers.${v}`,r,{arrayIndex:-1},m))return;C=i.createStyleLayer(r),this._validateLayer(C),C.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[C.id]=C.serialize()}const P=u?this._order.indexOf(u):this._order.length;if(u&&P===-1)this.fire(new i.ErrorEvent(new Error(`Cannot add layer "${v}" before non-existing layer "${u}".`)));else{if(this._order.splice(P,0,v),this._layerOrderChanged=!0,this._layers[v]=C,this._removedLayers[v]&&C.source&&C.type!=="custom"){const O=this._removedLayers[v];delete this._removedLayers[v],O.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}moveLayer(r,u){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new i.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===u)return;const m=this._order.indexOf(r);this._order.splice(m,1);const v=u?this._order.indexOf(u):this._order.length;u&&v===-1?this.fire(new i.ErrorEvent(new Error(`Cannot move layer "${r}" before non-existing layer "${u}".`))):(this._order.splice(v,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const u=this._layers[r];if(!u)return void this.fire(new i.ErrorEvent(new Error(`Cannot remove non-existing layer "${r}".`)));u.setEventedParent(null);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=u,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],u.onRemove&&u.onRemove(this.map)}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,u,m){this._checkLoaded();const v=this.getLayer(r);v?v.minzoom===u&&v.maxzoom===m||(u!=null&&(v.minzoom=u),m!=null&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new i.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,u,m={}){this._checkLoaded();const v=this.getLayer(r);if(v){if(!k(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(i.validateStyle.filter,`layers.${v.id}.filter`,u,null,m)||(v.filter=i.clone$1(u),this._updateLayer(v)))}else this.fire(new i.ErrorEvent(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return i.clone$1(this.getLayer(r).filter)}setLayoutProperty(r,u,m,v={}){this._checkLoaded();const C=this.getLayer(r);C?k(C.getLayoutProperty(u),m)||(C.setLayoutProperty(u,m,v),this._updateLayer(C)):this.fire(new i.ErrorEvent(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,u){const m=this.getLayer(r);if(m)return m.getLayoutProperty(u);this.fire(new i.ErrorEvent(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,u,m,v={}){this._checkLoaded();const C=this.getLayer(r);C?k(C.getPaintProperty(u),m)||(C.setPaintProperty(u,m,v)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new i.ErrorEvent(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,u){return this.getLayer(r).getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();const m=r.source,v=r.sourceLayer,C=this.sourceCaches[m];if(C===void 0)return void this.fire(new i.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const P=C.getSource().type;P==="geojson"&&v?this.fire(new i.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||v?(r.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),C.setFeatureState(v,r.id,u)):this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,u){this._checkLoaded();const m=r.source,v=this.sourceCaches[m];if(v===void 0)return void this.fire(new i.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const C=v.getSource().type,P=C==="vector"?r.sourceLayer:void 0;C!=="vector"||P?u&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new i.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(P,r.id,u):this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const u=r.source,m=r.sourceLayer,v=this.sourceCaches[u];if(v!==void 0)return v.getSource().type!=="vector"||m?(r.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),v.getFeatureState(m,r.id)):void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new i.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return i.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return i.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:i.mapObject(this.sourceCaches,r=>r.serialize()),layers:this._serializeLayers(this._order)},r=>r!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(r){const u=P=>this._layers[P].type==="fill-extrusion",m={},v=[];for(let P=this._order.length-1;P>=0;P--){const O=this._order[P];if(u(O)){m[O]=P;for(const B of r){const j=B[O];if(j)for(const W of j)v.push(W)}}}v.sort((P,O)=>O.intersectionZ-P.intersectionZ);const C=[];for(let P=this._order.length-1;P>=0;P--){const O=this._order[P];if(u(O))for(let B=v.length-1;B>=0;B--){const j=v[B].feature;if(m[j.layer.id]<P)break;C.push(j),v.pop()}else for(const B of r){const j=B[O];if(j)for(const W of j)C.push(W.feature)}}return C}queryRenderedFeatures(r,u,m){u&&u.filter&&this._validate(i.validateStyle.filter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new i.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of u.layers){const O=this._layers[P];if(!O)return this.fire(new i.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}const C=[];u.availableImages=this._availableImages;for(const P in this.sourceCaches)u.layers&&!v[P]||C.push(re(this.sourceCaches[P],this._layers,this._serializedLayers,r,u,m));return this.placement&&C.push(function(P,O,B,j,W,Q,ne){const ge={},fe=Q.queryRenderedSymbols(j),pe=[];for(const Pe of Object.keys(fe).map(Number))pe.push(ne[Pe]);pe.sort(ue);for(const Pe of pe){const De=Pe.featureIndex.lookupSymbolFeatures(fe[Pe.bucketInstanceId],O,Pe.bucketIndex,Pe.sourceLayerIndex,W.filter,W.layers,W.availableImages,P);for(const Ue in De){const xe=ge[Ue]=ge[Ue]||[],Je=De[Ue];Je.sort((He,st)=>{const lt=Pe.featureSortOrder;if(lt){const yt=lt.indexOf(He.featureIndex);return lt.indexOf(st.featureIndex)-yt}return st.featureIndex-He.featureIndex});for(const He of Je)xe.push(He)}}for(const Pe in ge)ge[Pe].forEach(De=>{const Ue=De.feature,xe=B[P[Pe].source].getFeatureState(Ue.layer["source-layer"],Ue.id);Ue.source=Ue.layer.source,Ue.layer["source-layer"]&&(Ue.sourceLayer=Ue.layer["source-layer"]),Ue.state=xe});return ge}(this._layers,this._serializedLayers,this.sourceCaches,r,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(r,u){u&&u.filter&&this._validate(i.validateStyle.filter,"querySourceFeatures.filter",u.filter,null,u);const m=this.sourceCaches[r];return m?function(v,C){const P=v.getRenderableIds().map(j=>v.getTileByID(j)),O=[],B={};for(let j=0;j<P.length;j++){const W=P[j],Q=W.tileID.canonical.key;B[Q]||(B[Q]=!0,W.querySourceFeatures(O,C))}return O}(m,u):[]}addSourceType(r,u,m){return di.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(di.setSourceType(r,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:u.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(r,u={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const P in r)if(!k(r[P],m[P])){v=!0;break}if(!v)return;const C={now:i.exported.now(),transition:i.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,u),this.light.updateTransitions(C)}_validate(r,u,m,v,C={}){return(!C||C.validate!==!1)&&dr(this,r.call(i.validateStyle,i.extend({key:u,style:this.serialize(),value:m,styleSpec:i.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const u=this.sourceCaches[r];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const u in this.sourceCaches)this.sourceCaches[u].update(r,this.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,u,m,v,C=!1){let P=!1,O=!1;const B={};for(const j of this._order){const W=this._layers[j];if(W.type!=="symbol")continue;if(!B[W.source]){const ne=this.sourceCaches[W.source];B[W.source]=ne.getRenderableIds(!0).map(ge=>ne.getTileByID(ge)).sort((ge,fe)=>fe.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(fe.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(W,B[W.source],r.center.lng);P=P||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.exported.now(),r.zoom))&&(this.pauseablePlacement=new Le(r,this.terrain,this._order,C,u,m,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.exported.now()),O=!0),P&&this.pauseablePlacement.placement.setStale()),O||P)for(const j of this._order){const W=this._layers[j];W.type==="symbol"&&this.placement.updateLayerOpacities(W,B[W.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.exported.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,u,m){this.imageManager.getImages(u.icons,m),this._updateTilesForChangedImages();const v=this.sourceCaches[u.source];v&&v.setDependencies(u.tileID.key,u.type,u.icons)}getGlyphs(r,u,m){this.glyphManager.getGlyphs(u.stacks,m)}getResource(r,u,m){return i.makeRequest(u,m)}}di.getSourceType=function(_){return _e[_]},di.setSourceType=function(_,r){_e[_]=r},di.registerForPluginStateChange=i.registerForPluginStateChange;var Zn="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const cs={prelude:Or(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Or(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Or(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Or(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Or("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Or(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Or(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Or("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Or("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Or("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Or(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Or(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Or(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Or(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Or(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Or(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Or(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Or(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Or(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Or(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Or(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Or(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Or(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Or(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Or(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Or(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Or("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Zn),terrainDepth:Or("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Zn),terrainCoords:Or("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Zn)};function Or(_,r){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/attribute ([\w]+) ([\w]+)/g),v=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=C?C.concat(v):v,O={};return{fragmentSource:_=_.replace(u,(B,j,W,Q,ne)=>(O[ne]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
varying ${W} ${Q} ${ne};
#else
uniform ${W} ${Q} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${W} ${Q} ${ne} = u_${ne};
#endif
`)),vertexSource:r=r.replace(u,(B,j,W,Q,ne)=>{const ge=Q==="float"?"vec2":"vec4",fe=ne.match(/color/)?"color":ge;return O[ne]?j==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${W} ${ge} a_${ne};
varying ${W} ${Q} ${ne};
#else
uniform ${W} ${Q} u_${ne};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${W} ${Q} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${fe}(a_${ne}, u_${ne}_t);
#else
    ${W} ${Q} ${ne} = u_${ne};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${W} ${ge} a_${ne};
#else
uniform ${W} ${Q} u_${ne};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${W} ${Q} ${ne} = a_${ne};
#else
    ${W} ${Q} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${W} ${Q} ${ne} = unpack_mix_${fe}(a_${ne}, u_${ne}_t);
#else
    ${W} ${Q} ${ne} = u_${ne};
#endif
`}),staticAttributes:m,staticUniforms:P}}class us{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,u,m,v,C,P,O,B,j){this.context=r;let W=this.boundPaintVertexBuffers.length!==v.length;for(let Q=0;!W&&Q<v.length;Q++)this.boundPaintVertexBuffers[Q]!==v[Q]&&(W=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===m&&!W&&this.boundIndexBuffer===C&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===O&&this.boundDynamicVertexBuffer2===B&&this.boundDynamicVertexBuffer3===j?(r.bindVertexArrayOES.set(this.vao),O&&O.bind(),C&&C.dynamicDraw&&C.bind(),B&&B.bind(),j&&j.bind()):this.freshBind(u,m,v,C,P,O,B,j)}freshBind(r,u,m,v,C,P,O,B){let j;const W=r.numAttributes,Q=this.context,ne=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),j=0,this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=O,this.boundDynamicVertexBuffer3=B;else{j=Q.currentNumAttributes||0;for(let ge=W;ge<j;ge++)ne.disableVertexAttribArray(ge)}u.enableAttributes(ne,r);for(const ge of m)ge.enableAttributes(ne,r);P&&P.enableAttributes(ne,r),O&&O.enableAttributes(ne,r),B&&B.enableAttributes(ne,r),u.bind(),u.setVertexAttribPointers(ne,r,C);for(const ge of m)ge.bind(),ge.setVertexAttribPointers(ne,r,C);P&&(P.bind(),P.setVertexAttribPointers(ne,r,C)),v&&v.bind(),O&&(O.bind(),O.setVertexAttribPointers(ne,r,C)),B&&(B.bind(),B.setVertexAttribPointers(ne,r,C)),Q.currentNumAttributes=W}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function hs(_){const r=[];for(let u=0;u<_.length;u++){if(_[u]===null)continue;const m=_[u].split(" ");r.push(m.pop())}return r}class ya{constructor(r,u,m,v,C,P,O){const B=r.gl;this.program=B.createProgram();const j=hs(m.staticAttributes),W=v?v.getBinderAttributes():[],Q=j.concat(W),ne=cs.prelude.staticUniforms?hs(cs.prelude.staticUniforms):[],ge=m.staticUniforms?hs(m.staticUniforms):[],fe=v?v.getBinderUniforms():[],pe=ne.concat(ge).concat(fe),Pe=[];for(const lt of pe)Pe.indexOf(lt)<0&&Pe.push(lt);const De=v?v.defines():[];P&&De.push("#define OVERDRAW_INSPECTOR;"),O&&De.push("#define TERRAIN3D;");const Ue=De.concat(cs.prelude.fragmentSource,m.fragmentSource).join(`
`),xe=De.concat(cs.prelude.vertexSource,m.vertexSource).join(`
`),Je=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(Je,Ue),B.compileShader(Je),B.attachShader(this.program,Je);const He=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(He,xe),B.compileShader(He),B.attachShader(this.program,He),this.attributes={};const st={};this.numAttributes=Q.length;for(let lt=0;lt<this.numAttributes;lt++)Q[lt]&&(B.bindAttribLocation(this.program,lt,Q[lt]),this.attributes[Q[lt]]=lt);B.linkProgram(this.program),B.deleteShader(He),B.deleteShader(Je);for(let lt=0;lt<Pe.length;lt++){const yt=Pe[lt];if(yt&&!st[yt]){const rt=B.getUniformLocation(this.program,yt);rt&&(st[yt]=rt)}}this.fixedUniforms=C(r,st),this.terrainUniforms=((lt,yt)=>({u_depth:new i.Uniform1i(lt,yt.u_depth),u_terrain:new i.Uniform1i(lt,yt.u_terrain),u_terrain_dim:new i.Uniform1f(lt,yt.u_terrain_dim),u_terrain_matrix:new i.UniformMatrix4f(lt,yt.u_terrain_matrix),u_terrain_unpack:new i.Uniform4f(lt,yt.u_terrain_unpack),u_terrain_offset:new i.Uniform1f(lt,yt.u_terrain_offset),u_terrain_exaggeration:new i.Uniform1f(lt,yt.u_terrain_exaggeration)}))(r,st),this.binderUniforms=v?v.getUniforms(r,st):[]}draw(r,u,m,v,C,P,O,B,j,W,Q,ne,ge,fe,pe,Pe,De,Ue){const xe=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(v),r.setColorMode(C),r.setCullFace(P),B){r.activeTexture.set(xe.TEXTURE2),xe.bindTexture(xe.TEXTURE_2D,B.depthTexture),r.activeTexture.set(xe.TEXTURE3),xe.bindTexture(xe.TEXTURE_2D,B.texture);for(const He in this.terrainUniforms)this.terrainUniforms[He].set(B[He])}for(const He in this.fixedUniforms)this.fixedUniforms[He].set(O[He]);pe&&pe.setUniforms(r,this.binderUniforms,ge,{zoom:fe});let Je=0;switch(u){case xe.LINES:Je=2;break;case xe.TRIANGLES:Je=3;break;case xe.LINE_STRIP:Je=1}for(const He of ne.get()){const st=He.vaos||(He.vaos={});(st[j]||(st[j]=new us)).bind(r,this,W,pe?pe.getPaintVertexBuffers():[],Q,He.vertexOffset,Pe,De,Ue),xe.drawElements(u,He.primitiveLength*Je,xe.UNSIGNED_SHORT,He.primitiveOffset*Je*2)}}}function va(_,r,u){const m=1/hi(u,1,r.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),C=u.tileSize*Math.pow(2,r.transform.tileZoom)/v,P=C*(u.tileID.canonical.x+u.tileID.wrap*v),O=C*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[m,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[P>>16,O>>16],u_pixel_coord_lower:[65535&P,65535&O]}}const Hn=(_,r,u,m)=>{const v=r.style.light,C=v.properties.get("position"),P=[C.x,C.y,C.z],O=i.create$1();v.properties.get("anchor")==="viewport"&&i.fromRotation(O,-r.transform.angle),i.transformMat3(P,P,O);const B=v.properties.get("color");return{u_matrix:_,u_lightpos:P,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+u,u_opacity:m}},yh=(_,r,u,m,v,C,P)=>i.extend(Hn(_,r,u,m),va(C,r,P),{u_height_factor:-Math.pow(2,v.overscaledZ)/P.tileSize/8}),so=_=>({u_matrix:_}),el=(_,r,u,m)=>i.extend(so(_),va(u,r,m)),Cc=(_,r)=>({u_matrix:_,u_world:r}),Ic=(_,r,u,m,v)=>i.extend(el(_,r,u,m),{u_world:v}),Ac=(_,r,u,m)=>{const v=_.transform;let C,P;if(m.paint.get("circle-pitch-alignment")==="map"){const O=hi(u,1,v.zoom);C=!0,P=[O,O]}else C=!1,P=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(r.posMatrix,u,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+C,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:P}},Es=(_,r,u)=>{const m=hi(u,1,r.zoom),v=Math.pow(2,r.zoom-u.tileID.overscaledZ),C=u.tileID.overscaleFactor();return{u_matrix:_,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[r.pixelsToGLUnits[0]/(m*v),r.pixelsToGLUnits[1]/(m*v)],u_overscale_factor:C}},ba=(_,r,u=1)=>({u_matrix:_,u_color:r,u_overlay:0,u_overlay_scale:u}),Hs=_=>({u_matrix:_}),ao=(_,r,u,m)=>({u_matrix:_,u_extrude_scale:hi(r,1,u),u_intensity:m});function oo(_,r){const u=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new i.MercatorCoordinate(0,m/u).toLngLat().lat,new i.MercatorCoordinate(0,(m+1)/u).toLngLat().lat]}const Ws=(_,r,u,m)=>{const v=_.transform;return{u_matrix:wa(_,r,u,m),u_ratio:1/hi(r,1,v.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},tl=(_,r,u,m,v)=>i.extend(Ws(_,r,u,v),{u_image:0,u_image_height:m}),lo=(_,r,u,m,v)=>{const C=_.transform,P=ni(r,C);return{u_matrix:wa(_,r,u,v),u_texsize:r.imageAtlasTexture.size,u_ratio:1/hi(r,1,C.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[P,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},xa=(_,r,u,m,v,C)=>{const P=_.lineAtlas,O=ni(r,_.transform),B=u.layout.get("line-cap")==="round",j=P.getDash(m.from,B),W=P.getDash(m.to,B),Q=j.width*v.fromScale,ne=W.width*v.toScale;return i.extend(Ws(_,r,u,C),{u_patternscale_a:[O/Q,-j.height/2],u_patternscale_b:[O/ne,-W.height/2],u_sdfgamma:P.width/(256*Math.min(Q,ne)*_.pixelRatio)/2,u_image:0,u_tex_y_a:j.y,u_tex_y_b:W.y,u_mix:v.t})};function ni(_,r){return 1/hi(_,1,r.tileZoom)}function wa(_,r,u,m){return _.translatePosMatrix(m?m.posMatrix:r.tileID.posMatrix,r,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Pc=(_,r,u,m,v)=>{return{u_matrix:_,u_tl_parent:r,u_scale_parent:u,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(P=v.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(C=v.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Mc(v.paint.get("raster-hue-rotate"))};var C,P};function Mc(_){_*=Math.PI/180;const r=Math.sin(_),u=Math.cos(_);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}const rl=(_,r,u,m,v,C,P,O,B,j)=>{const W=v.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:W.cameraToCenterDistance,u_pitch:W.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:W.width/W.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:P,u_coord_matrix:O,u_is_text:+B,u_pitch_with_map:+m,u_texsize:j,u_texture:0}},co=(_,r,u,m,v,C,P,O,B,j,W)=>{const Q=v.transform;return i.extend(rl(_,r,u,m,v,C,P,O,B,j),{u_gamma_scale:m?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+W})},zc=(_,r,u,m,v,C,P,O,B,j)=>i.extend(co(_,r,u,m,v,C,P,O,!0,B,!0),{u_texsize_icon:j,u_texture_icon:1}),vh=(_,r,u)=>({u_matrix:_,u_opacity:r,u_color:u}),bh=(_,r,u,m,v,C)=>i.extend(function(P,O,B,j){const W=B.imageManager.getPattern(P.from.toString()),Q=B.imageManager.getPattern(P.to.toString()),{width:ne,height:ge}=B.imageManager.getPixelSize(),fe=Math.pow(2,j.tileID.overscaledZ),pe=j.tileSize*Math.pow(2,B.transform.tileZoom)/fe,Pe=pe*(j.tileID.canonical.x+j.tileID.wrap*fe),De=pe*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:W.tl,u_pattern_br_a:W.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[ne,ge],u_mix:O.t,u_pattern_size_a:W.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/hi(j,1,B.transform.tileZoom),u_pixel_coord_upper:[Pe>>16,De>>16],u_pixel_coord_lower:[65535&Pe,65535&De]}}(m,C,u,v),{u_matrix:_,u_opacity:r}),il={fillExtrusion:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_lightpos:new i.Uniform3f(_,r.u_lightpos),u_lightintensity:new i.Uniform1f(_,r.u_lightintensity),u_lightcolor:new i.Uniform3f(_,r.u_lightcolor),u_vertical_gradient:new i.Uniform1f(_,r.u_vertical_gradient),u_opacity:new i.Uniform1f(_,r.u_opacity)}),fillExtrusionPattern:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_lightpos:new i.Uniform3f(_,r.u_lightpos),u_lightintensity:new i.Uniform1f(_,r.u_lightintensity),u_lightcolor:new i.Uniform3f(_,r.u_lightcolor),u_vertical_gradient:new i.Uniform1f(_,r.u_vertical_gradient),u_height_factor:new i.Uniform1f(_,r.u_height_factor),u_image:new i.Uniform1i(_,r.u_image),u_texsize:new i.Uniform2f(_,r.u_texsize),u_pixel_coord_upper:new i.Uniform2f(_,r.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(_,r.u_pixel_coord_lower),u_scale:new i.Uniform3f(_,r.u_scale),u_fade:new i.Uniform1f(_,r.u_fade),u_opacity:new i.Uniform1f(_,r.u_opacity)}),fill:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix)}),fillPattern:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_image:new i.Uniform1i(_,r.u_image),u_texsize:new i.Uniform2f(_,r.u_texsize),u_pixel_coord_upper:new i.Uniform2f(_,r.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(_,r.u_pixel_coord_lower),u_scale:new i.Uniform3f(_,r.u_scale),u_fade:new i.Uniform1f(_,r.u_fade)}),fillOutline:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_world:new i.Uniform2f(_,r.u_world)}),fillOutlinePattern:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_world:new i.Uniform2f(_,r.u_world),u_image:new i.Uniform1i(_,r.u_image),u_texsize:new i.Uniform2f(_,r.u_texsize),u_pixel_coord_upper:new i.Uniform2f(_,r.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(_,r.u_pixel_coord_lower),u_scale:new i.Uniform3f(_,r.u_scale),u_fade:new i.Uniform1f(_,r.u_fade)}),circle:(_,r)=>({u_camera_to_center_distance:new i.Uniform1f(_,r.u_camera_to_center_distance),u_scale_with_map:new i.Uniform1i(_,r.u_scale_with_map),u_pitch_with_map:new i.Uniform1i(_,r.u_pitch_with_map),u_extrude_scale:new i.Uniform2f(_,r.u_extrude_scale),u_device_pixel_ratio:new i.Uniform1f(_,r.u_device_pixel_ratio),u_matrix:new i.UniformMatrix4f(_,r.u_matrix)}),collisionBox:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_camera_to_center_distance:new i.Uniform1f(_,r.u_camera_to_center_distance),u_pixels_to_tile_units:new i.Uniform1f(_,r.u_pixels_to_tile_units),u_extrude_scale:new i.Uniform2f(_,r.u_extrude_scale),u_overscale_factor:new i.Uniform1f(_,r.u_overscale_factor)}),collisionCircle:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_inv_matrix:new i.UniformMatrix4f(_,r.u_inv_matrix),u_camera_to_center_distance:new i.Uniform1f(_,r.u_camera_to_center_distance),u_viewport_size:new i.Uniform2f(_,r.u_viewport_size)}),debug:(_,r)=>({u_color:new i.UniformColor(_,r.u_color),u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_overlay:new i.Uniform1i(_,r.u_overlay),u_overlay_scale:new i.Uniform1f(_,r.u_overlay_scale)}),clippingMask:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix)}),heatmap:(_,r)=>({u_extrude_scale:new i.Uniform1f(_,r.u_extrude_scale),u_intensity:new i.Uniform1f(_,r.u_intensity),u_matrix:new i.UniformMatrix4f(_,r.u_matrix)}),heatmapTexture:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_world:new i.Uniform2f(_,r.u_world),u_image:new i.Uniform1i(_,r.u_image),u_color_ramp:new i.Uniform1i(_,r.u_color_ramp),u_opacity:new i.Uniform1f(_,r.u_opacity)}),hillshade:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_image:new i.Uniform1i(_,r.u_image),u_latrange:new i.Uniform2f(_,r.u_latrange),u_light:new i.Uniform2f(_,r.u_light),u_shadow:new i.UniformColor(_,r.u_shadow),u_highlight:new i.UniformColor(_,r.u_highlight),u_accent:new i.UniformColor(_,r.u_accent)}),hillshadePrepare:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_image:new i.Uniform1i(_,r.u_image),u_dimension:new i.Uniform2f(_,r.u_dimension),u_zoom:new i.Uniform1f(_,r.u_zoom),u_unpack:new i.Uniform4f(_,r.u_unpack)}),line:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_ratio:new i.Uniform1f(_,r.u_ratio),u_device_pixel_ratio:new i.Uniform1f(_,r.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(_,r.u_units_to_pixels)}),lineGradient:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_ratio:new i.Uniform1f(_,r.u_ratio),u_device_pixel_ratio:new i.Uniform1f(_,r.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(_,r.u_units_to_pixels),u_image:new i.Uniform1i(_,r.u_image),u_image_height:new i.Uniform1f(_,r.u_image_height)}),linePattern:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_texsize:new i.Uniform2f(_,r.u_texsize),u_ratio:new i.Uniform1f(_,r.u_ratio),u_device_pixel_ratio:new i.Uniform1f(_,r.u_device_pixel_ratio),u_image:new i.Uniform1i(_,r.u_image),u_units_to_pixels:new i.Uniform2f(_,r.u_units_to_pixels),u_scale:new i.Uniform3f(_,r.u_scale),u_fade:new i.Uniform1f(_,r.u_fade)}),lineSDF:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_ratio:new i.Uniform1f(_,r.u_ratio),u_device_pixel_ratio:new i.Uniform1f(_,r.u_device_pixel_ratio),u_units_to_pixels:new i.Uniform2f(_,r.u_units_to_pixels),u_patternscale_a:new i.Uniform2f(_,r.u_patternscale_a),u_patternscale_b:new i.Uniform2f(_,r.u_patternscale_b),u_sdfgamma:new i.Uniform1f(_,r.u_sdfgamma),u_image:new i.Uniform1i(_,r.u_image),u_tex_y_a:new i.Uniform1f(_,r.u_tex_y_a),u_tex_y_b:new i.Uniform1f(_,r.u_tex_y_b),u_mix:new i.Uniform1f(_,r.u_mix)}),raster:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_tl_parent:new i.Uniform2f(_,r.u_tl_parent),u_scale_parent:new i.Uniform1f(_,r.u_scale_parent),u_buffer_scale:new i.Uniform1f(_,r.u_buffer_scale),u_fade_t:new i.Uniform1f(_,r.u_fade_t),u_opacity:new i.Uniform1f(_,r.u_opacity),u_image0:new i.Uniform1i(_,r.u_image0),u_image1:new i.Uniform1i(_,r.u_image1),u_brightness_low:new i.Uniform1f(_,r.u_brightness_low),u_brightness_high:new i.Uniform1f(_,r.u_brightness_high),u_saturation_factor:new i.Uniform1f(_,r.u_saturation_factor),u_contrast_factor:new i.Uniform1f(_,r.u_contrast_factor),u_spin_weights:new i.Uniform3f(_,r.u_spin_weights)}),symbolIcon:(_,r)=>({u_is_size_zoom_constant:new i.Uniform1i(_,r.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(_,r.u_is_size_feature_constant),u_size_t:new i.Uniform1f(_,r.u_size_t),u_size:new i.Uniform1f(_,r.u_size),u_camera_to_center_distance:new i.Uniform1f(_,r.u_camera_to_center_distance),u_pitch:new i.Uniform1f(_,r.u_pitch),u_rotate_symbol:new i.Uniform1i(_,r.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(_,r.u_aspect_ratio),u_fade_change:new i.Uniform1f(_,r.u_fade_change),u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(_,r.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(_,r.u_coord_matrix),u_is_text:new i.Uniform1i(_,r.u_is_text),u_pitch_with_map:new i.Uniform1i(_,r.u_pitch_with_map),u_texsize:new i.Uniform2f(_,r.u_texsize),u_texture:new i.Uniform1i(_,r.u_texture)}),symbolSDF:(_,r)=>({u_is_size_zoom_constant:new i.Uniform1i(_,r.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(_,r.u_is_size_feature_constant),u_size_t:new i.Uniform1f(_,r.u_size_t),u_size:new i.Uniform1f(_,r.u_size),u_camera_to_center_distance:new i.Uniform1f(_,r.u_camera_to_center_distance),u_pitch:new i.Uniform1f(_,r.u_pitch),u_rotate_symbol:new i.Uniform1i(_,r.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(_,r.u_aspect_ratio),u_fade_change:new i.Uniform1f(_,r.u_fade_change),u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(_,r.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(_,r.u_coord_matrix),u_is_text:new i.Uniform1i(_,r.u_is_text),u_pitch_with_map:new i.Uniform1i(_,r.u_pitch_with_map),u_texsize:new i.Uniform2f(_,r.u_texsize),u_texture:new i.Uniform1i(_,r.u_texture),u_gamma_scale:new i.Uniform1f(_,r.u_gamma_scale),u_device_pixel_ratio:new i.Uniform1f(_,r.u_device_pixel_ratio),u_is_halo:new i.Uniform1i(_,r.u_is_halo)}),symbolTextAndIcon:(_,r)=>({u_is_size_zoom_constant:new i.Uniform1i(_,r.u_is_size_zoom_constant),u_is_size_feature_constant:new i.Uniform1i(_,r.u_is_size_feature_constant),u_size_t:new i.Uniform1f(_,r.u_size_t),u_size:new i.Uniform1f(_,r.u_size),u_camera_to_center_distance:new i.Uniform1f(_,r.u_camera_to_center_distance),u_pitch:new i.Uniform1f(_,r.u_pitch),u_rotate_symbol:new i.Uniform1i(_,r.u_rotate_symbol),u_aspect_ratio:new i.Uniform1f(_,r.u_aspect_ratio),u_fade_change:new i.Uniform1f(_,r.u_fade_change),u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_label_plane_matrix:new i.UniformMatrix4f(_,r.u_label_plane_matrix),u_coord_matrix:new i.UniformMatrix4f(_,r.u_coord_matrix),u_is_text:new i.Uniform1i(_,r.u_is_text),u_pitch_with_map:new i.Uniform1i(_,r.u_pitch_with_map),u_texsize:new i.Uniform2f(_,r.u_texsize),u_texsize_icon:new i.Uniform2f(_,r.u_texsize_icon),u_texture:new i.Uniform1i(_,r.u_texture),u_texture_icon:new i.Uniform1i(_,r.u_texture_icon),u_gamma_scale:new i.Uniform1f(_,r.u_gamma_scale),u_device_pixel_ratio:new i.Uniform1f(_,r.u_device_pixel_ratio),u_is_halo:new i.Uniform1i(_,r.u_is_halo)}),background:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_opacity:new i.Uniform1f(_,r.u_opacity),u_color:new i.UniformColor(_,r.u_color)}),backgroundPattern:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_opacity:new i.Uniform1f(_,r.u_opacity),u_image:new i.Uniform1i(_,r.u_image),u_pattern_tl_a:new i.Uniform2f(_,r.u_pattern_tl_a),u_pattern_br_a:new i.Uniform2f(_,r.u_pattern_br_a),u_pattern_tl_b:new i.Uniform2f(_,r.u_pattern_tl_b),u_pattern_br_b:new i.Uniform2f(_,r.u_pattern_br_b),u_texsize:new i.Uniform2f(_,r.u_texsize),u_mix:new i.Uniform1f(_,r.u_mix),u_pattern_size_a:new i.Uniform2f(_,r.u_pattern_size_a),u_pattern_size_b:new i.Uniform2f(_,r.u_pattern_size_b),u_scale_a:new i.Uniform1f(_,r.u_scale_a),u_scale_b:new i.Uniform1f(_,r.u_scale_b),u_pixel_coord_upper:new i.Uniform2f(_,r.u_pixel_coord_upper),u_pixel_coord_lower:new i.Uniform2f(_,r.u_pixel_coord_lower),u_tile_units_to_pixels:new i.Uniform1f(_,r.u_tile_units_to_pixels)}),terrain:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_texture:new i.Uniform1i(_,r.u_texture)}),terrainDepth:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix)}),terrainCoords:(_,r)=>({u_matrix:new i.UniformMatrix4f(_,r.u_matrix),u_texture:new i.Uniform1i(_,r.u_texture),u_terrain_coords_id:new i.Uniform1f(_,r.u_terrain_coords_id)})};class nl{constructor(r,u,m){this.context=r;const v=r.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const sl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class al{constructor(r,u,m,v){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=r;const C=r.gl;this.buffer=C.createBuffer(),r.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let m=0;m<this.attributes.length;m++){const v=u.attributes[this.attributes[m].name];v!==void 0&&r.enableVertexAttribArray(v)}}setVertexAttribPointers(r,u,m){for(let v=0;v<this.attributes.length;v++){const C=this.attributes[v],P=u.attributes[C.name];P!==void 0&&r.vertexAttribPointer(P,C.components,r[sl[C.type]],!1,this.itemSize,C.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Br{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Dc extends Br{getDefault(){return i.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class xh extends Br{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Sa extends Br{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class ka extends Br{getDefault(){return[!0,!0,!0,!0]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Lc extends Br{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class an extends Br{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class ol extends Br{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class uo extends Br{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class ho extends Br{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class ll extends Br{getDefault(){return[0,1]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class cl extends Br{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class fo extends Br{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class ul extends Br{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class hl extends Br{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class po extends Br{getDefault(){return i.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Rc extends Br{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Oc extends Br{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class Ks extends Br{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class wh extends Br{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Sh extends Br{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class kh extends Br{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Eh extends Br{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Th extends Br{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Ch extends Br{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class fl extends Br{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class mo extends Br{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class dl extends Br{getDefault(){return null}set(r){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class pl extends Br{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Xs extends Br{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Bc extends Br{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Nc extends Br{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class go extends Br{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class Ts extends go{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Fc extends go{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Js{constructor(r,u,m,v){this.context=r,this.width=u,this.height=m;const C=r.gl,P=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new Ts(r,P),v&&(this.depthAttachment=new Fc(r,P)),C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,u=this.colorAttachment.get();if(u&&r.deleteTexture(u),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class ei{constructor(r,u,m){this.blendFunction=r,this.blendColor=u,this.mask=m}}ei.Replace=[1,0],ei.disabled=new ei(ei.Replace,i.Color.transparent,[!1,!1,!1,!1]),ei.unblended=new ei(ei.Replace,i.Color.transparent,[!0,!0,!0,!0]),ei.alphaBlended=new ei([1,771],i.Color.transparent,[!0,!0,!0,!0]);class Uc{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Dc(this),this.clearDepth=new xh(this),this.clearStencil=new Sa(this),this.colorMask=new ka(this),this.depthMask=new Lc(this),this.stencilMask=new an(this),this.stencilFunc=new ol(this),this.stencilOp=new uo(this),this.stencilTest=new ho(this),this.depthRange=new ll(this),this.depthTest=new cl(this),this.depthFunc=new fo(this),this.blend=new ul(this),this.blendFunc=new hl(this),this.blendColor=new po(this),this.blendEquation=new Rc(this),this.cullFace=new Oc(this),this.cullFaceSide=new Ks(this),this.frontFace=new wh(this),this.program=new Sh(this),this.activeTexture=new kh(this),this.viewport=new Eh(this),this.bindFramebuffer=new Th(this),this.bindRenderbuffer=new Ch(this),this.bindTexture=new fl(this),this.bindVertexBuffer=new mo(this),this.bindElementBuffer=new dl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new pl(this),this.pixelStoreUnpack=new Xs(this),this.pixelStoreUnpackPremultiplyAlpha=new Bc(this),this.pixelStoreUnpackFlipY=new Nc(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u){return new nl(this,r,u)}createVertexBuffer(r,u,m){return new al(this,r,u,m)}createRenderbuffer(r,u,m){const v=this.gl,C=v.createRenderbuffer();return this.bindRenderbuffer.set(C),v.renderbufferStorage(v.RENDERBUFFER,r,u,m),this.bindRenderbuffer.set(null),C}createFramebuffer(r,u,m){return new Js(this,r,u,m)}clear({color:r,depth:u}){const m=this.gl;let v=0;r&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),m.clear(v)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){k(r.blendFunction,ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ir{constructor(r,u,m){this.func=r,this.mask=u,this.range=m}}Ir.ReadOnly=!1,Ir.ReadWrite=!0,Ir.disabled=new Ir(519,Ir.ReadOnly,[0,1]);const Nr=7680;class Yr{constructor(r,u,m,v,C,P){this.test=r,this.ref=u,this.mask=m,this.fail=v,this.depthFail=C,this.pass=P}}Yr.disabled=new Yr({func:519,mask:0},0,0,Nr,Nr,Nr);class si{constructor(r,u,m){this.enable=r,this.mode=u,this.frontFace=m}}let Ea;function Ys(_,r,u,m,v,C,P){const O=_.context,B=O.gl,j=_.useProgram("collisionBox"),W=[];let Q=0,ne=0;for(let xe=0;xe<m.length;xe++){const Je=m[xe],He=r.getTile(Je),st=He.getBucket(u);if(!st)continue;let lt=Je.posMatrix;v[0]===0&&v[1]===0||(lt=_.translatePosMatrix(Je.posMatrix,He,v,C));const yt=P?st.textCollisionBox:st.iconCollisionBox,rt=st.collisionCircleArray;if(rt.length>0){const Vt=i.create(),Dt=lt;i.mul(Vt,st.placementInvProjMatrix,_.transform.glCoordMatrix),i.mul(Vt,Vt,st.placementViewportMatrix),W.push({circleArray:rt,circleOffset:ne,transform:Dt,invTransform:Vt,coord:Je}),Q+=rt.length/4,ne=Q}yt&&j.draw(O,B.LINES,Ir.disabled,Yr.disabled,_.colorModeForRenderPass(),si.disabled,Es(lt,_.transform,He),_.style.terrain&&_.style.terrain.getTerrainData(Je),u.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,null,_.transform.zoom,null,null,yt.collisionVertexBuffer)}if(!P||!W.length)return;const ge=_.useProgram("collisionCircle"),fe=new i.CollisionCircleLayoutArray;fe.resize(4*Q),fe._trim();let pe=0;for(const xe of W)for(let Je=0;Je<xe.circleArray.length/4;Je++){const He=4*Je,st=xe.circleArray[He+0],lt=xe.circleArray[He+1],yt=xe.circleArray[He+2],rt=xe.circleArray[He+3];fe.emplace(pe++,st,lt,yt,rt,0),fe.emplace(pe++,st,lt,yt,rt,1),fe.emplace(pe++,st,lt,yt,rt,2),fe.emplace(pe++,st,lt,yt,rt,3)}(!Ea||Ea.length<2*Q)&&(Ea=function(xe){const Je=2*xe,He=new i.QuadTriangleArray;He.resize(Je),He._trim();for(let st=0;st<Je;st++){const lt=6*st;He.uint16[lt+0]=4*st+0,He.uint16[lt+1]=4*st+1,He.uint16[lt+2]=4*st+2,He.uint16[lt+3]=4*st+2,He.uint16[lt+4]=4*st+3,He.uint16[lt+5]=4*st+0}return He}(Q));const Pe=O.createIndexBuffer(Ea,!0),De=O.createVertexBuffer(fe,i.collisionCircleLayout.members,!0);for(const xe of W){const Je={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(Ue=_.transform).cameraToCenterDistance,u_viewport_size:[Ue.width,Ue.height]};ge.draw(O,B.TRIANGLES,Ir.disabled,Yr.disabled,_.colorModeForRenderPass(),si.disabled,Je,_.style.terrain&&_.style.terrain.getTerrainData(xe.coord),u.id,De,Pe,i.SegmentVector.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,_.transform.zoom,null,null,null)}var Ue;De.destroy(),Pe.destroy()}si.disabled=new si(!1,1029,2305),si.backCCW=new si(!0,1029,2305);const Ih=i.identity(new Float32Array(16));function Ah(_,r,u,m,v,C){const{horizontalAlign:P,verticalAlign:O}=i.getAnchorAlignment(_),B=-(P-.5)*r,j=-(O-.5)*u,W=i.evaluateVariableOffset(_,m);return new i.pointGeometry((B/v+W[0])*C,(j/v+W[1])*C)}function Vc(_,r,u,m,v,C,P,O,B,j,W){const Q=_.text.placedSymbolArray,ne=_.text.dynamicLayoutVertexArray,ge=_.icon.dynamicLayoutVertexArray,fe={};ne.clear();for(let pe=0;pe<Q.length;pe++){const Pe=Q.get(pe),De=_.allowVerticalPlacement&&!Pe.placedOrientation,Ue=Pe.hidden||!Pe.crossTileID||De?null:m[Pe.crossTileID];if(Ue){const xe=new i.pointGeometry(Pe.anchorX,Pe.anchorY),Je=yr(xe,u?P:C,W),He=kr(v.cameraToCenterDistance,Je.signedDistanceFromCamera);let st=i.evaluateSizeForFeature(_.textSizeData,B,Pe)*He/i.ONE_EM;u&&(st*=_.tilePixelRatio/O);const{width:lt,height:yt,anchor:rt,textOffset:Vt,textBoxScale:Dt}=Ue,$t=Ah(rt,lt,yt,Vt,Dt,st),gr=u?yr(xe.add($t),C,W).point:Je.point.add(r?$t.rotate(-v.angle):$t),br=_.allowVerticalPlacement&&Pe.placedOrientation===i.WritingMode.vertical?Math.PI/2:0;for(let tr=0;tr<Pe.numGlyphs;tr++)i.addDynamicAttributes(ne,gr,br);j&&Pe.associatedIconIndex>=0&&(fe[Pe.associatedIconIndex]={shiftedAnchor:gr,angle:br})}else ar(Pe.numGlyphs,ne)}if(j){ge.clear();const pe=_.icon.placedSymbolArray;for(let Pe=0;Pe<pe.length;Pe++){const De=pe.get(Pe);if(De.hidden)ar(De.numGlyphs,ge);else{const Ue=fe[Pe];if(Ue)for(let xe=0;xe<De.numGlyphs;xe++)i.addDynamicAttributes(ge,Ue.shiftedAnchor,Ue.angle);else ar(De.numGlyphs,ge)}}_.icon.dynamicLayoutVertexBuffer.updateData(ge)}_.text.dynamicLayoutVertexBuffer.updateData(ne)}function Ph(_,r,u){return u.iconsInText&&r?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function _o(_,r,u,m,v,C,P,O,B,j,W,Q){const ne=_.context,ge=ne.gl,fe=_.transform,pe=O==="map",Pe=B==="map",De=O!=="viewport"&&u.layout.get("symbol-placement")!=="point",Ue=pe&&!Pe&&!De,xe=!u.layout.get("symbol-sort-key").isConstant();let Je=!1;const He=_.depthModeForSublayer(0,Ir.ReadOnly),st=u.layout.get("text-variable-anchor"),lt=[];for(const yt of m){const rt=r.getTile(yt),Vt=rt.getBucket(u);if(!Vt)continue;const Dt=v?Vt.text:Vt.icon;if(!Dt||!Dt.segments.get().length)continue;const $t=Dt.programConfigurations.get(u.id),gr=v||Vt.sdfIcons,br=v?Vt.textSizeData:Vt.iconSizeData,tr=Pe||fe.pitch!==0,qr=_.useProgram(Ph(gr,v,Vt),$t),Gr=i.evaluateSizeForZoom(br,fe.zoom),Ar=_.style.terrain&&_.style.terrain.getTerrainData(yt);let Pr,Hr,Ai,Rn,En=[0,0],On=null;if(v){if(Hr=rt.glyphAtlasTexture,Ai=ge.LINEAR,Pr=rt.glyphAtlasTexture.size,Vt.iconsInText){En=rt.imageAtlasTexture.size,On=rt.imageAtlasTexture;const bn=br.kind==="composite"||br.kind==="camera";Rn=tr||_.options.rotating||_.options.zooming||bn?ge.LINEAR:ge.NEAREST}}else{const bn=u.layout.get("icon-size").constantOr(0)!==1||Vt.iconsNeedLinear;Hr=rt.imageAtlasTexture,Ai=gr||_.options.rotating||_.options.zooming||bn||tr?ge.LINEAR:ge.NEAREST,Pr=rt.imageAtlasTexture.size}const ys=hi(rt,1,_.transform.zoom),vn=gi(yt.posMatrix,Pe,pe,_.transform,ys),Qi=ri(yt.posMatrix,Pe,pe,_.transform,ys),Xn=st&&Vt.hasTextData(),Eo=u.layout.get("icon-text-fit")!=="none"&&Xn&&Vt.hasIconData();if(De){const bn=_.style.terrain?(Al,na)=>_.style.terrain.getElevation(yt,Al,na):null,Ps=u.layout.get("text-rotation-alignment")==="map";ki(Vt,yt.posMatrix,_,v,vn,Qi,Pe,j,Ps,bn)}const Ei=_.translatePosMatrix(yt.posMatrix,rt,C,P),Sr=De||v&&st||Eo?Ih:vn,Ur=_.translatePosMatrix(Qi,rt,C,P,!0),Pi=gr&&u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mi;Mi=gr?Vt.iconsInText?zc(br.kind,Gr,Ue,Pe,_,Ei,Sr,Ur,Pr,En):co(br.kind,Gr,Ue,Pe,_,Ei,Sr,Ur,v,Pr,!0):rl(br.kind,Gr,Ue,Pe,_,Ei,Sr,Ur,v,Pr);const oi={program:qr,buffers:Dt,uniformValues:Mi,atlasTexture:Hr,atlasTextureIcon:On,atlasInterpolation:Ai,atlasInterpolationIcon:Rn,isSDF:gr,hasHalo:Pi};if(xe&&Vt.canOverlap){Je=!0;const bn=Dt.segments.get();for(const Ps of bn)lt.push({segments:new i.SegmentVector([Ps]),sortKey:Ps.sortKey,state:oi,terrainData:Ar})}else lt.push({segments:Dt.segments,sortKey:0,state:oi,terrainData:Ar})}Je&&lt.sort((yt,rt)=>yt.sortKey-rt.sortKey);for(const yt of lt){const rt=yt.state;if(ne.activeTexture.set(ge.TEXTURE0),rt.atlasTexture.bind(rt.atlasInterpolation,ge.CLAMP_TO_EDGE),rt.atlasTextureIcon&&(ne.activeTexture.set(ge.TEXTURE1),rt.atlasTextureIcon&&rt.atlasTextureIcon.bind(rt.atlasInterpolationIcon,ge.CLAMP_TO_EDGE)),rt.isSDF){const Vt=rt.uniformValues;rt.hasHalo&&(Vt.u_is_halo=1,Ta(rt.buffers,yt.segments,u,_,rt.program,He,W,Q,Vt,yt.terrainData)),Vt.u_is_halo=0}Ta(rt.buffers,yt.segments,u,_,rt.program,He,W,Q,rt.uniformValues,yt.terrainData)}}function Ta(_,r,u,m,v,C,P,O,B,j){const W=m.context;v.draw(W,W.gl.TRIANGLES,C,P,O,si.disabled,B,j,u.id,_.layoutVertexBuffer,_.indexBuffer,r,u.paint,m.transform.zoom,_.programConfigurations.get(u.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Ca(_,r,u,m,v,C,P){const O=_.context.gl,B=u.paint.get("fill-pattern"),j=B&&B.constantOr(1),W=u.getCrossfadeParameters();let Q,ne,ge,fe,pe;P?(ne=j&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=O.LINES):(ne=j?"fillPattern":"fill",Q=O.TRIANGLES);for(const Pe of m){const De=r.getTile(Pe);if(j&&!De.patternsLoaded())continue;const Ue=De.getBucket(u);if(!Ue)continue;const xe=Ue.programConfigurations.get(u.id),Je=_.useProgram(ne,xe),He=_.style.terrain&&_.style.terrain.getTerrainData(Pe);j&&(_.context.activeTexture.set(O.TEXTURE0),De.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),xe.updatePaintBuffers(W));const st=B.constantOr(null);if(st&&De.imageAtlas){const rt=De.imageAtlas,Vt=rt.patternPositions[st.to.toString()],Dt=rt.patternPositions[st.from.toString()];Vt&&Dt&&xe.setConstantPatternPositions(Vt,Dt)}const lt=He?Pe:null,yt=_.translatePosMatrix(lt?lt.posMatrix:Pe.posMatrix,De,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(P){fe=Ue.indexBuffer2,pe=Ue.segments2;const rt=[O.drawingBufferWidth,O.drawingBufferHeight];ge=ne==="fillOutlinePattern"&&j?Ic(yt,_,W,De,rt):Cc(yt,rt)}else fe=Ue.indexBuffer,pe=Ue.segments,ge=j?el(yt,_,W,De):so(yt);Je.draw(_.context,Q,v,_.stencilModeForClipping(Pe),C,si.disabled,ge,He,u.id,Ue.layoutVertexBuffer,fe,pe,u.paint,_.transform.zoom,xe)}}function Ia(_,r,u,m,v,C,P){const O=_.context,B=O.gl,j=u.paint.get("fill-extrusion-pattern"),W=j.constantOr(1),Q=u.getCrossfadeParameters(),ne=u.paint.get("fill-extrusion-opacity");for(const ge of m){const fe=r.getTile(ge),pe=fe.getBucket(u);if(!pe)continue;const Pe=_.style.terrain&&_.style.terrain.getTerrainData(ge),De=pe.programConfigurations.get(u.id),Ue=_.useProgram(W?"fillExtrusionPattern":"fillExtrusion",De);W&&(_.context.activeTexture.set(B.TEXTURE0),fe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),De.updatePaintBuffers(Q));const xe=j.constantOr(null);if(xe&&fe.imageAtlas){const lt=fe.imageAtlas,yt=lt.patternPositions[xe.to.toString()],rt=lt.patternPositions[xe.from.toString()];yt&&rt&&De.setConstantPatternPositions(yt,rt)}const Je=_.translatePosMatrix(ge.posMatrix,fe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),He=u.paint.get("fill-extrusion-vertical-gradient"),st=W?yh(Je,_,He,ne,ge,Q,fe):Hn(Je,_,He,ne);Ue.draw(O,O.gl.TRIANGLES,v,C,P,si.backCCW,st,Pe,u.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,u.paint,_.transform.zoom,De,_.style.terrain&&pe.centroidVertexBuffer)}}function ml(_,r,u,m,v,C,P){const O=_.context,B=O.gl,j=u.fbo;if(!j)return;const W=_.useProgram("hillshade"),Q=_.style.terrain&&_.style.terrain.getTerrainData(r);O.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,j.colorAttachment.get()),W.draw(O,B.TRIANGLES,v,C,P,si.disabled,((ne,ge,fe,pe)=>{const Pe=fe.paint.get("hillshade-shadow-color"),De=fe.paint.get("hillshade-highlight-color"),Ue=fe.paint.get("hillshade-accent-color");let xe=fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);fe.paint.get("hillshade-illumination-anchor")==="viewport"&&(xe-=ne.transform.angle);const Je=!ne.options.moving;return{u_matrix:pe?pe.posMatrix:ne.transform.calculatePosMatrix(ge.tileID.toUnwrapped(),Je),u_image:0,u_latrange:oo(0,ge.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),xe],u_shadow:Pe,u_highlight:De,u_accent:Ue}})(_,u,m,Q?r:null),Q,m.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function $c(_,r,u,m,v,C){const P=_.context,O=P.gl,B=r.dem;if(B&&B.data){const j=B.dim,W=B.stride,Q=B.getPixels();if(P.activeTexture.set(O.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||_.getTileTexture(W),r.demTexture){const ge=r.demTexture;ge.update(Q,{premultiply:!1}),ge.bind(O.NEAREST,O.CLAMP_TO_EDGE)}else r.demTexture=new T(P,Q,O.RGBA,{premultiply:!1}),r.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);P.activeTexture.set(O.TEXTURE0);let ne=r.fbo;if(!ne){const ge=new T(P,{width:j,height:j,data:null},O.RGBA);ge.bind(O.LINEAR,O.CLAMP_TO_EDGE),ne=r.fbo=P.createFramebuffer(j,j,!0),ne.colorAttachment.set(ge.texture)}P.bindFramebuffer.set(ne.framebuffer),P.viewport.set([0,0,j,j]),_.useProgram("hillshadePrepare").draw(P,O.TRIANGLES,m,v,C,si.disabled,((ge,fe)=>{const pe=fe.stride,Pe=i.create();return i.ortho(Pe,0,i.EXTENT,-i.EXTENT,0,0,1),i.translate(Pe,Pe,[0,-i.EXTENT,0]),{u_matrix:Pe,u_image:1,u_dimension:[pe,pe],u_zoom:ge.overscaledZ,u_unpack:fe.getUnpackVector()}})(r.tileID,B),null,u.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function yo(_,r,u,m,v,C){const P=m.paint.get("raster-fade-duration");if(!C&&P>0){const O=i.exported.now(),B=(O-_.timeAdded)/P,j=r?(O-r.timeAdded)/P:-1,W=u.getSource(),Q=v.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),ne=!r||Math.abs(r.tileID.overscaledZ-Q)>Math.abs(_.tileID.overscaledZ-Q),ge=ne&&_.refreshedUponExpiration?1:i.clamp(ne?B:1-j,0,1);return _.refreshedUponExpiration&&B>=1&&(_.refreshedUponExpiration=!1),r?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}const vo=new i.Color(1,0,0,1),kn=new i.Color(0,1,0,1),jc=new i.Color(0,0,1,1),gl=new i.Color(1,0,1,1),qc=new i.Color(0,1,1,1);function Cs(_,r,u,m){Qs(_,0,r+u/2,_.transform.width,u,m)}function Aa(_,r,u,m){Qs(_,r-u/2,0,u,_.transform.height,m)}function Qs(_,r,u,m,v,C){const P=_.context,O=P.gl;O.enable(O.SCISSOR_TEST),O.scissor(r*_.pixelRatio,u*_.pixelRatio,m*_.pixelRatio,v*_.pixelRatio),P.clear({color:C}),O.disable(O.SCISSOR_TEST)}function Mh(_,r,u){const m=_.context,v=m.gl,C=u.posMatrix,P=_.useProgram("debug"),O=Ir.disabled,B=Yr.disabled,j=_.colorModeForRenderPass(),W="$debug",Q=_.style.terrain&&_.style.terrain.getTerrainData(u);m.activeTexture.set(v.TEXTURE0),_.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE);const ne=r.getTileByID(u.key).latestRawTileData,ge=Math.floor((ne&&ne.byteLength||0)/1024),fe=r.getTile(u).tileSize,pe=512/Math.min(fe,512)*(u.overscaledZ/_.transform.zoom)*.5;let Pe=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Pe+=` => ${u.overscaledZ}`),function(De,Ue){De.initDebugOverlayCanvas();const xe=De.debugOverlayCanvas,Je=De.context.gl,He=De.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,xe.width,xe.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(Ue,5,5),He.strokeText(Ue,5,5),De.debugOverlayTexture.update(xe),De.debugOverlayTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE)}(_,`${Pe} ${ge}kB`),P.draw(m,v.TRIANGLES,O,B,ei.alphaBlended,si.disabled,ba(C,i.Color.transparent,pe),null,W,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),P.draw(m,v.LINE_STRIP,O,B,j,si.disabled,ba(C,i.Color.red),Q,W,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function bo(_,r,u){const m=_.context,v=m.gl,C=_.colorModeForRenderPass(),P=new Ir(v.LEQUAL,Ir.ReadWrite,_.depthRangeFor3D),O=_.useProgram("terrain"),B=r.getTerrainMesh(),j=r.getTerrainData(u.tileID);m.bindFramebuffer.set(null),m.viewport.set([0,0,_.width,_.height]),m.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,r.getRTTFramebuffer().colorAttachment.get());const W=_.transform.calculatePosMatrix(u.tileID.toUnwrapped());O.draw(m,v.TRIANGLES,P,Yr.disabled,C,si.backCCW,{u_matrix:W,u_texture:0},j,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}function Gc(_,r,u,m){const v=_.context,C=u.tileSize*r.qualityFactor;u.textures[m]||(u.textures[m]=_.getTileTexture(C)||new T(v,{width:C,height:C,data:null},v.gl.RGBA),u.textures[m].bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),m===0&&r.sourceCache.renderHistory.unshift(u.tileID.key));const P=r.getRTTFramebuffer();P.colorAttachment.set(u.textures[m].texture),v.bindFramebuffer.set(P.framebuffer),v.viewport.set([0,0,C,C])}class Zc{constructor(r){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=r,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=r.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const r=this.painter.style,u=r.terrain;for(const m in r.sourceCaches){this._coordsDescendingInv[m]={};const v=r.sourceCaches[m].getVisibleCoordinates();for(const C of v){const P=u.sourceCache.getTerrainCoords(C);for(const O in P)this._coordsDescendingInv[m][O]||(this._coordsDescendingInv[m][O]=[]),this._coordsDescendingInv[m][O].push(P[O])}}for(const m of r._order){const v=r._layers[m],C=v.source;if(this._renderToTexture[v.type]&&!this._coordsDescendingInvStr[C]){this._coordsDescendingInvStr[C]={};for(const P in this._coordsDescendingInv[C])this._coordsDescendingInvStr[C][P]=this._coordsDescendingInv[C][P].map(O=>O.key).sort().join()}}return this._renderableTiles.forEach(m=>{for(const v in this._coordsDescendingInvStr){const C=this._coordsDescendingInvStr[v][m.tileID.key];C&&C!==m.textureCoords[v]&&m.clearTextures(this.painter),u.needsRerender(v,m.tileID)&&m.clearTextures(this.painter)}this._rerender[m.tileID.key]=!m.textures.length}),u.clearRerenderCache(),u.sourceCache.removeOutdated(this.painter),this}renderLayer(r){const u=r.type,m=this.painter,v=m.style._order,C=m.currentLayer,P=C+1===v.length;if(this._renderToTexture[u]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(v[C]),!P))return!0;if(this._renderToTexture[this._prevType]||u==="hillshade"||this._renderToTexture[u]&&P){this._prevType=u;const O=this._stacks.length-1,B=this._stacks[O]||[];for(const j of this._renderableTiles){if(Gc(m,m.style.terrain,j,O),this._rerender[j.tileID.key]){m.context.clear({color:i.Color.transparent});for(let W=0;W<B.length;W++){const Q=m.style._layers[B[W]],ne=Q.source?this._coordsDescendingInv[Q.source][j.tileID.key]:[j.tileID];m._renderTileClippingMasks(Q,ne),m.renderLayer(m,m.style.sourceCaches[Q.source],Q,ne),Q.source&&(j.textureCoords[Q.source]=this._coordsDescendingInvStr[Q.source][j.tileID.key])}}bo(m,m.style.terrain,j)}if(u==="hillshade"){this._stacks.push([v[C]]);for(const j of this._renderableTiles){const W=this._coordsDescendingInv[r.source][j.tileID.key];Gc(m,m.style.terrain,j,this._stacks.length-1),m.context.clear({color:i.Color.transparent}),m._renderTileClippingMasks(r,W),m.renderLayer(m,m.style.sourceCaches[r.source],r,W),bo(m,m.style.terrain,j)}return!0}return this._renderToTexture[u]}return!1}}const Pa={symbol:function(_,r,u,m,v){if(_.renderPass!=="translucent")return;const C=Yr.disabled,P=_.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(O,B,j,W,Q,ne,ge){const fe=B.transform,pe=Q==="map",Pe=ne==="map";for(const De of O){const Ue=W.getTile(De),xe=Ue.getBucket(j);if(!xe||!xe.text||!xe.text.segments.get().length)continue;const Je=i.evaluateSizeForZoom(xe.textSizeData,fe.zoom),He=hi(Ue,1,B.transform.zoom),st=gi(De.posMatrix,Pe,pe,B.transform,He),lt=j.layout.get("icon-text-fit")!=="none"&&xe.hasIconData();if(Je){const yt=Math.pow(2,fe.zoom-Ue.tileID.overscaledZ);Vc(xe,pe,Pe,ge,fe,st,De.posMatrix,yt,Je,lt,B.style.terrain?(rt,Vt)=>B.style.terrain.getElevation(De,rt,Vt):null)}}}(m,_,u,r,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),u.paint.get("icon-opacity").constantOr(1)!==0&&_o(_,r,u,m,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),C,P),u.paint.get("text-opacity").constantOr(1)!==0&&_o(_,r,u,m,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),C,P),r.map.showCollisionBoxes&&(Ys(_,r,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Ys(_,r,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(_,r,u,m){if(_.renderPass!=="translucent")return;const v=u.paint.get("circle-opacity"),C=u.paint.get("circle-stroke-width"),P=u.paint.get("circle-stroke-opacity"),O=!u.layout.get("circle-sort-key").isConstant();if(v.constantOr(1)===0&&(C.constantOr(1)===0||P.constantOr(1)===0))return;const B=_.context,j=B.gl,W=_.depthModeForSublayer(0,Ir.ReadOnly),Q=Yr.disabled,ne=_.colorModeForRenderPass(),ge=[];for(let fe=0;fe<m.length;fe++){const pe=m[fe],Pe=r.getTile(pe),De=Pe.getBucket(u);if(!De)continue;const Ue=De.programConfigurations.get(u.id),xe=_.useProgram("circle",Ue),Je=De.layoutVertexBuffer,He=De.indexBuffer,st=_.style.terrain&&_.style.terrain.getTerrainData(pe),lt={programConfiguration:Ue,program:xe,layoutVertexBuffer:Je,indexBuffer:He,uniformValues:Ac(_,pe,Pe,u),terrainData:st};if(O){const yt=De.segments.get();for(const rt of yt)ge.push({segments:new i.SegmentVector([rt]),sortKey:rt.sortKey,state:lt})}else ge.push({segments:De.segments,sortKey:0,state:lt})}O&&ge.sort((fe,pe)=>fe.sortKey-pe.sortKey);for(const fe of ge){const{programConfiguration:pe,program:Pe,layoutVertexBuffer:De,indexBuffer:Ue,uniformValues:xe,terrainData:Je}=fe.state;Pe.draw(B,j.TRIANGLES,W,Q,ne,si.disabled,xe,Je,u.id,De,Ue,fe.segments,u.paint,_.transform.zoom,pe)}},heatmap:function(_,r,u,m){if(u.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const v=_.context,C=v.gl,P=Yr.disabled,O=new ei([C.ONE,C.ONE],i.Color.transparent,[!0,!0,!0,!0]);(function(B,j,W){const Q=B.gl;B.activeTexture.set(Q.TEXTURE1),B.viewport.set([0,0,j.width/4,j.height/4]);let ne=W.heatmapFbo;if(ne)Q.bindTexture(Q.TEXTURE_2D,ne.colorAttachment.get()),B.bindFramebuffer.set(ne.framebuffer);else{const ge=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,ge),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ne=W.heatmapFbo=B.createFramebuffer(j.width/4,j.height/4,!1),function(fe,pe,Pe,De){const Ue=fe.gl;Ue.texImage2D(Ue.TEXTURE_2D,0,Ue.RGBA,pe.width/4,pe.height/4,0,Ue.RGBA,fe.extRenderToTextureHalfFloat?fe.extTextureHalfFloat.HALF_FLOAT_OES:Ue.UNSIGNED_BYTE,null),De.colorAttachment.set(Pe)}(B,j,ge,ne)}})(v,_,u),v.clear({color:i.Color.transparent});for(let B=0;B<m.length;B++){const j=m[B];if(r.hasRenderableParent(j))continue;const W=r.getTile(j),Q=W.getBucket(u);if(!Q)continue;const ne=Q.programConfigurations.get(u.id),ge=_.useProgram("heatmap",ne),{zoom:fe}=_.transform;ge.draw(v,C.TRIANGLES,Ir.disabled,P,O,si.disabled,ao(j.posMatrix,W,fe,u.paint.get("heatmap-intensity")),null,u.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,u.paint,_.transform.zoom,ne)}v.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(v,C){const P=v.context,O=P.gl,B=C.heatmapFbo;if(!B)return;P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,B.colorAttachment.get()),P.activeTexture.set(O.TEXTURE1);let j=C.colorRampTexture;j||(j=C.colorRampTexture=new T(P,C.colorRamp,O.RGBA)),j.bind(O.LINEAR,O.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(P,O.TRIANGLES,Ir.disabled,Yr.disabled,v.colorModeForRenderPass(),si.disabled,((W,Q,ne,ge)=>{const fe=i.create();i.ortho(fe,0,W.width,W.height,0,0,1);const pe=W.context.gl;return{u_matrix:fe,u_world:[pe.drawingBufferWidth,pe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}})(v,C),null,C.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,C.paint,v.transform.zoom)}(_,u))},line:function(_,r,u,m){if(_.renderPass!=="translucent")return;const v=u.paint.get("line-opacity"),C=u.paint.get("line-width");if(v.constantOr(1)===0||C.constantOr(1)===0)return;const P=_.depthModeForSublayer(0,Ir.ReadOnly),O=_.colorModeForRenderPass(),B=u.paint.get("line-dasharray"),j=u.paint.get("line-pattern"),W=j.constantOr(1),Q=u.paint.get("line-gradient"),ne=u.getCrossfadeParameters(),ge=W?"linePattern":B?"lineSDF":Q?"lineGradient":"line",fe=_.context,pe=fe.gl;let Pe=!0;for(const De of m){const Ue=r.getTile(De);if(W&&!Ue.patternsLoaded())continue;const xe=Ue.getBucket(u);if(!xe)continue;const Je=xe.programConfigurations.get(u.id),He=_.context.program.get(),st=_.useProgram(ge,Je),lt=Pe||st.program!==He,yt=_.style.terrain&&_.style.terrain.getTerrainData(De),rt=j.constantOr(null);if(rt&&Ue.imageAtlas){const $t=Ue.imageAtlas,gr=$t.patternPositions[rt.to.toString()],br=$t.patternPositions[rt.from.toString()];gr&&br&&Je.setConstantPatternPositions(gr,br)}const Vt=yt?De:null,Dt=W?lo(_,Ue,u,ne,Vt):B?xa(_,Ue,u,B,ne,Vt):Q?tl(_,Ue,u,xe.lineClipsArray.length,Vt):Ws(_,Ue,u,Vt);if(W)fe.activeTexture.set(pe.TEXTURE0),Ue.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Je.updatePaintBuffers(ne);else if(B&&(lt||_.lineAtlas.dirty))fe.activeTexture.set(pe.TEXTURE0),_.lineAtlas.bind(fe);else if(Q){const $t=xe.gradients[u.id];let gr=$t.texture;if(u.gradientVersion!==$t.version){let br=256;if(u.stepInterpolant){const tr=r.getSource().maxzoom,qr=De.canonical.z===tr?Math.ceil(1<<_.transform.maxZoom-De.canonical.z):1;br=i.clamp(i.nextPowerOfTwo(xe.maxLineLength/i.EXTENT*1024*qr),256,fe.maxTextureSize)}$t.gradient=i.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:br,image:$t.gradient||void 0,clips:xe.lineClipsArray}),$t.texture?$t.texture.update($t.gradient):$t.texture=new T(fe,$t.gradient,pe.RGBA),$t.version=u.gradientVersion,gr=$t.texture}fe.activeTexture.set(pe.TEXTURE0),gr.bind(u.stepInterpolant?pe.NEAREST:pe.LINEAR,pe.CLAMP_TO_EDGE)}st.draw(fe,pe.TRIANGLES,P,_.stencilModeForClipping(De),O,si.disabled,Dt,yt,u.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,u.paint,_.transform.zoom,Je,xe.layoutVertexBuffer2),Pe=!1}},fill:function(_,r,u,m){const v=u.paint.get("fill-color"),C=u.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const P=_.colorModeForRenderPass(),O=u.paint.get("fill-pattern"),B=_.opaquePassEnabledForLayer()&&!O.constantOr(1)&&v.constantOr(i.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===B){const j=_.depthModeForSublayer(1,_.renderPass==="opaque"?Ir.ReadWrite:Ir.ReadOnly);Ca(_,r,u,m,j,P,!1)}if(_.renderPass==="translucent"&&u.paint.get("fill-antialias")){const j=_.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,Ir.ReadOnly);Ca(_,r,u,m,j,P,!0)}},"fill-extrusion":function(_,r,u,m){const v=u.paint.get("fill-extrusion-opacity");if(v!==0&&_.renderPass==="translucent"){const C=new Ir(_.context.gl.LEQUAL,Ir.ReadWrite,_.depthRangeFor3D);if(v!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Ia(_,r,u,m,C,Yr.disabled,ei.disabled),Ia(_,r,u,m,C,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const P=_.colorModeForRenderPass();Ia(_,r,u,m,C,Yr.disabled,P)}}},hillshade:function(_,r,u,m){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const v=_.context,C=_.depthModeForSublayer(0,Ir.ReadOnly),P=_.colorModeForRenderPass(),[O,B]=_.renderPass==="translucent"?_.stencilConfigForOverlap(m):[{},m];for(const j of B){const W=r.getTile(j);W.needsHillshadePrepare!==void 0&&W.needsHillshadePrepare&&_.renderPass==="offscreen"?$c(_,W,u,C,Yr.disabled,P):_.renderPass==="translucent"&&ml(_,j,W,u,C,O[j.overscaledZ],P)}v.viewport.set([0,0,_.width,_.height])},raster:function(_,r,u,m){if(_.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!m.length)return;const v=_.context,C=v.gl,P=r.getSource(),O=_.useProgram("raster"),B=_.colorModeForRenderPass(),[j,W]=P instanceof nt?[{},m]:_.stencilConfigForOverlap(m),Q=W[W.length-1].overscaledZ,ne=!_.options.moving;for(const ge of W){const fe=_.depthModeForSublayer(ge.overscaledZ-Q,u.paint.get("raster-opacity")===1?Ir.ReadWrite:Ir.ReadOnly,C.LESS),pe=r.getTile(ge);pe.registerFadeDuration(u.paint.get("raster-fade-duration"));const Pe=r.findLoadedParent(ge,0),De=yo(pe,Pe,r,u,_.transform,_.style.terrain);let Ue,xe;const Je=u.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;v.activeTexture.set(C.TEXTURE0),pe.texture.bind(Je,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),v.activeTexture.set(C.TEXTURE1),Pe?(Pe.texture.bind(Je,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Ue=Math.pow(2,Pe.tileID.overscaledZ-pe.tileID.overscaledZ),xe=[pe.tileID.canonical.x*Ue%1,pe.tileID.canonical.y*Ue%1]):pe.texture.bind(Je,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);const He=_.style.terrain&&_.style.terrain.getTerrainData(ge),st=He?ge:null,lt=st?st.posMatrix:_.transform.calculatePosMatrix(ge.toUnwrapped(),ne),yt=Pc(lt,xe||[0,0],Ue||1,De,u);P instanceof nt?O.draw(v,C.TRIANGLES,fe,Yr.disabled,B,si.disabled,yt,He,u.id,P.boundsBuffer,_.quadTriangleIndexBuffer,P.boundsSegments):O.draw(v,C.TRIANGLES,fe,j[ge.overscaledZ],B,si.disabled,yt,He,u.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}},background:function(_,r,u,m){const v=u.paint.get("background-color"),C=u.paint.get("background-opacity");if(C===0)return;const P=_.context,O=P.gl,B=_.transform,j=B.tileSize,W=u.paint.get("background-pattern");if(_.isPatternMissing(W))return;const Q=!W&&v.a===1&&C===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Q)return;const ne=Yr.disabled,ge=_.depthModeForSublayer(0,Q==="opaque"?Ir.ReadWrite:Ir.ReadOnly),fe=_.colorModeForRenderPass(),pe=_.useProgram(W?"backgroundPattern":"background"),Pe=m||B.coveringTiles({tileSize:j,terrain:_.style.terrain});W&&(P.activeTexture.set(O.TEXTURE0),_.imageManager.bind(_.context));const De=u.getCrossfadeParameters();for(const Ue of Pe){const xe=m?Ue.posMatrix:_.transform.calculatePosMatrix(Ue.toUnwrapped()),Je=W?bh(xe,C,_,W,{tileID:Ue,tileSize:j},De):vh(xe,C,v),He=_.style.terrain&&_.style.terrain.getTerrainData(Ue);pe.draw(P,O.TRIANGLES,ge,ne,fe,si.disabled,Je,He,u.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}},debug:function(_,r,u){for(let m=0;m<u.length;m++)Mh(_,r,u[m])},custom:function(_,r,u){const m=_.context,v=u.implementation;if(_.renderPass==="offscreen"){const C=v.prerender;C&&(_.setCustomLayerDefaults(),m.setColorMode(_.colorModeForRenderPass()),C.call(v,m.gl,_.transform.customLayerMatrix()),m.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),m.setColorMode(_.colorModeForRenderPass()),m.setStencilMode(Yr.disabled);const C=v.renderingMode==="3d"?new Ir(_.context.gl.LEQUAL,Ir.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,Ir.ReadOnly);m.setDepthMode(C),v.render(m.gl,_.transform.customLayerMatrix()),m.setDirty(),_.setBaseState(),m.bindFramebuffer.set(null)}}};class _l{constructor(r,u){this.context=new Uc(r),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:i.create(),renderTime:0},this.setup(),this.numSublayers=Ke.maxUnderzooming+Ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yt,this.gpuTimers={}}resize(r,u,m){if(this.width=r*m,this.height=u*m,this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const r=this.context,u=new i.PosArray;u.emplaceBack(0,0),u.emplaceBack(i.EXTENT,0),u.emplaceBack(0,i.EXTENT),u.emplaceBack(i.EXTENT,i.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(u,mr.members),this.tileExtentSegments=i.SegmentVector.simpleSegment(0,0,4,2);const m=new i.PosArray;m.emplaceBack(0,0),m.emplaceBack(i.EXTENT,0),m.emplaceBack(0,i.EXTENT),m.emplaceBack(i.EXTENT,i.EXTENT),this.debugBuffer=r.createVertexBuffer(m,mr.members),this.debugSegments=i.SegmentVector.simpleSegment(0,0,4,5);const v=new i.RasterBoundsArray;v.emplaceBack(0,0,0,0),v.emplaceBack(i.EXTENT,0,i.EXTENT,0),v.emplaceBack(0,i.EXTENT,0,i.EXTENT),v.emplaceBack(i.EXTENT,i.EXTENT,i.EXTENT,i.EXTENT),this.rasterBoundsBuffer=r.createVertexBuffer(v,Zt.members),this.rasterBoundsSegments=i.SegmentVector.simpleSegment(0,0,4,2);const C=new i.PosArray;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(C,mr.members),this.viewportSegments=i.SegmentVector.simpleSegment(0,0,4,2);const P=new i.LineStripIndexArray;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(P);const O=new i.TriangleIndexArray;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(O),this.emptyTexture=new T(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA);const B=this.context.gl;this.stencilClearMode=new Yr({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const r=this.context,u=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=i.create();i.ortho(m,0,this.width,this.height,0,0,1),i.scale(m,m,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,u.TRIANGLES,Ir.disabled,this.stencilClearMode,ei.disabled,si.disabled,Hs(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,u){if(this.currentStencilSource===r.source||!r.isTileClipped()||!u||!u.length)return;this.currentStencilSource=r.source;const m=this.context,v=m.gl;this.nextStencilID+u.length>256&&this.clearStencil(),m.setColorMode(ei.disabled),m.setDepthMode(Ir.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of u){const O=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,B=this.style.terrain&&this.style.terrain.getTerrainData(P);C.draw(m,v.TRIANGLES,Ir.disabled,new Yr({func:v.ALWAYS,mask:0},O,255,v.KEEP,v.KEEP,v.REPLACE),ei.disabled,si.disabled,Hs(P.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,u=this.context.gl;return new Yr({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){const u=this.context.gl;return new Yr({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(r){const u=this.context.gl,m=r.sort((P,O)=>O.overscaledZ-P.overscaledZ),v=m[m.length-1].overscaledZ,C=m[0].overscaledZ-v+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const P={};for(let O=0;O<C;O++)P[O+v]=new Yr({func:u.GEQUAL,mask:255},O+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=C,[P,m]}return[{[v]:Yr.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new ei([r.CONSTANT_COLOR,r.ONE],new i.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ei.unblended:ei.alphaBlended}depthModeForSublayer(r,u,m){if(!this.opaquePassEnabledForLayer())return Ir.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Ir(m||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,u){this.style=r,this.options=u,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.exported.now()),this.imageManager.beginFrame();const m=this.style._order,v=this.style.sourceCaches,C=this.style.terrain&&new Zc(this);for(const j in v){const W=v[j];W.used&&W.prepare(this.context)}const P={},O={},B={};for(const j in v){const W=v[j];P[j]=W.getVisibleCoordinates(),O[j]=P[j].slice().reverse(),B[j]=W.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<m.length;j++)if(this.style._layers[m[j]].is3D()){this.opaquePassCutoff=j;break}if(C){this.opaquePassCutoff=0;const j=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!i.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||j.length)&&(i.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(W,Q){const ne=W.context,ge=ne.gl,fe=ei.unblended,pe=new Ir(ge.LEQUAL,Ir.ReadWrite,[0,1]),Pe=Q.getTerrainMesh(),De=Q.sourceCache.getRenderableTiles(),Ue=W.useProgram("terrainDepth");ne.bindFramebuffer.set(Q.getFramebuffer("depth").framebuffer),ne.viewport.set([0,0,W.width/devicePixelRatio,W.height/devicePixelRatio]),ne.clear({color:i.Color.transparent,depth:1});for(const xe of De){const Je=Q.getTerrainData(xe.tileID),He=W.transform.calculatePosMatrix(xe.tileID.toUnwrapped());Ue.draw(ne,ge.TRIANGLES,pe,Yr.disabled,fe,si.backCCW,{u_matrix:He},Je,"terrain",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)}ne.bindFramebuffer.set(null),ne.viewport.set([0,0,W.width,W.height])}(this,this.style.terrain),function(W,Q){const ne=W.context,ge=ne.gl,fe=ei.unblended,pe=new Ir(ge.LEQUAL,Ir.ReadWrite,[0,1]),Pe=Q.getTerrainMesh(),De=Q.getCoordsTexture(),Ue=Q.sourceCache.getRenderableTiles(),xe=W.useProgram("terrainCoords");ne.bindFramebuffer.set(Q.getFramebuffer("coords").framebuffer),ne.viewport.set([0,0,W.width/devicePixelRatio,W.height/devicePixelRatio]),ne.clear({color:i.Color.transparent,depth:1}),Q.coordsIndex=[];for(const Je of Ue){const He=Q.getTerrainData(Je.tileID);ne.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,De.texture);const st=W.transform.calculatePosMatrix(Je.tileID.toUnwrapped());xe.draw(ne,ge.TRIANGLES,pe,Yr.disabled,fe,si.backCCW,{u_matrix:st,u_terrain_coords_id:(255-Q.coordsIndex.length)/255,u_texture:0},He,"terrain",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments),Q.coordsIndex.push(Je.tileID.key)}ne.bindFramebuffer.set(null),ne.viewport.set([0,0,W.width,W.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const j of m){const W=this.style._layers[j];if(!W.hasOffscreenPass()||W.isHidden(this.transform.zoom))continue;const Q=O[W.source];(W.type==="custom"||Q.length)&&this.renderLayer(this,v[W.source],W,Q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?i.Color.black:i.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!C)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[m[this.currentLayer]],W=v[j.source],Q=P[j.source];this._renderTileClippingMasks(j,Q),this.renderLayer(this,W,j,Q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const j=this.style._layers[m[this.currentLayer]],W=v[j.source];if(C&&C.renderLayer(j))continue;const Q=(j.type==="symbol"?B:O)[j.source];this._renderTileClippingMasks(j,P[j.source]),this.renderLayer(this,W,j,Q)}if(this.options.showTileBoundaries){let j,W;Object.values(this.style._layers).forEach(Q=>{Q.source&&!Q.isHidden(this.transform.zoom)&&(Q.source!==(W&&W.id)&&(W=this.style.sourceCaches[Q.source]),(!j||j.getSource().maxzoom<W.getSource().maxzoom)&&(j=W))}),j&&Pa.debug(this,j,j.getVisibleCoordinates())}this.options.showPadding&&function(j){const W=j.transform.padding;Cs(j,j.transform.height-(W.top||0),3,vo),Cs(j,W.bottom||0,3,kn),Aa(j,W.left||0,3,jc),Aa(j,j.transform.width-(W.right||0),3,gl);const Q=j.transform.centerPoint;(function(ne,ge,fe,pe){Qs(ne,ge-1,fe-10,2,20,pe),Qs(ne,ge-10,fe-1,20,2,pe)})(j,Q.x,j.transform.height-Q.y,qc)}(this),this.context.setDefault()}renderLayer(r,u,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(v||[]).length)&&(this.id=m.id,this.gpuTimingStart(m),Pa[m.type](r,u,m,v,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let m=this.gpuTimers[r.id];m||(m=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),m.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const u={};for(const m in r){const v=r[m],C=this.context.extTimerQuery,P=C.getQueryObjectEXT(v.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(v.query),u[m]=P}return u}translatePosMatrix(r,u,m,v,C){if(!m[0]&&!m[1])return r;const P=C?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(P){const j=Math.sin(P),W=Math.cos(P);m=[m[0]*W-m[1]*j,m[0]*j+m[1]*W]}const O=[C?m[0]:hi(u,m[0],this.transform.zoom),C?m[1]:hi(u,m[1],this.transform.zoom),0],B=new Float32Array(16);return i.translate(B,r,O),B}saveTileTexture(r){const u=this._tileTextures[r.size[0]];u?u.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const u=this._tileTextures[r];return u&&u.length>0?u.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const u=this.imageManager.getPattern(r.from.toString()),m=this.imageManager.getPattern(r.to.toString());return!u||!m}useProgram(r,u){this.cache=this.cache||{};const m=r+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new ya(this.context,r,cs[r],u,il[r],this._showOverdrawInspector,this.style.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class xo{constructor(r,u){this.points=r,this.planes=u}static fromInvProjectionMatrix(r,u,m){const v=Math.pow(2,m),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{const B=1/(O=i.transformMat4([],O,r))[3]/u*v;return i.mul$1(O,O,[B,B,1/O[3],B])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const B=i.sub([],C[O[0]],C[O[1]]),j=i.sub([],C[O[2]],C[O[1]]),W=i.normalize([],i.cross([],B,j)),Q=-i.dot(W,C[O[1]]);return W.concat(Q)});return new xo(C,P)}}class Ma{constructor(r,u){this.min=r,this.max=u,this.center=i.scale$1([],i.add([],this.min,this.max),.5)}quadrant(r){const u=[r%2==0,r<2],m=i.clone$2(this.min),v=i.clone$2(this.max);for(let C=0;C<u.length;C++)m[C]=u[C]?this.min[C]:this.center[C],v[C]=u[C]?this.center[C]:this.max[C];return v[2]=this.max[2],new Ma(m,v)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let v=0;v<r.planes.length;v++){const C=r.planes[v];let P=0;for(let O=0;O<u.length;O++)i.dot$1(C,u[O])>=0&&P++;if(P===0)return 0;P!==u.length&&(m=!1)}if(m)return 2;for(let v=0;v<3;v++){let C=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let O=0;O<r.points.length;O++){const B=r.points[O][v]-this.min[v];C=Math.min(C,B),P=Math.max(P,B)}if(P<0||C>this.max[v]-this.min[v])return 0}return 1}}class ea{constructor(r=0,u=0,m=0,v=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=m,this.right=v}interpolate(r,u,m){return u.top!=null&&r.top!=null&&(this.top=i.number(r.top,u.top,m)),u.bottom!=null&&r.bottom!=null&&(this.bottom=i.number(r.bottom,u.bottom,m)),u.left!=null&&r.left!=null&&(this.left=i.number(r.left,u.left,m)),u.right!=null&&r.right!=null&&(this.right=i.number(r.right,u.right,m)),this}getCenter(r,u){const m=i.clamp((this.left+r-this.right)/2,0,r),v=i.clamp((this.top+u-this.bottom)/2,0,u);return new i.pointGeometry(m,v)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ea(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class za{constructor(r,u,m,v,C){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=C===void 0||!!C,this._minZoom=r||0,this._maxZoom=u||22,this._minPitch=m??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new i.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ea,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const r=new za(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.tileSize=this.tileSize,r.latRange=this.latRange,r.width=this.width,r.height=this.height,r._center=this._center,r._elevation=this._elevation,r.zoom=this.zoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const u=-i.wrap(r,-180,180)*Math.PI/180;var m;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(m=new i.ARRAY_TYPE(4),i.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(v,C,P){var O=C[0],B=C[1],j=C[2],W=C[3],Q=Math.sin(P),ne=Math.cos(P);v[0]=O*ne+j*Q,v[1]=B*ne+W*Q,v[2]=O*-Q+j*ne,v[3]=B*-Q+W*ne}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const u=i.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const u=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,m){this._unmodified=!1,this._edgeInsets.interpolate(r,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const u=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(r){const u=[new i.UnwrappedTileID(0,r)];if(this._renderWorldCopies){const m=this.pointCoordinate(new i.pointGeometry(0,0)),v=this.pointCoordinate(new i.pointGeometry(this.width,0)),C=this.pointCoordinate(new i.pointGeometry(this.width,this.height)),P=this.pointCoordinate(new i.pointGeometry(0,this.height)),O=Math.floor(Math.min(m.x,v.x,C.x,P.x)),B=Math.floor(Math.max(m.x,v.x,C.x,P.x)),j=1;for(let W=O-j;W<=B+j;W++)W!==0&&u.push(new i.UnwrappedTileID(W,r))}return u}coveringTiles(r){var u,m;let v=this.coveringZoomLevel(r);const C=v;if(r.minzoom!==void 0&&v<r.minzoom)return[];r.maxzoom!==void 0&&v>r.maxzoom&&(v=r.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),O=i.MercatorCoordinate.fromLngLat(this.center),B=Math.pow(2,v),j=[B*P.x,B*P.y,0],W=[B*O.x,B*O.y,0],Q=xo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let ne=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ne=v);const ge=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,fe=xe=>({aabb:new Ma([xe*B,0,0],[(xe+1)*B,B,0]),zoom:0,x:0,y:0,wrap:xe,fullyVisible:!1}),pe=[],Pe=[],De=v,Ue=r.reparseOverscaled?C:v;if(this._renderWorldCopies)for(let xe=1;xe<=3;xe++)pe.push(fe(-xe)),pe.push(fe(xe));for(pe.push(fe(0));pe.length>0;){const xe=pe.pop(),Je=xe.x,He=xe.y;let st=xe.fullyVisible;if(!st){const $t=xe.aabb.intersects(Q);if($t===0)continue;st=$t===2}const lt=r.terrain?j:W,yt=xe.aabb.distanceX(lt),rt=xe.aabb.distanceY(lt),Vt=Math.max(Math.abs(yt),Math.abs(rt)),Dt=ge+(1<<De-xe.zoom)-2;if(xe.zoom===De||Vt>Dt&&xe.zoom>=ne){const $t=De-xe.zoom,gr=j[0]-.5-(Je<<$t),br=j[1]-.5-(He<<$t);Pe.push({tileID:new i.OverscaledTileID(xe.zoom===De?Ue:xe.zoom,xe.wrap,xe.zoom,Je,He),distanceSq:i.sqrLen([W[0]-.5-Je,W[1]-.5-He]),tileDistanceToCamera:Math.sqrt(gr*gr+br*br)})}else for(let $t=0;$t<4;$t++){const gr=(Je<<1)+$t%2,br=(He<<1)+($t>>1),tr=xe.zoom+1;let qr=xe.aabb.quadrant($t);if(r.terrain){const Gr=new i.OverscaledTileID(tr,xe.wrap,tr,gr,br),Ar=r.terrain.getMinMaxElevation(Gr),Pr=(u=Ar.minElevation)!==null&&u!==void 0?u:this.elevation,Hr=(m=Ar.maxElevation)!==null&&m!==void 0?m:this.elevation;qr=new Ma([qr.min[0],qr.min[1],Pr],[qr.max[0],qr.max[1],Hr])}pe.push({aabb:qr,zoom:tr,x:gr,y:br,wrap:xe.wrap,fullyVisible:st})}}return Pe.sort((xe,Je)=>xe.distanceSq-Je.distanceSq).map(xe=>xe.tileID)}resize(r,u){this.width=r,this.height=u,this.pixelsToGLUnits=[2/r,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const u=i.clamp(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new i.pointGeometry(i.mercatorXfromLng(r.lng)*this.worldSize,i.mercatorYfromLat(u)*this.worldSize)}unproject(r){return new i.MercatorCoordinate(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(r){this.freezeElevation||(this.elevation=r?this.getElevation(this._center,r):0)}getElevation(r,u){const m=i.MercatorCoordinate.fromLngLat(r),v=(1<<this.tileZoom)*i.EXTENT,C=m.x*v,P=m.y*v,O=Math.floor(C/i.EXTENT),B=Math.floor(P/i.EXTENT),j=new i.OverscaledTileID(this.tileZoom,0,this.tileZoom,O,B);return u.getElevation(j,C%i.EXTENT,P%i.EXTENT,i.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const u=this.pointLocation(this.centerPoint,r),m=this.getElevation(u,r);if(!(this.elevation-m))return;const v=this.getCameraPosition(),C=i.MercatorCoordinate.fromLngLat(v.lngLat,v.altitude),P=i.MercatorCoordinate.fromLngLat(u,m),O=C.x-P.x,B=C.y-P.y,j=C.z-P.z,W=Math.sqrt(O*O+B*B+j*j),Q=this.scaleZoom(this.cameraToCenterDistance/W/this.tileSize);this._elevation=m,this._center=u,this.zoom=Q}setLocationAtPoint(r,u){const m=this.pointCoordinate(u),v=this.pointCoordinate(this.centerPoint),C=this.locationCoordinate(r),P=new i.MercatorCoordinate(C.x-(m.x-v.x),C.y-(m.y-v.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,u){return u?this.coordinatePoint(this.locationCoordinate(r),this.getElevation(r,u),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,u){return this.coordinateLocation(this.pointCoordinate(r,u))}locationCoordinate(r){return i.MercatorCoordinate.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,u){if(u){const ne=u.pointCoordinate(r);if(ne!=null)return ne}const m=[r.x,r.y,0,1],v=[r.x,r.y,1,1];i.transformMat4(m,m,this.pixelMatrixInverse),i.transformMat4(v,v,this.pixelMatrixInverse);const C=m[3],P=v[3],O=m[1]/C,B=v[1]/P,j=m[2]/C,W=v[2]/P,Q=j===W?0:(0-j)/(W-j);return new i.MercatorCoordinate(i.number(m[0]/C,v[0]/P,Q)/this.worldSize,i.number(O,B,Q)/this.worldSize)}coordinatePoint(r,u=0,m=this.pixelMatrix){const v=[r.x*this.worldSize,r.y*this.worldSize,u,1];return i.transformMat4(v,v,m),new i.pointGeometry(v[0]/v[3],v[1]/v[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new i.LngLatBounds().extend(this.pointLocation(new i.pointGeometry(0,r))).extend(this.pointLocation(new i.pointGeometry(this.width,r))).extend(this.pointLocation(new i.pointGeometry(this.width,this.height))).extend(this.pointLocation(new i.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new i.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,u=!1){const m=r.key,v=u?this._alignedPosMatrixCache:this._posMatrixCache;if(v[m])return v[m];const C=r.canonical,P=this.worldSize/this.zoomScale(C.z),O=C.x+Math.pow(2,C.z)*r.wrap,B=i.identity(new Float64Array(16));return i.translate(B,B,[O*P,C.y*P,0]),i.scale(B,B,[P/i.EXTENT,P/i.EXTENT,1]),i.multiply(B,u?this.alignedProjMatrix:this.projMatrix,B),v[m]=new Float32Array(B),v[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,u,m,v,C=-90,P=90,O=-180,B=180;const j=this.size,W=this._unmodified;if(this.latRange){const ge=this.latRange;C=i.mercatorYfromLat(ge[1])*this.worldSize,P=i.mercatorYfromLat(ge[0])*this.worldSize,r=P-C<j.y?j.y/(P-C):0}if(this.lngRange){const ge=this.lngRange;O=i.wrap(i.mercatorXfromLng(ge[0])*this.worldSize,0,this.worldSize),B=i.wrap(i.mercatorXfromLng(ge[1])*this.worldSize,0,this.worldSize),B<O&&(B+=this.worldSize),u=B-O<j.x?j.x/(B-O):0}const Q=this.point,ne=Math.max(u||0,r||0);if(ne)return this.center=this.unproject(new i.pointGeometry(u?(B+O)/2:Q.x,r?(P+C)/2:Q.y)),this.zoom+=this.scaleZoom(ne),this._unmodified=W,void(this._constraining=!1);if(this.latRange){const ge=Q.y,fe=j.y/2;ge-fe<C&&(v=C+fe),ge+fe>P&&(v=P-fe)}if(this.lngRange){const ge=(O+B)/2,fe=i.wrap(Q.x,ge-this.worldSize/2,ge+this.worldSize/2),pe=j.x/2;fe-pe<O&&(m=O+pe),fe+pe>B&&(m=B-pe)}m===void 0&&v===void 0||(this.center=this.unproject(new i.pointGeometry(m!==void 0?m:Q.x,v!==void 0?v:Q.y)).wrap()),this._unmodified=W,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,u=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=i.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let v=i.identity(new Float64Array(16));i.scale(v,v,[this.width/2,-this.height/2,1]),i.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=i.identity(new Float64Array(16)),i.scale(v,v,[1,-1,1]),i.translate(v,v,[-1,-1,0]),i.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const C=Math.PI/2+this._pitch,P=this._fov*(.5+r.y/this.height),O=Math.sin(P)*this.cameraToSeaLevelDistance/Math.sin(i.clamp(Math.PI-C-P,.01,Math.PI-.01)),B=this.getHorizon(),j=2*Math.atan(B/this.cameraToCenterDistance)*(.5+r.y/(2*B)),W=Math.sin(j)*this.cameraToSeaLevelDistance/Math.sin(i.clamp(Math.PI-C-j,.01,Math.PI-.01)),Q=Math.cos(Math.PI/2-this._pitch)*O+this.cameraToSeaLevelDistance,ne=Math.cos(Math.PI/2-this._pitch)*W+this.cameraToSeaLevelDistance,ge=1.01*Math.min(Q,ne),fe=this.height/50;v=new Float64Array(16),i.perspective(v,this._fov,this.width/this.height,fe,ge),v[8]=2*-r.x/this.width,v[9]=2*r.y/this.height,i.scale(v,v,[1,-1,1]),i.translate(v,v,[0,0,-this.cameraToCenterDistance]),i.rotateX(v,v,this._pitch),i.rotateZ(v,v,this.angle),i.translate(v,v,[-u,-m,0]),this.mercatorMatrix=i.scale([],v,[this.worldSize,this.worldSize,this.worldSize]),i.scale(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=i.multiply(new Float64Array(16),this.labelPlaneMatrix,v),i.translate(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=i.invert([],v),this.pixelMatrix3D=i.multiply(new Float64Array(16),this.labelPlaneMatrix,v);const pe=this.width%2/2,Pe=this.height%2/2,De=Math.cos(this.angle),Ue=Math.sin(this.angle),xe=u-Math.round(u)+De*pe+Ue*Pe,Je=m-Math.round(m)+De*Pe+Ue*pe,He=new Float64Array(v);if(i.translate(He,He,[xe>.5?xe-1:xe,Je>.5?Je-1:Je,0]),this.alignedProjMatrix=He,v=i.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new i.pointGeometry(0,0)),u=[r.x*this.worldSize,r.y*this.worldSize,0,1];return i.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.pointGeometry(0,r))}getCameraQueryGeometry(r){const u=this.getCameraPoint();if(r.length===1)return[r[0],u];{let m=u.x,v=u.y,C=u.x,P=u.y;for(const O of r)m=Math.min(m,O.x),v=Math.min(v,O.y),C=Math.max(C,O.x),P=Math.max(P,O.y);return[new i.pointGeometry(m,v),new i.pointGeometry(C,v),new i.pointGeometry(C,P),new i.pointGeometry(m,P),new i.pointGeometry(m,v)]}}}class Hc{constructor(r){this._hashName=r&&encodeURIComponent(r),i.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(u,m){let v=!1,C=null;const P=()=>{C=null,v&&(u(),C=setTimeout(P,300),v=!1)};return()=>(v=!0,C||P(),C)}(this._updateHashUnthrottled.bind(this))}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const u=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,v),P=Math.round(u.lng*C)/C,O=Math.round(u.lat*C)/C,B=this._map.getBearing(),j=this._map.getPitch();let W="";if(W+=r?`/${P}/${O}/${m}`:`${m}/${O}/${P}`,(B||j)&&(W+="/"+Math.round(10*B)/10),j&&(W+=`/${Math.round(j)}`),this._hashName){const Q=this._hashName;let ne=!1;const ge=window.location.hash.slice(1).split("&").map(fe=>{const pe=fe.split("=")[0];return pe===Q?(ne=!0,`${pe}=${W}`):fe}).filter(fe=>fe);return ne||ge.push(`${Q}=${W}`),`#${ge.join("&")}`}return`#${W}`}_getCurrentHash(){const r=window.location.hash.replace("#","");if(this._hashName){let u;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._getCurrentHash();if(r.length>=3&&!r.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:u,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,r)}catch{}}}const Da={linearity:.3,easing:i.bezier(0,0,.3,1)},Wc=i.extend({deceleration:2500,maxSpeed:1400},Da),Kc=i.extend({deceleration:20,maxSpeed:1400},Da),Xc=i.extend({deceleration:1e3,maxSpeed:360},Da),ta=i.extend({deceleration:1e3,maxSpeed:90},Da);class Jc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,u=i.exported.now();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new i.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)u.zoom+=C.zoomDelta||0,u.bearing+=C.bearingDelta||0,u.pitch+=C.pitchDelta||0,C.panDelta&&u.pan._add(C.panDelta),C.around&&(u.around=C.around),C.pinchAround&&(u.pinchAround=C.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const C=Ra(u.pan.mag(),m,i.extend({},Wc,r||{}));v.offset=u.pan.mult(C.amount/u.pan.mag()),v.center=this._map.transform.center,La(v,C)}if(u.zoom){const C=Ra(u.zoom,m,Kc);v.zoom=this._map.transform.zoom+C.amount,La(v,C)}if(u.bearing){const C=Ra(u.bearing,m,Xc);v.bearing=this._map.transform.bearing+i.clamp(C.amount,-179,179),La(v,C)}if(u.pitch){const C=Ra(u.pitch,m,ta);v.pitch=this._map.transform.pitch+C.amount,La(v,C)}if(v.zoom||v.bearing){const C=u.pinchAround===void 0?u.around:u.pinchAround;v.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),i.extend(v,{noMoveStart:!0})}}function La(_,r){(!_.duration||_.duration<r.duration)&&(_.duration=r.duration,_.easing=r.easing)}function Ra(_,r,u){const{maxSpeed:m,linearity:v,deceleration:C}=u,P=i.clamp(_*v/(r/1e3),-m,m),O=Math.abs(P)/(C*v);return{easing:u.easing,duration:1e3*O,amount:P*(O/2)}}class on extends i.Event{constructor(r,u,m,v={}){const C=x.mousePos(u.getCanvasContainer(),m),P=u.unproject(C);super(r,i.extend({point:C,lngLat:P,originalEvent:m},v)),this._defaultPrevented=!1,this.target=u}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Oa extends i.Event{constructor(r,u,m){const v=r==="touchend"?m.changedTouches:m.touches,C=x.touchPos(u.getCanvasContainer(),v),P=C.map(B=>u.unproject(B)),O=C.reduce((B,j,W,Q)=>B.add(j.div(Q.length)),new i.pointGeometry(0,0));super(r,{points:C,point:O,lngLats:P,lngLat:u.unproject(O),originalEvent:m}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ln extends i.Event{constructor(r,u,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class zh{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new ln(r.type,this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new on(r.type,this._map,r))}mouseup(r){this._map.fire(new on(r.type,this._map,r))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new on(r.type,this._map,r))}dblclick(r){return this._firePreventable(new on(r.type,this._map,r))}mouseover(r){this._map.fire(new on(r.type,this._map,r))}mouseout(r){this._map.fire(new on(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Oa(r.type,this._map,r))}touchmove(r){this._map.fire(new Oa(r.type,this._map,r))}touchend(r){this._map.fire(new Oa(r.type,this._map,r))}touchcancel(r){this._map.fire(new Oa(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fs{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new on(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new on("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new on(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yc{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&r.button===0&&(x.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;const m=u;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=x.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const C=Math.min(v.x,m.x),P=Math.max(v.x,m.x),O=Math.min(v.y,m.y),B=Math.max(v.y,m.y);x.setTransform(this._box,`translate(${C}px,${O}px)`),this._box.style.width=P-C+"px",this._box.style.height=B-O+"px"}mouseupWindow(r,u){if(!this._active||r.button!==0)return;const m=this._startPos,v=u;if(this.reset(),x.suppressClick(),m.x!==v.x||m.y!==v.y)return this._map.fire(new i.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:C=>C.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new i.Event(r,{originalEvent:u}))}}function Wn(_,r){if(_.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${r.length}`);const u={};for(let m=0;m<_.length;m++)u[_[m].identifier]=r[m];return u}class Ba{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const C=new i.pointGeometry(0,0);for(const P of v)C._add(P);return C.div(v.length)}(u),this.touches=Wn(m,u)))}touchmove(r,u,m){if(this.aborted||!this.centroid)return;const v=Wn(m,u);for(const C in this.touches){const P=this.touches[C],O=v[C];(!O||O.dist(P)>30)&&(this.aborted=!0)}}touchend(r,u,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class yl{constructor(r){this.singleTap=new Ba(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,u,m){this.singleTap.touchstart(r,u,m)}touchmove(r,u,m){this.singleTap.touchmove(r,u,m)}touchend(r,u,m){const v=this.singleTap.touchend(r,u,m);if(v){const C=r.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(v)<30;if(C&&P||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Dh{constructor(){this._zoomIn=new yl({numTouches:1,numTaps:2}),this._zoomOut=new yl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,m){this._zoomIn.touchstart(r,u,m),this._zoomOut.touchstart(r,u,m)}touchmove(r,u,m){this._zoomIn.touchmove(r,u,m),this._zoomOut.touchmove(r,u,m)}touchend(r,u,m){const v=this._zoomIn.touchend(r,u,m),C=this._zoomOut.touchend(r,u,m);return v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(v)},{originalEvent:r})}):C?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(C)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Lh={0:1,2:2};class wo{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(r,u){return!1}_move(r,u){return{}}mousedown(r,u){if(this._lastPoint)return;const m=x.mouseButton(r);this._correctButton(r,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(r,u){const m=this._lastPoint;if(m){if(r.preventDefault(),function(v,C){const P=Lh[C];return v.buttons===void 0||(v.buttons&P)!==P}(r,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}}mouseupWindow(r){this._lastPoint&&x.mouseButton(r)===this._eventButton&&(this._moved&&x.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Na extends wo{mousedown(r,u){super.mousedown(r,u),this._lastPoint&&(this._active=!0)}_correctButton(r,u){return u===0&&!r.ctrlKey}_move(r,u){return{around:u,panDelta:u.sub(r)}}}class Kn extends wo{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const m=.8*(u.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class qt extends wo{_correctButton(r,u){return u===0&&r.ctrlKey||u===2}_move(r,u){const m=-.5*(u.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class Qc{constructor(r,u){this._minTouches=r.cooperativeGestures?2:1,this._clickTolerance=r.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new i.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(r,u,m){return this._calculateTransform(r,u,m)}touchmove(r,u,m){if(this._map._cooperativeGestures&&(this._minTouches===2&&m.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(r,!1,m.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(m.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,u,m)}touchend(r,u,m){this._calculateTransform(r,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,m){m.length>0&&(this._active=!0);const v=Wn(m,u),C=new i.pointGeometry(0,0),P=new i.pointGeometry(0,0);let O=0;for(const j in v){const W=v[j],Q=this._touches[j];Q&&(C._add(W),P._add(W.sub(Q)),O++,v[j]=W)}if(this._touches=v,O<this._minTouches||!P.mag())return;const B=P.div(O);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(O),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Is{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(r){}_move(r,u,m){return{}}touchstart(r,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,m){if(!this._firstTwoTouches)return;r.preventDefault();const[v,C]=this._firstTwoTouches,P=ds(m,u,v),O=ds(m,u,C);if(!P||!O)return;const B=this._aroundCenter?null:P.add(O).div(2);return this._move([P,O],B,r)}touchend(r,u,m){if(!this._firstTwoTouches)return;const[v,C]=this._firstTwoTouches,P=ds(m,u,v),O=ds(m,u,C);P&&O||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ds(_,r,u){for(let m=0;m<_.length;m++)if(_[m].identifier===u)return r[m]}function vl(_,r){return Math.log(_/r)/Math.LN2}class Nt extends Is{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(vl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vl(this._distance,m),pinchAround:u}}}function So(_,r){return 180*_.angleWith(r)/Math.PI}class Rh extends Is{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:So(this._vector,m),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const u=25/(Math.PI*this._minDiameter)*360,m=So(r,this._startVector);return Math.abs(m)<u}}function bl(_){return Math.abs(_.y)>Math.abs(_.x)}class xl extends Is{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,u,m){super.touchstart(r,u,m),this._currentTouchCount=m.length}_start(r){this._lastPoints=r,bl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,m){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const v=r[0].sub(this._lastPoints[0]),C=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,C,m.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+C.y)/2*-.5}):void 0}gestureBeginsVertically(r,u,m){if(this._valid!==void 0)return this._valid;const v=r.mag()>=2,C=u.mag()>=2;if(!v&&!C)return;if(!v||!C)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const P=r.y>0==u.y>0;return bl(r)&&bl(u)&&P}}const eu={panStep:100,bearingStep:15,pitchStep:10};class tu{constructor(){const r=eu;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,m=0,v=0,C=0,P=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),C=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),C=1);break;case 38:r.shiftKey?v=1:(r.preventDefault(),P=-1);break;case 40:r.shiftKey?v=-1:(r.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:O=>{const B=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:Oh,zoom:u?Math.round(B)+u*(r.shiftKey?2:1):B,bearing:O.getBearing()+m*this._bearingStep,pitch:O.getPitch()+v*this._pitchStep,offset:[-C*this._panStep,-P*this._panStep],center:O.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Oh(_){return _*(2-_)}const ru=4.000244140625;class wl{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,i.bindAll(["_onTimeout"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;r.preventDefault()}let u=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=i.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,u!==0&&u%ru==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=x.mousePos(this._el,r);this._around=i.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>ru?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&B!==0&&(B=1/B);const j=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(j*B))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,m=this._startZoom,v=this._easing;let C,P=!1;if(this._type==="wheel"&&m&&v){const O=Math.min((i.exported.now()-this._lastWheelEventTime)/200,1),B=v(O);C=i.number(m,u,B),O<1?this._frameId||(this._frameId=!0):P=!0}else C=u,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:C-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=i.ease;if(this._prevEase){const m=this._prevEase,v=(i.exported.now()-m.start)/m.duration,C=m.easing(v+.01)-m.easing(v),P=.27/Math.sqrt(C*C+1e-4)*.01,O=Math.sqrt(.0729-P*P);u=i.bezier(P,O,.25,1)}return this._prevEase={start:i.exported.now(),duration:r,easing:u},u}reset(){this._active=!1}}class Sl{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class kl{constructor(){this.reset()}reset(){this._active=!1}dblclick(r,u){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class El{constructor(){this._tap=new yl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(r,u,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,u,m))}touchmove(r,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=u[0],C=v.y-this._swipePoint.y;return this._swipePoint=v,r.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(r,u,m)}touchend(r,u,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(r,u,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yi{constructor(r,u,m){this._el=r,this._mousePan=u,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ps{constructor(r,u,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class iu{constructor(r,u,m,v){this._el=r,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ra=_=>_.zoom||_.drag||_.pitch||_.rotate;class Tl extends i.Event{}function Fa(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class nu{constructor(r,u){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Jc(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),i.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,C,P]of this._listeners)x.addEventListener(v,C,v===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[r,u,m]of this._listeners)x.removeEventListener(r,u,r===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new zh(u,r));const v=u.boxZoom=new Yc(u,r);this._add("boxZoom",v);const C=new Dh,P=new kl;u.doubleClickZoom=new Sl(P,C),this._add("tapZoom",C),this._add("clickZoom",P);const O=new El;this._add("tapDragZoom",O);const B=u.touchPitch=new xl(u);this._add("touchPitch",B);const j=new Kn(r),W=new qt(r);u.dragRotate=new ps(r,j,W),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);const Q=new Na(r),ne=new Qc(r,u);u.dragPan=new Yi(m,Q,ne),this._add("mousePan",Q),this._add("touchPan",ne,["touchZoom","touchRotate"]);const ge=new Rh,fe=new Nt;u.touchZoomRotate=new iu(m,fe,ge,O),this._add("touchRotate",ge,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]);const pe=u.scrollZoom=new wl(u,this);this._add("scrollZoom",pe,["mousePan"]);const Pe=u.keyboard=new tu;this._add("keyboard",Pe),this._add("blockableMapEvent",new fs(u));for(const De of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[De]&&u[De].enable(r[De])}_add(r,u,m){this._handlers.push({handlerName:r,handler:u,allowed:m}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ra(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,u,m){for(const v in r)if(v!==m&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const u=[];for(const m of r)this._el.contains(m.target)&&u.push(m);return u}handleEvent(r,u){if(r.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const m=r.type==="renderFrame"?void 0:r,v={needsRenderFrame:!1},C={},P={},O=r.touches,B=O?this._getMapTouches(O):void 0,j=B?x.touchPos(this._el,B):x.mousePos(this._el,r);for(const{handlerName:ne,handler:ge,allowed:fe}of this._handlers){if(!ge.isEnabled())continue;let pe;this._blockedByActive(P,fe,ne)?ge.reset():ge[u||r.type]&&(pe=ge[u||r.type](r,j,B),this.mergeHandlerResult(v,C,pe,ne,m),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||ge.isActive())&&(P[ne]=ge)}const W={};for(const ne in this._previousActiveHandlers)P[ne]||(W[ne]=m);this._previousActiveHandlers=P,(Object.keys(W).length||Fa(v))&&(this._changes.push([v,C,W]),this._triggerRenderFrame()),(Object.keys(P).length||Fa(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=v;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(r,u,m,v,C){if(!m)return;i.extend(r,m);const P={handlerName:v,originalEvent:m.originalEvent||C};m.zoomDelta!==void 0&&(u.zoom=P),m.panDelta!==void 0&&(u.drag=P),m.pitchDelta!==void 0&&(u.pitch=P),m.bearingDelta!==void 0&&(u.rotate=P)}_applyChanges(){const r={},u={},m={};for(const[v,C,P]of this._changes)v.panDelta&&(r.panDelta=(r.panDelta||new i.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(r.around=v.around),v.pinchAround!==void 0&&(r.pinchAround=v.pinchAround),v.noInertia&&(r.noInertia=v.noInertia),i.extend(u,C),i.extend(m,P);this._updateMapTransform(r,u,m),this._changes=[]}_updateMapTransform(r,u,m){const v=this._map,C=v.transform,P=v.style&&v.style.terrain;if(!(Fa(r)||P&&this._drag))return this._fireEvents(u,m,!0);let{panDelta:O,zoomDelta:B,bearingDelta:j,pitchDelta:W,around:Q,pinchAround:ne}=r;ne!==void 0&&(Q=ne),v._stop(!0),Q=Q||v.transform.centerPoint;const ge=C.pointLocation(O?Q.sub(O):Q);j&&(C.bearing+=j),W&&(C.pitch+=W),B&&(C.zoom+=B),P?u.drag&&!this._drag?(this._drag={center:C.centerPoint,lngLat:C.pointLocation(Q),point:Q,handlerName:u.drag.handlerName},v.fire(new i.Event("freezeElevation",{freeze:!0}))):this._drag&&m[this._drag.handlerName]?(v.fire(new i.Event("freezeElevation",{freeze:!1})),this._drag=null):u.drag&&this._drag&&(C.center=C.pointLocation(C.centerPoint.sub(O))):C.setLocationAtPoint(ge,Q),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,m,!0)}_fireEvents(r,u,m){const v=ra(this._eventsInProgress),C=ra(r),P={};for(const W in r){const{originalEvent:Q}=r[W];this._eventsInProgress[W]||(P[`${W}start`]=Q),this._eventsInProgress[W]=r[W]}!v&&C&&this._fireEvent("movestart",C.originalEvent);for(const W in P)this._fireEvent(W,P[W]);C&&this._fireEvent("move",C.originalEvent);for(const W in r){const{originalEvent:Q}=r[W];this._fireEvent(W,Q)}const O={};let B;for(const W in this._eventsInProgress){const{handlerName:Q,originalEvent:ne}=this._eventsInProgress[W];this._handlersById[Q].isActive()||(delete this._eventsInProgress[W],B=u[Q]||ne,O[`${W}end`]=B)}for(const W in O)this._fireEvent(W,O[W]);const j=ra(this._eventsInProgress);if(m&&(v||C)&&!j){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=ne=>ne!==0&&-this._bearingSnap<ne&&ne<this._bearingSnap;W?(Q(W.bearing||this._map.getBearing())&&(W.bearing=0),this._map.easeTo(W,{originalEvent:B})):(this._map.fire(new i.Event("moveend",{originalEvent:B})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new i.Event(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new Tl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const yn={extend:(_,...r)=>i.extend(_,...r),run(_){_()},logToElement(_,r=!1,u="log"){const m=window.document.getElementById(u);m&&(r&&(m.innerHTML=""),m.innerHTML+=`<br>${_}`)}};class ai extends i.Evented{constructor(r,u){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=u.bearingSnap,i.bindAll(["_renderFrameCallback"],this)}getCenter(){return new i.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}panBy(r,u,m){return r=i.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,i.extend({offset:r},u),m)}panTo(r,u,m){return this.easeTo(i.extend({center:r},u),m)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,m){return this.easeTo(i.extend({zoom:r},u),m)}zoomIn(r,u){return this.zoomTo(this.getZoom()+1,r,u),this}zoomOut(r,u){return this.zoomTo(this.getZoom()-1,r,u),this}getBearing(){return this.transform.bearing}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,m){return this.easeTo(i.extend({bearing:r},u),m)}resetNorth(r,u){return this.rotateTo(0,i.extend({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(i.extend({bearing:0,pitch:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}cameraForBounds(r,u){r=i.LngLatBounds.convert(r);const m=u&&u.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),m,u)}_cameraForBoxAndBearing(r,u,m,v){const C={top:0,bottom:0,right:0,left:0};if(typeof(v=i.extend({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const He=v.padding;v.padding={top:He,bottom:He,right:He,left:He}}v.padding=i.extend(C,v.padding);const P=this.transform,O=P.padding,B=P.project(i.LngLat.convert(r)),j=P.project(i.LngLat.convert(u)),W=B.rotate(-m*Math.PI/180),Q=j.rotate(-m*Math.PI/180),ne=new i.pointGeometry(Math.max(W.x,Q.x),Math.max(W.y,Q.y)),ge=new i.pointGeometry(Math.min(W.x,Q.x),Math.min(W.y,Q.y)),fe=ne.sub(ge),pe=(P.width-(O.left+O.right+v.padding.left+v.padding.right))/fe.x,Pe=(P.height-(O.top+O.bottom+v.padding.top+v.padding.bottom))/fe.y;if(Pe<0||pe<0)return void i.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const De=Math.min(P.scaleZoom(P.scale*Math.min(pe,Pe)),v.maxZoom),Ue=i.pointGeometry.convert(v.offset),xe=new i.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(m*Math.PI/180),Je=Ue.add(xe).mult(P.scale/P.zoomScale(De));return{center:P.unproject(B.add(j).div(2).sub(Je)),zoom:De,bearing:m}}fitBounds(r,u,m){return this._fitInternal(this.cameraForBounds(r,u),u,m)}fitScreenCoordinates(r,u,m,v,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(i.pointGeometry.convert(r)),this.transform.pointLocation(i.pointGeometry.convert(u)),m,v),v,C)}_fitInternal(r,u,m){return r?(delete(u=i.extend(r,u)).padding,u.linear?this.easeTo(u,m):this.flyTo(u,m)):this}jumpTo(r,u){this.stop();const m=this.transform;let v=!1,C=!1,P=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(v=!0,m.zoom=+r.zoom),r.center!==void 0&&(m.center=i.LngLat.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(C=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(P=!0,m.pitch=+r.pitch),r.padding==null||m.isPaddingEqual(r.padding)||(m.padding=r.padding),this.fire(new i.Event("movestart",u)).fire(new i.Event("move",u)),v&&this.fire(new i.Event("zoomstart",u)).fire(new i.Event("zoom",u)).fire(new i.Event("zoomend",u)),C&&this.fire(new i.Event("rotatestart",u)).fire(new i.Event("rotate",u)).fire(new i.Event("rotateend",u)),P&&this.fire(new i.Event("pitchstart",u)).fire(new i.Event("pitch",u)).fire(new i.Event("pitchend",u)),this.fire(new i.Event("moveend",u))}calculateCameraOptionsFromTo(r,u,m,v=0){const C=i.MercatorCoordinate.fromLngLat(r,u),P=i.MercatorCoordinate.fromLngLat(m,v),O=P.x-C.x,B=P.y-C.y,j=P.z-C.z,W=Math.hypot(O,B,j);if(W===0)throw new Error("Can't calculate camera options with same From and To");const Q=Math.hypot(O,B),ne=this.transform.scaleZoom(this.transform.cameraToCenterDistance/W/this.transform.tileSize),ge=180*Math.atan2(O,-B)/Math.PI;let fe=180*Math.acos(Q/W)/Math.PI;return fe=j<0?90-fe:90+fe,{center:P.toLngLat(),zoom:ne,pitch:fe,bearing:ge}}easeTo(r,u){this._stop(!1,r.easeId),((r=i.extend({offset:[0,0],duration:500,easing:i.ease},r)).animate===!1||!r.essential&&i.exported.prefersReducedMotion)&&(r.duration=0);const m=this.transform,v=this.getZoom(),C=this.getBearing(),P=this.getPitch(),O=this.getPadding(),B="zoom"in r?+r.zoom:v,j="bearing"in r?this._normalizeBearing(r.bearing,C):C,W="pitch"in r?+r.pitch:P,Q="padding"in r?r.padding:m.padding,ne=i.pointGeometry.convert(r.offset);let ge=m.centerPoint.add(ne);const fe=m.pointLocation(ge),pe=i.LngLat.convert(r.center||fe);this._normalizeCenter(pe);const Pe=m.project(fe),De=m.project(pe).sub(Pe),Ue=m.zoomScale(B-v);let xe,Je;r.around&&(xe=i.LngLat.convert(r.around),Je=m.locationPoint(xe));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||B!==v,this._rotating=this._rotating||C!==j,this._pitching=this._pitching||W!==P,this._padding=!m.isPaddingEqual(Q),this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,He),this._ease(st=>{if(this._zooming&&(m.zoom=i.number(v,B,st)),this._rotating&&(m.bearing=i.number(C,j,st)),this._pitching&&(m.pitch=i.number(P,W,st)),this._padding&&(m.interpolatePadding(O,Q,st),ge=m.centerPoint.add(ne)),xe)m.setLocationAtPoint(xe,Je);else{const lt=m.zoomScale(m.zoom-v),yt=B>v?Math.min(2,Ue):Math.max(.5,Ue),rt=Math.pow(yt,1-st),Vt=m.unproject(Pe.add(De.mult(st*rt)).mult(lt));m.setLocationAtPoint(m.renderWorldCopies?Vt.wrap():Vt,ge)}this._fireMoveEvents(u)},st=>{this._afterEase(u,st)},r),this}_prepareEase(r,u,m={}){this._moving=!0,this.fire(new i.Event("freezeElevation",{freeze:!0})),u||m.moving||this.fire(new i.Event("movestart",r)),this._zooming&&!m.zooming&&this.fire(new i.Event("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new i.Event("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new i.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.Event("move",r)),this._zooming&&this.fire(new i.Event("zoom",r)),this._rotating&&this.fire(new i.Event("rotate",r)),this._pitching&&this.fire(new i.Event("pitch",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId,this.fire(new i.Event("freezeElevation",{freeze:!1}));const m=this._zooming,v=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new i.Event("zoomend",r)),v&&this.fire(new i.Event("rotateend",r)),C&&this.fire(new i.Event("pitchend",r)),this.fire(new i.Event("moveend",r))}flyTo(r,u){if(!r.essential&&i.exported.prefersReducedMotion){const tr=i.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tr,u)}this.stop(),r=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},r);const m=this.transform,v=this.getZoom(),C=this.getBearing(),P=this.getPitch(),O=this.getPadding(),B="zoom"in r?i.clamp(+r.zoom,m.minZoom,m.maxZoom):v,j="bearing"in r?this._normalizeBearing(r.bearing,C):C,W="pitch"in r?+r.pitch:P,Q="padding"in r?r.padding:m.padding,ne=m.zoomScale(B-v),ge=i.pointGeometry.convert(r.offset);let fe=m.centerPoint.add(ge);const pe=m.pointLocation(fe),Pe=i.LngLat.convert(r.center||pe);this._normalizeCenter(Pe);const De=m.project(pe),Ue=m.project(Pe).sub(De);let xe=r.curve;const Je=Math.max(m.width,m.height),He=Je/ne,st=Ue.mag();if("minZoom"in r){const tr=i.clamp(Math.min(r.minZoom,v,B),m.minZoom,m.maxZoom),qr=Je/m.zoomScale(tr-v);xe=Math.sqrt(qr/st*2)}const lt=xe*xe;function yt(tr){const qr=(He*He-Je*Je+(tr?-1:1)*lt*lt*st*st)/(2*(tr?He:Je)*lt*st);return Math.log(Math.sqrt(qr*qr+1)-qr)}function rt(tr){return(Math.exp(tr)-Math.exp(-tr))/2}function Vt(tr){return(Math.exp(tr)+Math.exp(-tr))/2}const Dt=yt(0);let $t=function(tr){return Vt(Dt)/Vt(Dt+xe*tr)},gr=function(tr){return Je*((Vt(Dt)*(rt(qr=Dt+xe*tr)/Vt(qr))-rt(Dt))/lt)/st;var qr},br=(yt(1)-Dt)/xe;if(Math.abs(st)<1e-6||!isFinite(br)){if(Math.abs(Je-He)<1e-6)return this.easeTo(r,u);const tr=He<Je?-1:1;br=Math.abs(Math.log(He/Je))/xe,gr=function(){return 0},$t=function(qr){return Math.exp(tr*xe*qr)}}return r.duration="duration"in r?+r.duration:1e3*br/("screenSpeed"in r?+r.screenSpeed/xe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=C!==j,this._pitching=W!==P,this._padding=!m.isPaddingEqual(Q),this._prepareEase(u,!1),this._ease(tr=>{const qr=tr*br,Gr=1/$t(qr);m.zoom=tr===1?B:v+m.scaleZoom(Gr),this._rotating&&(m.bearing=i.number(C,j,tr)),this._pitching&&(m.pitch=i.number(P,W,tr)),this._padding&&(m.interpolatePadding(O,Q,tr),fe=m.centerPoint.add(ge));const Ar=tr===1?Pe:m.unproject(De.add(Ue.mult(gr(qr))).mult(Gr));m.setLocationAtPoint(m.renderWorldCopies?Ar.wrap():Ar,fe),this._fireMoveEvents(u)},()=>this._afterEase(u),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,u)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,u,m){m.animate===!1||m.duration===0?(r(1),u()):(this._easeStart=i.exported.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((i.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,u){r=i.wrap(r,-180,180);const m=Math.abs(r-u);return Math.abs(r-360-u)<m&&(r-=360),Math.abs(r+360-u)<m&&(r+=360),r}_normalizeCenter(r){const u=this.transform;if(!u.renderWorldCopies||u.lngRange)return;const m=r.lng-u.center.lng;r.lng+=m>180?-360:m<-180?360:0}}class Ua{constructor(r={}){this.options=r,i.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options&&this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,u){const m=this._map._getUIString(`AttributionControl.${u}`);r.title=m,r.setAttribute("aria-label",m)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style.sourceCaches;for(const v in u){const C=u[v];if(C.used||C.usedForTerrain){const P=C.getSource();P.attribution&&r.indexOf(P.attribution)<0&&r.push(P.attribution)}}r=r.filter(v=>String(v).trim()),r.sort((v,C)=>v.length-C.length),r=r.filter((v,C)=>{for(let P=C+1;P<r.length;P++)if(r[P].indexOf(v)>=0)return!1;return!0});const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ko{constructor(r={}){this.options=r,i.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl mapboxgl-ctrl");const u=x.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const r=this._container.children;if(r.length){const u=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact","mapboxgl-compact"):u.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class su{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const v of m)if(v.id===r)return void(v.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const au={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},ou={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Bh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dn{constructor(r,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Kn({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new qt({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),x.addEventListener(u,"mousedown",this.mousedown),x.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(u,"touchmove",this.touchmove),x.addEventListener(u,"touchend",this.touchend),x.addEventListener(u,"touchcancel",this.reset)}down(r,u){this.mouseRotate.mousedown(r,u),this.mousePitch&&this.mousePitch.mousedown(r,u),x.disableDrag()}move(r,u){const m=this.map,v=this.mouseRotate.mousemoveWindow(r,u);if(v&&v.bearingDelta&&m.setBearing(m.getBearing()+v.bearingDelta),this.mousePitch){const C=this.mousePitch.mousemoveWindow(r,u);C&&C.pitchDelta&&m.setPitch(m.getPitch()+C.pitchDelta)}}off(){const r=this.element;x.removeEventListener(r,"mousedown",this.mousedown),x.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(r,"touchmove",this.touchmove),x.removeEventListener(r,"touchend",this.touchend),x.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup)}mousedown(r){this.down(i.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),x.mousePos(this.element,r)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)}mousemove(r){this.move(r,x.mousePos(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Va(_,r,u){if(_=new i.LngLat(_.lng,_.lat),r){const m=new i.LngLat(_.lng-360,_.lat),v=new i.LngLat(_.lng+360,_.lat),C=u.locationPoint(_).distSqr(r);u.locationPoint(m).distSqr(r)<C?_=m:u.locationPoint(v).distSqr(r)<C&&(_=v)}for(;Math.abs(_.lng-u.center.lng)>180;){const m=u.locationPoint(_);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;_.lng>u.center.lng?_.lng-=360:_.lng+=360}return _}const Wt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function lr(_,r,u){const m=_.classList;for(const v in Wt)m.remove(`maplibregl-${u}-anchor-${v}`,`mapboxgl-${u}-anchor-${v}`);m.add(`maplibregl-${u}-anchor-${r}`,`mapboxgl-${u}-anchor-${r}`)}class ia extends i.Evented{constructor(r,u){if(super(),(r instanceof HTMLElement||u)&&(r=i.extend({element:r},u)),i.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=i.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const m=x.createNS("http://www.w3.org/2000/svg","svg"),v=41,C=27;m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height",`${v}px`),m.setAttributeNS(null,"width",`${C}px`),m.setAttributeNS(null,"viewBox",`0 0 ${C} ${v}`);const P=x.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");const O=x.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");const B=x.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");const j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ue of j){const xe=x.createNS("http://www.w3.org/2000/svg","ellipse");xe.setAttributeNS(null,"opacity","0.04"),xe.setAttributeNS(null,"cx","10.5"),xe.setAttributeNS(null,"cy","5.80029008"),xe.setAttributeNS(null,"rx",Ue.rx),xe.setAttributeNS(null,"ry",Ue.ry),B.appendChild(xe)}const W=x.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"fill",this._color);const Q=x.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),W.appendChild(Q);const ne=x.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"fill","#000000");const ge=x.createNS("http://www.w3.org/2000/svg","path");ge.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ne.appendChild(ge);const fe=x.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),fe.setAttributeNS(null,"fill","#FFFFFF");const pe=x.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Pe=x.createNS("http://www.w3.org/2000/svg","circle");Pe.setAttributeNS(null,"fill","#000000"),Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"cx","5.5"),Pe.setAttributeNS(null,"cy","5.5"),Pe.setAttributeNS(null,"r","5.4999962");const De=x.createNS("http://www.w3.org/2000/svg","circle");De.setAttributeNS(null,"fill","#FFFFFF"),De.setAttributeNS(null,"cx","5.5"),De.setAttributeNS(null,"cy","5.5"),De.setAttributeNS(null,"r","5.4999962"),pe.appendChild(Pe),pe.appendChild(De),O.appendChild(B),O.appendChild(W),O.appendChild(ne),O.appendChild(fe),O.appendChild(pe),m.appendChild(O),m.setAttributeNS(null,"height",v*this._scale+"px"),m.setAttributeNS(null,"width",C*this._scale+"px"),this._element.appendChild(m),this._offset=i.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()}),lr(this._element,this._anchor,"marker"),this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(r){const u=r.code,m=r.charCode||r.keyCode;u!=="Space"&&u!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(r){const u=r.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}_update(r){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Va(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),r&&r.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${Wt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${u}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const v=this._map.unproject(this._pos),C=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=v.distanceTo(this._lngLat)>20*C?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(r){return this._offset=i.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.Event("dragstart"))),this.fire(new i.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new i.Event("dragend")),this._state="inactive"}_addDragHandler(r){this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Cl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ms,Ri=0,gs=!1;const Ln={maxWidth:100,unit:"metric"};function lu(_,r,u){const m=u&&u.maxWidth||100,v=_._container.clientHeight/2,C=_.unproject([0,v]),P=_.unproject([m,v]),O=C.distanceTo(P);if(u&&u.unit==="imperial"){const B=3.2808*O;B>5280?_s(r,m,B/5280,_._getUIString("ScaleControl.Miles")):_s(r,m,B,_._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?_s(r,m,O/1852,_._getUIString("ScaleControl.NauticalMiles")):O>=1e3?_s(r,m,O/1e3,_._getUIString("ScaleControl.Kilometers")):_s(r,m,O,_._getUIString("ScaleControl.Meters"))}function _s(_,r,u,m){const v=function(C){const P=Math.pow(10,`${Math.floor(C)}`.length-1);let O=C/P;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(B){const j=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*j)/j}(O),P*O}(u);_.style.width=r*(v/u)+"px",_.innerHTML=`${v}&nbsp;${m}`}const pi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Il(_){if(_){if(typeof _=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(_,2)));return{center:new i.pointGeometry(0,0),top:new i.pointGeometry(0,_),"top-left":new i.pointGeometry(r,r),"top-right":new i.pointGeometry(-r,r),bottom:new i.pointGeometry(0,-_),"bottom-left":new i.pointGeometry(r,-r),"bottom-right":new i.pointGeometry(-r,-r),left:new i.pointGeometry(_,0),right:new i.pointGeometry(-_,0)}}if(_ instanceof i.pointGeometry||Array.isArray(_)){const r=i.pointGeometry.convert(_);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:i.pointGeometry.convert(_.center||[0,0]),top:i.pointGeometry.convert(_.top||[0,0]),"top-left":i.pointGeometry.convert(_["top-left"]||[0,0]),"top-right":i.pointGeometry.convert(_["top-right"]||[0,0]),bottom:i.pointGeometry.convert(_.bottom||[0,0]),"bottom-left":i.pointGeometry.convert(_["bottom-left"]||[0,0]),"bottom-right":i.pointGeometry.convert(_["bottom-right"]||[0,0]),left:i.pointGeometry.convert(_.left||[0,0]),right:i.pointGeometry.convert(_.right||[0,0])}}return Il(new i.pointGeometry(0,0))}const As={supported:d,setRTLTextPlugin:i.setRTLTextPlugin,getRTLTextPluginStatus:i.getRTLTextPluginStatus,Map:class extends ai{constructor(_){var r;if(i.PerformanceUtils.mark(i.PerformanceMarkers.create),(_=i.extend({},ou,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new za(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),{bearingSnap:_.bearingSnap}),this._interactive=_.interactive,this._cooperativeGestures=_.cooperativeGestures,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._renderTaskQueue=new su,this._controls=[],this._mapId=i.uniqueId(),this._locale=i.extend({},au,_.locale),this._clickTolerance=_.clickTolerance,this._pixelRatio=(r=_.pixelRatio)!==null&&r!==void 0?r:devicePixelRatio,this._requestManager=new S(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),i.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new nu(this,_),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=_.hash&&new Hc(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,i.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new Ua({customAttribution:_.customAttribution})),_.maplibreLogo&&this.addControl(new ko,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new i.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new i.Event(`${u.dataType}dataloading`,u))}),this.on("dataabort",u=>{this.fire(new i.Event("sourcedataabort",u))})}_getMapId(){return this._mapId}addControl(_,r){if(r===void 0&&(r=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=_.onAdd(this);this._controls.push(_);const m=this._controlPositions[r];return r.indexOf("bottom")!==-1?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(_);return r>-1&&this._controls.splice(r,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,r,u,m){return m==null&&this.style.terrain&&(m=this.transform.getElevation(u,this.style.terrain)),super.calculateCameraOptionsFromTo(_,r,u,m)}resize(_){const r=this._containerDimensions(),u=r[0],m=r[1];this._resizeCanvas(u,m,this.getPixelRatio()),this.transform.resize(u,m),this.painter.resize(u,m,this.getPixelRatio());const v=!this._moving;return v&&(this.stop(),this.fire(new i.Event("movestart",_)).fire(new i.Event("move",_))),this.fire(new i.Event("resize",_)),v&&this.fire(new i.Event("moveend",_)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(_){const[r,u]=this._containerDimensions();this._pixelRatio=_,this._resizeCanvas(r,u,_),this.painter.resize(r,u,_)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(i.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint(i.LngLat.convert(_),this.style&&this.style.terrain)}unproject(_){return this.transform.pointLocation(i.pointGeometry.convert(_),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(_,r,u){if(_==="mouseenter"||_==="mouseover"){let m=!1;return{layer:r,listener:u,delegates:{mousemove:C=>{const P=this.getLayer(r)?this.queryRenderedFeatures(C.point,{layers:[r]}):[];P.length?m||(m=!0,u.call(this,new on(_,this,C.originalEvent,{features:P}))):m=!1},mouseout:()=>{m=!1}}}}if(_==="mouseleave"||_==="mouseout"){let m=!1;return{layer:r,listener:u,delegates:{mousemove:P=>{(this.getLayer(r)?this.queryRenderedFeatures(P.point,{layers:[r]}):[]).length?m=!0:m&&(m=!1,u.call(this,new on(_,this,P.originalEvent)))},mouseout:P=>{m&&(m=!1,u.call(this,new on(_,this,P.originalEvent)))}}}}{const m=v=>{const C=this.getLayer(r)?this.queryRenderedFeatures(v.point,{layers:[r]}):[];C.length&&(v.features=C,u.call(this,v),delete v.features)};return{layer:r,listener:u,delegates:{[_]:m}}}}on(_,r,u){if(u===void 0)return super.on(_,r);const m=this._createDelegatedListener(_,r,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(_,r,u){if(u===void 0)return super.once(_,r);const m=this._createDelegatedListener(_,r,u);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(_,r,u){return u===void 0?super.off(_,r):(this._delegatedListeners&&this._delegatedListeners[_]&&(m=>{const v=this._delegatedListeners[_];for(let C=0;C<v.length;C++){const P=v[C];if(P.layer===r&&P.listener===u){for(const O in P.delegates)this.off(O,P.delegates[O]);return v.splice(C,1),this}}})(),this)}queryRenderedFeatures(_,r){if(!this.style)return[];let u;if(r!==void 0||_===void 0||_ instanceof i.pointGeometry||Array.isArray(_)||(r=_,_=void 0),r=r||{},(_=_||[[0,0],[this.transform.width,this.transform.height]])instanceof i.pointGeometry||typeof _[0]=="number")u=[i.pointGeometry.convert(_)];else{const m=i.pointGeometry.convert(_[0]),v=i.pointGeometry.convert(_[1]);u=[m,new i.pointGeometry(v.x,m.y),v,new i.pointGeometry(m.x,v.y),m]}return this.style.queryRenderedFeatures(u,r,this.transform)}querySourceFeatures(_,r){return this.style.querySourceFeatures(_,r)}setStyle(_,r){return(r=i.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(_,r))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const r=this._locale[_];if(r==null)throw new Error(`Missing UI string '${_}'`);return r}_updateStyle(_,r){return this.style&&(this.style.setEventedParent(null),this.style._remove()),_?(this.style=new di(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_):this.style.loadJSON(_),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new di(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,r){if(typeof _=="string"){const u=this._requestManager.transformRequest(_,i.ResourceType.Style);i.getJSON(u,(m,v)=>{m?this.fire(new i.ErrorEvent(m)):v&&this._updateDiff(v,r)})}else typeof _=="object"&&this._updateDiff(_,r)}_updateDiff(_,r){try{this.style.setState(_)&&this._update(!0)}catch(u){i.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(_,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():i.warnOnce("There is no style added to the map.")}addSource(_,r){return this._lazyInitEmptyStyle(),this.style.addSource(_,r),this._update(!0)}isSourceLoaded(_){const r=this.style&&this.style.sourceCaches[_];if(r!==void 0)return r.loaded();this.fire(new i.ErrorEvent(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){return this.style.setTerrain(_),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const r in _){const u=_[r]._tiles;for(const m in u){const v=u[m];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(_,r,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(_,r,u)}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,r,{pixelRatio:u=1,sdf:m=!1,stretchX:v,stretchY:C,content:P}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||i.isImageBitmap(r)){const{width:O,height:B,data:j}=i.exported.getImageData(r);this.style.addImage(_,{data:new i.RGBAImage({width:O,height:B},j),pixelRatio:u,stretchX:v,stretchY:C,content:P,sdf:m,version:0})}else{if(r.width===void 0||r.height===void 0)return this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:B,data:j}=r,W=r;this.style.addImage(_,{data:new i.RGBAImage({width:O,height:B},new Uint8Array(j)),pixelRatio:u,stretchX:v,stretchY:C,content:P,sdf:m,version:0,userImage:W}),W.onAdd&&W.onAdd(this,_)}}}updateImage(_,r){const u=this.style.getImage(_);if(!u)return this.fire(new i.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof HTMLImageElement||i.isImageBitmap(r)?i.exported.getImageData(r):r,{width:v,height:C,data:P}=m;if(v===void 0||C===void 0)return this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==u.data.width||C!==u.data.height)return this.fire(new i.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const O=!(r instanceof HTMLImageElement||i.isImageBitmap(r));u.data.replace(P,O),this.style.updateImage(_,u)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new i.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,r){i.getImage(this._requestManager.transformRequest(_,i.ResourceType.Image),r)}listImages(){return this.style.listImages()}addLayer(_,r){return this._lazyInitEmptyStyle(),this.style.addLayer(_,r),this._update(!0)}moveLayer(_,r){return this.style.moveLayer(_,r),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,r,u){return this.style.setLayerZoomRange(_,r,u),this._update(!0)}setFilter(_,r,u={}){return this.style.setFilter(_,r,u),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,r,u,m={}){return this.style.setPaintProperty(_,r,u,m),this._update(!0)}getPaintProperty(_,r){return this.style.getPaintProperty(_,r)}setLayoutProperty(_,r,u,m={}){return this.style.setLayoutProperty(_,r,u,m),this._update(!0)}getLayoutProperty(_,r){return this.style.getLayoutProperty(_,r)}setLight(_,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(_,r){return this.style.setFeatureState(_,r),this._update()}removeFeatureState(_,r){return this.style.removeFeatureState(_,r),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,r=0;return this._container&&(_=this._container.clientWidth||400,r=this._container.clientHeight||300),[_,r]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map","mapboxgl-map");const r=this._canvasContainer=x.create("div","maplibregl-canvas-container mapboxgl-canvas-container",_);this._interactive&&r.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const u=this._containerDimensions();this._resizeCanvas(u[0],u[1],this.getPixelRatio());const m=this._controlContainer=x.create("div","maplibregl-control-container mapboxgl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{v[C]=x.create("div",`maplibregl-ctrl-${C} mapboxgl-ctrl-${C}`,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const _=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=x.create("div","maplibregl-cooperative-gesture-screen",_);let r="Control",u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(u=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",r="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${u}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",m=>{m.key===r&&(this._metaPress=!0)}),document.addEventListener("keyup",m=>{m.key===r&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",m=>{this._onCooperativeGesture(m,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(_,r,u){this._canvas.width=u*_,this._canvas.height=u*r,this._canvas.style.width=`${_}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const _=i.extend({},d.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);r?(this.painter=new _l(r,this.transform),i.exported$1.testSupport(r)):this.fire(new i.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new i.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(_,r,u){return!r&&u<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){let r,u=0;const m=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(r=m.createQueryEXT(),m.beginQueryEXT(m.TIME_ELAPSED_EXT,r),u=i.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let v=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,O=i.exported.now();this.style.zoomHistory.update(P,O);const B=new i.EvaluationParameters(P,{now:O,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=B.crossFadingFactor();j===1&&j===this._crossFadingFactor||(v=!0,this._crossFadingFactor=j),this.style.update(B)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new i.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,i.PerformanceUtils.mark(i.PerformanceMarkers.load),this.fire(new i.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=i.exported.now()-u;m.endQueryEXT(m.TIME_ELAPSED_EXT,r),setTimeout(()=>{const O=m.getQueryObjectEXT(r,m.QUERY_RESULT_EXT)/1e6;m.deleteQueryEXT(r),this.fire(new i.Event("gpu-timing-frame",{cpuTime:P,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(P);this.fire(new i.Event("gpu-timing-layer",{layerTimes:O}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty;return C||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new i.Event("idle")),!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,i.PerformanceUtils.mark(i.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._cooperativeGestures&&x.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),i.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new i.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=i.exported.frame(_=>{i.PerformanceUtils.frame(_),this._frame=null,this._render(_)}))}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}_setCacheLimits(_,r){i.setCacheLimits(_,r)}get version(){return"2.4.0"}},NavigationControl:class{constructor(_){this.options=i.extend({},Bh,_),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(i.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),x.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),x.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map.getZoom(),r=_===this._map.getMaxZoom(),u=_===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const _=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=_}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,r){const u=x.create("button",_,this._container);return u.type="button",u.addEventListener("click",r),u}_setButtonTitle(_,r){const u=this._map._getUIString(`NavigationControl.${r}`);_.title=u,_.setAttribute("aria-label",u)}},GeolocateControl:class extends i.Evented{constructor(_){super(),this.options=i.extend({},Cl,_),i.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(_){var r;return this._map=_,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,ms!==void 0?r(ms):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(u=>{ms=u.state!=="denied",r(ms)}):(ms=!!window.navigator.geolocation,r(ms)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ri=0,gs=!1}_isOutOfMapMaxBounds(_){const r=this._map.getMaxBounds(),u=_.coords;return r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new i.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new i.Event("geolocate",_)),this._finish()}}_updateCamera(_){const r=new i.LngLat(_.coords.longitude,_.coords.latitude),u=_.coords.accuracy,m=this._map.getBearing(),v=i.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(u),v,{geolocateSource:!0})}_updateMarker(_){if(_){const r=new i.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map._container.clientHeight/2,r=this._map.unproject([0,_]),u=this._map.unproject([1,_]),m=r.distanceTo(u),v=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&gs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new i.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",_===!1){i.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ia(this._dotElement),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ia({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new i.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return i.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ri--,gs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ri++,Ri>1?(_={maximumAge:6e5,timeout:0},gs=!0):(_=this.options.positionOptions,gs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ua,LogoControl:ko,ScaleControl:class{constructor(_){this.options=i.extend({},Ln,_),i.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){lu(this._map,this._container,this.options)}onAdd(_){return this._map=_,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(_){this.options.unit=_,lu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:i.warnOnce("Full screen control 'container' must be a DOM element.")),i.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(_){this.options=_,i.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(_){return this._map=_,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends i.Evented{constructor(_){super(),this.options=i.extend(Object.create(pi),_),i.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new i.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new i.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=i.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const r=document.createDocumentFragment(),u=document.createElement("body");let m;for(u.innerHTML=_;m=u.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){this._container&&this._container.classList.add(_)}removeClassName(_){this._container&&this._container.classList.remove(_)}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(_){this._update(_.point)}_onMouseMove(_){this._update(_.point)}_onDrag(_){this._update(_.point)}_update(_){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=x.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(C=>this._container.classList.add(C)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Va(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!_))return;const r=this._pos=this._trackPointer&&_?_:this._map.project(this._lngLat);let u=this.options.anchor;const m=Il(this.options.offset);if(!u){const C=this._container.offsetWidth,P=this._container.offsetHeight;let O;O=r.y+m.bottom.y<P?["top"]:r.y>this._map.transform.height-P?["bottom"]:[],r.x<C/2?O.push("left"):r.x>this._map.transform.width-C/2&&O.push("right"),u=O.length===0?"bottom":O.join("-")}const v=r.add(m[u]).round();x.setTransform(this._container,`${Wt[u]} translate(${v.x}px,${v.y}px)`),lr(this._container,u,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(xi);_&&_.focus()}_onClose(){this.remove()}},Marker:ia,Style:di,LngLat:i.LngLat,LngLatBounds:i.LngLatBounds,Point:i.pointGeometry,MercatorCoordinate:i.MercatorCoordinate,Evented:i.Evented,AJAXError:i.AJAXError,config:i.config,CanvasSource:ce,GeoJSONSource:dt,ImageSource:nt,RasterDEMTileSource:pt,RasterTileSource:Y,VectorTileSource:Ne,VideoSource:tt,prewarm:function(){et().acquire(Lr)},clearPrewarmedResources:function(){const _=ct;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Lr),ct=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Fr.workerCount},set workerCount(_){Fr.workerCount=_},get maxParallelImageRequests(){return i.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){i.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){i.clearTileCache(_)},workerUrl:"",addProtocol(_,r){i.config.REGISTERED_PROTOCOLS[_]=r},removeProtocol(_){delete i.config.REGISTERED_PROTOCOLS[_]}};return yn.extend(As,{isSafari:i.isSafari,getPerformanceMetrics:i.PerformanceUtils.getPerformanceMetrics}),As});var f=c;return f})})(Hy);var Nx=Hy.exports;const Fo=fh(Nx);var mn=(s,e,a)=>new Promise((o,c)=>{var h=d=>{try{i(a.next(d))}catch(g){c(g)}},f=d=>{try{i(a.throw(d))}catch(g){c(g)}},i=d=>d.done?o(d.value):Promise.resolve(d.value).then(h,f);i((a=a.apply(s,e)).next())}),Mn=Uint8Array,jo=Uint16Array,Fx=Int32Array,Ky=new Mn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Xy=new Mn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ux=new Mn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Jy=function(s,e){for(var a=new jo(31),o=0;o<31;++o)a[o]=e+=1<<s[o-1];for(var c=new Fx(a[30]),o=1;o<30;++o)for(var h=a[o];h<a[o+1];++h)c[h]=h-a[o]<<5|o;return{b:a,r:c}},Yy=Jy(Ky,2),Qy=Yy.b,Vx=Yy.r;Qy[28]=258,Vx[258]=28;var $x=Jy(Xy,0),jx=$x.b,Wf=new jo(32768);for(Jr=0;Jr<32768;++Jr)Fs=(Jr&43690)>>1|(Jr&21845)<<1,Fs=(Fs&52428)>>2|(Fs&13107)<<2,Fs=(Fs&61680)>>4|(Fs&3855)<<4,Wf[Jr]=((Fs&65280)>>8|(Fs&255)<<8)>>1;var Fs,Jr,ic=function(s,e,a){for(var o=s.length,c=0,h=new jo(e);c<o;++c)s[c]&&++h[s[c]-1];var f=new jo(e);for(c=1;c<e;++c)f[c]=f[c-1]+h[c-1]<<1;var i;if(a){i=new jo(1<<e);var d=15-e;for(c=0;c<o;++c)if(s[c])for(var g=c<<4|s[c],b=e-s[c],k=f[s[c]-1]++<<b,x=k|(1<<b)-1;k<=x;++k)i[Wf[k]>>d]=g}else for(i=new jo(o),c=0;c<o;++c)s[c]&&(i[c]=Wf[f[s[c]-1]++]>>15-s[c]);return i},gc=new Mn(288);for(Jr=0;Jr<144;++Jr)gc[Jr]=8;var Jr;for(Jr=144;Jr<256;++Jr)gc[Jr]=9;var Jr;for(Jr=256;Jr<280;++Jr)gc[Jr]=7;var Jr;for(Jr=280;Jr<288;++Jr)gc[Jr]=8;var Jr,e1=new Mn(32);for(Jr=0;Jr<32;++Jr)e1[Jr]=5;var Jr,qx=ic(gc,9,1),Gx=ic(e1,5,1),Ef=function(s){for(var e=s[0],a=1;a<s.length;++a)s[a]>e&&(e=s[a]);return e},ts=function(s,e,a){var o=e/8|0;return(s[o]|s[o+1]<<8)>>(e&7)&a},Tf=function(s,e){var a=e/8|0;return(s[a]|s[a+1]<<8|s[a+2]<<16)>>(e&7)},Zx=function(s){return(s+7)/8|0},Hx=function(s,e,a){(e==null||e<0)&&(e=0),(a==null||a>s.length)&&(a=s.length);var o=new Mn(a-e);return o.set(s.subarray(e,a)),o},Wx=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Pn=function(s,e,a){var o=new Error(e||Wx[s]);if(o.code=s,Error.captureStackTrace&&Error.captureStackTrace(o,Pn),!a)throw o;return o},Md=function(s,e,a,o){var c=s.length,h=o?o.length:0;if(!c||e.f&&!e.l)return a||new Mn(0);var f=!a||e.i!=2,i=e.i;a||(a=new Mn(c*3));var d=function(Ot){var er=a.length;if(Ot>er){var Lr=new Mn(Math.max(er*2,Ot));Lr.set(a),a=Lr}},g=e.f||0,b=e.p||0,k=e.b||0,x=e.l,S=e.d,E=e.m,T=e.n,A=c*8;do{if(!x){g=ts(s,b,1);var z=ts(s,b+1,3);if(b+=3,z)if(z==1)x=qx,S=Gx,E=9,T=5;else if(z==2){var q=ts(s,b,31)+257,J=ts(s,b+10,15)+4,G=q+ts(s,b+5,31)+1;b+=14;for(var oe=new Mn(G),de=new Mn(19),Ee=0;Ee<J;++Ee)de[Ux[Ee]]=ts(s,b+Ee*3,7);b+=J*3;for(var ot=Ef(de),le=(1<<ot)-1,Ne=ic(de,ot,1),Ee=0;Ee<G;){var Y=Ne[ts(s,b,le)];b+=Y&15;var D=Y>>4;if(D<16)oe[Ee++]=D;else{var Qe=0,pt=0;for(D==16?(pt=3+ts(s,b,3),b+=2,Qe=oe[Ee-1]):D==17?(pt=3+ts(s,b,7),b+=3):D==18&&(pt=11+ts(s,b,127),b+=7);pt--;)oe[Ee++]=Qe}}var dt=oe.subarray(0,q),Zt=oe.subarray(q);E=Ef(dt),T=Ef(Zt),x=ic(dt,E,1),S=ic(Zt,T,1)}else Pn(1);else{var D=Zx(b)+4,F=s[D-4]|s[D-3]<<8,$=D+F;if($>c){i&&Pn(0);break}f&&d(k+F),a.set(s.subarray(D,$),k),e.b=k+=F,e.p=b=$*8,e.f=g;continue}if(b>A){i&&Pn(0);break}}f&&d(k+131072);for(var nt=(1<<E)-1,tt=(1<<T)-1,ce=b;;ce=b){var Qe=x[Tf(s,b)&nt],_e=Qe>>4;if(b+=Qe&15,b>A){i&&Pn(0);break}if(Qe||Pn(2),_e<256)a[k++]=_e;else if(_e==256){ce=b,x=null;break}else{var ze=_e-254;if(_e>264){var Ee=_e-257,re=Ky[Ee];ze=ts(s,b,(1<<re)-1)+Qy[Ee],b+=re}var ue=S[Tf(s,b)&tt],Xe=ue>>4;ue||Pn(3),b+=ue&15;var Zt=jx[Xe];if(Xe>3){var re=Xy[Xe];Zt+=Tf(s,b)&(1<<re)-1,b+=re}if(b>A){i&&Pn(0);break}f&&d(k+131072);var wt=k+ze;if(k<Zt){var mt=h-Zt,Ke=Math.min(Zt,wt);for(mt+k<0&&Pn(3);k<Ke;++k)a[k]=o[mt+k]}for(;k<wt;k+=4)a[k]=a[k-Zt],a[k+1]=a[k+1-Zt],a[k+2]=a[k+2-Zt],a[k+3]=a[k+3-Zt];k=wt}}e.l=x,e.p=ce,e.b=k,e.f=g,x&&(g=1,e.m=E,e.d=S,e.n=T)}while(!g);return k==a.length?a:Hx(a,0,k)},Kx=new Mn(0),Xx=function(s){(s[0]!=31||s[1]!=139||s[2]!=8)&&Pn(6,"invalid gzip data");var e=s[3],a=10;e&4&&(a+=(s[10]|s[11]<<8)+2);for(var o=(e>>3&1)+(e>>4&1);o>0;o-=!s[a++]);return a+(e&2)},Jx=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},Yx=function(s,e){return((s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31)&&Pn(6,"invalid zlib data"),(s[1]>>5&1)==+!e&&Pn(6,"invalid zlib data: "+(s[1]&32?"need":"unexpected")+" dictionary"),(s[1]>>3&4)+2};function Qx(s,e){return Md(s,{i:2},e&&e.out,e&&e.dictionary)}function e2(s,e){var a=Xx(s);return a+8>s.length&&Pn(6,"invalid gzip data"),Md(s.subarray(a,-8),{i:2},e&&e.out||new Mn(Jx(s)),e&&e.dictionary)}function t2(s,e){return Md(s.subarray(Yx(s,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Kf(s,e){return s[0]==31&&s[1]==139&&s[2]==8?e2(s,e):(s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?Qx(s,e):t2(s,e)}var r2=typeof TextDecoder<"u"&&new TextDecoder,i2=0;try{r2.decode(Kx,{stream:!0}),i2=1}catch{}var t1=(s,e)=>s*Math.pow(2,e),Wl=(s,e)=>Math.floor(s/Math.pow(2,e)),eh=(s,e)=>t1(s.getUint16(e+1,!0),8)+s.getUint8(e),r1=(s,e)=>t1(s.getUint32(e+2,!0),16)+s.getUint16(e,!0),n2=(s,e,a,o,c)=>{if(s!=o.getUint8(c))return s-o.getUint8(c);const h=eh(o,c+1);if(e!=h)return e-h;const f=eh(o,c+4);return a!=f?a-f:0},s2=(s,e,a,o)=>{const c=i1(s,e|128,a,o);return c?{z:e,x:a,y:o,offset:c[0],length:c[1],is_dir:!0}:null},t_=(s,e,a,o)=>{const c=i1(s,e,a,o);return c?{z:e,x:a,y:o,offset:c[0],length:c[1],is_dir:!1}:null},i1=(s,e,a,o)=>{let c=0,h=s.byteLength/17-1;for(;c<=h;){const f=h+c>>1,i=n2(e,a,o,s,f*17);if(i>0)c=f+1;else if(i<0)h=f-1;else return[r1(s,f*17+7),s.getUint32(f*17+13,!0)]}return null},a2=(s,e)=>s.is_dir&&!e.is_dir?1:!s.is_dir&&e.is_dir?-1:s.z!==e.z?s.z-e.z:s.x!==e.x?s.x-e.x:s.y-e.y,n1=(s,e)=>{const a=s.getUint8(e*17);return{z:a&127,x:eh(s,e*17+1),y:eh(s,e*17+4),offset:r1(s,e*17+7),length:s.getUint32(e*17+13,!0),is_dir:a>>7===1}},r_=s=>{const e=[],a=new DataView(s);for(let o=0;o<a.byteLength/17;o++)e.push(n1(a,o));return o2(e)},o2=s=>{s.sort(a2);const e=new ArrayBuffer(17*s.length),a=new Uint8Array(e);for(let o=0;o<s.length;o++){const c=s[o];let h=c.z;c.is_dir&&(h=h|128),a[o*17]=h,a[o*17+1]=c.x&255,a[o*17+2]=c.x>>8&255,a[o*17+3]=c.x>>16&255,a[o*17+4]=c.y&255,a[o*17+5]=c.y>>8&255,a[o*17+6]=c.y>>16&255,a[o*17+7]=c.offset&255,a[o*17+8]=Wl(c.offset,8)&255,a[o*17+9]=Wl(c.offset,16)&255,a[o*17+10]=Wl(c.offset,24)&255,a[o*17+11]=Wl(c.offset,32)&255,a[o*17+12]=Wl(c.offset,48)&255,a[o*17+13]=c.length&255,a[o*17+14]=c.length>>8&255,a[o*17+15]=c.length>>16&255,a[o*17+16]=c.length>>24&255}return e},l2=(s,e)=>{if(s.byteLength<17)return null;const a=s.byteLength/17,o=n1(s,a-1);if(o.is_dir){const c=o.z,h=e.z-c,f=Math.trunc(e.x/(1<<h)),i=Math.trunc(e.y/(1<<h));return{z:c,x:f,y:i}}return null};function c2(s){return mn(this,null,function*(){const e=yield s.getBytes(0,512e3),a=new DataView(e.data),o=a.getUint32(4,!0),c=a.getUint16(8,!0),h=new TextDecoder("utf-8"),f=JSON.parse(h.decode(new DataView(e.data,10,o)));let i=0;f.compression==="gzip"&&(i=2);let d=0;"minzoom"in f&&(d=+f.minzoom);let g=0;"maxzoom"in f&&(g=+f.maxzoom);let b=0,k=0,x=0,S=-180,E=-85,T=180,A=85;if(f.bounds){const D=f.bounds.split(",");S=+D[0],E=+D[1],T=+D[2],A=+D[3]}if(f.center){const D=f.center.split(",");b=+D[0],k=+D[1],x=+D[2]}return{specVersion:a.getUint16(2,!0),rootDirectoryOffset:10+o,rootDirectoryLength:c*17,jsonMetadataOffset:10,jsonMetadataLength:o,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:i,tileType:1,minZoom:d,maxZoom:g,minLon:S,minLat:E,maxLon:T,maxLat:A,centerZoom:x,centerLon:b,centerLat:k,etag:e.etag}})}function u2(s,e,a,o,c,h,f){return mn(this,null,function*(){let i=yield a.getArrayBuffer(e,s.rootDirectoryOffset,s.rootDirectoryLength,s);s.specVersion===1&&(i=r_(i));const d=t_(new DataView(i),o,c,h);if(d){let k=(yield e.getBytes(d.offset,d.length,f)).data;const x=new DataView(k);return x.getUint8(0)==31&&x.getUint8(1)==139&&(k=Kf(new Uint8Array(k))),{data:k}}const g=l2(new DataView(i),{z:o,x:c,y:h});if(g){const b=s2(new DataView(i),g.z,g.x,g.y);if(b){let k=yield a.getArrayBuffer(e,b.offset,b.length,s);s.specVersion===1&&(k=r_(k));const x=t_(new DataView(k),o,c,h);if(x){let E=(yield e.getBytes(x.offset,x.length,f)).data;const T=new DataView(E);return T.getUint8(0)==31&&T.getUint8(1)==139&&(E=Kf(new Uint8Array(E))),{data:E}}}}})}var s1={getHeader:c2,getZxy:u2},h2=class{constructor(){this.tile=(s,e)=>{if(s.type=="json"){const a=s.url.substr(10);let o=this.tiles.get(a);return o||(o=new i_(a),this.tiles.set(a,o)),o.getHeader().then(c=>{const h={tiles:[s.url+"/{z}/{x}/{y}"],minzoom:c.minZoom,maxzoom:c.maxZoom,bounds:[c.minLon,c.minLat,c.maxLon,c.maxLat]};e(null,h,null,null)}).catch(c=>{e(c,null,null,null)}),{cancel:()=>{}}}else{const a=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),o=s.url.match(a);if(!o)throw new Error("Invalid PMTiles protocol URL");const c=o[1];let h=this.tiles.get(c);h||(h=new i_(c),this.tiles.set(c,h));const f=o[2],i=o[3],d=o[4],g=new AbortController,b=g.signal;let k=()=>{g.abort()};return h.getHeader().then(x=>{h.getZxy(+f,+i,+d,b).then(S=>{S?e(null,new Uint8Array(S.data),S.cacheControl,S.expires):x.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(S=>{S.name!=="AbortError"&&e(S,null,null,null)})}),{cancel:k}}},this.tiles=new Map}add(s){this.tiles.set(s.source.getKey(),s)}get(s){return this.tiles.get(s)}};function Oo(s,e){return(e>>>0)*4294967296+(s>>>0)}function f2(s,e){const a=e.buf;let o,c;if(c=a[e.pos++],o=(c&112)>>4,c<128||(c=a[e.pos++],o|=(c&127)<<3,c<128)||(c=a[e.pos++],o|=(c&127)<<10,c<128)||(c=a[e.pos++],o|=(c&127)<<17,c<128)||(c=a[e.pos++],o|=(c&127)<<24,c<128)||(c=a[e.pos++],o|=(c&1)<<31,c<128))return Oo(s,o);throw new Error("Expected varint not more than 10 bytes")}function Kl(s){const e=s.buf;let a,o;return o=e[s.pos++],a=o&127,o<128||(o=e[s.pos++],a|=(o&127)<<7,o<128)||(o=e[s.pos++],a|=(o&127)<<14,o<128)||(o=e[s.pos++],a|=(o&127)<<21,o<128)?a:(o=e[s.pos],a|=(o&15)<<28,f2(a,s))}function d2(s,e,a,o){if(o==0){a==1&&(e[0]=s-1-e[0],e[1]=s-1-e[1]);const c=e[0];e[0]=e[1],e[1]=c}}var p2=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function m2(s,e,a){if(s>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,s)-1||a>Math.pow(2,s)-1)throw Error("tile x/y outside zoom level bounds");const o=p2[s],c=Math.pow(2,s);let h=0,f=0,i=0;const d=[e,a];let g=c/2;for(;g>0;)h=(d[0]&g)>0?1:0,f=(d[1]&g)>0?1:0,i+=g*g*(3*h^f),d2(g,d,h,f),g=g/2;return o+i}function a1(s,e){return mn(this,null,function*(){if(e===1||e===0)return s;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Kf(new Uint8Array(s));{let o=new Response(s).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(o).arrayBuffer()}}else throw Error("Compression method not supported")})}var g2=127;function _2(s,e){let a=0,o=s.length-1;for(;a<=o;){const c=o+a>>1,h=e-s[c].tileId;if(h>0)a=c+1;else if(h<0)o=c-1;else return s[c]}return o>=0&&(s[o].runLength===0||e-s[o].tileId<s[o].runLength)?s[o]:null}var y2=class{constructor(s){this.url=s}getKey(){return this.url}getBytes(s,e,a){return mn(this,null,function*(){let o;a||(o=new AbortController,a=o.signal);let c=yield fetch(this.url,{signal:a,headers:{Range:"bytes="+s+"-"+(s+e-1)}});if(c.status===416&&s===0){const i=c.headers.get("Content-Range");if(!i||!i.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const d=+i.substr(8);c=yield fetch(this.url,{signal:a,headers:{Range:"bytes=0-"+(d-1)}})}if(c.status>=300)throw Error("Bad response code: "+c.status);const h=c.headers.get("Content-Length");if(c.status===200&&(!h||+h>e))throw o&&o.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:c.headers.get("ETag")||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};function rs(s,e){const a=s.getUint32(e+4,!0),o=s.getUint32(e+0,!0);return a*Math.pow(2,32)+o}function v2(s,e){const a=new DataView(s),o=a.getUint8(7);if(o>3)throw Error(`Archive is spec version ${o} but this library supports up to spec version 3`);return{specVersion:o,rootDirectoryOffset:rs(a,8),rootDirectoryLength:rs(a,16),jsonMetadataOffset:rs(a,24),jsonMetadataLength:rs(a,32),leafDirectoryOffset:rs(a,40),leafDirectoryLength:rs(a,48),tileDataOffset:rs(a,56),tileDataLength:rs(a,64),numAddressedTiles:rs(a,72),numTileEntries:rs(a,80),numTileContents:rs(a,88),clustered:a.getUint8(96)===1,internalCompression:a.getUint8(97),tileCompression:a.getUint8(98),tileType:a.getUint8(99),minZoom:a.getUint8(100),maxZoom:a.getUint8(101),minLon:a.getInt32(102,!0)/1e7,minLat:a.getInt32(106,!0)/1e7,maxLon:a.getInt32(110,!0)/1e7,maxLat:a.getInt32(114,!0)/1e7,centerZoom:a.getUint8(118),centerLon:a.getInt32(119,!0)/1e7,centerLat:a.getInt32(123,!0)/1e7,etag:e}}function o1(s){const e={buf:new Uint8Array(s),pos:0},a=Kl(e),o=[];let c=0;for(let h=0;h<a;h++){const f=Kl(e);o.push({tileId:c+f,offset:0,length:0,runLength:1}),c+=f}for(let h=0;h<a;h++)o[h].runLength=Kl(e);for(let h=0;h<a;h++)o[h].length=Kl(e);for(let h=0;h<a;h++){const f=Kl(e);f===0&&h>0?o[h].offset=o[h-1].offset+o[h-1].length:o[h].offset=f-1}return o}function b2(s){const e=new DataView(s);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var qo=class extends Error{};function x2(s,e,a,o){return mn(this,null,function*(){const c=yield s.getBytes(0,16384);if(new DataView(c.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(b2(c.data)<3)return[yield s1.getHeader(s)];const f=c.data.slice(0,g2);let i=c.etag;o&&c.etag!=o&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+s.getKey()),i=void 0);const d=v2(f,i);if(a){const g=c.data.slice(d.rootDirectoryOffset,d.rootDirectoryOffset+d.rootDirectoryLength),b=s.getKey()+"|"+(d.etag||"")+"|"+d.rootDirectoryOffset+"|"+d.rootDirectoryLength,k=o1(yield e(g,d.internalCompression));return[d,[b,k.length,k]]}return[d,void 0]})}function w2(s,e,a,o,c){return mn(this,null,function*(){const h=yield s.getBytes(a,o);if(c.etag&&c.etag!==h.etag)throw new qo(h.etag);const f=yield e(h.data,c.internalCompression),i=o1(f);if(i.length===0)throw new Error("Empty directory is invalid");return i})}var S2=class{constructor(s=100,e=!0,a=a1){this.cache=new Map,this.maxCacheEntries=s,this.counter=1,this.prefetch=e,this.decompress=a}getHeader(s,e){return mn(this,null,function*(){const a=s.getKey();if(this.cache.has(a))return this.cache.get(a).lastUsed=this.counter++,yield this.cache.get(a).data;const o=new Promise((c,h)=>{x2(s,this.decompress,this.prefetch,e).then(f=>{f[1]&&this.cache.set(f[1][0],{lastUsed:this.counter++,data:Promise.resolve(f[1][2])}),c(f[0]),this.prune()}).catch(f=>{h(f)})});return this.cache.set(a,{lastUsed:this.counter++,data:o}),o})}getDirectory(s,e,a,o){return mn(this,null,function*(){const c=s.getKey()+"|"+(o.etag||"")+"|"+e+"|"+a;if(this.cache.has(c))return this.cache.get(c).lastUsed=this.counter++,yield this.cache.get(c).data;const h=new Promise((f,i)=>{w2(s,this.decompress,e,a,o).then(d=>{f(d),this.prune()}).catch(d=>{i(d)})});return this.cache.set(c,{lastUsed:this.counter++,data:h}),h})}getArrayBuffer(s,e,a,o){return mn(this,null,function*(){const c=s.getKey()+"|"+(o.etag||"")+"|"+e+"|"+a;if(this.cache.has(c))return this.cache.get(c).lastUsed=this.counter++,yield this.cache.get(c).data;const h=new Promise((f,i)=>{s.getBytes(e,a).then(d=>{if(o.etag&&o.etag!==d.etag)throw new qo(d.etag);f(d.data),this.cache.has(c),this.prune()}).catch(d=>{i(d)})});return this.cache.set(c,{lastUsed:this.counter++,data:h}),h})}prune(){if(this.cache.size>=this.maxCacheEntries){let s=1/0,e;this.cache.forEach((a,o)=>{a.lastUsed<s&&(s=a.lastUsed,e=o)}),e&&this.cache.delete(e)}}invalidate(s,e){return mn(this,null,function*(){this.cache.delete(s.getKey()),yield this.getHeader(s,e)})}},i_=class{constructor(s,e,a){typeof s=="string"?this.source=new y2(s):this.source=s,a?this.decompress=a:this.decompress=a1,e?this.cache=e:this.cache=new S2}getHeader(){return mn(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(s,e,a,o){return mn(this,null,function*(){const c=m2(s,e,a),h=yield this.cache.getHeader(this.source);if(h.specVersion<3)return s1.getZxy(h,this.source,this.cache,s,e,a,o);if(s<h.minZoom||s>h.maxZoom)return;let f=h.rootDirectoryOffset,i=h.rootDirectoryLength;for(let d=0;d<=3;d++){const g=yield this.cache.getDirectory(this.source,f,i,h),b=_2(g,c);if(b)if(b.runLength>0){const k=yield this.source.getBytes(h.tileDataOffset+b.offset,b.length,o);if(h.etag&&h.etag!==k.etag)throw new qo(k.etag);return{data:yield this.decompress(k.data,h.tileCompression),cacheControl:k.cacheControl,expires:k.expires}}else f=h.leafDirectoryOffset+b.offset,i=b.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(s,e,a,o){return mn(this,null,function*(){try{return yield this.getZxyAttempt(s,e,a,o)}catch(c){if(c instanceof qo)return this.cache.invalidate(this.source,c.message),yield this.getZxyAttempt(s,e,a,o);throw c}})}getMetadataAttempt(){return mn(this,null,function*(){const s=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(s.jsonMetadataOffset,s.jsonMetadataLength);if(s.etag&&s.etag!==e.etag)throw new qo(e.etag);const a=yield this.decompress(e.data,s.internalCompression),o=new TextDecoder("utf-8");return JSON.parse(o.decode(a))})}getMetadata(){return mn(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(s){if(s instanceof qo)return this.cache.invalidate(this.source,s.message),yield this.getMetadataAttempt();throw s}})}};const{document:n_}=$y;function s_(s){let e;const a=s[20].default,o=Bi(a,s,s[19],null);return{c(){o&&o.c()},l(c){o&&o.l(c)},m(c,h){o&&o.m(c,h),e=!0},p(c,h){o&&o.p&&(!e||h&524288)&&Ni(o,a,c,c[19],e?Ui(a,c[19],h,null):Fi(c[19]),null)},i(c){e||(Ge(o,c),e=!0)},o(c){it(o,c),e=!1},d(c){o&&o.d(c)}}}function k2(s){let e,a,o,c,h,f=s[3]&&s_(s);return{c(){e=Ve("link"),o=St(),c=Ve("div"),f&&f.c(),this.h()},l(i){const d=Vy("svelte-19mu9pj",n_.head);e=$e(d,"LINK",{rel:!0,href:!0}),d.forEach(ie),o=kt(i),c=$e(i,"DIV",{id:!0,class:!0});var g=Ze(c);f&&f.l(g),g.forEach(ie),this.h()},h(){ve(e,"rel","stylesheet"),ve(e,"href",a=s[1]?s[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"),ve(c,"id",s[0]),ve(c,"class","map svelte-1tna482")},m(i,d){Me(n_.head,e),Oe(i,o,d),Oe(i,c,d),f&&f.m(c,null),s[21](c),h=!0},p(i,[d]){(!h||d&2&&a!==(a=i[1]?i[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"))&&ve(e,"href",a),i[3]?f?(f.p(i,d),d&8&&Ge(f,1)):(f=s_(i),f.c(),Ge(f,1),f.m(c,null)):f&&(Vr(),it(f,1,1,()=>{f=null}),$r()),(!h||d&1)&&ve(c,"id",i[0])},i(i){h||(Ge(f),h=!0)},o(i){it(f),h=!1},d(i){ie(e),i&&ie(o),i&&ie(c),f&&f.d(),s[21](null)}}}function E2(s=1e3){return new Promise(e=>setTimeout(e,s))}function T2(s,e,a){let{$$slots:o={},$$scope:c}=e;const h=Cd();let{map:f}=e,{id:i="map"}=e,{location:d={lng:15,lat:45,zoom:1}}=e,{style:g={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=e,{css:b=null}=e,{pmtiles:k=!1}=e,{options:x={}}=e,{minzoom:S=0}=e,{maxzoom:E=14}=e,{controls:T=!1}=e,{tabbable:A=!1}=e,{zoom:z=null}=e,{center:D=null}=e,{pitch:F=null}=e,{bearing:$=null}=e,{interactive:q=!0}=e,{attribution:J=!0}=e,G,oe={},de=!1;eo("map",{getMap:()=>f}),d.bounds?oe.bounds=d.bounds:d.lng&&d.lat&&(oe.center=[+d.lng,+d.lat],d.zoom&&(oe.zoom=+d.zoom),d.pitch&&(oe.pitch=+d.pitch),d.bearing&&(oe.bearing=+d.bearing)),J||(oe.attributionControl=!1),oe={...oe,...x},Id(()=>{if(k){let le=new h2;Fo.addProtocol("pmtiles",le.tile)}a(4,f=new Fo.Map({container:G,style:g,minZoom:S,maxZoom:E,interactive:q,...oe})),T&&!Array.isArray(T)?f.addControl(new Fo.NavigationControl({showCompass:!1})):Array.isArray(T)&&T!=["locate"]&&f.addControl(new Fo.NavigationControl({showCompass:T.includes("compass"),visualizePitch:T.includes("pitch")})),Array.isArray(T)&&T.includes("locate")&&f.addControl(new Fo.GeolocateControl),f.on("load",le=>{a(5,z=f.getZoom()),a(6,D=f.getCenter()),a(7,F=f.getPitch()),a(8,$=f.getBearing()),a(3,de=!0),!A&&document.querySelector(`#${i} canvas`)&&(document.querySelector(`#${i} canvas`).tabIndex="-1"),h("load",{event:le})}),f.on("moveend",()=>{a(5,z=f.getZoom()),a(6,D=f.getCenter()),a(7,F=f.getPitch()),a(8,$=f.getBearing())})}),hh(async()=>{await E2(250),f&&f.remove(),a(4,f=null)});function Ee(le){f&&f.setStyle(le),h("style",{style:le})}function ot(le){pc[le?"unshift":"push"](()=>{G=le,a(2,G)})}return s.$$set=le=>{"map"in le&&a(4,f=le.map),"id"in le&&a(0,i=le.id),"location"in le&&a(9,d=le.location),"style"in le&&a(10,g=le.style),"css"in le&&a(1,b=le.css),"pmtiles"in le&&a(11,k=le.pmtiles),"options"in le&&a(12,x=le.options),"minzoom"in le&&a(13,S=le.minzoom),"maxzoom"in le&&a(14,E=le.maxzoom),"controls"in le&&a(15,T=le.controls),"tabbable"in le&&a(16,A=le.tabbable),"zoom"in le&&a(5,z=le.zoom),"center"in le&&a(6,D=le.center),"pitch"in le&&a(7,F=le.pitch),"bearing"in le&&a(8,$=le.bearing),"interactive"in le&&a(17,q=le.interactive),"attribution"in le&&a(18,J=le.attribution),"$$scope"in le&&a(19,c=le.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&Ee(g)},[i,b,G,de,f,z,D,F,$,d,g,k,x,S,E,T,A,q,J,c,o,ot]}let C2=class extends Wr{constructor(e){super(),Kr(this,e,T2,k2,jr,{map:4,id:0,location:9,style:10,css:1,pmtiles:11,options:12,minzoom:13,maxzoom:14,controls:15,tabbable:16,zoom:5,center:6,pitch:7,bearing:8,interactive:17,attribution:18})}};function a_(s){let e;const a=s[12].default,o=Bi(a,s,s[11],null);return{c(){o&&o.c()},l(c){o&&o.l(c)},m(c,h){o&&o.m(c,h),e=!0},p(c,h){o&&o.p&&(!e||h&2048)&&Ni(o,a,c,c[11],e?Ui(a,c[11],h,null):Fi(c[11]),null)},i(c){e||(Ge(o,c),e=!0)},o(c){it(o,c),e=!1},d(c){o&&o.d(c)}}}function I2(s){let e,a,o=s[0]&&a_(s);return{c(){o&&o.c(),e=Qt()},l(c){o&&o.l(c),e=Qt()},m(c,h){o&&o.m(c,h),Oe(c,e,h),a=!0},p(c,[h]){c[0]?o?(o.p(c,h),h&1&&Ge(o,1)):(o=a_(c),o.c(),Ge(o,1),o.m(e.parentNode,e)):o&&(Vr(),it(o,1,1,()=>{o=null}),$r())},i(c){a||(Ge(o),a=!0)},o(c){it(o),a=!1},d(c){o&&o.d(c),c&&ie(e)}}}function A2(s=1e3){return new Promise(e=>setTimeout(e,s))}function P2(s,e,a){let{$$slots:o={},$$scope:c}=e,{id:h}=e,{type:f}=e,{url:i=null}=e,{props:d={}}=e,{data:g=null}=e,{layer:b=null}=e,{promoteId:k=null}=e,{minzoom:x=null}=e,{maxzoom:S=null}=e,{tilesize:E=256}=e,T=!1,A=i;const{getMap:z}=to("map"),D=z();eo("source",{source:h,layer:b,promoteId:k}),D.getSource(h)&&D.removeSource(h);async function F(){await A2(100),D.isSourceLoaded(h)?(a(0,T=!0),console.log(h+" map source loaded!")):(console.log("..."),F())}x&&(d.minzoom=x),S&&(d.maxzoom=S),b&&k?(d.promoteId={},d.promoteId[b]=k):k&&(d.promoteId=k);function $(){console.log(h+" map source loading...");let oe;f=="geojson"?g?oe={type:f,data:g,...d}:i&&(oe={type:f,data:i,...d}):f=="vector"?(oe={type:f,...d},i.slice(0,7)==="pmtiles"?oe.url=i:oe.tiles=[i]):f=="raster"?oe={type:f,tiles:[i],tileSize:E,...d}:f=="raster-dem"&&(oe={type:f,tiles:[i],tileSize:E,...d}),oe&&(console.log(oe),D.addSource(h,oe),F())}function q(oe){let de=D.getSource(h);de&&de.setData(oe)}function J(oe){if(oe!==A){let de=D.getSource(h);de&&(oe.slice(0,7)==="pmtiles"?de.setUrl(oe):de.setTiles([oe])),A=oe}}function G(oe){oe!==A&&(D.getSource(h).tiles=[oe],D.style.sourceCaches[h].clearTiles(),D.style.sourceCaches[h].update(D.transform),D.triggerRepaint(),A=oe)}return Id($),hh(async()=>{D&&D.getSource(h)&&(D.getStyle().layers.filter(de=>de.source==h).forEach(de=>{D.removeLayer(de.id)}),D.removeSource(h))}),s.$$set=oe=>{"id"in oe&&a(2,h=oe.id),"type"in oe&&a(3,f=oe.type),"url"in oe&&a(4,i=oe.url),"props"in oe&&a(1,d=oe.props),"data"in oe&&a(5,g=oe.data),"layer"in oe&&a(6,b=oe.layer),"promoteId"in oe&&a(7,k=oe.promoteId),"minzoom"in oe&&a(8,x=oe.minzoom),"maxzoom"in oe&&a(9,S=oe.maxzoom),"tilesize"in oe&&a(10,E=oe.tilesize),"$$scope"in oe&&a(11,c=oe.$$scope)},s.$$.update=()=>{s.$$.dirty&41&&f=="geojson"&&T&&q(g),s.$$.dirty&25&&f=="vector"&&T&&J(i),s.$$.dirty&25&&f=="raster"&&T&&G(i)},[T,d,h,f,i,g,b,k,x,S,E,c,o]}class M2 extends Wr{constructor(e){super(),Kr(this,e,P2,I2,jr,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const z2=s=>({hovered:s[0]&1}),o_=s=>({hovered:s[0]});function D2(s){let e;const a=s[30].default,o=Bi(a,s,s[29],o_);return{c(){o&&o.c()},l(c){o&&o.l(c)},m(c,h){o&&o.m(c,h),e=!0},p(c,h){o&&o.p&&(!e||h[0]&536870913)&&Ni(o,a,c,c[29],e?Ui(a,c[29],h,z2):Fi(c[29]),o_)},i(c){e||(Ge(o,c),e=!0)},o(c){it(o,c),e=!1},d(c){o&&o.d(c)}}}function L2(s,e,a){let o,{$$slots:c={},$$scope:h}=e;const f=Cd();let{id:i}=e,{type:d}=e,{filter:g=null}=e,{layout:b={}}=e,{paint:k={}}=e,{data:x=null}=e,{colorKey:S="color"}=e,{nameKey:E=null}=e,{valueKey:T=null}=e,{idKey:A=null}=e,{select:z=!1}=e,{clickIgnore:D=!1}=e,{clickCenter:F=!1}=e,{selected:$=null}=e,{hover:q=!1}=e,{hovered:J=null}=e,{highlight:G=!1}=e,{highlightKey:oe="highlighted"}=e,{highlighted:de=[]}=e,{order:Ee=null}=e,{maxzoom:ot=null}=e,{minzoom:le=null}=e,{sourceLayer:Ne=null}=e,{visible:Y=!0}=e;const{source:Qe,layer:pt,promoteId:dt}=to("source"),{getMap:Zt}=to("map"),nt=Zt();eo("layer",{layer:i});const tt=jy({id:null,feature:null,event:null});lh(s,tt,Ke=>a(32,o=Ke)),eo("hover",tt),A=A||dt,Ne=Ne||pt;let ce=null,_e=null,ze=[];b.visibility=Y?"visible":"none";let re={id:i,type:d,source:Qe,paint:k,layout:b};g&&(re.filter=g),Ne&&(re["source-layer"]=Ne),ot&&(re.maxzoom=ot),le&&(re.minzoom=le),Id(()=>{nt.getLayer(i)&&nt.removeLayer(i),nt.addLayer(re,Ee)});function ue(Ke,Ot=S){if(console.log("updating colors..."),E||T)for(const er of Ke)nt.setFeatureState({source:Qe,sourceLayer:Ne,id:er[A]},{color:Ot?er[Ot]:null,name:E?er[E]:null,value:T?er[T]:null});else for(const er of Ke)nt.setFeatureState({source:Qe,sourceLayer:Ne,id:er[A]},{color:er[Ot]})}function Xe(Ke){nt.getLayer(i)&&nt.setFilter(i,Ke)}function wt(Ke){if(nt.getLayer(i))for(const Ot in Ke)nt.setPaintProperty(i,Ot,Ke[Ot])}function mt(Ke){nt.getLayer(i)&&nt.setLayoutProperty(i,"visibility",Ke?"visible":"none")}return z&&nt.on("click",i,Ke=>{if(Ke.features.length>0&&!D){let Ot=Ke.features[0];if(a(2,$=Ot.id),f("select",{id:$,feature:Ot,event:Ke}),ce&&nt.setFeatureState({source:Qe,sourceLayer:Ne,id:ce},{selected:!1}),nt.setFeatureState({source:Qe,sourceLayer:Ne,id:$},{selected:!0}),F){let er=centroid(Ke.features[0].toJSON().geometry);nt.flyTo({center:er.geometry.coordinates})}a(26,ce=$)}}),q&&(nt.on("mousemove",i,Ke=>{if(Ke.features.length>0){J&&nt.setFeatureState({source:Qe,sourceLayer:Ne,id:J},{hovered:!1});let Ot=Ke.features[0];a(0,J=a(27,_e=Ot.id)),tt.set({id:J,feature:Ot,event:Ke}),f("hover",o),nt.setFeatureState({source:Qe,sourceLayer:Ne,id:J},{hovered:!0}),nt.getCanvas().style.cursor="pointer"}}),nt.on("mouseleave",i,Ke=>{J&&nt.setFeatureState({source:Qe,sourceLayer:Ne,id:J},{hovered:!1}),a(0,J=a(27,_e=null)),tt.set({id:null,feature:null,event:Ke}),f("hover",o),nt.getCanvas().style.cursor=""})),hh(async()=>{nt&&nt.getLayer(i)&&nt.removeLayer(i)}),s.$$set=Ke=>{"id"in Ke&&a(6,i=Ke.id),"type"in Ke&&a(7,d=Ke.type),"filter"in Ke&&a(8,g=Ke.filter),"layout"in Ke&&a(4,b=Ke.layout),"paint"in Ke&&a(9,k=Ke.paint),"data"in Ke&&a(10,x=Ke.data),"colorKey"in Ke&&a(11,S=Ke.colorKey),"nameKey"in Ke&&a(12,E=Ke.nameKey),"valueKey"in Ke&&a(13,T=Ke.valueKey),"idKey"in Ke&&a(5,A=Ke.idKey),"select"in Ke&&a(14,z=Ke.select),"clickIgnore"in Ke&&a(15,D=Ke.clickIgnore),"clickCenter"in Ke&&a(16,F=Ke.clickCenter),"selected"in Ke&&a(2,$=Ke.selected),"hover"in Ke&&a(17,q=Ke.hover),"hovered"in Ke&&a(0,J=Ke.hovered),"highlight"in Ke&&a(18,G=Ke.highlight),"highlightKey"in Ke&&a(19,oe=Ke.highlightKey),"highlighted"in Ke&&a(20,de=Ke.highlighted),"order"in Ke&&a(21,Ee=Ke.order),"maxzoom"in Ke&&a(22,ot=Ke.maxzoom),"minzoom"in Ke&&a(23,le=Ke.minzoom),"sourceLayer"in Ke&&a(3,Ne=Ke.sourceLayer),"visible"in Ke&&a(24,Y=Ke.visible),"$$scope"in Ke&&a(29,h=Ke.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&3072&&x&&ue(x,S),s.$$.dirty[0]&256&&Xe(g),s.$$.dirty[0]&512&&wt(k),s.$$.dirty[0]&16777216&&mt(Y),s.$$.dirty[0]&270270472&&G&&de!=ze){if(ze[0])for(const Ke of ze){let Ot={};Ot[oe]=!1,nt.setFeatureState({source:Qe,sourceLayer:Ne,id:Ke},Ot)}if(a(28,ze=de),de[0])for(const Ke of de){let Ot={};Ot[oe]=!0,nt.setFeatureState({source:Qe,sourceLayer:Ne,id:Ke},Ot)}}s.$$.dirty[0]&67125260&&z&&$!=ce&&(ce&&nt.setFeatureState({source:Qe,sourceLayer:Ne,id:ce},{selected:!1}),$&&nt.setFeatureState({source:Qe,sourceLayer:Ne,id:$},{selected:!0}),a(26,ce=$)),s.$$.dirty[0]&134348809&&q&&J!=_e&&(_e&&nt.setFeatureState({source:Qe,sourceLayer:Ne,id:_e},{hovered:!1}),J&&nt.setFeatureState({source:Qe,sourceLayer:Ne,id:J},{hovered:!0}),a(27,_e=J))},[J,tt,$,Ne,b,A,i,d,g,k,x,S,E,T,z,D,F,q,G,oe,de,Ee,ot,le,Y,ue,ce,_e,ze,h,c]}class Cf extends Wr{constructor(e){super(),Kr(this,e,L2,D2,jr,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function R2(s,e,a){let o,{content:c}=e;const h=new Fo.Popup({closeButton:!1,closeOnClick:!1}),{getMap:f}=to("map"),i=f(),d=to("hover");lh(s,d,b=>a(2,o=b));function g(b,k){b.id?h.setLngLat(b.event.lngLat).setHTML(k||b.code).addTo(i):h.remove()}return hh(()=>h.remove()),s.$$set=b=>{"content"in b&&a(1,c=b.content)},s.$$.update=()=>{s.$$.dirty&6&&g(o,c)},[d,c,o]}class O2 extends Wr{constructor(e){super(),Kr(this,e,R2,null,jr,{content:1})}}function l_(s,e,a){const o=s.slice();return o[9]=e[a],o[11]=a,o}function c_(s){let e,a,o,c,h,f=s[4](s[2][s[11]])+"",i;return{c(){e=Ve("div"),a=St(),o=Ve("div"),c=St(),h=Ve("div"),i=Mt(f),this.h()},l(d){e=$e(d,"DIV",{class:!0,style:!0}),Ze(e).forEach(ie),a=kt(d),o=$e(d,"DIV",{class:!0,style:!0}),Ze(o).forEach(ie),c=kt(d),h=$e(d,"DIV",{class:!0,style:!0});var g=Ze(h);i=zt(g,f),g.forEach(ie),this.h()},h(){ve(e,"class","block svelte-xjas6d"),Ct(e,"width",100/(s[2].length-1)+"%"),Ct(e,"left",s[11]*(100/(s[2].length-1))+"%"),Ct(e,"background-color",s[3][s[11]]),ve(o,"class","line svelte-xjas6d"),Ct(o,"left",s[11]*(100/(s[2].length-1))+"%"),ve(h,"class","tick svelte-xjas6d"),Ct(h,"left",s[11]*(100/(s[2].length-1))+"%"),Kt(h,"tick-start",s[11]==0)},m(d,g){Oe(d,e,g),Oe(d,a,g),Oe(d,o,g),Oe(d,c,g),Oe(d,h,g),Me(h,i)},p(d,g){g&4&&Ct(e,"width",100/(d[2].length-1)+"%"),g&4&&Ct(e,"left",d[11]*(100/(d[2].length-1))+"%"),g&8&&Ct(e,"background-color",d[3][d[11]]),g&4&&Ct(o,"left",d[11]*(100/(d[2].length-1))+"%"),g&20&&f!==(f=d[4](d[2][d[11]])+"")&&Cr(i,f),g&4&&Ct(h,"left",d[11]*(100/(d[2].length-1))+"%")},d(d){d&&ie(e),d&&ie(a),d&&ie(o),d&&ie(c),d&&ie(h)}}}function u_(s){let e,a=`${s[7](s[0],s[2])}%`,o,c,h=s[5](s[0])+"",f,i;return{c(){e=Ve("div"),o=St(),c=Ve("div"),f=Mt(h),i=Mt(s[6]),this.h()},l(d){e=$e(d,"DIV",{class:!0}),Ze(e).forEach(ie),o=kt(d),c=$e(d,"DIV",{class:!0,style:!0});var g=Ze(c);f=zt(g,h),i=zt(g,s[6]),g.forEach(ie),this.h()},h(){ve(e,"class","marker  svelte-xjas6d"),Ct(e,"left",a),ve(c,"class","value svelte-xjas6d"),Ct(c,"left",s[7](s[0],s[2])+"%")},m(d,g){Oe(d,e,g),Oe(d,o,g),Oe(d,c,g),Me(c,f),Me(c,i)},p(d,g){g&5&&a!==(a=`${d[7](d[0],d[2])}%`)&&Ct(e,"left",a),g&33&&h!==(h=d[5](d[0])+"")&&Cr(f,h),g&64&&Cr(i,d[6]),g&5&&Ct(c,"left",d[7](d[0],d[2])+"%")},d(d){d&&ie(e),d&&ie(o),d&&ie(c)}}}function B2(s){let e,a,o,c,h,f=s[4](s[2][s[2].length-1])+"",i,d,g,b=s[2].slice(1),k=[];for(let S=0;S<b.length;S+=1)k[S]=c_(l_(s,b,S));let x=typeof s[0]=="number"&&u_(s);return{c(){e=Ve("div");for(let S=0;S<k.length;S+=1)k[S].c();a=St(),o=Ve("div"),c=St(),h=Ve("div"),i=Mt(f),d=Mt(s[6]),g=St(),x&&x.c(),this.h()},l(S){e=$e(S,"DIV",{class:!0,style:!0});var E=Ze(e);for(let A=0;A<k.length;A+=1)k[A].l(E);a=kt(E),o=$e(E,"DIV",{class:!0,style:!0}),Ze(o).forEach(ie),c=kt(E),h=$e(E,"DIV",{class:!0,style:!0});var T=Ze(h);i=zt(T,f),d=zt(T,s[6]),T.forEach(ie),g=kt(E),x&&x.l(E),E.forEach(ie),this.h()},h(){ve(o,"class","line svelte-xjas6d"),Ct(o,"left","100%"),ve(h,"class","tick tick-end svelte-xjas6d"),Ct(h,"left","100%"),ve(e,"class","container svelte-xjas6d"),Ct(e,"height",s[1]+"px")},m(S,E){Oe(S,e,E);for(let T=0;T<k.length;T+=1)k[T]&&k[T].m(e,null);Me(e,a),Me(e,o),Me(e,c),Me(e,h),Me(h,i),Me(h,d),Me(e,g),x&&x.m(e,null)},p(S,[E]){if(E&28){b=S[2].slice(1);let T;for(T=0;T<b.length;T+=1){const A=l_(S,b,T);k[T]?k[T].p(A,E):(k[T]=c_(A),k[T].c(),k[T].m(e,a))}for(;T<k.length;T+=1)k[T].d(1);k.length=b.length}E&20&&f!==(f=S[4](S[2][S[2].length-1])+"")&&Cr(i,f),E&64&&Cr(d,S[6]),typeof S[0]=="number"?x?x.p(S,E):(x=u_(S),x.c(),x.m(e,null)):x&&(x.d(1),x=null),E&2&&Ct(e,"height",S[1]+"px")},i:_r,o:_r,d(S){S&&ie(e),Vi(k,S),x&&x.d()}}}function N2(s,e,a){let{hovered:o=null}=e,{lineWidth:c=3}=e,{height:h=15}=e,{breaks:f=[0,20,40,60,80,100]}=e,{colors:i=["rgba(234,236,177,.8)","rgba(169,216,145,.8)","rgba(0,167,186,.8)","rgba(0,78,166,.8)","rgba(0,13,84,.8)"]}=e,{formatTick:d=x=>x.toFixed(1)}=e,{formatVal:g=x=>x.toFixed(1)}=e,{suffix:b="%"}=e;const k=(x,S)=>{let E=0;for(;x>S[E+1];)E+=1;let T=100/(S.length-1),A=(x-S[E])/(S[E+1]-S[E]);return(E+A)*T};return s.$$set=x=>{"hovered"in x&&a(0,o=x.hovered),"lineWidth"in x&&a(8,c=x.lineWidth),"height"in x&&a(1,h=x.height),"breaks"in x&&a(2,f=x.breaks),"colors"in x&&a(3,i=x.colors),"formatTick"in x&&a(4,d=x.formatTick),"formatVal"in x&&a(5,g=x.formatVal),"suffix"in x&&a(6,b=x.suffix)},[o,h,f,i,d,g,b,k,c]}class F2 extends Wr{constructor(e){super(),Kr(this,e,N2,B2,jr,{hovered:0,lineWidth:8,height:1,breaks:2,colors:3,formatTick:4,formatVal:5,suffix:6})}}function h_(s,e,a){const o=s.slice();return o[2]=e[a],o[4]=a,o}function f_(s){let e,a,o,c=s[2].name+"",h,f,i,d=s[2].value.toFixed(1)+"",g,b,k;return{c(){e=Ve("tr"),a=Ve("td"),o=Ve("strong"),h=Mt(c),f=St(),i=Ve("td"),g=Mt(d),b=Mt("%"),k=St(),this.h()},l(x){e=$e(x,"TR",{});var S=Ze(e);a=$e(S,"TD",{class:!0});var E=Ze(a);o=$e(E,"STRONG",{});var T=Ze(o);h=zt(T,c),T.forEach(ie),E.forEach(ie),f=kt(S),i=$e(S,"TD",{class:!0});var A=Ze(i);g=zt(A,d),b=zt(A,"%"),A.forEach(ie),k=kt(S),S.forEach(ie),this.h()},h(){ve(a,"class","svelte-1i52e02"),ve(i,"class","text-right svelte-1i52e02")},m(x,S){Oe(x,e,S),Me(e,a),Me(a,o),Me(o,h),Me(e,f),Me(e,i),Me(i,g),Me(i,b),Me(e,k)},p(x,S){S&1&&c!==(c=x[2].name+"")&&Cr(h,c),S&1&&d!==(d=x[2].value.toFixed(1)+"")&&Cr(g,d)},d(x){x&&ie(e)}}}function U2(s){let e,a,o=s[0],c=[];for(let h=0;h<o.length;h+=1)c[h]=f_(h_(s,o,h));return{c(){e=Ve("table"),a=Ve("tbody");for(let h=0;h<c.length;h+=1)c[h].c();this.h()},l(h){e=$e(h,"TABLE",{class:!0});var f=Ze(e);a=$e(f,"TBODY",{});var i=Ze(a);for(let d=0;d<c.length;d+=1)c[d].l(i);i.forEach(ie),f.forEach(ie),this.h()},h(){ve(e,"class","table-rank text-small svelte-1i52e02")},m(h,f){Oe(h,e,f),Me(e,a);for(let i=0;i<c.length;i+=1)c[i]&&c[i].m(a,null)},p(h,[f]){if(f&1){o=h[0];let i;for(i=0;i<o.length;i+=1){const d=h_(h,o,i);c[i]?c[i].p(d,f):(c[i]=f_(d),c[i].c(),c[i].m(a,null))}for(;i<c.length;i+=1)c[i].d(1);c.length=o.length}},i:_r,o:_r,d(h){h&&ie(e),Vi(c,h)}}}function V2(s,e,a){let{data:o}=e,{offset:c=1}=e;return s.$$set=h=>{"data"in h&&a(0,o=h.data),"offset"in h&&a(1,c=h.offset)},[o,c]}class l1 extends Wr{constructor(e){super(),Kr(this,e,V2,U2,jr,{data:0,offset:1})}}function $2(s){let e,a,o,c,h;return{c(){e=Ve("div"),a=Ve("div"),o=St(),c=Ve("div"),h=Mt("No data"),this.h()},l(f){e=$e(f,"DIV",{class:!0,style:!0});var i=Ze(e);a=$e(i,"DIV",{class:!0,style:!0}),Ze(a).forEach(ie),o=kt(i),c=$e(i,"DIV",{class:!0});var d=Ze(c);h=zt(d,"No data"),d.forEach(ie),i.forEach(ie),this.h()},h(){ve(a,"class","block svelte-1b3ufq7"),Ct(a,"width","100%"),Ct(a,"background-color",s[1]),ve(c,"class","tick svelte-1b3ufq7"),ve(e,"class","container svelte-1b3ufq7"),Ct(e,"height",s[0]+"px")},m(f,i){Oe(f,e,i),Me(e,a),Me(e,o),Me(e,c),Me(c,h)},p(f,[i]){i&2&&Ct(a,"background-color",f[1]),i&1&&Ct(e,"height",f[0]+"px")},i:_r,o:_r,d(f){f&&ie(e)}}}function j2(s,e,a){let{height:o=15}=e,{color:c="lightgrey"}=e;return s.$$set=h=>{"height"in h&&a(0,o=h.height),"color"in h&&a(1,c=h.color)},[o,c]}class q2 extends Wr{constructor(e){super(),Kr(this,e,j2,$2,jr,{height:0,color:1})}}function G2(s){let e,a;return{c(){e=Ve("p"),a=Mt("People with the selected characteristics as a proportion of whole population."),this.h()},l(o){e=$e(o,"P",{class:!0});var c=Ze(e);a=zt(c,"People with the selected characteristics as a proportion of whole population."),c.forEach(ie),this.h()},h(){ve(e,"class","subtitle svelte-xikkwp")},m(o,c){Oe(o,e,c),Me(e,a)},p:_r,d(o){o&&ie(e)}}}function d_(s){let e,a;return e=new M2({props:{id:"lad",type:"geojson",data:s[0].geojson,promoteId:s[2].code,$$slots:{default:[H2]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&1&&(h.data=o[0].geojson),c&4&&(h.promoteId=o[2].code),c&4161&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function Z2(s){let e,a;return e=new O2({props:{content:s[7](s[6])}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&64&&(h.content=o[7](o[6])),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function H2(s){let e,a,o,c,h,f,i;function d(b){s[8](b)}let g={id:"lad-fill",data:s[0].geoPerc,idKey:"code",nameKey:"name",valueKey:"value",hover:!0,tooltip:!0,type:"fill",paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"],"fill-opacity":.8},order:"place_other",$$slots:{default:[Z2]},$$scope:{ctx:s}};return s[6]!==void 0&&(g.hovered=s[6]),e=new Cf({props:g}),pc.push(()=>ch(e,"hovered",d)),c=new Cf({props:{id:"lad-line",type:"line",paint:{"line-color":"white","line-width":.3},order:"place_other"}}),f=new Cf({props:{id:"lad-hover",type:"line",paint:{"line-color":"black","line-width":2,"line-opacity":["case",["==",["feature-state","hovered"],!0],1,0]},order:"place_other"}}),{c(){ir(e.$$.fragment),o=St(),ir(c.$$.fragment),h=St(),ir(f.$$.fragment)},l(b){cr(e.$$.fragment,b),o=kt(b),cr(c.$$.fragment,b),h=kt(b),cr(f.$$.fragment,b)},m(b,k){nr(e,b,k),Oe(b,o,k),nr(c,b,k),Oe(b,h,k),nr(f,b,k),i=!0},p(b,k){const x={};k&1&&(x.data=b[0].geoPerc),k&4160&&(x.$$scope={dirty:k,ctx:b}),!a&&k&64&&(a=!0,x.hovered=b[6],uh(()=>a=!1)),e.$set(x)},i(b){i||(Ge(e.$$.fragment,b),Ge(c.$$.fragment,b),Ge(f.$$.fragment,b),i=!0)},o(b){it(e.$$.fragment,b),it(c.$$.fragment,b),it(f.$$.fragment,b),i=!1},d(b){sr(e,b),b&&ie(o),sr(c,b),b&&ie(h),sr(f,b)}}}function W2(s){let e,a,o=s[0].geojson&&s[0].geoPerc&&d_(s);return{c(){o&&o.c(),e=Qt()},l(c){o&&o.l(c),e=Qt()},m(c,h){o&&o.m(c,h),Oe(c,e,h),a=!0},p(c,h){c[0].geojson&&c[0].geoPerc?o?(o.p(c,h),h&1&&Ge(o,1)):(o=d_(c),o.c(),Ge(o,1),o.m(e.parentNode,e)):o&&(Vr(),it(o,1,1,()=>{o=null}),$r())},i(c){a||(Ge(o),a=!0)},o(c){it(o),a=!1},d(c){o&&o.d(c),c&&ie(e)}}}function p_(s){let e,a,o,c,h,f,i;return o=new F2({props:{breaks:s[0].geoBreaks,hovered:s[6]&&s[0].geoPerc.find(s[9])?s[0].geoPerc.find(s[10]).value:null,colors:s[0].geoBreaks[1]==100?[s[5].seq[4]]:s[5].seq}}),f=new q2({}),{c(){e=Ve("div"),a=Ve("div"),ir(o.$$.fragment),c=St(),h=Ve("div"),ir(f.$$.fragment),this.h()},l(d){e=$e(d,"DIV",{class:!0});var g=Ze(e);a=$e(g,"DIV",{class:!0});var b=Ze(a);cr(o.$$.fragment,b),b.forEach(ie),c=kt(g),h=$e(g,"DIV",{class:!0});var k=Ze(h);cr(f.$$.fragment,k),k.forEach(ie),g.forEach(ie),this.h()},h(){ve(a,"class","map-legend-breaks svelte-xikkwp"),ve(h,"class","map-legend-nodata svelte-xikkwp"),ve(e,"class","map-legend svelte-xikkwp")},m(d,g){Oe(d,e,g),Me(e,a),nr(o,a,null),Me(e,c),Me(e,h),nr(f,h,null),i=!0},p(d,g){const b={};g&1&&(b.breaks=d[0].geoBreaks),g&65&&(b.hovered=d[6]&&d[0].geoPerc.find(d[9])?d[0].geoPerc.find(d[10]).value:null),g&33&&(b.colors=d[0].geoBreaks[1]==100?[d[5].seq[4]]:d[5].seq),o.$set(b)},i(d){i||(Ge(o.$$.fragment,d),Ge(f.$$.fragment,d),i=!0)},o(d){it(o.$$.fragment,d),it(f.$$.fragment,d),i=!1},d(d){d&&ie(e),sr(o),sr(f)}}}function K2(s){let e,a,o,c,h;a=new C2({props:{style:s[1],location:{bounds:s[3]},$$slots:{default:[W2]},$$scope:{ctx:s}}});let f=s[0].geoBreaks&&s[0].geoPerc&&p_(s);return{c(){e=Ve("div"),ir(a.$$.fragment),o=St(),f&&f.c(),c=Qt(),this.h()},l(i){e=$e(i,"DIV",{});var d=Ze(e);cr(a.$$.fragment,d),d.forEach(ie),o=kt(i),f&&f.l(i),c=Qt(),this.h()},h(){Ct(e,"height","450px")},m(i,d){Oe(i,e,d),nr(a,e,null),Oe(i,o,d),f&&f.m(i,d),Oe(i,c,d),h=!0},p(i,d){const g={};d&2&&(g.style=i[1]),d&8&&(g.location={bounds:i[3]}),d&4165&&(g.$$scope={dirty:d,ctx:i}),a.$set(g),i[0].geoBreaks&&i[0].geoPerc?f?(f.p(i,d),d&1&&Ge(f,1)):(f=p_(i),f.c(),Ge(f,1),f.m(c.parentNode,c)):f&&(Vr(),it(f,1,1,()=>{f=null}),$r())},i(i){h||(Ge(a.$$.fragment,i),Ge(f),h=!0)},o(i){it(a.$$.fragment,i),it(f),h=!1},d(i){i&&ie(e),sr(a),i&&ie(o),f&&f.d(i),i&&ie(c)}}}function X2(s){let e,a;return{c(){e=Ve("span"),a=Mt("Make a selection to see rankings."),this.h()},l(o){e=$e(o,"SPAN",{class:!0});var c=Ze(e);a=zt(c,"Make a selection to see rankings."),c.forEach(ie),this.h()},h(){ve(e,"class","muted svelte-xikkwp")},m(o,c){Oe(o,e,c),Me(e,a)},p:_r,i:_r,o:_r,d(o){o&&ie(e)}}}function J2(s){let e,a;return e=new l1({props:{data:[...s[0].geoPerc].filter(m_).sort(g_).slice(0,5)}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&1&&(h.data=[...o[0].geoPerc].filter(m_).sort(g_).slice(0,5)),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function Y2(s){let e,a,o,c;const h=[J2,X2],f=[];function i(d,g){return d[0].geoPerc&&d[4][0]?0:1}return e=i(s),a=f[e]=h[e](s),{c(){a.c(),o=Qt()},l(d){a.l(d),o=Qt()},m(d,g){f[e].m(d,g),Oe(d,o,g),c=!0},p(d,g){let b=e;e=i(d),e===b?f[e].p(d,g):(Vr(),it(f[b],1,1,()=>{f[b]=null}),$r(),a=f[e],a?a.p(d,g):(a=f[e]=h[e](d),a.c()),Ge(a,1),a.m(o.parentNode,o))},i(d){c||(Ge(a),c=!0)},o(d){it(a),c=!1},d(d){f[e].d(d),d&&ie(o)}}}function Q2(s){let e,a;return{c(){e=Ve("span"),a=Mt("Make a selection to see rankings."),this.h()},l(o){e=$e(o,"SPAN",{class:!0});var c=Ze(e);a=zt(c,"Make a selection to see rankings."),c.forEach(ie),this.h()},h(){ve(e,"class","muted svelte-xikkwp")},m(o,c){Oe(o,e,c),Me(e,a)},p:_r,i:_r,o:_r,d(o){o&&ie(e)}}}function ew(s){let e,a;return e=new l1({props:{data:s[0].geoPerc.filter(__).sort(y_).slice(-5),offset:s[0].geoPerc.filter(v_).length-4}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&1&&(h.data=o[0].geoPerc.filter(__).sort(y_).slice(-5)),c&1&&(h.offset=o[0].geoPerc.filter(v_).length-4),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function tw(s){let e,a,o,c;const h=[ew,Q2],f=[];function i(d,g){return d[0].geoPerc&&d[4][0]?0:1}return e=i(s),a=f[e]=h[e](s),{c(){a.c(),o=Qt()},l(d){a.l(d),o=Qt()},m(d,g){f[e].m(d,g),Oe(d,o,g),c=!0},p(d,g){let b=e;e=i(d),e===b?f[e].p(d,g):(Vr(),it(f[b],1,1,()=>{f[b]=null}),$r(),a=f[e],a?a.p(d,g):(a=f[e]=h[e](d),a.c()),Ge(a,1),a.m(o.parentNode,o))},i(d){c||(Ge(a),c=!0)},o(d){it(a),c=!1},d(d){f[e].d(d),d&&ie(o)}}}function rw(s){let e,a,o,c,h,f,i,d;return e=new qs({props:{colspan:3,rowspan:1,noBackground:!0,$$slots:{default:[G2]},$$scope:{ctx:s}}}),o=new qs({props:{colspan:2,rowspan:2,noBackground:!0,$$slots:{default:[K2]},$$scope:{ctx:s}}}),h=new qs({props:{title:"Areas with high %",$$slots:{default:[Y2]},$$scope:{ctx:s}}}),i=new qs({props:{title:"Areas with low %",$$slots:{default:[tw]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment),a=St(),ir(o.$$.fragment),c=St(),ir(h.$$.fragment),f=St(),ir(i.$$.fragment)},l(g){cr(e.$$.fragment,g),a=kt(g),cr(o.$$.fragment,g),c=kt(g),cr(h.$$.fragment,g),f=kt(g),cr(i.$$.fragment,g)},m(g,b){nr(e,g,b),Oe(g,a,b),nr(o,g,b),Oe(g,c,b),nr(h,g,b),Oe(g,f,b),nr(i,g,b),d=!0},p(g,b){const k={};b&4096&&(k.$$scope={dirty:b,ctx:g}),e.$set(k);const x={};b&4207&&(x.$$scope={dirty:b,ctx:g}),o.$set(x);const S={};b&4113&&(S.$$scope={dirty:b,ctx:g}),h.$set(S);const E={};b&4113&&(E.$$scope={dirty:b,ctx:g}),i.$set(E)},i(g){d||(Ge(e.$$.fragment,g),Ge(o.$$.fragment,g),Ge(h.$$.fragment,g),Ge(i.$$.fragment,g),d=!0)},o(g){it(e.$$.fragment,g),it(o.$$.fragment,g),it(h.$$.fragment,g),it(i.$$.fragment,g),d=!1},d(g){sr(e,g),g&&ie(a),sr(o,g),g&&ie(c),sr(h,g),g&&ie(f),sr(i,g)}}}function iw(s){let e,a;return e=new Ad({props:{title:"Population by area",height:"auto",$$slots:{default:[rw]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,[c]){const h={};c&4223&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}const m_=s=>s.value!=null,g_=(s,e)=>e.value-s.value,__=s=>s.value!=null,y_=(s,e)=>e.value-s.value,v_=s=>s.value!=null;function nw(s,e,a){let o,{data:c}=e,{mapStyle:h}=e,{ladBounds:f}=e,{mapBounds:i}=e,{selected:d}=e,{colors:g}=e,b;const k=T=>{var z;let A="";if(T){A=`<b>${c.geoCodesLookup[b].name}</b><br/>`;const D=(z=o==null?void 0:o[T])==null?void 0:z.value;A+=D!=null?`${D}%`:"No data"}return A};function x(T){b=T,a(6,b)}const S=T=>T.code==b,E=T=>T.code==b;return s.$$set=T=>{"data"in T&&a(0,c=T.data),"mapStyle"in T&&a(1,h=T.mapStyle),"ladBounds"in T&&a(2,f=T.ladBounds),"mapBounds"in T&&a(3,i=T.mapBounds),"selected"in T&&a(4,d=T.selected),"colors"in T&&a(5,g=T.colors)},s.$$.update=()=>{s.$$.dirty&1&&(o=(T=>{const A={};return console.log("data",T),Array.isArray(T)&&T.forEach(z=>A[z.code]=z),A})(c.geoPerc))},[c,h,f,i,d,g,b,k,x,S,E]}class sw extends Wr{constructor(e){super(),Kr(this,e,nw,iw,jr,{data:0,mapStyle:1,ladBounds:2,mapBounds:3,selected:4,colors:5})}}function b_(s){let e,a;return e=new qs({props:{title:s[0],$$slots:{default:[cw]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&1&&(h.title=o[0]),c&30&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function aw(s){let e,a,o;var c=s[3];function h(f){return{props:{data:f[2].selected&&Yu("residents",f[1].code,f[2]),showLegend:!1}}}return c&&(e=Wm(c,h(s))),{c(){e&&ir(e.$$.fragment),a=Qt()},l(f){e&&cr(e.$$.fragment,f),a=Qt()},m(f,i){e&&nr(e,f,i),Oe(f,a,i),o=!0},p(f,i){const d={};if(i&6&&(d.data=f[2].selected&&Yu("residents",f[1].code,f[2])),i&8&&c!==(c=f[3])){if(e){Vr();const g=e;it(g.$$.fragment,1,0,()=>{sr(g,1)}),$r()}c?(e=Wm(c,h(f)),ir(e.$$.fragment),Ge(e.$$.fragment,1),nr(e,a.parentNode,a)):e=null}else c&&e.$set(d)},i(f){o||(e&&Ge(e.$$.fragment,f),o=!0)},o(f){e&&it(e.$$.fragment,f),o=!1},d(f){f&&ie(a),e&&sr(e,f)}}}function ow(s){let e,a=dc.nodata+"",o;return{c(){e=Ve("span"),o=Mt(a),this.h()},l(c){e=$e(c,"SPAN",{class:!0});var h=Ze(e);o=zt(h,a),h.forEach(ie),this.h()},h(){ve(e,"class","num-desc svelte-1yn8adz")},m(c,h){Oe(c,e,h),Me(e,o)},p:_r,i:_r,o:_r,d(c){c&&ie(e)}}}function lw(s){let e,a=dc.blocked+"",o;return{c(){e=Ve("span"),o=Mt(a),this.h()},l(c){e=$e(c,"SPAN",{class:!0});var h=Ze(e);o=zt(h,a),h.forEach(ie),this.h()},h(){ve(e,"class","num-desc svelte-1yn8adz")},m(c,h){Oe(c,e,h),Me(e,o)},p:_r,i:_r,o:_r,d(c){c&&ie(e)}}}function cw(s){let e,a,o,c,h,f=Zm[s[1].code]+"",i,d;const g=[lw,ow,aw],b=[];function k(x,S){return x[2].selected.residents[x[1].code].values==="blocked"?0:x[2].selected.residents[x[1].code].values.percent[0]==null?1:2}return e=k(s),a=b[e]=g[e](s),{c(){a.c(),o=St(),c=Ve("span"),h=Mt("% of "),i=Mt(f),this.h()},l(x){a.l(x),o=kt(x),c=$e(x,"SPAN",{class:!0});var S=Ze(c);h=zt(S,"% of "),i=zt(S,f),S.forEach(ie),this.h()},h(){ve(c,"class","num-desc svelte-1yn8adz")},m(x,S){b[e].m(x,S),Oe(x,o,S),Oe(x,c,S),Me(c,h),Me(c,i),d=!0},p(x,S){let E=e;e=k(x),e===E?b[e].p(x,S):(Vr(),it(b[E],1,1,()=>{b[E]=null}),$r(),a=b[e],a?a.p(x,S):(a=b[e]=g[e](x),a.c()),Ge(a,1),a.m(o.parentNode,o)),(!d||S&2)&&f!==(f=Zm[x[1].code]+"")&&Cr(i,f)},i(x){d||(Ge(a),d=!0)},o(x){it(a),d=!1},d(x){b[e].d(x),x&&ie(o),x&&ie(c)}}}function uw(s){var c,h;let e,a,o=((h=(c=s[2].selected.residents)==null?void 0:c[s[1].code])==null?void 0:h.values)&&b_(s);return{c(){o&&o.c(),e=Qt()},l(f){o&&o.l(f),e=Qt()},m(f,i){o&&o.m(f,i),Oe(f,e,i),a=!0},p(f,[i]){var d,g;(g=(d=f[2].selected.residents)==null?void 0:d[f[1].code])!=null&&g.values?o?(o.p(f,i),i&6&&Ge(o,1)):(o=b_(f),o.c(),Ge(o,1),o.m(e.parentNode,e)):o&&(Vr(),it(o,1,1,()=>{o=null}),$r())},i(f){a||(Ge(o),a=!0)},o(f){it(o),a=!1},d(f){o&&o.d(f),f&&ie(e)}}}function hw(s,e,a){let{title:o}=e,{table:c}=e,{data:h}=e,{chart_type:f}=e;return s.$$set=i=>{"title"in i&&a(0,o=i.title),"table"in i&&a(1,c=i.table),"data"in i&&a(2,h=i.data),"chart_type"in i&&a(3,f=i.chart_type)},[o,c,h,f]}class c1 extends Wr{constructor(e){super(),Kr(this,e,hw,uw,jr,{title:0,table:1,data:2,chart_type:3})}}function fw(s){let e,a;const o=s[5].default,c=Bi(o,s,s[4],null);return{c(){e=Ve("mark"),c&&c.c(),this.h()},l(h){e=$e(h,"MARK",{class:!0,style:!0,role:!0});var f=Ze(e);c&&c.l(f),f.forEach(ie),this.h()},h(){ve(e,"class","em svelte-1602h77"),Ct(e,"background-color",s[0]),Ct(e,"color",s[2]),ve(e,"role","presentation"),Kt(e,"nowrap",s[1])},m(h,f){Oe(h,e,f),c&&c.m(e,null),a=!0},p(h,[f]){c&&c.p&&(!a||f&16)&&Ni(c,o,h,h[4],a?Ui(o,h[4],f,null):Fi(h[4]),null),(!a||f&1)&&Ct(e,"background-color",h[0]),(!a||f&4)&&Ct(e,"color",h[2]),(!a||f&2)&&Kt(e,"nowrap",h[1])},i(h){a||(Ge(c,h),a=!0)},o(h){it(c,h),a=!1},d(h){h&&ie(e),c&&c.d(h)}}}function dw(s,e,a){let o,{$$slots:c={},$$scope:h}=e,{color:f="lightgrey"}=e,{nowrap:i=!0}=e;function d(b){return(b[0]*299+b[1]*587+b[2]*114)/1e3>125?"black":"white"}let g="black";return s.$$set=b=>{"color"in b&&a(0,f=b.color),"nowrap"in b&&a(1,i=b.nowrap),"$$scope"in b&&a(4,h=b.$$scope)},s.$$.update=()=>{s.$$.dirty&1&&a(3,o=Jb(f).rgb),s.$$.dirty&8&&o&&a(2,g=d(o))},[f,i,g,o,h,c]}class pw extends Wr{constructor(e){super(),Kr(this,e,dw,fw,jr,{color:0,nowrap:1})}}function mw(s){let e,a=s[0].selected.total_pop.count.toLocaleString()+"",o,c,h,f,i,d,g,b,k;return g=new pw({props:{color:"lightgrey",$$slots:{default:[_w]},$$scope:{ctx:s}}}),{c(){e=Ve("div"),o=Mt(a),c=St(),h=Ve("div"),f=Mt("people"),i=St(),d=Ve("div"),ir(g.$$.fragment),b=Mt(" of the total population of England and Wales"),this.h()},l(x){e=$e(x,"DIV",{class:!0});var S=Ze(e);o=zt(S,a),S.forEach(ie),c=kt(x),h=$e(x,"DIV",{class:!0});var E=Ze(h);f=zt(E,"people"),E.forEach(ie),i=kt(x),d=$e(x,"DIV",{class:!0});var T=Ze(d);cr(g.$$.fragment,T),b=zt(T," of the total population of England and Wales"),T.forEach(ie),this.h()},h(){ve(e,"class","num-big svelte-c46qp4"),ve(h,"class","num-suffix svelte-c46qp4"),ve(d,"class","num-desc svelte-c46qp4")},m(x,S){Oe(x,e,S),Me(e,o),Oe(x,c,S),Oe(x,h,S),Me(h,f),Oe(x,i,S),Oe(x,d,S),nr(g,d,null),Me(d,b),k=!0},p(x,S){(!k||S&1)&&a!==(a=x[0].selected.total_pop.count.toLocaleString()+"")&&Cr(o,a);const E={};S&3&&(E.$$scope={dirty:S,ctx:x}),g.$set(E)},i(x){k||(Ge(g.$$.fragment,x),k=!0)},o(x){it(g.$$.fragment,x),k=!1},d(x){x&&ie(e),x&&ie(c),x&&ie(h),x&&ie(i),x&&ie(d),sr(g)}}}function gw(s){let e,a=dc.nodata+"",o;return{c(){e=Ve("div"),o=Mt(a),this.h()},l(c){e=$e(c,"DIV",{class:!0});var h=Ze(e);o=zt(h,a),h.forEach(ie),this.h()},h(){ve(e,"class","num-desc svelte-c46qp4")},m(c,h){Oe(c,e,h),Me(e,o)},p:_r,i:_r,o:_r,d(c){c&&ie(e)}}}function _w(s){let e=Tg(s[0].selected.total_pop.percent)+"",a,o;return{c(){a=Mt(e),o=Mt("%")},l(c){a=zt(c,e),o=zt(c,"%")},m(c,h){Oe(c,a,h),Oe(c,o,h)},p(c,h){h&1&&e!==(e=Tg(c[0].selected.total_pop.percent)+"")&&Cr(a,e)},d(c){c&&ie(a),c&&ie(o)}}}function yw(s){let e,a,o,c;const h=[gw,mw],f=[];function i(d,g){return d[0].selected.total_pop.count==null?0:1}return e=i(s),a=f[e]=h[e](s),{c(){a.c(),o=Qt()},l(d){a.l(d),o=Qt()},m(d,g){f[e].m(d,g),Oe(d,o,g),c=!0},p(d,g){let b=e;e=i(d),e===b?f[e].p(d,g):(Vr(),it(f[b],1,1,()=>{f[b]=null}),$r(),a=f[e],a?a.p(d,g):(a=f[e]=h[e](d),a.c()),Ge(a,1),a.m(o.parentNode,o))},i(d){c||(Ge(a),c=!0)},o(d){it(a),c=!1},d(d){f[e].d(d),d&&ie(o)}}}function vw(s){let e,a;return e=new qs({props:{title:"Population",$$slots:{default:[yw]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,[c]){const h={};c&3&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function bw(s,e,a){let{data:o}=e;return s.$$set=c=>{"data"in c&&a(0,o=c.data)},[o]}class xw extends Wr{constructor(e){super(),Kr(this,e,bw,vw,jr,{data:0})}}function ww(s){let e,a,o,c,h=`translateX(${s[3]/s[1]+(s[1]-s[4])}px)`,f,i=`${s[2]}px`,d=`${s[4]}px`;return{c(){e=Ve("div"),a=Mt(s[0]),o=St(),c=Ve("div"),this.h()},l(g){e=$e(g,"DIV",{class:!0});var b=Ze(e);a=zt(b,s[0]),o=kt(b),c=$e(b,"DIV",{class:!0}),Ze(c).forEach(ie),b.forEach(ie),this.h()},h(){ve(c,"class","caret svelte-1491tb3"),Ct(c,"transform",h),ve(e,"class","tooltip svelte-1491tb3"),Ry(()=>s[6].call(e)),Ct(e,"top",i),Ct(e,"left",d)},m(g,b){Oe(g,e,b),Me(e,a),Me(e,o),Me(e,c),f=Oy(e,s[6].bind(e))},p(g,[b]){b&1&&Cr(a,g[0]),b&26&&h!==(h=`translateX(${g[3]/g[1]+(g[1]-g[4])}px)`)&&Ct(c,"transform",h),b&4&&i!==(i=`${g[2]}px`)&&Ct(e,"top",i),b&16&&d!==(d=`${g[4]}px`)&&Ct(e,"left",d)},i:_r,o:_r,d(g){g&&ie(e),f()}}}const zu=4;function Sw(s,e,a){let o,{title:c}=e,{x:h}=e,{y:f}=e,{width:i}=e,d;function g(){d=this.clientWidth,a(3,d)}return s.$$set=b=>{"title"in b&&a(0,c=b.title),"x"in b&&a(1,h=b.x),"y"in b&&a(2,f=b.y),"width"in b&&a(5,i=b.width)},s.$$.update=()=>{s.$$.dirty&42&&a(4,o=d&&h+d/2>i-zu?i-d/2-zu:d&&h-d/2<0+zu?d/2+zu:h)},[c,h,f,d,o,i,g]}class kw extends Wr{constructor(e){super(),Kr(this,e,Sw,ww,jr,{title:0,x:1,y:2,width:5})}}function Ew(s){let e,a;function o(h){e=s.getAttribute("title"),s.removeAttribute("title");let f=document.body.getBoundingClientRect(),i=s.getBoundingClientRect(),d=i.bottom,g=(i.left+i.right)/2;a=new kw({props:{title:e,x:g,y:d-f.y,width:f.width},target:document.body})}function c(){a.$destroy(),s.setAttribute("title",e)}return s.addEventListener("mouseover",o),s.addEventListener("mouseout",c),{destroy(){a&&a.$destroy(),s.removeEventListener("mouseover",o),s.removeEventListener("mouseout",c)}}}function x_(s,e,a){const o=s.slice();return o[20]=e[a],o[22]=a,o}function w_(s,e,a){const o=s.slice();return o[23]=e[a],o[25]=a,o}function S_(s,e,a){const o=s.slice();return o[23]=e[a],o[25]=a,o}function k_(s,e,a){const o=s.slice();return o[27]=e[a],o[22]=a,o}function E_(s){let e,a=s[12],o=[];for(let c=0;c<a.length;c+=1)o[c]=T_(k_(s,a,c));return{c(){e=Ve("ul");for(let c=0;c<o.length;c+=1)o[c].c();this.h()},l(c){e=$e(c,"UL",{class:!0});var h=Ze(e);for(let f=0;f<o.length;f+=1)o[f].l(h);h.forEach(ie),this.h()},h(){ve(e,"class","legend-block svelte-h6j55z")},m(c,h){Oe(c,e,h);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(e,null)},p(c,h){if(h&4112){a=c[12];let f;for(f=0;f<a.length;f+=1){const i=k_(c,a,f);o[f]?o[f].p(i,h):(o[f]=T_(i),o[f].c(),o[f].m(e,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=a.length}},d(c){c&&ie(e),Vi(o,c)}}}function T_(s){let e,a,o=`${s[22]==0?0:s[4]}px`,c,h,f=s[27]+"",i,d;return{c(){e=Ve("li"),a=Ve("div"),c=St(),h=Ve("span"),i=Mt(f),d=St(),this.h()},l(g){e=$e(g,"LI",{class:!0});var b=Ze(e);a=$e(b,"DIV",{class:!0}),Ze(a).forEach(ie),c=kt(b),h=$e(b,"SPAN",{class:!0});var k=Ze(h);i=zt(k,f),k.forEach(ie),d=kt(b),b.forEach(ie),this.h()},h(){ve(a,"class","legend-vis "+(s[22]==0?"bar":"marker-vis")+" svelte-h6j55z"),Ct(a,"border-bottom-width",o),ve(h,"class",Xu(s[22]==0?"bold":"brackets")+" svelte-h6j55z"),ve(e,"class","svelte-h6j55z")},m(g,b){Oe(g,e,b),Me(e,a),Me(e,c),Me(e,h),Me(h,i),Me(e,d)},p(g,b){b&16&&o!==(o=`${g[22]==0?0:g[4]}px`)&&Ct(a,"border-bottom-width",o),b&4096&&f!==(f=g[27]+"")&&Cr(i,f)},d(g){g&&ie(e)}}}function Tw(s){let e,a=s[20].values,o=[];for(let c=0;c<a.length;c+=1)o[c]=C_(w_(s,a,c));return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=Qt()},l(c){for(let h=0;h<o.length;h+=1)o[h].l(c);e=Qt()},m(c,h){for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(c,h);Oe(c,e,h)},p(c,h){if(h&11282){a=c[20].values;let f;for(f=0;f<a.length;f+=1){const i=w_(c,a,f);o[f]?o[f].p(i,h):(o[f]=C_(i),o[f].c(),o[f].m(e.parentNode,e))}for(;f<o.length;f+=1)o[f].d(1);o.length=a.length}},d(c){Vi(o,c),c&&ie(e)}}}function Cw(s){let e,a=s[20].values,o=[];for(let c=0;c<a.length;c+=1)o[c]=I_(S_(s,a,c));return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=Qt()},l(c){for(let h=0;h<o.length;h+=1)o[h].l(c);e=Qt()},m(c,h){for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(c,h);Oe(c,e,h)},p(c,h){if(h&11271){a=c[20].values;let f;for(f=0;f<a.length;f+=1){const i=S_(c,a,f);o[f]?o[f].p(i,h):(o[f]=I_(i),o[f].c(),o[f].m(e.parentNode,e))}for(;f<o.length;f+=1)o[f].d(1);o.length=a.length}},d(c){Vi(o,c),c&&ie(e)}}}function C_(s){let e,a=`calc(${s[11](s[23][s[1]])}% - ${s[4]/2}px)`,o=`${s[25]/s[13].length*100}%`,c=`calc(${1/s[13].length*100}% - 2px)`,h=`${s[4]}px`;return{c(){e=Ve("div"),this.h()},l(f){e=$e(f,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","marker svelte-h6j55z"),Ct(e,"bottom",a),Ct(e,"height","0px"),Ct(e,"left",o),Ct(e,"width",c),Ct(e,"border-bottom-width",h)},m(f,i){Oe(f,e,i)},p(f,i){i&3090&&a!==(a=`calc(${f[11](f[23][f[1]])}% - ${f[4]/2}px)`)&&Ct(e,"bottom",a),i&8192&&o!==(o=`${f[25]/f[13].length*100}%`)&&Ct(e,"left",o),i&8192&&c!==(c=`calc(${1/f[13].length*100}% - 2px)`)&&Ct(e,"width",c),i&16&&h!==(h=`${f[4]}px`)&&Ct(e,"border-bottom-width",h)},d(f){f&&ie(e)}}}function I_(s){let e,a,o=`${s[11](s[23][s[1]])}%`,c=`calc(${s[25]/s[13].length*100}%)`,h=`calc(${1/s[13].length*100}% - 2px)`,f,i;return{c(){e=Ve("div"),this.h()},l(d){e=$e(d,"DIV",{title:!0,class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"title",a=`${s[23][s[0]]}: ${s[2](s[23][s[1]])}%`+(s[10].length>1?` (${s[2](s[10][s[22]+1].values[s[25]][s[1]])}%)`:"")),ve(e,"class","bar svelte-h6j55z"),Ct(e,"bottom","0"),Ct(e,"height",o),Ct(e,"left",c),Ct(e,"width",h)},m(d,g){Oe(d,e,g),f||(i=Uy(Ew.call(null,e)),f=!0)},p(d,g){g&1031&&a!==(a=`${d[23][d[0]]}: ${d[2](d[23][d[1]])}%`+(d[10].length>1?` (${d[2](d[10][d[22]+1].values[d[25]][d[1]])}%)`:""))&&ve(e,"title",a),g&3074&&o!==(o=`${d[11](d[23][d[1]])}%`)&&Ct(e,"height",o),g&8192&&c!==(c=`calc(${d[25]/d[13].length*100}%)`)&&Ct(e,"left",c),g&8192&&h!==(h=`calc(${1/d[13].length*100}% - 2px)`)&&Ct(e,"width",h)},d(d){d&&ie(e),f=!1,i()}}}function A_(s){let e;function a(h,f){return h[22]==0?Cw:Tw}let c=a(s)(s);return{c(){c.c(),e=Qt()},l(h){c.l(h),e=Qt()},m(h,f){c.m(h,f),Oe(h,e,f)},p(h,f){c.p(h,f)},d(h){c.d(h),h&&ie(e)}}}function P_(s){let e,a,o=s[6][0]!=0&&M_(s),c=s[6][1]!=18&&z_(s);return{c(){o&&o.c(),e=St(),c&&c.c(),a=Qt()},l(h){o&&o.l(h),e=kt(h),c&&c.l(h),a=Qt()},m(h,f){o&&o.m(h,f),Oe(h,e,f),c&&c.m(h,f),Oe(h,a,f)},p(h,f){h[6][0]!=0?o?o.p(h,f):(o=M_(h),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),h[6][1]!=18?c?c.p(h,f):(c=z_(h),c.c(),c.m(a.parentNode,a)):c&&(c.d(1),c=null)},d(h){o&&o.d(h),h&&ie(e),c&&c.d(h),h&&ie(a)}}}function M_(s){let e,a=`${s[15](s[10])}%`;return{c(){e=Ve("div"),this.h()},l(o){e=$e(o,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","mask svelte-h6j55z"),Ct(e,"bottom","0"),Ct(e,"height",a),Ct(e,"left","0"),Ct(e,"width",s[14](s[6][0]))},m(o,c){Oe(o,e,c)},p(o,c){c&1024&&a!==(a=`${o[15](o[10])}%`)&&Ct(e,"height",a),c&64&&Ct(e,"width",o[14](o[6][0]))},d(o){o&&ie(e)}}}function z_(s){let e,a=`${s[15](s[10])}%`;return{c(){e=Ve("div"),this.h()},l(o){e=$e(o,"DIV",{class:!0}),Ze(e).forEach(ie),this.h()},h(){ve(e,"class","mask svelte-h6j55z"),Ct(e,"bottom","0"),Ct(e,"height",a),Ct(e,"left",s[14](s[6][1])),Ct(e,"right","2px")},m(o,c){Oe(o,e,c)},p(o,c){c&1024&&a!==(a=`${o[15](o[10])}%`)&&Ct(e,"height",a),c&64&&Ct(e,"left",o[14](o[6][1]))},d(o){o&&ie(e)}}}function D_(s){let e,a,o;return{c(){e=Ve("small"),a=Mt(s[7]),o=Mt(s[8]),this.h()},l(c){e=$e(c,"SMALL",{class:!0});var h=Ze(e);a=zt(h,s[7]),o=zt(h,s[8]),h.forEach(ie),this.h()},h(){ve(e,"class","svelte-h6j55z")},m(c,h){Oe(c,e,h),Me(e,a),Me(e,o)},p(c,h){h&128&&Cr(a,c[7]),h&256&&Cr(o,c[8])},d(c){c&&ie(e)}}}function Iw(s){let e,a,o,c=`${s[3]}px`,h,f,i,d=s[5][0]+"",g,b,k,x=s[5][1]+"",S,E,T,A=s[9]&&s[12][1]&&E_(s),z=s[10],D=[];for(let q=0;q<z.length;q+=1)D[q]=A_(x_(s,z,q));let F=s[6]!=null&&P_(s),$=s[7]&&D_(s);return{c(){A&&A.c(),e=St(),a=Ve("div");for(let q=0;q<D.length;q+=1)D[q].c();o=St(),F&&F.c(),h=St(),f=Ve("div"),i=Ve("div"),g=Mt(d),b=St(),k=Ve("div"),S=Mt(x),E=St(),$&&$.c(),T=Qt(),this.h()},l(q){A&&A.l(q),e=kt(q),a=$e(q,"DIV",{class:!0});var J=Ze(a);for(let Ee=0;Ee<D.length;Ee+=1)D[Ee].l(J);o=kt(J),F&&F.l(J),J.forEach(ie),h=kt(q),f=$e(q,"DIV",{class:!0});var G=Ze(f);i=$e(G,"DIV",{class:!0});var oe=Ze(i);g=zt(oe,d),oe.forEach(ie),b=kt(G),k=$e(G,"DIV",{class:!0});var de=Ze(k);S=zt(de,x),de.forEach(ie),G.forEach(ie),E=kt(q),$&&$.l(q),T=Qt(),this.h()},h(){ve(a,"class","bar-group svelte-h6j55z"),Ct(a,"height",c),ve(i,"class","svelte-h6j55z"),Ct(i,"left","0"),ve(k,"class","svelte-h6j55z"),Ct(k,"right","0"),ve(f,"class","x-scale svelte-h6j55z"),Ct(f,"height","1rem")},m(q,J){A&&A.m(q,J),Oe(q,e,J),Oe(q,a,J);for(let G=0;G<D.length;G+=1)D[G]&&D[G].m(a,null);Me(a,o),F&&F.m(a,null),Oe(q,h,J),Oe(q,f,J),Me(f,i),Me(i,g),Me(f,b),Me(f,k),Me(k,S),Oe(q,E,J),$&&$.m(q,J),Oe(q,T,J)},p(q,[J]){if(q[9]&&q[12][1]?A?A.p(q,J):(A=E_(q),A.c(),A.m(e.parentNode,e)):A&&(A.d(1),A=null),J&11287){z=q[10];let G;for(G=0;G<z.length;G+=1){const oe=x_(q,z,G);D[G]?D[G].p(oe,J):(D[G]=A_(oe),D[G].c(),D[G].m(a,o))}for(;G<D.length;G+=1)D[G].d(1);D.length=z.length}q[6]!=null?F?F.p(q,J):(F=P_(q),F.c(),F.m(a,null)):F&&(F.d(1),F=null),J&8&&c!==(c=`${q[3]}px`)&&Ct(a,"height",c),J&32&&d!==(d=q[5][0]+"")&&Cr(g,d),J&32&&x!==(x=q[5][1]+"")&&Cr(S,x),q[7]?$?$.p(q,J):($=D_(q),$.c(),$.m(T.parentNode,T)):$&&($.d(1),$=null)},i:_r,o:_r,d(q){A&&A.d(q),q&&ie(e),q&&ie(a),Vi(D,q),F&&F.d(),q&&ie(h),q&&ie(f),q&&ie(E),$&&$.d(q),q&&ie(T)}}}function Aw(s,e,a){let o,c,h,f,i,{data:d}=e,{xKey:g="category"}=e,{yKey:b="value"}=e,{zKey:k="areanm"}=e,{formatTick:x=G=>G.toFixed(1)}=e,{height:S=100}=e,{markerWidth:E=2.5}=e,{minmax:T=["0 years","85+"]}=e,{maskRange:A=null}=e,{base:z=null}=e,{base_ext:D=", 5 year age bands"}=e,{showLegend:F=!0}=e;function $(G,oe){let de={};for(const ot of G)de[ot[oe]]||(de[ot[oe]]={label:ot[oe],values:[]}),de[ot[oe]].values.push(ot);let Ee=[];for(const ot in de)Ee.push(de[ot]);return Ee}function q(G){return G%1===0?`calc(${G/o.length*100}% - 1px)`:`calc(${Math.floor(G)/o.length*100}% +(${1/o.length*100}% - 2px) * ${G%1})`}function J(G){return Math.max(...G.map(oe=>Math.max(...oe.values.map(de=>f(de[b])))))}return s.$$set=G=>{"data"in G&&a(16,d=G.data),"xKey"in G&&a(0,g=G.xKey),"yKey"in G&&a(1,b=G.yKey),"zKey"in G&&a(17,k=G.zKey),"formatTick"in G&&a(2,x=G.formatTick),"height"in G&&a(3,S=G.height),"markerWidth"in G&&a(4,E=G.markerWidth),"minmax"in G&&a(5,T=G.minmax),"maskRange"in G&&a(6,A=G.maskRange),"base"in G&&a(7,z=G.base),"base_ext"in G&&a(8,D=G.base_ext),"showLegend"in G&&a(9,F=G.showLegend)},s.$$.update=()=>{s.$$.dirty&65537&&a(13,o=d.map(G=>G[g]).filter((G,oe,de)=>de.indexOf(G)===oe)),s.$$.dirty&65538&&a(18,c=[0,Math.max(...d.map(G=>G[b]))]),s.$$.dirty&196608&&a(12,h=d.map(G=>G[k]).filter((G,oe,de)=>de.indexOf(G)===oe)),s.$$.dirty&262144&&a(11,f=G=>Math.abs(G/c[1])*100),s.$$.dirty&196608&&a(10,i=$(d,k))},[g,b,x,S,E,T,A,z,D,F,i,f,h,o,q,J,d,k,c]}class Pw extends Wr{constructor(e){super(),Kr(this,e,Aw,Iw,jr,{data:16,xKey:0,yKey:1,zKey:17,formatTick:2,height:3,markerWidth:4,minmax:5,maskRange:6,base:7,base_ext:8,showLegend:9})}}function Mw(s){let e,a;return e=new Pw({props:{data:s[0].selected&&Yu("residents","resident_age_18b",s[0]),zKey:"group",maskRange:Eg(s[1]),base:"% of all people",showLegend:!1}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c&1&&(h.data=o[0].selected&&Yu("residents","resident_age_18b",o[0])),c&2&&(h.maskRange=Eg(o[1])),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function zw(s){let e,a=dc.nodata+"",o;return{c(){e=Ve("span"),o=Mt(a),this.h()},l(c){e=$e(c,"SPAN",{class:!0});var h=Ze(e);o=zt(h,a),h.forEach(ie),this.h()},h(){ve(e,"class","num-desc svelte-uj0r62")},m(c,h){Oe(c,e,h),Me(e,o)},p:_r,i:_r,o:_r,d(c){c&&ie(e)}}}function Dw(s){let e,a=dc.nodata+"",o;return{c(){e=Ve("span"),o=Mt(a),this.h()},l(c){e=$e(c,"SPAN",{class:!0});var h=Ze(e);o=zt(h,a),h.forEach(ie),this.h()},h(){ve(e,"class","num-desc svelte-uj0r62")},m(c,h){Oe(c,e,h),Me(e,o)},p:_r,i:_r,o:_r,d(c){c&&ie(e)}}}function Lw(s){let e,a,o,c;const h=[Dw,zw,Mw],f=[];function i(d,g){return d[0].selected.residents.resident_age_18b.values==="blocked"?0:d[0].selected.residents.resident_age_18b.values.percent[0]==null?1:2}return e=i(s),a=f[e]=h[e](s),{c(){a.c(),o=Qt()},l(d){a.l(d),o=Qt()},m(d,g){f[e].m(d,g),Oe(d,o,g),c=!0},p(d,g){let b=e;e=i(d),e===b?f[e].p(d,g):(Vr(),it(f[b],1,1,()=>{f[b]=null}),$r(),a=f[e],a?a.p(d,g):(a=f[e]=h[e](d),a.c()),Ge(a,1),a.m(o.parentNode,o))},i(d){c||(Ge(a),c=!0)},o(d){it(a),c=!1},d(d){f[e].d(d),d&&ie(o)}}}function Rw(s){let e,a;return e=new qs({props:{title:"Age profile",$$slots:{default:[Lw]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,[c]){const h={};c&7&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function Ow(s,e,a){let{data:o}=e,{selected:c}=e;return s.$$set=h=>{"data"in h&&a(0,o=h.data),"selected"in h&&a(1,c=h.selected)},[o,c]}class Bw extends Wr{constructor(e){super(),Kr(this,e,Ow,Rw,jr,{data:0,selected:1})}}function Nw(s,e,a){const o=s.slice();return o[2]=e[a],o[4]=a,o}function Fw(s){let e,a,o,c,h,f;return{c(){e=Ve("li"),a=Ve("div"),o=St(),c=Ve("span"),h=Mt(s[2]),f=St(),this.h()},l(i){e=$e(i,"LI",{class:!0});var d=Ze(e);a=$e(d,"DIV",{class:!0}),Ze(a).forEach(ie),o=kt(d),c=$e(d,"SPAN",{class:!0});var g=Ze(c);h=zt(g,s[2]),g.forEach(ie),f=kt(d),d.forEach(ie),this.h()},h(){ve(a,"class","legend-vis "+(s[4]==0?"bar":"marker")+" svelte-npejzx"),ve(c,"class",s[4]==0?"bold":"brackets"),ve(e,"class","svelte-npejzx"),Kt(e,"ew",s[4]!=0)},m(i,d){Oe(i,e,d),Me(e,a),Me(e,o),Me(e,c),Me(c,h),Me(e,f)},p:_r,d(i){i&&ie(e)}}}function Uw(s){let e,a,o,c;const h=s[1].default,f=Bi(h,s,s[0],null);let i=["People with the selected characteristics","All people in England and Wales"],d=[];for(let g=0;g<2;g+=1)d[g]=Fw(Nw(s,i,g));return{c(){e=Ve("p"),f&&f.c(),a=St(),o=Ve("ul");for(let g=0;g<2;g+=1)d[g].c();this.h()},l(g){e=$e(g,"P",{class:!0});var b=Ze(e);f&&f.l(b),b.forEach(ie),a=kt(g),o=$e(g,"UL",{class:!0});var k=Ze(o);for(let x=0;x<2;x+=1)d[x].l(k);k.forEach(ie),this.h()},h(){ve(e,"class","legend-text svelte-npejzx"),ve(o,"class","legend-block svelte-npejzx")},m(g,b){Oe(g,e,b),f&&f.m(e,null),Oe(g,a,b),Oe(g,o,b);for(let k=0;k<2;k+=1)d[k]&&d[k].m(o,null);c=!0},p(g,[b]){f&&f.p&&(!c||b&1)&&Ni(f,h,g,g[0],c?Ui(h,g[0],b,null):Fi(g[0]),null)},i(g){c||(Ge(f,g),c=!0)},o(g){it(f,g),c=!1},d(g){g&&ie(e),f&&f.d(g),g&&ie(a),g&&ie(o),Vi(d,g)}}}function Vw(s,e,a){let{$$slots:o={},$$scope:c}=e;return s.$$set=h=>{"$$scope"in h&&a(0,c=h.$$scope)},[c,o]}class u1 extends Wr{constructor(e){super(),Kr(this,e,Vw,Uw,jr,{})}}function $w(s){let e,a,o,c,h=(s[0]?"Close panel":s[1])+"",f,i,d,g,b,k,x;const S=s[3].default,E=Bi(S,s,s[2],null);return{c(){e=Ve("details"),a=Ve("summary"),o=Ve("h3"),c=Ve("span"),f=Mt(h),d=St(),g=Ve("div"),E&&E.c(),this.h()},l(T){e=$e(T,"DETAILS",{class:!0});var A=Ze(e);a=$e(A,"SUMMARY",{class:!0,"data-ga-action":!0});var z=Ze(a);o=$e(z,"H3",{class:!0});var D=Ze(o);c=$e(D,"SPAN",{class:!0});var F=Ze(c);f=zt(F,h),F.forEach(ie),D.forEach(ie),z.forEach(ie),d=kt(A),g=$e(A,"DIV",{class:!0});var $=Ze(g);E&&E.l($),$.forEach(ie),A.forEach(ie),this.h()},h(){ve(c,"class","ons-btn__inner"),ve(o,"class","ons-btn"),Kt(o,"ons-btn--secondary",s[0]),ve(a,"class","ons-collapsible__heading ons-js-collapsible-heading svelte-1x2xth5"),ve(a,"data-ga-action",i=s[0]?"Close panel":"Open panel"),ve(g,"class","ons-collapsible__content ons-js-collapsible-content svelte-1x2xth5"),ve(e,"class","ons-collapsible ons-js-collapsible svelte-1x2xth5")},m(T,A){Oe(T,e,A),Me(e,a),Me(a,o),Me(o,c),Me(c,f),Me(e,d),Me(e,g),E&&E.m(g,null),e.open=s[0],b=!0,k||(x=Ss(e,"toggle",s[4]),k=!0)},p(T,[A]){(!b||A&3)&&h!==(h=(T[0]?"Close panel":T[1])+"")&&Cr(f,h),(!b||A&1)&&Kt(o,"ons-btn--secondary",T[0]),(!b||A&1&&i!==(i=T[0]?"Close panel":"Open panel"))&&ve(a,"data-ga-action",i),E&&E.p&&(!b||A&4)&&Ni(E,S,T,T[2],b?Ui(S,T[2],A,null):Fi(T[2]),null),A&1&&(e.open=T[0])},i(T){b||(Ge(E,T),b=!0)},o(T){it(E,T),b=!1},d(T){T&&ie(e),E&&E.d(T),k=!1,x()}}}function jw(s,e,a){let{$$slots:o={},$$scope:c}=e,{title:h="Title"}=e,{open:f=!1}=e;function i(){f=this.open,a(0,f)}return s.$$set=d=>{"title"in d&&a(1,h=d.title),"open"in d&&a(0,f=d.open),"$$scope"in d&&a(2,c=d.$$scope)},[f,h,c,o,i]}class qw extends Wr{constructor(e){super(),Kr(this,e,jw,$w,jr,{title:1,open:0})}}var L_={exports:{}},Xf={exports:{}},Vn={},ui={};ui.__esModule=!0;ui.extend=h1;ui.indexOf=Kw;ui.escapeExpression=Xw;ui.isEmpty=Jw;ui.createFrame=Yw;ui.blockParams=Qw;ui.appendContextPath=eS;var Gw={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},Zw=/[&<>"'`=]/g,Hw=/[&<>"'`=]/;function Ww(s){return Gw[s]}function h1(s){for(var e=1;e<arguments.length;e++)for(var a in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],a)&&(s[a]=arguments[e][a]);return s}var zd=Object.prototype.toString;ui.toString=zd;var Jf=function(e){return typeof e=="function"};Jf(/x/)&&(ui.isFunction=Jf=function(s){return typeof s=="function"&&zd.call(s)==="[object Function]"});ui.isFunction=Jf;var f1=Array.isArray||function(s){return s&&typeof s=="object"?zd.call(s)==="[object Array]":!1};ui.isArray=f1;function Kw(s,e){for(var a=0,o=s.length;a<o;a++)if(s[a]===e)return a;return-1}function Xw(s){if(typeof s!="string"){if(s&&s.toHTML)return s.toHTML();if(s==null)return"";if(!s)return s+"";s=""+s}return Hw.test(s)?s.replace(Zw,Ww):s}function Jw(s){return!s&&s!==0?!0:!!(f1(s)&&s.length===0)}function Yw(s){var e=h1({},s);return e._parent=s,e}function Qw(s,e){return s.path=e,s}function eS(s,e){return(s?s+".":"")+e}var Yf={exports:{}};(function(s,e){e.__esModule=!0;var a=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function o(c,h){var f=h&&h.loc,i=void 0,d=void 0,g=void 0,b=void 0;f&&(i=f.start.line,d=f.end.line,g=f.start.column,b=f.end.column,c+=" - "+i+":"+g);for(var k=Error.prototype.constructor.call(this,c),x=0;x<a.length;x++)this[a[x]]=k[a[x]];Error.captureStackTrace&&Error.captureStackTrace(this,o);try{f&&(this.lineNumber=i,this.endLineNumber=d,Object.defineProperty?(Object.defineProperty(this,"column",{value:g,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:b,enumerable:!0})):(this.column=g,this.endColumn=b))}catch{}}o.prototype=new Error,e.default=o,s.exports=e.default})(Yf,Yf.exports);var os=Yf.exports,_c={},Qf={exports:{}};(function(s,e){e.__esModule=!0;var a=ui;e.default=function(o){o.registerHelper("blockHelperMissing",function(c,h){var f=h.inverse,i=h.fn;if(c===!0)return i(this);if(c===!1||c==null)return f(this);if(a.isArray(c))return c.length>0?(h.ids&&(h.ids=[h.name]),o.helpers.each(c,h)):f(this);if(h.data&&h.ids){var d=a.createFrame(h.data);d.contextPath=a.appendContextPath(h.data.contextPath,h.name),h={data:d}}return i(c,h)})},s.exports=e.default})(Qf,Qf.exports);var tS=Qf.exports,ed={exports:{}};(function(s,e){e.__esModule=!0;function a(f){return f&&f.__esModule?f:{default:f}}var o=ui,c=os,h=a(c);e.default=function(f){f.registerHelper("each",function(i,d){if(!d)throw new h.default("Must pass iterator to #each");var g=d.fn,b=d.inverse,k=0,x="",S=void 0,E=void 0;d.data&&d.ids&&(E=o.appendContextPath(d.data.contextPath,d.ids[0])+"."),o.isFunction(i)&&(i=i.call(this)),d.data&&(S=o.createFrame(d.data));function T($,q,J){S&&(S.key=$,S.index=q,S.first=q===0,S.last=!!J,E&&(S.contextPath=E+$)),x=x+g(i[$],{data:S,blockParams:o.blockParams([i[$],$],[E+$,null])})}if(i&&typeof i=="object")if(o.isArray(i))for(var A=i.length;k<A;k++)k in i&&T(k,k,k===i.length-1);else if(typeof Symbol=="function"&&i[Symbol.iterator]){for(var z=[],D=i[Symbol.iterator](),F=D.next();!F.done;F=D.next())z.push(F.value);i=z;for(var A=i.length;k<A;k++)T(k,k,k===i.length-1)}else(function(){var $=void 0;Object.keys(i).forEach(function(q){$!==void 0&&T($,k-1),$=q,k++}),$!==void 0&&T($,k-1,!0)})();return k===0&&(x=b(this)),x})},s.exports=e.default})(ed,ed.exports);var rS=ed.exports,td={exports:{}};(function(s,e){e.__esModule=!0;function a(h){return h&&h.__esModule?h:{default:h}}var o=os,c=a(o);e.default=function(h){h.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new c.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},s.exports=e.default})(td,td.exports);var iS=td.exports,rd={exports:{}};(function(s,e){e.__esModule=!0;function a(f){return f&&f.__esModule?f:{default:f}}var o=ui,c=os,h=a(c);e.default=function(f){f.registerHelper("if",function(i,d){if(arguments.length!=2)throw new h.default("#if requires exactly one argument");return o.isFunction(i)&&(i=i.call(this)),!d.hash.includeZero&&!i||o.isEmpty(i)?d.inverse(this):d.fn(this)}),f.registerHelper("unless",function(i,d){if(arguments.length!=2)throw new h.default("#unless requires exactly one argument");return f.helpers.if.call(this,i,{fn:d.inverse,inverse:d.fn,hash:d.hash})})},s.exports=e.default})(rd,rd.exports);var nS=rd.exports,id={exports:{}};(function(s,e){e.__esModule=!0,e.default=function(a){a.registerHelper("log",function(){for(var o=[void 0],c=arguments[arguments.length-1],h=0;h<arguments.length-1;h++)o.push(arguments[h]);var f=1;c.hash.level!=null?f=c.hash.level:c.data&&c.data.level!=null&&(f=c.data.level),o[0]=f,a.log.apply(a,o)})},s.exports=e.default})(id,id.exports);var sS=id.exports,nd={exports:{}};(function(s,e){e.__esModule=!0,e.default=function(a){a.registerHelper("lookup",function(o,c,h){return o&&h.lookupProperty(o,c)})},s.exports=e.default})(nd,nd.exports);var aS=nd.exports,sd={exports:{}};(function(s,e){e.__esModule=!0;function a(f){return f&&f.__esModule?f:{default:f}}var o=ui,c=os,h=a(c);e.default=function(f){f.registerHelper("with",function(i,d){if(arguments.length!=2)throw new h.default("#with requires exactly one argument");o.isFunction(i)&&(i=i.call(this));var g=d.fn;if(o.isEmpty(i))return d.inverse(this);var b=d.data;return d.data&&d.ids&&(b=o.createFrame(d.data),b.contextPath=o.appendContextPath(d.data.contextPath,d.ids[0])),g(i,{data:b,blockParams:o.blockParams([i],[b&&b.contextPath])})})},s.exports=e.default})(sd,sd.exports);var oS=sd.exports;_c.__esModule=!0;_c.registerDefaultHelpers=wS;_c.moveHelperToHooks=SS;function no(s){return s&&s.__esModule?s:{default:s}}var lS=tS,cS=no(lS),uS=rS,hS=no(uS),fS=iS,dS=no(fS),pS=nS,mS=no(pS),gS=sS,_S=no(gS),yS=aS,vS=no(yS),bS=oS,xS=no(bS);function wS(s){cS.default(s),hS.default(s),dS.default(s),mS.default(s),_S.default(s),vS.default(s),xS.default(s)}function SS(s,e,a){s.helpers[e]&&(s.hooks[e]=s.helpers[e],a||delete s.helpers[e])}var Dd={},ad={exports:{}};(function(s,e){e.__esModule=!0;var a=ui;e.default=function(o){o.registerDecorator("inline",function(c,h,f,i){var d=c;return h.partials||(h.partials={},d=function(g,b){var k=f.partials;f.partials=a.extend({},k,h.partials);var x=c(g,b);return f.partials=k,x}),h.partials[i.args[0]]=i.fn,d})},s.exports=e.default})(ad,ad.exports);var kS=ad.exports;Dd.__esModule=!0;Dd.registerDefaultDecorators=IS;function ES(s){return s&&s.__esModule?s:{default:s}}var TS=kS,CS=ES(TS);function IS(s){CS.default(s)}var od={exports:{}};(function(s,e){e.__esModule=!0;var a=ui,o={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(h){if(typeof h=="string"){var f=a.indexOf(o.methodMap,h.toLowerCase());f>=0?h=f:h=parseInt(h,10)}return h},log:function(h){if(h=o.lookupLevel(h),typeof console<"u"&&o.lookupLevel(o.level)<=h){var f=o.methodMap[h];console[f]||(f="log");for(var i=arguments.length,d=Array(i>1?i-1:0),g=1;g<i;g++)d[g-1]=arguments[g];console[f].apply(console,d)}}};e.default=o,s.exports=e.default})(od,od.exports);var d1=od.exports,Xo={},Ld={};Ld.__esModule=!0;Ld.createNewLookupObject=PS;var AS=ui;function PS(){for(var s=arguments.length,e=Array(s),a=0;a<s;a++)e[a]=arguments[a];return AS.extend.apply(void 0,[Object.create(null)].concat(e))}Xo.__esModule=!0;Xo.createProtoAccessControl=LS;Xo.resultIsAllowed=RS;Xo.resetLoggedProperties=BS;function MS(s){return s&&s.__esModule?s:{default:s}}var R_=Ld,zS=d1,DS=MS(zS),th=Object.create(null);function LS(s){var e=Object.create(null);e.constructor=!1,e.__defineGetter__=!1,e.__defineSetter__=!1,e.__lookupGetter__=!1;var a=Object.create(null);return a.__proto__=!1,{properties:{whitelist:R_.createNewLookupObject(a,s.allowedProtoProperties),defaultValue:s.allowProtoPropertiesByDefault},methods:{whitelist:R_.createNewLookupObject(e,s.allowedProtoMethods),defaultValue:s.allowProtoMethodsByDefault}}}function RS(s,e,a){return O_(typeof s=="function"?e.methods:e.properties,a)}function O_(s,e){return s.whitelist[e]!==void 0?s.whitelist[e]===!0:s.defaultValue!==void 0?s.defaultValue:(OS(e),!1)}function OS(s){th[s]!==!0&&(th[s]=!0,DS.default.log("error",'Handlebars: Access has been denied to resolve the property "'+s+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function BS(){Object.keys(th).forEach(function(s){delete th[s]})}Vn.__esModule=!0;Vn.HandlebarsEnvironment=ld;function p1(s){return s&&s.__esModule?s:{default:s}}var Ka=ui,NS=os,If=p1(NS),FS=_c,US=Dd,VS=d1,rh=p1(VS),$S=Xo,jS="4.7.8";Vn.VERSION=jS;var qS=8;Vn.COMPILER_REVISION=qS;var GS=7;Vn.LAST_COMPATIBLE_COMPILER_REVISION=GS;var ZS={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};Vn.REVISION_CHANGES=ZS;var Af="[object Object]";function ld(s,e,a){this.helpers=s||{},this.partials=e||{},this.decorators=a||{},FS.registerDefaultHelpers(this),US.registerDefaultDecorators(this)}ld.prototype={constructor:ld,logger:rh.default,log:rh.default.log,registerHelper:function(e,a){if(Ka.toString.call(e)===Af){if(a)throw new If.default("Arg not supported with multiple helpers");Ka.extend(this.helpers,e)}else this.helpers[e]=a},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,a){if(Ka.toString.call(e)===Af)Ka.extend(this.partials,e);else{if(typeof a>"u")throw new If.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=a}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,a){if(Ka.toString.call(e)===Af){if(a)throw new If.default("Arg not supported with multiple decorators");Ka.extend(this.decorators,e)}else this.decorators[e]=a},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){$S.resetLoggedProperties()}};var HS=rh.default.log;Vn.log=HS;Vn.createFrame=Ka.createFrame;Vn.logger=rh.default;var cd={exports:{}};(function(s,e){e.__esModule=!0;function a(o){this.string=o}a.prototype.toString=a.prototype.toHTML=function(){return""+this.string},e.default=a,s.exports=e.default})(cd,cd.exports);var WS=cd.exports,_a={},Rd={};Rd.__esModule=!0;Rd.wrapHelper=KS;function KS(s,e){if(typeof s!="function")return s;var a=function(){var c=arguments[arguments.length-1];return arguments[arguments.length-1]=e(c),s.apply(this,arguments)};return a}_a.__esModule=!0;_a.checkRevision=tk;_a.template=rk;_a.wrapProgram=ju;_a.resolvePartial=ik;_a.invokePartial=nk;_a.noop=m1;function XS(s){return s&&s.__esModule?s:{default:s}}function JS(s){if(s&&s.__esModule)return s;var e={};if(s!=null)for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);return e.default=s,e}var YS=ui,Vs=JS(YS),QS=os,$s=XS(QS),js=Vn,B_=_c,ek=Rd,N_=Xo;function tk(s){var e=s&&s[0]||1,a=js.COMPILER_REVISION;if(!(e>=js.LAST_COMPATIBLE_COMPILER_REVISION&&e<=js.COMPILER_REVISION))if(e<js.LAST_COMPATIBLE_COMPILER_REVISION){var o=js.REVISION_CHANGES[a],c=js.REVISION_CHANGES[e];throw new $s.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+o+") or downgrade your runtime to an older version ("+c+").")}else throw new $s.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+s[1]+").")}function rk(s,e){if(!e)throw new $s.default("No environment passed to template");if(!s||!s.main)throw new $s.default("Unknown template object: "+typeof s);s.main.decorator=s.main_d,e.VM.checkRevision(s.compiler);var a=s.compiler&&s.compiler[0]===7;function o(f,i,d){d.hash&&(i=Vs.extend({},i,d.hash),d.ids&&(d.ids[0]=!0)),f=e.VM.resolvePartial.call(this,f,i,d);var g=Vs.extend({},d,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),b=e.VM.invokePartial.call(this,f,i,g);if(b==null&&e.compile&&(d.partials[d.name]=e.compile(f,s.compilerOptions,e),b=d.partials[d.name](i,g)),b!=null){if(d.indent){for(var k=b.split(`
`),x=0,S=k.length;x<S&&!(!k[x]&&x+1===S);x++)k[x]=d.indent+k[x];b=k.join(`
`)}return b}else throw new $s.default("The partial "+d.name+" could not be compiled when running in runtime-only mode")}var c={strict:function(i,d,g){if(!i||!(d in i))throw new $s.default('"'+d+'" not defined in '+i,{loc:g});return c.lookupProperty(i,d)},lookupProperty:function(i,d){var g=i[d];if(g==null||Object.prototype.hasOwnProperty.call(i,d)||N_.resultIsAllowed(g,c.protoAccessControl,d))return g},lookup:function(i,d){for(var g=i.length,b=0;b<g;b++){var k=i[b]&&c.lookupProperty(i[b],d);if(k!=null)return i[b][d]}},lambda:function(i,d){return typeof i=="function"?i.call(d):i},escapeExpression:Vs.escapeExpression,invokePartial:o,fn:function(i){var d=s[i];return d.decorator=s[i+"_d"],d},programs:[],program:function(i,d,g,b,k){var x=this.programs[i],S=this.fn(i);return d||k||b||g?x=ju(this,i,S,d,g,b,k):x||(x=this.programs[i]=ju(this,i,S)),x},data:function(i,d){for(;i&&d--;)i=i._parent;return i},mergeIfNeeded:function(i,d){var g=i||d;return i&&d&&i!==d&&(g=Vs.extend({},d,i)),g},nullContext:Object.seal({}),noop:e.VM.noop,compilerInfo:s.compiler};function h(f){var i=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],d=i.data;h._setup(i),!i.partial&&s.useData&&(d=sk(f,d));var g=void 0,b=s.useBlockParams?[]:void 0;s.useDepths&&(i.depths?g=f!=i.depths[0]?[f].concat(i.depths):i.depths:g=[f]);function k(x){return""+s.main(c,x,c.helpers,c.partials,d,b,g)}return k=g1(s.main,k,c,i.depths||[],d,b),k(f,i)}return h.isTop=!0,h._setup=function(f){if(f.partial)c.protoAccessControl=f.protoAccessControl,c.helpers=f.helpers,c.partials=f.partials,c.decorators=f.decorators,c.hooks=f.hooks;else{var i=Vs.extend({},e.helpers,f.helpers);ak(i,c),c.helpers=i,s.usePartial&&(c.partials=c.mergeIfNeeded(f.partials,e.partials)),(s.usePartial||s.useDecorators)&&(c.decorators=Vs.extend({},e.decorators,f.decorators)),c.hooks={},c.protoAccessControl=N_.createProtoAccessControl(f);var d=f.allowCallsToHelperMissing||a;B_.moveHelperToHooks(c,"helperMissing",d),B_.moveHelperToHooks(c,"blockHelperMissing",d)}},h._child=function(f,i,d,g){if(s.useBlockParams&&!d)throw new $s.default("must pass block params");if(s.useDepths&&!g)throw new $s.default("must pass parent depths");return ju(c,f,s[f],i,0,d,g)},h}function ju(s,e,a,o,c,h,f){function i(d){var g=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],b=f;return f&&d!=f[0]&&!(d===s.nullContext&&f[0]===null)&&(b=[d].concat(f)),a(s,d,s.helpers,s.partials,g.data||o,h&&[g.blockParams].concat(h),b)}return i=g1(a,i,s,f,o,h),i.program=e,i.depth=f?f.length:0,i.blockParams=c||0,i}function ik(s,e,a){return s?!s.call&&!a.name&&(a.name=s,s=a.partials[s]):a.name==="@partial-block"?s=a.data["partial-block"]:s=a.partials[a.name],s}function nk(s,e,a){var o=a.data&&a.data["partial-block"];a.partial=!0,a.ids&&(a.data.contextPath=a.ids[0]||a.data.contextPath);var c=void 0;if(a.fn&&a.fn!==m1&&function(){a.data=js.createFrame(a.data);var h=a.fn;c=a.data["partial-block"]=function(i){var d=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return d.data=js.createFrame(d.data),d.data["partial-block"]=o,h(i,d)},h.partials&&(a.partials=Vs.extend({},a.partials,h.partials))}(),s===void 0&&c&&(s=c),s===void 0)throw new $s.default("The partial "+a.name+" could not be found");if(s instanceof Function)return s(e,a)}function m1(){return""}function sk(s,e){return(!e||!("root"in e))&&(e=e?js.createFrame(e):{},e.root=s),e}function g1(s,e,a,o,c,h){if(s.decorator){var f={};e=s.decorator(e,f,a,o&&o[0],c,h,o),Vs.extend(e,f)}return e}function ak(s,e){Object.keys(s).forEach(function(a){var o=s[a];s[a]=ok(o,e)})}function ok(s,e){var a=e.lookupProperty;return ek.wrapHelper(s,function(o){return Vs.extend({lookupProperty:a},o)})}var ud={exports:{}};(function(s,e){e.__esModule=!0,e.default=function(a){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var o=globalThis.Handlebars;a.noConflict=function(){return globalThis.Handlebars===a&&(globalThis.Handlebars=o),a}},s.exports=e.default})(ud,ud.exports);var _1=ud.exports;(function(s,e){e.__esModule=!0;function a(D){return D&&D.__esModule?D:{default:D}}function o(D){if(D&&D.__esModule)return D;var F={};if(D!=null)for(var $ in D)Object.prototype.hasOwnProperty.call(D,$)&&(F[$]=D[$]);return F.default=D,F}var c=Vn,h=o(c),f=WS,i=a(f),d=os,g=a(d),b=ui,k=o(b),x=_a,S=o(x),E=_1,T=a(E);function A(){var D=new h.HandlebarsEnvironment;return k.extend(D,h),D.SafeString=i.default,D.Exception=g.default,D.Utils=k,D.escapeExpression=k.escapeExpression,D.VM=S,D.template=function(F){return S.template(F,D)},D}var z=A();z.create=A,T.default(z),z.default=z,e.default=z,s.exports=e.default})(Xf,Xf.exports);var lk=Xf.exports,hd={exports:{}};(function(s,e){e.__esModule=!0;var a={helpers:{helperExpression:function(c){return c.type==="SubExpression"||(c.type==="MustacheStatement"||c.type==="BlockStatement")&&!!(c.params&&c.params.length||c.hash)},scopedId:function(c){return/^\.|this\b/.test(c.original)},simpleId:function(c){return c.parts.length===1&&!a.helpers.scopedId(c)&&!c.depth}}};e.default=a,s.exports=e.default})(hd,hd.exports);var y1=hd.exports,yc={},fd={exports:{}};(function(s,e){e.__esModule=!0;var a=function(){var o={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(i,d,g,b,k,x,S){var E=x.length-1;switch(k){case 1:return x[E-1];case 2:this.$=b.prepareProgram(x[E]);break;case 3:this.$=x[E];break;case 4:this.$=x[E];break;case 5:this.$=x[E];break;case 6:this.$=x[E];break;case 7:this.$=x[E];break;case 8:this.$=x[E];break;case 9:this.$={type:"CommentStatement",value:b.stripComment(x[E]),strip:b.stripFlags(x[E],x[E]),loc:b.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:x[E],value:x[E],loc:b.locInfo(this._$)};break;case 11:this.$=b.prepareRawBlock(x[E-2],x[E-1],x[E],this._$);break;case 12:this.$={path:x[E-3],params:x[E-2],hash:x[E-1]};break;case 13:this.$=b.prepareBlock(x[E-3],x[E-2],x[E-1],x[E],!1,this._$);break;case 14:this.$=b.prepareBlock(x[E-3],x[E-2],x[E-1],x[E],!0,this._$);break;case 15:this.$={open:x[E-5],path:x[E-4],params:x[E-3],hash:x[E-2],blockParams:x[E-1],strip:b.stripFlags(x[E-5],x[E])};break;case 16:this.$={path:x[E-4],params:x[E-3],hash:x[E-2],blockParams:x[E-1],strip:b.stripFlags(x[E-5],x[E])};break;case 17:this.$={path:x[E-4],params:x[E-3],hash:x[E-2],blockParams:x[E-1],strip:b.stripFlags(x[E-5],x[E])};break;case 18:this.$={strip:b.stripFlags(x[E-1],x[E-1]),program:x[E]};break;case 19:var T=b.prepareBlock(x[E-2],x[E-1],x[E],x[E],!1,this._$),A=b.prepareProgram([T],x[E-1].loc);A.chained=!0,this.$={strip:x[E-2].strip,program:A,chain:!0};break;case 20:this.$=x[E];break;case 21:this.$={path:x[E-1],strip:b.stripFlags(x[E-2],x[E])};break;case 22:this.$=b.prepareMustache(x[E-3],x[E-2],x[E-1],x[E-4],b.stripFlags(x[E-4],x[E]),this._$);break;case 23:this.$=b.prepareMustache(x[E-3],x[E-2],x[E-1],x[E-4],b.stripFlags(x[E-4],x[E]),this._$);break;case 24:this.$={type:"PartialStatement",name:x[E-3],params:x[E-2],hash:x[E-1],indent:"",strip:b.stripFlags(x[E-4],x[E]),loc:b.locInfo(this._$)};break;case 25:this.$=b.preparePartialBlock(x[E-2],x[E-1],x[E],this._$);break;case 26:this.$={path:x[E-3],params:x[E-2],hash:x[E-1],strip:b.stripFlags(x[E-4],x[E])};break;case 27:this.$=x[E];break;case 28:this.$=x[E];break;case 29:this.$={type:"SubExpression",path:x[E-3],params:x[E-2],hash:x[E-1],loc:b.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:x[E],loc:b.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:b.id(x[E-2]),value:x[E],loc:b.locInfo(this._$)};break;case 32:this.$=b.id(x[E-1]);break;case 33:this.$=x[E];break;case 34:this.$=x[E];break;case 35:this.$={type:"StringLiteral",value:x[E],original:x[E],loc:b.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(x[E]),original:Number(x[E]),loc:b.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:x[E]==="true",original:x[E]==="true",loc:b.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:b.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:b.locInfo(this._$)};break;case 40:this.$=x[E];break;case 41:this.$=x[E];break;case 42:this.$=b.preparePath(!0,x[E],this._$);break;case 43:this.$=b.preparePath(!1,x[E],this._$);break;case 44:x[E-2].push({part:b.id(x[E]),original:x[E],separator:x[E-1]}),this.$=x[E-2];break;case 45:this.$=[{part:b.id(x[E]),original:x[E]}];break;case 46:this.$=[];break;case 47:x[E-1].push(x[E]);break;case 48:this.$=[];break;case 49:x[E-1].push(x[E]);break;case 50:this.$=[];break;case 51:x[E-1].push(x[E]);break;case 58:this.$=[];break;case 59:x[E-1].push(x[E]);break;case 64:this.$=[];break;case 65:x[E-1].push(x[E]);break;case 70:this.$=[];break;case 71:x[E-1].push(x[E]);break;case 78:this.$=[];break;case 79:x[E-1].push(x[E]);break;case 82:this.$=[];break;case 83:x[E-1].push(x[E]);break;case 86:this.$=[];break;case 87:x[E-1].push(x[E]);break;case 90:this.$=[];break;case 91:x[E-1].push(x[E]);break;case 94:this.$=[];break;case 95:x[E-1].push(x[E]);break;case 98:this.$=[x[E]];break;case 99:x[E-1].push(x[E]);break;case 100:this.$=[x[E]];break;case 101:x[E-1].push(x[E]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(i,d){throw new Error(i)},parse:function(i){var d=this,g=[0],b=[null],k=[],x=this.table,S="",E=0,T=0;this.lexer.setInput(i),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc>"u"&&(this.lexer.yylloc={});var A=this.lexer.yylloc;k.push(A);var z=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function D(){var Ne;return Ne=d.lexer.lex()||1,typeof Ne!="number"&&(Ne=d.symbols_[Ne]||Ne),Ne}for(var F,$,q,J,G={},oe,de,Ee,ot;;){if($=g[g.length-1],this.defaultActions[$]?q=this.defaultActions[$]:((F===null||typeof F>"u")&&(F=D()),q=x[$]&&x[$][F]),typeof q>"u"||!q.length||!q[0]){var le="";{ot=[];for(oe in x[$])this.terminals_[oe]&&oe>2&&ot.push("'"+this.terminals_[oe]+"'");this.lexer.showPosition?le="Parse error on line "+(E+1)+`:
`+this.lexer.showPosition()+`
Expecting `+ot.join(", ")+", got '"+(this.terminals_[F]||F)+"'":le="Parse error on line "+(E+1)+": Unexpected "+(F==1?"end of input":"'"+(this.terminals_[F]||F)+"'"),this.parseError(le,{text:this.lexer.match,token:this.terminals_[F]||F,line:this.lexer.yylineno,loc:A,expected:ot})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+$+", token: "+F);switch(q[0]){case 1:g.push(F),b.push(this.lexer.yytext),k.push(this.lexer.yylloc),g.push(q[1]),F=null,T=this.lexer.yyleng,S=this.lexer.yytext,E=this.lexer.yylineno,A=this.lexer.yylloc;break;case 2:if(de=this.productions_[q[1]][1],G.$=b[b.length-de],G._$={first_line:k[k.length-(de||1)].first_line,last_line:k[k.length-1].last_line,first_column:k[k.length-(de||1)].first_column,last_column:k[k.length-1].last_column},z&&(G._$.range=[k[k.length-(de||1)].range[0],k[k.length-1].range[1]]),J=this.performAction.call(G,S,T,E,this.yy,q[1],b,k),typeof J<"u")return J;de&&(g=g.slice(0,-1*de*2),b=b.slice(0,-1*de),k=k.slice(0,-1*de)),g.push(this.productions_[q[1]][0]),b.push(G.$),k.push(G._$),Ee=x[g[g.length-2]][g[g.length-1]],g.push(Ee);break;case 3:return!0}}return!0}},c=function(){var f={EOF:1,parseError:function(d,g){if(this.yy.parser)this.yy.parser.parseError(d,g);else throw new Error(d)},setInput:function(d){return this._input=d,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var d=this._input[0];this.yytext+=d,this.yyleng++,this.offset++,this.match+=d,this.matched+=d;var g=d.match(/(?:\r\n?|\n).*/g);return g?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),d},unput:function(d){var g=d.length,b=d.split(/(?:\r\n?|\n)/g);this._input=d+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-g-1),this.offset-=g;var k=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),b.length-1&&(this.yylineno-=b.length-1);var x=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:b?(b.length===k.length?this.yylloc.first_column:0)+k[k.length-b.length].length-b[0].length:this.yylloc.first_column-g},this.options.ranges&&(this.yylloc.range=[x[0],x[0]+this.yyleng-g]),this},more:function(){return this._more=!0,this},less:function(d){this.unput(this.match.slice(d))},pastInput:function(){var d=this.matched.substr(0,this.matched.length-this.match.length);return(d.length>20?"...":"")+d.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var d=this.match;return d.length<20&&(d+=this._input.substr(0,20-d.length)),(d.substr(0,20)+(d.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var d=this.pastInput(),g=new Array(d.length+1).join("-");return d+this.upcomingInput()+`
`+g+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var d,g,b,k,x;this._more||(this.yytext="",this.match="");for(var S=this._currentRules(),E=0;E<S.length&&(b=this._input.match(this.rules[S[E]]),!(b&&(!g||b[0].length>g[0].length)&&(g=b,k=E,!this.options.flex)));E++);return g?(x=g[0].match(/(?:\r\n?|\n).*/g),x&&(this.yylineno+=x.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:x?x[x.length-1].length-x[x.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+g[0].length},this.yytext+=g[0],this.match+=g[0],this.matches=g,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(g[0].length),this.matched+=g[0],d=this.performAction.call(this,this.yy,this,S[k],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),d||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var d=this.next();return typeof d<"u"?d:this.lex()},begin:function(d){this.conditionStack.push(d)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(d){this.begin(d)}};return f.options={},f.performAction=function(d,g,b,k){function x(S,E){return g.yytext=g.yytext.substring(S,g.yyleng-E+S)}switch(b){case 0:if(g.yytext.slice(-2)==="\\\\"?(x(0,1),this.begin("mu")):g.yytext.slice(-1)==="\\"?(x(0,1),this.begin("emu")):this.begin("mu"),g.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(x(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(g.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return g.yytext=x(1,2).replace(/\\"/g,'"'),80;case 32:return g.yytext=x(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return g.yytext=g.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},f.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],f.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},f}();o.lexer=c;function h(){this.yy={}}return h.prototype=o,o.Parser=h,new h}();e.default=a,s.exports=e.default})(fd,fd.exports);var ck=fd.exports,dd={exports:{}},pd={exports:{}};(function(s,e){e.__esModule=!0;function a(g){return g&&g.__esModule?g:{default:g}}var o=os,c=a(o);function h(){this.parents=[]}h.prototype={constructor:h,mutating:!1,acceptKey:function(b,k){var x=this.accept(b[k]);if(this.mutating){if(x&&!h.prototype[x.type])throw new c.default('Unexpected node type "'+x.type+'" found when accepting '+k+" on "+b.type);b[k]=x}},acceptRequired:function(b,k){if(this.acceptKey(b,k),!b[k])throw new c.default(b.type+" requires "+k)},acceptArray:function(b){for(var k=0,x=b.length;k<x;k++)this.acceptKey(b,k),b[k]||(b.splice(k,1),k--,x--)},accept:function(b){if(b){if(!this[b.type])throw new c.default("Unknown type: "+b.type,b);this.current&&this.parents.unshift(this.current),this.current=b;var k=this[b.type](b);if(this.current=this.parents.shift(),!this.mutating||k)return k;if(k!==!1)return b}},Program:function(b){this.acceptArray(b.body)},MustacheStatement:f,Decorator:f,BlockStatement:i,DecoratorBlock:i,PartialStatement:d,PartialBlockStatement:function(b){d.call(this,b),this.acceptKey(b,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:f,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(b){this.acceptArray(b.pairs)},HashPair:function(b){this.acceptRequired(b,"value")}};function f(g){this.acceptRequired(g,"path"),this.acceptArray(g.params),this.acceptKey(g,"hash")}function i(g){f.call(this,g),this.acceptKey(g,"program"),this.acceptKey(g,"inverse")}function d(g){this.acceptRequired(g,"name"),this.acceptArray(g.params),this.acceptKey(g,"hash")}e.default=h,s.exports=e.default})(pd,pd.exports);var v1=pd.exports;(function(s,e){e.__esModule=!0;function a(b){return b&&b.__esModule?b:{default:b}}var o=v1,c=a(o);function h(){var b=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=b}h.prototype=new c.default,h.prototype.Program=function(b){var k=!this.options.ignoreStandalone,x=!this.isRootSeen;this.isRootSeen=!0;for(var S=b.body,E=0,T=S.length;E<T;E++){var A=S[E],z=this.accept(A);if(z){var D=f(S,E,x),F=i(S,E,x),$=z.openStandalone&&D,q=z.closeStandalone&&F,J=z.inlineStandalone&&D&&F;z.close&&d(S,E,!0),z.open&&g(S,E,!0),k&&J&&(d(S,E),g(S,E)&&A.type==="PartialStatement"&&(A.indent=/([ \t]+$)/.exec(S[E-1].original)[1])),k&&$&&(d((A.program||A.inverse).body),g(S,E)),k&&q&&(d(S,E),g((A.inverse||A.program).body))}}return b},h.prototype.BlockStatement=h.prototype.DecoratorBlock=h.prototype.PartialBlockStatement=function(b){this.accept(b.program),this.accept(b.inverse);var k=b.program||b.inverse,x=b.program&&b.inverse,S=x,E=x;if(x&&x.chained)for(S=x.body[0].program;E.chained;)E=E.body[E.body.length-1].program;var T={open:b.openStrip.open,close:b.closeStrip.close,openStandalone:i(k.body),closeStandalone:f((S||k).body)};if(b.openStrip.close&&d(k.body,null,!0),x){var A=b.inverseStrip;A.open&&g(k.body,null,!0),A.close&&d(S.body,null,!0),b.closeStrip.open&&g(E.body,null,!0),!this.options.ignoreStandalone&&f(k.body)&&i(S.body)&&(g(k.body),d(S.body))}else b.closeStrip.open&&g(k.body,null,!0);return T},h.prototype.Decorator=h.prototype.MustacheStatement=function(b){return b.strip},h.prototype.PartialStatement=h.prototype.CommentStatement=function(b){var k=b.strip||{};return{inlineStandalone:!0,open:k.open,close:k.close}};function f(b,k,x){k===void 0&&(k=b.length);var S=b[k-1],E=b[k-2];if(!S)return x;if(S.type==="ContentStatement")return(E||!x?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(S.original)}function i(b,k,x){k===void 0&&(k=-1);var S=b[k+1],E=b[k+2];if(!S)return x;if(S.type==="ContentStatement")return(E||!x?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(S.original)}function d(b,k,x){var S=b[k==null?0:k+1];if(!(!S||S.type!=="ContentStatement"||!x&&S.rightStripped)){var E=S.value;S.value=S.value.replace(x?/^\s+/:/^[ \t]*\r?\n?/,""),S.rightStripped=S.value!==E}}function g(b,k,x){var S=b[k==null?b.length-1:k-1];if(!(!S||S.type!=="ContentStatement"||!x&&S.leftStripped)){var E=S.value;return S.value=S.value.replace(x?/\s+$/:/[ \t]+$/,""),S.leftStripped=S.value!==E,S.leftStripped}}e.default=h,s.exports=e.default})(dd,dd.exports);var uk=dd.exports,$n={};$n.__esModule=!0;$n.SourceLocation=dk;$n.id=pk;$n.stripFlags=mk;$n.stripComment=gk;$n.preparePath=_k;$n.prepareMustache=yk;$n.prepareRawBlock=vk;$n.prepareBlock=bk;$n.prepareProgram=xk;$n.preparePartialBlock=wk;function hk(s){return s&&s.__esModule?s:{default:s}}var fk=os,Od=hk(fk);function Bd(s,e){if(e=e.path?e.path.original:e,s.path.original!==e){var a={loc:s.path.loc};throw new Od.default(s.path.original+" doesn't match "+e,a)}}function dk(s,e){this.source=s,this.start={line:e.first_line,column:e.first_column},this.end={line:e.last_line,column:e.last_column}}function pk(s){return/^\[.*\]$/.test(s)?s.substring(1,s.length-1):s}function mk(s,e){return{open:s.charAt(2)==="~",close:e.charAt(e.length-3)==="~"}}function gk(s){return s.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function _k(s,e,a){a=this.locInfo(a);for(var o=s?"@":"",c=[],h=0,f=0,i=e.length;f<i;f++){var d=e[f].part,g=e[f].original!==d;if(o+=(e[f].separator||"")+d,!g&&(d===".."||d==="."||d==="this")){if(c.length>0)throw new Od.default("Invalid path: "+o,{loc:a});d===".."&&h++}else c.push(d)}return{type:"PathExpression",data:s,depth:h,parts:c,original:o,loc:a}}function yk(s,e,a,o,c,h){var f=o.charAt(3)||o.charAt(2),i=f!=="{"&&f!=="&",d=/\*/.test(o);return{type:d?"Decorator":"MustacheStatement",path:s,params:e,hash:a,escaped:i,strip:c,loc:this.locInfo(h)}}function vk(s,e,a,o){Bd(s,a),o=this.locInfo(o);var c={type:"Program",body:e,strip:{},loc:o};return{type:"BlockStatement",path:s.path,params:s.params,hash:s.hash,program:c,openStrip:{},inverseStrip:{},closeStrip:{},loc:o}}function bk(s,e,a,o,c,h){o&&o.path&&Bd(s,o);var f=/\*/.test(s.open);e.blockParams=s.blockParams;var i=void 0,d=void 0;if(a){if(f)throw new Od.default("Unexpected inverse block on decorator",a);a.chain&&(a.program.body[0].closeStrip=o.strip),d=a.strip,i=a.program}return c&&(c=i,i=e,e=c),{type:f?"DecoratorBlock":"BlockStatement",path:s.path,params:s.params,hash:s.hash,program:e,inverse:i,openStrip:s.strip,inverseStrip:d,closeStrip:o&&o.strip,loc:this.locInfo(h)}}function xk(s,e){if(!e&&s.length){var a=s[0].loc,o=s[s.length-1].loc;a&&o&&(e={source:a.source,start:{line:a.start.line,column:a.start.column},end:{line:o.end.line,column:o.end.column}})}return{type:"Program",body:s,strip:{},loc:e}}function wk(s,e,a,o){return Bd(s,a),{type:"PartialBlockStatement",name:s.path,params:s.params,hash:s.hash,program:e,openStrip:s.strip,closeStrip:a&&a.strip,loc:this.locInfo(o)}}yc.__esModule=!0;yc.parseWithoutProcessing=x1;yc.parse=Pk;function Sk(s){if(s&&s.__esModule)return s;var e={};if(s!=null)for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);return e.default=s,e}function b1(s){return s&&s.__esModule?s:{default:s}}var kk=ck,md=b1(kk),Ek=uk,Tk=b1(Ek),Ck=$n,Ik=Sk(Ck),Ak=ui;yc.parser=md.default;var qu={};Ak.extend(qu,Ik);function x1(s,e){if(s.type==="Program")return s;md.default.yy=qu,qu.locInfo=function(o){return new qu.SourceLocation(e&&e.srcName,o)};var a=md.default.parse(s);return a}function Pk(s,e){var a=x1(s,e),o=new Tk.default(e);return o.accept(a)}var vc={};vc.__esModule=!0;vc.Compiler=gd;vc.precompile=Lk;vc.compile=Rk;function w1(s){return s&&s.__esModule?s:{default:s}}var Mk=os,nc=w1(Mk),uc=ui,zk=y1,Xl=w1(zk),Dk=[].slice;function gd(){}gd.prototype={compiler:gd,equals:function(e){var a=this.opcodes.length;if(e.opcodes.length!==a)return!1;for(var o=0;o<a;o++){var c=this.opcodes[o],h=e.opcodes[o];if(c.opcode!==h.opcode||!S1(c.args,h.args))return!1}a=this.children.length;for(var o=0;o<a;o++)if(!this.children[o].equals(e.children[o]))return!1;return!0},guid:0,compile:function(e,a){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=a,this.stringParams=a.stringParams,this.trackIds=a.trackIds,a.blockParams=a.blockParams||[],a.knownHelpers=uc.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},a.knownHelpers),this.accept(e)},compileProgram:function(e){var a=new this.compiler,o=a.compile(e,this.options),c=this.guid++;return this.usePartial=this.usePartial||o.usePartial,this.children[c]=o,this.useDepths=this.useDepths||o.useDepths,c},accept:function(e){if(!this[e.type])throw new nc.default("Unknown type: "+e.type,e);this.sourceNode.unshift(e);var a=this[e.type](e);return this.sourceNode.shift(),a},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var a=e.body,o=a.length,c=0;c<o;c++)this.accept(a[c]);return this.options.blockParams.shift(),this.isSimple=o===1,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){F_(e);var a=e.program,o=e.inverse;a=a&&this.compileProgram(a),o=o&&this.compileProgram(o);var c=this.classifySexpr(e);c==="helper"?this.helperSexpr(e,a,o):c==="simple"?(this.simpleSexpr(e),this.opcode("pushProgram",a),this.opcode("pushProgram",o),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,a,o),this.opcode("pushProgram",a),this.opcode("pushProgram",o),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(e){var a=e.program&&this.compileProgram(e.program),o=this.setupFullMustacheParams(e,a,void 0),c=e.path;this.useDecorators=!0,this.opcode("registerDecorator",o.length,c.original)},PartialStatement:function(e){this.usePartial=!0;var a=e.program;a&&(a=this.compileProgram(e.program));var o=e.params;if(o.length>1)throw new nc.default("Unsupported number of partial arguments: "+o.length,e);o.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):o.push({type:"PathExpression",parts:[],depth:0}));var c=e.name.original,h=e.name.type==="SubExpression";h&&this.accept(e.name),this.setupFullMustacheParams(e,a,void 0,!0);var f=e.indent||"";this.options.preventIndent&&f&&(this.opcode("appendContent",f),f=""),this.opcode("invokePartial",h,c,f),this.opcode("append")},PartialBlockStatement:function(e){this.PartialStatement(e)},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(e){this.DecoratorBlock(e)},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){F_(e);var a=this.classifySexpr(e);a==="simple"?this.simpleSexpr(e):a==="helper"?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,a,o){var c=e.path,h=c.parts[0],f=a!=null||o!=null;this.opcode("getContext",c.depth),this.opcode("pushProgram",a),this.opcode("pushProgram",o),c.strict=!0,this.accept(c),this.opcode("invokeAmbiguous",h,f)},simpleSexpr:function(e){var a=e.path;a.strict=!0,this.accept(a),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,a,o){var c=this.setupFullMustacheParams(e,a,o),h=e.path,f=h.parts[0];if(this.options.knownHelpers[f])this.opcode("invokeKnownHelper",c.length,f);else{if(this.options.knownHelpersOnly)throw new nc.default("You specified knownHelpersOnly, but used the unknown helper "+f,e);h.strict=!0,h.falsy=!0,this.accept(h),this.opcode("invokeHelper",c.length,h.original,Xl.default.helpers.simpleId(h))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var a=e.parts[0],o=Xl.default.helpers.scopedId(e),c=!e.depth&&!o&&this.blockParamIndex(a);c?this.opcode("lookupBlockParam",c,e.parts):a?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts,e.strict)):this.opcode("lookupOnContext",e.parts,e.falsy,e.strict,o):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var a=e.pairs,o=0,c=a.length;for(this.opcode("pushHash");o<c;o++)this.pushParam(a[o].value);for(;o--;)this.opcode("assignToHash",a[o].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:Dk.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var a=Xl.default.helpers.simpleId(e.path),o=a&&!!this.blockParamIndex(e.path.parts[0]),c=!o&&Xl.default.helpers.helperExpression(e),h=!o&&(c||a);if(h&&!c){var f=e.path.parts[0],i=this.options;i.knownHelpers[f]?c=!0:i.knownHelpersOnly&&(h=!1)}return c?"helper":h?"ambiguous":"simple"},pushParams:function(e){for(var a=0,o=e.length;a<o;a++)this.pushParam(e[a])},pushParam:function(e){var a=e.value!=null?e.value:e.original||"";if(this.stringParams)a.replace&&(a=a.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",a,e.type),e.type==="SubExpression"&&this.accept(e);else{if(this.trackIds){var o=void 0;if(e.parts&&!Xl.default.helpers.scopedId(e)&&!e.depth&&(o=this.blockParamIndex(e.parts[0])),o){var c=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",o,c)}else a=e.original||a,a.replace&&(a=a.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",e.type,a)}this.accept(e)}},setupFullMustacheParams:function(e,a,o,c){var h=e.params;return this.pushParams(h),this.opcode("pushProgram",a),this.opcode("pushProgram",o),e.hash?this.accept(e.hash):this.opcode("emptyHash",c),h},blockParamIndex:function(e){for(var a=0,o=this.options.blockParams.length;a<o;a++){var c=this.options.blockParams[a],h=c&&uc.indexOf(c,e);if(c&&h>=0)return[a,h]}}};function Lk(s,e,a){if(s==null||typeof s!="string"&&s.type!=="Program")throw new nc.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+s);e=e||{},"data"in e||(e.data=!0),e.compat&&(e.useDepths=!0);var o=a.parse(s,e),c=new a.Compiler().compile(o,e);return new a.JavaScriptCompiler().compile(c,e)}function Rk(s,e,a){if(e===void 0&&(e={}),s==null||typeof s!="string"&&s.type!=="Program")throw new nc.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+s);e=uc.extend({},e),"data"in e||(e.data=!0),e.compat&&(e.useDepths=!0);var o=void 0;function c(){var f=a.parse(s,e),i=new a.Compiler().compile(f,e),d=new a.JavaScriptCompiler().compile(i,e,void 0,!0);return a.template(d)}function h(f,i){return o||(o=c()),o.call(this,f,i)}return h._setup=function(f){return o||(o=c()),o._setup(f)},h._child=function(f,i,d,g){return o||(o=c()),o._child(f,i,d,g)},h}function S1(s,e){if(s===e)return!0;if(uc.isArray(s)&&uc.isArray(e)&&s.length===e.length){for(var a=0;a<s.length;a++)if(!S1(s[a],e[a]))return!1;return!0}}function F_(s){if(!s.path.parts){var e=s.path;s.path={type:"PathExpression",data:!1,depth:0,parts:[e.original+""],original:e.original+"",loc:e.loc}}}var _d={exports:{}},yd={exports:{}},Jl={},Pf={},Du={},Lu={},U_;function Ok(){if(U_)return Lu;U_=1;var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return Lu.encode=function(e){if(0<=e&&e<s.length)return s[e];throw new TypeError("Must be between 0 and 63: "+e)},Lu.decode=function(e){var a=65,o=90,c=97,h=122,f=48,i=57,d=43,g=47,b=26,k=52;return a<=e&&e<=o?e-a:c<=e&&e<=h?e-c+b:f<=e&&e<=i?e-f+k:e==d?62:e==g?63:-1},Lu}var V_;function k1(){if(V_)return Du;V_=1;var s=Ok(),e=5,a=1<<e,o=a-1,c=a;function h(i){return i<0?(-i<<1)+1:(i<<1)+0}function f(i){var d=(i&1)===1,g=i>>1;return d?-g:g}return Du.encode=function(d){var g="",b,k=h(d);do b=k&o,k>>>=e,k>0&&(b|=c),g+=s.encode(b);while(k>0);return g},Du.decode=function(d,g,b){var k=d.length,x=0,S=0,E,T;do{if(g>=k)throw new Error("Expected more digits in base 64 VLQ value.");if(T=s.decode(d.charCodeAt(g++)),T===-1)throw new Error("Invalid base64 digit: "+d.charAt(g-1));E=!!(T&c),T&=o,x=x+(T<<S),S+=e}while(E);b.value=f(x),b.rest=g},Du}var Mf={},$_;function bc(){return $_||($_=1,function(s){function e($,q,J){if(q in $)return $[q];if(arguments.length===3)return J;throw new Error('"'+q+'" is a required argument.')}s.getArg=e;var a=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,o=/^data:.+\,.+$/;function c($){var q=$.match(a);return q?{scheme:q[1],auth:q[2],host:q[3],port:q[4],path:q[5]}:null}s.urlParse=c;function h($){var q="";return $.scheme&&(q+=$.scheme+":"),q+="//",$.auth&&(q+=$.auth+"@"),$.host&&(q+=$.host),$.port&&(q+=":"+$.port),$.path&&(q+=$.path),q}s.urlGenerate=h;function f($){var q=$,J=c($);if(J){if(!J.path)return $;q=J.path}for(var G=s.isAbsolute(q),oe=q.split(/\/+/),de,Ee=0,ot=oe.length-1;ot>=0;ot--)de=oe[ot],de==="."?oe.splice(ot,1):de===".."?Ee++:Ee>0&&(de===""?(oe.splice(ot+1,Ee),Ee=0):(oe.splice(ot,2),Ee--));return q=oe.join("/"),q===""&&(q=G?"/":"."),J?(J.path=q,h(J)):q}s.normalize=f;function i($,q){$===""&&($="."),q===""&&(q=".");var J=c(q),G=c($);if(G&&($=G.path||"/"),J&&!J.scheme)return G&&(J.scheme=G.scheme),h(J);if(J||q.match(o))return q;if(G&&!G.host&&!G.path)return G.host=q,h(G);var oe=q.charAt(0)==="/"?q:f($.replace(/\/+$/,"")+"/"+q);return G?(G.path=oe,h(G)):oe}s.join=i,s.isAbsolute=function($){return $.charAt(0)==="/"||a.test($)};function d($,q){$===""&&($="."),$=$.replace(/\/$/,"");for(var J=0;q.indexOf($+"/")!==0;){var G=$.lastIndexOf("/");if(G<0||($=$.slice(0,G),$.match(/^([^\/]+:\/)?\/*$/)))return q;++J}return Array(J+1).join("../")+q.substr($.length+1)}s.relative=d;var g=function(){var $=Object.create(null);return!("__proto__"in $)}();function b($){return $}function k($){return S($)?"$"+$:$}s.toSetString=g?b:k;function x($){return S($)?$.slice(1):$}s.fromSetString=g?b:x;function S($){if(!$)return!1;var q=$.length;if(q<9||$.charCodeAt(q-1)!==95||$.charCodeAt(q-2)!==95||$.charCodeAt(q-3)!==111||$.charCodeAt(q-4)!==116||$.charCodeAt(q-5)!==111||$.charCodeAt(q-6)!==114||$.charCodeAt(q-7)!==112||$.charCodeAt(q-8)!==95||$.charCodeAt(q-9)!==95)return!1;for(var J=q-10;J>=0;J--)if($.charCodeAt(J)!==36)return!1;return!0}function E($,q,J){var G=A($.source,q.source);return G!==0||(G=$.originalLine-q.originalLine,G!==0)||(G=$.originalColumn-q.originalColumn,G!==0||J)||(G=$.generatedColumn-q.generatedColumn,G!==0)||(G=$.generatedLine-q.generatedLine,G!==0)?G:A($.name,q.name)}s.compareByOriginalPositions=E;function T($,q,J){var G=$.generatedLine-q.generatedLine;return G!==0||(G=$.generatedColumn-q.generatedColumn,G!==0||J)||(G=A($.source,q.source),G!==0)||(G=$.originalLine-q.originalLine,G!==0)||(G=$.originalColumn-q.originalColumn,G!==0)?G:A($.name,q.name)}s.compareByGeneratedPositionsDeflated=T;function A($,q){return $===q?0:$===null?1:q===null?-1:$>q?1:-1}function z($,q){var J=$.generatedLine-q.generatedLine;return J!==0||(J=$.generatedColumn-q.generatedColumn,J!==0)||(J=A($.source,q.source),J!==0)||(J=$.originalLine-q.originalLine,J!==0)||(J=$.originalColumn-q.originalColumn,J!==0)?J:A($.name,q.name)}s.compareByGeneratedPositionsInflated=z;function D($){return JSON.parse($.replace(/^\)]}'[^\n]*\n/,""))}s.parseSourceMapInput=D;function F($,q,J){if(q=q||"",$&&($[$.length-1]!=="/"&&q[0]!=="/"&&($+="/"),q=$+q),J){var G=c(J);if(!G)throw new Error("sourceMapURL could not be parsed");if(G.path){var oe=G.path.lastIndexOf("/");oe>=0&&(G.path=G.path.substring(0,oe+1))}q=i(h(G),q)}return f(q)}s.computeSourceURL=F}(Mf)),Mf}var zf={},j_;function E1(){if(j_)return zf;j_=1;var s=bc(),e=Object.prototype.hasOwnProperty,a=typeof Map<"u";function o(){this._array=[],this._set=a?new Map:Object.create(null)}return o.fromArray=function(h,f){for(var i=new o,d=0,g=h.length;d<g;d++)i.add(h[d],f);return i},o.prototype.size=function(){return a?this._set.size:Object.getOwnPropertyNames(this._set).length},o.prototype.add=function(h,f){var i=a?h:s.toSetString(h),d=a?this.has(h):e.call(this._set,i),g=this._array.length;(!d||f)&&this._array.push(h),d||(a?this._set.set(h,g):this._set[i]=g)},o.prototype.has=function(h){if(a)return this._set.has(h);var f=s.toSetString(h);return e.call(this._set,f)},o.prototype.indexOf=function(h){if(a){var f=this._set.get(h);if(f>=0)return f}else{var i=s.toSetString(h);if(e.call(this._set,i))return this._set[i]}throw new Error('"'+h+'" is not in the set.')},o.prototype.at=function(h){if(h>=0&&h<this._array.length)return this._array[h];throw new Error("No element indexed by "+h)},o.prototype.toArray=function(){return this._array.slice()},zf.ArraySet=o,zf}var Df={},q_;function Bk(){if(q_)return Df;q_=1;var s=bc();function e(o,c){var h=o.generatedLine,f=c.generatedLine,i=o.generatedColumn,d=c.generatedColumn;return f>h||f==h&&d>=i||s.compareByGeneratedPositionsInflated(o,c)<=0}function a(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return a.prototype.unsortedForEach=function(c,h){this._array.forEach(c,h)},a.prototype.add=function(c){e(this._last,c)?(this._last=c,this._array.push(c)):(this._sorted=!1,this._array.push(c))},a.prototype.toArray=function(){return this._sorted||(this._array.sort(s.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},Df.MappingList=a,Df}var G_;function T1(){if(G_)return Pf;G_=1;var s=k1(),e=bc(),a=E1().ArraySet,o=Bk().MappingList;function c(h){h||(h={}),this._file=e.getArg(h,"file",null),this._sourceRoot=e.getArg(h,"sourceRoot",null),this._skipValidation=e.getArg(h,"skipValidation",!1),this._sources=new a,this._names=new a,this._mappings=new o,this._sourcesContents=null}return c.prototype._version=3,c.fromSourceMap=function(f){var i=f.sourceRoot,d=new c({file:f.file,sourceRoot:i});return f.eachMapping(function(g){var b={generated:{line:g.generatedLine,column:g.generatedColumn}};g.source!=null&&(b.source=g.source,i!=null&&(b.source=e.relative(i,b.source)),b.original={line:g.originalLine,column:g.originalColumn},g.name!=null&&(b.name=g.name)),d.addMapping(b)}),f.sources.forEach(function(g){var b=g;i!==null&&(b=e.relative(i,g)),d._sources.has(b)||d._sources.add(b);var k=f.sourceContentFor(g);k!=null&&d.setSourceContent(g,k)}),d},c.prototype.addMapping=function(f){var i=e.getArg(f,"generated"),d=e.getArg(f,"original",null),g=e.getArg(f,"source",null),b=e.getArg(f,"name",null);this._skipValidation||this._validateMapping(i,d,g,b),g!=null&&(g=String(g),this._sources.has(g)||this._sources.add(g)),b!=null&&(b=String(b),this._names.has(b)||this._names.add(b)),this._mappings.add({generatedLine:i.line,generatedColumn:i.column,originalLine:d!=null&&d.line,originalColumn:d!=null&&d.column,source:g,name:b})},c.prototype.setSourceContent=function(f,i){var d=f;this._sourceRoot!=null&&(d=e.relative(this._sourceRoot,d)),i!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(d)]=i):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(d)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},c.prototype.applySourceMap=function(f,i,d){var g=i;if(i==null){if(f.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);g=f.file}var b=this._sourceRoot;b!=null&&(g=e.relative(b,g));var k=new a,x=new a;this._mappings.unsortedForEach(function(S){if(S.source===g&&S.originalLine!=null){var E=f.originalPositionFor({line:S.originalLine,column:S.originalColumn});E.source!=null&&(S.source=E.source,d!=null&&(S.source=e.join(d,S.source)),b!=null&&(S.source=e.relative(b,S.source)),S.originalLine=E.line,S.originalColumn=E.column,E.name!=null&&(S.name=E.name))}var T=S.source;T!=null&&!k.has(T)&&k.add(T);var A=S.name;A!=null&&!x.has(A)&&x.add(A)},this),this._sources=k,this._names=x,f.sources.forEach(function(S){var E=f.sourceContentFor(S);E!=null&&(d!=null&&(S=e.join(d,S)),b!=null&&(S=e.relative(b,S)),this.setSourceContent(S,E))},this)},c.prototype._validateMapping=function(f,i,d,g){if(i&&typeof i.line!="number"&&typeof i.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(f&&"line"in f&&"column"in f&&f.line>0&&f.column>=0&&!i&&!d&&!g)){if(f&&"line"in f&&"column"in f&&i&&"line"in i&&"column"in i&&f.line>0&&f.column>=0&&i.line>0&&i.column>=0&&d)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:f,source:d,original:i,name:g}))}},c.prototype._serializeMappings=function(){for(var f=0,i=1,d=0,g=0,b=0,k=0,x="",S,E,T,A,z=this._mappings.toArray(),D=0,F=z.length;D<F;D++){if(E=z[D],S="",E.generatedLine!==i)for(f=0;E.generatedLine!==i;)S+=";",i++;else if(D>0){if(!e.compareByGeneratedPositionsInflated(E,z[D-1]))continue;S+=","}S+=s.encode(E.generatedColumn-f),f=E.generatedColumn,E.source!=null&&(A=this._sources.indexOf(E.source),S+=s.encode(A-k),k=A,S+=s.encode(E.originalLine-1-g),g=E.originalLine-1,S+=s.encode(E.originalColumn-d),d=E.originalColumn,E.name!=null&&(T=this._names.indexOf(E.name),S+=s.encode(T-b),b=T)),x+=S}return x},c.prototype._generateSourcesContent=function(f,i){return f.map(function(d){if(!this._sourcesContents)return null;i!=null&&(d=e.relative(i,d));var g=e.toSetString(d);return Object.prototype.hasOwnProperty.call(this._sourcesContents,g)?this._sourcesContents[g]:null},this)},c.prototype.toJSON=function(){var f={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(f.file=this._file),this._sourceRoot!=null&&(f.sourceRoot=this._sourceRoot),this._sourcesContents&&(f.sourcesContent=this._generateSourcesContent(f.sources,f.sourceRoot)),f},c.prototype.toString=function(){return JSON.stringify(this.toJSON())},Pf.SourceMapGenerator=c,Pf}var Yl={},Lf={},Z_;function Nk(){return Z_||(Z_=1,function(s){s.GREATEST_LOWER_BOUND=1,s.LEAST_UPPER_BOUND=2;function e(a,o,c,h,f,i){var d=Math.floor((o-a)/2)+a,g=f(c,h[d],!0);return g===0?d:g>0?o-d>1?e(d,o,c,h,f,i):i==s.LEAST_UPPER_BOUND?o<h.length?o:-1:d:d-a>1?e(a,d,c,h,f,i):i==s.LEAST_UPPER_BOUND?d:a<0?-1:a}s.search=function(o,c,h,f){if(c.length===0)return-1;var i=e(-1,c.length,o,c,h,f||s.GREATEST_LOWER_BOUND);if(i<0)return-1;for(;i-1>=0&&h(c[i],c[i-1],!0)===0;)--i;return i}}(Lf)),Lf}var Rf={},H_;function Fk(){if(H_)return Rf;H_=1;function s(o,c,h){var f=o[c];o[c]=o[h],o[h]=f}function e(o,c){return Math.round(o+Math.random()*(c-o))}function a(o,c,h,f){if(h<f){var i=e(h,f),d=h-1;s(o,i,f);for(var g=o[f],b=h;b<f;b++)c(o[b],g)<=0&&(d+=1,s(o,d,b));s(o,d+1,b);var k=d+1;a(o,c,h,k-1),a(o,c,k+1,f)}}return Rf.quickSort=function(o,c){a(o,c,0,o.length-1)},Rf}var W_;function Uk(){if(W_)return Yl;W_=1;var s=bc(),e=Nk(),a=E1().ArraySet,o=k1(),c=Fk().quickSort;function h(g,b){var k=g;return typeof g=="string"&&(k=s.parseSourceMapInput(g)),k.sections!=null?new d(k,b):new f(k,b)}h.fromSourceMap=function(g,b){return f.fromSourceMap(g,b)},h.prototype._version=3,h.prototype.__generatedMappings=null,Object.defineProperty(h.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),h.prototype.__originalMappings=null,Object.defineProperty(h.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),h.prototype._charIsMappingSeparator=function(b,k){var x=b.charAt(k);return x===";"||x===","},h.prototype._parseMappings=function(b,k){throw new Error("Subclasses must implement _parseMappings")},h.GENERATED_ORDER=1,h.ORIGINAL_ORDER=2,h.GREATEST_LOWER_BOUND=1,h.LEAST_UPPER_BOUND=2,h.prototype.eachMapping=function(b,k,x){var S=k||null,E=x||h.GENERATED_ORDER,T;switch(E){case h.GENERATED_ORDER:T=this._generatedMappings;break;case h.ORIGINAL_ORDER:T=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var A=this.sourceRoot;T.map(function(z){var D=z.source===null?null:this._sources.at(z.source);return D=s.computeSourceURL(A,D,this._sourceMapURL),{source:D,generatedLine:z.generatedLine,generatedColumn:z.generatedColumn,originalLine:z.originalLine,originalColumn:z.originalColumn,name:z.name===null?null:this._names.at(z.name)}},this).forEach(b,S)},h.prototype.allGeneratedPositionsFor=function(b){var k=s.getArg(b,"line"),x={source:s.getArg(b,"source"),originalLine:k,originalColumn:s.getArg(b,"column",0)};if(x.source=this._findSourceIndex(x.source),x.source<0)return[];var S=[],E=this._findMapping(x,this._originalMappings,"originalLine","originalColumn",s.compareByOriginalPositions,e.LEAST_UPPER_BOUND);if(E>=0){var T=this._originalMappings[E];if(b.column===void 0)for(var A=T.originalLine;T&&T.originalLine===A;)S.push({line:s.getArg(T,"generatedLine",null),column:s.getArg(T,"generatedColumn",null),lastColumn:s.getArg(T,"lastGeneratedColumn",null)}),T=this._originalMappings[++E];else for(var z=T.originalColumn;T&&T.originalLine===k&&T.originalColumn==z;)S.push({line:s.getArg(T,"generatedLine",null),column:s.getArg(T,"generatedColumn",null),lastColumn:s.getArg(T,"lastGeneratedColumn",null)}),T=this._originalMappings[++E]}return S},Yl.SourceMapConsumer=h;function f(g,b){var k=g;typeof g=="string"&&(k=s.parseSourceMapInput(g));var x=s.getArg(k,"version"),S=s.getArg(k,"sources"),E=s.getArg(k,"names",[]),T=s.getArg(k,"sourceRoot",null),A=s.getArg(k,"sourcesContent",null),z=s.getArg(k,"mappings"),D=s.getArg(k,"file",null);if(x!=this._version)throw new Error("Unsupported version: "+x);T&&(T=s.normalize(T)),S=S.map(String).map(s.normalize).map(function(F){return T&&s.isAbsolute(T)&&s.isAbsolute(F)?s.relative(T,F):F}),this._names=a.fromArray(E.map(String),!0),this._sources=a.fromArray(S,!0),this._absoluteSources=this._sources.toArray().map(function(F){return s.computeSourceURL(T,F,b)}),this.sourceRoot=T,this.sourcesContent=A,this._mappings=z,this._sourceMapURL=b,this.file=D}f.prototype=Object.create(h.prototype),f.prototype.consumer=h,f.prototype._findSourceIndex=function(g){var b=g;if(this.sourceRoot!=null&&(b=s.relative(this.sourceRoot,b)),this._sources.has(b))return this._sources.indexOf(b);var k;for(k=0;k<this._absoluteSources.length;++k)if(this._absoluteSources[k]==g)return k;return-1},f.fromSourceMap=function(b,k){var x=Object.create(f.prototype),S=x._names=a.fromArray(b._names.toArray(),!0),E=x._sources=a.fromArray(b._sources.toArray(),!0);x.sourceRoot=b._sourceRoot,x.sourcesContent=b._generateSourcesContent(x._sources.toArray(),x.sourceRoot),x.file=b._file,x._sourceMapURL=k,x._absoluteSources=x._sources.toArray().map(function(J){return s.computeSourceURL(x.sourceRoot,J,k)});for(var T=b._mappings.toArray().slice(),A=x.__generatedMappings=[],z=x.__originalMappings=[],D=0,F=T.length;D<F;D++){var $=T[D],q=new i;q.generatedLine=$.generatedLine,q.generatedColumn=$.generatedColumn,$.source&&(q.source=E.indexOf($.source),q.originalLine=$.originalLine,q.originalColumn=$.originalColumn,$.name&&(q.name=S.indexOf($.name)),z.push(q)),A.push(q)}return c(x.__originalMappings,s.compareByOriginalPositions),x},f.prototype._version=3,Object.defineProperty(f.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function i(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}f.prototype._parseMappings=function(b,k){for(var x=1,S=0,E=0,T=0,A=0,z=0,D=b.length,F=0,$={},q={},J=[],G=[],oe,de,Ee,ot,le;F<D;)if(b.charAt(F)===";")x++,F++,S=0;else if(b.charAt(F)===",")F++;else{for(oe=new i,oe.generatedLine=x,ot=F;ot<D&&!this._charIsMappingSeparator(b,ot);ot++);if(de=b.slice(F,ot),Ee=$[de],Ee)F+=de.length;else{for(Ee=[];F<ot;)o.decode(b,F,q),le=q.value,F=q.rest,Ee.push(le);if(Ee.length===2)throw new Error("Found a source, but no line and column");if(Ee.length===3)throw new Error("Found a source and line, but no column");$[de]=Ee}oe.generatedColumn=S+Ee[0],S=oe.generatedColumn,Ee.length>1&&(oe.source=A+Ee[1],A+=Ee[1],oe.originalLine=E+Ee[2],E=oe.originalLine,oe.originalLine+=1,oe.originalColumn=T+Ee[3],T=oe.originalColumn,Ee.length>4&&(oe.name=z+Ee[4],z+=Ee[4])),G.push(oe),typeof oe.originalLine=="number"&&J.push(oe)}c(G,s.compareByGeneratedPositionsDeflated),this.__generatedMappings=G,c(J,s.compareByOriginalPositions),this.__originalMappings=J},f.prototype._findMapping=function(b,k,x,S,E,T){if(b[x]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+b[x]);if(b[S]<0)throw new TypeError("Column must be greater than or equal to 0, got "+b[S]);return e.search(b,k,E,T)},f.prototype.computeColumnSpans=function(){for(var b=0;b<this._generatedMappings.length;++b){var k=this._generatedMappings[b];if(b+1<this._generatedMappings.length){var x=this._generatedMappings[b+1];if(k.generatedLine===x.generatedLine){k.lastGeneratedColumn=x.generatedColumn-1;continue}}k.lastGeneratedColumn=1/0}},f.prototype.originalPositionFor=function(b){var k={generatedLine:s.getArg(b,"line"),generatedColumn:s.getArg(b,"column")},x=this._findMapping(k,this._generatedMappings,"generatedLine","generatedColumn",s.compareByGeneratedPositionsDeflated,s.getArg(b,"bias",h.GREATEST_LOWER_BOUND));if(x>=0){var S=this._generatedMappings[x];if(S.generatedLine===k.generatedLine){var E=s.getArg(S,"source",null);E!==null&&(E=this._sources.at(E),E=s.computeSourceURL(this.sourceRoot,E,this._sourceMapURL));var T=s.getArg(S,"name",null);return T!==null&&(T=this._names.at(T)),{source:E,line:s.getArg(S,"originalLine",null),column:s.getArg(S,"originalColumn",null),name:T}}}return{source:null,line:null,column:null,name:null}},f.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(b){return b==null}):!1},f.prototype.sourceContentFor=function(b,k){if(!this.sourcesContent)return null;var x=this._findSourceIndex(b);if(x>=0)return this.sourcesContent[x];var S=b;this.sourceRoot!=null&&(S=s.relative(this.sourceRoot,S));var E;if(this.sourceRoot!=null&&(E=s.urlParse(this.sourceRoot))){var T=S.replace(/^file:\/\//,"");if(E.scheme=="file"&&this._sources.has(T))return this.sourcesContent[this._sources.indexOf(T)];if((!E.path||E.path=="/")&&this._sources.has("/"+S))return this.sourcesContent[this._sources.indexOf("/"+S)]}if(k)return null;throw new Error('"'+S+'" is not in the SourceMap.')},f.prototype.generatedPositionFor=function(b){var k=s.getArg(b,"source");if(k=this._findSourceIndex(k),k<0)return{line:null,column:null,lastColumn:null};var x={source:k,originalLine:s.getArg(b,"line"),originalColumn:s.getArg(b,"column")},S=this._findMapping(x,this._originalMappings,"originalLine","originalColumn",s.compareByOriginalPositions,s.getArg(b,"bias",h.GREATEST_LOWER_BOUND));if(S>=0){var E=this._originalMappings[S];if(E.source===x.source)return{line:s.getArg(E,"generatedLine",null),column:s.getArg(E,"generatedColumn",null),lastColumn:s.getArg(E,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},Yl.BasicSourceMapConsumer=f;function d(g,b){var k=g;typeof g=="string"&&(k=s.parseSourceMapInput(g));var x=s.getArg(k,"version"),S=s.getArg(k,"sections");if(x!=this._version)throw new Error("Unsupported version: "+x);this._sources=new a,this._names=new a;var E={line:-1,column:0};this._sections=S.map(function(T){if(T.url)throw new Error("Support for url field in sections not implemented.");var A=s.getArg(T,"offset"),z=s.getArg(A,"line"),D=s.getArg(A,"column");if(z<E.line||z===E.line&&D<E.column)throw new Error("Section offsets must be ordered and non-overlapping.");return E=A,{generatedOffset:{generatedLine:z+1,generatedColumn:D+1},consumer:new h(s.getArg(T,"map"),b)}})}return d.prototype=Object.create(h.prototype),d.prototype.constructor=h,d.prototype._version=3,Object.defineProperty(d.prototype,"sources",{get:function(){for(var g=[],b=0;b<this._sections.length;b++)for(var k=0;k<this._sections[b].consumer.sources.length;k++)g.push(this._sections[b].consumer.sources[k]);return g}}),d.prototype.originalPositionFor=function(b){var k={generatedLine:s.getArg(b,"line"),generatedColumn:s.getArg(b,"column")},x=e.search(k,this._sections,function(E,T){var A=E.generatedLine-T.generatedOffset.generatedLine;return A||E.generatedColumn-T.generatedOffset.generatedColumn}),S=this._sections[x];return S?S.consumer.originalPositionFor({line:k.generatedLine-(S.generatedOffset.generatedLine-1),column:k.generatedColumn-(S.generatedOffset.generatedLine===k.generatedLine?S.generatedOffset.generatedColumn-1:0),bias:b.bias}):{source:null,line:null,column:null,name:null}},d.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(b){return b.consumer.hasContentsOfAllSources()})},d.prototype.sourceContentFor=function(b,k){for(var x=0;x<this._sections.length;x++){var S=this._sections[x],E=S.consumer.sourceContentFor(b,!0);if(E)return E}if(k)return null;throw new Error('"'+b+'" is not in the SourceMap.')},d.prototype.generatedPositionFor=function(b){for(var k=0;k<this._sections.length;k++){var x=this._sections[k];if(x.consumer._findSourceIndex(s.getArg(b,"source"))!==-1){var S=x.consumer.generatedPositionFor(b);if(S){var E={line:S.line+(x.generatedOffset.generatedLine-1),column:S.column+(x.generatedOffset.generatedLine===S.line?x.generatedOffset.generatedColumn-1:0)};return E}}}return{line:null,column:null}},d.prototype._parseMappings=function(b,k){this.__generatedMappings=[],this.__originalMappings=[];for(var x=0;x<this._sections.length;x++)for(var S=this._sections[x],E=S.consumer._generatedMappings,T=0;T<E.length;T++){var A=E[T],z=S.consumer._sources.at(A.source);z=s.computeSourceURL(S.consumer.sourceRoot,z,this._sourceMapURL),this._sources.add(z),z=this._sources.indexOf(z);var D=null;A.name&&(D=S.consumer._names.at(A.name),this._names.add(D),D=this._names.indexOf(D));var F={source:z,generatedLine:A.generatedLine+(S.generatedOffset.generatedLine-1),generatedColumn:A.generatedColumn+(S.generatedOffset.generatedLine===A.generatedLine?S.generatedOffset.generatedColumn-1:0),originalLine:A.originalLine,originalColumn:A.originalColumn,name:D};this.__generatedMappings.push(F),typeof F.originalLine=="number"&&this.__originalMappings.push(F)}c(this.__generatedMappings,s.compareByGeneratedPositionsDeflated),c(this.__originalMappings,s.compareByOriginalPositions)},Yl.IndexedSourceMapConsumer=d,Yl}var Of={},K_;function Vk(){if(K_)return Of;K_=1;var s=T1().SourceMapGenerator,e=bc(),a=/(\r?\n)/,o=10,c="$$$isSourceNode$$$";function h(f,i,d,g,b){this.children=[],this.sourceContents={},this.line=f??null,this.column=i??null,this.source=d??null,this.name=b??null,this[c]=!0,g!=null&&this.add(g)}return h.fromStringWithSourceMap=function(i,d,g){var b=new h,k=i.split(a),x=0,S=function(){var D=$(),F=$()||"";return D+F;function $(){return x<k.length?k[x++]:void 0}},E=1,T=0,A=null;return d.eachMapping(function(D){if(A!==null)if(E<D.generatedLine)z(A,S()),E++,T=0;else{var F=k[x]||"",$=F.substr(0,D.generatedColumn-T);k[x]=F.substr(D.generatedColumn-T),T=D.generatedColumn,z(A,$),A=D;return}for(;E<D.generatedLine;)b.add(S()),E++;if(T<D.generatedColumn){var F=k[x]||"";b.add(F.substr(0,D.generatedColumn)),k[x]=F.substr(D.generatedColumn),T=D.generatedColumn}A=D},this),x<k.length&&(A&&z(A,S()),b.add(k.splice(x).join(""))),d.sources.forEach(function(D){var F=d.sourceContentFor(D);F!=null&&(g!=null&&(D=e.join(g,D)),b.setSourceContent(D,F))}),b;function z(D,F){if(D===null||D.source===void 0)b.add(F);else{var $=g?e.join(g,D.source):D.source;b.add(new h(D.originalLine,D.originalColumn,$,F,D.name))}}},h.prototype.add=function(i){if(Array.isArray(i))i.forEach(function(d){this.add(d)},this);else if(i[c]||typeof i=="string")i&&this.children.push(i);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+i);return this},h.prototype.prepend=function(i){if(Array.isArray(i))for(var d=i.length-1;d>=0;d--)this.prepend(i[d]);else if(i[c]||typeof i=="string")this.children.unshift(i);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+i);return this},h.prototype.walk=function(i){for(var d,g=0,b=this.children.length;g<b;g++)d=this.children[g],d[c]?d.walk(i):d!==""&&i(d,{source:this.source,line:this.line,column:this.column,name:this.name})},h.prototype.join=function(i){var d,g,b=this.children.length;if(b>0){for(d=[],g=0;g<b-1;g++)d.push(this.children[g]),d.push(i);d.push(this.children[g]),this.children=d}return this},h.prototype.replaceRight=function(i,d){var g=this.children[this.children.length-1];return g[c]?g.replaceRight(i,d):typeof g=="string"?this.children[this.children.length-1]=g.replace(i,d):this.children.push("".replace(i,d)),this},h.prototype.setSourceContent=function(i,d){this.sourceContents[e.toSetString(i)]=d},h.prototype.walkSourceContents=function(i){for(var d=0,g=this.children.length;d<g;d++)this.children[d][c]&&this.children[d].walkSourceContents(i);for(var b=Object.keys(this.sourceContents),d=0,g=b.length;d<g;d++)i(e.fromSetString(b[d]),this.sourceContents[b[d]])},h.prototype.toString=function(){var i="";return this.walk(function(d){i+=d}),i},h.prototype.toStringWithSourceMap=function(i){var d={code:"",line:1,column:0},g=new s(i),b=!1,k=null,x=null,S=null,E=null;return this.walk(function(T,A){d.code+=T,A.source!==null&&A.line!==null&&A.column!==null?((k!==A.source||x!==A.line||S!==A.column||E!==A.name)&&g.addMapping({source:A.source,original:{line:A.line,column:A.column},generated:{line:d.line,column:d.column},name:A.name}),k=A.source,x=A.line,S=A.column,E=A.name,b=!0):b&&(g.addMapping({generated:{line:d.line,column:d.column}}),k=null,b=!1);for(var z=0,D=T.length;z<D;z++)T.charCodeAt(z)===o?(d.line++,d.column=0,z+1===D?(k=null,b=!1):b&&g.addMapping({source:A.source,original:{line:A.line,column:A.column},generated:{line:d.line,column:d.column},name:A.name})):d.column++}),this.walkSourceContents(function(T,A){g.setSourceContent(T,A)}),{code:d.code,map:g}},Of.SourceNode=h,Of}var X_;function $k(){return X_||(X_=1,Jl.SourceMapGenerator=T1().SourceMapGenerator,Jl.SourceMapConsumer=Uk().SourceMapConsumer,Jl.SourceNode=Vk().SourceNode),Jl}(function(s,e){e.__esModule=!0;var a=ui,o=void 0;try{var c=$k();o=c.SourceNode}catch{}o||(o=function(i,d,g,b){this.src="",b&&this.add(b)},o.prototype={add:function(d){a.isArray(d)&&(d=d.join("")),this.src+=d},prepend:function(d){a.isArray(d)&&(d=d.join("")),this.src=d+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function h(i,d,g){if(a.isArray(i)){for(var b=[],k=0,x=i.length;k<x;k++)b.push(d.wrap(i[k],g));return b}else if(typeof i=="boolean"||typeof i=="number")return i+"";return i}function f(i){this.srcFile=i,this.source=[]}f.prototype={isEmpty:function(){return!this.source.length},prepend:function(d,g){this.source.unshift(this.wrap(d,g))},push:function(d,g){this.source.push(this.wrap(d,g))},merge:function(){var d=this.empty();return this.each(function(g){d.add(["  ",g,`
`])}),d},each:function(d){for(var g=0,b=this.source.length;g<b;g++)d(this.source[g])},empty:function(){var d=this.currentLocation||{start:{}};return new o(d.start.line,d.start.column,this.srcFile)},wrap:function(d){var g=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return d instanceof o?d:(d=h(d,this,g),new o(g.start.line,g.start.column,this.srcFile,d))},functionCall:function(d,g,b){return b=this.generateList(b),this.wrap([d,g?"."+g+"(":"(",b,")"])},quotedString:function(d){return'"'+(d+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(d){var g=this,b=[];Object.keys(d).forEach(function(x){var S=h(d[x],g);S!=="undefined"&&b.push([g.quotedString(x),":",S])});var k=this.generateList(b);return k.prepend("{"),k.add("}"),k},generateList:function(d){for(var g=this.empty(),b=0,k=d.length;b<k;b++)b&&g.add(","),g.add(h(d[b],this));return g},generateArray:function(d){var g=this.generateList(d);return g.prepend("["),g.add("]"),g}},e.default=f,s.exports=e.default})(yd,yd.exports);var jk=yd.exports;(function(s,e){e.__esModule=!0;function a(x){return x&&x.__esModule?x:{default:x}}var o=Vn,c=os,h=a(c),f=ui,i=jk,d=a(i);function g(x){this.value=x}function b(){}b.prototype={nameLookup:function(S,E){return this.internalNameLookup(S,E)},depthedLookup:function(S){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(S),")"]},compilerInfo:function(){var S=o.COMPILER_REVISION,E=o.REVISION_CHANGES[S];return[S,E]},appendToBuffer:function(S,E,T){return f.isArray(S)||(S=[S]),S=this.source.wrap(S,E),this.environment.isSimple?["return ",S,";"]:T?["buffer += ",S,";"]:(S.appendToBuffer=!0,S)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(S,E){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",S,",",JSON.stringify(E),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(S,E,T,A){this.environment=S,this.options=E,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!A,this.name=this.environment.name,this.isChild=!!T,this.context=T||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(S,E),this.useDepths=this.useDepths||S.useDepths||S.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||S.useBlockParams;var z=S.opcodes,D=void 0,F=void 0,$=void 0,q=void 0;for($=0,q=z.length;$<q;$++)D=z[$],this.source.currentLocation=D.loc,F=F||D.loc,this[D.opcode].apply(this,D.args);if(this.source.currentLocation=F,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new h.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),A?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var J=this.createFunctionContext(A);if(this.isChild)return J;var G={compiler:this.compilerInfo(),main:J};this.decorators&&(G.main_d=this.decorators,G.useDecorators=!0);var oe=this.context,de=oe.programs,Ee=oe.decorators;for($=0,q=de.length;$<q;$++)de[$]&&(G[$]=de[$],Ee[$]&&(G[$+"_d"]=Ee[$],G.useDecorators=!0));return this.environment.usePartial&&(G.usePartial=!0),this.options.data&&(G.useData=!0),this.useDepths&&(G.useDepths=!0),this.useBlockParams&&(G.useBlockParams=!0),this.options.compat&&(G.compat=!0),A?G.compilerOptions=this.options:(G.compiler=JSON.stringify(G.compiler),this.source.currentLocation={start:{line:1,column:0}},G=this.objectLiteral(G),E.srcName?(G=G.toStringWithSourceMap({file:E.destName}),G.map=G.map&&G.map.toString()):G=G.toString()),G},preamble:function(){this.lastContext=0,this.source=new d.default(this.options.srcName),this.decorators=new d.default(this.options.srcName)},createFunctionContext:function(S){var E=this,T="",A=this.stackVars.concat(this.registers.list);A.length>0&&(T+=", "+A.join(", "));var z=0;Object.keys(this.aliases).forEach(function($){var q=E.aliases[$];q.children&&q.referenceCount>1&&(T+=", alias"+ ++z+"="+$,q.children[0]="alias"+z)}),this.lookupPropertyFunctionIsUsed&&(T+=", "+this.lookupPropertyFunctionVarDeclaration());var D=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&D.push("blockParams"),this.useDepths&&D.push("depths");var F=this.mergeSource(T);return S?(D.push(F),Function.apply(this,D)):this.source.wrap(["function(",D.join(","),`) {
  `,F,"}"])},mergeSource:function(S){var E=this.environment.isSimple,T=!this.forceBuffer,A=void 0,z=void 0,D=void 0,F=void 0;return this.source.each(function($){$.appendToBuffer?(D?$.prepend("  + "):D=$,F=$):(D&&(z?D.prepend("buffer += "):A=!0,F.add(";"),D=F=void 0),z=!0,E||(T=!1))}),T?D?(D.prepend("return "),F.add(";")):z||this.source.push('return "";'):(S+=", buffer = "+(A?"":this.initializeBuffer()),D?(D.prepend("return buffer + "),F.add(";")):this.source.push("return buffer;")),S&&this.source.prepend("var "+S.substring(2)+(A?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(S){var E=this.aliasable("container.hooks.blockHelperMissing"),T=[this.contextName(0)];this.setupHelperArgs(S,0,T);var A=this.popStack();T.splice(1,0,A),this.push(this.source.functionCall(E,"call",T))},ambiguousBlockValue:function(){var S=this.aliasable("container.hooks.blockHelperMissing"),E=[this.contextName(0)];this.setupHelperArgs("",0,E,!0),this.flushInline();var T=this.topStack();E.splice(1,0,T),this.pushSource(["if (!",this.lastHelper,") { ",T," = ",this.source.functionCall(S,"call",E),"}"])},appendContent:function(S){this.pendingContent?S=this.pendingContent+S:this.pendingLocation=this.source.currentLocation,this.pendingContent=S},append:function(){if(this.isInline())this.replaceStack(function(E){return[" != null ? ",E,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var S=this.popStack();this.pushSource(["if (",S," != null) { ",this.appendToBuffer(S,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(S){this.lastContext=S},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(S,E,T,A){var z=0;!A&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(S[z++])):this.pushContext(),this.resolvePath("context",S,z,E,T)},lookupBlockParam:function(S,E){this.useBlockParams=!0,this.push(["blockParams[",S[0],"][",S[1],"]"]),this.resolvePath("context",E,1)},lookupData:function(S,E,T){S?this.pushStackLiteral("container.data(data, "+S+")"):this.pushStackLiteral("data"),this.resolvePath("data",E,0,!0,T)},resolvePath:function(S,E,T,A,z){var D=this;if(this.options.strict||this.options.assumeObjects){this.push(k(this.options.strict&&z,this,E,T,S));return}for(var F=E.length;T<F;T++)this.replaceStack(function($){var q=D.nameLookup($,E[T],S);return A?[" && ",q]:[" != null ? ",q," : ",$]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(S,E){this.pushContext(),this.pushString(E),E!=="SubExpression"&&(typeof S=="string"?this.pushString(S):this.pushStackLiteral(S))},emptyHash:function(S){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(S?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var S=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(S.ids)),this.stringParams&&(this.push(this.objectLiteral(S.contexts)),this.push(this.objectLiteral(S.types))),this.push(this.objectLiteral(S.values))},pushString:function(S){this.pushStackLiteral(this.quotedString(S))},pushLiteral:function(S){this.pushStackLiteral(S)},pushProgram:function(S){S!=null?this.pushStackLiteral(this.programExpression(S)):this.pushStackLiteral(null)},registerDecorator:function(S,E){var T=this.nameLookup("decorators",E,"decorator"),A=this.setupHelperArgs(E,S);this.decorators.push(["fn = ",this.decorators.functionCall(T,"",["fn","props","container",A])," || fn;"])},invokeHelper:function(S,E,T){var A=this.popStack(),z=this.setupHelper(S,E),D=[];T&&D.push(z.name),D.push(A),this.options.strict||D.push(this.aliasable("container.hooks.helperMissing"));var F=["(",this.itemsSeparatedBy(D,"||"),")"],$=this.source.functionCall(F,"call",z.callParams);this.push($)},itemsSeparatedBy:function(S,E){var T=[];T.push(S[0]);for(var A=1;A<S.length;A++)T.push(E,S[A]);return T},invokeKnownHelper:function(S,E){var T=this.setupHelper(S,E);this.push(this.source.functionCall(T.name,"call",T.callParams))},invokeAmbiguous:function(S,E){this.useRegister("helper");var T=this.popStack();this.emptyHash();var A=this.setupHelper(0,S,E),z=this.lastHelper=this.nameLookup("helpers",S,"helper"),D=["(","(helper = ",z," || ",T,")"];this.options.strict||(D[0]="(helper = ",D.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",D,A.paramsInit?["),(",A.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",A.callParams)," : helper))"])},invokePartial:function(S,E,T){var A=[],z=this.setupParams(E,1,A);S&&(E=this.popStack(),delete z.name),T&&(z.indent=JSON.stringify(T)),z.helpers="helpers",z.partials="partials",z.decorators="container.decorators",S?A.unshift(E):A.unshift(this.nameLookup("partials",E,"partial")),this.options.compat&&(z.depths="depths"),z=this.objectLiteral(z),A.push(z),this.push(this.source.functionCall("container.invokePartial","",A))},assignToHash:function(S){var E=this.popStack(),T=void 0,A=void 0,z=void 0;this.trackIds&&(z=this.popStack()),this.stringParams&&(A=this.popStack(),T=this.popStack());var D=this.hash;T&&(D.contexts[S]=T),A&&(D.types[S]=A),z&&(D.ids[S]=z),D.values[S]=E},pushId:function(S,E,T){S==="BlockParam"?this.pushStackLiteral("blockParams["+E[0]+"].path["+E[1]+"]"+(T?" + "+JSON.stringify("."+T):"")):S==="PathExpression"?this.pushString(E):S==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:b,compileChildren:function(S,E){for(var T=S.children,A=void 0,z=void 0,D=0,F=T.length;D<F;D++){A=T[D],z=new this.compiler;var $=this.matchExistingProgram(A);if($==null){this.context.programs.push("");var q=this.context.programs.length;A.index=q,A.name="program"+q,this.context.programs[q]=z.compile(A,E,this.context,!this.precompile),this.context.decorators[q]=z.decorators,this.context.environments[q]=A,this.useDepths=this.useDepths||z.useDepths,this.useBlockParams=this.useBlockParams||z.useBlockParams,A.useDepths=this.useDepths,A.useBlockParams=this.useBlockParams}else A.index=$.index,A.name="program"+$.index,this.useDepths=this.useDepths||$.useDepths,this.useBlockParams=this.useBlockParams||$.useBlockParams}},matchExistingProgram:function(S){for(var E=0,T=this.context.environments.length;E<T;E++){var A=this.context.environments[E];if(A&&A.equals(S))return A}},programExpression:function(S){var E=this.environment.children[S],T=[E.index,"data",E.blockParams];return(this.useBlockParams||this.useDepths)&&T.push("blockParams"),this.useDepths&&T.push("depths"),"container.program("+T.join(", ")+")"},useRegister:function(S){this.registers[S]||(this.registers[S]=!0,this.registers.list.push(S))},push:function(S){return S instanceof g||(S=this.source.wrap(S)),this.inlineStack.push(S),S},pushStackLiteral:function(S){this.push(new g(S))},pushSource:function(S){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),S&&this.source.push(S)},replaceStack:function(S){var E=["("],T=void 0,A=void 0,z=void 0;if(!this.isInline())throw new h.default("replaceStack on non-inline");var D=this.popStack(!0);if(D instanceof g)T=[D.value],E=["(",T],z=!0;else{A=!0;var F=this.incrStack();E=["((",this.push(F)," = ",D,")"],T=this.topStack()}var $=S.call(this,T);z||this.popStack(),A&&this.stackSlot--,this.push(E.concat($,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var S=this.inlineStack;this.inlineStack=[];for(var E=0,T=S.length;E<T;E++){var A=S[E];if(A instanceof g)this.compileStack.push(A);else{var z=this.incrStack();this.pushSource([z," = ",A,";"]),this.compileStack.push(z)}}},isInline:function(){return this.inlineStack.length},popStack:function(S){var E=this.isInline(),T=(E?this.inlineStack:this.compileStack).pop();if(!S&&T instanceof g)return T.value;if(!E){if(!this.stackSlot)throw new h.default("Invalid stack pop");this.stackSlot--}return T},topStack:function(){var S=this.isInline()?this.inlineStack:this.compileStack,E=S[S.length-1];return E instanceof g?E.value:E},contextName:function(S){return this.useDepths&&S?"depths["+S+"]":"depth"+S},quotedString:function(S){return this.source.quotedString(S)},objectLiteral:function(S){return this.source.objectLiteral(S)},aliasable:function(S){var E=this.aliases[S];return E?(E.referenceCount++,E):(E=this.aliases[S]=this.source.wrap(S),E.aliasable=!0,E.referenceCount=1,E)},setupHelper:function(S,E,T){var A=[],z=this.setupHelperArgs(E,S,A,T),D=this.nameLookup("helpers",E,"helper"),F=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:A,paramsInit:z,name:D,callParams:[F].concat(A)}},setupParams:function(S,E,T){var A={},z=[],D=[],F=[],$=!T,q=void 0;$&&(T=[]),A.name=this.quotedString(S),A.hash=this.popStack(),this.trackIds&&(A.hashIds=this.popStack()),this.stringParams&&(A.hashTypes=this.popStack(),A.hashContexts=this.popStack());var J=this.popStack(),G=this.popStack();(G||J)&&(A.fn=G||"container.noop",A.inverse=J||"container.noop");for(var oe=E;oe--;)q=this.popStack(),T[oe]=q,this.trackIds&&(F[oe]=this.popStack()),this.stringParams&&(D[oe]=this.popStack(),z[oe]=this.popStack());return $&&(A.args=this.source.generateArray(T)),this.trackIds&&(A.ids=this.source.generateArray(F)),this.stringParams&&(A.types=this.source.generateArray(D),A.contexts=this.source.generateArray(z)),this.options.data&&(A.data="data"),this.useBlockParams&&(A.blockParams="blockParams"),A},setupHelperArgs:function(S,E,T,A){var z=this.setupParams(S,E,T);return z.loc=JSON.stringify(this.source.currentLocation),z=this.objectLiteral(z),A?(this.useRegister("options"),T.push("options"),["options=",z]):T?(T.push(z),""):z}},function(){for(var x="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),S=b.RESERVED_WORDS={},E=0,T=x.length;E<T;E++)S[x[E]]=!0}(),b.isValidJavaScriptVariableName=function(x){return!b.RESERVED_WORDS[x]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(x)};function k(x,S,E,T,A){var z=S.popStack(),D=E.length;for(x&&D--;T<D;T++)z=S.nameLookup(z,E[T],A);return x?[S.aliasable("container.strict"),"(",z,", ",S.quotedString(E[T]),", ",JSON.stringify(S.source.currentLocation)," )"]:z}e.default=b,s.exports=e.default})(_d,_d.exports);var qk=_d.exports;(function(s,e){e.__esModule=!0;function a(D){return D&&D.__esModule?D:{default:D}}var o=lk,c=a(o),h=y1,f=a(h),i=yc,d=vc,g=qk,b=a(g),k=v1,x=a(k),S=_1,E=a(S),T=c.default.create;function A(){var D=T();return D.compile=function(F,$){return d.compile(F,$,D)},D.precompile=function(F,$){return d.precompile(F,$,D)},D.AST=f.default,D.Compiler=d.Compiler,D.JavaScriptCompiler=b.default,D.Parser=i.parser,D.parse=i.parse,D.parseWithoutProcessing=i.parseWithoutProcessing,D}var z=A();z.create=A,E.default(z),z.Visitor=x.default,z.default=z,e.default=z,s.exports=e.default})(L_,L_.exports);function Ru(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var C1={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,e){(function(a){s.exports=a()})(function(){return function a(o,c,h){function f(g,b){if(!c[g]){if(!o[g]){var k=typeof Ru=="function"&&Ru;if(!b&&k)return k(g,!0);if(i)return i(g,!0);var x=new Error("Cannot find module '"+g+"'");throw x.code="MODULE_NOT_FOUND",x}var S=c[g]={exports:{}};o[g][0].call(S.exports,function(E){var T=o[g][1][E];return f(T||E)},S,S.exports,a,o,c,h)}return c[g].exports}for(var i=typeof Ru=="function"&&Ru,d=0;d<h.length;d++)f(h[d]);return f}({1:[function(a,o,c){var h=a("./utils"),f=a("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(d){for(var g,b,k,x,S,E,T,A=[],z=0,D=d.length,F=D,$=h.getTypeOf(d)!=="string";z<d.length;)F=D-z,k=$?(g=d[z++],b=z<D?d[z++]:0,z<D?d[z++]:0):(g=d.charCodeAt(z++),b=z<D?d.charCodeAt(z++):0,z<D?d.charCodeAt(z++):0),x=g>>2,S=(3&g)<<4|b>>4,E=1<F?(15&b)<<2|k>>6:64,T=2<F?63&k:64,A.push(i.charAt(x)+i.charAt(S)+i.charAt(E)+i.charAt(T));return A.join("")},c.decode=function(d){var g,b,k,x,S,E,T=0,A=0,z="data:";if(d.substr(0,z.length)===z)throw new Error("Invalid base64 input, it looks like a data url.");var D,F=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===i.charAt(64)&&F--,d.charAt(d.length-2)===i.charAt(64)&&F--,F%1!=0)throw new Error("Invalid base64 input, bad content length.");for(D=f.uint8array?new Uint8Array(0|F):new Array(0|F);T<d.length;)g=i.indexOf(d.charAt(T++))<<2|(x=i.indexOf(d.charAt(T++)))>>4,b=(15&x)<<4|(S=i.indexOf(d.charAt(T++)))>>2,k=(3&S)<<6|(E=i.indexOf(d.charAt(T++))),D[A++]=g,S!==64&&(D[A++]=b),E!==64&&(D[A++]=k);return D}},{"./support":30,"./utils":32}],2:[function(a,o,c){var h=a("./external"),f=a("./stream/DataWorker"),i=a("./stream/Crc32Probe"),d=a("./stream/DataLengthProbe");function g(b,k,x,S,E){this.compressedSize=b,this.uncompressedSize=k,this.crc32=x,this.compression=S,this.compressedContent=E}g.prototype={getContentWorker:function(){var b=new f(h.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),k=this;return b.on("end",function(){if(this.streamInfo.data_length!==k.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),b},getCompressedWorker:function(){return new f(h.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},g.createWorkerFrom=function(b,k,x){return b.pipe(new i).pipe(new d("uncompressedSize")).pipe(k.compressWorker(x)).pipe(new d("compressedSize")).withStreamInfo("compression",k)},o.exports=g},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(a,o,c){var h=a("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(){return new h("STORE compression")},uncompressWorker:function(){return new h("STORE decompression")}},c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(a,o,c){var h=a("./utils"),f=function(){for(var i,d=[],g=0;g<256;g++){i=g;for(var b=0;b<8;b++)i=1&i?3988292384^i>>>1:i>>>1;d[g]=i}return d}();o.exports=function(i,d){return i!==void 0&&i.length?h.getTypeOf(i)!=="string"?function(g,b,k,x){var S=f,E=x+k;g^=-1;for(var T=x;T<E;T++)g=g>>>8^S[255&(g^b[T])];return-1^g}(0|d,i,i.length,0):function(g,b,k,x){var S=f,E=x+k;g^=-1;for(var T=x;T<E;T++)g=g>>>8^S[255&(g^b.charCodeAt(T))];return-1^g}(0|d,i,i.length,0):0}},{"./utils":32}],5:[function(a,o,c){c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,o,c){var h=null;h=typeof Promise<"u"?Promise:a("lie"),o.exports={Promise:h}},{lie:37}],7:[function(a,o,c){var h=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",f=a("pako"),i=a("./utils"),d=a("./stream/GenericWorker"),g=h?"uint8array":"array";function b(k,x){d.call(this,"FlateWorker/"+k),this._pako=null,this._pakoAction=k,this._pakoOptions=x,this.meta={}}c.magic="\b\0",i.inherits(b,d),b.prototype.processChunk=function(k){this.meta=k.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(g,k.data),!1)},b.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},b.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},b.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var k=this;this._pako.onData=function(x){k.push({data:x,meta:k.meta})}},c.compressWorker=function(k){return new b("Deflate",k)},c.uncompressWorker=function(){return new b("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(a,o,c){function h(S,E){var T,A="";for(T=0;T<E;T++)A+=String.fromCharCode(255&S),S>>>=8;return A}function f(S,E,T,A,z,D){var F,$,q=S.file,J=S.compression,G=D!==g.utf8encode,oe=i.transformTo("string",D(q.name)),de=i.transformTo("string",g.utf8encode(q.name)),Ee=q.comment,ot=i.transformTo("string",D(Ee)),le=i.transformTo("string",g.utf8encode(Ee)),Ne=de.length!==q.name.length,Y=le.length!==Ee.length,Qe="",pt="",dt="",Zt=q.dir,nt=q.date,tt={crc32:0,compressedSize:0,uncompressedSize:0};E&&!T||(tt.crc32=S.crc32,tt.compressedSize=S.compressedSize,tt.uncompressedSize=S.uncompressedSize);var ce=0;E&&(ce|=8),G||!Ne&&!Y||(ce|=2048);var _e=0,ze=0;Zt&&(_e|=16),z==="UNIX"?(ze=798,_e|=function(ue,Xe){var wt=ue;return ue||(wt=Xe?16893:33204),(65535&wt)<<16}(q.unixPermissions,Zt)):(ze=20,_e|=function(ue){return 63&(ue||0)}(q.dosPermissions)),F=nt.getUTCHours(),F<<=6,F|=nt.getUTCMinutes(),F<<=5,F|=nt.getUTCSeconds()/2,$=nt.getUTCFullYear()-1980,$<<=4,$|=nt.getUTCMonth()+1,$<<=5,$|=nt.getUTCDate(),Ne&&(pt=h(1,1)+h(b(oe),4)+de,Qe+="up"+h(pt.length,2)+pt),Y&&(dt=h(1,1)+h(b(ot),4)+le,Qe+="uc"+h(dt.length,2)+dt);var re="";return re+=`
\0`,re+=h(ce,2),re+=J.magic,re+=h(F,2),re+=h($,2),re+=h(tt.crc32,4),re+=h(tt.compressedSize,4),re+=h(tt.uncompressedSize,4),re+=h(oe.length,2),re+=h(Qe.length,2),{fileRecord:k.LOCAL_FILE_HEADER+re+oe+Qe,dirRecord:k.CENTRAL_FILE_HEADER+h(ze,2)+re+h(ot.length,2)+"\0\0\0\0"+h(_e,4)+h(A,4)+oe+Qe+ot}}var i=a("../utils"),d=a("../stream/GenericWorker"),g=a("../utf8"),b=a("../crc32"),k=a("../signature");function x(S,E,T,A){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=E,this.zipPlatform=T,this.encodeFileName=A,this.streamFiles=S,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(x,d),x.prototype.push=function(S){var E=S.meta.percent||0,T=this.entriesCount,A=this._sources.length;this.accumulate?this.contentBuffer.push(S):(this.bytesWritten+=S.data.length,d.prototype.push.call(this,{data:S.data,meta:{currentFile:this.currentFile,percent:T?(E+100*(T-A-1))/T:100}}))},x.prototype.openedSource=function(S){this.currentSourceOffset=this.bytesWritten,this.currentFile=S.file.name;var E=this.streamFiles&&!S.file.dir;if(E){var T=f(S,E,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:T.fileRecord,meta:{percent:0}})}else this.accumulate=!0},x.prototype.closedSource=function(S){this.accumulate=!1;var E=this.streamFiles&&!S.file.dir,T=f(S,E,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(T.dirRecord),E)this.push({data:function(A){return k.DATA_DESCRIPTOR+h(A.crc32,4)+h(A.compressedSize,4)+h(A.uncompressedSize,4)}(S),meta:{percent:100}});else for(this.push({data:T.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},x.prototype.flush=function(){for(var S=this.bytesWritten,E=0;E<this.dirRecords.length;E++)this.push({data:this.dirRecords[E],meta:{percent:100}});var T=this.bytesWritten-S,A=function(z,D,F,$,q){var J=i.transformTo("string",q($));return k.CENTRAL_DIRECTORY_END+"\0\0\0\0"+h(z,2)+h(z,2)+h(D,4)+h(F,4)+h(J.length,2)+J}(this.dirRecords.length,T,S,this.zipComment,this.encodeFileName);this.push({data:A,meta:{percent:100}})},x.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},x.prototype.registerPrevious=function(S){this._sources.push(S);var E=this;return S.on("data",function(T){E.processChunk(T)}),S.on("end",function(){E.closedSource(E.previous.streamInfo),E._sources.length?E.prepareNextSource():E.end()}),S.on("error",function(T){E.error(T)}),this},x.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},x.prototype.error=function(S){var E=this._sources;if(!d.prototype.error.call(this,S))return!1;for(var T=0;T<E.length;T++)try{E[T].error(S)}catch{}return!0},x.prototype.lock=function(){d.prototype.lock.call(this);for(var S=this._sources,E=0;E<S.length;E++)S[E].lock()},o.exports=x},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(a,o,c){var h=a("../compressions"),f=a("./ZipFileWorker");c.generateWorker=function(i,d,g){var b=new f(d.streamFiles,g,d.platform,d.encodeFileName),k=0;try{i.forEach(function(x,S){k++;var E=function(D,F){var $=D||F,q=h[$];if(!q)throw new Error($+" is not a valid compression method !");return q}(S.options.compression,d.compression),T=S.options.compressionOptions||d.compressionOptions||{},A=S.dir,z=S.date;S._compressWorker(E,T).withStreamInfo("file",{name:x,dir:A,date:z,comment:S.comment||"",unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions}).pipe(b)}),b.entriesCount=k}catch(x){b.error(x)}return b}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,o,c){function h(){if(!(this instanceof h))return new h;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var f=new h;for(var i in this)typeof this[i]!="function"&&(f[i]=this[i]);return f}}(h.prototype=a("./object")).loadAsync=a("./load"),h.support=a("./support"),h.defaults=a("./defaults"),h.version="3.10.1",h.loadAsync=function(f,i){return new h().loadAsync(f,i)},h.external=a("./external"),o.exports=h},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(a,o,c){var h=a("./utils"),f=a("./external"),i=a("./utf8"),d=a("./zipEntries"),g=a("./stream/Crc32Probe"),b=a("./nodejsUtils");function k(x){return new f.Promise(function(S,E){var T=x.decompressed.getContentWorker().pipe(new g);T.on("error",function(A){E(A)}).on("end",function(){T.streamInfo.crc32!==x.decompressed.crc32?E(new Error("Corrupted zip : CRC32 mismatch")):S()}).resume()})}o.exports=function(x,S){var E=this;return S=h.extend(S||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),b.isNode&&b.isStream(x)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):h.prepareContent("the loaded zip file",x,!0,S.optimizedBinaryString,S.base64).then(function(T){var A=new d(S);return A.load(T),A}).then(function(T){var A=[f.Promise.resolve(T)],z=T.files;if(S.checkCRC32)for(var D=0;D<z.length;D++)A.push(k(z[D]));return f.Promise.all(A)}).then(function(T){for(var A=T.shift(),z=A.files,D=0;D<z.length;D++){var F=z[D],$=F.fileNameStr,q=h.resolve(F.fileNameStr);E.file(q,F.decompressed,{binary:!0,optimizedBinaryString:!0,date:F.date,dir:F.dir,comment:F.fileCommentStr.length?F.fileCommentStr:null,unixPermissions:F.unixPermissions,dosPermissions:F.dosPermissions,createFolders:S.createFolders}),F.dir||(E.file(q).unsafeOriginalName=$)}return A.zipComment.length&&(E.comment=A.zipComment),E})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(a,o,c){var h=a("../utils"),f=a("../stream/GenericWorker");function i(d,g){f.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(g)}h.inherits(i,f),i.prototype._bindStream=function(d){var g=this;(this._stream=d).pause(),d.on("data",function(b){g.push({data:b,meta:{percent:0}})}).on("error",function(b){g.isPaused?this.generatedError=b:g.error(b)}).on("end",function(){g.isPaused?g._upstreamEnded=!0:g.end()})},i.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},o.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(a,o,c){var h=a("readable-stream").Readable;function f(i,d,g){h.call(this,d),this._helper=i;var b=this;i.on("data",function(k,x){b.push(k)||b._helper.pause(),g&&g(x)}).on("error",function(k){b.emit("error",k)}).on("end",function(){b.push(null)})}a("../utils").inherits(f,h),f.prototype._read=function(){this._helper.resume()},o.exports=f},{"../utils":32,"readable-stream":16}],14:[function(a,o,c){o.exports={isNode:typeof Buffer<"u",newBufferFrom:function(h,f){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(h,f);if(typeof h=="number")throw new Error('The "data" argument must not be a number');return new Buffer(h,f)},allocBuffer:function(h){if(Buffer.alloc)return Buffer.alloc(h);var f=new Buffer(h);return f.fill(0),f},isBuffer:function(h){return Buffer.isBuffer(h)},isStream:function(h){return h&&typeof h.on=="function"&&typeof h.pause=="function"&&typeof h.resume=="function"}}},{}],15:[function(a,o,c){function h(q,J,G){var oe,de=i.getTypeOf(J),Ee=i.extend(G||{},b);Ee.date=Ee.date||new Date,Ee.compression!==null&&(Ee.compression=Ee.compression.toUpperCase()),typeof Ee.unixPermissions=="string"&&(Ee.unixPermissions=parseInt(Ee.unixPermissions,8)),Ee.unixPermissions&&16384&Ee.unixPermissions&&(Ee.dir=!0),Ee.dosPermissions&&16&Ee.dosPermissions&&(Ee.dir=!0),Ee.dir&&(q=z(q)),Ee.createFolders&&(oe=A(q))&&D.call(this,oe,!0);var ot=de==="string"&&Ee.binary===!1&&Ee.base64===!1;G&&G.binary!==void 0||(Ee.binary=!ot),(J instanceof k&&J.uncompressedSize===0||Ee.dir||!J||J.length===0)&&(Ee.base64=!1,Ee.binary=!0,J="",Ee.compression="STORE",de="string");var le=null;le=J instanceof k||J instanceof d?J:E.isNode&&E.isStream(J)?new T(q,J):i.prepareContent(q,J,Ee.binary,Ee.optimizedBinaryString,Ee.base64);var Ne=new x(q,le,Ee);this.files[q]=Ne}var f=a("./utf8"),i=a("./utils"),d=a("./stream/GenericWorker"),g=a("./stream/StreamHelper"),b=a("./defaults"),k=a("./compressedObject"),x=a("./zipObject"),S=a("./generate"),E=a("./nodejsUtils"),T=a("./nodejs/NodejsStreamInputAdapter"),A=function(q){q.slice(-1)==="/"&&(q=q.substring(0,q.length-1));var J=q.lastIndexOf("/");return 0<J?q.substring(0,J):""},z=function(q){return q.slice(-1)!=="/"&&(q+="/"),q},D=function(q,J){return J=J!==void 0?J:b.createFolders,q=z(q),this.files[q]||h.call(this,q,null,{dir:!0,createFolders:J}),this.files[q]};function F(q){return Object.prototype.toString.call(q)==="[object RegExp]"}var $={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(q){var J,G,oe;for(J in this.files)oe=this.files[J],(G=J.slice(this.root.length,J.length))&&J.slice(0,this.root.length)===this.root&&q(G,oe)},filter:function(q){var J=[];return this.forEach(function(G,oe){q(G,oe)&&J.push(oe)}),J},file:function(q,J,G){if(arguments.length!==1)return q=this.root+q,h.call(this,q,J,G),this;if(F(q)){var oe=q;return this.filter(function(Ee,ot){return!ot.dir&&oe.test(Ee)})}var de=this.files[this.root+q];return de&&!de.dir?de:null},folder:function(q){if(!q)return this;if(F(q))return this.filter(function(de,Ee){return Ee.dir&&q.test(de)});var J=this.root+q,G=D.call(this,J),oe=this.clone();return oe.root=G.name,oe},remove:function(q){q=this.root+q;var J=this.files[q];if(J||(q.slice(-1)!=="/"&&(q+="/"),J=this.files[q]),J&&!J.dir)delete this.files[q];else for(var G=this.filter(function(de,Ee){return Ee.name.slice(0,q.length)===q}),oe=0;oe<G.length;oe++)delete this.files[G[oe].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(q){var J,G={};try{if((G=i.extend(q||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:f.utf8encode})).type=G.type.toLowerCase(),G.compression=G.compression.toUpperCase(),G.type==="binarystring"&&(G.type="string"),!G.type)throw new Error("No output type specified.");i.checkSupport(G.type),G.platform!=="darwin"&&G.platform!=="freebsd"&&G.platform!=="linux"&&G.platform!=="sunos"||(G.platform="UNIX"),G.platform==="win32"&&(G.platform="DOS");var oe=G.comment||this.comment||"";J=S.generateWorker(this,G,oe)}catch(de){(J=new d("error")).error(de)}return new g(J,G.type||"string",G.mimeType)},generateAsync:function(q,J){return this.generateInternalStream(q).accumulate(J)},generateNodeStream:function(q,J){return(q=q||{}).type||(q.type="nodebuffer"),this.generateInternalStream(q).toNodejsStream(J)}};o.exports=$},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(a,o,c){o.exports=a("stream")},{stream:void 0}],17:[function(a,o,c){var h=a("./DataReader");function f(i){h.call(this,i);for(var d=0;d<this.data.length;d++)i[d]=255&i[d]}a("../utils").inherits(f,h),f.prototype.byteAt=function(i){return this.data[this.zero+i]},f.prototype.lastIndexOfSignature=function(i){for(var d=i.charCodeAt(0),g=i.charCodeAt(1),b=i.charCodeAt(2),k=i.charCodeAt(3),x=this.length-4;0<=x;--x)if(this.data[x]===d&&this.data[x+1]===g&&this.data[x+2]===b&&this.data[x+3]===k)return x-this.zero;return-1},f.prototype.readAndCheckSignature=function(i){var d=i.charCodeAt(0),g=i.charCodeAt(1),b=i.charCodeAt(2),k=i.charCodeAt(3),x=this.readData(4);return d===x[0]&&g===x[1]&&b===x[2]&&k===x[3]},f.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,d},o.exports=f},{"../utils":32,"./DataReader":18}],18:[function(a,o,c){var h=a("../utils");function f(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}f.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var d,g=0;for(this.checkOffset(i),d=this.index+i-1;d>=this.index;d--)g=(g<<8)+this.byteAt(d);return this.index+=i,g},readString:function(i){return h.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},o.exports=f},{"../utils":32}],19:[function(a,o,c){var h=a("./Uint8ArrayReader");function f(i){h.call(this,i)}a("../utils").inherits(f,h),f.prototype.readData=function(i){this.checkOffset(i);var d=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,d},o.exports=f},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(a,o,c){var h=a("./DataReader");function f(i){h.call(this,i)}a("../utils").inherits(f,h),f.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},f.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},f.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},f.prototype.readData=function(i){this.checkOffset(i);var d=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,d},o.exports=f},{"../utils":32,"./DataReader":18}],21:[function(a,o,c){var h=a("./ArrayReader");function f(i){h.call(this,i)}a("../utils").inherits(f,h),f.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,d},o.exports=f},{"../utils":32,"./ArrayReader":17}],22:[function(a,o,c){var h=a("../utils"),f=a("../support"),i=a("./ArrayReader"),d=a("./StringReader"),g=a("./NodeBufferReader"),b=a("./Uint8ArrayReader");o.exports=function(k){var x=h.getTypeOf(k);return h.checkSupport(x),x!=="string"||f.uint8array?x==="nodebuffer"?new g(k):f.uint8array?new b(h.transformTo("uint8array",k)):new i(h.transformTo("array",k)):new d(k)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(a,o,c){c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(a,o,c){var h=a("./GenericWorker"),f=a("../utils");function i(d){h.call(this,"ConvertWorker to "+d),this.destType=d}f.inherits(i,h),i.prototype.processChunk=function(d){this.push({data:f.transformTo(this.destType,d.data),meta:d.meta})},o.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(a,o,c){var h=a("./GenericWorker"),f=a("../crc32");function i(){h.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}a("../utils").inherits(i,h),i.prototype.processChunk=function(d){this.streamInfo.crc32=f(d.data,this.streamInfo.crc32||0),this.push(d)},o.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(a,o,c){var h=a("../utils"),f=a("./GenericWorker");function i(d){f.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}h.inherits(i,f),i.prototype.processChunk=function(d){if(d){var g=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=g+d.data.length}f.prototype.processChunk.call(this,d)},o.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(a,o,c){var h=a("../utils"),f=a("./GenericWorker");function i(d){f.call(this,"DataWorker");var g=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(b){g.dataIsReady=!0,g.data=b,g.max=b&&b.length||0,g.type=h.getTypeOf(b),g.isPaused||g._tickAndRepeat()},function(b){g.error(b)})}h.inherits(i,f),i.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,h.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(h.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,g=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,g);break;case"uint8array":d=this.data.subarray(this.index,g);break;case"array":case"nodebuffer":d=this.data.slice(this.index,g)}return this.index=g,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},o.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(a,o,c){function h(f){this.name=f||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}h.prototype={push:function(f){this.emit("data",f)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(f){this.emit("error",f)}return!0},error:function(f){return!this.isFinished&&(this.isPaused?this.generatedError=f:(this.isFinished=!0,this.emit("error",f),this.previous&&this.previous.error(f),this.cleanUp()),!0)},on:function(f,i){return this._listeners[f].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(f,i){if(this._listeners[f])for(var d=0;d<this._listeners[f].length;d++)this._listeners[f][d].call(this,i)},pipe:function(f){return f.registerPrevious(this)},registerPrevious:function(f){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=f.streamInfo,this.mergeStreamInfo(),this.previous=f;var i=this;return f.on("data",function(d){i.processChunk(d)}),f.on("end",function(){i.end()}),f.on("error",function(d){i.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var f=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),f=!0),this.previous&&this.previous.resume(),!f},flush:function(){},processChunk:function(f){this.push(f)},withStreamInfo:function(f,i){return this.extraStreamInfo[f]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var f in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,f)&&(this.streamInfo[f]=this.extraStreamInfo[f])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var f="Worker "+this.name;return this.previous?this.previous+" -> "+f:f}},o.exports=h},{}],29:[function(a,o,c){var h=a("../utils"),f=a("./ConvertWorker"),i=a("./GenericWorker"),d=a("../base64"),g=a("../support"),b=a("../external"),k=null;if(g.nodestream)try{k=a("../nodejs/NodejsStreamOutputAdapter")}catch{}function x(E,T){return new b.Promise(function(A,z){var D=[],F=E._internalType,$=E._outputType,q=E._mimeType;E.on("data",function(J,G){D.push(J),T&&T(G)}).on("error",function(J){D=[],z(J)}).on("end",function(){try{var J=function(G,oe,de){switch(G){case"blob":return h.newBlob(h.transformTo("arraybuffer",oe),de);case"base64":return d.encode(oe);default:return h.transformTo(G,oe)}}($,function(G,oe){var de,Ee=0,ot=null,le=0;for(de=0;de<oe.length;de++)le+=oe[de].length;switch(G){case"string":return oe.join("");case"array":return Array.prototype.concat.apply([],oe);case"uint8array":for(ot=new Uint8Array(le),de=0;de<oe.length;de++)ot.set(oe[de],Ee),Ee+=oe[de].length;return ot;case"nodebuffer":return Buffer.concat(oe);default:throw new Error("concat : unsupported type '"+G+"'")}}(F,D),q);A(J)}catch(G){z(G)}D=[]}).resume()})}function S(E,T,A){var z=T;switch(T){case"blob":case"arraybuffer":z="uint8array";break;case"base64":z="string"}try{this._internalType=z,this._outputType=T,this._mimeType=A,h.checkSupport(z),this._worker=E.pipe(new f(z)),E.lock()}catch(D){this._worker=new i("error"),this._worker.error(D)}}S.prototype={accumulate:function(E){return x(this,E)},on:function(E,T){var A=this;return E==="data"?this._worker.on(E,function(z){T.call(A,z.data,z.meta)}):this._worker.on(E,function(){h.delay(T,arguments,A)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(h.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new k(this,{objectMode:this._outputType!=="nodebuffer"},E)}},o.exports=S},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(a,o,c){if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",c.nodebuffer=typeof Buffer<"u",c.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")c.blob=!1;else{var h=new ArrayBuffer(0);try{c.blob=new Blob([h],{type:"application/zip"}).size===0}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);f.append(h),c.blob=f.getBlob("application/zip").size===0}catch{c.blob=!1}}}try{c.nodestream=!!a("readable-stream").Readable}catch{c.nodestream=!1}},{"readable-stream":16}],31:[function(a,o,c){for(var h=a("./utils"),f=a("./support"),i=a("./nodejsUtils"),d=a("./stream/GenericWorker"),g=new Array(256),b=0;b<256;b++)g[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;g[254]=g[254]=1;function k(){d.call(this,"utf-8 decode"),this.leftOver=null}function x(){d.call(this,"utf-8 encode")}c.utf8encode=function(S){return f.nodebuffer?i.newBufferFrom(S,"utf-8"):function(E){var T,A,z,D,F,$=E.length,q=0;for(D=0;D<$;D++)(64512&(A=E.charCodeAt(D)))==55296&&D+1<$&&(64512&(z=E.charCodeAt(D+1)))==56320&&(A=65536+(A-55296<<10)+(z-56320),D++),q+=A<128?1:A<2048?2:A<65536?3:4;for(T=f.uint8array?new Uint8Array(q):new Array(q),D=F=0;F<q;D++)(64512&(A=E.charCodeAt(D)))==55296&&D+1<$&&(64512&(z=E.charCodeAt(D+1)))==56320&&(A=65536+(A-55296<<10)+(z-56320),D++),A<128?T[F++]=A:(A<2048?T[F++]=192|A>>>6:(A<65536?T[F++]=224|A>>>12:(T[F++]=240|A>>>18,T[F++]=128|A>>>12&63),T[F++]=128|A>>>6&63),T[F++]=128|63&A);return T}(S)},c.utf8decode=function(S){return f.nodebuffer?h.transformTo("nodebuffer",S).toString("utf-8"):function(E){var T,A,z,D,F=E.length,$=new Array(2*F);for(T=A=0;T<F;)if((z=E[T++])<128)$[A++]=z;else if(4<(D=g[z]))$[A++]=65533,T+=D-1;else{for(z&=D===2?31:D===3?15:7;1<D&&T<F;)z=z<<6|63&E[T++],D--;1<D?$[A++]=65533:z<65536?$[A++]=z:(z-=65536,$[A++]=55296|z>>10&1023,$[A++]=56320|1023&z)}return $.length!==A&&($.subarray?$=$.subarray(0,A):$.length=A),h.applyFromCharCode($)}(S=h.transformTo(f.uint8array?"uint8array":"array",S))},h.inherits(k,d),k.prototype.processChunk=function(S){var E=h.transformTo(f.uint8array?"uint8array":"array",S.data);if(this.leftOver&&this.leftOver.length){if(f.uint8array){var T=E;(E=new Uint8Array(T.length+this.leftOver.length)).set(this.leftOver,0),E.set(T,this.leftOver.length)}else E=this.leftOver.concat(E);this.leftOver=null}var A=function(D,F){var $;for((F=F||D.length)>D.length&&(F=D.length),$=F-1;0<=$&&(192&D[$])==128;)$--;return $<0||$===0?F:$+g[D[$]]>F?$:F}(E),z=E;A!==E.length&&(f.uint8array?(z=E.subarray(0,A),this.leftOver=E.subarray(A,E.length)):(z=E.slice(0,A),this.leftOver=E.slice(A,E.length))),this.push({data:c.utf8decode(z),meta:S.meta})},k.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=k,h.inherits(x,d),x.prototype.processChunk=function(S){this.push({data:c.utf8encode(S.data),meta:S.meta})},c.Utf8EncodeWorker=x},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(a,o,c){var h=a("./support"),f=a("./base64"),i=a("./nodejsUtils"),d=a("./external");function g(T){return T}function b(T,A){for(var z=0;z<T.length;++z)A[z]=255&T.charCodeAt(z);return A}a("setimmediate"),c.newBlob=function(T,A){c.checkSupport("blob");try{return new Blob([T],{type:A})}catch{try{var z=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return z.append(T),z.getBlob(A)}catch{throw new Error("Bug : can't construct the Blob.")}}};var k={stringifyByChunk:function(T,A,z){var D=[],F=0,$=T.length;if($<=z)return String.fromCharCode.apply(null,T);for(;F<$;)A==="array"||A==="nodebuffer"?D.push(String.fromCharCode.apply(null,T.slice(F,Math.min(F+z,$)))):D.push(String.fromCharCode.apply(null,T.subarray(F,Math.min(F+z,$)))),F+=z;return D.join("")},stringifyByChar:function(T){for(var A="",z=0;z<T.length;z++)A+=String.fromCharCode(T[z]);return A},applyCanBeUsed:{uint8array:function(){try{return h.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return h.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}}()}};function x(T){var A=65536,z=c.getTypeOf(T),D=!0;if(z==="uint8array"?D=k.applyCanBeUsed.uint8array:z==="nodebuffer"&&(D=k.applyCanBeUsed.nodebuffer),D)for(;1<A;)try{return k.stringifyByChunk(T,z,A)}catch{A=Math.floor(A/2)}return k.stringifyByChar(T)}function S(T,A){for(var z=0;z<T.length;z++)A[z]=T[z];return A}c.applyFromCharCode=x;var E={};E.string={string:g,array:function(T){return b(T,new Array(T.length))},arraybuffer:function(T){return E.string.uint8array(T).buffer},uint8array:function(T){return b(T,new Uint8Array(T.length))},nodebuffer:function(T){return b(T,i.allocBuffer(T.length))}},E.array={string:x,array:g,arraybuffer:function(T){return new Uint8Array(T).buffer},uint8array:function(T){return new Uint8Array(T)},nodebuffer:function(T){return i.newBufferFrom(T)}},E.arraybuffer={string:function(T){return x(new Uint8Array(T))},array:function(T){return S(new Uint8Array(T),new Array(T.byteLength))},arraybuffer:g,uint8array:function(T){return new Uint8Array(T)},nodebuffer:function(T){return i.newBufferFrom(new Uint8Array(T))}},E.uint8array={string:x,array:function(T){return S(T,new Array(T.length))},arraybuffer:function(T){return T.buffer},uint8array:g,nodebuffer:function(T){return i.newBufferFrom(T)}},E.nodebuffer={string:x,array:function(T){return S(T,new Array(T.length))},arraybuffer:function(T){return E.nodebuffer.uint8array(T).buffer},uint8array:function(T){return S(T,new Uint8Array(T.length))},nodebuffer:g},c.transformTo=function(T,A){if(A=A||"",!T)return A;c.checkSupport(T);var z=c.getTypeOf(A);return E[z][T](A)},c.resolve=function(T){for(var A=T.split("/"),z=[],D=0;D<A.length;D++){var F=A[D];F==="."||F===""&&D!==0&&D!==A.length-1||(F===".."?z.pop():z.push(F))}return z.join("/")},c.getTypeOf=function(T){return typeof T=="string"?"string":Object.prototype.toString.call(T)==="[object Array]"?"array":h.nodebuffer&&i.isBuffer(T)?"nodebuffer":h.uint8array&&T instanceof Uint8Array?"uint8array":h.arraybuffer&&T instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(T){if(!h[T.toLowerCase()])throw new Error(T+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(T){var A,z,D="";for(z=0;z<(T||"").length;z++)D+="\\x"+((A=T.charCodeAt(z))<16?"0":"")+A.toString(16).toUpperCase();return D},c.delay=function(T,A,z){setImmediate(function(){T.apply(z||null,A||[])})},c.inherits=function(T,A){function z(){}z.prototype=A.prototype,T.prototype=new z},c.extend=function(){var T,A,z={};for(T=0;T<arguments.length;T++)for(A in arguments[T])Object.prototype.hasOwnProperty.call(arguments[T],A)&&z[A]===void 0&&(z[A]=arguments[T][A]);return z},c.prepareContent=function(T,A,z,D,F){return d.Promise.resolve(A).then(function($){return h.blob&&($ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call($))!==-1)&&typeof FileReader<"u"?new d.Promise(function(q,J){var G=new FileReader;G.onload=function(oe){q(oe.target.result)},G.onerror=function(oe){J(oe.target.error)},G.readAsArrayBuffer($)}):$}).then(function($){var q=c.getTypeOf($);return q?(q==="arraybuffer"?$=c.transformTo("uint8array",$):q==="string"&&(F?$=f.decode($):z&&D!==!0&&($=function(J){return b(J,h.uint8array?new Uint8Array(J.length):new Array(J.length))}($))),$):d.Promise.reject(new Error("Can't read the data of '"+T+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(a,o,c){var h=a("./reader/readerFor"),f=a("./utils"),i=a("./signature"),d=a("./zipEntry"),g=a("./support");function b(k){this.files=[],this.loadOptions=k}b.prototype={checkSignature:function(k){if(!this.reader.readAndCheckSignature(k)){this.reader.index-=4;var x=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(x)+", expected "+f.pretty(k)+")")}},isSignature:function(k,x){var S=this.reader.index;this.reader.setIndex(k);var E=this.reader.readString(4)===x;return this.reader.setIndex(S),E},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var k=this.reader.readData(this.zipCommentLength),x=g.uint8array?"uint8array":"array",S=f.transformTo(x,k);this.zipComment=this.loadOptions.decodeFileName(S)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var k,x,S,E=this.zip64EndOfCentralSize-44;0<E;)k=this.reader.readInt(2),x=this.reader.readInt(4),S=this.reader.readData(x),this.zip64ExtensibleData[k]={id:k,length:x,value:S}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var k,x;for(k=0;k<this.files.length;k++)x=this.files[k],this.reader.setIndex(x.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),x.readLocalPart(this.reader),x.handleUTF8(),x.processAttributes()},readCentralDir:function(){var k;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(k=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(k);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var k=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(k<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(k);var x=k;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,(k=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(k),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var S=this.centralDirOffset+this.centralDirSize;this.zip64&&(S+=20,S+=12+this.zip64EndOfCentralSize);var E=x-S;if(0<E)this.isSignature(x,i.CENTRAL_FILE_HEADER)||(this.reader.zero=E);else if(E<0)throw new Error("Corrupted zip: missing "+Math.abs(E)+" bytes.")},prepareReader:function(k){this.reader=h(k)},load:function(k){this.prepareReader(k),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},o.exports=b},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(a,o,c){var h=a("./reader/readerFor"),f=a("./utils"),i=a("./compressedObject"),d=a("./crc32"),g=a("./utf8"),b=a("./compressions"),k=a("./support");function x(S,E){this.options=S,this.loadOptions=E}x.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(S){var E,T;if(S.skip(22),this.fileNameLength=S.readInt(2),T=S.readInt(2),this.fileName=S.readData(this.fileNameLength),S.skip(T),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((E=function(A){for(var z in b)if(Object.prototype.hasOwnProperty.call(b,z)&&b[z].magic===A)return b[z];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,E,S.readData(this.compressedSize))},readCentralPart:function(S){this.versionMadeBy=S.readInt(2),S.skip(2),this.bitFlag=S.readInt(2),this.compressionMethod=S.readString(2),this.date=S.readDate(),this.crc32=S.readInt(4),this.compressedSize=S.readInt(4),this.uncompressedSize=S.readInt(4);var E=S.readInt(2);if(this.extraFieldsLength=S.readInt(2),this.fileCommentLength=S.readInt(2),this.diskNumberStart=S.readInt(2),this.internalFileAttributes=S.readInt(2),this.externalFileAttributes=S.readInt(4),this.localHeaderOffset=S.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");S.skip(E),this.readExtraFields(S),this.parseZIP64ExtraField(S),this.fileComment=S.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var S=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),S==0&&(this.dosPermissions=63&this.externalFileAttributes),S==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var S=h(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=S.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=S.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=S.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=S.readInt(4))}},readExtraFields:function(S){var E,T,A,z=S.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});S.index+4<z;)E=S.readInt(2),T=S.readInt(2),A=S.readData(T),this.extraFields[E]={id:E,length:T,value:A};S.setIndex(z)},handleUTF8:function(){var S=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=g.utf8decode(this.fileName),this.fileCommentStr=g.utf8decode(this.fileComment);else{var E=this.findExtraFieldUnicodePath();if(E!==null)this.fileNameStr=E;else{var T=f.transformTo(S,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(T)}var A=this.findExtraFieldUnicodeComment();if(A!==null)this.fileCommentStr=A;else{var z=f.transformTo(S,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(z)}}},findExtraFieldUnicodePath:function(){var S=this.extraFields[28789];if(S){var E=h(S.value);return E.readInt(1)!==1||d(this.fileName)!==E.readInt(4)?null:g.utf8decode(E.readData(S.length-5))}return null},findExtraFieldUnicodeComment:function(){var S=this.extraFields[25461];if(S){var E=h(S.value);return E.readInt(1)!==1||d(this.fileComment)!==E.readInt(4)?null:g.utf8decode(E.readData(S.length-5))}return null}},o.exports=x},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(a,o,c){function h(E,T,A){this.name=E,this.dir=A.dir,this.date=A.date,this.comment=A.comment,this.unixPermissions=A.unixPermissions,this.dosPermissions=A.dosPermissions,this._data=T,this._dataBinary=A.binary,this.options={compression:A.compression,compressionOptions:A.compressionOptions}}var f=a("./stream/StreamHelper"),i=a("./stream/DataWorker"),d=a("./utf8"),g=a("./compressedObject"),b=a("./stream/GenericWorker");h.prototype={internalStream:function(E){var T=null,A="string";try{if(!E)throw new Error("No output type specified.");var z=(A=E.toLowerCase())==="string"||A==="text";A!=="binarystring"&&A!=="text"||(A="string"),T=this._decompressWorker();var D=!this._dataBinary;D&&!z&&(T=T.pipe(new d.Utf8EncodeWorker)),!D&&z&&(T=T.pipe(new d.Utf8DecodeWorker))}catch(F){(T=new b("error")).error(F)}return new f(T,A,"")},async:function(E,T){return this.internalStream(E).accumulate(T)},nodeStream:function(E,T){return this.internalStream(E||"nodebuffer").toNodejsStream(T)},_compressWorker:function(E,T){if(this._data instanceof g&&this._data.compression.magic===E.magic)return this._data.getCompressedWorker();var A=this._decompressWorker();return this._dataBinary||(A=A.pipe(new d.Utf8EncodeWorker)),g.createWorkerFrom(A,E,T)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof b?this._data:new i(this._data)}};for(var k=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],x=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},S=0;S<k.length;S++)h.prototype[k[S]]=x;o.exports=h},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(a,o,c){(function(h){var f,i,d=h.MutationObserver||h.WebKitMutationObserver;if(d){var g=0,b=new d(E),k=h.document.createTextNode("");b.observe(k,{characterData:!0}),f=function(){k.data=g=++g%2}}else if(h.setImmediate||h.MessageChannel===void 0)f="document"in h&&"onreadystatechange"in h.document.createElement("script")?function(){var T=h.document.createElement("script");T.onreadystatechange=function(){E(),T.onreadystatechange=null,T.parentNode.removeChild(T),T=null},h.document.documentElement.appendChild(T)}:function(){setTimeout(E,0)};else{var x=new h.MessageChannel;x.port1.onmessage=E,f=function(){x.port2.postMessage(0)}}var S=[];function E(){var T,A;i=!0;for(var z=S.length;z;){for(A=S,S=[],T=-1;++T<z;)A[T]();z=S.length}i=!1}o.exports=function(T){S.push(T)!==1||i||f()}}).call(this,typeof $o<"u"?$o:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(a,o,c){var h=a("immediate");function f(){}var i={},d=["REJECTED"],g=["FULFILLED"],b=["PENDING"];function k(z){if(typeof z!="function")throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,z!==f&&T(this,z)}function x(z,D,F){this.promise=z,typeof D=="function"&&(this.onFulfilled=D,this.callFulfilled=this.otherCallFulfilled),typeof F=="function"&&(this.onRejected=F,this.callRejected=this.otherCallRejected)}function S(z,D,F){h(function(){var $;try{$=D(F)}catch(q){return i.reject(z,q)}$===z?i.reject(z,new TypeError("Cannot resolve promise with itself")):i.resolve(z,$)})}function E(z){var D=z&&z.then;if(z&&(typeof z=="object"||typeof z=="function")&&typeof D=="function")return function(){D.apply(z,arguments)}}function T(z,D){var F=!1;function $(G){F||(F=!0,i.reject(z,G))}function q(G){F||(F=!0,i.resolve(z,G))}var J=A(function(){D(q,$)});J.status==="error"&&$(J.value)}function A(z,D){var F={};try{F.value=z(D),F.status="success"}catch($){F.status="error",F.value=$}return F}(o.exports=k).prototype.finally=function(z){if(typeof z!="function")return this;var D=this.constructor;return this.then(function(F){return D.resolve(z()).then(function(){return F})},function(F){return D.resolve(z()).then(function(){throw F})})},k.prototype.catch=function(z){return this.then(null,z)},k.prototype.then=function(z,D){if(typeof z!="function"&&this.state===g||typeof D!="function"&&this.state===d)return this;var F=new this.constructor(f);return this.state!==b?S(F,this.state===g?z:D,this.outcome):this.queue.push(new x(F,z,D)),F},x.prototype.callFulfilled=function(z){i.resolve(this.promise,z)},x.prototype.otherCallFulfilled=function(z){S(this.promise,this.onFulfilled,z)},x.prototype.callRejected=function(z){i.reject(this.promise,z)},x.prototype.otherCallRejected=function(z){S(this.promise,this.onRejected,z)},i.resolve=function(z,D){var F=A(E,D);if(F.status==="error")return i.reject(z,F.value);var $=F.value;if($)T(z,$);else{z.state=g,z.outcome=D;for(var q=-1,J=z.queue.length;++q<J;)z.queue[q].callFulfilled(D)}return z},i.reject=function(z,D){z.state=d,z.outcome=D;for(var F=-1,$=z.queue.length;++F<$;)z.queue[F].callRejected(D);return z},k.resolve=function(z){return z instanceof this?z:i.resolve(new this(f),z)},k.reject=function(z){var D=new this(f);return i.reject(D,z)},k.all=function(z){var D=this;if(Object.prototype.toString.call(z)!=="[object Array]")return this.reject(new TypeError("must be an array"));var F=z.length,$=!1;if(!F)return this.resolve([]);for(var q=new Array(F),J=0,G=-1,oe=new this(f);++G<F;)de(z[G],G);return oe;function de(Ee,ot){D.resolve(Ee).then(function(le){q[ot]=le,++J!==F||$||($=!0,i.resolve(oe,q))},function(le){$||($=!0,i.reject(oe,le))})}},k.race=function(z){var D=this;if(Object.prototype.toString.call(z)!=="[object Array]")return this.reject(new TypeError("must be an array"));var F=z.length,$=!1;if(!F)return this.resolve([]);for(var q=-1,J=new this(f);++q<F;)G=z[q],D.resolve(G).then(function(oe){$||($=!0,i.resolve(J,oe))},function(oe){$||($=!0,i.reject(J,oe))});var G;return J}},{immediate:36}],38:[function(a,o,c){var h={};(0,a("./lib/utils/common").assign)(h,a("./lib/deflate"),a("./lib/inflate"),a("./lib/zlib/constants")),o.exports=h},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(a,o,c){var h=a("./zlib/deflate"),f=a("./utils/common"),i=a("./utils/strings"),d=a("./zlib/messages"),g=a("./zlib/zstream"),b=Object.prototype.toString,k=0,x=-1,S=0,E=8;function T(z){if(!(this instanceof T))return new T(z);this.options=f.assign({level:x,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:S,to:""},z||{});var D=this.options;D.raw&&0<D.windowBits?D.windowBits=-D.windowBits:D.gzip&&0<D.windowBits&&D.windowBits<16&&(D.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var F=h.deflateInit2(this.strm,D.level,D.method,D.windowBits,D.memLevel,D.strategy);if(F!==k)throw new Error(d[F]);if(D.header&&h.deflateSetHeader(this.strm,D.header),D.dictionary){var $;if($=typeof D.dictionary=="string"?i.string2buf(D.dictionary):b.call(D.dictionary)==="[object ArrayBuffer]"?new Uint8Array(D.dictionary):D.dictionary,(F=h.deflateSetDictionary(this.strm,$))!==k)throw new Error(d[F]);this._dict_set=!0}}function A(z,D){var F=new T(D);if(F.push(z,!0),F.err)throw F.msg||d[F.err];return F.result}T.prototype.push=function(z,D){var F,$,q=this.strm,J=this.options.chunkSize;if(this.ended)return!1;$=D===~~D?D:D===!0?4:0,typeof z=="string"?q.input=i.string2buf(z):b.call(z)==="[object ArrayBuffer]"?q.input=new Uint8Array(z):q.input=z,q.next_in=0,q.avail_in=q.input.length;do{if(q.avail_out===0&&(q.output=new f.Buf8(J),q.next_out=0,q.avail_out=J),(F=h.deflate(q,$))!==1&&F!==k)return this.onEnd(F),!(this.ended=!0);q.avail_out!==0&&(q.avail_in!==0||$!==4&&$!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(f.shrinkBuf(q.output,q.next_out))):this.onData(f.shrinkBuf(q.output,q.next_out)))}while((0<q.avail_in||q.avail_out===0)&&F!==1);return $===4?(F=h.deflateEnd(this.strm),this.onEnd(F),this.ended=!0,F===k):$!==2||(this.onEnd(k),!(q.avail_out=0))},T.prototype.onData=function(z){this.chunks.push(z)},T.prototype.onEnd=function(z){z===k&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg},c.Deflate=T,c.deflate=A,c.deflateRaw=function(z,D){return(D=D||{}).raw=!0,A(z,D)},c.gzip=function(z,D){return(D=D||{}).gzip=!0,A(z,D)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(a,o,c){var h=a("./zlib/inflate"),f=a("./utils/common"),i=a("./utils/strings"),d=a("./zlib/constants"),g=a("./zlib/messages"),b=a("./zlib/zstream"),k=a("./zlib/gzheader"),x=Object.prototype.toString;function S(T){if(!(this instanceof S))return new S(T);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},T||{});var A=this.options;A.raw&&0<=A.windowBits&&A.windowBits<16&&(A.windowBits=-A.windowBits,A.windowBits===0&&(A.windowBits=-15)),!(0<=A.windowBits&&A.windowBits<16)||T&&T.windowBits||(A.windowBits+=32),15<A.windowBits&&A.windowBits<48&&!(15&A.windowBits)&&(A.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var z=h.inflateInit2(this.strm,A.windowBits);if(z!==d.Z_OK)throw new Error(g[z]);this.header=new k,h.inflateGetHeader(this.strm,this.header)}function E(T,A){var z=new S(A);if(z.push(T,!0),z.err)throw z.msg||g[z.err];return z.result}S.prototype.push=function(T,A){var z,D,F,$,q,J,G=this.strm,oe=this.options.chunkSize,de=this.options.dictionary,Ee=!1;if(this.ended)return!1;D=A===~~A?A:A===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof T=="string"?G.input=i.binstring2buf(T):x.call(T)==="[object ArrayBuffer]"?G.input=new Uint8Array(T):G.input=T,G.next_in=0,G.avail_in=G.input.length;do{if(G.avail_out===0&&(G.output=new f.Buf8(oe),G.next_out=0,G.avail_out=oe),(z=h.inflate(G,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&de&&(J=typeof de=="string"?i.string2buf(de):x.call(de)==="[object ArrayBuffer]"?new Uint8Array(de):de,z=h.inflateSetDictionary(this.strm,J)),z===d.Z_BUF_ERROR&&Ee===!0&&(z=d.Z_OK,Ee=!1),z!==d.Z_STREAM_END&&z!==d.Z_OK)return this.onEnd(z),!(this.ended=!0);G.next_out&&(G.avail_out!==0&&z!==d.Z_STREAM_END&&(G.avail_in!==0||D!==d.Z_FINISH&&D!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(F=i.utf8border(G.output,G.next_out),$=G.next_out-F,q=i.buf2string(G.output,F),G.next_out=$,G.avail_out=oe-$,$&&f.arraySet(G.output,G.output,F,$,0),this.onData(q)):this.onData(f.shrinkBuf(G.output,G.next_out)))),G.avail_in===0&&G.avail_out===0&&(Ee=!0)}while((0<G.avail_in||G.avail_out===0)&&z!==d.Z_STREAM_END);return z===d.Z_STREAM_END&&(D=d.Z_FINISH),D===d.Z_FINISH?(z=h.inflateEnd(this.strm),this.onEnd(z),this.ended=!0,z===d.Z_OK):D!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(G.avail_out=0))},S.prototype.onData=function(T){this.chunks.push(T)},S.prototype.onEnd=function(T){T===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg},c.Inflate=S,c.inflate=E,c.inflateRaw=function(T,A){return(A=A||{}).raw=!0,E(T,A)},c.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(a,o,c){var h=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";c.assign=function(d){for(var g=Array.prototype.slice.call(arguments,1);g.length;){var b=g.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(var k in b)b.hasOwnProperty(k)&&(d[k]=b[k])}}return d},c.shrinkBuf=function(d,g){return d.length===g?d:d.subarray?d.subarray(0,g):(d.length=g,d)};var f={arraySet:function(d,g,b,k,x){if(g.subarray&&d.subarray)d.set(g.subarray(b,b+k),x);else for(var S=0;S<k;S++)d[x+S]=g[b+S]},flattenChunks:function(d){var g,b,k,x,S,E;for(g=k=0,b=d.length;g<b;g++)k+=d[g].length;for(E=new Uint8Array(k),g=x=0,b=d.length;g<b;g++)S=d[g],E.set(S,x),x+=S.length;return E}},i={arraySet:function(d,g,b,k,x){for(var S=0;S<k;S++)d[x+S]=g[b+S]},flattenChunks:function(d){return[].concat.apply([],d)}};c.setTyped=function(d){d?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,f)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,i))},c.setTyped(h)},{}],42:[function(a,o,c){var h=a("./common"),f=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var d=new h.Buf8(256),g=0;g<256;g++)d[g]=252<=g?6:248<=g?5:240<=g?4:224<=g?3:192<=g?2:1;function b(k,x){if(x<65537&&(k.subarray&&i||!k.subarray&&f))return String.fromCharCode.apply(null,h.shrinkBuf(k,x));for(var S="",E=0;E<x;E++)S+=String.fromCharCode(k[E]);return S}d[254]=d[254]=1,c.string2buf=function(k){var x,S,E,T,A,z=k.length,D=0;for(T=0;T<z;T++)(64512&(S=k.charCodeAt(T)))==55296&&T+1<z&&(64512&(E=k.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),D+=S<128?1:S<2048?2:S<65536?3:4;for(x=new h.Buf8(D),T=A=0;A<D;T++)(64512&(S=k.charCodeAt(T)))==55296&&T+1<z&&(64512&(E=k.charCodeAt(T+1)))==56320&&(S=65536+(S-55296<<10)+(E-56320),T++),S<128?x[A++]=S:(S<2048?x[A++]=192|S>>>6:(S<65536?x[A++]=224|S>>>12:(x[A++]=240|S>>>18,x[A++]=128|S>>>12&63),x[A++]=128|S>>>6&63),x[A++]=128|63&S);return x},c.buf2binstring=function(k){return b(k,k.length)},c.binstring2buf=function(k){for(var x=new h.Buf8(k.length),S=0,E=x.length;S<E;S++)x[S]=k.charCodeAt(S);return x},c.buf2string=function(k,x){var S,E,T,A,z=x||k.length,D=new Array(2*z);for(S=E=0;S<z;)if((T=k[S++])<128)D[E++]=T;else if(4<(A=d[T]))D[E++]=65533,S+=A-1;else{for(T&=A===2?31:A===3?15:7;1<A&&S<z;)T=T<<6|63&k[S++],A--;1<A?D[E++]=65533:T<65536?D[E++]=T:(T-=65536,D[E++]=55296|T>>10&1023,D[E++]=56320|1023&T)}return b(D,E)},c.utf8border=function(k,x){var S;for((x=x||k.length)>k.length&&(x=k.length),S=x-1;0<=S&&(192&k[S])==128;)S--;return S<0||S===0?x:S+d[k[S]]>x?S:x}},{"./common":41}],43:[function(a,o,c){o.exports=function(h,f,i,d){for(var g=65535&h|0,b=h>>>16&65535|0,k=0;i!==0;){for(i-=k=2e3<i?2e3:i;b=b+(g=g+f[d++]|0)|0,--k;);g%=65521,b%=65521}return g|b<<16|0}},{}],44:[function(a,o,c){o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(a,o,c){var h=function(){for(var f,i=[],d=0;d<256;d++){f=d;for(var g=0;g<8;g++)f=1&f?3988292384^f>>>1:f>>>1;i[d]=f}return i}();o.exports=function(f,i,d,g){var b=h,k=g+d;f^=-1;for(var x=g;x<k;x++)f=f>>>8^b[255&(f^i[x])];return-1^f}},{}],46:[function(a,o,c){var h,f=a("../utils/common"),i=a("./trees"),d=a("./adler32"),g=a("./crc32"),b=a("./messages"),k=0,x=4,S=0,E=-2,T=-1,A=4,z=2,D=8,F=9,$=286,q=30,J=19,G=2*$+1,oe=15,de=3,Ee=258,ot=Ee+de+1,le=42,Ne=113,Y=1,Qe=2,pt=3,dt=4;function Zt(K,ct){return K.msg=b[ct],ct}function nt(K){return(K<<1)-(4<K?9:0)}function tt(K){for(var ct=K.length;0<=--ct;)K[ct]=0}function ce(K){var ct=K.state,et=ct.pending;et>K.avail_out&&(et=K.avail_out),et!==0&&(f.arraySet(K.output,ct.pending_buf,ct.pending_out,et,K.next_out),K.next_out+=et,ct.pending_out+=et,K.total_out+=et,K.avail_out-=et,ct.pending-=et,ct.pending===0&&(ct.pending_out=0))}function _e(K,ct){i._tr_flush_block(K,0<=K.block_start?K.block_start:-1,K.strstart-K.block_start,ct),K.block_start=K.strstart,ce(K.strm)}function ze(K,ct){K.pending_buf[K.pending++]=ct}function re(K,ct){K.pending_buf[K.pending++]=ct>>>8&255,K.pending_buf[K.pending++]=255&ct}function ue(K,ct){var et,be,me=K.max_chain_length,Ie=K.strstart,ft=K.prev_length,gt=K.nice_match,je=K.strstart>K.w_size-ot?K.strstart-(K.w_size-ot):0,vt=K.window,Bt=K.w_mask,Et=K.prev,Ht=K.strstart+Ee,wr=vt[Ie+ft-1],Fe=vt[Ie+ft];K.prev_length>=K.good_match&&(me>>=2),gt>K.lookahead&&(gt=K.lookahead);do if(vt[(et=ct)+ft]===Fe&&vt[et+ft-1]===wr&&vt[et]===vt[Ie]&&vt[++et]===vt[Ie+1]){Ie+=2,et++;do;while(vt[++Ie]===vt[++et]&&vt[++Ie]===vt[++et]&&vt[++Ie]===vt[++et]&&vt[++Ie]===vt[++et]&&vt[++Ie]===vt[++et]&&vt[++Ie]===vt[++et]&&vt[++Ie]===vt[++et]&&vt[++Ie]===vt[++et]&&Ie<Ht);if(be=Ee-(Ht-Ie),Ie=Ht-Ee,ft<be){if(K.match_start=ct,gt<=(ft=be))break;wr=vt[Ie+ft-1],Fe=vt[Ie+ft]}}while((ct=Et[ct&Bt])>je&&--me!=0);return ft<=K.lookahead?ft:K.lookahead}function Xe(K){var ct,et,be,me,Ie,ft,gt,je,vt,Bt,Et=K.w_size;do{if(me=K.window_size-K.lookahead-K.strstart,K.strstart>=Et+(Et-ot)){for(f.arraySet(K.window,K.window,Et,Et,0),K.match_start-=Et,K.strstart-=Et,K.block_start-=Et,ct=et=K.hash_size;be=K.head[--ct],K.head[ct]=Et<=be?be-Et:0,--et;);for(ct=et=Et;be=K.prev[--ct],K.prev[ct]=Et<=be?be-Et:0,--et;);me+=Et}if(K.strm.avail_in===0)break;if(ft=K.strm,gt=K.window,je=K.strstart+K.lookahead,vt=me,Bt=void 0,Bt=ft.avail_in,vt<Bt&&(Bt=vt),et=Bt===0?0:(ft.avail_in-=Bt,f.arraySet(gt,ft.input,ft.next_in,Bt,je),ft.state.wrap===1?ft.adler=d(ft.adler,gt,Bt,je):ft.state.wrap===2&&(ft.adler=g(ft.adler,gt,Bt,je)),ft.next_in+=Bt,ft.total_in+=Bt,Bt),K.lookahead+=et,K.lookahead+K.insert>=de)for(Ie=K.strstart-K.insert,K.ins_h=K.window[Ie],K.ins_h=(K.ins_h<<K.hash_shift^K.window[Ie+1])&K.hash_mask;K.insert&&(K.ins_h=(K.ins_h<<K.hash_shift^K.window[Ie+de-1])&K.hash_mask,K.prev[Ie&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=Ie,Ie++,K.insert--,!(K.lookahead+K.insert<de)););}while(K.lookahead<ot&&K.strm.avail_in!==0)}function wt(K,ct){for(var et,be;;){if(K.lookahead<ot){if(Xe(K),K.lookahead<ot&&ct===k)return Y;if(K.lookahead===0)break}if(et=0,K.lookahead>=de&&(K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+de-1])&K.hash_mask,et=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),et!==0&&K.strstart-et<=K.w_size-ot&&(K.match_length=ue(K,et)),K.match_length>=de)if(be=i._tr_tally(K,K.strstart-K.match_start,K.match_length-de),K.lookahead-=K.match_length,K.match_length<=K.max_lazy_match&&K.lookahead>=de){for(K.match_length--;K.strstart++,K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+de-1])&K.hash_mask,et=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart,--K.match_length!=0;);K.strstart++}else K.strstart+=K.match_length,K.match_length=0,K.ins_h=K.window[K.strstart],K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+1])&K.hash_mask;else be=i._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++;if(be&&(_e(K,!1),K.strm.avail_out===0))return Y}return K.insert=K.strstart<de-1?K.strstart:de-1,ct===x?(_e(K,!0),K.strm.avail_out===0?pt:dt):K.last_lit&&(_e(K,!1),K.strm.avail_out===0)?Y:Qe}function mt(K,ct){for(var et,be,me;;){if(K.lookahead<ot){if(Xe(K),K.lookahead<ot&&ct===k)return Y;if(K.lookahead===0)break}if(et=0,K.lookahead>=de&&(K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+de-1])&K.hash_mask,et=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),K.prev_length=K.match_length,K.prev_match=K.match_start,K.match_length=de-1,et!==0&&K.prev_length<K.max_lazy_match&&K.strstart-et<=K.w_size-ot&&(K.match_length=ue(K,et),K.match_length<=5&&(K.strategy===1||K.match_length===de&&4096<K.strstart-K.match_start)&&(K.match_length=de-1)),K.prev_length>=de&&K.match_length<=K.prev_length){for(me=K.strstart+K.lookahead-de,be=i._tr_tally(K,K.strstart-1-K.prev_match,K.prev_length-de),K.lookahead-=K.prev_length-1,K.prev_length-=2;++K.strstart<=me&&(K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+de-1])&K.hash_mask,et=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),--K.prev_length!=0;);if(K.match_available=0,K.match_length=de-1,K.strstart++,be&&(_e(K,!1),K.strm.avail_out===0))return Y}else if(K.match_available){if((be=i._tr_tally(K,0,K.window[K.strstart-1]))&&_e(K,!1),K.strstart++,K.lookahead--,K.strm.avail_out===0)return Y}else K.match_available=1,K.strstart++,K.lookahead--}return K.match_available&&(be=i._tr_tally(K,0,K.window[K.strstart-1]),K.match_available=0),K.insert=K.strstart<de-1?K.strstart:de-1,ct===x?(_e(K,!0),K.strm.avail_out===0?pt:dt):K.last_lit&&(_e(K,!1),K.strm.avail_out===0)?Y:Qe}function Ke(K,ct,et,be,me){this.good_length=K,this.max_lazy=ct,this.nice_length=et,this.max_chain=be,this.func=me}function Ot(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=D,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new f.Buf16(2*G),this.dyn_dtree=new f.Buf16(2*(2*q+1)),this.bl_tree=new f.Buf16(2*(2*J+1)),tt(this.dyn_ltree),tt(this.dyn_dtree),tt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new f.Buf16(oe+1),this.heap=new f.Buf16(2*$+1),tt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new f.Buf16(2*$+1),tt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function er(K){var ct;return K&&K.state?(K.total_in=K.total_out=0,K.data_type=z,(ct=K.state).pending=0,ct.pending_out=0,ct.wrap<0&&(ct.wrap=-ct.wrap),ct.status=ct.wrap?le:Ne,K.adler=ct.wrap===2?0:1,ct.last_flush=k,i._tr_init(ct),S):Zt(K,E)}function Lr(K){var ct=er(K);return ct===S&&function(et){et.window_size=2*et.w_size,tt(et.head),et.max_lazy_match=h[et.level].max_lazy,et.good_match=h[et.level].good_length,et.nice_match=h[et.level].nice_length,et.max_chain_length=h[et.level].max_chain,et.strstart=0,et.block_start=0,et.lookahead=0,et.insert=0,et.match_length=et.prev_length=de-1,et.match_available=0,et.ins_h=0}(K.state),ct}function Fr(K,ct,et,be,me,Ie){if(!K)return E;var ft=1;if(ct===T&&(ct=6),be<0?(ft=0,be=-be):15<be&&(ft=2,be-=16),me<1||F<me||et!==D||be<8||15<be||ct<0||9<ct||Ie<0||A<Ie)return Zt(K,E);be===8&&(be=9);var gt=new Ot;return(K.state=gt).strm=K,gt.wrap=ft,gt.gzhead=null,gt.w_bits=be,gt.w_size=1<<gt.w_bits,gt.w_mask=gt.w_size-1,gt.hash_bits=me+7,gt.hash_size=1<<gt.hash_bits,gt.hash_mask=gt.hash_size-1,gt.hash_shift=~~((gt.hash_bits+de-1)/de),gt.window=new f.Buf8(2*gt.w_size),gt.head=new f.Buf16(gt.hash_size),gt.prev=new f.Buf16(gt.w_size),gt.lit_bufsize=1<<me+6,gt.pending_buf_size=4*gt.lit_bufsize,gt.pending_buf=new f.Buf8(gt.pending_buf_size),gt.d_buf=1*gt.lit_bufsize,gt.l_buf=3*gt.lit_bufsize,gt.level=ct,gt.strategy=Ie,gt.method=et,Lr(K)}h=[new Ke(0,0,0,0,function(K,ct){var et=65535;for(et>K.pending_buf_size-5&&(et=K.pending_buf_size-5);;){if(K.lookahead<=1){if(Xe(K),K.lookahead===0&&ct===k)return Y;if(K.lookahead===0)break}K.strstart+=K.lookahead,K.lookahead=0;var be=K.block_start+et;if((K.strstart===0||K.strstart>=be)&&(K.lookahead=K.strstart-be,K.strstart=be,_e(K,!1),K.strm.avail_out===0)||K.strstart-K.block_start>=K.w_size-ot&&(_e(K,!1),K.strm.avail_out===0))return Y}return K.insert=0,ct===x?(_e(K,!0),K.strm.avail_out===0?pt:dt):(K.strstart>K.block_start&&(_e(K,!1),K.strm.avail_out),Y)}),new Ke(4,4,8,4,wt),new Ke(4,5,16,8,wt),new Ke(4,6,32,32,wt),new Ke(4,4,16,16,mt),new Ke(8,16,32,32,mt),new Ke(8,16,128,128,mt),new Ke(8,32,128,256,mt),new Ke(32,128,258,1024,mt),new Ke(32,258,258,4096,mt)],c.deflateInit=function(K,ct){return Fr(K,ct,D,15,8,0)},c.deflateInit2=Fr,c.deflateReset=Lr,c.deflateResetKeep=er,c.deflateSetHeader=function(K,ct){return K&&K.state?K.state.wrap!==2?E:(K.state.gzhead=ct,S):E},c.deflate=function(K,ct){var et,be,me,Ie;if(!K||!K.state||5<ct||ct<0)return K?Zt(K,E):E;if(be=K.state,!K.output||!K.input&&K.avail_in!==0||be.status===666&&ct!==x)return Zt(K,K.avail_out===0?-5:E);if(be.strm=K,et=be.last_flush,be.last_flush=ct,be.status===le)if(be.wrap===2)K.adler=0,ze(be,31),ze(be,139),ze(be,8),be.gzhead?(ze(be,(be.gzhead.text?1:0)+(be.gzhead.hcrc?2:0)+(be.gzhead.extra?4:0)+(be.gzhead.name?8:0)+(be.gzhead.comment?16:0)),ze(be,255&be.gzhead.time),ze(be,be.gzhead.time>>8&255),ze(be,be.gzhead.time>>16&255),ze(be,be.gzhead.time>>24&255),ze(be,be.level===9?2:2<=be.strategy||be.level<2?4:0),ze(be,255&be.gzhead.os),be.gzhead.extra&&be.gzhead.extra.length&&(ze(be,255&be.gzhead.extra.length),ze(be,be.gzhead.extra.length>>8&255)),be.gzhead.hcrc&&(K.adler=g(K.adler,be.pending_buf,be.pending,0)),be.gzindex=0,be.status=69):(ze(be,0),ze(be,0),ze(be,0),ze(be,0),ze(be,0),ze(be,be.level===9?2:2<=be.strategy||be.level<2?4:0),ze(be,3),be.status=Ne);else{var ft=D+(be.w_bits-8<<4)<<8;ft|=(2<=be.strategy||be.level<2?0:be.level<6?1:be.level===6?2:3)<<6,be.strstart!==0&&(ft|=32),ft+=31-ft%31,be.status=Ne,re(be,ft),be.strstart!==0&&(re(be,K.adler>>>16),re(be,65535&K.adler)),K.adler=1}if(be.status===69)if(be.gzhead.extra){for(me=be.pending;be.gzindex<(65535&be.gzhead.extra.length)&&(be.pending!==be.pending_buf_size||(be.gzhead.hcrc&&be.pending>me&&(K.adler=g(K.adler,be.pending_buf,be.pending-me,me)),ce(K),me=be.pending,be.pending!==be.pending_buf_size));)ze(be,255&be.gzhead.extra[be.gzindex]),be.gzindex++;be.gzhead.hcrc&&be.pending>me&&(K.adler=g(K.adler,be.pending_buf,be.pending-me,me)),be.gzindex===be.gzhead.extra.length&&(be.gzindex=0,be.status=73)}else be.status=73;if(be.status===73)if(be.gzhead.name){me=be.pending;do{if(be.pending===be.pending_buf_size&&(be.gzhead.hcrc&&be.pending>me&&(K.adler=g(K.adler,be.pending_buf,be.pending-me,me)),ce(K),me=be.pending,be.pending===be.pending_buf_size)){Ie=1;break}Ie=be.gzindex<be.gzhead.name.length?255&be.gzhead.name.charCodeAt(be.gzindex++):0,ze(be,Ie)}while(Ie!==0);be.gzhead.hcrc&&be.pending>me&&(K.adler=g(K.adler,be.pending_buf,be.pending-me,me)),Ie===0&&(be.gzindex=0,be.status=91)}else be.status=91;if(be.status===91)if(be.gzhead.comment){me=be.pending;do{if(be.pending===be.pending_buf_size&&(be.gzhead.hcrc&&be.pending>me&&(K.adler=g(K.adler,be.pending_buf,be.pending-me,me)),ce(K),me=be.pending,be.pending===be.pending_buf_size)){Ie=1;break}Ie=be.gzindex<be.gzhead.comment.length?255&be.gzhead.comment.charCodeAt(be.gzindex++):0,ze(be,Ie)}while(Ie!==0);be.gzhead.hcrc&&be.pending>me&&(K.adler=g(K.adler,be.pending_buf,be.pending-me,me)),Ie===0&&(be.status=103)}else be.status=103;if(be.status===103&&(be.gzhead.hcrc?(be.pending+2>be.pending_buf_size&&ce(K),be.pending+2<=be.pending_buf_size&&(ze(be,255&K.adler),ze(be,K.adler>>8&255),K.adler=0,be.status=Ne)):be.status=Ne),be.pending!==0){if(ce(K),K.avail_out===0)return be.last_flush=-1,S}else if(K.avail_in===0&&nt(ct)<=nt(et)&&ct!==x)return Zt(K,-5);if(be.status===666&&K.avail_in!==0)return Zt(K,-5);if(K.avail_in!==0||be.lookahead!==0||ct!==k&&be.status!==666){var gt=be.strategy===2?function(je,vt){for(var Bt;;){if(je.lookahead===0&&(Xe(je),je.lookahead===0)){if(vt===k)return Y;break}if(je.match_length=0,Bt=i._tr_tally(je,0,je.window[je.strstart]),je.lookahead--,je.strstart++,Bt&&(_e(je,!1),je.strm.avail_out===0))return Y}return je.insert=0,vt===x?(_e(je,!0),je.strm.avail_out===0?pt:dt):je.last_lit&&(_e(je,!1),je.strm.avail_out===0)?Y:Qe}(be,ct):be.strategy===3?function(je,vt){for(var Bt,Et,Ht,wr,Fe=je.window;;){if(je.lookahead<=Ee){if(Xe(je),je.lookahead<=Ee&&vt===k)return Y;if(je.lookahead===0)break}if(je.match_length=0,je.lookahead>=de&&0<je.strstart&&(Et=Fe[Ht=je.strstart-1])===Fe[++Ht]&&Et===Fe[++Ht]&&Et===Fe[++Ht]){wr=je.strstart+Ee;do;while(Et===Fe[++Ht]&&Et===Fe[++Ht]&&Et===Fe[++Ht]&&Et===Fe[++Ht]&&Et===Fe[++Ht]&&Et===Fe[++Ht]&&Et===Fe[++Ht]&&Et===Fe[++Ht]&&Ht<wr);je.match_length=Ee-(wr-Ht),je.match_length>je.lookahead&&(je.match_length=je.lookahead)}if(je.match_length>=de?(Bt=i._tr_tally(je,1,je.match_length-de),je.lookahead-=je.match_length,je.strstart+=je.match_length,je.match_length=0):(Bt=i._tr_tally(je,0,je.window[je.strstart]),je.lookahead--,je.strstart++),Bt&&(_e(je,!1),je.strm.avail_out===0))return Y}return je.insert=0,vt===x?(_e(je,!0),je.strm.avail_out===0?pt:dt):je.last_lit&&(_e(je,!1),je.strm.avail_out===0)?Y:Qe}(be,ct):h[be.level].func(be,ct);if(gt!==pt&&gt!==dt||(be.status=666),gt===Y||gt===pt)return K.avail_out===0&&(be.last_flush=-1),S;if(gt===Qe&&(ct===1?i._tr_align(be):ct!==5&&(i._tr_stored_block(be,0,0,!1),ct===3&&(tt(be.head),be.lookahead===0&&(be.strstart=0,be.block_start=0,be.insert=0))),ce(K),K.avail_out===0))return be.last_flush=-1,S}return ct!==x?S:be.wrap<=0?1:(be.wrap===2?(ze(be,255&K.adler),ze(be,K.adler>>8&255),ze(be,K.adler>>16&255),ze(be,K.adler>>24&255),ze(be,255&K.total_in),ze(be,K.total_in>>8&255),ze(be,K.total_in>>16&255),ze(be,K.total_in>>24&255)):(re(be,K.adler>>>16),re(be,65535&K.adler)),ce(K),0<be.wrap&&(be.wrap=-be.wrap),be.pending!==0?S:1)},c.deflateEnd=function(K){var ct;return K&&K.state?(ct=K.state.status)!==le&&ct!==69&&ct!==73&&ct!==91&&ct!==103&&ct!==Ne&&ct!==666?Zt(K,E):(K.state=null,ct===Ne?Zt(K,-3):S):E},c.deflateSetDictionary=function(K,ct){var et,be,me,Ie,ft,gt,je,vt,Bt=ct.length;if(!K||!K.state||(Ie=(et=K.state).wrap)===2||Ie===1&&et.status!==le||et.lookahead)return E;for(Ie===1&&(K.adler=d(K.adler,ct,Bt,0)),et.wrap=0,Bt>=et.w_size&&(Ie===0&&(tt(et.head),et.strstart=0,et.block_start=0,et.insert=0),vt=new f.Buf8(et.w_size),f.arraySet(vt,ct,Bt-et.w_size,et.w_size,0),ct=vt,Bt=et.w_size),ft=K.avail_in,gt=K.next_in,je=K.input,K.avail_in=Bt,K.next_in=0,K.input=ct,Xe(et);et.lookahead>=de;){for(be=et.strstart,me=et.lookahead-(de-1);et.ins_h=(et.ins_h<<et.hash_shift^et.window[be+de-1])&et.hash_mask,et.prev[be&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=be,be++,--me;);et.strstart=be,et.lookahead=de-1,Xe(et)}return et.strstart+=et.lookahead,et.block_start=et.strstart,et.insert=et.lookahead,et.lookahead=0,et.match_length=et.prev_length=de-1,et.match_available=0,K.next_in=gt,K.input=je,K.avail_in=ft,et.wrap=Ie,S},c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(a,o,c){o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(a,o,c){o.exports=function(h,f){var i,d,g,b,k,x,S,E,T,A,z,D,F,$,q,J,G,oe,de,Ee,ot,le,Ne,Y,Qe;i=h.state,d=h.next_in,Y=h.input,g=d+(h.avail_in-5),b=h.next_out,Qe=h.output,k=b-(f-h.avail_out),x=b+(h.avail_out-257),S=i.dmax,E=i.wsize,T=i.whave,A=i.wnext,z=i.window,D=i.hold,F=i.bits,$=i.lencode,q=i.distcode,J=(1<<i.lenbits)-1,G=(1<<i.distbits)-1;e:do{F<15&&(D+=Y[d++]<<F,F+=8,D+=Y[d++]<<F,F+=8),oe=$[D&J];t:for(;;){if(D>>>=de=oe>>>24,F-=de,(de=oe>>>16&255)===0)Qe[b++]=65535&oe;else{if(!(16&de)){if(!(64&de)){oe=$[(65535&oe)+(D&(1<<de)-1)];continue t}if(32&de){i.mode=12;break e}h.msg="invalid literal/length code",i.mode=30;break e}Ee=65535&oe,(de&=15)&&(F<de&&(D+=Y[d++]<<F,F+=8),Ee+=D&(1<<de)-1,D>>>=de,F-=de),F<15&&(D+=Y[d++]<<F,F+=8,D+=Y[d++]<<F,F+=8),oe=q[D&G];r:for(;;){if(D>>>=de=oe>>>24,F-=de,!(16&(de=oe>>>16&255))){if(!(64&de)){oe=q[(65535&oe)+(D&(1<<de)-1)];continue r}h.msg="invalid distance code",i.mode=30;break e}if(ot=65535&oe,F<(de&=15)&&(D+=Y[d++]<<F,(F+=8)<de&&(D+=Y[d++]<<F,F+=8)),S<(ot+=D&(1<<de)-1)){h.msg="invalid distance too far back",i.mode=30;break e}if(D>>>=de,F-=de,(de=b-k)<ot){if(T<(de=ot-de)&&i.sane){h.msg="invalid distance too far back",i.mode=30;break e}if(Ne=z,(le=0)===A){if(le+=E-de,de<Ee){for(Ee-=de;Qe[b++]=z[le++],--de;);le=b-ot,Ne=Qe}}else if(A<de){if(le+=E+A-de,(de-=A)<Ee){for(Ee-=de;Qe[b++]=z[le++],--de;);if(le=0,A<Ee){for(Ee-=de=A;Qe[b++]=z[le++],--de;);le=b-ot,Ne=Qe}}}else if(le+=A-de,de<Ee){for(Ee-=de;Qe[b++]=z[le++],--de;);le=b-ot,Ne=Qe}for(;2<Ee;)Qe[b++]=Ne[le++],Qe[b++]=Ne[le++],Qe[b++]=Ne[le++],Ee-=3;Ee&&(Qe[b++]=Ne[le++],1<Ee&&(Qe[b++]=Ne[le++]))}else{for(le=b-ot;Qe[b++]=Qe[le++],Qe[b++]=Qe[le++],Qe[b++]=Qe[le++],2<(Ee-=3););Ee&&(Qe[b++]=Qe[le++],1<Ee&&(Qe[b++]=Qe[le++]))}break}}break}}while(d<g&&b<x);d-=Ee=F>>3,D&=(1<<(F-=Ee<<3))-1,h.next_in=d,h.next_out=b,h.avail_in=d<g?g-d+5:5-(d-g),h.avail_out=b<x?x-b+257:257-(b-x),i.hold=D,i.bits=F}},{}],49:[function(a,o,c){var h=a("../utils/common"),f=a("./adler32"),i=a("./crc32"),d=a("./inffast"),g=a("./inftrees"),b=1,k=2,x=0,S=-2,E=1,T=852,A=592;function z(le){return(le>>>24&255)+(le>>>8&65280)+((65280&le)<<8)+((255&le)<<24)}function D(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new h.Buf16(320),this.work=new h.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function F(le){var Ne;return le&&le.state?(Ne=le.state,le.total_in=le.total_out=Ne.total=0,le.msg="",Ne.wrap&&(le.adler=1&Ne.wrap),Ne.mode=E,Ne.last=0,Ne.havedict=0,Ne.dmax=32768,Ne.head=null,Ne.hold=0,Ne.bits=0,Ne.lencode=Ne.lendyn=new h.Buf32(T),Ne.distcode=Ne.distdyn=new h.Buf32(A),Ne.sane=1,Ne.back=-1,x):S}function $(le){var Ne;return le&&le.state?((Ne=le.state).wsize=0,Ne.whave=0,Ne.wnext=0,F(le)):S}function q(le,Ne){var Y,Qe;return le&&le.state?(Qe=le.state,Ne<0?(Y=0,Ne=-Ne):(Y=1+(Ne>>4),Ne<48&&(Ne&=15)),Ne&&(Ne<8||15<Ne)?S:(Qe.window!==null&&Qe.wbits!==Ne&&(Qe.window=null),Qe.wrap=Y,Qe.wbits=Ne,$(le))):S}function J(le,Ne){var Y,Qe;return le?(Qe=new D,(le.state=Qe).window=null,(Y=q(le,Ne))!==x&&(le.state=null),Y):S}var G,oe,de=!0;function Ee(le){if(de){var Ne;for(G=new h.Buf32(512),oe=new h.Buf32(32),Ne=0;Ne<144;)le.lens[Ne++]=8;for(;Ne<256;)le.lens[Ne++]=9;for(;Ne<280;)le.lens[Ne++]=7;for(;Ne<288;)le.lens[Ne++]=8;for(g(b,le.lens,0,288,G,0,le.work,{bits:9}),Ne=0;Ne<32;)le.lens[Ne++]=5;g(k,le.lens,0,32,oe,0,le.work,{bits:5}),de=!1}le.lencode=G,le.lenbits=9,le.distcode=oe,le.distbits=5}function ot(le,Ne,Y,Qe){var pt,dt=le.state;return dt.window===null&&(dt.wsize=1<<dt.wbits,dt.wnext=0,dt.whave=0,dt.window=new h.Buf8(dt.wsize)),Qe>=dt.wsize?(h.arraySet(dt.window,Ne,Y-dt.wsize,dt.wsize,0),dt.wnext=0,dt.whave=dt.wsize):(Qe<(pt=dt.wsize-dt.wnext)&&(pt=Qe),h.arraySet(dt.window,Ne,Y-Qe,pt,dt.wnext),(Qe-=pt)?(h.arraySet(dt.window,Ne,Y-Qe,Qe,0),dt.wnext=Qe,dt.whave=dt.wsize):(dt.wnext+=pt,dt.wnext===dt.wsize&&(dt.wnext=0),dt.whave<dt.wsize&&(dt.whave+=pt))),0}c.inflateReset=$,c.inflateReset2=q,c.inflateResetKeep=F,c.inflateInit=function(le){return J(le,15)},c.inflateInit2=J,c.inflate=function(le,Ne){var Y,Qe,pt,dt,Zt,nt,tt,ce,_e,ze,re,ue,Xe,wt,mt,Ke,Ot,er,Lr,Fr,K,ct,et,be,me=0,Ie=new h.Buf8(4),ft=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!le||!le.state||!le.output||!le.input&&le.avail_in!==0)return S;(Y=le.state).mode===12&&(Y.mode=13),Zt=le.next_out,pt=le.output,tt=le.avail_out,dt=le.next_in,Qe=le.input,nt=le.avail_in,ce=Y.hold,_e=Y.bits,ze=nt,re=tt,ct=x;e:for(;;)switch(Y.mode){case E:if(Y.wrap===0){Y.mode=13;break}for(;_e<16;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(2&Y.wrap&&ce===35615){Ie[Y.check=0]=255&ce,Ie[1]=ce>>>8&255,Y.check=i(Y.check,Ie,2,0),_e=ce=0,Y.mode=2;break}if(Y.flags=0,Y.head&&(Y.head.done=!1),!(1&Y.wrap)||(((255&ce)<<8)+(ce>>8))%31){le.msg="incorrect header check",Y.mode=30;break}if((15&ce)!=8){le.msg="unknown compression method",Y.mode=30;break}if(_e-=4,K=8+(15&(ce>>>=4)),Y.wbits===0)Y.wbits=K;else if(K>Y.wbits){le.msg="invalid window size",Y.mode=30;break}Y.dmax=1<<K,le.adler=Y.check=1,Y.mode=512&ce?10:12,_e=ce=0;break;case 2:for(;_e<16;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(Y.flags=ce,(255&Y.flags)!=8){le.msg="unknown compression method",Y.mode=30;break}if(57344&Y.flags){le.msg="unknown header flags set",Y.mode=30;break}Y.head&&(Y.head.text=ce>>8&1),512&Y.flags&&(Ie[0]=255&ce,Ie[1]=ce>>>8&255,Y.check=i(Y.check,Ie,2,0)),_e=ce=0,Y.mode=3;case 3:for(;_e<32;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}Y.head&&(Y.head.time=ce),512&Y.flags&&(Ie[0]=255&ce,Ie[1]=ce>>>8&255,Ie[2]=ce>>>16&255,Ie[3]=ce>>>24&255,Y.check=i(Y.check,Ie,4,0)),_e=ce=0,Y.mode=4;case 4:for(;_e<16;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}Y.head&&(Y.head.xflags=255&ce,Y.head.os=ce>>8),512&Y.flags&&(Ie[0]=255&ce,Ie[1]=ce>>>8&255,Y.check=i(Y.check,Ie,2,0)),_e=ce=0,Y.mode=5;case 5:if(1024&Y.flags){for(;_e<16;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}Y.length=ce,Y.head&&(Y.head.extra_len=ce),512&Y.flags&&(Ie[0]=255&ce,Ie[1]=ce>>>8&255,Y.check=i(Y.check,Ie,2,0)),_e=ce=0}else Y.head&&(Y.head.extra=null);Y.mode=6;case 6:if(1024&Y.flags&&(nt<(ue=Y.length)&&(ue=nt),ue&&(Y.head&&(K=Y.head.extra_len-Y.length,Y.head.extra||(Y.head.extra=new Array(Y.head.extra_len)),h.arraySet(Y.head.extra,Qe,dt,ue,K)),512&Y.flags&&(Y.check=i(Y.check,Qe,ue,dt)),nt-=ue,dt+=ue,Y.length-=ue),Y.length))break e;Y.length=0,Y.mode=7;case 7:if(2048&Y.flags){if(nt===0)break e;for(ue=0;K=Qe[dt+ue++],Y.head&&K&&Y.length<65536&&(Y.head.name+=String.fromCharCode(K)),K&&ue<nt;);if(512&Y.flags&&(Y.check=i(Y.check,Qe,ue,dt)),nt-=ue,dt+=ue,K)break e}else Y.head&&(Y.head.name=null);Y.length=0,Y.mode=8;case 8:if(4096&Y.flags){if(nt===0)break e;for(ue=0;K=Qe[dt+ue++],Y.head&&K&&Y.length<65536&&(Y.head.comment+=String.fromCharCode(K)),K&&ue<nt;);if(512&Y.flags&&(Y.check=i(Y.check,Qe,ue,dt)),nt-=ue,dt+=ue,K)break e}else Y.head&&(Y.head.comment=null);Y.mode=9;case 9:if(512&Y.flags){for(;_e<16;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(ce!==(65535&Y.check)){le.msg="header crc mismatch",Y.mode=30;break}_e=ce=0}Y.head&&(Y.head.hcrc=Y.flags>>9&1,Y.head.done=!0),le.adler=Y.check=0,Y.mode=12;break;case 10:for(;_e<32;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}le.adler=Y.check=z(ce),_e=ce=0,Y.mode=11;case 11:if(Y.havedict===0)return le.next_out=Zt,le.avail_out=tt,le.next_in=dt,le.avail_in=nt,Y.hold=ce,Y.bits=_e,2;le.adler=Y.check=1,Y.mode=12;case 12:if(Ne===5||Ne===6)break e;case 13:if(Y.last){ce>>>=7&_e,_e-=7&_e,Y.mode=27;break}for(;_e<3;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}switch(Y.last=1&ce,_e-=1,3&(ce>>>=1)){case 0:Y.mode=14;break;case 1:if(Ee(Y),Y.mode=20,Ne!==6)break;ce>>>=2,_e-=2;break e;case 2:Y.mode=17;break;case 3:le.msg="invalid block type",Y.mode=30}ce>>>=2,_e-=2;break;case 14:for(ce>>>=7&_e,_e-=7&_e;_e<32;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if((65535&ce)!=(ce>>>16^65535)){le.msg="invalid stored block lengths",Y.mode=30;break}if(Y.length=65535&ce,_e=ce=0,Y.mode=15,Ne===6)break e;case 15:Y.mode=16;case 16:if(ue=Y.length){if(nt<ue&&(ue=nt),tt<ue&&(ue=tt),ue===0)break e;h.arraySet(pt,Qe,dt,ue,Zt),nt-=ue,dt+=ue,tt-=ue,Zt+=ue,Y.length-=ue;break}Y.mode=12;break;case 17:for(;_e<14;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(Y.nlen=257+(31&ce),ce>>>=5,_e-=5,Y.ndist=1+(31&ce),ce>>>=5,_e-=5,Y.ncode=4+(15&ce),ce>>>=4,_e-=4,286<Y.nlen||30<Y.ndist){le.msg="too many length or distance symbols",Y.mode=30;break}Y.have=0,Y.mode=18;case 18:for(;Y.have<Y.ncode;){for(;_e<3;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}Y.lens[ft[Y.have++]]=7&ce,ce>>>=3,_e-=3}for(;Y.have<19;)Y.lens[ft[Y.have++]]=0;if(Y.lencode=Y.lendyn,Y.lenbits=7,et={bits:Y.lenbits},ct=g(0,Y.lens,0,19,Y.lencode,0,Y.work,et),Y.lenbits=et.bits,ct){le.msg="invalid code lengths set",Y.mode=30;break}Y.have=0,Y.mode=19;case 19:for(;Y.have<Y.nlen+Y.ndist;){for(;Ke=(me=Y.lencode[ce&(1<<Y.lenbits)-1])>>>16&255,Ot=65535&me,!((mt=me>>>24)<=_e);){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(Ot<16)ce>>>=mt,_e-=mt,Y.lens[Y.have++]=Ot;else{if(Ot===16){for(be=mt+2;_e<be;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(ce>>>=mt,_e-=mt,Y.have===0){le.msg="invalid bit length repeat",Y.mode=30;break}K=Y.lens[Y.have-1],ue=3+(3&ce),ce>>>=2,_e-=2}else if(Ot===17){for(be=mt+3;_e<be;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}_e-=mt,K=0,ue=3+(7&(ce>>>=mt)),ce>>>=3,_e-=3}else{for(be=mt+7;_e<be;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}_e-=mt,K=0,ue=11+(127&(ce>>>=mt)),ce>>>=7,_e-=7}if(Y.have+ue>Y.nlen+Y.ndist){le.msg="invalid bit length repeat",Y.mode=30;break}for(;ue--;)Y.lens[Y.have++]=K}}if(Y.mode===30)break;if(Y.lens[256]===0){le.msg="invalid code -- missing end-of-block",Y.mode=30;break}if(Y.lenbits=9,et={bits:Y.lenbits},ct=g(b,Y.lens,0,Y.nlen,Y.lencode,0,Y.work,et),Y.lenbits=et.bits,ct){le.msg="invalid literal/lengths set",Y.mode=30;break}if(Y.distbits=6,Y.distcode=Y.distdyn,et={bits:Y.distbits},ct=g(k,Y.lens,Y.nlen,Y.ndist,Y.distcode,0,Y.work,et),Y.distbits=et.bits,ct){le.msg="invalid distances set",Y.mode=30;break}if(Y.mode=20,Ne===6)break e;case 20:Y.mode=21;case 21:if(6<=nt&&258<=tt){le.next_out=Zt,le.avail_out=tt,le.next_in=dt,le.avail_in=nt,Y.hold=ce,Y.bits=_e,d(le,re),Zt=le.next_out,pt=le.output,tt=le.avail_out,dt=le.next_in,Qe=le.input,nt=le.avail_in,ce=Y.hold,_e=Y.bits,Y.mode===12&&(Y.back=-1);break}for(Y.back=0;Ke=(me=Y.lencode[ce&(1<<Y.lenbits)-1])>>>16&255,Ot=65535&me,!((mt=me>>>24)<=_e);){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(Ke&&!(240&Ke)){for(er=mt,Lr=Ke,Fr=Ot;Ke=(me=Y.lencode[Fr+((ce&(1<<er+Lr)-1)>>er)])>>>16&255,Ot=65535&me,!(er+(mt=me>>>24)<=_e);){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}ce>>>=er,_e-=er,Y.back+=er}if(ce>>>=mt,_e-=mt,Y.back+=mt,Y.length=Ot,Ke===0){Y.mode=26;break}if(32&Ke){Y.back=-1,Y.mode=12;break}if(64&Ke){le.msg="invalid literal/length code",Y.mode=30;break}Y.extra=15&Ke,Y.mode=22;case 22:if(Y.extra){for(be=Y.extra;_e<be;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}Y.length+=ce&(1<<Y.extra)-1,ce>>>=Y.extra,_e-=Y.extra,Y.back+=Y.extra}Y.was=Y.length,Y.mode=23;case 23:for(;Ke=(me=Y.distcode[ce&(1<<Y.distbits)-1])>>>16&255,Ot=65535&me,!((mt=me>>>24)<=_e);){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(!(240&Ke)){for(er=mt,Lr=Ke,Fr=Ot;Ke=(me=Y.distcode[Fr+((ce&(1<<er+Lr)-1)>>er)])>>>16&255,Ot=65535&me,!(er+(mt=me>>>24)<=_e);){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}ce>>>=er,_e-=er,Y.back+=er}if(ce>>>=mt,_e-=mt,Y.back+=mt,64&Ke){le.msg="invalid distance code",Y.mode=30;break}Y.offset=Ot,Y.extra=15&Ke,Y.mode=24;case 24:if(Y.extra){for(be=Y.extra;_e<be;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}Y.offset+=ce&(1<<Y.extra)-1,ce>>>=Y.extra,_e-=Y.extra,Y.back+=Y.extra}if(Y.offset>Y.dmax){le.msg="invalid distance too far back",Y.mode=30;break}Y.mode=25;case 25:if(tt===0)break e;if(ue=re-tt,Y.offset>ue){if((ue=Y.offset-ue)>Y.whave&&Y.sane){le.msg="invalid distance too far back",Y.mode=30;break}Xe=ue>Y.wnext?(ue-=Y.wnext,Y.wsize-ue):Y.wnext-ue,ue>Y.length&&(ue=Y.length),wt=Y.window}else wt=pt,Xe=Zt-Y.offset,ue=Y.length;for(tt<ue&&(ue=tt),tt-=ue,Y.length-=ue;pt[Zt++]=wt[Xe++],--ue;);Y.length===0&&(Y.mode=21);break;case 26:if(tt===0)break e;pt[Zt++]=Y.length,tt--,Y.mode=21;break;case 27:if(Y.wrap){for(;_e<32;){if(nt===0)break e;nt--,ce|=Qe[dt++]<<_e,_e+=8}if(re-=tt,le.total_out+=re,Y.total+=re,re&&(le.adler=Y.check=Y.flags?i(Y.check,pt,re,Zt-re):f(Y.check,pt,re,Zt-re)),re=tt,(Y.flags?ce:z(ce))!==Y.check){le.msg="incorrect data check",Y.mode=30;break}_e=ce=0}Y.mode=28;case 28:if(Y.wrap&&Y.flags){for(;_e<32;){if(nt===0)break e;nt--,ce+=Qe[dt++]<<_e,_e+=8}if(ce!==(4294967295&Y.total)){le.msg="incorrect length check",Y.mode=30;break}_e=ce=0}Y.mode=29;case 29:ct=1;break e;case 30:ct=-3;break e;case 31:return-4;case 32:default:return S}return le.next_out=Zt,le.avail_out=tt,le.next_in=dt,le.avail_in=nt,Y.hold=ce,Y.bits=_e,(Y.wsize||re!==le.avail_out&&Y.mode<30&&(Y.mode<27||Ne!==4))&&ot(le,le.output,le.next_out,re-le.avail_out)?(Y.mode=31,-4):(ze-=le.avail_in,re-=le.avail_out,le.total_in+=ze,le.total_out+=re,Y.total+=re,Y.wrap&&re&&(le.adler=Y.check=Y.flags?i(Y.check,pt,re,le.next_out-re):f(Y.check,pt,re,le.next_out-re)),le.data_type=Y.bits+(Y.last?64:0)+(Y.mode===12?128:0)+(Y.mode===20||Y.mode===15?256:0),(ze==0&&re===0||Ne===4)&&ct===x&&(ct=-5),ct)},c.inflateEnd=function(le){if(!le||!le.state)return S;var Ne=le.state;return Ne.window&&(Ne.window=null),le.state=null,x},c.inflateGetHeader=function(le,Ne){var Y;return le&&le.state&&2&(Y=le.state).wrap?((Y.head=Ne).done=!1,x):S},c.inflateSetDictionary=function(le,Ne){var Y,Qe=Ne.length;return le&&le.state?(Y=le.state).wrap!==0&&Y.mode!==11?S:Y.mode===11&&f(1,Ne,Qe,0)!==Y.check?-3:ot(le,Ne,Qe,Qe)?(Y.mode=31,-4):(Y.havedict=1,x):S},c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(a,o,c){var h=a("../utils/common"),f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];o.exports=function(b,k,x,S,E,T,A,z){var D,F,$,q,J,G,oe,de,Ee,ot=z.bits,le=0,Ne=0,Y=0,Qe=0,pt=0,dt=0,Zt=0,nt=0,tt=0,ce=0,_e=null,ze=0,re=new h.Buf16(16),ue=new h.Buf16(16),Xe=null,wt=0;for(le=0;le<=15;le++)re[le]=0;for(Ne=0;Ne<S;Ne++)re[k[x+Ne]]++;for(pt=ot,Qe=15;1<=Qe&&re[Qe]===0;Qe--);if(Qe<pt&&(pt=Qe),Qe===0)return E[T++]=20971520,E[T++]=20971520,z.bits=1,0;for(Y=1;Y<Qe&&re[Y]===0;Y++);for(pt<Y&&(pt=Y),le=nt=1;le<=15;le++)if(nt<<=1,(nt-=re[le])<0)return-1;if(0<nt&&(b===0||Qe!==1))return-1;for(ue[1]=0,le=1;le<15;le++)ue[le+1]=ue[le]+re[le];for(Ne=0;Ne<S;Ne++)k[x+Ne]!==0&&(A[ue[k[x+Ne]]++]=Ne);if(G=b===0?(_e=Xe=A,19):b===1?(_e=f,ze-=257,Xe=i,wt-=257,256):(_e=d,Xe=g,-1),le=Y,J=T,Zt=Ne=ce=0,$=-1,q=(tt=1<<(dt=pt))-1,b===1&&852<tt||b===2&&592<tt)return 1;for(;;){for(oe=le-Zt,Ee=A[Ne]<G?(de=0,A[Ne]):A[Ne]>G?(de=Xe[wt+A[Ne]],_e[ze+A[Ne]]):(de=96,0),D=1<<le-Zt,Y=F=1<<dt;E[J+(ce>>Zt)+(F-=D)]=oe<<24|de<<16|Ee|0,F!==0;);for(D=1<<le-1;ce&D;)D>>=1;if(D!==0?(ce&=D-1,ce+=D):ce=0,Ne++,--re[le]==0){if(le===Qe)break;le=k[x+A[Ne]]}if(pt<le&&(ce&q)!==$){for(Zt===0&&(Zt=pt),J+=Y,nt=1<<(dt=le-Zt);dt+Zt<Qe&&!((nt-=re[dt+Zt])<=0);)dt++,nt<<=1;if(tt+=1<<dt,b===1&&852<tt||b===2&&592<tt)return 1;E[$=ce&q]=pt<<24|dt<<16|J-T|0}}return ce!==0&&(E[J+ce]=le-Zt<<24|64<<16|0),z.bits=pt,0}},{"../utils/common":41}],51:[function(a,o,c){o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(a,o,c){var h=a("../utils/common"),f=0,i=1;function d(me){for(var Ie=me.length;0<=--Ie;)me[Ie]=0}var g=0,b=29,k=256,x=k+1+b,S=30,E=19,T=2*x+1,A=15,z=16,D=7,F=256,$=16,q=17,J=18,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],oe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],de=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ot=new Array(2*(x+2));d(ot);var le=new Array(2*S);d(le);var Ne=new Array(512);d(Ne);var Y=new Array(256);d(Y);var Qe=new Array(b);d(Qe);var pt,dt,Zt,nt=new Array(S);function tt(me,Ie,ft,gt,je){this.static_tree=me,this.extra_bits=Ie,this.extra_base=ft,this.elems=gt,this.max_length=je,this.has_stree=me&&me.length}function ce(me,Ie){this.dyn_tree=me,this.max_code=0,this.stat_desc=Ie}function _e(me){return me<256?Ne[me]:Ne[256+(me>>>7)]}function ze(me,Ie){me.pending_buf[me.pending++]=255&Ie,me.pending_buf[me.pending++]=Ie>>>8&255}function re(me,Ie,ft){me.bi_valid>z-ft?(me.bi_buf|=Ie<<me.bi_valid&65535,ze(me,me.bi_buf),me.bi_buf=Ie>>z-me.bi_valid,me.bi_valid+=ft-z):(me.bi_buf|=Ie<<me.bi_valid&65535,me.bi_valid+=ft)}function ue(me,Ie,ft){re(me,ft[2*Ie],ft[2*Ie+1])}function Xe(me,Ie){for(var ft=0;ft|=1&me,me>>>=1,ft<<=1,0<--Ie;);return ft>>>1}function wt(me,Ie,ft){var gt,je,vt=new Array(A+1),Bt=0;for(gt=1;gt<=A;gt++)vt[gt]=Bt=Bt+ft[gt-1]<<1;for(je=0;je<=Ie;je++){var Et=me[2*je+1];Et!==0&&(me[2*je]=Xe(vt[Et]++,Et))}}function mt(me){var Ie;for(Ie=0;Ie<x;Ie++)me.dyn_ltree[2*Ie]=0;for(Ie=0;Ie<S;Ie++)me.dyn_dtree[2*Ie]=0;for(Ie=0;Ie<E;Ie++)me.bl_tree[2*Ie]=0;me.dyn_ltree[2*F]=1,me.opt_len=me.static_len=0,me.last_lit=me.matches=0}function Ke(me){8<me.bi_valid?ze(me,me.bi_buf):0<me.bi_valid&&(me.pending_buf[me.pending++]=me.bi_buf),me.bi_buf=0,me.bi_valid=0}function Ot(me,Ie,ft,gt){var je=2*Ie,vt=2*ft;return me[je]<me[vt]||me[je]===me[vt]&&gt[Ie]<=gt[ft]}function er(me,Ie,ft){for(var gt=me.heap[ft],je=ft<<1;je<=me.heap_len&&(je<me.heap_len&&Ot(Ie,me.heap[je+1],me.heap[je],me.depth)&&je++,!Ot(Ie,gt,me.heap[je],me.depth));)me.heap[ft]=me.heap[je],ft=je,je<<=1;me.heap[ft]=gt}function Lr(me,Ie,ft){var gt,je,vt,Bt,Et=0;if(me.last_lit!==0)for(;gt=me.pending_buf[me.d_buf+2*Et]<<8|me.pending_buf[me.d_buf+2*Et+1],je=me.pending_buf[me.l_buf+Et],Et++,gt===0?ue(me,je,Ie):(ue(me,(vt=Y[je])+k+1,Ie),(Bt=G[vt])!==0&&re(me,je-=Qe[vt],Bt),ue(me,vt=_e(--gt),ft),(Bt=oe[vt])!==0&&re(me,gt-=nt[vt],Bt)),Et<me.last_lit;);ue(me,F,Ie)}function Fr(me,Ie){var ft,gt,je,vt=Ie.dyn_tree,Bt=Ie.stat_desc.static_tree,Et=Ie.stat_desc.has_stree,Ht=Ie.stat_desc.elems,wr=-1;for(me.heap_len=0,me.heap_max=T,ft=0;ft<Ht;ft++)vt[2*ft]!==0?(me.heap[++me.heap_len]=wr=ft,me.depth[ft]=0):vt[2*ft+1]=0;for(;me.heap_len<2;)vt[2*(je=me.heap[++me.heap_len]=wr<2?++wr:0)]=1,me.depth[je]=0,me.opt_len--,Et&&(me.static_len-=Bt[2*je+1]);for(Ie.max_code=wr,ft=me.heap_len>>1;1<=ft;ft--)er(me,vt,ft);for(je=Ht;ft=me.heap[1],me.heap[1]=me.heap[me.heap_len--],er(me,vt,1),gt=me.heap[1],me.heap[--me.heap_max]=ft,me.heap[--me.heap_max]=gt,vt[2*je]=vt[2*ft]+vt[2*gt],me.depth[je]=(me.depth[ft]>=me.depth[gt]?me.depth[ft]:me.depth[gt])+1,vt[2*ft+1]=vt[2*gt+1]=je,me.heap[1]=je++,er(me,vt,1),2<=me.heap_len;);me.heap[--me.heap_max]=me.heap[1],function(Fe,_t){var gi,ri,yr,kr,_i,ki,yi=_t.dyn_tree,Tt=_t.max_code,pr=_t.stat_desc.static_tree,hr=_t.stat_desc.has_stree,vi=_t.stat_desc.extra_bits,sn=_t.stat_desc.extra_base,ar=_t.stat_desc.max_length,$i=0;for(kr=0;kr<=A;kr++)Fe.bl_count[kr]=0;for(yi[2*Fe.heap[Fe.heap_max]+1]=0,gi=Fe.heap_max+1;gi<T;gi++)ar<(kr=yi[2*yi[2*(ri=Fe.heap[gi])+1]+1]+1)&&(kr=ar,$i++),yi[2*ri+1]=kr,Tt<ri||(Fe.bl_count[kr]++,_i=0,sn<=ri&&(_i=vi[ri-sn]),ki=yi[2*ri],Fe.opt_len+=ki*(kr+_i),hr&&(Fe.static_len+=ki*(pr[2*ri+1]+_i)));if($i!==0){do{for(kr=ar-1;Fe.bl_count[kr]===0;)kr--;Fe.bl_count[kr]--,Fe.bl_count[kr+1]+=2,Fe.bl_count[ar]--,$i-=2}while(0<$i);for(kr=ar;kr!==0;kr--)for(ri=Fe.bl_count[kr];ri!==0;)Tt<(yr=Fe.heap[--gi])||(yi[2*yr+1]!==kr&&(Fe.opt_len+=(kr-yi[2*yr+1])*yi[2*yr],yi[2*yr+1]=kr),ri--)}}(me,Ie),wt(vt,wr,me.bl_count)}function K(me,Ie,ft){var gt,je,vt=-1,Bt=Ie[1],Et=0,Ht=7,wr=4;for(Bt===0&&(Ht=138,wr=3),Ie[2*(ft+1)+1]=65535,gt=0;gt<=ft;gt++)je=Bt,Bt=Ie[2*(gt+1)+1],++Et<Ht&&je===Bt||(Et<wr?me.bl_tree[2*je]+=Et:je!==0?(je!==vt&&me.bl_tree[2*je]++,me.bl_tree[2*$]++):Et<=10?me.bl_tree[2*q]++:me.bl_tree[2*J]++,vt=je,wr=(Et=0)===Bt?(Ht=138,3):je===Bt?(Ht=6,3):(Ht=7,4))}function ct(me,Ie,ft){var gt,je,vt=-1,Bt=Ie[1],Et=0,Ht=7,wr=4;for(Bt===0&&(Ht=138,wr=3),gt=0;gt<=ft;gt++)if(je=Bt,Bt=Ie[2*(gt+1)+1],!(++Et<Ht&&je===Bt)){if(Et<wr)for(;ue(me,je,me.bl_tree),--Et!=0;);else je!==0?(je!==vt&&(ue(me,je,me.bl_tree),Et--),ue(me,$,me.bl_tree),re(me,Et-3,2)):Et<=10?(ue(me,q,me.bl_tree),re(me,Et-3,3)):(ue(me,J,me.bl_tree),re(me,Et-11,7));vt=je,wr=(Et=0)===Bt?(Ht=138,3):je===Bt?(Ht=6,3):(Ht=7,4)}}d(nt);var et=!1;function be(me,Ie,ft,gt){re(me,(g<<1)+(gt?1:0),3),function(je,vt,Bt,Et){Ke(je),Et&&(ze(je,Bt),ze(je,~Bt)),h.arraySet(je.pending_buf,je.window,vt,Bt,je.pending),je.pending+=Bt}(me,Ie,ft,!0)}c._tr_init=function(me){et||(function(){var Ie,ft,gt,je,vt,Bt=new Array(A+1);for(je=gt=0;je<b-1;je++)for(Qe[je]=gt,Ie=0;Ie<1<<G[je];Ie++)Y[gt++]=je;for(Y[gt-1]=je,je=vt=0;je<16;je++)for(nt[je]=vt,Ie=0;Ie<1<<oe[je];Ie++)Ne[vt++]=je;for(vt>>=7;je<S;je++)for(nt[je]=vt<<7,Ie=0;Ie<1<<oe[je]-7;Ie++)Ne[256+vt++]=je;for(ft=0;ft<=A;ft++)Bt[ft]=0;for(Ie=0;Ie<=143;)ot[2*Ie+1]=8,Ie++,Bt[8]++;for(;Ie<=255;)ot[2*Ie+1]=9,Ie++,Bt[9]++;for(;Ie<=279;)ot[2*Ie+1]=7,Ie++,Bt[7]++;for(;Ie<=287;)ot[2*Ie+1]=8,Ie++,Bt[8]++;for(wt(ot,x+1,Bt),Ie=0;Ie<S;Ie++)le[2*Ie+1]=5,le[2*Ie]=Xe(Ie,5);pt=new tt(ot,G,k+1,x,A),dt=new tt(le,oe,0,S,A),Zt=new tt(new Array(0),de,0,E,D)}(),et=!0),me.l_desc=new ce(me.dyn_ltree,pt),me.d_desc=new ce(me.dyn_dtree,dt),me.bl_desc=new ce(me.bl_tree,Zt),me.bi_buf=0,me.bi_valid=0,mt(me)},c._tr_stored_block=be,c._tr_flush_block=function(me,Ie,ft,gt){var je,vt,Bt=0;0<me.level?(me.strm.data_type===2&&(me.strm.data_type=function(Et){var Ht,wr=4093624447;for(Ht=0;Ht<=31;Ht++,wr>>>=1)if(1&wr&&Et.dyn_ltree[2*Ht]!==0)return f;if(Et.dyn_ltree[18]!==0||Et.dyn_ltree[20]!==0||Et.dyn_ltree[26]!==0)return i;for(Ht=32;Ht<k;Ht++)if(Et.dyn_ltree[2*Ht]!==0)return i;return f}(me)),Fr(me,me.l_desc),Fr(me,me.d_desc),Bt=function(Et){var Ht;for(K(Et,Et.dyn_ltree,Et.l_desc.max_code),K(Et,Et.dyn_dtree,Et.d_desc.max_code),Fr(Et,Et.bl_desc),Ht=E-1;3<=Ht&&Et.bl_tree[2*Ee[Ht]+1]===0;Ht--);return Et.opt_len+=3*(Ht+1)+5+5+4,Ht}(me),je=me.opt_len+3+7>>>3,(vt=me.static_len+3+7>>>3)<=je&&(je=vt)):je=vt=ft+5,ft+4<=je&&Ie!==-1?be(me,Ie,ft,gt):me.strategy===4||vt===je?(re(me,2+(gt?1:0),3),Lr(me,ot,le)):(re(me,4+(gt?1:0),3),function(Et,Ht,wr,Fe){var _t;for(re(Et,Ht-257,5),re(Et,wr-1,5),re(Et,Fe-4,4),_t=0;_t<Fe;_t++)re(Et,Et.bl_tree[2*Ee[_t]+1],3);ct(Et,Et.dyn_ltree,Ht-1),ct(Et,Et.dyn_dtree,wr-1)}(me,me.l_desc.max_code+1,me.d_desc.max_code+1,Bt+1),Lr(me,me.dyn_ltree,me.dyn_dtree)),mt(me),gt&&Ke(me)},c._tr_tally=function(me,Ie,ft){return me.pending_buf[me.d_buf+2*me.last_lit]=Ie>>>8&255,me.pending_buf[me.d_buf+2*me.last_lit+1]=255&Ie,me.pending_buf[me.l_buf+me.last_lit]=255&ft,me.last_lit++,Ie===0?me.dyn_ltree[2*ft]++:(me.matches++,Ie--,me.dyn_ltree[2*(Y[ft]+k+1)]++,me.dyn_dtree[2*_e(Ie)]++),me.last_lit===me.lit_bufsize-1},c._tr_align=function(me){re(me,2,3),ue(me,F,ot),function(Ie){Ie.bi_valid===16?(ze(Ie,Ie.bi_buf),Ie.bi_buf=0,Ie.bi_valid=0):8<=Ie.bi_valid&&(Ie.pending_buf[Ie.pending++]=255&Ie.bi_buf,Ie.bi_buf>>=8,Ie.bi_valid-=8)}(me)}},{"../utils/common":41}],53:[function(a,o,c){o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(a,o,c){(function(h){(function(f,i){if(!f.setImmediate){var d,g,b,k,x=1,S={},E=!1,T=f.document,A=Object.getPrototypeOf&&Object.getPrototypeOf(f);A=A&&A.setTimeout?A:f,d={}.toString.call(f.process)==="[object process]"?function($){process.nextTick(function(){D($)})}:function(){if(f.postMessage&&!f.importScripts){var $=!0,q=f.onmessage;return f.onmessage=function(){$=!1},f.postMessage("","*"),f.onmessage=q,$}}()?(k="setImmediate$"+Math.random()+"$",f.addEventListener?f.addEventListener("message",F,!1):f.attachEvent("onmessage",F),function($){f.postMessage(k+$,"*")}):f.MessageChannel?((b=new MessageChannel).port1.onmessage=function($){D($.data)},function($){b.port2.postMessage($)}):T&&"onreadystatechange"in T.createElement("script")?(g=T.documentElement,function($){var q=T.createElement("script");q.onreadystatechange=function(){D($),q.onreadystatechange=null,g.removeChild(q),q=null},g.appendChild(q)}):function($){setTimeout(D,0,$)},A.setImmediate=function($){typeof $!="function"&&($=new Function(""+$));for(var q=new Array(arguments.length-1),J=0;J<q.length;J++)q[J]=arguments[J+1];var G={callback:$,args:q};return S[x]=G,d(x),x++},A.clearImmediate=z}function z($){delete S[$]}function D($){if(E)setTimeout(D,0,$);else{var q=S[$];if(q){E=!0;try{(function(J){var G=J.callback,oe=J.args;switch(oe.length){case 0:G();break;case 1:G(oe[0]);break;case 2:G(oe[0],oe[1]);break;case 3:G(oe[0],oe[1],oe[2]);break;default:G.apply(i,oe)}})(q)}finally{z($),E=!1}}}}function F($){$.source===f&&typeof $.data=="string"&&$.data.indexOf(k)===0&&D(+$.data.slice(k.length))}})(typeof self>"u"?h===void 0?this:h:self)}).call(this,typeof $o<"u"?$o:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(C1);var Gk=C1.exports;const Zk=fh(Gk),Hk=[{filename:"mimetype",contents:"application/vnd.oasis.opendocument.spreadsheet"},{filename:"META-INF/manifest.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" manifest:version="1.3">
  <manifest:file-entry manifest:full-path="/" manifest:version="1.3" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
  <manifest:file-entry manifest:full-path="meta.xml" manifest:media-type="text/xml"/>
  <manifest:file-entry manifest:full-path="styles.xml" manifest:media-type="text/xml"/>
  <manifest:file-entry manifest:full-path="content.xml" manifest:media-type="text/xml"/>
</manifest:manifest>
`},{filename:"content.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-content xmlns:presentation="urn:oasis:names:tc:opendocument:xmlns:presentation:1.0" xmlns:css3t="http://www.w3.org/TR/css3-text/" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:rpt="http://openoffice.org/2005/report" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:formx="urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:scripts/>
  <office:font-face-decls>
    <style:font-face style:name="Arial" svg:font-family="Arial" style:font-adornments="Regular" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Liberation Sans" svg:font-family="'Liberation Sans'" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Arial Unicode MS" svg:font-family="'Arial Unicode MS'" style:font-family-generic="system" style:font-pitch="variable"/>
    <style:font-face style:name="PingFang SC" svg:font-family="'PingFang SC'" style:font-family-generic="system" style:font-pitch="variable"/>
  </office:font-face-decls>
  <office:automatic-styles>
    <style:style style:name="co1" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="2.258cm"/>
    </style:style>
{{#sheets}}
  {{#columnStyles}}
    <style:style style:name="{{name}}" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="{{widthCm}}cm"/>
    </style:style>
  {{/columnStyles}}
{{/sheets}}
    <style:style style:name="co3" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="15.723cm"/>
    </style:style>
    <style:style style:name="contents_and_notes_column_2" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="12cm"/>
    </style:style>
    <style:style style:name="ro1" style:family="table-row">
      <style:table-row-properties style:row-height="0.778cm" fo:break-before="auto" style:use-optimal-row-height="true"/>
    </style:style>
    <style:style style:name="ro2" style:family="table-row">
      <style:table-row-properties style:row-height="0.529cm" fo:break-before="auto" style:use-optimal-row-height="true"/>
    </style:style>
    <style:style style:name="ro3" style:family="table-row">
      <style:table-row-properties style:row-height="1.25cm" fo:break-before="auto"/>
    </style:style>
    <style:style style:name="ta1" style:family="table" style:master-page-name="Default">
      <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
    </style:style>
    <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties fo:wrap-option="wrap"/>
      <style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="ce2" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N111"/>
    <style:style style:name="ce5" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties fo:wrap-option="wrap"/>
    </style:style>
    <style:style style:name="ce6" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties fo:wrap-option="wrap"/>
      <style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="cell_extra_padding_bottom" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties fo:padding-bottom="0.7cm"/>
    </style:style>
    <style:style style:name="cell_hyperlink" style:family="table-cell" style:parent-style-name="Hyperlink"/>
    <style:style style:name="cell_number_1dp" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N111"/>
    <style:style style:name="cell_number_with_commas" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="number_with_commas"/>
  </office:automatic-styles>
  <office:body>
    <office:spreadsheet>
      <table:calculation-settings table:automatic-find-labels="false" table:use-regular-expressions="false" table:use-wildcards="true"/>
      <table:table table:name="Cover sheet" table:style-name="ta1">
        <table:table-column table:style-name="co3" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>{{coverSheetTitle}}</text:p>
          </table:table-cell>
        </table:table-row>
{{#coverSheetContents}}
{{#isSubtitle}}
        <table:table-row table:style-name="ro3">
          <table:table-cell table:style-name="Heading_20_2" office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
        </table:table-row>
{{/isSubtitle}}
{{#isText}}
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="ce5" office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
        </table:table-row>
{{/isText}}
{{#isHyperlink}}
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="cell_hyperlink" office:value-type="string" calcext:value-type="string">
            <text:p><text:a xlink:href="{{href}}" xlink:type="simple">{{text}}</text:a></text:p>
          </table:table-cell>
        </table:table-row>
{{/isHyperlink}}
{{/coverSheetContents}}
      </table:table>
      <table:table table:name="Contents" table:style-name="ta1">
        <table:table-column table:style-name="co1" table:default-cell-style-name="Default"/>
        <table:table-column table:style-name="contents_and_notes_column_2" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>Contents</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="cell_extra_padding_bottom" office:value-type="string" calcext:value-type="string">
            <text:p>This worksheet contains one table.</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
            <text:p>Table</text:p>
          </table:table-cell>
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
            <text:p>Name</text:p>
          </table:table-cell>
        </table:table-row>
{{#sheets}}
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="cell_hyperlink" office:value-type="string" calcext:value-type="string">
            <text:p><text:a xlink:href="#'{{sheetNumber}}'.A1" xlink:type="simple">Table {{sheetNumber}}</text:a></text:p>
          </table:table-cell>
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{sheetName}}</text:p>
          </table:table-cell>
        </table:table-row>
{{/sheets}}
      </table:table>
{{#hasNotes}}
      <table:table table:name="Notes" table:style-name="ta1">
        <table:table-column table:style-name="co1" table:default-cell-style-name="Default"/>
        <table:table-column table:style-name="contents_and_notes_column_2" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>Notes</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="cell_extra_padding_bottom" office:value-type="string" calcext:value-type="string">
            <text:p>This worksheet contains one table.</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
            <text:p>Number</text:p>
          </table:table-cell>
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
            <text:p>Note</text:p>
          </table:table-cell>
        </table:table-row>
{{#notes}}
        <table:table-row table:style-name="ro2">
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{name}}</text:p>
          </table:table-cell>
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
        </table:table-row>
{{/notes}}
      </table:table>
{{/hasNotes}}
{{#sheets}}
      <table:table table:name="{{sheetNumber}}" table:style-name="ta1">
  {{#columnStyles}}
        <table:table-column table:style-name="{{name}}" table:default-cell-style-name="Default"/>
  {{/columnStyles}}
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>{{sheetName}}</text:p>
          </table:table-cell>
          <table:table-cell table:number-columns-repeated="2"/>
        </table:table-row>
{{#introText}}
        <table:table-row table:style-name="ro2">
  {{#isLastIntroRow}}
          <table:table-cell table:style-name="cell_extra_padding_bottom" office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
  {{/isLastIntroRow}}
  {{^isLastIntroRow}}
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
  {{/isLastIntroRow}}
          <table:table-cell table:number-columns-repeated="2"/>
      </table:table-row>
{{/introText}}
        <table:table-row table:style-name="ro2">
{{#columns}}
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
{{#heading}}
            <text:p>{{.}}</text:p>
{{/heading}}
          </table:table-cell>
{{/columns}}
        </table:table-row>
{{#rows}}
        <table:table-row table:style-name="ro2">
{{#cellsInRow}}
{{#isText}}
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{displayValue}}</text:p>
          </table:table-cell>
{{/isText}}
{{#isNumeric}}
          <table:table-cell table:style-name="cell_{{style}}" office:value-type="float" office:value="{{rawValue}}" calcext:value-type="float">
            <text:p>{{displayValue}}</text:p>
          </table:table-cell>
{{/isNumeric}}
{{/cellsInRow}}
        </table:table-row>
{{/rows}}
      </table:table>
{{/sheets}}
      <table:named-expressions/>
      <table:database-ranges>
        <table:database-range table:name="table_of_contents" table:target-range-address="'Contents'.{{firstTocCell}}:'Contents'.{{lastTocCell}}" table:on-update-keep-styles="true" table:on-update-keep-size="false"/>
{{#sheets}}
        <table:database-range table:name="{{tableName}}" table:target-range-address="'{{sheetNumber}}'.{{firstTableCell}}:'{{sheetNumber}}'.{{lastTableCell}}" table:on-update-keep-styles="true" table:on-update-keep-size="false"/>
{{/sheets}}
      </table:database-ranges>
    </office:spreadsheet>
  </office:body>
</office:document-content>
`},{filename:"meta.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-meta xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:meta>
    <meta:creation-date>2023-09-21T12:53:29.924750298</meta:creation-date>
    <dc:date>2023-10-11T10:07:17.854771739</dc:date>
    <meta:editing-duration>PT12M36S</meta:editing-duration>
    <meta:editing-cycles>14</meta:editing-cycles>
    <meta:generator>LibreOffice/7.0.6.2$MacOSX_X86_64 LibreOffice_project/144abb84a525d8e30c9dbbefa69cbbf2d8d4ae3b</meta:generator>
    <meta:document-statistic meta:table-count="{{tableCount}}" meta:object-count="0"/>
  </office:meta>
</office:document-meta>
`},{filename:"styles.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-styles xmlns:presentation="urn:oasis:names:tc:opendocument:xmlns:presentation:1.0" xmlns:css3t="http://www.w3.org/TR/css3-text/" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:rpt="http://openoffice.org/2005/report" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:font-face-decls>
    <style:font-face style:name="Arial" svg:font-family="Arial" style:font-adornments="Regular" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Liberation Sans" svg:font-family="'Liberation Sans'" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Arial Unicode MS" svg:font-family="'Arial Unicode MS'" style:font-family-generic="system" style:font-pitch="variable"/>
    <style:font-face style:name="PingFang SC" svg:font-family="'PingFang SC'" style:font-family-generic="system" style:font-pitch="variable"/>
  </office:font-face-decls>
  <office:styles>
    <style:default-style style:family="table-cell">
      <style:paragraph-properties style:tab-stop-distance="1.25cm"/>
      <style:text-properties style:font-name="Liberation Sans" fo:language="en" fo:country="GB" style:font-name-asian="PingFang SC" style:language-asian="zh" style:country-asian="CN" style:font-name-complex="Arial Unicode MS" style:language-complex="hi" style:country-complex="IN"/>
    </style:default-style>
    <number:number-style style:name="N0">
      <number:number number:min-integer-digits="1"/>
    </number:number-style>
    <number:number-style style:name="N111">
      <number:number number:decimal-places="1" number:min-decimal-places="1" number:min-integer-digits="1"/>
    </number:number-style>
    <number:number-style style:name="number_with_commas">
      <number:number number:decimal-places="0" number:min-decimal-places="0" number:min-integer-digits="1" number:grouping="true"/>
    </number:number-style>
    <style:style style:name="Default" style:family="table-cell">
      <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-style-name="Regular" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="12pt"/>
    </style:style>
    <style:style style:name="Heading" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="24pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Heading_20_1" style:display-name="Heading 1" style:family="table-cell" style:parent-style-name="Heading">
      <style:text-properties fo:color="#000000" fo:font-size="18pt" fo:font-style="normal" fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="Heading_20_2" style:display-name="Heading 2" style:family="table-cell" style:parent-style-name="Heading">
      <style:text-properties fo:color="#000000" fo:font-size="14pt" fo:font-style="normal" fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="Text" style:family="table-cell" style:parent-style-name="Default"/>
    <style:style style:name="Note" style:family="table-cell" style:parent-style-name="Text">
      <style:table-cell-properties fo:background-color="#ffffcc" style:diagonal-bl-tr="none" style:diagonal-tl-br="none" fo:border="0.74pt solid #808080"/>
      <style:text-properties fo:color="#333333" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Footnote" style:family="table-cell" style:parent-style-name="Text">
      <style:text-properties fo:color="#808080" fo:font-size="10pt" fo:font-style="italic" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Hyperlink" style:family="table-cell" style:parent-style-name="Text">
      <style:text-properties fo:color="#0000ee" fo:font-size="12pt" fo:font-style="normal" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="#0000ee" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Status" style:family="table-cell" style:parent-style-name="Default"/>
    <style:style style:name="Good" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ccffcc"/>
      <style:text-properties fo:color="#006600" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Neutral" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ffffcc"/>
      <style:text-properties fo:color="#996600" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Bad" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ffcccc"/>
      <style:text-properties fo:color="#cc0000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Warning" style:family="table-cell" style:parent-style-name="Status">
      <style:text-properties fo:color="#cc0000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Error" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#cc0000"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Accent" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Accent_20_1" style:display-name="Accent 1" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#000000"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Accent_20_2" style:display-name="Accent 2" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#808080"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Accent_20_3" style:display-name="Accent 3" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#dddddd"/>
    </style:style>
    <style:style style:name="Result" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="10pt" fo:font-style="italic" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="#000000" fo:font-weight="bold"/>
    </style:style>
  </office:styles>
  <office:automatic-styles>
    <style:page-layout style:name="Mpm1">
      <style:page-layout-properties style:writing-mode="lr-tb"/>
      <style:header-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-bottom="0.25cm"/>
      </style:header-style>
      <style:footer-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-top="0.25cm"/>
      </style:footer-style>
    </style:page-layout>
    <style:page-layout style:name="Mpm2">
      <style:page-layout-properties style:writing-mode="lr-tb"/>
      <style:header-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-bottom="0.25cm" fo:border="2.49pt solid #000000" fo:padding="0.018cm" fo:background-color="#c0c0c0">
          <style:background-image/>
        </style:header-footer-properties>
      </style:header-style>
      <style:footer-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-top="0.25cm" fo:border="2.49pt solid #000000" fo:padding="0.018cm" fo:background-color="#c0c0c0">
          <style:background-image/>
        </style:header-footer-properties>
      </style:footer-style>
    </style:page-layout>
  </office:automatic-styles>
  <office:master-styles>
    <style:master-page style:name="Default" style:page-layout-name="Mpm1">
      <style:header>
        <text:p>
          <text:sheet-name>???</text:sheet-name>
        </text:p>
      </style:header>
      <style:header-left style:display="false"/>
      <style:footer>
        <text:p>Page <text:page-number>1</text:page-number></text:p>
      </style:footer>
      <style:footer-left style:display="false"/>
    </style:master-page>
    <style:master-page style:name="Report" style:page-layout-name="Mpm2">
      <style:header>
        <style:region-left>
          <text:p><text:sheet-name>???</text:sheet-name><text:s/>(<text:title>???</text:title>)</text:p>
        </style:region-left>
        <style:region-right>
          <text:p><text:date style:data-style-name="N2" text:date-value="2023-10-11">00/00/0000</text:date>, <text:time style:data-style-name="N2" text:time-value="10:06:35.023372525">00:00:00</text:time></text:p>
        </style:region-right>
      </style:header>
      <style:header-left style:display="false"/>
      <style:footer>
        <text:p>Page <text:page-number>1</text:page-number><text:s/>/ <text:page-count>99</text:page-count></text:p>
      </style:footer>
      <style:footer-left style:display="false"/>
    </style:master-page>
  </office:master-styles>
</office:document-styles>
`}];function Wk(s){let e=0;for(const a of s)e+=a in Bf?Bf[a]:Bf.AVERAGE;return e}const Bf={0:8.9,1:8.9,2:8.9,3:8.9,4:8.9,5:8.9,6:8.9,7:8.9,8:8.9,9:8.9,a:8.9,b:8.9,c:8,d:8.9,e:8.9,f:4.43,g:8.9,h:8.9,i:3.57,j:3.57,k:8,l:3.57,m:13.33,n:8.9,o:8.9,p:8.9,q:8.9,r:5.33,s:8,t:4.43,u:8.9,v:8,w:11.57,x:8,y:8,z:8,A:10.67,B:10.67,C:11.57,D:11.57,E:10.67,F:9.77,G:12.43,H:11.57,I:4.43,J:8,K:10.67,L:8.9,M:13.33,N:11.57,O:12.43,P:10.67,Q:12.43,R:11.57,S:10.67,T:9.77,U:11.57,V:10.67,W:15.1,X:10.67,Y:10.67,Z:9.77," ":4.43,"!":4.43,'"':5.67,"#":8.9,$:8.9,"%":14.23,"&":10.67,"'":3.07,"(":5.33,")":5.33,"*":6.23,"+":9.33,",":4.43,"-":5.33,".":4.43,"/":4.43,":":4.43,";":4.43,"<":9.33,"=":9.33,">":9.33,"?":8.9,"@":16.23,"[":4.43,"]":4.43,"^":7.5,_:8.9,"`":5.33,"{":5.33,"|":4.17,"}":5.33,"~":9.33,AVERAGE:8.472},Kk={$id:"https://github.com/jtrim-ons/accessible-spreadsheet-creator",title:"Accessible Spreadsheet Creator",description:"A description of an accessible spreadsheet",type:"object",properties:{coverSheetTitle:{type:"string",title:"Cover sheet title",description:"The title displayed in cell A1 of the workbook.",minLength:1},coverSheetContents:{type:"array",title:"Cover sheet contents",description:"The lines below the cover sheet title. Each can be a subtitle starting with '## ', a link in Markdown style, or just text.",items:{type:"string"}},notes:{type:"array",title:"Notes",description:"The notes, each with a name that can be referred to in double square brackets and text.",items:{type:"object",title:"Note",properties:{name:{type:"string",title:"Note name",description:"A note name (e.g. note1) that can be referred to in a sheet using double square brackets (e.g. [[note1]])."},text:{type:"string",title:"Note text",description:"The text that will appear on the Notes page."}}}},sheets:{type:"array",title:"Sheets",description:"The data an metadata for the worksheets other than cover, contents and notes sheets.",items:{type:"object",title:"Sheet",properties:{sheetName:{type:"string",minLength:1,title:"Sheet name",description:"The name to appear in cell A1"},tableName:{type:"string",minLength:1,title:"Table name",description:"The name to give to the data table",pattern:"^[A-Za-z0-9_]*$"},sheetIntroText:{type:"array",title:"Sheet intro text",description:"Introductory text to appear below cell A2",items:{type:"string"}},columns:{type:"array",title:"Data columns",items:{type:"object",title:"Data column",description:"A column with its heading, number/text style and data.",properties:{style:{type:"string",title:"Number/text style",description:"'text'=text column; 'number_with_commas': integers with thousand separator; 'number_1dp': numbers to 1 decimal place"},heading:{type:"string",title:"Column heading",description:"Table column heading. May contain notes in double square brackets."},values:{type:"array",title:"Column values",description:"An array of text or numeric values",anyOf:[{items:{type:"number"}},{items:{type:"string"}}]}},required:["style","heading","values"]}}},required:["sheetName","tableName","columns"]}}},required:["coverSheetTitle","coverSheetContents","sheets"]};var vd={exports:{}},I1={},as={},Ho={},xc={},zr={},hc={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.regexpCode=s.getEsmExportName=s.getProperty=s.safeStringify=s.stringify=s.strConcat=s.addCodeArg=s.str=s._=s.nil=s._Code=s.Name=s.IDENTIFIER=s._CodeOrName=void 0;class e{}s._CodeOrName=e,s.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class a extends e{constructor(D){if(super(),!s.IDENTIFIER.test(D))throw new Error("CodeGen: name must be a valid identifier");this.str=D}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}s.Name=a;class o extends e{constructor(D){super(),this._items=typeof D=="string"?[D]:D}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const D=this._items[0];return D===""||D==='""'}get str(){var D;return(D=this._str)!==null&&D!==void 0?D:this._str=this._items.reduce((F,$)=>`${F}${$}`,"")}get names(){var D;return(D=this._names)!==null&&D!==void 0?D:this._names=this._items.reduce((F,$)=>($ instanceof a&&(F[$.str]=(F[$.str]||0)+1),F),{})}}s._Code=o,s.nil=new o("");function c(z,...D){const F=[z[0]];let $=0;for(;$<D.length;)i(F,D[$]),F.push(z[++$]);return new o(F)}s._=c;const h=new o("+");function f(z,...D){const F=[S(z[0])];let $=0;for(;$<D.length;)F.push(h),i(F,D[$]),F.push(h,S(z[++$]));return d(F),new o(F)}s.str=f;function i(z,D){D instanceof o?z.push(...D._items):D instanceof a?z.push(D):z.push(k(D))}s.addCodeArg=i;function d(z){let D=1;for(;D<z.length-1;){if(z[D]===h){const F=g(z[D-1],z[D+1]);if(F!==void 0){z.splice(D-1,3,F);continue}z[D++]="+"}D++}}function g(z,D){if(D==='""')return z;if(z==='""')return D;if(typeof z=="string")return D instanceof a||z[z.length-1]!=='"'?void 0:typeof D!="string"?`${z.slice(0,-1)}${D}"`:D[0]==='"'?z.slice(0,-1)+D.slice(1):void 0;if(typeof D=="string"&&D[0]==='"'&&!(z instanceof a))return`"${z}${D.slice(1)}`}function b(z,D){return D.emptyStr()?z:z.emptyStr()?D:f`${z}${D}`}s.strConcat=b;function k(z){return typeof z=="number"||typeof z=="boolean"||z===null?z:S(Array.isArray(z)?z.join(","):z)}function x(z){return new o(S(z))}s.stringify=x;function S(z){return JSON.stringify(z).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}s.safeStringify=S;function E(z){return typeof z=="string"&&s.IDENTIFIER.test(z)?new o(`.${z}`):c`[${z}]`}s.getProperty=E;function T(z){if(typeof z=="string"&&s.IDENTIFIER.test(z))return new o(`${z}`);throw new Error(`CodeGen: invalid export name: ${z}, use explicit $id name mapping`)}s.getEsmExportName=T;function A(z){return new o(z.toString())}s.regexpCode=A})(hc);var bd={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.ValueScope=s.ValueScopeName=s.Scope=s.varKinds=s.UsedValueState=void 0;const e=hc;class a extends Error{constructor(g){super(`CodeGen: "code" for ${g} not defined`),this.value=g.value}}var o;(function(d){d[d.Started=0]="Started",d[d.Completed=1]="Completed"})(o=s.UsedValueState||(s.UsedValueState={})),s.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class c{constructor({prefixes:g,parent:b}={}){this._names={},this._prefixes=g,this._parent=b}toName(g){return g instanceof e.Name?g:this.name(g)}name(g){return new e.Name(this._newName(g))}_newName(g){const b=this._names[g]||this._nameGroup(g);return`${g}${b.index++}`}_nameGroup(g){var b,k;if(!((k=(b=this._parent)===null||b===void 0?void 0:b._prefixes)===null||k===void 0)&&k.has(g)||this._prefixes&&!this._prefixes.has(g))throw new Error(`CodeGen: prefix "${g}" is not allowed in this scope`);return this._names[g]={prefix:g,index:0}}}s.Scope=c;class h extends e.Name{constructor(g,b){super(b),this.prefix=g}setValue(g,{property:b,itemIndex:k}){this.value=g,this.scopePath=(0,e._)`.${new e.Name(b)}[${k}]`}}s.ValueScopeName=h;const f=(0,e._)`\n`;class i extends c{constructor(g){super(g),this._values={},this._scope=g.scope,this.opts={...g,_n:g.lines?f:e.nil}}get(){return this._scope}name(g){return new h(g,this._newName(g))}value(g,b){var k;if(b.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const x=this.toName(g),{prefix:S}=x,E=(k=b.key)!==null&&k!==void 0?k:b.ref;let T=this._values[S];if(T){const D=T.get(E);if(D)return D}else T=this._values[S]=new Map;T.set(E,x);const A=this._scope[S]||(this._scope[S]=[]),z=A.length;return A[z]=b.ref,x.setValue(b,{property:S,itemIndex:z}),x}getValue(g,b){const k=this._values[g];if(k)return k.get(b)}scopeRefs(g,b=this._values){return this._reduceValues(b,k=>{if(k.scopePath===void 0)throw new Error(`CodeGen: name "${k}" has no value`);return(0,e._)`${g}${k.scopePath}`})}scopeCode(g=this._values,b,k){return this._reduceValues(g,x=>{if(x.value===void 0)throw new Error(`CodeGen: name "${x}" has no value`);return x.value.code},b,k)}_reduceValues(g,b,k={},x){let S=e.nil;for(const E in g){const T=g[E];if(!T)continue;const A=k[E]=k[E]||new Map;T.forEach(z=>{if(A.has(z))return;A.set(z,o.Started);let D=b(z);if(D){const F=this.opts.es5?s.varKinds.var:s.varKinds.const;S=(0,e._)`${S}${F} ${z} = ${D};${this.opts._n}`}else if(D=x==null?void 0:x(z))S=(0,e._)`${S}${D}${this.opts._n}`;else throw new a(z);A.set(z,o.Completed)})}return S}}s.ValueScope=i})(bd);(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.or=s.and=s.not=s.CodeGen=s.operators=s.varKinds=s.ValueScopeName=s.ValueScope=s.Scope=s.Name=s.regexpCode=s.stringify=s.getProperty=s.nil=s.strConcat=s.str=s._=void 0;const e=hc,a=bd;var o=hc;Object.defineProperty(s,"_",{enumerable:!0,get:function(){return o._}}),Object.defineProperty(s,"str",{enumerable:!0,get:function(){return o.str}}),Object.defineProperty(s,"strConcat",{enumerable:!0,get:function(){return o.strConcat}}),Object.defineProperty(s,"nil",{enumerable:!0,get:function(){return o.nil}}),Object.defineProperty(s,"getProperty",{enumerable:!0,get:function(){return o.getProperty}}),Object.defineProperty(s,"stringify",{enumerable:!0,get:function(){return o.stringify}}),Object.defineProperty(s,"regexpCode",{enumerable:!0,get:function(){return o.regexpCode}}),Object.defineProperty(s,"Name",{enumerable:!0,get:function(){return o.Name}});var c=bd;Object.defineProperty(s,"Scope",{enumerable:!0,get:function(){return c.Scope}}),Object.defineProperty(s,"ValueScope",{enumerable:!0,get:function(){return c.ValueScope}}),Object.defineProperty(s,"ValueScopeName",{enumerable:!0,get:function(){return c.ValueScopeName}}),Object.defineProperty(s,"varKinds",{enumerable:!0,get:function(){return c.varKinds}}),s.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class h{optimizeNodes(){return this}optimizeNames(re,ue){return this}}class f extends h{constructor(re,ue,Xe){super(),this.varKind=re,this.name=ue,this.rhs=Xe}render({es5:re,_n:ue}){const Xe=re?a.varKinds.var:this.varKind,wt=this.rhs===void 0?"":` = ${this.rhs}`;return`${Xe} ${this.name}${wt};`+ue}optimizeNames(re,ue){if(re[this.name.str])return this.rhs&&(this.rhs=Y(this.rhs,re,ue)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class i extends h{constructor(re,ue,Xe){super(),this.lhs=re,this.rhs=ue,this.sideEffects=Xe}render({_n:re}){return`${this.lhs} = ${this.rhs};`+re}optimizeNames(re,ue){if(!(this.lhs instanceof e.Name&&!re[this.lhs.str]&&!this.sideEffects))return this.rhs=Y(this.rhs,re,ue),this}get names(){const re=this.lhs instanceof e.Name?{}:{...this.lhs.names};return Ne(re,this.rhs)}}class d extends i{constructor(re,ue,Xe,wt){super(re,Xe,wt),this.op=ue}render({_n:re}){return`${this.lhs} ${this.op}= ${this.rhs};`+re}}class g extends h{constructor(re){super(),this.label=re,this.names={}}render({_n:re}){return`${this.label}:`+re}}class b extends h{constructor(re){super(),this.label=re,this.names={}}render({_n:re}){return`break${this.label?` ${this.label}`:""};`+re}}class k extends h{constructor(re){super(),this.error=re}render({_n:re}){return`throw ${this.error};`+re}get names(){return this.error.names}}class x extends h{constructor(re){super(),this.code=re}render({_n:re}){return`${this.code};`+re}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(re,ue){return this.code=Y(this.code,re,ue),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class S extends h{constructor(re=[]){super(),this.nodes=re}render(re){return this.nodes.reduce((ue,Xe)=>ue+Xe.render(re),"")}optimizeNodes(){const{nodes:re}=this;let ue=re.length;for(;ue--;){const Xe=re[ue].optimizeNodes();Array.isArray(Xe)?re.splice(ue,1,...Xe):Xe?re[ue]=Xe:re.splice(ue,1)}return re.length>0?this:void 0}optimizeNames(re,ue){const{nodes:Xe}=this;let wt=Xe.length;for(;wt--;){const mt=Xe[wt];mt.optimizeNames(re,ue)||(Qe(re,mt.names),Xe.splice(wt,1))}return Xe.length>0?this:void 0}get names(){return this.nodes.reduce((re,ue)=>le(re,ue.names),{})}}class E extends S{render(re){return"{"+re._n+super.render(re)+"}"+re._n}}class T extends S{}class A extends E{}A.kind="else";class z extends E{constructor(re,ue){super(ue),this.condition=re}render(re){let ue=`if(${this.condition})`+super.render(re);return this.else&&(ue+="else "+this.else.render(re)),ue}optimizeNodes(){super.optimizeNodes();const re=this.condition;if(re===!0)return this.nodes;let ue=this.else;if(ue){const Xe=ue.optimizeNodes();ue=this.else=Array.isArray(Xe)?new A(Xe):Xe}if(ue)return re===!1?ue instanceof z?ue:ue.nodes:this.nodes.length?this:new z(pt(re),ue instanceof z?[ue]:ue.nodes);if(!(re===!1||!this.nodes.length))return this}optimizeNames(re,ue){var Xe;if(this.else=(Xe=this.else)===null||Xe===void 0?void 0:Xe.optimizeNames(re,ue),!!(super.optimizeNames(re,ue)||this.else))return this.condition=Y(this.condition,re,ue),this}get names(){const re=super.names;return Ne(re,this.condition),this.else&&le(re,this.else.names),re}}z.kind="if";class D extends E{}D.kind="for";class F extends D{constructor(re){super(),this.iteration=re}render(re){return`for(${this.iteration})`+super.render(re)}optimizeNames(re,ue){if(super.optimizeNames(re,ue))return this.iteration=Y(this.iteration,re,ue),this}get names(){return le(super.names,this.iteration.names)}}class $ extends D{constructor(re,ue,Xe,wt){super(),this.varKind=re,this.name=ue,this.from=Xe,this.to=wt}render(re){const ue=re.es5?a.varKinds.var:this.varKind,{name:Xe,from:wt,to:mt}=this;return`for(${ue} ${Xe}=${wt}; ${Xe}<${mt}; ${Xe}++)`+super.render(re)}get names(){const re=Ne(super.names,this.from);return Ne(re,this.to)}}class q extends D{constructor(re,ue,Xe,wt){super(),this.loop=re,this.varKind=ue,this.name=Xe,this.iterable=wt}render(re){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(re)}optimizeNames(re,ue){if(super.optimizeNames(re,ue))return this.iterable=Y(this.iterable,re,ue),this}get names(){return le(super.names,this.iterable.names)}}class J extends E{constructor(re,ue,Xe){super(),this.name=re,this.args=ue,this.async=Xe}render(re){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(re)}}J.kind="func";class G extends S{render(re){return"return "+super.render(re)}}G.kind="return";class oe extends E{render(re){let ue="try"+super.render(re);return this.catch&&(ue+=this.catch.render(re)),this.finally&&(ue+=this.finally.render(re)),ue}optimizeNodes(){var re,ue;return super.optimizeNodes(),(re=this.catch)===null||re===void 0||re.optimizeNodes(),(ue=this.finally)===null||ue===void 0||ue.optimizeNodes(),this}optimizeNames(re,ue){var Xe,wt;return super.optimizeNames(re,ue),(Xe=this.catch)===null||Xe===void 0||Xe.optimizeNames(re,ue),(wt=this.finally)===null||wt===void 0||wt.optimizeNames(re,ue),this}get names(){const re=super.names;return this.catch&&le(re,this.catch.names),this.finally&&le(re,this.finally.names),re}}class de extends E{constructor(re){super(),this.error=re}render(re){return`catch(${this.error})`+super.render(re)}}de.kind="catch";class Ee extends E{render(re){return"finally"+super.render(re)}}Ee.kind="finally";class ot{constructor(re,ue={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...ue,_n:ue.lines?`
`:""},this._extScope=re,this._scope=new a.Scope({parent:re}),this._nodes=[new T]}toString(){return this._root.render(this.opts)}name(re){return this._scope.name(re)}scopeName(re){return this._extScope.name(re)}scopeValue(re,ue){const Xe=this._extScope.value(re,ue);return(this._values[Xe.prefix]||(this._values[Xe.prefix]=new Set)).add(Xe),Xe}getScopeValue(re,ue){return this._extScope.getValue(re,ue)}scopeRefs(re){return this._extScope.scopeRefs(re,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(re,ue,Xe,wt){const mt=this._scope.toName(ue);return Xe!==void 0&&wt&&(this._constants[mt.str]=Xe),this._leafNode(new f(re,mt,Xe)),mt}const(re,ue,Xe){return this._def(a.varKinds.const,re,ue,Xe)}let(re,ue,Xe){return this._def(a.varKinds.let,re,ue,Xe)}var(re,ue,Xe){return this._def(a.varKinds.var,re,ue,Xe)}assign(re,ue,Xe){return this._leafNode(new i(re,ue,Xe))}add(re,ue){return this._leafNode(new d(re,s.operators.ADD,ue))}code(re){return typeof re=="function"?re():re!==e.nil&&this._leafNode(new x(re)),this}object(...re){const ue=["{"];for(const[Xe,wt]of re)ue.length>1&&ue.push(","),ue.push(Xe),(Xe!==wt||this.opts.es5)&&(ue.push(":"),(0,e.addCodeArg)(ue,wt));return ue.push("}"),new e._Code(ue)}if(re,ue,Xe){if(this._blockNode(new z(re)),ue&&Xe)this.code(ue).else().code(Xe).endIf();else if(ue)this.code(ue).endIf();else if(Xe)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(re){return this._elseNode(new z(re))}else(){return this._elseNode(new A)}endIf(){return this._endBlockNode(z,A)}_for(re,ue){return this._blockNode(re),ue&&this.code(ue).endFor(),this}for(re,ue){return this._for(new F(re),ue)}forRange(re,ue,Xe,wt,mt=this.opts.es5?a.varKinds.var:a.varKinds.let){const Ke=this._scope.toName(re);return this._for(new $(mt,Ke,ue,Xe),()=>wt(Ke))}forOf(re,ue,Xe,wt=a.varKinds.const){const mt=this._scope.toName(re);if(this.opts.es5){const Ke=ue instanceof e.Name?ue:this.var("_arr",ue);return this.forRange("_i",0,(0,e._)`${Ke}.length`,Ot=>{this.var(mt,(0,e._)`${Ke}[${Ot}]`),Xe(mt)})}return this._for(new q("of",wt,mt,ue),()=>Xe(mt))}forIn(re,ue,Xe,wt=this.opts.es5?a.varKinds.var:a.varKinds.const){if(this.opts.ownProperties)return this.forOf(re,(0,e._)`Object.keys(${ue})`,Xe);const mt=this._scope.toName(re);return this._for(new q("in",wt,mt,ue),()=>Xe(mt))}endFor(){return this._endBlockNode(D)}label(re){return this._leafNode(new g(re))}break(re){return this._leafNode(new b(re))}return(re){const ue=new G;if(this._blockNode(ue),this.code(re),ue.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(G)}try(re,ue,Xe){if(!ue&&!Xe)throw new Error('CodeGen: "try" without "catch" and "finally"');const wt=new oe;if(this._blockNode(wt),this.code(re),ue){const mt=this.name("e");this._currNode=wt.catch=new de(mt),ue(mt)}return Xe&&(this._currNode=wt.finally=new Ee,this.code(Xe)),this._endBlockNode(de,Ee)}throw(re){return this._leafNode(new k(re))}block(re,ue){return this._blockStarts.push(this._nodes.length),re&&this.code(re).endBlock(ue),this}endBlock(re){const ue=this._blockStarts.pop();if(ue===void 0)throw new Error("CodeGen: not in self-balancing block");const Xe=this._nodes.length-ue;if(Xe<0||re!==void 0&&Xe!==re)throw new Error(`CodeGen: wrong number of nodes: ${Xe} vs ${re} expected`);return this._nodes.length=ue,this}func(re,ue=e.nil,Xe,wt){return this._blockNode(new J(re,ue,Xe)),wt&&this.code(wt).endFunc(),this}endFunc(){return this._endBlockNode(J)}optimize(re=1){for(;re-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(re){return this._currNode.nodes.push(re),this}_blockNode(re){this._currNode.nodes.push(re),this._nodes.push(re)}_endBlockNode(re,ue){const Xe=this._currNode;if(Xe instanceof re||ue&&Xe instanceof ue)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${ue?`${re.kind}/${ue.kind}`:re.kind}"`)}_elseNode(re){const ue=this._currNode;if(!(ue instanceof z))throw new Error('CodeGen: "else" without "if"');return this._currNode=ue.else=re,this}get _root(){return this._nodes[0]}get _currNode(){const re=this._nodes;return re[re.length-1]}set _currNode(re){const ue=this._nodes;ue[ue.length-1]=re}}s.CodeGen=ot;function le(ze,re){for(const ue in re)ze[ue]=(ze[ue]||0)+(re[ue]||0);return ze}function Ne(ze,re){return re instanceof e._CodeOrName?le(ze,re.names):ze}function Y(ze,re,ue){if(ze instanceof e.Name)return Xe(ze);if(!wt(ze))return ze;return new e._Code(ze._items.reduce((mt,Ke)=>(Ke instanceof e.Name&&(Ke=Xe(Ke)),Ke instanceof e._Code?mt.push(...Ke._items):mt.push(Ke),mt),[]));function Xe(mt){const Ke=ue[mt.str];return Ke===void 0||re[mt.str]!==1?mt:(delete re[mt.str],Ke)}function wt(mt){return mt instanceof e._Code&&mt._items.some(Ke=>Ke instanceof e.Name&&re[Ke.str]===1&&ue[Ke.str]!==void 0)}}function Qe(ze,re){for(const ue in re)ze[ue]=(ze[ue]||0)-(re[ue]||0)}function pt(ze){return typeof ze=="boolean"||typeof ze=="number"||ze===null?!ze:(0,e._)`!${_e(ze)}`}s.not=pt;const dt=ce(s.operators.AND);function Zt(...ze){return ze.reduce(dt)}s.and=Zt;const nt=ce(s.operators.OR);function tt(...ze){return ze.reduce(nt)}s.or=tt;function ce(ze){return(re,ue)=>re===e.nil?ue:ue===e.nil?re:(0,e._)`${_e(re)} ${ze} ${_e(ue)}`}function _e(ze){return ze instanceof e.Name?ze:(0,e._)`(${ze})`}})(zr);var Zr={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.checkStrictMode=s.getErrorPath=s.Type=s.useFunc=s.setEvaluated=s.evaluatedPropsToName=s.mergeEvaluated=s.eachItem=s.unescapeJsonPointer=s.escapeJsonPointer=s.escapeFragment=s.unescapeFragment=s.schemaRefOrVal=s.schemaHasRulesButRef=s.schemaHasRules=s.checkUnknownRules=s.alwaysValidSchema=s.toHash=void 0;const e=zr,a=hc;function o(J){const G={};for(const oe of J)G[oe]=!0;return G}s.toHash=o;function c(J,G){return typeof G=="boolean"?G:Object.keys(G).length===0?!0:(h(J,G),!f(G,J.self.RULES.all))}s.alwaysValidSchema=c;function h(J,G=J.schema){const{opts:oe,self:de}=J;if(!oe.strictSchema||typeof G=="boolean")return;const Ee=de.RULES.keywords;for(const ot in G)Ee[ot]||q(J,`unknown keyword: "${ot}"`)}s.checkUnknownRules=h;function f(J,G){if(typeof J=="boolean")return!J;for(const oe in J)if(G[oe])return!0;return!1}s.schemaHasRules=f;function i(J,G){if(typeof J=="boolean")return!J;for(const oe in J)if(oe!=="$ref"&&G.all[oe])return!0;return!1}s.schemaHasRulesButRef=i;function d({topSchemaRef:J,schemaPath:G},oe,de,Ee){if(!Ee){if(typeof oe=="number"||typeof oe=="boolean")return oe;if(typeof oe=="string")return(0,e._)`${oe}`}return(0,e._)`${J}${G}${(0,e.getProperty)(de)}`}s.schemaRefOrVal=d;function g(J){return x(decodeURIComponent(J))}s.unescapeFragment=g;function b(J){return encodeURIComponent(k(J))}s.escapeFragment=b;function k(J){return typeof J=="number"?`${J}`:J.replace(/~/g,"~0").replace(/\//g,"~1")}s.escapeJsonPointer=k;function x(J){return J.replace(/~1/g,"/").replace(/~0/g,"~")}s.unescapeJsonPointer=x;function S(J,G){if(Array.isArray(J))for(const oe of J)G(oe);else G(J)}s.eachItem=S;function E({mergeNames:J,mergeToName:G,mergeValues:oe,resultToName:de}){return(Ee,ot,le,Ne)=>{const Y=le===void 0?ot:le instanceof e.Name?(ot instanceof e.Name?J(Ee,ot,le):G(Ee,ot,le),le):ot instanceof e.Name?(G(Ee,le,ot),ot):oe(ot,le);return Ne===e.Name&&!(Y instanceof e.Name)?de(Ee,Y):Y}}s.mergeEvaluated={props:E({mergeNames:(J,G,oe)=>J.if((0,e._)`${oe} !== true && ${G} !== undefined`,()=>{J.if((0,e._)`${G} === true`,()=>J.assign(oe,!0),()=>J.assign(oe,(0,e._)`${oe} || {}`).code((0,e._)`Object.assign(${oe}, ${G})`))}),mergeToName:(J,G,oe)=>J.if((0,e._)`${oe} !== true`,()=>{G===!0?J.assign(oe,!0):(J.assign(oe,(0,e._)`${oe} || {}`),A(J,oe,G))}),mergeValues:(J,G)=>J===!0?!0:{...J,...G},resultToName:T}),items:E({mergeNames:(J,G,oe)=>J.if((0,e._)`${oe} !== true && ${G} !== undefined`,()=>J.assign(oe,(0,e._)`${G} === true ? true : ${oe} > ${G} ? ${oe} : ${G}`)),mergeToName:(J,G,oe)=>J.if((0,e._)`${oe} !== true`,()=>J.assign(oe,G===!0?!0:(0,e._)`${oe} > ${G} ? ${oe} : ${G}`)),mergeValues:(J,G)=>J===!0?!0:Math.max(J,G),resultToName:(J,G)=>J.var("items",G)})};function T(J,G){if(G===!0)return J.var("props",!0);const oe=J.var("props",(0,e._)`{}`);return G!==void 0&&A(J,oe,G),oe}s.evaluatedPropsToName=T;function A(J,G,oe){Object.keys(oe).forEach(de=>J.assign((0,e._)`${G}${(0,e.getProperty)(de)}`,!0))}s.setEvaluated=A;const z={};function D(J,G){return J.scopeValue("func",{ref:G,code:z[G.code]||(z[G.code]=new a._Code(G.code))})}s.useFunc=D;var F;(function(J){J[J.Num=0]="Num",J[J.Str=1]="Str"})(F=s.Type||(s.Type={}));function $(J,G,oe){if(J instanceof e.Name){const de=G===F.Num;return oe?de?(0,e._)`"[" + ${J} + "]"`:(0,e._)`"['" + ${J} + "']"`:de?(0,e._)`"/" + ${J}`:(0,e._)`"/" + ${J}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return oe?(0,e.getProperty)(J).toString():"/"+k(J)}s.getErrorPath=$;function q(J,G,oe=J.opts.strictSchema){if(oe){if(G=`strict mode: ${G}`,oe===!0)throw new Error(G);J.self.logger.warn(G)}}s.checkStrictMode=q})(Zr);var ks={};Object.defineProperty(ks,"__esModule",{value:!0});const nn=zr,Xk={data:new nn.Name("data"),valCxt:new nn.Name("valCxt"),instancePath:new nn.Name("instancePath"),parentData:new nn.Name("parentData"),parentDataProperty:new nn.Name("parentDataProperty"),rootData:new nn.Name("rootData"),dynamicAnchors:new nn.Name("dynamicAnchors"),vErrors:new nn.Name("vErrors"),errors:new nn.Name("errors"),this:new nn.Name("this"),self:new nn.Name("self"),scope:new nn.Name("scope"),json:new nn.Name("json"),jsonPos:new nn.Name("jsonPos"),jsonLen:new nn.Name("jsonLen"),jsonPart:new nn.Name("jsonPart")};ks.default=Xk;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.extendErrors=s.resetErrorsCount=s.reportExtraError=s.reportError=s.keyword$DataError=s.keywordError=void 0;const e=zr,a=Zr,o=ks;s.keywordError={message:({keyword:A})=>(0,e.str)`must pass "${A}" keyword validation`},s.keyword$DataError={message:({keyword:A,schemaType:z})=>z?(0,e.str)`"${A}" keyword must be ${z} ($data)`:(0,e.str)`"${A}" keyword is invalid ($data)`};function c(A,z=s.keywordError,D,F){const{it:$}=A,{gen:q,compositeRule:J,allErrors:G}=$,oe=k(A,z,D);F??(J||G)?d(q,oe):g($,(0,e._)`[${oe}]`)}s.reportError=c;function h(A,z=s.keywordError,D){const{it:F}=A,{gen:$,compositeRule:q,allErrors:J}=F,G=k(A,z,D);d($,G),q||J||g(F,o.default.vErrors)}s.reportExtraError=h;function f(A,z){A.assign(o.default.errors,z),A.if((0,e._)`${o.default.vErrors} !== null`,()=>A.if(z,()=>A.assign((0,e._)`${o.default.vErrors}.length`,z),()=>A.assign(o.default.vErrors,null)))}s.resetErrorsCount=f;function i({gen:A,keyword:z,schemaValue:D,data:F,errsCount:$,it:q}){if($===void 0)throw new Error("ajv implementation error");const J=A.name("err");A.forRange("i",$,o.default.errors,G=>{A.const(J,(0,e._)`${o.default.vErrors}[${G}]`),A.if((0,e._)`${J}.instancePath === undefined`,()=>A.assign((0,e._)`${J}.instancePath`,(0,e.strConcat)(o.default.instancePath,q.errorPath))),A.assign((0,e._)`${J}.schemaPath`,(0,e.str)`${q.errSchemaPath}/${z}`),q.opts.verbose&&(A.assign((0,e._)`${J}.schema`,D),A.assign((0,e._)`${J}.data`,F))})}s.extendErrors=i;function d(A,z){const D=A.const("err",z);A.if((0,e._)`${o.default.vErrors} === null`,()=>A.assign(o.default.vErrors,(0,e._)`[${D}]`),(0,e._)`${o.default.vErrors}.push(${D})`),A.code((0,e._)`${o.default.errors}++`)}function g(A,z){const{gen:D,validateName:F,schemaEnv:$}=A;$.$async?D.throw((0,e._)`new ${A.ValidationError}(${z})`):(D.assign((0,e._)`${F}.errors`,z),D.return(!1))}const b={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function k(A,z,D){const{createErrors:F}=A.it;return F===!1?(0,e._)`{}`:x(A,z,D)}function x(A,z,D={}){const{gen:F,it:$}=A,q=[S($,D),E(A,D)];return T(A,z,q),F.object(...q)}function S({errorPath:A},{instancePath:z}){const D=z?(0,e.str)`${A}${(0,a.getErrorPath)(z,a.Type.Str)}`:A;return[o.default.instancePath,(0,e.strConcat)(o.default.instancePath,D)]}function E({keyword:A,it:{errSchemaPath:z}},{schemaPath:D,parentSchema:F}){let $=F?z:(0,e.str)`${z}/${A}`;return D&&($=(0,e.str)`${$}${(0,a.getErrorPath)(D,a.Type.Str)}`),[b.schemaPath,$]}function T(A,{params:z,message:D},F){const{keyword:$,data:q,schemaValue:J,it:G}=A,{opts:oe,propertyName:de,topSchemaRef:Ee,schemaPath:ot}=G;F.push([b.keyword,$],[b.params,typeof z=="function"?z(A):z||(0,e._)`{}`]),oe.messages&&F.push([b.message,typeof D=="function"?D(A):D]),oe.verbose&&F.push([b.schema,J],[b.parentSchema,(0,e._)`${Ee}${ot}`],[o.default.data,q]),de&&F.push([b.propertyName,de])}})(xc);Object.defineProperty(Ho,"__esModule",{value:!0});Ho.boolOrEmptySchema=Ho.topBoolOrEmptySchema=void 0;const Jk=xc,Yk=zr,Qk=ks,eE={message:"boolean schema is false"};function tE(s){const{gen:e,schema:a,validateName:o}=s;a===!1?A1(s,!1):typeof a=="object"&&a.$async===!0?e.return(Qk.default.data):(e.assign((0,Yk._)`${o}.errors`,null),e.return(!0))}Ho.topBoolOrEmptySchema=tE;function rE(s,e){const{gen:a,schema:o}=s;o===!1?(a.var(e,!1),A1(s)):a.var(e,!0)}Ho.boolOrEmptySchema=rE;function A1(s,e){const{gen:a,data:o}=s,c={gen:a,keyword:"false schema",data:o,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:s};(0,Jk.reportError)(c,eE,void 0,e)}var wc={},ro={};Object.defineProperty(ro,"__esModule",{value:!0});ro.getRules=ro.isJSONType=void 0;const iE=["string","number","integer","boolean","null","object","array"],nE=new Set(iE);function sE(s){return typeof s=="string"&&nE.has(s)}ro.isJSONType=sE;function aE(){const s={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...s,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},s.number,s.string,s.array,s.object],post:{rules:[]},all:{},keywords:{}}}ro.getRules=aE;var Gs={};Object.defineProperty(Gs,"__esModule",{value:!0});Gs.shouldUseRule=Gs.shouldUseGroup=Gs.schemaHasRulesForType=void 0;function oE({schema:s,self:e},a){const o=e.RULES.types[a];return o&&o!==!0&&P1(s,o)}Gs.schemaHasRulesForType=oE;function P1(s,e){return e.rules.some(a=>M1(s,a))}Gs.shouldUseGroup=P1;function M1(s,e){var a;return s[e.keyword]!==void 0||((a=e.definition.implements)===null||a===void 0?void 0:a.some(o=>s[o]!==void 0))}Gs.shouldUseRule=M1;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.reportTypeError=s.checkDataTypes=s.checkDataType=s.coerceAndCheckDataType=s.getJSONTypes=s.getSchemaTypes=s.DataType=void 0;const e=ro,a=Gs,o=xc,c=zr,h=Zr;var f;(function(F){F[F.Correct=0]="Correct",F[F.Wrong=1]="Wrong"})(f=s.DataType||(s.DataType={}));function i(F){const $=d(F.type);if($.includes("null")){if(F.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!$.length&&F.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');F.nullable===!0&&$.push("null")}return $}s.getSchemaTypes=i;function d(F){const $=Array.isArray(F)?F:F?[F]:[];if($.every(e.isJSONType))return $;throw new Error("type must be JSONType or JSONType[]: "+$.join(","))}s.getJSONTypes=d;function g(F,$){const{gen:q,data:J,opts:G}=F,oe=k($,G.coerceTypes),de=$.length>0&&!(oe.length===0&&$.length===1&&(0,a.schemaHasRulesForType)(F,$[0]));if(de){const Ee=T($,J,G.strictNumbers,f.Wrong);q.if(Ee,()=>{oe.length?x(F,$,oe):z(F)})}return de}s.coerceAndCheckDataType=g;const b=new Set(["string","number","integer","boolean","null"]);function k(F,$){return $?F.filter(q=>b.has(q)||$==="array"&&q==="array"):[]}function x(F,$,q){const{gen:J,data:G,opts:oe}=F,de=J.let("dataType",(0,c._)`typeof ${G}`),Ee=J.let("coerced",(0,c._)`undefined`);oe.coerceTypes==="array"&&J.if((0,c._)`${de} == 'object' && Array.isArray(${G}) && ${G}.length == 1`,()=>J.assign(G,(0,c._)`${G}[0]`).assign(de,(0,c._)`typeof ${G}`).if(T($,G,oe.strictNumbers),()=>J.assign(Ee,G))),J.if((0,c._)`${Ee} !== undefined`);for(const le of q)(b.has(le)||le==="array"&&oe.coerceTypes==="array")&&ot(le);J.else(),z(F),J.endIf(),J.if((0,c._)`${Ee} !== undefined`,()=>{J.assign(G,Ee),S(F,Ee)});function ot(le){switch(le){case"string":J.elseIf((0,c._)`${de} == "number" || ${de} == "boolean"`).assign(Ee,(0,c._)`"" + ${G}`).elseIf((0,c._)`${G} === null`).assign(Ee,(0,c._)`""`);return;case"number":J.elseIf((0,c._)`${de} == "boolean" || ${G} === null
              || (${de} == "string" && ${G} && ${G} == +${G})`).assign(Ee,(0,c._)`+${G}`);return;case"integer":J.elseIf((0,c._)`${de} === "boolean" || ${G} === null
              || (${de} === "string" && ${G} && ${G} == +${G} && !(${G} % 1))`).assign(Ee,(0,c._)`+${G}`);return;case"boolean":J.elseIf((0,c._)`${G} === "false" || ${G} === 0 || ${G} === null`).assign(Ee,!1).elseIf((0,c._)`${G} === "true" || ${G} === 1`).assign(Ee,!0);return;case"null":J.elseIf((0,c._)`${G} === "" || ${G} === 0 || ${G} === false`),J.assign(Ee,null);return;case"array":J.elseIf((0,c._)`${de} === "string" || ${de} === "number"
              || ${de} === "boolean" || ${G} === null`).assign(Ee,(0,c._)`[${G}]`)}}}function S({gen:F,parentData:$,parentDataProperty:q},J){F.if((0,c._)`${$} !== undefined`,()=>F.assign((0,c._)`${$}[${q}]`,J))}function E(F,$,q,J=f.Correct){const G=J===f.Correct?c.operators.EQ:c.operators.NEQ;let oe;switch(F){case"null":return(0,c._)`${$} ${G} null`;case"array":oe=(0,c._)`Array.isArray(${$})`;break;case"object":oe=(0,c._)`${$} && typeof ${$} == "object" && !Array.isArray(${$})`;break;case"integer":oe=de((0,c._)`!(${$} % 1) && !isNaN(${$})`);break;case"number":oe=de();break;default:return(0,c._)`typeof ${$} ${G} ${F}`}return J===f.Correct?oe:(0,c.not)(oe);function de(Ee=c.nil){return(0,c.and)((0,c._)`typeof ${$} == "number"`,Ee,q?(0,c._)`isFinite(${$})`:c.nil)}}s.checkDataType=E;function T(F,$,q,J){if(F.length===1)return E(F[0],$,q,J);let G;const oe=(0,h.toHash)(F);if(oe.array&&oe.object){const de=(0,c._)`typeof ${$} != "object"`;G=oe.null?de:(0,c._)`!${$} || ${de}`,delete oe.null,delete oe.array,delete oe.object}else G=c.nil;oe.number&&delete oe.integer;for(const de in oe)G=(0,c.and)(G,E(de,$,q,J));return G}s.checkDataTypes=T;const A={message:({schema:F})=>`must be ${F}`,params:({schema:F,schemaValue:$})=>typeof F=="string"?(0,c._)`{type: ${F}}`:(0,c._)`{type: ${$}}`};function z(F){const $=D(F);(0,o.reportError)($,A)}s.reportTypeError=z;function D(F){const{gen:$,data:q,schema:J}=F,G=(0,h.schemaRefOrVal)(F,J,"type");return{gen:$,keyword:"type",data:q,schema:J.type,schemaCode:G,schemaValue:G,parentSchema:J,params:{},it:F}}})(wc);var ph={};Object.defineProperty(ph,"__esModule",{value:!0});ph.assignDefaults=void 0;const Bo=zr,lE=Zr;function cE(s,e){const{properties:a,items:o}=s.schema;if(e==="object"&&a)for(const c in a)J_(s,c,a[c].default);else e==="array"&&Array.isArray(o)&&o.forEach((c,h)=>J_(s,h,c.default))}ph.assignDefaults=cE;function J_(s,e,a){const{gen:o,compositeRule:c,data:h,opts:f}=s;if(a===void 0)return;const i=(0,Bo._)`${h}${(0,Bo.getProperty)(e)}`;if(c){(0,lE.checkStrictMode)(s,`default is ignored for: ${i}`);return}let d=(0,Bo._)`${i} === undefined`;f.useDefaults==="empty"&&(d=(0,Bo._)`${d} || ${i} === null || ${i} === ""`),o.if(d,(0,Bo._)`${i} = ${(0,Bo.stringify)(a)}`)}var ws={},Mr={};Object.defineProperty(Mr,"__esModule",{value:!0});Mr.validateUnion=Mr.validateArray=Mr.usePattern=Mr.callValidateCode=Mr.schemaProperties=Mr.allSchemaProperties=Mr.noPropertyInData=Mr.propertyInData=Mr.isOwnProperty=Mr.hasPropFunc=Mr.reportMissingProp=Mr.checkMissingProp=Mr.checkReportMissingProp=void 0;const fi=zr,Nd=Zr,ua=ks,uE=Zr;function hE(s,e){const{gen:a,data:o,it:c}=s;a.if(Ud(a,o,e,c.opts.ownProperties),()=>{s.setParams({missingProperty:(0,fi._)`${e}`},!0),s.error()})}Mr.checkReportMissingProp=hE;function fE({gen:s,data:e,it:{opts:a}},o,c){return(0,fi.or)(...o.map(h=>(0,fi.and)(Ud(s,e,h,a.ownProperties),(0,fi._)`${c} = ${h}`)))}Mr.checkMissingProp=fE;function dE(s,e){s.setParams({missingProperty:e},!0),s.error()}Mr.reportMissingProp=dE;function z1(s){return s.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,fi._)`Object.prototype.hasOwnProperty`})}Mr.hasPropFunc=z1;function Fd(s,e,a){return(0,fi._)`${z1(s)}.call(${e}, ${a})`}Mr.isOwnProperty=Fd;function pE(s,e,a,o){const c=(0,fi._)`${e}${(0,fi.getProperty)(a)} !== undefined`;return o?(0,fi._)`${c} && ${Fd(s,e,a)}`:c}Mr.propertyInData=pE;function Ud(s,e,a,o){const c=(0,fi._)`${e}${(0,fi.getProperty)(a)} === undefined`;return o?(0,fi.or)(c,(0,fi.not)(Fd(s,e,a))):c}Mr.noPropertyInData=Ud;function D1(s){return s?Object.keys(s).filter(e=>e!=="__proto__"):[]}Mr.allSchemaProperties=D1;function mE(s,e){return D1(e).filter(a=>!(0,Nd.alwaysValidSchema)(s,e[a]))}Mr.schemaProperties=mE;function gE({schemaCode:s,data:e,it:{gen:a,topSchemaRef:o,schemaPath:c,errorPath:h},it:f},i,d,g){const b=g?(0,fi._)`${s}, ${e}, ${o}${c}`:e,k=[[ua.default.instancePath,(0,fi.strConcat)(ua.default.instancePath,h)],[ua.default.parentData,f.parentData],[ua.default.parentDataProperty,f.parentDataProperty],[ua.default.rootData,ua.default.rootData]];f.opts.dynamicRef&&k.push([ua.default.dynamicAnchors,ua.default.dynamicAnchors]);const x=(0,fi._)`${b}, ${a.object(...k)}`;return d!==fi.nil?(0,fi._)`${i}.call(${d}, ${x})`:(0,fi._)`${i}(${x})`}Mr.callValidateCode=gE;const _E=(0,fi._)`new RegExp`;function yE({gen:s,it:{opts:e}},a){const o=e.unicodeRegExp?"u":"",{regExp:c}=e.code,h=c(a,o);return s.scopeValue("pattern",{key:h.toString(),ref:h,code:(0,fi._)`${c.code==="new RegExp"?_E:(0,uE.useFunc)(s,c)}(${a}, ${o})`})}Mr.usePattern=yE;function vE(s){const{gen:e,data:a,keyword:o,it:c}=s,h=e.name("valid");if(c.allErrors){const i=e.let("valid",!0);return f(()=>e.assign(i,!1)),i}return e.var(h,!0),f(()=>e.break()),h;function f(i){const d=e.const("len",(0,fi._)`${a}.length`);e.forRange("i",0,d,g=>{s.subschema({keyword:o,dataProp:g,dataPropType:Nd.Type.Num},h),e.if((0,fi.not)(h),i)})}}Mr.validateArray=vE;function bE(s){const{gen:e,schema:a,keyword:o,it:c}=s;if(!Array.isArray(a))throw new Error("ajv implementation error");if(a.some(d=>(0,Nd.alwaysValidSchema)(c,d))&&!c.opts.unevaluated)return;const f=e.let("valid",!1),i=e.name("_valid");e.block(()=>a.forEach((d,g)=>{const b=s.subschema({keyword:o,schemaProp:g,compositeRule:!0},i);e.assign(f,(0,fi._)`${f} || ${i}`),s.mergeValidEvaluated(b,i)||e.if((0,fi.not)(f))})),s.result(f,()=>s.reset(),()=>s.error(!0))}Mr.validateUnion=bE;Object.defineProperty(ws,"__esModule",{value:!0});ws.validateKeywordUsage=ws.validSchemaType=ws.funcKeywordCode=ws.macroKeywordCode=void 0;const pn=zr,Xa=ks,xE=Mr,wE=xc;function SE(s,e){const{gen:a,keyword:o,schema:c,parentSchema:h,it:f}=s,i=e.macro.call(f.self,c,h,f),d=L1(a,o,i);f.opts.validateSchema!==!1&&f.self.validateSchema(i,!0);const g=a.name("valid");s.subschema({schema:i,schemaPath:pn.nil,errSchemaPath:`${f.errSchemaPath}/${o}`,topSchemaRef:d,compositeRule:!0},g),s.pass(g,()=>s.error(!0))}ws.macroKeywordCode=SE;function kE(s,e){var a;const{gen:o,keyword:c,schema:h,parentSchema:f,$data:i,it:d}=s;TE(d,e);const g=!i&&e.compile?e.compile.call(d.self,h,f,d):e.validate,b=L1(o,c,g),k=o.let("valid");s.block$data(k,x),s.ok((a=e.valid)!==null&&a!==void 0?a:k);function x(){if(e.errors===!1)T(),e.modifying&&Y_(s),A(()=>s.error());else{const z=e.async?S():E();e.modifying&&Y_(s),A(()=>EE(s,z))}}function S(){const z=o.let("ruleErrs",null);return o.try(()=>T((0,pn._)`await `),D=>o.assign(k,!1).if((0,pn._)`${D} instanceof ${d.ValidationError}`,()=>o.assign(z,(0,pn._)`${D}.errors`),()=>o.throw(D))),z}function E(){const z=(0,pn._)`${b}.errors`;return o.assign(z,null),T(pn.nil),z}function T(z=e.async?(0,pn._)`await `:pn.nil){const D=d.opts.passContext?Xa.default.this:Xa.default.self,F=!("compile"in e&&!i||e.schema===!1);o.assign(k,(0,pn._)`${z}${(0,xE.callValidateCode)(s,b,D,F)}`,e.modifying)}function A(z){var D;o.if((0,pn.not)((D=e.valid)!==null&&D!==void 0?D:k),z)}}ws.funcKeywordCode=kE;function Y_(s){const{gen:e,data:a,it:o}=s;e.if(o.parentData,()=>e.assign(a,(0,pn._)`${o.parentData}[${o.parentDataProperty}]`))}function EE(s,e){const{gen:a}=s;a.if((0,pn._)`Array.isArray(${e})`,()=>{a.assign(Xa.default.vErrors,(0,pn._)`${Xa.default.vErrors} === null ? ${e} : ${Xa.default.vErrors}.concat(${e})`).assign(Xa.default.errors,(0,pn._)`${Xa.default.vErrors}.length`),(0,wE.extendErrors)(s)},()=>s.error())}function TE({schemaEnv:s},e){if(e.async&&!s.$async)throw new Error("async keyword in sync schema")}function L1(s,e,a){if(a===void 0)throw new Error(`keyword "${e}" failed to compile`);return s.scopeValue("keyword",typeof a=="function"?{ref:a}:{ref:a,code:(0,pn.stringify)(a)})}function CE(s,e,a=!1){return!e.length||e.some(o=>o==="array"?Array.isArray(s):o==="object"?s&&typeof s=="object"&&!Array.isArray(s):typeof s==o||a&&typeof s>"u")}ws.validSchemaType=CE;function IE({schema:s,opts:e,self:a,errSchemaPath:o},c,h){if(Array.isArray(c.keyword)?!c.keyword.includes(h):c.keyword!==h)throw new Error("ajv implementation error");const f=c.dependencies;if(f!=null&&f.some(i=>!Object.prototype.hasOwnProperty.call(s,i)))throw new Error(`parent schema must have dependencies of ${h}: ${f.join(",")}`);if(c.validateSchema&&!c.validateSchema(s[h])){const d=`keyword "${h}" value is invalid at path "${o}": `+a.errorsText(c.validateSchema.errors);if(e.validateSchema==="log")a.logger.error(d);else throw new Error(d)}}ws.validateKeywordUsage=IE;var pa={};Object.defineProperty(pa,"__esModule",{value:!0});pa.extendSubschemaMode=pa.extendSubschemaData=pa.getSubschema=void 0;const xs=zr,R1=Zr;function AE(s,{keyword:e,schemaProp:a,schema:o,schemaPath:c,errSchemaPath:h,topSchemaRef:f}){if(e!==void 0&&o!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){const i=s.schema[e];return a===void 0?{schema:i,schemaPath:(0,xs._)`${s.schemaPath}${(0,xs.getProperty)(e)}`,errSchemaPath:`${s.errSchemaPath}/${e}`}:{schema:i[a],schemaPath:(0,xs._)`${s.schemaPath}${(0,xs.getProperty)(e)}${(0,xs.getProperty)(a)}`,errSchemaPath:`${s.errSchemaPath}/${e}/${(0,R1.escapeFragment)(a)}`}}if(o!==void 0){if(c===void 0||h===void 0||f===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:o,schemaPath:c,topSchemaRef:f,errSchemaPath:h}}throw new Error('either "keyword" or "schema" must be passed')}pa.getSubschema=AE;function PE(s,e,{dataProp:a,dataPropType:o,data:c,dataTypes:h,propertyName:f}){if(c!==void 0&&a!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:i}=e;if(a!==void 0){const{errorPath:g,dataPathArr:b,opts:k}=e,x=i.let("data",(0,xs._)`${e.data}${(0,xs.getProperty)(a)}`,!0);d(x),s.errorPath=(0,xs.str)`${g}${(0,R1.getErrorPath)(a,o,k.jsPropertySyntax)}`,s.parentDataProperty=(0,xs._)`${a}`,s.dataPathArr=[...b,s.parentDataProperty]}if(c!==void 0){const g=c instanceof xs.Name?c:i.let("data",c,!0);d(g),f!==void 0&&(s.propertyName=f)}h&&(s.dataTypes=h);function d(g){s.data=g,s.dataLevel=e.dataLevel+1,s.dataTypes=[],e.definedProperties=new Set,s.parentData=e.data,s.dataNames=[...e.dataNames,g]}}pa.extendSubschemaData=PE;function ME(s,{jtdDiscriminator:e,jtdMetadata:a,compositeRule:o,createErrors:c,allErrors:h}){o!==void 0&&(s.compositeRule=o),c!==void 0&&(s.createErrors=c),h!==void 0&&(s.allErrors=h),s.jtdDiscriminator=e,s.jtdMetadata=a}pa.extendSubschemaMode=ME;var Ji={},O1=function s(e,a){if(e===a)return!0;if(e&&a&&typeof e=="object"&&typeof a=="object"){if(e.constructor!==a.constructor)return!1;var o,c,h;if(Array.isArray(e)){if(o=e.length,o!=a.length)return!1;for(c=o;c--!==0;)if(!s(e[c],a[c]))return!1;return!0}if(e.constructor===RegExp)return e.source===a.source&&e.flags===a.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===a.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===a.toString();if(h=Object.keys(e),o=h.length,o!==Object.keys(a).length)return!1;for(c=o;c--!==0;)if(!Object.prototype.hasOwnProperty.call(a,h[c]))return!1;for(c=o;c--!==0;){var f=h[c];if(!s(e[f],a[f]))return!1}return!0}return e!==e&&a!==a},B1={exports:{}},da=B1.exports=function(s,e,a){typeof e=="function"&&(a=e,e={}),a=e.cb||a;var o=typeof a=="function"?a:a.pre||function(){},c=a.post||function(){};Gu(e,o,c,s,"",s)};da.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};da.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};da.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};da.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Gu(s,e,a,o,c,h,f,i,d,g){if(o&&typeof o=="object"&&!Array.isArray(o)){e(o,c,h,f,i,d,g);for(var b in o){var k=o[b];if(Array.isArray(k)){if(b in da.arrayKeywords)for(var x=0;x<k.length;x++)Gu(s,e,a,k[x],c+"/"+b+"/"+x,h,c,b,o,x)}else if(b in da.propsKeywords){if(k&&typeof k=="object")for(var S in k)Gu(s,e,a,k[S],c+"/"+b+"/"+zE(S),h,c,b,o,S)}else(b in da.keywords||s.allKeys&&!(b in da.skipKeywords))&&Gu(s,e,a,k,c+"/"+b,h,c,b,o)}a(o,c,h,f,i,d,g)}}function zE(s){return s.replace(/~/g,"~0").replace(/\//g,"~1")}var DE=B1.exports;Object.defineProperty(Ji,"__esModule",{value:!0});Ji.getSchemaRefs=Ji.resolveUrl=Ji.normalizeId=Ji._getFullPath=Ji.getFullPath=Ji.inlineRef=void 0;const LE=Zr,RE=O1,OE=DE,BE=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function NE(s,e=!0){return typeof s=="boolean"?!0:e===!0?!xd(s):e?N1(s)<=e:!1}Ji.inlineRef=NE;const FE=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function xd(s){for(const e in s){if(FE.has(e))return!0;const a=s[e];if(Array.isArray(a)&&a.some(xd)||typeof a=="object"&&xd(a))return!0}return!1}function N1(s){let e=0;for(const a in s){if(a==="$ref")return 1/0;if(e++,!BE.has(a)&&(typeof s[a]=="object"&&(0,LE.eachItem)(s[a],o=>e+=N1(o)),e===1/0))return 1/0}return e}function F1(s,e="",a){a!==!1&&(e=Go(e));const o=s.parse(e);return U1(s,o)}Ji.getFullPath=F1;function U1(s,e){return s.serialize(e).split("#")[0]+"#"}Ji._getFullPath=U1;const UE=/#\/?$/;function Go(s){return s?s.replace(UE,""):""}Ji.normalizeId=Go;function VE(s,e,a){return a=Go(a),s.resolve(e,a)}Ji.resolveUrl=VE;const $E=/^[a-z_][-a-z0-9._]*$/i;function jE(s,e){if(typeof s=="boolean")return{};const{schemaId:a,uriResolver:o}=this.opts,c=Go(s[a]||e),h={"":c},f=F1(o,c,!1),i={},d=new Set;return OE(s,{allKeys:!0},(k,x,S,E)=>{if(E===void 0)return;const T=f+x;let A=h[E];typeof k[a]=="string"&&(A=z.call(this,k[a])),D.call(this,k.$anchor),D.call(this,k.$dynamicAnchor),h[x]=A;function z(F){const $=this.opts.uriResolver.resolve;if(F=Go(A?$(A,F):F),d.has(F))throw b(F);d.add(F);let q=this.refs[F];return typeof q=="string"&&(q=this.refs[q]),typeof q=="object"?g(k,q.schema,F):F!==Go(T)&&(F[0]==="#"?(g(k,i[F],F),i[F]=k):this.refs[F]=T),F}function D(F){if(typeof F=="string"){if(!$E.test(F))throw new Error(`invalid anchor "${F}"`);z.call(this,`#${F}`)}}}),i;function g(k,x,S){if(x!==void 0&&!RE(k,x))throw b(S)}function b(k){return new Error(`reference "${k}" resolves to more than one schema`)}}Ji.getSchemaRefs=jE;Object.defineProperty(as,"__esModule",{value:!0});as.getData=as.KeywordCxt=as.validateFunctionCode=void 0;const V1=Ho,Q_=wc,Vd=Gs,ih=wc,qE=ph,sc=ws,Nf=pa,ur=zr,vr=ks,GE=Ji,Zs=Zr,Ql=xc;function ZE(s){if(q1(s)&&(G1(s),j1(s))){KE(s);return}$1(s,()=>(0,V1.topBoolOrEmptySchema)(s))}as.validateFunctionCode=ZE;function $1({gen:s,validateName:e,schema:a,schemaEnv:o,opts:c},h){c.code.es5?s.func(e,(0,ur._)`${vr.default.data}, ${vr.default.valCxt}`,o.$async,()=>{s.code((0,ur._)`"use strict"; ${ey(a,c)}`),WE(s,c),s.code(h)}):s.func(e,(0,ur._)`${vr.default.data}, ${HE(c)}`,o.$async,()=>s.code(ey(a,c)).code(h))}function HE(s){return(0,ur._)`{${vr.default.instancePath}="", ${vr.default.parentData}, ${vr.default.parentDataProperty}, ${vr.default.rootData}=${vr.default.data}${s.dynamicRef?(0,ur._)`, ${vr.default.dynamicAnchors}={}`:ur.nil}}={}`}function WE(s,e){s.if(vr.default.valCxt,()=>{s.var(vr.default.instancePath,(0,ur._)`${vr.default.valCxt}.${vr.default.instancePath}`),s.var(vr.default.parentData,(0,ur._)`${vr.default.valCxt}.${vr.default.parentData}`),s.var(vr.default.parentDataProperty,(0,ur._)`${vr.default.valCxt}.${vr.default.parentDataProperty}`),s.var(vr.default.rootData,(0,ur._)`${vr.default.valCxt}.${vr.default.rootData}`),e.dynamicRef&&s.var(vr.default.dynamicAnchors,(0,ur._)`${vr.default.valCxt}.${vr.default.dynamicAnchors}`)},()=>{s.var(vr.default.instancePath,(0,ur._)`""`),s.var(vr.default.parentData,(0,ur._)`undefined`),s.var(vr.default.parentDataProperty,(0,ur._)`undefined`),s.var(vr.default.rootData,vr.default.data),e.dynamicRef&&s.var(vr.default.dynamicAnchors,(0,ur._)`{}`)})}function KE(s){const{schema:e,opts:a,gen:o}=s;$1(s,()=>{a.$comment&&e.$comment&&H1(s),e5(s),o.let(vr.default.vErrors,null),o.let(vr.default.errors,0),a.unevaluated&&XE(s),Z1(s),i5(s)})}function XE(s){const{gen:e,validateName:a}=s;s.evaluated=e.const("evaluated",(0,ur._)`${a}.evaluated`),e.if((0,ur._)`${s.evaluated}.dynamicProps`,()=>e.assign((0,ur._)`${s.evaluated}.props`,(0,ur._)`undefined`)),e.if((0,ur._)`${s.evaluated}.dynamicItems`,()=>e.assign((0,ur._)`${s.evaluated}.items`,(0,ur._)`undefined`))}function ey(s,e){const a=typeof s=="object"&&s[e.schemaId];return a&&(e.code.source||e.code.process)?(0,ur._)`/*# sourceURL=${a} */`:ur.nil}function JE(s,e){if(q1(s)&&(G1(s),j1(s))){YE(s,e);return}(0,V1.boolOrEmptySchema)(s,e)}function j1({schema:s,self:e}){if(typeof s=="boolean")return!s;for(const a in s)if(e.RULES.all[a])return!0;return!1}function q1(s){return typeof s.schema!="boolean"}function YE(s,e){const{schema:a,gen:o,opts:c}=s;c.$comment&&a.$comment&&H1(s),t5(s),r5(s);const h=o.const("_errs",vr.default.errors);Z1(s,h),o.var(e,(0,ur._)`${h} === ${vr.default.errors}`)}function G1(s){(0,Zs.checkUnknownRules)(s),QE(s)}function Z1(s,e){if(s.opts.jtd)return ty(s,[],!1,e);const a=(0,Q_.getSchemaTypes)(s.schema),o=(0,Q_.coerceAndCheckDataType)(s,a);ty(s,a,!o,e)}function QE(s){const{schema:e,errSchemaPath:a,opts:o,self:c}=s;e.$ref&&o.ignoreKeywordsWithRef&&(0,Zs.schemaHasRulesButRef)(e,c.RULES)&&c.logger.warn(`$ref: keywords ignored in schema at path "${a}"`)}function e5(s){const{schema:e,opts:a}=s;e.default!==void 0&&a.useDefaults&&a.strictSchema&&(0,Zs.checkStrictMode)(s,"default is ignored in the schema root")}function t5(s){const e=s.schema[s.opts.schemaId];e&&(s.baseId=(0,GE.resolveUrl)(s.opts.uriResolver,s.baseId,e))}function r5(s){if(s.schema.$async&&!s.schemaEnv.$async)throw new Error("async schema in sync schema")}function H1({gen:s,schemaEnv:e,schema:a,errSchemaPath:o,opts:c}){const h=a.$comment;if(c.$comment===!0)s.code((0,ur._)`${vr.default.self}.logger.log(${h})`);else if(typeof c.$comment=="function"){const f=(0,ur.str)`${o}/$comment`,i=s.scopeValue("root",{ref:e.root});s.code((0,ur._)`${vr.default.self}.opts.$comment(${h}, ${f}, ${i}.schema)`)}}function i5(s){const{gen:e,schemaEnv:a,validateName:o,ValidationError:c,opts:h}=s;a.$async?e.if((0,ur._)`${vr.default.errors} === 0`,()=>e.return(vr.default.data),()=>e.throw((0,ur._)`new ${c}(${vr.default.vErrors})`)):(e.assign((0,ur._)`${o}.errors`,vr.default.vErrors),h.unevaluated&&n5(s),e.return((0,ur._)`${vr.default.errors} === 0`))}function n5({gen:s,evaluated:e,props:a,items:o}){a instanceof ur.Name&&s.assign((0,ur._)`${e}.props`,a),o instanceof ur.Name&&s.assign((0,ur._)`${e}.items`,o)}function ty(s,e,a,o){const{gen:c,schema:h,data:f,allErrors:i,opts:d,self:g}=s,{RULES:b}=g;if(h.$ref&&(d.ignoreKeywordsWithRef||!(0,Zs.schemaHasRulesButRef)(h,b))){c.block(()=>X1(s,"$ref",b.all.$ref.definition));return}d.jtd||s5(s,e),c.block(()=>{for(const x of b.rules)k(x);k(b.post)});function k(x){(0,Vd.shouldUseGroup)(h,x)&&(x.type?(c.if((0,ih.checkDataType)(x.type,f,d.strictNumbers)),ry(s,x),e.length===1&&e[0]===x.type&&a&&(c.else(),(0,ih.reportTypeError)(s)),c.endIf()):ry(s,x),i||c.if((0,ur._)`${vr.default.errors} === ${o||0}`))}}function ry(s,e){const{gen:a,schema:o,opts:{useDefaults:c}}=s;c&&(0,qE.assignDefaults)(s,e.type),a.block(()=>{for(const h of e.rules)(0,Vd.shouldUseRule)(o,h)&&X1(s,h.keyword,h.definition,e.type)})}function s5(s,e){s.schemaEnv.meta||!s.opts.strictTypes||(a5(s,e),s.opts.allowUnionTypes||o5(s,e),l5(s,s.dataTypes))}function a5(s,e){if(e.length){if(!s.dataTypes.length){s.dataTypes=e;return}e.forEach(a=>{W1(s.dataTypes,a)||$d(s,`type "${a}" not allowed by context "${s.dataTypes.join(",")}"`)}),u5(s,e)}}function o5(s,e){e.length>1&&!(e.length===2&&e.includes("null"))&&$d(s,"use allowUnionTypes to allow union type keyword")}function l5(s,e){const a=s.self.RULES.all;for(const o in a){const c=a[o];if(typeof c=="object"&&(0,Vd.shouldUseRule)(s.schema,c)){const{type:h}=c.definition;h.length&&!h.some(f=>c5(e,f))&&$d(s,`missing type "${h.join(",")}" for keyword "${o}"`)}}}function c5(s,e){return s.includes(e)||e==="number"&&s.includes("integer")}function W1(s,e){return s.includes(e)||e==="integer"&&s.includes("number")}function u5(s,e){const a=[];for(const o of s.dataTypes)W1(e,o)?a.push(o):e.includes("integer")&&o==="number"&&a.push("integer");s.dataTypes=a}function $d(s,e){const a=s.schemaEnv.baseId+s.errSchemaPath;e+=` at "${a}" (strictTypes)`,(0,Zs.checkStrictMode)(s,e,s.opts.strictTypes)}class K1{constructor(e,a,o){if((0,sc.validateKeywordUsage)(e,a,o),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=o,this.data=e.data,this.schema=e.schema[o],this.$data=a.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Zs.schemaRefOrVal)(e,this.schema,o,this.$data),this.schemaType=a.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=a,this.$data)this.schemaCode=e.gen.const("vSchema",J1(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,sc.validSchemaType)(this.schema,a.schemaType,a.allowUndefined))throw new Error(`${o} value must be ${JSON.stringify(a.schemaType)}`);("code"in a?a.trackErrors:a.errors!==!1)&&(this.errsCount=e.gen.const("_errs",vr.default.errors))}result(e,a,o){this.failResult((0,ur.not)(e),a,o)}failResult(e,a,o){this.gen.if(e),o?o():this.error(),a?(this.gen.else(),a(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,a){this.failResult((0,ur.not)(e),void 0,a)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:a}=this;this.fail((0,ur._)`${a} !== undefined && (${(0,ur.or)(this.invalid$data(),e)})`)}error(e,a,o){if(a){this.setParams(a),this._error(e,o),this.setParams({});return}this._error(e,o)}_error(e,a){(e?Ql.reportExtraError:Ql.reportError)(this,this.def.error,a)}$dataError(){(0,Ql.reportError)(this,this.def.$dataError||Ql.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Ql.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,a){a?Object.assign(this.params,e):this.params=e}block$data(e,a,o=ur.nil){this.gen.block(()=>{this.check$data(e,o),a()})}check$data(e=ur.nil,a=ur.nil){if(!this.$data)return;const{gen:o,schemaCode:c,schemaType:h,def:f}=this;o.if((0,ur.or)((0,ur._)`${c} === undefined`,a)),e!==ur.nil&&o.assign(e,!0),(h.length||f.validateSchema)&&(o.elseIf(this.invalid$data()),this.$dataError(),e!==ur.nil&&o.assign(e,!1)),o.else()}invalid$data(){const{gen:e,schemaCode:a,schemaType:o,def:c,it:h}=this;return(0,ur.or)(f(),i());function f(){if(o.length){if(!(a instanceof ur.Name))throw new Error("ajv implementation error");const d=Array.isArray(o)?o:[o];return(0,ur._)`${(0,ih.checkDataTypes)(d,a,h.opts.strictNumbers,ih.DataType.Wrong)}`}return ur.nil}function i(){if(c.validateSchema){const d=e.scopeValue("validate$data",{ref:c.validateSchema});return(0,ur._)`!${d}(${a})`}return ur.nil}}subschema(e,a){const o=(0,Nf.getSubschema)(this.it,e);(0,Nf.extendSubschemaData)(o,this.it,e),(0,Nf.extendSubschemaMode)(o,e);const c={...this.it,...o,items:void 0,props:void 0};return JE(c,a),c}mergeEvaluated(e,a){const{it:o,gen:c}=this;o.opts.unevaluated&&(o.props!==!0&&e.props!==void 0&&(o.props=Zs.mergeEvaluated.props(c,e.props,o.props,a)),o.items!==!0&&e.items!==void 0&&(o.items=Zs.mergeEvaluated.items(c,e.items,o.items,a)))}mergeValidEvaluated(e,a){const{it:o,gen:c}=this;if(o.opts.unevaluated&&(o.props!==!0||o.items!==!0))return c.if(a,()=>this.mergeEvaluated(e,ur.Name)),!0}}as.KeywordCxt=K1;function X1(s,e,a,o){const c=new K1(s,a,e);"code"in a?a.code(c,o):c.$data&&a.validate?(0,sc.funcKeywordCode)(c,a):"macro"in a?(0,sc.macroKeywordCode)(c,a):(a.compile||a.validate)&&(0,sc.funcKeywordCode)(c,a)}const h5=/^\/(?:[^~]|~0|~1)*$/,f5=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function J1(s,{dataLevel:e,dataNames:a,dataPathArr:o}){let c,h;if(s==="")return vr.default.rootData;if(s[0]==="/"){if(!h5.test(s))throw new Error(`Invalid JSON-pointer: ${s}`);c=s,h=vr.default.rootData}else{const g=f5.exec(s);if(!g)throw new Error(`Invalid JSON-pointer: ${s}`);const b=+g[1];if(c=g[2],c==="#"){if(b>=e)throw new Error(d("property/index",b));return o[e-b]}if(b>e)throw new Error(d("data",b));if(h=a[e-b],!c)return h}let f=h;const i=c.split("/");for(const g of i)g&&(h=(0,ur._)`${h}${(0,ur.getProperty)((0,Zs.unescapeJsonPointer)(g))}`,f=(0,ur._)`${f} && ${h}`);return f;function d(g,b){return`Cannot access ${g} ${b} levels up, current level is ${e}`}}as.getData=J1;var Sc={};Object.defineProperty(Sc,"__esModule",{value:!0});class d5 extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}Sc.default=d5;var kc={};Object.defineProperty(kc,"__esModule",{value:!0});const Ff=Ji;class p5 extends Error{constructor(e,a,o,c){super(c||`can't resolve reference ${o} from id ${a}`),this.missingRef=(0,Ff.resolveUrl)(e,a,o),this.missingSchema=(0,Ff.normalizeId)((0,Ff.getFullPath)(e,this.missingRef))}}kc.default=p5;var Sn={};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.resolveSchema=Sn.getCompilingSchema=Sn.resolveRef=Sn.compileSchema=Sn.SchemaEnv=void 0;const is=zr,m5=Sc,Wa=ks,ss=Ji,iy=Zr,g5=as;class mh{constructor(e){var a;this.refs={},this.dynamicAnchors={};let o;typeof e.schema=="object"&&(o=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(a=e.baseId)!==null&&a!==void 0?a:(0,ss.normalizeId)(o==null?void 0:o[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=o==null?void 0:o.$async,this.refs={}}}Sn.SchemaEnv=mh;function jd(s){const e=Y1.call(this,s);if(e)return e;const a=(0,ss.getFullPath)(this.opts.uriResolver,s.root.baseId),{es5:o,lines:c}=this.opts.code,{ownProperties:h}=this.opts,f=new is.CodeGen(this.scope,{es5:o,lines:c,ownProperties:h});let i;s.$async&&(i=f.scopeValue("Error",{ref:m5.default,code:(0,is._)`require("ajv/dist/runtime/validation_error").default`}));const d=f.scopeName("validate");s.validateName=d;const g={gen:f,allErrors:this.opts.allErrors,data:Wa.default.data,parentData:Wa.default.parentData,parentDataProperty:Wa.default.parentDataProperty,dataNames:[Wa.default.data],dataPathArr:[is.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:f.scopeValue("schema",this.opts.code.source===!0?{ref:s.schema,code:(0,is.stringify)(s.schema)}:{ref:s.schema}),validateName:d,ValidationError:i,schema:s.schema,schemaEnv:s,rootId:a,baseId:s.baseId||a,schemaPath:is.nil,errSchemaPath:s.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,is._)`""`,opts:this.opts,self:this};let b;try{this._compilations.add(s),(0,g5.validateFunctionCode)(g),f.optimize(this.opts.code.optimize);const k=f.toString();b=`${f.scopeRefs(Wa.default.scope)}return ${k}`,this.opts.code.process&&(b=this.opts.code.process(b,s));const S=new Function(`${Wa.default.self}`,`${Wa.default.scope}`,b)(this,this.scope.get());if(this.scope.value(d,{ref:S}),S.errors=null,S.schema=s.schema,S.schemaEnv=s,s.$async&&(S.$async=!0),this.opts.code.source===!0&&(S.source={validateName:d,validateCode:k,scopeValues:f._values}),this.opts.unevaluated){const{props:E,items:T}=g;S.evaluated={props:E instanceof is.Name?void 0:E,items:T instanceof is.Name?void 0:T,dynamicProps:E instanceof is.Name,dynamicItems:T instanceof is.Name},S.source&&(S.source.evaluated=(0,is.stringify)(S.evaluated))}return s.validate=S,s}catch(k){throw delete s.validate,delete s.validateName,b&&this.logger.error("Error compiling schema, function code:",b),k}finally{this._compilations.delete(s)}}Sn.compileSchema=jd;function _5(s,e,a){var o;a=(0,ss.resolveUrl)(this.opts.uriResolver,e,a);const c=s.refs[a];if(c)return c;let h=b5.call(this,s,a);if(h===void 0){const f=(o=s.localRefs)===null||o===void 0?void 0:o[a],{schemaId:i}=this.opts;f&&(h=new mh({schema:f,schemaId:i,root:s,baseId:e}))}if(h!==void 0)return s.refs[a]=y5.call(this,h)}Sn.resolveRef=_5;function y5(s){return(0,ss.inlineRef)(s.schema,this.opts.inlineRefs)?s.schema:s.validate?s:jd.call(this,s)}function Y1(s){for(const e of this._compilations)if(v5(e,s))return e}Sn.getCompilingSchema=Y1;function v5(s,e){return s.schema===e.schema&&s.root===e.root&&s.baseId===e.baseId}function b5(s,e){let a;for(;typeof(a=this.refs[e])=="string";)e=a;return a||this.schemas[e]||gh.call(this,s,e)}function gh(s,e){const a=this.opts.uriResolver.parse(e),o=(0,ss._getFullPath)(this.opts.uriResolver,a);let c=(0,ss.getFullPath)(this.opts.uriResolver,s.baseId,void 0);if(Object.keys(s.schema).length>0&&o===c)return Uf.call(this,a,s);const h=(0,ss.normalizeId)(o),f=this.refs[h]||this.schemas[h];if(typeof f=="string"){const i=gh.call(this,s,f);return typeof(i==null?void 0:i.schema)!="object"?void 0:Uf.call(this,a,i)}if(typeof(f==null?void 0:f.schema)=="object"){if(f.validate||jd.call(this,f),h===(0,ss.normalizeId)(e)){const{schema:i}=f,{schemaId:d}=this.opts,g=i[d];return g&&(c=(0,ss.resolveUrl)(this.opts.uriResolver,c,g)),new mh({schema:i,schemaId:d,root:s,baseId:c})}return Uf.call(this,a,f)}}Sn.resolveSchema=gh;const x5=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Uf(s,{baseId:e,schema:a,root:o}){var c;if(((c=s.fragment)===null||c===void 0?void 0:c[0])!=="/")return;for(const i of s.fragment.slice(1).split("/")){if(typeof a=="boolean")return;const d=a[(0,iy.unescapeFragment)(i)];if(d===void 0)return;a=d;const g=typeof a=="object"&&a[this.opts.schemaId];!x5.has(i)&&g&&(e=(0,ss.resolveUrl)(this.opts.uriResolver,e,g))}let h;if(typeof a!="boolean"&&a.$ref&&!(0,iy.schemaHasRulesButRef)(a,this.RULES)){const i=(0,ss.resolveUrl)(this.opts.uriResolver,e,a.$ref);h=gh.call(this,o,i)}const{schemaId:f}=this.opts;if(h=h||new mh({schema:a,schemaId:f,root:o,baseId:e}),h.schema!==h.root.schema)return h}const w5="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",S5="Meta-schema for $data reference (JSON AnySchema extension proposal)",k5="object",E5=["$data"],T5={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},C5=!1,I5={$id:w5,description:S5,type:k5,required:E5,properties:T5,additionalProperties:C5};var qd={},wd={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function(s,e){(function(a,o){o(e)})($o,function(a){function o(){for(var Ae=arguments.length,U=Array(Ae),L=0;L<Ae;L++)U[L]=arguments[L];if(U.length>1){U[0]=U[0].slice(0,-1);for(var V=U.length-1,H=1;H<V;++H)U[H]=U[H].slice(1,-1);return U[V]=U[V].slice(1),U.join("")}else return U[0]}function c(Ae){return"(?:"+Ae+")"}function h(Ae){return Ae===void 0?"undefined":Ae===null?"null":Object.prototype.toString.call(Ae).split(" ").pop().split("]").shift().toLowerCase()}function f(Ae){return Ae.toUpperCase()}function i(Ae){return Ae!=null?Ae instanceof Array?Ae:typeof Ae.length!="number"||Ae.split||Ae.setInterval||Ae.call?[Ae]:Array.prototype.slice.call(Ae):[]}function d(Ae,U){var L=Ae;if(U)for(var V in U)L[V]=U[V];return L}function g(Ae){var U="[A-Za-z]",L="[0-9]",V=o(L,"[A-Fa-f]"),H=c(c("%[EFef]"+V+"%"+V+V+"%"+V+V)+"|"+c("%[89A-Fa-f]"+V+"%"+V+V)+"|"+c("%"+V+V)),te="[\\:\\/\\?\\#\\[\\]\\@]",he="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Te=o(te,he),Se=Ae?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",ye=Ae?"[\\uE000-\\uF8FF]":"[]",Ce=o(U,L,"[\\-\\.\\_\\~]",Se);c(U+o(U,L,"[\\+\\-\\.]")+"*"),c(c(H+"|"+o(Ce,he,"[\\:]"))+"*");var qe=c(c("25[0-5]")+"|"+c("2[0-4]"+L)+"|"+c("1"+L+L)+"|"+c("0?[1-9]"+L)+"|0?0?"+L),at=c(qe+"\\."+qe+"\\."+qe+"\\."+qe),Le=c(V+"{1,4}"),It=c(c(Le+"\\:"+Le)+"|"+at),Pt=c(c(Le+"\\:")+"{6}"+It),bt=c("\\:\\:"+c(Le+"\\:")+"{5}"+It),Xt=c(c(Le)+"?\\:\\:"+c(Le+"\\:")+"{4}"+It),Yt=c(c(c(Le+"\\:")+"{0,1}"+Le)+"?\\:\\:"+c(Le+"\\:")+"{3}"+It),mr=c(c(c(Le+"\\:")+"{0,2}"+Le)+"?\\:\\:"+c(Le+"\\:")+"{2}"+It),or=c(c(c(Le+"\\:")+"{0,3}"+Le)+"?\\:\\:"+Le+"\\:"+It),fr=c(c(c(Le+"\\:")+"{0,4}"+Le)+"?\\:\\:"+It),dr=c(c(c(Le+"\\:")+"{0,5}"+Le)+"?\\:\\:"+Le),Er=c(c(c(Le+"\\:")+"{0,6}"+Le)+"?\\:\\:"),Qr=c([Pt,bt,Xt,Yt,mr,or,fr,dr,Er].join("|")),Dr=c(c(Ce+"|"+H)+"+");c("[vV]"+V+"+\\."+o(Ce,he,"[\\:]")+"+"),c(c(H+"|"+o(Ce,he))+"*");var di=c(H+"|"+o(Ce,he,"[\\:\\@]"));return c(c(H+"|"+o(Ce,he,"[\\@]"))+"+"),c(c(di+"|"+o("[\\/\\?]",ye))+"*"),{NOT_SCHEME:new RegExp(o("[^]",U,L,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(o("[^\\%\\:]",Ce,he),"g"),NOT_HOST:new RegExp(o("[^\\%\\[\\]\\:]",Ce,he),"g"),NOT_PATH:new RegExp(o("[^\\%\\/\\:\\@]",Ce,he),"g"),NOT_PATH_NOSCHEME:new RegExp(o("[^\\%\\/\\@]",Ce,he),"g"),NOT_QUERY:new RegExp(o("[^\\%]",Ce,he,"[\\:\\@\\/\\?]",ye),"g"),NOT_FRAGMENT:new RegExp(o("[^\\%]",Ce,he,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(o("[^]",Ce,he),"g"),UNRESERVED:new RegExp(Ce,"g"),OTHER_CHARS:new RegExp(o("[^\\%]",Ce,Te),"g"),PCT_ENCODED:new RegExp(H,"g"),IPV4ADDRESS:new RegExp("^("+at+")$"),IPV6ADDRESS:new RegExp("^\\[?("+Qr+")"+c(c("\\%25|\\%(?!"+V+"{2})")+"("+Dr+")")+"?\\]?$")}}var b=g(!1),k=g(!0),x=function(){function Ae(U,L){var V=[],H=!0,te=!1,he=void 0;try{for(var Te=U[Symbol.iterator](),Se;!(H=(Se=Te.next()).done)&&(V.push(Se.value),!(L&&V.length===L));H=!0);}catch(ye){te=!0,he=ye}finally{try{!H&&Te.return&&Te.return()}finally{if(te)throw he}}return V}return function(U,L){if(Array.isArray(U))return U;if(Symbol.iterator in Object(U))return Ae(U,L);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),S=function(Ae){if(Array.isArray(Ae)){for(var U=0,L=Array(Ae.length);U<Ae.length;U++)L[U]=Ae[U];return L}else return Array.from(Ae)},E=2147483647,T=36,A=1,z=26,D=38,F=700,$=72,q=128,J="-",G=/^xn--/,oe=/[^\0-\x7E]/,de=/[\x2E\u3002\uFF0E\uFF61]/g,Ee={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},ot=T-A,le=Math.floor,Ne=String.fromCharCode;function Y(Ae){throw new RangeError(Ee[Ae])}function Qe(Ae,U){for(var L=[],V=Ae.length;V--;)L[V]=U(Ae[V]);return L}function pt(Ae,U){var L=Ae.split("@"),V="";L.length>1&&(V=L[0]+"@",Ae=L[1]),Ae=Ae.replace(de,".");var H=Ae.split("."),te=Qe(H,U).join(".");return V+te}function dt(Ae){for(var U=[],L=0,V=Ae.length;L<V;){var H=Ae.charCodeAt(L++);if(H>=55296&&H<=56319&&L<V){var te=Ae.charCodeAt(L++);(te&64512)==56320?U.push(((H&1023)<<10)+(te&1023)+65536):(U.push(H),L--)}else U.push(H)}return U}var Zt=function(U){return String.fromCodePoint.apply(String,S(U))},nt=function(U){return U-48<10?U-22:U-65<26?U-65:U-97<26?U-97:T},tt=function(U,L){return U+22+75*(U<26)-((L!=0)<<5)},ce=function(U,L,V){var H=0;for(U=V?le(U/F):U>>1,U+=le(U/L);U>ot*z>>1;H+=T)U=le(U/ot);return le(H+(ot+1)*U/(U+D))},_e=function(U){var L=[],V=U.length,H=0,te=q,he=$,Te=U.lastIndexOf(J);Te<0&&(Te=0);for(var Se=0;Se<Te;++Se)U.charCodeAt(Se)>=128&&Y("not-basic"),L.push(U.charCodeAt(Se));for(var ye=Te>0?Te+1:0;ye<V;){for(var Ce=H,qe=1,at=T;;at+=T){ye>=V&&Y("invalid-input");var Le=nt(U.charCodeAt(ye++));(Le>=T||Le>le((E-H)/qe))&&Y("overflow"),H+=Le*qe;var It=at<=he?A:at>=he+z?z:at-he;if(Le<It)break;var Pt=T-It;qe>le(E/Pt)&&Y("overflow"),qe*=Pt}var bt=L.length+1;he=ce(H-Ce,bt,Ce==0),le(H/bt)>E-te&&Y("overflow"),te+=le(H/bt),H%=bt,L.splice(H++,0,te)}return String.fromCodePoint.apply(String,L)},ze=function(U){var L=[];U=dt(U);var V=U.length,H=q,te=0,he=$,Te=!0,Se=!1,ye=void 0;try{for(var Ce=U[Symbol.iterator](),qe;!(Te=(qe=Ce.next()).done);Te=!0){var at=qe.value;at<128&&L.push(Ne(at))}}catch(Hn){Se=!0,ye=Hn}finally{try{!Te&&Ce.return&&Ce.return()}finally{if(Se)throw ye}}var Le=L.length,It=Le;for(Le&&L.push(J);It<V;){var Pt=E,bt=!0,Xt=!1,Yt=void 0;try{for(var mr=U[Symbol.iterator](),or;!(bt=(or=mr.next()).done);bt=!0){var fr=or.value;fr>=H&&fr<Pt&&(Pt=fr)}}catch(Hn){Xt=!0,Yt=Hn}finally{try{!bt&&mr.return&&mr.return()}finally{if(Xt)throw Yt}}var dr=It+1;Pt-H>le((E-te)/dr)&&Y("overflow"),te+=(Pt-H)*dr,H=Pt;var Er=!0,Qr=!1,Dr=void 0;try{for(var di=U[Symbol.iterator](),Zn;!(Er=(Zn=di.next()).done);Er=!0){var cs=Zn.value;if(cs<H&&++te>E&&Y("overflow"),cs==H){for(var Or=te,us=T;;us+=T){var hs=us<=he?A:us>=he+z?z:us-he;if(Or<hs)break;var ya=Or-hs,va=T-hs;L.push(Ne(tt(hs+ya%va,0))),Or=le(ya/va)}L.push(Ne(tt(Or,0))),he=ce(te,dr,It==Le),te=0,++It}}}catch(Hn){Qr=!0,Dr=Hn}finally{try{!Er&&di.return&&di.return()}finally{if(Qr)throw Dr}}++te,++H}return L.join("")},re=function(U){return pt(U,function(L){return G.test(L)?_e(L.slice(4).toLowerCase()):L})},ue=function(U){return pt(U,function(L){return oe.test(L)?"xn--"+ze(L):L})},Xe={version:"2.1.0",ucs2:{decode:dt,encode:Zt},decode:_e,encode:ze,toASCII:ue,toUnicode:re},wt={};function mt(Ae){var U=Ae.charCodeAt(0),L=void 0;return U<16?L="%0"+U.toString(16).toUpperCase():U<128?L="%"+U.toString(16).toUpperCase():U<2048?L="%"+(U>>6|192).toString(16).toUpperCase()+"%"+(U&63|128).toString(16).toUpperCase():L="%"+(U>>12|224).toString(16).toUpperCase()+"%"+(U>>6&63|128).toString(16).toUpperCase()+"%"+(U&63|128).toString(16).toUpperCase(),L}function Ke(Ae){for(var U="",L=0,V=Ae.length;L<V;){var H=parseInt(Ae.substr(L+1,2),16);if(H<128)U+=String.fromCharCode(H),L+=3;else if(H>=194&&H<224){if(V-L>=6){var te=parseInt(Ae.substr(L+4,2),16);U+=String.fromCharCode((H&31)<<6|te&63)}else U+=Ae.substr(L,6);L+=6}else if(H>=224){if(V-L>=9){var he=parseInt(Ae.substr(L+4,2),16),Te=parseInt(Ae.substr(L+7,2),16);U+=String.fromCharCode((H&15)<<12|(he&63)<<6|Te&63)}else U+=Ae.substr(L,9);L+=9}else U+=Ae.substr(L,3),L+=3}return U}function Ot(Ae,U){function L(V){var H=Ke(V);return H.match(U.UNRESERVED)?H:V}return Ae.scheme&&(Ae.scheme=String(Ae.scheme).replace(U.PCT_ENCODED,L).toLowerCase().replace(U.NOT_SCHEME,"")),Ae.userinfo!==void 0&&(Ae.userinfo=String(Ae.userinfo).replace(U.PCT_ENCODED,L).replace(U.NOT_USERINFO,mt).replace(U.PCT_ENCODED,f)),Ae.host!==void 0&&(Ae.host=String(Ae.host).replace(U.PCT_ENCODED,L).toLowerCase().replace(U.NOT_HOST,mt).replace(U.PCT_ENCODED,f)),Ae.path!==void 0&&(Ae.path=String(Ae.path).replace(U.PCT_ENCODED,L).replace(Ae.scheme?U.NOT_PATH:U.NOT_PATH_NOSCHEME,mt).replace(U.PCT_ENCODED,f)),Ae.query!==void 0&&(Ae.query=String(Ae.query).replace(U.PCT_ENCODED,L).replace(U.NOT_QUERY,mt).replace(U.PCT_ENCODED,f)),Ae.fragment!==void 0&&(Ae.fragment=String(Ae.fragment).replace(U.PCT_ENCODED,L).replace(U.NOT_FRAGMENT,mt).replace(U.PCT_ENCODED,f)),Ae}function er(Ae){return Ae.replace(/^0*(.*)/,"$1")||"0"}function Lr(Ae,U){var L=Ae.match(U.IPV4ADDRESS)||[],V=x(L,2),H=V[1];return H?H.split(".").map(er).join("."):Ae}function Fr(Ae,U){var L=Ae.match(U.IPV6ADDRESS)||[],V=x(L,3),H=V[1],te=V[2];if(H){for(var he=H.toLowerCase().split("::").reverse(),Te=x(he,2),Se=Te[0],ye=Te[1],Ce=ye?ye.split(":").map(er):[],qe=Se.split(":").map(er),at=U.IPV4ADDRESS.test(qe[qe.length-1]),Le=at?7:8,It=qe.length-Le,Pt=Array(Le),bt=0;bt<Le;++bt)Pt[bt]=Ce[bt]||qe[It+bt]||"";at&&(Pt[Le-1]=Lr(Pt[Le-1],U));var Xt=Pt.reduce(function(dr,Er,Qr){if(!Er||Er==="0"){var Dr=dr[dr.length-1];Dr&&Dr.index+Dr.length===Qr?Dr.length++:dr.push({index:Qr,length:1})}return dr},[]),Yt=Xt.sort(function(dr,Er){return Er.length-dr.length})[0],mr=void 0;if(Yt&&Yt.length>1){var or=Pt.slice(0,Yt.index),fr=Pt.slice(Yt.index+Yt.length);mr=or.join(":")+"::"+fr.join(":")}else mr=Pt.join(":");return te&&(mr+="%"+te),mr}else return Ae}var K=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,ct="".match(/(){0}/)[1]===void 0;function et(Ae){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L={},V=U.iri!==!1?k:b;U.reference==="suffix"&&(Ae=(U.scheme?U.scheme+":":"")+"//"+Ae);var H=Ae.match(K);if(H){ct?(L.scheme=H[1],L.userinfo=H[3],L.host=H[4],L.port=parseInt(H[5],10),L.path=H[6]||"",L.query=H[7],L.fragment=H[8],isNaN(L.port)&&(L.port=H[5])):(L.scheme=H[1]||void 0,L.userinfo=Ae.indexOf("@")!==-1?H[3]:void 0,L.host=Ae.indexOf("//")!==-1?H[4]:void 0,L.port=parseInt(H[5],10),L.path=H[6]||"",L.query=Ae.indexOf("?")!==-1?H[7]:void 0,L.fragment=Ae.indexOf("#")!==-1?H[8]:void 0,isNaN(L.port)&&(L.port=Ae.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?H[4]:void 0)),L.host&&(L.host=Fr(Lr(L.host,V),V)),L.scheme===void 0&&L.userinfo===void 0&&L.host===void 0&&L.port===void 0&&!L.path&&L.query===void 0?L.reference="same-document":L.scheme===void 0?L.reference="relative":L.fragment===void 0?L.reference="absolute":L.reference="uri",U.reference&&U.reference!=="suffix"&&U.reference!==L.reference&&(L.error=L.error||"URI is not a "+U.reference+" reference.");var te=wt[(U.scheme||L.scheme||"").toLowerCase()];if(!U.unicodeSupport&&(!te||!te.unicodeSupport)){if(L.host&&(U.domainHost||te&&te.domainHost))try{L.host=Xe.toASCII(L.host.replace(V.PCT_ENCODED,Ke).toLowerCase())}catch(he){L.error=L.error||"Host's domain name can not be converted to ASCII via punycode: "+he}Ot(L,b)}else Ot(L,V);te&&te.parse&&te.parse(L,U)}else L.error=L.error||"URI can not be parsed.";return L}function be(Ae,U){var L=U.iri!==!1?k:b,V=[];return Ae.userinfo!==void 0&&(V.push(Ae.userinfo),V.push("@")),Ae.host!==void 0&&V.push(Fr(Lr(String(Ae.host),L),L).replace(L.IPV6ADDRESS,function(H,te,he){return"["+te+(he?"%25"+he:"")+"]"})),(typeof Ae.port=="number"||typeof Ae.port=="string")&&(V.push(":"),V.push(String(Ae.port))),V.length?V.join(""):void 0}var me=/^\.\.?\//,Ie=/^\/\.(\/|$)/,ft=/^\/\.\.(\/|$)/,gt=/^\/?(?:.|\n)*?(?=\/|$)/;function je(Ae){for(var U=[];Ae.length;)if(Ae.match(me))Ae=Ae.replace(me,"");else if(Ae.match(Ie))Ae=Ae.replace(Ie,"/");else if(Ae.match(ft))Ae=Ae.replace(ft,"/"),U.pop();else if(Ae==="."||Ae==="..")Ae="";else{var L=Ae.match(gt);if(L){var V=L[0];Ae=Ae.slice(V.length),U.push(V)}else throw new Error("Unexpected dot segment condition")}return U.join("")}function vt(Ae){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=U.iri?k:b,V=[],H=wt[(U.scheme||Ae.scheme||"").toLowerCase()];if(H&&H.serialize&&H.serialize(Ae,U),Ae.host&&!L.IPV6ADDRESS.test(Ae.host)){if(U.domainHost||H&&H.domainHost)try{Ae.host=U.iri?Xe.toUnicode(Ae.host):Xe.toASCII(Ae.host.replace(L.PCT_ENCODED,Ke).toLowerCase())}catch(Te){Ae.error=Ae.error||"Host's domain name can not be converted to "+(U.iri?"Unicode":"ASCII")+" via punycode: "+Te}}Ot(Ae,L),U.reference!=="suffix"&&Ae.scheme&&(V.push(Ae.scheme),V.push(":"));var te=be(Ae,U);if(te!==void 0&&(U.reference!=="suffix"&&V.push("//"),V.push(te),Ae.path&&Ae.path.charAt(0)!=="/"&&V.push("/")),Ae.path!==void 0){var he=Ae.path;!U.absolutePath&&(!H||!H.absolutePath)&&(he=je(he)),te===void 0&&(he=he.replace(/^\/\//,"/%2F")),V.push(he)}return Ae.query!==void 0&&(V.push("?"),V.push(Ae.query)),Ae.fragment!==void 0&&(V.push("#"),V.push(Ae.fragment)),V.join("")}function Bt(Ae,U){var L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},V=arguments[3],H={};return V||(Ae=et(vt(Ae,L),L),U=et(vt(U,L),L)),L=L||{},!L.tolerant&&U.scheme?(H.scheme=U.scheme,H.userinfo=U.userinfo,H.host=U.host,H.port=U.port,H.path=je(U.path||""),H.query=U.query):(U.userinfo!==void 0||U.host!==void 0||U.port!==void 0?(H.userinfo=U.userinfo,H.host=U.host,H.port=U.port,H.path=je(U.path||""),H.query=U.query):(U.path?(U.path.charAt(0)==="/"?H.path=je(U.path):((Ae.userinfo!==void 0||Ae.host!==void 0||Ae.port!==void 0)&&!Ae.path?H.path="/"+U.path:Ae.path?H.path=Ae.path.slice(0,Ae.path.lastIndexOf("/")+1)+U.path:H.path=U.path,H.path=je(H.path)),H.query=U.query):(H.path=Ae.path,U.query!==void 0?H.query=U.query:H.query=Ae.query),H.userinfo=Ae.userinfo,H.host=Ae.host,H.port=Ae.port),H.scheme=Ae.scheme),H.fragment=U.fragment,H}function Et(Ae,U,L){var V=d({scheme:"null"},L);return vt(Bt(et(Ae,V),et(U,V),V,!0),V)}function Ht(Ae,U){return typeof Ae=="string"?Ae=vt(et(Ae,U),U):h(Ae)==="object"&&(Ae=et(vt(Ae,U),U)),Ae}function wr(Ae,U,L){return typeof Ae=="string"?Ae=vt(et(Ae,L),L):h(Ae)==="object"&&(Ae=vt(Ae,L)),typeof U=="string"?U=vt(et(U,L),L):h(U)==="object"&&(U=vt(U,L)),Ae===U}function Fe(Ae,U){return Ae&&Ae.toString().replace(!U||!U.iri?b.ESCAPE:k.ESCAPE,mt)}function _t(Ae,U){return Ae&&Ae.toString().replace(!U||!U.iri?b.PCT_ENCODED:k.PCT_ENCODED,Ke)}var gi={scheme:"http",domainHost:!0,parse:function(U,L){return U.host||(U.error=U.error||"HTTP URIs must have a host."),U},serialize:function(U,L){var V=String(U.scheme).toLowerCase()==="https";return(U.port===(V?443:80)||U.port==="")&&(U.port=void 0),U.path||(U.path="/"),U}},ri={scheme:"https",domainHost:gi.domainHost,parse:gi.parse,serialize:gi.serialize};function yr(Ae){return typeof Ae.secure=="boolean"?Ae.secure:String(Ae.scheme).toLowerCase()==="wss"}var kr={scheme:"ws",domainHost:!0,parse:function(U,L){var V=U;return V.secure=yr(V),V.resourceName=(V.path||"/")+(V.query?"?"+V.query:""),V.path=void 0,V.query=void 0,V},serialize:function(U,L){if((U.port===(yr(U)?443:80)||U.port==="")&&(U.port=void 0),typeof U.secure=="boolean"&&(U.scheme=U.secure?"wss":"ws",U.secure=void 0),U.resourceName){var V=U.resourceName.split("?"),H=x(V,2),te=H[0],he=H[1];U.path=te&&te!=="/"?te:void 0,U.query=he,U.resourceName=void 0}return U.fragment=void 0,U}},_i={scheme:"wss",domainHost:kr.domainHost,parse:kr.parse,serialize:kr.serialize},ki={},yi="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Tt="[0-9A-Fa-f]",pr=c(c("%[EFef]"+Tt+"%"+Tt+Tt+"%"+Tt+Tt)+"|"+c("%[89A-Fa-f]"+Tt+"%"+Tt+Tt)+"|"+c("%"+Tt+Tt)),hr="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",vi="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",sn=o(vi,'[\\"\\\\]'),ar="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",$i=new RegExp(yi,"g"),ii=new RegExp(pr,"g"),ls=new RegExp(o("[^]",hr,"[\\.]",'[\\"]',sn),"g"),hi=new RegExp(o("[^]",yi,ar),"g"),Li=hi;function Rr(Ae){var U=Ke(Ae);return U.match($i)?U:Ae}var jn={scheme:"mailto",parse:function(U,L){var V=U,H=V.to=V.path?V.path.split(","):[];if(V.path=void 0,V.query){for(var te=!1,he={},Te=V.query.split("&"),Se=0,ye=Te.length;Se<ye;++Se){var Ce=Te[Se].split("=");switch(Ce[0]){case"to":for(var qe=Ce[1].split(","),at=0,Le=qe.length;at<Le;++at)H.push(qe[at]);break;case"subject":V.subject=_t(Ce[1],L);break;case"body":V.body=_t(Ce[1],L);break;default:te=!0,he[_t(Ce[0],L)]=_t(Ce[1],L);break}}te&&(V.headers=he)}V.query=void 0;for(var It=0,Pt=H.length;It<Pt;++It){var bt=H[It].split("@");if(bt[0]=_t(bt[0]),L.unicodeSupport)bt[1]=_t(bt[1],L).toLowerCase();else try{bt[1]=Xe.toASCII(_t(bt[1],L).toLowerCase())}catch(Xt){V.error=V.error||"Email address's domain name can not be converted to ASCII via punycode: "+Xt}H[It]=bt.join("@")}return V},serialize:function(U,L){var V=U,H=i(U.to);if(H){for(var te=0,he=H.length;te<he;++te){var Te=String(H[te]),Se=Te.lastIndexOf("@"),ye=Te.slice(0,Se).replace(ii,Rr).replace(ii,f).replace(ls,mt),Ce=Te.slice(Se+1);try{Ce=L.iri?Xe.toUnicode(Ce):Xe.toASCII(_t(Ce,L).toLowerCase())}catch(It){V.error=V.error||"Email address's domain name can not be converted to "+(L.iri?"Unicode":"ASCII")+" via punycode: "+It}H[te]=ye+"@"+Ce}V.path=H.join(",")}var qe=U.headers=U.headers||{};U.subject&&(qe.subject=U.subject),U.body&&(qe.body=U.body);var at=[];for(var Le in qe)qe[Le]!==ki[Le]&&at.push(Le.replace(ii,Rr).replace(ii,f).replace(hi,mt)+"="+qe[Le].replace(ii,Rr).replace(ii,f).replace(Li,mt));return at.length&&(V.query=at.join("&")),V}},_n=/^([^\:]+)\:(.*)/,zn={scheme:"urn",parse:function(U,L){var V=U.path&&U.path.match(_n),H=U;if(V){var te=L.scheme||H.scheme||"urn",he=V[1].toLowerCase(),Te=V[2],Se=te+":"+(L.nid||he),ye=wt[Se];H.nid=he,H.nss=Te,H.path=void 0,ye&&(H=ye.parse(H,L))}else H.error=H.error||"URN can not be parsed.";return H},serialize:function(U,L){var V=L.scheme||U.scheme||"urn",H=U.nid,te=V+":"+(L.nid||H),he=wt[te];he&&(U=he.serialize(U,L));var Te=U,Se=U.nss;return Te.path=(H||L.nid)+":"+Se,Te}},qn=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Gn={scheme:"urn:uuid",parse:function(U,L){var V=U;return V.uuid=V.nss,V.nss=void 0,!L.tolerant&&(!V.uuid||!V.uuid.match(qn))&&(V.error=V.error||"UUID is not valid."),V},serialize:function(U,L){var V=U;return V.nss=(U.uuid||"").toLowerCase(),V}};wt[gi.scheme]=gi,wt[ri.scheme]=ri,wt[kr.scheme]=kr,wt[_i.scheme]=_i,wt[jn.scheme]=jn,wt[zn.scheme]=zn,wt[Gn.scheme]=Gn,a.SCHEMES=wt,a.pctEncChar=mt,a.pctDecChars=Ke,a.parse=et,a.removeDotSegments=je,a.serialize=vt,a.resolveComponents=Bt,a.resolve=Et,a.normalize=Ht,a.equal=wr,a.escapeComponent=Fe,a.unescapeComponent=_t,Object.defineProperty(a,"__esModule",{value:!0})})})(wd,wd.exports);var A5=wd.exports;Object.defineProperty(qd,"__esModule",{value:!0});const Q1=A5;Q1.code='require("ajv/dist/runtime/uri").default';qd.default=Q1;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.CodeGen=s.Name=s.nil=s.stringify=s.str=s._=s.KeywordCxt=void 0;var e=as;Object.defineProperty(s,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var a=zr;Object.defineProperty(s,"_",{enumerable:!0,get:function(){return a._}}),Object.defineProperty(s,"str",{enumerable:!0,get:function(){return a.str}}),Object.defineProperty(s,"stringify",{enumerable:!0,get:function(){return a.stringify}}),Object.defineProperty(s,"nil",{enumerable:!0,get:function(){return a.nil}}),Object.defineProperty(s,"Name",{enumerable:!0,get:function(){return a.Name}}),Object.defineProperty(s,"CodeGen",{enumerable:!0,get:function(){return a.CodeGen}});const o=Sc,c=kc,h=ro,f=Sn,i=zr,d=Ji,g=wc,b=Zr,k=I5,x=qd,S=(tt,ce)=>new RegExp(tt,ce);S.code="new RegExp";const E=["removeAdditional","useDefaults","coerceTypes"],T=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),A={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},z={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},D=200;function F(tt){var ce,_e,ze,re,ue,Xe,wt,mt,Ke,Ot,er,Lr,Fr,K,ct,et,be,me,Ie,ft,gt,je,vt,Bt,Et;const Ht=tt.strict,wr=(ce=tt.code)===null||ce===void 0?void 0:ce.optimize,Fe=wr===!0||wr===void 0?1:wr||0,_t=(ze=(_e=tt.code)===null||_e===void 0?void 0:_e.regExp)!==null&&ze!==void 0?ze:S,gi=(re=tt.uriResolver)!==null&&re!==void 0?re:x.default;return{strictSchema:(Xe=(ue=tt.strictSchema)!==null&&ue!==void 0?ue:Ht)!==null&&Xe!==void 0?Xe:!0,strictNumbers:(mt=(wt=tt.strictNumbers)!==null&&wt!==void 0?wt:Ht)!==null&&mt!==void 0?mt:!0,strictTypes:(Ot=(Ke=tt.strictTypes)!==null&&Ke!==void 0?Ke:Ht)!==null&&Ot!==void 0?Ot:"log",strictTuples:(Lr=(er=tt.strictTuples)!==null&&er!==void 0?er:Ht)!==null&&Lr!==void 0?Lr:"log",strictRequired:(K=(Fr=tt.strictRequired)!==null&&Fr!==void 0?Fr:Ht)!==null&&K!==void 0?K:!1,code:tt.code?{...tt.code,optimize:Fe,regExp:_t}:{optimize:Fe,regExp:_t},loopRequired:(ct=tt.loopRequired)!==null&&ct!==void 0?ct:D,loopEnum:(et=tt.loopEnum)!==null&&et!==void 0?et:D,meta:(be=tt.meta)!==null&&be!==void 0?be:!0,messages:(me=tt.messages)!==null&&me!==void 0?me:!0,inlineRefs:(Ie=tt.inlineRefs)!==null&&Ie!==void 0?Ie:!0,schemaId:(ft=tt.schemaId)!==null&&ft!==void 0?ft:"$id",addUsedSchema:(gt=tt.addUsedSchema)!==null&&gt!==void 0?gt:!0,validateSchema:(je=tt.validateSchema)!==null&&je!==void 0?je:!0,validateFormats:(vt=tt.validateFormats)!==null&&vt!==void 0?vt:!0,unicodeRegExp:(Bt=tt.unicodeRegExp)!==null&&Bt!==void 0?Bt:!0,int32range:(Et=tt.int32range)!==null&&Et!==void 0?Et:!0,uriResolver:gi}}class ${constructor(ce={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,ce=this.opts={...ce,...F(ce)};const{es5:_e,lines:ze}=this.opts.code;this.scope=new i.ValueScope({scope:{},prefixes:T,es5:_e,lines:ze}),this.logger=le(ce.logger);const re=ce.validateFormats;ce.validateFormats=!1,this.RULES=(0,h.getRules)(),q.call(this,A,ce,"NOT SUPPORTED"),q.call(this,z,ce,"DEPRECATED","warn"),this._metaOpts=Ee.call(this),ce.formats&&oe.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),ce.keywords&&de.call(this,ce.keywords),typeof ce.meta=="object"&&this.addMetaSchema(ce.meta),G.call(this),ce.validateFormats=re}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:ce,meta:_e,schemaId:ze}=this.opts;let re=k;ze==="id"&&(re={...k},re.id=re.$id,delete re.$id),_e&&ce&&this.addMetaSchema(re,re[ze],!1)}defaultMeta(){const{meta:ce,schemaId:_e}=this.opts;return this.opts.defaultMeta=typeof ce=="object"?ce[_e]||ce:void 0}validate(ce,_e){let ze;if(typeof ce=="string"){if(ze=this.getSchema(ce),!ze)throw new Error(`no schema with key or ref "${ce}"`)}else ze=this.compile(ce);const re=ze(_e);return"$async"in ze||(this.errors=ze.errors),re}compile(ce,_e){const ze=this._addSchema(ce,_e);return ze.validate||this._compileSchemaEnv(ze)}compileAsync(ce,_e){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:ze}=this.opts;return re.call(this,ce,_e);async function re(Ot,er){await ue.call(this,Ot.$schema);const Lr=this._addSchema(Ot,er);return Lr.validate||Xe.call(this,Lr)}async function ue(Ot){Ot&&!this.getSchema(Ot)&&await re.call(this,{$ref:Ot},!0)}async function Xe(Ot){try{return this._compileSchemaEnv(Ot)}catch(er){if(!(er instanceof c.default))throw er;return wt.call(this,er),await mt.call(this,er.missingSchema),Xe.call(this,Ot)}}function wt({missingSchema:Ot,missingRef:er}){if(this.refs[Ot])throw new Error(`AnySchema ${Ot} is loaded but ${er} cannot be resolved`)}async function mt(Ot){const er=await Ke.call(this,Ot);this.refs[Ot]||await ue.call(this,er.$schema),this.refs[Ot]||this.addSchema(er,Ot,_e)}async function Ke(Ot){const er=this._loading[Ot];if(er)return er;try{return await(this._loading[Ot]=ze(Ot))}finally{delete this._loading[Ot]}}}addSchema(ce,_e,ze,re=this.opts.validateSchema){if(Array.isArray(ce)){for(const Xe of ce)this.addSchema(Xe,void 0,ze,re);return this}let ue;if(typeof ce=="object"){const{schemaId:Xe}=this.opts;if(ue=ce[Xe],ue!==void 0&&typeof ue!="string")throw new Error(`schema ${Xe} must be string`)}return _e=(0,d.normalizeId)(_e||ue),this._checkUnique(_e),this.schemas[_e]=this._addSchema(ce,ze,_e,re,!0),this}addMetaSchema(ce,_e,ze=this.opts.validateSchema){return this.addSchema(ce,_e,!0,ze),this}validateSchema(ce,_e){if(typeof ce=="boolean")return!0;let ze;if(ze=ce.$schema,ze!==void 0&&typeof ze!="string")throw new Error("$schema must be a string");if(ze=ze||this.opts.defaultMeta||this.defaultMeta(),!ze)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const re=this.validate(ze,ce);if(!re&&_e){const ue="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(ue);else throw new Error(ue)}return re}getSchema(ce){let _e;for(;typeof(_e=J.call(this,ce))=="string";)ce=_e;if(_e===void 0){const{schemaId:ze}=this.opts,re=new f.SchemaEnv({schema:{},schemaId:ze});if(_e=f.resolveSchema.call(this,re,ce),!_e)return;this.refs[ce]=_e}return _e.validate||this._compileSchemaEnv(_e)}removeSchema(ce){if(ce instanceof RegExp)return this._removeAllSchemas(this.schemas,ce),this._removeAllSchemas(this.refs,ce),this;switch(typeof ce){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const _e=J.call(this,ce);return typeof _e=="object"&&this._cache.delete(_e.schema),delete this.schemas[ce],delete this.refs[ce],this}case"object":{const _e=ce;this._cache.delete(_e);let ze=ce[this.opts.schemaId];return ze&&(ze=(0,d.normalizeId)(ze),delete this.schemas[ze],delete this.refs[ze]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(ce){for(const _e of ce)this.addKeyword(_e);return this}addKeyword(ce,_e){let ze;if(typeof ce=="string")ze=ce,typeof _e=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),_e.keyword=ze);else if(typeof ce=="object"&&_e===void 0){if(_e=ce,ze=_e.keyword,Array.isArray(ze)&&!ze.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Y.call(this,ze,_e),!_e)return(0,b.eachItem)(ze,ue=>Qe.call(this,ue)),this;dt.call(this,_e);const re={..._e,type:(0,g.getJSONTypes)(_e.type),schemaType:(0,g.getJSONTypes)(_e.schemaType)};return(0,b.eachItem)(ze,re.type.length===0?ue=>Qe.call(this,ue,re):ue=>re.type.forEach(Xe=>Qe.call(this,ue,re,Xe))),this}getKeyword(ce){const _e=this.RULES.all[ce];return typeof _e=="object"?_e.definition:!!_e}removeKeyword(ce){const{RULES:_e}=this;delete _e.keywords[ce],delete _e.all[ce];for(const ze of _e.rules){const re=ze.rules.findIndex(ue=>ue.keyword===ce);re>=0&&ze.rules.splice(re,1)}return this}addFormat(ce,_e){return typeof _e=="string"&&(_e=new RegExp(_e)),this.formats[ce]=_e,this}errorsText(ce=this.errors,{separator:_e=", ",dataVar:ze="data"}={}){return!ce||ce.length===0?"No errors":ce.map(re=>`${ze}${re.instancePath} ${re.message}`).reduce((re,ue)=>re+_e+ue)}$dataMetaSchema(ce,_e){const ze=this.RULES.all;ce=JSON.parse(JSON.stringify(ce));for(const re of _e){const ue=re.split("/").slice(1);let Xe=ce;for(const wt of ue)Xe=Xe[wt];for(const wt in ze){const mt=ze[wt];if(typeof mt!="object")continue;const{$data:Ke}=mt.definition,Ot=Xe[wt];Ke&&Ot&&(Xe[wt]=nt(Ot))}}return ce}_removeAllSchemas(ce,_e){for(const ze in ce){const re=ce[ze];(!_e||_e.test(ze))&&(typeof re=="string"?delete ce[ze]:re&&!re.meta&&(this._cache.delete(re.schema),delete ce[ze]))}}_addSchema(ce,_e,ze,re=this.opts.validateSchema,ue=this.opts.addUsedSchema){let Xe;const{schemaId:wt}=this.opts;if(typeof ce=="object")Xe=ce[wt];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof ce!="boolean")throw new Error("schema must be object or boolean")}let mt=this._cache.get(ce);if(mt!==void 0)return mt;ze=(0,d.normalizeId)(Xe||ze);const Ke=d.getSchemaRefs.call(this,ce,ze);return mt=new f.SchemaEnv({schema:ce,schemaId:wt,meta:_e,baseId:ze,localRefs:Ke}),this._cache.set(mt.schema,mt),ue&&!ze.startsWith("#")&&(ze&&this._checkUnique(ze),this.refs[ze]=mt),re&&this.validateSchema(ce,!0),mt}_checkUnique(ce){if(this.schemas[ce]||this.refs[ce])throw new Error(`schema with key or id "${ce}" already exists`)}_compileSchemaEnv(ce){if(ce.meta?this._compileMetaSchema(ce):f.compileSchema.call(this,ce),!ce.validate)throw new Error("ajv implementation error");return ce.validate}_compileMetaSchema(ce){const _e=this.opts;this.opts=this._metaOpts;try{f.compileSchema.call(this,ce)}finally{this.opts=_e}}}s.default=$,$.ValidationError=o.default,$.MissingRefError=c.default;function q(tt,ce,_e,ze="error"){for(const re in tt){const ue=re;ue in ce&&this.logger[ze](`${_e}: option ${re}. ${tt[ue]}`)}}function J(tt){return tt=(0,d.normalizeId)(tt),this.schemas[tt]||this.refs[tt]}function G(){const tt=this.opts.schemas;if(tt)if(Array.isArray(tt))this.addSchema(tt);else for(const ce in tt)this.addSchema(tt[ce],ce)}function oe(){for(const tt in this.opts.formats){const ce=this.opts.formats[tt];ce&&this.addFormat(tt,ce)}}function de(tt){if(Array.isArray(tt)){this.addVocabulary(tt);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const ce in tt){const _e=tt[ce];_e.keyword||(_e.keyword=ce),this.addKeyword(_e)}}function Ee(){const tt={...this.opts};for(const ce of E)delete tt[ce];return tt}const ot={log(){},warn(){},error(){}};function le(tt){if(tt===!1)return ot;if(tt===void 0)return console;if(tt.log&&tt.warn&&tt.error)return tt;throw new Error("logger must implement log, warn and error methods")}const Ne=/^[a-z_$][a-z0-9_$:-]*$/i;function Y(tt,ce){const{RULES:_e}=this;if((0,b.eachItem)(tt,ze=>{if(_e.keywords[ze])throw new Error(`Keyword ${ze} is already defined`);if(!Ne.test(ze))throw new Error(`Keyword ${ze} has invalid name`)}),!!ce&&ce.$data&&!("code"in ce||"validate"in ce))throw new Error('$data keyword must have "code" or "validate" function')}function Qe(tt,ce,_e){var ze;const re=ce==null?void 0:ce.post;if(_e&&re)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:ue}=this;let Xe=re?ue.post:ue.rules.find(({type:mt})=>mt===_e);if(Xe||(Xe={type:_e,rules:[]},ue.rules.push(Xe)),ue.keywords[tt]=!0,!ce)return;const wt={keyword:tt,definition:{...ce,type:(0,g.getJSONTypes)(ce.type),schemaType:(0,g.getJSONTypes)(ce.schemaType)}};ce.before?pt.call(this,Xe,wt,ce.before):Xe.rules.push(wt),ue.all[tt]=wt,(ze=ce.implements)===null||ze===void 0||ze.forEach(mt=>this.addKeyword(mt))}function pt(tt,ce,_e){const ze=tt.rules.findIndex(re=>re.keyword===_e);ze>=0?tt.rules.splice(ze,0,ce):(tt.rules.push(ce),this.logger.warn(`rule ${_e} is not defined`))}function dt(tt){let{metaSchema:ce}=tt;ce!==void 0&&(tt.$data&&this.opts.$data&&(ce=nt(ce)),tt.validateSchema=this.compile(ce,!0))}const Zt={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function nt(tt){return{anyOf:[tt,Zt]}}})(I1);var Gd={},Zd={},Hd={};Object.defineProperty(Hd,"__esModule",{value:!0});const P5={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Hd.default=P5;var io={};Object.defineProperty(io,"__esModule",{value:!0});io.callRef=io.getValidate=void 0;const M5=kc,ny=Mr,wn=zr,No=ks,sy=Sn,Ou=Zr,z5={keyword:"$ref",schemaType:"string",code(s){const{gen:e,schema:a,it:o}=s,{baseId:c,schemaEnv:h,validateName:f,opts:i,self:d}=o,{root:g}=h;if((a==="#"||a==="#/")&&c===g.baseId)return k();const b=sy.resolveRef.call(d,g,c,a);if(b===void 0)throw new M5.default(o.opts.uriResolver,c,a);if(b instanceof sy.SchemaEnv)return x(b);return S(b);function k(){if(h===g)return Zu(s,f,h,h.$async);const E=e.scopeValue("root",{ref:g});return Zu(s,(0,wn._)`${E}.validate`,g,g.$async)}function x(E){const T=e0(s,E);Zu(s,T,E,E.$async)}function S(E){const T=e.scopeValue("schema",i.code.source===!0?{ref:E,code:(0,wn.stringify)(E)}:{ref:E}),A=e.name("valid"),z=s.subschema({schema:E,dataTypes:[],schemaPath:wn.nil,topSchemaRef:T,errSchemaPath:a},A);s.mergeEvaluated(z),s.ok(A)}}};function e0(s,e){const{gen:a}=s;return e.validate?a.scopeValue("validate",{ref:e.validate}):(0,wn._)`${a.scopeValue("wrapper",{ref:e})}.validate`}io.getValidate=e0;function Zu(s,e,a,o){const{gen:c,it:h}=s,{allErrors:f,schemaEnv:i,opts:d}=h,g=d.passContext?No.default.this:wn.nil;o?b():k();function b(){if(!i.$async)throw new Error("async schema referenced by sync schema");const E=c.let("valid");c.try(()=>{c.code((0,wn._)`await ${(0,ny.callValidateCode)(s,e,g)}`),S(e),f||c.assign(E,!0)},T=>{c.if((0,wn._)`!(${T} instanceof ${h.ValidationError})`,()=>c.throw(T)),x(T),f||c.assign(E,!1)}),s.ok(E)}function k(){s.result((0,ny.callValidateCode)(s,e,g),()=>S(e),()=>x(e))}function x(E){const T=(0,wn._)`${E}.errors`;c.assign(No.default.vErrors,(0,wn._)`${No.default.vErrors} === null ? ${T} : ${No.default.vErrors}.concat(${T})`),c.assign(No.default.errors,(0,wn._)`${No.default.vErrors}.length`)}function S(E){var T;if(!h.opts.unevaluated)return;const A=(T=a==null?void 0:a.validate)===null||T===void 0?void 0:T.evaluated;if(h.props!==!0)if(A&&!A.dynamicProps)A.props!==void 0&&(h.props=Ou.mergeEvaluated.props(c,A.props,h.props));else{const z=c.var("props",(0,wn._)`${E}.evaluated.props`);h.props=Ou.mergeEvaluated.props(c,z,h.props,wn.Name)}if(h.items!==!0)if(A&&!A.dynamicItems)A.items!==void 0&&(h.items=Ou.mergeEvaluated.items(c,A.items,h.items));else{const z=c.var("items",(0,wn._)`${E}.evaluated.items`);h.items=Ou.mergeEvaluated.items(c,z,h.items,wn.Name)}}}io.callRef=Zu;io.default=z5;Object.defineProperty(Zd,"__esModule",{value:!0});const D5=Hd,L5=io,R5=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",D5.default,L5.default];Zd.default=R5;var Wd={},Kd={};Object.defineProperty(Kd,"__esModule",{value:!0});const nh=zr,ha=nh.operators,sh={maximum:{okStr:"<=",ok:ha.LTE,fail:ha.GT},minimum:{okStr:">=",ok:ha.GTE,fail:ha.LT},exclusiveMaximum:{okStr:"<",ok:ha.LT,fail:ha.GTE},exclusiveMinimum:{okStr:">",ok:ha.GT,fail:ha.LTE}},O5={message:({keyword:s,schemaCode:e})=>(0,nh.str)`must be ${sh[s].okStr} ${e}`,params:({keyword:s,schemaCode:e})=>(0,nh._)`{comparison: ${sh[s].okStr}, limit: ${e}}`},B5={keyword:Object.keys(sh),type:"number",schemaType:"number",$data:!0,error:O5,code(s){const{keyword:e,data:a,schemaCode:o}=s;s.fail$data((0,nh._)`${a} ${sh[e].fail} ${o} || isNaN(${a})`)}};Kd.default=B5;var Xd={};Object.defineProperty(Xd,"__esModule",{value:!0});const ac=zr,N5={message:({schemaCode:s})=>(0,ac.str)`must be multiple of ${s}`,params:({schemaCode:s})=>(0,ac._)`{multipleOf: ${s}}`},F5={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:N5,code(s){const{gen:e,data:a,schemaCode:o,it:c}=s,h=c.opts.multipleOfPrecision,f=e.let("res"),i=h?(0,ac._)`Math.abs(Math.round(${f}) - ${f}) > 1e-${h}`:(0,ac._)`${f} !== parseInt(${f})`;s.fail$data((0,ac._)`(${o} === 0 || (${f} = ${a}/${o}, ${i}))`)}};Xd.default=F5;var Jd={},Yd={};Object.defineProperty(Yd,"__esModule",{value:!0});function t0(s){const e=s.length;let a=0,o=0,c;for(;o<e;)a++,c=s.charCodeAt(o++),c>=55296&&c<=56319&&o<e&&(c=s.charCodeAt(o),(c&64512)===56320&&o++);return a}Yd.default=t0;t0.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(Jd,"__esModule",{value:!0});const Ja=zr,U5=Zr,V5=Yd,$5={message({keyword:s,schemaCode:e}){const a=s==="maxLength"?"more":"fewer";return(0,Ja.str)`must NOT have ${a} than ${e} characters`},params:({schemaCode:s})=>(0,Ja._)`{limit: ${s}}`},j5={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:$5,code(s){const{keyword:e,data:a,schemaCode:o,it:c}=s,h=e==="maxLength"?Ja.operators.GT:Ja.operators.LT,f=c.opts.unicode===!1?(0,Ja._)`${a}.length`:(0,Ja._)`${(0,U5.useFunc)(s.gen,V5.default)}(${a})`;s.fail$data((0,Ja._)`${f} ${h} ${o}`)}};Jd.default=j5;var Qd={};Object.defineProperty(Qd,"__esModule",{value:!0});const q5=Mr,ah=zr,G5={message:({schemaCode:s})=>(0,ah.str)`must match pattern "${s}"`,params:({schemaCode:s})=>(0,ah._)`{pattern: ${s}}`},Z5={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:G5,code(s){const{data:e,$data:a,schema:o,schemaCode:c,it:h}=s,f=h.opts.unicodeRegExp?"u":"",i=a?(0,ah._)`(new RegExp(${c}, ${f}))`:(0,q5.usePattern)(s,o);s.fail$data((0,ah._)`!${i}.test(${e})`)}};Qd.default=Z5;var ep={};Object.defineProperty(ep,"__esModule",{value:!0});const oc=zr,H5={message({keyword:s,schemaCode:e}){const a=s==="maxProperties"?"more":"fewer";return(0,oc.str)`must NOT have ${a} than ${e} properties`},params:({schemaCode:s})=>(0,oc._)`{limit: ${s}}`},W5={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:H5,code(s){const{keyword:e,data:a,schemaCode:o}=s,c=e==="maxProperties"?oc.operators.GT:oc.operators.LT;s.fail$data((0,oc._)`Object.keys(${a}).length ${c} ${o}`)}};ep.default=W5;var tp={};Object.defineProperty(tp,"__esModule",{value:!0});const ec=Mr,lc=zr,K5=Zr,X5={message:({params:{missingProperty:s}})=>(0,lc.str)`must have required property '${s}'`,params:({params:{missingProperty:s}})=>(0,lc._)`{missingProperty: ${s}}`},J5={keyword:"required",type:"object",schemaType:"array",$data:!0,error:X5,code(s){const{gen:e,schema:a,schemaCode:o,data:c,$data:h,it:f}=s,{opts:i}=f;if(!h&&a.length===0)return;const d=a.length>=i.loopRequired;if(f.allErrors?g():b(),i.strictRequired){const S=s.parentSchema.properties,{definedProperties:E}=s.it;for(const T of a)if((S==null?void 0:S[T])===void 0&&!E.has(T)){const A=f.schemaEnv.baseId+f.errSchemaPath,z=`required property "${T}" is not defined at "${A}" (strictRequired)`;(0,K5.checkStrictMode)(f,z,f.opts.strictRequired)}}function g(){if(d||h)s.block$data(lc.nil,k);else for(const S of a)(0,ec.checkReportMissingProp)(s,S)}function b(){const S=e.let("missing");if(d||h){const E=e.let("valid",!0);s.block$data(E,()=>x(S,E)),s.ok(E)}else e.if((0,ec.checkMissingProp)(s,a,S)),(0,ec.reportMissingProp)(s,S),e.else()}function k(){e.forOf("prop",o,S=>{s.setParams({missingProperty:S}),e.if((0,ec.noPropertyInData)(e,c,S,i.ownProperties),()=>s.error())})}function x(S,E){s.setParams({missingProperty:S}),e.forOf(S,o,()=>{e.assign(E,(0,ec.propertyInData)(e,c,S,i.ownProperties)),e.if((0,lc.not)(E),()=>{s.error(),e.break()})},lc.nil)}}};tp.default=J5;var rp={};Object.defineProperty(rp,"__esModule",{value:!0});const cc=zr,Y5={message({keyword:s,schemaCode:e}){const a=s==="maxItems"?"more":"fewer";return(0,cc.str)`must NOT have ${a} than ${e} items`},params:({schemaCode:s})=>(0,cc._)`{limit: ${s}}`},Q5={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:Y5,code(s){const{keyword:e,data:a,schemaCode:o}=s,c=e==="maxItems"?cc.operators.GT:cc.operators.LT;s.fail$data((0,cc._)`${a}.length ${c} ${o}`)}};rp.default=Q5;var ip={},Ec={};Object.defineProperty(Ec,"__esModule",{value:!0});const r0=O1;r0.code='require("ajv/dist/runtime/equal").default';Ec.default=r0;Object.defineProperty(ip,"__esModule",{value:!0});const Vf=wc,Xi=zr,e3=Zr,t3=Ec,r3={message:({params:{i:s,j:e}})=>(0,Xi.str)`must NOT have duplicate items (items ## ${e} and ${s} are identical)`,params:({params:{i:s,j:e}})=>(0,Xi._)`{i: ${s}, j: ${e}}`},i3={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:r3,code(s){const{gen:e,data:a,$data:o,schema:c,parentSchema:h,schemaCode:f,it:i}=s;if(!o&&!c)return;const d=e.let("valid"),g=h.items?(0,Vf.getSchemaTypes)(h.items):[];s.block$data(d,b,(0,Xi._)`${f} === false`),s.ok(d);function b(){const E=e.let("i",(0,Xi._)`${a}.length`),T=e.let("j");s.setParams({i:E,j:T}),e.assign(d,!0),e.if((0,Xi._)`${E} > 1`,()=>(k()?x:S)(E,T))}function k(){return g.length>0&&!g.some(E=>E==="object"||E==="array")}function x(E,T){const A=e.name("item"),z=(0,Vf.checkDataTypes)(g,A,i.opts.strictNumbers,Vf.DataType.Wrong),D=e.const("indices",(0,Xi._)`{}`);e.for((0,Xi._)`;${E}--;`,()=>{e.let(A,(0,Xi._)`${a}[${E}]`),e.if(z,(0,Xi._)`continue`),g.length>1&&e.if((0,Xi._)`typeof ${A} == "string"`,(0,Xi._)`${A} += "_"`),e.if((0,Xi._)`typeof ${D}[${A}] == "number"`,()=>{e.assign(T,(0,Xi._)`${D}[${A}]`),s.error(),e.assign(d,!1).break()}).code((0,Xi._)`${D}[${A}] = ${E}`)})}function S(E,T){const A=(0,e3.useFunc)(e,t3.default),z=e.name("outer");e.label(z).for((0,Xi._)`;${E}--;`,()=>e.for((0,Xi._)`${T} = ${E}; ${T}--;`,()=>e.if((0,Xi._)`${A}(${a}[${E}], ${a}[${T}])`,()=>{s.error(),e.assign(d,!1).break(z)})))}}};ip.default=i3;var np={};Object.defineProperty(np,"__esModule",{value:!0});const Sd=zr,n3=Zr,s3=Ec,a3={message:"must be equal to constant",params:({schemaCode:s})=>(0,Sd._)`{allowedValue: ${s}}`},o3={keyword:"const",$data:!0,error:a3,code(s){const{gen:e,data:a,$data:o,schemaCode:c,schema:h}=s;o||h&&typeof h=="object"?s.fail$data((0,Sd._)`!${(0,n3.useFunc)(e,s3.default)}(${a}, ${c})`):s.fail((0,Sd._)`${h} !== ${a}`)}};np.default=o3;var sp={};Object.defineProperty(sp,"__esModule",{value:!0});const rc=zr,l3=Zr,c3=Ec,u3={message:"must be equal to one of the allowed values",params:({schemaCode:s})=>(0,rc._)`{allowedValues: ${s}}`},h3={keyword:"enum",schemaType:"array",$data:!0,error:u3,code(s){const{gen:e,data:a,$data:o,schema:c,schemaCode:h,it:f}=s;if(!o&&c.length===0)throw new Error("enum must have non-empty array");const i=c.length>=f.opts.loopEnum;let d;const g=()=>d??(d=(0,l3.useFunc)(e,c3.default));let b;if(i||o)b=e.let("valid"),s.block$data(b,k);else{if(!Array.isArray(c))throw new Error("ajv implementation error");const S=e.const("vSchema",h);b=(0,rc.or)(...c.map((E,T)=>x(S,T)))}s.pass(b);function k(){e.assign(b,!1),e.forOf("v",h,S=>e.if((0,rc._)`${g()}(${a}, ${S})`,()=>e.assign(b,!0).break()))}function x(S,E){const T=c[E];return typeof T=="object"&&T!==null?(0,rc._)`${g()}(${a}, ${S}[${E}])`:(0,rc._)`${a} === ${T}`}}};sp.default=h3;Object.defineProperty(Wd,"__esModule",{value:!0});const f3=Kd,d3=Xd,p3=Jd,m3=Qd,g3=ep,_3=tp,y3=rp,v3=ip,b3=np,x3=sp,w3=[f3.default,d3.default,p3.default,m3.default,g3.default,_3.default,y3.default,v3.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},b3.default,x3.default];Wd.default=w3;var ap={},Jo={};Object.defineProperty(Jo,"__esModule",{value:!0});Jo.validateAdditionalItems=void 0;const Ya=zr,kd=Zr,S3={message:({params:{len:s}})=>(0,Ya.str)`must NOT have more than ${s} items`,params:({params:{len:s}})=>(0,Ya._)`{limit: ${s}}`},k3={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:S3,code(s){const{parentSchema:e,it:a}=s,{items:o}=e;if(!Array.isArray(o)){(0,kd.checkStrictMode)(a,'"additionalItems" is ignored when "items" is not an array of schemas');return}i0(s,o)}};function i0(s,e){const{gen:a,schema:o,data:c,keyword:h,it:f}=s;f.items=!0;const i=a.const("len",(0,Ya._)`${c}.length`);if(o===!1)s.setParams({len:e.length}),s.pass((0,Ya._)`${i} <= ${e.length}`);else if(typeof o=="object"&&!(0,kd.alwaysValidSchema)(f,o)){const g=a.var("valid",(0,Ya._)`${i} <= ${e.length}`);a.if((0,Ya.not)(g),()=>d(g)),s.ok(g)}function d(g){a.forRange("i",e.length,i,b=>{s.subschema({keyword:h,dataProp:b,dataPropType:kd.Type.Num},g),f.allErrors||a.if((0,Ya.not)(g),()=>a.break())})}}Jo.validateAdditionalItems=i0;Jo.default=k3;var op={},Yo={};Object.defineProperty(Yo,"__esModule",{value:!0});Yo.validateTuple=void 0;const ay=zr,Hu=Zr,E3=Mr,T3={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(s){const{schema:e,it:a}=s;if(Array.isArray(e))return n0(s,"additionalItems",e);a.items=!0,!(0,Hu.alwaysValidSchema)(a,e)&&s.ok((0,E3.validateArray)(s))}};function n0(s,e,a=s.schema){const{gen:o,parentSchema:c,data:h,keyword:f,it:i}=s;b(c),i.opts.unevaluated&&a.length&&i.items!==!0&&(i.items=Hu.mergeEvaluated.items(o,a.length,i.items));const d=o.name("valid"),g=o.const("len",(0,ay._)`${h}.length`);a.forEach((k,x)=>{(0,Hu.alwaysValidSchema)(i,k)||(o.if((0,ay._)`${g} > ${x}`,()=>s.subschema({keyword:f,schemaProp:x,dataProp:x},d)),s.ok(d))});function b(k){const{opts:x,errSchemaPath:S}=i,E=a.length,T=E===k.minItems&&(E===k.maxItems||k[e]===!1);if(x.strictTuples&&!T){const A=`"${f}" is ${E}-tuple, but minItems or maxItems/${e} are not specified or different at path "${S}"`;(0,Hu.checkStrictMode)(i,A,x.strictTuples)}}}Yo.validateTuple=n0;Yo.default=T3;Object.defineProperty(op,"__esModule",{value:!0});const C3=Yo,I3={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:s=>(0,C3.validateTuple)(s,"items")};op.default=I3;var lp={};Object.defineProperty(lp,"__esModule",{value:!0});const oy=zr,A3=Zr,P3=Mr,M3=Jo,z3={message:({params:{len:s}})=>(0,oy.str)`must NOT have more than ${s} items`,params:({params:{len:s}})=>(0,oy._)`{limit: ${s}}`},D3={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:z3,code(s){const{schema:e,parentSchema:a,it:o}=s,{prefixItems:c}=a;o.items=!0,!(0,A3.alwaysValidSchema)(o,e)&&(c?(0,M3.validateAdditionalItems)(s,c):s.ok((0,P3.validateArray)(s)))}};lp.default=D3;var cp={};Object.defineProperty(cp,"__esModule",{value:!0});const Fn=zr,Bu=Zr,L3={message:({params:{min:s,max:e}})=>e===void 0?(0,Fn.str)`must contain at least ${s} valid item(s)`:(0,Fn.str)`must contain at least ${s} and no more than ${e} valid item(s)`,params:({params:{min:s,max:e}})=>e===void 0?(0,Fn._)`{minContains: ${s}}`:(0,Fn._)`{minContains: ${s}, maxContains: ${e}}`},R3={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:L3,code(s){const{gen:e,schema:a,parentSchema:o,data:c,it:h}=s;let f,i;const{minContains:d,maxContains:g}=o;h.opts.next?(f=d===void 0?1:d,i=g):f=1;const b=e.const("len",(0,Fn._)`${c}.length`);if(s.setParams({min:f,max:i}),i===void 0&&f===0){(0,Bu.checkStrictMode)(h,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(i!==void 0&&f>i){(0,Bu.checkStrictMode)(h,'"minContains" > "maxContains" is always invalid'),s.fail();return}if((0,Bu.alwaysValidSchema)(h,a)){let T=(0,Fn._)`${b} >= ${f}`;i!==void 0&&(T=(0,Fn._)`${T} && ${b} <= ${i}`),s.pass(T);return}h.items=!0;const k=e.name("valid");i===void 0&&f===1?S(k,()=>e.if(k,()=>e.break())):f===0?(e.let(k,!0),i!==void 0&&e.if((0,Fn._)`${c}.length > 0`,x)):(e.let(k,!1),x()),s.result(k,()=>s.reset());function x(){const T=e.name("_valid"),A=e.let("count",0);S(T,()=>e.if(T,()=>E(A)))}function S(T,A){e.forRange("i",0,b,z=>{s.subschema({keyword:"contains",dataProp:z,dataPropType:Bu.Type.Num,compositeRule:!0},T),A()})}function E(T){e.code((0,Fn._)`${T}++`),i===void 0?e.if((0,Fn._)`${T} >= ${f}`,()=>e.assign(k,!0).break()):(e.if((0,Fn._)`${T} > ${i}`,()=>e.assign(k,!1).break()),f===1?e.assign(k,!0):e.if((0,Fn._)`${T} >= ${f}`,()=>e.assign(k,!0)))}}};cp.default=R3;var s0={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.validateSchemaDeps=s.validatePropertyDeps=s.error=void 0;const e=zr,a=Zr,o=Mr;s.error={message:({params:{property:d,depsCount:g,deps:b}})=>{const k=g===1?"property":"properties";return(0,e.str)`must have ${k} ${b} when property ${d} is present`},params:({params:{property:d,depsCount:g,deps:b,missingProperty:k}})=>(0,e._)`{property: ${d},
    missingProperty: ${k},
    depsCount: ${g},
    deps: ${b}}`};const c={keyword:"dependencies",type:"object",schemaType:"object",error:s.error,code(d){const[g,b]=h(d);f(d,g),i(d,b)}};function h({schema:d}){const g={},b={};for(const k in d){if(k==="__proto__")continue;const x=Array.isArray(d[k])?g:b;x[k]=d[k]}return[g,b]}function f(d,g=d.schema){const{gen:b,data:k,it:x}=d;if(Object.keys(g).length===0)return;const S=b.let("missing");for(const E in g){const T=g[E];if(T.length===0)continue;const A=(0,o.propertyInData)(b,k,E,x.opts.ownProperties);d.setParams({property:E,depsCount:T.length,deps:T.join(", ")}),x.allErrors?b.if(A,()=>{for(const z of T)(0,o.checkReportMissingProp)(d,z)}):(b.if((0,e._)`${A} && (${(0,o.checkMissingProp)(d,T,S)})`),(0,o.reportMissingProp)(d,S),b.else())}}s.validatePropertyDeps=f;function i(d,g=d.schema){const{gen:b,data:k,keyword:x,it:S}=d,E=b.name("valid");for(const T in g)(0,a.alwaysValidSchema)(S,g[T])||(b.if((0,o.propertyInData)(b,k,T,S.opts.ownProperties),()=>{const A=d.subschema({keyword:x,schemaProp:T},E);d.mergeValidEvaluated(A,E)},()=>b.var(E,!0)),d.ok(E))}s.validateSchemaDeps=i,s.default=c})(s0);var up={};Object.defineProperty(up,"__esModule",{value:!0});const a0=zr,O3=Zr,B3={message:"property name must be valid",params:({params:s})=>(0,a0._)`{propertyName: ${s.propertyName}}`},N3={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:B3,code(s){const{gen:e,schema:a,data:o,it:c}=s;if((0,O3.alwaysValidSchema)(c,a))return;const h=e.name("valid");e.forIn("key",o,f=>{s.setParams({propertyName:f}),s.subschema({keyword:"propertyNames",data:f,dataTypes:["string"],propertyName:f,compositeRule:!0},h),e.if((0,a0.not)(h),()=>{s.error(!0),c.allErrors||e.break()})}),s.ok(h)}};up.default=N3;var _h={};Object.defineProperty(_h,"__esModule",{value:!0});const Nu=Mr,ns=zr,F3=ks,Fu=Zr,U3={message:"must NOT have additional properties",params:({params:s})=>(0,ns._)`{additionalProperty: ${s.additionalProperty}}`},V3={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:U3,code(s){const{gen:e,schema:a,parentSchema:o,data:c,errsCount:h,it:f}=s;if(!h)throw new Error("ajv implementation error");const{allErrors:i,opts:d}=f;if(f.props=!0,d.removeAdditional!=="all"&&(0,Fu.alwaysValidSchema)(f,a))return;const g=(0,Nu.allSchemaProperties)(o.properties),b=(0,Nu.allSchemaProperties)(o.patternProperties);k(),s.ok((0,ns._)`${h} === ${F3.default.errors}`);function k(){e.forIn("key",c,A=>{!g.length&&!b.length?E(A):e.if(x(A),()=>E(A))})}function x(A){let z;if(g.length>8){const D=(0,Fu.schemaRefOrVal)(f,o.properties,"properties");z=(0,Nu.isOwnProperty)(e,D,A)}else g.length?z=(0,ns.or)(...g.map(D=>(0,ns._)`${A} === ${D}`)):z=ns.nil;return b.length&&(z=(0,ns.or)(z,...b.map(D=>(0,ns._)`${(0,Nu.usePattern)(s,D)}.test(${A})`))),(0,ns.not)(z)}function S(A){e.code((0,ns._)`delete ${c}[${A}]`)}function E(A){if(d.removeAdditional==="all"||d.removeAdditional&&a===!1){S(A);return}if(a===!1){s.setParams({additionalProperty:A}),s.error(),i||e.break();return}if(typeof a=="object"&&!(0,Fu.alwaysValidSchema)(f,a)){const z=e.name("valid");d.removeAdditional==="failing"?(T(A,z,!1),e.if((0,ns.not)(z),()=>{s.reset(),S(A)})):(T(A,z),i||e.if((0,ns.not)(z),()=>e.break()))}}function T(A,z,D){const F={keyword:"additionalProperties",dataProp:A,dataPropType:Fu.Type.Str};D===!1&&Object.assign(F,{compositeRule:!0,createErrors:!1,allErrors:!1}),s.subschema(F,z)}}};_h.default=V3;var hp={};Object.defineProperty(hp,"__esModule",{value:!0});const $3=as,ly=Mr,$f=Zr,cy=_h,j3={keyword:"properties",type:"object",schemaType:"object",code(s){const{gen:e,schema:a,parentSchema:o,data:c,it:h}=s;h.opts.removeAdditional==="all"&&o.additionalProperties===void 0&&cy.default.code(new $3.KeywordCxt(h,cy.default,"additionalProperties"));const f=(0,ly.allSchemaProperties)(a);for(const k of f)h.definedProperties.add(k);h.opts.unevaluated&&f.length&&h.props!==!0&&(h.props=$f.mergeEvaluated.props(e,(0,$f.toHash)(f),h.props));const i=f.filter(k=>!(0,$f.alwaysValidSchema)(h,a[k]));if(i.length===0)return;const d=e.name("valid");for(const k of i)g(k)?b(k):(e.if((0,ly.propertyInData)(e,c,k,h.opts.ownProperties)),b(k),h.allErrors||e.else().var(d,!0),e.endIf()),s.it.definedProperties.add(k),s.ok(d);function g(k){return h.opts.useDefaults&&!h.compositeRule&&a[k].default!==void 0}function b(k){s.subschema({keyword:"properties",schemaProp:k,dataProp:k},d)}}};hp.default=j3;var fp={};Object.defineProperty(fp,"__esModule",{value:!0});const uy=Mr,Uu=zr,hy=Zr,fy=Zr,q3={keyword:"patternProperties",type:"object",schemaType:"object",code(s){const{gen:e,schema:a,data:o,parentSchema:c,it:h}=s,{opts:f}=h,i=(0,uy.allSchemaProperties)(a),d=i.filter(T=>(0,hy.alwaysValidSchema)(h,a[T]));if(i.length===0||d.length===i.length&&(!h.opts.unevaluated||h.props===!0))return;const g=f.strictSchema&&!f.allowMatchingProperties&&c.properties,b=e.name("valid");h.props!==!0&&!(h.props instanceof Uu.Name)&&(h.props=(0,fy.evaluatedPropsToName)(e,h.props));const{props:k}=h;x();function x(){for(const T of i)g&&S(T),h.allErrors?E(T):(e.var(b,!0),E(T),e.if(b))}function S(T){for(const A in g)new RegExp(T).test(A)&&(0,hy.checkStrictMode)(h,`property ${A} matches pattern ${T} (use allowMatchingProperties)`)}function E(T){e.forIn("key",o,A=>{e.if((0,Uu._)`${(0,uy.usePattern)(s,T)}.test(${A})`,()=>{const z=d.includes(T);z||s.subschema({keyword:"patternProperties",schemaProp:T,dataProp:A,dataPropType:fy.Type.Str},b),h.opts.unevaluated&&k!==!0?e.assign((0,Uu._)`${k}[${A}]`,!0):!z&&!h.allErrors&&e.if((0,Uu.not)(b),()=>e.break())})})}}};fp.default=q3;var dp={};Object.defineProperty(dp,"__esModule",{value:!0});const G3=Zr,Z3={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(s){const{gen:e,schema:a,it:o}=s;if((0,G3.alwaysValidSchema)(o,a)){s.fail();return}const c=e.name("valid");s.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},c),s.failResult(c,()=>s.reset(),()=>s.error())},error:{message:"must NOT be valid"}};dp.default=Z3;var pp={};Object.defineProperty(pp,"__esModule",{value:!0});const H3=Mr,W3={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:H3.validateUnion,error:{message:"must match a schema in anyOf"}};pp.default=W3;var mp={};Object.defineProperty(mp,"__esModule",{value:!0});const Wu=zr,K3=Zr,X3={message:"must match exactly one schema in oneOf",params:({params:s})=>(0,Wu._)`{passingSchemas: ${s.passing}}`},J3={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:X3,code(s){const{gen:e,schema:a,parentSchema:o,it:c}=s;if(!Array.isArray(a))throw new Error("ajv implementation error");if(c.opts.discriminator&&o.discriminator)return;const h=a,f=e.let("valid",!1),i=e.let("passing",null),d=e.name("_valid");s.setParams({passing:i}),e.block(g),s.result(f,()=>s.reset(),()=>s.error(!0));function g(){h.forEach((b,k)=>{let x;(0,K3.alwaysValidSchema)(c,b)?e.var(d,!0):x=s.subschema({keyword:"oneOf",schemaProp:k,compositeRule:!0},d),k>0&&e.if((0,Wu._)`${d} && ${f}`).assign(f,!1).assign(i,(0,Wu._)`[${i}, ${k}]`).else(),e.if(d,()=>{e.assign(f,!0),e.assign(i,k),x&&s.mergeEvaluated(x,Wu.Name)})})}}};mp.default=J3;var gp={};Object.defineProperty(gp,"__esModule",{value:!0});const Y3=Zr,Q3={keyword:"allOf",schemaType:"array",code(s){const{gen:e,schema:a,it:o}=s;if(!Array.isArray(a))throw new Error("ajv implementation error");const c=e.name("valid");a.forEach((h,f)=>{if((0,Y3.alwaysValidSchema)(o,h))return;const i=s.subschema({keyword:"allOf",schemaProp:f},c);s.ok(c),s.mergeEvaluated(i)})}};gp.default=Q3;var _p={};Object.defineProperty(_p,"__esModule",{value:!0});const oh=zr,o0=Zr,e4={message:({params:s})=>(0,oh.str)`must match "${s.ifClause}" schema`,params:({params:s})=>(0,oh._)`{failingKeyword: ${s.ifClause}}`},t4={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:e4,code(s){const{gen:e,parentSchema:a,it:o}=s;a.then===void 0&&a.else===void 0&&(0,o0.checkStrictMode)(o,'"if" without "then" and "else" is ignored');const c=dy(o,"then"),h=dy(o,"else");if(!c&&!h)return;const f=e.let("valid",!0),i=e.name("_valid");if(d(),s.reset(),c&&h){const b=e.let("ifClause");s.setParams({ifClause:b}),e.if(i,g("then",b),g("else",b))}else c?e.if(i,g("then")):e.if((0,oh.not)(i),g("else"));s.pass(f,()=>s.error(!0));function d(){const b=s.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},i);s.mergeEvaluated(b)}function g(b,k){return()=>{const x=s.subschema({keyword:b},i);e.assign(f,i),s.mergeValidEvaluated(x,f),k?e.assign(k,(0,oh._)`${b}`):s.setParams({ifClause:b})}}}};function dy(s,e){const a=s.schema[e];return a!==void 0&&!(0,o0.alwaysValidSchema)(s,a)}_p.default=t4;var yp={};Object.defineProperty(yp,"__esModule",{value:!0});const r4=Zr,i4={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:s,parentSchema:e,it:a}){e.if===void 0&&(0,r4.checkStrictMode)(a,`"${s}" without "if" is ignored`)}};yp.default=i4;Object.defineProperty(ap,"__esModule",{value:!0});const n4=Jo,s4=op,a4=Yo,o4=lp,l4=cp,c4=s0,u4=up,h4=_h,f4=hp,d4=fp,p4=dp,m4=pp,g4=mp,_4=gp,y4=_p,v4=yp;function b4(s=!1){const e=[p4.default,m4.default,g4.default,_4.default,y4.default,v4.default,u4.default,h4.default,c4.default,f4.default,d4.default];return s?e.push(s4.default,o4.default):e.push(n4.default,a4.default),e.push(l4.default),e}ap.default=b4;var vp={},bp={};Object.defineProperty(bp,"__esModule",{value:!0});const Ii=zr,x4={message:({schemaCode:s})=>(0,Ii.str)`must match format "${s}"`,params:({schemaCode:s})=>(0,Ii._)`{format: ${s}}`},w4={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:x4,code(s,e){const{gen:a,data:o,$data:c,schema:h,schemaCode:f,it:i}=s,{opts:d,errSchemaPath:g,schemaEnv:b,self:k}=i;if(!d.validateFormats)return;c?x():S();function x(){const E=a.scopeValue("formats",{ref:k.formats,code:d.code.formats}),T=a.const("fDef",(0,Ii._)`${E}[${f}]`),A=a.let("fType"),z=a.let("format");a.if((0,Ii._)`typeof ${T} == "object" && !(${T} instanceof RegExp)`,()=>a.assign(A,(0,Ii._)`${T}.type || "string"`).assign(z,(0,Ii._)`${T}.validate`),()=>a.assign(A,(0,Ii._)`"string"`).assign(z,T)),s.fail$data((0,Ii.or)(D(),F()));function D(){return d.strictSchema===!1?Ii.nil:(0,Ii._)`${f} && !${z}`}function F(){const $=b.$async?(0,Ii._)`(${T}.async ? await ${z}(${o}) : ${z}(${o}))`:(0,Ii._)`${z}(${o})`,q=(0,Ii._)`(typeof ${z} == "function" ? ${$} : ${z}.test(${o}))`;return(0,Ii._)`${z} && ${z} !== true && ${A} === ${e} && !${q}`}}function S(){const E=k.formats[h];if(!E){D();return}if(E===!0)return;const[T,A,z]=F(E);T===e&&s.pass($());function D(){if(d.strictSchema===!1){k.logger.warn(q());return}throw new Error(q());function q(){return`unknown format "${h}" ignored in schema at path "${g}"`}}function F(q){const J=q instanceof RegExp?(0,Ii.regexpCode)(q):d.code.formats?(0,Ii._)`${d.code.formats}${(0,Ii.getProperty)(h)}`:void 0,G=a.scopeValue("formats",{key:h,ref:q,code:J});return typeof q=="object"&&!(q instanceof RegExp)?[q.type||"string",q.validate,(0,Ii._)`${G}.validate`]:["string",q,G]}function $(){if(typeof E=="object"&&!(E instanceof RegExp)&&E.async){if(!b.$async)throw new Error("async format in sync schema");return(0,Ii._)`await ${z}(${o})`}return typeof A=="function"?(0,Ii._)`${z}(${o})`:(0,Ii._)`${z}.test(${o})`}}}};bp.default=w4;Object.defineProperty(vp,"__esModule",{value:!0});const S4=bp,k4=[S4.default];vp.default=k4;var Wo={};Object.defineProperty(Wo,"__esModule",{value:!0});Wo.contentVocabulary=Wo.metadataVocabulary=void 0;Wo.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];Wo.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(Gd,"__esModule",{value:!0});const E4=Zd,T4=Wd,C4=ap,I4=vp,py=Wo,A4=[E4.default,T4.default,(0,C4.default)(),I4.default,py.metadataVocabulary,py.contentVocabulary];Gd.default=A4;var xp={},l0={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.DiscrError=void 0,function(e){e.Tag="tag",e.Mapping="mapping"}(s.DiscrError||(s.DiscrError={}))})(l0);Object.defineProperty(xp,"__esModule",{value:!0});const Uo=zr,Ed=l0,my=Sn,P4=Zr,M4={message:({params:{discrError:s,tagName:e}})=>s===Ed.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:s,tag:e,tagName:a}})=>(0,Uo._)`{error: ${s}, tag: ${a}, tagValue: ${e}}`},z4={keyword:"discriminator",type:"object",schemaType:"object",error:M4,code(s){const{gen:e,data:a,schema:o,parentSchema:c,it:h}=s,{oneOf:f}=c;if(!h.opts.discriminator)throw new Error("discriminator: requires discriminator option");const i=o.propertyName;if(typeof i!="string")throw new Error("discriminator: requires propertyName");if(o.mapping)throw new Error("discriminator: mapping is not supported");if(!f)throw new Error("discriminator: requires oneOf keyword");const d=e.let("valid",!1),g=e.const("tag",(0,Uo._)`${a}${(0,Uo.getProperty)(i)}`);e.if((0,Uo._)`typeof ${g} == "string"`,()=>b(),()=>s.error(!1,{discrError:Ed.DiscrError.Tag,tag:g,tagName:i})),s.ok(d);function b(){const S=x();e.if(!1);for(const E in S)e.elseIf((0,Uo._)`${g} === ${E}`),e.assign(d,k(S[E]));e.else(),s.error(!1,{discrError:Ed.DiscrError.Mapping,tag:g,tagName:i}),e.endIf()}function k(S){const E=e.name("valid"),T=s.subschema({keyword:"oneOf",schemaProp:S},E);return s.mergeEvaluated(T,Uo.Name),E}function x(){var S;const E={},T=z(c);let A=!0;for(let $=0;$<f.length;$++){let q=f[$];q!=null&&q.$ref&&!(0,P4.schemaHasRulesButRef)(q,h.self.RULES)&&(q=my.resolveRef.call(h.self,h.schemaEnv.root,h.baseId,q==null?void 0:q.$ref),q instanceof my.SchemaEnv&&(q=q.schema));const J=(S=q==null?void 0:q.properties)===null||S===void 0?void 0:S[i];if(typeof J!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${i}"`);A=A&&(T||z(q)),D(J,$)}if(!A)throw new Error(`discriminator: "${i}" must be required`);return E;function z({required:$}){return Array.isArray($)&&$.includes(i)}function D($,q){if($.const)F($.const,q);else if($.enum)for(const J of $.enum)F(J,q);else throw new Error(`discriminator: "properties/${i}" must have "const" or "enum"`)}function F($,q){if(typeof $!="string"||$ in E)throw new Error(`discriminator: "${i}" values must be unique strings`);E[$]=q}}}};xp.default=z4;const D4="http://json-schema.org/draft-07/schema#",L4="http://json-schema.org/draft-07/schema#",R4="Core schema meta-schema",O4={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},B4=["object","boolean"],N4={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},F4={$schema:D4,$id:L4,title:R4,definitions:O4,type:B4,properties:N4,default:!0};(function(s,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;const a=I1,o=Gd,c=xp,h=F4,f=["/properties"],i="http://json-schema.org/draft-07/schema";class d extends a.default{_addVocabularies(){super._addVocabularies(),o.default.forEach(E=>this.addVocabulary(E)),this.opts.discriminator&&this.addKeyword(c.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const E=this.opts.$data?this.$dataMetaSchema(h,f):h;this.addMetaSchema(E,i,!1),this.refs["http://json-schema.org/schema"]=i}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(i)?i:void 0)}}s.exports=e=d,Object.defineProperty(e,"__esModule",{value:!0}),e.default=d;var g=as;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return g.KeywordCxt}});var b=zr;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return b._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return b.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return b.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return b.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return b.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return b.CodeGen}});var k=Sc;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return k.default}});var x=kc;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return x.default}})})(vd,vd.exports);var U4=vd.exports;const V4=fh(U4);/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var $4=Object.prototype.toString,Qo=Array.isArray||function(e){return $4.call(e)==="[object Array]"};function wp(s){return typeof s=="function"}function j4(s){return Qo(s)?"array":typeof s}function jf(s){return s.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function gy(s,e){return s!=null&&typeof s=="object"&&e in s}function q4(s,e){return s!=null&&typeof s!="object"&&s.hasOwnProperty&&s.hasOwnProperty(e)}var G4=RegExp.prototype.test;function Z4(s,e){return G4.call(s,e)}var H4=/\S/;function W4(s){return!Z4(H4,s)}var K4={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function X4(s){return String(s).replace(/[&<>"'`=\/]/g,function(a){return K4[a]})}var J4=/\s*/,Y4=/\s+/,_y=/\s*=/,Q4=/\s*\}/,eT=/#|\^|\/|>|\{|&|=|!/;function tT(s,e){if(!s)return[];var a=!1,o=[],c=[],h=[],f=!1,i=!1,d="",g=0;function b(){if(f&&!i)for(;h.length;)delete c[h.pop()];else h=[];f=!1,i=!1}var k,x,S;function E(oe){if(typeof oe=="string"&&(oe=oe.split(Y4,2)),!Qo(oe)||oe.length!==2)throw new Error("Invalid tags: "+oe);k=new RegExp(jf(oe[0])+"\\s*"),x=new RegExp("\\s*"+jf(oe[1])),S=new RegExp("\\s*"+jf("}"+oe[1]))}E(e||Un.tags);for(var T=new Tc(s),A,z,D,F,$,q;!T.eos();){if(A=T.pos,D=T.scanUntil(k),D)for(var J=0,G=D.length;J<G;++J)F=D.charAt(J),W4(F)?(h.push(c.length),d+=F):(i=!0,a=!0,d+=" "),c.push(["text",F,A,A+1]),A+=1,F===`
`&&(b(),d="",g=0,a=!1);if(!T.scan(k))break;if(f=!0,z=T.scan(eT)||"name",T.scan(J4),z==="="?(D=T.scanUntil(_y),T.scan(_y),T.scanUntil(x)):z==="{"?(D=T.scanUntil(S),T.scan(Q4),T.scanUntil(x),z="&"):D=T.scanUntil(x),!T.scan(x))throw new Error("Unclosed tag at "+T.pos);if(z==">"?$=[z,D,A,T.pos,d,g,a]:$=[z,D,A,T.pos],g++,c.push($),z==="#"||z==="^")o.push($);else if(z==="/"){if(q=o.pop(),!q)throw new Error('Unopened section "'+D+'" at '+A);if(q[1]!==D)throw new Error('Unclosed section "'+q[1]+'" at '+A)}else z==="name"||z==="{"||z==="&"?i=!0:z==="="&&E(D)}if(b(),q=o.pop(),q)throw new Error('Unclosed section "'+q[1]+'" at '+T.pos);return iT(rT(c))}function rT(s){for(var e=[],a,o,c=0,h=s.length;c<h;++c)a=s[c],a&&(a[0]==="text"&&o&&o[0]==="text"?(o[1]+=a[1],o[3]=a[3]):(e.push(a),o=a));return e}function iT(s){for(var e=[],a=e,o=[],c,h,f=0,i=s.length;f<i;++f)switch(c=s[f],c[0]){case"#":case"^":a.push(c),o.push(c),a=c[4]=[];break;case"/":h=o.pop(),h[5]=c[2],a=o.length>0?o[o.length-1][4]:e;break;default:a.push(c)}return e}function Tc(s){this.string=s,this.tail=s,this.pos=0}Tc.prototype.eos=function(){return this.tail===""};Tc.prototype.scan=function(e){var a=this.tail.match(e);if(!a||a.index!==0)return"";var o=a[0];return this.tail=this.tail.substring(o.length),this.pos+=o.length,o};Tc.prototype.scanUntil=function(e){var a=this.tail.search(e),o;switch(a){case-1:o=this.tail,this.tail="";break;case 0:o="";break;default:o=this.tail.substring(0,a),this.tail=this.tail.substring(a)}return this.pos+=o.length,o};function Ko(s,e){this.view=s,this.cache={".":this.view},this.parent=e}Ko.prototype.push=function(e){return new Ko(e,this)};Ko.prototype.lookup=function(e){var a=this.cache,o;if(a.hasOwnProperty(e))o=a[e];else{for(var c=this,h,f,i,d=!1;c;){if(e.indexOf(".")>0)for(h=c.view,f=e.split("."),i=0;h!=null&&i<f.length;)i===f.length-1&&(d=gy(h,f[i])||q4(h,f[i])),h=h[f[i++]];else h=c.view[e],d=gy(c.view,e);if(d){o=h;break}c=c.parent}a[e]=o}return wp(o)&&(o=o.call(this.view)),o};function gn(){this.templateCache={_cache:{},set:function(e,a){this._cache[e]=a},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}gn.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};gn.prototype.parse=function(e,a){var o=this.templateCache,c=e+":"+(a||Un.tags).join(":"),h=typeof o<"u",f=h?o.get(c):void 0;return f==null&&(f=tT(e,a),h&&o.set(c,f)),f};gn.prototype.render=function(e,a,o,c){var h=this.getConfigTags(c),f=this.parse(e,h),i=a instanceof Ko?a:new Ko(a,void 0);return this.renderTokens(f,i,o,e,c)};gn.prototype.renderTokens=function(e,a,o,c,h){for(var f="",i,d,g,b=0,k=e.length;b<k;++b)g=void 0,i=e[b],d=i[0],d==="#"?g=this.renderSection(i,a,o,c,h):d==="^"?g=this.renderInverted(i,a,o,c,h):d===">"?g=this.renderPartial(i,a,o,h):d==="&"?g=this.unescapedValue(i,a):d==="name"?g=this.escapedValue(i,a,h):d==="text"&&(g=this.rawValue(i)),g!==void 0&&(f+=g);return f};gn.prototype.renderSection=function(e,a,o,c,h){var f=this,i="",d=a.lookup(e[1]);function g(x){return f.render(x,a,o,h)}if(d){if(Qo(d))for(var b=0,k=d.length;b<k;++b)i+=this.renderTokens(e[4],a.push(d[b]),o,c,h);else if(typeof d=="object"||typeof d=="string"||typeof d=="number")i+=this.renderTokens(e[4],a.push(d),o,c,h);else if(wp(d)){if(typeof c!="string")throw new Error("Cannot use higher-order sections without the original template");d=d.call(a.view,c.slice(e[3],e[5]),g),d!=null&&(i+=d)}else i+=this.renderTokens(e[4],a,o,c,h);return i}};gn.prototype.renderInverted=function(e,a,o,c,h){var f=a.lookup(e[1]);if(!f||Qo(f)&&f.length===0)return this.renderTokens(e[4],a,o,c,h)};gn.prototype.indentPartial=function(e,a,o){for(var c=a.replace(/[^ \t]/g,""),h=e.split(`
`),f=0;f<h.length;f++)h[f].length&&(f>0||!o)&&(h[f]=c+h[f]);return h.join(`
`)};gn.prototype.renderPartial=function(e,a,o,c){if(o){var h=this.getConfigTags(c),f=wp(o)?o(e[1]):o[e[1]];if(f!=null){var i=e[6],d=e[5],g=e[4],b=f;d==0&&g&&(b=this.indentPartial(f,g,i));var k=this.parse(b,h);return this.renderTokens(k,a,o,b,c)}}};gn.prototype.unescapedValue=function(e,a){var o=a.lookup(e[1]);if(o!=null)return o};gn.prototype.escapedValue=function(e,a,o){var c=this.getConfigEscape(o)||Un.escape,h=a.lookup(e[1]);if(h!=null)return typeof h=="number"&&c===Un.escape?String(h):c(h)};gn.prototype.rawValue=function(e){return e[1]};gn.prototype.getConfigTags=function(e){return Qo(e)?e:e&&typeof e=="object"?e.tags:void 0};gn.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Qo(e))return e.escape};var Un={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(s){fc.templateCache=s},get templateCache(){return fc.templateCache}},fc=new gn;Un.clearCache=function(){return fc.clearCache()};Un.parse=function(e,a){return fc.parse(e,a)};Un.render=function(e,a,o,c){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+j4(e)+'" was given as the first argument for mustache#render(template, view, partials)');return fc.render(e,a,o,c)};Un.escape=X4;Un.Scanner=Tc;Un.Context=Ko;Un.Writer=gn;let Vu=null;function $u(s,e){return String.fromCodePoint("A".codePointAt(0)-1+s)+e}function nT(s,e){if(e==="text")return s.map(a=>({isText:!0,displayValue:a}));if(e==="number_with_commas")return s.map(a=>({isNumeric:!0,rawValue:a,displayValue:a.toLocaleString("en-GB"),style:e}));if(e==="number_1dp")return s.map(a=>({isNumeric:!0,rawValue:a,displayValue:a.toFixed(1),style:e}));throw new Error("Unrecognised column style: "+e)}function yy(s,e){e(s.sheetName,a=>{s.sheetName=a});for(let a=0;a<s.sheetIntroText.length;a++)e(s.sheetIntroText[a],o=>{s.sheetIntroText[a]=o});for(const a of s.columns)if(e(a.heading,o=>{a.heading=o}),a.style==="text")for(let o=0;o<a.values.length;o++)e(a.values[o],c=>{a.values[o]=c})}function sT(s,e){if(!s)return[];const a=/\[\[[^\]]+\]\]/g;let o=s.map(({name:h,text:f})=>({name:h,text:f,used:!1}));const c=new Map(o.map(h=>[`[[${h.name}]]`,h]));for(const h of e)h.sheetIntroText||(h.sheetIntroText=[]),h.hasNotes=!1,yy(h,f=>{for(const i of f.match(a)||[])c.get(i).used=!0,h.hasNotes=!0});o=o.filter(h=>h.used),o.forEach((h,f)=>h.name=`[note ${f+1}]`);for(const h of e)if(h.hasNotes){const f=i=>c.get(i).name;yy(h,(i,d)=>{d(i.replace(a,f))})}return o}function aT(s){return(Math.max(...s.map(a=>Wk(a)))/37.8+.5).toFixed(2)}function oT(s){return s.map(e=>{if(e.startsWith("## "))return{isSubtitle:!0,text:e.slice(3)};if(/^\[.*\]\(.*\)$/.test(e)){const a=e.slice(1,-1).split("](");return{isHyperlink:!0,text:a[0],href:a[1]}}return{isText:!0,text:e}})}function lT(s){let e="This worksheet contains one table.";return s?e+" Some cells refer to notes, which can be found on the notes worksheet.":e}function cT(s){if(Vu||(Vu=new V4().compile(Kk)),!Vu(s))throw console.log(Vu.errors),new Error("Input did not match the schema");const a={coverSheetTitle:s.coverSheetTitle,firstTocCell:$u(1,3),lastTocCell:$u(2,3+s.sheets.length),coverSheetContents:oT(s.coverSheetContents),sheets:JSON.parse(JSON.stringify(s.sheets))};a.notes=sT(s.notes,a.sheets),a.hasNotes=a.notes.length>0,a.tableCount=a.sheets.length+2+a.hasNotes;for(let o=0;o<a.sheets.length;o++){const c=a.sheets[o];c.sheetNumber=o+1,c.sheetIntroText=[lT(c.hasNotes),...c.sheetIntroText||[]],c.introText=c.sheetIntroText.map((h,f)=>({text:h,isLastIntroRow:f===c.sheetIntroText.length-1})),c.firstTableCell=$u(1,2+c.sheetIntroText.length),c.lastTableCell=$u(c.columns.length,2+c.columns[0].values.length+c.sheetIntroText.length);for(const h of c.columns)h.valuesFormatted=nT(h.values,h.style),h.heading=h.heading.split(`
`);c.rows=[];for(let h=0;h<c.columns[0].values.length;h++)c.rows.push({cellsInRow:c.columns.map(f=>f.valuesFormatted[h])});c.columnStyles=c.columns.map((h,f)=>{const i=Math.max(2.4,aT(h.valuesFormatted.map(d=>d.displayValue)));return{name:"colStyle"+o+"_"+f,widthCm:i}})}return Hk.map(o=>({filename:o.filename,contents:Un.render(o.contents,a)}))}const{document:Us}=$y;function vy(s,e,a){const o=s.slice();return o[25]=e[a],o}function by(s,e,a){const o=s.slice();return o[28]=e[a],o}function xy(s,e,a){const o=s.slice();return o[31]=e[a],o[33]=a,o}function wy(s){let e,a,o=s[0].selected!=null&&s[9](s[0]).missing>0&&s[0].selected.total_pop.count!=null&&s[0].selected.total_pop.count>=100,c,h,f;e=new Gy({props:{mode:s[3]=="failed"?"error":"info",$$slots:{default:[yT]},$$scope:{ctx:s}}});let i=o&&Ey(s);return{c(){ir(e.$$.fragment),a=St(),i&&i.c(),c=St(),h=Ve("div"),this.h()},l(d){cr(e.$$.fragment,d),a=kt(d),i&&i.l(d),c=kt(d),h=$e(d,"DIV",{}),Ze(h).forEach(ie),this.h()},h(){Ct(h,"height","24px")},m(d,g){nr(e,d,g),Oe(d,a,g),i&&i.m(d,g),Oe(d,c,g),Oe(d,h,g),f=!0},p(d,g){const b={};g[0]&8&&(b.mode=d[3]=="failed"?"error":"info"),g[0]&26|g[1]&8&&(b.$$scope={dirty:g,ctx:d}),e.$set(b),g[0]&1&&(o=d[0].selected!=null&&d[9](d[0]).missing>0&&d[0].selected.total_pop.count!=null&&d[0].selected.total_pop.count>=100),o?i?(i.p(d,g),g[0]&1&&Ge(i,1)):(i=Ey(d),i.c(),Ge(i,1),i.m(c.parentNode,c)):i&&(Vr(),it(i,1,1,()=>{i=null}),$r())},i(d){f||(Ge(e.$$.fragment,d),Ge(i),f=!0)},o(d){it(e.$$.fragment,d),it(i),f=!1},d(d){sr(e,d),d&&ie(a),i&&i.d(d),d&&ie(c),d&&ie(h)}}}function Sy(s){let e;function a(h,f){return h[1].length===1?hT:uT}let o=a(s),c=o(s);return{c(){e=Ve("p"),c.c()},l(h){e=$e(h,"P",{});var f=Ze(e);c.l(f),f.forEach(ie)},m(h,f){Oe(h,e,f),c.m(e,null)},p(h,f){o===(o=a(h))&&c?c.p(h,f):(c.d(1),c=o(h),c&&(c.c(),c.m(e,null)))},d(h){h&&ie(e),c.d()}}}function uT(s){let e,a;function o(f,i){return f[1].length===2?dT:fT}let c=o(s),h=c(s);return{c(){e=Mt("The profile below is for people with "),h.c(),a=Mt(`
                of the following characteristics:`)},l(f){e=zt(f,"The profile below is for people with "),h.l(f),a=zt(f,`
                of the following characteristics:`)},m(f,i){Oe(f,e,i),h.m(f,i),Oe(f,a,i)},p(f,i){c!==(c=o(f))&&(h.d(1),h=c(f),h&&(h.c(),h.m(a.parentNode,a)))},d(f){f&&ie(e),h.d(f),f&&ie(a)}}}function hT(s){let e;return{c(){e=Mt(`The profile below is for people with the following
                characteristic:`)},l(a){e=zt(a,`The profile below is for people with the following
                characteristic:`)},m(a,o){Oe(a,e,o)},p:_r,d(a){a&&ie(e)}}}function fT(s){let e;return{c(){e=Mt("all")},l(a){e=zt(a,"all")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function dT(s){let e;return{c(){e=Mt("both")},l(a){e=zt(a,"both")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function pT(s){let e,a,o=fa(s[31].topic)+"",c,h,f=fa(Zo(s[31].label))+"",i,d,g,b,k;function x(){return s[12](s[31])}return{c(){e=Ve("button"),a=Ve("span"),c=Mt(o),h=Mt(": "),i=Mt(f),d=St(),g=Ve("span"),this.h()},l(S){e=$e(S,"BUTTON",{class:!0});var E=Ze(e);a=$e(E,"SPAN",{class:!0});var T=Ze(a);c=zt(T,o),h=zt(T,": "),i=zt(T,f),T.forEach(ie),d=kt(E),g=$e(E,"SPAN",{class:!0}),Ze(g).forEach(ie),E.forEach(ie),this.h()},h(){ve(a,"class","chip-text svelte-hd3bon"),ve(g,"class","chip-ready svelte-hd3bon"),ve(e,"class","chip svelte-hd3bon")},m(S,E){Oe(S,e,E),Me(e,a),Me(a,c),Me(a,h),Me(a,i),Me(e,d),Me(e,g),b||(k=Ss(e,"click",x),b=!0)},p(S,E){s=S,E[0]&2&&o!==(o=fa(s[31].topic)+"")&&Cr(c,o),E[0]&2&&f!==(f=fa(Zo(s[31].label))+"")&&Cr(i,f)},d(S){S&&ie(e),b=!1,k()}}}function mT(s){let e,a,o=fa(s[31].topic)+"",c,h,f=fa(Zo(s[31].label))+"",i,d,g;return{c(){e=Ve("div"),a=Ve("span"),c=Mt(o),h=Mt(": "),i=Mt(f),d=St(),g=Ve("div"),this.h()},l(b){e=$e(b,"DIV",{class:!0});var k=Ze(e);a=$e(k,"SPAN",{class:!0});var x=Ze(a);c=zt(x,o),h=zt(x,": "),i=zt(x,f),x.forEach(ie),d=kt(k),g=$e(k,"DIV",{class:!0}),Ze(g).forEach(ie),k.forEach(ie),this.h()},h(){ve(a,"class","chip-text svelte-hd3bon"),ve(g,"class","chip-loader svelte-hd3bon"),ve(e,"class","chip chip-pending svelte-hd3bon")},m(b,k){Oe(b,e,k),Me(e,a),Me(a,c),Me(a,h),Me(a,i),Me(e,d),Me(e,g)},p(b,k){k[0]&2&&o!==(o=fa(b[31].topic)+"")&&Cr(c,o),k[0]&2&&f!==(f=fa(Zo(b[31].label))+"")&&Cr(i,f)},d(b){b&&ie(e)}}}function ky(s){let e;function a(h,f){return h[3]=="loading"?mT:pT}let o=a(s),c=o(s);return{c(){c.c(),e=Qt()},l(h){c.l(h),e=Qt()},m(h,f){c.m(h,f),Oe(h,e,f)},p(h,f){o===(o=a(h))&&c?c.p(h,f):(c.d(1),c=o(h),c&&(c.c(),c.m(e.parentNode,e)))},d(h){c.d(h),h&&ie(e)}}}function gT(s){let e,a;return{c(){e=Ve("p"),a=Mt(`Economic indicators (employment, social status etc) are not
              available for ages 0 to 15.`),this.h()},l(o){e=$e(o,"P",{});var c=Ze(e);a=zt(c,`Economic indicators (employment, social status etc) are not
              available for ages 0 to 15.`),c.forEach(ie),this.h()},h(){Ct(e,"margin","1rem 0 0")},m(o,c){Oe(o,e,c),Me(e,a)},d(o){o&&ie(e)}}}function _T(s){let e,a;return{c(){e=Ve("p"),a=Mt(`No data is available for the selected variables. Try removing a
              variable to see more datasets.`),this.h()},l(o){e=$e(o,"P",{});var c=Ze(e);a=zt(c,`No data is available for the selected variables. Try removing a
              variable to see more datasets.`),c.forEach(ie),this.h()},h(){Ct(e,"margin","1rem 0 0")},m(o,c){Oe(o,e,c),Me(e,a)},d(o){o&&ie(e)}}}function yT(s){let e,a,o,c=s[3]!="failed"&&Sy(s),h=s[1],f=[];for(let b=0;b<h.length;b+=1)f[b]=ky(xy(s,h,b));function i(b,k){if(b[3]=="failed")return _T;if(b[4]==!0)return gT}let d=i(s),g=d&&d(s);return{c(){e=Ve("div"),c&&c.c(),a=St();for(let b=0;b<f.length;b+=1)f[b].c();o=St(),g&&g.c(),this.h()},l(b){e=$e(b,"DIV",{"aria-live":!0});var k=Ze(e);c&&c.l(k),a=kt(k);for(let x=0;x<f.length;x+=1)f[x].l(k);o=kt(k),g&&g.l(k),k.forEach(ie),this.h()},h(){ve(e,"aria-live","polite")},m(b,k){Oe(b,e,k),c&&c.m(e,null),Me(e,a);for(let x=0;x<f.length;x+=1)f[x]&&f[x].m(e,null);Me(e,o),g&&g.m(e,null)},p(b,k){if(b[3]!="failed"?c?c.p(b,k):(c=Sy(b),c.c(),c.m(e,a)):c&&(c.d(1),c=null),k[0]&266){h=b[1];let x;for(x=0;x<h.length;x+=1){const S=xy(b,h,x);f[x]?f[x].p(S,k):(f[x]=ky(S),f[x].c(),f[x].m(e,o))}for(;x<f.length;x+=1)f[x].d(1);f.length=h.length}d!==(d=i(b))&&(g&&g.d(1),g=d&&d(b),g&&(g.c(),g.m(e,null)))},d(b){b&&ie(e),c&&c.d(),Vi(f,b),g&&g.d()}}}function Ey(s){let e,a;return e=new Gy({props:{mode:"info",$$slots:{default:[vT]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c[0]&1|c[1]&8&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function vT(s){let e,a=s[9](s[0]).available+"",o,c,h=s[9](s[0]).missing+s[9](s[0]).available+"",f,i,d,g,b,k,x;return{c(){e=Ve("strong"),o=Mt(a),c=Mt(`
            of `),f=Mt(h),i=Mt(` charts available.
          `),d=Ve("br"),g=St(),b=Ve("a"),k=Mt("Protecting personal data"),x=Mt(`
          prevents some datasets from being included.`),this.h()},l(S){e=$e(S,"STRONG",{});var E=Ze(e);o=zt(E,a),c=zt(E,`
            of `),f=zt(E,h),i=zt(E,` charts available.
          `),E.forEach(ie),d=$e(S,"BR",{}),g=kt(S),b=$e(S,"A",{href:!0,class:!0});var T=Ze(b);k=zt(T,"Protecting personal data"),T.forEach(ie),x=zt(S,`
          prevents some datasets from being included.`),this.h()},h(){ve(b,"href","https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/methodologies/protectingpersonaldataincensus2021results"),ve(b,"class","svelte-hd3bon")},m(S,E){Oe(S,e,E),Me(e,o),Me(e,c),Me(e,f),Me(e,i),Oe(S,d,E),Oe(S,g,E),Oe(S,b,E),Me(b,k),Oe(S,x,E)},p(S,E){E[0]&1&&a!==(a=S[9](S[0]).available+"")&&Cr(o,a),E[0]&1&&h!==(h=S[9](S[0]).missing+S[9](S[0]).available+"")&&Cr(f,h)},d(S){S&&ie(e),S&&ie(d),S&&ie(g),S&&ie(b),S&&ie(x)}}}function bT(s){let e,a;return e=new Bx({props:{options:tb,clickCallback:s[6],removeCatCallback:s[7],globalSelectedCategories:s[1],disabled:s[3]==="loading"}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c[0]&2&&(h.globalSelectedCategories=o[1]),c[0]&8&&(h.disabled=o[3]==="loading"),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function xT(s){let e,a,o,c,h,f,i,d,g,b,k,x,S,E,T=s[1][0]&&wy(s);function A(D){s[13](D)}let z={title:s[1][0]?s[1][2]?"Change selected characteristics":"Add another characteristic":"Start creating profile",$$slots:{default:[bT]},$$scope:{ctx:s}};return s[2]!==void 0&&(z.open=s[2]),x=new qw({props:z}),pc.push(()=>ch(x,"open",A)),{c(){e=Ve("div"),a=Ve("p"),o=Mt(`Select one or more identity characteristics to define a population group,
      for example
      `),c=Ve("a"),h=Mt("Sikhs born in the UK"),f=Mt(`
      or
      `),i=Ve("a"),d=Mt("people aged 65+ born in Ireland"),g=Mt(`. Once selected, you will see how this group compares to the whole
      population of England and Wales based on Census 2021 data.`),b=St(),T&&T.c(),k=St(),ir(x.$$.fragment),this.h()},l(D){e=$e(D,"DIV",{slot:!0});var F=Ze(e);a=$e(F,"P",{class:!0});var $=Ze(a);o=zt($,`Select one or more identity characteristics to define a population group,
      for example
      `),c=$e($,"A",{href:!0,class:!0});var q=Ze(c);h=zt(q,"Sikhs born in the UK"),q.forEach(ie),f=zt($,`
      or
      `),i=$e($,"A",{href:!0,class:!0});var J=Ze(i);d=zt(J,"people aged 65+ born in Ireland"),J.forEach(ie),g=zt($,`. Once selected, you will see how this group compares to the whole
      population of England and Wales based on Census 2021 data.`),$.forEach(ie),b=kt(F),T&&T.l(F),k=kt(F),cr(x.$$.fragment,F),F.forEach(ie),this.h()},h(){ve(c,"href","?religion_tb=7&country_of_birth_3a=1"),ve(c,"class","svelte-hd3bon"),ve(i,"href","?resident_age_3a=3&country_of_birth_8a=2"),ve(i,"class","svelte-hd3bon"),ve(a,"class","subtitle svelte-hd3bon"),ve(e,"slot","after")},m(D,F){Oe(D,e,F),Me(e,a),Me(a,o),Me(a,c),Me(c,h),Me(a,f),Me(a,i),Me(i,d),Me(a,g),Me(e,b),T&&T.m(e,null),Me(e,k),nr(x,e,null),E=!0},p(D,F){D[1][0]?T?(T.p(D,F),F[0]&2&&Ge(T,1)):(T=wy(D),T.c(),Ge(T,1),T.m(e,k)):T&&(Vr(),it(T,1,1,()=>{T=null}),$r());const $={};F[0]&2&&($.title=D[1][0]?D[1][2]?"Change selected characteristics":"Add another characteristic":"Start creating profile"),F[0]&10|F[1]&8&&($.$$scope={dirty:F,ctx:D}),!S&&F[0]&4&&(S=!0,$.open=D[2],uh(()=>S=!1)),x.$set($)},i(D){E||(Ge(T),Ge(x.$$.fragment,D),E=!0)},o(D){it(T),it(x.$$.fragment,D),E=!1},d(D){D&&ie(e),T&&T.d(),sr(x)}}}function Ty(s){let e,a,o,c,h,f;e=new mc({props:{cls:"show-overflow",width:"wide",$$slots:{default:[kT]},$$scope:{ctx:s}}}),o=new Ad({props:{title:"Demographics",height:"auto",$$slots:{default:[CT]},$$scope:{ctx:s}}});let i=s[0].selected.total_pop.count!=null&&s[0].selected.total_pop.count>=100&&Iy(s);return{c(){ir(e.$$.fragment),a=St(),ir(o.$$.fragment),c=St(),i&&i.c(),h=Qt()},l(d){cr(e.$$.fragment,d),a=kt(d),cr(o.$$.fragment,d),c=kt(d),i&&i.l(d),h=Qt()},m(d,g){nr(e,d,g),Oe(d,a,g),nr(o,d,g),Oe(d,c,g),i&&i.m(d,g),Oe(d,h,g),f=!0},p(d,g){const b={};g[0]&1|g[1]&8&&(b.$$scope={dirty:g,ctx:d}),e.$set(b);const k={};g[0]&3|g[1]&8&&(k.$$scope={dirty:g,ctx:d}),o.$set(k),d[0].selected.total_pop.count!=null&&d[0].selected.total_pop.count>=100?i?(i.p(d,g),g[0]&1&&Ge(i,1)):(i=Iy(d),i.c(),Ge(i,1),i.m(h.parentNode,h)):i&&(Vr(),it(i,1,1,()=>{i=null}),$r())},i(d){f||(Ge(e.$$.fragment,d),Ge(o.$$.fragment,d),Ge(i),f=!0)},o(d){it(e.$$.fragment,d),it(o.$$.fragment,d),it(i),f=!1},d(d){sr(e,d),d&&ie(a),sr(o,d),d&&ie(c),i&&i.d(d),d&&ie(h)}}}function wT(s){let e;return{c(){e=Mt("Download profile")},l(a){e=zt(a,"Download profile")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function ST(s){let e;return{c(){e=Mt("Print profile")},l(a){e=zt(a,"Print profile")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function kT(s){let e,a,o,c,h;return a=new Gf({props:{variant:"secondary",icon:"download",small:!0,$$slots:{default:[wT]},$$scope:{ctx:s}}}),a.$on("click",s[14]),c=new Gf({props:{variant:"secondary",icon:"print",small:!0,$$slots:{default:[ST]},$$scope:{ctx:s}}}),c.$on("click",s[15]),{c(){e=Ve("div"),ir(a.$$.fragment),o=St(),ir(c.$$.fragment),this.h()},l(f){e=$e(f,"DIV",{class:!0});var i=Ze(e);cr(a.$$.fragment,i),o=kt(i),cr(c.$$.fragment,i),i.forEach(ie),this.h()},h(){ve(e,"class","action-buttons svelte-hd3bon")},m(f,i){Oe(f,e,i),nr(a,e,null),Me(e,o),nr(c,e,null),h=!0},p(f,i){const d={};i[1]&8&&(d.$$scope={dirty:i,ctx:f}),a.$set(d);const g={};i[1]&8&&(g.$$scope={dirty:i,ctx:f}),c.$set(g)},i(f){h||(Ge(a.$$.fragment,f),Ge(c.$$.fragment,f),h=!0)},o(f){it(a.$$.fragment,f),it(c.$$.fragment,f),h=!1},d(f){f&&ie(e),sr(a),sr(c)}}}function ET(s){let e;return{c(){e=Mt("Number of people, age and sex compared to the population as a whole.")},l(a){e=zt(a,"Number of people, age and sex compared to the population as a whole.")},m(a,o){Oe(a,e,o)},d(a){a&&ie(e)}}}function TT(s){let e,a;return e=new u1({props:{$$slots:{default:[ET]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c[1]&8&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function Cy(s){let e,a;return e=new c1({props:{title:"Sex",table:{code:"sex",key:"Sex"},data:s[0],chart_type:s[5]}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c[0]&1&&(h.data=o[0]),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function CT(s){let e,a,o,c,h,f,i=!s[1].map(Dy).includes("sex")&&s[0].selected.residents.sex.values!=="blocked",d,g;e=new qs({props:{colspan:3,noBackground:!0,$$slots:{default:[TT]},$$scope:{ctx:s}}}),o=new xw({props:{data:s[0]}}),h=new Bw({props:{data:s[0],selected:s[1]}});let b=i&&Cy(s);return{c(){ir(e.$$.fragment),a=St(),ir(o.$$.fragment),c=St(),ir(h.$$.fragment),f=St(),b&&b.c(),d=Qt()},l(k){cr(e.$$.fragment,k),a=kt(k),cr(o.$$.fragment,k),c=kt(k),cr(h.$$.fragment,k),f=kt(k),b&&b.l(k),d=Qt()},m(k,x){nr(e,k,x),Oe(k,a,x),nr(o,k,x),Oe(k,c,x),nr(h,k,x),Oe(k,f,x),b&&b.m(k,x),Oe(k,d,x),g=!0},p(k,x){const S={};x[1]&8&&(S.$$scope={dirty:x,ctx:k}),e.$set(S);const E={};x[0]&1&&(E.data=k[0]),o.$set(E);const T={};x[0]&1&&(T.data=k[0]),x[0]&2&&(T.selected=k[1]),h.$set(T),x[0]&3&&(i=!k[1].map(Dy).includes("sex")&&k[0].selected.residents.sex.values!=="blocked"),i?b?(b.p(k,x),x[0]&3&&Ge(b,1)):(b=Cy(k),b.c(),Ge(b,1),b.m(d.parentNode,d)):b&&(Vr(),it(b,1,1,()=>{b=null}),$r())},i(k){g||(Ge(e.$$.fragment,k),Ge(o.$$.fragment,k),Ge(h.$$.fragment,k),Ge(b),g=!0)},o(k){it(e.$$.fragment,k),it(o.$$.fragment,k),it(h.$$.fragment,k),it(b),g=!1},d(k){sr(e,k),k&&ie(a),sr(o,k),k&&ie(c),sr(h,k),k&&ie(f),b&&b.d(k),k&&ie(d)}}}function Iy(s){let e,a,o,c;e=new sw({props:{data:s[0],mapStyle:Yv,mapBounds:Qv,ladBounds:tc,selected:s[1],colors:Vo}});let h=Qa[0].tablesCategorised,f=[];for(let d=0;d<h.length;d+=1)f[d]=My(vy(s,h,d));const i=d=>it(f[d],1,1,()=>{f[d]=null});return{c(){ir(e.$$.fragment),a=St();for(let d=0;d<f.length;d+=1)f[d].c();o=Qt()},l(d){cr(e.$$.fragment,d),a=kt(d);for(let g=0;g<f.length;g+=1)f[g].l(d);o=Qt()},m(d,g){nr(e,d,g),Oe(d,a,g);for(let b=0;b<f.length;b+=1)f[b]&&f[b].m(d,g);Oe(d,o,g),c=!0},p(d,g){const b={};if(g[0]&1&&(b.data=d[0]),g[0]&2&&(b.selected=d[1]),e.$set(b),g[0]&33){h=Qa[0].tablesCategorised;let k;for(k=0;k<h.length;k+=1){const x=vy(d,h,k);f[k]?(f[k].p(x,g),Ge(f[k],1)):(f[k]=My(x),f[k].c(),Ge(f[k],1),f[k].m(o.parentNode,o))}for(Vr(),k=h.length;k<f.length;k+=1)i(k);$r()}},i(d){if(!c){Ge(e.$$.fragment,d);for(let g=0;g<h.length;g+=1)Ge(f[g]);c=!0}},o(d){it(e.$$.fragment,d),f=f.filter(Boolean);for(let g=0;g<f.length;g+=1)it(f[g]);c=!1},d(d){sr(e,d),d&&ie(a),Vi(f,d),d&&ie(o)}}}function Ay(s){let e,a;return e=new Ad({props:{title:s[25].categoryName,height:"auto",$$slots:{default:[PT]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c[0]&1|c[1]&8&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function IT(s){let e=s[25].categoryDescription+"",a;return{c(){a=Mt(e)},l(o){a=zt(o,e)},m(o,c){Oe(o,a,c)},p:_r,d(o){o&&ie(a)}}}function AT(s){let e,a;return e=new u1({props:{$$slots:{default:[IT]},$$scope:{ctx:s}}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c[1]&8&&(h.$$scope={dirty:c,ctx:o}),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function Py(s){let e,a;return e=new c1({props:{title:kg(s[28].key),table:s[28],data:s[0],chart_type:s[5]}}),{c(){ir(e.$$.fragment)},l(o){cr(e.$$.fragment,o)},m(o,c){nr(e,o,c),a=!0},p(o,c){const h={};c[0]&1&&(h.title=kg(o[28].key)),c[0]&1&&(h.table=o[28]),c[0]&1&&(h.data=o[0]),e.$set(h)},i(o){a||(Ge(e.$$.fragment,o),a=!0)},o(o){it(e.$$.fragment,o),a=!1},d(o){sr(e,o)}}}function PT(s){let e,a,o,c;e=new qs({props:{colspan:3,noBackground:!0,$$slots:{default:[AT]},$$scope:{ctx:s}}});let h=s[25].tables.filter(s[16]),f=[];for(let d=0;d<h.length;d+=1)f[d]=Py(by(s,h,d));const i=d=>it(f[d],1,1,()=>{f[d]=null});return{c(){ir(e.$$.fragment),a=St();for(let d=0;d<f.length;d+=1)f[d].c();o=St()},l(d){cr(e.$$.fragment,d),a=kt(d);for(let g=0;g<f.length;g+=1)f[g].l(d);o=kt(d)},m(d,g){nr(e,d,g),Oe(d,a,g);for(let b=0;b<f.length;b+=1)f[b]&&f[b].m(d,g);Oe(d,o,g),c=!0},p(d,g){const b={};if(g[1]&8&&(b.$$scope={dirty:g,ctx:d}),e.$set(b),g[0]&33){h=d[25].tables.filter(d[16]);let k;for(k=0;k<h.length;k+=1){const x=by(d,h,k);f[k]?(f[k].p(x,g),Ge(f[k],1)):(f[k]=Py(x),f[k].c(),Ge(f[k],1),f[k].m(o.parentNode,o))}for(Vr(),k=h.length;k<f.length;k+=1)i(k);$r()}},i(d){if(!c){Ge(e.$$.fragment,d);for(let g=0;g<h.length;g+=1)Ge(f[g]);c=!0}},o(d){it(e.$$.fragment,d),f=f.filter(Boolean);for(let g=0;g<f.length;g+=1)it(f[g]);c=!1},d(d){sr(e,d),d&&ie(a),Vi(f,d),d&&ie(o)}}}function My(s){let e=s[25].tables.some(s[11]),a,o,c=e&&Ay(s);return{c(){c&&c.c(),a=Qt()},l(h){c&&c.l(h),a=Qt()},m(h,f){c&&c.m(h,f),Oe(h,a,f),o=!0},p(h,f){f[0]&1&&(e=h[25].tables.some(h[11])),e?c?(c.p(h,f),f[0]&1&&Ge(c,1)):(c=Ay(h),c.c(),Ge(c,1),c.m(a.parentNode,a)):c&&(Vr(),it(c,1,1,()=>{c=null}),$r())},i(h){o||(Ge(c),o=!0)},o(h){it(c),o=!1},d(h){c&&c.d(h),h&&ie(a)}}}function MT(s){let e,a,o,c,h,f,i,d,g,b,k,x,S,E;g=new mb({props:{links:[{label:"Census",href:"/census"},{label:"Create a population group profile"}]}}),k=new jb({props:{title:"Create a population group profile",$$slots:{after:[xT]},$$scope:{ctx:s}}});let T=s[3]=="success"&&s[1].length>0&&Ty(s);return{c(){e=Ve("meta"),a=Ve("meta"),o=Ve("meta"),c=Ve("meta"),h=Ve("meta"),f=Ve("meta"),i=Ve("meta"),d=St(),ir(g.$$.fragment),b=St(),ir(k.$$.fragment),x=St(),T&&T.c(),S=Qt(),this.h()},l(A){const z=Vy("svelte-1fzc9rl",Us.head);e=$e(z,"META",{name:!0,content:!0}),a=$e(z,"META",{property:!0,content:!0}),o=$e(z,"META",{property:!0,content:!0}),c=$e(z,"META",{property:!0,content:!0}),h=$e(z,"META",{property:!0,content:!0}),f=$e(z,"META",{property:!0,content:!0}),i=$e(z,"META",{name:!0,content:!0}),z.forEach(ie),d=kt(A),cr(g.$$.fragment,A),b=kt(A),cr(k.$$.fragment,A),x=kt(A),T&&T.l(A),S=Qt(),this.h()},h(){Us.title="Create a population group profile",ve(e,"name","description"),ve(e,"content",""),ve(a,"property","og:title"),ve(a,"content","Create a population group profile"),ve(o,"property","og:type"),ve(o,"content","website"),ve(c,"property","og:url"),ve(c,"content",Td),ve(h,"property","og:image:type"),ve(h,"content","image/jpeg"),ve(f,"property","og:description"),ve(f,"content",""),ve(i,"name","description"),ve(i,"content","")},m(A,z){Me(Us.head,e),Me(Us.head,a),Me(Us.head,o),Me(Us.head,c),Me(Us.head,h),Me(Us.head,f),Me(Us.head,i),Oe(A,d,z),nr(g,A,z),Oe(A,b,z),nr(k,A,z),Oe(A,x,z),T&&T.m(A,z),Oe(A,S,z),E=!0},p(A,z){const D={};z[0]&31|z[1]&8&&(D.$$scope={dirty:z,ctx:A}),k.$set(D),A[3]=="success"&&A[1].length>0?T?(T.p(A,z),z[0]&10&&Ge(T,1)):(T=Ty(A),T.c(),Ge(T,1),T.m(S.parentNode,S)):T&&(Vr(),it(T,1,1,()=>{T=null}),$r())},i(A){E||(Ge(g.$$.fragment,A),Ge(k.$$.fragment,A),Ge(T),E=!0)},o(A){it(g.$$.fragment,A),it(k.$$.fragment,A),it(T),E=!1},d(A){ie(e),ie(a),ie(o),ie(c),ie(h),ie(f),ie(i),A&&ie(d),sr(g,A),A&&ie(b),sr(k,A),A&&ie(x),T&&T.d(A),A&&ie(S)}}}let zT="light";function DT(s){let e=[];s.forEach(o=>e.push(o[0]));const a=s.flat().pop();return(s.length===1||a!=e[e.length-1])&&e.push(a),e}function Ku(s,e){const a=e.selected.residents[s].values;return a!=="blocked"&&a!==void 0}function zy(s,e,a){for(const o of e)Ku(o,s)?++a.available:s.selected.residents[o].values!==void 0&&++a.missing}const Dy=s=>s.key;function LT(s,e,a){let o;lh(s,ib,de=>a(18,o=de));let{data:c}=e;eo("theme",eb[zT]);let h=[],f=!1,i="success",d=!1,g=_x;function b(){ox(`${Td}?${h.map(de=>`${de.key}=${de.code}`).join("&")}`,{noScroll:!0,keepFocus:!0})}function k(de,Ee){a(1,h=[...h.filter(ot=>ot.topic!==de.shortLabel),{topic:de.shortLabel,key:de.key,...Ee}]),a(2,f=!1),b()}function x(de){a(1,h=h.filter(Ee=>Ee.topic!==de.shortLabel)),b()}function S(de){a(1,h=h.filter(Ee=>Ee.topic!=de)),b()}function E(de){let Ee={available:0,missing:0};for(const ot of Qa[0].tablesCategorised)zy(de,ot.tables.map(le=>le.code),Ee);return zy(de,["sex","resident_age_18b"],Ee),Ee}function T(de){const Ee={coverSheetTitle:"Data Downloaded from 'Create a Population Group Profile'",coverSheetContents:["## Source","Census 2021 from the Office for National Statistics"],tableHeadings:["Category","Selected group %","England and Wales %","Selected group count","England and Wales count"],sheets:[]};let ot=de.geoPerc.filter(Y=>Y.value!=null);ot.length>0&&Ee.sheets.push({sheetName:"Percentage of Population, by Local Authority",tableName:"percentage_of_population",sheetIntroText:["Source: Census 2021 from the Office for National Statistics"],columns:[{heading:"Local Authority",style:"text",values:ot.map(Y=>Y.name)},{heading:"% of Local Authority Population",style:"number_1dp",values:ot.map(Y=>Y.value)},{heading:"Count",style:"number_with_commas",values:ot.map(Y=>Y.count)}]});for(let Y of Qa[0].tables){if(Y.code==="resident_age_23a"||!Ku(Y.code,de)||de.selected.residents[Y.code].values==null)continue;let Qe={sheetName:Y.key,tableName:Y.code,sheetIntroText:["Source: Census 2021 from the Office for National Statistics"],columns:[{heading:"Category",style:"text",values:qf[Y.code].map(pt=>pt.label)},{heading:`Selected group
(%)`,style:"number_1dp",values:de.selected.residents[Y.code].values.percent},{heading:`England and Wales
(%)`,style:"number_1dp",values:de.all.residents[Y.code].values.percent},{heading:`Selected group
(count)`,style:"number_with_commas",values:de.selected.residents[Y.code].values.count},{heading:`England and Wales
(count)`,style:"number_with_commas",values:de.all.residents[Y.code].values.count}]};Ee.sheets.push(Qe)}console.log({data:de,vars:Hm,datasets:Qa,codes:qf,odsData:Ee});let le=cT(Ee);const Ne=new Zk;for(let{filename:Y,contents:Qe}of le)Ne.file(Y,Qe);Ne.generateAsync({type:"blob"}).then(Y=>{let Qe=new Blob([Y],{type:"application/vnd.oasis.opendocument.spreadsheet"}),pt=URL.createObjectURL(Qe);var dt=document.createElement("a");dt.setAttribute("href",pt),dt.setAttribute("download","data-download.ods"),dt.style.display="none",document.body.appendChild(dt),dt.click(),document.body.removeChild(dt),URL.revokeObjectURL(pt)})}function A(de){a(0,c.selected=de.data,c),a(0,c.selected.total_pop=de.total_pop,c),a(0,c.geoPerc=[],c);let Ee;c.geoCodesAndNames.forEach(({code:le,name:Ne})=>{let Y=h.length===0?100:de.mapData[le]!=null?de.mapData[le][1]:null,Qe=h.length===0?-1:de.mapData[le]!=null?de.mapData[le][0]:null;c.geoPerc.push({code:le,name:Ne,value:Y,count:Qe})});let ot=c.geoPerc.map(le=>le.value).filter(le=>le!=null);if(Ee=ot.length===0?null:fx(ot,Math.min(5,ot.length)),!Ee)c.geoPerc.forEach(le=>le.color=Vo.nodata),a(0,c.geoBreaks=[0,100],c);else if(h.length===0)c.geoPerc.forEach(le=>le.color=Vo.seq[4]),a(0,c.geoBreaks=[100,100],c);else{let le=DT(Ee);c.geoPerc.forEach(Ne=>Ne.color=Ne.value!=null?nx(Ne.value,le,Vo.seq):Vo.nodata),a(0,c.geoBreaks=le,c)}h.length,a(3,i=c.selected.total_pop.count==null?"failed":"success")}function z(){a(3,i="loading"),a(4,d=h&&h.some(de=>["Aged 4 years and under","Aged 5 to 9 years","Aged 10 to 14 years","Aged 15 years and under"].includes(de.label))),Zy(Qa,h).then(A)}function D(){a(1,h=[]);for(let de of o.url.searchParams.entries()){let Ee=Hm.find(le=>le.key==de[0]);if(!Ee)continue;let ot=Ee.cats.find(le=>le.code==de[1]);ot&&h.push({topic:Ee.shortLabel,key:Ee.key,...ot})}z()}lx(D);const F=de=>Ku(de.code,c),$=de=>S(de.topic);function q(de){f=de,a(2,f)}const J=()=>T(c),G=()=>print(),oe=de=>Ku(de.code,c);return s.$$set=de=>{"data"in de&&a(0,c=de.data)},s.$$.update=()=>{s.$$.dirty[0]&2&&console.log("selected",h)},[c,h,f,i,d,g,k,x,S,E,T,F,$,q,J,G,oe]}class jT extends Wr{constructor(e){super(),Kr(this,e,LT,MT,jr,{data:0},null,[-1,-1])}}export{jT as component,VT as universal};
