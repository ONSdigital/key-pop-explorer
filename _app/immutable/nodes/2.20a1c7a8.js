import{T as rp,c as wg,m as tf,a as Tg,l as Ga,b as Uo,d as tc,p as rf,e as Za,f as kg,g as Eg,t as Sg,v as Ig,h as Cg}from"../chunks/Table.svelte_svelte_type_style_lang.078a35ac.js";import{b as Eu}from"../chunks/paths.d902e451.js";import{S as fi,i as di,s as ti,e as xt,b as ge,v as ui,d as Be,f as hi,g as Ee,h as X,y as kt,z as Ct,A as Et,B as St,C as $i,k as xe,a as qe,l as be,m as we,c as Ze,n as ee,P as gt,E as ue,G as er,H as tr,I as ir,T as rr,L as Dn,M as Ln,q as nt,r as st,u as Gt,D as np,F as sp,W as so,p as He,O as ic,J as oo,K as ac,X as rc,N as Bt,Y as op,Z as ap,_ as Su,Q as ts,$ as lp,a0 as cp,U as Ag,w as lc,a1 as Iu,a2 as Cu,V as up,o as Au,a3 as cc,a4 as zg,x as nf}from"../chunks/index.c7c35ed9.js";import{p as Mg}from"../chunks/stores.3561591b.js";import{w as hp,h as fp}from"../chunks/singletons.8c1dd8f0.js";function Pg(d){let n,c;return n=new rp({props:{id:d[0],cls:d[1],theme:d[6],background:d[8],overrides:d[7],$$slots:{default:[Lg]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.id=l[0]),h&2&&(_.cls=l[1]),h&64&&(_.theme=l[6]),h&256&&(_.background=l[8]),h&128&&(_.overrides=l[7]),h&5692&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function Dg(d){let n,c;return n=new rp({props:{id:d[0],cls:d[1],theme:d[6],background:d[8],overrides:d[7],$$slots:{default:[Bg]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.id=l[0]),h&2&&(_.cls=l[1]),h&64&&(_.theme=l[6]),h&256&&(_.background=l[8]),h&128&&(_.overrides=l[7]),h&5692&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function sf(d){let n;return{c(){n=xe("div"),this.h()},l(c){n=be(c,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","ons-spacer")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function of(d){let n;return{c(){n=xe("div"),this.h()},l(c){n=be(c,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","ons-spacer")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function Lg(d){let n,c,l,h,_,x=d[4]&&sf();const o=d[11].default,b=$i(o,d,d[12],null);let E=d[5]&&of();return{c(){n=xe("div"),x&&x.c(),c=qe(),b&&b.c(),l=qe(),E&&E.c(),this.h()},l(I){n=be(I,"DIV",{id:!0,class:!0});var P=we(n);x&&x.l(P),c=Ze(P),b&&b.l(P),l=Ze(P),E&&E.l(P),P.forEach(X),this.h()},h(){ee(n,"id",d[10]),ee(n,"class",h="ons-page__container ons-container "+d[9]+" svelte-1i9f2l"),gt(n,"ons-page__container--wider",d[2]==="wider"),gt(n,"ons-page__container--full",d[2]==="full"),gt(n,"ons-page__container--tall-height",d[3]==="tall"),gt(n,"ons-page__container--full-height",d[3]==="full")},m(I,P){ge(I,n,P),x&&x.m(n,null),ue(n,c),b&&b.m(n,null),ue(n,l),E&&E.m(n,null),_=!0},p(I,P){I[4]?x||(x=sf(),x.c(),x.m(n,c)):x&&(x.d(1),x=null),b&&b.p&&(!_||P&4096)&&er(b,o,I,I[12],_?ir(o,I[12],P,null):tr(I[12]),null),I[5]?E||(E=of(),E.c(),E.m(n,null)):E&&(E.d(1),E=null),(!_||P&1024)&&ee(n,"id",I[10]),(!_||P&512&&h!==(h="ons-page__container ons-container "+I[9]+" svelte-1i9f2l"))&&ee(n,"class",h),(!_||P&516)&&gt(n,"ons-page__container--wider",I[2]==="wider"),(!_||P&516)&&gt(n,"ons-page__container--full",I[2]==="full"),(!_||P&520)&&gt(n,"ons-page__container--tall-height",I[3]==="tall"),(!_||P&520)&&gt(n,"ons-page__container--full-height",I[3]==="full")},i(I){_||(Ee(b,I),_=!0)},o(I){Be(b,I),_=!1},d(I){I&&X(n),x&&x.d(),b&&b.d(I),E&&E.d()}}}function af(d){let n;return{c(){n=xe("div"),this.h()},l(c){n=be(c,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","ons-spacer")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function lf(d){let n;return{c(){n=xe("div"),this.h()},l(c){n=be(c,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","ons-spacer")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function Bg(d){let n,c,l,h,_,x,o=d[4]&&af();const b=d[11].default,E=$i(b,d,d[12],null);let I=d[5]&&lf();return{c(){n=xe("div"),o&&o.c(),c=qe(),l=xe("div"),E&&E.c(),h=qe(),I&&I.c(),this.h()},l(P){n=be(P,"DIV",{id:!0,class:!0});var A=we(n);o&&o.l(A),c=Ze(A),l=be(A,"DIV",{class:!0});var V=we(l);E&&E.l(V),V.forEach(X),h=Ze(A),I&&I.l(A),A.forEach(X),this.h()},h(){ee(l,"class","svelte-1i9f2l"),gt(l,"ons-page__container--narrow",d[2]==="narrow"),gt(l,"ons-page__container--medium",d[2]==="medium"),ee(n,"id",d[10]),ee(n,"class",_="ons-page__container ons-container "+d[9]+" svelte-1i9f2l"),gt(n,"ons-page__container--tall-height",d[3]==="tall"),gt(n,"ons-page__container--full-height",d[3]==="full")},m(P,A){ge(P,n,A),o&&o.m(n,null),ue(n,c),ue(n,l),E&&E.m(l,null),ue(n,h),I&&I.m(n,null),x=!0},p(P,A){P[4]?o||(o=af(),o.c(),o.m(n,c)):o&&(o.d(1),o=null),E&&E.p&&(!x||A&4096)&&er(E,b,P,P[12],x?ir(b,P[12],A,null):tr(P[12]),null),(!x||A&4)&&gt(l,"ons-page__container--narrow",P[2]==="narrow"),(!x||A&4)&&gt(l,"ons-page__container--medium",P[2]==="medium"),P[5]?I||(I=lf(),I.c(),I.m(n,null)):I&&(I.d(1),I=null),(!x||A&1024)&&ee(n,"id",P[10]),(!x||A&512&&_!==(_="ons-page__container ons-container "+P[9]+" svelte-1i9f2l"))&&ee(n,"class",_),(!x||A&520)&&gt(n,"ons-page__container--tall-height",P[3]==="tall"),(!x||A&520)&&gt(n,"ons-page__container--full-height",P[3]==="full")},i(P){x||(Ee(E,P),x=!0)},o(P){Be(E,P),x=!1},d(P){P&&X(n),o&&o.d(),E&&E.d(P),I&&I.d()}}}function Rg(d){let n,c,l,h,_;const x=[Dg,Pg],o=[];function b(E,I){return I&4&&(n=null),n==null&&(n=!!["narrow","medium"].includes(E[2])),n?0:1}return c=b(d,-1),l=o[c]=x[c](d),{c(){l.c(),h=xt()},l(E){l.l(E),h=xt()},m(E,I){o[c].m(E,I),ge(E,h,I),_=!0},p(E,[I]){let P=c;c=b(E,I),c===P?o[c].p(E,I):(ui(),Be(o[P],1,1,()=>{o[P]=null}),hi(),l=o[c],l?l.p(E,I):(l=o[c]=x[c](E),l.c()),Ee(l,1),l.m(h.parentNode,h))},i(E){_||(Ee(l),_=!0)},o(E){Be(l),_=!1},d(E){o[c].d(E),E&&X(h)}}}function Fg(d,n,c){let l,h,{$$slots:_={},$$scope:x}=n,{id:o=null}=n,{cls:b=null}=n,{width:E="wide"}=n,{height:I="auto"}=n,{marginTop:P=!1}=n,{marginBottom:A=!1}=n,{theme:V=null}=n,{themeOverrides:U=null}=n,{background:F=null}=n;return d.$$set=Q=>{"id"in Q&&c(0,o=Q.id),"cls"in Q&&c(1,b=Q.cls),"width"in Q&&c(2,E=Q.width),"height"in Q&&c(3,I=Q.height),"marginTop"in Q&&c(4,P=Q.marginTop),"marginBottom"in Q&&c(5,A=Q.marginBottom),"theme"in Q&&c(6,V=Q.theme),"themeOverrides"in Q&&c(7,U=Q.themeOverrides),"background"in Q&&c(8,F=Q.background),"$$scope"in Q&&c(12,x=Q.$$scope)},d.$$.update=()=>{d.$$.dirty&321&&c(10,l=o&&!(V||F)?o:null),d.$$.dirty&322&&c(9,h=b&&!(V||F)?b:"")},[o,b,E,I,P,A,V,U,F,h,l,_,x]}class uc extends fi{constructor(n){super(),di(this,n,Fg,Rg,ti,{id:0,cls:1,width:2,height:3,marginTop:4,marginBottom:5,theme:6,themeOverrides:7,background:8})}}var Og=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dp(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function cf(d,n,c){const l=d.slice();return l[5]=n[c],l}function Vg(d){let n=d[5].label+"",c;return{c(){c=nt(n)},l(l){c=st(l,n)},m(l,h){ge(l,c,h)},p(l,h){h&1&&n!==(n=l[5].label+"")&&Gt(c,n)},d(l){l&&X(c)}}}function Ug(d){let n,c=d[5].label+"",l,h;return{c(){n=xe("a"),l=nt(c),this.h()},l(_){n=be(_,"A",{class:!0,href:!0});var x=we(n);l=st(x,c),x.forEach(X),this.h()},h(){ee(n,"class","ons-breadcrumb__link"),ee(n,"href",h=d[5].href)},m(_,x){ge(_,n,x),ue(n,l)},p(_,x){x&1&&c!==(c=_[5].label+"")&&Gt(l,c),x&1&&h!==(h=_[5].href)&&ee(n,"href",h)},d(_){_&&X(n)}}}function uf(d){let n,c,l,h,_;function x(E,I){return E[5].href?Ug:Vg}let o=x(d),b=o(d);return{c(){n=xe("li"),b.c(),c=qe(),l=Dn("svg"),h=Dn("path"),_=qe(),this.h()},l(E){n=be(E,"LI",{class:!0});var I=we(n);b.l(I),c=Ze(I),l=Ln(I,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0});var P=we(l);h=Ln(P,"path",{d:!0,transform:!0}),we(h).forEach(X),P.forEach(X),_=Ze(I),I.forEach(X),this.h()},h(){ee(h,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),ee(h,"transform","translate(-5.02 -1.59)"),ee(l,"class","ons-svg-icon svelte-w4p0hu"),ee(l,"viewBox","0 0 8 13"),ee(l,"xmlns","http://www.w3.org/2000/svg"),ee(l,"focusable","false"),ee(n,"class","ons-breadcrumb__item ons-u-p-no")},m(E,I){ge(E,n,I),b.m(n,null),ue(n,c),ue(n,l),ue(l,h),ue(n,_)},p(E,I){o===(o=x(E))&&b?b.p(E,I):(b.d(1),b=o(E),b&&(b.c(),b.m(n,c)))},d(E){E&&X(n),b.d()}}}function Ng(d){let n,c,l=d[0],h=[];for(let _=0;_<l.length;_+=1)h[_]=uf(cf(d,l,_));return{c(){n=xe("nav"),c=xe("ol");for(let _=0;_<h.length;_+=1)h[_].c();this.h()},l(_){n=be(_,"NAV",{class:!0,"aria-label":!0});var x=we(n);c=be(x,"OL",{class:!0});var o=we(c);for(let b=0;b<h.length;b+=1)h[b].l(o);o.forEach(X),x.forEach(X),this.h()},h(){ee(c,"class","ons-breadcrumb__items ons-u-fs-s"),ee(n,"class","ons-breadcrumb print--hide"),ee(n,"aria-label","Breadcrumbs")},m(_,x){ge(_,n,x),ue(n,c);for(let o=0;o<h.length;o+=1)h[o]&&h[o].m(c,null)},p(_,x){if(x&1){l=_[0];let o;for(o=0;o<l.length;o+=1){const b=cf(_,l,o);h[o]?h[o].p(b,x):(h[o]=uf(b),h[o].c(),h[o].m(c,null))}for(;o<h.length;o+=1)h[o].d(1);h.length=l.length}},d(_){_&&X(n),rr(h,_)}}}function jg(d){let n,c;return n=new uc({props:{theme:d[2],themeOverrides:d[3],width:d[1],background:d[4],$$slots:{default:[Ng]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,[h]){const _={};h&4&&(_.theme=l[2]),h&8&&(_.themeOverrides=l[3]),h&2&&(_.width=l[1]),h&16&&(_.background=l[4]),h&257&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function Gg(d,n,c){let{links:l=[]}=n,{width:h="wide"}=n,{theme:_=null}=n,{themeOverrides:x=null}=n,{background:o=null}=n;return d.$$set=b=>{"links"in b&&c(0,l=b.links),"width"in b&&c(1,h=b.width),"theme"in b&&c(2,_=b.theme),"themeOverrides"in b&&c(3,x=b.themeOverrides),"background"in b&&c(4,o=b.background)},[l,h,_,x,o]}class qg extends fi{constructor(n){super(),di(this,n,Gg,jg,ti,{links:0,width:1,theme:2,themeOverrides:3,background:4})}}function hf(d){let n,c;return{c(){n=xe("h2"),c=nt(d[3]),this.h()},l(l){n=be(l,"H2",{class:!0});var h=we(n);c=st(h,d[3]),h.forEach(X),this.h()},h(){ee(n,"class","section-title"),gt(n,"ons-u-vh",d[4])},m(l,h){ge(l,n,h),ue(n,c)},p(l,h){h&8&&Gt(c,l[3]),h&16&&gt(n,"ons-u-vh",l[4])},d(l){l&&X(n)}}}function Zg(d){let n,c,l,h=d[3]&&hf(d);const _=d[18].default,x=$i(_,d,d[20],null);return{c(){h&&h.c(),n=qe(),c=xe("div"),x&&x.c(),this.h()},l(o){h&&h.l(o),n=Ze(o),c=be(o,"DIV",{class:!0});var b=we(c);x&&x.l(b),b.forEach(X),this.h()},h(){ee(c,"class","grid "+d[12]+" svelte-1og4gya"),He(c,"grid-gap",d[14]),He(c,"min-height",d[13])},m(o,b){h&&h.m(o,b),ge(o,n,b),ge(o,c,b),x&&x.m(c,null),l=!0},p(o,b){o[3]?h?h.p(o,b):(h=hf(o),h.c(),h.m(n.parentNode,n)):h&&(h.d(1),h=null),x&&x.p&&(!l||b&1048576)&&er(x,_,o,o[20],l?ir(_,o[20],b,null):tr(o[20]),null)},i(o){l||(Ee(x,o),l=!0)},o(o){Be(x,o),l=!1},d(o){h&&h.d(o),o&&X(n),o&&X(c),x&&x.d(o)}}}function ff(d){let n,c,l;return c=new uc({props:{cls:d[1],theme:d[5],themeOverrides:d[6],width:"narrow",marginBottom:d[8],$$slots:{default:[Xg]},$$scope:{ctx:d}}}),{c(){n=xe("figcaption"),kt(c.$$.fragment),this.h()},l(h){n=be(h,"FIGCAPTION",{class:!0});var _=we(n);Ct(c.$$.fragment,_),_.forEach(X),this.h()},h(){ee(n,"class","svelte-1og4gya")},m(h,_){ge(h,n,_),Et(c,n,null),l=!0},p(h,_){const x={};_&2&&(x.cls=h[1]),_&32&&(x.theme=h[5]),_&64&&(x.themeOverrides=h[6]),_&256&&(x.marginBottom=h[8]),_&1049088&&(x.$$scope={dirty:_,ctx:h}),c.$set(x)},i(h){l||(Ee(c.$$.fragment,h),l=!0)},o(h){Be(c.$$.fragment,h),l=!1},d(h){h&&X(n),St(c)}}}function Xg(d){let n;return{c(){n=xe("span"),this.h()},l(c){n=be(c,"SPAN",{class:!0});var l=we(n);l.forEach(X),this.h()},h(){ee(n,"class","ons-figure__caption")},m(c,l){ge(c,n,l),n.innerHTML=d[9]},p(c,l){l&512&&(n.innerHTML=c[9])},d(c){c&&X(n)}}}function Hg(d){let n,c,l,h,_;c=new uc({props:{id:d[0],cls:d[1],theme:d[5],themeOverrides:d[6],width:d[2],height:["tall","full"].includes(d[10])?d[10]:"auto",marginTop:d[7],marginBottom:d[9]?!1:d[8],$$slots:{default:[Zg]},$$scope:{ctx:d}}});let x=d[9]&&ff(d);return{c(){n=xe("figure"),kt(c.$$.fragment),l=qe(),x&&x.c(),this.h()},l(o){n=be(o,"FIGURE",{"aria-label":!0,class:!0});var b=we(n);Ct(c.$$.fragment,b),l=Ze(b),x&&x.l(b),b.forEach(X),this.h()},h(){ee(n,"aria-label",d[9]),ee(n,"class","svelte-1og4gya"),np(()=>d[19].call(n))},m(o,b){ge(o,n,b),Et(c,n,null),ue(n,l),x&&x.m(n,null),h=sp(n,d[19].bind(n)),_=!0},p(o,[b]){const E={};b&1&&(E.id=o[0]),b&2&&(E.cls=o[1]),b&32&&(E.theme=o[5]),b&64&&(E.themeOverrides=o[6]),b&4&&(E.width=o[2]),b&1024&&(E.height=["tall","full"].includes(o[10])?o[10]:"auto"),b&128&&(E.marginTop=o[7]),b&768&&(E.marginBottom=o[9]?!1:o[8]),b&1048600&&(E.$$scope={dirty:b,ctx:o}),c.$set(E),o[9]?x?(x.p(o,b),b&512&&Ee(x,1)):(x=ff(o),x.c(),Ee(x,1),x.m(n,null)):x&&(ui(),Be(x,1,1,()=>{x=null}),hi()),(!_||b&512)&&ee(n,"aria-label",o[9])},i(o){_||(Ee(c.$$.fragment,o),Ee(x),_=!0)},o(o){Be(c.$$.fragment,o),Be(x),_=!1},d(o){o&&X(n),St(c),x&&x.d(),h()}}}function Wg(d,n,c){let l,{$$slots:h={},$$scope:_}=n,{id:x=null}=n,{cls:o=null}=n,{width:b="medium"}=n,{title:E=""}=n,{hideTitle:I=!1}=n,{theme:P=null}=n,{themeOverrides:A=null}=n,{marginTop:V=!1}=n,{marginBottom:U=!0}=n,{colwidth:F="medium"}=n,{caption:Q=""}=n,{height:pe=200}=n,{gap:ae=12}=n,Se=!F||F==="full"?"":`grid-${F}`,Ge=pe==="full"?"100vh":Number.isNaN(pe)?pe:pe+"px",ze=Number.isNaN(ae)?ae:ae+"px";const Oe={narrow:{w:180,c:4},medium:{w:280,c:3},wide:{w:400,c:2},full:{w:"100%",c:1}};let Me;const Ue=hp(Oe[F].c);so("cols",Ue);function zt(){Me=this.clientWidth,c(11,Me)}return d.$$set=dt=>{"id"in dt&&c(0,x=dt.id),"cls"in dt&&c(1,o=dt.cls),"width"in dt&&c(2,b=dt.width),"title"in dt&&c(3,E=dt.title),"hideTitle"in dt&&c(4,I=dt.hideTitle),"theme"in dt&&c(5,P=dt.theme),"themeOverrides"in dt&&c(6,A=dt.themeOverrides),"marginTop"in dt&&c(7,V=dt.marginTop),"marginBottom"in dt&&c(8,U=dt.marginBottom),"colwidth"in dt&&c(15,F=dt.colwidth),"caption"in dt&&c(9,Q=dt.caption),"height"in dt&&c(10,pe=dt.height),"gap"in dt&&c(16,ae=dt.gap),"$$scope"in dt&&c(20,_=dt.$$scope)},d.$$.update=()=>{d.$$.dirty&100352&&c(17,l=F=="full"?1:Me?Math.floor((Me+ae)/(Oe[F].w+ae)):Oe[F].c),d.$$.dirty&131072&&Ue.set(l)},[x,o,b,E,I,P,A,V,U,Q,pe,Me,Se,Ge,ze,F,ae,l,h,zt,_]}class Kg extends fi{constructor(n){super(),di(this,n,Wg,Hg,ti,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:15,caption:9,height:10,gap:16})}}function Jg(d){let n;const c=d[13].default,l=$i(c,d,d[14],null);return{c(){l&&l.c()},l(h){l&&l.l(h)},m(h,_){l&&l.m(h,_),n=!0},p(h,_){l&&l.p&&(!n||_&16384)&&er(l,c,h,h[14],n?ir(c,h[14],_,null):tr(h[14]),null)},i(h){n||(Ee(l,h),n=!0)},o(h){Be(l,h),n=!1},d(h){l&&l.d(h)}}}function Yg(d){let n,c;return n=new Kg({props:{id:d[0],cls:d[1],width:d[2],height:d[10],title:d[3],hideTitle:d[4],theme:d[5],themeOverrides:d[6],marginTop:d[7],marginBottom:d[8],colwidth:d[9],gap:d[11],$$slots:{default:[Jg]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,[h]){const _={};h&1&&(_.id=l[0]),h&2&&(_.cls=l[1]),h&4&&(_.width=l[2]),h&1024&&(_.height=l[10]),h&8&&(_.title=l[3]),h&16&&(_.hideTitle=l[4]),h&32&&(_.theme=l[5]),h&64&&(_.themeOverrides=l[6]),h&128&&(_.marginTop=l[7]),h&256&&(_.marginBottom=l[8]),h&512&&(_.colwidth=l[9]),h&2048&&(_.gap=l[11]),h&16384&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function Qg(d,n,c){let{$$slots:l={},$$scope:h}=n,{id:_=null}=n,{cls:x="ons-cards"}=n,{width:o="wide"}=n,{title:b=""}=n,{hideTitle:E=!1}=n,{theme:I=null}=n,{themeOverrides:P=null}=n,{marginTop:A=!1}=n,{marginBottom:V=!0}=n,{colwidth:U="medium"}=n,{height:F=200}=n,{noBackground:Q=!1}=n,{gap:pe=Q?36:16}=n;return so("noBackground",Q),d.$$set=ae=>{"id"in ae&&c(0,_=ae.id),"cls"in ae&&c(1,x=ae.cls),"width"in ae&&c(2,o=ae.width),"title"in ae&&c(3,b=ae.title),"hideTitle"in ae&&c(4,E=ae.hideTitle),"theme"in ae&&c(5,I=ae.theme),"themeOverrides"in ae&&c(6,P=ae.themeOverrides),"marginTop"in ae&&c(7,A=ae.marginTop),"marginBottom"in ae&&c(8,V=ae.marginBottom),"colwidth"in ae&&c(9,U=ae.colwidth),"height"in ae&&c(10,F=ae.height),"noBackground"in ae&&c(12,Q=ae.noBackground),"gap"in ae&&c(11,pe=ae.gap),"$$scope"in ae&&c(14,h=ae.$$scope)},[_,x,o,b,E,I,P,A,V,U,F,pe,Q,l,h]}class zu extends fi{constructor(n){super(),di(this,n,Qg,Yg,ti,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:9,height:10,noBackground:12,gap:11})}}const df=()=>Math.random().toString(16).slice(2,8),$g=(d,n=!1)=>typeof d=="string"?d.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").concat(n?`-${df()}`:""):df(),e_=d=>{if(!d)return!1;const n=new Date(d);return!isNaN(n)},pf=(d,n="en-GB",c={year:"numeric",month:"long",day:"2-digit"})=>new Date(d).toLocaleDateString(n,c);function t_(d){let n,c;return{c(){n=xe("h3"),c=nt(d[0]),this.h()},l(l){n=be(l,"H3",{class:!0});var h=we(n);c=st(h,d[0]),h.forEach(X),this.h()},h(){ee(n,"class","ons-card__title ons-u-fs-m"),gt(n,"ons-u-vh",d[2]),He(n,"padding",d[8]?"":"8px 16px 0"),He(n,"margin-bottom","5px")},m(l,h){ge(l,n,h),ue(n,c)},p(l,h){h&1&&Gt(c,l[0]),h&4&&gt(n,"ons-u-vh",l[2]),h&256&&He(n,"padding",l[8]?"":"8px 16px 0")},d(l){l&&X(n)}}}function i_(d){let n,c,l,h,_=d[3]&&mf(d);return{c(){n=xe("a"),_&&_.c(),c=qe(),l=xe("h3"),h=nt(d[0]),this.h()},l(x){n=be(x,"A",{href:!0,class:!0});var o=we(n);_&&_.l(o),c=Ze(o),l=be(o,"H3",{class:!0});var b=we(l);h=st(b,d[0]),b.forEach(X),o.forEach(X),this.h()},h(){ee(l,"class","ons-card__title ons-u-fs-m"),He(l,"padding",!d[8]&&!d[3]?"12px 16px 0":d[8]?"":"0 16px"),ee(n,"href",d[5]),ee(n,"class","ons-card__link ons-u-db"),gt(n,"ons-u-vh",d[2])},m(x,o){ge(x,n,o),_&&_.m(n,null),ue(n,c),ue(n,l),ue(l,h)},p(x,o){x[3]?_?_.p(x,o):(_=mf(x),_.c(),_.m(n,c)):_&&(_.d(1),_=null),o&1&&Gt(h,x[0]),o&264&&He(l,"padding",!x[8]&&!x[3]?"12px 16px 0":x[8]?"":"0 16px"),o&32&&ee(n,"href",x[5]),o&4&&gt(n,"ons-u-vh",x[2])},d(x){x&&X(n),_&&_.d()}}}function mf(d){let n,c;return{c(){n=xe("img"),this.h()},l(l){n=be(l,"IMG",{class:!0,src:!0,alt:!0,loading:!0}),this.h()},h(){ee(n,"class","ons-card__image ons-u-mb-s svelte-k1nrya"),rc(n.src,c=d[3])||ee(n,"src",c),ee(n,"alt",d[4]),ee(n,"loading","lazy"),He(n,"width","100%")},m(l,h){ge(l,n,h)},p(l,h){h&8&&!rc(n.src,c=l[3])&&ee(n,"src",c),h&16&&ee(n,"alt",l[4])},d(l){l&&X(n)}}}function r_(d){let n,c,l,h,_,x,o,b=`span ${d[9]&&d[10]<3?d[10]:d[6]==1?1:d[6]>d[10]?d[10]:d[6]}`,E;function I(F,Q){if(F[5]&&F[0])return i_;if(F[0])return t_}let P=I(d),A=P&&P(d);const V=d[13].default,U=$i(V,d,d[12],null);return{c(){n=xe("div"),c=xe("div"),A&&A.c(),l=qe(),h=xe("div"),U&&U.c(),this.h()},l(F){n=be(F,"DIV",{class:!0});var Q=we(n);c=be(Q,"DIV",{id:!0,class:!0,"aria-describedby":!0});var pe=we(c);A&&A.l(pe),l=Ze(pe),h=be(pe,"DIV",{id:!0,class:!0});var ae=we(h);U&&U.l(ae),ae.forEach(X),pe.forEach(X),Q.forEach(X),this.h()},h(){ee(h,"id",_=d[1]+"_text"),ee(h,"class","svelte-k1nrya"),gt(h,"tile__body",!d[8]),ee(c,"id",d[1]),ee(c,"class","ons-card"),ee(c,"aria-describedby",x=d[1]+"_text"),ee(n,"class",o=ic(d[8]?"":"tile tile__content")+" svelte-k1nrya"),He(n,"grid-column",b),He(n,"grid-column-end",d[9]?d[10]+1:null),He(n,"grid-row",d[7]>1?`span ${d[7]}`:null)},m(F,Q){ge(F,n,Q),ue(n,c),A&&A.m(c,null),ue(c,l),ue(c,h),U&&U.m(h,null),E=!0},p(F,[Q]){P===(P=I(F))&&A?A.p(F,Q):(A&&A.d(1),A=P&&P(F),A&&(A.c(),A.m(c,l))),U&&U.p&&(!E||Q&4096)&&er(U,V,F,F[12],E?ir(V,F[12],Q,null):tr(F[12]),null),(!E||Q&2&&_!==(_=F[1]+"_text"))&&ee(h,"id",_),(!E||Q&256)&&gt(h,"tile__body",!F[8]),(!E||Q&2)&&ee(c,"id",F[1]),(!E||Q&2&&x!==(x=F[1]+"_text"))&&ee(c,"aria-describedby",x),(!E||Q&256&&o!==(o=ic(F[8]?"":"tile tile__content")+" svelte-k1nrya"))&&ee(n,"class",o),Q&1600&&b!==(b=`span ${F[9]&&F[10]<3?F[10]:F[6]==1?1:F[6]>F[10]?F[10]:F[6]}`)&&He(n,"grid-column",b),Q&1536&&He(n,"grid-column-end",F[9]?F[10]+1:null),Q&128&&He(n,"grid-row",F[7]>1?`span ${F[7]}`:null)},i(F){E||(Ee(U,F),E=!0)},o(F){Be(U,F),E=!1},d(F){F&&X(n),A&&A.d(),U&&U.d(F)}}}function n_(d,n,c){let l,{$$slots:h={},$$scope:_}=n,{title:x=null}=n,{id:o=$g(x)}=n,{hideTitle:b=!1}=n,{image:E=null}=n,{imageAlt:I=null}=n,{href:P=null}=n,{colspan:A=1}=n,{rowspan:V=1}=n,{noBackground:U=oo("noBackground")||!1}=n,{grow:F=!1}=n;const Q=oo("cols");return ac(d,Q,pe=>c(10,l=pe)),d.$$set=pe=>{"title"in pe&&c(0,x=pe.title),"id"in pe&&c(1,o=pe.id),"hideTitle"in pe&&c(2,b=pe.hideTitle),"image"in pe&&c(3,E=pe.image),"imageAlt"in pe&&c(4,I=pe.imageAlt),"href"in pe&&c(5,P=pe.href),"colspan"in pe&&c(6,A=pe.colspan),"rowspan"in pe&&c(7,V=pe.rowspan),"noBackground"in pe&&c(8,U=pe.noBackground),"grow"in pe&&c(9,F=pe.grow),"$$scope"in pe&&c(12,_=pe.$$scope)},[x,o,b,E,I,P,A,V,U,F,l,Q,_,h]}class es extends fi{constructor(n){super(),di(this,n,n_,r_,ti,{title:0,id:1,hideTitle:2,image:3,imageAlt:4,href:5,colspan:6,rowspan:7,noBackground:8,grow:9})}}function gf(d){let n,c;return{c(){n=xe("div"),c=nt("!"),this.h()},l(l){n=be(l,"DIV",{class:!0,"aria-hidden":!0});var h=we(n);c=st(h,"!"),h.forEach(X),this.h()},h(){ee(n,"class","ons-panel__icon"),ee(n,"aria-hidden","true")},m(l,h){ge(l,n,h),ue(n,c)},d(l){l&&X(n)}}}function _f(d){let n,c,l;return{c(){n=xe("p"),c=xe("strong"),l=nt(d[0])},l(h){n=be(h,"P",{});var _=we(n);c=be(_,"STRONG",{});var x=we(c);l=st(x,d[0]),x.forEach(X),_.forEach(X)},m(h,_){ge(h,n,_),ue(n,c),ue(c,l)},p(h,_){_&1&&Gt(l,h[0])},d(h){h&&X(n)}}}function s_(d){let n,c,l,h,_,x,o,b,E,I,P,A=d[1]&&gf(),V=d[0]&&_f(d);const U=d[5].default,F=$i(U,d,d[4],null);return{c(){n=xe("div"),c=xe("div"),A&&A.c(),l=qe(),h=xe("span"),_=nt("Important information:"),x=qe(),o=xe("div"),b=xe("div"),V&&V.c(),E=qe(),I=xe("p"),F&&F.c(),this.h()},l(Q){n=be(Q,"DIV",{class:!0,style:!0});var pe=we(n);c=be(pe,"DIV",{class:!0});var ae=we(c);A&&A.l(ae),l=Ze(ae),h=be(ae,"SPAN",{class:!0});var Se=we(h);_=st(Se,"Important information:"),Se.forEach(X),x=Ze(ae),o=be(ae,"DIV",{class:!0});var Ge=we(o);b=be(Ge,"DIV",{class:!0});var ze=we(b);V&&V.l(ze),E=Ze(ze),I=be(ze,"P",{class:!0});var Oe=we(I);F&&F.l(Oe),Oe.forEach(X),ze.forEach(X),Ge.forEach(X),ae.forEach(X),pe.forEach(X),this.h()},h(){ee(h,"class","ons-panel__assistive-text ons-u-vh"),ee(I,"class","ons-u-mb-no"),ee(b,"class","ons-u-fs-r default-line-height"),ee(o,"class","ons-panel__body"),ee(c,"class","ons-u-bg--tr"),gt(c,"ons-panel--warn",d[1]),ee(n,"class","ons-panel ons-panel--info ons-panel--no-title ons-u-mt-m ons-u-mb-l svelte-g4zlbx"),ee(n,"style",d[2])},m(Q,pe){ge(Q,n,pe),ue(n,c),A&&A.m(c,null),ue(c,l),ue(c,h),ue(h,_),ue(c,x),ue(c,o),ue(o,b),V&&V.m(b,null),ue(b,E),ue(b,I),F&&F.m(I,null),P=!0},p(Q,[pe]){Q[1]?A||(A=gf(),A.c(),A.m(c,l)):A&&(A.d(1),A=null),Q[0]?V?V.p(Q,pe):(V=_f(Q),V.c(),V.m(b,E)):V&&(V.d(1),V=null),F&&F.p&&(!P||pe&16)&&er(F,U,Q,Q[4],P?ir(U,Q[4],pe,null):tr(Q[4]),null),(!P||pe&2)&&gt(c,"ons-panel--warn",Q[1]),(!P||pe&4)&&ee(n,"style",Q[2])},i(Q){P||(Ee(F,Q),P=!0)},o(Q){Be(F,Q),P=!1},d(Q){Q&&X(n),A&&A.d(),V&&V.d(),F&&F.d(Q)}}}function o_(d,n,c){let l,{$$slots:h={},$$scope:_}=n,{title:x=null}=n,{important:o=!1}=n,{mode:b="info"}=n;return d.$$set=E=>{"title"in E&&c(0,x=E.title),"important"in E&&c(1,o=E.important),"mode"in E&&c(3,b=E.mode),"$$scope"in E&&c(4,_=E.$$scope)},d.$$.update=()=>{d.$$.dirty&8&&c(2,l=b==="success"?"background: var(--ons-color-success-tint); border-color: var(--ons-color-success);":b==="pending"?"background: var(--ons-color-pending-tint); border-color: var(--ons-color-pending);":b==="error"?"background: var(--ons-color-errors-tint); border-color: var(--ons-color-errors);":null)},[x,o,l,b,_,h]}class a_ extends fi{constructor(n){super(),di(this,n,o_,s_,ti,{title:0,important:1,mode:3})}}function yf(d,n,c){const l=d.slice();return l[1]=n[c],l[3]=c,l}function vf(d){let n,c=d[0],l=[];for(let h=0;h<c.length;h+=1)l[h]=bf(yf(d,c,h));return{c(){n=xe("dl");for(let h=0;h<l.length;h+=1)l[h].c();this.h()},l(h){n=be(h,"DL",{class:!0,title:!0,"aria-label":!0});var _=we(n);for(let x=0;x<l.length;x+=1)l[x].l(_);_.forEach(X),this.h()},h(){ee(n,"class","ons-metadata metadata__list ons-grid ons-grid--gutterless ons-u-cf ons-u-mb-m"),ee(n,"title","Dataset ID and release date information"),ee(n,"aria-label","Dataset ID and release date information")},m(h,_){ge(h,n,_);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(n,null)},p(h,_){if(_&1){c=h[0];let x;for(x=0;x<c.length;x+=1){const o=yf(h,c,x);l[x]?l[x].p(o,_):(l[x]=bf(o),l[x].c(),l[x].m(n,null))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){h&&X(n),rr(l,h)}}}function l_(d){let n,c=d[1].value+"",l;return{c(){n=new op(!1),l=xt(),this.h()},l(h){n=ap(h,!1),l=xt(),this.h()},h(){n.a=l},m(h,_){n.m(c,h,_),ge(h,l,_)},p(h,_){_&1&&c!==(c=h[1].value+"")&&n.p(c)},d(h){h&&X(l),h&&n.d()}}}function c_(d){let n,c=pf(d[1].value)+"",l,h,_,x,o=d[1].extra&&xf(d);return{c(){n=xe("time"),l=nt(c),_=qe(),o&&o.c(),x=xt(),this.h()},l(b){n=be(b,"TIME",{datetime:!0});var E=we(n);l=st(E,c),E.forEach(X),_=Ze(b),o&&o.l(b),x=xt(),this.h()},h(){ee(n,"datetime",h=new Date(d[1].value).toISOString())},m(b,E){ge(b,n,E),ue(n,l),ge(b,_,E),o&&o.m(b,E),ge(b,x,E)},p(b,E){E&1&&c!==(c=pf(b[1].value)+"")&&Gt(l,c),E&1&&h!==(h=new Date(b[1].value).toISOString())&&ee(n,"datetime",h),b[1].extra?o?o.p(b,E):(o=xf(b),o.c(),o.m(x.parentNode,x)):o&&(o.d(1),o=null)},d(b){b&&X(n),b&&X(_),o&&o.d(b),b&&X(x)}}}function xf(d){let n,c=d[1].extra+"",l;return{c(){n=new op(!1),l=xt(),this.h()},l(h){n=ap(h,!1),l=xt(),this.h()},h(){n.a=l},m(h,_){n.m(c,h,_),ge(h,l,_)},p(h,_){_&1&&c!==(c=h[1].extra+"")&&n.p(c)},d(h){h&&X(l),h&&n.d()}}}function bf(d){let n,c,l=d[1].key+"",h,_,x,o,b,E,I;function P(U,F){return F&1&&(b=null),b==null&&(b=!!e_(U[1].value)),b?c_:l_}let A=P(d,-1),V=A(d);return{c(){n=xe("div"),c=xe("dt"),h=nt(l),_=nt(":"),x=qe(),o=xe("dd"),V.c(),E=qe(),this.h()},l(U){n=be(U,"DIV",{class:!0});var F=we(n);c=be(F,"DT",{class:!0});var Q=we(c);h=st(Q,l),_=st(Q,":"),Q.forEach(X),x=Ze(F),o=be(F,"DD",{class:!0});var pe=we(o);V.l(pe),pe.forEach(X),E=Ze(F),F.forEach(X),this.h()},h(){ee(c,"class","ons-metadata__term ons-u-mr-xs"),ee(o,"class","ons-metadata__value ons-u-f-no"),ee(n,"class",I="ons-grid__col ons-col-"+(d[1].col?d[1].col:12)+"@m"),gt(n,"ons-u-mt-xs",d[3]!==0)},m(U,F){ge(U,n,F),ue(n,c),ue(c,h),ue(c,_),ue(n,x),ue(n,o),V.m(o,null),ue(n,E)},p(U,F){F&1&&l!==(l=U[1].key+"")&&Gt(h,l),A===(A=P(U,F))&&V?V.p(U,F):(V.d(1),V=A(U),V&&(V.c(),V.m(o,null))),F&1&&I!==(I="ons-grid__col ons-col-"+(U[1].col?U[1].col:12)+"@m")&&ee(n,"class",I),F&1&&gt(n,"ons-u-mt-xs",U[3]!==0)},d(U){U&&X(n),V.d()}}}function u_(d){let n=Array.isArray(d[0]),c,l=n&&vf(d);return{c(){l&&l.c(),c=xt()},l(h){l&&l.l(h),c=xt()},m(h,_){l&&l.m(h,_),ge(h,c,_)},p(h,[_]){_&1&&(n=Array.isArray(h[0])),n?l?l.p(h,_):(l=vf(h),l.c(),l.m(c.parentNode,c)):l&&(l.d(1),l=null)},i:Bt,o:Bt,d(h){l&&l.d(h),h&&X(c)}}}function h_(d,n,c){let{meta:l=null}=n;return d.$$set=h=>{"meta"in h&&c(0,l=h.meta)},[l]}class f_ extends fi{constructor(n){super(),di(this,n,h_,u_,ti,{meta:0})}}const d_=d=>({}),wf=d=>({}),p_=d=>({}),Tf=d=>({}),m_=d=>({}),kf=d=>({});function Ef(d){let n,c,l,h,_;return{c(){n=xe("div"),c=xe("div"),l=xe("a"),h=xe("img"),this.h()},l(x){n=be(x,"DIV",{class:!0});var o=we(n);c=be(o,"DIV",{class:!0});var b=we(c);l=be(b,"A",{href:!0,class:!0});var E=we(l);h=be(E,"IMG",{src:!0,alt:!0,class:!0}),E.forEach(X),b.forEach(X),o.forEach(X),this.h()},h(){rc(h.src,_="//cdn.ons.gov.uk/assets/images/ons-logo/kitemark/uksa-kitemark.svg")||ee(h,"src",_),ee(h,"alt","UK Statistics Authority Kitemark"),ee(h,"class","national-statistics__logo"),ee(l,"href","https://uksa.statisticsauthority.gov.uk/about-the-authority/uk-statistical-system/types-of-official-statistics/"),ee(l,"class","national-statistics__link ons-u-fs-xxxl"),ee(c,"class","ons-grid--flex ons-grid--between@m ons-u-mt-s@m ons-u-mb-m@xxs ons-u-flex-jc-fe@m"),ee(n,"class","ons-grid__col ons-col-2@m svelte-lohx48")},m(x,o){ge(x,n,o),ue(n,c),ue(c,l),ue(l,h)},d(x){x&&X(n)}}}function Sf(d){let n,c,l,h;return{c(){n=xe("div"),c=xe("div"),l=xe("img"),this.h()},l(_){n=be(_,"DIV",{class:!0});var x=we(n);c=be(x,"DIV",{class:!0});var o=we(c);l=be(o,"IMG",{src:!0,title:!0,alt:!0,class:!0,focusable:!0,width:!0,height:!0}),o.forEach(X),x.forEach(X),this.h()},h(){rc(l.src,h="https://cdn.ons.gov.uk/assets/images/census-logo/logo-census-2021-purple-landscape.svg")||ee(l,"src",h),ee(l,"title","Census 2021"),ee(l,"alt","Census 2021"),ee(l,"class","header__svg-logo margin-right--1"),ee(l,"focusable","false"),ee(l,"width","167"),ee(l,"height","32"),ee(c,"class","ons-grid__col svelte-lohx48"),ee(n,"class","ons-grid ons-u-mb-m")},m(_,x){ge(_,n,x),ue(n,c),ue(c,l)},d(_){_&&X(n)}}}function g_(d){let n,c,l,h,_,x,o,b,E,I,P,A,V;const U=d[7].before,F=$i(U,d,d[8],kf);let Q=d[1]&&Ef();const pe=d[7].brand,ae=$i(pe,d,d[8],Tf);let Se=d[2]&&Sf();P=new f_({props:{meta:d[3]}});const Ge=d[7].after,ze=$i(Ge,d,d[8],wf);return{c(){n=xe("section"),F&&F.c(),c=qe(),l=xe("div"),h=xe("div"),_=xe("h1"),x=nt(d[0]),o=qe(),Q&&Q.c(),b=qe(),ae&&ae.c(),E=qe(),Se&&Se.c(),I=qe(),kt(P.$$.fragment),A=qe(),ze&&ze.c(),this.h()},l(Oe){n=be(Oe,"SECTION",{class:!0});var Me=we(n);F&&F.l(Me),c=Ze(Me),l=be(Me,"DIV",{class:!0});var Ue=we(l);h=be(Ue,"DIV",{class:!0});var zt=we(h);_=be(zt,"H1",{class:!0});var dt=we(_);x=st(dt,d[0]),dt.forEach(X),zt.forEach(X),o=Ze(Ue),Q&&Q.l(Ue),Ue.forEach(X),b=Ze(Me),ae&&ae.l(Me),E=Ze(Me),Se&&Se.l(Me),I=Ze(Me),Ct(P.$$.fragment,Me),A=Ze(Me),ze&&ze.l(Me),Me.forEach(X),this.h()},h(){ee(_,"class","ons-u-fs-xxxl ons-u-mt-s ons-u-mb-m ons-u-pb-no ons-u-pt-no"),ee(h,"class","ons-grid__col ons-col-10@m svelte-lohx48"),ee(l,"class","ons-grid"),ee(n,"class","ons-u-mb-xl")},m(Oe,Me){ge(Oe,n,Me),F&&F.m(n,null),ue(n,c),ue(n,l),ue(l,h),ue(h,_),ue(_,x),ue(l,o),Q&&Q.m(l,null),ue(n,b),ae&&ae.m(n,null),ue(n,E),Se&&Se.m(n,null),ue(n,I),Et(P,n,null),ue(n,A),ze&&ze.m(n,null),V=!0},p(Oe,Me){F&&F.p&&(!V||Me&256)&&er(F,U,Oe,Oe[8],V?ir(U,Oe[8],Me,m_):tr(Oe[8]),kf),(!V||Me&1)&&Gt(x,Oe[0]),Oe[1]?Q||(Q=Ef(),Q.c(),Q.m(l,null)):Q&&(Q.d(1),Q=null),ae&&ae.p&&(!V||Me&256)&&er(ae,pe,Oe,Oe[8],V?ir(pe,Oe[8],Me,p_):tr(Oe[8]),Tf),Oe[2]?Se||(Se=Sf(),Se.c(),Se.m(n,I)):Se&&(Se.d(1),Se=null);const Ue={};Me&8&&(Ue.meta=Oe[3]),P.$set(Ue),ze&&ze.p&&(!V||Me&256)&&er(ze,Ge,Oe,Oe[8],V?ir(Ge,Oe[8],Me,d_):tr(Oe[8]),wf)},i(Oe){V||(Ee(F,Oe),Ee(ae,Oe),Ee(P.$$.fragment,Oe),Ee(ze,Oe),V=!0)},o(Oe){Be(F,Oe),Be(ae,Oe),Be(P.$$.fragment,Oe),Be(ze,Oe),V=!1},d(Oe){Oe&&X(n),F&&F.d(Oe),Q&&Q.d(),ae&&ae.d(Oe),Se&&Se.d(),St(P),ze&&ze.d(Oe)}}}function __(d){let n,c;return n=new uc({props:{theme:d[4],themeOverrides:d[5],background:d[6],$$slots:{default:[g_]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,[h]){const _={};h&16&&(_.theme=l[4]),h&32&&(_.themeOverrides=l[5]),h&64&&(_.background=l[6]),h&271&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function y_(d,n,c){let{$$slots:l={},$$scope:h}=n,{title:_="Page title"}=n,{natStatBadge:x=!1}=n,{censusLogo:o=!1}=n,{meta:b=null}=n,{theme:E=null}=n,{themeOverrides:I=null}=n,{background:P=null}=n;return d.$$set=A=>{"title"in A&&c(0,_=A.title),"natStatBadge"in A&&c(1,x=A.natStatBadge),"censusLogo"in A&&c(2,o=A.censusLogo),"meta"in A&&c(3,b=A.meta),"theme"in A&&c(4,E=A.theme),"themeOverrides"in A&&c(5,I=A.themeOverrides),"background"in A&&c(6,P=A.background),"$$scope"in A&&c(8,h=A.$$scope)},[_,x,o,b,E,I,P,l,h]}class v_ extends fi{constructor(n){super(),di(this,n,y_,__,ti,{title:0,natStatBadge:1,censusLogo:2,meta:3,theme:4,themeOverrides:5,background:6})}}function x_(d){let n,c,l,h,_,x,o,b,E,I,P,A;const V=d[3].default,U=$i(V,d,d[2],null);return{c(){n=xe("details"),c=xe("summary"),l=xe("h3"),h=nt(d[0]),_=qe(),x=xe("span"),o=Dn("svg"),b=Dn("path"),I=qe(),P=xe("div"),U&&U.c(),this.h()},l(F){n=be(F,"DETAILS",{class:!0});var Q=we(n);c=be(Q,"SUMMARY",{class:!0,"data-ga-action":!0});var pe=we(c);l=be(pe,"H3",{class:!0});var ae=we(l);h=st(ae,d[0]),ae.forEach(X),_=Ze(pe),x=be(pe,"SPAN",{class:!0});var Se=we(x);o=Ln(Se,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0});var Ge=we(o);b=Ln(Ge,"path",{d:!0,transform:!0}),we(b).forEach(X),Ge.forEach(X),Se.forEach(X),pe.forEach(X),I=Ze(Q),P=be(Q,"DIV",{class:!0});var ze=we(P);U&&U.l(ze),ze.forEach(X),Q.forEach(X),this.h()},h(){ee(l,"class","ons-collapsible__title"),ee(b,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),ee(b,"transform","translate(-5.02 -1.59)"),ee(o,"class","ons-svg-icon svelte-1uv81ck"),ee(o,"viewBox","0 0 8 13"),ee(o,"xmlns","http://www.w3.org/2000/svg"),ee(o,"focusable","false"),ee(x,"class","ons-collapsible__icon"),ee(c,"class","ons-collapsible__heading ons-js-collapsible-heading svelte-1uv81ck"),ee(c,"data-ga-action",E=d[1]?"Close panel":"Open panel"),ee(P,"class","ons-collapsible__content ons-js-collapsible-content"),ee(n,"class","ons-collapsible ons-js-collapsible"),n.open=d[1]},m(F,Q){ge(F,n,Q),ue(n,c),ue(c,l),ue(l,h),ue(c,_),ue(c,x),ue(x,o),ue(o,b),ue(n,I),ue(n,P),U&&U.m(P,null),A=!0},p(F,[Q]){(!A||Q&1)&&Gt(h,F[0]),(!A||Q&2&&E!==(E=F[1]?"Close panel":"Open panel"))&&ee(c,"data-ga-action",E),U&&U.p&&(!A||Q&4)&&er(U,V,F,F[2],A?ir(V,F[2],Q,null):tr(F[2]),null),(!A||Q&2)&&(n.open=F[1])},i(F){A||(Ee(U,F),A=!0)},o(F){Be(U,F),A=!1},d(F){F&&X(n),U&&U.d(F)}}}function b_(d,n,c){let{$$slots:l={},$$scope:h}=n,{title:_="Title"}=n,{open:x=!1}=n;return d.$$set=o=>{"title"in o&&c(0,_=o.title),"open"in o&&c(1,x=o.open),"$$scope"in o&&c(2,h=o.$$scope)},[_,x,h,l]}class w_ extends fi{constructor(n){super(),di(this,n,b_,x_,ti,{title:0,open:1})}}function If(d){let n,c,l,h;return{c(){n=Dn("svg"),c=Dn("path"),this.h()},l(_){n=Ln(_,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var x=we(n);c=Ln(x,"path",{d:!0}),we(c).forEach(X),x.forEach(X),this.h()},h(){ee(c,"d",l=d[3][d[0]].d),ee(n,"class","ons-svg-icon"),ee(n,"viewBox",h=d[3][d[0]].viewBox),ee(n,"xmlns","http://www.w3.org/2000/svg"),ee(n,"focusable","false"),ee(n,"fill","currentColor"),gt(n,"ons-u-ml-xs",d[1]),gt(n,"ons-u-mr-xs",d[2])},m(_,x){ge(_,n,x),ue(n,c)},p(_,x){x&1&&l!==(l=_[3][_[0]].d)&&ee(c,"d",l),x&1&&h!==(h=_[3][_[0]].viewBox)&&ee(n,"viewBox",h),x&2&&gt(n,"ons-u-ml-xs",_[1]),x&4&&gt(n,"ons-u-mr-xs",_[2])},d(_){_&&X(n)}}}function T_(d){let n,c=d[3][d[0]]&&If(d);return{c(){c&&c.c(),n=xt()},l(l){c&&c.l(l),n=xt()},m(l,h){c&&c.m(l,h),ge(l,n,h)},p(l,[h]){l[3][l[0]]?c?c.p(l,h):(c=If(l),c.c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i:Bt,o:Bt,d(l){c&&c.d(l),l&&X(n)}}}function k_(d,n,c){let{type:l="arrow"}=n,{marginLeft:h=!1}=n,{marginRight:_=!1}=n;const x={arrow:{d:"m10 .2-.9.9c-.1.1-.1.4 0 .5l4 4H.6c-.2 0-.4.2-.4.4v1.2c0 .2.2.4.4.4h12.5l-3.9 3.7c-.2.2-.2.4 0 .6l.8.9c.2.2.4.2.6 0L16.8 7c.2-.2.2-.4 0-.6L10.7.3c-.3-.2-.5-.2-.7-.1z",viewBox:"0 0 17 13"},externalLink:{d:"M13.5,9H13a.5.5,0,0,0-.5.5v3h-9v-9h3A.5.5,0,0,0,7,3V2.5A.5.5,0,0,0,6.5,2h-4a.5.5,0,0,0-.5.5v11a.5.5,0,0,0,.5.5h11a.5.5,0,0,0,.5-.5v-4A.5.5,0,0,0,13.5,9Z M8.83,7.88a.51.51,0,0,0,.71,0l2.31-2.32,1.28,1.28A.51.51,0,0,0,14,6.49v-4a.52.52,0,0,0-.5-.5h-4A.51.51,0,0,0,9,2.52a.58.58,0,0,0,.14.33l1.28,1.28L8.12,6.46a.51.51,0,0,0,0,.71Z",viewBox:"2 2 12 12"},signout:{d:"M13.85,7.65l-2.5-2.5a.5.5,0,0,0-.71,0,.48.48,0,0,0-.15.36V7h-3a.5.5,0,0,0-.5.5v1a.5.5,0,0,0,.5.5h3v1.5A.49.49,0,0,0,11,11a.48.48,0,0,0,.34-.14l2.51-2.5a.49.49,0,0,0,0-.68Z M8.5,14h-6a.5.5,0,0,1-.5-.5V2.5A.5.5,0,0,1,2.5,2h6a.5.5,0,0,1,.5.5V3a.5.5,0,0,1-.5.5h-5v9h5A.5.5,0,0,1,9,13v.5A.5.5,0,0,1,8.5,14Z",viewBox:"0 0 12 12"},print:{d:"M17 4H3C1.3 4 0 5.2 0 6.8v5.5h4V16h12v-3.7h4V6.8C20 5.2 18.7 4 17 4zm-3 10H6V9h8v5zm3-6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-1-8H4v3h12V0z",viewBox:"0 0 20 16"},download:{d:"M5.6 9a.48.48 0 0 0 .7 0l3-3.2a.48.48 0 0 0 0-.7C9.3 5 9.2 5 9 5H7.5V.5A.47.47 0 0 0 7 0H5a.47.47 0 0 0-.5.5V5H3a.47.47 0 0 0-.5.5.37.37 0 0 0 .1.3Z M11.5 9H11a.47.47 0 0 0-.5.5v1h-9v-1A.47.47 0 0 0 1 9H.5a.47.47 0 0 0-.5.5v2a.47.47 0 0 0 .5.5h11a.47.47 0 0 0 .5-.5v-2a.47.47 0 0 0-.5-.5Z",viewBox:"0 0 12 12"},tick:{d:"M14.35,3.9l-.71-.71a.5.5,0,0,0-.71,0h0L5.79,10.34,3.07,7.61a.51.51,0,0,0-.71,0l-.71.71a.51.51,0,0,0,0,.71l3.78,3.78a.5.5,0,0,0,.71,0h0L14.35,4.6A.5.5,0,0,0,14.35,3.9Z",viewBox:"1.5 3 13 10"},search:{d:"M11.86 10.23 8.62 6.99a4.63 4.63 0 1 0-6.34 1.64 4.55 4.55 0 0 0 2.36.64 4.65 4.65 0 0 0 2.33-.65l3.24 3.23a.46.46 0 0 0 .65 0l1-1a.48.48 0 0 0 0-.62Zm-5-3.32a3.28 3.28 0 0 1-2.31.93 3.22 3.22 0 1 1 2.35-.93Z",viewBox:"0 0 12 12"}};return d.$$set=o=>{"type"in o&&c(0,l=o.type),"marginLeft"in o&&c(1,h=o.marginLeft),"marginRight"in o&&c(2,_=o.marginRight)},[l,h,_,x]}let hc=class extends fi{constructor(n){super(),di(this,n,k_,T_,ti,{type:0,marginLeft:1,marginRight:2})}};function E_(d){let n,c,l,h,_,x,o,b,E=d[4]&&d[5]==="before"&&Cf(d);const I=d[9].default,P=$i(I,d,d[8],null);let A=d[4]&&d[5]==="after"&&Af(d);return{c(){n=xe("button"),c=xe("span"),E&&E.c(),l=qe(),h=xe("span"),P&&P.c(),_=qe(),A&&A.c(),this.h()},l(V){n=be(V,"BUTTON",{type:!0,class:!0});var U=we(n);c=be(U,"SPAN",{class:!0});var F=we(c);E&&E.l(F),l=Ze(F),h=be(F,"SPAN",{class:!0});var Q=we(h);P&&P.l(Q),Q.forEach(X),_=Ze(F),A&&A.l(F),F.forEach(X),U.forEach(X),this.h()},h(){ee(h,"class","ons-btn__text"),ee(c,"class","ons-btn__inner"),ee(n,"type",d[0]),ee(n,"class","ons-btn"),n.disabled=d[6],gt(n,"ons-btn--small",d[3]),gt(n,"ons-btn--secondary",d[1]==="secondary"),gt(n,"ons-btn--ghost",d[1]==="ghost"),gt(n,"ons-btn--disabled",d[6])},m(V,U){ge(V,n,U),ue(n,c),E&&E.m(c,null),ue(c,l),ue(c,h),P&&P.m(h,null),ue(c,_),A&&A.m(c,null),x=!0,o||(b=ts(n,"click",d[11]),o=!0)},p(V,U){V[4]&&V[5]==="before"?E?(E.p(V,U),U&48&&Ee(E,1)):(E=Cf(V),E.c(),Ee(E,1),E.m(c,l)):E&&(ui(),Be(E,1,1,()=>{E=null}),hi()),P&&P.p&&(!x||U&256)&&er(P,I,V,V[8],x?ir(I,V[8],U,null):tr(V[8]),null),V[4]&&V[5]==="after"?A?(A.p(V,U),U&48&&Ee(A,1)):(A=Af(V),A.c(),Ee(A,1),A.m(c,null)):A&&(ui(),Be(A,1,1,()=>{A=null}),hi()),(!x||U&1)&&ee(n,"type",V[0]),(!x||U&64)&&(n.disabled=V[6]),(!x||U&8)&&gt(n,"ons-btn--small",V[3]),(!x||U&2)&&gt(n,"ons-btn--secondary",V[1]==="secondary"),(!x||U&2)&&gt(n,"ons-btn--ghost",V[1]==="ghost"),(!x||U&64)&&gt(n,"ons-btn--disabled",V[6])},i(V){x||(Ee(E),Ee(P,V),Ee(A),x=!0)},o(V){Be(E),Be(P,V),Be(A),x=!1},d(V){V&&X(n),E&&E.d(),P&&P.d(V),A&&A.d(),o=!1,b()}}}function S_(d){let n,c,l,h,_,x,o,b,E,I=d[4]&&d[5]==="before"&&zf(d);const P=d[9].default,A=$i(P,d,d[8],null);let V=d[4]&&d[5]==="after"&&Mf(d);return{c(){n=xe("a"),c=xe("span"),I&&I.c(),l=qe(),h=xe("span"),A&&A.c(),_=qe(),V&&V.c(),this.h()},l(U){n=be(U,"A",{href:!0,role:!0,class:!0,disabled:!0});var F=we(n);c=be(F,"SPAN",{class:!0});var Q=we(c);I&&I.l(Q),l=Ze(Q),h=be(Q,"SPAN",{class:!0});var pe=we(h);A&&A.l(pe),pe.forEach(X),_=Ze(Q),V&&V.l(Q),Q.forEach(X),F.forEach(X),this.h()},h(){ee(h,"class","ons-btn__text"),ee(c,"class","ons-btn__inner"),ee(n,"href",x=d[6]?null:d[2]),ee(n,"role","button"),ee(n,"class","ons-btn ons-btn--link ons-js-submit-btn"),ee(n,"disabled",d[6]),gt(n,"ons-btn--small",d[3]),gt(n,"ons-btn--secondary",d[1]==="secondary"),gt(n,"ons-btn--ghost",d[1]==="ghost"),gt(n,"ons-btn--disabled",d[6])},m(U,F){ge(U,n,F),ue(n,c),I&&I.m(c,null),ue(c,l),ue(c,h),A&&A.m(h,null),ue(c,_),V&&V.m(c,null),o=!0,b||(E=ts(n,"click",d[10]),b=!0)},p(U,F){U[4]&&U[5]==="before"?I?(I.p(U,F),F&48&&Ee(I,1)):(I=zf(U),I.c(),Ee(I,1),I.m(c,l)):I&&(ui(),Be(I,1,1,()=>{I=null}),hi()),A&&A.p&&(!o||F&256)&&er(A,P,U,U[8],o?ir(P,U[8],F,null):tr(U[8]),null),U[4]&&U[5]==="after"?V?(V.p(U,F),F&48&&Ee(V,1)):(V=Mf(U),V.c(),Ee(V,1),V.m(c,null)):V&&(ui(),Be(V,1,1,()=>{V=null}),hi()),(!o||F&68&&x!==(x=U[6]?null:U[2]))&&ee(n,"href",x),(!o||F&64)&&ee(n,"disabled",U[6]),(!o||F&8)&&gt(n,"ons-btn--small",U[3]),(!o||F&2)&&gt(n,"ons-btn--secondary",U[1]==="secondary"),(!o||F&2)&&gt(n,"ons-btn--ghost",U[1]==="ghost"),(!o||F&64)&&gt(n,"ons-btn--disabled",U[6])},i(U){o||(Ee(I),Ee(A,U),Ee(V),o=!0)},o(U){Be(I),Be(A,U),Be(V),o=!1},d(U){U&&X(n),I&&I.d(),A&&A.d(U),V&&V.d(),b=!1,E()}}}function Cf(d){let n,c;return n=new hc({props:{type:d[4],marginRight:!0}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&16&&(_.type=l[4]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function Af(d){let n,c;return n=new hc({props:{type:d[4],marginLeft:!0}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&16&&(_.type=l[4]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function zf(d){let n,c;return n=new hc({props:{type:d[4],marginRight:!0}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&16&&(_.type=l[4]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function Mf(d){let n,c;return n=new hc({props:{type:d[4],marginLeft:!0}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&16&&(_.type=l[4]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function I_(d){let n,c,l,h;const _=[S_,E_],x=[];function o(b,E){return b[2]?0:1}return n=o(d),c=x[n]=_[n](d),{c(){c.c(),l=xt()},l(b){c.l(b),l=xt()},m(b,E){x[n].m(b,E),ge(b,l,E),h=!0},p(b,[E]){let I=n;n=o(b),n===I?x[n].p(b,E):(ui(),Be(x[I],1,1,()=>{x[I]=null}),hi(),c=x[n],c?c.p(b,E):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Be(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function C_(d,n,c){let{$$slots:l={},$$scope:h}=n;const _=Su();let{type:x="button"}=n,{variant:o="primary"}=n,{href:b=""}=n,{small:E=!1}=n,{icon:I=""}=n,{iconPosition:P="before"}=n,{disabled:A=!1}=n;const V=F=>_("click",F),U=F=>_("click",F);return d.$$set=F=>{"type"in F&&c(0,x=F.type),"variant"in F&&c(1,o=F.variant),"href"in F&&c(2,b=F.href),"small"in F&&c(3,E=F.small),"icon"in F&&c(4,I=F.icon),"iconPosition"in F&&c(5,P=F.iconPosition),"disabled"in F&&c(6,A=F.disabled),"$$scope"in F&&c(8,h=F.$$scope)},[x,o,b,E,I,P,A,_,h,l,V,U]}class pp extends fi{constructor(n){super(),di(this,n,C_,I_,ti,{type:0,variant:1,href:2,small:3,icon:4,iconPosition:5,disabled:6})}}var gu=wg,A_=function(d){var n,c,l,h;if(n=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(d)){var _=n[1],x=_.replace(/a$/,""),o=x==="cmyk"?4:3;c=gu[x],l=n[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(E,I){return/%$/.test(E)&&I===o?parseFloat(E)/100:(/%$/.test(E),parseFloat(E))}),_===x&&l.push(1),h=l[o]===void 0?1:l[o],l=l.slice(0,o),c[x]=function(){return l}}else if(/^#[A-Fa-f0-9]+$/.test(d)){var x=d.replace(/^#/,""),o=x.length;c=gu.rgb,l=x.split(o===3?/(.)/:/(..)/),l=l.filter(Boolean).map(function(P){return parseInt(o===3?P+P:P,16)}),h=1,c.rgb=function(){return l},l[0]||(l[0]=0),l[1]||(l[1]=0),l[2]||(l[2]=0)}else c=gu.keyword,c.keyword=function(){return d},l=d,h=1;var b={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{b.rgb=c.rgb(l)}catch{}try{b.hsl=c.hsl(l)}catch{}try{b.hsv=c.hsv(l)}catch{}try{b.cmyk=c.cmyk(l)}catch{}try{b.keyword=c.keyword(l)}catch{}return b.rgb&&(b.hex="#"+b.rgb.map(function(E){var I=E.toString(16);return I.length===1?"0"+I:I}).join("")),b.rgb&&(b.rgba=b.rgb.concat(h)),b.hsl&&(b.hsla=b.hsl.concat(h)),b.hsv&&(b.hsva=b.hsv.concat(h)),b.cmyk&&(b.cmyka=b.cmyk.concat(h)),b};const z_=dp(A_);function M_(d){return d}function P_(d){if(d==null)return M_;var n,c,l=d.scale[0],h=d.scale[1],_=d.translate[0],x=d.translate[1];return function(o,b){b||(n=c=0);var E=2,I=o.length,P=new Array(I);for(P[0]=(n+=o[0])*l+_,P[1]=(c+=o[1])*h+x;E<I;)P[E]=o[E],++E;return P}}function D_(d,n){for(var c,l=d.length,h=l-n;h<--l;)c=d[h],d[h++]=d[l],d[l]=c}function L_(d,n){return typeof n=="string"&&(n=d.objects[n]),n.type==="GeometryCollection"?{type:"FeatureCollection",features:n.geometries.map(function(c){return Pf(d,c)})}:Pf(d,n)}function Pf(d,n){var c=n.id,l=n.bbox,h=n.properties==null?{}:n.properties,_=B_(d,n);return c==null&&l==null?{type:"Feature",properties:h,geometry:_}:l==null?{type:"Feature",id:c,properties:h,geometry:_}:{type:"Feature",id:c,bbox:l,properties:h,geometry:_}}function B_(d,n){var c=P_(d.transform),l=d.arcs;function h(I,P){P.length&&P.pop();for(var A=l[I<0?~I:I],V=0,U=A.length;V<U;++V)P.push(c(A[V],V));I<0&&D_(P,U)}function _(I){return c(I)}function x(I){for(var P=[],A=0,V=I.length;A<V;++A)h(I[A],P);return P.length<2&&P.push(P[0]),P}function o(I){for(var P=x(I);P.length<4;)P.push(P[0]);return P}function b(I){return I.map(o)}function E(I){var P=I.type,A;switch(P){case"GeometryCollection":return{type:P,geometries:I.geometries.map(E)};case"Point":A=_(I.coordinates);break;case"MultiPoint":A=I.coordinates.map(_);break;case"LineString":A=x(I.arcs);break;case"MultiLineString":A=I.arcs.map(x);break;case"Polygon":A=b(I.arcs);break;case"MultiPolygon":A=I.arcs.map(b);break;default:return null}return{type:P,coordinates:A}}return E(n)}const Df="https://raw.githubusercontent.com/jtrim-ons/key-pop-api-downloader/main/generated/";function R_(d){let n=[...d].sort((l,h)=>l.key.localeCompare(h.key));return{selString:d.length==0?"data":n.map((l,h)=>h<n.length-1?`${l.key}-${l.code}`:`${l.key}`).join("/"),lastCode:d.length>0?n[n.length-1].code:null}}async function mp(d,n=[],c=window.fetch){if(n.length>0&&!n[0].newFormat)throw new Error("OLD FORMAT!");let{selString:l,lastCode:h}=R_(n),_={data:{}},x;if(n.length===0){let o=`${Df}${n.length}var_percent/${l}.json`;x=await(await c(o)).json(),_.total_pop={count:x.sex.count[0]+x.sex.count[1],percent:100}}else{let o=`${Df}${n.length}var-combined_percent/${l}.json`,E=await(await c(o)).json();x=E.bar_chart_data[h],_.mapData=E.map_data[h],_.total_pop=x.total_pop}for(let o of d){_.data[o.key]={};for(let b of o.tables)_.data[o.key][b.code]={values:x[b.code]}}return _}function F_(d,n,c){for(let l=1;l<n.length;l++)if(d<=n[l])return c[l-1]}async function O_(d,n,c=window.fetch){let h=await(await c(d)).json();return await L_(h,n)}function Ss(d){return d.charAt(0).toUpperCase()+d.slice(1)}function Lf(d){return d.replace(new RegExp(" \\([0-9]* categories\\)"),"")}function Bf(d){for(const n of d)if(n.var in tf)return tf[n.var][n.code];return null}function nc(d,n,c){let l=c.all[d][n].values,h=c.selected[d][n].values,_=[];return Tg[n].forEach((x,o)=>{let b=x.label,E=l.percent[o],I=h.percent[o];c.selected.total_pop!=c.all.total_pop&&_.push({group:"This group",category:b,value:I}),_.push({group:"Whole population",category:b,value:E})}),_}function Rf(d){if(d===100)return"100";const n=d.toFixed(1);return n!=="0.0"?n:"Less than 0.05"}function Go(d){return d.split(": ").slice(-1)[0]}async function V_({fetch:d}){let n=await O_(Eu+Ga.url,Ga.layer,d),c=(await mp(tc,[],d)).data,l=[],h={},_=[];return n.features.forEach(x=>{const o=x.properties[Ga.code],b=x.properties[Ga.name],E={code:o,name:b};l.push(E),h[o]=E,_.push({...E,value:100,color:Uo.seq[4]})}),{geojson:n,geoCodesAndNames:l,geoCodesLookup:h,geoPerc:_,all:c,selected:null}}const X0=Object.freeze(Object.defineProperty({__proto__:null,load:V_},Symbol.toStringTag,{value:"Module"})),U_=fp("goto"),N_=fp("after_navigate");function j_(d){return d.slice().sort(function(n,c){return n-c})}function Ff(d,n){for(var c=[],l=0;l<d;l++){for(var h=[],_=0;_<n;_++)h.push(0);c.push(h)}return c}function G_(d){for(var n=0,c,l=0;l<d.length;l++)(l===0||d[l]!==c)&&(c=d[l],n++);return n}function bu(d,n,c,l){var h;if(d>0){var _=(c[n]-c[d-1])/(n-d+1);h=l[n]-l[d-1]-(n-d+1)*_*_}else h=l[n]-c[n]*c[n]/(n+1);return h<0?0:h}function wu(d,n,c,l,h,_,x){if(!(d>n)){var o=Math.floor((d+n)/2);l[c][o]=l[c-1][o-1],h[c][o]=o;var b=c;d>c&&(b=Math.max(b,h[c][d-1]||0)),b=Math.max(b,h[c-1][o]||0);var E=o-1;n<l[0].length-1&&(E=Math.min(E,h[c][n+1]||0));for(var I,P,A,V,U=E;U>=b&&(I=bu(U,o,_,x),!(I+l[c-1][b-1]>=l[c][o]));--U)P=bu(b,o,_,x),A=P+l[c-1][b-1],A<l[c][o]&&(l[c][o]=A,h[c][o]=b),b++,V=I+l[c-1][U-1],V<l[c][o]&&(l[c][o]=V,h[c][o]=U);wu(d,o-1,c,l,h,_,x),wu(o+1,n,c,l,h,_,x)}}function q_(d,n,c){for(var l=n[0].length,h=d[Math.floor(l/2)],_=[],x=[],o=0,b=void 0;o<l;++o)b=d[o]-h,o===0?(_.push(b),x.push(b*b)):(_.push(_[o-1]+b),x.push(x[o-1]+b*b)),n[0][o]=bu(0,o,_,x),c[0][o]=0;for(var E,I=1;I<n.length;++I)I<n.length-1?E=I:E=l-1,wu(E,l-1,I,n,c,_,x)}function Z_(d,n){if(n>d.length)throw new Error("cannot generate more classes than there are data values");var c=j_(d),l=G_(c);if(l===1)return[c];var h=Ff(n,c.length),_=Ff(n,c.length);q_(c,h,_);for(var x=[],o=_[0].length-1,b=_.length-1;b>=0;b--){var E=_[b][o];x[b]=c.slice(E,o+1),b>0&&(o=E-1)}return x}function Of(d,n,c){const l=d.slice();return l[15]=n[c],l}function Vf(d,n,c){const l=d.slice();return l[18]=n[c],l[20]=c,l}function Uf(d,n,c){const l=d.slice();return l[18]=n[c],l[20]=c,l}function Nf(d,n,c){const l=d.slice();return l[15]=n[c],l[20]=c,l}function jf(d){let n,c=d[9],l=[];for(let h=0;h<c.length;h+=1)l[h]=Gf(Nf(d,c,h));return{c(){n=xe("ul");for(let h=0;h<l.length;h+=1)l[h].c();this.h()},l(h){n=be(h,"UL",{class:!0});var _=we(n);for(let x=0;x<l.length;x+=1)l[x].l(_);_.forEach(X),this.h()},h(){ee(n,"class","legend-block svelte-lmi12p")},m(h,_){ge(h,n,_);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(n,null)},p(h,_){if(_&544){c=h[9];let x;for(x=0;x<c.length;x+=1){const o=Nf(h,c,x);l[x]?l[x].p(o,_):(l[x]=Gf(o),l[x].c(),l[x].m(n,null))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){h&&X(n),rr(l,h)}}}function Gf(d){let n,c,l,h,_=d[15]+"",x,o;return{c(){n=xe("li"),c=xe("div"),l=qe(),h=xe("span"),x=nt(_),o=qe(),this.h()},l(b){n=be(b,"LI",{class:!0});var E=we(n);c=be(E,"DIV",{class:!0}),we(c).forEach(X),l=Ze(E),h=be(E,"SPAN",{class:!0});var I=we(h);x=st(I,_),I.forEach(X),o=Ze(E),E.forEach(X),this.h()},h(){ee(c,"class","legend-vis "+(d[20]==0?"bar":"marker")+" svelte-lmi12p"),He(c,"height","1rem"),He(c,"width",d[20]==0?"1rem":d[5]+"px"),ee(h,"class",ic(d[20]==0?"bold":"brackets")+" svelte-lmi12p"),ee(n,"class","svelte-lmi12p"),gt(n,"ew",d[20]!=0)},m(b,E){ge(b,n,E),ue(n,c),ue(n,l),ue(n,h),ue(h,x),ue(n,o)},p(b,E){E&32&&He(c,"width",b[20]==0?"1rem":b[5]+"px"),E&512&&_!==(_=b[15]+"")&&Gt(x,_)},d(b){b&&X(n)}}}function qf(d){let n,c=d[1](d[18][d[0]])+"",l,h;return{c(){n=xe("span"),l=nt(c),h=nt(d[2]),this.h()},l(_){n=be(_,"SPAN",{class:!0});var x=we(n);l=st(x,c),h=st(x,d[2]),x.forEach(X),this.h()},h(){ee(n,"class","label "+(d[20]==0?"bold":"sml brackets")+" svelte-lmi12p")},m(_,x){ge(_,n,x),ue(n,l),ue(n,h)},p(_,x){x&131&&c!==(c=_[1](_[18][_[0]])+"")&&Gt(l,c),x&4&&Gt(h,_[2])},d(_){_&&X(n)}}}function X_(d){let n,c=`calc(${d[8](d[18][d[0]])}% - ${d[5]/2}px)`,l=`${d[5]}px`;return{c(){n=xe("div"),this.h()},l(h){n=be(h,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","marker svelte-lmi12p"),He(n,"left",c),He(n,"border-left-width",l)},m(h,_){ge(h,n,_)},p(h,_){_&417&&c!==(c=`calc(${h[8](h[18][h[0]])}% - ${h[5]/2}px)`)&&He(n,"left",c),_&32&&l!==(l=`${h[5]}px`)&&He(n,"border-left-width",l)},d(h){h&&X(n)}}}function H_(d){let n,c=`${d[8](d[18][d[0]])}%`;return{c(){n=xe("div"),this.h()},l(l){n=be(l,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","bar svelte-lmi12p"),He(n,"left","0"),He(n,"width",c)},m(l,h){ge(l,n,h)},p(l,h){h&385&&c!==(c=`${l[8](l[18][l[0]])}%`)&&He(n,"width",c)},d(l){l&&X(n)}}}function Zf(d){let n;function c(_,x){return _[20]==0?H_:X_}let h=c(d)(d);return{c(){h.c(),n=xt()},l(_){h.l(_),n=xt()},m(_,x){h.m(_,x),ge(_,n,x)},p(_,x){h.p(_,x)},d(_){h.d(_),_&&X(n)}}}function Xf(d){let n,c=d[15].label+"",l,h,_,x,o,b=`${d[4]}px`,E=d[15].values,I=[];for(let V=0;V<E.length;V+=1)I[V]=qf(Uf(d,E,V));let P=d[15].values,A=[];for(let V=0;V<P.length;V+=1)A[V]=Zf(Vf(d,P,V));return{c(){n=xe("div"),l=nt(c),h=qe(),_=xe("span");for(let V=0;V<I.length;V+=1)I[V].c();x=qe(),o=xe("div");for(let V=0;V<A.length;V+=1)A[V].c();this.h()},l(V){n=be(V,"DIV",{class:!0});var U=we(n);l=st(U,c),h=Ze(U),_=be(U,"SPAN",{class:!0});var F=we(_);for(let pe=0;pe<I.length;pe+=1)I[pe].l(F);F.forEach(X),U.forEach(X),x=Ze(V),o=be(V,"DIV",{class:!0});var Q=we(o);for(let pe=0;pe<A.length;pe+=1)A[pe].l(Q);Q.forEach(X),this.h()},h(){ee(_,"class","nowrap svelte-lmi12p"),ee(n,"class","label-group svelte-lmi12p"),ee(o,"class","bar-group svelte-lmi12p"),He(o,"height",b)},m(V,U){ge(V,n,U),ue(n,l),ue(n,h),ue(n,_);for(let F=0;F<I.length;F+=1)I[F]&&I[F].m(_,null);ge(V,x,U),ge(V,o,U);for(let F=0;F<A.length;F+=1)A[F]&&A[F].m(o,null)},p(V,U){if(U&128&&c!==(c=V[15].label+"")&&Gt(l,c),U&135){E=V[15].values;let F;for(F=0;F<E.length;F+=1){const Q=Uf(V,E,F);I[F]?I[F].p(Q,U):(I[F]=qf(Q),I[F].c(),I[F].m(_,null))}for(;F<I.length;F+=1)I[F].d(1);I.length=E.length}if(U&417){P=V[15].values;let F;for(F=0;F<P.length;F+=1){const Q=Vf(V,P,F);A[F]?A[F].p(Q,U):(A[F]=Zf(Q),A[F].c(),A[F].m(o,null))}for(;F<A.length;F+=1)A[F].d(1);A.length=P.length}U&16&&b!==(b=`${V[4]}px`)&&He(o,"height",b)},d(V){V&&X(n),rr(I,V),V&&X(x),V&&X(o),rr(A,V)}}}function Hf(d){let n,c;return{c(){n=xe("small"),c=nt(d[3]),this.h()},l(l){n=be(l,"SMALL",{class:!0});var h=we(n);c=st(h,d[3]),h.forEach(X),this.h()},h(){ee(n,"class","svelte-lmi12p")},m(l,h){ge(l,n,h),ue(n,c)},p(l,h){h&8&&Gt(c,l[3])},d(l){l&&X(n)}}}function W_(d){let n,c,l,h=d[6]&&d[9][1]&&jf(d),_=d[7],x=[];for(let b=0;b<_.length;b+=1)x[b]=Xf(Of(d,_,b));let o=d[3]&&Hf(d);return{c(){h&&h.c(),n=qe();for(let b=0;b<x.length;b+=1)x[b].c();c=qe(),o&&o.c(),l=xt()},l(b){h&&h.l(b),n=Ze(b);for(let E=0;E<x.length;E+=1)x[E].l(b);c=Ze(b),o&&o.l(b),l=xt()},m(b,E){h&&h.m(b,E),ge(b,n,E);for(let I=0;I<x.length;I+=1)x[I]&&x[I].m(b,E);ge(b,c,E),o&&o.m(b,E),ge(b,l,E)},p(b,[E]){if(b[6]&&b[9][1]?h?h.p(b,E):(h=jf(b),h.c(),h.m(n.parentNode,n)):h&&(h.d(1),h=null),E&439){_=b[7];let I;for(I=0;I<_.length;I+=1){const P=Of(b,_,I);x[I]?x[I].p(P,E):(x[I]=Xf(P),x[I].c(),x[I].m(c.parentNode,c))}for(;I<x.length;I+=1)x[I].d(1);x.length=_.length}b[3]?o?o.p(b,E):(o=Hf(b),o.c(),o.m(l.parentNode,l)):o&&(o.d(1),o=null)},i:Bt,o:Bt,d(b){h&&h.d(b),b&&X(n),rr(x,b),b&&X(c),o&&o.d(b),b&&X(l)}}}function K_(d,n,c){let l,h,_,x,{data:o}=n,{xKey:b="value"}=n,{yKey:E="category"}=n,{zKey:I="areanm"}=n,{formatTick:P=ae=>ae.toFixed(1)}=n,{suffix:A="%"}=n,{base:V=null}=n,{barHeight:U=25}=n,{markerWidth:F=3}=n,{showLegend:Q=!0}=n;function pe(ae,Se){let Ge={},ze=[];for(const Me of ae)Ge[Me[Se]]||(Ge[Me[Se]]={label:Me[Se],values:[]},ze.push(Me[Se])),Ge[Me[Se]].values.push(Me);let Oe=[];return ze.forEach(Me=>{Oe.push(Ge[Me])}),Oe}return d.$$set=ae=>{"data"in ae&&c(10,o=ae.data),"xKey"in ae&&c(0,b=ae.xKey),"yKey"in ae&&c(11,E=ae.yKey),"zKey"in ae&&c(12,I=ae.zKey),"formatTick"in ae&&c(1,P=ae.formatTick),"suffix"in ae&&c(2,A=ae.suffix),"base"in ae&&c(3,V=ae.base),"barHeight"in ae&&c(4,U=ae.barHeight),"markerWidth"in ae&&c(5,F=ae.markerWidth),"showLegend"in ae&&c(6,Q=ae.showLegend)},d.$$.update=()=>{d.$$.dirty&1025&&c(13,l=Math.max(...o.map(ae=>ae[b]))),d.$$.dirty&5120&&c(9,h=o.map(ae=>ae[I]).filter((ae,Se,Ge)=>Ge.indexOf(ae)===Se)),d.$$.dirty&8192&&c(8,_=ae=>ae/l*100),d.$$.dirty&3072&&c(7,x=pe(o,E))},[b,P,A,V,U,F,Q,x,_,h,o,E,I,l]}class J_ extends fi{constructor(n){super(),di(this,n,K_,W_,ti,{data:10,xKey:0,yKey:11,zKey:12,formatTick:1,suffix:2,base:3,barHeight:4,markerWidth:5,showLegend:6})}}function Y_(d){let n,c,l;return{c(){n=Dn("svg"),c=Dn("path"),this.h()},l(h){n=Ln(h,"svg",{class:!0,viewBox:!0,"fill-rule":!0,"clip-rule":!0,"aria-hidden":!0,focusable:!0,style:!0});var _=we(n);c=Ln(_,"path",{d:!0}),we(c).forEach(X),_.forEach(X),this.h()},h(){ee(c,"d",l=d[4][d[0]]),ee(n,"class","ico svelte-175xtay"),ee(n,"viewBox","0 0 24 24"),ee(n,"fill-rule","evenodd"),ee(n,"clip-rule","evenodd"),ee(n,"aria-hidden","true"),ee(n,"focusable","false"),ee(n,"style",d[3]),gt(n,"margin",d[2]),gt(n,"noclick",!d[1])},m(h,_){ge(h,n,_),ue(n,c)},p(h,[_]){_&1&&l!==(l=h[4][h[0]])&&ee(c,"d",l),_&8&&ee(n,"style",h[3]),_&4&&gt(n,"margin",h[2]),_&2&&gt(n,"noclick",!h[1])},i:Bt,o:Bt,d(h){h&&X(n)}}}function Q_(d,n,c){let l,{type:h="compass"}=n,{rotation:_=0}=n,{position:x="inline"}=n,{clickable:o=!1}=n,{margin:b=!1}=n;const E={compass:"M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zm-10 1H8v-2h4V8l4 4-4 4v-3z",info:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z",chart:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 17c-.55 0-1-.45-1-1v-5c0-.55.45-1 1-1s1 .45 1 1v5c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v8c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1z",share:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",chevron:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",full:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",full_exit:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",shuffle:"M10.59 9.17 5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z",replay:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z",save:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z",tick:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z",cross:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z",arrow:"M5,13h11.2l-2.9,2.9c-0.4,0.4-0.4,1,0,1.4s1,0.4,1.4,0l4.6-4.6c0.4-0.4,0.4-1,0-1.4l-4.6-4.6c-0.4-0.4-1-0.4-1.4,0c0,0,0,0,0,0c-0.4,0.4-0.4,1,0,1.4l2.9,2.9H5c-0.6,0-1,0.4-1,1S4.4,13,5,13z",plus:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z",minus:"M18 13H6c-.55 0-1-.45-1-1s.45-1 1-1h12c.55 0 1 .45 1 1s-.45 1-1 1z",subdir:"m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9l6 6z",touch:"M9 11.24V7.5C9 6.12 10.12 5 11.5 5S14 6.12 14 7.5v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74c-3.6-.76-3.54-.75-3.67-.75-.31 0-.59.13-.79.33l-.79.8 4.94 4.94c.27.27.65.44 1.06.44h6.79c.75 0 1.33-.55 1.44-1.28l.75-5.27c.01-.07.02-.14.02-.2 0-.62-.38-1.16-.91-1.38z",launch:"M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.11 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1zM14 4c0 .55.45 1 1 1h2.59l-9.13 9.13c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V3h-6c-.55 0-1 .45-1 1z",close:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",error:"M 12 2 C 6.48 2 2 6.48 2 12 s 4.48 10 10 10 s 10 -4.48 10 -10 S 17.52 2 12 2 z m 1 15 h -2 v -2 h 2 v 2 z m 0 -4 h -2 V 7 h 2 v 6 z"};return d.$$set=I=>{"type"in I&&c(0,h=I.type),"rotation"in I&&c(5,_=I.rotation),"position"in I&&c(6,x=I.position),"clickable"in I&&c(1,o=I.clickable),"margin"in I&&c(2,b=I.margin)},d.$$.update=()=>{d.$$.dirty&96&&c(3,l=`transform: translate(0, 15%) scale(1.5) rotate(${-_}deg);${["left","right"].includes(x)?` position: absolute; ${x}: 10px;`:""}`)},[h,o,b,l,E,_,x]}class Mu extends fi{constructor(n){super(),di(this,n,Q_,Y_,ti,{type:0,rotation:5,position:6,clickable:1,margin:2})}}function Wf(d,n,c){const l=d.slice();return l[11]=n[c],l}function Kf(d){let n,c,l,h;return{c(){n=xe("button"),c=nt("Back"),this.h()},l(_){n=be(_,"BUTTON",{class:!0});var x=we(n);c=st(x,"Back"),x.forEach(X),this.h()},h(){ee(n,"class","hidden-on-desktop svelte-1iovvug")},m(_,x){ge(_,n,x),ue(n,c),l||(h=ts(n,"click",function(){lp(d[3])&&d[3].apply(this,arguments)}),l=!0)},p(_,x){d=_},d(_){_&&X(n),l=!1,h()}}}function Jf(d){let n,c,l,h,_=Go(sc(d[11],d[4]))+"",x;return{c(){n=xe("br"),c=qe(),l=xe("div"),h=nt("Selected: "),x=nt(_),this.h()},l(o){n=be(o,"BR",{}),c=Ze(o),l=be(o,"DIV",{class:!0});var b=we(l);h=st(b,"Selected: "),x=st(b,_),b.forEach(X),this.h()},h(){ee(l,"class","selected-item-label svelte-1iovvug")},m(o,b){ge(o,n,b),ge(o,c,b),ge(o,l,b),ue(l,h),ue(l,x)},p(o,b){b&18&&_!==(_=Go(sc(o[11],o[4]))+"")&&Gt(x,_)},d(o){o&&X(n),o&&X(c),o&&X(l)}}}function Yf(d){let n,c=d[6](d[11])+"",l,h,_,x,o,b=sc(d[11],d[4]),E,I,P;x=new Mu({props:{type:"chevron"}});let A=b&&Jf(d);function V(){return d[10](d[11])}return{c(){n=xe("button"),l=nt(c),h=qe(),_=xe("span"),kt(x.$$.fragment),o=qe(),A&&A.c(),this.h()},l(U){n=be(U,"BUTTON",{class:!0});var F=we(n);l=st(F,c),h=Ze(F),_=be(F,"SPAN",{class:!0});var Q=we(_);Ct(x.$$.fragment,Q),Q.forEach(X),o=Ze(F),A&&A.l(F),F.forEach(X),this.h()},h(){ee(_,"class","right-chevron svelte-1iovvug"),ee(n,"class","svelte-1iovvug"),gt(n,"plain-button",!0),gt(n,"selected",d[11]===d[0])},m(U,F){ge(U,n,F),ue(n,l),ue(n,h),ue(n,_),Et(x,_,null),ue(n,o),A&&A.m(n,null),E=!0,I||(P=ts(n,"click",V),I=!0)},p(U,F){d=U,(!E||F&66)&&c!==(c=d[6](d[11])+"")&&Gt(l,c),F&18&&(b=sc(d[11],d[4])),b?A?A.p(d,F):(A=Jf(d),A.c(),A.m(n,null)):A&&(A.d(1),A=null),(!E||F&3)&&gt(n,"selected",d[11]===d[0])},i(U){E||(Ee(x.$$.fragment,U),E=!0)},o(U){Be(x.$$.fragment,U),E=!1},d(U){U&&X(n),St(x),A&&A.d(),I=!1,P()}}}function $_(d){let n,c,l,h,_,x,o,b=d[3]!=null&&Kf(d),E=d[1],I=[];for(let U=0;U<E.length;U+=1)I[U]=Yf(Wf(d,E,U));const P=U=>Be(I[U],1,1,()=>{I[U]=null}),A=d[9].default,V=$i(A,d,d[8],null);return{c(){n=xe("div"),b&&b.c(),c=qe(),l=xe("h5"),h=nt(d[5]),_=qe();for(let U=0;U<I.length;U+=1)I[U].c();x=qe(),V&&V.c(),this.h()},l(U){n=be(U,"DIV",{class:!0});var F=we(n);b&&b.l(F),c=Ze(F),l=be(F,"H5",{class:!0});var Q=we(l);h=st(Q,d[5]),Q.forEach(X),_=Ze(F);for(let pe=0;pe<I.length;pe+=1)I[pe].l(F);x=Ze(F),V&&V.l(F),F.forEach(X),this.h()},h(){ee(l,"class","column-title svelte-1iovvug"),ee(n,"class","column svelte-1iovvug"),gt(n,"hidden-first-column",d[7])},m(U,F){ge(U,n,F),b&&b.m(n,null),ue(n,c),ue(n,l),ue(l,h),ue(n,_);for(let Q=0;Q<I.length;Q+=1)I[Q]&&I[Q].m(n,null);ue(n,x),V&&V.m(n,null),o=!0},p(U,[F]){if(U[3]!=null?b?b.p(U,F):(b=Kf(U),b.c(),b.m(n,c)):b&&(b.d(1),b=null),(!o||F&32)&&Gt(h,U[5]),F&87){E=U[1];let Q;for(Q=0;Q<E.length;Q+=1){const pe=Wf(U,E,Q);I[Q]?(I[Q].p(pe,F),Ee(I[Q],1)):(I[Q]=Yf(pe),I[Q].c(),Ee(I[Q],1),I[Q].m(n,x))}for(ui(),Q=E.length;Q<I.length;Q+=1)P(Q);hi()}V&&V.p&&(!o||F&256)&&er(V,A,U,U[8],o?ir(A,U[8],F,null):tr(U[8]),null),(!o||F&128)&&gt(n,"hidden-first-column",U[7])},i(U){if(!o){for(let F=0;F<E.length;F+=1)Ee(I[F]);Ee(V,U),o=!0}},o(U){I=I.filter(Boolean);for(let F=0;F<I.length;F+=1)Be(I[F]);Be(V,U),o=!1},d(U){U&&X(n),b&&b.d(),rr(I,U),V&&V.d(U)}}}function ey(d){console.log("clicked",d)}function sc(d,n){for(let c of n)if(c.topic===d.label)return c.label;return!1}function ty(d,n,c){let{$$slots:l={},$$scope:h}=n,{options:_=[]}=n,{clickCallback:x=ey}=n,{backButtonCallback:o=null}=n,{globalSelectedCategories:b=[]}=n,{columnTitle:E="column title"}=n,{labeller:I=U=>U.label}=n,{selected:P=null}=n,{hiddenOnMobile:A=!1}=n;const V=U=>{c(0,P=U),x(U)};return d.$$set=U=>{"options"in U&&c(1,_=U.options),"clickCallback"in U&&c(2,x=U.clickCallback),"backButtonCallback"in U&&c(3,o=U.backButtonCallback),"globalSelectedCategories"in U&&c(4,b=U.globalSelectedCategories),"columnTitle"in U&&c(5,E=U.columnTitle),"labeller"in U&&c(6,I=U.labeller),"selected"in U&&c(0,P=U.selected),"hiddenOnMobile"in U&&c(7,A=U.hiddenOnMobile),"$$scope"in U&&c(8,h=U.$$scope)},[P,_,x,o,b,E,I,A,h,l,V]}class iy extends fi{constructor(n){super(),di(this,n,ty,$_,ti,{options:1,clickCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,selected:0,hiddenOnMobile:7})}}function Qf(d,n,c){const l=d.slice();return l[14]=n[c],l[16]=c,l}function $f(d){let n,c,l,h,_,x,o,b,E;return{c(){n=xe("ol"),c=xe("li"),l=xe("button"),h=nt("Back"),_=qe(),x=Dn("svg"),o=Dn("path"),this.h()},l(I){n=be(I,"OL",{class:!0});var P=we(n);c=be(P,"LI",{class:!0,id:!0});var A=we(c);l=be(A,"BUTTON",{class:!0});var V=we(l);h=st(V,"Back"),V.forEach(X),_=Ze(A),x=Ln(A,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var U=we(x);o=Ln(U,"path",{d:!0,transform:!0}),we(o).forEach(X),U.forEach(X),A.forEach(X),P.forEach(X),this.h()},h(){ee(l,"class","btn-link ons-breadcrumb__link"),ee(o,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),ee(o,"transform","translate(-5.02 -1.59)"),ee(x,"class","ons-svg-icon svelte-w4p0hu"),ee(x,"viewBox","0 0 8 13"),ee(x,"xmlns","http://www.w3.org/2000/svg"),ee(x,"focusable","false"),ee(x,"fill","currentColor"),ee(c,"class","ons-breadcrumb__item"),ee(c,"id","breadcrumb-1"),ee(n,"class","ons-breadcrumb__items ons-u-fs-s")},m(I,P){ge(I,n,P),ue(n,c),ue(c,l),ue(l,h),ue(c,_),ue(c,x),ue(x,o),b||(E=ts(l,"click",function(){lp(d[3])&&d[3].apply(this,arguments)}),b=!0)},p(I,P){d=I},d(I){I&&X(n),b=!1,E()}}}function ed(d){let n,c;return n=new pp({props:{variant:"secondary",small:!0,disabled:d[7],$$slots:{default:[ry]},$$scope:{ctx:d}}}),n.$on("click",d[11]),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&128&&(_.disabled=l[7]),h&8192&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function ry(d){let n;return{c(){n=nt("Remove selection")},l(c){n=st(c,"Remove selection")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function ny(d){let n,c=d[0],l,h,_=id(d);const x=d[10].default,o=$i(x,d,d[13],null);return{c(){n=xe("div"),_.c(),l=qe(),o&&o.c(),this.h()},l(b){n=be(b,"DIV",{class:!0});var E=we(n);_.l(E),E.forEach(X),l=Ze(b),o&&o.l(b),this.h()},h(){ee(n,"class","ons-radios__items")},m(b,E){ge(b,n,E),_.m(n,null),ge(b,l,E),o&&o.m(b,E),h=!0},p(b,E){E&1&&ti(c,c=b[0])?(_.d(1),_=id(b),_.c(),_.m(n,null)):_.p(b,E),o&&o.p&&(!h||E&8192)&&er(o,x,b,b[13],h?ir(x,b[13],E,null):tr(b[13]),null)},i(b){h||(Ee(o,b),h=!0)},o(b){Be(o,b),h=!1},d(b){b&&X(n),_.d(b),b&&X(l),o&&o.d(b)}}}function sy(d){let n;return{c(){n=nt(`At most three characteristics can be selected. To add another
      characteristic, please remove one of the three selected ones.`)},l(c){n=st(c,`At most three characteristics can be selected. To add another
      characteristic, please remove one of the three selected ones.`)},m(c,l){ge(c,n,l)},p:Bt,i:Bt,o:Bt,d(c){c&&X(n)}}}function td(d){let n,c,l,h,_,x=d[6](d[14])+"",o,b,E,I;function P(){return d[12](d[14])}return{c(){n=xe("button"),c=xe("span"),l=xe("span"),h=qe(),_=xe("span"),o=nt(x),b=qe(),this.h()},l(A){n=be(A,"BUTTON",{class:!0});var V=we(n);c=be(V,"SPAN",{class:!0});var U=we(c);l=be(U,"SPAN",{class:!0}),we(l).forEach(X),h=Ze(U),_=be(U,"SPAN",{class:!0});var F=we(_);o=st(F,x),F.forEach(X),U.forEach(X),b=Ze(V),V.forEach(X),this.h()},h(){ee(l,"class","ons-radio__input ons-js-radio svelte-1cwdic4"),ee(_,"class","ons-radio__label svelte-1cwdic4"),ee(c,"class","ons-radio ons-radio--no-border"),ee(n,"class","ons-radios__item ons-radios__item--no-border svelte-1cwdic4"),n.disabled=d[7],gt(n,"ons-radio__checked",nd(d[14],d[4]))},m(A,V){ge(A,n,V),ue(n,c),ue(c,l),ue(c,h),ue(c,_),ue(_,o),ue(n,b),E||(I=[cp(ay.call(null,n,d[16]===0)),ts(n,"click",P)],E=!0)},p(A,V){d=A,V&65&&x!==(x=d[6](d[14])+"")&&Gt(o,x),V&128&&(n.disabled=d[7]),V&17&&gt(n,"ons-radio__checked",nd(d[14],d[4]))},d(A){A&&X(n),E=!1,Ag(I)}}}function id(d){let n,c=d[0],l=[];for(let h=0;h<c.length;h+=1)l[h]=td(Qf(d,c,h));return{c(){for(let h=0;h<l.length;h+=1)l[h].c();n=xt()},l(h){for(let _=0;_<l.length;_+=1)l[_].l(h);n=xt()},m(h,_){for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(h,_);ge(h,n,_)},p(h,_){if(_&211){c=h[0];let x;for(x=0;x<c.length;x+=1){const o=Qf(h,c,x);l[x]?l[x].p(o,_):(l[x]=td(o),l[x].c(),l[x].m(n.parentNode,n))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){rr(l,h),h&&X(n)}}}function oy(d){let n,c,l,h,_,x,o,b=_u(d[9],d[4]),E,I,P,A,V,U=d[3]!=null&&$f(d),F=b&&ed(d);const Q=[sy,ny],pe=[];function ae(Se,Ge){return Ge&528&&(I=null),I==null&&(I=Se[4].length===3&&!_u(Se[9],Se[4])),I?0:1}return P=ae(d,-1),A=pe[P]=Q[P](d),{c(){n=xe("div"),c=xe("div"),U&&U.c(),l=qe(),h=xe("div"),_=xe("h5"),x=nt(d[5]),o=qe(),F&&F.c(),E=qe(),A.c(),this.h()},l(Se){n=be(Se,"DIV",{class:!0});var Ge=we(n);c=be(Ge,"DIV",{class:!0});var ze=we(c);U&&U.l(ze),ze.forEach(X),l=Ze(Ge),h=be(Ge,"DIV",{class:!0});var Oe=we(h);_=be(Oe,"H5",{class:!0});var Me=we(_);x=st(Me,d[5]),Me.forEach(X),o=Ze(Oe),F&&F.l(Oe),Oe.forEach(X),E=Ze(Ge),A.l(Ge),Ge.forEach(X),this.h()},h(){ee(c,"class","svelte-1cwdic4"),gt(c,"hidden-on-desktop",!0),ee(_,"class","column-title svelte-1cwdic4"),ee(h,"class","title-container svelte-1cwdic4"),ee(n,"class","column svelte-1cwdic4"),gt(n,"hidden-first-column",d[8])},m(Se,Ge){ge(Se,n,Ge),ue(n,c),U&&U.m(c,null),ue(n,l),ue(n,h),ue(h,_),ue(_,x),ue(h,o),F&&F.m(h,null),ue(n,E),pe[P].m(n,null),V=!0},p(Se,[Ge]){Se[3]!=null?U?U.p(Se,Ge):(U=$f(Se),U.c(),U.m(c,null)):U&&(U.d(1),U=null),(!V||Ge&32)&&Gt(x,Se[5]),Ge&528&&(b=_u(Se[9],Se[4])),b?F?(F.p(Se,Ge),Ge&528&&Ee(F,1)):(F=ed(Se),F.c(),Ee(F,1),F.m(h,null)):F&&(ui(),Be(F,1,1,()=>{F=null}),hi());let ze=P;P=ae(Se,Ge),P===ze?pe[P].p(Se,Ge):(ui(),Be(pe[ze],1,1,()=>{pe[ze]=null}),hi(),A=pe[P],A?A.p(Se,Ge):(A=pe[P]=Q[P](Se),A.c()),Ee(A,1),A.m(n,null)),(!V||Ge&256)&&gt(n,"hidden-first-column",Se[8])},i(Se){V||(Ee(F),Ee(A),V=!0)},o(Se){Be(F),Be(A),V=!1},d(Se){Se&&X(n),U&&U.d(),F&&F.d(),pe[P].d()}}}function rd(d){console.log("clicked",d)}function _u(d,n){for(let c of n)if(c.topic===d.label)return c.label;return!1}function nd(d,n){for(const c of n)if(c.var===d.var&&c.code===d.code)return!0;return!1}function ay(d,n){n&&d.focus()}function ly(d,n,c){let{$$slots:l={},$$scope:h}=n,{options:_=[]}=n,{clickCallback:x=rd}=n,{removeCatCallback:o=rd}=n,{backButtonCallback:b=null}=n,{globalSelectedCategories:E=[]}=n,{columnTitle:I="column title"}=n,{labeller:P=pe=>pe.label}=n,{disabled:A=!1}=n,{hiddenOnMobile:V=!1}=n,{currentVar:U=null}=n;const F=()=>o(U),Q=pe=>x(pe);return d.$$set=pe=>{"options"in pe&&c(0,_=pe.options),"clickCallback"in pe&&c(1,x=pe.clickCallback),"removeCatCallback"in pe&&c(2,o=pe.removeCatCallback),"backButtonCallback"in pe&&c(3,b=pe.backButtonCallback),"globalSelectedCategories"in pe&&c(4,E=pe.globalSelectedCategories),"columnTitle"in pe&&c(5,I=pe.columnTitle),"labeller"in pe&&c(6,P=pe.labeller),"disabled"in pe&&c(7,A=pe.disabled),"hiddenOnMobile"in pe&&c(8,V=pe.hiddenOnMobile),"currentVar"in pe&&c(9,U=pe.currentVar),"$$scope"in pe&&c(13,h=pe.$$scope)},[_,x,o,b,E,I,P,A,V,U,l,F,Q,h]}class cy extends fi{constructor(n){super(),di(this,n,ly,oy,ti,{options:0,clickCallback:1,removeCatCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,disabled:7,hiddenOnMobile:8,currentVar:9})}}function sd(d,n,c){const l=d.slice();return l[25]=n[c],l}function od(d){let n,c,l=[d[5].vars[d[7][d[5].label]]],h=[];for(let x=0;x<1;x+=1)h[x]=cd(sd(d,l,x));const _=x=>Be(h[x],1,1,()=>{h[x]=null});return{c(){for(let x=0;x<1;x+=1)h[x].c();n=xt()},l(x){for(let o=0;o<1;o+=1)h[o].l(x);n=xt()},m(x,o){for(let b=0;b<1;b+=1)h[b]&&h[b].m(x,o);ge(x,n,o),c=!0},p(x,o){if(o&1022){l=[x[5].vars[x[7][x[5].label]]];let b;for(b=0;b<1;b+=1){const E=sd(x,l,b);h[b]?(h[b].p(E,o),Ee(h[b],1)):(h[b]=cd(E),h[b].c(),Ee(h[b],1),h[b].m(n.parentNode,n))}for(ui(),b=1;b<1;b+=1)_(b);hi()}},i(x){if(!c){for(let o=0;o<1;o+=1)Ee(h[o]);c=!0}},o(x){h=h.filter(Boolean);for(let o=0;o<1;o+=1)Be(h[o]);c=!1},d(x){rr(h,x),x&&X(n)}}}function ad(d){let n,c,l,h,_,x;return c=new Mu({props:{type:"chevron",rotation:90}}),{c(){n=xe("button"),kt(c.$$.fragment),l=nt(" Show fewer"),this.h()},l(o){n=be(o,"BUTTON",{class:!0});var b=we(n);Ct(c.$$.fragment,b),l=st(b," Show fewer"),b.forEach(X),this.h()},h(){ee(n,"class","btn-link")},m(o,b){ge(o,n,b),Et(c,n,null),ue(n,l),h=!0,_||(x=ts(n,"click",d[9]),_=!0)},p:Bt,i(o){h||(Ee(c.$$.fragment,o),h=!0)},o(o){Be(c.$$.fragment,o),h=!1},d(o){o&&X(n),St(c),_=!1,x()}}}function ld(d){let n,c,l,h,_,x;return c=new Mu({props:{type:"chevron",rotation:-90}}),{c(){n=xe("button"),kt(c.$$.fragment),l=nt(" Show more"),this.h()},l(o){n=be(o,"BUTTON",{class:!0});var b=we(n);Ct(c.$$.fragment,b),l=st(b," Show more"),b.forEach(X),this.h()},h(){ee(n,"class","btn-link")},m(o,b){ge(o,n,b),Et(c,n,null),ue(n,l),h=!0,_||(x=ts(n,"click",d[8]),_=!0)},p:Bt,i(o){h||(Ee(c.$$.fragment,o),h=!0)},o(o){Be(c.$$.fragment,o),h=!1},d(o){o&&X(n),St(c),_=!1,x()}}}function uy(d){let n,c,l,h=d[7][d[5].label]>0&&ad(d),_=d[7][d[5].label]<d[5].vars.length-1&&ld(d);return{c(){h&&h.c(),n=qe(),_&&_.c(),c=qe()},l(x){h&&h.l(x),n=Ze(x),_&&_.l(x),c=Ze(x)},m(x,o){h&&h.m(x,o),ge(x,n,o),_&&_.m(x,o),ge(x,c,o),l=!0},p(x,o){x[7][x[5].label]>0?h?(h.p(x,o),o&160&&Ee(h,1)):(h=ad(x),h.c(),Ee(h,1),h.m(n.parentNode,n)):h&&(ui(),Be(h,1,1,()=>{h=null}),hi()),x[7][x[5].label]<x[5].vars.length-1?_?(_.p(x,o),o&160&&Ee(_,1)):(_=ld(x),_.c(),Ee(_,1),_.m(c.parentNode,c)):_&&(ui(),Be(_,1,1,()=>{_=null}),hi())},i(x){l||(Ee(h),Ee(_),l=!0)},o(x){Be(h),Be(_),l=!1},d(x){h&&h.d(x),x&&X(n),_&&_.d(x),x&&X(c)}}}function cd(d){let n,c,l;function h(...b){return d[11](d[25],...b)}function _(...b){return d[12](d[25],...b)}function x(b){d[14](b)}let o={columnTitle:d[5].label,options:d[25].cats,clickCallback:h,removeCatCallback:_,backButtonCallback:d[13],globalSelectedCategories:d[3],currentVar:d[5],disabled:d[4],$$slots:{default:[uy]},$$scope:{ctx:d}};return d[6]!==void 0&&(o.selected=d[6]),n=new cy({props:o}),lc.push(()=>Iu(n,"selected",x)),{c(){kt(n.$$.fragment)},l(b){Ct(n.$$.fragment,b)},m(b,E){Et(n,b,E),l=!0},p(b,E){d=b;const I={};E&32&&(I.columnTitle=d[5].label),E&160&&(I.options=d[25].cats),E&162&&(I.clickCallback=h),E&164&&(I.removeCatCallback=_),E&32&&(I.backButtonCallback=d[13]),E&8&&(I.globalSelectedCategories=d[3]),E&32&&(I.currentVar=d[5]),E&16&&(I.disabled=d[4]),E&268435616&&(I.$$scope={dirty:E,ctx:d}),!c&&E&64&&(c=!0,I.selected=d[6],Cu(()=>c=!1)),n.$set(I)},i(b){l||(Ee(n.$$.fragment,b),l=!0)},o(b){Be(n.$$.fragment,b),l=!1},d(b){St(n,b)}}}function ud(d){let n,c,l=d[5]!=null&&od(d);return{c(){l&&l.c(),n=xt()},l(h){l&&l.l(h),n=xt()},m(h,_){l&&l.m(h,_),ge(h,n,_),c=!0},p(h,_){h[5]!=null?l?(l.p(h,_),_&32&&Ee(l,1)):(l=od(h),l.c(),Ee(l,1),l.m(n.parentNode,n)):l&&(ui(),Be(l,1,1,()=>{l=null}),hi())},i(h){c||(Ee(l),c=!0)},o(h){Be(l),c=!1},d(h){l&&l.d(h),h&&X(n)}}}function hy(d){let n,c,l,h,_=d[5],x,o,b;function E(A){d[10](A)}let I={columnTitle:"Select a variable",clickCallback:py,options:d[0],globalSelectedCategories:d[3],hiddenOnMobile:d[5]!=null};d[5]!==void 0&&(I.selected=d[5]),c=new iy({props:I}),lc.push(()=>Iu(c,"selected",E));let P=ud(d);return{c(){n=xe("div"),kt(c.$$.fragment),h=qe(),P.c(),x=qe(),o=xt(),this.h()},l(A){n=be(A,"DIV",{class:!0});var V=we(n);Ct(c.$$.fragment,V),h=Ze(V),P.l(V),V.forEach(X),x=Ze(A),o=xt(),this.h()},h(){ee(n,"class","container svelte-9mqv54")},m(A,V){ge(A,n,V),Et(c,n,null),ue(n,h),P.m(n,null),ge(A,x,V),ge(A,o,V),b=!0},p(A,[V]){const U={};V&1&&(U.options=A[0]),V&8&&(U.globalSelectedCategories=A[3]),V&32&&(U.hiddenOnMobile=A[5]!=null),!l&&V&32&&(l=!0,U.selected=A[5],Cu(()=>l=!1)),c.$set(U),V&32&&ti(_,_=A[5])?(ui(),Be(P,1,1,Bt),hi(),P=ud(A),P.c(),Ee(P,1),P.m(n,null)):P.p(A,V)},i(A){b||(Ee(c.$$.fragment,A),Ee(P),b=!0)},o(A){Be(c.$$.fragment,A),Be(P),b=!1},d(A){A&&X(n),St(c),P.d(A),A&&X(x),A&&X(o)}}}function fy(d,n){console.log(d,n)}function dy(d,n){console.log(d,n)}const py=()=>{};function my(d,n,c){let l,{options:h=[]}=n,{clickCallback:_=fy}=n,{removeCatCallback:x=dy}=n,{globalSelectedCategories:o=[]}=n,{disabled:b=!1}=n,E=null,I=null;function P(){c(7,++l[E.label],l)}function A(){c(7,--l[E.label],l)}function V(Se){E=Se,c(5,E)}const U=(Se,Ge)=>_(Se,Ge),F=(Se,Ge)=>x(Se,Ge),Q=()=>c(5,E=null);function pe(Se){I=Se,c(6,I)}const ae=(Se,Ge)=>_(Se,Ge);return d.$$set=Se=>{"options"in Se&&c(0,h=Se.options),"clickCallback"in Se&&c(1,_=Se.clickCallback),"removeCatCallback"in Se&&c(2,x=Se.removeCatCallback),"globalSelectedCategories"in Se&&c(3,o=Se.globalSelectedCategories),"disabled"in Se&&c(4,b=Se.disabled)},d.$$.update=()=>{d.$$.dirty&1&&c(7,l=function(){let Se={};return h.forEach(Ge=>Se[Ge.label]=0),Se}())},[h,_,x,o,b,E,I,l,P,A,V,U,F,Q,pe,ae]}class gy extends fi{constructor(n){super(),di(this,n,my,hy,ti,{options:0,clickCallback:1,removeCatCallback:2,globalSelectedCategories:3,disabled:4})}}var gp={exports:{}};(function(d,n){(function(c,l){d.exports=l()})(Og,function(){var c,l,h;function _(o,b){if(!c)c=b;else if(!l)l=b;else{var E="var sharedChunk = {}; ("+c+")(sharedChunk); ("+l+")(sharedChunk);",I={};c(I),h=b(I),typeof window<"u"&&(h.workerUrl=window.URL.createObjectURL(new Blob([E],{type:"text/javascript"})))}}_(["exports"],function(o){var b=E;function E(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}function I(i,e,r,a){const p=new b(i,e,r,a);return function(g){return p.solve(g)}}E.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var p=this.sampleCurveX(r)-i;if(Math.abs(p)<e)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=p/g}var v=0,T=1;for(r=i,a=0;a<20&&(p=this.sampleCurveX(r),!(Math.abs(p-i)<e));a++)i>p?v=r:T=r,r=.5*(T-v)+v;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const P=I(.25,.1,.25,1);function A(i,e,r){return Math.min(r,Math.max(e,i))}function V(i,e,r){const a=r-e,p=((i-e)%a+a)%a+e;return p===e?r:p}function U(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let F=1;function Q(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function pe(i,e,r){const a={};for(const p in i)a[p]=e.call(r||this,i[p],p,i);return a}function ae(i,e,r){const a={};for(const p in i)e.call(r||this,i[p],p,i)&&(a[p]=i[p]);return a}function Se(i){return Array.isArray(i)?i.map(Se):typeof i=="object"&&i?pe(i,Se):i}const Ge={};function ze(i){Ge[i]||(typeof console<"u"&&console.warn(i),Ge[i]=!0)}function Oe(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Me(i){let e=0;for(let r,a,p=0,g=i.length,v=g-1;p<g;v=p++)r=i[p],a=i[v],e+=(a.x-r.x)*(r.y+a.y);return e}function Ue(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function zt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,p,g)=>{const v=p||g;return e[a]=!v||v.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let dt,yi,_t=null;function si(i){if(_t==null){const e=i.navigator?i.navigator.userAgent:null;_t=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return _t}function nr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const ii={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,a.drawImage(i,0,0,i.width,i.height),a.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(dt||(dt=document.createElement("a")),dt.href=i,dt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(yi==null&&(yi=matchMedia("(prefers-reduced-motion: reduce)")),yi.matches)}};var bt=mr;function mr(i,e){this.x=i,this.y=e}mr.prototype={clone:function(){return new mr(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),p=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},mr.convert=function(i){return i instanceof mr?i:Array.isArray(i)?new mr(i[0],i[1]):i};const Si={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Lt="mapbox-tiles";let Ri,Mi,Ai=500,ur=50;function Ui(){typeof caches>"u"||Ri||(Ri=caches.open(Lt))}let Ki=1/0;const gr={supported:!1,testSupport:function(i){!Xe&&Tr&&(pi?Ni(i):_r=i)}};let _r,Tr,Xe=!1,pi=!1;function Ni(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Tr),i.isContextLost())return;gr.supported=!0}catch{}i.deleteTexture(e),Xe=!0}typeof document<"u"&&(Tr=document.createElement("img"),Tr.onload=function(){_r&&Ni(_r),_r=null,pi=!0},Tr.onerror=function(){Xe=!0,_r=null},Tr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Rr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Rr);class kr extends Error{constructor(e,r,a,p){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=p}}const Is=Ue()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function vn(i,e){const r=new AbortController,a=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Is(),signal:r.signal});let p=!1,g=!1;return i.type==="json"&&a.headers.set("Accept","application/json"),((v,T,k)=>{if(g)return;const z=Date.now();fetch(a).then(L=>L.ok?((R,j,q)=>{(i.type==="arrayBuffer"?R.arrayBuffer():i.type==="json"?R.json():R.text()).then(Z=>{g||(j&&q&&function(re,ie,me){if(Ui(),!Ri)return;const ke={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((ve,Fe)=>ke.headers.set(Fe,ve));const de=zt(ie.headers.get("Cache-Control")||"");de["no-store"]||(de["max-age"]&&ke.headers.set("Expires",new Date(me+1e3*de["max-age"]).toUTCString()),new Date(ke.headers.get("Expires")).getTime()-me<42e4||function(ve,Fe){if(Mi===void 0)try{new Response(new ReadableStream),Mi=!0}catch{Mi=!1}Mi?Fe(ve.body):ve.blob().then(Fe)}(ie,ve=>{const Fe=new Response(ve,ke);Ui(),Ri&&Ri.then(Re=>Re.put(function(lt){const ht=lt.indexOf("?");return ht<0?lt:lt.slice(0,ht)}(re.url),Fe)).catch(Re=>ze(Re.message))}))}(a,j,q),p=!0,e(null,Z,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(Z=>{g||e(new Error(Z.message))})})(L,null,z):L.blob().then(R=>e(new kr(L.status,L.statusText,i.url,R)))).catch(L=>{L.code!==20&&e(new Error(L.message))})})(),{cancel:()=>{g=!0,p||r.abort()}}}const is=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Ue()){const a=i.url.substring(0,i.url.indexOf("://"));return(Si.REGISTERED_PROTOCOLS[a]||vn)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(Is())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return vn(i,e);if(Ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(a,p){const g=new XMLHttpRequest;g.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const v in a.headers)g.setRequestHeader(v,a.headers[v]);return a.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=a.credentials==="include",g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let v=g.response;if(a.type==="json")try{v=JSON.parse(g.response)}catch(T){return p(T)}p(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else{const v=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});p(new kr(g.status,g.statusText,a.url,v))}},g.send(a.body),{cancel:()=>g.abort()}}(i,e)},rs=function(i,e){return is(U(i,{type:"arrayBuffer"}),e)};function Cs(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const Zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Yr,xn;Yr=[],xn=0;const bn=function(i,e){if(gr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),xn>=Si.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Yr.push(g),g}xn++;let r=!1;const a=()=>{if(!r)for(r=!0,xn--;Yr.length&&xn<Si.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Yr.shift(),{requestParameters:v,callback:T,cancelled:k}=g;k||(g.cancel=bn(v,T).cancel)}},p=rs(i,(g,v,T,k)=>{a(),g?e(g):v&&function(z,L){typeof createImageBitmap=="function"?function(R,j){const q=new Blob([new Uint8Array(R)],{type:"image/png"});createImageBitmap(q).then(Z=>{j(null,Z)}).catch(Z=>{j(new Error(`Could not load image because of ${Z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(z,L):function(R,j){const q=new Image;q.onload=()=>{j(null,q),URL.revokeObjectURL(q.src),q.onload=null,window.requestAnimationFrame(()=>{q.src=Zt})},q.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Z=new Blob([new Uint8Array(R)],{type:"image/png"});q.src=R.byteLength?URL.createObjectURL(Z):Zt}(z,L)}(v,(z,L)=>{z!=null?e(z):L!=null&&e(null,L,{cacheControl:T,expires:k})})});return{cancel:()=>{p.cancel(),a()}}};function As(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function on(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class an{constructor(e,r={}){U(this,r),this.type=e}}class ns extends an{constructor(e,r={}){super("error",U({error:e},r))}}class ln{on(e,r){return this._listeners=this._listeners||{},As(e,r,this._listeners),this}off(e,r){return on(e,r,this._listeners),on(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},As(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new an(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const p=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const T of p)T.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const T of g)on(a,T,this._oneTimeListeners),T.call(this,e);const v=this._eventedParent;v&&(U(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(e))}else e instanceof ns&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Qe{constructor(e,r,a,p){this.message=(e?`${e}: `:"")+a,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function Bn(i){const e=i.value;return e?[new Qe(i.key,e,"constants have been deprecated as of v8")]:[]}function jr(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}function Xt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Fr(i){if(Array.isArray(i))return i.map(Fr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Fr(i[r]);return e}return Xt(i)}class Er extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Sr{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,p]of r)this.bindings[a]=p}concat(e){return new Sr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const wn={kind:"null"},Ke={kind:"number"},Rt={kind:"string"},Pt={kind:"boolean"},Ji={kind:"color"},Tn={kind:"object"},Mt={kind:"value"},cn={kind:"collator"},ji={kind:"formatted"},ss={kind:"padding"},Pi={kind:"resolvedImage"};function hr(i,e){return{kind:"array",itemType:i,N:e}}function ri(i){if(i.kind==="array"){const e=ri(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const os=[wn,Ke,Rt,Pt,Ji,ji,Tn,hr(Mt),ss,Pi];function Qr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Qr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of os)if(!Qr(r,e))return null}}return`Expected ${ri(i)} but found ${ri(e)} instead.`}function Rn(i,e){return e.some(r=>r.kind===i.kind)}function Fn(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var as,On={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function K(i){return(i=Math.round(i))<0?0:i>255?255:i}function D(i){return K(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function O(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function H(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{as={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in On)return On[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),p=r.indexOf(")");if(a!==-1&&p+1===r.length){var g=r.substr(0,a),v=r.substr(a+1,p-(a+1)).split(","),T=1;switch(g){case"rgba":if(v.length!==4)return null;T=O(v.pop());case"rgb":return v.length!==3?null:[D(v[0]),D(v[1]),D(v[2]),T];case"hsla":if(v.length!==4)return null;T=O(v.pop());case"hsl":if(v.length!==3)return null;var k=(parseFloat(v[0])%360+360)%360/360,z=O(v[1]),L=O(v[2]),R=L<=.5?L*(z+1):L+z-L*z,j=2*L-R;return[K(255*H(j,R,k+1/3)),K(255*H(j,R,k)),K(255*H(j,R,k-1/3)),T];default:return null}}return null}}catch{}class W{constructor(e,r,a,p=1){this.r=e,this.g=r,this.b=a,this.a=p}static parse(e){if(!e)return;if(e instanceof W)return e;if(typeof e!="string")return;const r=as(e);return r?new W(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,p]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${p})`}toArray(){const{r:e,g:r,b:a,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*r/p,255*a/p,p]}}W.black=new W(0,0,0,1),W.white=new W(1,1,1,1),W.transparent=new W(0,0,0,0),W.red=new W(1,0,0,1);class ne{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ce{constructor(e,r,a,p,g){this.text=e,this.image=r,this.scale=a,this.fontStack=p,this.textColor=g}}class oe{constructor(e){this.sections=e}static fromString(e){return new oe([new ce(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof oe?e:oe.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class se{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof se)return e;if(typeof e=="number")return new se([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new se(e)}}toString(){return JSON.stringify(this.values)}}class he{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new he({name:e,available:!1}):null}}function Ce(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ve(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof W||i instanceof ne||i instanceof oe||i instanceof se||i instanceof he)return!0;if(Array.isArray(i)){for(const e of i)if(!Ve(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ve(i[e]))return!1;return!0}return!1}function Ie(i){if(i===null)return wn;if(typeof i=="string")return Rt;if(typeof i=="boolean")return Pt;if(typeof i=="number")return Ke;if(i instanceof W)return Ji;if(i instanceof ne)return cn;if(i instanceof oe)return ji;if(i instanceof se)return ss;if(i instanceof he)return Pi;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const p=Ie(a);if(r){if(r===p)continue;r=Mt;break}r=p}return hr(r||Mt,e)}return Tn}function ut(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof W||i instanceof oe||i instanceof se||i instanceof he?i.toString():JSON.stringify(i)}class ft{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ve(e[1]))return r.error("invalid value");const a=e[1];let p=Ie(a);const g=r.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new ft(p,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class rt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const wt={string:Rt,number:Ke,boolean:Pt,object:Tn};class It{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,p=1;const g=e[0];if(g==="array"){let T,k;if(e.length>2){const z=e[1];if(typeof z!="string"||!(z in wt)||z==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);T=wt[z],p++}else T=Mt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);k=e[2],p++}a=hr(T,k)}else{if(!wt[g])throw new Error(`Types doesn't contain name = ${g}`);a=wt[g]}const v=[];for(;p<e.length;p++){const T=r.parse(e[p],p,Mt);if(!T)return null;v.push(T)}return new It(a,v)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!Qr(this.type,Ie(a)))return a;if(r===this.args.length-1)throw new rt(`Expected value to be of type ${ri(this.type)}, but found ${ri(Ie(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ht={"to-boolean":Pt,"to-color":Ji,"to-number":Ke,"to-string":Rt};class At{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!Ht[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const p=Ht[a],g=[];for(let v=1;v<e.length;v++){const T=r.parse(e[v],v,Mt);if(!T)return null;g.push(T)}return new At(p,g)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const p of this.args){if(r=p.evaluate(e),a=null,r instanceof W)return r;if(typeof r=="string"){const g=e.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ce(r[0],r[1],r[2],r[3]),!a))return new W(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new rt(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const a of this.args){r=a.evaluate(e);const p=se.parse(r);if(p)return p}throw new rt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new rt(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?oe.fromString(ut(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?he.fromString(ut(this.args[0].evaluate(e))):ut(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ft=["Unknown","Point","LineString","Polygon"];class Wt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ft[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=W.parse(e)),r}}class oi{constructor(e,r,a,p){this.name=e,this.type=r,this._evaluate=a,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],p=oi.definitions[a];if(!p)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=v.filter(([z])=>!Array.isArray(z)||z.length===e.length-1);let k=null;for(const[z,L]of T){k=new us(r.registry,r.path,null,r.scope);const R=[];let j=!1;for(let q=1;q<e.length;q++){const Z=e[q],re=Array.isArray(z)?z[q-1]:z.type,ie=k.parse(Z,1+R.length,re);if(!ie){j=!0;break}R.push(ie)}if(!j)if(Array.isArray(z)&&z.length!==R.length)k.error(`Expected ${z.length} arguments, but found ${R.length} instead.`);else{for(let q=0;q<R.length;q++){const Z=Array.isArray(z)?z[q]:z.type,re=R[q];k.concat(q+1).checkSubtype(Z,re.type)}if(k.errors.length===0)return new oi(a,g,L,R)}}if(T.length===1)r.errors.push(...k.errors);else{const z=(T.length?T:v).map(([R])=>{return j=R,Array.isArray(j)?`(${j.map(ri).join(", ")})`:`(${ri(j.type)}...)`;var j}).join(" | "),L=[];for(let R=1;R<e.length;R++){const j=r.parse(e[R],1+L.length);if(!j)return null;L.push(ri(j.type))}r.error(`Expected arguments of type ${z}, but found (${L.join(", ")}) instead.`)}return null}static register(e,r){oi.definitions=r;for(const a in r)e[a]=oi}}class Gi{constructor(e,r,a){this.type=cn,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const p=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Pt);if(!p)return null;const g=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Pt);if(!g)return null;let v=null;return a.locale&&(v=r.parse(a.locale,1,Rt),!v)?null:new Gi(p,g,v)}evaluate(e){return new ne(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const vi=8192;function sr(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ls(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function zs(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*vi),Math.round(a*p*vi)]}function ai(i,e,r){const a=i[0]-e[0],p=i[1]-e[1],g=i[0]-r[0],v=i[1]-r[1];return a*v-g*p==0&&a*g<=0&&p*v<=0}function qo(i,e){let r=!1;for(let v=0,T=e.length;v<T;v++){const k=e[v];for(let z=0,L=k.length;z<L-1;z++){if(ai(i,k[z],k[z+1]))return!1;(p=k[z])[1]>(a=i)[1]!=(g=k[z+1])[1]>a[1]&&a[0]<(g[0]-p[0])*(a[1]-p[1])/(g[1]-p[1])+p[0]&&(r=!r)}}var a,p,g;return r}function Zo(i,e){for(let r=0;r<e.length;r++)if(qo(i,e[r]))return!0;return!1}function Ha(i,e,r,a){const p=a[0]-r[0],g=a[1]-r[1],v=(i[0]-r[0])*g-p*(i[1]-r[1]),T=(e[0]-r[0])*g-p*(e[1]-r[1]);return v>0&&T<0||v<0&&T>0}function Wa(i,e,r){for(const z of r)for(let L=0;L<z.length-1;++L)if((T=[(v=z[L+1])[0]-(g=z[L])[0],v[1]-g[1]])[0]*(k=[(p=e)[0]-(a=i)[0],p[1]-a[1]])[1]-T[1]*k[0]!=0&&Ha(a,p,g,v)&&Ha(g,v,a,p))return!0;var a,p,g,v,T,k;return!1}function Xo(i,e){for(let r=0;r<i.length;++r)if(!qo(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Wa(i[r],i[r+1],e))return!1;return!0}function fc(i,e){for(let r=0;r<e.length;r++)if(Xo(i,e[r]))return!0;return!1}function ao(i,e,r){const a=[];for(let p=0;p<i.length;p++){const g=[];for(let v=0;v<i[p].length;v++){const T=zs(i[p][v],r);sr(e,T),g.push(T)}a.push(g)}return a}function Ho(i,e,r){const a=[];for(let p=0;p<i.length;p++){const g=ao(i[p],e,r);a.push(g)}return a}function Ka(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const p=.5*a;let g=i[0]-r[0]>p?-a:r[0]-i[0]>p?a:0;g===0&&(g=i[0]-r[2]>p?-a:r[2]-i[0]>p?a:0),i[0]+=g}sr(e,i)}function Ja(i,e,r,a){const p=Math.pow(2,a.z)*vi,g=[a.x*vi,a.y*vi],v=[];for(const T of i)for(const k of T){const z=[k.x+g[0],k.y+g[1]];Ka(z,e,r,p),v.push(z)}return v}function Ya(i,e,r,a){const p=Math.pow(2,a.z)*vi,g=[a.x*vi,a.y*vi],v=[];for(const k of i){const z=[];for(const L of k){const R=[L.x+g[0],L.y+g[1]];sr(e,R),z.push(R)}v.push(z)}if(e[2]-e[0]<=p/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const k of v)for(const z of k)Ka(z,e,r,p)}var T;return v}class Vn{constructor(e,r){this.type=Pt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ve(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let p=0;p<a.features.length;++p){const g=a.features[p].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Vn(a,a.features[p].geometry)}else if(a.type==="Feature"){const p=a.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Vn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Vn(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=r.canonicalID();if(a.type==="Polygon"){const T=ao(a.coordinates,g,v),k=Ja(r.geometry(),p,g,v);if(!ls(p,g))return!1;for(const z of k)if(!qo(z,T))return!1}if(a.type==="MultiPolygon"){const T=Ho(a.coordinates,g,v),k=Ja(r.geometry(),p,g,v);if(!ls(p,g))return!1;for(const z of k)if(!Zo(z,T))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=r.canonicalID();if(a.type==="Polygon"){const T=ao(a.coordinates,g,v),k=Ya(r.geometry(),p,g,v);if(!ls(p,g))return!1;for(const z of k)if(!Xo(z,T))return!1}if(a.type==="MultiPolygon"){const T=Ho(a.coordinates,g,v),k=Ya(r.geometry(),p,g,v);if(!ls(p,g))return!1;for(const z of k)if(!fc(z,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Ms(i){if(i instanceof oi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Vn)return!1;let e=!0;return i.eachChild(r=>{e&&!Ms(r)&&(e=!1)}),e}function cs(i){if(i instanceof oi&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!cs(r)&&(e=!1)}),e}function lo(i,e){if(i instanceof oi&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!lo(a,e)&&(r=!1)}),r}class co{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new co(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class us{constructor(e,r=[],a,p=new Sr,g=[]){this.registry=e,this.path=r,this.key=r.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=g,this.expectedType=a}parse(e,r,a,p,g={}){return r?this.concat(r,a,p)._parse(e,g):this._parse(e,g)}_parse(e,r){function a(p,g,v){return v==="assert"?new It(g,[p]):v==="coerce"?new At(g,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let v=g.parse(e,this);if(!v)return null;if(this.expectedType){const T=this.expectedType,k=v.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||k.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(T.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array"){if(this.checkSubtype(T,k))return null}else v=a(v,T,r.typeAnnotation||"coerce");else v=a(v,T,r.typeAnnotation||"coerce");else v=a(v,T,r.typeAnnotation||"assert")}if(!(v instanceof ft)&&v.type.kind!=="resolvedImage"&&Wo(v)){const T=new Wt;try{v=new ft(v.type,v.evaluate(T))}catch(k){return this.error(k.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const p=typeof e=="number"?this.path.concat(e):this.path,g=a?this.scope.concat(a):this.scope;return new us(this.registry,p,r||null,g,this.errors)}error(e,...r){const a=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new Er(a,e))}checkSubtype(e,r){const a=Qr(e,r);return a&&this.error(a),a}}function Wo(i){if(i instanceof co)return Wo(i.boundExpression);if(i instanceof oi&&i.name==="error"||i instanceof Gi||i instanceof Vn)return!1;const e=i instanceof At||i instanceof It;let r=!0;return i.eachChild(a=>{r=e?r&&Wo(a):r&&a instanceof ft}),!!r&&Ms(i)&&lo(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function uo(i,e){const r=i.length-1;let a,p,g=0,v=r,T=0;for(;g<=v;)if(T=Math.floor((g+v)/2),a=i[T],p=i[T+1],a<=e){if(T===r||e<p)return T;g=T+1}else{if(!(a>e))throw new rt("Input is not a number.");v=T-1}return 0}class Ps{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[p,g]of a)this.labels.push(p),this.outputs.push(g)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Ke);if(!a)return null;const p=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let v=1;v<e.length;v+=2){const T=v===1?-1/0:e[v],k=e[v+1],z=v,L=v+1;if(typeof T!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(p.length&&p[p.length-1][0]>=T)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const R=r.parse(k,L,g);if(!R)return null;g=g||R.type,p.push([T,R])}return new Ps(g,a,p)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return a[0].evaluate(e);const g=r.length;return p>=r[g-1]?a[g-1].evaluate(e):a[uo(r,p)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function xi(i,e,r){return i*(1-r)+e*r}var Ds=Object.freeze({__proto__:null,number:xi,color:function(i,e,r){return new W(xi(i.r,e.r,r),xi(i.g,e.g,r),xi(i.b,e.b,r),xi(i.a,e.a,r))},array:function(i,e,r){return i.map((a,p)=>xi(a,e[p],r))},padding:function(i,e,r){const a=i.values,p=e.values;return new se([xi(a[0],p[0],r),xi(a[1],p[1],r),xi(a[2],p[2],r),xi(a[3],p[3],r)])}});const Qa=.95047,$a=1.08883,Ko=4/29,ho=6/29,el=3*ho*ho,dc=Math.PI/180,pc=180/Math.PI;function Jo(i){return i>.008856451679035631?Math.pow(i,1/3):i/el+Ko}function Yo(i){return i>ho?i*i*i:el*(i-Ko)}function Qo(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function $o(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Jt(i){const e=$o(i.r),r=$o(i.g),a=$o(i.b),p=Jo((.4124564*e+.3575761*r+.1804375*a)/Qa),g=Jo((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-Jo((.0193339*e+.119192*r+.9503041*a)/$a)),alpha:i.a}}function tl(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,a=isNaN(i.b)?e:e-i.b/200;return e=1*Yo(e),r=Qa*Yo(r),a=$a*Yo(a),new W(Qo(3.2404542*r-1.5371385*e-.4985314*a),Qo(-.969266*r+1.8760108*e+.041556*a),Qo(.0556434*r-.2040259*e+1.0572252*a),i.alpha)}function mc(i,e,r){const a=e-i;return i+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const Ls={forward:Jt,reverse:tl,interpolate:function(i,e,r){return{l:xi(i.l,e.l,r),a:xi(i.a,e.a,r),b:xi(i.b,e.b,r),alpha:xi(i.alpha,e.alpha,r)}}},Bs={forward:function(i){const{l:e,a:r,b:a}=Jt(i),p=Math.atan2(a,r)*pc;return{h:p<0?p+360:p,c:Math.sqrt(r*r+a*a),l:e,alpha:i.a}},reverse:function(i){const e=i.h*dc,r=i.c;return tl({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:mc(i.h,e.h,r),c:xi(i.c,e.c,r),l:xi(i.l,e.l,r),alpha:xi(i.alpha,e.alpha,r)}}};var il=Object.freeze({__proto__:null,lab:Ls,hcl:Bs});class Ir{constructor(e,r,a,p,g){this.type=e,this.operator=r,this.interpolation=a,this.input=p,this.labels=[],this.outputs=[];for(const[v,T]of g)this.labels.push(v),this.outputs.push(T)}static interpolationFactor(e,r,a,p){let g=0;if(e.name==="exponential")g=ea(r,e.base,a,p);else if(e.name==="linear")g=ea(r,1,a,p);else if(e.name==="cubic-bezier"){const v=e.controlPoints;g=new b(v[0],v[1],v[2],v[3]).solve(ea(r,1,a,p))}return g}static parse(e,r){let[a,p,g,...v]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const z=p[1];if(typeof z!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:z}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const z=p.slice(1);if(z.length!==4||z.some(L=>typeof L!="number"||L<0||L>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:z}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,Ke),!g)return null;const T=[];let k=null;a==="interpolate-hcl"||a==="interpolate-lab"?k=Ji:r.expectedType&&r.expectedType.kind!=="value"&&(k=r.expectedType);for(let z=0;z<v.length;z+=2){const L=v[z],R=v[z+1],j=z+3,q=z+4;if(typeof L!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(T.length&&T[T.length-1][0]>=L)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const Z=r.parse(R,q,k);if(!Z)return null;k=k||Z.type,T.push([L,Z])}return k.kind==="number"||k.kind==="color"||k.kind==="padding"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new Ir(k,a,p,g,T):r.error(`Type ${ri(k)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return a[0].evaluate(e);const g=r.length;if(p>=r[g-1])return a[g-1].evaluate(e);const v=uo(r,p),T=Ir.interpolationFactor(this.interpolation,p,r[v],r[v+1]),k=a[v].evaluate(e),z=a[v+1].evaluate(e);return this.operator==="interpolate"?Ds[this.type.kind.toLowerCase()](k,z,T):this.operator==="interpolate-hcl"?Bs.reverse(Bs.interpolate(Bs.forward(k),Bs.forward(z),T)):Ls.reverse(Ls.interpolate(Ls.forward(k),Ls.forward(z),T))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ea(i,e,r,a){const p=a-r,g=i-r;return p===0?0:e===1?g/p:(Math.pow(e,g)-1)/(Math.pow(e,p)-1)}class fo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const p=r.expectedType;p&&p.kind!=="value"&&(a=p);const g=[];for(const T of e.slice(1)){const k=r.parse(T,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!k)return null;a=a||k.type,g.push(k)}if(!a)throw new Error("No output type");const v=p&&g.some(T=>Qr(p,T.type));return new fo(v?Mt:a,g)}evaluate(e){let r,a=null,p=0;for(const g of this.args)if(p++,a=g.evaluate(e),a&&a instanceof he&&!a.available&&(r||(r=a.name),a=null,p===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class po{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let g=1;g<e.length-1;g+=2){const v=e[g];if(typeof v!="string")return r.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const T=r.parse(e[g+1],g+1);if(!T)return null;a.push([v,T])}const p=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return p?new po(a,p):null}outputDefined(){return this.result.outputDefined()}}class ta{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Ke),p=r.parse(e[2],2,hr(r.expectedType||Mt));return a&&p?new ta(p.type.itemType,a,p):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new rt(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new rt(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new rt(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ia{constructor(e,r){this.type=Pt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),p=r.parse(e[2],2,Mt);return a&&p?Rn(a.type,[Pt,Rt,Ke,wn,Mt])?new ia(a,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ri(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Fn(r,["boolean","string","number","null"]))throw new rt(`Expected first argument to be of type boolean, string, number or null, but found ${ri(Ie(r))} instead.`);if(!Fn(a,["string","array"]))throw new rt(`Expected second argument to be of type array or string, but found ${ri(Ie(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class mo{constructor(e,r,a){this.type=Ke,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),p=r.parse(e[2],2,Mt);if(!a||!p)return null;if(!Rn(a.type,[Pt,Rt,Ke,wn,Mt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ri(a.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,Ke);return g?new mo(a,p,g):null}return new mo(a,p)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Fn(r,["boolean","string","number","null"]))throw new rt(`Expected first argument to be of type boolean, string, number or null, but found ${ri(Ie(r))} instead.`);if(!Fn(a,["string","array"]))throw new rt(`Expected second argument to be of type array or string, but found ${ri(Ie(a))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return a.indexOf(r,p)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ra{constructor(e,r,a,p,g,v){this.inputType=e,this.type=r,this.input=a,this.cases=p,this.outputs=g,this.otherwise=v}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const g={},v=[];for(let z=2;z<e.length-1;z+=2){let L=e[z];const R=e[z+1];Array.isArray(L)||(L=[L]);const j=r.concat(z);if(L.length===0)return j.error("Expected at least one branch label.");for(const Z of L){if(typeof Z!="number"&&typeof Z!="string")return j.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return j.error("Numeric branch labels must be integer values.");if(a){if(j.checkSubtype(a,Ie(Z)))return null}else a=Ie(Z);if(g[String(Z)]!==void 0)return j.error("Branch labels must be unique.");g[String(Z)]=v.length}const q=r.parse(R,z,p);if(!q)return null;p=p||q.type,v.push(q)}const T=r.parse(e[1],1,Mt);if(!T)return null;const k=r.parse(e[e.length-1],e.length-1,p);return k?T.type.kind!=="value"&&r.concat(1).checkSubtype(a,T.type)?null:new ra(a,p,T,g,v,k):null}evaluate(e){const r=this.input.evaluate(e);return(Ie(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class na{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const p=[];for(let v=1;v<e.length-1;v+=2){const T=r.parse(e[v],v,Pt);if(!T)return null;const k=r.parse(e[v+1],v+1,a);if(!k)return null;p.push([T,k]),a=a||k.type}const g=r.parse(e[e.length-1],e.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new na(a,p,g)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class go{constructor(e,r,a,p){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Mt),p=r.parse(e[2],2,Ke);if(!a||!p)return null;if(!Rn(a.type,[hr(Mt),Rt,Mt]))return r.error(`Expected first argument to be of type array or string, but found ${ri(a.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,Ke);return g?new go(a.type,a,p,g):null}return new go(a.type,a,p)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Fn(r,["string","array"]))throw new rt(`Expected first argument to be of type array or string, but found ${ri(Ie(r))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return r.slice(a,p)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function rl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function nl(i,e,r,a){return a.compare(e,r)===0}function hs(i,e,r){const a=i!=="=="&&i!=="!=";return class _p{constructor(g,v,T){this.type=Pt,this.lhs=g,this.rhs=v,this.collator=T,this.hasUntypedArgument=g.type.kind==="value"||v.type.kind==="value"}static parse(g,v){if(g.length!==3&&g.length!==4)return v.error("Expected two or three arguments.");const T=g[0];let k=v.parse(g[1],1,Mt);if(!k)return null;if(!rl(T,k.type))return v.concat(1).error(`"${T}" comparisons are not supported for type '${ri(k.type)}'.`);let z=v.parse(g[2],2,Mt);if(!z)return null;if(!rl(T,z.type))return v.concat(2).error(`"${T}" comparisons are not supported for type '${ri(z.type)}'.`);if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return v.error(`Cannot compare types '${ri(k.type)}' and '${ri(z.type)}'.`);a&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new It(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new It(k.type,[z])));let L=null;if(g.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(L=v.parse(g[3],3,cn),!L)return null}return new _p(k,z,L)}evaluate(g){const v=this.lhs.evaluate(g),T=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const k=Ie(v),z=Ie(T);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new rt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${k.kind}, ${z.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const k=Ie(v),z=Ie(T);if(k.kind!=="string"||z.kind!=="string")return e(g,v,T)}return this.collator?r(g,v,T,this.collator.evaluate(g)):e(g,v,T)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const gc=hs("==",function(i,e,r){return e===r},nl),_c=hs("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!nl(0,e,r,a)}),yc=hs("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),vc=hs(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),xc=hs("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),bc=hs(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class sa{constructor(e,r,a,p,g){this.type=Rt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Ke);if(!a)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=r.parse(p.locale,1,Rt),!g))return null;let v=null;if(p.currency&&(v=r.parse(p.currency,1,Rt),!v))return null;let T=null;if(p["min-fraction-digits"]&&(T=r.parse(p["min-fraction-digits"],1,Ke),!T))return null;let k=null;return p["max-fraction-digits"]&&(k=r.parse(p["max-fraction-digits"],1,Ke),!k)?null:new sa(a,g,v,T,k)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class _o{constructor(e){this.type=ji,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const p=[];let g=!1;for(let v=1;v<=e.length-1;++v){const T=e[v];if(g&&typeof T=="object"&&!Array.isArray(T)){g=!1;let k=null;if(T["font-scale"]&&(k=r.parse(T["font-scale"],1,Ke),!k))return null;let z=null;if(T["text-font"]&&(z=r.parse(T["text-font"],1,hr(Rt)),!z))return null;let L=null;if(T["text-color"]&&(L=r.parse(T["text-color"],1,Ji),!L))return null;const R=p[p.length-1];R.scale=k,R.font=z,R.textColor=L}else{const k=r.parse(e[v],1,Mt);if(!k)return null;const z=k.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:k,scale:null,font:null,textColor:null})}}return new _o(p)}evaluate(e){return new oe(this.sections.map(r=>{const a=r.content.evaluate(e);return Ie(a)===Pi?new ce("",a,null,null,null):new ce(ut(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class oa{constructor(e){this.type=Pi,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Rt);return a?new oa(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=he.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class aa{constructor(e){this.type=Ke,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ri(a.type)} instead.`):new aa(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new rt(`Expected value to be of type string or array, but found ${ri(Ie(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const fs={"==":gc,"!=":_c,">":vc,"<":yc,">=":bc,"<=":xc,array:It,at:ta,boolean:It,case:na,coalesce:fo,collator:Gi,format:_o,image:oa,in:ia,"index-of":mo,interpolate:Ir,"interpolate-hcl":Ir,"interpolate-lab":Ir,length:aa,let:po,literal:ft,match:ra,number:It,"number-format":sa,object:It,slice:go,step:Ps,string:It,"to-boolean":At,"to-color":At,"to-number":At,"to-string":At,var:co,within:Vn};function sl(i,[e,r,a,p]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const g=p?p.evaluate(i):1,v=Ce(e,r,a,g);if(v)throw new rt(v);return new W(e/255*g,r/255*g,a/255*g,g)}function ol(i,e){return i in e}function yo(i,e){const r=e[i];return r===void 0?null:r}function Un(i){return{type:i}}function al(i){return{result:"success",value:i}}function ds(i){return{result:"error",value:i}}function gi(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ll(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function jt(i){return!!i.expression&&i.expression.interpolated}function Yt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function mi(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function bi(i){return i}function Rs(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",p=a||!(a||i.property!==void 0),g=i.type||(jt(e)?"exponential":"interval");if(r||e.type==="padding"){const z=r?W.parse:se.parse;(i=jr({},i)).stops&&(i.stops=i.stops.map(L=>[L[0],z(L[1])])),i.default=z(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!il[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let v,T,k;if(g==="exponential")v=cl;else if(g==="interval")v=Tc;else if(g==="categorical"){v=wc,T=Object.create(null);for(const z of i.stops)T[z[0]]=z[1];k=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=kc}if(a){const z={},L=[];for(let q=0;q<i.stops.length;q++){const Z=i.stops[q],re=Z[0].zoom;z[re]===void 0&&(z[re]={zoom:re,type:i.type,property:i.property,default:i.default,stops:[]},L.push(re)),z[re].stops.push([Z[0].value,Z[1]])}const R=[];for(const q of L)R.push([z[q].zoom,Rs(z[q],e)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Ir.interpolationFactor.bind(void 0,j),zoomStops:R.map(q=>q[0]),evaluate:({zoom:q},Z)=>cl({stops:R,base:i.base},e,q).evaluate(q,Z)}}if(p){const z=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:Ir.interpolationFactor.bind(void 0,z),zoomStops:i.stops.map(L=>L[0]),evaluate:({zoom:L})=>v(i,e,L,T,k)}}return{kind:"source",evaluate(z,L){const R=L&&L.properties?L.properties[i.property]:void 0;return R===void 0?ps(i.default,e.default):v(i,e,R,T,k)}}}function ps(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function wc(i,e,r,a,p){return ps(typeof r===p?a[r]:void 0,i.default,e.default)}function Tc(i,e,r){if(Yt(r)!=="number")return ps(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const p=uo(i.stops.map(g=>g[0]),r);return i.stops[p][1]}function cl(i,e,r){const a=i.base!==void 0?i.base:1;if(Yt(r)!=="number")return ps(i.default,e.default);const p=i.stops.length;if(p===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[p-1][0])return i.stops[p-1][1];const g=uo(i.stops.map(L=>L[0]),r),v=function(L,R,j,q){const Z=q-j,re=L-j;return Z===0?0:R===1?re/Z:(Math.pow(R,re)-1)/(Math.pow(R,Z)-1)}(r,a,i.stops[g][0],i.stops[g+1][0]),T=i.stops[g][1],k=i.stops[g+1][1];let z=Ds[e.type]||bi;if(i.colorSpace&&i.colorSpace!=="rgb"){const L=il[i.colorSpace];z=(R,j)=>L.reverse(L.interpolate(L.forward(R),L.forward(j),v))}return typeof T.evaluate=="function"?{evaluate(...L){const R=T.evaluate.apply(void 0,L),j=k.evaluate.apply(void 0,L);if(R!==void 0&&j!==void 0)return z(R,j,v)}}:z(T,k,v)}function kc(i,e,r){switch(e.type){case"color":r=W.parse(r);break;case"formatted":r=oe.fromString(r.toString());break;case"resolvedImage":r=he.fromString(r.toString());break;case"padding":r=se.parse(r);break;default:Yt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return ps(r,i.default,e.default)}oi.register(fs,{error:[{kind:"error"},[Rt],(i,[e])=>{throw new rt(e.evaluate(i))}],typeof:[Rt,[Mt],(i,[e])=>ri(Ie(e.evaluate(i)))],"to-rgba":[hr(Ke,4),[Ji],(i,[e])=>e.evaluate(i).toArray()],rgb:[Ji,[Ke,Ke,Ke],sl],rgba:[Ji,[Ke,Ke,Ke,Ke],sl],has:{type:Pt,overloads:[[[Rt],(i,[e])=>ol(e.evaluate(i),i.properties())],[[Rt,Tn],(i,[e,r])=>ol(e.evaluate(i),r.evaluate(i))]]},get:{type:Mt,overloads:[[[Rt],(i,[e])=>yo(e.evaluate(i),i.properties())],[[Rt,Tn],(i,[e,r])=>yo(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Mt,[Rt],(i,[e])=>yo(e.evaluate(i),i.featureState||{})],properties:[Tn,[],i=>i.properties()],"geometry-type":[Rt,[],i=>i.geometryType()],id:[Mt,[],i=>i.id()],zoom:[Ke,[],i=>i.globals.zoom],"heatmap-density":[Ke,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ke,[],i=>i.globals.lineProgress||0],accumulated:[Mt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ke,Un(Ke),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[Ke,Un(Ke),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:Ke,overloads:[[[Ke,Ke],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ke],(i,[e])=>-e.evaluate(i)]]},"/":[Ke,[Ke,Ke],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ke,[Ke,Ke],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ke,[Ke],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ke,[Ke],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ke,[Ke],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ke,[Ke],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ke,[Ke],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ke,[Ke],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ke,[Ke],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ke,[Ke],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ke,[Ke],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ke,[Ke],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ke,Un(Ke),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ke,Un(Ke),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ke,[Ke],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ke,[Ke],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ke,[Ke],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ke,[Ke],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Pt,[Rt,Mt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Pt,[Mt],(i,[e])=>i.id()===e.value],"filter-type-==":[Pt,[Rt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Pt,[Rt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],p=r.value;return typeof a==typeof p&&a<p}],"filter-id-<":[Pt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[Pt,[Rt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],p=r.value;return typeof a==typeof p&&a>p}],"filter-id->":[Pt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[Pt,[Rt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],p=r.value;return typeof a==typeof p&&a<=p}],"filter-id-<=":[Pt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[Pt,[Rt,Mt],(i,[e,r])=>{const a=i.properties()[e.value],p=r.value;return typeof a==typeof p&&a>=p}],"filter-id->=":[Pt,[Mt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[Pt,[Mt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Pt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Pt,[hr(Rt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Pt,[hr(Mt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Pt,[Rt,hr(Mt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Pt,[Rt,hr(Mt)],(i,[e,r])=>function(a,p,g,v){for(;g<=v;){const T=g+v>>1;if(p[T]===a)return!0;p[T]>a?v=T-1:g=T+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Un(Pt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Un(Pt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Pt,[Pt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Pt,[Rt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Rt,[Rt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Rt,[Rt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Rt,Un(Mt),(i,e)=>e.map(r=>ut(r.evaluate(i))).join("")],"resolved-locale":[Rt,[cn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class vo{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Wt,this._defaultValue=r?function(a){return a.type==="color"&&mi(a.default)?new W(0,0,0,0):a.type==="color"?W.parse(a.default)||null:a.type==="padding"?se.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,p,g,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,p,g,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new rt(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Fs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in fs}function Os(i,e){const r=new us(fs,[],e?function(p){const g={color:Ji,string:Rt,number:Ke,enum:Rt,boolean:Pt,formatted:ji,padding:ss,resolvedImage:Pi};return p.type==="array"?hr(g[p.value]||Mt,p.length):g[p.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?al(new vo(a,e)):ds(r.errors)}class Vs{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!cs(r.expression)}evaluateWithoutErrorHandling(e,r,a,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,p,g,v)}evaluate(e,r,a,p,g,v){return this._styleExpression.evaluate(e,r,a,p,g,v)}}class la{constructor(e,r,a,p){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!cs(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,a,p,g,v){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,p,g,v)}evaluate(e,r,a,p,g,v){return this._styleExpression.evaluate(e,r,a,p,g,v)}interpolationFactor(e,r,a){return this.interpolationType?Ir.interpolationFactor(this.interpolationType,e,r,a):0}}function ul(i,e){const r=Os(i,e);if(r.result==="error")return r;const a=r.value.expression,p=Ms(a);if(!p&&!gi(e))return ds([new Er("","data expressions not supported")]);const g=lo(a,["zoom"]);if(!g&&!ll(e))return ds([new Er("","zoom expressions not supported")]);const v=bo(a);return v||g?v instanceof Er?ds([v]):v instanceof Ir&&!jt(e)?ds([new Er("",'"interpolate" expressions cannot be used with this property')]):al(v?new la(p?"camera":"composite",r.value,v.labels,v instanceof Ir?v.interpolation:void 0):new Vs(p?"constant":"source",r.value)):ds([new Er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xo{constructor(e,r){this._parameters=e,this._specification=r,jr(this,Rs(this._parameters,this._specification))}static deserialize(e){return new xo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function bo(i){let e=null;if(i instanceof po)e=bo(i.result);else if(i instanceof fo){for(const r of i.args)if(e=bo(r),e)break}else(i instanceof Ps||i instanceof Ir)&&i.input instanceof oi&&i.input.name==="zoom"&&(e=i);return e instanceof Er||i.eachChild(r=>{const a=bo(r);a instanceof Er?e=a:!e&&a?e=new Er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Er("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Gr(i){const e=i.key,r=i.value,a=i.valueSpec||{},p=i.objectElementValidators||{},g=i.style,v=i.styleSpec;let T=[];const k=Yt(r);if(k!=="object")return[new Qe(e,r,`object expected, ${k} found`)];for(const z in r){const L=z.split(".")[0],R=a[L]||a["*"];let j;if(p[L])j=p[L];else if(a[L])j=Ar;else if(p["*"])j=p["*"];else{if(!a["*"]){T.push(new Qe(e,r[z],`unknown property "${z}"`));continue}j=Ar}T=T.concat(j({key:(e&&`${e}.`)+z,value:r[z],valueSpec:R,style:g,styleSpec:v,object:r,objectKey:z},r))}for(const z in a)p[z]||a[z].required&&a[z].default===void 0&&r[z]===void 0&&T.push(new Qe(e,r,`missing required property "${z}"`));return T}function hl(i){const e=i.value,r=i.valueSpec,a=i.style,p=i.styleSpec,g=i.key,v=i.arrayElementValidator||Ar;if(Yt(e)!=="array")return[new Qe(g,e,`array expected, ${Yt(e)} found`)];if(r.length&&e.length!==r.length)return[new Qe(g,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Qe(g,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let T={type:r.value,values:r.values};p.$version<7&&(T.function=r.function),Yt(r.value)==="object"&&(T=r.value);let k=[];for(let z=0;z<e.length;z++)k=k.concat(v({array:e,arrayIndex:z,value:e[z],valueSpec:T,style:a,styleSpec:p,key:`${g}[${z}]`}));return k}function ca(i){const e=i.key,r=i.value,a=i.valueSpec;let p=Yt(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new Qe(e,r,`number expected, ${p} found`)]:"minimum"in a&&r<a.minimum?[new Qe(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Qe(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function fl(i){const e=i.valueSpec,r=Xt(i.value.type);let a,p,g,v={};const T=r!=="categorical"&&i.value.property===void 0,k=!T,z=Yt(i.value.stops)==="array"&&Yt(i.value.stops[0])==="array"&&Yt(i.value.stops[0][0])==="object",L=Gr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(q){if(r==="identity")return[new Qe(q.key,q.value,'identity function may not have a "stops" property')];let Z=[];const re=q.value;return Z=Z.concat(hl({key:q.key,value:re,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:R})),Yt(re)==="array"&&re.length===0&&Z.push(new Qe(q.key,re,"array must have at least one stop")),Z},default:function(q){return Ar({key:q.key,value:q.value,valueSpec:e,style:q.style,styleSpec:q.styleSpec})}}});return r==="identity"&&T&&L.push(new Qe(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||L.push(new Qe(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!jt(i.valueSpec)&&L.push(new Qe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(k&&!gi(i.valueSpec)?L.push(new Qe(i.key,i.value,"property functions not supported")):T&&!ll(i.valueSpec)&&L.push(new Qe(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!z||i.value.property!==void 0||L.push(new Qe(i.key,i.value,'"property" property is required')),L;function R(q){let Z=[];const re=q.value,ie=q.key;if(Yt(re)!=="array")return[new Qe(ie,re,`array expected, ${Yt(re)} found`)];if(re.length!==2)return[new Qe(ie,re,`array length 2 expected, length ${re.length} found`)];if(z){if(Yt(re[0])!=="object")return[new Qe(ie,re,`object expected, ${Yt(re[0])} found`)];if(re[0].zoom===void 0)return[new Qe(ie,re,"object stop key must have zoom")];if(re[0].value===void 0)return[new Qe(ie,re,"object stop key must have value")];if(g&&g>Xt(re[0].zoom))return[new Qe(ie,re[0].zoom,"stop zoom values must appear in ascending order")];Xt(re[0].zoom)!==g&&(g=Xt(re[0].zoom),p=void 0,v={}),Z=Z.concat(Gr({key:`${ie}[0]`,value:re[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:ca,value:j}}))}else Z=Z.concat(j({key:`${ie}[0]`,value:re[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},re));return Fs(Fr(re[1]))?Z.concat([new Qe(`${ie}[1]`,re[1],"expressions are not allowed in function stops.")]):Z.concat(Ar({key:`${ie}[1]`,value:re[1],valueSpec:e,style:q.style,styleSpec:q.styleSpec}))}function j(q,Z){const re=Yt(q.value),ie=Xt(q.value),me=q.value!==null?q.value:Z;if(a){if(re!==a)return[new Qe(q.key,me,`${re} stop domain type must match previous stop domain type ${a}`)]}else a=re;if(re!=="number"&&re!=="string"&&re!=="boolean")return[new Qe(q.key,me,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&r!=="categorical"){let ke=`number expected, ${re} found`;return gi(e)&&r===void 0&&(ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(q.key,me,ke)]}return r!=="categorical"||re!=="number"||isFinite(ie)&&Math.floor(ie)===ie?r!=="categorical"&&re==="number"&&p!==void 0&&ie<p?[new Qe(q.key,me,"stop domain values must appear in ascending order")]:(p=ie,r==="categorical"&&ie in v?[new Qe(q.key,me,"stop domain values must be unique")]:(v[ie]=!0,[])):[new Qe(q.key,me,`integer expected, found ${ie}`)]}}function Nn(i){const e=(i.expressionContext==="property"?ul:Os)(Fr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new Qe(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Qe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!cs(r))return[new Qe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!cs(r))return[new Qe(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!lo(r,["zoom","feature-state"]))return[new Qe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ms(r))return[new Qe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Us(i){const e=i.key,r=i.value,a=i.valueSpec,p=[];return Array.isArray(a.values)?a.values.indexOf(Xt(r))===-1&&p.push(new Qe(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Xt(r))===-1&&p.push(new Qe(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function ms(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ms(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ec={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wo(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ms(i)||(i=Ns(i));const e=Os(i,Ec);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,p)=>e.value.evaluate(r,a,{},p),needGeometry:pl(i)}}function dl(i,e){return i<e?-1:i>e?1:0}function pl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(pl(i[e]))return!0;return!1}function Ns(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ua(i[1],i[2],"=="):e==="!="?gs(ua(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ua(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Ns))):e==="all"?["all"].concat(i.slice(1).map(Ns)):e==="none"?["all"].concat(i.slice(1).map(Ns).map(gs)):e==="in"?To(i[1],i.slice(2)):e==="!in"?gs(To(i[1],i.slice(2))):e==="has"?js(i[1]):e==="!has"?gs(js(i[1])):e!=="within"||i;var r}function ua(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function To(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(dl)]]:["filter-in-small",i,["literal",e]]}}function js(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function gs(i){return["!",i]}function Gs(i){return ms(Fr(i.value))?Nn(jr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ml(i)}function ml(i){const e=i.value,r=i.key;if(Yt(e)!=="array")return[new Qe(r,e,`array expected, ${Yt(e)} found`)];const a=i.styleSpec;let p,g=[];if(e.length<1)return[new Qe(r,e,"filter array must have at least 1 element")];switch(g=g.concat(Us({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Xt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Xt(e[1])==="$type"&&g.push(new Qe(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Qe(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Yt(e[1]),p!=="string"&&g.push(new Qe(`${r}[1]`,e[1],`string expected, ${p} found`)));for(let v=2;v<e.length;v++)p=Yt(e[v]),Xt(e[1])==="$type"?g=g.concat(Us({key:`${r}[${v}]`,value:e[v],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new Qe(`${r}[${v}]`,e[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<e.length;v++)g=g.concat(ml({key:`${r}[${v}]`,value:e[v],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Yt(e[1]),e.length!==2?g.push(new Qe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new Qe(`${r}[1]`,e[1],`string expected, ${p} found`));break;case"within":p=Yt(e[1]),e.length!==2?g.push(new Qe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="object"&&g.push(new Qe(`${r}[1]`,e[1],`object expected, ${p} found`))}return g}function qs(i,e){const r=i.key,a=i.style,p=i.styleSpec,g=i.value,v=i.objectKey,T=p[`${e}_${i.layerType}`];if(!T)return[];const k=v.match(/^(.*)-transition$/);if(e==="paint"&&k&&T[k[1]]&&T[k[1]].transition)return Ar({key:r,value:g,valueSpec:p.transition,style:a,styleSpec:p});const z=i.valueSpec||T[v];if(!z)return[new Qe(r,g,`unknown property "${v}"`)];let L;if(Yt(g)==="string"&&gi(z)&&!z.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new Qe(r,g,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const R=[];return i.layerType==="symbol"&&(v==="text-field"&&a&&!a.glyphs&&R.push(new Qe(r,g,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&mi(Fr(g))&&Xt(g.type)==="identity"&&R.push(new Qe(r,g,'"text-font" does not support identity functions'))),R.concat(Ar({key:i.key,value:g,valueSpec:z,style:a,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:v}))}function gl(i){return qs(i,"paint")}function _l(i){return qs(i,"layout")}function yl(i){let e=[];const r=i.value,a=i.key,p=i.style,g=i.styleSpec;r.type||r.ref||e.push(new Qe(a,r,'either "type" or "ref" is required'));let v=Xt(r.type);const T=Xt(r.ref);if(r.id){const k=Xt(r.id);for(let z=0;z<i.arrayIndex;z++){const L=p.layers[z];Xt(L.id)===k&&e.push(new Qe(a,r.id,`duplicate layer id "${r.id}", previously used at line ${L.id.__line__}`))}}if("ref"in r){let k;["type","source","source-layer","filter","layout"].forEach(z=>{z in r&&e.push(new Qe(a,r[z],`"${z}" is prohibited for ref layers`))}),p.layers.forEach(z=>{Xt(z.id)===T&&(k=z)}),k?k.ref?e.push(new Qe(a,r.ref,"ref cannot reference another ref layer")):v=Xt(k.type):e.push(new Qe(a,r.ref,`ref layer "${T}" not found`))}else if(v!=="background")if(r.source){const k=p.sources&&p.sources[r.source],z=k&&Xt(k.type);k?z==="vector"&&v==="raster"?e.push(new Qe(a,r.source,`layer "${r.id}" requires a raster source`)):z==="raster"&&v!=="raster"?e.push(new Qe(a,r.source,`layer "${r.id}" requires a vector source`)):z!=="vector"||r["source-layer"]?z==="raster-dem"&&v!=="hillshade"?e.push(new Qe(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!r.paint||!r.paint["line-gradient"]||z==="geojson"&&k.lineMetrics||e.push(new Qe(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Qe(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Qe(a,r.source,`source "${r.source}" not found`))}else e.push(new Qe(a,r,'missing required property "source"'));return e=e.concat(Gr({key:a,value:r,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ar({key:`${a}.type`,value:r.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:Gs,layout:k=>Gr({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":z=>_l(jr({layerType:v},z))}}),paint:k=>Gr({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":z=>gl(jr({layerType:v},z))}})}})),e}function _s(i){const e=i.value,r=i.key,a=Yt(e);return a!=="string"?[new Qe(r,e,`string expected, ${a} found`)]:[]}const vl={promoteId:function({key:i,value:e}){if(Yt(e)==="string")return _s({key:i,value:e});{const r=[];for(const a in e)r.push(..._s({key:`${i}.${a}`,value:e[a]}));return r}}};function Zs(i){const e=i.value,r=i.key,a=i.styleSpec,p=i.style;if(!e.type)return[new Qe(r,e,'"type" is required')];const g=Xt(e.type);let v;switch(g){case"vector":case"raster":case"raster-dem":return v=Gr({key:r,value:e,valueSpec:a[`source_${g.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:vl}),v;case"geojson":if(v=Gr({key:r,value:e,valueSpec:a.source_geojson,style:p,styleSpec:a,objectElementValidators:vl}),e.cluster)for(const T in e.clusterProperties){const[k,z]=e.clusterProperties[T],L=typeof k=="string"?[k,["accumulated"],["get",T]]:k;v.push(...Nn({key:`${r}.${T}.map`,value:z,expressionContext:"cluster-map"})),v.push(...Nn({key:`${r}.${T}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return Gr({key:r,value:e,valueSpec:a.source_video,style:p,styleSpec:a});case"image":return Gr({key:r,value:e,valueSpec:a.source_image,style:p,styleSpec:a});case"canvas":return[new Qe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Us({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:a})}}function Xs(i){const e=i.value,r=i.styleSpec,a=r.light,p=i.style;let g=[];const v=Yt(e);if(e===void 0)return g;if(v!=="object")return g=g.concat([new Qe("light",e,`object expected, ${v} found`)]),g;for(const T in e){const k=T.match(/^(.*)-transition$/);g=g.concat(k&&a[k[1]]&&a[k[1]].transition?Ar({key:T,value:e[T],valueSpec:r.transition,style:p,styleSpec:r}):a[T]?Ar({key:T,value:e[T],valueSpec:a[T],style:p,styleSpec:r}):[new Qe(T,e[T],`unknown property "${T}"`)])}return g}function Cr(i){const e=i.value,r=i.styleSpec,a=r.terrain,p=i.style;let g=[];const v=Yt(e);if(e===void 0)return g;if(v!=="object")return g=g.concat([new Qe("terrain",e,`object expected, ${v} found`)]),g;for(const T in e)g=g.concat(a[T]?Ar({key:T,value:e[T],valueSpec:a[T],style:p,styleSpec:r}):[new Qe(T,e[T],`unknown property "${T}"`)]);return g}const Hs={"*":()=>[],array:hl,boolean:function(i){const e=i.value,r=i.key,a=Yt(e);return a!=="boolean"?[new Qe(r,e,`boolean expected, ${a} found`)]:[]},number:ca,color:function(i){const e=i.key,r=i.value,a=Yt(r);return a!=="string"?[new Qe(e,r,`color expected, ${a} found`)]:as(r)===null?[new Qe(e,r,`color expected, "${r}" found`)]:[]},constants:Bn,enum:Us,filter:Gs,function:fl,layer:yl,object:Gr,source:Zs,light:Xs,terrain:Cr,string:_s,formatted:function(i){return _s(i).length===0?[]:Nn(i)},resolvedImage:function(i){return _s(i).length===0?[]:Nn(i)},padding:function(i){const e=i.key,r=i.value;if(Yt(r)==="array"){if(r.length<1||r.length>4)return[new Qe(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let p=[];for(let g=0;g<r.length;g++)p=p.concat(Ar({key:`${e}[${g}]`,value:r[g],valueSpec:a}));return p}return ca({key:e,value:r,valueSpec:{}})}};function Ar(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return r.expression&&mi(Xt(e))?fl(i):r.expression&&Fs(Fr(e))?Nn(i):r.type&&Hs[r.type]?Hs[r.type](i):Gr(jr({},i,{valueSpec:r.type?a[r.type]:r}))}function Sc(i){const e=i.value,r=i.key,a=_s(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Qe(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Qe(r,e,'"glyphs" url must include a "{range}" token'))),a}function kn(i,e=Le){let r=[];return r=r.concat(Ar({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Sc,"*":()=>[]}})),i.constants&&(r=r.concat(Bn({key:"constants",value:i.constants,style:i,styleSpec:e}))),xl(r)}function xl(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function un(i){return function(...e){return xl(i.apply(this,e))}}kn.source=un(Zs),kn.light=un(Xs),kn.terrain=un(Cr),kn.layer=un(yl),kn.filter=un(Gs),kn.paintProperty=un(gl),kn.layoutProperty=un(_l);const Ws=kn,ha=Ws.light,Ic=Ws.paintProperty,Cc=Ws.layoutProperty;function ko(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new ns(new Error(a.message))),r=!0;return r}class Ks{constructor(e,r,a){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(r=v[1])+2*(a=v[2]);for(let k=0;k<this.d*this.d;k++){const z=v[3+k],L=v[3+k+1];p.push(z===L?null:v.subarray(z,L))}const T=v[3+p.length+1];this.keys=v.subarray(v[3+p.length],T),this.bboxes=v.subarray(T),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let v=0;v<this.d*this.d;v++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const g=a/r*e;this.min=-g,this.max=e+g}insert(e,r,a,p,g){this._forEachCell(r,a,p,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,p,g,v){this.cells[g].push(v)}query(e,r,a,p,g){const v=this.min,T=this.max;if(e<=v&&r<=v&&T<=a&&T<=p&&!g)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(e,r,a,p,this._queryCell,k,{},g),k}}_queryCell(e,r,a,p,g,v,T,k){const z=this.cells[g];if(z!==null){const L=this.keys,R=this.bboxes;for(let j=0;j<z.length;j++){const q=z[j];if(T[q]===void 0){const Z=4*q;(k?k(R[Z+0],R[Z+1],R[Z+2],R[Z+3]):e<=R[Z+2]&&r<=R[Z+3]&&a>=R[Z+0]&&p>=R[Z+1])?(T[q]=!0,v.push(L[q])):T[q]=!1}}}}_forEachCell(e,r,a,p,g,v,T,k){const z=this._convertToCellCoord(e),L=this._convertToCellCoord(r),R=this._convertToCellCoord(a),j=this._convertToCellCoord(p);for(let q=z;q<=R;q++)for(let Z=L;Z<=j;Z++){const re=this.d*Z+q;if((!k||k(this._convertFromCellCoord(q),this._convertFromCellCoord(Z),this._convertFromCellCoord(q+1),this._convertFromCellCoord(Z+1)))&&g.call(this,e,r,a,p,re,v,T,k))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let v=0;v<this.cells.length;v++)a+=this.cells[v].length;const p=new Int32Array(r+a+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let g=r;for(let v=0;v<e.length;v++){const T=e[v];p[3+v]=g,p.set(T,g),g+=T.length}return p[3+e.length]=g,p.set(this.keys,g),g+=this.keys.length,p[3+e.length+1]=g,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new Ks(e.buffer)}}const hn={};function ct(i,e,r={}){if(hn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),hn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}ct("Object",Object),ct("TransferableGridIndex",Ks),ct("Color",W),ct("Error",Error),ct("AJAXError",kr),ct("ResolvedImage",he),ct("StylePropertyFunction",xo),ct("StyleExpression",vo,{omit:["_evaluator"]}),ct("ZoomDependentExpression",la),ct("ZoomConstantExpression",Vs),ct("CompoundExpression",oi,{omit:["_evaluate"]});for(const i in fs)fs[i]._classRegistryKey||ct(`Expression_${i}`,fs[i]);function bl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function jn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(bl(i)||nr(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(jn(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!hn[a])throw new Error(`${a} is not registered.`);const p=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&p===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||hn[a].omit.indexOf(g)>=0)continue;const v=i[g];p[g]=hn[a].shallow.indexOf(g)>=0?v:jn(v,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(p.$name=a),p}throw new Error("can't serialize object of type "+typeof i)}function En(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||bl(i)||nr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(En);if(typeof i=="object"){const e=i.$name||"Object";if(!hn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=hn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const g=i[p];a[p]=hn[e].shallow.indexOf(p)>=0?g:En(g)}return a}throw new Error("can't deserialize object of type "+typeof i)}class fa{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const et={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Eo(i){for(const e of i)if(pa(e.charCodeAt(0)))return!0;return!1}function Ac(i){for(const e of i)if(!da(e.charCodeAt(0)))return!1;return!0}function da(i){return!(et.Arabic(i)||et["Arabic Supplement"](i)||et["Arabic Extended-A"](i)||et["Arabic Presentation Forms-A"](i)||et["Arabic Presentation Forms-B"](i))}function pa(i){return!(i!==746&&i!==747&&(i<4352||!(et["Bopomofo Extended"](i)||et.Bopomofo(i)||et["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||et["CJK Compatibility Ideographs"](i)||et["CJK Compatibility"](i)||et["CJK Radicals Supplement"](i)||et["CJK Strokes"](i)||!(!et["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||et["CJK Unified Ideographs Extension A"](i)||et["CJK Unified Ideographs"](i)||et["Enclosed CJK Letters and Months"](i)||et["Hangul Compatibility Jamo"](i)||et["Hangul Jamo Extended-A"](i)||et["Hangul Jamo Extended-B"](i)||et["Hangul Jamo"](i)||et["Hangul Syllables"](i)||et.Hiragana(i)||et["Ideographic Description Characters"](i)||et.Kanbun(i)||et["Kangxi Radicals"](i)||et["Katakana Phonetic Extensions"](i)||et.Katakana(i)&&i!==12540||!(!et["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!et["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||et["Unified Canadian Aboriginal Syllabics"](i)||et["Unified Canadian Aboriginal Syllabics Extended"](i)||et["Vertical Forms"](i)||et["Yijing Hexagram Symbols"](i)||et["Yi Syllables"](i)||et["Yi Radicals"](i))))}function wl(i){return!(pa(i)||function(e){return!!(et["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||et["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||et["Letterlike Symbols"](e)||et["Number Forms"](e)||et["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||et["Control Pictures"](e)&&e!==9251||et["Optical Character Recognition"](e)||et["Enclosed Alphanumerics"](e)||et["Geometric Shapes"](e)||et["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||et["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||et["CJK Symbols and Punctuation"](e)||et.Katakana(e)||et["Private Use Area"](e)||et["CJK Compatibility Forms"](e)||et["Small Form Variants"](e)||et["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Tl(i){return i>=1424&&i<=2303||et["Arabic Presentation Forms-A"](i)||et["Arabic Presentation Forms-B"](i)}function zc(i,e){return!(!e&&Tl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||et.Khmer(i))}function kl(i){for(const e of i)if(Tl(e.charCodeAt(0)))return!0;return!1}const ma="deferred",ga="loading",_a="loaded";let ya=null,yr="unavailable",Sn=null;const El=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(yr="error"),ya&&ya(i)};function ys(){va.fire(new an("pluginStateChange",{pluginStatus:yr,pluginURL:Sn}))}const va=new ln,Js=function(){return yr},Sl=function(){if(yr!==ma||!Sn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");yr=ga,ys(),Sn&&rs({url:Sn},i=>{i?El(i):(yr=_a,ys())})},Or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>yr===_a||Or.applyArabicShaping!=null,isLoading:()=>yr===ga,setState(i){if(!Ue())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");yr=i.pluginStatus,Sn=i.pluginURL},isParsed(){if(!Ue())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Or.applyArabicShaping!=null&&Or.processBidirectionalText!=null&&Or.processStyledBidirectionalText!=null},getPluginURL(){if(!Ue())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Sn}};class wi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new fa,this.transition={})}isSupportedScript(e){return function(r,a){for(const p of r)if(!zc(p.charCodeAt(0),a))return!1;return!0}(e,Or.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class Ys{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,p){if(mi(a))return new xo(a,p);if(Fs(a)){const g=ul(a,p);if(g.result==="error")throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=a;return p.type==="color"&&typeof a=="string"?g=W.parse(a):p.type!=="padding"||typeof a!="number"&&!Array.isArray(a)||(g=se.parse(a)),{kind:"constant",evaluate:()=>g}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class So{constructor(e){this.property=e,this.value=new Ys(e,void 0)}transitioned(e,r){return new Cl(this.property,this.value,r,U({},e.transition,this.transition),e.now)}untransitioned(){return new Cl(this.property,this.value,null,{},0)}}class Il{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Se(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new So(this._values[e].property)),this._values[e].value=new Ys(this._values[e].property,r===null?void 0:Se(r))}getTransition(e){return Se(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new So(this._values[e].property)),this._values[e].transition=Se(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){const a=new Al(this._properties);for(const p of Object.keys(this._values))a._values[p]=this._values[p].transitioned(e,r._values[p]);return a}untransitioned(){const e=new Al(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Cl{constructor(e,r,a,p,g){this.property=e,this.value=r,this.begin=g+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const p=e.now||0,g=this.value.possiblyEvaluate(e,r,a),v=this.prior;if(v){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return v.possiblyEvaluate(e,r,a);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(e,r,a),g,function(k){if(k<=0)return 0;if(k>=1)return 1;const z=k*k,L=z*k;return 4*(k<.5?L:3*(k-z)+L-.75)}(T))}}return g}}class Al{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const p=new Qs(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(e,r,a);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Mc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Se(this._values[e].value)}setValue(e,r){this._values[e]=new Ys(this._values[e].property,r===null?void 0:Se(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const p=new Qs(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(e,r,a);return p}}class $r{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,p){return this.property.evaluate(this.value,this.parameters,e,r,a,p)}}class Qs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const p=Ds[this.specification.type];return p?p(e,r,a):e}}class Tt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,p){return new $r(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,p)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new $r(this,{kind:"constant",value:void 0},e.parameters);const p=Ds[this.specification.type];return p?new $r(this,{kind:"constant",value:p(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,p,g,v){return e.kind==="constant"?e.value:e.evaluate(r,a,p,g,v)}}class vs extends Tt{possiblyEvaluate(e,r,a,p){if(e.value===void 0)return new $r(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},a,p),v=e.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,T=this._calculate(v,v,v,r);return new $r(this,{kind:"constant",value:T},r)}if(e.expression.kind==="camera"){const g=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new $r(this,{kind:"constant",value:g},r)}return new $r(this,e.expression,r)}evaluate(e,r,a,p,g,v){if(e.kind==="source"){const T=e.evaluate(r,a,p,g,v);return this._calculate(T,T,T,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,p),e.evaluate({zoom:Math.floor(r.zoom)},a,p),e.evaluate({zoom:Math.floor(r.zoom)+1},a,p),r):e.value}_calculate(e,r,a,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class xa{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},a,p);return this._calculate(g,g,g,r)}return this._calculate(e.expression.evaluate(new wi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new wi(Math.floor(r.zoom),r)),e.expression.evaluate(new wi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class In{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,p){return!!e.expression.evaluate(r,null,{},a,p)}interpolate(){return!1}}class Yi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const p=this.defaultPropertyValues[r]=new Ys(a,void 0),g=this.defaultTransitionablePropertyValues[r]=new So(a);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}ct("DataDrivenProperty",Tt),ct("DataConstantProperty",pt),ct("CrossFadedDataDrivenProperty",vs),ct("CrossFadedProperty",xa),ct("ColorRampProperty",In);const Cn="-transition";class en extends ln{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Mc(r.layout)),r.paint)){this._transitionablePaint=new Il(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qs(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(Cc,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Cn)?this._transitionablePaint.getTransition(e.slice(0,-Cn.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(Ic,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(Cn))return this._transitionablePaint.setTransition(e.slice(0,-Cn.length),r||void 0),!1;{const p=this._transitionablePaint._values[e],g=p.property.specification["property-type"]==="cross-faded-data-driven",v=p.value.isDataDriven(),T=p.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const k=this._transitionablePaint._values[e].value;return k.isDataDriven()||v||g||this._handleOverridablePaintPropertyUpdate(e,T,k)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ae(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,p,g={}){return(!g||g.validate!==!1)&&ko(this,e.call(Ws,{key:r,layerType:this.type,objectKey:a,value:p,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof $r&&gi(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const zl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class An{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ii{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Di(i,e=1){let r=0,a=0;return{members:i.map(p=>{const g=zl[p.type].BYTES_PER_ELEMENT,v=r=ba(r,Math.max(e,g)),T=p.components||1;return a=Math.max(a,g),r+=g*T,{name:p.name,type:p.type,components:T,offset:v}}),size:ba(r,Math.max(a,e)),alignment:e}}function ba(i,e){return Math.ceil(i/e)*e}class Gn extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const p=2*e;return this.int16[p+0]=r,this.int16[p+1]=a,e}}Gn.prototype.bytesPerElement=4,ct("StructArrayLayout2i4",Gn);class f extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,p)}emplace(e,r,a,p,g){const v=4*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=p,this.int16[v+3]=g,e}}f.prototype.bytesPerElement=8,ct("StructArrayLayout4i8",f);class t extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,a,p,g,v)}emplace(e,r,a,p,g,v,T){const k=6*e;return this.int16[k+0]=r,this.int16[k+1]=a,this.int16[k+2]=p,this.int16[k+3]=g,this.int16[k+4]=v,this.int16[k+5]=T,e}}t.prototype.bytesPerElement=12,ct("StructArrayLayout2i4i12",t);class s extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,a,p,g,v)}emplace(e,r,a,p,g,v,T){const k=4*e,z=8*e;return this.int16[k+0]=r,this.int16[k+1]=a,this.uint8[z+4]=p,this.uint8[z+5]=g,this.uint8[z+6]=v,this.uint8[z+7]=T,e}}s.prototype.bytesPerElement=8,ct("StructArrayLayout2i4ub8",s);class u extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const p=2*e;return this.float32[p+0]=r,this.float32[p+1]=a,e}}u.prototype.bytesPerElement=8,ct("StructArrayLayout2f8",u);class m extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g,v,T,k,z,L){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,a,p,g,v,T,k,z,L)}emplace(e,r,a,p,g,v,T,k,z,L,R){const j=10*e;return this.uint16[j+0]=r,this.uint16[j+1]=a,this.uint16[j+2]=p,this.uint16[j+3]=g,this.uint16[j+4]=v,this.uint16[j+5]=T,this.uint16[j+6]=k,this.uint16[j+7]=z,this.uint16[j+8]=L,this.uint16[j+9]=R,e}}m.prototype.bytesPerElement=20,ct("StructArrayLayout10ui20",m);class y extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g,v,T,k,z,L,R,j){const q=this.length;return this.resize(q+1),this.emplace(q,e,r,a,p,g,v,T,k,z,L,R,j)}emplace(e,r,a,p,g,v,T,k,z,L,R,j,q){const Z=12*e;return this.int16[Z+0]=r,this.int16[Z+1]=a,this.int16[Z+2]=p,this.int16[Z+3]=g,this.uint16[Z+4]=v,this.uint16[Z+5]=T,this.uint16[Z+6]=k,this.uint16[Z+7]=z,this.int16[Z+8]=L,this.int16[Z+9]=R,this.int16[Z+10]=j,this.int16[Z+11]=q,e}}y.prototype.bytesPerElement=24,ct("StructArrayLayout4i4ui4i24",y);class w extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a)}emplace(e,r,a,p){const g=3*e;return this.float32[g+0]=r,this.float32[g+1]=a,this.float32[g+2]=p,e}}w.prototype.bytesPerElement=12,ct("StructArrayLayout3f12",w);class S extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}S.prototype.bytesPerElement=4,ct("StructArrayLayout1ul4",S);class C extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g,v,T,k,z){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,p,g,v,T,k,z)}emplace(e,r,a,p,g,v,T,k,z,L){const R=10*e,j=5*e;return this.int16[R+0]=r,this.int16[R+1]=a,this.int16[R+2]=p,this.int16[R+3]=g,this.int16[R+4]=v,this.int16[R+5]=T,this.uint32[j+3]=k,this.uint16[R+8]=z,this.uint16[R+9]=L,e}}C.prototype.bytesPerElement=20,ct("StructArrayLayout6i1ul2ui20",C);class M extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,a,p,g,v)}emplace(e,r,a,p,g,v,T){const k=6*e;return this.int16[k+0]=r,this.int16[k+1]=a,this.int16[k+2]=p,this.int16[k+3]=g,this.int16[k+4]=v,this.int16[k+5]=T,e}}M.prototype.bytesPerElement=12,ct("StructArrayLayout2i2i2i12",M);class B extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,p,g)}emplace(e,r,a,p,g,v){const T=4*e,k=8*e;return this.float32[T+0]=r,this.float32[T+1]=a,this.float32[T+2]=p,this.int16[k+6]=g,this.int16[k+7]=v,e}}B.prototype.bytesPerElement=16,ct("StructArrayLayout2f1f2i16",B);class N extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,p)}emplace(e,r,a,p,g){const v=12*e,T=3*e;return this.uint8[v+0]=r,this.uint8[v+1]=a,this.float32[T+1]=p,this.float32[T+2]=g,e}}N.prototype.bytesPerElement=12,ct("StructArrayLayout2ub2f12",N);class G extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a)}emplace(e,r,a,p){const g=3*e;return this.uint16[g+0]=r,this.uint16[g+1]=a,this.uint16[g+2]=p,e}}G.prototype.bytesPerElement=6,ct("StructArrayLayout3ui6",G);class $ extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g,v,T,k,z,L,R,j,q,Z,re,ie,me){const ke=this.length;return this.resize(ke+1),this.emplace(ke,e,r,a,p,g,v,T,k,z,L,R,j,q,Z,re,ie,me)}emplace(e,r,a,p,g,v,T,k,z,L,R,j,q,Z,re,ie,me,ke){const de=24*e,ve=12*e,Fe=48*e;return this.int16[de+0]=r,this.int16[de+1]=a,this.uint16[de+2]=p,this.uint16[de+3]=g,this.uint32[ve+2]=v,this.uint32[ve+3]=T,this.uint32[ve+4]=k,this.uint16[de+10]=z,this.uint16[de+11]=L,this.uint16[de+12]=R,this.float32[ve+7]=j,this.float32[ve+8]=q,this.uint8[Fe+36]=Z,this.uint8[Fe+37]=re,this.uint8[Fe+38]=ie,this.uint32[ve+10]=me,this.int16[de+22]=ke,e}}$.prototype.bytesPerElement=48,ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$);class J extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,p,g,v,T,k,z,L,R,j,q,Z,re,ie,me,ke,de,ve,Fe,Re,lt,ht,tt,Ye,We,it){const $e=this.length;return this.resize($e+1),this.emplace($e,e,r,a,p,g,v,T,k,z,L,R,j,q,Z,re,ie,me,ke,de,ve,Fe,Re,lt,ht,tt,Ye,We,it)}emplace(e,r,a,p,g,v,T,k,z,L,R,j,q,Z,re,ie,me,ke,de,ve,Fe,Re,lt,ht,tt,Ye,We,it,$e){const je=34*e,vt=17*e;return this.int16[je+0]=r,this.int16[je+1]=a,this.int16[je+2]=p,this.int16[je+3]=g,this.int16[je+4]=v,this.int16[je+5]=T,this.int16[je+6]=k,this.int16[je+7]=z,this.uint16[je+8]=L,this.uint16[je+9]=R,this.uint16[je+10]=j,this.uint16[je+11]=q,this.uint16[je+12]=Z,this.uint16[je+13]=re,this.uint16[je+14]=ie,this.uint16[je+15]=me,this.uint16[je+16]=ke,this.uint16[je+17]=de,this.uint16[je+18]=ve,this.uint16[je+19]=Fe,this.uint16[je+20]=Re,this.uint16[je+21]=lt,this.uint16[je+22]=ht,this.uint32[vt+12]=tt,this.float32[vt+13]=Ye,this.float32[vt+14]=We,this.float32[vt+15]=it,this.float32[vt+16]=$e,e}}J.prototype.bytesPerElement=68,ct("StructArrayLayout8i15ui1ul4f68",J);class Y extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Y.prototype.bytesPerElement=4,ct("StructArrayLayout1f4",Y);class le extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a)}emplace(e,r,a,p){const g=3*e;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=p,e}}le.prototype.bytesPerElement=6,ct("StructArrayLayout3i6",le);class fe extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a)}emplace(e,r,a,p){const g=4*e;return this.uint32[2*e+0]=r,this.uint16[g+2]=a,this.uint16[g+3]=p,e}}fe.prototype.bytesPerElement=8,ct("StructArrayLayout1ul2ui8",fe);class _e extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,e}}_e.prototype.bytesPerElement=4,ct("StructArrayLayout2ui4",_e);class te extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}te.prototype.bytesPerElement=2,ct("StructArrayLayout1ui2",te);class Te extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,p)}emplace(e,r,a,p,g){const v=4*e;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=p,this.float32[v+3]=g,e}}Te.prototype.bytesPerElement=16,ct("StructArrayLayout4f16",Te);class ye extends An{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new bt(this.anchorPointX,this.anchorPointY)}}ye.prototype.size=20;class Pe extends C{get(e){return new ye(this,e)}}ct("CollisionBoxArray",Pe);class De extends An{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}De.prototype.size=48;class Ne extends ${get(e){return new De(this,e)}}ct("PlacedSymbolArray",Ne);class Ae extends An{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ae.prototype.size=68;class ot extends J{get(e){return new Ae(this,e)}}ct("SymbolInstanceArray",ot);class Je extends Y{getoffsetX(e){return this.float32[1*e+0]}}ct("GlyphOffsetArray",Je);class at extends le{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ct("SymbolLineVertexArray",at);class Dt extends An{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Dt.prototype.size=8;class Ot extends fe{get(e){return new Dt(this,e)}}ct("FeatureIndexArray",Ot);class yt extends Gn{}class $t extends Gn{}class ei extends Gn{}class qt extends t{}class Kt extends s{}class ni extends u{}class qi extends m{}class tn extends y{}class qr extends w{}class rn extends S{}class zn extends M{}class Vr extends N{}class vr extends G{}class fn extends _e{}const Io=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fi}=Io;class Ut{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,p){let g=this.segments[this.segments.length-1];return e>Ut.MAX_VERTEX_ARRAY_LENGTH&&ze(`Max vertices per segment is ${Ut.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>Ut.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,p){return new Ut([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:p,vaos:{},sortKey:0}])}}function Qt(i,e){return 256*(i=A(Math.floor(i),0,255))+A(Math.floor(e),0,255)}Ut.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ct("SegmentVector",Ut);const Zi=Di([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xi={exports:{}},Ti={exports:{}};Ti.exports=function(i,e){var r,a,p,g,v,T,k,z;for(a=i.length-(r=3&i.length),p=e,v=3432918353,T=461845907,z=0;z<a;)k=255&i.charCodeAt(z)|(255&i.charCodeAt(++z))<<8|(255&i.charCodeAt(++z))<<16|(255&i.charCodeAt(++z))<<24,++z,p=27492+(65535&(g=5*(65535&(p=(p^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*T+(((k>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(k=0,r){case 3:k^=(255&i.charCodeAt(z+2))<<16;case 2:k^=(255&i.charCodeAt(z+1))<<8;case 1:p^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(z)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*T+(((k>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Ur={exports:{}};Ur.exports=function(i,e){for(var r,a=i.length,p=e^a,g=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(r>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:p^=(255&i.charCodeAt(g+2))<<16;case 2:p^=(255&i.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var qn=Ti.exports,wa=Ur.exports;Xi.exports=qn,Xi.exports.murmur3=qn,Xi.exports.murmur2=wa;class xs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,p){this.ids.push(Ml(e)),this.positions.push(r,a,p)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ml(e);let a=0,p=this.ids.length-1;for(;a<p;){const v=a+p>>1;this.ids[v]>=r?p=v:a=v+1}const g=[];for(;this.ids[a]===r;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(e,r){const a=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Ta(a,p,0,a.length-1),r&&r.push(a.buffer,p.buffer),{ids:a,positions:p}}static deserialize(e){const r=new xs;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Ml(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Xi.exports(String(i))}function Ta(i,e,r,a){for(;r<a;){const p=i[r+a>>1];let g=r-1,v=a+1;for(;;){do g++;while(i[g]<p);do v--;while(i[v]>p);if(g>=v)break;Mn(i,g,v),Mn(e,3*g,3*v),Mn(e,3*g+1,3*v+1),Mn(e,3*g+2,3*v+2)}v-r<a-v?(Ta(i,e,r,v),r=v+1):(Ta(i,e,v+1,a),a=v)}}function Mn(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}ct("FeaturePositionMap",xs);class Zn{constructor(e,r){this.gl=e.gl,this.location=r}}class Xn extends Zn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Co extends Zn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Du extends Zn{constructor(e,r){super(e,r),this.current=W.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Lp=new Float32Array(16);function Pc(i){return[Qt(255*i.r,255*i.g),Qt(255*i.b,255*i.a)]}class ka{constructor(e,r,a){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new Du(e,r):new Xn(e,r)}}class Ao{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,p){const g=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&e.set(g)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new Co(e,r):new Xn(e,r)}}class Hn{constructor(e,r,a,p){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,a,p,g){const v=this.paintVertexArray.length,T=this.expression.evaluate(new wi(0),r,{},p,[],g);this.paintVertexArray.resize(e),this._setPaintValue(v,e,T)}updatePaintArray(e,r,a,p){const g=this.expression.evaluate({zoom:0},a,p);this._setPaintValue(e,r,g)}_setPaintValue(e,r,a){if(this.type==="color"){const p=Pc(a);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dn{constructor(e,r,a,p,g,v){this.expression=e,this.uniformNames=r.map(T=>`u_${T}_t`),this.type=a,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(T=>({name:`a_${T}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(e,r,a,p,g){const v=this.expression.evaluate(new wi(this.zoom),r,{},p,[],g),T=this.expression.evaluate(new wi(this.zoom+1),r,{},p,[],g),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,v,T)}updatePaintArray(e,r,a,p){const g=this.expression.evaluate({zoom:this.zoom},a,p),v=this.expression.evaluate({zoom:this.zoom+1},a,p);this._setPaintValue(e,r,g,v)}_setPaintValue(e,r,a,p){if(this.type==="color"){const g=Pc(a),v=Pc(p);for(let T=e;T<r;T++)this.paintVertexArray.emplace(T,g[0],g[1],v[0],v[1])}else{for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,a,p);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=A(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,r,a){return new Xn(e,r)}}class bs{constructor(e,r,a,p,g,v){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=p,this.layerId=v,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,r,a){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,p,g){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(e,r,a,p){if(!p||!a)return;const{min:g,mid:v,max:T}=a,k=p[g],z=p[v],L=p[T];if(k&&z&&L)for(let R=e;R<r;R++)this.zoomInPaintVertexArray.emplace(R,z.tl[0],z.tl[1],z.br[0],z.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],z.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,z.tl[0],z.tl[1],z.br[0],z.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],z.pixelRatio,L.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Zi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Zi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Lu{constructor(e,r,a){this.binders={},this._buffers=[];const p=[];for(const g in e.paint._values){if(!a(g))continue;const v=e.paint.get(g);if(!(v instanceof $r&&gi(v.property.specification)))continue;const T=Bp(g,e.type),k=v.value,z=v.property.specification.type,L=v.property.useIntegerZoom,R=v.property.specification["property-type"],j=R==="cross-faded"||R==="cross-faded-data-driven";if(k.kind==="constant")this.binders[g]=j?new Ao(k.value,T):new ka(k.value,T,z),p.push(`/u_${g}`);else if(k.kind==="source"||j){const q=Bu(g,z,"source");this.binders[g]=j?new bs(k,z,L,r,q,e.id):new Hn(k,T,z,q),p.push(`/a_${g}`)}else{const q=Bu(g,z,"composite");this.binders[g]=new dn(k,T,z,L,r,q),p.push(`/z_${g}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Hn||r instanceof dn?r.maxValue:0}populatePaintArrays(e,r,a,p,g){for(const v in this.binders){const T=this.binders[v];(T instanceof Hn||T instanceof dn||T instanceof bs)&&T.populatePaintArray(e,r,a,p,g)}}setConstantPatternPositions(e,r){for(const a in this.binders){const p=this.binders[a];p instanceof Ao&&p.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,p,g){let v=!1;for(const T in e){const k=r.getPositions(T);for(const z of k){const L=a.feature(z.index);for(const R in this.binders){const j=this.binders[R];if((j instanceof Hn||j instanceof dn||j instanceof bs)&&j.expression.isStateDependent===!0){const q=p.paint.get(R);j.expression=q.value,j.updatePaintArray(z.start,z.end,L,e[T],g),v=!0}}}}return v}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof ka||a instanceof Ao)&&e.push(...a.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Hn||a instanceof dn)for(let p=0;p<a.paintVertexAttributes.length;p++)e.push(a.paintVertexAttributes[p].name);else if(a instanceof bs)for(let p=0;p<Zi.members.length;p++)e.push(Zi.members[p].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof ka||a instanceof Ao||a instanceof dn)for(const p of a.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof ka||g instanceof Ao||g instanceof dn){for(const v of g.uniformNames)if(r[v]){const T=g.getBinding(e,r[v],v);a.push({name:v,property:p,binding:T})}}}return a}setUniforms(e,r,a,p){for(const{name:g,property:v,binding:T}of r)this.binders[v].setUniform(T,p,a.get(v),g)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof bs){const p=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(a instanceof Hn||a instanceof dn)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof Hn||a instanceof dn||a instanceof bs)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Hn||r instanceof dn||r instanceof bs)&&r.destroy()}}}class $s{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new Lu(p,r,a);this.needsUpload=!1,this._featureMap=new xs,this._bufferOffset=0}populatePaintArrays(e,r,a,p,g,v){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,r,p,g,v);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,p){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,r,g,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Bp(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Bu(i,e,r){const a={color:{source:u,composite:Te},number:{source:Y,composite:u}},p=function(g){return{"line-pattern":{source:qi,composite:qi},"fill-pattern":{source:qi,composite:qi},"fill-extrusion-pattern":{source:qi,composite:qi}}[g]}(i);return p&&p[r]||a[e][r]}ct("ConstantBinder",ka),ct("CrossFadedConstantBinder",Ao),ct("SourceExpressionBinder",Hn),ct("CrossFadedCompositeBinder",bs),ct("CompositeExpressionBinder",dn),ct("ProgramConfiguration",Lu,{omit:["_buffers"]}),ct("ProgramConfigurationSet",$s);var Oi=8192;const Dc=Math.pow(2,14)-1,Ru=-Dc-1;function eo(i){const e=Oi/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const p=r[a];for(let g=0;g<p.length;g++){const v=p[g],T=Math.round(v.x*e),k=Math.round(v.y*e);v.x=A(T,Ru,Dc),v.y=A(k,Ru,Dc),(T<v.x||T>v.x+1||k<v.y||k>v.y+1)&&ze("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function to(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?eo(i):[]}}function Pl(i,e,r,a,p){i.emplaceBack(2*e+(a+1)/2,2*r+(p+1)/2)}class Lc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new $t,this.indexArray=new vr,this.segments=new Ut,this.programConfigurations=new $s(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const p=this.layers[0],g=[];let v=null,T=!1;p.type==="circle"&&(v=p.layout.get("circle-sort-key"),T=!v.isConstant());for(const{feature:k,id:z,index:L,sourceLayerIndex:R}of e){const j=this.layers[0]._featureFilter.needGeometry,q=to(k,j);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),q,a))continue;const Z=T?v.evaluate(q,{},a):void 0,re={id:z,properties:k.properties,type:k.type,sourceLayerIndex:R,index:L,geometry:j?q.geometry:eo(k),patterns:{},sortKey:Z};g.push(re)}T&&g.sort((k,z)=>k.sortKey-z.sortKey);for(const k of g){const{geometry:z,index:L,sourceLayerIndex:R}=k,j=e[L].feature;this.addFeature(k,z,L,a),r.featureIndex.insert(j,z,L,R,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fi),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,p){for(const g of r)for(const v of g){const T=v.x,k=v.y;if(T<0||T>=Oi||k<0||k>=Oi)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=z.vertexLength;Pl(this.layoutVertexArray,T,k,-1,-1),Pl(this.layoutVertexArray,T,k,1,-1),Pl(this.layoutVertexArray,T,k,1,1),Pl(this.layoutVertexArray,T,k,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},p)}}function Fu(i,e){for(let r=0;r<i.length;r++)if(zo(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(zo(i,e[r]))return!0;return!!Bc(i,e)}function Rp(i,e,r){return!!zo(i,e)||!!Rc(e,i,r)}function Ou(i,e){if(i.length===1)return Uu(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let p=0;p<a.length;p++)if(zo(i,a[p]))return!0}for(let r=0;r<i.length;r++)if(Uu(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Bc(i,e[r]))return!0;return!1}function Fp(i,e,r){if(i.length>1){if(Bc(i,e))return!0;for(let a=0;a<e.length;a++)if(Rc(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Rc(i[a],e,r))return!0;return!1}function Bc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],p=i[r+1];for(let g=0;g<e.length-1;g++)if(Op(a,p,e[g],e[g+1]))return!0}return!1}function Op(i,e,r,a){return Oe(i,r,a)!==Oe(e,r,a)&&Oe(i,e,r)!==Oe(i,e,a)}function Rc(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let p=1;p<e.length;p++)if(Vu(i,e[p-1],e[p])<a)return!0;return!1}function Vu(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const p=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function Uu(i,e){let r,a,p,g=!1;for(let v=0;v<i.length;v++){r=i[v];for(let T=0,k=r.length-1;T<r.length;k=T++)a=r[T],p=r[k],a.y>e.y!=p.y>e.y&&e.x<(p.x-a.x)*(e.y-a.y)/(p.y-a.y)+a.x&&(g=!g)}return g}function zo(i,e){let r=!1;for(let a=0,p=i.length-1;a<i.length;p=a++){const g=i[a],v=i[p];g.y>e.y!=v.y>e.y&&e.x<(v.x-g.x)*(e.y-g.y)/(v.y-g.y)+g.x&&(r=!r)}return r}function Vp(i,e,r){const a=r[0],p=r[2];if(i.x<a.x&&e.x<a.x||i.x>p.x&&e.x>p.x||i.y<a.y&&e.y<a.y||i.y>p.y&&e.y>p.y)return!1;const g=Oe(i,e,r[0]);return g!==Oe(i,e,r[1])||g!==Oe(i,e,r[2])||g!==Oe(i,e,r[3])}function Ea(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Dl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ll(i,e,r,a,p){if(!e[0]&&!e[1])return i;const g=bt.convert(e)._mult(p);r==="viewport"&&g._rotate(-a);const v=[];for(let T=0;T<i.length;T++)v.push(i[T].sub(g));return v}ct("CircleBucket",Lc,{omit:["layers"]});const Up=new Yi({"circle-sort-key":new Tt(Le.layout_circle["circle-sort-key"])});var Np={paint:new Yi({"circle-radius":new Tt(Le.paint_circle["circle-radius"]),"circle-color":new Tt(Le.paint_circle["circle-color"]),"circle-blur":new Tt(Le.paint_circle["circle-blur"]),"circle-opacity":new Tt(Le.paint_circle["circle-opacity"]),"circle-translate":new pt(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(Le.paint_circle["circle-stroke-opacity"])}),layout:Up},xr=1e-6,br=typeof Float32Array<"u"?Float32Array:Array;function Nu(){var i=new br(9);return br!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Fc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ju(i,e,r){var a=e[0],p=e[1],g=e[2],v=e[3],T=e[4],k=e[5],z=e[6],L=e[7],R=e[8],j=e[9],q=e[10],Z=e[11],re=e[12],ie=e[13],me=e[14],ke=e[15],de=r[0],ve=r[1],Fe=r[2],Re=r[3];return i[0]=de*a+ve*T+Fe*R+Re*re,i[1]=de*p+ve*k+Fe*j+Re*ie,i[2]=de*g+ve*z+Fe*q+Re*me,i[3]=de*v+ve*L+Fe*Z+Re*ke,i[4]=(de=r[4])*a+(ve=r[5])*T+(Fe=r[6])*R+(Re=r[7])*re,i[5]=de*p+ve*k+Fe*j+Re*ie,i[6]=de*g+ve*z+Fe*q+Re*me,i[7]=de*v+ve*L+Fe*Z+Re*ke,i[8]=(de=r[8])*a+(ve=r[9])*T+(Fe=r[10])*R+(Re=r[11])*re,i[9]=de*p+ve*k+Fe*j+Re*ie,i[10]=de*g+ve*z+Fe*q+Re*me,i[11]=de*v+ve*L+Fe*Z+Re*ke,i[12]=(de=r[12])*a+(ve=r[13])*T+(Fe=r[14])*R+(Re=r[15])*re,i[13]=de*p+ve*k+Fe*j+Re*ie,i[14]=de*g+ve*z+Fe*q+Re*me,i[15]=de*v+ve*L+Fe*Z+Re*ke,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Sa,jp=ju;function Gu(){var i=new br(3);return br!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function qu(i,e,r){var a=new br(3);return a[0]=i,a[1]=e,a[2]=r,a}function Bl(i,e,r){var a=e[0],p=e[1],g=e[2],v=e[3];return i[0]=r[0]*a+r[4]*p+r[8]*g+r[12]*v,i[1]=r[1]*a+r[5]*p+r[9]*g+r[13]*v,i[2]=r[2]*a+r[6]*p+r[10]*g+r[14]*v,i[3]=r[3]*a+r[7]*p+r[11]*g+r[15]*v,i}function Zu(){var i=new br(4);return br!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Xu(i,e){const r=Bl([],[i.x,i.y,0,1],e);return new bt(r[0]/r[3],r[1]/r[3])}Gu(),Sa=new br(4),br!=Float32Array&&(Sa[0]=0,Sa[1]=0,Sa[2]=0,Sa[3]=0),Gu(),qu(1,0,0),qu(0,1,0),Zu(),Zu(),Nu(),function(){var i;i=new br(2),br!=Float32Array&&(i[0]=0,i[1]=0)}();class Hu extends Lc{}ct("HeatmapBucket",Hu,{omit:["layers"]});var Gp={paint:new Yi({"heatmap-radius":new Tt(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new In(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(Le.paint_heatmap["heatmap-opacity"])})};function Oc(i,{width:e,height:r},a,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*r*a}`)}else p=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=p,i}function Wu(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const p=Oc({},{width:e,height:r},a);Vc(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=p.data}function Vc(i,e,r,a,p,g){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||r.x>i.width-p.width||r.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||a.x>e.width-p.width||a.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=i.data,T=e.data;if(v===T)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<p.height;k++){const z=((r.y+k)*i.width+r.x)*g,L=((a.y+k)*e.width+a.x)*g;for(let R=0;R<p.width*g;R++)T[L+R]=v[z+R]}return e}class Ia{constructor(e,r){Oc(this,e,1,r)}resize(e){Wu(this,e,1)}clone(){return new Ia({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,p,g){Vc(e,r,a,p,g,1)}}class Zr{constructor(e,r){Oc(this,e,4,r)}resize(e){Wu(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,p,g){Vc(e,r,a,p,g,4)}}function Ku(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,p=i.image||new Zr({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const g=(v,T,k)=>{e[i.evaluationKey]=k;const z=i.expression.evaluate(e);p.data[v+T+0]=Math.floor(255*z.r/z.a),p.data[v+T+1]=Math.floor(255*z.g/z.a),p.data[v+T+2]=Math.floor(255*z.b/z.a),p.data[v+T+3]=Math.floor(255*z.a)};if(i.clips)for(let v=0,T=0;v<a;++v,T+=4*r)for(let k=0,z=0;k<r;k++,z+=4){const L=k/(r-1),{start:R,end:j}=i.clips[v];g(T,z,R*(1-L)+j*L)}else for(let v=0,T=0;v<r;v++,T+=4)g(0,T,v/(r-1));return p}ct("AlphaImage",Ia),ct("RGBAImage",Zr);var qp={paint:new Yi({"hillshade-illumination-direction":new pt(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(Le.paint_hillshade["hillshade-accent-color"])})};const Zp=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xp}=Zp;var Rl={exports:{}};function Fl(i,e,r){r=r||2;var a,p,g,v,T,k,z,L=e&&e.length,R=L?e[0]*r:i.length,j=Ju(i,0,R,r,!0),q=[];if(!j||j.next===j.prev)return q;if(L&&(j=function(re,ie,me,ke){var de,ve,Fe,Re=[];for(de=0,ve=ie.length;de<ve;de++)(Fe=Ju(re,ie[de]*ke,de<ve-1?ie[de+1]*ke:re.length,ke,!1))===Fe.next&&(Fe.steiner=!0),Re.push(em(Fe));for(Re.sort(Yp),de=0;de<Re.length;de++)me=Qp(Re[de],me);return me}(i,e,j,r)),i.length>80*r){a=g=i[0],p=v=i[1];for(var Z=r;Z<R;Z+=r)(T=i[Z])<a&&(a=T),(k=i[Z+1])<p&&(p=k),T>g&&(g=T),k>v&&(v=k);z=(z=Math.max(g-a,v-p))!==0?32767/z:0}return Ca(j,q,r,a,p,z,0),q}function Ju(i,e,r,a,p){var g,v;if(p===jc(i,e,r,a)>0)for(g=e;g<r;g+=a)v=$u(g,i[g],i[g+1],v);else for(g=r-a;g>=e;g-=a)v=$u(g,i[g],i[g+1],v);return v&&Ol(v,v.next)&&(za(v),v=v.next),v}function io(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!Ol(a,a.next)&&zi(a.prev,a,a.next)!==0)a=a.next;else{if(za(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Ca(i,e,r,a,p,g,v){if(i){!v&&g&&function(L,R,j,q){var Z=L;do Z.z===0&&(Z.z=Uc(Z.x,Z.y,R,j,q)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==L);Z.prevZ.nextZ=null,Z.prevZ=null,function(re){var ie,me,ke,de,ve,Fe,Re,lt,ht=1;do{for(me=re,re=null,ve=null,Fe=0;me;){for(Fe++,ke=me,Re=0,ie=0;ie<ht&&(Re++,ke=ke.nextZ);ie++);for(lt=ht;Re>0||lt>0&&ke;)Re!==0&&(lt===0||!ke||me.z<=ke.z)?(de=me,me=me.nextZ,Re--):(de=ke,ke=ke.nextZ,lt--),ve?ve.nextZ=de:re=de,de.prevZ=ve,ve=de;me=ke}ve.nextZ=null,ht*=2}while(Fe>1)}(Z)}(i,a,p,g);for(var T,k,z=i;i.prev!==i.next;)if(T=i.prev,k=i.next,g?Wp(i,a,p,g):Hp(i))e.push(T.i/r|0),e.push(i.i/r|0),e.push(k.i/r|0),za(i),i=k.next,z=k.next;else if((i=k)===z){v?v===1?Ca(i=Kp(io(i),e,r),e,r,a,p,g,2):v===2&&Jp(i,e,r,a,p,g):Ca(io(i),e,r,a,p,g,1);break}}}function Hp(i){var e=i.prev,r=i,a=i.next;if(zi(e,r,a)>=0)return!1;for(var p=e.x,g=r.x,v=a.x,T=e.y,k=r.y,z=a.y,L=p<g?p<v?p:v:g<v?g:v,R=T<k?T<z?T:z:k<z?k:z,j=p>g?p>v?p:v:g>v?g:v,q=T>k?T>z?T:z:k>z?k:z,Z=a.next;Z!==e;){if(Z.x>=L&&Z.x<=j&&Z.y>=R&&Z.y<=q&&Mo(p,T,g,k,v,z,Z.x,Z.y)&&zi(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function Wp(i,e,r,a){var p=i.prev,g=i,v=i.next;if(zi(p,g,v)>=0)return!1;for(var T=p.x,k=g.x,z=v.x,L=p.y,R=g.y,j=v.y,q=T<k?T<z?T:z:k<z?k:z,Z=L<R?L<j?L:j:R<j?R:j,re=T>k?T>z?T:z:k>z?k:z,ie=L>R?L>j?L:j:R>j?R:j,me=Uc(q,Z,e,r,a),ke=Uc(re,ie,e,r,a),de=i.prevZ,ve=i.nextZ;de&&de.z>=me&&ve&&ve.z<=ke;){if(de.x>=q&&de.x<=re&&de.y>=Z&&de.y<=ie&&de!==p&&de!==v&&Mo(T,L,k,R,z,j,de.x,de.y)&&zi(de.prev,de,de.next)>=0||(de=de.prevZ,ve.x>=q&&ve.x<=re&&ve.y>=Z&&ve.y<=ie&&ve!==p&&ve!==v&&Mo(T,L,k,R,z,j,ve.x,ve.y)&&zi(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;de&&de.z>=me;){if(de.x>=q&&de.x<=re&&de.y>=Z&&de.y<=ie&&de!==p&&de!==v&&Mo(T,L,k,R,z,j,de.x,de.y)&&zi(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;ve&&ve.z<=ke;){if(ve.x>=q&&ve.x<=re&&ve.y>=Z&&ve.y<=ie&&ve!==p&&ve!==v&&Mo(T,L,k,R,z,j,ve.x,ve.y)&&zi(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function Kp(i,e,r){var a=i;do{var p=a.prev,g=a.next.next;!Ol(p,g)&&Yu(p,a,a.next,g)&&Aa(p,g)&&Aa(g,p)&&(e.push(p.i/r|0),e.push(a.i/r|0),e.push(g.i/r|0),za(a),za(a.next),a=i=g),a=a.next}while(a!==i);return io(a)}function Jp(i,e,r,a,p,g){var v=i;do{for(var T=v.next.next;T!==v.prev;){if(v.i!==T.i&&tm(v,T)){var k=Qu(v,T);return v=io(v,v.next),k=io(k,k.next),Ca(v,e,r,a,p,g,0),void Ca(k,e,r,a,p,g,0)}T=T.next}v=v.next}while(v!==i)}function Yp(i,e){return i.x-e.x}function Qp(i,e){var r=function(p,g){var v,T=g,k=p.x,z=p.y,L=-1/0;do{if(z<=T.y&&z>=T.next.y&&T.next.y!==T.y){var R=T.x+(z-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(R<=k&&R>L&&(L=R,v=T.x<T.next.x?T:T.next,R===k))return v}T=T.next}while(T!==g);if(!v)return null;var j,q=v,Z=v.x,re=v.y,ie=1/0;T=v;do k>=T.x&&T.x>=Z&&k!==T.x&&Mo(z<re?k:L,z,Z,re,z<re?L:k,z,T.x,T.y)&&(j=Math.abs(z-T.y)/(k-T.x),Aa(T,p)&&(j<ie||j===ie&&(T.x>v.x||T.x===v.x&&$p(v,T)))&&(v=T,ie=j)),T=T.next;while(T!==q);return v}(i,e);if(!r)return e;var a=Qu(r,i);return io(a,a.next),io(r,r.next)}function $p(i,e){return zi(i.prev,i,e.prev)<0&&zi(e.next,i,i.next)<0}function Uc(i,e,r,a,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function em(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Mo(i,e,r,a,p,g,v,T){return(p-v)*(e-T)>=(i-v)*(g-T)&&(i-v)*(a-T)>=(r-v)*(e-T)&&(r-v)*(g-T)>=(p-v)*(a-T)}function tm(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==a.i&&p.next.i!==a.i&&Yu(p,p.next,r,a))return!0;p=p.next}while(p!==r);return!1}(i,e)&&(Aa(i,e)&&Aa(e,i)&&function(r,a){var p=r,g=!1,v=(r.x+a.x)/2,T=(r.y+a.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&v<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next;while(p!==r);return g}(i,e)&&(zi(i.prev,i,e.prev)||zi(i,e.prev,e))||Ol(i,e)&&zi(i.prev,i,i.next)>0&&zi(e.prev,e,e.next)>0)}function zi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Ol(i,e){return i.x===e.x&&i.y===e.y}function Yu(i,e,r,a){var p=Ul(zi(i,e,r)),g=Ul(zi(i,e,a)),v=Ul(zi(r,a,i)),T=Ul(zi(r,a,e));return p!==g&&v!==T||!(p!==0||!Vl(i,r,e))||!(g!==0||!Vl(i,a,e))||!(v!==0||!Vl(r,i,a))||!(T!==0||!Vl(r,e,a))}function Vl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Ul(i){return i>0?1:i<0?-1:0}function Aa(i,e){return zi(i.prev,i,i.next)<0?zi(i,e,i.next)>=0&&zi(i,i.prev,e)>=0:zi(i,e,i.prev)<0||zi(i,i.next,e)<0}function Qu(i,e){var r=new Nc(i.i,i.x,i.y),a=new Nc(e.i,e.x,e.y),p=i.next,g=e.prev;return i.next=e,e.prev=i,r.next=p,p.prev=r,a.next=r,r.prev=a,g.next=a,a.prev=g,a}function $u(i,e,r,a){var p=new Nc(i,e,r);return a?(p.next=a.next,p.prev=a,a.next.prev=p,a.next=p):(p.prev=p,p.next=p),p}function za(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Nc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jc(i,e,r,a){for(var p=0,g=e,v=r-a;g<r;g+=a)p+=(i[v]-i[g])*(i[g+1]+i[v+1]),v=g;return p}function im(i,e,r,a,p){eh(i,e,r||0,a||i.length-1,p||rm)}function eh(i,e,r,a,p){for(;a>r;){if(a-r>600){var g=a-r+1,v=e-r+1,T=Math.log(g),k=.5*Math.exp(2*T/3),z=.5*Math.sqrt(T*k*(g-k)/g)*(v-g/2<0?-1:1);eh(i,e,Math.max(r,Math.floor(e-v*k/g+z)),Math.min(a,Math.floor(e+(g-v)*k/g+z)),p)}var L=i[e],R=r,j=a;for(Ma(i,r,e),p(i[a],L)>0&&Ma(i,r,a);R<j;){for(Ma(i,R,j),R++,j--;p(i[R],L)<0;)R++;for(;p(i[j],L)>0;)j--}p(i[r],L)===0?Ma(i,r,j):Ma(i,++j,a),j<=e&&(r=j+1),e<=j&&(a=j-1)}}function Ma(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function rm(i,e){return i<e?-1:i>e?1:0}function Gc(i,e){const r=i.length;if(r<=1)return[i];const a=[];let p,g;for(let v=0;v<r;v++){const T=Me(i[v]);T!==0&&(i[v].area=Math.abs(T),g===void 0&&(g=T<0),g===T<0?(p&&a.push(p),p=[i[v]]):p.push(i[v]))}if(p&&a.push(p),e>1)for(let v=0;v<a.length;v++)a[v].length<=e||(im(a[v],e,1,a[v].length-1,nm),a[v]=a[v].slice(0,e));return a}function nm(i,e){return e.area-i.area}function qc(i,e,r){const a=r.patternDependencies;let p=!1;for(const g of e){const v=g.paint.get(`${i}-pattern`);v.isConstant()||(p=!0);const T=v.constantOr(null);T&&(p=!0,a[T.to]=!0,a[T.from]=!0)}return p}function Zc(i,e,r,a,p){const g=p.patternDependencies;for(const v of e){const T=v.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let k=T.evaluate({zoom:a-1},r,{},p.availableImages),z=T.evaluate({zoom:a},r,{},p.availableImages),L=T.evaluate({zoom:a+1},r,{},p.availableImages);k=k&&k.name?k.name:k,z=z&&z.name?z.name:z,L=L&&L.name?L.name:L,g[k]=!0,g[z]=!0,g[L]=!0,r.patterns[v.id]={min:k,mid:z,max:L}}}return r}Rl.exports=Fl,Rl.exports.default=Fl,Fl.deviation=function(i,e,r,a){var p=e&&e.length,g=Math.abs(jc(i,0,p?e[0]*r:i.length,r));if(p)for(var v=0,T=e.length;v<T;v++)g-=Math.abs(jc(i,e[v]*r,v<T-1?e[v+1]*r:i.length,r));var k=0;for(v=0;v<a.length;v+=3){var z=a[v]*r,L=a[v+1]*r,R=a[v+2]*r;k+=Math.abs((i[z]-i[R])*(i[L+1]-i[z+1])-(i[z]-i[L])*(i[R+1]-i[z+1]))}return g===0&&k===0?0:Math.abs((k-g)/g)},Fl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,p=0;p<i.length;p++){for(var g=0;g<i[p].length;g++)for(var v=0;v<e;v++)r.vertices.push(i[p][g][v]);p>0&&r.holes.push(a+=i[p-1].length)}return r};class Xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ei,this.indexArray=new vr,this.indexArray2=new fn,this.programConfigurations=new $s(e.layers,e.zoom),this.segments=new Ut,this.segments2=new Ut,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=qc("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),g=!p.isConstant(),v=[];for(const{feature:T,id:k,index:z,sourceLayerIndex:L}of e){const R=this.layers[0]._featureFilter.needGeometry,j=to(T,R);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),j,a))continue;const q=g?p.evaluate(j,{},a,r.availableImages):void 0,Z={id:k,properties:T.properties,type:T.type,sourceLayerIndex:L,index:z,geometry:R?j.geometry:eo(T),patterns:{},sortKey:q};v.push(Z)}g&&v.sort((T,k)=>T.sortKey-k.sortKey);for(const T of v){const{geometry:k,index:z,sourceLayerIndex:L}=T;if(this.hasPattern){const R=Zc("fill",this.layers,T,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(T,k,z,a,{});r.featureIndex.insert(e[z].feature,k,z,L,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,p,g){for(const v of Gc(r,500)){let T=0;for(const q of v)T+=q.length;const k=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),z=k.vertexLength,L=[],R=[];for(const q of v){if(q.length===0)continue;q!==v[0]&&R.push(L.length/2);const Z=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),re=Z.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(re+q.length-1,re),L.push(q[0].x),L.push(q[0].y);for(let ie=1;ie<q.length;ie++)this.layoutVertexArray.emplaceBack(q[ie].x,q[ie].y),this.indexArray2.emplaceBack(re+ie-1,re+ie),L.push(q[ie].x),L.push(q[ie].y);Z.vertexLength+=q.length,Z.primitiveLength+=q.length}const j=Rl.exports(L,R);for(let q=0;q<j.length;q+=3)this.indexArray.emplaceBack(z+j[q],z+j[q+1],z+j[q+2]);k.vertexLength+=T,k.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,p)}}ct("FillBucket",Xc,{omit:["layers","patternFeatures"]});const sm=new Yi({"fill-sort-key":new Tt(Le.layout_fill["fill-sort-key"])});var om={paint:new Yi({"fill-antialias":new pt(Le.paint_fill["fill-antialias"]),"fill-opacity":new Tt(Le.paint_fill["fill-opacity"]),"fill-color":new Tt(Le.paint_fill["fill-color"]),"fill-outline-color":new Tt(Le.paint_fill["fill-outline-color"]),"fill-translate":new pt(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new vs(Le.paint_fill["fill-pattern"])}),layout:sm};const am=Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),lm=Di([{name:"a_centroid",components:2,type:"Int16"}],4),{members:cm}=am;var ws={},um=bt,th=Po;function Po(i,e,r,a,p){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=p,i.readFields(hm,this,e)}function hm(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,p){for(var g=a.readVarint()+a.pos;a.pos<g;){var v=p._keys[a.readVarint()],T=p._values[a.readVarint()];p.properties[v]=T}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function fm(i){for(var e,r,a=0,p=0,g=i.length,v=g-1;p<g;v=p++)a+=((r=i[v]).x-(e=i[p]).x)*(e.y+r.y);return a}Po.types=["Unknown","Point","LineString","Polygon"],Po.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,p=0,g=0,v=0,T=[];i.pos<r;){if(p<=0){var k=i.readVarint();a=7&k,p=k>>3}if(p--,a===1||a===2)g+=i.readSVarint(),v+=i.readSVarint(),a===1&&(e&&T.push(e),e=[]),e.push(new um(g,v));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&T.push(e),T},Po.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,p=0,g=0,v=1/0,T=-1/0,k=1/0,z=-1/0;i.pos<e;){if(a<=0){var L=i.readVarint();r=7&L,a=L>>3}if(a--,r===1||r===2)(p+=i.readSVarint())<v&&(v=p),p>T&&(T=p),(g+=i.readSVarint())<k&&(k=g),g>z&&(z=g);else if(r!==7)throw new Error("unknown command "+r)}return[v,k,T,z]},Po.prototype.toGeoJSON=function(i,e,r){var a,p,g=this.extent*Math.pow(2,r),v=this.extent*i,T=this.extent*e,k=this.loadGeometry(),z=Po.types[this.type];function L(q){for(var Z=0;Z<q.length;Z++){var re=q[Z];q[Z]=[360*(re.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+T)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(a=0;a<k.length;a++)R[a]=k[a][0];L(k=R);break;case 2:for(a=0;a<k.length;a++)L(k[a]);break;case 3:for(k=function(q){var Z=q.length;if(Z<=1)return[q];for(var re,ie,me=[],ke=0;ke<Z;ke++){var de=fm(q[ke]);de!==0&&(ie===void 0&&(ie=de<0),ie===de<0?(re&&me.push(re),re=[q[ke]]):re.push(q[ke]))}return re&&me.push(re),me}(k),a=0;a<k.length;a++)for(p=0;p<k[a].length;p++)L(k[a][p])}k.length===1?k=k[0]:z="Multi"+z;var j={type:"Feature",geometry:{type:z,coordinates:k},properties:this.properties};return"id"in this&&(j.id=this.id),j};var dm=th,ih=rh;function rh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(pm,this,e),this.length=this._features.length}function pm(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var p=null,g=a.readVarint()+a.pos;a.pos<g;){var v=a.readVarint()>>3;p=v===1?a.readString():v===2?a.readFloat():v===3?a.readDouble():v===4?a.readVarint64():v===5?a.readVarint():v===6?a.readSVarint():v===7?a.readBoolean():null}return p}(r))}rh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new dm(this._pbf,e,this.extent,this._keys,this._values)};var mm=ih;function gm(i,e,r){if(i===3){var a=new mm(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}ws.VectorTile=function(i,e){this.layers=i.readFields(gm,{},e)},ws.VectorTileFeature=th,ws.VectorTileLayer=ih;const _m=ws.VectorTileFeature.types,Hc=Math.pow(2,13);function Pa(i,e,r,a,p,g,v,T){i.emplaceBack(e,r,2*Math.floor(a*Hc)+v,p*Hc*2,g*Hc*2,Math.round(T))}class Wc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new qt,this.centroidVertexArray=new yt,this.indexArray=new vr,this.programConfigurations=new $s(e.layers,e.zoom),this.segments=new Ut,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=qc("fill-extrusion",this.layers,r);for(const{feature:p,id:g,index:v,sourceLayerIndex:T}of e){const k=this.layers[0]._featureFilter.needGeometry,z=to(p,k);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),z,a))continue;const L={id:g,sourceLayerIndex:T,index:v,geometry:k?z.geometry:eo(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Zc("fill-extrusion",this.layers,L,this.zoom,r)):this.addFeature(L,L.geometry,v,a,{}),r.featureIndex.insert(p,L.geometry,v,T,this.index,!0)}}addFeatures(e,r,a){for(const p of this.features){const{geometry:g}=p;this.addFeature(p,g,p.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cm),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,lm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,p,g){const v={x:0,y:0,vertexCount:0};for(const T of Gc(r,500)){let k=0;for(const Z of T)k+=Z.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Z of T){if(Z.length===0||vm(Z))continue;let re=0;for(let ie=0;ie<Z.length;ie++){const me=Z[ie];if(ie>=1){const ke=Z[ie-1];if(!ym(me,ke)){z.vertexLength+4>Ut.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const de=me.sub(ke)._perp()._unit(),ve=ke.dist(me);re+ve>32768&&(re=0),Pa(this.layoutVertexArray,me.x,me.y,de.x,de.y,0,0,re),Pa(this.layoutVertexArray,me.x,me.y,de.x,de.y,0,1,re),v.x+=2*me.x,v.y+=2*me.y,v.vertexCount+=2,re+=ve,Pa(this.layoutVertexArray,ke.x,ke.y,de.x,de.y,0,0,re),Pa(this.layoutVertexArray,ke.x,ke.y,de.x,de.y,0,1,re),v.x+=2*ke.x,v.y+=2*ke.y,v.vertexCount+=2;const Fe=z.vertexLength;this.indexArray.emplaceBack(Fe,Fe+2,Fe+1),this.indexArray.emplaceBack(Fe+1,Fe+2,Fe+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+k>Ut.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),_m[e.type]!=="Polygon")continue;const L=[],R=[],j=z.vertexLength;for(const Z of T)if(Z.length!==0){Z!==T[0]&&R.push(L.length/2);for(let re=0;re<Z.length;re++){const ie=Z[re];Pa(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),v.x+=ie.x,v.y+=ie.y,v.vertexCount+=1,L.push(ie.x),L.push(ie.y)}}const q=Rl.exports(L,R);for(let Z=0;Z<q.length;Z+=3)this.indexArray.emplaceBack(j+q[Z],j+q[Z+2],j+q[Z+1]);z.primitiveLength+=q.length/3,z.vertexLength+=k}for(let T=0;T<v.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(v.x/v.vertexCount),Math.floor(v.y/v.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,p)}}function ym(i,e){return i.x===e.x&&(i.x<0||i.x>Oi)||i.y===e.y&&(i.y<0||i.y>Oi)}function vm(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Oi)||i.every(e=>e.y<0)||i.every(e=>e.y>Oi)}ct("FillExtrusionBucket",Wc,{omit:["layers","features"]});var xm={paint:new Yi({"fill-extrusion-opacity":new pt(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vs(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Da(i,e){return i.x*e.x+i.y*e.y}function nh(i,e){if(i.length===1){let r=0;const a=e[r++];let p;for(;!p||a.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){const g=e[r],v=i[0],T=p.sub(a),k=g.sub(a),z=v.sub(a),L=Da(T,T),R=Da(T,k),j=Da(k,k),q=Da(z,T),Z=Da(z,k),re=L*j-R*R,ie=(j*q-R*Z)/re,me=(L*Z-R*q)/re,ke=a.z*(1-ie-me)+p.z*ie+g.z*me;if(isFinite(ke))return ke}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const bm=Di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:wm}=bm,Tm=Di([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:km}=Tm,Em=ws.VectorTileFeature.types,Sm=Math.cos(Math.PI/180*37.5),sh=Math.pow(2,14)/.5;class Kc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Kt,this.layoutVertexArray2=new ni,this.indexArray=new vr,this.programConfigurations=new $s(e.layers,e.zoom),this.segments=new Ut,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=qc("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),g=!p.isConstant(),v=[];for(const{feature:T,id:k,index:z,sourceLayerIndex:L}of e){const R=this.layers[0]._featureFilter.needGeometry,j=to(T,R);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),j,a))continue;const q=g?p.evaluate(j,{},a):void 0,Z={id:k,properties:T.properties,type:T.type,sourceLayerIndex:L,index:z,geometry:R?j.geometry:eo(T),patterns:{},sortKey:q};v.push(Z)}g&&v.sort((T,k)=>T.sortKey-k.sortKey);for(const T of v){const{geometry:k,index:z,sourceLayerIndex:L}=T;if(this.hasPattern){const R=Zc("line",this.layers,T,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(T,k,z,a,{});r.featureIndex.insert(e[z].feature,k,z,L,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,km)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,p,g){const v=this.layers[0].layout,T=v.get("line-join").evaluate(e,{}),k=v.get("line-cap"),z=v.get("line-miter-limit"),L=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of r)this.addLine(R,e,T,k,z,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,p)}addLine(e,r,a,p,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<e.length-1;me++)this.totalDistance+=e[me].dist(e[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Em[r.type]==="Polygon";let k=e.length;for(;k>=2&&e[k-1].equals(e[k-2]);)k--;let z=0;for(;z<k-1&&e[z].equals(e[z+1]);)z++;if(k<(T?3:2))return;a==="bevel"&&(g=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,R=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let j,q,Z,re,ie;this.e1=this.e2=-1,T&&(j=e[k-2],ie=e[z].sub(j)._unit()._perp());for(let me=z;me<k;me++){if(Z=me===k-1?T?e[z+1]:void 0:e[me+1],Z&&e[me].equals(Z))continue;ie&&(re=ie),j&&(q=j),j=e[me],ie=Z?Z.sub(j)._unit()._perp():re,re=re||ie;let ke=re.add(ie);ke.x===0&&ke.y===0||ke._unit();const de=re.x*ie.x+re.y*ie.y,ve=ke.x*ie.x+ke.y*ie.y,Fe=ve!==0?1/ve:1/0,Re=2*Math.sqrt(2-2*ve),lt=ve<Sm&&q&&Z,ht=re.x*ie.y-re.y*ie.x>0;if(lt&&me>z){const We=j.dist(q);if(We>2*L){const it=j.sub(j.sub(q)._mult(L/We)._round());this.updateDistance(q,it),this.addCurrentVertex(it,re,0,0,R),q=it}}const tt=q&&Z;let Ye=tt?a:T?"butt":p;if(tt&&Ye==="round"&&(Fe<v?Ye="miter":Fe<=2&&(Ye="fakeround")),Ye==="miter"&&Fe>g&&(Ye="bevel"),Ye==="bevel"&&(Fe>2&&(Ye="flipbevel"),Fe<g&&(Ye="miter")),q&&this.updateDistance(q,j),Ye==="miter")ke._mult(Fe),this.addCurrentVertex(j,ke,0,0,R);else if(Ye==="flipbevel"){if(Fe>100)ke=ie.mult(-1);else{const We=Fe*re.add(ie).mag()/re.sub(ie).mag();ke._perp()._mult(We*(ht?-1:1))}this.addCurrentVertex(j,ke,0,0,R),this.addCurrentVertex(j,ke.mult(-1),0,0,R)}else if(Ye==="bevel"||Ye==="fakeround"){const We=-Math.sqrt(Fe*Fe-1),it=ht?We:0,$e=ht?0:We;if(q&&this.addCurrentVertex(j,re,it,$e,R),Ye==="fakeround"){const je=Math.round(180*Re/Math.PI/20);for(let vt=1;vt<je;vt++){let mt=vt/je;if(mt!==.5){const _i=mt-.5;mt+=mt*_i*(mt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*_i*_i+(.848013+de*(.215638*de-1.06021)))}const Vt=ie.sub(re)._mult(mt)._add(re)._unit()._mult(ht?-1:1);this.addHalfVertex(j,Vt.x,Vt.y,!1,ht,0,R)}}Z&&this.addCurrentVertex(j,ie,-it,-$e,R)}else if(Ye==="butt")this.addCurrentVertex(j,ke,0,0,R);else if(Ye==="square"){const We=q?1:-1;this.addCurrentVertex(j,ke,We,We,R)}else Ye==="round"&&(q&&(this.addCurrentVertex(j,re,0,0,R),this.addCurrentVertex(j,re,1,1,R,!0)),Z&&(this.addCurrentVertex(j,ie,-1,-1,R,!0),this.addCurrentVertex(j,ie,0,0,R)));if(lt&&me<k-1){const We=j.dist(Z);if(We>2*L){const it=j.add(Z.sub(j)._mult(L/We)._round());this.updateDistance(j,it),this.addCurrentVertex(it,ie,0,0,R),j=it}}}}addCurrentVertex(e,r,a,p,g,v=!1){const T=r.y*p-r.x,k=-r.y-r.x*p;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,v,!1,a,g),this.addHalfVertex(e,T,k,v,!0,-p,g),this.distance>sh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,a,p,g,v))}addHalfVertex({x:e,y:r},a,p,g,v,T,k){const z=.5*(this.lineClips?this.scaledDistance*(sh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(r<<1)+(v?1:0),Math.round(63*a)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),k.primitiveLength++),v?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}ct("LineBucket",Kc,{omit:["layers","patternFeatures"]});const Im=new Yi({"line-cap":new pt(Le.layout_line["line-cap"]),"line-join":new Tt(Le.layout_line["line-join"]),"line-miter-limit":new pt(Le.layout_line["line-miter-limit"]),"line-round-limit":new pt(Le.layout_line["line-round-limit"]),"line-sort-key":new Tt(Le.layout_line["line-sort-key"])});var oh={paint:new Yi({"line-opacity":new Tt(Le.paint_line["line-opacity"]),"line-color":new Tt(Le.paint_line["line-color"]),"line-translate":new pt(Le.paint_line["line-translate"]),"line-translate-anchor":new pt(Le.paint_line["line-translate-anchor"]),"line-width":new Tt(Le.paint_line["line-width"]),"line-gap-width":new Tt(Le.paint_line["line-gap-width"]),"line-offset":new Tt(Le.paint_line["line-offset"]),"line-blur":new Tt(Le.paint_line["line-blur"]),"line-dasharray":new xa(Le.paint_line["line-dasharray"]),"line-pattern":new vs(Le.paint_line["line-pattern"]),"line-gradient":new In(Le.paint_line["line-gradient"])}),layout:Im};const ah=new class extends Tt{possiblyEvaluate(i,e){return e=new wi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,a){return e=U({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,a)}}(oh.paint.properties["line-width"].specification);function lh(i,e){return e>0?e+2*i:i}ah.useIntegerZoom=!0;const Cm=Di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Am=Di([{name:"a_projected_pos",components:3,type:"Float32"}],4);Di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zm=Di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Di([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ch=Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Mm=Di([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pm(i,e,r){return i.sections.forEach(a=>{a.text=function(p,g,v){const T=g.layout.get("text-transform").evaluate(v,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),Or.applyArabicShaping&&(p=Or.applyArabicShaping(p)),p}(a.text,e,r)}),i}Di([{name:"triangle",components:3,type:"Uint16"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Di([{type:"Float32",name:"offsetX"}]),Di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const La={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Qi=24,Jc=li,uh=function(i,e,r,a,p){var g,v,T=8*p-a-1,k=(1<<T)-1,z=k>>1,L=-7,R=r?p-1:0,j=r?-1:1,q=i[e+R];for(R+=j,g=q&(1<<-L)-1,q>>=-L,L+=T;L>0;g=256*g+i[e+R],R+=j,L-=8);for(v=g&(1<<-L)-1,g>>=-L,L+=a;L>0;v=256*v+i[e+R],R+=j,L-=8);if(g===0)g=1-z;else{if(g===k)return v?NaN:1/0*(q?-1:1);v+=Math.pow(2,a),g-=z}return(q?-1:1)*v*Math.pow(2,g-a)},hh=function(i,e,r,a,p,g){var v,T,k,z=8*g-p-1,L=(1<<z)-1,R=L>>1,j=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=a?0:g-1,Z=a?1:-1,re=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,v=L):(v=Math.floor(Math.log(e)/Math.LN2),e*(k=Math.pow(2,-v))<1&&(v--,k*=2),(e+=v+R>=1?j/k:j*Math.pow(2,1-R))*k>=2&&(v++,k/=2),v+R>=L?(T=0,v=L):v+R>=1?(T=(e*k-1)*Math.pow(2,p),v+=R):(T=e*Math.pow(2,R-1)*Math.pow(2,p),v=0));p>=8;i[r+q]=255&T,q+=Z,T/=256,p-=8);for(v=v<<p|T,z+=p;z>0;i[r+q]=255&v,q+=Z,v/=256,z-=8);i[r+q-Z]|=128*re};function li(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}li.Varint=0,li.Fixed64=1,li.Bytes=2,li.Fixed32=5;var Ts,Yc=4294967296,fh=1/Yc,dh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Wn(i){return i.type===li.Bytes?i.readVarint()+i.pos:i.pos+1}function Do(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function ph(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var p=r.pos-1;p>=i;p--)r.buf[p+a]=r.buf[p]}function Dm(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Lm(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Bm(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Rm(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Fm(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Om(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Vm(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Um(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Nm(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Nl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Lo(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function mh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function jm(i,e,r){i===1&&r.readMessage(Gm,e)}function Gm(i,e,r){if(i===3){const{id:a,bitmap:p,width:g,height:v,left:T,top:k,advance:z}=r.readMessage(qm,{});e.push({id:a,bitmap:new Ia({width:g+6,height:v+6},p),metrics:{width:g,height:v,left:T,top:k,advance:z}})}}function qm(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function gh(i){let e=0,r=0;for(const v of i)e+=v.w*v.h,r=Math.max(r,v.w);i.sort((v,T)=>T.h-v.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let p=0,g=0;for(const v of i)for(let T=a.length-1;T>=0;T--){const k=a[T];if(!(v.w>k.w||v.h>k.h)){if(v.x=k.x,v.y=k.y,g=Math.max(g,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===k.w&&v.h===k.h){const z=a.pop();T<a.length&&(a[T]=z)}else v.h===k.h?(k.x+=v.w,k.w-=v.w):v.w===k.w?(k.y+=v.h,k.h-=v.h):(a.push({x:k.x+v.w,y:k.y,w:k.w-v.w,h:v.h}),k.y+=v.h,k.h-=v.h);break}}return{w:p,h:g,fill:e/(p*g)||0}}li.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),p=a>>3,g=this.pos;this.type=7&a,i(p,e,this),this.pos===g&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Nl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=mh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Nl(this.buf,this.pos)+Nl(this.buf,this.pos+4)*Yc;return this.pos+=8,i},readSFixed64:function(){var i=Nl(this.buf,this.pos)+mh(this.buf,this.pos+4)*Yc;return this.pos+=8,i},readFloat:function(){var i=uh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=uh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(p,g,v){var T,k,z=v.buf;if(T=(112&(k=z[v.pos++]))>>4,k<128||(T|=(127&(k=z[v.pos++]))<<3,k<128)||(T|=(127&(k=z[v.pos++]))<<10,k<128)||(T|=(127&(k=z[v.pos++]))<<17,k<128)||(T|=(127&(k=z[v.pos++]))<<24,k<128)||(T|=(1&(k=z[v.pos++]))<<31,k<128))return Do(p,T,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&dh?function(r,a,p){return dh.decode(r.subarray(a,p))}(this.buf,e,i):function(r,a,p){for(var g="",v=a;v<p;){var T,k,z,L=r[v],R=null,j=L>239?4:L>223?3:L>191?2:1;if(v+j>p)break;j===1?L<128&&(R=L):j===2?(192&(T=r[v+1]))==128&&(R=(31&L)<<6|63&T)<=127&&(R=null):j===3?(k=r[v+2],(192&(T=r[v+1]))==128&&(192&k)==128&&((R=(15&L)<<12|(63&T)<<6|63&k)<=2047||R>=55296&&R<=57343)&&(R=null)):j===4&&(k=r[v+2],z=r[v+3],(192&(T=r[v+1]))==128&&(192&k)==128&&(192&z)==128&&((R=(15&L)<<18|(63&T)<<12|(63&k)<<6|63&z)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,j=1):R>65535&&(R-=65536,g+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),g+=String.fromCharCode(R),v+=j}return g}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==li.Bytes)return i.push(this.readVarint(e));var r=Wn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==li.Bytes)return i.push(this.readSVarint());var e=Wn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==li.Bytes)return i.push(this.readBoolean());var e=Wn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==li.Bytes)return i.push(this.readFloat());var e=Wn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==li.Bytes)return i.push(this.readDouble());var e=Wn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==li.Bytes)return i.push(this.readFixed32());var e=Wn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==li.Bytes)return i.push(this.readSFixed32());var e=Wn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==li.Bytes)return i.push(this.readFixed64());var e=Wn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==li.Bytes)return i.push(this.readSFixed64());var e=Wn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===li.Varint)for(;this.buf[this.pos++]>127;);else if(e===li.Bytes)this.pos=this.readVarint()+this.pos;else if(e===li.Fixed32)this.pos+=4;else{if(e!==li.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Lo(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Lo(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Lo(this.buf,-1&i,this.pos),Lo(this.buf,Math.floor(i*fh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Lo(this.buf,-1&i,this.pos),Lo(this.buf,Math.floor(i*fh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,p;if(e>=0?(a=e%4294967296|0,p=e/4294967296|0):(p=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,p=p+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,v,T){T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,T.buf[T.pos]=127&(g>>>=7)}(a,0,r),function(g,v){var T=(7&g)<<4;v.buf[v.pos++]|=T|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(p,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,p,g){for(var v,T,k=0;k<p.length;k++){if((v=p.charCodeAt(k))>55295&&v<57344){if(!T){v>56319||k+1===p.length?(a[g++]=239,a[g++]=191,a[g++]=189):T=v;continue}if(v<56320){a[g++]=239,a[g++]=191,a[g++]=189,T=v;continue}v=T-55296<<10|v-56320|65536,T=null}else T&&(a[g++]=239,a[g++]=191,a[g++]=189,T=null);v<128?a[g++]=v:(v<2048?a[g++]=v>>6|192:(v<65536?a[g++]=v>>12|224:(a[g++]=v>>18|240,a[g++]=v>>12&63|128),a[g++]=v>>6&63|128),a[g++]=63&v|128)}return g}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&ph(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),hh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),hh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&ph(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,li.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Dm,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Lm,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Fm,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Bm,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Rm,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Om,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Vm,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Um,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Nm,e)},writeBytesField:function(i,e){this.writeTag(i,li.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,li.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,li.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,li.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,li.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,li.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,li.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,li.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,li.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,li.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};class Qc{constructor(e,{pixelRatio:r,version:a,stretchX:p,stretchY:g,content:v}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=g,this.content=v,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class _h{constructor(e,r){const a={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,a,g),this.addImages(r,p,g);const{w:v,h:T}=gh(g),k=new Zr({width:v||1,height:T||1});for(const z in e){const L=e[z],R=a[z].paddedRect;Zr.copy(L.data,k,{x:0,y:0},{x:R.x+1,y:R.y+1},L.data)}for(const z in r){const L=r[z],R=p[z].paddedRect,j=R.x+1,q=R.y+1,Z=L.data.width,re=L.data.height;Zr.copy(L.data,k,{x:0,y:0},{x:j,y:q},L.data),Zr.copy(L.data,k,{x:0,y:re-1},{x:j,y:q-1},{width:Z,height:1}),Zr.copy(L.data,k,{x:0,y:0},{x:j,y:q+re},{width:Z,height:1}),Zr.copy(L.data,k,{x:Z-1,y:0},{x:j-1,y:q},{width:1,height:re}),Zr.copy(L.data,k,{x:0,y:0},{x:j+Z,y:q},{width:1,height:re})}this.image=k,this.iconPositions=a,this.patternPositions=p}addImages(e,r,a){for(const p in e){const g=e[p],v={x:0,y:0,w:g.data.width+2,h:g.data.height+2};a.push(v),r[p]=new Qc(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[p,g]=e.tl;a.update(r.data,void 0,{x:p,y:g})}}ct("ImagePosition",Qc),ct("ImageAtlas",_h),o.WritingMode=void 0,(Ts=o.WritingMode||(o.WritingMode={}))[Ts.none=0]="none",Ts[Ts.horizontal=1]="horizontal",Ts[Ts.vertical=2]="vertical",Ts[Ts.horizontalOnly=3]="horizontalOnly";const jl=-17;class Ba{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new Ba;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new Ba;return r.imageName=e,r}}class Bo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new Bo;for(let p=0;p<e.sections.length;p++){const g=e.sections[p];g.image?a.addImageSection(g):a.addTextSection(g,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const p=e.charCodeAt(a+1)||null,g=e.charCodeAt(a-1)||null;r+=p&&wl(p)&&!La[e[a+1]]||g&&wl(g)&&!La[e[a-1]]||!La[e[a]]?e[a]:La[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&ql[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&ql[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Bo;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Ba.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void ze("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Ba.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ze("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gl(i,e,r,a,p,g,v,T,k,z,L,R,j,q,Z,re){const ie=Bo.fromFeature(i,p);let me;R===o.WritingMode.vertical&&ie.verticalizePunctuation();const{processBidirectionalText:ke,processStyledBidirectionalText:de}=Or;if(ke&&ie.sections.length===1){me=[];const Re=ke(ie.toString(),$c(ie,z,g,e,a,q,Z));for(const lt of Re){const ht=new Bo;ht.text=lt,ht.sections=ie.sections;for(let tt=0;tt<lt.length;tt++)ht.sectionIndex.push(0);me.push(ht)}}else if(de){me=[];const Re=de(ie.text,ie.sectionIndex,$c(ie,z,g,e,a,q,Z));for(const lt of Re){const ht=new Bo;ht.text=lt[0],ht.sectionIndex=lt[1],ht.sections=ie.sections,me.push(ht)}}else me=function(Re,lt){const ht=[],tt=Re.text;let Ye=0;for(const We of lt)ht.push(Re.substring(Ye,We)),Ye=We;return Ye<tt.length&&ht.push(Re.substring(Ye,tt.length)),ht}(ie,$c(ie,z,g,e,a,q,Z));const ve=[],Fe={positionedLines:ve,text:ie.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(Re,lt,ht,tt,Ye,We,it,$e,je,vt,mt,Vt){let _i=0,ki=jl,Vi=0,Hr=0;const or=$e==="right"?1:$e==="left"?0:.5;let Li=0;for(const Bi of Ye){Bi.trim();const lr=Bi.getMaxScale(),dr=(lr-1)*Qi,wr={positionedGlyphs:[],lineOffset:0};Re.positionedLines[Li]=wr;const Mr=wr.positionedGlyphs;let Pr=0;if(!Bi.length()){ki+=We,++Li;continue}for(let Wi=0;Wi<Bi.length();Wi++){const Nt=Bi.getSection(Wi),Nr=Bi.getSectionIndex(Wi),cr=Bi.getCharCode(Wi);let pr=0,nn=null,pn=null,mn=null,Jn=Qi;const sn=!(je===o.WritingMode.horizontal||!mt&&!pa(cr)||mt&&(ql[cr]||(Hi=cr,et.Arabic(Hi)||et["Arabic Supplement"](Hi)||et["Arabic Extended-A"](Hi)||et["Arabic Presentation Forms-A"](Hi)||et["Arabic Presentation Forms-B"](Hi))));if(Nt.imageName){const Wr=tt[Nt.imageName];if(!Wr)continue;mn=Nt.imageName,Re.iconsInText=Re.iconsInText||!0,pn=Wr.paddedRect;const Dr=Wr.displaySize;Nt.scale=Nt.scale*Qi/Vt,nn={width:Dr[0],height:Dr[1],left:1,top:-3,advance:sn?Dr[1]:Dr[0]},pr=dr+(Qi-Dr[1]*Nt.scale),Jn=nn.advance;const Yn=sn?Dr[0]*Nt.scale-Qi*lr:Dr[1]*Nt.scale-Qi*lr;Yn>0&&Yn>Pr&&(Pr=Yn)}else{const Wr=ht[Nt.fontStack],Dr=Wr&&Wr[cr];if(Dr&&Dr.rect)pn=Dr.rect,nn=Dr.metrics;else{const Yn=lt[Nt.fontStack],Oa=Yn&&Yn[cr];if(!Oa)continue;nn=Oa.metrics}pr=(lr-Nt.scale)*Qi}sn?(Re.verticalizable=!0,Mr.push({glyph:cr,imageName:mn,x:_i,y:ki+pr,vertical:sn,scale:Nt.scale,fontStack:Nt.fontStack,sectionIndex:Nr,metrics:nn,rect:pn}),_i+=Jn*Nt.scale+vt):(Mr.push({glyph:cr,imageName:mn,x:_i,y:ki+pr,vertical:sn,scale:Nt.scale,fontStack:Nt.fontStack,sectionIndex:Nr,metrics:nn,rect:pn}),_i+=nn.advance*Nt.scale+vt)}Mr.length!==0&&(Vi=Math.max(_i-vt,Vi),Hm(Mr,0,Mr.length-1,or,Pr)),_i=0;const Ei=We*lr+Pr;wr.lineOffset=Math.max(Pr,dr),ki+=Ei,Hr=Math.max(Ei,Hr),++Li}var Hi;const ar=ki-jl,{horizontalAlign:fr,verticalAlign:zr}=eu(it);(function(Bi,lr,dr,wr,Mr,Pr,Ei,Wi,Nt){const Nr=(lr-dr)*Mr;let cr=0;cr=Pr!==Ei?-Wi*wr-jl:(-wr*Nt+.5)*Ei;for(const pr of Bi)for(const nn of pr.positionedGlyphs)nn.x+=Nr,nn.y+=cr})(Re.positionedLines,or,fr,zr,Vi,Hr,We,ar,Ye.length),Re.top+=-zr*ar,Re.bottom=Re.top+ar,Re.left+=-fr*Vi,Re.right=Re.left+Vi}(Fe,e,r,a,me,v,T,k,R,z,j,re),!function(Re){for(const lt of Re)if(lt.positionedGlyphs.length!==0)return!1;return!0}(ve)&&Fe}const ql={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yh(i,e,r,a,p,g){if(e.imageName){const v=a[e.imageName];return v?v.displaySize[0]*e.scale*Qi/g+p:0}{const v=r[e.fontStack],T=v&&v[i];return T?T.metrics.advance*e.scale+p:0}}function vh(i,e,r,a){const p=Math.pow(i-e,2);return a?i<e?p/2:2*p:p+Math.abs(r)*r}function Xm(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function xh(i,e,r,a,p,g){let v=null,T=vh(e,r,p,g);for(const k of a){const z=vh(e-k.x,r,p,g)+k.badness;z<=T&&(v=k,T=z)}return{index:i,x:e,priorBreak:v,badness:T}}function bh(i){return i?bh(i.priorBreak).concat(i.index):[]}function $c(i,e,r,a,p,g,v){if(g!=="point")return[];if(!i)return[];const T=[],k=function(j,q,Z,re,ie,me){let ke=0;for(let de=0;de<j.length();de++){const ve=j.getSection(de);ke+=yh(j.getCharCode(de),ve,re,ie,q,me)}return ke/Math.max(1,Math.ceil(ke/Z))}(i,e,r,a,p,v),z=i.text.indexOf("")>=0;let L=0;for(let j=0;j<i.length();j++){const q=i.getSection(j),Z=i.getCharCode(j);if(ql[Z]||(L+=yh(Z,q,a,p,e,v)),j<i.length()-1){const re=!((R=Z)<11904||!(et["Bopomofo Extended"](R)||et.Bopomofo(R)||et["CJK Compatibility Forms"](R)||et["CJK Compatibility Ideographs"](R)||et["CJK Compatibility"](R)||et["CJK Radicals Supplement"](R)||et["CJK Strokes"](R)||et["CJK Symbols and Punctuation"](R)||et["CJK Unified Ideographs Extension A"](R)||et["CJK Unified Ideographs"](R)||et["Enclosed CJK Letters and Months"](R)||et["Halfwidth and Fullwidth Forms"](R)||et.Hiragana(R)||et["Ideographic Description Characters"](R)||et["Kangxi Radicals"](R)||et["Katakana Phonetic Extensions"](R)||et.Katakana(R)||et["Vertical Forms"](R)||et["Yi Radicals"](R)||et["Yi Syllables"](R)));(Zm[Z]||re||q.imageName)&&T.push(xh(j+1,L,k,T,Xm(Z,i.getCharCode(j+1),re&&z),!1))}}var R;return bh(xh(i.length(),L,k,T,0,!0))}function eu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Hm(i,e,r,a,p){if(!a&&!p)return;const g=i[r],v=(i[r].x+g.metrics.advance*g.scale)*a;for(let T=e;T<=r;T++)i[T].x-=v,i[T].y+=p}function Wm(i,e,r){const{horizontalAlign:a,verticalAlign:p}=eu(r),g=e[0]-i.displaySize[0]*a,v=e[1]-i.displaySize[1]*p;return{image:i,top:v,bottom:v+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function wh(i,e,r,a,p,g){const v=i.image;let T;if(v.content){const ie=v.content,me=v.pixelRatio||1;T=[ie[0]/me,ie[1]/me,v.displaySize[0]-ie[2]/me,v.displaySize[1]-ie[3]/me]}const k=e.left*g,z=e.right*g;let L,R,j,q;r==="width"||r==="both"?(q=p[0]+k-a[3],R=p[0]+z+a[1]):(q=p[0]+(k+z-v.displaySize[0])/2,R=q+v.displaySize[0]);const Z=e.top*g,re=e.bottom*g;return r==="height"||r==="both"?(L=p[1]+Z-a[0],j=p[1]+re+a[2]):(L=p[1]+(Z+re-v.displaySize[1])/2,j=L+v.displaySize[1]),{image:v,top:L,right:R,bottom:j,left:q,collisionPadding:T}}const Kn=128;function Th(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new wi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:p}=r;let g=0;for(;g<a.length&&a[g]<=i;)g++;g=Math.max(0,g-1);let v=g;for(;v<a.length&&a[v]<i+1;)v++;v=Math.min(a.length-1,v);const T=a[g],k=a[v];return r.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:k,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:k,minSize:r.evaluate(new wi(T)),maxSize:r.evaluate(new wi(k)),interpolationType:p}}}class ks extends bt{constructor(e,r,a,p){super(e,r),this.angle=a,p!==void 0&&(this.segment=p)}clone(){return new ks(this.x,this.y,this.angle,this.segment)}}function kh(i,e,r,a,p){if(e.segment===void 0)return!0;let g=e,v=e.segment+1,T=0;for(;T>-r/2;){if(v--,v<0)return!1;T-=i[v].dist(g),g=i[v]}T+=i[v].dist(i[v+1]),v++;const k=[];let z=0;for(;T<r/2;){const L=i[v],R=i[v+1];if(!R)return!1;let j=i[v-1].angleTo(L)-L.angleTo(R);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:T,angleDelta:j}),z+=j;T-k[0].distance>a;)z-=k.shift().angleDelta;if(z>p)return!1;v++,T+=L.dist(R)}return!0}function Eh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Sh(i,e,r){return i?.6*e*r:0}function Ih(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Km(i,e,r,a,p,g){const v=Sh(r,p,g),T=Ih(r,a)*g;let k=0;const z=Eh(i)/2;for(let L=0;L<i.length-1;L++){const R=i[L],j=i[L+1],q=R.dist(j);if(k+q>z){const Z=(z-k)/q,re=xi(R.x,j.x,Z),ie=xi(R.y,j.y,Z),me=new ks(re,ie,j.angleTo(R),L);return me._round(),!v||kh(i,me,T,v,e)?me:void 0}k+=q}}function Jm(i,e,r,a,p,g,v,T,k){const z=Sh(a,g,v),L=Ih(a,p),R=L*v,j=i[0].x===0||i[0].x===k||i[0].y===0||i[0].y===k;return e-R<e/4&&(e=R+e/4),Ch(i,j?e/2*T%e:(L/2+2*g)*v*T%e,e,z,r,R,j,!1,k)}function Ch(i,e,r,a,p,g,v,T,k){const z=g/2,L=Eh(i);let R=0,j=e-r,q=[];for(let Z=0;Z<i.length-1;Z++){const re=i[Z],ie=i[Z+1],me=re.dist(ie),ke=ie.angleTo(re);for(;j+r<R+me;){j+=r;const de=(j-R)/me,ve=xi(re.x,ie.x,de),Fe=xi(re.y,ie.y,de);if(ve>=0&&ve<k&&Fe>=0&&Fe<k&&j-z>=0&&j+z<=L){const Re=new ks(ve,Fe,ke,Z);Re._round(),a&&!kh(i,Re,g,a,p)||q.push(Re)}}R+=me}return T||q.length||v||(q=Ch(i,R/2,r,a,p,g,v,!0,k)),q}function Ah(i,e,r,a,p){const g=[];for(let v=0;v<i.length;v++){const T=i[v];let k;for(let z=0;z<T.length-1;z++){let L=T[z],R=T[z+1];L.x<e&&R.x<e||(L.x<e?L=new bt(e,L.y+(e-L.x)/(R.x-L.x)*(R.y-L.y))._round():R.x<e&&(R=new bt(e,L.y+(e-L.x)/(R.x-L.x)*(R.y-L.y))._round()),L.y<r&&R.y<r||(L.y<r?L=new bt(L.x+(r-L.y)/(R.y-L.y)*(R.x-L.x),r)._round():R.y<r&&(R=new bt(L.x+(r-L.y)/(R.y-L.y)*(R.x-L.x),r)._round()),L.x>=a&&R.x>=a||(L.x>=a?L=new bt(a,L.y+(a-L.x)/(R.x-L.x)*(R.y-L.y))._round():R.x>=a&&(R=new bt(a,L.y+(a-L.x)/(R.x-L.x)*(R.y-L.y))._round()),L.y>=p&&R.y>=p||(L.y>=p?L=new bt(L.x+(p-L.y)/(R.y-L.y)*(R.x-L.x),p)._round():R.y>=p&&(R=new bt(L.x+(p-L.y)/(R.y-L.y)*(R.x-L.x),p)._round()),k&&L.equals(k[k.length-1])||(k=[L],g.push(k)),k.push(R)))))}}return g}function zh(i,e,r,a){const p=[],g=i.image,v=g.pixelRatio,T=g.paddedRect.w-2,k=g.paddedRect.h-2,z=i.right-i.left,L=i.bottom-i.top,R=g.stretchX||[[0,T]],j=g.stretchY||[[0,k]],q=(We,it)=>We+it[1]-it[0],Z=R.reduce(q,0),re=j.reduce(q,0),ie=T-Z,me=k-re;let ke=0,de=Z,ve=0,Fe=re,Re=0,lt=ie,ht=0,tt=me;if(g.content&&a){const We=g.content;ke=Zl(R,0,We[0]),ve=Zl(j,0,We[1]),de=Zl(R,We[0],We[2]),Fe=Zl(j,We[1],We[3]),Re=We[0]-ke,ht=We[1]-ve,lt=We[2]-We[0]-de,tt=We[3]-We[1]-Fe}const Ye=(We,it,$e,je)=>{const vt=Xl(We.stretch-ke,de,z,i.left),mt=Hl(We.fixed-Re,lt,We.stretch,Z),Vt=Xl(it.stretch-ve,Fe,L,i.top),_i=Hl(it.fixed-ht,tt,it.stretch,re),ki=Xl($e.stretch-ke,de,z,i.left),Vi=Hl($e.fixed-Re,lt,$e.stretch,Z),Hr=Xl(je.stretch-ve,Fe,L,i.top),or=Hl(je.fixed-ht,tt,je.stretch,re),Li=new bt(vt,Vt),Hi=new bt(ki,Vt),ar=new bt(ki,Hr),fr=new bt(vt,Hr),zr=new bt(mt/v,_i/v),Bi=new bt(Vi/v,or/v),lr=e*Math.PI/180;if(lr){const Mr=Math.sin(lr),Pr=Math.cos(lr),Ei=[Pr,-Mr,Mr,Pr];Li._matMult(Ei),Hi._matMult(Ei),fr._matMult(Ei),ar._matMult(Ei)}const dr=We.stretch+We.fixed,wr=it.stretch+it.fixed;return{tl:Li,tr:Hi,bl:fr,br:ar,tex:{x:g.paddedRect.x+1+dr,y:g.paddedRect.y+1+wr,w:$e.stretch+$e.fixed-dr,h:je.stretch+je.fixed-wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zr,pixelOffsetBR:Bi,minFontScaleX:lt/v/z,minFontScaleY:tt/v/L,isSDF:r}};if(a&&(g.stretchX||g.stretchY)){const We=Mh(R,ie,Z),it=Mh(j,me,re);for(let $e=0;$e<We.length-1;$e++){const je=We[$e],vt=We[$e+1];for(let mt=0;mt<it.length-1;mt++)p.push(Ye(je,it[mt],vt,it[mt+1]))}}else p.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:k+1}));return p}function Zl(i,e,r){let a=0;for(const p of i)a+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return a}function Mh(i,e,r){const a=[{fixed:-1,stretch:0}];for(const[p,g]of i){const v=a[a.length-1];a.push({fixed:p-v.stretch,stretch:v.stretch}),a.push({fixed:p-v.stretch,stretch:v.stretch+(g-p)})}return a.push({fixed:e+1,stretch:r}),a}function Xl(i,e,r,a){return i/e*r+a}function Hl(i,e,r,a){return i-e*r/a}ct("Anchor",ks);class Wl{constructor(e,r,a,p,g,v,T,k,z,L){if(this.boxStartIndex=e.length,z){let R=v.top,j=v.bottom;const q=v.collisionPadding;q&&(R-=q[1],j+=q[3]);let Z=j-R;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{let R=v.top*T-k[0],j=v.bottom*T+k[2],q=v.left*T-k[3],Z=v.right*T+k[1];const re=v.collisionPadding;if(re&&(q-=re[0]*T,R-=re[1]*T,Z+=re[2]*T,j+=re[3]*T),L){const ie=new bt(q,R),me=new bt(Z,R),ke=new bt(q,j),de=new bt(Z,j),ve=L*Math.PI/180;ie._rotate(ve),me._rotate(ve),ke._rotate(ve),de._rotate(ve),q=Math.min(ie.x,me.x,ke.x,de.x),Z=Math.max(ie.x,me.x,ke.x,de.x),R=Math.min(ie.y,me.y,ke.y,de.y),j=Math.max(ie.y,me.y,ke.y,de.y)}e.emplaceBack(r.x,r.y,q,R,Z,j,a,p,g)}this.boxEndIndex=e.length}}class Ym{constructor(e=[],r=Qm){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,p=r[e];for(;e>0;){const g=e-1>>1,v=r[g];if(a(p,v)>=0)break;r[e]=v,e=g}r[e]=p}_down(e){const{data:r,compare:a}=this,p=this.length>>1,g=r[e];for(;e<p;){let v=1+(e<<1),T=r[v];const k=v+1;if(k<this.length&&a(r[k],T)<0&&(v=k,T=r[k]),a(T,g)>=0)break;r[e]=T,e=v}r[e]=g}}function Qm(i,e){return i<e?-1:i>e?1:0}function $m(i,e=1,r=!1){let a=1/0,p=1/0,g=-1/0,v=-1/0;const T=i[0];for(let q=0;q<T.length;q++){const Z=T[q];(!q||Z.x<a)&&(a=Z.x),(!q||Z.y<p)&&(p=Z.y),(!q||Z.x>g)&&(g=Z.x),(!q||Z.y>v)&&(v=Z.y)}const k=Math.min(g-a,v-p);let z=k/2;const L=new Ym([],eg);if(k===0)return new bt(a,p);for(let q=a;q<g;q+=k)for(let Z=p;Z<v;Z+=k)L.push(new Ro(q+z,Z+z,z,i));let R=function(q){let Z=0,re=0,ie=0;const me=q[0];for(let ke=0,de=me.length,ve=de-1;ke<de;ve=ke++){const Fe=me[ke],Re=me[ve],lt=Fe.x*Re.y-Re.x*Fe.y;re+=(Fe.x+Re.x)*lt,ie+=(Fe.y+Re.y)*lt,Z+=3*lt}return new Ro(re/Z,ie/Z,0,q)}(i),j=L.length;for(;L.length;){const q=L.pop();(q.d>R.d||!R.d)&&(R=q,r&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,j)),q.max-R.d<=e||(z=q.h/2,L.push(new Ro(q.p.x-z,q.p.y-z,z,i)),L.push(new Ro(q.p.x+z,q.p.y-z,z,i)),L.push(new Ro(q.p.x-z,q.p.y+z,z,i)),L.push(new Ro(q.p.x+z,q.p.y+z,z,i)),j+=4)}return r&&(console.log(`num probes: ${j}`),console.log(`best distance: ${R.d}`)),R.p}function eg(i,e){return e.max-i.max}function Ro(i,e,r,a){this.p=new bt(i,e),this.h=r,this.d=function(p,g){let v=!1,T=1/0;for(let k=0;k<g.length;k++){const z=g[k];for(let L=0,R=z.length,j=R-1;L<R;j=L++){const q=z[L],Z=z[j];q.y>p.y!=Z.y>p.y&&p.x<(Z.x-q.x)*(p.y-q.y)/(Z.y-q.y)+q.x&&(v=!v),T=Math.min(T,Vu(p,q,Z))}}return(v?1:-1)*Math.sqrt(T)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const tu=Number.POSITIVE_INFINITY;function Ph(i,e){return e[1]!==tu?function(r,a,p){let g=0,v=0;switch(a=Math.abs(a),p=Math.abs(p),r){case"top-right":case"top-left":case"top":v=p-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-p}switch(r){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,v]}(i,e[0],e[1]):function(r,a){let p=0,g=0;a<0&&(a=0);const v=a/Math.sqrt(2);switch(r){case"top-right":case"top-left":g=v-7;break;case"bottom-right":case"bottom-left":g=7-v;break;case"bottom":g=7-a;break;case"top":g=a-7}switch(r){case"top-right":case"bottom-right":p=-v;break;case"top-left":case"bottom-left":p=v;break;case"left":p=a;break;case"right":p=-a}return[p,g]}(i,e[0])}function iu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tg(i,e,r,a,p,g,v,T,k,z,L){let R=g.textMaxSize.evaluate(e,{});R===void 0&&(R=v);const j=i.layers[0].layout,q=j.get("icon-offset").evaluate(e,{},L),Z=Lh(r.horizontal),re=v/24,ie=i.tilePixelRatio*re,me=i.tilePixelRatio*R/24,ke=i.tilePixelRatio*T,de=i.tilePixelRatio*j.get("symbol-spacing"),ve=j.get("text-padding")*i.tilePixelRatio,Fe=function(je,vt,mt,Vt=1){const _i=je.get("icon-padding").evaluate(vt,{},mt),ki=_i&&_i.values;return[ki[0]*Vt,ki[1]*Vt,ki[2]*Vt,ki[3]*Vt]}(j,e,L,i.tilePixelRatio),Re=j.get("text-max-angle")/180*Math.PI,lt=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",ht=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",tt=j.get("symbol-placement"),Ye=de/2,We=j.get("icon-text-fit");let it;a&&We!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(it=wh(a,r.vertical,We,j.get("icon-text-fit-padding"),q,re)),Z&&(a=wh(a,Z,We,j.get("icon-text-fit-padding"),q,re)));const $e=(je,vt)=>{vt.x<0||vt.x>=Oi||vt.y<0||vt.y>=Oi||function(mt,Vt,_i,ki,Vi,Hr,or,Li,Hi,ar,fr,zr,Bi,lr,dr,wr,Mr,Pr,Ei,Wi,Nt,Nr,cr,pr,nn){const pn=mt.addToLineVertexArray(Vt,_i);let mn,Jn,sn,Wr,Dr=0,Yn=0,Oa=0,Jh=0,fu=-1,du=-1;const Qn={};let Yh=Xi.exports(""),pu=0,mu=0;if(Li._unevaluatedLayout.getValue("text-radial-offset")===void 0?[pu,mu]=Li.layout.get("text-offset").evaluate(Nt,{},pr).map(Lr=>Lr*Qi):(pu=Li.layout.get("text-radial-offset").evaluate(Nt,{},pr)*Qi,mu=tu),mt.allowVerticalPlacement&&ki.vertical){const Lr=Li.layout.get("text-rotate").evaluate(Nt,{},pr)+90;sn=new Wl(Hi,Vt,ar,fr,zr,ki.vertical,Bi,lr,dr,Lr),or&&(Wr=new Wl(Hi,Vt,ar,fr,zr,or,Mr,Pr,dr,Lr))}if(Vi){const Lr=Li.layout.get("icon-rotate").evaluate(Nt,{}),Pn=Li.layout.get("icon-text-fit")!=="none",Va=zh(Vi,Lr,cr,Pn),Ua=or?zh(or,Lr,cr,Pn):void 0;Jn=new Wl(Hi,Vt,ar,fr,zr,Vi,Mr,Pr,!1,Lr),Dr=4*Va.length;const ef=mt.iconSizeData;let no=null;ef.kind==="source"?(no=[Kn*Li.layout.get("icon-size").evaluate(Nt,{})],no[0]>Es&&ze(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ef.kind==="composite"&&(no=[Kn*Nr.compositeIconSizes[0].evaluate(Nt,{},pr),Kn*Nr.compositeIconSizes[1].evaluate(Nt,{},pr)],(no[0]>Es||no[1]>Es)&&ze(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,Va,no,Wi,Ei,Nt,o.WritingMode.none,Vt,pn.lineStartIndex,pn.lineLength,-1,pr),fu=mt.icon.placedSymbolArray.length-1,Ua&&(Yn=4*Ua.length,mt.addSymbols(mt.icon,Ua,no,Wi,Ei,Nt,o.WritingMode.vertical,Vt,pn.lineStartIndex,pn.lineLength,-1,pr),du=mt.icon.placedSymbolArray.length-1)}const Qh=Object.keys(ki.horizontal);for(const Lr of Qh){const Pn=ki.horizontal[Lr];if(!mn){Yh=Xi.exports(Pn.text);const Ua=Li.layout.get("text-rotate").evaluate(Nt,{},pr);mn=new Wl(Hi,Vt,ar,fr,zr,Pn,Bi,lr,dr,Ua)}const Va=Pn.positionedLines.length===1;if(Oa+=Dh(mt,Vt,Pn,Hr,Li,dr,Nt,wr,pn,ki.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,Va?Qh:[Lr],Qn,fu,Nr,pr),Va)break}ki.vertical&&(Jh+=Dh(mt,Vt,ki.vertical,Hr,Li,dr,Nt,wr,pn,o.WritingMode.vertical,["vertical"],Qn,du,Nr,pr));const pg=mn?mn.boxStartIndex:mt.collisionBoxArray.length,mg=mn?mn.boxEndIndex:mt.collisionBoxArray.length,gg=sn?sn.boxStartIndex:mt.collisionBoxArray.length,_g=sn?sn.boxEndIndex:mt.collisionBoxArray.length,yg=Jn?Jn.boxStartIndex:mt.collisionBoxArray.length,vg=Jn?Jn.boxEndIndex:mt.collisionBoxArray.length,xg=Wr?Wr.boxStartIndex:mt.collisionBoxArray.length,bg=Wr?Wr.boxEndIndex:mt.collisionBoxArray.length;let gn=-1;const $l=(Lr,Pn)=>Lr&&Lr.circleDiameter?Math.max(Lr.circleDiameter,Pn):Pn;gn=$l(mn,gn),gn=$l(sn,gn),gn=$l(Jn,gn),gn=$l(Wr,gn);const $h=gn>-1?1:0;$h&&(gn*=nn/Qi),mt.glyphOffsetArray.length>=Fo.MAX_GLYPHS&&ze("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Nt.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,Nt.sortKey),mt.symbolInstances.emplaceBack(Vt.x,Vt.y,Qn.right>=0?Qn.right:-1,Qn.center>=0?Qn.center:-1,Qn.left>=0?Qn.left:-1,Qn.vertical||-1,fu,du,Yh,pg,mg,gg,_g,yg,vg,xg,bg,ar,Oa,Jh,Dr,Yn,$h,0,Bi,pu,mu,gn)}(i,vt,je,r,a,p,it,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ie,[ve,ve,ve,ve],lt,k,ke,Fe,ht,q,e,g,z,L,v)};if(tt==="line")for(const je of Ah(e.geometry,0,0,Oi,Oi)){const vt=Jm(je,de,Re,r.vertical||Z,a,24,me,i.overscaling,Oi);for(const mt of vt){const Vt=Z;Vt&&ig(i,Vt.text,Ye,mt)||$e(je,mt)}}else if(tt==="line-center"){for(const je of e.geometry)if(je.length>1){const vt=Km(je,Re,r.vertical||Z,a,24,me);vt&&$e(je,vt)}}else if(e.type==="Polygon")for(const je of Gc(e.geometry,0)){const vt=$m(je,16);$e(je[0],new ks(vt.x,vt.y,0))}else if(e.type==="LineString")for(const je of e.geometry)$e(je,new ks(je[0].x,je[0].y,0));else if(e.type==="Point")for(const je of e.geometry)for(const vt of je)$e([vt],new ks(vt.x,vt.y,0))}const Es=32640;function Dh(i,e,r,a,p,g,v,T,k,z,L,R,j,q,Z){const re=function(ke,de,ve,Fe,Re,lt,ht,tt){const Ye=Fe.layout.get("text-rotate").evaluate(lt,{})*Math.PI/180,We=[];for(const it of de.positionedLines)for(const $e of it.positionedGlyphs){if(!$e.rect)continue;const je=$e.rect||{};let vt=4,mt=!0,Vt=1,_i=0;const ki=(Re||tt)&&$e.vertical,Vi=$e.metrics.advance*$e.scale/2;if(tt&&de.verticalizable){const Ei=($e.scale-1)*Qi,Wi=(Qi-$e.metrics.width*$e.scale)/2;_i=it.lineOffset/2-($e.imageName?-Wi:Ei)}if($e.imageName){const Ei=ht[$e.imageName];mt=Ei.sdf,Vt=Ei.pixelRatio,vt=1/Vt}const Hr=Re?[$e.x+Vi,$e.y]:[0,0];let or=Re?[0,0]:[$e.x+Vi+ve[0],$e.y+ve[1]-_i],Li=[0,0];ki&&(Li=or,or=[0,0]);const Hi=($e.metrics.left-vt)*$e.scale-Vi+or[0],ar=(-$e.metrics.top-vt)*$e.scale+or[1],fr=Hi+je.w*$e.scale/Vt,zr=ar+je.h*$e.scale/Vt,Bi=new bt(Hi,ar),lr=new bt(fr,ar),dr=new bt(Hi,zr),wr=new bt(fr,zr);if(ki){const Ei=new bt(-Vi,Vi-jl),Wi=-Math.PI/2,Nt=12-Vi,Nr=new bt(22-Nt,-($e.imageName?Nt:0)),cr=new bt(...Li);Bi._rotateAround(Wi,Ei)._add(Nr)._add(cr),lr._rotateAround(Wi,Ei)._add(Nr)._add(cr),dr._rotateAround(Wi,Ei)._add(Nr)._add(cr),wr._rotateAround(Wi,Ei)._add(Nr)._add(cr)}if(Ye){const Ei=Math.sin(Ye),Wi=Math.cos(Ye),Nt=[Wi,-Ei,Ei,Wi];Bi._matMult(Nt),lr._matMult(Nt),dr._matMult(Nt),wr._matMult(Nt)}const Mr=new bt(0,0),Pr=new bt(0,0);We.push({tl:Bi,tr:lr,bl:dr,br:wr,tex:je,writingMode:de.writingMode,glyphOffset:Hr,sectionIndex:$e.sectionIndex,isSDF:mt,pixelOffsetTL:Mr,pixelOffsetBR:Pr,minFontScaleX:0,minFontScaleY:0})}return We}(0,r,T,p,g,v,a,i.allowVerticalPlacement),ie=i.textSizeData;let me=null;ie.kind==="source"?(me=[Kn*p.layout.get("text-size").evaluate(v,{})],me[0]>Es&&ze(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(me=[Kn*q.compositeTextSizes[0].evaluate(v,{},Z),Kn*q.compositeTextSizes[1].evaluate(v,{},Z)],(me[0]>Es||me[1]>Es)&&ze(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,re,me,T,g,v,z,e,k.lineStartIndex,k.lineLength,j,Z);for(const ke of L)R[ke]=i.text.placedSymbolArray.length-1;return 4*re.length}function Lh(i){for(const e in i)return i[e];return null}function ig(i,e,r,a){const p=i.compareText;if(e in p){const g=p[e];for(let v=g.length-1;v>=0;v--)if(a.dist(g[v])<r)return!0}else p[e]=[];return p[e].push(a),!1}const rg=ws.VectorTileFeature.types,ng=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kl(i,e,r,a,p,g,v,T,k,z,L,R,j){const q=T?Math.min(Es,Math.round(T[0])):0,Z=T?Math.min(Es,Math.round(T[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*p),g,v,(q<<1)+(k?1:0),Z,16*z,16*L,256*R,256*j)}function ru(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function sg(i){for(const e of i.sections)if(kl(e.text))return!0;return!1}class nu{constructor(e){this.layoutVertexArray=new tn,this.indexArray=new vr,this.programConfigurations=e,this.segments=new Ut,this.dynamicLayoutVertexArray=new qr,this.opacityVertexArray=new rn,this.placedSymbolArray=new Ne}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,p){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Am.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ng,!0),this.opacityVertexBuffer.itemSize=1),(a||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ct("SymbolBuffers",nu);class su{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Ut,this.collisionVertexArray=new Vr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,zm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ct("CollisionBuffers",su);class Fo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(v=>v.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Fc([]),this.placementViewportMatrix=Fc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Th(this.zoom,r["text-size"]),this.iconSizeData=Th(this.zoom,r["icon-size"]);const a=this.layers[0].layout,p=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=au(a,"text-overlap","text-allow-overlap")!=="never"||au(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(v=>o.WritingMode[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=e.sourceID}createArrays(){this.text=new nu(new $s(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new nu(new $s(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Je,this.lineVertexArray=new at,this.symbolInstances=new ot}calculateGlyphDependencies(e,r,a,p,g){for(let v=0;v<e.length;v++)if(r[e.charCodeAt(v)]=!0,(a||p)&&g){const T=La[e.charAt(v)];T&&(r[T.charCodeAt(0)]=!0)}}populate(e,r,a){const p=this.layers[0],g=p.layout,v=g.get("text-font"),T=g.get("text-field"),k=g.get("icon-image"),z=(T.value.kind!=="constant"||T.value.value instanceof oe&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),L=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,R=g.get("symbol-sort-key");if(this.features=[],!z&&!L)return;const j=r.iconDependencies,q=r.glyphDependencies,Z=r.availableImages,re=new wi(this.zoom);for(const{feature:ie,id:me,index:ke,sourceLayerIndex:de}of e){const ve=p._featureFilter.needGeometry,Fe=to(ie,ve);if(!p._featureFilter.filter(re,Fe,a))continue;let Re,lt;if(ve||(Fe.geometry=eo(ie)),z){const tt=p.getValueAndResolveTokens("text-field",Fe,a,Z),Ye=oe.factory(tt);sg(Ye)&&(this.hasRTLText=!0),(!this.hasRTLText||Js()==="unavailable"||this.hasRTLText&&Or.isParsed())&&(Re=Pm(Ye,p,Fe))}if(L){const tt=p.getValueAndResolveTokens("icon-image",Fe,a,Z);lt=tt instanceof he?tt:he.fromString(tt)}if(!Re&&!lt)continue;const ht=this.sortFeaturesByKey?R.evaluate(Fe,{},a):void 0;if(this.features.push({id:me,text:Re,icon:lt,index:ke,sourceLayerIndex:de,geometry:Fe.geometry,properties:ie.properties,type:rg[ie.type],sortKey:ht}),lt&&(j[lt.name]=!0),Re){const tt=v.evaluate(Fe,{},a).join(","),Ye=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const We of Re.sections)if(We.image)j[We.image.name]=!0;else{const it=Eo(Re.toString()),$e=We.fontStack||tt,je=q[$e]=q[$e]||{};this.calculateGlyphDependencies(We.text,je,Ye,this.allowVerticalPlacement,it)}}}g.get("symbol-placement")==="line"&&(this.features=function(ie){const me={},ke={},de=[];let ve=0;function Fe(tt){de.push(ie[tt]),ve++}function Re(tt,Ye,We){const it=ke[tt];return delete ke[tt],ke[Ye]=it,de[it].geometry[0].pop(),de[it].geometry[0]=de[it].geometry[0].concat(We[0]),it}function lt(tt,Ye,We){const it=me[Ye];return delete me[Ye],me[tt]=it,de[it].geometry[0].shift(),de[it].geometry[0]=We[0].concat(de[it].geometry[0]),it}function ht(tt,Ye,We){const it=We?Ye[0][Ye[0].length-1]:Ye[0][0];return`${tt}:${it.x}:${it.y}`}for(let tt=0;tt<ie.length;tt++){const Ye=ie[tt],We=Ye.geometry,it=Ye.text?Ye.text.toString():null;if(!it){Fe(tt);continue}const $e=ht(it,We),je=ht(it,We,!0);if($e in ke&&je in me&&ke[$e]!==me[je]){const vt=lt($e,je,We),mt=Re($e,je,de[vt].geometry);delete me[$e],delete ke[je],ke[ht(it,de[mt].geometry,!0)]=mt,de[vt].geometry=null}else $e in ke?Re($e,je,We):je in me?lt($e,je,We):(Fe(tt),me[$e]=ve-1,ke[je]=ve-1)}return de.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,me)=>ie.sortKey-me.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(r[e.segment+1]),g=e.dist(r[e.segment]);const v={};for(let T=e.segment+1;T<r.length;T++)v[T]={x:r[T].x,y:r[T].y,tileUnitDistanceFromAnchor:p},T<r.length-1&&(p+=r[T+1].dist(r[T]));for(let T=e.segment||0;T>=0;T--)v[T]={x:r[T].x,y:r[T].y,tileUnitDistanceFromAnchor:g},T>0&&(g+=r[T-1].dist(r[T]));for(let T=0;T<r.length;T++){const k=v[T];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,p,g,v,T,k,z,L,R,j){const q=e.indexArray,Z=e.layoutVertexArray,re=e.segments.prepareSegment(4*r.length,Z,q,this.canOverlap?v.sortKey:void 0),ie=this.glyphOffsetArray.length,me=re.vertexLength,ke=this.allowVerticalPlacement&&T===o.WritingMode.vertical?Math.PI/2:0,de=v.text&&v.text.sections;for(let ve=0;ve<r.length;ve++){const{tl:Fe,tr:Re,bl:lt,br:ht,tex:tt,pixelOffsetTL:Ye,pixelOffsetBR:We,minFontScaleX:it,minFontScaleY:$e,glyphOffset:je,isSDF:vt,sectionIndex:mt}=r[ve],Vt=re.vertexLength,_i=je[1];Kl(Z,k.x,k.y,Fe.x,_i+Fe.y,tt.x,tt.y,a,vt,Ye.x,Ye.y,it,$e),Kl(Z,k.x,k.y,Re.x,_i+Re.y,tt.x+tt.w,tt.y,a,vt,We.x,Ye.y,it,$e),Kl(Z,k.x,k.y,lt.x,_i+lt.y,tt.x,tt.y+tt.h,a,vt,Ye.x,We.y,it,$e),Kl(Z,k.x,k.y,ht.x,_i+ht.y,tt.x+tt.w,tt.y+tt.h,a,vt,We.x,We.y,it,$e),ru(e.dynamicLayoutVertexArray,k,ke),q.emplaceBack(Vt,Vt+1,Vt+2),q.emplaceBack(Vt+1,Vt+2,Vt+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(je[0]),ve!==r.length-1&&mt===r[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,v,v.index,{},j,de&&de[mt])}e.placedSymbolArray.emplaceBack(k.x,k.y,ie,this.glyphOffsetArray.length-ie,me,z,L,k.segment,a?a[0]:0,a?a[1]:0,p[0],p[1],T,0,!1,0,R)}_addCollisionDebugVertex(e,r,a,p,g,v){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,p,g,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(e,r,a,p,g,v,T){const k=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),z=k.vertexLength,L=g.layoutVertexArray,R=g.collisionVertexArray,j=T.anchorX,q=T.anchorY;this._addCollisionDebugVertex(L,R,v,j,q,new bt(e,r)),this._addCollisionDebugVertex(L,R,v,j,q,new bt(a,r)),this._addCollisionDebugVertex(L,R,v,j,q,new bt(a,p)),this._addCollisionDebugVertex(L,R,v,j,q,new bt(e,p)),k.vertexLength+=4;const Z=g.indexArray;Z.emplaceBack(z,z+1),Z.emplaceBack(z+1,z+2),Z.emplaceBack(z+2,z+3),Z.emplaceBack(z+3,z),k.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,p){for(let g=e;g<r;g++){const v=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,p?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new su(zn,ch.members,fn),this.iconCollisionBox=new su(zn,ch.members,fn);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,p,g,v,T,k,z){const L={};for(let R=r;R<a;R++){const j=e.get(R);L.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},L.textFeatureIndex=j.featureIndex;break}for(let R=p;R<g;R++){const j=e.get(R);L.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},L.verticalTextFeatureIndex=j.featureIndex;break}for(let R=v;R<T;R++){const j=e.get(R);L.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},L.iconFeatureIndex=j.featureIndex;break}for(let R=k;R<z;R++){const j=e.get(R);L.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},L.verticalIconFeatureIndex=j.featureIndex;break}return L}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),p=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<p;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),p=[],g=[],v=[];for(let T=0;T<this.symbolInstances.length;++T){v.push(T);const k=this.symbolInstances.get(T);p.push(0|Math.round(r*k.anchorX+a*k.anchorY)),g.push(k.featureIndex)}return v.sort((T,k)=>p[T]-p[k]||g[k]-g[T]),v}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((p,g,v)=>{p>=0&&v.indexOf(p)===g&&this.addIndicesForPlacedSymbol(this.text,p)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ct("SymbolBucket",Fo,{omit:["layers","collisionBoxArray","features","compareText"]}),Fo.MAX_GLYPHS=65535,Fo.addDynamicAttributes=ru;const og=new Yi({"symbol-placement":new pt(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pt(Le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new pt(Le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new pt(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(Le.layout_symbol["icon-size"]),"icon-text-fit":new pt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(Le.layout_symbol["icon-image"]),"icon-rotate":new Tt(Le.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(Le.layout_symbol["icon-offset"]),"icon-anchor":new Tt(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(Le.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(Le.layout_symbol["text-field"]),"text-font":new Tt(Le.layout_symbol["text-font"]),"text-size":new Tt(Le.layout_symbol["text-size"]),"text-max-width":new Tt(Le.layout_symbol["text-max-width"]),"text-line-height":new pt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(Le.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(Le.layout_symbol["text-justify"]),"text-radial-offset":new Tt(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(Le.layout_symbol["text-variable-anchor"]),"text-anchor":new Tt(Le.layout_symbol["text-anchor"]),"text-max-angle":new pt(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(Le.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(Le.layout_symbol["text-rotate"]),"text-padding":new pt(Le.layout_symbol["text-padding"]),"text-keep-upright":new pt(Le.layout_symbol["text-keep-upright"]),"text-transform":new Tt(Le.layout_symbol["text-transform"]),"text-offset":new Tt(Le.layout_symbol["text-offset"]),"text-allow-overlap":new pt(Le.layout_symbol["text-allow-overlap"]),"text-overlap":new pt(Le.layout_symbol["text-overlap"]),"text-ignore-placement":new pt(Le.layout_symbol["text-ignore-placement"]),"text-optional":new pt(Le.layout_symbol["text-optional"])});var ou={paint:new Yi({"icon-opacity":new Tt(Le.paint_symbol["icon-opacity"]),"icon-color":new Tt(Le.paint_symbol["icon-color"]),"icon-halo-color":new Tt(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tt(Le.paint_symbol["text-opacity"]),"text-color":new Tt(Le.paint_symbol["text-color"],{runtimeType:Ji,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Tt(Le.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(Le.paint_symbol["text-halo-blur"]),"text-translate":new pt(Le.paint_symbol["text-translate"]),"text-translate-anchor":new pt(Le.paint_symbol["text-translate-anchor"])}),layout:og};class Bh{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:wn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ct("FormatSectionOverride",Bh,{omit:["defaultValue"]});class Jl extends en{constructor(e){super(e,ou)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const p=[];for(const g of a)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,p){const g=this.layout.get(e).evaluate(r,{},a,p),v=this._unevaluatedLayout._values[e];return v.isDataDriven()||Fs(v.value)||!g?g:function(T,k){return k.replace(/{([^{}]+)}/g,(z,L)=>L in T?String(T[L]):"")}(r.properties,g)}createBucket(e){return new Fo(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of ou.paint.overridableProperties){if(!Jl.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new Bh(r),p=new vo(a,r.property.specification);let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new Vs("source",p):new la("composite",p,r.value.zoomStops),this.paint._values[e]=new $r(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Jl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),p=ou.paint.properties[r];let g=!1;const v=T=>{for(const k of T)if(p.overrides&&p.overrides.hasOverride(k))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof oe)v(a.value.value.sections);else if(a.value.kind==="source"){const T=z=>{g||(z instanceof ft&&Ie(z.value)===ji?v(z.value.sections):z instanceof _o?v(z.sections):z.eachChild(T))},k=a.value;k._styleExpression&&T(k._styleExpression.expression)}return g}}function au(i,e,r){let a="never";const p=i.get(e);return p?a=p:i.get(r)&&(a="always"),a}var ag={paint:new Yi({"background-color":new pt(Le.paint_background["background-color"]),"background-pattern":new xa(Le.paint_background["background-pattern"]),"background-opacity":new pt(Le.paint_background["background-opacity"])})},lg={paint:new Yi({"raster-opacity":new pt(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new pt(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(Le.paint_raster["raster-saturation"]),"raster-contrast":new pt(Le.paint_raster["raster-contrast"]),"raster-resampling":new pt(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(Le.paint_raster["raster-fade-duration"])})};class cg extends en{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const ug={circle:class extends en{constructor(i){super(i,Np)}createBucket(i){return new Lc(i)}queryRadius(i){const e=i;return Ea("circle-radius",this,e)+Ea("circle-stroke-width",this,e)+Dl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,a,p,g,v,T){const k=Ll(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,v),z=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),L=this.paint.get("circle-pitch-alignment")==="map",R=L?k:function(q,Z){return q.map(re=>Xu(re,Z))}(k,T),j=L?z*v:z;for(const q of a)for(const Z of q){const re=L?Z:Xu(Z,T);let ie=j;const me=Bl([],[Z.x,Z.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=me[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=g.cameraToCenterDistance/me[3]),Rp(R,re,ie))return!0}return!1}},heatmap:class extends en{constructor(i){super(i,Gp),this._updateColorRamp()}createBucket(i){return new Hu(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ku({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends en{constructor(i){super(i,qp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends en{constructor(i){super(i,om)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Xc(i)}queryRadius(){return Dl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,a,p,g,v){return Ou(Ll(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,v),a)}isTileClipped(){return!0}},"fill-extrusion":class extends en{constructor(i){super(i,xm)}createBucket(i){return new Wc(i)}queryRadius(){return Dl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,a,p,g,v,T){const k=Ll(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,v),z=this.paint.get("fill-extrusion-height").evaluate(e,r),L=this.paint.get("fill-extrusion-base").evaluate(e,r),R=function(q,Z,re,ie){const me=[];for(const ke of q){const de=[ke.x,ke.y,0,1];Bl(de,de,Z),me.push(new bt(de[0]/de[3],de[1]/de[3]))}return me}(k,T),j=function(q,Z,re,ie){const me=[],ke=[],de=ie[8]*Z,ve=ie[9]*Z,Fe=ie[10]*Z,Re=ie[11]*Z,lt=ie[8]*re,ht=ie[9]*re,tt=ie[10]*re,Ye=ie[11]*re;for(const We of q){const it=[],$e=[];for(const je of We){const vt=je.x,mt=je.y,Vt=ie[0]*vt+ie[4]*mt+ie[12],_i=ie[1]*vt+ie[5]*mt+ie[13],ki=ie[2]*vt+ie[6]*mt+ie[14],Vi=ie[3]*vt+ie[7]*mt+ie[15],Hr=ki+Fe,or=Vi+Re,Li=Vt+lt,Hi=_i+ht,ar=ki+tt,fr=Vi+Ye,zr=new bt((Vt+de)/or,(_i+ve)/or);zr.z=Hr/or,it.push(zr);const Bi=new bt(Li/fr,Hi/fr);Bi.z=ar/fr,$e.push(Bi)}me.push(it),ke.push($e)}return[me,ke]}(a,L,z,T);return function(q,Z,re){let ie=1/0;Ou(re,Z)&&(ie=nh(re,Z[0]));for(let me=0;me<Z.length;me++){const ke=Z[me],de=q[me];for(let ve=0;ve<ke.length-1;ve++){const Fe=ke[ve],Re=[Fe,ke[ve+1],de[ve+1],de[ve],Fe];Fu(re,Re)&&(ie=Math.min(ie,nh(re,Re)))}}return ie!==1/0&&ie}(j[0],j[1],R)}},line:class extends en{constructor(i){super(i,oh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ps,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=ah.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Kc(i)}queryRadius(i){const e=i,r=lh(Ea("line-width",this,e),Ea("line-gap-width",this,e)),a=Ea("line-offset",this,e);return r/2+Math.abs(a)+Dl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,a,p,g,v){const T=Ll(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,v),k=v/2*lh(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),z=this.paint.get("line-offset").evaluate(e,r);return z&&(a=function(L,R){const j=[];for(let q=0;q<L.length;q++){const Z=L[q],re=[];for(let ie=0;ie<Z.length;ie++){const me=Z[ie-1],ke=Z[ie],de=Z[ie+1],ve=ie===0?new bt(0,0):ke.sub(me)._unit()._perp(),Fe=ie===Z.length-1?new bt(0,0):de.sub(ke)._unit()._perp(),Re=ve._add(Fe)._unit(),lt=Re.x*Fe.x+Re.y*Fe.y;lt!==0&&Re._mult(1/lt),re.push(Re._mult(R)._add(ke))}j.push(re)}return j}(a,z*v)),function(L,R,j){for(let q=0;q<R.length;q++){const Z=R[q];if(L.length>=3){for(let re=0;re<Z.length;re++)if(zo(L,Z[re]))return!0}if(Fp(L,Z,j))return!0}return!1}(T,a,k)}isTileClipped(){return!0}},symbol:Jl,background:class extends en{constructor(i){super(i,ag)}},raster:class extends en{constructor(i){super(i,lg)}}};class hg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Rh=63710088e-1;class Ci{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ci(V(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,p=e.lat*r,g=Math.sin(a)*Math.sin(p)+Math.cos(a)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return Rh*Math.acos(Math.min(g,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new ro(new Ci(this.lng-a,this.lat-r),new Ci(this.lng+a,this.lat+r))}static convert(e){if(e instanceof Ci)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ci(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ci(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ro{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ci?new Ci(e.lng,e.lat):Ci.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ci?new Ci(e.lng,e.lat):Ci.convert(e),this}extend(e){const r=this._sw,a=this._ne;let p,g;if(e instanceof Ci)p=e,g=e;else{if(!(e instanceof ro))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ro.convert(e)):this.extend(Ci.convert(e)):this;if(p=e._sw,g=e._ne,!p||!g)return this}return r||a?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),a.lng=Math.max(g.lng,a.lng),a.lat=Math.max(g.lat,a.lat)):(this._sw=new Ci(p.lng,p.lat),this._ne=new Ci(g.lng,g.lat)),this}getCenter(){return new Ci((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ci(this.getWest(),this.getNorth())}getSouthEast(){return new Ci(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=Ci.convert(e);let p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&p}static convert(e){return e instanceof ro?e:e&&new ro(e)}}const Fh=2*Math.PI*Rh;function Oh(i){return Fh*Math.cos(i*Math.PI/180)}function Vh(i){return(180+i)/360}function Uh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Nh(i,e){return i/Oh(e)}function lu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Yl{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Ci.convert(e);return new Yl(Vh(a.lng),Uh(a.lat),Nh(r,a.lat))}toLngLat(){return new Ci(360*this.x-180,lu(this.y))}toAltitude(){return this.z*Oh(lu(this.y))}meterInMercatorCoordinateUnits(){return 1/Fh*(e=lu(this.y),1/Math.cos(e*Math.PI/180));var e}}function jh(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class cu{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=Ra(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const p=(v=this.y,T=this.z,k=jh(256*(g=this.x),256*(v=Math.pow(2,T)-v-1),T),z=jh(256*(g+1),256*(v+1),T),k[0]+","+k[1]+","+z[0]+","+z[1]);var g,v,T,k,z;const L=function(R,j,q){let Z,re="";for(let ie=R;ie>0;ie--)Z=1<<ie-1,re+=(j&Z?1:0)+(q&Z?2:0);return re}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,p)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new bt((e.x*r-this.x)*Oi,(e.y*r-this.y)*Oi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gh{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ra(e,r.z,r.z,r.x,r.y)}}class Xr{constructor(e,r,a,p,g){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new cu(a,+p,+g),this.key=Ra(r,e,a,p,g)}clone(){return new Xr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Xr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Ra(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Ra(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Xr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,p=2*this.canonical.y;return[new Xr(r,this.wrap,r,a,p),new Xr(r,this.wrap,r,a+1,p),new Xr(r,this.wrap,r,a,p+1),new Xr(r,this.wrap,r,a+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Xr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Xr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Yl(e.x-this.wrap,e.y))}}function Ra(i,e,r,a,p){(i*=2)<0&&(i=-1*i-1);const g=1<<r;return(g*g*i+g*p+a).toString(36)+r.toString(36)+e.toString(36)}ct("CanonicalTileID",cu),ct("OverscaledTileID",Xr,{omit:["posMatrix"]});class qh{constructor(e,r,a){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void ze(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=a||"mapbox";for(let g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let g=0;g<p;g++)for(let v=0;v<p;v++){const T=this.get(g,v);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(e,r){const a=new Uint8Array(this.data.buffer),p=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[p],a[p+1],a[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,a){return(256*e*256+256*r+a)/10-1e4}_unpackTerrarium(e,r,a){return 256*e+r+a/256-32768}getPixels(){return new Zr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,g=r*this.dim+this.dim,v=a*this.dim,T=a*this.dim+this.dim;switch(r){case-1:p=g-1;break;case 1:g=p+1}switch(a){case-1:v=T-1;break;case 1:T=v+1}const k=-r*this.dim,z=-a*this.dim;for(let L=v;L<T;L++)for(let R=p;R<g;R++)this.data[this._idx(R,L)]=e.data[this._idx(R+k,L+z)]}}ct("DEMData",qh);class Zh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Xh{constructor(e,r,a,p,g){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=p,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Hh{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ks(Oi,16,0),this.grid3D=new Ks(Oi,16,0),this.featureIndexArray=new Ot,this.promoteId=r}insert(e,r,a,p,g,v){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,p,g);const k=v?this.grid3D:this.grid;for(let z=0;z<r.length;z++){const L=r[z],R=[1/0,1/0,-1/0,-1/0];for(let j=0;j<L.length;j++){const q=L[j];R[0]=Math.min(R[0],q.x),R[1]=Math.min(R[1],q.y),R[2]=Math.max(R[2],q.x),R[3]=Math.max(R[3],q.y)}R[0]<Oi&&R[1]<Oi&&R[2]>=0&&R[3]>=0&&k.insert(T,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ws.VectorTile(new Jc(this.rawTileData)).layers,this.sourceLayerCoder=new Zh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,p){this.loadVTLayers();const g=e.params||{},v=Oi/e.tileSize/e.scale,T=wo(g.filter),k=e.queryGeometry,z=e.queryPadding*v,L=Kh(k),R=this.grid.query(L.minX-z,L.minY-z,L.maxX+z,L.maxY+z),j=Kh(e.cameraQueryGeometry),q=this.grid3D.query(j.minX-z,j.minY-z,j.maxX+z,j.maxY+z,(ie,me,ke,de)=>function(ve,Fe,Re,lt,ht){for(const Ye of ve)if(Fe<=Ye.x&&Re<=Ye.y&&lt>=Ye.x&&ht>=Ye.y)return!0;const tt=[new bt(Fe,Re),new bt(Fe,ht),new bt(lt,ht),new bt(lt,Re)];if(ve.length>2){for(const Ye of tt)if(zo(ve,Ye))return!0}for(let Ye=0;Ye<ve.length-1;Ye++)if(Vp(ve[Ye],ve[Ye+1],tt))return!0;return!1}(e.cameraQueryGeometry,ie-z,me-z,ke+z,de+z));for(const ie of q)R.push(ie);R.sort(fg);const Z={};let re;for(let ie=0;ie<R.length;ie++){const me=R[ie];if(me===re)continue;re=me;const ke=this.featureIndexArray.get(me);let de=null;this.loadMatchingFeature(Z,ke.bucketIndex,ke.sourceLayerIndex,ke.featureIndex,T,g.layers,g.availableImages,r,a,p,(ve,Fe,Re)=>(de||(de=eo(ve)),Fe.queryIntersectsFeature(k,ve,Re,de,this.z,e.transform,v,e.pixelPosMatrix)))}return Z}loadMatchingFeature(e,r,a,p,g,v,T,k,z,L,R){const j=this.bucketLayerIDs[r];if(v&&!function(ie,me){for(let ke=0;ke<ie.length;ke++)if(me.indexOf(ie[ke])>=0)return!0;return!1}(v,j))return;const q=this.sourceLayerCoder.decode(a),Z=this.vtLayers[q].feature(p);if(g.needGeometry){const ie=to(Z,!0);if(!g.filter(new wi(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!g.filter(new wi(this.tileID.overscaledZ),Z))return;const re=this.getId(Z,q);for(let ie=0;ie<j.length;ie++){const me=j[ie];if(v&&v.indexOf(me)<0)continue;const ke=k[me];if(!ke)continue;let de={};re&&L&&(de=L.getState(ke.sourceLayer||"_geojsonTileLayer",re));const ve=U({},z[me]);ve.paint=Wh(ve.paint,ke.paint,Z,de,T),ve.layout=Wh(ve.layout,ke.layout,Z,de,T);const Fe=!R||R(Z,ke,de);if(!Fe)continue;const Re=new Xh(Z,this.z,this.x,this.y,re);Re.layer=ve;let lt=e[me];lt===void 0&&(lt=e[me]=[]),lt.push({featureIndex:p,feature:Re,intersectionZ:Fe})}}lookupSymbolFeatures(e,r,a,p,g,v,T,k){const z={};this.loadVTLayers();const L=wo(g);for(const R of e)this.loadMatchingFeature(z,a,p,R,L,v,T,k,r);return z}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function Wh(i,e,r,a,p){return pe(i,(g,v)=>{const T=e instanceof Qs?e.get(v):null;return T&&T.evaluate?T.evaluate(r,a,p):T})}function Kh(i){let e=1/0,r=1/0,a=-1/0,p=-1/0;for(const g of i)e=Math.min(e,g.x),r=Math.min(r,g.y),a=Math.max(a,g.x),p=Math.max(p,g.y);return{minX:e,minY:r,maxX:a,maxY:p}}function fg(i,e){return e-i}var uu;ct("FeatureIndex",Hh,{omit:["rawTileData","sourceLayerCoder"]}),o.PerformanceMarkers=void 0,(uu=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",uu.load="load",uu.fullLoad="fullLoad";let Ql=null,Fa=[];const hu=1e3/30,dg={mark(i){performance.mark(i)},frame(i){const e=i;Ql!=null&&Fa.push(e-Ql),Ql=e},clearMetrics(){Ql=null,Fa=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure("fullLoadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=Fa.length,a=1/(Fa.reduce((g,v)=>g+v,0)/r/1e3),p=Fa.filter(g=>g>hu).reduce((g,v)=>g+(v-hu)/hu,0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:p/(r+p)*100}}};o.AJAXError=kr,o.ARRAY_TYPE=br,o.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Q(["receive","process"],this),this.invoker=new hg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ue()?i:window}send(i,e,r,a,p=!1){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[g]=r);const v=si(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:i,hasCallback:!!r,targetMapId:a,mustQueue:p,sourceMapId:this.mapId,data:jn(e,v)},v),{cancel:()=>{r&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a()}else Ue()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(En(e.error)):r(null,En(e.data)))}else{let r=!1;const a=si(this.globalScope)?void 0:[],p=e.hasCallback?(T,k)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:T?jn(T):null,data:jn(k,a)},a)}:T=>{r=!0};let g=null;const v=En(e.data);if(this.parent[e.type])g=this.parent[e.type](e.sourceMapId,v,p);else if(this.parent.getWorkerSource){const T=e.type.split(".");g=this.parent.getWorkerSource(e.sourceMapId,T[0],v.source)[T[1]](v,p)}else p(new Error(`Could not find function ${e.type}`));!r&&g&&g.cancel&&(this.cancelCallbacks[i]=g.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=Ia,o.CanonicalTileID=cu,o.CollisionBoxArray=Pe,o.CollisionCircleLayoutArray=class extends B{},o.Color=W,o.DEMData=qh,o.DataConstantProperty=pt,o.DictionaryCoder=Zh,o.EXTENT=Oi,o.ErrorEvent=ns,o.EvaluationParameters=wi,o.Event=an,o.Evented=ln,o.FeatureIndex=Hh,o.FillBucket=Xc,o.FillExtrusionBucket=Wc,o.GeoJSONFeature=Xh,o.ImageAtlas=_h,o.ImagePosition=Qc,o.LineBucket=Kc,o.LineStripIndexArray=class extends te{},o.LngLat=Ci,o.LngLatBounds=ro,o.MercatorCoordinate=Yl,o.ONE_EM=Qi,o.OverscaledTileID=Xr,o.PerformanceUtils=dg,o.PosArray=yt,o.Properties=Yi,o.QuadTriangleArray=class extends G{},o.RGBAImage=Zr,o.RasterBoundsArray=class extends f{},o.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.ResourceType=Rr,o.SegmentVector=Ut,o.SymbolBucket=Fo,o.Transitionable=Il,o.TriangleIndexArray=vr,o.Uniform1f=Xn,o.Uniform1i=class extends Zn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends Zn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends Zn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=Co,o.UniformColor=Du,o.UniformMatrix4f=class extends Zn{constructor(i,e){super(i,e),this.current=Lp}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=Gh,o.ValidationError=Qe,o.ZoomHistory=fa,o.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},o.addDynamicAttributes=ru,o.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let a=i.length;const p=new Array(i.length);let g=null;i.forEach((v,T)=>{e(v,(k,z)=>{k&&(g=k),p[T]=z,--a==0&&r(g,p)})})},o.bezier=I,o.bindAll=Q,o.cacheEntryPossiblyAdded=function(i){Ki++,Ki>ur&&(i.getActor().send("enforceCacheSizeLimit",Ai),Ki=0)},o.clamp=A,o.clearTileCache=function(i){const e=caches.delete(Lt);i&&e.catch(i).then(()=>i())},o.clipLine=Ah,o.clone=function(i){var e=new br(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=Se,o.clone$2=function(i){var e=new br(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},o.collisionCircleLayout=Mm,o.config=Si,o.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.create=function(){var i=new br(16);return br!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.create$1=Nu,o.createExpression=Os,o.createFilter=wo,o.createLayout=Di,o.createStyleLayer=function(i){return i.type==="custom"?new cg(i):new ug[i.type](i)},o.cross=function(i,e,r){var a=e[0],p=e[1],g=e[2],v=r[0],T=r[1],k=r[2];return i[0]=p*k-g*T,i[1]=g*v-a*k,i[2]=a*T-p*v,i},o.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},o.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},o.ease=P,o.emitValidationErrors=ko,o.enforceCacheSizeLimit=function(i){Ui(),Ri&&Ri.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-i;a++)e.delete(r[a])})})},o.equals=function(i,e){var r=i[0],a=i[1],p=i[2],g=i[3],v=i[4],T=i[5],k=i[6],z=i[7],L=i[8],R=i[9],j=i[10],q=i[11],Z=i[12],re=i[13],ie=i[14],me=i[15],ke=e[0],de=e[1],ve=e[2],Fe=e[3],Re=e[4],lt=e[5],ht=e[6],tt=e[7],Ye=e[8],We=e[9],it=e[10],$e=e[11],je=e[12],vt=e[13],mt=e[14],Vt=e[15];return Math.abs(r-ke)<=xr*Math.max(1,Math.abs(r),Math.abs(ke))&&Math.abs(a-de)<=xr*Math.max(1,Math.abs(a),Math.abs(de))&&Math.abs(p-ve)<=xr*Math.max(1,Math.abs(p),Math.abs(ve))&&Math.abs(g-Fe)<=xr*Math.max(1,Math.abs(g),Math.abs(Fe))&&Math.abs(v-Re)<=xr*Math.max(1,Math.abs(v),Math.abs(Re))&&Math.abs(T-lt)<=xr*Math.max(1,Math.abs(T),Math.abs(lt))&&Math.abs(k-ht)<=xr*Math.max(1,Math.abs(k),Math.abs(ht))&&Math.abs(z-tt)<=xr*Math.max(1,Math.abs(z),Math.abs(tt))&&Math.abs(L-Ye)<=xr*Math.max(1,Math.abs(L),Math.abs(Ye))&&Math.abs(R-We)<=xr*Math.max(1,Math.abs(R),Math.abs(We))&&Math.abs(j-it)<=xr*Math.max(1,Math.abs(j),Math.abs(it))&&Math.abs(q-$e)<=xr*Math.max(1,Math.abs(q),Math.abs($e))&&Math.abs(Z-je)<=xr*Math.max(1,Math.abs(Z),Math.abs(je))&&Math.abs(re-vt)<=xr*Math.max(1,Math.abs(re),Math.abs(vt))&&Math.abs(ie-mt)<=xr*Math.max(1,Math.abs(ie),Math.abs(mt))&&Math.abs(me-Vt)<=xr*Math.max(1,Math.abs(me),Math.abs(Vt))},o.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:p}){return i.kind==="source"?a/Kn:i.kind==="composite"?xi(a/Kn,p/Kn,r):e},o.evaluateSizeForZoom=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:v}=i,T=p?A(Ir.interpolationFactor(p,e,g,v),0,1):0;i.kind==="camera"?a=xi(i.minSize,i.maxSize,T):r=T}return{uSizeT:r,uSize:a}},o.evaluateVariableOffset=Ph,o.evented=va,o.exported=ii,o.exported$1=gr,o.extend=U,o.filterObject=ae,o.fromRotation=function(i,e){var r=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=r,i[2]=0,i[3]=-r,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},o.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.getAnchorAlignment=eu,o.getAnchorJustification=iu,o.getArrayBuffer=rs,o.getImage=bn,o.getJSON=function(i,e){return is(U(i,{type:"json"}),e)},o.getOverlapMode=au,o.getRTLTextPluginStatus=Js,o.getReferrer=Is,o.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<i.length;a++){const p=window.document.createElement("source");Cs(i[a])||(r.crossOrigin="Anonymous"),p.src=i[a],r.appendChild(p)}return{cancel:()=>{}}},o.identity=Fc,o.invert=function(i,e){var r=e[0],a=e[1],p=e[2],g=e[3],v=e[4],T=e[5],k=e[6],z=e[7],L=e[8],R=e[9],j=e[10],q=e[11],Z=e[12],re=e[13],ie=e[14],me=e[15],ke=r*T-a*v,de=r*k-p*v,ve=r*z-g*v,Fe=a*k-p*T,Re=a*z-g*T,lt=p*z-g*k,ht=L*re-R*Z,tt=L*ie-j*Z,Ye=L*me-q*Z,We=R*ie-j*re,it=R*me-q*re,$e=j*me-q*ie,je=ke*$e-de*it+ve*We+Fe*Ye-Re*tt+lt*ht;return je?(i[0]=(T*$e-k*it+z*We)*(je=1/je),i[1]=(p*it-a*$e-g*We)*je,i[2]=(re*lt-ie*Re+me*Fe)*je,i[3]=(j*Re-R*lt-q*Fe)*je,i[4]=(k*Ye-v*$e-z*tt)*je,i[5]=(r*$e-p*Ye+g*tt)*je,i[6]=(ie*ve-Z*lt-me*de)*je,i[7]=(L*lt-j*ve+q*de)*je,i[8]=(v*it-T*Ye+z*ht)*je,i[9]=(a*Ye-r*it-g*ht)*je,i[10]=(Z*Re-re*ve+me*ke)*je,i[11]=(R*ve-L*Re-q*ke)*je,i[12]=(T*tt-v*We-k*ht)*je,i[13]=(r*We-a*tt+p*ht)*je,i[14]=(re*de-Z*Fe-ie*ke)*je,i[15]=(L*Fe-R*de+j*ke)*je,i):null},o.isImageBitmap=nr,o.isSafari=si,o.isWorker=Ue,o.keysDifference=function(i,e){const r=[];for(const a in i)a in e||r.push(a);return r},o.lazyLoadRTLTextPlugin=function(){Or.isLoading()||Or.isLoaded()||Js()!=="deferred"||Sl()},o.makeRequest=is,o.mapObject=pe,o.mercatorXfromLng=Vh,o.mercatorYfromLat=Uh,o.mercatorZfromAltitude=Nh,o.mul=jp,o.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},o.multiply=ju,o.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.normalize=function(i,e){var r=e[0],a=e[1],p=e[2],g=r*r+a*a+p*p;return g>0&&(g=1/Math.sqrt(g)),i[0]=e[0]*g,i[1]=e[1]*g,i[2]=e[2]*g,i},o.number=xi,o.ortho=function(i,e,r,a,p,g,v){var T=1/(e-r),k=1/(a-p),z=1/(g-v);return i[0]=-2*T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*k,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*z,i[11]=0,i[12]=(e+r)*T,i[13]=(p+a)*k,i[14]=(v+g)*z,i[15]=1,i},o.parseCacheControl=zt,o.parseGlyphPbf=function(i){return new Jc(i).readFields(jm,[])},o.pbf=Jc,o.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Oi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,a={layoutIconSize:r["icon-size"].possiblyEvaluate(new wi(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new wi(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new wi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:z}=i.bucket.textSizeData;a.compositeTextSizes=[r["text-size"].possiblyEvaluate(new wi(k),i.canonical),r["text-size"].possiblyEvaluate(new wi(z),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:z}=i.bucket.iconSizeData;a.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new wi(k),i.canonical),r["icon-size"].possiblyEvaluate(new wi(z),i.canonical)]}const p=e.get("text-line-height")*Qi,g=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",v=e.get("text-keep-upright"),T=e.get("text-size");for(const k of i.bucket.features){const z=e.get("text-font").evaluate(k,{},i.canonical).join(","),L=T.evaluate(k,{},i.canonical),R=a.layoutTextSize.evaluate(k,{},i.canonical),j=a.layoutIconSize.evaluate(k,{},i.canonical),q={horizontal:{},vertical:void 0},Z=k.text;let re,ie=[0,0];if(Z){const de=Z.toString(),ve=e.get("text-letter-spacing").evaluate(k,{},i.canonical)*Qi,Fe=Ac(de)?ve:0,Re=e.get("text-anchor").evaluate(k,{},i.canonical),lt=e.get("text-variable-anchor");if(!lt){const it=e.get("text-radial-offset").evaluate(k,{},i.canonical);ie=it?Ph(Re,[it*Qi,tu]):e.get("text-offset").evaluate(k,{},i.canonical).map($e=>$e*Qi)}let ht=g?"center":e.get("text-justify").evaluate(k,{},i.canonical);const tt=e.get("symbol-placement"),Ye=tt==="point"?e.get("text-max-width").evaluate(k,{},i.canonical)*Qi:0,We=()=>{i.bucket.allowVerticalPlacement&&Eo(de)&&(q.vertical=Gl(Z,i.glyphMap,i.glyphPositions,i.imagePositions,z,Ye,p,Re,"left",Fe,ie,o.WritingMode.vertical,!0,tt,R,L))};if(!g&&lt){const it=ht==="auto"?lt.map(je=>iu(je)):[ht];let $e=!1;for(let je=0;je<it.length;je++){const vt=it[je];if(!q.horizontal[vt])if($e)q.horizontal[vt]=q.horizontal[0];else{const mt=Gl(Z,i.glyphMap,i.glyphPositions,i.imagePositions,z,Ye,p,"center",vt,Fe,ie,o.WritingMode.horizontal,!1,tt,R,L);mt&&(q.horizontal[vt]=mt,$e=mt.positionedLines.length===1)}}We()}else{ht==="auto"&&(ht=iu(Re));const it=Gl(Z,i.glyphMap,i.glyphPositions,i.imagePositions,z,Ye,p,Re,ht,Fe,ie,o.WritingMode.horizontal,!1,tt,R,L);it&&(q.horizontal[ht]=it),We(),Eo(de)&&g&&v&&(q.vertical=Gl(Z,i.glyphMap,i.glyphPositions,i.imagePositions,z,Ye,p,Re,ht,Fe,ie,o.WritingMode.vertical,!1,tt,R,L))}}let me=!1;if(k.icon&&k.icon.name){const de=i.imageMap[k.icon.name];de&&(re=Wm(i.imagePositions[k.icon.name],e.get("icon-offset").evaluate(k,{},i.canonical),e.get("icon-anchor").evaluate(k,{},i.canonical)),me=!!de.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=me:i.bucket.sdfIcons!==me&&ze("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(de.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ke=Lh(q.horizontal)||q.vertical;i.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||re)&&tg(i.bucket,k,q,re,i.imageMap,a,R,j,ie,me,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.perspective=function(i,e,r,a,p){var g,v=1/Math.tan(e/2);return i[0]=v/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+a)*(g=1/(a-p)),i[14]=2*p*a*g):(i[10]=-1,i[14]=-2*a),i},o.pick=function(i,e){const r={};for(let a=0;a<e.length;a++){const p=e[a];p in i&&(r[p]=i[p])}return r},o.plugin=Or,o.pointGeometry=bt,o.polygonIntersectsPolygon=Fu,o.potpack=gh,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=ct,o.registerForPluginStateChange=function(i){return i({pluginStatus:yr,pluginURL:Sn}),va.on("pluginStateChange",i),i},o.renderColorRamp=Ku,o.rotateX=function(i,e,r){var a=Math.sin(r),p=Math.cos(r),g=e[4],v=e[5],T=e[6],k=e[7],z=e[8],L=e[9],R=e[10],j=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=g*p+z*a,i[5]=v*p+L*a,i[6]=T*p+R*a,i[7]=k*p+j*a,i[8]=z*p-g*a,i[9]=L*p-v*a,i[10]=R*p-T*a,i[11]=j*p-k*a,i},o.rotateZ=function(i,e,r){var a=Math.sin(r),p=Math.cos(r),g=e[0],v=e[1],T=e[2],k=e[3],z=e[4],L=e[5],R=e[6],j=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=g*p+z*a,i[1]=v*p+L*a,i[2]=T*p+R*a,i[3]=k*p+j*a,i[4]=z*p-g*a,i[5]=L*p-v*a,i[6]=R*p-T*a,i[7]=j*p-k*a,i},o.scale=function(i,e,r){var a=r[0],p=r[1],g=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*g,i[9]=e[9]*g,i[10]=e[10]*g,i[11]=e[11]*g,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},o.setCacheLimits=function(i,e){Ai=i,ur=e},o.setRTLTextPlugin=function(i,e,r=!1){if(yr===ma||yr===ga||yr===_a)throw new Error("setRTLTextPlugin cannot be called multiple times.");Sn=ii.resolveURL(i),yr=ma,ya=e,ys(),r||Sl()},o.spec=Le,o.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},o.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},o.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},o.toEvaluationFeature=to,o.transformMat3=function(i,e,r){var a=e[0],p=e[1],g=e[2];return i[0]=a*r[0]+p*r[3]+g*r[6],i[1]=a*r[1]+p*r[4]+g*r[7],i[2]=a*r[2]+p*r[5]+g*r[8],i},o.transformMat4=Bl,o.transformMat4$1=function(i,e,r){var a=e[0],p=e[1];return i[0]=r[0]*a+r[4]*p+r[12],i[1]=r[1]*a+r[5]*p+r[13],i},o.translate=function(i,e,r){var a,p,g,v,T,k,z,L,R,j,q,Z,re=r[0],ie=r[1],me=r[2];return e===i?(i[12]=e[0]*re+e[4]*ie+e[8]*me+e[12],i[13]=e[1]*re+e[5]*ie+e[9]*me+e[13],i[14]=e[2]*re+e[6]*ie+e[10]*me+e[14],i[15]=e[3]*re+e[7]*ie+e[11]*me+e[15]):(p=e[1],g=e[2],v=e[3],T=e[4],k=e[5],z=e[6],L=e[7],R=e[8],j=e[9],q=e[10],Z=e[11],i[0]=a=e[0],i[1]=p,i[2]=g,i[3]=v,i[4]=T,i[5]=k,i[6]=z,i[7]=L,i[8]=R,i[9]=j,i[10]=q,i[11]=Z,i[12]=a*re+T*ie+R*me+e[12],i[13]=p*re+k*ie+j*me+e[13],i[14]=g*re+z*ie+q*me+e[14],i[15]=v*re+L*ie+Z*me+e[15]),i},o.triggerPluginCompletionEvent=El,o.unicodeBlockLookup=et,o.uniqueId=function(){return F++},o.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateLight=ha,o.validateStyle=Ws,o.vectorTile=ws,o.warnOnce=ze,o.wrap=V}),_(["./shared"],function(o){function b(K){const D=typeof K;if(D==="number"||D==="boolean"||D==="string"||K==null)return JSON.stringify(K);if(Array.isArray(K)){let W="[";for(const ne of K)W+=`${b(ne)},`;return`${W}]`}const O=Object.keys(K).sort();let H="{";for(let W=0;W<O.length;W++)H+=`${JSON.stringify(O[W])}:${b(K[O[W]])},`;return`${H}}`}function E(K){let D="";for(const O of o.refProperties)D+=`/${b(K[O])}`;return D}class I{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,O){for(const W of D){this._layerConfigs[W.id]=W;const ne=this._layers[W.id]=o.createStyleLayer(W);ne._featureFilter=o.createFilter(ne.filter),this.keyCache[W.id]&&delete this.keyCache[W.id]}for(const W of O)delete this.keyCache[W],delete this._layerConfigs[W],delete this._layers[W];this.familiesBySource={};const H=function(W,ne){const ce={};for(let se=0;se<W.length;se++){const he=ne&&ne[W[se].id]||E(W[se]);ne&&(ne[W[se].id]=he);let Ce=ce[he];Ce||(Ce=ce[he]=[]),Ce.push(W[se])}const oe=[];for(const se in ce)oe.push(ce[se]);return oe}(Object.values(this._layerConfigs),this.keyCache);for(const W of H){const ne=W.map(Ve=>this._layers[Ve.id]),ce=ne[0];if(ce.visibility==="none")continue;const oe=ce.source||"";let se=this.familiesBySource[oe];se||(se=this.familiesBySource[oe]={});const he=ce.sourceLayer||"_geojsonTileLayer";let Ce=se[he];Ce||(Ce=se[he]=[]),Ce.push(ne)}}}class P{constructor(D){const O={},H=[];for(const oe in D){const se=D[oe],he=O[oe]={};for(const Ce in se){const Ve=se[+Ce];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const Ie={x:0,y:0,w:Ve.bitmap.width+2,h:Ve.bitmap.height+2};H.push(Ie),he[Ce]={rect:Ie,metrics:Ve.metrics}}}const{w:W,h:ne}=o.potpack(H),ce=new o.AlphaImage({width:W||1,height:ne||1});for(const oe in D){const se=D[oe];for(const he in se){const Ce=se[+he];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const Ve=O[oe][he].rect;o.AlphaImage.copy(Ce.bitmap,ce,{x:0,y:0},{x:Ve.x+1,y:Ve.y+1},Ce.bitmap)}}this.image=ce,this.positions=O}}o.register("GlyphAtlas",P);class A{constructor(D){this.tileID=new o.OverscaledTileID(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId}parse(D,O,H,W,ne){this.status="parsing",this.data=D,this.collisionBoxArray=new o.CollisionBoxArray;const ce=new o.DictionaryCoder(Object.keys(D.layers).sort()),oe=new o.FeatureIndex(this.tileID,this.promoteId);oe.bucketLayerIDs=[];const se={},he={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Ce=O.familiesBySource[this.source];for(const At in Ce){const Ft=D.layers[At];if(!Ft)continue;Ft.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${At}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wt=ce.encode(At),oi=[];for(let Gi=0;Gi<Ft.length;Gi++){const vi=Ft.feature(Gi),sr=oe.getId(vi,At);oi.push({feature:vi,id:sr,index:Gi,sourceLayerIndex:Wt})}for(const Gi of Ce[At]){const vi=Gi[0];vi.source!==this.source&&o.warnOnce(`layer.source = ${vi.source} does not equal this.source = ${this.source}`),vi.minzoom&&this.zoom<Math.floor(vi.minzoom)||vi.maxzoom&&this.zoom>=vi.maxzoom||vi.visibility!=="none"&&(V(Gi,this.zoom,H),(se[vi.id]=vi.createBucket({index:oe.bucketLayerIDs.length,layers:Gi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wt,sourceID:this.source})).populate(oi,he,this.tileID.canonical),oe.bucketLayerIDs.push(Gi.map(sr=>sr.id)))}}let Ve,Ie,ut,ft;const rt=o.mapObject(he.glyphDependencies,At=>Object.keys(At).map(Number));Object.keys(rt).length?W.send("getGlyphs",{uid:this.uid,stacks:rt},(At,Ft)=>{Ve||(Ve=At,Ie=Ft,Ht.call(this))}):Ie={};const wt=Object.keys(he.iconDependencies);wt.length?W.send("getImages",{icons:wt,source:this.source,tileID:this.tileID,type:"icons"},(At,Ft)=>{Ve||(Ve=At,ut=Ft,Ht.call(this))}):ut={};const It=Object.keys(he.patternDependencies);function Ht(){if(Ve)return ne(Ve);if(Ie&&ut&&ft){const At=new P(Ie),Ft=new o.ImageAtlas(ut,ft);for(const Wt in se){const oi=se[Wt];oi instanceof o.SymbolBucket?(V(oi.layers,this.zoom,H),o.performSymbolLayout({bucket:oi,glyphMap:Ie,glyphPositions:At.positions,imageMap:ut,imagePositions:Ft.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):oi.hasPattern&&(oi instanceof o.LineBucket||oi instanceof o.FillBucket||oi instanceof o.FillExtrusionBucket)&&(V(oi.layers,this.zoom,H),oi.addFeatures(he,this.tileID.canonical,Ft.patternPositions))}this.status="done",ne(null,{buckets:Object.values(se).filter(Wt=>!Wt.isEmpty()),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:At.image,imageAtlas:Ft,glyphMap:this.returnDependencies?Ie:null,iconMap:this.returnDependencies?ut:null,glyphPositions:this.returnDependencies?At.positions:null})}}It.length?W.send("getImages",{icons:It,source:this.source,tileID:this.tileID,type:"patterns"},(At,Ft)=>{Ve||(Ve=At,ft=Ft,Ht.call(this))}):ft={},Ht.call(this)}}function V(K,D,O){const H=new o.EvaluationParameters(D);for(const W of K)W.recalculate(H,O)}function U(K,D){const O=o.getArrayBuffer(K.request,(H,W,ne,ce)=>{H?D(H):W&&D(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(W)),rawData:W,cacheControl:ne,expires:ce})});return()=>{O.cancel(),D()}}class F{constructor(D,O,H,W){this.actor=D,this.layerIndex=O,this.availableImages=H,this.loadVectorData=W||U,this.loading={},this.loaded={}}loadTile(D,O){const H=D.uid;this.loading||(this.loading={});const W=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.RequestPerformance(D.request),ne=this.loading[H]=new A(D);ne.abort=this.loadVectorData(D,(ce,oe)=>{if(delete this.loading[H],ce||!oe)return ne.status="done",this.loaded[H]=ne,O(ce);const se=oe.rawData,he={};oe.expires&&(he.expires=oe.expires),oe.cacheControl&&(he.cacheControl=oe.cacheControl);const Ce={};if(W){const Ve=W.finish();Ve&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Ve)))}ne.vectorTile=oe.vectorTile,ne.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ve,Ie)=>{if(Ve||!Ie)return O(Ve);O(null,o.extend({rawTileData:se.slice(0)},Ie,he,Ce))}),this.loaded=this.loaded||{},this.loaded[H]=ne})}reloadTile(D,O){const H=this.loaded,W=D.uid,ne=this;if(H&&H[W]){const ce=H[W];ce.showCollisionBoxes=D.showCollisionBoxes;const oe=(se,he)=>{const Ce=ce.reloadCallback;Ce&&(delete ce.reloadCallback,ce.parse(ce.vectorTile,ne.layerIndex,this.availableImages,ne.actor,Ce)),O(se,he)};ce.status==="parsing"?ce.reloadCallback=oe:ce.status==="done"&&(ce.vectorTile?ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,oe):oe())}}abortTile(D,O){const H=this.loading,W=D.uid;H&&H[W]&&H[W].abort&&(H[W].abort(),delete H[W]),O()}removeTile(D,O){const H=this.loaded,W=D.uid;H&&H[W]&&delete H[W],O()}}class Q{constructor(){this.loaded={}}loadTile(D,O){const{uid:H,encoding:W,rawImageData:ne}=D,ce=o.isImageBitmap(ne)?this.getImageData(ne):ne,oe=new o.DEMData(H,ce,W);this.loaded=this.loaded||{},this.loaded[H]=oe,O(null,oe)}getImageData(D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const O=this.offscreenCanvasContext.getImageData(-1,-1,D.width+2,D.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:O.width,height:O.height},O.data)}removeTile(D){const O=this.loaded,H=D.uid;O&&O[H]&&delete O[H]}}var pe=function K(D,O){var H,W=D&&D.type;if(W==="FeatureCollection")for(H=0;H<D.features.length;H++)K(D.features[H],O);else if(W==="GeometryCollection")for(H=0;H<D.geometries.length;H++)K(D.geometries[H],O);else if(W==="Feature")K(D.geometry,O);else if(W==="Polygon")ae(D.coordinates,O);else if(W==="MultiPolygon")for(H=0;H<D.coordinates.length;H++)ae(D.coordinates[H],O);return D};function ae(K,D){if(K.length!==0){Se(K[0],D);for(var O=1;O<K.length;O++)Se(K[O],!D)}}function Se(K,D){for(var O=0,H=0,W=0,ne=K.length,ce=ne-1;W<ne;ce=W++){var oe=(K[W][0]-K[ce][0])*(K[ce][1]+K[W][1]),se=O+oe;H+=Math.abs(O)>=Math.abs(oe)?O-se+oe:oe-se+O,O=se}O+H>=0!=!!D&&K.reverse()}const Ge=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ze{constructor(D){this._feature=D,this.extent=o.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){const D=[];for(const O of this._feature.geometry)D.push([new o.pointGeometry(O[0],O[1])]);return D}{const D=[];for(const O of this._feature.geometry){const H=[];for(const W of O)H.push(new o.pointGeometry(W[0],W[1]));D.push(H)}return D}}toGeoJSON(D,O,H){return Ge.call(this,D,O,H)}}class Oe{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=D.length,this._features=D}feature(D){return new ze(this._features[D])}}var Me={exports:{}},Ue=o.pointGeometry,zt=o.vectorTile.VectorTileFeature,dt=yi;function yi(K,D){this.options=D||{},this.features=K,this.length=K.length}function _t(K,D){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=D||4096}yi.prototype.feature=function(K){return new _t(this.features[K],this.options.extent)},_t.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var D=0;D<K.length;D++){for(var O=K[D],H=[],W=0;W<O.length;W++)H.push(new Ue(O[W][0],O[W][1]));this.geometry.push(H)}return this.geometry},_t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,D=1/0,O=-1/0,H=1/0,W=-1/0,ne=0;ne<K.length;ne++)for(var ce=K[ne],oe=0;oe<ce.length;oe++){var se=ce[oe];D=Math.min(D,se.x),O=Math.max(O,se.x),H=Math.min(H,se.y),W=Math.max(W,se.y)}return[D,H,O,W]},_t.prototype.toGeoJSON=zt.prototype.toGeoJSON;var si=o.pbf,nr=dt;function ii(K){var D=new si;return function(O,H){for(var W in O.layers)H.writeMessage(3,bt,O.layers[W])}(K,D),D.finish()}function bt(K,D){var O;D.writeVarintField(15,K.version||1),D.writeStringField(1,K.name||""),D.writeVarintField(5,K.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<K.length;O++)H.feature=K.feature(O),D.writeMessage(2,mr,H);var W=H.keys;for(O=0;O<W.length;O++)D.writeStringField(3,W[O]);var ne=H.values;for(O=0;O<ne.length;O++)D.writeMessage(4,Ai,ne[O])}function mr(K,D){var O=K.feature;O.id!==void 0&&D.writeVarintField(1,O.id),D.writeMessage(2,Si,K),D.writeVarintField(3,O.type),D.writeMessage(4,Mi,O)}function Si(K,D){var O=K.feature,H=K.keys,W=K.values,ne=K.keycache,ce=K.valuecache;for(var oe in O.properties){var se=O.properties[oe],he=ne[oe];if(se!==null){he===void 0&&(H.push(oe),ne[oe]=he=H.length-1),D.writeVarint(he);var Ce=typeof se;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(se=JSON.stringify(se));var Ve=Ce+":"+se,Ie=ce[Ve];Ie===void 0&&(W.push(se),ce[Ve]=Ie=W.length-1),D.writeVarint(Ie)}}}function Lt(K,D){return(D<<3)+(7&K)}function Ri(K){return K<<1^K>>31}function Mi(K,D){for(var O=K.loadGeometry(),H=K.type,W=0,ne=0,ce=O.length,oe=0;oe<ce;oe++){var se=O[oe],he=1;H===1&&(he=se.length),D.writeVarint(Lt(1,he));for(var Ce=H===3?se.length-1:se.length,Ve=0;Ve<Ce;Ve++){Ve===1&&H!==1&&D.writeVarint(Lt(2,Ce-1));var Ie=se[Ve].x-W,ut=se[Ve].y-ne;D.writeVarint(Ri(Ie)),D.writeVarint(Ri(ut)),W+=Ie,ne+=ut}H===3&&D.writeVarint(Lt(7,1))}}function Ai(K,D){var O=typeof K;O==="string"?D.writeStringField(1,K):O==="boolean"?D.writeBooleanField(7,K):O==="number"&&(K%1!=0?D.writeDoubleField(3,K):K<0?D.writeSVarintField(6,K):D.writeVarintField(5,K))}function ur(K,D,O,H,W,ne){if(W-H<=O)return;const ce=H+W>>1;Ui(K,D,ce,H,W,ne%2),ur(K,D,O,H,ce-1,ne+1),ur(K,D,O,ce+1,W,ne+1)}function Ui(K,D,O,H,W,ne){for(;W>H;){if(W-H>600){const he=W-H+1,Ce=O-H+1,Ve=Math.log(he),Ie=.5*Math.exp(2*Ve/3),ut=.5*Math.sqrt(Ve*Ie*(he-Ie)/he)*(Ce-he/2<0?-1:1);Ui(K,D,O,Math.max(H,Math.floor(O-Ce*Ie/he+ut)),Math.min(W,Math.floor(O+(he-Ce)*Ie/he+ut)),ne)}const ce=D[2*O+ne];let oe=H,se=W;for(Ki(K,D,H,O),D[2*W+ne]>ce&&Ki(K,D,H,W);oe<se;){for(Ki(K,D,oe,se),oe++,se--;D[2*oe+ne]<ce;)oe++;for(;D[2*se+ne]>ce;)se--}D[2*H+ne]===ce?Ki(K,D,H,se):(se++,Ki(K,D,se,W)),se<=O&&(H=se+1),O<=se&&(W=se-1)}}function Ki(K,D,O,H){gr(K,O,H),gr(D,2*O,2*H),gr(D,2*O+1,2*H+1)}function gr(K,D,O){const H=K[D];K[D]=K[O],K[O]=H}function _r(K,D,O,H){const W=K-O,ne=D-H;return W*W+ne*ne}Me.exports=ii,Me.exports.fromVectorTileJs=ii,Me.exports.fromGeojsonVt=function(K,D){D=D||{};var O={};for(var H in K)O[H]=new nr(K[H].features,D),O[H].name=H,O[H].version=D.version,O[H].extent=D.extent;return ii({layers:O})},Me.exports.GeoJSONWrapper=nr;const Tr=K=>K[0],Xe=K=>K[1];class pi{constructor(D,O=Tr,H=Xe,W=64,ne=Float64Array){this.nodeSize=W,this.points=D;const ce=D.length<65536?Uint16Array:Uint32Array,oe=this.ids=new ce(D.length),se=this.coords=new ne(2*D.length);for(let he=0;he<D.length;he++)oe[he]=he,se[2*he]=O(D[he]),se[2*he+1]=H(D[he]);ur(oe,se,W,0,oe.length-1,0)}range(D,O,H,W){return function(ne,ce,oe,se,he,Ce,Ve){const Ie=[0,ne.length-1,0],ut=[];let ft,rt;for(;Ie.length;){const wt=Ie.pop(),It=Ie.pop(),Ht=Ie.pop();if(It-Ht<=Ve){for(let Wt=Ht;Wt<=It;Wt++)ft=ce[2*Wt],rt=ce[2*Wt+1],ft>=oe&&ft<=he&&rt>=se&&rt<=Ce&&ut.push(ne[Wt]);continue}const At=Math.floor((Ht+It)/2);ft=ce[2*At],rt=ce[2*At+1],ft>=oe&&ft<=he&&rt>=se&&rt<=Ce&&ut.push(ne[At]);const Ft=(wt+1)%2;(wt===0?oe<=ft:se<=rt)&&(Ie.push(Ht),Ie.push(At-1),Ie.push(Ft)),(wt===0?he>=ft:Ce>=rt)&&(Ie.push(At+1),Ie.push(It),Ie.push(Ft))}return ut}(this.ids,this.coords,D,O,H,W,this.nodeSize)}within(D,O,H){return function(W,ne,ce,oe,se,he){const Ce=[0,W.length-1,0],Ve=[],Ie=se*se;for(;Ce.length;){const ut=Ce.pop(),ft=Ce.pop(),rt=Ce.pop();if(ft-rt<=he){for(let Ft=rt;Ft<=ft;Ft++)_r(ne[2*Ft],ne[2*Ft+1],ce,oe)<=Ie&&Ve.push(W[Ft]);continue}const wt=Math.floor((rt+ft)/2),It=ne[2*wt],Ht=ne[2*wt+1];_r(It,Ht,ce,oe)<=Ie&&Ve.push(W[wt]);const At=(ut+1)%2;(ut===0?ce-se<=It:oe-se<=Ht)&&(Ce.push(rt),Ce.push(wt-1),Ce.push(At)),(ut===0?ce+se>=It:oe+se>=Ht)&&(Ce.push(wt+1),Ce.push(ft),Ce.push(At))}return Ve}(this.ids,this.coords,D,O,H,this.nodeSize)}}const Ni={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Rr=Math.fround||(kr=new Float32Array(1),K=>(kr[0]=+K,kr[0]));var kr;class Is{constructor(D){this.options=bn(Object.create(Ni),D),this.trees=new Array(this.options.maxZoom+1)}load(D){const{log:O,minZoom:H,maxZoom:W,nodeSize:ne}=this.options;O&&console.time("total time");const ce=`prepare ${D.length} points`;O&&console.time(ce),this.points=D;let oe=[];for(let se=0;se<D.length;se++)D[se].geometry&&oe.push(is(D[se],se));this.trees[W+1]=new pi(oe,As,on,ne,Float32Array),O&&console.timeEnd(ce);for(let se=W;se>=H;se--){const he=+Date.now();oe=this._cluster(oe,se),this.trees[se]=new pi(oe,As,on,ne,Float32Array),O&&console.log("z%d: %d clusters in %dms",se,oe.length,+Date.now()-he)}return O&&console.timeEnd("total time"),this}getClusters(D,O){let H=((D[0]+180)%360+360)%360-180;const W=Math.max(-90,Math.min(90,D[1]));let ne=D[2]===180?180:((D[2]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)H=-180,ne=180;else if(H>ne){const Ce=this.getClusters([H,W,180,ce],O),Ve=this.getClusters([-180,W,ne,ce],O);return Ce.concat(Ve)}const oe=this.trees[this._limitZoom(O)],se=oe.range(Zt(H),Yr(ce),Zt(ne),Yr(W)),he=[];for(const Ce of se){const Ve=oe.points[Ce];he.push(Ve.numPoints?rs(Ve):this.points[Ve.index])}return he}getChildren(D){const O=this._getOriginId(D),H=this._getOriginZoom(D),W="No cluster with the specified id.",ne=this.trees[H];if(!ne)throw new Error(W);const ce=ne.points[O];if(!ce)throw new Error(W);const oe=this.options.radius/(this.options.extent*Math.pow(2,H-1)),se=ne.within(ce.x,ce.y,oe),he=[];for(const Ce of se){const Ve=ne.points[Ce];Ve.parentId===D&&he.push(Ve.numPoints?rs(Ve):this.points[Ve.index])}if(he.length===0)throw new Error(W);return he}getLeaves(D,O,H){const W=[];return this._appendLeaves(W,D,O=O||10,H=H||0,0),W}getTile(D,O,H){const W=this.trees[this._limitZoom(D)],ne=Math.pow(2,D),{extent:ce,radius:oe}=this.options,se=oe/ce,he=(H-se)/ne,Ce=(H+1+se)/ne,Ve={features:[]};return this._addTileFeatures(W.range((O-se)/ne,he,(O+1+se)/ne,Ce),W.points,O,H,ne,Ve),O===0&&this._addTileFeatures(W.range(1-se/ne,he,1,Ce),W.points,ne,H,ne,Ve),O===ne-1&&this._addTileFeatures(W.range(0,he,se/ne,Ce),W.points,-1,H,ne,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(D){let O=this._getOriginZoom(D)-1;for(;O<=this.options.maxZoom;){const H=this.getChildren(D);if(O++,H.length!==1)break;D=H[0].properties.cluster_id}return O}_appendLeaves(D,O,H,W,ne){const ce=this.getChildren(O);for(const oe of ce){const se=oe.properties;if(se&&se.cluster?ne+se.point_count<=W?ne+=se.point_count:ne=this._appendLeaves(D,se.cluster_id,H,W,ne):ne<W?ne++:D.push(oe),D.length===H)break}return ne}_addTileFeatures(D,O,H,W,ne,ce){for(const oe of D){const se=O[oe],he=se.numPoints;let Ce,Ve,Ie;if(he)Ce=Cs(se),Ve=se.x,Ie=se.y;else{const rt=this.points[se.index];Ce=rt.properties,Ve=Zt(rt.geometry.coordinates[0]),Ie=Yr(rt.geometry.coordinates[1])}const ut={type:1,geometry:[[Math.round(this.options.extent*(Ve*ne-H)),Math.round(this.options.extent*(Ie*ne-W))]],tags:Ce};let ft;he?ft=se.id:this.options.generateId?ft=se.index:this.points[se.index].id&&(ft=this.points[se.index].id),ft!==void 0&&(ut.id=ft),ce.features.push(ut)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,O){const H=[],{radius:W,extent:ne,reduce:ce,minPoints:oe}=this.options,se=W/(ne*Math.pow(2,O));for(let he=0;he<D.length;he++){const Ce=D[he];if(Ce.zoom<=O)continue;Ce.zoom=O;const Ve=this.trees[O+1],Ie=Ve.within(Ce.x,Ce.y,se),ut=Ce.numPoints||1;let ft=ut;for(const rt of Ie){const wt=Ve.points[rt];wt.zoom>O&&(ft+=wt.numPoints||1)}if(ft>ut&&ft>=oe){let rt=Ce.x*ut,wt=Ce.y*ut,It=ce&&ut>1?this._map(Ce,!0):null;const Ht=(he<<5)+(O+1)+this.points.length;for(const At of Ie){const Ft=Ve.points[At];if(Ft.zoom<=O)continue;Ft.zoom=O;const Wt=Ft.numPoints||1;rt+=Ft.x*Wt,wt+=Ft.y*Wt,Ft.parentId=Ht,ce&&(It||(It=this._map(Ce,!0)),ce(It,this._map(Ft)))}Ce.parentId=Ht,H.push(vn(rt/ft,wt/ft,Ht,ft,It))}else if(H.push(Ce),ft>1)for(const rt of Ie){const wt=Ve.points[rt];wt.zoom<=O||(wt.zoom=O,H.push(wt))}}return H}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,O){if(D.numPoints)return O?bn({},D.properties):D.properties;const H=this.points[D.index].properties,W=this.options.map(H);return O&&W===H?bn({},W):W}}function vn(K,D,O,H,W){return{x:Rr(K),y:Rr(D),zoom:1/0,id:O,parentId:-1,numPoints:H,properties:W}}function is(K,D){const[O,H]=K.geometry.coordinates;return{x:Rr(Zt(O)),y:Rr(Yr(H)),zoom:1/0,index:D,parentId:-1}}function rs(K){return{type:"Feature",id:K.id,properties:Cs(K),geometry:{type:"Point",coordinates:[(D=K.x,360*(D-.5)),xn(K.y)]}};var D}function Cs(K){const D=K.numPoints,O=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return bn(bn({},K.properties),{cluster:!0,cluster_id:K.id,point_count:D,point_count_abbreviated:O})}function Zt(K){return K/360+.5}function Yr(K){const D=Math.sin(K*Math.PI/180),O=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return O<0?0:O>1?1:O}function xn(K){const D=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function bn(K,D){for(const O in D)K[O]=D[O];return K}function As(K){return K.x}function on(K){return K.y}function an(K,D,O,H){for(var W,ne=H,ce=O-D>>1,oe=O-D,se=K[D],he=K[D+1],Ce=K[O],Ve=K[O+1],Ie=D+3;Ie<O;Ie+=3){var ut=ns(K[Ie],K[Ie+1],se,he,Ce,Ve);if(ut>ne)W=Ie,ne=ut;else if(ut===ne){var ft=Math.abs(Ie-ce);ft<oe&&(W=Ie,oe=ft)}}ne>H&&(W-D>3&&an(K,D,W,H),K[W+2]=ne,O-W>3&&an(K,W,O,H))}function ns(K,D,O,H,W,ne){var ce=W-O,oe=ne-H;if(ce!==0||oe!==0){var se=((K-O)*ce+(D-H)*oe)/(ce*ce+oe*oe);se>1?(O=W,H=ne):se>0&&(O+=ce*se,H+=oe*se)}return(ce=K-O)*ce+(oe=D-H)*oe}function ln(K,D,O,H){var W={id:K===void 0?null:K,type:D,geometry:O,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ne){var ce=ne.geometry,oe=ne.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Le(ne,ce);else if(oe==="Polygon"||oe==="MultiLineString")for(var se=0;se<ce.length;se++)Le(ne,ce[se]);else if(oe==="MultiPolygon")for(se=0;se<ce.length;se++)for(var he=0;he<ce[se].length;he++)Le(ne,ce[se][he])}(W),W}function Le(K,D){for(var O=0;O<D.length;O+=3)K.minX=Math.min(K.minX,D[O]),K.minY=Math.min(K.minY,D[O+1]),K.maxX=Math.max(K.maxX,D[O]),K.maxY=Math.max(K.maxY,D[O+1])}function Qe(K,D,O,H){if(D.geometry){var W=D.geometry.coordinates,ne=D.geometry.type,ce=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),oe=[],se=D.id;if(O.promoteId?se=D.properties[O.promoteId]:O.generateId&&(se=H||0),ne==="Point")Bn(W,oe);else if(ne==="MultiPoint")for(var he=0;he<W.length;he++)Bn(W[he],oe);else if(ne==="LineString")jr(W,oe,ce,!1);else if(ne==="MultiLineString"){if(O.lineMetrics){for(he=0;he<W.length;he++)jr(W[he],oe=[],ce,!1),K.push(ln(se,"LineString",oe,D.properties));return}Xt(W,oe,ce,!1)}else if(ne==="Polygon")Xt(W,oe,ce,!0);else{if(ne!=="MultiPolygon"){if(ne==="GeometryCollection"){for(he=0;he<D.geometry.geometries.length;he++)Qe(K,{id:se,geometry:D.geometry.geometries[he],properties:D.properties},O,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(he=0;he<W.length;he++){var Ce=[];Xt(W[he],Ce,ce,!0),oe.push(Ce)}}K.push(ln(se,ne,oe,D.properties))}}function Bn(K,D){D.push(Fr(K[0])),D.push(Er(K[1])),D.push(0)}function jr(K,D,O,H){for(var W,ne,ce=0,oe=0;oe<K.length;oe++){var se=Fr(K[oe][0]),he=Er(K[oe][1]);D.push(se),D.push(he),D.push(0),oe>0&&(ce+=H?(W*he-se*ne)/2:Math.sqrt(Math.pow(se-W,2)+Math.pow(he-ne,2))),W=se,ne=he}var Ce=D.length-3;D[2]=1,an(D,0,Ce,O),D[Ce+2]=1,D.size=Math.abs(ce),D.start=0,D.end=D.size}function Xt(K,D,O,H){for(var W=0;W<K.length;W++){var ne=[];jr(K[W],ne,O,H),D.push(ne)}}function Fr(K){return K/360+.5}function Er(K){var D=Math.sin(K*Math.PI/180),O=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return O<0?0:O>1?1:O}function Sr(K,D,O,H,W,ne,ce,oe){if(H/=D,ne>=(O/=D)&&ce<H)return K;if(ce<O||ne>=H)return null;for(var se=[],he=0;he<K.length;he++){var Ce=K[he],Ve=Ce.geometry,Ie=Ce.type,ut=W===0?Ce.minX:Ce.minY,ft=W===0?Ce.maxX:Ce.maxY;if(ut>=O&&ft<H)se.push(Ce);else if(!(ft<O||ut>=H)){var rt=[];if(Ie==="Point"||Ie==="MultiPoint")wn(Ve,rt,O,H,W);else if(Ie==="LineString")Ke(Ve,rt,O,H,W,!1,oe.lineMetrics);else if(Ie==="MultiLineString")Pt(Ve,rt,O,H,W,!1);else if(Ie==="Polygon")Pt(Ve,rt,O,H,W,!0);else if(Ie==="MultiPolygon")for(var wt=0;wt<Ve.length;wt++){var It=[];Pt(Ve[wt],It,O,H,W,!0),It.length&&rt.push(It)}if(rt.length){if(oe.lineMetrics&&Ie==="LineString"){for(wt=0;wt<rt.length;wt++)se.push(ln(Ce.id,Ie,rt[wt],Ce.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(rt.length===1?(Ie="LineString",rt=rt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=rt.length===3?"Point":"MultiPoint"),se.push(ln(Ce.id,Ie,rt,Ce.tags))}}}return se.length?se:null}function wn(K,D,O,H,W){for(var ne=0;ne<K.length;ne+=3){var ce=K[ne+W];ce>=O&&ce<=H&&(D.push(K[ne]),D.push(K[ne+1]),D.push(K[ne+2]))}}function Ke(K,D,O,H,W,ne,ce){for(var oe,se,he=Rt(K),Ce=W===0?Tn:Mt,Ve=K.start,Ie=0;Ie<K.length-3;Ie+=3){var ut=K[Ie],ft=K[Ie+1],rt=K[Ie+2],wt=K[Ie+3],It=K[Ie+4],Ht=W===0?ut:ft,At=W===0?wt:It,Ft=!1;ce&&(oe=Math.sqrt(Math.pow(ut-wt,2)+Math.pow(ft-It,2))),Ht<O?At>O&&(se=Ce(he,ut,ft,wt,It,O),ce&&(he.start=Ve+oe*se)):Ht>H?At<H&&(se=Ce(he,ut,ft,wt,It,H),ce&&(he.start=Ve+oe*se)):Ji(he,ut,ft,rt),At<O&&Ht>=O&&(se=Ce(he,ut,ft,wt,It,O),Ft=!0),At>H&&Ht<=H&&(se=Ce(he,ut,ft,wt,It,H),Ft=!0),!ne&&Ft&&(ce&&(he.end=Ve+oe*se),D.push(he),he=Rt(K)),ce&&(Ve+=oe)}var Wt=K.length-3;ut=K[Wt],ft=K[Wt+1],rt=K[Wt+2],(Ht=W===0?ut:ft)>=O&&Ht<=H&&Ji(he,ut,ft,rt),Wt=he.length-3,ne&&Wt>=3&&(he[Wt]!==he[0]||he[Wt+1]!==he[1])&&Ji(he,he[0],he[1],he[2]),he.length&&D.push(he)}function Rt(K){var D=[];return D.size=K.size,D.start=K.start,D.end=K.end,D}function Pt(K,D,O,H,W,ne){for(var ce=0;ce<K.length;ce++)Ke(K[ce],D,O,H,W,ne,!1)}function Ji(K,D,O,H){K.push(D),K.push(O),K.push(H)}function Tn(K,D,O,H,W,ne){var ce=(ne-D)/(H-D);return K.push(ne),K.push(O+(W-O)*ce),K.push(1),ce}function Mt(K,D,O,H,W,ne){var ce=(ne-O)/(W-O);return K.push(D+(H-D)*ce),K.push(ne),K.push(1),ce}function cn(K,D){for(var O=[],H=0;H<K.length;H++){var W,ne=K[H],ce=ne.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")W=ji(ne.geometry,D);else if(ce==="MultiLineString"||ce==="Polygon"){W=[];for(var oe=0;oe<ne.geometry.length;oe++)W.push(ji(ne.geometry[oe],D))}else if(ce==="MultiPolygon")for(W=[],oe=0;oe<ne.geometry.length;oe++){for(var se=[],he=0;he<ne.geometry[oe].length;he++)se.push(ji(ne.geometry[oe][he],D));W.push(se)}O.push(ln(ne.id,ce,W,ne.tags))}return O}function ji(K,D){var O=[];O.size=K.size,K.start!==void 0&&(O.start=K.start,O.end=K.end);for(var H=0;H<K.length;H+=3)O.push(K[H]+D,K[H+1],K[H+2]);return O}function ss(K,D){if(K.transformed)return K;var O,H,W,ne=1<<K.z,ce=K.x,oe=K.y;for(O=0;O<K.features.length;O++){var se=K.features[O],he=se.geometry,Ce=se.type;if(se.geometry=[],Ce===1)for(H=0;H<he.length;H+=2)se.geometry.push(Pi(he[H],he[H+1],D,ne,ce,oe));else for(H=0;H<he.length;H++){var Ve=[];for(W=0;W<he[H].length;W+=2)Ve.push(Pi(he[H][W],he[H][W+1],D,ne,ce,oe));se.geometry.push(Ve)}}return K.transformed=!0,K}function Pi(K,D,O,H,W,ne){return[Math.round(O*(K*H-W)),Math.round(O*(D*H-ne))]}function hr(K,D,O,H,W){for(var ne=D===W.maxZoom?0:W.tolerance/((1<<D)*W.extent),ce={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:H,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<K.length;oe++){ce.numFeatures++,ri(ce,K[oe],ne,W);var se=K[oe].minX,he=K[oe].minY,Ce=K[oe].maxX,Ve=K[oe].maxY;se<ce.minX&&(ce.minX=se),he<ce.minY&&(ce.minY=he),Ce>ce.maxX&&(ce.maxX=Ce),Ve>ce.maxY&&(ce.maxY=Ve)}return ce}function ri(K,D,O,H){var W=D.geometry,ne=D.type,ce=[];if(ne==="Point"||ne==="MultiPoint")for(var oe=0;oe<W.length;oe+=3)ce.push(W[oe]),ce.push(W[oe+1]),K.numPoints++,K.numSimplified++;else if(ne==="LineString")os(ce,W,K,O,!1,!1);else if(ne==="MultiLineString"||ne==="Polygon")for(oe=0;oe<W.length;oe++)os(ce,W[oe],K,O,ne==="Polygon",oe===0);else if(ne==="MultiPolygon")for(var se=0;se<W.length;se++){var he=W[se];for(oe=0;oe<he.length;oe++)os(ce,he[oe],K,O,!0,oe===0)}if(ce.length){var Ce=D.tags||null;if(ne==="LineString"&&H.lineMetrics){for(var Ve in Ce={},D.tags)Ce[Ve]=D.tags[Ve];Ce.mapbox_clip_start=W.start/W.size,Ce.mapbox_clip_end=W.end/W.size}var Ie={geometry:ce,type:ne==="Polygon"||ne==="MultiPolygon"?3:ne==="LineString"||ne==="MultiLineString"?2:1,tags:Ce};D.id!==null&&(Ie.id=D.id),K.features.push(Ie)}}function os(K,D,O,H,W,ne){var ce=H*H;if(H>0&&D.size<(W?ce:H))O.numPoints+=D.length/3;else{for(var oe=[],se=0;se<D.length;se+=3)(H===0||D[se+2]>ce)&&(O.numSimplified++,oe.push(D[se]),oe.push(D[se+1])),O.numPoints++;W&&function(he,Ce){for(var Ve=0,Ie=0,ut=he.length,ft=ut-2;Ie<ut;ft=Ie,Ie+=2)Ve+=(he[Ie]-he[ft])*(he[Ie+1]+he[ft+1]);if(Ve>0===Ce)for(Ie=0,ut=he.length;Ie<ut/2;Ie+=2){var rt=he[Ie],wt=he[Ie+1];he[Ie]=he[ut-2-Ie],he[Ie+1]=he[ut-1-Ie],he[ut-2-Ie]=rt,he[ut-1-Ie]=wt}}(oe,ne),K.push(oe)}}function Qr(K,D){var O=(D=this.options=function(W,ne){for(var ce in ne)W[ce]=ne[ce];return W}(Object.create(this.options),D)).debug;if(O&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(W,ne){var ce=[];if(W.type==="FeatureCollection")for(var oe=0;oe<W.features.length;oe++)Qe(ce,W.features[oe],ne,oe);else Qe(ce,W.type==="Feature"?W:{geometry:W},ne);return ce}(K,D);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(W,ne){var ce=ne.buffer/ne.extent,oe=W,se=Sr(W,1,-1-ce,ce,0,-1,2,ne),he=Sr(W,1,1-ce,2+ce,0,-1,2,ne);return(se||he)&&(oe=Sr(W,1,-ce,1+ce,0,-1,2,ne)||[],se&&(oe=cn(se,1).concat(oe)),he&&(oe=oe.concat(cn(he,-1)))),oe}(H,D),H.length&&this.splitTile(H,0,0,0),O&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Rn(K,D,O){return 32*((1<<K)*O+D)+K}function Fn(K,D){const O=K.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const H=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!H)return D(null,null);const W=new Oe(H.features);let ne=Me.exports(W);ne.byteOffset===0&&ne.byteLength===ne.buffer.byteLength||(ne=new Uint8Array(ne)),D(null,{vectorTile:W,rawData:ne.buffer})}Qr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qr.prototype.splitTile=function(K,D,O,H,W,ne,ce){for(var oe=[K,D,O,H],se=this.options,he=se.debug;oe.length;){H=oe.pop(),O=oe.pop(),D=oe.pop(),K=oe.pop();var Ce=1<<D,Ve=Rn(D,O,H),Ie=this.tiles[Ve];if(!Ie&&(he>1&&console.time("creation"),Ie=this.tiles[Ve]=hr(K,D,O,H,se),this.tileCoords.push({z:D,x:O,y:H}),he)){he>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,O,H,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var ut="z"+D;this.stats[ut]=(this.stats[ut]||0)+1,this.total++}if(Ie.source=K,W){if(D===se.maxZoom||D===W)continue;var ft=1<<W-D;if(O!==Math.floor(ne/ft)||H!==Math.floor(ce/ft))continue}else if(D===se.indexMaxZoom||Ie.numPoints<=se.indexMaxPoints)continue;if(Ie.source=null,K.length!==0){he>1&&console.time("clipping");var rt,wt,It,Ht,At,Ft,Wt=.5*se.buffer/se.extent,oi=.5-Wt,Gi=.5+Wt,vi=1+Wt;rt=wt=It=Ht=null,At=Sr(K,Ce,O-Wt,O+Gi,0,Ie.minX,Ie.maxX,se),Ft=Sr(K,Ce,O+oi,O+vi,0,Ie.minX,Ie.maxX,se),K=null,At&&(rt=Sr(At,Ce,H-Wt,H+Gi,1,Ie.minY,Ie.maxY,se),wt=Sr(At,Ce,H+oi,H+vi,1,Ie.minY,Ie.maxY,se),At=null),Ft&&(It=Sr(Ft,Ce,H-Wt,H+Gi,1,Ie.minY,Ie.maxY,se),Ht=Sr(Ft,Ce,H+oi,H+vi,1,Ie.minY,Ie.maxY,se),Ft=null),he>1&&console.timeEnd("clipping"),oe.push(rt||[],D+1,2*O,2*H),oe.push(wt||[],D+1,2*O,2*H+1),oe.push(It||[],D+1,2*O+1,2*H),oe.push(Ht||[],D+1,2*O+1,2*H+1)}}},Qr.prototype.getTile=function(K,D,O){var H=this.options,W=H.extent,ne=H.debug;if(K<0||K>24)return null;var ce=1<<K,oe=Rn(K,D=(D%ce+ce)%ce,O);if(this.tiles[oe])return ss(this.tiles[oe],W);ne>1&&console.log("drilling down to z%d-%d-%d",K,D,O);for(var se,he=K,Ce=D,Ve=O;!se&&he>0;)he--,Ce=Math.floor(Ce/2),Ve=Math.floor(Ve/2),se=this.tiles[Rn(he,Ce,Ve)];return se&&se.source?(ne>1&&console.log("found parent tile z%d-%d-%d",he,Ce,Ve),ne>1&&console.time("drilling down"),this.splitTile(se.source,he,Ce,Ve,K,D,O),ne>1&&console.timeEnd("drilling down"),this.tiles[oe]?ss(this.tiles[oe],W):null):null};class as extends F{constructor(D,O,H,W){super(D,O,H,Fn),W&&(this.loadGeoJSON=W)}loadData(D,O){var H;(H=this._pendingRequest)===null||H===void 0||H.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const W=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.RequestPerformance(D.request);this._pendingCallback=O,this._pendingRequest=this.loadGeoJSON(D,(ne,ce)=>{if(delete this._pendingCallback,delete this._pendingRequest,ne||!ce)return O(ne);if(typeof ce!="object")return O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{pe(ce,!0);try{if(D.filter){const se=o.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(Ce=>se.value.evaluate({zoom:0},Ce))}}this._geoJSONIndex=D.cluster?new Is(function({superclusterOptions:se,clusterProperties:he}){if(!he||!se)return se;const Ce={},Ve={},Ie={accumulated:null,zoom:0},ut={properties:null},ft=Object.keys(he);for(const rt of ft){const[wt,It]=he[rt],Ht=o.createExpression(It),At=o.createExpression(typeof wt=="string"?[wt,["accumulated"],["get",rt]]:wt);Ce[rt]=Ht.value,Ve[rt]=At.value}return se.map=rt=>{ut.properties=rt;const wt={};for(const It of ft)wt[It]=Ce[It].evaluate(Ie,ut);return wt},se.reduce=(rt,wt)=>{ut.properties=wt;for(const It of ft)Ie.accumulated=rt[It],rt[It]=Ve[It].evaluate(Ie,ut)},se}(D)).load(ce.features):function(se,he){return new Qr(se,he)}(ce,D.geojsonVtOptions)}catch(se){return O(se)}this.loaded={};const oe={};if(W){const se=W.finish();se&&(oe.resourceTiming={},oe.resourceTiming[D.source]=JSON.parse(JSON.stringify(se)))}O(null,oe)}})}reloadTile(D,O){const H=this.loaded;return H&&H[D.uid]?super.reloadTile(D,O):this.loadTile(D,O)}loadGeoJSON(D,O){if(D.request)return o.getJSON(D.request,O);if(typeof D.data=="string")try{O(null,JSON.parse(D.data))}catch{O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}else O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(D,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(D,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(H){O(H)}}getClusterChildren(D,O){try{O(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(H){O(H)}}getClusterLeaves(D,O){try{O(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(H){O(H)}}}class On{constructor(D){this.self=D,this.actor=new o.Actor(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:F,geojson:as},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,H)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=H},this.self.registerRTLTextPlugin=O=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=O.applyArabicShaping,o.plugin.processBidirectionalText=O.processBidirectionalText,o.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(D,O){this.referrer=O}setImages(D,O,H){this.availableImages[D]=O;for(const W in this.workerSources[D]){const ne=this.workerSources[D][W];for(const ce in ne)ne[ce].availableImages=O}H()}setLayers(D,O,H){this.getLayerIndex(D).replace(O),H()}updateLayers(D,O,H){this.getLayerIndex(D).update(O.layers,O.removedIds),H()}loadTile(D,O,H){this.getWorkerSource(D,O.type,O.source).loadTile(O,H)}loadDEMTile(D,O,H){this.getDEMWorkerSource(D,O.source).loadTile(O,H)}reloadTile(D,O,H){this.getWorkerSource(D,O.type,O.source).reloadTile(O,H)}abortTile(D,O,H){this.getWorkerSource(D,O.type,O.source).abortTile(O,H)}removeTile(D,O,H){this.getWorkerSource(D,O.type,O.source).removeTile(O,H)}removeDEMTile(D,O){this.getDEMWorkerSource(D,O.source).removeTile(O)}removeSource(D,O,H){if(!this.workerSources[D]||!this.workerSources[D][O.type]||!this.workerSources[D][O.type][O.source])return;const W=this.workerSources[D][O.type][O.source];delete this.workerSources[D][O.type][O.source],W.removeSource!==void 0?W.removeSource(O,H):H()}loadWorkerSource(D,O,H){try{this.self.importScripts(O.url),H()}catch(W){H(W.toString())}}syncRTLPluginState(D,O,H){try{o.plugin.setState(O);const W=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&W!=null){this.self.importScripts(W);const ne=o.plugin.isParsed();H(ne?void 0:new Error(`RTL Text Plugin failed to import scripts from ${W}`),ne)}}catch(W){H(W.toString())}}getAvailableImages(D){let O=this.availableImages[D];return O||(O=[]),O}getLayerIndex(D){let O=this.layerIndexes[D];return O||(O=this.layerIndexes[D]=new I),O}getWorkerSource(D,O,H){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][O]||(this.workerSources[D][O]={}),!this.workerSources[D][O][H]){const W={send:(ne,ce,oe)=>{this.actor.send(ne,ce,oe,D)}};this.workerSources[D][O][H]=new this.workerSourceTypes[O](W,this.getLayerIndex(D),this.getAvailableImages(D))}return this.workerSources[D][O][H]}getDEMWorkerSource(D,O){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][O]||(this.demWorkerSources[D][O]=new Q),this.demWorkerSources[D][O]}enforceCacheSizeLimit(D,O){o.enforceCacheSizeLimit(O)}}return o.isWorker()&&(self.worker=new On(self)),On}),_(["./shared"],function(o){var b=E;function E(f){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,m,y=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(y);try{m=new Worker(w),u=!0}catch{u=!1}return m&&m.terminate(),URL.revokeObjectURL(w),u}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var u=document.createElement("canvas");u.width=u.height=1;var m=u.getContext("2d");if(!m)return!1;var y=m.getImageData(0,0,1,1);return y&&y.width===u.width}()?(I[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(I[s]=function(u){var m,y=function(w){var S=document.createElement("canvas"),C=Object.create(E.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=w,S.getContext("webgl",C)||S.getContext("experimental-webgl",C)}(u);if(!y)return!1;try{m=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!m||y.isContextLost())&&(y.shaderSource(m,"void main() {}"),y.compileShader(m),y.getShaderParameter(m,y.COMPILE_STATUS)===!0)}(s)),I[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(f)}var I={};function P(f,t){if(Array.isArray(f)){if(!Array.isArray(t)||f.length!==t.length)return!1;for(let s=0;s<f.length;s++)if(!P(f[s],t[s]))return!1;return!0}if(typeof f=="object"&&f!==null&&t!==null){if(typeof t!="object"||Object.keys(f).length!==Object.keys(t).length)return!1;for(const s in f)if(!P(f[s],t[s]))return!1;return!0}return f===t}E.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class A{static testProp(t){if(!A.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in A.docStyle)return t[s];return t[0]}static create(t,s,u){const m=window.document.createElement(t);return s!==void 0&&(m.className=s),u&&u.appendChild(m),m}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){A.docStyle&&A.selectProp&&(A.userSelect=A.docStyle[A.selectProp],A.docStyle[A.selectProp]="none")}static enableDrag(){A.docStyle&&A.selectProp&&(A.docStyle[A.selectProp]=A.userSelect)}static setTransform(t,s){t.style[A.transformProp]=s}static addEventListener(t,s,u,m={}){t.addEventListener(s,u,"passive"in m?m:m.capture)}static removeEventListener(t,s,u,m={}){t.removeEventListener(s,u,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",A.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",A.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",A.suppressClickInternal,!0)},0)}static mousePos(t,s){const u=t.getBoundingClientRect();return new o.pointGeometry(s.clientX-u.left-t.clientLeft,s.clientY-u.top-t.clientTop)}static touchPos(t,s){const u=t.getBoundingClientRect(),m=[];for(let y=0;y<s.length;y++)m.push(new o.pointGeometry(s[y].clientX-u.left-t.clientLeft,s[y].clientY-u.top-t.clientTop));return m}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}A.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,A.selectProp=A.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),A.transformProp=A.testProp(["transform","WebkitTransform"]);class V{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,u){const m=function(y){const w=y.match(U);if(!w)throw new Error(`Unable to parse URL "${y}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(t);return m.path+=`${s}${u}`,function(y){const w=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${w}`}(m)}setTransformRequest(t){this._transformRequestFn=t}}const U=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class F{constructor(t,s,u,m){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(s,m)}update(t,s,u){const{width:m,height:y}=t,w=!(this.size&&this.size[0]===m&&this.size[1]===y||u),{context:S}=this,{gl:C}=S;if(this.useMipmap=!!(s&&s.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!s||s.premultiply!==!1)),w)this.size=[m,y],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,t):C.texImage2D(C.TEXTURE_2D,0,this.format,m,y,0,this.format,C.UNSIGNED_BYTE,t.data);else{const{x:M,y:B}=u||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?C.texSubImage2D(C.TEXTURE_2D,0,M,B,C.RGBA,C.UNSIGNED_BYTE,t):C.texSubImage2D(C.TEXTURE_2D,0,M,B,m,y,C.RGBA,C.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(t,s,u){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),u!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=y.LINEAR),t!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,t),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,u||t),this.filter=t),s!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Q(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class pe extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:u}of this.requestors)this._notify(s,u);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let u=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,s){if(!t)return!0;let u=0;for(const m of t){if(m[0]<u||m[1]<m[0]||s<m[1])return!1;u=m[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){const u=this.images[t];if(u.data.width!==s.data.width||u.data.height!==s.data.height)throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let u=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(u=!1);this.isLoaded()||u?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const u={};for(const m of t){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));const y=this.images[m];y?u[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,u)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],u=this.getImage(t);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const m={w:u.data.width+2,h:u.data.height+2,x:0,y:0},y=new o.ImagePosition(m,u);this.patterns[t]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new F(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:s,h:u}=o.potpack(t),m=this.atlasImage;m.resize({width:s||1,height:u||1});for(const y in this.patterns){const{bin:w}=this.patterns[y],S=w.x+1,C=w.y+1,M=this.images[y].data,B=M.width,N=M.height;o.RGBAImage.copy(M,m,{x:0,y:0},{x:S,y:C},{width:B,height:N}),o.RGBAImage.copy(M,m,{x:0,y:N-1},{x:S,y:C-1},{width:B,height:1}),o.RGBAImage.copy(M,m,{x:0,y:0},{x:S,y:C+N},{width:B,height:1}),o.RGBAImage.copy(M,m,{x:B-1,y:0},{x:S-1,y:C},{width:1,height:N}),o.RGBAImage.copy(M,m,{x:0,y:0},{x:S+B,y:C},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.images[s];u||o.warnOnce(`Image with ID: "${s}" was not found`),Q(u)&&this.updateImage(s,u)}}}const ae=1e20;function Se(f,t,s,u,m,y,w,S,C){for(let M=t;M<t+u;M++)Ge(f,s*y+M,y,m,w,S,C);for(let M=s;M<s+m;M++)Ge(f,M*y+t,1,u,w,S,C)}function Ge(f,t,s,u,m,y,w){y[0]=0,w[0]=-ae,w[1]=ae,m[0]=f[t];for(let S=1,C=0,M=0;S<u;S++){m[S]=f[t+S*s];const B=S*S;do{const N=y[C];M=(m[S]-m[N]+B-N*N)/(S-N)/2}while(M<=w[C]&&--C>-1);C++,y[C]=S,w[C]=M,w[C+1]=ae}for(let S=0,C=0;S<u;S++){for(;w[C+1]<S;)C++;const M=y[C],B=S-M;f[t+S*s]=m[M]+B*B}}class ze{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const u=[];for(const m in t)for(const y of t[m])u.push({stack:m,id:y});o.asyncAll(u,({stack:m,id:y},w)=>{let S=this.entries[m];S||(S=this.entries[m]={glyphs:{},requests:{},ranges:{}});let C=S.glyphs[y];if(C!==void 0)return void w(null,{stack:m,id:y,glyph:C});if(C=this._tinySDF(S,m,y),C)return S.glyphs[y]=C,void w(null,{stack:m,id:y,glyph:C});const M=Math.floor(y/256);if(256*M>65535)return void w(new Error("glyphs > 65535 not supported"));if(S.ranges[M])return void w(null,{stack:m,id:y,glyph:C});let B=S.requests[M];B||(B=S.requests[M]=[],ze.loadGlyphRange(m,M,this.url,this.requestManager,(N,G)=>{if(G){for(const $ in G)this._doesCharSupportLocalGlyph(+$)||(S.glyphs[+$]=G[+$]);S.ranges[M]=!0}for(const $ of B)$(N,G);delete S.requests[M]})),B.push((N,G)=>{N?w(N):G&&w(null,{stack:m,id:y,glyph:G[y]||null})})},(m,y)=>{if(m)s(m);else if(y){const w={};for(const{stack:S,id:C,glyph:M}of y)(w[S]||(w[S]={}))[C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};s(null,w)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](t)||o.unicodeBlockLookup["Hangul Syllables"](t)||o.unicodeBlockLookup.Hiragana(t)||o.unicodeBlockLookup.Katakana(t))}_tinySDF(t,s,u){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let y=t.tinySDF;if(!y){let S="400";/bold/i.test(s)?S="900":/medium/i.test(s)?S="500":/light/i.test(s)&&(S="200"),y=t.tinySDF=new ze.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:m,fontWeight:S})}const w=y.draw(String.fromCharCode(u));return{id:u,bitmap:new o.AlphaImage({width:w.width||30,height:w.height||30},w.data),metrics:{width:w.glyphWidth||24,height:w.glyphHeight||24,left:w.glyphLeft||0,top:w.glyphTop-27||-8,advance:w.glyphAdvance||24}}}}ze.loadGlyphRange=function(f,t,s,u,m){const y=256*t,w=y+255,S=u.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${y}-${w}`),o.ResourceType.Glyphs);o.getArrayBuffer(S,(C,M)=>{if(C)m(C);else if(M){const B={};for(const N of o.parseGlyphPbf(M))B[N.id]=N;m(null,B)}})},ze.TinySDF=class{constructor({fontSize:f=24,buffer:t=3,radius:s=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:w="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=s;const S=this.size=f+4*t,C=this._createCanvas(S),M=this.ctx=C.getContext("2d",{willReadFrequently:!0});M.font=`${w} ${y} ${f}px ${m}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(f){const t=document.createElement("canvas");return t.width=t.height=f,t}draw(f){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(f),w=Math.ceil(s),S=Math.min(this.size-this.buffer,Math.ceil(y-m)),C=Math.min(this.size-this.buffer,w+Math.ceil(u)),M=S+2*this.buffer,B=C+2*this.buffer,N=Math.max(M*B,0),G=new Uint8ClampedArray(N),$={data:G,width:M,height:B,glyphWidth:S,glyphHeight:C,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(S===0||C===0)return $;const{ctx:J,buffer:Y,gridInner:le,gridOuter:fe}=this;J.clearRect(Y,Y,S,C),J.fillText(f,Y,Y+w);const _e=J.getImageData(Y,Y,S,C);fe.fill(ae,0,N),le.fill(0,0,N);for(let te=0;te<C;te++)for(let Te=0;Te<S;Te++){const ye=_e.data[4*(te*S+Te)+3]/255;if(ye===0)continue;const Pe=(te+Y)*M+Te+Y;if(ye===1)fe[Pe]=0,le[Pe]=ae;else{const De=.5-ye;fe[Pe]=De>0?De*De:0,le[Pe]=De<0?De*De:0}}Se(fe,0,0,M,B,M,this.f,this.v,this.z),Se(le,Y,Y,S,C,M,this.f,this.v,this.z);for(let te=0;te<N;te++){const Te=Math.sqrt(fe[te])-Math.sqrt(le[te]);G[te]=Math.round(255-255*(Te/this.radius+this.cutoff))}return $}};const Oe=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(f,t){return o.sphericalToCartesian(f.expression.evaluate(t))}interpolate(f,t,s){return{x:o.number(f.x,t.x,s),y:o.number(f.y,t.y,s),z:o.number(f.z,t.z,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Me="-transition";class Ue extends o.Evented{constructor(t){super(),this._transitionable=new o.Transitionable(Oe),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(o.validateLight,t,s))for(const u in t){const m=t[u];u.endsWith(Me)?this._transitionable.setTransition(u.slice(0,-Me.length),m):this._transitionable.setValue(u,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,u){return(!u||u.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class zt{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const u=t.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,s)),this.dashEntry[u]}getDashRanges(t,s,u){const m=[];let y=t.length%2==1?-t[t.length-1]*u:0,w=t[0]*u,S=!0;m.push({left:y,right:w,isDash:S,zeroLength:t[0]===0});let C=t[0];for(let M=1;M<t.length;M++){S=!S;const B=t[M];y=C*u,C+=B,w=C*u,m.push({left:y,right:w,isDash:S,zeroLength:B===0})}return m}addRoundDash(t,s,u){const m=s/2;for(let y=-u;y<=u;y++){const w=this.width*(this.nextRow+u+y);let S=0,C=t[S];for(let M=0;M<this.width;M++){M/C.right>1&&(C=t[++S]);const B=Math.abs(M-C.left),N=Math.abs(M-C.right),G=Math.min(B,N);let $;const J=y/u*(m+1);if(C.isDash){const Y=m-Math.abs(J);$=Math.sqrt(G*G+Y*Y)}else $=m-Math.sqrt(G*G+J*J);this.data[w+M]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(t){for(let S=t.length-1;S>=0;--S){const C=t[S],M=t[S+1];C.zeroLength?t.splice(S,1):M&&M.isDash===C.isDash&&(M.left=C.left,t.splice(S,1))}const s=t[0],u=t[t.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const m=this.width*this.nextRow;let y=0,w=t[y];for(let S=0;S<this.width;S++){S/w.right>1&&(w=t[++y]);const C=Math.abs(S-w.left),M=Math.abs(S-w.right),B=Math.min(C,M);this.data[m+S]=Math.max(0,Math.min(255,(w.isDash?B:-B)+128))}}addDash(t,s){const u=s?7:0,m=2*u+1;if(this.nextRow+m>this.height)return o.warnOnce("LineAtlas out of space"),null;let y=0;for(let S=0;S<t.length;S++)y+=t[S];if(y!==0){const S=this.width/y,C=this.getDashRanges(t,this.width,S);s?this.addRoundDash(C,S,u):this.addRegularDash(C)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:y};return this.nextRow+=m,this.dirty=!0,w}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class dt{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const u=this.workerPool.acquire(this.id);for(let m=0;m<u.length;m++){const y=new dt.Actor(u[m],s,this.id);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,u){o.asyncAll(this.actors,(m,y)=>{m.send(t,s,y)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function yi(f,t,s){const u=function(m,y){if(m)return s(m);if(y){const w=o.pick(o.extend(y,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(w.vectorLayers=y.vector_layers,w.vectorLayerIds=w.vectorLayers.map(S=>S.id)),s(null,w)}};return f.url?o.getJSON(t.transformRequest(f.url,o.ResourceType.Source),u):o.exported.frame(()=>u(null,f))}dt.Actor=o.Actor;class _t{constructor(t,s,u){this.bounds=o.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),u=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),y=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),w=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=u&&t.x<y&&t.y>=m&&t.y<w}}class si extends o.Evented{constructor(t,s,u,m){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(s,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yi(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new o.ErrorEvent(t)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new _t(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(t,s){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(u,o.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(w,S){return delete t.request,t.aborted?s(null):w&&w.status!==404?s(w):(S&&S.resourceTiming&&(t.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&t.setExpiryData(S),t.loadVectorData(S,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",m,y.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",m,y.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class nr extends o.Evented{constructor(t,s,u,m){super(),this.id=t,this.dispatcher=u,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yi(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new _t(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=o.getImage(this.map._requestManager.transformRequest(u,o.ResourceType.Tile),(m,y,w)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(m)t.state="errored",s(m);else if(y){this.map._refreshExpiredTiles&&t.setExpiryData(w);const S=this.map.painter.context,C=S.gl;t.texture=this.map.painter.getTileTexture(y.width),t.texture?t.texture.update(y,{useMipmap:!0}):(t.texture=new F(S,y,C.RGBA,{useMipmap:!0}),t.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&C.texParameterf(C.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),t.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let ii;class bt extends nr{constructor(t,s,u,m){super(t,s,u,m),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,s){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function m(y,w){y&&(t.state="errored",s(y)),w&&(t.dem=w,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.request=o.getImage(this.map._requestManager.transformRequest(u,o.ResourceType.Tile),(function(y,w){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(y)t.state="errored",s(y);else if(w){this.map._refreshExpiredTiles&&t.setExpiryData(w),delete w.cacheControl,delete w.expires;const S=o.isImageBitmap(w)&&(ii==null&&(ii=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ii)?w:o.exported.getImageData(w,1),C={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:S,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,m.bind(this)))}}).bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const s=t.canonical,u=Math.pow(2,s.z),m=(s.x-1+u)%u,y=s.x===0?t.wrap-1:t.wrap,w=(s.x+1+u)%u,S=s.x+1===u?t.wrap+1:t.wrap,C={};return C[new o.OverscaledTileID(t.overscaledZ,y,s.z,m,s.y).key]={backfilled:!1},C[new o.OverscaledTileID(t.overscaledZ,S,s.z,w,s.y).key]={backfilled:!1},s.y>0&&(C[new o.OverscaledTileID(t.overscaledZ,y,s.z,m,s.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(t.overscaledZ,S,s.z,w,s.y-1).key]={backfilled:!1}),s.y+1<u&&(C[new o.OverscaledTileID(t.overscaledZ,y,s.z,m,s.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(t.overscaledZ,S,s.z,w,s.y+1).key]={backfilled:!1}),C}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class mr extends o.Evented{constructor(t,s,u,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(m),this._data=s.data,this._options=o.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const y=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*y,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*y,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:o.EXTENT,radius:(s.clusterRadius||50)*y,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:u},m),this}_updateWorkerData(t){const s=o.extend({},this.workerOptions),u=this._data;typeof u=="string"?(s.request=this.map._requestManager.transformRequest(o.exported.resolveURL(u),o.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(u),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(m,y)=>{if(this._pendingLoads--,this._removed||y&&y.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source",sourceDataType:t}));let w=null;if(y&&y.resourceTiming&&y.resourceTiming[this.id]&&(w=y.resourceTiming[this.id].slice(0)),m)return void this.fire(new o.ErrorEvent(m));const S={dataType:"source",sourceDataType:t};this._collectResourceTiming&&w&&w.length>0&&o.extend(S,{resourceTiming:w}),this.fire(new o.Event("data",S))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const u=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const m={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(u,m,(y,w)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):y?s(y):(t.loadVectorData(w,this.map.painter,u==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Si=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Lt extends o.Evented{constructor(t,s,u,m){super(),this.id=t,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(t,s){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(u,m)=>{this._loaded=!0,u?this.fire(new o.ErrorEvent(u)):m&&(this.image=m,t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(m){let y=1/0,w=1/0,S=-1/0,C=-1/0;for(const G of m)y=Math.min(y,G.x),w=Math.min(w,G.y),S=Math.max(S,G.x),C=Math.max(C,G.y);const M=Math.max(S-y,C-w),B=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),N=Math.pow(2,B);return new o.CanonicalTileID(B,Math.floor((y+S)/2*N),Math.floor((w+C)/2*N))}(s),this.minzoom=this.maxzoom=this.tileID.z;const u=s.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(u[2].x,u[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Si.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new F(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ri extends Lt{constructor(t,s,u,m){super(t,s,u,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,o.ResourceType.Source).url);o.getVideo(this.urls,(s,u)=>{this._loaded=!0,s?this.fire(new o.ErrorEvent(s)):u&&(this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Si.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new F(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Mi extends Lt{constructor(t,s,u,m){super(t,s,u,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(w=>typeof w!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Si.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new F(s,this.canvas,u.RGBA,{premultiply:!0});for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ai={vector:si,raster:nr,"raster-dem":bt,geojson:mr,video:Ri,image:Lt,canvas:Mi};function ur(f,t){const s=o.create();return o.translate(s,s,[1,1,0]),o.scale(s,s,[.5*f.width,.5*f.height,1]),o.multiply(s,s,f.calculatePosMatrix(t.toUnwrapped()))}function Ui(f,t,s,u,m,y){const w=function(N,G,$){if(N)for(const J of N){const Y=G[J];if(Y&&Y.source===$&&Y.type==="fill-extrusion")return!0}else for(const J in G){const Y=G[J];if(Y.source===$&&Y.type==="fill-extrusion")return!0}return!1}(m&&m.layers,t,f.id),S=y.maxPitchScaleFactor(),C=f.tilesIn(u,S,w);C.sort(Ki);const M=[];for(const N of C)M.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,s,f._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,y,S,ur(f.transform,N.tileID))});const B=function(N){const G={},$={};for(const J of N){const Y=J.queryResults,le=J.wrappedTileID,fe=$[le]=$[le]||{};for(const _e in Y){const te=Y[_e],Te=fe[_e]=fe[_e]||{},ye=G[_e]=G[_e]||[];for(const Pe of te)Te[Pe.featureIndex]||(Te[Pe.featureIndex]=!0,ye.push(Pe))}}return G}(M);for(const N in B)B[N].forEach(G=>{const $=G.feature,J=f.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=J});return B}function Ki(f,t){const s=f.tileID,u=t.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}class gr{constructor(t,s){this.tileID=t,this.uid=o.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<o.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(s=>t.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,y){const w={};if(!y)return w;for(const S of m){const C=S.layerIds.map(M=>y.getLayer(M)).filter(Boolean);if(C.length!==0){S.layers=C,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(M=>C.filter(B=>B.id===M)[0]));for(const M of C)w[M.id]=S}}return w}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof o.SymbolBucket&&y.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(m).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const m=this.buckets[u];m.uploadPending()&&m.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new F(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new F(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,u,m,y,w,S,C,M,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:w,tileSize:this.tileSize,pixelPosMatrix:B,transform:C,params:S,queryPadding:this.queryPadding*M},t,s,u):{}}querySourceFeatures(t,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const m=u.loadVTLayers(),y=s?s.sourceLayer:"",w=m._geojsonTileLayer||m[y];if(!w)return;const S=o.createFilter(s&&s.filter),{z:C,x:M,y:B}=this.tileID.canonical,N={z:C,x:M,y:B};for(let G=0;G<w.length;G++){const $=w.feature(G);if(S.needGeometry){const le=o.toEvaluationFeature($,!0);if(!S.filter(new o.EvaluationParameters(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!S.filter(new o.EvaluationParameters(this.tileID.overscaledZ),$))continue;const J=u.getId($,y),Y=new o.GeoJSONFeature($,C,M,B,J);Y.tile=N,t.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const u=o.parseCacheControl(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let m=!1;if(this.expirationTime>u)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const y=this.expirationTime-s;y?this.expirationTime=u+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const y=this.buckets[m],w=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[w],C=t[w];if(!S||!C||Object.keys(C).length===0)continue;y.update(C,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=s&&s.style&&s.style.getLayer(m);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.exported.now()+t}setDependencies(t,s){const u={};for(const m of s)u[m]=!0;this.dependencies[t]=u}hasDependency(t,s){for(const u of t){const m=this.dependencies[u];if(m){for(const y of s)if(m[y])return!0}}return!1}}class _r{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,u){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:s,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},u)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const u=t.wrapped().key,m=s===void 0?0:this.data[u].indexOf(s),y=this.data[u][m];return this.data[u].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const u in this.data)for(const m of this.data[u])t(m.value)||s.push(m);for(const u of s)this.remove(u.value.tileID,u)}}class Tr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,u){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},o.extend(this.stateChanges[t][m],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==m&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const y in this.state[t][m])u[y]||(this.deletedStates[t][m][y]=null)}else for(const y in u)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][y]===null&&delete this.deletedStates[t][m][y]}removeFeatureState(t,s,u){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][u]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(u in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][u]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const u=String(s),m=o.extend({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const y=this.deletedStates[t][s];if(y===null)return{};for(const w in y)delete m[w]}return m}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const u={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),o.extend(this.state[m][w],this.stateChanges[m][w]),y[w]=this.state[m][w];u[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const w in this.state[m])y[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else for(const S of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][S];y[w]=this.state[m][w]}u[m]=u[m]||{},o.extend(u[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const m in t)t[m].setFeatureState(u,s)}}class Xe extends o.Evented{constructor(t,s,u){super(),this.id=t,this.dispatcher=u,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(m,y,w,S){const C=new Ai[y.type](m,y,w,S);if(C.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${C.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],C),C}(t,s,u,this),this._tiles={},this._cache=new _r(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Tr}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(pi).map(t=>t.key)}getRenderableIds(t){const s=[];for(const u in this._tiles)this._isIdRenderable(u,t)&&s.push(this._tiles[u]);return t?s.sort((u,m)=>{const y=u.tileID,w=m.tileID,S=new o.pointGeometry(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),C=new o.pointGeometry(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-w.overscaledZ||C.y-S.y||C.x-S.x}).map(u=>u.tileID.key):s.map(u=>u.tileID).sort(pi).map(u=>u.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=s),this._loadTile(u,this._tileLoaded.bind(this,u,t,s)))}_tileLoaded(t,s,u,m){if(m)return t.state="errored",void(m.status!==404?this._source.fire(new o.ErrorEvent(m,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=o.exported.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const y=s[m];if(t.neighboringTiles&&t.neighboringTiles[y]){const w=this.getTileByID(y);u(t,w),u(w,t)}}function u(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let w=y.tileID.canonical.x-m.tileID.canonical.x;const S=y.tileID.canonical.y-m.tileID.canonical.y,C=Math.pow(2,m.tileID.canonical.z),M=y.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+C)===1?w+=C:Math.abs(w-C)===1&&(w-=C)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,w,S),m.neighboringTiles&&m.neighboringTiles[M]&&(m.neighboringTiles[M].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,u,m){for(const y in this._tiles){let w=this._tiles[y];if(m[y]||!w.hasData()||w.tileID.overscaledZ<=s||w.tileID.overscaledZ>u)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>s+1;){const M=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[M.key],w&&w.hasData()&&(S=M)}let C=S;for(;C.overscaledZ>s;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){m[S.key]=S;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=t.overscaledZ-1;u>=s;u--){const m=t.scaledTo(u),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(s*u*5),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const u={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+s),u[y.tileID.key]=y}this._tiles=u;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new o.OverscaledTileID(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(u=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(u=u.filter(M=>this._source.hasTile(M)))):u=[];const m=t.coveringZoomLevel(this._source),y=Math.max(m-Xe.maxOverzooming,this._source.minzoom),w=Math.max(m+Xe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const B of u)if(B.canonical.z>this._source.minzoom){const N=B.scaledTo(B.canonical.z-1);M[N.key]=N;const G=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));M[G.key]=G}u=u.concat(Object.values(M))}const S=this._updateRetainedTiles(u,m);if(Ni(this._source.type)){const M={},B={},N=Object.keys(S);for(const G of N){const $=S[G],J=this._tiles[G];if(!J||J.fadeEndTime&&J.fadeEndTime<=o.exported.now())continue;const Y=this.findLoadedParent($,y);Y&&(this._addTile(Y.tileID),M[Y.tileID.key]=Y.tileID),B[G]=$}this._retainLoadedChildren(B,m,w,S);for(const G in M)S[G]||(this._coveredTiles[G]=!0,S[G]=M[G]);if(s){const G={},$={};for(const J of u)this._tiles[J.key].hasData()?G[J.key]=J:$[J.key]=J;for(const J in $){const Y=$[J].children(this._source.maxzoom);this._tiles[Y[0].key]&&this._tiles[Y[1].key]&&this._tiles[Y[2].key]&&this._tiles[Y[3].key]&&(G[Y[0].key]=S[Y[0].key]=Y[0],G[Y[1].key]=S[Y[1].key]=Y[1],G[Y[2].key]=S[Y[2].key]=Y[2],G[Y[3].key]=S[Y[3].key]=Y[3],delete $[J])}for(const J in $){const Y=this.findLoadedParent($[J],this._source.minzoom);if(Y){G[Y.tileID.key]=S[Y.tileID.key]=Y.tileID;for(const le in G)G[le].isChildOf(Y.tileID)&&delete G[le]}}for(const J in this._tiles)G[J]||(this._coveredTiles[J]=!0)}}for(const M in S)this._tiles[M].clearFadeHold();const C=o.keysDifference(this._tiles,S);for(const M of C){const B=this._tiles[M];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const u={},m={},y=Math.max(s-Xe.maxOverzooming,this._source.minzoom),w=Math.max(s+Xe.maxUnderzooming,this._source.minzoom),S={};for(const C of t){const M=this._addTile(C);u[C.key]=C,M.hasData()||s<this._source.maxzoom&&(S[C.key]=C)}this._retainLoadedChildren(S,s,w,u);for(const C of t){let M=this._tiles[C.key];if(M.hasData())continue;if(s+1>this._source.maxzoom){const N=C.children(this._source.maxzoom)[0],G=this.getTile(N);if(G&&G.hasData()){u[N.key]=N;continue}}else{const N=C.children(this._source.maxzoom);if(u[N[0].key]&&u[N[1].key]&&u[N[2].key]&&u[N[3].key])continue}let B=M.wasRequested();for(let N=C.overscaledZ-1;N>=y;--N){const G=C.scaledTo(N);if(m[G.key]||(m[G.key]=!0,M=this.getTile(G),!M&&B&&(M=this._addTile(G)),M&&(u[G.key]=G,B=M.wasRequested(),M.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let u,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){u=this._loadedParentTiles[m.key];break}s.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;m=y}for(const y of s)this._loadedParentTiles[y]=u}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const u=s;return s||(s=new gr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,u||this._source.fire(new o.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=s.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,u){const m=[],y=this.transform;if(!y)return m;const w=u?y.getCameraQueryGeometry(t):t,S=t.map(J=>y.pointCoordinate(J,this.terrain)),C=w.map(J=>y.pointCoordinate(J,this.terrain)),M=this.getIds();let B=1/0,N=1/0,G=-1/0,$=-1/0;for(const J of C)B=Math.min(B,J.x),N=Math.min(N,J.y),G=Math.max(G,J.x),$=Math.max($,J.y);for(let J=0;J<M.length;J++){const Y=this._tiles[M[J]];if(Y.holdingForFade())continue;const le=Y.tileID,fe=Math.pow(2,y.zoom-Y.tileID.overscaledZ),_e=s*Y.queryPadding*o.EXTENT/Y.tileSize/fe,te=[le.getTilePoint(new o.MercatorCoordinate(B,N)),le.getTilePoint(new o.MercatorCoordinate(G,$))];if(te[0].x-_e<o.EXTENT&&te[0].y-_e<o.EXTENT&&te[1].x+_e>=0&&te[1].y+_e>=0){const Te=S.map(Pe=>le.getTilePoint(Pe)),ye=C.map(Pe=>le.getTilePoint(Pe));m.push({tile:Y,tileID:le,queryGeometry:Te,cameraQueryGeometry:ye,scale:fe})}}return m}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of s)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Ni(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=o.exported.now())return!0}return!1}setFeatureState(t,s,u){this._state.updateState(t=t||"_geojsonTileLayer",s,u)}removeFeatureState(t,s,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,u)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,u){const m=this._tiles[t];m&&m.setDependencies(s,u)}reloadTilesForDependencies(t,s){for(const u in this._tiles)this._tiles[u].hasDependency(t,s)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(t,s))}}function pi(f,t){const s=Math.abs(2*f.wrap)-+(f.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||u-s||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function Ni(f){return f==="raster"||f==="image"||f==="video"}Xe.maxOverzooming=10,Xe.maxUnderzooming=3;const Rr="mapboxgl_preloaded_worker_pool";class kr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<kr.workerCount;)this.workers.push(new Worker(Gn.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Rr]}numActive(){return Object.keys(this.active).length}}const Is=Math.floor(o.exported.hardwareConcurrency/2);let vn;function is(){return vn||(vn=new kr),vn}function rs(f,t){const s={};for(const u in f)u!=="ref"&&(s[u]=f[u]);return o.refProperties.forEach(u=>{u in t&&(s[u]=t[u])}),s}function Cs(f){f=f.slice();const t=Object.create(null);for(let s=0;s<f.length;s++)t[f[s].id]=f[s];for(let s=0;s<f.length;s++)"ref"in f[s]&&(f[s]=rs(f[s],t[f[s].ref]));return f}kr.workerCount=Math.max(Math.min(Is,6),1);const Zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Yr(f,t,s){s.push({command:Zt.addSource,args:[f,t[f]]})}function xn(f,t,s){t.push({command:Zt.removeSource,args:[f]}),s[f]=!0}function bn(f,t,s,u){xn(f,s,u),Yr(f,t,s)}function As(f,t,s){let u;for(u in f[s])if(Object.prototype.hasOwnProperty.call(f[s],u)&&u!=="data"&&!P(f[s][u],t[s][u]))return!1;for(u in t[s])if(Object.prototype.hasOwnProperty.call(t[s],u)&&u!=="data"&&!P(f[s][u],t[s][u]))return!1;return!0}function on(f,t,s,u,m,y){let w;for(w in t=t||{},f=f||{})Object.prototype.hasOwnProperty.call(f,w)&&(P(f[w],t[w])||s.push({command:y,args:[u,w,t[w],m]}));for(w in t)Object.prototype.hasOwnProperty.call(t,w)&&!Object.prototype.hasOwnProperty.call(f,w)&&(P(f[w],t[w])||s.push({command:y,args:[u,w,t[w],m]}))}function an(f){return f.id}function ns(f,t){return f[t.id]=t,f}class ln{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let s=1,u=this._distances[s];const m=t*this.paddedLength+this.padding;for(;u<m&&s<this._distances.length;)u=this._distances[++s];const y=s-1,w=this._distances[y],S=u-w,C=S>0?(m-w)/S:0;return this.points[y].mult(1-C).add(this.points[s].mult(C))}}function Le(f,t){let s=!0;return f==="always"||f!=="never"&&t!=="never"||(s=!1),s}class Qe{constructor(t,s,u){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(s/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,u,m,y){this._forEachCell(s,u,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(t,s,u,m){this._forEachCell(s-m,u-m,s+m,u+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(u),this.circles.push(m)}_insertBoxCell(t,s,u,m,y,w){this.boxCells[y].push(w)}_insertCircleCell(t,s,u,m,y,w){this.circleCells[y].push(w)}_query(t,s,u,m,y,w,S){if(u<0||t>this.width||m<0||s>this.height)return[];const C=[];if(t<=0&&s<=0&&this.width<=u&&this.height<=m){if(y)return[{key:null,x1:t,y1:s,x2:u,y2:m}];for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const B=this.circles[3*M],N=this.circles[3*M+1],G=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:B-G,y1:N-G,x2:B+G,y2:N+G})}}else this._forEachCell(t,s,u,m,this._queryCell,C,{hitTest:y,overlapMode:w,seenUids:{box:{},circle:{}}},S);return C}query(t,s,u,m){return this._query(t,s,u,m,!1,null)}hitTest(t,s,u,m,y,w){return this._query(t,s,u,m,!0,y,w).length>0}hitTestCircle(t,s,u,m,y){const w=t-u,S=t+u,C=s-u,M=s+u;if(S<0||w>this.width||M<0||C>this.height)return!1;const B=[];return this._forEachCell(w,C,S,M,this._queryCellCircle,B,{hitTest:!0,overlapMode:m,circle:{x:t,y:s,radius:u},seenUids:{box:{},circle:{}}},y),B.length>0}_queryCell(t,s,u,m,y,w,S,C){const{seenUids:M,hitTest:B,overlapMode:N}=S,G=this.boxCells[y];if(G!==null){const J=this.bboxes;for(const Y of G)if(!M.box[Y]){M.box[Y]=!0;const le=4*Y,fe=this.boxKeys[Y];if(t<=J[le+2]&&s<=J[le+3]&&u>=J[le+0]&&m>=J[le+1]&&(!C||C(fe))&&(!B||!Le(N,fe.overlapMode))&&(w.push({key:fe,x1:J[le],y1:J[le+1],x2:J[le+2],y2:J[le+3]}),B))return!0}}const $=this.circleCells[y];if($!==null){const J=this.circles;for(const Y of $)if(!M.circle[Y]){M.circle[Y]=!0;const le=3*Y,fe=this.circleKeys[Y];if(this._circleAndRectCollide(J[le],J[le+1],J[le+2],t,s,u,m)&&(!C||C(fe))&&(!B||!Le(N,fe.overlapMode))){const _e=J[le],te=J[le+1],Te=J[le+2];if(w.push({key:fe,x1:_e-Te,y1:te-Te,x2:_e+Te,y2:te+Te}),B)return!0}}}return!1}_queryCellCircle(t,s,u,m,y,w,S,C){const{circle:M,seenUids:B,overlapMode:N}=S,G=this.boxCells[y];if(G!==null){const J=this.bboxes;for(const Y of G)if(!B.box[Y]){B.box[Y]=!0;const le=4*Y,fe=this.boxKeys[Y];if(this._circleAndRectCollide(M.x,M.y,M.radius,J[le+0],J[le+1],J[le+2],J[le+3])&&(!C||C(fe))&&!Le(N,fe.overlapMode))return w.push(!0),!0}}const $=this.circleCells[y];if($!==null){const J=this.circles;for(const Y of $)if(!B.circle[Y]){B.circle[Y]=!0;const le=3*Y,fe=this.circleKeys[Y];if(this._circlesCollide(J[le],J[le+1],J[le+2],M.x,M.y,M.radius)&&(!C||C(fe))&&!Le(N,fe.overlapMode))return w.push(!0),!0}}}_forEachCell(t,s,u,m,y,w,S,C){const M=this._convertToXCellCoord(t),B=this._convertToYCellCoord(s),N=this._convertToXCellCoord(u),G=this._convertToYCellCoord(m);for(let $=M;$<=N;$++)for(let J=B;J<=G;J++)if(y.call(this,t,s,u,m,this.xCellCount*J+$,w,S,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,u,m,y,w){const S=m-t,C=y-s,M=u+w;return M*M>S*S+C*C}_circleAndRectCollide(t,s,u,m,y,w,S){const C=(w-m)/2,M=Math.abs(t-(m+C));if(M>C+u)return!1;const B=(S-y)/2,N=Math.abs(s-(y+B));if(N>B+u)return!1;if(M<=C||N<=B)return!0;const G=M-C,$=N-B;return G*G+$*$<=u*u}}function Bn(f,t,s,u,m){const y=o.create();return t?(o.scale(y,y,[1/m,1/m,1]),s||o.rotateZ(y,y,u.angle)):o.multiply(y,u.labelPlaneMatrix,f),y}function jr(f,t,s,u,m){if(t){const y=o.clone(f);return o.scale(y,y,[m,m,1]),s||o.rotateZ(y,y,-u.angle),y}return u.glCoordMatrix}function Xt(f,t,s){let u;s?(u=[f.x,f.y,s(f.x,f.y),1],o.transformMat4(u,u,t)):(u=[f.x,f.y,0,1],cn(u,u,t));const m=u[3];return{point:new o.pointGeometry(u[0]/m,u[1]/m),signedDistanceFromCamera:m}}function Fr(f,t){return .5+f/t*.5}function Er(f,t){const s=f[0]/f[3],u=f[1]/f[3];return s>=-t[0]&&s<=t[0]&&u>=-t[1]&&u<=t[1]}function Sr(f,t,s,u,m,y,w,S,C,M){const B=u?f.textSizeData:f.iconSizeData,N=o.evaluateSizeForZoom(B,s.transform.zoom),G=[256/s.width*2+1,256/s.height*2+1],$=u?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;$.clear();const J=f.lineVertexArray,Y=u?f.text.placedSymbolArray:f.icon.placedSymbolArray,le=s.transform.width/s.transform.height;let fe=!1;for(let _e=0;_e<Y.length;_e++){const te=Y.get(_e);if(te.hidden||te.writingMode===o.WritingMode.vertical&&!fe){Mt(te.numGlyphs,$);continue}let Te;if(fe=!1,M?(Te=[te.anchorX,te.anchorY,M(te.anchorX,te.anchorY),1],o.transformMat4(Te,Te,t)):(Te=[te.anchorX,te.anchorY,0,1],cn(Te,Te,t)),!Er(Te,G)){Mt(te.numGlyphs,$);continue}const ye=Fr(s.transform.cameraToCenterDistance,Te[3]),Pe=o.evaluateSizeForFeature(B,N,te),De=w?Pe/ye:Pe*ye,Ne=new o.pointGeometry(te.anchorX,te.anchorY),Ae=Xt(Ne,m,M).point,ot={},Je=Rt(te,De,!1,S,t,m,y,f.glyphOffsetArray,J,$,Ae,Ne,ot,le,C,M);fe=Je.useVertical,(Je.notEnoughRoom||fe||Je.needsFlipping&&Rt(te,De,!0,S,t,m,y,f.glyphOffsetArray,J,$,Ae,Ne,ot,le,C,M).notEnoughRoom)&&Mt(te.numGlyphs,$)}u?f.text.dynamicLayoutVertexBuffer.updateData($):f.icon.dynamicLayoutVertexBuffer.updateData($)}function wn(f,t,s,u,m,y,w,S,C,M,B,N,G){const $=S.glyphStartIndex+S.numGlyphs,J=S.lineStartIndex,Y=S.lineStartIndex+S.lineLength,le=t.getoffsetX(S.glyphStartIndex),fe=t.getoffsetX($-1),_e=Ji(f*le,s,u,m,y,w,S.segment,J,Y,C,M,B,N,G);if(!_e)return null;const te=Ji(f*fe,s,u,m,y,w,S.segment,J,Y,C,M,B,N,G);return te?{first:_e,last:te}:null}function Ke(f,t,s,u){return f===o.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*u?{useVertical:!0}:(f===o.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function Rt(f,t,s,u,m,y,w,S,C,M,B,N,G,$,J,Y){const le=t/24,fe=f.lineOffsetX*le,_e=f.lineOffsetY*le;let te;if(f.numGlyphs>1){const Te=f.glyphStartIndex+f.numGlyphs,ye=f.lineStartIndex,Pe=f.lineStartIndex+f.lineLength,De=wn(le,S,fe,_e,s,B,N,f,C,y,G,J,Y);if(!De)return{notEnoughRoom:!0};const Ne=Xt(De.first.point,w,Y).point,Ae=Xt(De.last.point,w,Y).point;if(u&&!s){const ot=Ke(f.writingMode,Ne,Ae,$);if(ot)return ot}te=[De.first];for(let ot=f.glyphStartIndex+1;ot<Te-1;ot++)te.push(Ji(le*S.getoffsetX(ot),fe,_e,s,B,N,f.segment,ye,Pe,C,y,G,J,Y));te.push(De.last)}else{if(u&&!s){const ye=Xt(N,m,Y).point,Pe=f.lineStartIndex+f.segment+1,De=new o.pointGeometry(C.getx(Pe),C.gety(Pe)),Ne=Xt(De,m,Y),Ae=Ne.signedDistanceFromCamera>0?Ne.point:Pt(N,De,ye,1,m,Y),ot=Ke(f.writingMode,ye,Ae,$);if(ot)return ot}const Te=Ji(le*S.getoffsetX(f.glyphStartIndex),fe,_e,s,B,N,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,C,y,G,J,Y);if(!Te)return{notEnoughRoom:!0};te=[Te]}for(const Te of te)o.addDynamicAttributes(M,Te.point,Te.angle);return{}}function Pt(f,t,s,u,m,y){const w=Xt(f.add(f.sub(t)._unit()),m,y).point,S=s.sub(w);return s.add(S._mult(u/S.mag()))}function Ji(f,t,s,u,m,y,w,S,C,M,B,N,G,$){const J=u?f-t:f+t;let Y=J>0?1:-1,le=0;u&&(Y*=-1,le=Math.PI),Y<0&&(le+=Math.PI);let fe=Y>0?S+w:S+w+1,_e=m,te=m,Te=0,ye=0;const Pe=Math.abs(J),De=[];for(;Te+ye<=Pe;){if(fe+=Y,fe<S||fe>=C)return null;if(te=_e,De.push(_e),_e=N[fe],_e===void 0){const at=new o.pointGeometry(M.getx(fe),M.gety(fe)),Dt=Xt(at,B,$);if(Dt.signedDistanceFromCamera>0)_e=N[fe]=Dt.point;else{const Ot=fe-Y;_e=Pt(Te===0?y:new o.pointGeometry(M.getx(Ot),M.gety(Ot)),at,te,Pe-Te+1,B,$)}}Te+=ye,ye=te.dist(_e)}const Ne=(Pe-Te)/ye,Ae=_e.sub(te),ot=Ae.mult(Ne)._add(te);ot._add(Ae._unit()._perp()._mult(s*Y));const Je=le+Math.atan2(_e.y-te.y,_e.x-te.x);return De.push(ot),{point:ot,angle:G?Je:0,path:De}}const Tn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Mt(f,t){for(let s=0;s<f;s++){const u=t.length;t.resize(u+4),t.float32.set(Tn,3*u)}}function cn(f,t,s){const u=t[0],m=t[1];return f[0]=s[0]*u+s[4]*m+s[12],f[1]=s[1]*u+s[5]*m+s[13],f[3]=s[3]*u+s[7]*m+s[15],f}const ji=100;class ss{constructor(t,s=new Qe(t.width+200,t.height+200,25),u=new Qe(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=u,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ji,this.screenBottomBoundary=t.height+ji,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,u,m,y,w){const S=this.projectAndGetPerspectiveRatio(m,t.anchorPointX,t.anchorPointY,w),C=u*S.perspectiveRatio,M=t.x1*C+S.point.x,B=t.y1*C+S.point.y,N=t.x2*C+S.point.x,G=t.y2*C+S.point.y;return!this.isInsideGrid(M,B,N,G)||s!=="always"&&this.grid.hitTest(M,B,N,G,s,y)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[M,B,N,G],offscreen:this.isOffscreen(M,B,N,G)}}placeCollisionCircles(t,s,u,m,y,w,S,C,M,B,N,G,$,J){const Y=[],le=new o.pointGeometry(s.anchorX,s.anchorY),fe=Xt(le,w,J),_e=Fr(this.transform.cameraToCenterDistance,fe.signedDistanceFromCamera),te=(B?y/_e:y*_e)/o.ONE_EM,Te=Xt(le,S,J).point,ye=wn(te,m,s.lineOffsetX*te,s.lineOffsetY*te,!1,Te,le,s,u,S,{},!1,J);let Pe=!1,De=!1,Ne=!0;if(ye){const Ae=.5*G*_e+$,ot=new o.pointGeometry(-100,-100),Je=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),at=new ln,Dt=ye.first,Ot=ye.last;let yt=[];for(let qt=Dt.path.length-1;qt>=1;qt--)yt.push(Dt.path[qt]);for(let qt=1;qt<Ot.path.length;qt++)yt.push(Ot.path[qt]);const $t=2.5*Ae;if(C){const qt=yt.map(Kt=>Xt(Kt,C,J));yt=qt.some(Kt=>Kt.signedDistanceFromCamera<=0)?[]:qt.map(Kt=>Kt.point)}let ei=[];if(yt.length>0){const qt=yt[0].clone(),Kt=yt[0].clone();for(let ni=1;ni<yt.length;ni++)qt.x=Math.min(qt.x,yt[ni].x),qt.y=Math.min(qt.y,yt[ni].y),Kt.x=Math.max(Kt.x,yt[ni].x),Kt.y=Math.max(Kt.y,yt[ni].y);ei=qt.x>=ot.x&&Kt.x<=Je.x&&qt.y>=ot.y&&Kt.y<=Je.y?[yt]:Kt.x<ot.x||qt.x>Je.x||Kt.y<ot.y||qt.y>Je.y?[]:o.clipLine([yt],ot.x,ot.y,Je.x,Je.y)}for(const qt of ei){at.reset(qt,.25*Ae);let Kt=0;Kt=at.length<=.5*Ae?1:Math.ceil(at.paddedLength/$t)+1;for(let ni=0;ni<Kt;ni++){const qi=ni/Math.max(Kt-1,1),tn=at.lerp(qi),qr=tn.x+ji,rn=tn.y+ji;Y.push(qr,rn,Ae,0);const zn=qr-Ae,Vr=rn-Ae,vr=qr+Ae,fn=rn+Ae;if(Ne=Ne&&this.isOffscreen(zn,Vr,vr,fn),De=De||this.isInsideGrid(zn,Vr,vr,fn),t!=="always"&&this.grid.hitTestCircle(qr,rn,Ae,t,N)&&(Pe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Pe}}}}return{circles:!M&&Pe||!De||_e<this.perspectiveRatioCutoff?[]:Y,offscreen:Ne,collisionDetected:Pe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,m=1/0,y=-1/0,w=-1/0;for(const B of t){const N=new o.pointGeometry(B.x+ji,B.y+ji);u=Math.min(u,N.x),m=Math.min(m,N.y),y=Math.max(y,N.x),w=Math.max(w,N.y),s.push(N)}const S=this.grid.query(u,m,y,w).concat(this.ignoredGrid.query(u,m,y,w)),C={},M={};for(const B of S){const N=B.key;if(C[N.bucketInstanceId]===void 0&&(C[N.bucketInstanceId]={}),C[N.bucketInstanceId][N.featureIndex])continue;const G=[new o.pointGeometry(B.x1,B.y1),new o.pointGeometry(B.x2,B.y1),new o.pointGeometry(B.x2,B.y2),new o.pointGeometry(B.x1,B.y2)];o.polygonIntersectsPolygon(s,G)&&(C[N.bucketInstanceId][N.featureIndex]=!0,M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]=[]),M[N.bucketInstanceId].push(N.featureIndex))}return M}insertCollisionBox(t,s,u,m,y,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:w,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,u,m,y,w){const S=u?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:y,collisionGroupID:w,overlapMode:s};for(let M=0;M<t.length;M+=4)S.insertCircle(C,t[M],t[M+1],t[M+2])}projectAndGetPerspectiveRatio(t,s,u,m){let y;return m?(y=[s,u,m(s,u),1],o.transformMat4(y,y,t)):(y=[s,u,0,1],cn(y,y,t)),{point:new o.pointGeometry((y[0]/y[3]+1)/2*this.transform.width+ji,(-y[1]/y[3]+1)/2*this.transform.height+ji),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(t,s,u,m){return u<ji||t>=this.screenRightBoundary||m<ji||s>this.screenBottomBoundary}isInsideGrid(t,s,u,m){return u>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}function Pi(f,t,s){return t*(o.EXTENT/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class hr{constructor(t,s,u,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class ri{constructor(t,s,u,m,y){this.text=new hr(t?t.text:null,s,u,y),this.icon=new hr(t?t.icon:null,s,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class os{constructor(t,s,u){this.text=t,this.icon=s,this.skipFade=u}}class Qr{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Rn{constructor(t,s,u,m,y){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=m,this.tileID=y}}class Fn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[t]}}function as(f,t,s,u,m){const{horizontalAlign:y,verticalAlign:w}=o.getAnchorAlignment(f),S=-(y-.5)*t,C=-(w-.5)*s,M=o.evaluateVariableOffset(f,u);return new o.pointGeometry(S+M[0]*m,C+M[1]*m)}function On(f,t,s,u,m,y){const{x1:w,x2:S,y1:C,y2:M,anchorPointX:B,anchorPointY:N}=f,G=new o.pointGeometry(t,s);return u&&G._rotate(m?y:-y),{x1:w+G.x,y1:C+G.y,x2:S+G.x,y2:M+G.y,anchorPointX:B,anchorPointY:N}}class K{constructor(t,s,u,m,y){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new ss(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Fn(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,u,m){const y=u.getBucket(s),w=u.latestFeatureIndex;if(!y||!w||s.id!==y.layerIds[0])return;const S=u.collisionBoxArray,C=y.layers[0].layout,M=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),B=u.tileSize/o.EXTENT,N=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),G=C.get("text-pitch-alignment")==="map",$=C.get("text-rotation-alignment")==="map",J=Pi(u,1,this.transform.zoom),Y=Bn(N,G,$,this.transform,J);let le=null;if(G){const _e=jr(N,G,$,this.transform,J);le=o.multiply([],this.transform.labelPlaneMatrix,_e)}this.retainedQueryData[y.bucketInstanceId]=new Rn(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,u.tileID);const fe={bucket:y,layout:C,posMatrix:N,textLabelPlaneMatrix:Y,labelToScreenMatrix:le,scale:M,textPixelRatio:B,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const _e of y.sortKeyRanges){const{sortKey:te,symbolInstanceStart:Te,symbolInstanceEnd:ye}=_e;t.push({sortKey:te,symbolInstanceStart:Te,symbolInstanceEnd:ye,parameters:fe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(t,s,u,m,y,w,S,C,M,B,N,G,$,J,Y,le){const fe=[G.textOffset0,G.textOffset1],_e=as(t,u,m,fe,y),te=this.collisionIndex.placeCollisionBox(On(s,_e.x,_e.y,w,S,this.transform.angle),N,C,M,B.predicate,le);if((!Y||this.collisionIndex.placeCollisionBox(On(Y,_e.x,_e.y,w,S,this.transform.angle),N,C,M,B.predicate,le).box.length!==0)&&te.box.length>0){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:fe,width:u,height:m,anchor:t,textBoxScale:y,prevAnchor:Te},this.markUsedJustification($,t,G,J),$.allowVerticalPlacement&&(this.markUsedOrientation($,J,G),this.placedOrientations[G.crossTileID]=J),{shift:_e,placedGlyphBoxes:te}}}placeLayerBucketPart(t,s,u){const{bucket:m,layout:y,posMatrix:w,textLabelPlaneMatrix:S,labelToScreenMatrix:C,textPixelRatio:M,holdingForFade:B,collisionBoxArray:N,partiallyEvaluatedTextSize:G,collisionGroup:$}=t.parameters,J=y.get("text-optional"),Y=y.get("icon-optional"),le=o.getOverlapMode(y,"text-overlap","text-allow-overlap"),fe=le==="always",_e=o.getOverlapMode(y,"icon-overlap","icon-allow-overlap"),te=_e==="always",Te=y.get("text-rotation-alignment")==="map",ye=y.get("text-pitch-alignment")==="map",Pe=y.get("icon-text-fit")!=="none",De=y.get("symbol-z-order")==="viewport-y",Ne=fe&&(te||!m.hasIconData()||Y),Ae=te&&(fe||!m.hasTextData()||J);!m.collisionArrays&&N&&m.deserializeCollisionBoxes(N);const ot=(Je,at)=>{if(s[Je.crossTileID])return;if(B)return void(this.placements[Je.crossTileID]=new os(!1,!1,!1));let Dt=!1,Ot=!1,yt=!0,$t=null,ei={box:null,offscreen:null},qt={box:null,offscreen:null},Kt=null,ni=null,qi=null,tn=0,qr=0,rn=0;at.textFeatureIndex?tn=at.textFeatureIndex:Je.useRuntimeCollisionCircles&&(tn=Je.featureIndex),at.verticalTextFeatureIndex&&(qr=at.verticalTextFeatureIndex);const zn=this.retainedQueryData[m.bucketInstanceId].tileID,Vr=this.terrain?(Fi,Ut)=>this.terrain.getElevation(zn,Fi,Ut):null;for(const Fi of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Ut=at[Fi];Ut&&(Ut.elevation=Vr?Vr(Ut.anchorPointX,Ut.anchorPointY):0)}const vr=at.textBox;if(vr){const Fi=Qt=>{let Zi=o.WritingMode.horizontal;if(m.allowVerticalPlacement&&!Qt&&this.prevPlacement){const Xi=this.prevPlacement.placedOrientations[Je.crossTileID];Xi&&(this.placedOrientations[Je.crossTileID]=Xi,Zi=Xi,this.markUsedOrientation(m,Zi,Je))}return Zi},Ut=(Qt,Zi)=>{if(m.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&at.verticalTextBox){for(const Xi of m.writingModes)if(Xi===o.WritingMode.vertical?(ei=Zi(),qt=ei):ei=Qt(),ei&&ei.box&&ei.box.length)break}else ei=Qt()};if(y.get("text-variable-anchor")){let Qt=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Je.crossTileID]){const Ti=this.prevPlacement.variableOffsets[Je.crossTileID];Qt.indexOf(Ti.anchor)>0&&(Qt=Qt.filter(Ur=>Ur!==Ti.anchor),Qt.unshift(Ti.anchor))}const Zi=(Ti,Ur,qn)=>{const wa=Ti.x2-Ti.x1,xs=Ti.y2-Ti.y1,Ml=Je.textBoxScale,Ta=Pe&&_e==="never"?Ur:null;let Mn={box:[],offscreen:!1};const Zn=le!=="never"?2*Qt.length:Qt.length;for(let Xn=0;Xn<Zn;++Xn){const Co=this.attemptAnchorPlacement(Qt[Xn%Qt.length],Ti,wa,xs,Ml,Te,ye,M,w,$,Xn>=Qt.length?le:"never",Je,m,qn,Ta,Vr);if(Co&&(Mn=Co.placedGlyphBoxes,Mn&&Mn.box&&Mn.box.length)){Dt=!0,$t=Co.shift;break}}return Mn};Ut(()=>Zi(vr,at.iconBox,o.WritingMode.horizontal),()=>{const Ti=at.verticalTextBox;return m.allowVerticalPlacement&&!(ei&&ei.box&&ei.box.length)&&Je.numVerticalGlyphVertices>0&&Ti?Zi(Ti,at.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),ei&&(Dt=ei.box,yt=ei.offscreen);const Xi=Fi(ei&&ei.box);if(!Dt&&this.prevPlacement){const Ti=this.prevPlacement.variableOffsets[Je.crossTileID];Ti&&(this.variableOffsets[Je.crossTileID]=Ti,this.markUsedJustification(m,Ti.anchor,Je,Xi))}}else{const Qt=(Zi,Xi)=>{const Ti=this.collisionIndex.placeCollisionBox(Zi,le,M,w,$.predicate,Vr);return Ti&&Ti.box&&Ti.box.length&&(this.markUsedOrientation(m,Xi,Je),this.placedOrientations[Je.crossTileID]=Xi),Ti};Ut(()=>Qt(vr,o.WritingMode.horizontal),()=>{const Zi=at.verticalTextBox;return m.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&Zi?Qt(Zi,o.WritingMode.vertical):{box:null,offscreen:null}}),Fi(ei&&ei.box&&ei.box.length)}}if(Kt=ei,Dt=Kt&&Kt.box&&Kt.box.length>0,yt=Kt&&Kt.offscreen,Je.useRuntimeCollisionCircles){const Fi=m.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex),Ut=o.evaluateSizeForFeature(m.textSizeData,G,Fi),Qt=y.get("text-padding");ni=this.collisionIndex.placeCollisionCircles(le,Fi,m.lineVertexArray,m.glyphOffsetArray,Ut,w,S,C,u,ye,$.predicate,Je.collisionCircleDiameter,Qt,Vr),ni.circles.length&&ni.collisionDetected&&!u&&o.warnOnce("Collisions detected, but collision boxes are not shown"),Dt=fe||ni.circles.length>0&&!ni.collisionDetected,yt=yt&&ni.offscreen}if(at.iconFeatureIndex&&(rn=at.iconFeatureIndex),at.iconBox){const Fi=Ut=>{const Qt=Pe&&$t?On(Ut,$t.x,$t.y,Te,ye,this.transform.angle):Ut;return this.collisionIndex.placeCollisionBox(Qt,_e,M,w,$.predicate,Vr)};qt&&qt.box&&qt.box.length&&at.verticalIconBox?(qi=Fi(at.verticalIconBox),Ot=qi.box.length>0):(qi=Fi(at.iconBox),Ot=qi.box.length>0),yt=yt&&qi.offscreen}const fn=J||Je.numHorizontalGlyphVertices===0&&Je.numVerticalGlyphVertices===0,Io=Y||Je.numIconVertices===0;if(fn||Io?Io?fn||(Ot=Ot&&Dt):Dt=Ot&&Dt:Ot=Dt=Ot&&Dt,Dt&&Kt&&Kt.box&&this.collisionIndex.insertCollisionBox(Kt.box,le,y.get("text-ignore-placement"),m.bucketInstanceId,qt&&qt.box&&qr?qr:tn,$.ID),Ot&&qi&&this.collisionIndex.insertCollisionBox(qi.box,_e,y.get("icon-ignore-placement"),m.bucketInstanceId,rn,$.ID),ni&&(Dt&&this.collisionIndex.insertCollisionCircles(ni.circles,le,y.get("text-ignore-placement"),m.bucketInstanceId,tn,$.ID),u)){const Fi=m.bucketInstanceId;let Ut=this.collisionCircleArrays[Fi];Ut===void 0&&(Ut=this.collisionCircleArrays[Fi]=new Qr);for(let Qt=0;Qt<ni.circles.length;Qt+=4)Ut.circles.push(ni.circles[Qt+0]),Ut.circles.push(ni.circles[Qt+1]),Ut.circles.push(ni.circles[Qt+2]),Ut.circles.push(ni.collisionDetected?1:0)}if(Je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Je.crossTileID]=new os(Dt||Ne,Ot||Ae,yt||m.justReloaded),s[Je.crossTileID]=!0};if(De){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Je=m.getSortedSymbolIndexes(this.transform.angle);for(let at=Je.length-1;at>=0;--at){const Dt=Je[at];ot(m.symbolInstances.get(Dt),m.collisionArrays[Dt])}}else for(let Je=t.symbolInstanceStart;Je<t.symbolInstanceEnd;Je++)ot(m.symbolInstances.get(Je),m.collisionArrays[Je]);if(u&&m.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[m.bucketInstanceId];o.invert(Je.invProjMatrix,w),Je.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(t,s,u,m){let y;y=m===o.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:u.crossTileID)}markUsedOrientation(t,s,u){const m=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,y=s===o.WritingMode.vertical?s:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of w)t.text.placedSymbolArray.get(S).placedOrientation=m;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,y=s?s.opacities:{},w=s?s.variableOffsets:{},S=s?s.placedOrientations:{};for(const C in this.placements){const M=this.placements[C],B=y[C];B?(this.opacities[C]=new ri(B,m,M.text,M.icon),u=u||M.text!==B.text.placed||M.icon!==B.icon.placed):(this.opacities[C]=new ri(null,m,M.text,M.icon,M.skipFade),u=u||M.text||M.icon)}for(const C in y){const M=y[C];if(!this.opacities[C]){const B=new ri(M,m,!1,!1);B.isHidden()||(this.opacities[C]=B,u=u||M.text.placed||M.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const u={};for(const m of s){const y=m.getBucket(t);y&&m.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,u,m.collisionBoxArray)}}updateBucketOpacities(t,s,u){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,y=new ri(null,0,!1,!1,!0),w=m.get("text-allow-overlap"),S=m.get("icon-allow-overlap"),C=m.get("text-variable-anchor"),M=m.get("text-rotation-alignment")==="map",B=m.get("text-pitch-alignment")==="map",N=m.get("icon-text-fit")!=="none",G=new ri(null,0,w&&(S||!t.hasIconData()||m.get("icon-optional")),S&&(w||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const $=(J,Y,le)=>{for(let fe=0;fe<Y/4;fe++)J.opacityVertexArray.emplaceBack(le)};for(let J=0;J<t.symbolInstances.length;J++){const Y=t.symbolInstances.get(J),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:fe,crossTileID:_e}=Y;let te=this.opacities[_e];s[_e]?te=y:te||(te=G,this.opacities[_e]=te),s[_e]=!0;const Te=Y.numIconVertices>0,ye=this.placedOrientations[Y.crossTileID],Pe=ye===o.WritingMode.vertical,De=ye===o.WritingMode.horizontal||ye===o.WritingMode.horizontalOnly;if(le>0||fe>0){const Ne=he(te.text);$(t.text,le,Pe?Ce:Ne),$(t.text,fe,De?Ce:Ne);const Ae=te.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(at=>{at>=0&&(t.text.placedSymbolArray.get(at).hidden=Ae||Pe?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=Ae||De?1:0);const ot=this.variableOffsets[Y.crossTileID];ot&&this.markUsedJustification(t,ot.anchor,Y,ye);const Je=this.placedOrientations[Y.crossTileID];Je&&(this.markUsedJustification(t,"left",Y,Je),this.markUsedOrientation(t,Je,Y))}if(Te){const Ne=he(te.icon),Ae=!(N&&Y.verticalPlacedIconSymbolIndex&&Pe);Y.placedIconSymbolIndex>=0&&($(t.icon,Y.numIconVertices,Ae?Ne:Ce),t.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=te.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&($(t.icon,Y.numVerticalIconVertices,Ae?Ce:Ne),t.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=te.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ne=t.collisionArrays[J];if(Ne){let Ae=new o.pointGeometry(0,0);if(Ne.textBox||Ne.verticalTextBox){let Je=!0;if(C){const at=this.variableOffsets[_e];at?(Ae=as(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale),M&&Ae._rotate(B?this.transform.angle:-this.transform.angle)):Je=!1}Ne.textBox&&D(t.textCollisionBox.collisionVertexArray,te.text.placed,!Je||Pe,Ae.x,Ae.y),Ne.verticalTextBox&&D(t.textCollisionBox.collisionVertexArray,te.text.placed,!Je||De,Ae.x,Ae.y)}const ot=!!(!De&&Ne.verticalIconBox);Ne.iconBox&&D(t.iconCollisionBox.collisionVertexArray,te.icon.placed,ot,N?Ae.x:0,N?Ae.y:0),Ne.verticalIconBox&&D(t.iconCollisionBox.collisionVertexArray,te.icon.placed,!ot,N?Ae.x:0,N?Ae.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=J.invProjMatrix,t.placementViewportMatrix=J.viewportMatrix,t.collisionCircleArray=J.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function D(f,t,s,u,m){f.emplaceBack(t?1:0,s?1:0,u||0,m||0),f.emplaceBack(t?1:0,s?1:0,u||0,m||0),f.emplaceBack(t?1:0,s?1:0,u||0,m||0),f.emplaceBack(t?1:0,s?1:0,u||0,m||0)}const O=Math.pow(2,25),H=Math.pow(2,24),W=Math.pow(2,17),ne=Math.pow(2,16),ce=Math.pow(2,9),oe=Math.pow(2,8),se=Math.pow(2,1);function he(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,s=Math.floor(127*f.opacity);return s*O+t*H+s*W+t*ne+s*ce+t*oe+s*se+t}const Ce=0;class Ve{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,u,m,y){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(w,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<w.length;)if(s.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1}}class Ie{constructor(t,s,u,m,y,w,S,C){this.placement=new K(t,s,w,S,C),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,s,u){const m=o.exported.now(),y=()=>{const w=o.exported.now()-m;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=s[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ve(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ut=512/o.EXTENT/2;class ft{constructor(t,s,u){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(let m=0;m<s.length;m++){const y=s.get(m),w=y.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,t)})}}getScaledCoordinates(t,s){const u=ut/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+t.anchorX)*u),y:Math.floor((s.canonical.y*o.EXTENT+t.anchorY)*u)}}findMatches(t,s,u){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<t.length;y++){const w=t.get(y);if(w.crossTileID)continue;const S=this.indexedSymbolInstances[w.key];if(!S)continue;const C=this.getScaledCoordinates(w,s);for(const M of S)if(Math.abs(M.coord.x-C.x)<=m&&Math.abs(M.coord.y-C.y)<=m&&!u[M.crossTileID]){u[M.crossTileID]=!0,w.crossTileID=M.crossTileID;break}}}}class rt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const u in this.indexes){const m=this.indexes[u],y={};for(const w in m){const S=m[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+s),y[S.tileID.key]=S}this.indexes[u]=y}this.lng=t}addBucket(t,s,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>t.overscaledZ)for(const S in w){const C=w[S];C.tileID.isChildOf(t)&&C.findMatches(s.symbolInstances,t,m)}else{const S=w[t.scaledTo(Number(y)).key];S&&S.findMatches(s.symbolInstances,t,m)}}for(let y=0;y<s.symbolInstances.length;y++){const w=s.symbolInstances.get(y);w.crossTileID||(w.crossTileID=u.generate(),m[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ft(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const u in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[u])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let s=!1;for(const u in this.indexes){const m=this.indexes[u];for(const y in m)t[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,m[y]),delete m[y],s=!0)}return s}}class It{constructor(){this.layerIndexes={},this.crossTileIDs=new rt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,u){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new wt);let y=!1;const w={};m.handleWrapJump(u);for(const S of s){const C=S.getBucket(t);C&&t.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(S.tileID,C,this.crossTileIDs)&&(y=!0),w[C.bucketInstanceId]=!0)}return m.removeStaleBuckets(w)&&(y=!0),y}pruneUnusedLayers(t){const s={};t.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}var Ht=o.createLayout([{name:"a_pos",type:"Int16",components:2}]);class At extends o.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const s=this._tiles[t];s.textures.forEach(u=>u.destroy()),s.textures=[]}}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),o.ortho(u.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[u.key]=new gr(u,this.tileSize))}removeOutdated(t){const s={};this.renderHistory=this.renderHistory.filter((u,m)=>this.renderHistory.indexOf(u)===m).slice(0,this.renderHistorySize);for(const u of this._renderableTilesKeys)s[u]=!0;for(const u of this.renderHistory)s[u]=!0;for(const u in this._tiles)s[u]||(this._tiles[u].clearTextures(t),delete this._tiles[u])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const u of this._renderableTilesKeys){const m=this._tiles[u].tileID;if(m.canonical.equals(t.canonical)){const y=t.clone();y.posMatrix=new Float64Array(16),o.ortho(y.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),s[u]=y}else if(m.canonical.isChildOf(t.canonical)){const y=t.clone();y.posMatrix=new Float64Array(16);const w=m.canonical.z-t.canonical.z,S=m.canonical.x-(m.canonical.x>>w<<w),C=m.canonical.y-(m.canonical.y>>w<<w),M=o.EXTENT>>w;o.ortho(y.posMatrix,0,M,0,M,0,1),o.translate(y.posMatrix,y.posMatrix,[-S*M,-C*M,0]),s[u]=y}else if(t.canonical.isChildOf(m.canonical)){const y=t.clone();y.posMatrix=new Float64Array(16);const w=t.canonical.z-m.canonical.z,S=t.canonical.x-(t.canonical.x>>w<<w),C=t.canonical.y-(t.canonical.y>>w<<w),M=o.EXTENT>>w;o.ortho(y.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(y.posMatrix,y.posMatrix,[S*M,C*M,0]),o.scale(y.posMatrix,y.posMatrix,[1/2**w,1/2**w,0]),s[u]=y}}return s}getSourceTile(t,s){const u=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>u.maxzoom&&(m=u.maxzoom),m<u.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!y||!y.dem)&&s)for(;m>=u.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(t.scaledTo(m--).key);return y}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=t)}}class Ft{constructor(t,s,u){this.style=t,this.sourceCache=new At(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.elevationOffset=typeof u.elevationOffset=="number"?u.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,s,u,m=o.EXTENT){if(!(s>=0&&s<m&&u>=0&&u<m))return this.elevationOffset;let y=0;const w=this.getTerrainData(t);if(w.tile&&w.tile.dem){const S=o.transformMat4$1([],[s/m*o.EXTENT,u/m*o.EXTENT],w.u_terrain_matrix),C=[S[0]*w.tile.dem.dim,S[1]*w.tile.dem.dim],M=[Math.floor(C[0]),Math.floor(C[1])],B=w.tile.dem.get(M[0],M[1]),N=w.tile.dem.get(M[0],M[1]+1),G=w.tile.dem.get(M[0]+1,M[1]),$=w.tile.dem.get(M[0]+1,M[1]+1);y=o.number(o.number(B,N,C[0]-M[0]),o.number(G,$,C[0]-M[0]),C[1]-M[1])}return y}rememberForRerender(t,s){for(const u in this.sourceCache._tiles){const m=this.sourceCache._tiles[u];(m.tileID.equals(s)||m.tileID.isChildOf(s))&&(t===this.sourceCache.sourceCache.id&&(m.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][m.tileID.key]=!0)}}needsRerender(t,s){return this._rerender[t]&&this._rerender[t][s.key]}clearRerenderCache(){this._rerender={}}getElevation(t,s,u,m=o.EXTENT){return(this.getDEMElevation(t,s,u,m)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.style.map.painter.context,y=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new F(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new F(m,new o.RGBAImage({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const m=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new F(m,s.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),s.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s+s.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?y=t.canonical.z-m:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>y<<y),S=t.canonical.y-(t.canonical.y>>y<<y),C=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<y),1/(o.EXTENT<<y),0]);o.translate(C,C,[w*o.EXTENT,S*o.EXTENT,0]),this._demMatrixCache[t.key]={matrix:C,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(t){const s=this.style.map.painter,u=s.width/devicePixelRatio,m=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new F(s.context,{width:u,height:m,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new F(s.context,{width:u,height:m,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,m,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,w=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)s[w+0]=255&S,s[w+1]=255&y,s[w+2]=S>>8<<4|y>>8,s[w+3]=0;const u=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),m=new F(t,u,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){const s=new Uint8Array(4),u=this.style.map.painter,m=u.context,y=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(t.x,u.height/devicePixelRatio-t.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,s),m.bindFramebuffer.set(null);const w=s[0]+(s[2]>>4<<8),S=s[1]+((15&s[2])<<8),C=this.coordsIndex[255-s[3]],M=C&&this.sourceCache.getTileByID(C);if(!M)return null;const B=this._coordsTextureSize,N=(1<<M.tileID.canonical.z)*B;return new o.MercatorCoordinate((M.tileID.canonical.x*B+w)/N,(M.tileID.canonical.y*B+S)/N,this.getElevation(M.tileID,w,S,B))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,s=new o.PosArray,u=new o.TriangleIndexArray,m=this.meshSize,y=o.EXTENT/m,w=m*m;for(let S=0;S<=m;S++)for(let C=0;C<=m;C++)s.emplaceBack(C*y,S*y);for(let S=0;S<w;S+=m+1)for(let C=0;C<m;C++)u.emplaceBack(C+S,m+C+S+1,m+C+S+2),u.emplaceBack(C+S,m+C+S+2,C+S+1);return this._mesh={indexBuffer:t.createIndexBuffer(u),vertexBuffer:t.createVertexBuffer(s,Ht.members),segments:o.SegmentVector.simpleSegment(0,0,s.length,u.length)},this._mesh}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,u.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),u}}const Wt=(f,t)=>o.emitValidationErrors(f,t&&t.filter(s=>s.identifier!=="source.canvas")),oi=o.pick(Zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Gi=o.pick(Zt,["setCenter","setZoom","setBearing","setPitch"]),vi=function(){const f={},t=o.spec.$version;for(const s in o.spec.$root){const u=o.spec.$root[s];if(u.required){let m=null;m=s==="version"?t:u.type==="array"?[]:{},m!=null&&(f[s]=m)}}return f}();class sr extends o.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new dt(is(),this),this.imageManager=new pe,this.imageManager.setEventedParent(this),this.glyphManager=new ze(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new zt(256,512),this.crossTileSymbolIndex=new It,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const u=this;this._rtlTextPluginCallback=sr.registerForPluginStateChange(m=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,w)=>{if(o.triggerPluginCompletionEvent(y),w&&w.every(S=>S))for(const S in u.sourceCaches)u.sourceCaches[S].reload()})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.sourceCaches[m.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===w.id&&this._validateLayer(C)}})}loadURL(t,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const u=typeof s.validate!="boolean"||s.validate,m=this.map._requestManager.transformRequest(t,o.ResourceType.Style);this._request=o.getJSON(m,(y,w)=>{this._request=null,y?this.fire(new o.ErrorEvent(y)):w&&this._load(w,u)})}loadJSON(t,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(vi,!1)}_load(t,s){if(s&&Wt(this,o.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const u=Cs(this.stylesheet.layers);this._order=u.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of u)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ue(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,u,m,y){let w,S,C;const M=m>1?"@2x":"";let B=o.getJSON(u.transformRequest(u.normalizeSpriteURL(s,M,".json"),o.ResourceType.SpriteJSON),($,J)=>{B=null,C||(C=$,w=J,G())}),N=o.getImage(u.transformRequest(u.normalizeSpriteURL(s,M,".png"),o.ResourceType.SpriteImage),($,J)=>{N=null,C||(C=$,S=J,G())});function G(){if(C)y(C);else if(w&&S){const $=o.exported.getImageData(S),J={};for(const Y in w){const{width:le,height:fe,x:_e,y:te,sdf:Te,pixelRatio:ye,stretchX:Pe,stretchY:De,content:Ne}=w[Y],Ae=new o.RGBAImage({width:le,height:fe});o.RGBAImage.copy($,Ae,{x:_e,y:te},{x:0,y:0},{width:le,height:fe}),J[Y]={data:Ae,pixelRatio:ye,sdf:Te,stretchX:Pe,stretchY:De,content:Ne}}y(null,J)}}return{cancel(){B&&(B.cancel(),B=null),N&&(N.cancel(),N=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(s,u)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(u)for(const m in u)this.imageManager.addImage(m,u[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const u=t.sourceLayer;if(!u)return;const m=s.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const u of t){const m=this._layers[u];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const u={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];u[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in u){const y=this.sourceCaches[m];u[m]!==y.used&&y.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const s=this.sourceCaches[t.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new Ft(this,s,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=u=>{u.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=u=>{u.tile&&(u.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(u.sourceId,u.tile.tileID)):u.source.type==="geojson"&&this.terrain.rememberForRerender(u.sourceId,u.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new o.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),Wt(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=Cs(t.layers);const s=function(m,y){if(!m)return[{command:Zt.setStyle,args:[y]}];let w=[];try{if(!P(m.version,y.version))return[{command:Zt.setStyle,args:[y]}];P(m.center,y.center)||w.push({command:Zt.setCenter,args:[y.center]}),P(m.zoom,y.zoom)||w.push({command:Zt.setZoom,args:[y.zoom]}),P(m.bearing,y.bearing)||w.push({command:Zt.setBearing,args:[y.bearing]}),P(m.pitch,y.pitch)||w.push({command:Zt.setPitch,args:[y.pitch]}),P(m.sprite,y.sprite)||w.push({command:Zt.setSprite,args:[y.sprite]}),P(m.glyphs,y.glyphs)||w.push({command:Zt.setGlyphs,args:[y.glyphs]}),P(m.transition,y.transition)||w.push({command:Zt.setTransition,args:[y.transition]}),P(m.light,y.light)||w.push({command:Zt.setLight,args:[y.light]});const S={},C=[];(function(B,N,G,$){let J;for(J in N=N||{},B=B||{})Object.prototype.hasOwnProperty.call(B,J)&&(Object.prototype.hasOwnProperty.call(N,J)||xn(J,G,$));for(J in N)Object.prototype.hasOwnProperty.call(N,J)&&(Object.prototype.hasOwnProperty.call(B,J)?P(B[J],N[J])||(B[J].type==="geojson"&&N[J].type==="geojson"&&As(B,N,J)?G.push({command:Zt.setGeoJSONSourceData,args:[J,N[J].data]}):bn(J,N,G,$)):Yr(J,N,G))})(m.sources,y.sources,C,S);const M=[];m.layers&&m.layers.forEach(B=>{S[B.source]?w.push({command:Zt.removeLayer,args:[B.id]}):M.push(B)}),w=w.concat(C),function(B,N,G){N=N||[];const $=(B=B||[]).map(an),J=N.map(an),Y=B.reduce(ns,{}),le=N.reduce(ns,{}),fe=$.slice(),_e=Object.create(null);let te,Te,ye,Pe,De,Ne,Ae;for(te=0,Te=0;te<$.length;te++)ye=$[te],Object.prototype.hasOwnProperty.call(le,ye)?Te++:(G.push({command:Zt.removeLayer,args:[ye]}),fe.splice(fe.indexOf(ye,Te),1));for(te=0,Te=0;te<J.length;te++)ye=J[J.length-1-te],fe[fe.length-1-te]!==ye&&(Object.prototype.hasOwnProperty.call(Y,ye)?(G.push({command:Zt.removeLayer,args:[ye]}),fe.splice(fe.lastIndexOf(ye,fe.length-Te),1)):Te++,Ne=fe[fe.length-te],G.push({command:Zt.addLayer,args:[le[ye],Ne]}),fe.splice(fe.length-te,0,ye),_e[ye]=!0);for(te=0;te<J.length;te++)if(ye=J[te],Pe=Y[ye],De=le[ye],!_e[ye]&&!P(Pe,De))if(P(Pe.source,De.source)&&P(Pe["source-layer"],De["source-layer"])&&P(Pe.type,De.type)){for(Ae in on(Pe.layout,De.layout,G,ye,null,Zt.setLayoutProperty),on(Pe.paint,De.paint,G,ye,null,Zt.setPaintProperty),P(Pe.filter,De.filter)||G.push({command:Zt.setFilter,args:[ye,De.filter]}),P(Pe.minzoom,De.minzoom)&&P(Pe.maxzoom,De.maxzoom)||G.push({command:Zt.setLayerZoomRange,args:[ye,De.minzoom,De.maxzoom]}),Pe)Object.prototype.hasOwnProperty.call(Pe,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?on(Pe[Ae],De[Ae],G,ye,Ae.slice(6),Zt.setPaintProperty):P(Pe[Ae],De[Ae])||G.push({command:Zt.setLayerProperty,args:[ye,Ae,De[Ae]]}));for(Ae in De)Object.prototype.hasOwnProperty.call(De,Ae)&&!Object.prototype.hasOwnProperty.call(Pe,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?on(Pe[Ae],De[Ae],G,ye,Ae.slice(6),Zt.setPaintProperty):P(Pe[Ae],De[Ae])||G.push({command:Zt.setLayerProperty,args:[ye,Ae,De[Ae]]}))}else G.push({command:Zt.removeLayer,args:[ye]}),Ne=fe[fe.lastIndexOf(ye)+1],G.push({command:Zt.addLayer,args:[De,Ne]})}(M,y.layers,w)}catch(S){console.warn("Unable to compute style diff:",S),w=[{command:Zt.setStyle,args:[y]}]}return w}(this.serialize(),t).filter(m=>!(m.command in Gi));if(s.length===0)return!1;const u=s.filter(m=>!(m.command in oi));if(u.length>0)throw new Error(`Unimplemented: ${u.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,u={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateStyle.source,`sources.${t}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=this.sourceCaches[t]=new Xe(t,s,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.sourceCaches[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,u={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer "${m}" already exists on this map.`)));let y;if(t.type==="custom"){if(Wt(this,o.validateCustomStyleLayer(t)))return;y=o.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=o.clone$1(t),t=o.extend(t,{source:m})),this._validate(o.validateStyle.layer,`layers.${m}`,t,{arrayIndex:-1},u))return;y=o.createStyleLayer(t),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[y.id]=y.serialize()}const w=s?this._order.indexOf(s):this._order.length;if(s&&w===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${m}" before non-existing layer "${s}".`)));else{if(this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const S=this._removedLayers[m];delete this._removedLayers[m],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const u=this._order.indexOf(t);this._order.splice(u,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,u){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===s&&m.maxzoom===u||(s!=null&&(m.minzoom=s),u!=null&&(m.maxzoom=u),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,u={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!P(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateStyle.filter,`layers.${m.id}.filter`,s,null,u)||(m.filter=o.clone$1(s),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,s,u,m={}){this._checkLoaded();const y=this.getLayer(t);y?P(y.getLayoutProperty(s),u)||(y.setLayoutProperty(s,u,m),this._updateLayer(y)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const u=this.getLayer(t);if(u)return u.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,u,m={}){this._checkLoaded();const y=this.getLayer(t);y?P(y.getPaintProperty(s),u)||(y.setPaintProperty(s,u,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const u=t.source,m=t.sourceLayer,y=this.sourceCaches[u];if(y===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const w=y.getSource().type;w==="geojson"&&m?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||m?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,t.id,s)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const u=t.source,m=this.sourceCaches[u];if(m===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const y=m.getSource().type,w=y==="vector"?t.sourceLayer:void 0;y!=="vector"||w?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(w,t.id,s):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,u=t.sourceLayer,m=this.sourceCaches[s];if(m!==void 0)return m.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),m.getFeatureState(u,t.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=w=>this._layers[w].type==="fill-extrusion",u={},m=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(s(S)){u[S]=w;for(const C of t){const M=C[S];if(M)for(const B of M)m.push(B)}}}m.sort((w,S)=>S.intersectionZ-w.intersectionZ);const y=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(s(S))for(let C=m.length-1;C>=0;C--){const M=m[C].feature;if(u[M.layer.id]<w)break;y.push(M),m.pop()}else for(const C of t){const M=C[S];if(M)for(const B of M)y.push(B.feature)}}return y}queryRenderedFeatures(t,s,u){s&&s.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const S=this._layers[w];if(!S)return this.fire(new o.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];m[S.source]=!0}}const y=[];s.availableImages=this._availableImages;for(const w in this.sourceCaches)s.layers&&!m[w]||y.push(Ui(this.sourceCaches[w],this._layers,this._serializedLayers,t,s,u));return this.placement&&y.push(function(w,S,C,M,B,N,G){const $={},J=N.queryRenderedSymbols(M),Y=[];for(const le of Object.keys(J).map(Number))Y.push(G[le]);Y.sort(Ki);for(const le of Y){const fe=le.featureIndex.lookupSymbolFeatures(J[le.bucketInstanceId],S,le.bucketIndex,le.sourceLayerIndex,B.filter,B.layers,B.availableImages,w);for(const _e in fe){const te=$[_e]=$[_e]||[],Te=fe[_e];Te.sort((ye,Pe)=>{const De=le.featureSortOrder;if(De){const Ne=De.indexOf(ye.featureIndex);return De.indexOf(Pe.featureIndex)-Ne}return Pe.featureIndex-ye.featureIndex});for(const ye of Te)te.push(ye)}}for(const le in $)$[le].forEach(fe=>{const _e=fe.feature,te=C[w[le].source].getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=te});return $}(this._layers,this._serializedLayers,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,s){s&&s.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.sourceCaches[t];return u?function(m,y){const w=m.getRenderableIds().map(M=>m.getTileByID(M)),S=[],C={};for(let M=0;M<w.length;M++){const B=w[M],N=B.tileID.canonical.key;C[N]||(C[N]=!0,B.querySourceFeatures(S,y))}return S}(u,s):[]}addSourceType(t,s,u){return sr.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(sr.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const u=this.light.getLight();let m=!1;for(const w in t)if(!P(t[w],u[w])){m=!0;break}if(!m)return;const y={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(y)}_validate(t,s,u,m,y={}){return(!y||y.validate!==!1)&&Wt(this,t.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:u,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const s=this.sourceCaches[t];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,u,m,y=!1){let w=!1,S=!1;const C={};for(const M of this._order){const B=this._layers[M];if(B.type!=="symbol")continue;if(!C[B.source]){const G=this.sourceCaches[B.source];C[B.source]=G.getRenderableIds(!0).map($=>G.getTileByID($)).sort(($,J)=>J.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(J.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(B,C[B.source],t.center.lng);w=w||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),t.zoom))&&(this.pauseablePlacement=new Ie(t,this.terrain,this._order,y,s,u,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const M of this._order){const B=this._layers[M];B.type==="symbol"&&this.placement.updateLayerOpacities(B,C[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,u){this.imageManager.getImages(s.icons,u),this._updateTilesForChangedImages();const m=this.sourceCaches[s.source];m&&m.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,u){this.glyphManager.getGlyphs(s.stacks,u)}getResource(t,s,u){return o.makeRequest(s,u)}}sr.getSourceType=function(f){return Ai[f]},sr.setSourceType=function(f,t){Ai[f]=t},sr.registerForPluginStateChange=o.registerForPluginStateChange;var ls="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const zs={prelude:ai(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ai(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ai(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ai(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ai(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ai("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ai(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ai(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ai(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ai(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ai(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ai(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ai(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ai(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ai(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ai(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ai(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ai("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ls),terrainDepth:ai("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ls),terrainCoords:ai("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ls)};function ai(f,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/attribute ([\w]+) ([\w]+)/g),m=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=y?y.concat(m):m,S={};return{fragmentSource:f=f.replace(s,(C,M,B,N,G)=>(S[G]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${G}
varying ${B} ${N} ${G};
#else
uniform ${B} ${N} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${B} ${N} ${G} = u_${G};
#endif
`)),vertexSource:t=t.replace(s,(C,M,B,N,G)=>{const $=N==="float"?"vec2":"vec4",J=G.match(/color/)?"color":$;return S[G]?M==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${$} a_${G};
varying ${B} ${N} ${G};
#else
uniform ${B} ${N} u_${G};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${B} ${N} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${J}(a_${G}, u_${G}_t);
#else
    ${B} ${N} ${G} = u_${G};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${$} a_${G};
#else
uniform ${B} ${N} u_${G};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${N} ${G} = a_${G};
#else
    ${B} ${N} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${N} ${G} = unpack_mix_${J}(a_${G}, u_${G}_t);
#else
    ${B} ${N} ${G} = u_${G};
#endif
`}),staticAttributes:u,staticUniforms:w}}class qo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,u,m,y,w,S,C,M){this.context=t;let B=this.boundPaintVertexBuffers.length!==m.length;for(let N=0;!B&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(B=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===u&&!B&&this.boundIndexBuffer===y&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===C&&this.boundDynamicVertexBuffer3===M?(t.bindVertexArrayOES.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),C&&C.bind(),M&&M.bind()):this.freshBind(s,u,m,y,w,S,C,M)}freshBind(t,s,u,m,y,w,S,C){let M;const B=t.numAttributes,N=this.context,G=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=C;else{M=N.currentNumAttributes||0;for(let $=B;$<M;$++)G.disableVertexAttribArray($)}s.enableAttributes(G,t);for(const $ of u)$.enableAttributes(G,t);w&&w.enableAttributes(G,t),S&&S.enableAttributes(G,t),C&&C.enableAttributes(G,t),s.bind(),s.setVertexAttribPointers(G,t,y);for(const $ of u)$.bind(),$.setVertexAttribPointers(G,t,y);w&&(w.bind(),w.setVertexAttribPointers(G,t,y)),m&&m.bind(),S&&(S.bind(),S.setVertexAttribPointers(G,t,y)),C&&(C.bind(),C.setVertexAttribPointers(G,t,y)),N.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Zo(f){const t=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const u=f[s].split(" ");t.push(u.pop())}return t}class Ha{constructor(t,s,u,m,y,w,S){const C=t.gl;this.program=C.createProgram();const M=Zo(u.staticAttributes),B=m?m.getBinderAttributes():[],N=M.concat(B),G=zs.prelude.staticUniforms?Zo(zs.prelude.staticUniforms):[],$=u.staticUniforms?Zo(u.staticUniforms):[],J=m?m.getBinderUniforms():[],Y=G.concat($).concat(J),le=[];for(const De of Y)le.indexOf(De)<0&&le.push(De);const fe=m?m.defines():[];w&&fe.push("#define OVERDRAW_INSPECTOR;"),S&&fe.push("#define TERRAIN3D;");const _e=fe.concat(zs.prelude.fragmentSource,u.fragmentSource).join(`
`),te=fe.concat(zs.prelude.vertexSource,u.vertexSource).join(`
`),Te=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Te,_e),C.compileShader(Te),C.attachShader(this.program,Te);const ye=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(ye,te),C.compileShader(ye),C.attachShader(this.program,ye),this.attributes={};const Pe={};this.numAttributes=N.length;for(let De=0;De<this.numAttributes;De++)N[De]&&(C.bindAttribLocation(this.program,De,N[De]),this.attributes[N[De]]=De);C.linkProgram(this.program),C.deleteShader(ye),C.deleteShader(Te);for(let De=0;De<le.length;De++){const Ne=le[De];if(Ne&&!Pe[Ne]){const Ae=C.getUniformLocation(this.program,Ne);Ae&&(Pe[Ne]=Ae)}}this.fixedUniforms=y(t,Pe),this.terrainUniforms=((De,Ne)=>({u_depth:new o.Uniform1i(De,Ne.u_depth),u_terrain:new o.Uniform1i(De,Ne.u_terrain),u_terrain_dim:new o.Uniform1f(De,Ne.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(De,Ne.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(De,Ne.u_terrain_unpack),u_terrain_offset:new o.Uniform1f(De,Ne.u_terrain_offset),u_terrain_exaggeration:new o.Uniform1f(De,Ne.u_terrain_exaggeration)}))(t,Pe),this.binderUniforms=m?m.getUniforms(t,Pe):[]}draw(t,s,u,m,y,w,S,C,M,B,N,G,$,J,Y,le,fe,_e){const te=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(m),t.setColorMode(y),t.setCullFace(w),C){t.activeTexture.set(te.TEXTURE2),te.bindTexture(te.TEXTURE_2D,C.depthTexture),t.activeTexture.set(te.TEXTURE3),te.bindTexture(te.TEXTURE_2D,C.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(C[ye])}for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(S[ye]);Y&&Y.setUniforms(t,this.binderUniforms,$,{zoom:J});let Te=0;switch(s){case te.LINES:Te=2;break;case te.TRIANGLES:Te=3;break;case te.LINE_STRIP:Te=1}for(const ye of G.get()){const Pe=ye.vaos||(ye.vaos={});(Pe[M]||(Pe[M]=new qo)).bind(t,this,B,Y?Y.getPaintVertexBuffers():[],N,ye.vertexOffset,le,fe,_e),te.drawElements(s,ye.primitiveLength*Te,te.UNSIGNED_SHORT,ye.primitiveOffset*Te*2)}}}function Wa(f,t,s){const u=1/Pi(s,1,t.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,t.transform.tileZoom)/m,w=y*(s.tileID.canonical.x+s.tileID.wrap*m),S=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const Xo=(f,t,s,u)=>{const m=t.style.light,y=m.properties.get("position"),w=[y.x,y.y,y.z],S=o.create$1();m.properties.get("anchor")==="viewport"&&o.fromRotation(S,-t.transform.angle),o.transformMat3(w,w,S);const C=m.properties.get("color");return{u_matrix:f,u_lightpos:w,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+s,u_opacity:u}},fc=(f,t,s,u,m,y,w)=>o.extend(Xo(f,t,s,u),Wa(y,t,w),{u_height_factor:-Math.pow(2,m.overscaledZ)/w.tileSize/8}),ao=f=>({u_matrix:f}),Ho=(f,t,s,u)=>o.extend(ao(f),Wa(s,t,u)),Ka=(f,t)=>({u_matrix:f,u_world:t}),Ja=(f,t,s,u,m)=>o.extend(Ho(f,t,s,u),{u_world:m}),Ya=(f,t,s,u)=>{const m=f.transform;let y,w;if(u.paint.get("circle-pitch-alignment")==="map"){const S=Pi(s,1,m.zoom);y=!0,w=[S,S]}else y=!1,w=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(t.posMatrix,s,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:w}},Vn=(f,t,s)=>{const u=Pi(s,1,t.zoom),m=Math.pow(2,t.zoom-s.tileID.overscaledZ),y=s.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[t.pixelsToGLUnits[0]/(u*m),t.pixelsToGLUnits[1]/(u*m)],u_overscale_factor:y}},Ms=(f,t,s=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:s}),cs=f=>({u_matrix:f}),lo=(f,t,s,u)=>({u_matrix:f,u_extrude_scale:Pi(t,1,s),u_intensity:u});function co(f,t){const s=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new o.MercatorCoordinate(0,u/s).toLngLat().lat,new o.MercatorCoordinate(0,(u+1)/s).toLngLat().lat]}const us=(f,t,s,u)=>{const m=f.transform;return{u_matrix:Ds(f,t,s,u),u_ratio:1/Pi(t,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Wo=(f,t,s,u,m)=>o.extend(us(f,t,s,m),{u_image:0,u_image_height:u}),uo=(f,t,s,u,m)=>{const y=f.transform,w=xi(t,y);return{u_matrix:Ds(f,t,s,m),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Pi(t,1,y.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[w,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Ps=(f,t,s,u,m,y)=>{const w=f.lineAtlas,S=xi(t,f.transform),C=s.layout.get("line-cap")==="round",M=w.getDash(u.from,C),B=w.getDash(u.to,C),N=M.width*m.fromScale,G=B.width*m.toScale;return o.extend(us(f,t,s,y),{u_patternscale_a:[S/N,-M.height/2],u_patternscale_b:[S/G,-B.height/2],u_sdfgamma:w.width/(256*Math.min(N,G)*f.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:B.y,u_mix:m.t})};function xi(f,t){return 1/Pi(f,1,t.tileZoom)}function Ds(f,t,s,u){return f.translatePosMatrix(u?u.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Qa=(f,t,s,u,m)=>{return{u_matrix:f,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(w=m.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(y=m.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:$a(m.paint.get("raster-hue-rotate"))};var y,w};function $a(f){f*=Math.PI/180;const t=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Ko=(f,t,s,u,m,y,w,S,C,M)=>{const B=m.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:B.width/B.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+u,u_texsize:M,u_texture:0}},ho=(f,t,s,u,m,y,w,S,C,M,B)=>{const N=m.transform;return o.extend(Ko(f,t,s,u,m,y,w,S,C,M),{u_gamma_scale:u?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+B})},el=(f,t,s,u,m,y,w,S,C,M)=>o.extend(ho(f,t,s,u,m,y,w,S,!0,C,!0),{u_texsize_icon:M,u_texture_icon:1}),dc=(f,t,s)=>({u_matrix:f,u_opacity:t,u_color:s}),pc=(f,t,s,u,m,y)=>o.extend(function(w,S,C,M){const B=C.imageManager.getPattern(w.from.toString()),N=C.imageManager.getPattern(w.to.toString()),{width:G,height:$}=C.imageManager.getPixelSize(),J=Math.pow(2,M.tileID.overscaledZ),Y=M.tileSize*Math.pow(2,C.transform.tileZoom)/J,le=Y*(M.tileID.canonical.x+M.tileID.wrap*J),fe=Y*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[G,$],u_mix:S.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Pi(M,1,C.transform.tileZoom),u_pixel_coord_upper:[le>>16,fe>>16],u_pixel_coord_lower:[65535&le,65535&fe]}}(u,y,s,m),{u_matrix:f,u_opacity:t}),Jo={fillExtrusion:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_lightpos:new o.Uniform3f(f,t.u_lightpos),u_lightintensity:new o.Uniform1f(f,t.u_lightintensity),u_lightcolor:new o.Uniform3f(f,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(f,t.u_vertical_gradient),u_opacity:new o.Uniform1f(f,t.u_opacity)}),fillExtrusionPattern:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_lightpos:new o.Uniform3f(f,t.u_lightpos),u_lightintensity:new o.Uniform1f(f,t.u_lightintensity),u_lightcolor:new o.Uniform3f(f,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(f,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(f,t.u_height_factor),u_image:new o.Uniform1i(f,t.u_image),u_texsize:new o.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(f,t.u_scale),u_fade:new o.Uniform1f(f,t.u_fade),u_opacity:new o.Uniform1f(f,t.u_opacity)}),fill:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix)}),fillPattern:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_image:new o.Uniform1i(f,t.u_image),u_texsize:new o.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(f,t.u_scale),u_fade:new o.Uniform1f(f,t.u_fade)}),fillOutline:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_world:new o.Uniform2f(f,t.u_world)}),fillOutlinePattern:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_world:new o.Uniform2f(f,t.u_world),u_image:new o.Uniform1i(f,t.u_image),u_texsize:new o.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(f,t.u_scale),u_fade:new o.Uniform1f(f,t.u_fade)}),circle:(f,t)=>({u_camera_to_center_distance:new o.Uniform1f(f,t.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(f,t.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(f,t.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(f,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(f,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(f,t.u_matrix)}),collisionBox:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(f,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(f,t.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(f,t.u_extrude_scale),u_overscale_factor:new o.Uniform1f(f,t.u_overscale_factor)}),collisionCircle:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(f,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(f,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(f,t.u_viewport_size)}),debug:(f,t)=>({u_color:new o.UniformColor(f,t.u_color),u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_overlay:new o.Uniform1i(f,t.u_overlay),u_overlay_scale:new o.Uniform1f(f,t.u_overlay_scale)}),clippingMask:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix)}),heatmap:(f,t)=>({u_extrude_scale:new o.Uniform1f(f,t.u_extrude_scale),u_intensity:new o.Uniform1f(f,t.u_intensity),u_matrix:new o.UniformMatrix4f(f,t.u_matrix)}),heatmapTexture:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_world:new o.Uniform2f(f,t.u_world),u_image:new o.Uniform1i(f,t.u_image),u_color_ramp:new o.Uniform1i(f,t.u_color_ramp),u_opacity:new o.Uniform1f(f,t.u_opacity)}),hillshade:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_image:new o.Uniform1i(f,t.u_image),u_latrange:new o.Uniform2f(f,t.u_latrange),u_light:new o.Uniform2f(f,t.u_light),u_shadow:new o.UniformColor(f,t.u_shadow),u_highlight:new o.UniformColor(f,t.u_highlight),u_accent:new o.UniformColor(f,t.u_accent)}),hillshadePrepare:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_image:new o.Uniform1i(f,t.u_image),u_dimension:new o.Uniform2f(f,t.u_dimension),u_zoom:new o.Uniform1f(f,t.u_zoom),u_unpack:new o.Uniform4f(f,t.u_unpack)}),line:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_ratio:new o.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(f,t.u_units_to_pixels)}),lineGradient:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_ratio:new o.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(f,t.u_units_to_pixels),u_image:new o.Uniform1i(f,t.u_image),u_image_height:new o.Uniform1f(f,t.u_image_height)}),linePattern:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_texsize:new o.Uniform2f(f,t.u_texsize),u_ratio:new o.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(f,t.u_device_pixel_ratio),u_image:new o.Uniform1i(f,t.u_image),u_units_to_pixels:new o.Uniform2f(f,t.u_units_to_pixels),u_scale:new o.Uniform3f(f,t.u_scale),u_fade:new o.Uniform1f(f,t.u_fade)}),lineSDF:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_ratio:new o.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(f,t.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(f,t.u_patternscale_a),u_patternscale_b:new o.Uniform2f(f,t.u_patternscale_b),u_sdfgamma:new o.Uniform1f(f,t.u_sdfgamma),u_image:new o.Uniform1i(f,t.u_image),u_tex_y_a:new o.Uniform1f(f,t.u_tex_y_a),u_tex_y_b:new o.Uniform1f(f,t.u_tex_y_b),u_mix:new o.Uniform1f(f,t.u_mix)}),raster:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_tl_parent:new o.Uniform2f(f,t.u_tl_parent),u_scale_parent:new o.Uniform1f(f,t.u_scale_parent),u_buffer_scale:new o.Uniform1f(f,t.u_buffer_scale),u_fade_t:new o.Uniform1f(f,t.u_fade_t),u_opacity:new o.Uniform1f(f,t.u_opacity),u_image0:new o.Uniform1i(f,t.u_image0),u_image1:new o.Uniform1i(f,t.u_image1),u_brightness_low:new o.Uniform1f(f,t.u_brightness_low),u_brightness_high:new o.Uniform1f(f,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(f,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(f,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(f,t.u_spin_weights)}),symbolIcon:(f,t)=>({u_is_size_zoom_constant:new o.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(f,t.u_size_t),u_size:new o.Uniform1f(f,t.u_size),u_camera_to_center_distance:new o.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(f,t.u_pitch),u_rotate_symbol:new o.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(f,t.u_fade_change),u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new o.Uniform1i(f,t.u_is_text),u_pitch_with_map:new o.Uniform1i(f,t.u_pitch_with_map),u_texsize:new o.Uniform2f(f,t.u_texsize),u_texture:new o.Uniform1i(f,t.u_texture)}),symbolSDF:(f,t)=>({u_is_size_zoom_constant:new o.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(f,t.u_size_t),u_size:new o.Uniform1f(f,t.u_size),u_camera_to_center_distance:new o.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(f,t.u_pitch),u_rotate_symbol:new o.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(f,t.u_fade_change),u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new o.Uniform1i(f,t.u_is_text),u_pitch_with_map:new o.Uniform1i(f,t.u_pitch_with_map),u_texsize:new o.Uniform2f(f,t.u_texsize),u_texture:new o.Uniform1i(f,t.u_texture),u_gamma_scale:new o.Uniform1f(f,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(f,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(f,t.u_is_halo)}),symbolTextAndIcon:(f,t)=>({u_is_size_zoom_constant:new o.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(f,t.u_size_t),u_size:new o.Uniform1f(f,t.u_size),u_camera_to_center_distance:new o.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(f,t.u_pitch),u_rotate_symbol:new o.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(f,t.u_fade_change),u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new o.Uniform1i(f,t.u_is_text),u_pitch_with_map:new o.Uniform1i(f,t.u_pitch_with_map),u_texsize:new o.Uniform2f(f,t.u_texsize),u_texsize_icon:new o.Uniform2f(f,t.u_texsize_icon),u_texture:new o.Uniform1i(f,t.u_texture),u_texture_icon:new o.Uniform1i(f,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(f,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(f,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(f,t.u_is_halo)}),background:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_opacity:new o.Uniform1f(f,t.u_opacity),u_color:new o.UniformColor(f,t.u_color)}),backgroundPattern:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_opacity:new o.Uniform1f(f,t.u_opacity),u_image:new o.Uniform1i(f,t.u_image),u_pattern_tl_a:new o.Uniform2f(f,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(f,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(f,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(f,t.u_pattern_br_b),u_texsize:new o.Uniform2f(f,t.u_texsize),u_mix:new o.Uniform1f(f,t.u_mix),u_pattern_size_a:new o.Uniform2f(f,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(f,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(f,t.u_scale_a),u_scale_b:new o.Uniform1f(f,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(f,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(f,t.u_tile_units_to_pixels)}),terrain:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_texture:new o.Uniform1i(f,t.u_texture)}),terrainDepth:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix)}),terrainCoords:(f,t)=>({u_matrix:new o.UniformMatrix4f(f,t.u_matrix),u_texture:new o.Uniform1i(f,t.u_texture),u_terrain_coords_id:new o.Uniform1f(f,t.u_terrain_coords_id)})};class Yo{constructor(t,s,u){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $o{constructor(t,s,u,m){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let u=0;u<this.attributes.length;u++){const m=s.attributes[this.attributes[u].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,u){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],w=s.attributes[y.name];w!==void 0&&t.vertexAttribPointer(w,y.components,t[Qo[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class tl extends Jt{getDefault(){return o.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class mc extends Jt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ls extends Jt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Bs extends Jt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class il extends Jt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ir extends Jt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ea extends Jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class fo extends Jt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class po extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class ta extends Jt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ia extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class mo extends Jt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ra extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class na extends Jt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class go extends Jt{getDefault(){return o.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class rl extends Jt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class nl extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class hs extends Jt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class gc extends Jt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class _c extends Jt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class yc extends Jt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class vc extends Jt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class xc extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class bc extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class sa extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class _o extends Jt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class oa extends Jt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class aa extends Jt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class fs extends Jt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class sl extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ol extends Jt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class yo extends Jt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Un extends yo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class al extends yo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ds{constructor(t,s,u,m){this.context=t,this.width=s,this.height=u;const y=t.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Un(t,w),m&&(this.depthAttachment=new al(t,w)),y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class gi{constructor(t,s,u){this.blendFunction=t,this.blendColor=s,this.mask=u}}gi.Replace=[1,0],gi.disabled=new gi(gi.Replace,o.Color.transparent,[!1,!1,!1,!1]),gi.unblended=new gi(gi.Replace,o.Color.transparent,[!0,!0,!0,!0]),gi.alphaBlended=new gi([1,771],o.Color.transparent,[!0,!0,!0,!0]);class ll{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new tl(this),this.clearDepth=new mc(this),this.clearStencil=new Ls(this),this.colorMask=new Bs(this),this.depthMask=new il(this),this.stencilMask=new Ir(this),this.stencilFunc=new ea(this),this.stencilOp=new fo(this),this.stencilTest=new po(this),this.depthRange=new ta(this),this.depthTest=new ia(this),this.depthFunc=new mo(this),this.blend=new ra(this),this.blendFunc=new na(this),this.blendColor=new go(this),this.blendEquation=new rl(this),this.cullFace=new nl(this),this.cullFaceSide=new hs(this),this.frontFace=new gc(this),this.program=new _c(this),this.activeTexture=new yc(this),this.viewport=new vc(this),this.bindFramebuffer=new xc(this),this.bindRenderbuffer=new bc(this),this.bindTexture=new sa(this),this.bindVertexBuffer=new _o(this),this.bindElementBuffer=new oa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new aa(this),this.pixelStoreUnpack=new fs(this),this.pixelStoreUnpackPremultiplyAlpha=new sl(this),this.pixelStoreUnpackFlipY=new ol(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Yo(this,t,s)}createVertexBuffer(t,s,u){return new $o(this,t,s,u)}createRenderbuffer(t,s,u){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,t,s,u),this.bindRenderbuffer.set(null),y}createFramebuffer(t,s,u){return new ds(this,t,s,u)}clear({color:t,depth:s}){const u=this.gl;let m=0;t&&(m|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(m|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){P(t.blendFunction,gi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class jt{constructor(t,s,u){this.func=t,this.mask=s,this.range=u}}jt.ReadOnly=!1,jt.ReadWrite=!0,jt.disabled=new jt(519,jt.ReadOnly,[0,1]);const Yt=7680;class mi{constructor(t,s,u,m,y,w){this.test=t,this.ref=s,this.mask=u,this.fail=m,this.depthFail=y,this.pass=w}}mi.disabled=new mi({func:519,mask:0},0,0,Yt,Yt,Yt);class bi{constructor(t,s,u){this.enable=t,this.mode=s,this.frontFace=u}}let Rs;function ps(f,t,s,u,m,y,w){const S=f.context,C=S.gl,M=f.useProgram("collisionBox"),B=[];let N=0,G=0;for(let te=0;te<u.length;te++){const Te=u[te],ye=t.getTile(Te),Pe=ye.getBucket(s);if(!Pe)continue;let De=Te.posMatrix;m[0]===0&&m[1]===0||(De=f.translatePosMatrix(Te.posMatrix,ye,m,y));const Ne=w?Pe.textCollisionBox:Pe.iconCollisionBox,Ae=Pe.collisionCircleArray;if(Ae.length>0){const ot=o.create(),Je=De;o.mul(ot,Pe.placementInvProjMatrix,f.transform.glCoordMatrix),o.mul(ot,ot,Pe.placementViewportMatrix),B.push({circleArray:Ae,circleOffset:G,transform:Je,invTransform:ot,coord:Te}),N+=Ae.length/4,G=N}Ne&&M.draw(S,C.LINES,jt.disabled,mi.disabled,f.colorModeForRenderPass(),bi.disabled,Vn(De,f.transform,ye),f.style.terrain&&f.style.terrain.getTerrainData(Te),s.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,f.transform.zoom,null,null,Ne.collisionVertexBuffer)}if(!w||!B.length)return;const $=f.useProgram("collisionCircle"),J=new o.CollisionCircleLayoutArray;J.resize(4*N),J._trim();let Y=0;for(const te of B)for(let Te=0;Te<te.circleArray.length/4;Te++){const ye=4*Te,Pe=te.circleArray[ye+0],De=te.circleArray[ye+1],Ne=te.circleArray[ye+2],Ae=te.circleArray[ye+3];J.emplace(Y++,Pe,De,Ne,Ae,0),J.emplace(Y++,Pe,De,Ne,Ae,1),J.emplace(Y++,Pe,De,Ne,Ae,2),J.emplace(Y++,Pe,De,Ne,Ae,3)}(!Rs||Rs.length<2*N)&&(Rs=function(te){const Te=2*te,ye=new o.QuadTriangleArray;ye.resize(Te),ye._trim();for(let Pe=0;Pe<Te;Pe++){const De=6*Pe;ye.uint16[De+0]=4*Pe+0,ye.uint16[De+1]=4*Pe+1,ye.uint16[De+2]=4*Pe+2,ye.uint16[De+3]=4*Pe+2,ye.uint16[De+4]=4*Pe+3,ye.uint16[De+5]=4*Pe+0}return ye}(N));const le=S.createIndexBuffer(Rs,!0),fe=S.createVertexBuffer(J,o.collisionCircleLayout.members,!0);for(const te of B){const Te={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(_e=f.transform).cameraToCenterDistance,u_viewport_size:[_e.width,_e.height]};$.draw(S,C.TRIANGLES,jt.disabled,mi.disabled,f.colorModeForRenderPass(),bi.disabled,Te,f.style.terrain&&f.style.terrain.getTerrainData(te.coord),s.id,fe,le,o.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,f.transform.zoom,null,null,null)}var _e;fe.destroy(),le.destroy()}bi.disabled=new bi(!1,1029,2305),bi.backCCW=new bi(!0,1029,2305);const wc=o.identity(new Float32Array(16));function Tc(f,t,s,u,m,y){const{horizontalAlign:w,verticalAlign:S}=o.getAnchorAlignment(f),C=-(w-.5)*t,M=-(S-.5)*s,B=o.evaluateVariableOffset(f,u);return new o.pointGeometry((C/m+B[0])*y,(M/m+B[1])*y)}function cl(f,t,s,u,m,y,w,S,C,M,B){const N=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,$=f.icon.dynamicLayoutVertexArray,J={};G.clear();for(let Y=0;Y<N.length;Y++){const le=N.get(Y),fe=f.allowVerticalPlacement&&!le.placedOrientation,_e=le.hidden||!le.crossTileID||fe?null:u[le.crossTileID];if(_e){const te=new o.pointGeometry(le.anchorX,le.anchorY),Te=Xt(te,s?w:y,B),ye=Fr(m.cameraToCenterDistance,Te.signedDistanceFromCamera);let Pe=o.evaluateSizeForFeature(f.textSizeData,C,le)*ye/o.ONE_EM;s&&(Pe*=f.tilePixelRatio/S);const{width:De,height:Ne,anchor:Ae,textOffset:ot,textBoxScale:Je}=_e,at=Tc(Ae,De,Ne,ot,Je,Pe),Dt=s?Xt(te.add(at),y,B).point:Te.point.add(t?at.rotate(-m.angle):at),Ot=f.allowVerticalPlacement&&le.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let yt=0;yt<le.numGlyphs;yt++)o.addDynamicAttributes(G,Dt,Ot);M&&le.associatedIconIndex>=0&&(J[le.associatedIconIndex]={shiftedAnchor:Dt,angle:Ot})}else Mt(le.numGlyphs,G)}if(M){$.clear();const Y=f.icon.placedSymbolArray;for(let le=0;le<Y.length;le++){const fe=Y.get(le);if(fe.hidden)Mt(fe.numGlyphs,$);else{const _e=J[le];if(_e)for(let te=0;te<fe.numGlyphs;te++)o.addDynamicAttributes($,_e.shiftedAnchor,_e.angle);else Mt(fe.numGlyphs,$)}}f.icon.dynamicLayoutVertexBuffer.updateData($)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function kc(f,t,s){return s.iconsInText&&t?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function vo(f,t,s,u,m,y,w,S,C,M,B,N){const G=f.context,$=G.gl,J=f.transform,Y=S==="map",le=C==="map",fe=S!=="viewport"&&s.layout.get("symbol-placement")!=="point",_e=Y&&!le&&!fe,te=!s.layout.get("symbol-sort-key").isConstant();let Te=!1;const ye=f.depthModeForSublayer(0,jt.ReadOnly),Pe=s.layout.get("text-variable-anchor"),De=[];for(const Ne of u){const Ae=t.getTile(Ne),ot=Ae.getBucket(s);if(!ot)continue;const Je=m?ot.text:ot.icon;if(!Je||!Je.segments.get().length)continue;const at=Je.programConfigurations.get(s.id),Dt=m||ot.sdfIcons,Ot=m?ot.textSizeData:ot.iconSizeData,yt=le||J.pitch!==0,$t=f.useProgram(kc(Dt,m,ot),at),ei=o.evaluateSizeForZoom(Ot,J.zoom),qt=f.style.terrain&&f.style.terrain.getTerrainData(Ne);let Kt,ni,qi,tn,qr=[0,0],rn=null;if(m){if(ni=Ae.glyphAtlasTexture,qi=$.LINEAR,Kt=Ae.glyphAtlasTexture.size,ot.iconsInText){qr=Ae.imageAtlasTexture.size,rn=Ae.imageAtlasTexture;const Ur=Ot.kind==="composite"||Ot.kind==="camera";tn=yt||f.options.rotating||f.options.zooming||Ur?$.LINEAR:$.NEAREST}}else{const Ur=s.layout.get("icon-size").constantOr(0)!==1||ot.iconsNeedLinear;ni=Ae.imageAtlasTexture,qi=Dt||f.options.rotating||f.options.zooming||Ur||yt?$.LINEAR:$.NEAREST,Kt=Ae.imageAtlasTexture.size}const zn=Pi(Ae,1,f.transform.zoom),Vr=Bn(Ne.posMatrix,le,Y,f.transform,zn),vr=jr(Ne.posMatrix,le,Y,f.transform,zn),fn=Pe&&ot.hasTextData(),Io=s.layout.get("icon-text-fit")!=="none"&&fn&&ot.hasIconData();if(fe){const Ur=f.style.terrain?(wa,xs)=>f.style.terrain.getElevation(Ne,wa,xs):null,qn=s.layout.get("text-rotation-alignment")==="map";Sr(ot,Ne.posMatrix,f,m,Vr,vr,le,M,qn,Ur)}const Fi=f.translatePosMatrix(Ne.posMatrix,Ae,y,w),Ut=fe||m&&Pe||Io?wc:Vr,Qt=f.translatePosMatrix(vr,Ae,y,w,!0),Zi=Dt&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Xi;Xi=Dt?ot.iconsInText?el(Ot.kind,ei,_e,le,f,Fi,Ut,Qt,Kt,qr):ho(Ot.kind,ei,_e,le,f,Fi,Ut,Qt,m,Kt,!0):Ko(Ot.kind,ei,_e,le,f,Fi,Ut,Qt,m,Kt);const Ti={program:$t,buffers:Je,uniformValues:Xi,atlasTexture:ni,atlasTextureIcon:rn,atlasInterpolation:qi,atlasInterpolationIcon:tn,isSDF:Dt,hasHalo:Zi};if(te&&ot.canOverlap){Te=!0;const Ur=Je.segments.get();for(const qn of Ur)De.push({segments:new o.SegmentVector([qn]),sortKey:qn.sortKey,state:Ti,terrainData:qt})}else De.push({segments:Je.segments,sortKey:0,state:Ti,terrainData:qt})}Te&&De.sort((Ne,Ae)=>Ne.sortKey-Ae.sortKey);for(const Ne of De){const Ae=Ne.state;if(G.activeTexture.set($.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,$.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(G.activeTexture.set($.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Ae.isSDF){const ot=Ae.uniformValues;Ae.hasHalo&&(ot.u_is_halo=1,Fs(Ae.buffers,Ne.segments,s,f,Ae.program,ye,B,N,ot,Ne.terrainData)),ot.u_is_halo=0}Fs(Ae.buffers,Ne.segments,s,f,Ae.program,ye,B,N,Ae.uniformValues,Ne.terrainData)}}function Fs(f,t,s,u,m,y,w,S,C,M){const B=u.context;m.draw(B,B.gl.TRIANGLES,y,w,S,bi.disabled,C,M,s.id,f.layoutVertexBuffer,f.indexBuffer,t,s.paint,u.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Os(f,t,s,u,m,y,w){const S=f.context.gl,C=s.paint.get("fill-pattern"),M=C&&C.constantOr(1),B=s.getCrossfadeParameters();let N,G,$,J,Y;w?(G=M&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=S.LINES):(G=M?"fillPattern":"fill",N=S.TRIANGLES);for(const le of u){const fe=t.getTile(le);if(M&&!fe.patternsLoaded())continue;const _e=fe.getBucket(s);if(!_e)continue;const te=_e.programConfigurations.get(s.id),Te=f.useProgram(G,te),ye=f.style.terrain&&f.style.terrain.getTerrainData(le);M&&(f.context.activeTexture.set(S.TEXTURE0),fe.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),te.updatePaintBuffers(B));const Pe=C.constantOr(null);if(Pe&&fe.imageAtlas){const Ae=fe.imageAtlas,ot=Ae.patternPositions[Pe.to.toString()],Je=Ae.patternPositions[Pe.from.toString()];ot&&Je&&te.setConstantPatternPositions(ot,Je)}const De=ye?le:null,Ne=f.translatePosMatrix(De?De.posMatrix:le.posMatrix,fe,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(w){J=_e.indexBuffer2,Y=_e.segments2;const Ae=[S.drawingBufferWidth,S.drawingBufferHeight];$=G==="fillOutlinePattern"&&M?Ja(Ne,f,B,fe,Ae):Ka(Ne,Ae)}else J=_e.indexBuffer,Y=_e.segments,$=M?Ho(Ne,f,B,fe):ao(Ne);Te.draw(f.context,N,m,f.stencilModeForClipping(le),y,bi.disabled,$,ye,s.id,_e.layoutVertexBuffer,J,Y,s.paint,f.transform.zoom,te)}}function Vs(f,t,s,u,m,y,w){const S=f.context,C=S.gl,M=s.paint.get("fill-extrusion-pattern"),B=M.constantOr(1),N=s.getCrossfadeParameters(),G=s.paint.get("fill-extrusion-opacity");for(const $ of u){const J=t.getTile($),Y=J.getBucket(s);if(!Y)continue;const le=f.style.terrain&&f.style.terrain.getTerrainData($),fe=Y.programConfigurations.get(s.id),_e=f.useProgram(B?"fillExtrusionPattern":"fillExtrusion",fe);B&&(f.context.activeTexture.set(C.TEXTURE0),J.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),fe.updatePaintBuffers(N));const te=M.constantOr(null);if(te&&J.imageAtlas){const De=J.imageAtlas,Ne=De.patternPositions[te.to.toString()],Ae=De.patternPositions[te.from.toString()];Ne&&Ae&&fe.setConstantPatternPositions(Ne,Ae)}const Te=f.translatePosMatrix($.posMatrix,J,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ye=s.paint.get("fill-extrusion-vertical-gradient"),Pe=B?fc(Te,f,ye,G,$,N,J):Xo(Te,f,ye,G);_e.draw(S,S.gl.TRIANGLES,m,y,w,bi.backCCW,Pe,le,s.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,s.paint,f.transform.zoom,fe,f.style.terrain&&Y.centroidVertexBuffer)}}function la(f,t,s,u,m,y,w){const S=f.context,C=S.gl,M=s.fbo;if(!M)return;const B=f.useProgram("hillshade"),N=f.style.terrain&&f.style.terrain.getTerrainData(t);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),B.draw(S,C.TRIANGLES,m,y,w,bi.disabled,((G,$,J,Y)=>{const le=J.paint.get("hillshade-shadow-color"),fe=J.paint.get("hillshade-highlight-color"),_e=J.paint.get("hillshade-accent-color");let te=J.paint.get("hillshade-illumination-direction")*(Math.PI/180);J.paint.get("hillshade-illumination-anchor")==="viewport"&&(te-=G.transform.angle);const Te=!G.options.moving;return{u_matrix:Y?Y.posMatrix:G.transform.calculatePosMatrix($.tileID.toUnwrapped(),Te),u_image:0,u_latrange:co(0,$.tileID),u_light:[J.paint.get("hillshade-exaggeration"),te],u_shadow:le,u_highlight:fe,u_accent:_e}})(f,s,u,N?t:null),N,u.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function ul(f,t,s,u,m,y){const w=f.context,S=w.gl,C=t.dem;if(C&&C.data){const M=C.dim,B=C.stride,N=C.getPixels();if(w.activeTexture.set(S.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(B),t.demTexture){const $=t.demTexture;$.update(N,{premultiply:!1}),$.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else t.demTexture=new F(w,N,S.RGBA,{premultiply:!1}),t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);w.activeTexture.set(S.TEXTURE0);let G=t.fbo;if(!G){const $=new F(w,{width:M,height:M,data:null},S.RGBA);$.bind(S.LINEAR,S.CLAMP_TO_EDGE),G=t.fbo=w.createFramebuffer(M,M,!0),G.colorAttachment.set($.texture)}w.bindFramebuffer.set(G.framebuffer),w.viewport.set([0,0,M,M]),f.useProgram("hillshadePrepare").draw(w,S.TRIANGLES,u,m,y,bi.disabled,(($,J)=>{const Y=J.stride,le=o.create();return o.ortho(le,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(le,le,[0,-o.EXTENT,0]),{u_matrix:le,u_image:1,u_dimension:[Y,Y],u_zoom:$.overscaledZ,u_unpack:J.getUnpackVector()}})(t.tileID,C),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function xo(f,t,s,u,m,y){const w=u.paint.get("raster-fade-duration");if(!y&&w>0){const S=o.exported.now(),C=(S-f.timeAdded)/w,M=t?(S-t.timeAdded)/w:-1,B=s.getSource(),N=m.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),G=!t||Math.abs(t.tileID.overscaledZ-N)>Math.abs(f.tileID.overscaledZ-N),$=G&&f.refreshedUponExpiration?1:o.clamp(G?C:1-M,0,1);return f.refreshedUponExpiration&&C>=1&&(f.refreshedUponExpiration=!1),t?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}const bo=new o.Color(1,0,0,1),Gr=new o.Color(0,1,0,1),hl=new o.Color(0,0,1,1),ca=new o.Color(1,0,1,1),fl=new o.Color(0,1,1,1);function Nn(f,t,s,u){ms(f,0,t+s/2,f.transform.width,s,u)}function Us(f,t,s,u){ms(f,t-s/2,0,s,f.transform.height,u)}function ms(f,t,s,u,m,y){const w=f.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*f.pixelRatio,s*f.pixelRatio,u*f.pixelRatio,m*f.pixelRatio),w.clear({color:y}),S.disable(S.SCISSOR_TEST)}function Ec(f,t,s){const u=f.context,m=u.gl,y=s.posMatrix,w=f.useProgram("debug"),S=jt.disabled,C=mi.disabled,M=f.colorModeForRenderPass(),B="$debug",N=f.style.terrain&&f.style.terrain.getTerrainData(s);u.activeTexture.set(m.TEXTURE0),f.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE);const G=t.getTileByID(s.key).latestRawTileData,$=Math.floor((G&&G.byteLength||0)/1024),J=t.getTile(s).tileSize,Y=512/Math.min(J,512)*(s.overscaledZ/f.transform.zoom)*.5;let le=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(le+=` => ${s.overscaledZ}`),function(fe,_e){fe.initDebugOverlayCanvas();const te=fe.debugOverlayCanvas,Te=fe.context.gl,ye=fe.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,te.width,te.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(_e,5,5),ye.strokeText(_e,5,5),fe.debugOverlayTexture.update(te),fe.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(f,`${le} ${$}kB`),w.draw(u,m.TRIANGLES,S,C,gi.alphaBlended,bi.disabled,Ms(y,o.Color.transparent,Y),null,B,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),w.draw(u,m.LINE_STRIP,S,C,M,bi.disabled,Ms(y,o.Color.red),N,B,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function wo(f,t,s){const u=f.context,m=u.gl,y=f.colorModeForRenderPass(),w=new jt(m.LEQUAL,jt.ReadWrite,f.depthRangeFor3D),S=f.useProgram("terrain"),C=t.getTerrainMesh(),M=t.getTerrainData(s.tileID);u.bindFramebuffer.set(null),u.viewport.set([0,0,f.width,f.height]),u.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const B=f.transform.calculatePosMatrix(s.tileID.toUnwrapped());S.draw(u,m.TRIANGLES,w,mi.disabled,y,bi.backCCW,{u_matrix:B,u_texture:0},M,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}function dl(f,t,s,u){const m=f.context,y=s.tileSize*t.qualityFactor;s.textures[u]||(s.textures[u]=f.getTileTexture(y)||new F(m,{width:y,height:y,data:null},m.gl.RGBA),s.textures[u].bind(m.gl.LINEAR,m.gl.CLAMP_TO_EDGE),u===0&&t.sourceCache.renderHistory.unshift(s.tileID.key));const w=t.getRTTFramebuffer();w.colorAttachment.set(s.textures[u].texture),m.bindFramebuffer.set(w.framebuffer),m.viewport.set([0,0,y,y])}class pl{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,s=t.terrain;for(const u in t.sourceCaches){this._coordsDescendingInv[u]={};const m=t.sourceCaches[u].getVisibleCoordinates();for(const y of m){const w=s.sourceCache.getTerrainCoords(y);for(const S in w)this._coordsDescendingInv[u][S]||(this._coordsDescendingInv[u][S]=[]),this._coordsDescendingInv[u][S].push(w[S])}}for(const u of t._order){const m=t._layers[u],y=m.source;if(this._renderToTexture[m.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const w in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][w]=this._coordsDescendingInv[y][w].map(S=>S.key).sort().join()}}return this._renderableTiles.forEach(u=>{for(const m in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[m][u.tileID.key];y&&y!==u.textureCoords[m]&&u.clearTextures(this.painter),s.needsRerender(m,u.tileID)&&u.clearTextures(this.painter)}this._rerender[u.tileID.key]=!u.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const s=t.type,u=this.painter,m=u.style._order,y=u.currentLayer,w=y+1===m.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(m[y]),!w))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&w){this._prevType=s;const S=this._stacks.length-1,C=this._stacks[S]||[];for(const M of this._renderableTiles){if(dl(u,u.style.terrain,M,S),this._rerender[M.tileID.key]){u.context.clear({color:o.Color.transparent});for(let B=0;B<C.length;B++){const N=u.style._layers[C[B]],G=N.source?this._coordsDescendingInv[N.source][M.tileID.key]:[M.tileID];u._renderTileClippingMasks(N,G),u.renderLayer(u,u.style.sourceCaches[N.source],N,G),N.source&&(M.textureCoords[N.source]=this._coordsDescendingInvStr[N.source][M.tileID.key])}}wo(u,u.style.terrain,M)}if(s==="hillshade"){this._stacks.push([m[y]]);for(const M of this._renderableTiles){const B=this._coordsDescendingInv[t.source][M.tileID.key];dl(u,u.style.terrain,M,this._stacks.length-1),u.context.clear({color:o.Color.transparent}),u._renderTileClippingMasks(t,B),u.renderLayer(u,u.style.sourceCaches[t.source],t,B),wo(u,u.style.terrain,M)}return!0}return this._renderToTexture[s]}return!1}}const Ns={symbol:function(f,t,s,u,m){if(f.renderPass!=="translucent")return;const y=mi.disabled,w=f.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(S,C,M,B,N,G,$){const J=C.transform,Y=N==="map",le=G==="map";for(const fe of S){const _e=B.getTile(fe),te=_e.getBucket(M);if(!te||!te.text||!te.text.segments.get().length)continue;const Te=o.evaluateSizeForZoom(te.textSizeData,J.zoom),ye=Pi(_e,1,C.transform.zoom),Pe=Bn(fe.posMatrix,le,Y,C.transform,ye),De=M.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(Te){const Ne=Math.pow(2,J.zoom-_e.tileID.overscaledZ);cl(te,Y,le,$,J,Pe,fe.posMatrix,Ne,Te,De,C.style.terrain?(Ae,ot)=>C.style.terrain.getElevation(fe,Ae,ot):null)}}}(u,f,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&vo(f,t,s,u,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),y,w),s.paint.get("text-opacity").constantOr(1)!==0&&vo(f,t,s,u,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),y,w),t.map.showCollisionBoxes&&(ps(f,t,s,u,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),ps(f,t,s,u,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,s,u){if(f.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),y=s.paint.get("circle-stroke-width"),w=s.paint.get("circle-stroke-opacity"),S=!s.layout.get("circle-sort-key").isConstant();if(m.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const C=f.context,M=C.gl,B=f.depthModeForSublayer(0,jt.ReadOnly),N=mi.disabled,G=f.colorModeForRenderPass(),$=[];for(let J=0;J<u.length;J++){const Y=u[J],le=t.getTile(Y),fe=le.getBucket(s);if(!fe)continue;const _e=fe.programConfigurations.get(s.id),te=f.useProgram("circle",_e),Te=fe.layoutVertexBuffer,ye=fe.indexBuffer,Pe=f.style.terrain&&f.style.terrain.getTerrainData(Y),De={programConfiguration:_e,program:te,layoutVertexBuffer:Te,indexBuffer:ye,uniformValues:Ya(f,Y,le,s),terrainData:Pe};if(S){const Ne=fe.segments.get();for(const Ae of Ne)$.push({segments:new o.SegmentVector([Ae]),sortKey:Ae.sortKey,state:De})}else $.push({segments:fe.segments,sortKey:0,state:De})}S&&$.sort((J,Y)=>J.sortKey-Y.sortKey);for(const J of $){const{programConfiguration:Y,program:le,layoutVertexBuffer:fe,indexBuffer:_e,uniformValues:te,terrainData:Te}=J.state;le.draw(C,M.TRIANGLES,B,N,G,bi.disabled,te,Te,s.id,fe,_e,J.segments,s.paint,f.transform.zoom,Y)}},heatmap:function(f,t,s,u){if(s.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const m=f.context,y=m.gl,w=mi.disabled,S=new gi([y.ONE,y.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(C,M,B){const N=C.gl;C.activeTexture.set(N.TEXTURE1),C.viewport.set([0,0,M.width/4,M.height/4]);let G=B.heatmapFbo;if(G)N.bindTexture(N.TEXTURE_2D,G.colorAttachment.get()),C.bindFramebuffer.set(G.framebuffer);else{const $=N.createTexture();N.bindTexture(N.TEXTURE_2D,$),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),G=B.heatmapFbo=C.createFramebuffer(M.width/4,M.height/4,!1),function(J,Y,le,fe){const _e=J.gl;_e.texImage2D(_e.TEXTURE_2D,0,_e.RGBA,Y.width/4,Y.height/4,0,_e.RGBA,J.extRenderToTextureHalfFloat?J.extTextureHalfFloat.HALF_FLOAT_OES:_e.UNSIGNED_BYTE,null),fe.colorAttachment.set(le)}(C,M,$,G)}})(m,f,s),m.clear({color:o.Color.transparent});for(let C=0;C<u.length;C++){const M=u[C];if(t.hasRenderableParent(M))continue;const B=t.getTile(M),N=B.getBucket(s);if(!N)continue;const G=N.programConfigurations.get(s.id),$=f.useProgram("heatmap",G),{zoom:J}=f.transform;$.draw(m,y.TRIANGLES,jt.disabled,w,S,bi.disabled,lo(M.posMatrix,B,J,s.paint.get("heatmap-intensity")),null,s.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,s.paint,f.transform.zoom,G)}m.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(m,y){const w=m.context,S=w.gl,C=y.heatmapFbo;if(!C)return;w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),w.activeTexture.set(S.TEXTURE1);let M=y.colorRampTexture;M||(M=y.colorRampTexture=new F(w,y.colorRamp,S.RGBA)),M.bind(S.LINEAR,S.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(w,S.TRIANGLES,jt.disabled,mi.disabled,m.colorModeForRenderPass(),bi.disabled,((B,N,G,$)=>{const J=o.create();o.ortho(J,0,B.width,B.height,0,0,1);const Y=B.context.gl;return{u_matrix:J,u_world:[Y.drawingBufferWidth,Y.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(m,y),null,y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(f,s))},line:function(f,t,s,u){if(f.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),y=s.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const w=f.depthModeForSublayer(0,jt.ReadOnly),S=f.colorModeForRenderPass(),C=s.paint.get("line-dasharray"),M=s.paint.get("line-pattern"),B=M.constantOr(1),N=s.paint.get("line-gradient"),G=s.getCrossfadeParameters(),$=B?"linePattern":C?"lineSDF":N?"lineGradient":"line",J=f.context,Y=J.gl;let le=!0;for(const fe of u){const _e=t.getTile(fe);if(B&&!_e.patternsLoaded())continue;const te=_e.getBucket(s);if(!te)continue;const Te=te.programConfigurations.get(s.id),ye=f.context.program.get(),Pe=f.useProgram($,Te),De=le||Pe.program!==ye,Ne=f.style.terrain&&f.style.terrain.getTerrainData(fe),Ae=M.constantOr(null);if(Ae&&_e.imageAtlas){const at=_e.imageAtlas,Dt=at.patternPositions[Ae.to.toString()],Ot=at.patternPositions[Ae.from.toString()];Dt&&Ot&&Te.setConstantPatternPositions(Dt,Ot)}const ot=Ne?fe:null,Je=B?uo(f,_e,s,G,ot):C?Ps(f,_e,s,C,G,ot):N?Wo(f,_e,s,te.lineClipsArray.length,ot):us(f,_e,s,ot);if(B)J.activeTexture.set(Y.TEXTURE0),_e.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Te.updatePaintBuffers(G);else if(C&&(De||f.lineAtlas.dirty))J.activeTexture.set(Y.TEXTURE0),f.lineAtlas.bind(J);else if(N){const at=te.gradients[s.id];let Dt=at.texture;if(s.gradientVersion!==at.version){let Ot=256;if(s.stepInterpolant){const yt=t.getSource().maxzoom,$t=fe.canonical.z===yt?Math.ceil(1<<f.transform.maxZoom-fe.canonical.z):1;Ot=o.clamp(o.nextPowerOfTwo(te.maxLineLength/o.EXTENT*1024*$t),256,J.maxTextureSize)}at.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:at.gradient||void 0,clips:te.lineClipsArray}),at.texture?at.texture.update(at.gradient):at.texture=new F(J,at.gradient,Y.RGBA),at.version=s.gradientVersion,Dt=at.texture}J.activeTexture.set(Y.TEXTURE0),Dt.bind(s.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}Pe.draw(J,Y.TRIANGLES,w,f.stencilModeForClipping(fe),S,bi.disabled,Je,Ne,s.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,s.paint,f.transform.zoom,Te,te.layoutVertexBuffer2),le=!1}},fill:function(f,t,s,u){const m=s.paint.get("fill-color"),y=s.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const w=f.colorModeForRenderPass(),S=s.paint.get("fill-pattern"),C=f.opaquePassEnabledForLayer()&&!S.constantOr(1)&&m.constantOr(o.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===C){const M=f.depthModeForSublayer(1,f.renderPass==="opaque"?jt.ReadWrite:jt.ReadOnly);Os(f,t,s,u,M,w,!1)}if(f.renderPass==="translucent"&&s.paint.get("fill-antialias")){const M=f.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,jt.ReadOnly);Os(f,t,s,u,M,w,!0)}},"fill-extrusion":function(f,t,s,u){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&f.renderPass==="translucent"){const y=new jt(f.context.gl.LEQUAL,jt.ReadWrite,f.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Vs(f,t,s,u,y,mi.disabled,gi.disabled),Vs(f,t,s,u,y,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const w=f.colorModeForRenderPass();Vs(f,t,s,u,y,mi.disabled,w)}}},hillshade:function(f,t,s,u){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const m=f.context,y=f.depthModeForSublayer(0,jt.ReadOnly),w=f.colorModeForRenderPass(),[S,C]=f.renderPass==="translucent"?f.stencilConfigForOverlap(u):[{},u];for(const M of C){const B=t.getTile(M);B.needsHillshadePrepare!==void 0&&B.needsHillshadePrepare&&f.renderPass==="offscreen"?ul(f,B,s,y,mi.disabled,w):f.renderPass==="translucent"&&la(f,M,B,s,y,S[M.overscaledZ],w)}m.viewport.set([0,0,f.width,f.height])},raster:function(f,t,s,u){if(f.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!u.length)return;const m=f.context,y=m.gl,w=t.getSource(),S=f.useProgram("raster"),C=f.colorModeForRenderPass(),[M,B]=w instanceof Lt?[{},u]:f.stencilConfigForOverlap(u),N=B[B.length-1].overscaledZ,G=!f.options.moving;for(const $ of B){const J=f.depthModeForSublayer($.overscaledZ-N,s.paint.get("raster-opacity")===1?jt.ReadWrite:jt.ReadOnly,y.LESS),Y=t.getTile($);Y.registerFadeDuration(s.paint.get("raster-fade-duration"));const le=t.findLoadedParent($,0),fe=xo(Y,le,t,s,f.transform,f.style.terrain);let _e,te;const Te=s.paint.get("raster-resampling")==="nearest"?y.NEAREST:y.LINEAR;m.activeTexture.set(y.TEXTURE0),Y.texture.bind(Te,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),m.activeTexture.set(y.TEXTURE1),le?(le.texture.bind(Te,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,le.tileID.overscaledZ-Y.tileID.overscaledZ),te=[Y.tileID.canonical.x*_e%1,Y.tileID.canonical.y*_e%1]):Y.texture.bind(Te,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST);const ye=f.style.terrain&&f.style.terrain.getTerrainData($),Pe=ye?$:null,De=Pe?Pe.posMatrix:f.transform.calculatePosMatrix($.toUnwrapped(),G),Ne=Qa(De,te||[0,0],_e||1,fe,s);w instanceof Lt?S.draw(m,y.TRIANGLES,J,mi.disabled,C,bi.disabled,Ne,ye,s.id,w.boundsBuffer,f.quadTriangleIndexBuffer,w.boundsSegments):S.draw(m,y.TRIANGLES,J,M[$.overscaledZ],C,bi.disabled,Ne,ye,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,t,s,u){const m=s.paint.get("background-color"),y=s.paint.get("background-opacity");if(y===0)return;const w=f.context,S=w.gl,C=f.transform,M=C.tileSize,B=s.paint.get("background-pattern");if(f.isPatternMissing(B))return;const N=!B&&m.a===1&&y===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==N)return;const G=mi.disabled,$=f.depthModeForSublayer(0,N==="opaque"?jt.ReadWrite:jt.ReadOnly),J=f.colorModeForRenderPass(),Y=f.useProgram(B?"backgroundPattern":"background"),le=u||C.coveringTiles({tileSize:M,terrain:f.style.terrain});B&&(w.activeTexture.set(S.TEXTURE0),f.imageManager.bind(f.context));const fe=s.getCrossfadeParameters();for(const _e of le){const te=u?_e.posMatrix:f.transform.calculatePosMatrix(_e.toUnwrapped()),Te=B?pc(te,y,f,B,{tileID:_e,tileSize:M},fe):dc(te,y,m),ye=f.style.terrain&&f.style.terrain.getTerrainData(_e);Y.draw(w,S.TRIANGLES,$,G,J,bi.disabled,Te,ye,s.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}},debug:function(f,t,s){for(let u=0;u<s.length;u++)Ec(f,t,s[u])},custom:function(f,t,s){const u=f.context,m=s.implementation;if(f.renderPass==="offscreen"){const y=m.prerender;y&&(f.setCustomLayerDefaults(),u.setColorMode(f.colorModeForRenderPass()),y.call(m,u.gl,f.transform.customLayerMatrix()),u.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),u.setColorMode(f.colorModeForRenderPass()),u.setStencilMode(mi.disabled);const y=m.renderingMode==="3d"?new jt(f.context.gl.LEQUAL,jt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,jt.ReadOnly);u.setDepthMode(y),m.render(u.gl,f.transform.customLayerMatrix()),u.setDirty(),f.setBaseState(),u.bindFramebuffer.set(null)}}};class ua{constructor(t,s){this.context=new ll(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=Xe.maxUnderzooming+Xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new It,this.gpuTimers={}}resize(t,s,u){if(this.width=t*u,this.height=s*u,this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,s=new o.PosArray;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,Ht.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const u=new o.PosArray;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(u,Ht.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const m=new o.RasterBoundsArray;m.emplaceBack(0,0,0,0),m.emplaceBack(o.EXTENT,0,o.EXTENT,0),m.emplaceBack(0,o.EXTENT,0,o.EXTENT),m.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(m,Si.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.PosArray;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,Ht.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const w=new o.LineStripIndexArray;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const S=new o.TriangleIndexArray;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new F(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const C=this.context.gl;this.stencilClearMode=new mi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=o.create();o.ortho(u,0,this.width,this.height,0,0,1),o.scale(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,jt.disabled,this.stencilClearMode,gi.disabled,bi.disabled,cs(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const u=this.context,m=u.gl;this.nextStencilID+s.length>256&&this.clearStencil(),u.setColorMode(gi.disabled),u.setDepthMode(jt.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of s){const S=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,C=this.style.terrain&&this.style.terrain.getTerrainData(w);y.draw(u,m.TRIANGLES,jt.disabled,new mi({func:m.ALWAYS,mask:0},S,255,m.KEEP,m.KEEP,m.REPLACE),gi.disabled,bi.disabled,cs(w.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new mi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new mi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,u=t.sort((w,S)=>S.overscaledZ-w.overscaledZ),m=u[u.length-1].overscaledZ,y=u[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let S=0;S<y;S++)w[S+m]=new mi({func:s.GEQUAL,mask:255},S+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[w,u]}return[{[m]:mi.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new gi([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gi.unblended:gi.alphaBlended}depthModeForSublayer(t,s,u){if(!this.opaquePassEnabledForLayer())return jt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new jt(u||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const u=this.style._order,m=this.style.sourceCaches,y=this.style.terrain&&new pl(this);for(const M in m){const B=m[M];B.used&&B.prepare(this.context)}const w={},S={},C={};for(const M in m){const B=m[M];w[M]=B.getVisibleCoordinates(),S[M]=w[M].slice().reverse(),C[M]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<u.length;M++)if(this.style._layers[u[M]].is3D()){this.opaquePassCutoff=M;break}if(y){this.opaquePassCutoff=0;const M=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||M.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,N){const G=B.context,$=G.gl,J=gi.unblended,Y=new jt($.LEQUAL,jt.ReadWrite,[0,1]),le=N.getTerrainMesh(),fe=N.sourceCache.getRenderableTiles(),_e=B.useProgram("terrainDepth");G.bindFramebuffer.set(N.getFramebuffer("depth").framebuffer),G.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),G.clear({color:o.Color.transparent,depth:1});for(const te of fe){const Te=N.getTerrainData(te.tileID),ye=B.transform.calculatePosMatrix(te.tileID.toUnwrapped());_e.draw(G,$.TRIANGLES,Y,mi.disabled,J,bi.backCCW,{u_matrix:ye},Te,"terrain",le.vertexBuffer,le.indexBuffer,le.segments)}G.bindFramebuffer.set(null),G.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain),function(B,N){const G=B.context,$=G.gl,J=gi.unblended,Y=new jt($.LEQUAL,jt.ReadWrite,[0,1]),le=N.getTerrainMesh(),fe=N.getCoordsTexture(),_e=N.sourceCache.getRenderableTiles(),te=B.useProgram("terrainCoords");G.bindFramebuffer.set(N.getFramebuffer("coords").framebuffer),G.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),G.clear({color:o.Color.transparent,depth:1}),N.coordsIndex=[];for(const Te of _e){const ye=N.getTerrainData(Te.tileID);G.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,fe.texture);const Pe=B.transform.calculatePosMatrix(Te.tileID.toUnwrapped());te.draw(G,$.TRIANGLES,Y,mi.disabled,J,bi.backCCW,{u_matrix:Pe,u_terrain_coords_id:(255-N.coordsIndex.length)/255,u_texture:0},ye,"terrain",le.vertexBuffer,le.indexBuffer,le.segments),N.coordsIndex.push(Te.tileID.key)}G.bindFramebuffer.set(null),G.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const M of u){const B=this.style._layers[M];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const N=S[B.source];(B.type==="custom"||N.length)&&this.renderLayer(this,m[B.source],B,N)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!y)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[u[this.currentLayer]],B=m[M.source],N=w[M.source];this._renderTileClippingMasks(M,N),this.renderLayer(this,B,M,N)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const M=this.style._layers[u[this.currentLayer]],B=m[M.source];if(y&&y.renderLayer(M))continue;const N=(M.type==="symbol"?C:S)[M.source];this._renderTileClippingMasks(M,w[M.source]),this.renderLayer(this,B,M,N)}if(this.options.showTileBoundaries){let M,B;Object.values(this.style._layers).forEach(N=>{N.source&&!N.isHidden(this.transform.zoom)&&(N.source!==(B&&B.id)&&(B=this.style.sourceCaches[N.source]),(!M||M.getSource().maxzoom<B.getSource().maxzoom)&&(M=B))}),M&&Ns.debug(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const B=M.transform.padding;Nn(M,M.transform.height-(B.top||0),3,bo),Nn(M,B.bottom||0,3,Gr),Us(M,B.left||0,3,hl),Us(M,M.transform.width-(B.right||0),3,ca);const N=M.transform.centerPoint;(function(G,$,J,Y){ms(G,$-1,J-10,2,20,Y),ms(G,$-10,J-1,20,2,Y)})(M,N.x,M.transform.height-N.y,fl)}(this),this.context.setDefault()}renderLayer(t,s,u,m){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(m||[]).length)&&(this.id=u.id,this.gpuTimingStart(u),Ns[u.type](t,s,u,m,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let u=this.gpuTimers[t.id];u||(u=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),u.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,u.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const u in t){const m=t[u],y=this.context.extTimerQuery,w=y.getQueryObjectEXT(m.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(m.query),s[u]=w}return s}translatePosMatrix(t,s,u,m,y){if(!u[0]&&!u[1])return t;const w=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const M=Math.sin(w),B=Math.cos(w);u=[u[0]*B-u[1]*M,u[0]*M+u[1]*B]}const S=[y?u[0]:Pi(s,u[0],this.transform.zoom),y?u[1]:Pi(s,u[1],this.transform.zoom),0],C=new Float32Array(16);return o.translate(C,t,S),C}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!s||!u}useProgram(t,s){this.cache=this.cache||{};const u=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new Ha(this.context,t,zs[t],s,Jo[t],this._showOverdrawInspector,this.style.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new F(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class To{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,u){const m=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const C=1/(S=o.transformMat4([],S,t))[3]/s*m;return o.mul$1(S,S,[C,C,1/S[3],C])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const C=o.sub([],y[S[0]],y[S[1]]),M=o.sub([],y[S[2]],y[S[1]]),B=o.normalize([],o.cross([],C,M)),N=-o.dot(B,y[S[1]]);return B.concat(N)});return new To(y,w)}}class js{constructor(t,s){this.min=t,this.max=s,this.center=o.scale$1([],o.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],u=o.clone$2(this.min),m=o.clone$2(this.max);for(let y=0;y<s.length;y++)u[y]=s[y]?this.min[y]:this.center[y],m[y]=s[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new js(u,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let m=0;m<t.planes.length;m++){const y=t.planes[m];let w=0;for(let S=0;S<s.length;S++)o.dot$1(y,s[S])>=0&&w++;if(w===0)return 0;w!==s.length&&(u=!1)}if(u)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let S=0;S<t.points.length;S++){const C=t.points[S][m]-this.min[m];y=Math.min(y,C),w=Math.max(w,C)}if(w<0||y>this.max[m]-this.min[m])return 0}return 1}}class gs{constructor(t=0,s=0,u=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=u,this.right=m}interpolate(t,s,u){return s.top!=null&&t.top!=null&&(this.top=o.number(t.top,s.top,u)),s.bottom!=null&&t.bottom!=null&&(this.bottom=o.number(t.bottom,s.bottom,u)),s.left!=null&&t.left!=null&&(this.left=o.number(t.left,s.left,u)),s.right!=null&&t.right!=null&&(this.right=o.number(t.right,s.right,u)),this}getCenter(t,s){const u=o.clamp((this.left+t-this.right)/2,0,t),m=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(u,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new gs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Gs{constructor(t,s,u,m,y){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=y===void 0||!!y,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new gs,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Gs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-o.wrap(t,-180,180)*Math.PI/180;var u;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(u=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),function(m,y,w){var S=y[0],C=y[1],M=y[2],B=y[3],N=Math.sin(w),G=Math.cos(w);m[0]=S*G+M*N,m[1]=C*G+B*N,m[2]=S*-N+M*G,m[3]=C*-N+B*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,u){this._unmodified=!1,this._edgeInsets.interpolate(t,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new o.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const u=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),y=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new o.pointGeometry(0,this.height)),S=Math.floor(Math.min(u.x,m.x,y.x,w.x)),C=Math.floor(Math.max(u.x,m.x,y.x,w.x)),M=1;for(let B=S-M;B<=C+M;B++)B!==0&&s.push(new o.UnwrappedTileID(B,t))}return s}coveringTiles(t){var s,u;let m=this.coveringZoomLevel(t);const y=m;if(t.minzoom!==void 0&&m<t.minzoom)return[];t.maxzoom!==void 0&&m>t.maxzoom&&(m=t.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),S=o.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,m),M=[C*w.x,C*w.y,0],B=[C*S.x,C*S.y,0],N=To.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let G=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(G=m);const $=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,J=te=>({aabb:new js([te*C,0,0],[(te+1)*C,C,0]),zoom:0,x:0,y:0,wrap:te,fullyVisible:!1}),Y=[],le=[],fe=m,_e=t.reparseOverscaled?y:m;if(this._renderWorldCopies)for(let te=1;te<=3;te++)Y.push(J(-te)),Y.push(J(te));for(Y.push(J(0));Y.length>0;){const te=Y.pop(),Te=te.x,ye=te.y;let Pe=te.fullyVisible;if(!Pe){const at=te.aabb.intersects(N);if(at===0)continue;Pe=at===2}const De=t.terrain?M:B,Ne=te.aabb.distanceX(De),Ae=te.aabb.distanceY(De),ot=Math.max(Math.abs(Ne),Math.abs(Ae)),Je=$+(1<<fe-te.zoom)-2;if(te.zoom===fe||ot>Je&&te.zoom>=G){const at=fe-te.zoom,Dt=M[0]-.5-(Te<<at),Ot=M[1]-.5-(ye<<at);le.push({tileID:new o.OverscaledTileID(te.zoom===fe?_e:te.zoom,te.wrap,te.zoom,Te,ye),distanceSq:o.sqrLen([B[0]-.5-Te,B[1]-.5-ye]),tileDistanceToCamera:Math.sqrt(Dt*Dt+Ot*Ot)})}else for(let at=0;at<4;at++){const Dt=(Te<<1)+at%2,Ot=(ye<<1)+(at>>1),yt=te.zoom+1;let $t=te.aabb.quadrant(at);if(t.terrain){const ei=new o.OverscaledTileID(yt,te.wrap,yt,Dt,Ot),qt=t.terrain.getMinMaxElevation(ei),Kt=(s=qt.minElevation)!==null&&s!==void 0?s:this.elevation,ni=(u=qt.maxElevation)!==null&&u!==void 0?u:this.elevation;$t=new js([$t.min[0],$t.min[1],Kt],[$t.max[0],$t.max[1],ni])}Y.push({aabb:$t,zoom:yt,x:Dt,y:Ot,wrap:te.wrap,fullyVisible:Pe})}}return le.sort((te,Te)=>te.distanceSq-Te.distanceSq).map(te=>te.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=o.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.pointGeometry(o.mercatorXfromLng(t.lng)*this.worldSize,o.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new o.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,s){const u=o.MercatorCoordinate.fromLngLat(t),m=(1<<this.tileZoom)*o.EXTENT,y=u.x*m,w=u.y*m,S=Math.floor(y/o.EXTENT),C=Math.floor(w/o.EXTENT),M=new o.OverscaledTileID(this.tileZoom,0,this.tileZoom,S,C);return s.getElevation(M,y%o.EXTENT,w%o.EXTENT,o.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),u=this.getElevation(s,t);if(!(this.elevation-u))return;const m=this.getCameraPosition(),y=o.MercatorCoordinate.fromLngLat(m.lngLat,m.altitude),w=o.MercatorCoordinate.fromLngLat(s,u),S=y.x-w.x,C=y.y-w.y,M=y.z-w.z,B=Math.sqrt(S*S+C*C+M*M),N=this.scaleZoom(this.cameraToCenterDistance/B/this.tileSize);this._elevation=u,this._center=s,this.zoom=N}setLocationAtPoint(t,s){const u=this.pointCoordinate(s),m=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(t),w=new o.MercatorCoordinate(y.x-(u.x-m.x),y.y-(u.y-m.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return o.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const G=s.pointCoordinate(t);if(G!=null)return G}const u=[t.x,t.y,0,1],m=[t.x,t.y,1,1];o.transformMat4(u,u,this.pixelMatrixInverse),o.transformMat4(m,m,this.pixelMatrixInverse);const y=u[3],w=m[3],S=u[1]/y,C=m[1]/w,M=u[2]/y,B=m[2]/w,N=M===B?0:(0-M)/(B-M);return new o.MercatorCoordinate(o.number(u[0]/y,m[0]/w,N)/this.worldSize,o.number(S,C,N)/this.worldSize)}coordinatePoint(t,s=0,u=this.pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,s,1];return o.transformMat4(m,m,u),new o.pointGeometry(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new o.LngLatBounds().extend(this.pointLocation(new o.pointGeometry(0,t))).extend(this.pointLocation(new o.pointGeometry(this.width,t))).extend(this.pointLocation(new o.pointGeometry(this.width,this.height))).extend(this.pointLocation(new o.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const u=t.key,m=s?this._alignedPosMatrixCache:this._posMatrixCache;if(m[u])return m[u];const y=t.canonical,w=this.worldSize/this.zoomScale(y.z),S=y.x+Math.pow(2,y.z)*t.wrap,C=o.identity(new Float64Array(16));return o.translate(C,C,[S*w,y.y*w,0]),o.scale(C,C,[w/o.EXTENT,w/o.EXTENT,1]),o.multiply(C,s?this.alignedProjMatrix:this.projMatrix,C),m[u]=new Float32Array(C),m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,u,m,y=-90,w=90,S=-180,C=180;const M=this.size,B=this._unmodified;if(this.latRange){const $=this.latRange;y=o.mercatorYfromLat($[1])*this.worldSize,w=o.mercatorYfromLat($[0])*this.worldSize,t=w-y<M.y?M.y/(w-y):0}if(this.lngRange){const $=this.lngRange;S=o.wrap(o.mercatorXfromLng($[0])*this.worldSize,0,this.worldSize),C=o.wrap(o.mercatorXfromLng($[1])*this.worldSize,0,this.worldSize),C<S&&(C+=this.worldSize),s=C-S<M.x?M.x/(C-S):0}const N=this.point,G=Math.max(s||0,t||0);if(G)return this.center=this.unproject(new o.pointGeometry(s?(C+S)/2:N.x,t?(w+y)/2:N.y)),this.zoom+=this.scaleZoom(G),this._unmodified=B,void(this._constraining=!1);if(this.latRange){const $=N.y,J=M.y/2;$-J<y&&(m=y+J),$+J>w&&(m=w-J)}if(this.lngRange){const $=(S+C)/2,J=o.wrap(N.x,$-this.worldSize/2,$+this.worldSize/2),Y=M.x/2;J-Y<S&&(u=S+Y),J+Y>C&&(u=C-Y)}u===void 0&&m===void 0||(this.center=this.unproject(new o.pointGeometry(u!==void 0?u:N.x,m!==void 0?m:N.y)).wrap()),this._unmodified=B,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let m=o.identity(new Float64Array(16));o.scale(m,m,[this.width/2,-this.height/2,1]),o.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=o.identity(new Float64Array(16)),o.scale(m,m,[1,-1,1]),o.translate(m,m,[-1,-1,0]),o.scale(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const y=Math.PI/2+this._pitch,w=this._fov*(.5+t.y/this.height),S=Math.sin(w)*this.cameraToSeaLevelDistance/Math.sin(o.clamp(Math.PI-y-w,.01,Math.PI-.01)),C=this.getHorizon(),M=2*Math.atan(C/this.cameraToCenterDistance)*(.5+t.y/(2*C)),B=Math.sin(M)*this.cameraToSeaLevelDistance/Math.sin(o.clamp(Math.PI-y-M,.01,Math.PI-.01)),N=Math.cos(Math.PI/2-this._pitch)*S+this.cameraToSeaLevelDistance,G=Math.cos(Math.PI/2-this._pitch)*B+this.cameraToSeaLevelDistance,$=1.01*Math.min(N,G),J=this.height/50;m=new Float64Array(16),o.perspective(m,this._fov,this.width/this.height,J,$),m[8]=2*-t.x/this.width,m[9]=2*t.y/this.height,o.scale(m,m,[1,-1,1]),o.translate(m,m,[0,0,-this.cameraToCenterDistance]),o.rotateX(m,m,this._pitch),o.rotateZ(m,m,this.angle),o.translate(m,m,[-s,-u,0]),this.mercatorMatrix=o.scale([],m,[this.worldSize,this.worldSize,this.worldSize]),o.scale(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,m),o.translate(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=o.invert([],m),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,m);const Y=this.width%2/2,le=this.height%2/2,fe=Math.cos(this.angle),_e=Math.sin(this.angle),te=s-Math.round(s)+fe*Y+_e*le,Te=u-Math.round(u)+fe*le+_e*Y,ye=new Float64Array(m);if(o.translate(ye,ye,[te>.5?te-1:te,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=ye,m=o.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.pointGeometry(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let u=s.x,m=s.y,y=s.x,w=s.y;for(const S of t)u=Math.min(u,S.x),m=Math.min(m,S.y),y=Math.max(y,S.x),w=Math.max(w,S.y);return[new o.pointGeometry(u,m),new o.pointGeometry(y,m),new o.pointGeometry(y,w),new o.pointGeometry(u,w),new o.pointGeometry(u,m)]}}}class ml{constructor(t){this._hashName=t&&encodeURIComponent(t),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,u){let m=!1,y=null;const w=()=>{y=null,m&&(s(),y=setTimeout(w,300),m=!1)};return()=>(m=!0,y||w(),y)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,m=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),w=Math.round(s.lng*y)/y,S=Math.round(s.lat*y)/y,C=this._map.getBearing(),M=this._map.getPitch();let B="";if(B+=t?`/${w}/${S}/${u}`:`${u}/${S}/${w}`,(C||M)&&(B+="/"+Math.round(10*C)/10),M&&(B+=`/${Math.round(M)}`),this._hashName){const N=this._hashName;let G=!1;const $=window.location.hash.slice(1).split("&").map(J=>{const Y=J.split("=")[0];return Y===N?(G=!0,`${Y}=${B}`):J}).filter(J=>J);return G||$.push(`${N}=${B}`),`#${$.join("&")}`}return`#${B}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(s=u)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const qs={linearity:.3,easing:o.bezier(0,0,.3,1)},gl=o.extend({deceleration:2500,maxSpeed:1400},qs),_l=o.extend({deceleration:20,maxSpeed:1400},qs),yl=o.extend({deceleration:1e3,maxSpeed:360},qs),_s=o.extend({deceleration:1e3,maxSpeed:90},qs);class vl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=o.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const y=Xs(s.pan.mag(),u,o.extend({},gl,t||{}));m.offset=s.pan.mult(y.amount/s.pan.mag()),m.center=this._map.transform.center,Zs(m,y)}if(s.zoom){const y=Xs(s.zoom,u,_l);m.zoom=this._map.transform.zoom+y.amount,Zs(m,y)}if(s.bearing){const y=Xs(s.bearing,u,yl);m.bearing=this._map.transform.bearing+o.clamp(y.amount,-179,179),Zs(m,y)}if(s.pitch){const y=Xs(s.pitch,u,_s);m.pitch=this._map.transform.pitch+y.amount,Zs(m,y)}if(m.zoom||m.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),o.extend(m,{noMoveStart:!0})}}function Zs(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function Xs(f,t,s){const{maxSpeed:u,linearity:m,deceleration:y}=s,w=o.clamp(f*m/(t/1e3),-u,u),S=Math.abs(w)/(y*m);return{easing:s.easing,duration:1e3*S,amount:w*(S/2)}}class Cr extends o.Event{constructor(t,s,u,m={}){const y=A.mousePos(s.getCanvasContainer(),u),w=s.unproject(y);super(t,o.extend({point:y,lngLat:w,originalEvent:u},m)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Hs extends o.Event{constructor(t,s,u){const m=t==="touchend"?u.changedTouches:u.touches,y=A.touchPos(s.getCanvasContainer(),m),w=y.map(C=>s.unproject(C)),S=y.reduce((C,M,B,N)=>C.add(M.div(N.length)),new o.pointGeometry(0,0));super(t,{points:y,point:S,lngLats:w,lngLat:s.unproject(S),originalEvent:u}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ar extends o.Event{constructor(t,s,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Sc{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ar(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Cr(t.type,this._map,t))}mouseup(t){this._map.fire(new Cr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Cr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Cr(t.type,this._map,t))}mouseover(t){this._map.fire(new Cr(t.type,this._map,t))}mouseout(t){this._map.fire(new Cr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Hs(t.type,this._map,t))}touchmove(t){this._map.fire(new Hs(t.type,this._map,t))}touchend(t){this._map.fire(new Hs(t.type,this._map,t))}touchcancel(t){this._map.fire(new Hs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Cr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Cr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xl{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(A.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=u,this._box||(this._box=A.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(m.x,u.x),w=Math.max(m.x,u.x),S=Math.min(m.y,u.y),C=Math.max(m.y,u.y);A.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=w-y+"px",this._box.style.height=C-S+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const u=this._startPos,m=s;if(this.reset(),A.suppressClick(),u.x!==m.x||u.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(u,m,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(A.remove(this._box),this._box=null),A.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new o.Event(t,{originalEvent:s}))}}function un(f,t){if(f.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${t.length}`);const s={};for(let u=0;u<f.length;u++)s[f[u].identifier]=t[u];return s}class Ws{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(m){const y=new o.pointGeometry(0,0);for(const w of m)y._add(w);return y.div(m.length)}(s),this.touches=un(u,s)))}touchmove(t,s,u){if(this.aborted||!this.centroid)return;const m=un(u,s);for(const y in this.touches){const w=this.touches[y],S=m[y];(!S||S.dist(w)>30)&&(this.aborted=!0)}}touchend(t,s,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class ha{constructor(t){this.singleTap=new Ws(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,u){this.singleTap.touchstart(t,s,u)}touchmove(t,s,u){this.singleTap.touchmove(t,s,u)}touchend(t,s,u){const m=this.singleTap.touchend(t,s,u);if(m){const y=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(y&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Ic{constructor(){this._zoomIn=new ha({numTouches:1,numTaps:2}),this._zoomOut=new ha({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,u){this._zoomIn.touchstart(t,s,u),this._zoomOut.touchstart(t,s,u)}touchmove(t,s,u){this._zoomIn.touchmove(t,s,u),this._zoomOut.touchmove(t,s,u)}touchend(t,s,u){const m=this._zoomIn.touchend(t,s,u),y=this._zoomOut.touchend(t,s,u);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Cc={0:1,2:2};class ko{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const u=A.mouseButton(t);this._correctButton(t,u)&&(this._lastPoint=s,this._eventButton=u)}mousemoveWindow(t,s){const u=this._lastPoint;if(u){if(t.preventDefault(),function(m,y){const w=Cc[y];return m.buttons===void 0||(m.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(u,s)}}mouseupWindow(t){this._lastPoint&&A.mouseButton(t)===this._eventButton&&(this._moved&&A.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ks extends ko{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class hn extends ko{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const u=.8*(s.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){t.preventDefault()}}class ct extends ko{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const u=-.5*(s.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){t.preventDefault()}}class bl{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,u){return this._calculateTransform(t,s,u)}touchmove(t,s,u){if(this._map._cooperativeGestures&&(this._minTouches===2&&u.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,u.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(u.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,u)}touchend(t,s,u){this._calculateTransform(t,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,u){u.length>0&&(this._active=!0);const m=un(u,s),y=new o.pointGeometry(0,0),w=new o.pointGeometry(0,0);let S=0;for(const M in m){const B=m[M],N=this._touches[M];N&&(y._add(B),w._add(B.sub(N)),S++,m[M]=B)}if(this._touches=m,S<this._minTouches||!w.mag())return;const C=w.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,u){return{}}touchstart(t,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,u){if(!this._firstTwoTouches)return;t.preventDefault();const[m,y]=this._firstTwoTouches,w=En(u,s,m),S=En(u,s,y);if(!w||!S)return;const C=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],C,t)}touchend(t,s,u){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,w=En(u,s,m),S=En(u,s,y);w&&S||(this._active&&A.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function En(f,t,s){for(let u=0;u<f.length;u++)if(f[u].identifier===s)return t[u]}function fa(f,t){return Math.log(f/t)/Math.LN2}class et extends jn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(fa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fa(this._distance,u),pinchAround:s}}}function Eo(f,t){return 180*f.angleWith(t)/Math.PI}class Ac extends jn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const u=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Eo(this._vector,u),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,u=Eo(t,this._startVector);return Math.abs(u)<s}}function da(f){return Math.abs(f.y)>Math.abs(f.x)}class pa extends jn{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,u){super.touchstart(t,s,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,da(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,u){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),y=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,u){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,y=s.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=t.y>0==s.y>0;return da(t)&&da(s)&&w}}const wl={panStep:100,bearingStep:15,pitchStep:10};class Tl{constructor(){const t=wl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,u=0,m=0,y=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,m=0),{cameraAnimation:S=>{const C=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:zc,zoom:s?Math.round(C)+s*(t.shiftKey?2:1):C,bearing:S.getBearing()+u*this._bearingStep,pitch:S.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zc(f){return f*(2-f)}const kl=4.000244140625;class ma{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=o.exported.now(),m=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%kl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=A.mousePos(this._el,t);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>kl?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&C!==0&&(C=1/C);const M=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(M*C))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,u=this._startZoom,m=this._easing;let y,w=!1;if(this._type==="wheel"&&u&&m){const S=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),C=m(S);y=o.number(u,s,C),S<1?this._frameId||(this._frameId=!0):w=!0}else y=s,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:y-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=o.ease;if(this._prevEase){const u=this._prevEase,m=(o.exported.now()-u.start)/u.duration,y=u.easing(m+.01)-u.easing(m),w=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-w*w);s=o.bezier(w,S,.25,1)}return this._prevEase={start:o.exported.now(),duration:t,easing:s},s}reset(){this._active=!1}}class ga{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _a{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ya{constructor(){this._tap=new ha({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=s[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,s,u))}touchmove(t,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const m=s[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,s,u)}touchend(t,s,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,s,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yr{constructor(t,s,u){this._el=t,this._mousePan=s,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sn{constructor(t,s,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class El{constructor(t,s,u,m){this._el=t,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ys=f=>f.zoom||f.drag||f.pitch||f.rotate;class va extends o.Event{}function Js(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Sl{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vl(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,w]of this._listeners)A.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,s,u]of this._listeners)A.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new Sc(s,t));const m=s.boxZoom=new xl(s,t);this._add("boxZoom",m);const y=new Ic,w=new _a;s.doubleClickZoom=new ga(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const S=new ya;this._add("tapDragZoom",S);const C=s.touchPitch=new pa(s);this._add("touchPitch",C);const M=new hn(t),B=new ct(t);s.dragRotate=new Sn(t,M,B),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const N=new Ks(t),G=new bl(t,s);s.dragPan=new yr(u,N,G),this._add("mousePan",N),this._add("touchPan",G,["touchZoom","touchRotate"]);const $=new Ac,J=new et;s.touchZoomRotate=new El(u,J,$,S),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]);const Y=s.scrollZoom=new ma(s,this);this._add("scrollZoom",Y,["mousePan"]);const le=s.keyboard=new Tl;this._add("keyboard",le),this._add("blockableMapEvent",new kn(s));for(const fe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[fe]&&s[fe].enable(t[fe])}_add(t,s,u){this._handlers.push({handlerName:t,handler:s,allowed:u}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ys(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,u){for(const m in t)if(m!==u&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const u of t)this._el.contains(u.target)&&s.push(u);return s}handleEvent(t,s){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const u=t.type==="renderFrame"?void 0:t,m={needsRenderFrame:!1},y={},w={},S=t.touches,C=S?this._getMapTouches(S):void 0,M=C?A.touchPos(this._el,C):A.mousePos(this._el,t);for(const{handlerName:G,handler:$,allowed:J}of this._handlers){if(!$.isEnabled())continue;let Y;this._blockedByActive(w,J,G)?$.reset():$[s||t.type]&&(Y=$[s||t.type](t,M,C),this.mergeHandlerResult(m,y,Y,G,u),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||$.isActive())&&(w[G]=$)}const B={};for(const G in this._previousActiveHandlers)w[G]||(B[G]=u);this._previousActiveHandlers=w,(Object.keys(B).length||Js(m))&&(this._changes.push([m,y,B]),this._triggerRenderFrame()),(Object.keys(w).length||Js(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=m;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(t,s,u,m,y){if(!u)return;o.extend(t,u);const w={handlerName:m,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(s.zoom=w),u.panDelta!==void 0&&(s.drag=w),u.pitchDelta!==void 0&&(s.pitch=w),u.bearingDelta!==void 0&&(s.rotate=w)}_applyChanges(){const t={},s={},u={};for(const[m,y,w]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),o.extend(s,y),o.extend(u,w);this._updateMapTransform(t,s,u),this._changes=[]}_updateMapTransform(t,s,u){const m=this._map,y=m.transform,w=m.style&&m.style.terrain;if(!(Js(t)||w&&this._drag))return this._fireEvents(s,u,!0);let{panDelta:S,zoomDelta:C,bearingDelta:M,pitchDelta:B,around:N,pinchAround:G}=t;G!==void 0&&(N=G),m._stop(!0),N=N||m.transform.centerPoint;const $=y.pointLocation(S?N.sub(S):N);M&&(y.bearing+=M),B&&(y.pitch+=B),C&&(y.zoom+=C),w?s.drag&&!this._drag?(this._drag={center:y.centerPoint,lngLat:y.pointLocation(N),point:N,handlerName:s.drag.handlerName},m.fire(new o.Event("freezeElevation",{freeze:!0}))):this._drag&&u[this._drag.handlerName]?(m.fire(new o.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(y.center=y.pointLocation(y.centerPoint.sub(S))):y.setLocationAtPoint($,N),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,u,!0)}_fireEvents(t,s,u){const m=ys(this._eventsInProgress),y=ys(t),w={};for(const B in t){const{originalEvent:N}=t[B];this._eventsInProgress[B]||(w[`${B}start`]=N),this._eventsInProgress[B]=t[B]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const B in w)this._fireEvent(B,w[B]);y&&this._fireEvent("move",y.originalEvent);for(const B in t){const{originalEvent:N}=t[B];this._fireEvent(B,N)}const S={};let C;for(const B in this._eventsInProgress){const{handlerName:N,originalEvent:G}=this._eventsInProgress[B];this._handlersById[N].isActive()||(delete this._eventsInProgress[B],C=s[N]||G,S[`${B}end`]=C)}for(const B in S)this._fireEvent(B,S[B]);const M=ys(this._eventsInProgress);if(u&&(m||y)&&!M){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;B?(N(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:C})):(this._map.fire(new o.Event("moveend",{originalEvent:C})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new o.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new va("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Or={extend:(f,...t)=>o.extend(f,...t),run(f){f()},logToElement(f,t=!1,s="log"){const u=window.document.getElementById(s);u&&(t&&(u.innerHTML=""),u.innerHTML+=`<br>${f}`)}};class wi extends o.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,u){return t=o.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},s),u)}panTo(t,s,u){return this.easeTo(o.extend({center:t},s),u)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,u){return this.easeTo(o.extend({zoom:t},s),u)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,u){return this.easeTo(o.extend({bearing:t},s),u)}resetNorth(t,s){return this.rotateTo(0,o.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=o.LngLatBounds.convert(t);const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,s)}_cameraForBoxAndBearing(t,s,u,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=o.extend({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const ye=m.padding;m.padding={top:ye,bottom:ye,right:ye,left:ye}}m.padding=o.extend(y,m.padding);const w=this.transform,S=w.padding,C=w.project(o.LngLat.convert(t)),M=w.project(o.LngLat.convert(s)),B=C.rotate(-u*Math.PI/180),N=M.rotate(-u*Math.PI/180),G=new o.pointGeometry(Math.max(B.x,N.x),Math.max(B.y,N.y)),$=new o.pointGeometry(Math.min(B.x,N.x),Math.min(B.y,N.y)),J=G.sub($),Y=(w.width-(S.left+S.right+m.padding.left+m.padding.right))/J.x,le=(w.height-(S.top+S.bottom+m.padding.top+m.padding.bottom))/J.y;if(le<0||Y<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const fe=Math.min(w.scaleZoom(w.scale*Math.min(Y,le)),m.maxZoom),_e=o.pointGeometry.convert(m.offset),te=new o.pointGeometry((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(u*Math.PI/180),Te=_e.add(te).mult(w.scale/w.zoomScale(fe));return{center:w.unproject(C.add(M).div(2).sub(Te)),zoom:fe,bearing:u}}fitBounds(t,s,u){return this._fitInternal(this.cameraForBounds(t,s),s,u)}fitScreenCoordinates(t,s,u,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(t)),this.transform.pointLocation(o.pointGeometry.convert(s)),u,m),m,y)}_fitInternal(t,s,u){return t?(delete(s=o.extend(t,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(t,s){this.stop();const u=this.transform;let m=!1,y=!1,w=!1;return"zoom"in t&&u.zoom!==+t.zoom&&(m=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=o.LngLat.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(y=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(w=!0,u.pitch=+t.pitch),t.padding==null||u.isPaddingEqual(t.padding)||(u.padding=t.padding),this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),m&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),y&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),w&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s))}calculateCameraOptionsFromTo(t,s,u,m=0){const y=o.MercatorCoordinate.fromLngLat(t,s),w=o.MercatorCoordinate.fromLngLat(u,m),S=w.x-y.x,C=w.y-y.y,M=w.z-y.z,B=Math.hypot(S,C,M);if(B===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(S,C),G=this.transform.scaleZoom(this.transform.cameraToCenterDistance/B/this.transform.tileSize),$=180*Math.atan2(S,-C)/Math.PI;let J=180*Math.acos(N/B)/Math.PI;return J=M<0?90-J:90+J,{center:w.toLngLat(),zoom:G,pitch:J,bearing:$}}easeTo(t,s){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.ease},t)).animate===!1||!t.essential&&o.exported.prefersReducedMotion)&&(t.duration=0);const u=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),C="zoom"in t?+t.zoom:m,M="bearing"in t?this._normalizeBearing(t.bearing,y):y,B="pitch"in t?+t.pitch:w,N="padding"in t?t.padding:u.padding,G=o.pointGeometry.convert(t.offset);let $=u.centerPoint.add(G);const J=u.pointLocation($),Y=o.LngLat.convert(t.center||J);this._normalizeCenter(Y);const le=u.project(J),fe=u.project(Y).sub(le),_e=u.zoomScale(C-m);let te,Te;t.around&&(te=o.LngLat.convert(t.around),Te=u.locationPoint(te));const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||C!==m,this._rotating=this._rotating||y!==M,this._pitching=this._pitching||B!==w,this._padding=!u.isPaddingEqual(N),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,ye),this._ease(Pe=>{if(this._zooming&&(u.zoom=o.number(m,C,Pe)),this._rotating&&(u.bearing=o.number(y,M,Pe)),this._pitching&&(u.pitch=o.number(w,B,Pe)),this._padding&&(u.interpolatePadding(S,N,Pe),$=u.centerPoint.add(G)),te)u.setLocationAtPoint(te,Te);else{const De=u.zoomScale(u.zoom-m),Ne=C>m?Math.min(2,_e):Math.max(.5,_e),Ae=Math.pow(Ne,1-Pe),ot=u.unproject(le.add(fe.mult(Pe*Ae)).mult(De));u.setLocationAtPoint(u.renderWorldCopies?ot.wrap():ot,$)}this._fireMoveEvents(s)},Pe=>{this._afterEase(s,Pe)},t),this}_prepareEase(t,s,u={}){this._moving=!0,this.fire(new o.Event("freezeElevation",{freeze:!0})),s||u.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!u.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new o.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new o.Event("freezeElevation",{freeze:!1}));const u=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new o.Event("zoomend",t)),m&&this.fire(new o.Event("rotateend",t)),y&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,s){if(!t.essential&&o.exported.prefersReducedMotion){const yt=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(yt,s)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},t);const u=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),C="zoom"in t?o.clamp(+t.zoom,u.minZoom,u.maxZoom):m,M="bearing"in t?this._normalizeBearing(t.bearing,y):y,B="pitch"in t?+t.pitch:w,N="padding"in t?t.padding:u.padding,G=u.zoomScale(C-m),$=o.pointGeometry.convert(t.offset);let J=u.centerPoint.add($);const Y=u.pointLocation(J),le=o.LngLat.convert(t.center||Y);this._normalizeCenter(le);const fe=u.project(Y),_e=u.project(le).sub(fe);let te=t.curve;const Te=Math.max(u.width,u.height),ye=Te/G,Pe=_e.mag();if("minZoom"in t){const yt=o.clamp(Math.min(t.minZoom,m,C),u.minZoom,u.maxZoom),$t=Te/u.zoomScale(yt-m);te=Math.sqrt($t/Pe*2)}const De=te*te;function Ne(yt){const $t=(ye*ye-Te*Te+(yt?-1:1)*De*De*Pe*Pe)/(2*(yt?ye:Te)*De*Pe);return Math.log(Math.sqrt($t*$t+1)-$t)}function Ae(yt){return(Math.exp(yt)-Math.exp(-yt))/2}function ot(yt){return(Math.exp(yt)+Math.exp(-yt))/2}const Je=Ne(0);let at=function(yt){return ot(Je)/ot(Je+te*yt)},Dt=function(yt){return Te*((ot(Je)*(Ae($t=Je+te*yt)/ot($t))-Ae(Je))/De)/Pe;var $t},Ot=(Ne(1)-Je)/te;if(Math.abs(Pe)<1e-6||!isFinite(Ot)){if(Math.abs(Te-ye)<1e-6)return this.easeTo(t,s);const yt=ye<Te?-1:1;Ot=Math.abs(Math.log(ye/Te))/te,Dt=function(){return 0},at=function($t){return Math.exp(yt*te*$t)}}return t.duration="duration"in t?+t.duration:1e3*Ot/("screenSpeed"in t?+t.screenSpeed/te:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=y!==M,this._pitching=B!==w,this._padding=!u.isPaddingEqual(N),this._prepareEase(s,!1),this._ease(yt=>{const $t=yt*Ot,ei=1/at($t);u.zoom=yt===1?C:m+u.scaleZoom(ei),this._rotating&&(u.bearing=o.number(y,M,yt)),this._pitching&&(u.pitch=o.number(w,B,yt)),this._padding&&(u.interpolatePadding(S,N,yt),J=u.centerPoint.add($));const qt=yt===1?le:u.unproject(fe.add(_e.mult(Dt($t))).mult(ei));u.setLocationAtPoint(u.renderWorldCopies?qt.wrap():qt,J),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,s,u){u.animate===!1||u.duration===0?(t(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=o.wrap(t,-180,180);const u=Math.abs(t-s);return Math.abs(t-360-s)<u&&(t-=360),Math.abs(t+360-s)<u&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const u=t.lng-s.center.lng;t.lng+=u>180?-360:u<-180?360:0}}class Ys{constructor(t={}){this.options=t,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=A.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=A.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){A.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const u=this._map._getUIString(`AttributionControl.${s}`);t.title=u,t.setAttribute("aria-label",u)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style.sourceCaches;for(const m in s){const y=s[m];if(y.used||y.usedForTerrain){const w=y.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,y)=>m.length-y.length),t=t.filter((m,y)=>{for(let w=y+1;w<t.length;w++)if(t[w].indexOf(m)>=0)return!1;return!0});const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class So{constructor(t={}){this.options=t,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=A.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=A.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){A.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Il{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const m of u)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Cl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Al={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Mc={showCompass:!0,showZoom:!0,visualizePitch:!1};class $r{constructor(t,s,u=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new hn({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new ct({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),A.addEventListener(s,"mousedown",this.mousedown),A.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),A.addEventListener(s,"touchmove",this.touchmove),A.addEventListener(s,"touchend",this.touchend),A.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),A.disableDrag()}move(t,s){const u=this.map,m=this.mouseRotate.mousemoveWindow(t,s);if(m&&m.bearingDelta&&u.setBearing(u.getBearing()+m.bearingDelta),this.mousePitch){const y=this.mousePitch.mousemoveWindow(t,s);y&&y.pitchDelta&&u.setPitch(u.getPitch()+y.pitchDelta)}}off(){const t=this.element;A.removeEventListener(t,"mousedown",this.mousedown),A.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),A.removeEventListener(t,"touchmove",this.touchmove),A.removeEventListener(t,"touchend",this.touchend),A.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){A.enableDrag(),A.removeEventListener(window,"mousemove",this.mousemove),A.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(o.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),A.mousePos(this.element,t)),A.addEventListener(window,"mousemove",this.mousemove),A.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,A.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=A.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=A.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Qs(f,t,s){if(f=new o.LngLat(f.lng,f.lat),t){const u=new o.LngLat(f.lng-360,f.lat),m=new o.LngLat(f.lng+360,f.lat),y=s.locationPoint(f).distSqr(t);s.locationPoint(u).distSqr(t)<y?f=u:s.locationPoint(m).distSqr(t)<y&&(f=m)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f}const pt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tt(f,t,s){const u=f.classList;for(const m in pt)u.remove(`maplibregl-${s}-anchor-${m}`,`mapboxgl-${s}-anchor-${m}`);u.add(`maplibregl-${s}-anchor-${t}`,`mapboxgl-${s}-anchor-${t}`)}class vs extends o.Evented{constructor(t,s){if(super(),(t instanceof HTMLElement||s)&&(t=o.extend({element:t},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=A.create("div"),this._element.setAttribute("aria-label","Map marker");const u=A.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${m}px`),u.setAttributeNS(null,"width",`${y}px`),u.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const w=A.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const S=A.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const C=A.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const _e of M){const te=A.createNS("http://www.w3.org/2000/svg","ellipse");te.setAttributeNS(null,"opacity","0.04"),te.setAttributeNS(null,"cx","10.5"),te.setAttributeNS(null,"cy","5.80029008"),te.setAttributeNS(null,"rx",_e.rx),te.setAttributeNS(null,"ry",_e.ry),C.appendChild(te)}const B=A.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const N=A.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(N);const G=A.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"fill","#000000");const $=A.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),G.appendChild($);const J=A.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(6.0, 7.0)"),J.setAttributeNS(null,"fill","#FFFFFF");const Y=A.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=A.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const fe=A.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#FFFFFF"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962"),Y.appendChild(le),Y.appendChild(fe),S.appendChild(C),S.appendChild(B),S.appendChild(G),S.appendChild(J),S.appendChild(Y),u.appendChild(S),u.setAttributeNS(null,"height",m*this._scale+"px"),u.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(u),this._offset=o.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),Tt(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),A.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,u=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,u=this._element;this._popup&&(s===u||u.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Qs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let u="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?u="rotateX(0deg)":this._pitchAlignment==="map"&&(u=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),A.setTransform(this._element,`${pt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${u} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),y=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*y?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=o.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const xa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let In,Yi=0,Cn=!1;const en={maxWidth:100,unit:"metric"};function zl(f,t,s){const u=s&&s.maxWidth||100,m=f._container.clientHeight/2,y=f.unproject([0,m]),w=f.unproject([u,m]),S=y.distanceTo(w);if(s&&s.unit==="imperial"){const C=3.2808*S;C>5280?An(t,u,C/5280,f._getUIString("ScaleControl.Miles")):An(t,u,C,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?An(t,u,S/1852,f._getUIString("ScaleControl.NauticalMiles")):S>=1e3?An(t,u,S/1e3,f._getUIString("ScaleControl.Kilometers")):An(t,u,S,f._getUIString("ScaleControl.Meters"))}function An(f,t,s,u){const m=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const M=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*M)/M}(S),w*S}(s);f.style.width=t*(m/s)+"px",f.innerHTML=`${m}&nbsp;${u}`}const Ii={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Di=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ba(f){if(f){if(typeof f=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(f,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,f),"top-left":new o.pointGeometry(t,t),"top-right":new o.pointGeometry(-t,t),bottom:new o.pointGeometry(0,-f),"bottom-left":new o.pointGeometry(t,-t),"bottom-right":new o.pointGeometry(-t,-t),left:new o.pointGeometry(f,0),right:new o.pointGeometry(-f,0)}}if(f instanceof o.pointGeometry||Array.isArray(f)){const t=o.pointGeometry.convert(f);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.pointGeometry.convert(f.center||[0,0]),top:o.pointGeometry.convert(f.top||[0,0]),"top-left":o.pointGeometry.convert(f["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(f["top-right"]||[0,0]),bottom:o.pointGeometry.convert(f.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(f["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(f["bottom-right"]||[0,0]),left:o.pointGeometry.convert(f.left||[0,0]),right:o.pointGeometry.convert(f.right||[0,0])}}return ba(new o.pointGeometry(0,0))}const Gn={supported:b,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends wi{constructor(f){var t;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(f=o.extend({},Al,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Gs(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new Il,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Cl,f.locale),this._clickTolerance=f.clickTolerance,this._pixelRatio=(t=f.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new V(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Sl(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new ml(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,o.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new Ys({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new So,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new o.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new o.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new o.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,t,s,u){return u==null&&this.style.terrain&&(u=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(f,t,s,u)}resize(f){const t=this._containerDimensions(),s=t[0],u=t[1];this._resizeCanvas(s,u,this.getPixelRatio()),this.transform.resize(s,u),this.painter.resize(s,u,this.getPixelRatio());const m=!this._moving;return m&&(this.stop(),this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f))),this.fire(new o.Event("resize",f)),m&&this.fire(new o.Event("moveend",f)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(f){const[t,s]=this._containerDimensions();this._pixelRatio=f,this._resizeCanvas(t,s,f),this.painter.resize(t,s,f)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(o.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(o.LngLat.convert(f),this.style&&this.style.terrain)}unproject(f){return this.transform.pointLocation(o.pointGeometry.convert(f),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(f,t,s){if(f==="mouseenter"||f==="mouseover"){let u=!1;return{layer:t,listener:s,delegates:{mousemove:y=>{const w=this.getLayer(t)?this.queryRenderedFeatures(y.point,{layers:[t]}):[];w.length?u||(u=!0,s.call(this,new Cr(f,this,y.originalEvent,{features:w}))):u=!1},mouseout:()=>{u=!1}}}}if(f==="mouseleave"||f==="mouseout"){let u=!1;return{layer:t,listener:s,delegates:{mousemove:w=>{(this.getLayer(t)?this.queryRenderedFeatures(w.point,{layers:[t]}):[]).length?u=!0:u&&(u=!1,s.call(this,new Cr(f,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,s.call(this,new Cr(f,this,w.originalEvent)))}}}}{const u=m=>{const y=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];y.length&&(m.features=y,s.call(this,m),delete m.features)};return{layer:t,listener:s,delegates:{[f]:u}}}}on(f,t,s){if(s===void 0)return super.on(f,t);const u=this._createDelegatedListener(f,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(u);for(const m in u.delegates)this.on(m,u.delegates[m]);return this}once(f,t,s){if(s===void 0)return super.once(f,t);const u=this._createDelegatedListener(f,t,s);for(const m in u.delegates)this.once(m,u.delegates[m]);return this}off(f,t,s){return s===void 0?super.off(f,t):(this._delegatedListeners&&this._delegatedListeners[f]&&(u=>{const m=this._delegatedListeners[f];for(let y=0;y<m.length;y++){const w=m[y];if(w.layer===t&&w.listener===s){for(const S in w.delegates)this.off(S,w.delegates[S]);return m.splice(y,1),this}}})(),this)}queryRenderedFeatures(f,t){if(!this.style)return[];let s;if(t!==void 0||f===void 0||f instanceof o.pointGeometry||Array.isArray(f)||(t=f,f=void 0),t=t||{},(f=f||[[0,0],[this.transform.width,this.transform.height]])instanceof o.pointGeometry||typeof f[0]=="number")s=[o.pointGeometry.convert(f)];else{const u=o.pointGeometry.convert(f[0]),m=o.pointGeometry.convert(f[1]);s=[u,new o.pointGeometry(m.x,u.y),m,new o.pointGeometry(u.x,m.y),u]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(f,t){return this.style.querySourceFeatures(f,t)}setStyle(f,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(f,t))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),f?(this.style=new sr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new sr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,t){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,o.ResourceType.Style);o.getJSON(s,(u,m)=>{u?this.fire(new o.ErrorEvent(u)):m&&this._updateDiff(m,t)})}else typeof f=="object"&&this._updateDiff(f,t)}_updateDiff(f,t){try{this.style.setState(f)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(f,t){return this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)}isSourceLoaded(f){const t=this.style&&this.style.sourceCaches[f];if(t!==void 0)return t.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){return this.style.setTerrain(f),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const t in f){const s=f[t]._tiles;for(const u in s){const m=s[u];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(f,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,s)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,t,{pixelRatio:s=1,sdf:u=!1,stretchX:m,stretchY:y,content:w}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||o.isImageBitmap(t)){const{width:S,height:C,data:M}=o.exported.getImageData(t);this.style.addImage(f,{data:new o.RGBAImage({width:S,height:C},M),pixelRatio:s,stretchX:m,stretchY:y,content:w,sdf:u,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:C,data:M}=t,B=t;this.style.addImage(f,{data:new o.RGBAImage({width:S,height:C},new Uint8Array(M)),pixelRatio:s,stretchX:m,stretchY:y,content:w,sdf:u,version:0,userImage:B}),B.onAdd&&B.onAdd(this,f)}}}updateImage(f,t){const s=this.style.getImage(f);if(!s)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||o.isImageBitmap(t)?o.exported.getImageData(t):t,{width:m,height:y,data:w}=u;if(m===void 0||y===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==s.data.width||y!==s.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(t instanceof HTMLImageElement||o.isImageBitmap(t));s.data.replace(w,S),this.style.updateImage(f,s)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,t){o.getImage(this._requestManager.transformRequest(f,o.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(f,t){return this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)}moveLayer(f,t){return this.style.moveLayer(f,t),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,t,s){return this.style.setLayerZoomRange(f,t,s),this._update(!0)}setFilter(f,t,s={}){return this.style.setFilter(f,t,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,t,s,u={}){return this.style.setPaintProperty(f,t,s,u),this._update(!0)}getPaintProperty(f,t){return this.style.getPaintProperty(f,t)}setLayoutProperty(f,t,s,u={}){return this.style.setLayoutProperty(f,t,s,u),this._update(!0)}getLayoutProperty(f,t){return this.style.getLayoutProperty(f,t)}setLight(f,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,t){return this.style.setFeatureState(f,t),this._update()}removeFeatureState(f,t){return this.style.removeFeatureState(f,t),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,t=0;return this._container&&(f=this._container.clientWidth||400,t=this._container.clientHeight||300),[f,t]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=A.create("div","maplibregl-canvas-container mapboxgl-canvas-container",f);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=A.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const u=this._controlContainer=A.create("div","maplibregl-control-container mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=A.create("div",`maplibregl-ctrl-${y} mapboxgl-ctrl-${y}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const f=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=A.create("div","maplibregl-cooperative-gesture-screen",f);let t="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",u=>{u.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",u=>{u.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",u=>{this._onCooperativeGesture(u,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(f,t,s){this._canvas.width=s*f,this._canvas.height=s*t,this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const f=o.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);t?(this.painter=new ua(t,this.transform),o.exported$1.testSupport(t)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(f,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){let t,s=0;const u=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,t),s=o.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let m=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,S=o.exported.now();this.style.zoomHistory.update(w,S);const C=new o.EvaluationParameters(w,{now:S,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=C.crossFadingFactor();M===1&&M===this._crossFadingFactor||(m=!0,this._crossFadingFactor=M),this.style.update(C)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const w=o.exported.now()-s;u.endQueryEXT(u.TIME_ELAPSED_EXT,t),setTimeout(()=>{const S=u.getQueryObjectEXT(t,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(t),this.fire(new o.Event("gpu-timing-frame",{cpuTime:w,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){const w=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(w);this.fire(new o.Event("gpu-timing-layer",{layerTimes:S}))},50)}const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),A.remove(this._canvasContainer),A.remove(this._controlContainer),this._cooperativeGestures&&A.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(f=>{o.PerformanceUtils.frame(f),this._frame=null,this._render(f)}))}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,t){o.setCacheLimits(f,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(f){this.options=o.extend({},Mc,f),this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map.getZoom(),t=f===this._map.getMaxZoom(),s=f===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=f}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $r(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){A.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,t){const s=A.create("button",f,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(f,t){const s=this._map._getUIString(`NavigationControl.${t}`);f.title=s,f.setAttribute("aria-label",s)}},GeolocateControl:class extends o.Evented{constructor(f){super(),this.options=o.extend({},xa,f),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(f){var t;return this._map=f,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,In!==void 0?t(In):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{In=s.state!=="denied",t(In)}):(In=!!window.navigator.geolocation,t(In)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),A.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Yi=0,Cn=!1}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),s=f.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",f)),this._finish()}}_updateCamera(f){const t=new o.LngLat(f.coords.longitude,f.coords.latitude),s=f.coords.accuracy,u=this._map.getBearing(),m=o.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new o.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._container.clientHeight/2,t=this._map.unproject([0,f]),s=this._map.unproject([1,f]),u=t.distanceTo(s),m=Math.ceil(2*this._accuracy/u);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Cn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=A.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new vs(this._dotElement),this._circleElement=A.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Yi--,Cn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Yi++,Yi>1?(f={maximumAge:6e5,timeout:0},Cn=!0):(f=this.options.positionOptions,Cn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ys,LogoControl:So,ScaleControl:class{constructor(f){this.options=o.extend({},en,f),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){zl(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){A.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,zl(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=A.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){A.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=A.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(f){this.options=f,o.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(f){return this._map=f,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=A.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){A.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends o.Evented{constructor(f){super(),this.options=o.extend(Object.create(Ii),f),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&A.remove(this._content),this._container&&(A.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=o.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=f;u=s.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=A.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=A.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_update(f){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=A.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=A.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(y=>this._container.classList.add(y)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qs(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!f))return;const t=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat);let s=this.options.anchor;const u=ba(this.options.offset);if(!s){const y=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=t.y+u.bottom.y<w?["top"]:t.y>this._map.transform.height-w?["bottom"]:[],t.x<y/2?S.push("left"):t.x>this._map.transform.width-y/2&&S.push("right"),s=S.length===0?"bottom":S.join("-")}const m=t.add(u[s]).round();A.setTransform(this._container,`${pt[s]} translate(${m.x}px,${m.y}px)`),Tt(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Di);f&&f.focus()}_onClose(){this.remove()}},Marker:vs,Style:sr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:Mi,GeoJSONSource:mr,ImageSource:Lt,RasterDEMTileSource:bt,RasterTileSource:nr,VectorTileSource:si,VideoSource:Ri,prewarm:function(){is().acquire(Rr)},clearPrewarmedResources:function(){const f=vn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Rr),vn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return kr.workerCount},set workerCount(f){kr.workerCount=f},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){o.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){o.clearTileCache(f)},workerUrl:"",addProtocol(f,t){o.config.REGISTERED_PROTOCOLS[f]=t},removeProtocol(f){delete o.config.REGISTERED_PROTOCOLS[f]}};return Or.extend(Gn,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),Gn});var x=h;return x})})(gp);var _y=gp.exports;const Vo=dp(_y);var Br=(d,n,c)=>new Promise((l,h)=>{var _=b=>{try{o(c.next(b))}catch(E){h(E)}},x=b=>{try{o(c.throw(b))}catch(E){h(E)}},o=b=>b.done?l(b.value):Promise.resolve(b.value).then(_,x);o((c=c.apply(d,n)).next())}),Jr=Uint8Array,No=Uint16Array,yy=Int32Array,yp=new Jr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vp=new Jr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vy=new Jr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xp=function(d,n){for(var c=new No(31),l=0;l<31;++l)c[l]=n+=1<<d[l-1];for(var h=new yy(c[30]),l=1;l<30;++l)for(var _=c[l];_<c[l+1];++_)h[_]=_-c[l]<<5|l;return{b:c,r:h}},bp=xp(yp,2),wp=bp.b,xy=bp.r;wp[28]=258,xy[258]=28;var by=xp(vp,0),wy=by.b,Tu=new No(32768);for(ci=0;ci<32768;++ci)$n=(ci&43690)>>1|(ci&21845)<<1,$n=($n&52428)>>2|($n&13107)<<2,$n=($n&61680)>>4|($n&3855)<<4,Tu[ci]=(($n&65280)>>8|($n&255)<<8)>>1;var $n,ci,qa=function(d,n,c){for(var l=d.length,h=0,_=new No(n);h<l;++h)d[h]&&++_[d[h]-1];var x=new No(n);for(h=1;h<n;++h)x[h]=x[h-1]+_[h-1]<<1;var o;if(c){o=new No(1<<n);var b=15-n;for(h=0;h<l;++h)if(d[h])for(var E=h<<4|d[h],I=n-d[h],P=x[d[h]-1]++<<I,A=P|(1<<I)-1;P<=A;++P)o[Tu[P]>>b]=E}else for(o=new No(l),h=0;h<l;++h)d[h]&&(o[h]=Tu[x[d[h]-1]++]>>15-d[h]);return o},Xa=new Jr(288);for(ci=0;ci<144;++ci)Xa[ci]=8;var ci;for(ci=144;ci<256;++ci)Xa[ci]=9;var ci;for(ci=256;ci<280;++ci)Xa[ci]=7;var ci;for(ci=280;ci<288;++ci)Xa[ci]=8;var ci,Tp=new Jr(32);for(ci=0;ci<32;++ci)Tp[ci]=5;var ci,Ty=qa(Xa,9,1),ky=qa(Tp,5,1),yu=function(d){for(var n=d[0],c=1;c<d.length;++c)d[c]>n&&(n=d[c]);return n},_n=function(d,n,c){var l=n/8|0;return(d[l]|d[l+1]<<8)>>(n&7)&c},vu=function(d,n){var c=n/8|0;return(d[c]|d[c+1]<<8|d[c+2]<<16)>>(n&7)},Ey=function(d){return(d+7)/8|0},Sy=function(d,n,c){(n==null||n<0)&&(n=0),(c==null||c>d.length)&&(c=d.length);var l=new Jr(c-n);return l.set(d.subarray(n,c)),l},Iy=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Kr=function(d,n,c){var l=new Error(n||Iy[d]);if(l.code=d,Error.captureStackTrace&&Error.captureStackTrace(l,Kr),!c)throw l;return l},Pu=function(d,n,c,l){var h=d.length,_=l?l.length:0;if(!h||n.f&&!n.l)return c||new Jr(0);var x=!c||n.i!=2,o=n.i;c||(c=new Jr(h*3));var b=function(pi){var Ni=c.length;if(pi>Ni){var Rr=new Jr(Math.max(Ni*2,pi));Rr.set(c),c=Rr}},E=n.f||0,I=n.p||0,P=n.b||0,A=n.l,V=n.d,U=n.m,F=n.n,Q=h*8;do{if(!A){E=_n(d,I,1);var pe=_n(d,I+1,3);if(I+=3,pe)if(pe==1)A=Ty,V=ky,U=9,F=5;else if(pe==2){var ze=_n(d,I,31)+257,Oe=_n(d,I+10,15)+4,Me=ze+_n(d,I+5,31)+1;I+=14;for(var Ue=new Jr(Me),zt=new Jr(19),dt=0;dt<Oe;++dt)zt[vy[dt]]=_n(d,I+dt*3,7);I+=Oe*3;for(var yi=yu(zt),_t=(1<<yi)-1,si=qa(zt,yi,1),dt=0;dt<Me;){var nr=si[_n(d,I,_t)];I+=nr&15;var ae=nr>>4;if(ae<16)Ue[dt++]=ae;else{var ii=0,bt=0;for(ae==16?(bt=3+_n(d,I,3),I+=2,ii=Ue[dt-1]):ae==17?(bt=3+_n(d,I,7),I+=3):ae==18&&(bt=11+_n(d,I,127),I+=7);bt--;)Ue[dt++]=ii}}var mr=Ue.subarray(0,ze),Si=Ue.subarray(ze);U=yu(mr),F=yu(Si),A=qa(mr,U,1),V=qa(Si,F,1)}else Kr(1);else{var ae=Ey(I)+4,Se=d[ae-4]|d[ae-3]<<8,Ge=ae+Se;if(Ge>h){o&&Kr(0);break}x&&b(P+Se),c.set(d.subarray(ae,Ge),P),n.b=P+=Se,n.p=I=Ge*8,n.f=E;continue}if(I>Q){o&&Kr(0);break}}x&&b(P+131072);for(var Lt=(1<<U)-1,Ri=(1<<F)-1,Mi=I;;Mi=I){var ii=A[vu(d,I)&Lt],Ai=ii>>4;if(I+=ii&15,I>Q){o&&Kr(0);break}if(ii||Kr(2),Ai<256)c[P++]=Ai;else if(Ai==256){Mi=I,A=null;break}else{var ur=Ai-254;if(Ai>264){var dt=Ai-257,Ui=yp[dt];ur=_n(d,I,(1<<Ui)-1)+wp[dt],I+=Ui}var Ki=V[vu(d,I)&Ri],gr=Ki>>4;Ki||Kr(3),I+=Ki&15;var Si=wy[gr];if(gr>3){var Ui=vp[gr];Si+=vu(d,I)&(1<<Ui)-1,I+=Ui}if(I>Q){o&&Kr(0);break}x&&b(P+131072);var _r=P+ur;if(P<Si){var Tr=_-Si,Xe=Math.min(Si,_r);for(Tr+P<0&&Kr(3);P<Xe;++P)c[P]=l[Tr+P]}for(;P<_r;P+=4)c[P]=c[P-Si],c[P+1]=c[P+1-Si],c[P+2]=c[P+2-Si],c[P+3]=c[P+3-Si];P=_r}}n.l=A,n.p=Mi,n.b=P,n.f=E,A&&(E=1,n.m=U,n.d=V,n.n=F)}while(!E);return P==c.length?c:Sy(c,0,P)},Cy=new Jr(0),Ay=function(d){(d[0]!=31||d[1]!=139||d[2]!=8)&&Kr(6,"invalid gzip data");var n=d[3],c=10;n&4&&(c+=(d[10]|d[11]<<8)+2);for(var l=(n>>3&1)+(n>>4&1);l>0;l-=!d[c++]);return c+(n&2)},zy=function(d){var n=d.length;return(d[n-4]|d[n-3]<<8|d[n-2]<<16|d[n-1]<<24)>>>0},My=function(d,n){return((d[0]&15)!=8||d[0]>>4>7||(d[0]<<8|d[1])%31)&&Kr(6,"invalid zlib data"),(d[1]>>5&1)==+!n&&Kr(6,"invalid zlib data: "+(d[1]&32?"need":"unexpected")+" dictionary"),(d[1]>>3&4)+2};function Py(d,n){return Pu(d,{i:2},n&&n.out,n&&n.dictionary)}function Dy(d,n){var c=Ay(d);return c+8>d.length&&Kr(6,"invalid gzip data"),Pu(d.subarray(c,-8),{i:2},n&&n.out||new Jr(zy(d)),n&&n.dictionary)}function Ly(d,n){return Pu(d.subarray(My(d,n&&n.dictionary),-4),{i:2},n&&n.out,n&&n.dictionary)}function ku(d,n){return d[0]==31&&d[1]==139&&d[2]==8?Dy(d,n):(d[0]&15)!=8||d[0]>>4>7||(d[0]<<8|d[1])%31?Py(d,n):Ly(d,n)}var By=typeof TextDecoder<"u"&&new TextDecoder,Ry=0;try{By.decode(Cy,{stream:!0}),Ry=1}catch{}var kp=(d,n)=>d*Math.pow(2,n),Na=(d,n)=>Math.floor(d/Math.pow(2,n)),oc=(d,n)=>kp(d.getUint16(n+1,!0),8)+d.getUint8(n),Ep=(d,n)=>kp(d.getUint32(n+2,!0),16)+d.getUint16(n,!0),Fy=(d,n,c,l,h)=>{if(d!=l.getUint8(h))return d-l.getUint8(h);const _=oc(l,h+1);if(n!=_)return n-_;const x=oc(l,h+4);return c!=x?c-x:0},Oy=(d,n,c,l)=>{const h=Sp(d,n|128,c,l);return h?{z:n,x:c,y:l,offset:h[0],length:h[1],is_dir:!0}:null},hd=(d,n,c,l)=>{const h=Sp(d,n,c,l);return h?{z:n,x:c,y:l,offset:h[0],length:h[1],is_dir:!1}:null},Sp=(d,n,c,l)=>{let h=0,_=d.byteLength/17-1;for(;h<=_;){const x=_+h>>1,o=Fy(n,c,l,d,x*17);if(o>0)h=x+1;else if(o<0)_=x-1;else return[Ep(d,x*17+7),d.getUint32(x*17+13,!0)]}return null},Vy=(d,n)=>d.is_dir&&!n.is_dir?1:!d.is_dir&&n.is_dir?-1:d.z!==n.z?d.z-n.z:d.x!==n.x?d.x-n.x:d.y-n.y,Ip=(d,n)=>{const c=d.getUint8(n*17);return{z:c&127,x:oc(d,n*17+1),y:oc(d,n*17+4),offset:Ep(d,n*17+7),length:d.getUint32(n*17+13,!0),is_dir:c>>7===1}},fd=d=>{const n=[],c=new DataView(d);for(let l=0;l<c.byteLength/17;l++)n.push(Ip(c,l));return Uy(n)},Uy=d=>{d.sort(Vy);const n=new ArrayBuffer(17*d.length),c=new Uint8Array(n);for(let l=0;l<d.length;l++){const h=d[l];let _=h.z;h.is_dir&&(_=_|128),c[l*17]=_,c[l*17+1]=h.x&255,c[l*17+2]=h.x>>8&255,c[l*17+3]=h.x>>16&255,c[l*17+4]=h.y&255,c[l*17+5]=h.y>>8&255,c[l*17+6]=h.y>>16&255,c[l*17+7]=h.offset&255,c[l*17+8]=Na(h.offset,8)&255,c[l*17+9]=Na(h.offset,16)&255,c[l*17+10]=Na(h.offset,24)&255,c[l*17+11]=Na(h.offset,32)&255,c[l*17+12]=Na(h.offset,48)&255,c[l*17+13]=h.length&255,c[l*17+14]=h.length>>8&255,c[l*17+15]=h.length>>16&255,c[l*17+16]=h.length>>24&255}return n},Ny=(d,n)=>{if(d.byteLength<17)return null;const c=d.byteLength/17,l=Ip(d,c-1);if(l.is_dir){const h=l.z,_=n.z-h,x=Math.trunc(n.x/(1<<_)),o=Math.trunc(n.y/(1<<_));return{z:h,x,y:o}}return null};function jy(d){return Br(this,null,function*(){const n=yield d.getBytes(0,512e3),c=new DataView(n.data),l=c.getUint32(4,!0),h=c.getUint16(8,!0),_=new TextDecoder("utf-8"),x=JSON.parse(_.decode(new DataView(n.data,10,l)));let o=0;x.compression==="gzip"&&(o=2);let b=0;"minzoom"in x&&(b=+x.minzoom);let E=0;"maxzoom"in x&&(E=+x.maxzoom);let I=0,P=0,A=0,V=-180,U=-85,F=180,Q=85;if(x.bounds){const ae=x.bounds.split(",");V=+ae[0],U=+ae[1],F=+ae[2],Q=+ae[3]}if(x.center){const ae=x.center.split(",");I=+ae[0],P=+ae[1],A=+ae[2]}return{specVersion:c.getUint16(2,!0),rootDirectoryOffset:10+l,rootDirectoryLength:h*17,jsonMetadataOffset:10,jsonMetadataLength:l,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:b,maxZoom:E,minLon:V,minLat:U,maxLon:F,maxLat:Q,centerZoom:A,centerLon:I,centerLat:P,etag:n.etag}})}function Gy(d,n,c,l,h,_,x){return Br(this,null,function*(){let o=yield c.getArrayBuffer(n,d.rootDirectoryOffset,d.rootDirectoryLength,d);d.specVersion===1&&(o=fd(o));const b=hd(new DataView(o),l,h,_);if(b){let P=(yield n.getBytes(b.offset,b.length,x)).data;const A=new DataView(P);return A.getUint8(0)==31&&A.getUint8(1)==139&&(P=ku(new Uint8Array(P))),{data:P}}const E=Ny(new DataView(o),{z:l,x:h,y:_});if(E){const I=Oy(new DataView(o),E.z,E.x,E.y);if(I){let P=yield c.getArrayBuffer(n,I.offset,I.length,d);d.specVersion===1&&(P=fd(P));const A=hd(new DataView(P),l,h,_);if(A){let U=(yield n.getBytes(A.offset,A.length,x)).data;const F=new DataView(U);return F.getUint8(0)==31&&F.getUint8(1)==139&&(U=ku(new Uint8Array(U))),{data:U}}}}})}var Cp={getHeader:jy,getZxy:Gy},qy=class{constructor(){this.tile=(d,n)=>{if(d.type=="json"){const c=d.url.substr(10);let l=this.tiles.get(c);return l||(l=new dd(c),this.tiles.set(c,l)),l.getHeader().then(h=>{const _={tiles:[d.url+"/{z}/{x}/{y}"],minzoom:h.minZoom,maxzoom:h.maxZoom,bounds:[h.minLon,h.minLat,h.maxLon,h.maxLat]};n(null,_,null,null)}).catch(h=>{n(h,null,null,null)}),{cancel:()=>{}}}else{const c=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),l=d.url.match(c);if(!l)throw new Error("Invalid PMTiles protocol URL");const h=l[1];let _=this.tiles.get(h);_||(_=new dd(h),this.tiles.set(h,_));const x=l[2],o=l[3],b=l[4],E=new AbortController,I=E.signal;let P=()=>{E.abort()};return _.getHeader().then(A=>{_.getZxy(+x,+o,+b,I).then(V=>{V?n(null,new Uint8Array(V.data),V.cacheControl,V.expires):A.tileType==1?n(null,new Uint8Array,null,null):n(null,null,null,null)}).catch(V=>{V.name!=="AbortError"&&n(V,null,null,null)})}),{cancel:P}}},this.tiles=new Map}add(d){this.tiles.set(d.source.getKey(),d)}get(d){return this.tiles.get(d)}};function Oo(d,n){return(n>>>0)*4294967296+(d>>>0)}function Zy(d,n){const c=n.buf;let l,h;if(h=c[n.pos++],l=(h&112)>>4,h<128||(h=c[n.pos++],l|=(h&127)<<3,h<128)||(h=c[n.pos++],l|=(h&127)<<10,h<128)||(h=c[n.pos++],l|=(h&127)<<17,h<128)||(h=c[n.pos++],l|=(h&127)<<24,h<128)||(h=c[n.pos++],l|=(h&1)<<31,h<128))return Oo(d,l);throw new Error("Expected varint not more than 10 bytes")}function ja(d){const n=d.buf;let c,l;return l=n[d.pos++],c=l&127,l<128||(l=n[d.pos++],c|=(l&127)<<7,l<128)||(l=n[d.pos++],c|=(l&127)<<14,l<128)||(l=n[d.pos++],c|=(l&127)<<21,l<128)?c:(l=n[d.pos],c|=(l&15)<<28,Zy(c,d))}function Xy(d,n,c,l){if(l==0){c==1&&(n[0]=d-1-n[0],n[1]=d-1-n[1]);const h=n[0];n[0]=n[1],n[1]=h}}var Hy=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Wy(d,n,c){if(d>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(n>Math.pow(2,d)-1||c>Math.pow(2,d)-1)throw Error("tile x/y outside zoom level bounds");const l=Hy[d],h=Math.pow(2,d);let _=0,x=0,o=0;const b=[n,c];let E=h/2;for(;E>0;)_=(b[0]&E)>0?1:0,x=(b[1]&E)>0?1:0,o+=E*E*(3*_^x),Xy(E,b,_,x),E=E/2;return l+o}function Ap(d,n){return Br(this,null,function*(){if(n===1||n===0)return d;if(n===2){if(typeof globalThis.DecompressionStream>"u")return ku(new Uint8Array(d));{let l=new Response(d).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(l).arrayBuffer()}}else throw Error("Compression method not supported")})}var Ky=127;function Jy(d,n){let c=0,l=d.length-1;for(;c<=l;){const h=l+c>>1,_=n-d[h].tileId;if(_>0)c=h+1;else if(_<0)l=h-1;else return d[h]}return l>=0&&(d[l].runLength===0||n-d[l].tileId<d[l].runLength)?d[l]:null}var Yy=class{constructor(d){this.url=d}getKey(){return this.url}getBytes(d,n,c){return Br(this,null,function*(){let l;c||(l=new AbortController,c=l.signal);let h=yield fetch(this.url,{signal:c,headers:{Range:"bytes="+d+"-"+(d+n-1)}});if(h.status===416&&d===0){const o=h.headers.get("Content-Range");if(!o||!o.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const b=+o.substr(8);h=yield fetch(this.url,{signal:c,headers:{Range:"bytes=0-"+(b-1)}})}if(h.status>=300)throw Error("Bad response code: "+h.status);const _=h.headers.get("Content-Length");if(h.status===200&&(!_||+_>n))throw l&&l.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield h.arrayBuffer(),etag:h.headers.get("ETag")||void 0,cacheControl:h.headers.get("Cache-Control")||void 0,expires:h.headers.get("Expires")||void 0}})}};function yn(d,n){const c=d.getUint32(n+4,!0),l=d.getUint32(n+0,!0);return c*Math.pow(2,32)+l}function Qy(d,n){const c=new DataView(d),l=c.getUint8(7);if(l>3)throw Error(`Archive is spec version ${l} but this library supports up to spec version 3`);return{specVersion:l,rootDirectoryOffset:yn(c,8),rootDirectoryLength:yn(c,16),jsonMetadataOffset:yn(c,24),jsonMetadataLength:yn(c,32),leafDirectoryOffset:yn(c,40),leafDirectoryLength:yn(c,48),tileDataOffset:yn(c,56),tileDataLength:yn(c,64),numAddressedTiles:yn(c,72),numTileEntries:yn(c,80),numTileContents:yn(c,88),clustered:c.getUint8(96)===1,internalCompression:c.getUint8(97),tileCompression:c.getUint8(98),tileType:c.getUint8(99),minZoom:c.getUint8(100),maxZoom:c.getUint8(101),minLon:c.getInt32(102,!0)/1e7,minLat:c.getInt32(106,!0)/1e7,maxLon:c.getInt32(110,!0)/1e7,maxLat:c.getInt32(114,!0)/1e7,centerZoom:c.getUint8(118),centerLon:c.getInt32(119,!0)/1e7,centerLat:c.getInt32(123,!0)/1e7,etag:n}}function zp(d){const n={buf:new Uint8Array(d),pos:0},c=ja(n),l=[];let h=0;for(let _=0;_<c;_++){const x=ja(n);l.push({tileId:h+x,offset:0,length:0,runLength:1}),h+=x}for(let _=0;_<c;_++)l[_].runLength=ja(n);for(let _=0;_<c;_++)l[_].length=ja(n);for(let _=0;_<c;_++){const x=ja(n);x===0&&_>0?l[_].offset=l[_-1].offset+l[_-1].length:l[_].offset=x-1}return l}function $y(d){const n=new DataView(d);return n.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):n.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var jo=class extends Error{};function e1(d,n,c,l){return Br(this,null,function*(){const h=yield d.getBytes(0,16384);if(new DataView(h.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if($y(h.data)<3)return[yield Cp.getHeader(d)];const x=h.data.slice(0,Ky);let o=h.etag;l&&h.etag!=l&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+d.getKey()),o=void 0);const b=Qy(x,o);if(c){const E=h.data.slice(b.rootDirectoryOffset,b.rootDirectoryOffset+b.rootDirectoryLength),I=d.getKey()+"|"+(b.etag||"")+"|"+b.rootDirectoryOffset+"|"+b.rootDirectoryLength,P=zp(yield n(E,b.internalCompression));return[b,[I,P.length,P]]}return[b,void 0]})}function t1(d,n,c,l,h){return Br(this,null,function*(){const _=yield d.getBytes(c,l);if(h.etag&&h.etag!==_.etag)throw new jo(_.etag);const x=yield n(_.data,h.internalCompression),o=zp(x);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var i1=class{constructor(d=100,n=!0,c=Ap){this.cache=new Map,this.maxCacheEntries=d,this.counter=1,this.prefetch=n,this.decompress=c}getHeader(d,n){return Br(this,null,function*(){const c=d.getKey();if(this.cache.has(c))return this.cache.get(c).lastUsed=this.counter++,yield this.cache.get(c).data;const l=new Promise((h,_)=>{e1(d,this.decompress,this.prefetch,n).then(x=>{x[1]&&this.cache.set(x[1][0],{lastUsed:this.counter++,data:Promise.resolve(x[1][2])}),h(x[0]),this.prune()}).catch(x=>{_(x)})});return this.cache.set(c,{lastUsed:this.counter++,data:l}),l})}getDirectory(d,n,c,l){return Br(this,null,function*(){const h=d.getKey()+"|"+(l.etag||"")+"|"+n+"|"+c;if(this.cache.has(h))return this.cache.get(h).lastUsed=this.counter++,yield this.cache.get(h).data;const _=new Promise((x,o)=>{t1(d,this.decompress,n,c,l).then(b=>{x(b),this.prune()}).catch(b=>{o(b)})});return this.cache.set(h,{lastUsed:this.counter++,data:_}),_})}getArrayBuffer(d,n,c,l){return Br(this,null,function*(){const h=d.getKey()+"|"+(l.etag||"")+"|"+n+"|"+c;if(this.cache.has(h))return this.cache.get(h).lastUsed=this.counter++,yield this.cache.get(h).data;const _=new Promise((x,o)=>{d.getBytes(n,c).then(b=>{if(l.etag&&l.etag!==b.etag)throw new jo(b.etag);x(b.data),this.cache.has(h),this.prune()}).catch(b=>{o(b)})});return this.cache.set(h,{lastUsed:this.counter++,data:_}),_})}prune(){if(this.cache.size>=this.maxCacheEntries){let d=1/0,n;this.cache.forEach((c,l)=>{c.lastUsed<d&&(d=c.lastUsed,n=l)}),n&&this.cache.delete(n)}}invalidate(d,n){return Br(this,null,function*(){this.cache.delete(d.getKey()),yield this.getHeader(d,n)})}},dd=class{constructor(d,n,c){typeof d=="string"?this.source=new Yy(d):this.source=d,c?this.decompress=c:this.decompress=Ap,n?this.cache=n:this.cache=new i1}getHeader(){return Br(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(d,n,c,l){return Br(this,null,function*(){const h=Wy(d,n,c),_=yield this.cache.getHeader(this.source);if(_.specVersion<3)return Cp.getZxy(_,this.source,this.cache,d,n,c,l);if(d<_.minZoom||d>_.maxZoom)return;let x=_.rootDirectoryOffset,o=_.rootDirectoryLength;for(let b=0;b<=3;b++){const E=yield this.cache.getDirectory(this.source,x,o,_),I=Jy(E,h);if(I)if(I.runLength>0){const P=yield this.source.getBytes(_.tileDataOffset+I.offset,I.length,l);if(_.etag&&_.etag!==P.etag)throw new jo(P.etag);return{data:yield this.decompress(P.data,_.tileCompression),cacheControl:P.cacheControl,expires:P.expires}}else x=_.leafDirectoryOffset+I.offset,o=I.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(d,n,c,l){return Br(this,null,function*(){try{return yield this.getZxyAttempt(d,n,c,l)}catch(h){if(h instanceof jo)return this.cache.invalidate(this.source,h.message),yield this.getZxyAttempt(d,n,c,l);throw h}})}getMetadataAttempt(){return Br(this,null,function*(){const d=yield this.cache.getHeader(this.source),n=yield this.source.getBytes(d.jsonMetadataOffset,d.jsonMetadataLength);if(d.etag&&d.etag!==n.etag)throw new jo(n.etag);const c=yield this.decompress(n.data,d.internalCompression),l=new TextDecoder("utf-8");return JSON.parse(l.decode(c))})}getMetadata(){return Br(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(d){if(d instanceof jo)return this.cache.invalidate(this.source,d.message),yield this.getMetadataAttempt();throw d}})}};const{document:pd}=zg;function md(d){let n;const c=d[20].default,l=$i(c,d,d[19],null);return{c(){l&&l.c()},l(h){l&&l.l(h)},m(h,_){l&&l.m(h,_),n=!0},p(h,_){l&&l.p&&(!n||_&524288)&&er(l,c,h,h[19],n?ir(c,h[19],_,null):tr(h[19]),null)},i(h){n||(Ee(l,h),n=!0)},o(h){Be(l,h),n=!1},d(h){l&&l.d(h)}}}function r1(d){let n,c,l,h,_,x=d[3]&&md(d);return{c(){n=xe("link"),l=qe(),h=xe("div"),x&&x.c(),this.h()},l(o){const b=up("svelte-19mu9pj",pd.head);n=be(b,"LINK",{rel:!0,href:!0}),b.forEach(X),l=Ze(o),h=be(o,"DIV",{id:!0,class:!0});var E=we(h);x&&x.l(E),E.forEach(X),this.h()},h(){ee(n,"rel","stylesheet"),ee(n,"href",c=d[1]?d[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"),ee(h,"id",d[0]),ee(h,"class","map svelte-1tna482")},m(o,b){ue(pd.head,n),ge(o,l,b),ge(o,h,b),x&&x.m(h,null),d[21](h),_=!0},p(o,[b]){(!_||b&2&&c!==(c=o[1]?o[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"))&&ee(n,"href",c),o[3]?x?(x.p(o,b),b&8&&Ee(x,1)):(x=md(o),x.c(),Ee(x,1),x.m(h,null)):x&&(ui(),Be(x,1,1,()=>{x=null}),hi()),(!_||b&1)&&ee(h,"id",o[0])},i(o){_||(Ee(x),_=!0)},o(o){Be(x),_=!1},d(o){X(n),o&&X(l),o&&X(h),x&&x.d(),d[21](null)}}}function n1(d=1e3){return new Promise(n=>setTimeout(n,d))}function s1(d,n,c){let{$$slots:l={},$$scope:h}=n;const _=Su();let{map:x}=n,{id:o="map"}=n,{location:b={lng:15,lat:45,zoom:1}}=n,{style:E={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=n,{css:I=null}=n,{pmtiles:P=!1}=n,{options:A={}}=n,{minzoom:V=0}=n,{maxzoom:U=14}=n,{controls:F=!1}=n,{tabbable:Q=!1}=n,{zoom:pe=null}=n,{center:ae=null}=n,{pitch:Se=null}=n,{bearing:Ge=null}=n,{interactive:ze=!0}=n,{attribution:Oe=!0}=n,Me,Ue={},zt=!1;so("map",{getMap:()=>x}),b.bounds?Ue.bounds=b.bounds:b.lng&&b.lat&&(Ue.center=[+b.lng,+b.lat],b.zoom&&(Ue.zoom=+b.zoom),b.pitch&&(Ue.pitch=+b.pitch),b.bearing&&(Ue.bearing=+b.bearing)),Oe||(Ue.attributionControl=!1),Ue={...Ue,...A},Au(()=>{if(P){let _t=new qy;Vo.addProtocol("pmtiles",_t.tile)}c(4,x=new Vo.Map({container:Me,style:E,minZoom:V,maxZoom:U,interactive:ze,...Ue})),F&&!Array.isArray(F)?x.addControl(new Vo.NavigationControl({showCompass:!1})):Array.isArray(F)&&F!=["locate"]&&x.addControl(new Vo.NavigationControl({showCompass:F.includes("compass"),visualizePitch:F.includes("pitch")})),Array.isArray(F)&&F.includes("locate")&&x.addControl(new Vo.GeolocateControl),x.on("load",_t=>{c(5,pe=x.getZoom()),c(6,ae=x.getCenter()),c(7,Se=x.getPitch()),c(8,Ge=x.getBearing()),c(3,zt=!0),!Q&&document.querySelector(`#${o} canvas`)&&(document.querySelector(`#${o} canvas`).tabIndex="-1"),_("load",{event:_t})}),x.on("moveend",()=>{c(5,pe=x.getZoom()),c(6,ae=x.getCenter()),c(7,Se=x.getPitch()),c(8,Ge=x.getBearing())})}),cc(async()=>{await n1(250),x&&x.remove(),c(4,x=null)});function dt(_t){x&&x.setStyle(_t),_("style",{style:_t})}function yi(_t){lc[_t?"unshift":"push"](()=>{Me=_t,c(2,Me)})}return d.$$set=_t=>{"map"in _t&&c(4,x=_t.map),"id"in _t&&c(0,o=_t.id),"location"in _t&&c(9,b=_t.location),"style"in _t&&c(10,E=_t.style),"css"in _t&&c(1,I=_t.css),"pmtiles"in _t&&c(11,P=_t.pmtiles),"options"in _t&&c(12,A=_t.options),"minzoom"in _t&&c(13,V=_t.minzoom),"maxzoom"in _t&&c(14,U=_t.maxzoom),"controls"in _t&&c(15,F=_t.controls),"tabbable"in _t&&c(16,Q=_t.tabbable),"zoom"in _t&&c(5,pe=_t.zoom),"center"in _t&&c(6,ae=_t.center),"pitch"in _t&&c(7,Se=_t.pitch),"bearing"in _t&&c(8,Ge=_t.bearing),"interactive"in _t&&c(17,ze=_t.interactive),"attribution"in _t&&c(18,Oe=_t.attribution),"$$scope"in _t&&c(19,h=_t.$$scope)},d.$$.update=()=>{d.$$.dirty&1024&&dt(E)},[o,I,Me,zt,x,pe,ae,Se,Ge,b,E,P,A,V,U,F,Q,ze,Oe,h,l,yi]}let o1=class extends fi{constructor(n){super(),di(this,n,s1,r1,ti,{map:4,id:0,location:9,style:10,css:1,pmtiles:11,options:12,minzoom:13,maxzoom:14,controls:15,tabbable:16,zoom:5,center:6,pitch:7,bearing:8,interactive:17,attribution:18})}};function gd(d){let n;const c=d[12].default,l=$i(c,d,d[11],null);return{c(){l&&l.c()},l(h){l&&l.l(h)},m(h,_){l&&l.m(h,_),n=!0},p(h,_){l&&l.p&&(!n||_&2048)&&er(l,c,h,h[11],n?ir(c,h[11],_,null):tr(h[11]),null)},i(h){n||(Ee(l,h),n=!0)},o(h){Be(l,h),n=!1},d(h){l&&l.d(h)}}}function a1(d){let n,c,l=d[0]&&gd(d);return{c(){l&&l.c(),n=xt()},l(h){l&&l.l(h),n=xt()},m(h,_){l&&l.m(h,_),ge(h,n,_),c=!0},p(h,[_]){h[0]?l?(l.p(h,_),_&1&&Ee(l,1)):(l=gd(h),l.c(),Ee(l,1),l.m(n.parentNode,n)):l&&(ui(),Be(l,1,1,()=>{l=null}),hi())},i(h){c||(Ee(l),c=!0)},o(h){Be(l),c=!1},d(h){l&&l.d(h),h&&X(n)}}}function l1(d=1e3){return new Promise(n=>setTimeout(n,d))}function c1(d,n,c){let{$$slots:l={},$$scope:h}=n,{id:_}=n,{type:x}=n,{url:o=null}=n,{props:b={}}=n,{data:E=null}=n,{layer:I=null}=n,{promoteId:P=null}=n,{minzoom:A=null}=n,{maxzoom:V=null}=n,{tilesize:U=256}=n,F=!1,Q=o;const{getMap:pe}=oo("map"),ae=pe();so("source",{source:_,layer:I,promoteId:P}),ae.getSource(_)&&ae.removeSource(_);async function Se(){await l1(100),ae.isSourceLoaded(_)?(c(0,F=!0),console.log(_+" map source loaded!")):(console.log("..."),Se())}A&&(b.minzoom=A),V&&(b.maxzoom=V),I&&P?(b.promoteId={},b.promoteId[I]=P):P&&(b.promoteId=P);function Ge(){console.log(_+" map source loading...");let Ue;x=="geojson"?E?Ue={type:x,data:E,...b}:o&&(Ue={type:x,data:o,...b}):x=="vector"?(Ue={type:x,...b},o.slice(0,7)==="pmtiles"?Ue.url=o:Ue.tiles=[o]):x=="raster"?Ue={type:x,tiles:[o],tileSize:U,...b}:x=="raster-dem"&&(Ue={type:x,tiles:[o],tileSize:U,...b}),Ue&&(console.log(Ue),ae.addSource(_,Ue),Se())}function ze(Ue){let zt=ae.getSource(_);zt&&zt.setData(Ue)}function Oe(Ue){if(Ue!==Q){let zt=ae.getSource(_);zt&&(Ue.slice(0,7)==="pmtiles"?zt.setUrl(Ue):zt.setTiles([Ue])),Q=Ue}}function Me(Ue){Ue!==Q&&(ae.getSource(_).tiles=[Ue],ae.style.sourceCaches[_].clearTiles(),ae.style.sourceCaches[_].update(ae.transform),ae.triggerRepaint(),Q=Ue)}return Au(Ge),cc(async()=>{ae&&ae.getSource(_)&&(ae.getStyle().layers.filter(zt=>zt.source==_).forEach(zt=>{ae.removeLayer(zt.id)}),ae.removeSource(_))}),d.$$set=Ue=>{"id"in Ue&&c(2,_=Ue.id),"type"in Ue&&c(3,x=Ue.type),"url"in Ue&&c(4,o=Ue.url),"props"in Ue&&c(1,b=Ue.props),"data"in Ue&&c(5,E=Ue.data),"layer"in Ue&&c(6,I=Ue.layer),"promoteId"in Ue&&c(7,P=Ue.promoteId),"minzoom"in Ue&&c(8,A=Ue.minzoom),"maxzoom"in Ue&&c(9,V=Ue.maxzoom),"tilesize"in Ue&&c(10,U=Ue.tilesize),"$$scope"in Ue&&c(11,h=Ue.$$scope)},d.$$.update=()=>{d.$$.dirty&41&&x=="geojson"&&F&&ze(E),d.$$.dirty&25&&x=="vector"&&F&&Oe(o),d.$$.dirty&25&&x=="raster"&&F&&Me(o)},[F,b,_,x,o,E,I,P,A,V,U,h,l]}class u1 extends fi{constructor(n){super(),di(this,n,c1,a1,ti,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const h1=d=>({hovered:d[0]&1}),_d=d=>({hovered:d[0]});function f1(d){let n;const c=d[30].default,l=$i(c,d,d[29],_d);return{c(){l&&l.c()},l(h){l&&l.l(h)},m(h,_){l&&l.m(h,_),n=!0},p(h,_){l&&l.p&&(!n||_[0]&536870913)&&er(l,c,h,h[29],n?ir(c,h[29],_,h1):tr(h[29]),_d)},i(h){n||(Ee(l,h),n=!0)},o(h){Be(l,h),n=!1},d(h){l&&l.d(h)}}}function d1(d,n,c){let l,{$$slots:h={},$$scope:_}=n;const x=Su();let{id:o}=n,{type:b}=n,{filter:E=null}=n,{layout:I={}}=n,{paint:P={}}=n,{data:A=null}=n,{colorKey:V="color"}=n,{nameKey:U=null}=n,{valueKey:F=null}=n,{idKey:Q=null}=n,{select:pe=!1}=n,{clickIgnore:ae=!1}=n,{clickCenter:Se=!1}=n,{selected:Ge=null}=n,{hover:ze=!1}=n,{hovered:Oe=null}=n,{highlight:Me=!1}=n,{highlightKey:Ue="highlighted"}=n,{highlighted:zt=[]}=n,{order:dt=null}=n,{maxzoom:yi=null}=n,{minzoom:_t=null}=n,{sourceLayer:si=null}=n,{visible:nr=!0}=n;const{source:ii,layer:bt,promoteId:mr}=oo("source"),{getMap:Si}=oo("map"),Lt=Si();so("layer",{layer:o});const Ri=hp({id:null,feature:null,event:null});ac(d,Ri,Xe=>c(32,l=Xe)),so("hover",Ri),Q=Q||mr,si=si||bt;let Mi=null,Ai=null,ur=[];I.visibility=nr?"visible":"none";let Ui={id:o,type:b,source:ii,paint:P,layout:I};E&&(Ui.filter=E),si&&(Ui["source-layer"]=si),yi&&(Ui.maxzoom=yi),_t&&(Ui.minzoom=_t),Au(()=>{Lt.getLayer(o)&&Lt.removeLayer(o),Lt.addLayer(Ui,dt)});function Ki(Xe,pi=V){if(console.log("updating colors..."),U||F)for(const Ni of Xe)Lt.setFeatureState({source:ii,sourceLayer:si,id:Ni[Q]},{color:pi?Ni[pi]:null,name:U?Ni[U]:null,value:F?Ni[F]:null});else for(const Ni of Xe)Lt.setFeatureState({source:ii,sourceLayer:si,id:Ni[Q]},{color:Ni[pi]})}function gr(Xe){Lt.getLayer(o)&&Lt.setFilter(o,Xe)}function _r(Xe){if(Lt.getLayer(o))for(const pi in Xe)Lt.setPaintProperty(o,pi,Xe[pi])}function Tr(Xe){Lt.getLayer(o)&&Lt.setLayoutProperty(o,"visibility",Xe?"visible":"none")}return pe&&Lt.on("click",o,Xe=>{if(Xe.features.length>0&&!ae){let pi=Xe.features[0];if(c(2,Ge=pi.id),x("select",{id:Ge,feature:pi,event:Xe}),Mi&&Lt.setFeatureState({source:ii,sourceLayer:si,id:Mi},{selected:!1}),Lt.setFeatureState({source:ii,sourceLayer:si,id:Ge},{selected:!0}),Se){let Ni=centroid(Xe.features[0].toJSON().geometry);Lt.flyTo({center:Ni.geometry.coordinates})}c(26,Mi=Ge)}}),ze&&(Lt.on("mousemove",o,Xe=>{if(Xe.features.length>0){Oe&&Lt.setFeatureState({source:ii,sourceLayer:si,id:Oe},{hovered:!1});let pi=Xe.features[0];c(0,Oe=c(27,Ai=pi.id)),Ri.set({id:Oe,feature:pi,event:Xe}),x("hover",l),Lt.setFeatureState({source:ii,sourceLayer:si,id:Oe},{hovered:!0}),Lt.getCanvas().style.cursor="pointer"}}),Lt.on("mouseleave",o,Xe=>{Oe&&Lt.setFeatureState({source:ii,sourceLayer:si,id:Oe},{hovered:!1}),c(0,Oe=c(27,Ai=null)),Ri.set({id:null,feature:null,event:Xe}),x("hover",l),Lt.getCanvas().style.cursor=""})),cc(async()=>{Lt&&Lt.getLayer(o)&&Lt.removeLayer(o)}),d.$$set=Xe=>{"id"in Xe&&c(6,o=Xe.id),"type"in Xe&&c(7,b=Xe.type),"filter"in Xe&&c(8,E=Xe.filter),"layout"in Xe&&c(4,I=Xe.layout),"paint"in Xe&&c(9,P=Xe.paint),"data"in Xe&&c(10,A=Xe.data),"colorKey"in Xe&&c(11,V=Xe.colorKey),"nameKey"in Xe&&c(12,U=Xe.nameKey),"valueKey"in Xe&&c(13,F=Xe.valueKey),"idKey"in Xe&&c(5,Q=Xe.idKey),"select"in Xe&&c(14,pe=Xe.select),"clickIgnore"in Xe&&c(15,ae=Xe.clickIgnore),"clickCenter"in Xe&&c(16,Se=Xe.clickCenter),"selected"in Xe&&c(2,Ge=Xe.selected),"hover"in Xe&&c(17,ze=Xe.hover),"hovered"in Xe&&c(0,Oe=Xe.hovered),"highlight"in Xe&&c(18,Me=Xe.highlight),"highlightKey"in Xe&&c(19,Ue=Xe.highlightKey),"highlighted"in Xe&&c(20,zt=Xe.highlighted),"order"in Xe&&c(21,dt=Xe.order),"maxzoom"in Xe&&c(22,yi=Xe.maxzoom),"minzoom"in Xe&&c(23,_t=Xe.minzoom),"sourceLayer"in Xe&&c(3,si=Xe.sourceLayer),"visible"in Xe&&c(24,nr=Xe.visible),"$$scope"in Xe&&c(29,_=Xe.$$scope)},d.$$.update=()=>{if(d.$$.dirty[0]&3072&&A&&Ki(A,V),d.$$.dirty[0]&256&&gr(E),d.$$.dirty[0]&512&&_r(P),d.$$.dirty[0]&16777216&&Tr(nr),d.$$.dirty[0]&270270472&&Me&&zt!=ur){if(ur[0])for(const Xe of ur){let pi={};pi[Ue]=!1,Lt.setFeatureState({source:ii,sourceLayer:si,id:Xe},pi)}if(c(28,ur=zt),zt[0])for(const Xe of zt){let pi={};pi[Ue]=!0,Lt.setFeatureState({source:ii,sourceLayer:si,id:Xe},pi)}}d.$$.dirty[0]&67125260&&pe&&Ge!=Mi&&(Mi&&Lt.setFeatureState({source:ii,sourceLayer:si,id:Mi},{selected:!1}),Ge&&Lt.setFeatureState({source:ii,sourceLayer:si,id:Ge},{selected:!0}),c(26,Mi=Ge)),d.$$.dirty[0]&134348809&&ze&&Oe!=Ai&&(Ai&&Lt.setFeatureState({source:ii,sourceLayer:si,id:Ai},{hovered:!1}),Oe&&Lt.setFeatureState({source:ii,sourceLayer:si,id:Oe},{hovered:!0}),c(27,Ai=Oe))},[Oe,Ri,Ge,si,I,Q,o,b,E,P,A,V,U,F,pe,ae,Se,ze,Me,Ue,zt,dt,yi,_t,nr,Ki,Mi,Ai,ur,_,h]}class xu extends fi{constructor(n){super(),di(this,n,d1,f1,ti,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function p1(d,n,c){let l,{content:h}=n;const _=new Vo.Popup({closeButton:!1,closeOnClick:!1}),{getMap:x}=oo("map"),o=x(),b=oo("hover");ac(d,b,I=>c(2,l=I));function E(I,P){I.id?_.setLngLat(I.event.lngLat).setHTML(P||I.code).addTo(o):_.remove()}return cc(()=>_.remove()),d.$$set=I=>{"content"in I&&c(1,h=I.content)},d.$$.update=()=>{d.$$.dirty&6&&E(l,h)},[b,h,l]}class m1 extends fi{constructor(n){super(),di(this,n,p1,null,ti,{content:1})}}function yd(d,n,c){const l=d.slice();return l[9]=n[c],l[11]=c,l}function vd(d){let n,c,l,h,_,x=d[4](d[2][d[11]])+"",o;return{c(){n=xe("div"),c=qe(),l=xe("div"),h=qe(),_=xe("div"),o=nt(x),this.h()},l(b){n=be(b,"DIV",{class:!0,style:!0}),we(n).forEach(X),c=Ze(b),l=be(b,"DIV",{class:!0,style:!0}),we(l).forEach(X),h=Ze(b),_=be(b,"DIV",{class:!0,style:!0});var E=we(_);o=st(E,x),E.forEach(X),this.h()},h(){ee(n,"class","block svelte-xjas6d"),He(n,"width",100/(d[2].length-1)+"%"),He(n,"left",d[11]*(100/(d[2].length-1))+"%"),He(n,"background-color",d[3][d[11]]),ee(l,"class","line svelte-xjas6d"),He(l,"left",d[11]*(100/(d[2].length-1))+"%"),ee(_,"class","tick svelte-xjas6d"),He(_,"left",d[11]*(100/(d[2].length-1))+"%"),gt(_,"tick-start",d[11]==0)},m(b,E){ge(b,n,E),ge(b,c,E),ge(b,l,E),ge(b,h,E),ge(b,_,E),ue(_,o)},p(b,E){E&4&&He(n,"width",100/(b[2].length-1)+"%"),E&4&&He(n,"left",b[11]*(100/(b[2].length-1))+"%"),E&8&&He(n,"background-color",b[3][b[11]]),E&4&&He(l,"left",b[11]*(100/(b[2].length-1))+"%"),E&20&&x!==(x=b[4](b[2][b[11]])+"")&&Gt(o,x),E&4&&He(_,"left",b[11]*(100/(b[2].length-1))+"%")},d(b){b&&X(n),b&&X(c),b&&X(l),b&&X(h),b&&X(_)}}}function xd(d){let n,c=`${d[7](d[0],d[2])}%`,l,h,_=d[5](d[0])+"",x,o;return{c(){n=xe("div"),l=qe(),h=xe("div"),x=nt(_),o=nt(d[6]),this.h()},l(b){n=be(b,"DIV",{class:!0}),we(n).forEach(X),l=Ze(b),h=be(b,"DIV",{class:!0,style:!0});var E=we(h);x=st(E,_),o=st(E,d[6]),E.forEach(X),this.h()},h(){ee(n,"class","marker  svelte-xjas6d"),He(n,"left",c),ee(h,"class","value svelte-xjas6d"),He(h,"left",d[7](d[0],d[2])+"%")},m(b,E){ge(b,n,E),ge(b,l,E),ge(b,h,E),ue(h,x),ue(h,o)},p(b,E){E&5&&c!==(c=`${b[7](b[0],b[2])}%`)&&He(n,"left",c),E&33&&_!==(_=b[5](b[0])+"")&&Gt(x,_),E&64&&Gt(o,b[6]),E&5&&He(h,"left",b[7](b[0],b[2])+"%")},d(b){b&&X(n),b&&X(l),b&&X(h)}}}function g1(d){let n,c,l,h,_,x=d[4](d[2][d[2].length-1])+"",o,b,E,I=d[2].slice(1),P=[];for(let V=0;V<I.length;V+=1)P[V]=vd(yd(d,I,V));let A=typeof d[0]=="number"&&xd(d);return{c(){n=xe("div");for(let V=0;V<P.length;V+=1)P[V].c();c=qe(),l=xe("div"),h=qe(),_=xe("div"),o=nt(x),b=nt(d[6]),E=qe(),A&&A.c(),this.h()},l(V){n=be(V,"DIV",{class:!0,style:!0});var U=we(n);for(let Q=0;Q<P.length;Q+=1)P[Q].l(U);c=Ze(U),l=be(U,"DIV",{class:!0,style:!0}),we(l).forEach(X),h=Ze(U),_=be(U,"DIV",{class:!0,style:!0});var F=we(_);o=st(F,x),b=st(F,d[6]),F.forEach(X),E=Ze(U),A&&A.l(U),U.forEach(X),this.h()},h(){ee(l,"class","line svelte-xjas6d"),He(l,"left","100%"),ee(_,"class","tick tick-end svelte-xjas6d"),He(_,"left","100%"),ee(n,"class","container svelte-xjas6d"),He(n,"height",d[1]+"px")},m(V,U){ge(V,n,U);for(let F=0;F<P.length;F+=1)P[F]&&P[F].m(n,null);ue(n,c),ue(n,l),ue(n,h),ue(n,_),ue(_,o),ue(_,b),ue(n,E),A&&A.m(n,null)},p(V,[U]){if(U&28){I=V[2].slice(1);let F;for(F=0;F<I.length;F+=1){const Q=yd(V,I,F);P[F]?P[F].p(Q,U):(P[F]=vd(Q),P[F].c(),P[F].m(n,c))}for(;F<P.length;F+=1)P[F].d(1);P.length=I.length}U&20&&x!==(x=V[4](V[2][V[2].length-1])+"")&&Gt(o,x),U&64&&Gt(b,V[6]),typeof V[0]=="number"?A?A.p(V,U):(A=xd(V),A.c(),A.m(n,null)):A&&(A.d(1),A=null),U&2&&He(n,"height",V[1]+"px")},i:Bt,o:Bt,d(V){V&&X(n),rr(P,V),A&&A.d()}}}function _1(d,n,c){let{hovered:l=null}=n,{lineWidth:h=3}=n,{height:_=15}=n,{breaks:x=[0,20,40,60,80,100]}=n,{colors:o=["rgba(234,236,177,.8)","rgba(169,216,145,.8)","rgba(0,167,186,.8)","rgba(0,78,166,.8)","rgba(0,13,84,.8)"]}=n,{formatTick:b=A=>A.toFixed(1)}=n,{formatVal:E=A=>A.toFixed(1)}=n,{suffix:I="%"}=n;const P=(A,V)=>{let U=0;for(;A>V[U+1];)U+=1;let F=100/(V.length-1),Q=(A-V[U])/(V[U+1]-V[U]);return(U+Q)*F};return d.$$set=A=>{"hovered"in A&&c(0,l=A.hovered),"lineWidth"in A&&c(8,h=A.lineWidth),"height"in A&&c(1,_=A.height),"breaks"in A&&c(2,x=A.breaks),"colors"in A&&c(3,o=A.colors),"formatTick"in A&&c(4,b=A.formatTick),"formatVal"in A&&c(5,E=A.formatVal),"suffix"in A&&c(6,I=A.suffix)},[l,_,x,o,b,E,I,P,h]}class y1 extends fi{constructor(n){super(),di(this,n,_1,g1,ti,{hovered:0,lineWidth:8,height:1,breaks:2,colors:3,formatTick:4,formatVal:5,suffix:6})}}function bd(d,n,c){const l=d.slice();return l[2]=n[c],l[4]=c,l}function wd(d){let n,c,l,h=d[2].name+"",_,x,o,b=d[2].value.toFixed(1)+"",E,I,P;return{c(){n=xe("tr"),c=xe("td"),l=xe("strong"),_=nt(h),x=qe(),o=xe("td"),E=nt(b),I=nt("%"),P=qe(),this.h()},l(A){n=be(A,"TR",{});var V=we(n);c=be(V,"TD",{class:!0});var U=we(c);l=be(U,"STRONG",{});var F=we(l);_=st(F,h),F.forEach(X),U.forEach(X),x=Ze(V),o=be(V,"TD",{class:!0});var Q=we(o);E=st(Q,b),I=st(Q,"%"),Q.forEach(X),P=Ze(V),V.forEach(X),this.h()},h(){ee(c,"class","svelte-1i52e02"),ee(o,"class","text-right svelte-1i52e02")},m(A,V){ge(A,n,V),ue(n,c),ue(c,l),ue(l,_),ue(n,x),ue(n,o),ue(o,E),ue(o,I),ue(n,P)},p(A,V){V&1&&h!==(h=A[2].name+"")&&Gt(_,h),V&1&&b!==(b=A[2].value.toFixed(1)+"")&&Gt(E,b)},d(A){A&&X(n)}}}function v1(d){let n,c,l=d[0],h=[];for(let _=0;_<l.length;_+=1)h[_]=wd(bd(d,l,_));return{c(){n=xe("table"),c=xe("tbody");for(let _=0;_<h.length;_+=1)h[_].c();this.h()},l(_){n=be(_,"TABLE",{class:!0});var x=we(n);c=be(x,"TBODY",{});var o=we(c);for(let b=0;b<h.length;b+=1)h[b].l(o);o.forEach(X),x.forEach(X),this.h()},h(){ee(n,"class","table-rank text-small svelte-1i52e02")},m(_,x){ge(_,n,x),ue(n,c);for(let o=0;o<h.length;o+=1)h[o]&&h[o].m(c,null)},p(_,[x]){if(x&1){l=_[0];let o;for(o=0;o<l.length;o+=1){const b=bd(_,l,o);h[o]?h[o].p(b,x):(h[o]=wd(b),h[o].c(),h[o].m(c,null))}for(;o<h.length;o+=1)h[o].d(1);h.length=l.length}},i:Bt,o:Bt,d(_){_&&X(n),rr(h,_)}}}function x1(d,n,c){let{data:l}=n,{offset:h=1}=n;return d.$$set=_=>{"data"in _&&c(0,l=_.data),"offset"in _&&c(1,h=_.offset)},[l,h]}class Mp extends fi{constructor(n){super(),di(this,n,x1,v1,ti,{data:0,offset:1})}}function b1(d){let n,c;return{c(){n=xe("p"),c=nt("People with the selected characteristics as a proportion of whole population."),this.h()},l(l){n=be(l,"P",{class:!0});var h=we(n);c=st(h,"People with the selected characteristics as a proportion of whole population."),h.forEach(X),this.h()},h(){ee(n,"class","subtitle svelte-12ieinf")},m(l,h){ge(l,n,h),ue(n,c)},p:Bt,d(l){l&&X(n)}}}function Td(d){let n,c;return n=new u1({props:{id:"lad",type:"geojson",data:d[0].geojson,promoteId:d[2].code,$$slots:{default:[T1]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=l[0].geojson),h&4&&(_.promoteId=l[2].code),h&1089&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function w1(d){let n,c;return n=new m1({props:{content:d[6]?d[0].geoCodesLookup[d[6]].name:""}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&65&&(_.content=l[6]?l[0].geoCodesLookup[l[6]].name:""),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function T1(d){let n,c,l,h,_,x,o;function b(I){d[7](I)}let E={id:"lad-fill",data:d[0].geoPerc,idKey:"code",nameKey:"name",valueKey:"value",hover:!0,tooltip:!0,type:"fill",paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"],"fill-opacity":.8},order:"place_other",$$slots:{default:[w1]},$$scope:{ctx:d}};return d[6]!==void 0&&(E.hovered=d[6]),n=new xu({props:E}),lc.push(()=>Iu(n,"hovered",b)),h=new xu({props:{id:"lad-line",type:"line",paint:{"line-color":"white","line-width":.3},order:"place_other"}}),x=new xu({props:{id:"lad-hover",type:"line",paint:{"line-color":"black","line-width":2,"line-opacity":["case",["==",["feature-state","hovered"],!0],1,0]},order:"place_other"}}),{c(){kt(n.$$.fragment),l=qe(),kt(h.$$.fragment),_=qe(),kt(x.$$.fragment)},l(I){Ct(n.$$.fragment,I),l=Ze(I),Ct(h.$$.fragment,I),_=Ze(I),Ct(x.$$.fragment,I)},m(I,P){Et(n,I,P),ge(I,l,P),Et(h,I,P),ge(I,_,P),Et(x,I,P),o=!0},p(I,P){const A={};P&1&&(A.data=I[0].geoPerc),P&1089&&(A.$$scope={dirty:P,ctx:I}),!c&&P&64&&(c=!0,A.hovered=I[6],Cu(()=>c=!1)),n.$set(A)},i(I){o||(Ee(n.$$.fragment,I),Ee(h.$$.fragment,I),Ee(x.$$.fragment,I),o=!0)},o(I){Be(n.$$.fragment,I),Be(h.$$.fragment,I),Be(x.$$.fragment,I),o=!1},d(I){St(n,I),I&&X(l),St(h,I),I&&X(_),St(x,I)}}}function k1(d){let n,c,l=d[0].geojson&&d[0].geoPerc&&Td(d);return{c(){l&&l.c(),n=xt()},l(h){l&&l.l(h),n=xt()},m(h,_){l&&l.m(h,_),ge(h,n,_),c=!0},p(h,_){h[0].geojson&&h[0].geoPerc?l?(l.p(h,_),_&1&&Ee(l,1)):(l=Td(h),l.c(),Ee(l,1),l.m(n.parentNode,n)):l&&(ui(),Be(l,1,1,()=>{l=null}),hi())},i(h){c||(Ee(l),c=!0)},o(h){Be(l),c=!1},d(h){l&&l.d(h),h&&X(n)}}}function kd(d){let n,c,l;return c=new y1({props:{breaks:d[0].geoBreaks,hovered:d[6]&&d[0].geoPerc.find(d[8])?d[0].geoPerc.find(d[9]).value:null,colors:d[0].geoBreaks[1]==100?[d[5].seq[4]]:d[5].seq}}),{c(){n=xe("div"),kt(c.$$.fragment),this.h()},l(h){n=be(h,"DIV",{});var _=we(n);Ct(c.$$.fragment,_),_.forEach(X),this.h()},h(){He(n,"height","38px"),He(n,"width","100%")},m(h,_){ge(h,n,_),Et(c,n,null),l=!0},p(h,_){const x={};_&1&&(x.breaks=h[0].geoBreaks),_&65&&(x.hovered=h[6]&&h[0].geoPerc.find(h[8])?h[0].geoPerc.find(h[9]).value:null),_&33&&(x.colors=h[0].geoBreaks[1]==100?[h[5].seq[4]]:h[5].seq),c.$set(x)},i(h){l||(Ee(c.$$.fragment,h),l=!0)},o(h){Be(c.$$.fragment,h),l=!1},d(h){h&&X(n),St(c)}}}function E1(d){let n,c,l,h,_;c=new o1({props:{style:d[1],location:{bounds:d[3]},$$slots:{default:[k1]},$$scope:{ctx:d}}});let x=d[0].geoBreaks&&d[0].geoPerc&&kd(d);return{c(){n=xe("div"),kt(c.$$.fragment),l=qe(),x&&x.c(),h=xt(),this.h()},l(o){n=be(o,"DIV",{});var b=we(n);Ct(c.$$.fragment,b),b.forEach(X),l=Ze(o),x&&x.l(o),h=xt(),this.h()},h(){He(n,"height","450px")},m(o,b){ge(o,n,b),Et(c,n,null),ge(o,l,b),x&&x.m(o,b),ge(o,h,b),_=!0},p(o,b){const E={};b&2&&(E.style=o[1]),b&8&&(E.location={bounds:o[3]}),b&1093&&(E.$$scope={dirty:b,ctx:o}),c.$set(E),o[0].geoBreaks&&o[0].geoPerc?x?(x.p(o,b),b&1&&Ee(x,1)):(x=kd(o),x.c(),Ee(x,1),x.m(h.parentNode,h)):x&&(ui(),Be(x,1,1,()=>{x=null}),hi())},i(o){_||(Ee(c.$$.fragment,o),Ee(x),_=!0)},o(o){Be(c.$$.fragment,o),Be(x),_=!1},d(o){o&&X(n),St(c),o&&X(l),x&&x.d(o),o&&X(h)}}}function S1(d){let n,c;return{c(){n=xe("span"),c=nt("Make a selection to see rankings."),this.h()},l(l){n=be(l,"SPAN",{class:!0});var h=we(n);c=st(h,"Make a selection to see rankings."),h.forEach(X),this.h()},h(){ee(n,"class","muted svelte-12ieinf")},m(l,h){ge(l,n,h),ue(n,c)},p:Bt,i:Bt,o:Bt,d(l){l&&X(n)}}}function I1(d){let n,c;return n=new Mp({props:{data:[...d[0].geoPerc].filter(Ed).sort(Sd).slice(0,5)}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=[...l[0].geoPerc].filter(Ed).sort(Sd).slice(0,5)),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function C1(d){let n,c,l,h;const _=[I1,S1],x=[];function o(b,E){return b[0].geoPerc&&b[4][0]?0:1}return n=o(d),c=x[n]=_[n](d),{c(){c.c(),l=xt()},l(b){c.l(b),l=xt()},m(b,E){x[n].m(b,E),ge(b,l,E),h=!0},p(b,E){let I=n;n=o(b),n===I?x[n].p(b,E):(ui(),Be(x[I],1,1,()=>{x[I]=null}),hi(),c=x[n],c?c.p(b,E):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Be(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function A1(d){let n,c;return{c(){n=xe("span"),c=nt("Make a selection to see rankings."),this.h()},l(l){n=be(l,"SPAN",{class:!0});var h=we(n);c=st(h,"Make a selection to see rankings."),h.forEach(X),this.h()},h(){ee(n,"class","muted svelte-12ieinf")},m(l,h){ge(l,n,h),ue(n,c)},p:Bt,i:Bt,o:Bt,d(l){l&&X(n)}}}function z1(d){let n,c;return n=new Mp({props:{data:d[0].geoPerc.filter(Id).sort(Cd).slice(-5),offset:d[0].geoPerc.filter(Ad).length-4}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=l[0].geoPerc.filter(Id).sort(Cd).slice(-5)),h&1&&(_.offset=l[0].geoPerc.filter(Ad).length-4),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function M1(d){let n,c,l,h;const _=[z1,A1],x=[];function o(b,E){return b[0].geoPerc&&b[4][0]?0:1}return n=o(d),c=x[n]=_[n](d),{c(){c.c(),l=xt()},l(b){c.l(b),l=xt()},m(b,E){x[n].m(b,E),ge(b,l,E),h=!0},p(b,E){let I=n;n=o(b),n===I?x[n].p(b,E):(ui(),Be(x[I],1,1,()=>{x[I]=null}),hi(),c=x[n],c?c.p(b,E):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Be(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function P1(d){let n,c,l,h,_,x,o,b;return n=new es({props:{colspan:3,rowspan:1,noBackground:!0,$$slots:{default:[b1]},$$scope:{ctx:d}}}),l=new es({props:{colspan:2,rowspan:2,noBackground:!0,$$slots:{default:[E1]},$$scope:{ctx:d}}}),_=new es({props:{title:"Areas with high %",$$slots:{default:[C1]},$$scope:{ctx:d}}}),o=new es({props:{title:"Areas with low %",$$slots:{default:[M1]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment),c=qe(),kt(l.$$.fragment),h=qe(),kt(_.$$.fragment),x=qe(),kt(o.$$.fragment)},l(E){Ct(n.$$.fragment,E),c=Ze(E),Ct(l.$$.fragment,E),h=Ze(E),Ct(_.$$.fragment,E),x=Ze(E),Ct(o.$$.fragment,E)},m(E,I){Et(n,E,I),ge(E,c,I),Et(l,E,I),ge(E,h,I),Et(_,E,I),ge(E,x,I),Et(o,E,I),b=!0},p(E,I){const P={};I&1024&&(P.$$scope={dirty:I,ctx:E}),n.$set(P);const A={};I&1135&&(A.$$scope={dirty:I,ctx:E}),l.$set(A);const V={};I&1041&&(V.$$scope={dirty:I,ctx:E}),_.$set(V);const U={};I&1041&&(U.$$scope={dirty:I,ctx:E}),o.$set(U)},i(E){b||(Ee(n.$$.fragment,E),Ee(l.$$.fragment,E),Ee(_.$$.fragment,E),Ee(o.$$.fragment,E),b=!0)},o(E){Be(n.$$.fragment,E),Be(l.$$.fragment,E),Be(_.$$.fragment,E),Be(o.$$.fragment,E),b=!1},d(E){St(n,E),E&&X(c),St(l,E),E&&X(h),St(_,E),E&&X(x),St(o,E)}}}function D1(d){let n,c;return n=new zu({props:{title:"Population by area",height:"auto",$$slots:{default:[P1]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,[h]){const _={};h&1151&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}const Ed=d=>d.value!=null,Sd=(d,n)=>n.value-d.value,Id=d=>d.value!=null,Cd=(d,n)=>n.value-d.value,Ad=d=>d.value!=null;function L1(d,n,c){let{data:l}=n,{mapStyle:h}=n,{ladBounds:_}=n,{mapBounds:x}=n,{selected:o}=n,{colors:b}=n,E;function I(V){E=V,c(6,E)}const P=V=>V.code==E,A=V=>V.code==E;return d.$$set=V=>{"data"in V&&c(0,l=V.data),"mapStyle"in V&&c(1,h=V.mapStyle),"ladBounds"in V&&c(2,_=V.ladBounds),"mapBounds"in V&&c(3,x=V.mapBounds),"selected"in V&&c(4,o=V.selected),"colors"in V&&c(5,b=V.colors)},[l,h,_,x,o,b,E,I,P,A]}class B1 extends fi{constructor(n){super(),di(this,n,L1,D1,ti,{data:0,mapStyle:1,ladBounds:2,mapBounds:3,selected:4,colors:5})}}function zd(d){let n,c;return n=new es({props:{title:d[0],$$slots:{default:[V1]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.title=l[0]),h&30&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function R1(d){let n,c,l;var h=d[3];function _(x){return{props:{data:x[2].selected&&nc("residents",x[1].code,x[2]),showLegend:!1}}}return h&&(n=nf(h,_(d))),{c(){n&&kt(n.$$.fragment),c=xt()},l(x){n&&Ct(n.$$.fragment,x),c=xt()},m(x,o){n&&Et(n,x,o),ge(x,c,o),l=!0},p(x,o){const b={};if(o&6&&(b.data=x[2].selected&&nc("residents",x[1].code,x[2])),o&8&&h!==(h=x[3])){if(n){ui();const E=n;Be(E.$$.fragment,1,0,()=>{St(E,1)}),hi()}h?(n=nf(h,_(x)),kt(n.$$.fragment),Ee(n.$$.fragment,1),Et(n,c.parentNode,c)):n=null}else h&&n.$set(b)},i(x){l||(n&&Ee(n.$$.fragment,x),l=!0)},o(x){n&&Be(n.$$.fragment,x),l=!1},d(x){x&&X(c),n&&St(n,x)}}}function F1(d){let n,c=Za.nodata+"",l;return{c(){n=xe("span"),l=nt(c),this.h()},l(h){n=be(h,"SPAN",{class:!0});var _=we(n);l=st(_,c),_.forEach(X),this.h()},h(){ee(n,"class","num-desc svelte-1yn8adz")},m(h,_){ge(h,n,_),ue(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function O1(d){let n,c=Za.blocked+"",l;return{c(){n=xe("span"),l=nt(c),this.h()},l(h){n=be(h,"SPAN",{class:!0});var _=we(n);l=st(_,c),_.forEach(X),this.h()},h(){ee(n,"class","num-desc svelte-1yn8adz")},m(h,_){ge(h,n,_),ue(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function V1(d){let n,c,l,h,_,x=rf[d[1].code]+"",o,b;const E=[O1,F1,R1],I=[];function P(A,V){return A[2].selected.residents[A[1].code].values==="blocked"?0:A[2].selected.residents[A[1].code].values.percent[0]==null?1:2}return n=P(d),c=I[n]=E[n](d),{c(){c.c(),l=qe(),h=xe("span"),_=nt("% of "),o=nt(x),this.h()},l(A){c.l(A),l=Ze(A),h=be(A,"SPAN",{class:!0});var V=we(h);_=st(V,"% of "),o=st(V,x),V.forEach(X),this.h()},h(){ee(h,"class","num-desc svelte-1yn8adz")},m(A,V){I[n].m(A,V),ge(A,l,V),ge(A,h,V),ue(h,_),ue(h,o),b=!0},p(A,V){let U=n;n=P(A),n===U?I[n].p(A,V):(ui(),Be(I[U],1,1,()=>{I[U]=null}),hi(),c=I[n],c?c.p(A,V):(c=I[n]=E[n](A),c.c()),Ee(c,1),c.m(l.parentNode,l)),(!b||V&2)&&x!==(x=rf[A[1].code]+"")&&Gt(o,x)},i(A){b||(Ee(c),b=!0)},o(A){Be(c),b=!1},d(A){I[n].d(A),A&&X(l),A&&X(h)}}}function U1(d){var h,_;let n,c,l=((_=(h=d[2].selected.residents)==null?void 0:h[d[1].code])==null?void 0:_.values)&&zd(d);return{c(){l&&l.c(),n=xt()},l(x){l&&l.l(x),n=xt()},m(x,o){l&&l.m(x,o),ge(x,n,o),c=!0},p(x,[o]){var b,E;(E=(b=x[2].selected.residents)==null?void 0:b[x[1].code])!=null&&E.values?l?(l.p(x,o),o&6&&Ee(l,1)):(l=zd(x),l.c(),Ee(l,1),l.m(n.parentNode,n)):l&&(ui(),Be(l,1,1,()=>{l=null}),hi())},i(x){c||(Ee(l),c=!0)},o(x){Be(l),c=!1},d(x){l&&l.d(x),x&&X(n)}}}function N1(d,n,c){let{title:l}=n,{table:h}=n,{data:_}=n,{chart_type:x}=n;return d.$$set=o=>{"title"in o&&c(0,l=o.title),"table"in o&&c(1,h=o.table),"data"in o&&c(2,_=o.data),"chart_type"in o&&c(3,x=o.chart_type)},[l,h,_,x]}class Pp extends fi{constructor(n){super(),di(this,n,N1,U1,ti,{title:0,table:1,data:2,chart_type:3})}}function j1(d){let n,c;const l=d[5].default,h=$i(l,d,d[4],null);return{c(){n=xe("mark"),h&&h.c(),this.h()},l(_){n=be(_,"MARK",{class:!0,style:!0,role:!0});var x=we(n);h&&h.l(x),x.forEach(X),this.h()},h(){ee(n,"class","em svelte-1602h77"),He(n,"background-color",d[0]),He(n,"color",d[2]),ee(n,"role","presentation"),gt(n,"nowrap",d[1])},m(_,x){ge(_,n,x),h&&h.m(n,null),c=!0},p(_,[x]){h&&h.p&&(!c||x&16)&&er(h,l,_,_[4],c?ir(l,_[4],x,null):tr(_[4]),null),(!c||x&1)&&He(n,"background-color",_[0]),(!c||x&4)&&He(n,"color",_[2]),(!c||x&2)&&gt(n,"nowrap",_[1])},i(_){c||(Ee(h,_),c=!0)},o(_){Be(h,_),c=!1},d(_){_&&X(n),h&&h.d(_)}}}function G1(d,n,c){let l,{$$slots:h={},$$scope:_}=n,{color:x="lightgrey"}=n,{nowrap:o=!0}=n;function b(I){return(I[0]*299+I[1]*587+I[2]*114)/1e3>125?"black":"white"}let E="black";return d.$$set=I=>{"color"in I&&c(0,x=I.color),"nowrap"in I&&c(1,o=I.nowrap),"$$scope"in I&&c(4,_=I.$$scope)},d.$$.update=()=>{d.$$.dirty&1&&c(3,l=z_(x).rgb),d.$$.dirty&8&&l&&c(2,E=b(l))},[x,o,E,l,_,h]}class q1 extends fi{constructor(n){super(),di(this,n,G1,j1,ti,{color:0,nowrap:1})}}function Z1(d){let n,c=d[0].selected.total_pop.count.toLocaleString()+"",l,h,_,x,o,b,E,I,P;return E=new q1({props:{color:"lightgrey",$$slots:{default:[H1]},$$scope:{ctx:d}}}),{c(){n=xe("div"),l=nt(c),h=qe(),_=xe("div"),x=nt("people"),o=qe(),b=xe("div"),kt(E.$$.fragment),I=nt(" of the total population of England and Wales"),this.h()},l(A){n=be(A,"DIV",{class:!0});var V=we(n);l=st(V,c),V.forEach(X),h=Ze(A),_=be(A,"DIV",{class:!0});var U=we(_);x=st(U,"people"),U.forEach(X),o=Ze(A),b=be(A,"DIV",{class:!0});var F=we(b);Ct(E.$$.fragment,F),I=st(F," of the total population of England and Wales"),F.forEach(X),this.h()},h(){ee(n,"class","num-big svelte-c46qp4"),ee(_,"class","num-suffix svelte-c46qp4"),ee(b,"class","num-desc svelte-c46qp4")},m(A,V){ge(A,n,V),ue(n,l),ge(A,h,V),ge(A,_,V),ue(_,x),ge(A,o,V),ge(A,b,V),Et(E,b,null),ue(b,I),P=!0},p(A,V){(!P||V&1)&&c!==(c=A[0].selected.total_pop.count.toLocaleString()+"")&&Gt(l,c);const U={};V&3&&(U.$$scope={dirty:V,ctx:A}),E.$set(U)},i(A){P||(Ee(E.$$.fragment,A),P=!0)},o(A){Be(E.$$.fragment,A),P=!1},d(A){A&&X(n),A&&X(h),A&&X(_),A&&X(o),A&&X(b),St(E)}}}function X1(d){let n,c=Za.nodata+"",l;return{c(){n=xe("div"),l=nt(c),this.h()},l(h){n=be(h,"DIV",{class:!0});var _=we(n);l=st(_,c),_.forEach(X),this.h()},h(){ee(n,"class","num-desc svelte-c46qp4")},m(h,_){ge(h,n,_),ue(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function H1(d){let n=Rf(d[0].selected.total_pop.percent)+"",c,l;return{c(){c=nt(n),l=nt("%")},l(h){c=st(h,n),l=st(h,"%")},m(h,_){ge(h,c,_),ge(h,l,_)},p(h,_){_&1&&n!==(n=Rf(h[0].selected.total_pop.percent)+"")&&Gt(c,n)},d(h){h&&X(c),h&&X(l)}}}function W1(d){let n,c,l,h;const _=[X1,Z1],x=[];function o(b,E){return b[0].selected.total_pop.count==null?0:1}return n=o(d),c=x[n]=_[n](d),{c(){c.c(),l=xt()},l(b){c.l(b),l=xt()},m(b,E){x[n].m(b,E),ge(b,l,E),h=!0},p(b,E){let I=n;n=o(b),n===I?x[n].p(b,E):(ui(),Be(x[I],1,1,()=>{x[I]=null}),hi(),c=x[n],c?c.p(b,E):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Be(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function K1(d){let n,c;return n=new es({props:{title:"Population",$$slots:{default:[W1]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,[h]){const _={};h&3&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function J1(d,n,c){let{data:l}=n;return d.$$set=h=>{"data"in h&&c(0,l=h.data)},[l]}class Y1 extends fi{constructor(n){super(),di(this,n,J1,K1,ti,{data:0})}}function Q1(d){let n,c,l,h,_=`translateX(${d[3]/d[1]+(d[1]-d[4])}px)`,x,o=`${d[2]}px`,b=`${d[4]}px`;return{c(){n=xe("div"),c=nt(d[0]),l=qe(),h=xe("div"),this.h()},l(E){n=be(E,"DIV",{class:!0});var I=we(n);c=st(I,d[0]),l=Ze(I),h=be(I,"DIV",{class:!0}),we(h).forEach(X),I.forEach(X),this.h()},h(){ee(h,"class","caret svelte-1491tb3"),He(h,"transform",_),ee(n,"class","tooltip svelte-1491tb3"),np(()=>d[6].call(n)),He(n,"top",o),He(n,"left",b)},m(E,I){ge(E,n,I),ue(n,c),ue(n,l),ue(n,h),x=sp(n,d[6].bind(n))},p(E,[I]){I&1&&Gt(c,E[0]),I&26&&_!==(_=`translateX(${E[3]/E[1]+(E[1]-E[4])}px)`)&&He(h,"transform",_),I&4&&o!==(o=`${E[2]}px`)&&He(n,"top",o),I&16&&b!==(b=`${E[4]}px`)&&He(n,"left",b)},i:Bt,o:Bt,d(E){E&&X(n),x()}}}const ec=4;function $1(d,n,c){let l,{title:h}=n,{x:_}=n,{y:x}=n,{width:o}=n,b;function E(){b=this.clientWidth,c(3,b)}return d.$$set=I=>{"title"in I&&c(0,h=I.title),"x"in I&&c(1,_=I.x),"y"in I&&c(2,x=I.y),"width"in I&&c(5,o=I.width)},d.$$.update=()=>{d.$$.dirty&42&&c(4,l=b&&_+b/2>o-ec?o-b/2-ec:b&&_-b/2<0+ec?b/2+ec:_)},[h,_,x,b,l,o,E]}class e0 extends fi{constructor(n){super(),di(this,n,$1,Q1,ti,{title:0,x:1,y:2,width:5})}}function t0(d){let n,c;function l(_){n=d.getAttribute("title"),d.removeAttribute("title");let x=document.body.getBoundingClientRect(),o=d.getBoundingClientRect(),b=o.bottom,E=(o.left+o.right)/2;c=new e0({props:{title:n,x:E,y:b-x.y,width:x.width},target:document.body})}function h(){c.$destroy(),d.setAttribute("title",n)}return d.addEventListener("mouseover",l),d.addEventListener("mouseout",h),{destroy(){c&&c.$destroy(),d.removeEventListener("mouseover",l),d.removeEventListener("mouseout",h)}}}function Md(d,n,c){const l=d.slice();return l[20]=n[c],l[22]=c,l}function Pd(d,n,c){const l=d.slice();return l[23]=n[c],l[25]=c,l}function Dd(d,n,c){const l=d.slice();return l[23]=n[c],l[25]=c,l}function Ld(d,n,c){const l=d.slice();return l[27]=n[c],l[22]=c,l}function Bd(d){let n,c=d[12],l=[];for(let h=0;h<c.length;h+=1)l[h]=Rd(Ld(d,c,h));return{c(){n=xe("ul");for(let h=0;h<l.length;h+=1)l[h].c();this.h()},l(h){n=be(h,"UL",{class:!0});var _=we(n);for(let x=0;x<l.length;x+=1)l[x].l(_);_.forEach(X),this.h()},h(){ee(n,"class","legend-block svelte-h6j55z")},m(h,_){ge(h,n,_);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(n,null)},p(h,_){if(_&4112){c=h[12];let x;for(x=0;x<c.length;x+=1){const o=Ld(h,c,x);l[x]?l[x].p(o,_):(l[x]=Rd(o),l[x].c(),l[x].m(n,null))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){h&&X(n),rr(l,h)}}}function Rd(d){let n,c,l=`${d[22]==0?0:d[4]}px`,h,_,x=d[27]+"",o,b;return{c(){n=xe("li"),c=xe("div"),h=qe(),_=xe("span"),o=nt(x),b=qe(),this.h()},l(E){n=be(E,"LI",{class:!0});var I=we(n);c=be(I,"DIV",{class:!0}),we(c).forEach(X),h=Ze(I),_=be(I,"SPAN",{class:!0});var P=we(_);o=st(P,x),P.forEach(X),b=Ze(I),I.forEach(X),this.h()},h(){ee(c,"class","legend-vis "+(d[22]==0?"bar":"marker-vis")+" svelte-h6j55z"),He(c,"border-bottom-width",l),ee(_,"class",ic(d[22]==0?"bold":"brackets")+" svelte-h6j55z"),ee(n,"class","svelte-h6j55z")},m(E,I){ge(E,n,I),ue(n,c),ue(n,h),ue(n,_),ue(_,o),ue(n,b)},p(E,I){I&16&&l!==(l=`${E[22]==0?0:E[4]}px`)&&He(c,"border-bottom-width",l),I&4096&&x!==(x=E[27]+"")&&Gt(o,x)},d(E){E&&X(n)}}}function i0(d){let n,c=d[20].values,l=[];for(let h=0;h<c.length;h+=1)l[h]=Fd(Pd(d,c,h));return{c(){for(let h=0;h<l.length;h+=1)l[h].c();n=xt()},l(h){for(let _=0;_<l.length;_+=1)l[_].l(h);n=xt()},m(h,_){for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(h,_);ge(h,n,_)},p(h,_){if(_&11282){c=h[20].values;let x;for(x=0;x<c.length;x+=1){const o=Pd(h,c,x);l[x]?l[x].p(o,_):(l[x]=Fd(o),l[x].c(),l[x].m(n.parentNode,n))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){rr(l,h),h&&X(n)}}}function r0(d){let n,c=d[20].values,l=[];for(let h=0;h<c.length;h+=1)l[h]=Od(Dd(d,c,h));return{c(){for(let h=0;h<l.length;h+=1)l[h].c();n=xt()},l(h){for(let _=0;_<l.length;_+=1)l[_].l(h);n=xt()},m(h,_){for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(h,_);ge(h,n,_)},p(h,_){if(_&11271){c=h[20].values;let x;for(x=0;x<c.length;x+=1){const o=Dd(h,c,x);l[x]?l[x].p(o,_):(l[x]=Od(o),l[x].c(),l[x].m(n.parentNode,n))}for(;x<l.length;x+=1)l[x].d(1);l.length=c.length}},d(h){rr(l,h),h&&X(n)}}}function Fd(d){let n,c=`calc(${d[11](d[23][d[1]])}% - ${d[4]/2}px)`,l=`${d[25]/d[13].length*100}%`,h=`calc(${1/d[13].length*100}% - 2px)`,_=`${d[4]}px`;return{c(){n=xe("div"),this.h()},l(x){n=be(x,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","marker svelte-h6j55z"),He(n,"bottom",c),He(n,"height","0px"),He(n,"left",l),He(n,"width",h),He(n,"border-bottom-width",_)},m(x,o){ge(x,n,o)},p(x,o){o&3090&&c!==(c=`calc(${x[11](x[23][x[1]])}% - ${x[4]/2}px)`)&&He(n,"bottom",c),o&8192&&l!==(l=`${x[25]/x[13].length*100}%`)&&He(n,"left",l),o&8192&&h!==(h=`calc(${1/x[13].length*100}% - 2px)`)&&He(n,"width",h),o&16&&_!==(_=`${x[4]}px`)&&He(n,"border-bottom-width",_)},d(x){x&&X(n)}}}function Od(d){let n,c,l=`${d[11](d[23][d[1]])}%`,h=`calc(${d[25]/d[13].length*100}%)`,_=`calc(${1/d[13].length*100}% - 2px)`,x,o;return{c(){n=xe("div"),this.h()},l(b){n=be(b,"DIV",{title:!0,class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"title",c=`${d[23][d[0]]}: ${d[2](d[23][d[1]])}%`+(d[10].length>1?` (${d[2](d[10][d[22]+1].values[d[25]][d[1]])}%)`:"")),ee(n,"class","bar svelte-h6j55z"),He(n,"bottom","0"),He(n,"height",l),He(n,"left",h),He(n,"width",_)},m(b,E){ge(b,n,E),x||(o=cp(t0.call(null,n)),x=!0)},p(b,E){E&1031&&c!==(c=`${b[23][b[0]]}: ${b[2](b[23][b[1]])}%`+(b[10].length>1?` (${b[2](b[10][b[22]+1].values[b[25]][b[1]])}%)`:""))&&ee(n,"title",c),E&3074&&l!==(l=`${b[11](b[23][b[1]])}%`)&&He(n,"height",l),E&8192&&h!==(h=`calc(${b[25]/b[13].length*100}%)`)&&He(n,"left",h),E&8192&&_!==(_=`calc(${1/b[13].length*100}% - 2px)`)&&He(n,"width",_)},d(b){b&&X(n),x=!1,o()}}}function Vd(d){let n;function c(_,x){return _[22]==0?r0:i0}let h=c(d)(d);return{c(){h.c(),n=xt()},l(_){h.l(_),n=xt()},m(_,x){h.m(_,x),ge(_,n,x)},p(_,x){h.p(_,x)},d(_){h.d(_),_&&X(n)}}}function Ud(d){let n,c,l=d[6][0]!=0&&Nd(d),h=d[6][1]!=18&&jd(d);return{c(){l&&l.c(),n=qe(),h&&h.c(),c=xt()},l(_){l&&l.l(_),n=Ze(_),h&&h.l(_),c=xt()},m(_,x){l&&l.m(_,x),ge(_,n,x),h&&h.m(_,x),ge(_,c,x)},p(_,x){_[6][0]!=0?l?l.p(_,x):(l=Nd(_),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null),_[6][1]!=18?h?h.p(_,x):(h=jd(_),h.c(),h.m(c.parentNode,c)):h&&(h.d(1),h=null)},d(_){l&&l.d(_),_&&X(n),h&&h.d(_),_&&X(c)}}}function Nd(d){let n,c=`${d[15](d[10])}%`;return{c(){n=xe("div"),this.h()},l(l){n=be(l,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","mask svelte-h6j55z"),He(n,"bottom","0"),He(n,"height",c),He(n,"left","0"),He(n,"width",d[14](d[6][0]))},m(l,h){ge(l,n,h)},p(l,h){h&1024&&c!==(c=`${l[15](l[10])}%`)&&He(n,"height",c),h&64&&He(n,"width",l[14](l[6][0]))},d(l){l&&X(n)}}}function jd(d){let n,c=`${d[15](d[10])}%`;return{c(){n=xe("div"),this.h()},l(l){n=be(l,"DIV",{class:!0}),we(n).forEach(X),this.h()},h(){ee(n,"class","mask svelte-h6j55z"),He(n,"bottom","0"),He(n,"height",c),He(n,"left",d[14](d[6][1])),He(n,"right","2px")},m(l,h){ge(l,n,h)},p(l,h){h&1024&&c!==(c=`${l[15](l[10])}%`)&&He(n,"height",c),h&64&&He(n,"left",l[14](l[6][1]))},d(l){l&&X(n)}}}function Gd(d){let n,c,l;return{c(){n=xe("small"),c=nt(d[7]),l=nt(d[8]),this.h()},l(h){n=be(h,"SMALL",{class:!0});var _=we(n);c=st(_,d[7]),l=st(_,d[8]),_.forEach(X),this.h()},h(){ee(n,"class","svelte-h6j55z")},m(h,_){ge(h,n,_),ue(n,c),ue(n,l)},p(h,_){_&128&&Gt(c,h[7]),_&256&&Gt(l,h[8])},d(h){h&&X(n)}}}function n0(d){let n,c,l,h=`${d[3]}px`,_,x,o,b=d[5][0]+"",E,I,P,A=d[5][1]+"",V,U,F,Q=d[9]&&d[12][1]&&Bd(d),pe=d[10],ae=[];for(let ze=0;ze<pe.length;ze+=1)ae[ze]=Vd(Md(d,pe,ze));let Se=d[6]!=null&&Ud(d),Ge=d[7]&&Gd(d);return{c(){Q&&Q.c(),n=qe(),c=xe("div");for(let ze=0;ze<ae.length;ze+=1)ae[ze].c();l=qe(),Se&&Se.c(),_=qe(),x=xe("div"),o=xe("div"),E=nt(b),I=qe(),P=xe("div"),V=nt(A),U=qe(),Ge&&Ge.c(),F=xt(),this.h()},l(ze){Q&&Q.l(ze),n=Ze(ze),c=be(ze,"DIV",{class:!0});var Oe=we(c);for(let dt=0;dt<ae.length;dt+=1)ae[dt].l(Oe);l=Ze(Oe),Se&&Se.l(Oe),Oe.forEach(X),_=Ze(ze),x=be(ze,"DIV",{class:!0});var Me=we(x);o=be(Me,"DIV",{class:!0});var Ue=we(o);E=st(Ue,b),Ue.forEach(X),I=Ze(Me),P=be(Me,"DIV",{class:!0});var zt=we(P);V=st(zt,A),zt.forEach(X),Me.forEach(X),U=Ze(ze),Ge&&Ge.l(ze),F=xt(),this.h()},h(){ee(c,"class","bar-group svelte-h6j55z"),He(c,"height",h),ee(o,"class","svelte-h6j55z"),He(o,"left","0"),ee(P,"class","svelte-h6j55z"),He(P,"right","0"),ee(x,"class","x-scale svelte-h6j55z"),He(x,"height","1rem")},m(ze,Oe){Q&&Q.m(ze,Oe),ge(ze,n,Oe),ge(ze,c,Oe);for(let Me=0;Me<ae.length;Me+=1)ae[Me]&&ae[Me].m(c,null);ue(c,l),Se&&Se.m(c,null),ge(ze,_,Oe),ge(ze,x,Oe),ue(x,o),ue(o,E),ue(x,I),ue(x,P),ue(P,V),ge(ze,U,Oe),Ge&&Ge.m(ze,Oe),ge(ze,F,Oe)},p(ze,[Oe]){if(ze[9]&&ze[12][1]?Q?Q.p(ze,Oe):(Q=Bd(ze),Q.c(),Q.m(n.parentNode,n)):Q&&(Q.d(1),Q=null),Oe&11287){pe=ze[10];let Me;for(Me=0;Me<pe.length;Me+=1){const Ue=Md(ze,pe,Me);ae[Me]?ae[Me].p(Ue,Oe):(ae[Me]=Vd(Ue),ae[Me].c(),ae[Me].m(c,l))}for(;Me<ae.length;Me+=1)ae[Me].d(1);ae.length=pe.length}ze[6]!=null?Se?Se.p(ze,Oe):(Se=Ud(ze),Se.c(),Se.m(c,null)):Se&&(Se.d(1),Se=null),Oe&8&&h!==(h=`${ze[3]}px`)&&He(c,"height",h),Oe&32&&b!==(b=ze[5][0]+"")&&Gt(E,b),Oe&32&&A!==(A=ze[5][1]+"")&&Gt(V,A),ze[7]?Ge?Ge.p(ze,Oe):(Ge=Gd(ze),Ge.c(),Ge.m(F.parentNode,F)):Ge&&(Ge.d(1),Ge=null)},i:Bt,o:Bt,d(ze){Q&&Q.d(ze),ze&&X(n),ze&&X(c),rr(ae,ze),Se&&Se.d(),ze&&X(_),ze&&X(x),ze&&X(U),Ge&&Ge.d(ze),ze&&X(F)}}}function s0(d,n,c){let l,h,_,x,o,{data:b}=n,{xKey:E="category"}=n,{yKey:I="value"}=n,{zKey:P="areanm"}=n,{formatTick:A=Me=>Me.toFixed(1)}=n,{height:V=100}=n,{markerWidth:U=2.5}=n,{minmax:F=["0 years","85+"]}=n,{maskRange:Q=null}=n,{base:pe=null}=n,{base_ext:ae=", 5 year age bands"}=n,{showLegend:Se=!0}=n;function Ge(Me,Ue){let zt={};for(const yi of Me)zt[yi[Ue]]||(zt[yi[Ue]]={label:yi[Ue],values:[]}),zt[yi[Ue]].values.push(yi);let dt=[];for(const yi in zt)dt.push(zt[yi]);return dt}function ze(Me){return Me%1===0?`calc(${Me/l.length*100}% - 1px)`:`calc(${Math.floor(Me)/l.length*100}% +(${1/l.length*100}% - 2px) * ${Me%1})`}function Oe(Me){return Math.max(...Me.map(Ue=>Math.max(...Ue.values.map(zt=>x(zt[I])))))}return d.$$set=Me=>{"data"in Me&&c(16,b=Me.data),"xKey"in Me&&c(0,E=Me.xKey),"yKey"in Me&&c(1,I=Me.yKey),"zKey"in Me&&c(17,P=Me.zKey),"formatTick"in Me&&c(2,A=Me.formatTick),"height"in Me&&c(3,V=Me.height),"markerWidth"in Me&&c(4,U=Me.markerWidth),"minmax"in Me&&c(5,F=Me.minmax),"maskRange"in Me&&c(6,Q=Me.maskRange),"base"in Me&&c(7,pe=Me.base),"base_ext"in Me&&c(8,ae=Me.base_ext),"showLegend"in Me&&c(9,Se=Me.showLegend)},d.$$.update=()=>{d.$$.dirty&65537&&c(13,l=b.map(Me=>Me[E]).filter((Me,Ue,zt)=>zt.indexOf(Me)===Ue)),d.$$.dirty&65538&&c(18,h=[0,Math.max(...b.map(Me=>Me[I]))]),d.$$.dirty&196608&&c(12,_=b.map(Me=>Me[P]).filter((Me,Ue,zt)=>zt.indexOf(Me)===Ue)),d.$$.dirty&262144&&c(11,x=Me=>Math.abs(Me/h[1])*100),d.$$.dirty&196608&&c(10,o=Ge(b,P))},[E,I,A,V,U,F,Q,pe,ae,Se,o,x,_,l,ze,Oe,b,P,h]}class o0 extends fi{constructor(n){super(),di(this,n,s0,n0,ti,{data:16,xKey:0,yKey:1,zKey:17,formatTick:2,height:3,markerWidth:4,minmax:5,maskRange:6,base:7,base_ext:8,showLegend:9})}}function a0(d){let n,c;return n=new o0({props:{data:d[0].selected&&nc("residents","resident_age_18b",d[0]),zKey:"group",maskRange:Bf(d[1]),base:"% of all people",showLegend:!1}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=l[0].selected&&nc("residents","resident_age_18b",l[0])),h&2&&(_.maskRange=Bf(l[1])),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function l0(d){let n,c=Za.nodata+"",l;return{c(){n=xe("span"),l=nt(c),this.h()},l(h){n=be(h,"SPAN",{class:!0});var _=we(n);l=st(_,c),_.forEach(X),this.h()},h(){ee(n,"class","num-desc svelte-uj0r62")},m(h,_){ge(h,n,_),ue(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function c0(d){let n,c=Za.nodata+"",l;return{c(){n=xe("span"),l=nt(c),this.h()},l(h){n=be(h,"SPAN",{class:!0});var _=we(n);l=st(_,c),_.forEach(X),this.h()},h(){ee(n,"class","num-desc svelte-uj0r62")},m(h,_){ge(h,n,_),ue(n,l)},p:Bt,i:Bt,o:Bt,d(h){h&&X(n)}}}function u0(d){let n,c,l,h;const _=[c0,l0,a0],x=[];function o(b,E){return b[0].selected.residents.resident_age_18b.values==="blocked"?0:b[0].selected.residents.resident_age_18b.values.percent[0]==null?1:2}return n=o(d),c=x[n]=_[n](d),{c(){c.c(),l=xt()},l(b){c.l(b),l=xt()},m(b,E){x[n].m(b,E),ge(b,l,E),h=!0},p(b,E){let I=n;n=o(b),n===I?x[n].p(b,E):(ui(),Be(x[I],1,1,()=>{x[I]=null}),hi(),c=x[n],c?c.p(b,E):(c=x[n]=_[n](b),c.c()),Ee(c,1),c.m(l.parentNode,l))},i(b){h||(Ee(c),h=!0)},o(b){Be(c),h=!1},d(b){x[n].d(b),b&&X(l)}}}function h0(d){let n,c;return n=new es({props:{title:"Age profile",$$slots:{default:[u0]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,[h]){const _={};h&7&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function f0(d,n,c){let{data:l}=n,{selected:h}=n;return d.$$set=_=>{"data"in _&&c(0,l=_.data),"selected"in _&&c(1,h=_.selected)},[l,h]}class d0 extends fi{constructor(n){super(),di(this,n,f0,h0,ti,{data:0,selected:1})}}function p0(d,n,c){const l=d.slice();return l[2]=n[c],l[4]=c,l}function m0(d){let n,c,l,h,_,x;return{c(){n=xe("li"),c=xe("div"),l=qe(),h=xe("span"),_=nt(d[2]),x=qe(),this.h()},l(o){n=be(o,"LI",{class:!0});var b=we(n);c=be(b,"DIV",{class:!0}),we(c).forEach(X),l=Ze(b),h=be(b,"SPAN",{class:!0});var E=we(h);_=st(E,d[2]),E.forEach(X),x=Ze(b),b.forEach(X),this.h()},h(){ee(c,"class","legend-vis "+(d[4]==0?"bar":"marker")+" svelte-npejzx"),ee(h,"class",d[4]==0?"bold":"brackets"),ee(n,"class","svelte-npejzx"),gt(n,"ew",d[4]!=0)},m(o,b){ge(o,n,b),ue(n,c),ue(n,l),ue(n,h),ue(h,_),ue(n,x)},p:Bt,d(o){o&&X(n)}}}function g0(d){let n,c,l,h;const _=d[1].default,x=$i(_,d,d[0],null);let o=["People with the selected characteristics","All people in England and Wales"],b=[];for(let E=0;E<2;E+=1)b[E]=m0(p0(d,o,E));return{c(){n=xe("p"),x&&x.c(),c=qe(),l=xe("ul");for(let E=0;E<2;E+=1)b[E].c();this.h()},l(E){n=be(E,"P",{class:!0});var I=we(n);x&&x.l(I),I.forEach(X),c=Ze(E),l=be(E,"UL",{class:!0});var P=we(l);for(let A=0;A<2;A+=1)b[A].l(P);P.forEach(X),this.h()},h(){ee(n,"class","legend-text svelte-npejzx"),ee(l,"class","legend-block svelte-npejzx")},m(E,I){ge(E,n,I),x&&x.m(n,null),ge(E,c,I),ge(E,l,I);for(let P=0;P<2;P+=1)b[P]&&b[P].m(l,null);h=!0},p(E,[I]){x&&x.p&&(!h||I&1)&&er(x,_,E,E[0],h?ir(_,E[0],I,null):tr(E[0]),null)},i(E){h||(Ee(x,E),h=!0)},o(E){Be(x,E),h=!1},d(E){E&&X(n),x&&x.d(E),E&&X(c),E&&X(l),rr(b,E)}}}function _0(d,n,c){let{$$slots:l={},$$scope:h}=n;return d.$$set=_=>{"$$scope"in _&&c(0,h=_.$$scope)},[h,l]}class Dp extends fi{constructor(n){super(),di(this,n,_0,g0,ti,{})}}function qd(d,n,c){const l=d.slice();return l[18]=n[c],l}function Zd(d,n,c){const l=d.slice();return l[21]=n[c],l}function Xd(d,n,c){const l=d.slice();return l[24]=n[c],l[26]=c,l}function y0(d){let n;return{c(){n=nt("Close menu")},l(c){n=st(c,"Close menu")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function v0(d){let n,c,l,h;return n=new gy({props:{options:Cg,clickCallback:d[5],removeCatCallback:d[6],globalSelectedCategories:d[1],disabled:d[2]==="loading"}}),l=new pp({props:{variant:"secondary",small:!0,$$slots:{default:[y0]},$$scope:{ctx:d}}}),l.$on("click",O0),{c(){kt(n.$$.fragment),c=qe(),kt(l.$$.fragment)},l(_){Ct(n.$$.fragment,_),c=Ze(_),Ct(l.$$.fragment,_)},m(_,x){Et(n,_,x),ge(_,c,x),Et(l,_,x),h=!0},p(_,x){const o={};x&2&&(o.globalSelectedCategories=_[1]),x&4&&(o.disabled=_[2]==="loading"),n.$set(o);const b={};x&134217728&&(b.$$scope={dirty:x,ctx:_}),l.$set(b)},i(_){h||(Ee(n.$$.fragment,_),Ee(l.$$.fragment,_),h=!0)},o(_){Be(n.$$.fragment,_),Be(l.$$.fragment,_),h=!1},d(_){St(n,_),_&&X(c),St(l,_)}}}function Hd(d){let n,c;return n=new a_({props:{mode:d[2]=="failed"||d[3]==!0?"pending":"info",$$slots:{default:[S0]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&12&&(_.mode=l[2]=="failed"||l[3]==!0?"pending":"info"),h&134217742&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function x0(d){let n,c;function l(x,o){return x[1].length===2?T0:w0}let h=l(d),_=h(d);return{c(){n=nt("The profile below is for people with "),_.c(),c=nt(`
              of the following characteristics:`)},l(x){n=st(x,"The profile below is for people with "),_.l(x),c=st(x,`
              of the following characteristics:`)},m(x,o){ge(x,n,o),_.m(x,o),ge(x,c,o)},p(x,o){h!==(h=l(x))&&(_.d(1),_=h(x),_&&(_.c(),_.m(c.parentNode,c)))},d(x){x&&X(n),_.d(x),x&&X(c)}}}function b0(d){let n;return{c(){n=nt("The profile below is for people with the following characteristic:")},l(c){n=st(c,"The profile below is for people with the following characteristic:")},m(c,l){ge(c,n,l)},p:Bt,d(c){c&&X(n)}}}function w0(d){let n;return{c(){n=nt("all")},l(c){n=st(c,"all")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function T0(d){let n;return{c(){n=nt("both")},l(c){n=st(c,"both")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function k0(d){let n,c,l=Ss(d[24].topic)+"",h,_,x=Ss(Go(d[24].label))+"",o,b,E,I,P;function A(){return d[8](d[24])}return{c(){n=xe("button"),c=xe("span"),h=nt(l),_=nt(": "),o=nt(x),b=qe(),E=xe("span"),this.h()},l(V){n=be(V,"BUTTON",{class:!0});var U=we(n);c=be(U,"SPAN",{class:!0});var F=we(c);h=st(F,l),_=st(F,": "),o=st(F,x),F.forEach(X),b=Ze(U),E=be(U,"SPAN",{class:!0}),we(E).forEach(X),U.forEach(X),this.h()},h(){ee(c,"class","chip-text svelte-u99f0d"),ee(E,"class","chip-ready svelte-u99f0d"),ee(n,"class","chip svelte-u99f0d")},m(V,U){ge(V,n,U),ue(n,c),ue(c,h),ue(c,_),ue(c,o),ue(n,b),ue(n,E),I||(P=ts(n,"click",A),I=!0)},p(V,U){d=V,U&2&&l!==(l=Ss(d[24].topic)+"")&&Gt(h,l),U&2&&x!==(x=Ss(Go(d[24].label))+"")&&Gt(o,x)},d(V){V&&X(n),I=!1,P()}}}function E0(d){let n,c,l=Ss(d[24].topic)+"",h,_,x=Ss(Go(d[24].label))+"",o,b,E;return{c(){n=xe("div"),c=xe("span"),h=nt(l),_=nt(": "),o=nt(x),b=qe(),E=xe("div"),this.h()},l(I){n=be(I,"DIV",{class:!0});var P=we(n);c=be(P,"SPAN",{class:!0});var A=we(c);h=st(A,l),_=st(A,": "),o=st(A,x),A.forEach(X),b=Ze(P),E=be(P,"DIV",{class:!0}),we(E).forEach(X),P.forEach(X),this.h()},h(){ee(c,"class","chip-text svelte-u99f0d"),ee(E,"class","chip-loader svelte-u99f0d"),ee(n,"class","chip chip-pending svelte-u99f0d")},m(I,P){ge(I,n,P),ue(n,c),ue(c,h),ue(c,_),ue(c,o),ue(n,b),ue(n,E)},p(I,P){P&2&&l!==(l=Ss(I[24].topic)+"")&&Gt(h,l),P&2&&x!==(x=Ss(Go(I[24].label))+"")&&Gt(o,x)},d(I){I&&X(n)}}}function Wd(d){let n;function c(_,x){return _[2]=="loading"?E0:k0}let l=c(d),h=l(d);return{c(){h.c(),n=xt()},l(_){h.l(_),n=xt()},m(_,x){h.m(_,x),ge(_,n,x)},p(_,x){l===(l=c(_))&&h?h.p(_,x):(h.d(1),h=l(_),h&&(h.c(),h.m(n.parentNode,n)))},d(_){h.d(_),_&&X(n)}}}function Kd(d){let n,c,l,h=d[2]=="failed"&&Jd(),_=d[3]==!0&&Yd();return{c(){n=xe("p"),c=nt(`Some datasets not available for selected variables.
              `),h&&h.c(),l=qe(),_&&_.c(),this.h()},l(x){n=be(x,"P",{});var o=we(n);c=st(o,`Some datasets not available for selected variables.
              `),h&&h.l(o),l=Ze(o),_&&_.l(o),o.forEach(X),this.h()},h(){He(n,"margin","1rem 0 0")},m(x,o){ge(x,n,o),ue(n,c),h&&h.m(n,null),ue(n,l),_&&_.m(n,null)},p(x,o){x[2]=="failed"?h||(h=Jd(),h.c(),h.m(n,l)):h&&(h.d(1),h=null),x[3]==!0?_||(_=Yd(),_.c(),_.m(n,null)):_&&(_.d(1),_=null)},d(x){x&&X(n),h&&h.d(),_&&_.d()}}}function Jd(d){let n;return{c(){n=nt("Try removing a variable to see more datasets.")},l(c){n=st(c,"Try removing a variable to see more datasets.")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function Yd(d){let n;return{c(){n=nt(`Economic indicators (employment, social status etc) not available for
                ages 0 to 15.`)},l(c){n=st(c,`Economic indicators (employment, social status etc) not available for
                ages 0 to 15.`)},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function S0(d){let n,c,l,h;function _(P,A){return P[1].length===1?b0:x0}let x=_(d),o=x(d),b=d[1],E=[];for(let P=0;P<b.length;P+=1)E[P]=Wd(Xd(d,b,P));let I=(d[2]=="failed"||d[3]==!0)&&Kd(d);return{c(){n=xe("div"),c=xe("p"),o.c(),l=qe();for(let P=0;P<E.length;P+=1)E[P].c();h=qe(),I&&I.c(),this.h()},l(P){n=be(P,"DIV",{"aria-live":!0});var A=we(n);c=be(A,"P",{});var V=we(c);o.l(V),V.forEach(X),l=Ze(A);for(let U=0;U<E.length;U+=1)E[U].l(A);h=Ze(A),I&&I.l(A),A.forEach(X),this.h()},h(){ee(n,"aria-live","polite")},m(P,A){ge(P,n,A),ue(n,c),o.m(c,null),ue(n,l);for(let V=0;V<E.length;V+=1)E[V]&&E[V].m(n,null);ue(n,h),I&&I.m(n,null)},p(P,A){if(x===(x=_(P))&&o?o.p(P,A):(o.d(1),o=x(P),o&&(o.c(),o.m(c,null))),A&134){b=P[1];let V;for(V=0;V<b.length;V+=1){const U=Xd(P,b,V);E[V]?E[V].p(U,A):(E[V]=Wd(U),E[V].c(),E[V].m(n,h))}for(;V<E.length;V+=1)E[V].d(1);E.length=b.length}P[2]=="failed"||P[3]==!0?I?I.p(P,A):(I=Kd(P),I.c(),I.m(n,null)):I&&(I.d(1),I=null)},d(P){P&&X(n),o.d(),rr(E,P),I&&I.d()}}}function I0(d){let n,c,l,h,_,x,o,b,E,I,P,A,V;P=new w_({props:{title:"Select characteristics",open:R0,$$slots:{default:[v0]},$$scope:{ctx:d}}});let U=d[1][0]&&Hd(d);return{c(){n=xe("div"),c=xe("p"),l=nt(`Select one or more identity characteristics to define a population group, for example
      `),h=xe("a"),_=nt("Sikhs born in the UK"),x=nt(`
      or
      `),o=xe("a"),b=nt("people aged 65+ born in Ireland"),E=nt(`.
      Once selected, you will see how this group compares to the whole population of England and Wales based on Census 2021 data.`),I=qe(),kt(P.$$.fragment),A=qe(),U&&U.c(),this.h()},l(F){n=be(F,"DIV",{slot:!0});var Q=we(n);c=be(Q,"P",{class:!0});var pe=we(c);l=st(pe,`Select one or more identity characteristics to define a population group, for example
      `),h=be(pe,"A",{href:!0,class:!0});var ae=we(h);_=st(ae,"Sikhs born in the UK"),ae.forEach(X),x=st(pe,`
      or
      `),o=be(pe,"A",{href:!0,class:!0});var Se=we(o);b=st(Se,"people aged 65+ born in Ireland"),Se.forEach(X),E=st(pe,`.
      Once selected, you will see how this group compares to the whole population of England and Wales based on Census 2021 data.`),pe.forEach(X),I=Ze(Q),Ct(P.$$.fragment,Q),A=Ze(Q),U&&U.l(Q),Q.forEach(X),this.h()},h(){ee(h,"href","?religion_tb=7&country_of_birth_3a=1"),ee(h,"class","svelte-u99f0d"),ee(o,"href","?resident_age_3a=3&country_of_birth_8a=2"),ee(o,"class","svelte-u99f0d"),ee(c,"class","subtitle svelte-u99f0d"),ee(n,"slot","after")},m(F,Q){ge(F,n,Q),ue(n,c),ue(c,l),ue(c,h),ue(h,_),ue(c,x),ue(c,o),ue(o,b),ue(c,E),ue(n,I),Et(P,n,null),ue(n,A),U&&U.m(n,null),V=!0},p(F,Q){const pe={};Q&134217734&&(pe.$$scope={dirty:Q,ctx:F}),P.$set(pe),F[1][0]?U?(U.p(F,Q),Q&2&&Ee(U,1)):(U=Hd(F),U.c(),Ee(U,1),U.m(n,null)):U&&(ui(),Be(U,1,1,()=>{U=null}),hi())},i(F){V||(Ee(P.$$.fragment,F),Ee(U),V=!0)},o(F){Be(P.$$.fragment,F),Be(U),V=!1},d(F){F&&X(n),St(P),U&&U.d()}}}function Qd(d){let n,c,l,h,_,x;n=new zu({props:{title:"Demographics",height:"auto",$$slots:{default:[z0]},$$scope:{ctx:d}}}),l=new B1({props:{data:d[0],mapStyle:kg,mapBounds:Eg,ladBounds:Ga,selected:d[1],colors:Uo}});let o=tc[0].tablesCategorised,b=[];for(let I=0;I<o.length;I+=1)b[I]=tp(qd(d,o,I));const E=I=>Be(b[I],1,1,()=>{b[I]=null});return{c(){kt(n.$$.fragment),c=qe(),kt(l.$$.fragment),h=qe();for(let I=0;I<b.length;I+=1)b[I].c();_=xt()},l(I){Ct(n.$$.fragment,I),c=Ze(I),Ct(l.$$.fragment,I),h=Ze(I);for(let P=0;P<b.length;P+=1)b[P].l(I);_=xt()},m(I,P){Et(n,I,P),ge(I,c,P),Et(l,I,P),ge(I,h,P);for(let A=0;A<b.length;A+=1)b[A]&&b[A].m(I,P);ge(I,_,P),x=!0},p(I,P){const A={};P&134217731&&(A.$$scope={dirty:P,ctx:I}),n.$set(A);const V={};if(P&1&&(V.data=I[0]),P&2&&(V.selected=I[1]),l.$set(V),P&17){o=tc[0].tablesCategorised;let U;for(U=0;U<o.length;U+=1){const F=qd(I,o,U);b[U]?(b[U].p(F,P),Ee(b[U],1)):(b[U]=tp(F),b[U].c(),Ee(b[U],1),b[U].m(_.parentNode,_))}for(ui(),U=o.length;U<b.length;U+=1)E(U);hi()}},i(I){if(!x){Ee(n.$$.fragment,I),Ee(l.$$.fragment,I);for(let P=0;P<o.length;P+=1)Ee(b[P]);x=!0}},o(I){Be(n.$$.fragment,I),Be(l.$$.fragment,I),b=b.filter(Boolean);for(let P=0;P<b.length;P+=1)Be(b[P]);x=!1},d(I){St(n,I),I&&X(c),St(l,I),I&&X(h),rr(b,I),I&&X(_)}}}function C0(d){let n;return{c(){n=nt("Number of people, age and sex compared to the population as a whole.")},l(c){n=st(c,"Number of people, age and sex compared to the population as a whole.")},m(c,l){ge(c,n,l)},d(c){c&&X(n)}}}function A0(d){let n,c;return n=new Dp({props:{$$slots:{default:[C0]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&134217728&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function $d(d){let n,c;return n=new Pp({props:{title:"Sex",table:{code:"sex",key:"Sex"},data:d[0],chart_type:d[4]}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.data=l[0]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function z0(d){let n,c,l,h,_,x,o=!d[1].map(ip).includes("sex"),b,E;n=new es({props:{colspan:3,noBackground:!0,$$slots:{default:[A0]},$$scope:{ctx:d}}}),l=new Y1({props:{data:d[0]}}),_=new d0({props:{data:d[0],selected:d[1]}});let I=o&&$d(d);return{c(){kt(n.$$.fragment),c=qe(),kt(l.$$.fragment),h=qe(),kt(_.$$.fragment),x=qe(),I&&I.c(),b=xt()},l(P){Ct(n.$$.fragment,P),c=Ze(P),Ct(l.$$.fragment,P),h=Ze(P),Ct(_.$$.fragment,P),x=Ze(P),I&&I.l(P),b=xt()},m(P,A){Et(n,P,A),ge(P,c,A),Et(l,P,A),ge(P,h,A),Et(_,P,A),ge(P,x,A),I&&I.m(P,A),ge(P,b,A),E=!0},p(P,A){const V={};A&134217728&&(V.$$scope={dirty:A,ctx:P}),n.$set(V);const U={};A&1&&(U.data=P[0]),l.$set(U);const F={};A&1&&(F.data=P[0]),A&2&&(F.selected=P[1]),_.$set(F),A&2&&(o=!P[1].map(ip).includes("sex")),o?I?(I.p(P,A),A&2&&Ee(I,1)):(I=$d(P),I.c(),Ee(I,1),I.m(b.parentNode,b)):I&&(ui(),Be(I,1,1,()=>{I=null}),hi())},i(P){E||(Ee(n.$$.fragment,P),Ee(l.$$.fragment,P),Ee(_.$$.fragment,P),Ee(I),E=!0)},o(P){Be(n.$$.fragment,P),Be(l.$$.fragment,P),Be(_.$$.fragment,P),Be(I),E=!1},d(P){St(n,P),P&&X(c),St(l,P),P&&X(h),St(_,P),P&&X(x),I&&I.d(P),P&&X(b)}}}function M0(d){let n=d[18].categoryDescription+"",c;return{c(){c=nt(n)},l(l){c=st(l,n)},m(l,h){ge(l,c,h)},p:Bt,d(l){l&&X(c)}}}function P0(d){let n,c;return n=new Dp({props:{$$slots:{default:[M0]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&134217728&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function ep(d){let n,c;return n=new Pp({props:{title:Lf(d[21].key),table:d[21],data:d[0],chart_type:d[4]}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&1&&(_.title=Lf(l[21].key)),h&1&&(_.table=l[21]),h&1&&(_.data=l[0]),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function D0(d){let n,c,l,h;n=new es({props:{colspan:3,noBackground:!0,$$slots:{default:[P0]},$$scope:{ctx:d}}});let _=d[18].tables.filter(d[9]),x=[];for(let b=0;b<_.length;b+=1)x[b]=ep(Zd(d,_,b));const o=b=>Be(x[b],1,1,()=>{x[b]=null});return{c(){kt(n.$$.fragment),c=qe();for(let b=0;b<x.length;b+=1)x[b].c();l=qe()},l(b){Ct(n.$$.fragment,b),c=Ze(b);for(let E=0;E<x.length;E+=1)x[E].l(b);l=Ze(b)},m(b,E){Et(n,b,E),ge(b,c,E);for(let I=0;I<x.length;I+=1)x[I]&&x[I].m(b,E);ge(b,l,E),h=!0},p(b,E){const I={};if(E&134217728&&(I.$$scope={dirty:E,ctx:b}),n.$set(I),E&17){_=b[18].tables.filter(b[9]);let P;for(P=0;P<_.length;P+=1){const A=Zd(b,_,P);x[P]?(x[P].p(A,E),Ee(x[P],1)):(x[P]=ep(A),x[P].c(),Ee(x[P],1),x[P].m(l.parentNode,l))}for(ui(),P=_.length;P<x.length;P+=1)o(P);hi()}},i(b){if(!h){Ee(n.$$.fragment,b);for(let E=0;E<_.length;E+=1)Ee(x[E]);h=!0}},o(b){Be(n.$$.fragment,b),x=x.filter(Boolean);for(let E=0;E<x.length;E+=1)Be(x[E]);h=!1},d(b){St(n,b),b&&X(c),rr(x,b),b&&X(l)}}}function tp(d){let n,c;return n=new zu({props:{title:d[18].categoryName,height:"auto",$$slots:{default:[D0]},$$scope:{ctx:d}}}),{c(){kt(n.$$.fragment)},l(l){Ct(n.$$.fragment,l)},m(l,h){Et(n,l,h),c=!0},p(l,h){const _={};h&134217729&&(_.$$scope={dirty:h,ctx:l}),n.$set(_)},i(l){c||(Ee(n.$$.fragment,l),c=!0)},o(l){Be(n.$$.fragment,l),c=!1},d(l){St(n,l)}}}function L0(d){let n,c,l,h,_,x,o,b,E,I,P,A,V,U;E=new qg({props:{links:[{label:"Census",href:"/census"},{label:"Create a population group profile"}]}}),P=new v_({props:{title:"Create a population group profile",$$slots:{after:[I0]},$$scope:{ctx:d}}});let F=d[2]=="success"&&d[1].length>0&&Qd(d);return{c(){n=xe("meta"),c=xe("meta"),l=xe("meta"),h=xe("meta"),_=xe("meta"),x=xe("meta"),o=xe("meta"),b=qe(),kt(E.$$.fragment),I=qe(),kt(P.$$.fragment),A=qe(),F&&F.c(),V=xt(),this.h()},l(Q){const pe=up("svelte-1fzc9rl",document.head);n=be(pe,"META",{name:!0,content:!0}),c=be(pe,"META",{property:!0,content:!0}),l=be(pe,"META",{property:!0,content:!0}),h=be(pe,"META",{property:!0,content:!0}),_=be(pe,"META",{property:!0,content:!0}),x=be(pe,"META",{property:!0,content:!0}),o=be(pe,"META",{name:!0,content:!0}),pe.forEach(X),b=Ze(Q),Ct(E.$$.fragment,Q),I=Ze(Q),Ct(P.$$.fragment,Q),A=Ze(Q),F&&F.l(Q),V=xt(),this.h()},h(){document.title="Create a population group profile",ee(n,"name","description"),ee(n,"content",""),ee(c,"property","og:title"),ee(c,"content","Create a population group profile"),ee(l,"property","og:type"),ee(l,"content","website"),ee(h,"property","og:url"),ee(h,"content",Eu),ee(_,"property","og:image:type"),ee(_,"content","image/jpeg"),ee(x,"property","og:description"),ee(x,"content",""),ee(o,"name","description"),ee(o,"content","")},m(Q,pe){ue(document.head,n),ue(document.head,c),ue(document.head,l),ue(document.head,h),ue(document.head,_),ue(document.head,x),ue(document.head,o),ge(Q,b,pe),Et(E,Q,pe),ge(Q,I,pe),Et(P,Q,pe),ge(Q,A,pe),F&&F.m(Q,pe),ge(Q,V,pe),U=!0},p(Q,[pe]){const ae={};pe&134217742&&(ae.$$scope={dirty:pe,ctx:Q}),P.$set(ae),Q[2]=="success"&&Q[1].length>0?F?(F.p(Q,pe),pe&6&&Ee(F,1)):(F=Qd(Q),F.c(),Ee(F,1),F.m(V.parentNode,V)):F&&(ui(),Be(F,1,1,()=>{F=null}),hi())},i(Q){U||(Ee(E.$$.fragment,Q),Ee(P.$$.fragment,Q),Ee(F),U=!0)},o(Q){Be(E.$$.fragment,Q),Be(P.$$.fragment,Q),Be(F),U=!1},d(Q){X(n),X(c),X(l),X(h),X(_),X(x),X(o),Q&&X(b),St(E,Q),Q&&X(I),St(P,Q),Q&&X(A),F&&F.d(Q),Q&&X(V)}}}let B0="light",R0=!0;function F0(d){let n=[];d.forEach(l=>n.push(l[0]));const c=d.flat().pop();return(d.length===1||c!=n[n.length-1])&&n.push(c),n}const ip=d=>d.key,O0=d=>d.detail.target.parentElement.parentElement.removeAttribute("open");function V0(d,n,c){let l;ac(d,Mg,ae=>c(11,l=ae));let{data:h}=n;so("theme",Sg[B0]);let _=[],x="success",o=!1,b=J_;function E(){U_(`${Eu}?${_.map(ae=>`${ae.key}=${ae.code}`).join("&")}`,{noScroll:!0,keepFocus:!0})}function I(ae,Se){c(1,_=[..._.filter(Ge=>Ge.topic!==ae.shortLabel),{topic:ae.shortLabel,key:ae.key,...Se}]),E()}function P(ae){c(1,_=_.filter(Se=>Se.topic!==ae.shortLabel)),E()}function A(ae){c(1,_=_.filter(Se=>Se.topic!=ae)),E()}function V(ae){c(0,h.selected=ae.data,h),c(0,h.selected.total_pop=ae.total_pop,h),c(0,h.geoPerc=[],h);let Se;h.geoCodesAndNames.forEach(({code:ze,name:Oe})=>{let Me=_.length===0?100:ae.mapData[ze]!=null?ae.mapData[ze][1]:null;h.geoPerc.push({code:ze,name:Oe,value:Me})});let Ge=h.geoPerc.map(ze=>ze.value).filter(ze=>ze!=null);if(Se=Ge.length===0?null:Z_(Ge,Math.min(5,Ge.length)),!Se)h.geoPerc.forEach(ze=>ze.color=Uo.nodata),c(0,h.geoBreaks=[0,100],h);else if(_.length===0)h.geoPerc.forEach(ze=>ze.color=Uo.seq[4]),c(0,h.geoBreaks=[100,100],h);else{let ze=F0(Se);h.geoPerc.forEach(Oe=>Oe.color=Oe.value!=null?F_(Oe.value,ze,Uo.seq):Uo.nodata),c(0,h.geoBreaks=ze,h)}_.length,c(2,x="success")}function U(){c(2,x="loading"),c(3,o=_&&_.some(ae=>["Aged 4 years and under","Aged 5 to 9 years","Aged 10 to 14 years","Aged 15 years and under"].includes(ae.label))),mp(tc,_).then(V)}function F(){c(1,_=[]);for(let ae of l.url.searchParams.entries()){let Se=Ig.find(ze=>ze.key==ae[0]);if(!Se)continue;let Ge=Se.cats.find(ze=>ze.code==ae[1]);Ge&&_.push({topic:Se.shortLabel,key:Se.key,...Ge})}U()}N_(F);const Q=ae=>A(ae.topic),pe=ae=>h.selected.residents[ae.code].values!=="blocked"&&h.selected.residents[ae.code].values!==void 0;return d.$$set=ae=>{"data"in ae&&c(0,h=ae.data)},d.$$.update=()=>{d.$$.dirty&2&&console.log("selected",_)},[h,_,x,o,b,I,P,A,Q,pe]}class W0 extends fi{constructor(n){super(),di(this,n,V0,L0,ti,{data:0})}}export{W0 as component,X0 as universal};
