//js
import{T as C_,e as Pi,c as s1,b as Ru,l as ac,d as Vo,f as jo,g as Df,m as a1,h as o1,i as l1,t as c1,j as hf,v as u1,k as h1}from"../chunks/Table.svelte_svelte_type_style_lang.fefaeba6.js";import{b as qo}from"../chunks/paths.37ae9a2d.js";import{s as Fi,e as oi,i as Ze,d as J,r as Tr,f as $e,a as mt,g as je,h as et,c as gt,j as _e,F as Ht,C as ze,u as Cr,v as Ir,w as Ar,I as Pr,z as da,A as pa,l as Ut,m as Vt,n as bi,M as I_,N as A_,L as Za,k as Ft,O as $u,P as ju,E as dc,x as Ga,y as qu,Q as Qp,B as lr,o as Zu,D as Ci,R as Lf,G as $s,S as f1,T as P_,J as d1,p as yc,U as Gu,K as z_,V as Hu,q as em}from"../chunks/scheduler.452d2f96.js";import{S as $i,i as ji,g as Ni,t as st,c as Ui,a as Ye,b as ii,d as si,m as ri,e as ni,f as Wu}from"../chunks/index.bed91369.js";import{p as p1}from"../chunks/stores.9ec628bc.js";import{w as M_,h as D_}from"../chunks/singletons.91eb9aab.js";const L_=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function m1(c){let r,a;return r=new C_({props:{id:c[0],cls:c[1],theme:c[6],background:c[8],overrides:c[7],$$slots:{default:[_1]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&1&&(f.id=l[0]),u&2&&(f.cls=l[1]),u&64&&(f.theme=l[6]),u&256&&(f.background=l[8]),u&128&&(f.overrides=l[7]),u&5692&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function g1(c){let r,a;return r=new C_({props:{id:c[0],cls:c[1],theme:c[6],background:c[8],overrides:c[7],$$slots:{default:[y1]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&1&&(f.id=l[0]),u&2&&(f.cls=l[1]),u&64&&(f.theme=l[6]),u&256&&(f.background=l[8]),u&128&&(f.overrides=l[7]),u&5692&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function tm(c){let r;return{c(){r=$e("div"),this.h()},l(a){r=je(a,"DIV",{class:!0}),et(r).forEach(J),this.h()},h(){_e(r,"class","ons-spacer")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function im(c){let r;return{c(){r=$e("div"),this.h()},l(a){r=je(a,"DIV",{class:!0}),et(r).forEach(J),this.h()},h(){_e(r,"class","ons-spacer")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function _1(c){let r,a,l,u,f,d=c[4]&&tm();const n=c[11].default,g=Tr(n,c,c[12],null);let v=c[5]&&im();return{c(){r=$e("div"),d&&d.c(),a=mt(),g&&g.c(),l=mt(),v&&v.c(),this.h()},l(E){r=je(E,"DIV",{id:!0,class:!0});var S=et(r);d&&d.l(S),a=gt(S),g&&g.l(S),l=gt(S),v&&v.l(S),S.forEach(J),this.h()},h(){_e(r,"id",c[10]),_e(r,"class",u="ons-page__container ons-container "+c[9]+" svelte-18rmgoy"),Ht(r,"ons-page__container--wider",c[2]==="wider"),Ht(r,"ons-page__container--full",c[2]==="full"),Ht(r,"ons-page__container--tall-height",c[3]==="tall"),Ht(r,"ons-page__container--full-height",c[3]==="full")},m(E,S){Ze(E,r,S),d&&d.m(r,null),ze(r,a),g&&g.m(r,null),ze(r,l),v&&v.m(r,null),f=!0},p(E,S){E[4]?d||(d=tm(),d.c(),d.m(r,a)):d&&(d.d(1),d=null),g&&g.p&&(!f||S&4096)&&Cr(g,n,E,E[12],f?Ar(n,E[12],S,null):Ir(E[12]),null),E[5]?v||(v=im(),v.c(),v.m(r,null)):v&&(v.d(1),v=null),(!f||S&1024)&&_e(r,"id",E[10]),(!f||S&512&&u!==(u="ons-page__container ons-container "+E[9]+" svelte-18rmgoy"))&&_e(r,"class",u),(!f||S&516)&&Ht(r,"ons-page__container--wider",E[2]==="wider"),(!f||S&516)&&Ht(r,"ons-page__container--full",E[2]==="full"),(!f||S&520)&&Ht(r,"ons-page__container--tall-height",E[3]==="tall"),(!f||S&520)&&Ht(r,"ons-page__container--full-height",E[3]==="full")},i(E){f||(Ye(g,E),f=!0)},o(E){st(g,E),f=!1},d(E){E&&J(r),d&&d.d(),g&&g.d(E),v&&v.d()}}}function rm(c){let r;return{c(){r=$e("div"),this.h()},l(a){r=je(a,"DIV",{class:!0}),et(r).forEach(J),this.h()},h(){_e(r,"class","ons-spacer")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function nm(c){let r;return{c(){r=$e("div"),this.h()},l(a){r=je(a,"DIV",{class:!0}),et(r).forEach(J),this.h()},h(){_e(r,"class","ons-spacer")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function y1(c){let r,a,l,u,f,d,n=c[4]&&rm();const g=c[11].default,v=Tr(g,c,c[12],null);let E=c[5]&&nm();return{c(){r=$e("div"),n&&n.c(),a=mt(),l=$e("div"),v&&v.c(),u=mt(),E&&E.c(),this.h()},l(S){r=je(S,"DIV",{id:!0,class:!0});var T=et(r);n&&n.l(T),a=gt(T),l=je(T,"DIV",{class:!0});var k=et(l);v&&v.l(k),k.forEach(J),u=gt(T),E&&E.l(T),T.forEach(J),this.h()},h(){_e(l,"class","svelte-18rmgoy"),Ht(l,"ons-page__container--narrow",c[2]==="narrow"),Ht(l,"ons-page__container--medium",c[2]==="medium"),_e(r,"id",c[10]),_e(r,"class",f="ons-page__container ons-container "+c[9]+" svelte-18rmgoy"),Ht(r,"ons-page__container--tall-height",c[3]==="tall"),Ht(r,"ons-page__container--full-height",c[3]==="full")},m(S,T){Ze(S,r,T),n&&n.m(r,null),ze(r,a),ze(r,l),v&&v.m(l,null),ze(r,u),E&&E.m(r,null),d=!0},p(S,T){S[4]?n||(n=rm(),n.c(),n.m(r,a)):n&&(n.d(1),n=null),v&&v.p&&(!d||T&4096)&&Cr(v,g,S,S[12],d?Ar(g,S[12],T,null):Ir(S[12]),null),(!d||T&4)&&Ht(l,"ons-page__container--narrow",S[2]==="narrow"),(!d||T&4)&&Ht(l,"ons-page__container--medium",S[2]==="medium"),S[5]?E||(E=nm(),E.c(),E.m(r,null)):E&&(E.d(1),E=null),(!d||T&1024)&&_e(r,"id",S[10]),(!d||T&512&&f!==(f="ons-page__container ons-container "+S[9]+" svelte-18rmgoy"))&&_e(r,"class",f),(!d||T&520)&&Ht(r,"ons-page__container--tall-height",S[3]==="tall"),(!d||T&520)&&Ht(r,"ons-page__container--full-height",S[3]==="full")},i(S){d||(Ye(v,S),d=!0)},o(S){st(v,S),d=!1},d(S){S&&J(r),n&&n.d(),v&&v.d(S),E&&E.d()}}}function v1(c){let r,a,l,u,f;const d=[g1,m1],n=[];function g(v,E){return E&4&&(r=null),r==null&&(r=!!["narrow","medium"].includes(v[2])),r?0:1}return a=g(c,-1),l=n[a]=d[a](c),{c(){l.c(),u=oi()},l(v){l.l(v),u=oi()},m(v,E){n[a].m(v,E),Ze(v,u,E),f=!0},p(v,[E]){let S=a;a=g(v,E),a===S?n[a].p(v,E):(Ni(),st(n[S],1,1,()=>{n[S]=null}),Ui(),l=n[a],l?l.p(v,E):(l=n[a]=d[a](v),l.c()),Ye(l,1),l.m(u.parentNode,u))},i(v){f||(Ye(l),f=!0)},o(v){st(l),f=!1},d(v){v&&J(u),n[a].d(v)}}}function b1(c,r,a){let l,u,{$$slots:f={},$$scope:d}=r,{id:n=null}=r,{cls:g=null}=r,{width:v="wide"}=r,{height:E="auto"}=r,{marginTop:S=!1}=r,{marginBottom:T=!1}=r,{theme:k=null}=r,{themeOverrides:z=null}=r,{background:A=null}=r;return c.$$set=R=>{"id"in R&&a(0,n=R.id),"cls"in R&&a(1,g=R.cls),"width"in R&&a(2,v=R.width),"height"in R&&a(3,E=R.height),"marginTop"in R&&a(4,S=R.marginTop),"marginBottom"in R&&a(5,T=R.marginBottom),"theme"in R&&a(6,k=R.theme),"themeOverrides"in R&&a(7,z=R.themeOverrides),"background"in R&&a(8,A=R.background),"$$scope"in R&&a(12,d=R.$$scope)},c.$$.update=()=>{c.$$.dirty&321&&a(10,l=n&&!(k||A)?n:null),c.$$.dirty&322&&a(9,u=g&&!(k||A)?g:"")},[n,g,v,E,S,T,k,z,A,u,l,f,d]}class Wo extends $i{constructor(r){super(),ji(this,r,b1,v1,Fi,{id:0,cls:1,width:2,height:3,marginTop:4,marginBottom:5,theme:6,themeOverrides:7,background:8})}}var $o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ku(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function sm(c,r,a){const l=c.slice();return l[5]=r[a],l}function w1(c){let r=c[5].label+"",a;return{c(){a=Ut(r)},l(l){a=Vt(l,r)},m(l,u){Ze(l,a,u)},p(l,u){u&1&&r!==(r=l[5].label+"")&&bi(a,r)},d(l){l&&J(a)}}}function x1(c){let r,a=c[5].label+"",l,u;return{c(){r=$e("a"),l=Ut(a),this.h()},l(f){r=je(f,"A",{class:!0,href:!0});var d=et(r);l=Vt(d,a),d.forEach(J),this.h()},h(){_e(r,"class","ons-breadcrumb__link"),_e(r,"href",u=c[5].href)},m(f,d){Ze(f,r,d),ze(r,l)},p(f,d){d&1&&a!==(a=f[5].label+"")&&bi(l,a),d&1&&u!==(u=f[5].href)&&_e(r,"href",u)},d(f){f&&J(r)}}}function am(c){let r,a,l,u,f;function d(v,E){return v[5].href?x1:w1}let n=d(c),g=n(c);return{c(){r=$e("li"),g.c(),a=mt(),l=da("svg"),u=da("path"),f=mt(),this.h()},l(v){r=je(v,"LI",{class:!0});var E=et(r);g.l(E),a=gt(E),l=pa(E,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0});var S=et(l);u=pa(S,"path",{d:!0,transform:!0}),et(u).forEach(J),S.forEach(J),f=gt(E),E.forEach(J),this.h()},h(){_e(u,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),_e(u,"transform","translate(-5.02 -1.59)"),_e(l,"class","ons-svg-icon svelte-w4p0hu"),_e(l,"viewBox","0 0 8 13"),_e(l,"xmlns","http://www.w3.org/2000/svg"),_e(l,"focusable","false"),_e(r,"class","ons-breadcrumb__item ons-u-p-no")},m(v,E){Ze(v,r,E),g.m(r,null),ze(r,a),ze(r,l),ze(l,u),ze(r,f)},p(v,E){n===(n=d(v))&&g?g.p(v,E):(g.d(1),g=n(v),g&&(g.c(),g.m(r,a)))},d(v){v&&J(r),g.d()}}}function E1(c){let r,a,l=Pi(c[0]),u=[];for(let f=0;f<l.length;f+=1)u[f]=am(sm(c,l,f));return{c(){r=$e("nav"),a=$e("ol");for(let f=0;f<u.length;f+=1)u[f].c();this.h()},l(f){r=je(f,"NAV",{class:!0,"aria-label":!0});var d=et(r);a=je(d,"OL",{class:!0});var n=et(a);for(let g=0;g<u.length;g+=1)u[g].l(n);n.forEach(J),d.forEach(J),this.h()},h(){_e(a,"class","ons-breadcrumb__items ons-u-fs-s"),_e(r,"class","ons-breadcrumb print--hide"),_e(r,"aria-label","Breadcrumbs")},m(f,d){Ze(f,r,d),ze(r,a);for(let n=0;n<u.length;n+=1)u[n]&&u[n].m(a,null)},p(f,d){if(d&1){l=Pi(f[0]);let n;for(n=0;n<l.length;n+=1){const g=sm(f,l,n);u[n]?u[n].p(g,d):(u[n]=am(g),u[n].c(),u[n].m(a,null))}for(;n<u.length;n+=1)u[n].d(1);u.length=l.length}},d(f){f&&J(r),Pr(u,f)}}}function S1(c){let r,a;return r=new Wo({props:{theme:c[2],themeOverrides:c[3],width:c[1],background:c[4],$$slots:{default:[E1]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,[u]){const f={};u&4&&(f.theme=l[2]),u&8&&(f.themeOverrides=l[3]),u&2&&(f.width=l[1]),u&16&&(f.background=l[4]),u&257&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function k1(c,r,a){let{links:l=[]}=r,{width:u="wide"}=r,{theme:f=null}=r,{themeOverrides:d=null}=r,{background:n=null}=r;return c.$$set=g=>{"links"in g&&a(0,l=g.links),"width"in g&&a(1,u=g.width),"theme"in g&&a(2,f=g.theme),"themeOverrides"in g&&a(3,d=g.themeOverrides),"background"in g&&a(4,n=g.background)},[l,u,f,d,n]}class T1 extends $i{constructor(r){super(),ji(this,r,k1,S1,Fi,{links:0,width:1,theme:2,themeOverrides:3,background:4})}}function om(c){let r,a;return{c(){r=$e("h2"),a=Ut(c[3]),this.h()},l(l){r=je(l,"H2",{class:!0});var u=et(r);a=Vt(u,c[3]),u.forEach(J),this.h()},h(){_e(r,"class","section-title"),Ht(r,"ons-u-vh",c[4])},m(l,u){Ze(l,r,u),ze(r,a)},p(l,u){u&8&&bi(a,l[3]),u&16&&Ht(r,"ons-u-vh",l[4])},d(l){l&&J(r)}}}function C1(c){let r,a,l,u=c[3]&&om(c);const f=c[18].default,d=Tr(f,c,c[20],null);return{c(){u&&u.c(),r=mt(),a=$e("div"),d&&d.c(),this.h()},l(n){u&&u.l(n),r=gt(n),a=je(n,"DIV",{class:!0});var g=et(a);d&&d.l(g),g.forEach(J),this.h()},h(){_e(a,"class","grid "+c[12]+" svelte-1og4gya"),Ft(a,"grid-gap",c[14]),Ft(a,"min-height",c[13])},m(n,g){u&&u.m(n,g),Ze(n,r,g),Ze(n,a,g),d&&d.m(a,null),l=!0},p(n,g){n[3]?u?u.p(n,g):(u=om(n),u.c(),u.m(r.parentNode,r)):u&&(u.d(1),u=null),d&&d.p&&(!l||g&1048576)&&Cr(d,f,n,n[20],l?Ar(f,n[20],g,null):Ir(n[20]),null)},i(n){l||(Ye(d,n),l=!0)},o(n){st(d,n),l=!1},d(n){n&&(J(r),J(a)),u&&u.d(n),d&&d.d(n)}}}function lm(c){let r,a,l;return a=new Wo({props:{cls:c[1],theme:c[5],themeOverrides:c[6],width:"narrow",marginBottom:c[8],$$slots:{default:[I1]},$$scope:{ctx:c}}}),{c(){r=$e("figcaption"),ii(a.$$.fragment),this.h()},l(u){r=je(u,"FIGCAPTION",{class:!0});var f=et(r);si(a.$$.fragment,f),f.forEach(J),this.h()},h(){_e(r,"class","svelte-1og4gya")},m(u,f){Ze(u,r,f),ri(a,r,null),l=!0},p(u,f){const d={};f&2&&(d.cls=u[1]),f&32&&(d.theme=u[5]),f&64&&(d.themeOverrides=u[6]),f&256&&(d.marginBottom=u[8]),f&1049088&&(d.$$scope={dirty:f,ctx:u}),a.$set(d)},i(u){l||(Ye(a.$$.fragment,u),l=!0)},o(u){st(a.$$.fragment,u),l=!1},d(u){u&&J(r),ni(a)}}}function I1(c){let r,a;return{c(){r=$e("span"),a=new $u(!1),this.h()},l(l){r=je(l,"SPAN",{class:!0});var u=et(r);a=ju(u,!1),u.forEach(J),this.h()},h(){a.a=null,_e(r,"class","ons-figure__caption")},m(l,u){Ze(l,r,u),a.m(c[9],r)},p(l,u){u&512&&a.p(l[9])},d(l){l&&J(r)}}}function A1(c){let r,a,l,u,f;a=new Wo({props:{id:c[0],cls:c[1],theme:c[5],themeOverrides:c[6],width:c[2],height:["tall","full"].includes(c[10])?c[10]:"auto",marginTop:c[7],marginBottom:c[9]?!1:c[8],$$slots:{default:[C1]},$$scope:{ctx:c}}});let d=c[9]&&lm(c);return{c(){r=$e("figure"),ii(a.$$.fragment),l=mt(),d&&d.c(),this.h()},l(n){r=je(n,"FIGURE",{"aria-label":!0,class:!0});var g=et(r);si(a.$$.fragment,g),l=gt(g),d&&d.l(g),g.forEach(J),this.h()},h(){_e(r,"aria-label",c[9]),_e(r,"class","svelte-1og4gya"),I_(()=>c[19].call(r))},m(n,g){Ze(n,r,g),ri(a,r,null),ze(r,l),d&&d.m(r,null),u=A_(r,c[19].bind(r)),f=!0},p(n,[g]){const v={};g&1&&(v.id=n[0]),g&2&&(v.cls=n[1]),g&32&&(v.theme=n[5]),g&64&&(v.themeOverrides=n[6]),g&4&&(v.width=n[2]),g&1024&&(v.height=["tall","full"].includes(n[10])?n[10]:"auto"),g&128&&(v.marginTop=n[7]),g&768&&(v.marginBottom=n[9]?!1:n[8]),g&1048600&&(v.$$scope={dirty:g,ctx:n}),a.$set(v),n[9]?d?(d.p(n,g),g&512&&Ye(d,1)):(d=lm(n),d.c(),Ye(d,1),d.m(r,null)):d&&(Ni(),st(d,1,1,()=>{d=null}),Ui()),(!f||g&512)&&_e(r,"aria-label",n[9])},i(n){f||(Ye(a.$$.fragment,n),Ye(d),f=!0)},o(n){st(a.$$.fragment,n),st(d),f=!1},d(n){n&&J(r),ni(a),d&&d.d(),u()}}}function P1(c,r,a){let l,{$$slots:u={},$$scope:f}=r,{id:d=null}=r,{cls:n=null}=r,{width:g="medium"}=r,{title:v=""}=r,{hideTitle:E=!1}=r,{theme:S=null}=r,{themeOverrides:T=null}=r,{marginTop:k=!1}=r,{marginBottom:z=!0}=r,{colwidth:A="medium"}=r,{caption:R=""}=r,{height:D=200}=r,{gap:F=12}=r,q=!A||A==="full"?"":`grid-${A}`,ee=D==="full"?"100vh":Number.isNaN(D)?D:D+"px",ie=Number.isNaN(F)?F:F+"px";const ne={narrow:{w:180,c:4},medium:{w:280,c:3},wide:{w:400,c:2},full:{w:"100%",c:1}};let se;const ue=M_(ne[A].c);Za("cols",ue);function Ce(){se=this.clientWidth,a(11,se)}return c.$$set=ye=>{"id"in ye&&a(0,d=ye.id),"cls"in ye&&a(1,n=ye.cls),"width"in ye&&a(2,g=ye.width),"title"in ye&&a(3,v=ye.title),"hideTitle"in ye&&a(4,E=ye.hideTitle),"theme"in ye&&a(5,S=ye.theme),"themeOverrides"in ye&&a(6,T=ye.themeOverrides),"marginTop"in ye&&a(7,k=ye.marginTop),"marginBottom"in ye&&a(8,z=ye.marginBottom),"colwidth"in ye&&a(15,A=ye.colwidth),"caption"in ye&&a(9,R=ye.caption),"height"in ye&&a(10,D=ye.height),"gap"in ye&&a(16,F=ye.gap),"$$scope"in ye&&a(20,f=ye.$$scope)},c.$$.update=()=>{c.$$.dirty&100352&&a(17,l=A=="full"?1:se?Math.floor((se+F)/(ne[A].w+F)):ne[A].c),c.$$.dirty&131072&&ue.set(l)},[d,n,g,v,E,S,T,k,z,R,D,se,q,ee,ie,A,F,l,u,Ce,f]}class z1 extends $i{constructor(r){super(),ji(this,r,P1,A1,Fi,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:15,caption:9,height:10,gap:16})}}function M1(c){let r;const a=c[13].default,l=Tr(a,c,c[14],null);return{c(){l&&l.c()},l(u){l&&l.l(u)},m(u,f){l&&l.m(u,f),r=!0},p(u,f){l&&l.p&&(!r||f&16384)&&Cr(l,a,u,u[14],r?Ar(a,u[14],f,null):Ir(u[14]),null)},i(u){r||(Ye(l,u),r=!0)},o(u){st(l,u),r=!1},d(u){l&&l.d(u)}}}function D1(c){let r,a;return r=new z1({props:{id:c[0],cls:c[1],width:c[2],height:c[10],title:c[3],hideTitle:c[4],theme:c[5],themeOverrides:c[6],marginTop:c[7],marginBottom:c[8],colwidth:c[9],gap:c[11],$$slots:{default:[M1]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,[u]){const f={};u&1&&(f.id=l[0]),u&2&&(f.cls=l[1]),u&4&&(f.width=l[2]),u&1024&&(f.height=l[10]),u&8&&(f.title=l[3]),u&16&&(f.hideTitle=l[4]),u&32&&(f.theme=l[5]),u&64&&(f.themeOverrides=l[6]),u&128&&(f.marginTop=l[7]),u&256&&(f.marginBottom=l[8]),u&512&&(f.colwidth=l[9]),u&2048&&(f.gap=l[11]),u&16384&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function L1(c,r,a){let{$$slots:l={},$$scope:u}=r,{id:f=null}=r,{cls:d="ons-cards"}=r,{width:n="wide"}=r,{title:g=""}=r,{hideTitle:v=!1}=r,{theme:E=null}=r,{themeOverrides:S=null}=r,{marginTop:T=!1}=r,{marginBottom:k=!0}=r,{colwidth:z="medium"}=r,{height:A=200}=r,{noBackground:R=!1}=r,{gap:D=R?36:16}=r;return Za("noBackground",R),c.$$set=F=>{"id"in F&&a(0,f=F.id),"cls"in F&&a(1,d=F.cls),"width"in F&&a(2,n=F.width),"title"in F&&a(3,g=F.title),"hideTitle"in F&&a(4,v=F.hideTitle),"theme"in F&&a(5,E=F.theme),"themeOverrides"in F&&a(6,S=F.themeOverrides),"marginTop"in F&&a(7,T=F.marginTop),"marginBottom"in F&&a(8,k=F.marginBottom),"colwidth"in F&&a(9,z=F.colwidth),"height"in F&&a(10,A=F.height),"noBackground"in F&&a(12,R=F.noBackground),"gap"in F&&a(11,D=F.gap),"$$scope"in F&&a(14,u=F.$$scope)},[f,d,n,g,v,E,S,T,k,z,A,D,R,l,u]}class Rf extends $i{constructor(r){super(),ji(this,r,L1,D1,Fi,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,marginTop:7,marginBottom:8,colwidth:9,height:10,noBackground:12,gap:11})}}const cm=()=>Math.random().toString(16).slice(2,8),wf=(c,r=!1)=>typeof c=="string"?c.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").concat(r?`-${cm()}`:""):cm(),R1=c=>{if(!c)return!1;const r=new Date(c);return!isNaN(r)},um=(c,r="en-GB",a={year:"numeric",month:"long",day:"2-digit"})=>new Date(c).toLocaleDateString(r,a);function B1(c){let r,a;return{c(){r=$e("h3"),a=Ut(c[0]),this.h()},l(l){r=je(l,"H3",{class:!0});var u=et(r);a=Vt(u,c[0]),u.forEach(J),this.h()},h(){_e(r,"class","ons-card__title ons-u-fs-m"),Ht(r,"ons-u-vh",c[2]),Ft(r,"padding",c[8]?"":"8px 16px 0"),Ft(r,"margin-bottom","5px")},m(l,u){Ze(l,r,u),ze(r,a)},p(l,u){u&1&&bi(a,l[0]),u&4&&Ht(r,"ons-u-vh",l[2]),u&256&&Ft(r,"padding",l[8]?"":"8px 16px 0")},d(l){l&&J(r)}}}function O1(c){let r,a,l,u,f=c[3]&&hm(c);return{c(){r=$e("a"),f&&f.c(),a=mt(),l=$e("h3"),u=Ut(c[0]),this.h()},l(d){r=je(d,"A",{href:!0,class:!0});var n=et(r);f&&f.l(n),a=gt(n),l=je(n,"H3",{class:!0});var g=et(l);u=Vt(g,c[0]),g.forEach(J),n.forEach(J),this.h()},h(){_e(l,"class","ons-card__title ons-u-fs-m"),Ft(l,"padding",!c[8]&&!c[3]?"12px 16px 0":c[8]?"":"0 16px"),_e(r,"href",c[5]),_e(r,"class","ons-card__link ons-u-db"),Ht(r,"ons-u-vh",c[2])},m(d,n){Ze(d,r,n),f&&f.m(r,null),ze(r,a),ze(r,l),ze(l,u)},p(d,n){d[3]?f?f.p(d,n):(f=hm(d),f.c(),f.m(r,a)):f&&(f.d(1),f=null),n&1&&bi(u,d[0]),n&264&&Ft(l,"padding",!d[8]&&!d[3]?"12px 16px 0":d[8]?"":"0 16px"),n&32&&_e(r,"href",d[5]),n&4&&Ht(r,"ons-u-vh",d[2])},d(d){d&&J(r),f&&f.d()}}}function hm(c){let r,a;return{c(){r=$e("img"),this.h()},l(l){r=je(l,"IMG",{class:!0,src:!0,alt:!0,loading:!0}),this.h()},h(){_e(r,"class","ons-card__image ons-u-mb-s svelte-1s3ctdj"),Qp(r.src,a=c[3])||_e(r,"src",a),_e(r,"alt",c[4]),_e(r,"loading","lazy"),Ft(r,"width","100%")},m(l,u){Ze(l,r,u)},p(l,u){u&8&&!Qp(r.src,a=l[3])&&_e(r,"src",a),u&16&&_e(r,"alt",l[4])},d(l){l&&J(r)}}}function F1(c){let r,a,l,u,f,d,n,g=`span ${c[9]&&c[10]<3?c[10]:c[6]==1?1:c[6]>c[10]?c[10]:c[6]}`,v;function E(A,R){if(A[5]&&A[0])return O1;if(A[0])return B1}let S=E(c),T=S&&S(c);const k=c[13].default,z=Tr(k,c,c[12],null);return{c(){r=$e("div"),a=$e("div"),T&&T.c(),l=mt(),u=$e("div"),z&&z.c(),this.h()},l(A){r=je(A,"DIV",{class:!0});var R=et(r);a=je(R,"DIV",{id:!0,class:!0,"aria-describedby":!0});var D=et(a);T&&T.l(D),l=gt(D),u=je(D,"DIV",{id:!0,class:!0});var F=et(u);z&&z.l(F),F.forEach(J),D.forEach(J),R.forEach(J),this.h()},h(){_e(u,"id",f=c[1]+"_text"),_e(u,"class","svelte-1s3ctdj"),Ht(u,"tile__body",!c[8]),_e(a,"id",c[1]),_e(a,"class","ons-card"),_e(a,"aria-describedby",d=c[1]+"_text"),_e(r,"class",n=dc(c[8]?"":"tile tile__content")+" svelte-1s3ctdj"),Ft(r,"grid-column",g),Ft(r,"grid-column-end",c[9]?c[10]+1:null),Ft(r,"grid-row",c[7]>1?`span ${c[7]}`:null)},m(A,R){Ze(A,r,R),ze(r,a),T&&T.m(a,null),ze(a,l),ze(a,u),z&&z.m(u,null),v=!0},p(A,[R]){S===(S=E(A))&&T?T.p(A,R):(T&&T.d(1),T=S&&S(A),T&&(T.c(),T.m(a,l))),z&&z.p&&(!v||R&4096)&&Cr(z,k,A,A[12],v?Ar(k,A[12],R,null):Ir(A[12]),null),(!v||R&2&&f!==(f=A[1]+"_text"))&&_e(u,"id",f),(!v||R&256)&&Ht(u,"tile__body",!A[8]),(!v||R&2)&&_e(a,"id",A[1]),(!v||R&2&&d!==(d=A[1]+"_text"))&&_e(a,"aria-describedby",d),(!v||R&256&&n!==(n=dc(A[8]?"":"tile tile__content")+" svelte-1s3ctdj"))&&_e(r,"class",n),R&1600&&g!==(g=`span ${A[9]&&A[10]<3?A[10]:A[6]==1?1:A[6]>A[10]?A[10]:A[6]}`)&&Ft(r,"grid-column",g),R&1536&&Ft(r,"grid-column-end",A[9]?A[10]+1:null),R&128&&Ft(r,"grid-row",A[7]>1?`span ${A[7]}`:null)},i(A){v||(Ye(z,A),v=!0)},o(A){st(z,A),v=!1},d(A){A&&J(r),T&&T.d(),z&&z.d(A)}}}function N1(c,r,a){let l,{$$slots:u={},$$scope:f}=r,{title:d=null}=r,{id:n=wf(d)}=r,{hideTitle:g=!1}=r,{image:v=null}=r,{imageAlt:E=null}=r,{href:S=null}=r,{colspan:T=1}=r,{rowspan:k=1}=r,{noBackground:z=Ga("noBackground")||!1}=r,{grow:A=!1}=r;const R=Ga("cols");return qu(c,R,D=>a(10,l=D)),c.$$set=D=>{"title"in D&&a(0,d=D.title),"id"in D&&a(1,n=D.id),"hideTitle"in D&&a(2,g=D.hideTitle),"image"in D&&a(3,v=D.image),"imageAlt"in D&&a(4,E=D.imageAlt),"href"in D&&a(5,S=D.href),"colspan"in D&&a(6,T=D.colspan),"rowspan"in D&&a(7,k=D.rowspan),"noBackground"in D&&a(8,z=D.noBackground),"grow"in D&&a(9,A=D.grow),"$$scope"in D&&a(12,f=D.$$scope)},[d,n,g,v,E,S,T,k,z,A,l,R,f,u]}class Ts extends $i{constructor(r){super(),ji(this,r,N1,F1,Fi,{title:0,id:1,hideTitle:2,image:3,imageAlt:4,href:5,colspan:6,rowspan:7,noBackground:8,grow:9})}}function fm(c){let r,a="!";return{c(){r=$e("div"),r.textContent=a,this.h()},l(l){r=je(l,"DIV",{class:!0,"aria-hidden":!0,"data-svelte-h":!0}),lr(r)!=="svelte-z0ta1j"&&(r.textContent=a),this.h()},h(){_e(r,"class","ons-panel__icon"),_e(r,"aria-hidden","true")},m(l,u){Ze(l,r,u)},d(l){l&&J(r)}}}function dm(c){let r,a,l;return{c(){r=$e("p"),a=$e("strong"),l=Ut(c[0])},l(u){r=je(u,"P",{});var f=et(r);a=je(f,"STRONG",{});var d=et(a);l=Vt(d,c[0]),d.forEach(J),f.forEach(J)},m(u,f){Ze(u,r,f),ze(r,a),ze(a,l)},p(u,f){f&1&&bi(l,u[0])},d(u){u&&J(r)}}}function U1(c){let r,a,l,u,f=c[1]==="warning"?"Warning:":"Important information:",d,n,g,v,E,S,T,k=c[2]&&fm(),z=c[0]&&dm(c);const A=c[5].default,R=Tr(A,c,c[4],null);return{c(){r=$e("div"),a=$e("div"),k&&k.c(),l=mt(),u=$e("span"),d=Ut(f),n=mt(),g=$e("div"),v=$e("div"),z&&z.c(),E=mt(),R&&R.c(),this.h()},l(D){r=je(D,"DIV",{class:!0,style:!0});var F=et(r);a=je(F,"DIV",{class:!0});var q=et(a);k&&k.l(q),l=gt(q),u=je(q,"SPAN",{class:!0});var ee=et(u);d=Vt(ee,f),ee.forEach(J),n=gt(q),g=je(q,"DIV",{class:!0});var ie=et(g);v=je(ie,"DIV",{class:!0});var ne=et(v);z&&z.l(ne),E=gt(ne),R&&R.l(ne),ne.forEach(J),ie.forEach(J),q.forEach(J),F.forEach(J),this.h()},h(){_e(u,"class","ons-panel__assistive-text ons-u-vh"),_e(v,"class","default-line-height"),Ht(v,"ons-u-fs-r",c[1]!=="warning"),_e(g,"class","ons-panel__body"),_e(a,"class","ons-u-bg--tr"),Ht(a,"ons-panel--warn",c[2]&&c[1]!=="warning"),_e(r,"class",S="ons-panel "+(c[1]==="warning"?"ons-panel--warn":"ons-panel--info")+" ons-panel--no-title svelte-1l6efpg"),_e(r,"style",c[3])},m(D,F){Ze(D,r,F),ze(r,a),k&&k.m(a,null),ze(a,l),ze(a,u),ze(u,d),ze(a,n),ze(a,g),ze(g,v),z&&z.m(v,null),ze(v,E),R&&R.m(v,null),T=!0},p(D,[F]){D[2]?k||(k=fm(),k.c(),k.m(a,l)):k&&(k.d(1),k=null),(!T||F&2)&&f!==(f=D[1]==="warning"?"Warning:":"Important information:")&&bi(d,f),D[0]?z?z.p(D,F):(z=dm(D),z.c(),z.m(v,E)):z&&(z.d(1),z=null),R&&R.p&&(!T||F&16)&&Cr(R,A,D,D[4],T?Ar(A,D[4],F,null):Ir(D[4]),null),(!T||F&2)&&Ht(v,"ons-u-fs-r",D[1]!=="warning"),(!T||F&6)&&Ht(a,"ons-panel--warn",D[2]&&D[1]!=="warning"),(!T||F&2&&S!==(S="ons-panel "+(D[1]==="warning"?"ons-panel--warn":"ons-panel--info")+" ons-panel--no-title svelte-1l6efpg"))&&_e(r,"class",S),(!T||F&8)&&_e(r,"style",D[3])},i(D){T||(Ye(R,D),T=!0)},o(D){st(R,D),T=!1},d(D){D&&J(r),k&&k.d(),z&&z.d(),R&&R.d(D)}}}function V1(c,r,a){let l,{$$slots:u={},$$scope:f}=r,{title:d=null}=r,{mode:n="info"}=r,{important:g=n==="warning"}=r;return c.$$set=v=>{"title"in v&&a(0,d=v.title),"mode"in v&&a(1,n=v.mode),"important"in v&&a(2,g=v.important),"$$scope"in v&&a(4,f=v.$$scope)},c.$$.update=()=>{c.$$.dirty&2&&a(3,l=n==="success"?"background: var(--ons-color-success-tint); border-color: var(--ons-color-success);":n==="pending"?"background: var(--ons-color-pending-tint); border-color: var(--ons-color-pending);":n==="error"?"background: var(--ons-color-errors-tint); border-color: var(--ons-color-errors);":null)},[d,n,g,l,f,u]}class R_ extends $i{constructor(r){super(),ji(this,r,V1,U1,Fi,{title:0,mode:1,important:2})}}function pm(c){let r,a;return{c(){r=$e("h2"),a=Ut(c[3]),this.h()},l(l){r=je(l,"H2",{class:!0});var u=et(r);a=Vt(u,c[3]),u.forEach(J),this.h()},h(){_e(r,"class","section-title"),Ht(r,"ons-u-vh",c[4])},m(l,u){Ze(l,r,u),ze(r,a)},p(l,u){u&8&&bi(a,l[3]),u&16&&Ht(r,"ons-u-vh",l[4])},d(l){l&&J(r)}}}function $1(c){let r,a,l,u=c[3]&&pm(c);const f=c[10].default,d=Tr(f,c,c[11],null);return{c(){r=$e("section"),u&&u.c(),a=mt(),d&&d.c(),this.h()},l(n){r=je(n,"SECTION",{"aria-label":!0,class:!0});var g=et(r);u&&u.l(g),a=gt(g),d&&d.l(g),g.forEach(J),this.h()},h(){_e(r,"aria-label",c[3]),_e(r,"class","ons-feature__section")},m(n,g){Ze(n,r,g),u&&u.m(r,null),ze(r,a),d&&d.m(r,null),l=!0},p(n,g){n[3]?u?u.p(n,g):(u=pm(n),u.c(),u.m(r,a)):u&&(u.d(1),u=null),d&&d.p&&(!l||g&2048)&&Cr(d,f,n,n[11],l?Ar(f,n[11],g,null):Ir(n[11]),null),(!l||g&8)&&_e(r,"aria-label",n[3])},i(n){l||(Ye(d,n),l=!0)},o(n){st(d,n),l=!1},d(n){n&&J(r),u&&u.d(),d&&d.d(n)}}}function j1(c){let r,a;return r=new Wo({props:{id:c[0]?c[0]:wf(c[3]),cls:c[1],theme:c[5],themeOverrides:c[6],width:c[2],marginTop:c[8],marginBottom:c[9],background:c[7],$$slots:{default:[$1]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,[u]){const f={};u&9&&(f.id=l[0]?l[0]:wf(l[3])),u&2&&(f.cls=l[1]),u&32&&(f.theme=l[5]),u&64&&(f.themeOverrides=l[6]),u&4&&(f.width=l[2]),u&256&&(f.marginTop=l[8]),u&512&&(f.marginBottom=l[9]),u&128&&(f.background=l[7]),u&2072&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function q1(c,r,a){let{$$slots:l={},$$scope:u}=r,{id:f=null}=r,{cls:d=null}=r,{width:n="narrow"}=r,{title:g=""}=r,{hideTitle:v=!1}=r,{theme:E=null}=r,{themeOverrides:S=null}=r,{background:T=null}=r,{marginTop:k=!1}=r,{marginBottom:z=!0}=r;return c.$$set=A=>{"id"in A&&a(0,f=A.id),"cls"in A&&a(1,d=A.cls),"width"in A&&a(2,n=A.width),"title"in A&&a(3,g=A.title),"hideTitle"in A&&a(4,v=A.hideTitle),"theme"in A&&a(5,E=A.theme),"themeOverrides"in A&&a(6,S=A.themeOverrides),"background"in A&&a(7,T=A.background),"marginTop"in A&&a(8,k=A.marginTop),"marginBottom"in A&&a(9,z=A.marginBottom),"$$scope"in A&&a(11,u=A.$$scope)},[f,d,n,g,v,E,S,T,k,z,l,u]}class mm extends $i{constructor(r){super(),ji(this,r,q1,j1,Fi,{id:0,cls:1,width:2,title:3,hideTitle:4,theme:5,themeOverrides:6,background:7,marginTop:8,marginBottom:9})}}function Z1(c){let r,a,l,u,f,d,n,g=`<svg class="ons-svg-icon ons-svg-icon--xxl svelte-w4p0hu" id="icon-facebook" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true"><path d="M32,16.0986285 C32.0009185,7.5342974 25.337417,0.468462963 16.8372092,0.0203294753 C8.33700136,-0.427804013
      0.97607758,5.89865855 0.0874346352,14.4161886 C-0.801208309,22.9337186 5.09355054,30.6602611 13.5009524,31.9979281
      L13.5009524,20.7518951 L9.44,20.7518951 L9.44,16.0986285 L13.5009524,16.0986285 L13.5009524,12.549267
      C13.5009524,8.5169471 15.8857143,6.28613892 19.5428571,6.28613892 C20.742535,6.30277426 21.9393895,6.40782423
      23.1238095,6.60044523 L23.1238095,10.5637711 L21.1047619,10.5637711 C19.1161905,10.5637711 18.4990476,11.8056643
      18.4990476,13.0782216 L18.4990476,16.0986285 L22.9409524,16.0986285 L22.2247619,20.7518951 L18.4990476,20.7518951
      L18.4990476,31.9979281 C26.2735701,30.760956 31.9991507,24.0182672 32,16.0986285 L32,16.0986285 Z"></path></svg>`,v,E,S,T,k="this link will open in a new tab",z,A,R,D,F='<svg class="ons-svg-icon ons-svg-icon--xxl svelte-w4p0hu" id="icon-twitter" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true"><path d="M24.04,12.95c0,0.17,0,0.33,0,0.5c0.01,4.01-2.17,7.71-5.69,9.64c-3.52,1.93-7.81,1.78-11.19-0.38c0.31,0.04,0.61,0.05,0.92,0.05c1.73,0,3.42-0.58,4.78-1.65c-1.65-0.04-3.09-1.11-3.6-2.68c0.25,0.05,0.51,0.07,0.76,0.07c0.34,0,0.68-0.05,1.01-0.14C9.23,18,7.93,16.4,7.95,14.55v-0.05c0.54,0.29,1.13,0.46,1.74,0.48c-1.66-1.12-2.2-3.33-1.23-5.08c1.96,2.41,4.85,3.87,7.95,4.03c-0.07-0.29-0.1-0.58-0.1-0.88c0-1.58,0.97-3,2.44-3.59c1.47-0.58,3.15-0.21,4.23,0.94c0.86-0.17,1.69-0.49,2.45-0.94c-0.28,0.9-0.88,1.65-1.69,2.13c0.76-0.09,1.51-0.29,2.21-0.6C25.43,11.76,24.79,12.42,24.04,12.95zM16,0C7.16,0,0,7.16,0,16s7.16,16,16,16s16-7.16,16-16c0-4.24-1.69-8.31-4.69-11.31S20.24,0,16,0z"></path></svg>',q,ee,ie,ne,se="this link will open in a new tab",ue,Ce,ye,Xe,ae=`<svg class="ons-svg-icon ons-svg-icon--xxl svelte-w4p0hu" id="icon-linkedin" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true"><path d="M16,-3.41060513e-13 C20.2434638,-3.41060513e-13 24.3131264,1.68570945 27.3137085,4.6862915 C30.3142906,7.68687356
          32,11.7565362 32,16 C32,24.836556 24.836556,32 16,32 C7.163444,32 0,24.836556 0,16 C0,7.163444 7.163444,-3.41060513e-13
          16,-3.41060513e-13 Z M11.3505859,12.4641113 L7.45385744,12.4641113 L7.45385744,24.1875 L11.3505859,24.1875
          L11.3505859,12.4641113 Z M20.9152832,12.1889649 C18.8479004,12.1889649 17.9213867,13.3251953 17.4035644,14.1240234
          L17.4035644,14.1240234 L17.4035644,12.4641113 L13.5070801,12.4641113 C13.5212538,12.7696262 13.5275532,13.809993
          13.5292593,15.1533871 L13.5293118,16.8832762 C13.5292156,16.9843911 13.5291048,17.0860852 13.5289803,17.1882303
          L13.5280782,17.8054916 L13.5280782,17.8054916 L13.5268961,18.427439 C13.5216699,20.9164121 13.5108442,23.3704557
          13.5078578,24.0208157 L13.5070801,24.1875 L17.4035644,24.1875 L17.4035644,17.640625 C17.4035644,17.2902832
          17.4287109,16.9401856 17.5317382,16.6896972 C17.8134766,15.9897461 18.4545899,15.2646484 19.5310059,15.2646484
          C20.940918,15.2646484 21.5051269,16.3395996 21.5051269,17.9157715 L21.5051269,17.9157715 L21.5051269,24.1875
          L25.4013672,24.1875 L25.4013672,17.465332 C25.4013672,13.8645019 23.4790039,12.1889649 20.9152832,12.1889649 Z
          M9.42822263,6.8125 C8.09521488,6.8125 7.22363281,7.68774412 7.22363281,8.83813475 C7.22363281,9.96313475
          8.06933594,10.8632812 9.37695313,10.8632812 L9.37695313,10.8632812 L9.40234375,10.8632812 C10.7612305,10.8632812
          11.6069336,9.96313475 11.6069336,8.83813475 C11.581543,7.68774412 10.7612305,6.8125 9.42822263,6.8125 Z"></path></svg>`,Le,Z,tt,$t,ft="this link will open in a new tab",Jt,ut,at,le,Ee=`<svg class="ons-svg-icon ons-svg-icon--xxl svelte-w4p0hu" id="icon-email" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M30.7279 5.27208C27.3523 1.89642 22.7739 0 18 0C8.05887 0 0 8.05887 0 18C0 27.9411 8.05887 36 18 36C27.9411 36 36
              27.9411 36 18C36 13.2261 34.1036 8.64773 30.7279 5.27208ZM18 19L26 14V12L18 17L10 12V14L18 19ZM8 10H28V26H8V10Z"></path></svg>`,Re,Q,he,it,Ct="this link will open in a new tab",bt;return{c(){r=$e("section"),a=$e("h2"),l=Ut(c[0]),u=mt(),f=$e("ul"),d=$e("li"),n=$e("span"),n.innerHTML=g,v=mt(),E=$e("a"),S=Ut("Facebook"),T=$e("span"),T.textContent=k,A=mt(),R=$e("li"),D=$e("span"),D.innerHTML=F,q=mt(),ee=$e("a"),ie=Ut("Twitter"),ne=$e("span"),ne.textContent=se,Ce=mt(),ye=$e("li"),Xe=$e("span"),Xe.innerHTML=ae,Le=mt(),Z=$e("a"),tt=Ut("LinkedIn"),$t=$e("span"),$t.textContent=ft,ut=mt(),at=$e("li"),le=$e("span"),le.innerHTML=Ee,Re=mt(),Q=$e("a"),he=Ut("Email"),it=$e("span"),it.textContent=Ct,this.h()},l(It){r=je(It,"SECTION",{class:!0,"aria-label":!0});var Bt=et(r);a=je(Bt,"H2",{class:!0});var Fe=et(a);l=Vt(Fe,c[0]),Fe.forEach(J),u=gt(Bt),f=je(Bt,"UL",{class:!0});var Se=et(f);d=je(Se,"LI",{class:!0});var ct=et(d);n=je(ct,"SPAN",{class:!0,"data-svelte-h":!0}),lr(n)!=="svelte-ywkcxu"&&(n.innerHTML=g),v=gt(ct),E=je(ct,"A",{href:!0,class:!0,target:!0,rel:!0});var N=et(E);S=Vt(N,"Facebook"),T=je(N,"SPAN",{class:!0,"data-svelte-h":!0}),lr(T)!=="svelte-1i77wdx"&&(T.textContent=k),N.forEach(J),ct.forEach(J),A=gt(Se),R=je(Se,"LI",{class:!0});var Je=et(R);D=je(Je,"SPAN",{class:!0,"data-svelte-h":!0}),lr(D)!=="svelte-7gfqv"&&(D.innerHTML=F),q=gt(Je),ee=je(Je,"A",{href:!0,class:!0,target:!0,rel:!0});var We=et(ee);ie=Vt(We,"Twitter"),ne=je(We,"SPAN",{class:!0,"data-svelte-h":!0}),lr(ne)!=="svelte-1i77wdx"&&(ne.textContent=se),We.forEach(J),Je.forEach(J),Ce=gt(Se),ye=je(Se,"LI",{class:!0});var we=et(ye);Xe=je(we,"SPAN",{class:!0,"data-svelte-h":!0}),lr(Xe)!=="svelte-dxqxbr"&&(Xe.innerHTML=ae),Le=gt(we),Z=je(we,"A",{href:!0,class:!0,target:!0,rel:!0});var me=et(Z);tt=Vt(me,"LinkedIn"),$t=je(me,"SPAN",{class:!0,"data-svelte-h":!0}),lr($t)!=="svelte-1i77wdx"&&($t.textContent=ft),me.forEach(J),we.forEach(J),ut=gt(Se),at=je(Se,"LI",{class:!0});var Ne=et(at);le=je(Ne,"SPAN",{class:!0,"data-svelte-h":!0}),lr(le)!=="svelte-1vk6k44"&&(le.innerHTML=Ee),Re=gt(Ne),Q=je(Ne,"A",{href:!0,class:!0,target:!0,rel:!0});var ht=et(Q);he=Vt(ht,"Email"),it=je(ht,"SPAN",{class:!0,"data-svelte-h":!0}),lr(it)!=="svelte-1i77wdx"&&(it.textContent=Ct),ht.forEach(J),Ne.forEach(J),Se.forEach(J),Bt.forEach(J),this.h()},h(){_e(a,"class","ons-u-fs-r--b ons-u-mb-xs"),_e(n,"class","ons-list__prefix"),_e(T,"class","ons-u-vh"),_e(E,"href",z="https://www.facebook.com/sharer/sharer.php?u="+c[6]),_e(E,"class","ons-list__link ons-u-fs-r ons-u-pt-xxs"),_e(E,"target","_blank"),_e(E,"rel","noreferrer external"),_e(d,"class","ons-list__item ons-u-pl-no ons-u-pr-xs"),_e(D,"class","ons-list__prefix"),_e(ne,"class","ons-u-vh"),_e(ee,"href",ue="https://twitter.com/intent/tweet?original_referer&text="+c[7]+"&url="+c[6]),_e(ee,"class","ons-list__link ons-u-fs-r ons-u-pt-xxs"),_e(ee,"target","_blank"),_e(ee,"rel","noreferrer external"),_e(R,"class","ons-list__item ons-u-pl-no ons-u-pr-xs"),_e(Xe,"class","ons-list__prefix"),_e($t,"class","ons-u-vh"),_e(Z,"href",Jt="https://www.linkedin.com/sharing/share-offsite/?url="+c[6]),_e(Z,"class","ons-list__link ons-u-fs-r ons-u-pt-xxs"),_e(Z,"target","_blank"),_e(Z,"rel","noreferrer external"),_e(ye,"class","ons-list__item ons-u-pl-no ons-u-pr-xs"),_e(le,"class","ons-list__prefix"),_e(it,"class","ons-u-vh"),_e(Q,"href",bt="mailto:?subject="+c[7]+"&body="+c[7]+"%0A"+c[6]),_e(Q,"class","ons-list__link ons-u-fs-r ons-u-pt-xxs"),_e(Q,"target","_blank"),_e(Q,"rel","noreferrer external"),_e(at,"class","ons-list__item ons-u-pl-no ons-u-pr-xs"),_e(f,"class","ons-list ons-list--inline ons-list--bare ons-list--icons"),_e(r,"class","ons-grid ons-u-ml-no"),_e(r,"aria-label","Share this dataset")},m(It,Bt){Ze(It,r,Bt),ze(r,a),ze(a,l),ze(r,u),ze(r,f),ze(f,d),ze(d,n),ze(d,v),ze(d,E),ze(E,S),ze(E,T),ze(f,A),ze(f,R),ze(R,D),ze(R,q),ze(R,ee),ze(ee,ie),ze(ee,ne),ze(f,Ce),ze(f,ye),ze(ye,Xe),ze(ye,Le),ze(ye,Z),ze(Z,tt),ze(Z,$t),ze(f,ut),ze(f,at),ze(at,le),ze(at,Re),ze(at,Q),ze(Q,he),ze(Q,it)},p(It,Bt){Bt&1&&bi(l,It[0]),Bt&64&&z!==(z="https://www.facebook.com/sharer/sharer.php?u="+It[6])&&_e(E,"href",z),Bt&192&&ue!==(ue="https://twitter.com/intent/tweet?original_referer&text="+It[7]+"&url="+It[6])&&_e(ee,"href",ue),Bt&64&&Jt!==(Jt="https://www.linkedin.com/sharing/share-offsite/?url="+It[6])&&_e(Z,"href",Jt),Bt&192&&bt!==(bt="mailto:?subject="+It[7]+"&body="+It[7]+"%0A"+It[6])&&_e(Q,"href",bt)},d(It){It&&J(r)}}}function G1(c){let r,a;return r=new Wo({props:{theme:c[2],themeOverrides:c[3],width:c[1],marginTop:c[4],marginBottom:c[5],$$slots:{default:[Z1]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,[u]){const f={};u&4&&(f.theme=l[2]),u&8&&(f.themeOverrides=l[3]),u&2&&(f.width=l[1]),u&16&&(f.marginTop=l[4]),u&32&&(f.marginBottom=l[5]),u&449&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function H1(c,r,a){let{title:l="Share this page"}=r,{width:u="narrow"}=r,{theme:f=null}=r,{themeOverrides:d=null}=r,{marginTop:n=!1}=r,{marginBottom:g=!0}=r,v="",E="";return Zu(()=>{a(6,v=document.location.href),a(7,E=document.title)}),c.$$set=S=>{"title"in S&&a(0,l=S.title),"width"in S&&a(1,u=S.width),"theme"in S&&a(2,f=S.theme),"themeOverrides"in S&&a(3,d=S.themeOverrides),"marginTop"in S&&a(4,n=S.marginTop),"marginBottom"in S&&a(5,g=S.marginBottom)},[l,u,f,d,n,g,v,E]}class W1 extends $i{constructor(r){super(),ji(this,r,H1,G1,Fi,{title:0,width:1,theme:2,themeOverrides:3,marginTop:4,marginBottom:5})}}function gm(c,r,a){const l=c.slice();return l[1]=r[a],l[3]=a,l}function _m(c){let r,a=Pi(c[0]),l=[];for(let u=0;u<a.length;u+=1)l[u]=vm(gm(c,a,u));return{c(){r=$e("dl");for(let u=0;u<l.length;u+=1)l[u].c();this.h()},l(u){r=je(u,"DL",{class:!0,title:!0,"aria-label":!0});var f=et(r);for(let d=0;d<l.length;d+=1)l[d].l(f);f.forEach(J),this.h()},h(){_e(r,"class","ons-metadata metadata__list ons-grid ons-grid--gutterless ons-u-cf ons-u-mb-m"),_e(r,"title","Dataset ID and release date information"),_e(r,"aria-label","Dataset ID and release date information")},m(u,f){Ze(u,r,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(r,null)},p(u,f){if(f&1){a=Pi(u[0]);let d;for(d=0;d<a.length;d+=1){const n=gm(u,a,d);l[d]?l[d].p(n,f):(l[d]=vm(n),l[d].c(),l[d].m(r,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},d(u){u&&J(r),Pr(l,u)}}}function K1(c){let r,a=c[1].value+"",l;return{c(){r=new $u(!1),l=oi(),this.h()},l(u){r=ju(u,!1),l=oi(),this.h()},h(){r.a=l},m(u,f){r.m(a,u,f),Ze(u,l,f)},p(u,f){f&1&&a!==(a=u[1].value+"")&&r.p(a)},d(u){u&&(J(l),r.d())}}}function X1(c){let r,a=um(c[1].value)+"",l,u,f,d,n=c[1].extra&&ym(c);return{c(){r=$e("time"),l=Ut(a),f=mt(),n&&n.c(),d=oi(),this.h()},l(g){r=je(g,"TIME",{datetime:!0});var v=et(r);l=Vt(v,a),v.forEach(J),f=gt(g),n&&n.l(g),d=oi(),this.h()},h(){_e(r,"datetime",u=new Date(c[1].value).toISOString())},m(g,v){Ze(g,r,v),ze(r,l),Ze(g,f,v),n&&n.m(g,v),Ze(g,d,v)},p(g,v){v&1&&a!==(a=um(g[1].value)+"")&&bi(l,a),v&1&&u!==(u=new Date(g[1].value).toISOString())&&_e(r,"datetime",u),g[1].extra?n?n.p(g,v):(n=ym(g),n.c(),n.m(d.parentNode,d)):n&&(n.d(1),n=null)},d(g){g&&(J(r),J(f),J(d)),n&&n.d(g)}}}function ym(c){let r,a=c[1].extra+"",l;return{c(){r=new $u(!1),l=oi(),this.h()},l(u){r=ju(u,!1),l=oi(),this.h()},h(){r.a=l},m(u,f){r.m(a,u,f),Ze(u,l,f)},p(u,f){f&1&&a!==(a=u[1].extra+"")&&r.p(a)},d(u){u&&(J(l),r.d())}}}function vm(c){let r,a,l=c[1].key+"",u,f,d,n,g,v,E;function S(z,A){return A&1&&(g=null),g==null&&(g=!!R1(z[1].value)),g?X1:K1}let T=S(c,-1),k=T(c);return{c(){r=$e("div"),a=$e("dt"),u=Ut(l),f=Ut(":"),d=mt(),n=$e("dd"),k.c(),v=mt(),this.h()},l(z){r=je(z,"DIV",{class:!0});var A=et(r);a=je(A,"DT",{class:!0});var R=et(a);u=Vt(R,l),f=Vt(R,":"),R.forEach(J),d=gt(A),n=je(A,"DD",{class:!0});var D=et(n);k.l(D),D.forEach(J),v=gt(A),A.forEach(J),this.h()},h(){_e(a,"class","ons-metadata__term ons-u-mr-xs"),_e(n,"class","ons-metadata__value ons-u-f-no"),_e(r,"class",E="ons-grid__col ons-col-"+(c[1].col?c[1].col:12)+"@m"),Ht(r,"ons-u-mt-xs",c[3]!==0)},m(z,A){Ze(z,r,A),ze(r,a),ze(a,u),ze(a,f),ze(r,d),ze(r,n),k.m(n,null),ze(r,v)},p(z,A){A&1&&l!==(l=z[1].key+"")&&bi(u,l),T===(T=S(z,A))&&k?k.p(z,A):(k.d(1),k=T(z),k&&(k.c(),k.m(n,null))),A&1&&E!==(E="ons-grid__col ons-col-"+(z[1].col?z[1].col:12)+"@m")&&_e(r,"class",E),A&1&&Ht(r,"ons-u-mt-xs",z[3]!==0)},d(z){z&&J(r),k.d()}}}function J1(c){let r=Array.isArray(c[0]),a,l=r&&_m(c);return{c(){l&&l.c(),a=oi()},l(u){l&&l.l(u),a=oi()},m(u,f){l&&l.m(u,f),Ze(u,a,f)},p(u,[f]){f&1&&(r=Array.isArray(u[0])),r?l?l.p(u,f):(l=_m(u),l.c(),l.m(a.parentNode,a)):l&&(l.d(1),l=null)},i:Ci,o:Ci,d(u){u&&J(a),l&&l.d(u)}}}function Y1(c,r,a){let{meta:l=null}=r;return c.$$set=u=>{"meta"in u&&a(0,l=u.meta)},[l]}class Q1 extends $i{constructor(r){super(),ji(this,r,Y1,J1,Fi,{meta:0})}}const ev=c=>({}),bm=c=>({}),tv=c=>({}),wm=c=>({}),iv=c=>({}),xm=c=>({});function Em(c){let r,a='<div class="ons-grid--flex ons-grid--between@m ons-u-mt-s@m ons-u-mb-m@xxs ons-u-flex-jc-fe@m"><a href="https://uksa.statisticsauthority.gov.uk/about-the-authority/uk-statistical-system/types-of-official-statistics/" class="national-statistics__link ons-u-fs-xxxl"><img src="//cdn.ons.gov.uk/assets/images/ons-logo/kitemark/uksa-kitemark.svg" alt="UK Statistics Authority Kitemark" class="national-statistics__logo"/></a></div>';return{c(){r=$e("div"),r.innerHTML=a,this.h()},l(l){r=je(l,"DIV",{class:!0,"data-svelte-h":!0}),lr(r)!=="svelte-pqjcyt"&&(r.innerHTML=a),this.h()},h(){_e(r,"class","ons-grid__col ons-col-2@m svelte-lohx48")},m(l,u){Ze(l,r,u)},d(l){l&&J(r)}}}function Sm(c){let r,a='<div class="ons-grid__col svelte-lohx48"><img src="https://cdn.ons.gov.uk/assets/images/census-logo/logo-census-2021-purple-landscape.svg" title="Census 2021" alt="Census 2021" class="header__svg-logo margin-right--1" focusable="false" width="167" height="32"/></div>';return{c(){r=$e("div"),r.innerHTML=a,this.h()},l(l){r=je(l,"DIV",{class:!0,"data-svelte-h":!0}),lr(r)!=="svelte-9wk1rb"&&(r.innerHTML=a),this.h()},h(){_e(r,"class","ons-grid ons-u-mb-m")},m(l,u){Ze(l,r,u)},d(l){l&&J(r)}}}function rv(c){let r,a,l,u,f,d,n,g,v,E,S,T,k,z;const A=c[7].before,R=Tr(A,c,c[8],xm);let D=c[1]&&Em();const F=c[7].default,q=Tr(F,c,c[8],null),ee=c[7].brand,ie=Tr(ee,c,c[8],wm);let ne=c[2]&&Sm();T=new Q1({props:{meta:c[3]}});const se=c[7].after,ue=Tr(se,c,c[8],bm);return{c(){r=$e("section"),R&&R.c(),a=mt(),l=$e("div"),u=$e("div"),f=$e("h1"),d=Ut(c[0]),n=mt(),D&&D.c(),g=mt(),q&&q.c(),v=mt(),ie&&ie.c(),E=mt(),ne&&ne.c(),S=mt(),ii(T.$$.fragment),k=mt(),ue&&ue.c(),this.h()},l(Ce){r=je(Ce,"SECTION",{class:!0});var ye=et(r);R&&R.l(ye),a=gt(ye),l=je(ye,"DIV",{class:!0});var Xe=et(l);u=je(Xe,"DIV",{class:!0});var ae=et(u);f=je(ae,"H1",{class:!0});var Le=et(f);d=Vt(Le,c[0]),Le.forEach(J),ae.forEach(J),n=gt(Xe),D&&D.l(Xe),Xe.forEach(J),g=gt(ye),q&&q.l(ye),v=gt(ye),ie&&ie.l(ye),E=gt(ye),ne&&ne.l(ye),S=gt(ye),si(T.$$.fragment,ye),k=gt(ye),ue&&ue.l(ye),ye.forEach(J),this.h()},h(){_e(f,"class","ons-u-fs-xxxl ons-u-mt-s ons-u-mb-m ons-u-pb-no ons-u-pt-no"),_e(u,"class","ons-grid__col ons-col-10@m svelte-lohx48"),_e(l,"class","ons-grid"),_e(r,"class","ons-u-mb-xl")},m(Ce,ye){Ze(Ce,r,ye),R&&R.m(r,null),ze(r,a),ze(r,l),ze(l,u),ze(u,f),ze(f,d),ze(l,n),D&&D.m(l,null),ze(r,g),q&&q.m(r,null),ze(r,v),ie&&ie.m(r,null),ze(r,E),ne&&ne.m(r,null),ze(r,S),ri(T,r,null),ze(r,k),ue&&ue.m(r,null),z=!0},p(Ce,ye){R&&R.p&&(!z||ye&256)&&Cr(R,A,Ce,Ce[8],z?Ar(A,Ce[8],ye,iv):Ir(Ce[8]),xm),(!z||ye&1)&&bi(d,Ce[0]),Ce[1]?D||(D=Em(),D.c(),D.m(l,null)):D&&(D.d(1),D=null),q&&q.p&&(!z||ye&256)&&Cr(q,F,Ce,Ce[8],z?Ar(F,Ce[8],ye,null):Ir(Ce[8]),null),ie&&ie.p&&(!z||ye&256)&&Cr(ie,ee,Ce,Ce[8],z?Ar(ee,Ce[8],ye,tv):Ir(Ce[8]),wm),Ce[2]?ne||(ne=Sm(),ne.c(),ne.m(r,S)):ne&&(ne.d(1),ne=null);const Xe={};ye&8&&(Xe.meta=Ce[3]),T.$set(Xe),ue&&ue.p&&(!z||ye&256)&&Cr(ue,se,Ce,Ce[8],z?Ar(se,Ce[8],ye,ev):Ir(Ce[8]),bm)},i(Ce){z||(Ye(R,Ce),Ye(q,Ce),Ye(ie,Ce),Ye(T.$$.fragment,Ce),Ye(ue,Ce),z=!0)},o(Ce){st(R,Ce),st(q,Ce),st(ie,Ce),st(T.$$.fragment,Ce),st(ue,Ce),z=!1},d(Ce){Ce&&J(r),R&&R.d(Ce),D&&D.d(),q&&q.d(Ce),ie&&ie.d(Ce),ne&&ne.d(),ni(T),ue&&ue.d(Ce)}}}function nv(c){let r,a;return r=new Wo({props:{theme:c[4],themeOverrides:c[5],background:c[6],$$slots:{default:[rv]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,[u]){const f={};u&16&&(f.theme=l[4]),u&32&&(f.themeOverrides=l[5]),u&64&&(f.background=l[6]),u&271&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function sv(c,r,a){let{$$slots:l={},$$scope:u}=r,{title:f="Page title"}=r,{natStatBadge:d=!1}=r,{censusLogo:n=!1}=r,{meta:g=null}=r,{theme:v=null}=r,{themeOverrides:E=null}=r,{background:S=null}=r;return c.$$set=T=>{"title"in T&&a(0,f=T.title),"natStatBadge"in T&&a(1,d=T.natStatBadge),"censusLogo"in T&&a(2,n=T.censusLogo),"meta"in T&&a(3,g=T.meta),"theme"in T&&a(4,v=T.theme),"themeOverrides"in T&&a(5,E=T.themeOverrides),"background"in T&&a(6,S=T.background),"$$scope"in T&&a(8,u=T.$$scope)},[f,d,n,g,v,E,S,l,u]}class av extends $i{constructor(r){super(),ji(this,r,sv,nv,Fi,{title:0,natStatBadge:1,censusLogo:2,meta:3,theme:4,themeOverrides:5,background:6})}}function km(c){let r,a,l,u;return{c(){r=da("svg"),a=da("path"),this.h()},l(f){r=pa(f,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var d=et(r);a=pa(d,"path",{d:!0}),et(a).forEach(J),d.forEach(J),this.h()},h(){_e(a,"d",l=c[3][c[0]].d),_e(r,"class","ons-svg-icon"),_e(r,"viewBox",u=c[3][c[0]].viewBox),_e(r,"xmlns","http://www.w3.org/2000/svg"),_e(r,"focusable","false"),_e(r,"fill","currentColor"),Ht(r,"ons-u-ml-xs",c[1]),Ht(r,"ons-u-mr-xs",c[2])},m(f,d){Ze(f,r,d),ze(r,a)},p(f,d){d&1&&l!==(l=f[3][f[0]].d)&&_e(a,"d",l),d&1&&u!==(u=f[3][f[0]].viewBox)&&_e(r,"viewBox",u),d&2&&Ht(r,"ons-u-ml-xs",f[1]),d&4&&Ht(r,"ons-u-mr-xs",f[2])},d(f){f&&J(r)}}}function ov(c){let r,a=c[3][c[0]]&&km(c);return{c(){a&&a.c(),r=oi()},l(l){a&&a.l(l),r=oi()},m(l,u){a&&a.m(l,u),Ze(l,r,u)},p(l,[u]){l[3][l[0]]?a?a.p(l,u):(a=km(l),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null)},i:Ci,o:Ci,d(l){l&&J(r),a&&a.d(l)}}}function lv(c,r,a){let{type:l="arrow"}=r,{marginLeft:u=!1}=r,{marginRight:f=!1}=r;const d={arrow:{d:"m10 .2-.9.9c-.1.1-.1.4 0 .5l4 4H.6c-.2 0-.4.2-.4.4v1.2c0 .2.2.4.4.4h12.5l-3.9 3.7c-.2.2-.2.4 0 .6l.8.9c.2.2.4.2.6 0L16.8 7c.2-.2.2-.4 0-.6L10.7.3c-.3-.2-.5-.2-.7-.1z",viewBox:"0 0 17 13"},externalLink:{d:"M13.5,9H13a.5.5,0,0,0-.5.5v3h-9v-9h3A.5.5,0,0,0,7,3V2.5A.5.5,0,0,0,6.5,2h-4a.5.5,0,0,0-.5.5v11a.5.5,0,0,0,.5.5h11a.5.5,0,0,0,.5-.5v-4A.5.5,0,0,0,13.5,9Z M8.83,7.88a.51.51,0,0,0,.71,0l2.31-2.32,1.28,1.28A.51.51,0,0,0,14,6.49v-4a.52.52,0,0,0-.5-.5h-4A.51.51,0,0,0,9,2.52a.58.58,0,0,0,.14.33l1.28,1.28L8.12,6.46a.51.51,0,0,0,0,.71Z",viewBox:"2 2 12 12"},signout:{d:"M13.85,7.65l-2.5-2.5a.5.5,0,0,0-.71,0,.48.48,0,0,0-.15.36V7h-3a.5.5,0,0,0-.5.5v1a.5.5,0,0,0,.5.5h3v1.5A.49.49,0,0,0,11,11a.48.48,0,0,0,.34-.14l2.51-2.5a.49.49,0,0,0,0-.68Z M8.5,14h-6a.5.5,0,0,1-.5-.5V2.5A.5.5,0,0,1,2.5,2h6a.5.5,0,0,1,.5.5V3a.5.5,0,0,1-.5.5h-5v9h5A.5.5,0,0,1,9,13v.5A.5.5,0,0,1,8.5,14Z",viewBox:"0 0 12 12"},print:{d:"M17 4H3C1.3 4 0 5.2 0 6.8v5.5h4V16h12v-3.7h4V6.8C20 5.2 18.7 4 17 4zm-3 10H6V9h8v5zm3-6a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm-1-8H4v3h12V0z",viewBox:"0 0 20 16"},download:{d:"M5.6 9a.48.48 0 0 0 .7 0l3-3.2a.48.48 0 0 0 0-.7C9.3 5 9.2 5 9 5H7.5V.5A.47.47 0 0 0 7 0H5a.47.47 0 0 0-.5.5V5H3a.47.47 0 0 0-.5.5.37.37 0 0 0 .1.3Z M11.5 9H11a.47.47 0 0 0-.5.5v1h-9v-1A.47.47 0 0 0 1 9H.5a.47.47 0 0 0-.5.5v2a.47.47 0 0 0 .5.5h11a.47.47 0 0 0 .5-.5v-2a.47.47 0 0 0-.5-.5Z",viewBox:"0 0 12 12"},tick:{d:"M14.35,3.9l-.71-.71a.5.5,0,0,0-.71,0h0L5.79,10.34,3.07,7.61a.51.51,0,0,0-.71,0l-.71.71a.51.51,0,0,0,0,.71l3.78,3.78a.5.5,0,0,0,.71,0h0L14.35,4.6A.5.5,0,0,0,14.35,3.9Z",viewBox:"1.5 3 13 10"},search:{d:"M11.86 10.23 8.62 6.99a4.63 4.63 0 1 0-6.34 1.64 4.55 4.55 0 0 0 2.36.64 4.65 4.65 0 0 0 2.33-.65l3.24 3.23a.46.46 0 0 0 .65 0l1-1a.48.48 0 0 0 0-.62Zm-5-3.32a3.28 3.28 0 0 1-2.31.93 3.22 3.22 0 1 1 2.35-.93Z",viewBox:"0 0 12 12"}};return c.$$set=n=>{"type"in n&&a(0,l=n.type),"marginLeft"in n&&a(1,u=n.marginLeft),"marginRight"in n&&a(2,f=n.marginRight)},[l,u,f,d]}let Xu=class extends $i{constructor(r){super(),ji(this,r,lv,ov,Fi,{type:0,marginLeft:1,marginRight:2})}};function cv(c){let r,a,l,u,f,d,n,g,v=c[4]&&c[5]==="before"&&Tm(c);const E=c[9].default,S=Tr(E,c,c[8],null);let T=c[4]&&c[5]==="after"&&Cm(c);return{c(){r=$e("button"),a=$e("span"),v&&v.c(),l=mt(),u=$e("span"),S&&S.c(),f=mt(),T&&T.c(),this.h()},l(k){r=je(k,"BUTTON",{type:!0,class:!0});var z=et(r);a=je(z,"SPAN",{class:!0});var A=et(a);v&&v.l(A),l=gt(A),u=je(A,"SPAN",{class:!0});var R=et(u);S&&S.l(R),R.forEach(J),f=gt(A),T&&T.l(A),A.forEach(J),z.forEach(J),this.h()},h(){_e(u,"class","ons-btn__text"),_e(a,"class","ons-btn__inner"),_e(r,"type",c[0]),_e(r,"class","ons-btn"),r.disabled=c[6],Ht(r,"ons-btn--small",c[3]),Ht(r,"ons-btn--secondary",c[1]==="secondary"),Ht(r,"ons-btn--ghost",c[1]==="ghost"),Ht(r,"ons-btn--disabled",c[6])},m(k,z){Ze(k,r,z),ze(r,a),v&&v.m(a,null),ze(a,l),ze(a,u),S&&S.m(u,null),ze(a,f),T&&T.m(a,null),d=!0,n||(g=$s(r,"click",c[11]),n=!0)},p(k,z){k[4]&&k[5]==="before"?v?(v.p(k,z),z&48&&Ye(v,1)):(v=Tm(k),v.c(),Ye(v,1),v.m(a,l)):v&&(Ni(),st(v,1,1,()=>{v=null}),Ui()),S&&S.p&&(!d||z&256)&&Cr(S,E,k,k[8],d?Ar(E,k[8],z,null):Ir(k[8]),null),k[4]&&k[5]==="after"?T?(T.p(k,z),z&48&&Ye(T,1)):(T=Cm(k),T.c(),Ye(T,1),T.m(a,null)):T&&(Ni(),st(T,1,1,()=>{T=null}),Ui()),(!d||z&1)&&_e(r,"type",k[0]),(!d||z&64)&&(r.disabled=k[6]),(!d||z&8)&&Ht(r,"ons-btn--small",k[3]),(!d||z&2)&&Ht(r,"ons-btn--secondary",k[1]==="secondary"),(!d||z&2)&&Ht(r,"ons-btn--ghost",k[1]==="ghost"),(!d||z&64)&&Ht(r,"ons-btn--disabled",k[6])},i(k){d||(Ye(v),Ye(S,k),Ye(T),d=!0)},o(k){st(v),st(S,k),st(T),d=!1},d(k){k&&J(r),v&&v.d(),S&&S.d(k),T&&T.d(),n=!1,g()}}}function uv(c){let r,a,l,u,f,d,n,g,v,E=c[4]&&c[5]==="before"&&Im(c);const S=c[9].default,T=Tr(S,c,c[8],null);let k=c[4]&&c[5]==="after"&&Am(c);return{c(){r=$e("a"),a=$e("span"),E&&E.c(),l=mt(),u=$e("span"),T&&T.c(),f=mt(),k&&k.c(),this.h()},l(z){r=je(z,"A",{href:!0,role:!0,class:!0,disabled:!0});var A=et(r);a=je(A,"SPAN",{class:!0});var R=et(a);E&&E.l(R),l=gt(R),u=je(R,"SPAN",{class:!0});var D=et(u);T&&T.l(D),D.forEach(J),f=gt(R),k&&k.l(R),R.forEach(J),A.forEach(J),this.h()},h(){_e(u,"class","ons-btn__text"),_e(a,"class","ons-btn__inner"),_e(r,"href",d=c[6]?null:c[2]),_e(r,"role","button"),_e(r,"class","ons-btn ons-btn--link ons-js-submit-btn"),_e(r,"disabled",c[6]),Ht(r,"ons-btn--small",c[3]),Ht(r,"ons-btn--secondary",c[1]==="secondary"),Ht(r,"ons-btn--ghost",c[1]==="ghost"),Ht(r,"ons-btn--disabled",c[6])},m(z,A){Ze(z,r,A),ze(r,a),E&&E.m(a,null),ze(a,l),ze(a,u),T&&T.m(u,null),ze(a,f),k&&k.m(a,null),n=!0,g||(v=$s(r,"click",c[10]),g=!0)},p(z,A){z[4]&&z[5]==="before"?E?(E.p(z,A),A&48&&Ye(E,1)):(E=Im(z),E.c(),Ye(E,1),E.m(a,l)):E&&(Ni(),st(E,1,1,()=>{E=null}),Ui()),T&&T.p&&(!n||A&256)&&Cr(T,S,z,z[8],n?Ar(S,z[8],A,null):Ir(z[8]),null),z[4]&&z[5]==="after"?k?(k.p(z,A),A&48&&Ye(k,1)):(k=Am(z),k.c(),Ye(k,1),k.m(a,null)):k&&(Ni(),st(k,1,1,()=>{k=null}),Ui()),(!n||A&68&&d!==(d=z[6]?null:z[2]))&&_e(r,"href",d),(!n||A&64)&&_e(r,"disabled",z[6]),(!n||A&8)&&Ht(r,"ons-btn--small",z[3]),(!n||A&2)&&Ht(r,"ons-btn--secondary",z[1]==="secondary"),(!n||A&2)&&Ht(r,"ons-btn--ghost",z[1]==="ghost"),(!n||A&64)&&Ht(r,"ons-btn--disabled",z[6])},i(z){n||(Ye(E),Ye(T,z),Ye(k),n=!0)},o(z){st(E),st(T,z),st(k),n=!1},d(z){z&&J(r),E&&E.d(),T&&T.d(z),k&&k.d(),g=!1,v()}}}function Tm(c){let r,a;return r=new Xu({props:{type:c[4],marginRight:!0}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&16&&(f.type=l[4]),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function Cm(c){let r,a;return r=new Xu({props:{type:c[4],marginLeft:!0}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&16&&(f.type=l[4]),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function Im(c){let r,a;return r=new Xu({props:{type:c[4],marginRight:!0}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&16&&(f.type=l[4]),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function Am(c){let r,a;return r=new Xu({props:{type:c[4],marginLeft:!0}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&16&&(f.type=l[4]),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function hv(c){let r,a,l,u;const f=[uv,cv],d=[];function n(g,v){return g[2]?0:1}return r=n(c),a=d[r]=f[r](c),{c(){a.c(),l=oi()},l(g){a.l(g),l=oi()},m(g,v){d[r].m(g,v),Ze(g,l,v),u=!0},p(g,[v]){let E=r;r=n(g),r===E?d[r].p(g,v):(Ni(),st(d[E],1,1,()=>{d[E]=null}),Ui(),a=d[r],a?a.p(g,v):(a=d[r]=f[r](g),a.c()),Ye(a,1),a.m(l.parentNode,l))},i(g){u||(Ye(a),u=!0)},o(g){st(a),u=!1},d(g){g&&J(l),d[r].d(g)}}}function fv(c,r,a){let{$$slots:l={},$$scope:u}=r;const f=Lf();let{type:d="button"}=r,{variant:n="primary"}=r,{href:g=""}=r,{small:v=!1}=r,{icon:E=""}=r,{iconPosition:S="before"}=r,{disabled:T=!1}=r;const k=A=>f("click",A),z=A=>f("click",A);return c.$$set=A=>{"type"in A&&a(0,d=A.type),"variant"in A&&a(1,n=A.variant),"href"in A&&a(2,g=A.href),"small"in A&&a(3,v=A.small),"icon"in A&&a(4,E=A.icon),"iconPosition"in A&&a(5,S=A.iconPosition),"disabled"in A&&a(6,T=A.disabled),"$$scope"in A&&a(8,u=A.$$scope)},[d,n,g,v,E,S,T,f,u,l,k,z]}class Bf extends $i{constructor(r){super(),ji(this,r,fv,hv,Fi,{type:0,variant:1,href:2,small:3,icon:4,iconPosition:5,disabled:6})}}var ff=s1,dv=function(c){var r,a,l,u;if(r=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(c)){var f=r[1],d=f.replace(/a$/,""),n=d==="cmyk"?4:3;a=ff[d],l=r[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map(function(v,E){return/%$/.test(v)&&E===n?parseFloat(v)/100:(/%$/.test(v),parseFloat(v))}),f===d&&l.push(1),u=l[n]===void 0?1:l[n],l=l.slice(0,n),a[d]=function(){return l}}else if(/^#[A-Fa-f0-9]+$/.test(c)){var d=c.replace(/^#/,""),n=d.length;a=ff.rgb,l=d.split(n===3?/(.)/:/(..)/),l=l.filter(Boolean).map(function(S){return parseInt(n===3?S+S:S,16)}),u=1,a.rgb=function(){return l},l[0]||(l[0]=0),l[1]||(l[1]=0),l[2]||(l[2]=0)}else a=ff.keyword,a.keyword=function(){return c},l=c,u=1;var g={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{g.rgb=a.rgb(l)}catch{}try{g.hsl=a.hsl(l)}catch{}try{g.hsv=a.hsv(l)}catch{}try{g.cmyk=a.cmyk(l)}catch{}try{g.keyword=a.keyword(l)}catch{}return g.rgb&&(g.hex="#"+g.rgb.map(function(v){var E=v.toString(16);return E.length===1?"0"+E:E}).join("")),g.rgb&&(g.rgba=g.rgb.concat(u)),g.hsl&&(g.hsla=g.hsl.concat(u)),g.hsv&&(g.hsva=g.hsv.concat(u)),g.cmyk&&(g.cmyka=g.cmyk.concat(u)),g};const pv=Ku(dv);function mv(c){return c}function gv(c){if(c==null)return mv;var r,a,l=c.scale[0],u=c.scale[1],f=c.translate[0],d=c.translate[1];return function(n,g){g||(r=a=0);var v=2,E=n.length,S=new Array(E);for(S[0]=(r+=n[0])*l+f,S[1]=(a+=n[1])*u+d;v<E;)S[v]=n[v],++v;return S}}function _v(c,r){for(var a,l=c.length,u=l-r;u<--l;)a=c[u],c[u++]=c[l],c[l]=a}function yv(c,r){return typeof r=="string"&&(r=c.objects[r]),r.type==="GeometryCollection"?{type:"FeatureCollection",features:r.geometries.map(function(a){return Pm(c,a)})}:Pm(c,r)}function Pm(c,r){var a=r.id,l=r.bbox,u=r.properties==null?{}:r.properties,f=vv(c,r);return a==null&&l==null?{type:"Feature",properties:u,geometry:f}:l==null?{type:"Feature",id:a,properties:u,geometry:f}:{type:"Feature",id:a,bbox:l,properties:u,geometry:f}}function vv(c,r){var a=gv(c.transform),l=c.arcs;function u(E,S){S.length&&S.pop();for(var T=l[E<0?~E:E],k=0,z=T.length;k<z;++k)S.push(a(T[k],k));E<0&&_v(S,z)}function f(E){return a(E)}function d(E){for(var S=[],T=0,k=E.length;T<k;++T)u(E[T],S);return S.length<2&&S.push(S[0]),S}function n(E){for(var S=d(E);S.length<4;)S.push(S[0]);return S}function g(E){return E.map(n)}function v(E){var S=E.type,T;switch(S){case"GeometryCollection":return{type:S,geometries:E.geometries.map(v)};case"Point":T=f(E.coordinates);break;case"MultiPoint":T=E.coordinates.map(f);break;case"LineString":T=d(E.arcs);break;case"MultiLineString":T=E.arcs.map(d);break;case"Polygon":T=g(E.arcs);break;case"MultiPolygon":T=E.arcs.map(g);break;default:return null}return{type:S,coordinates:T}}return v(r)}const bv=[{filename:"mimetype",contents:"application/vnd.oasis.opendocument.spreadsheet"},{filename:"META-INF/manifest.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" manifest:version="1.3">
  <manifest:file-entry manifest:full-path="/" manifest:version="1.3" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
  <manifest:file-entry manifest:full-path="meta.xml" manifest:media-type="text/xml"/>
  <manifest:file-entry manifest:full-path="styles.xml" manifest:media-type="text/xml"/>
  <manifest:file-entry manifest:full-path="content.xml" manifest:media-type="text/xml"/>
</manifest:manifest>
`},{filename:"content.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-content xmlns:presentation="urn:oasis:names:tc:opendocument:xmlns:presentation:1.0" xmlns:css3t="http://www.w3.org/TR/css3-text/" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:rpt="http://openoffice.org/2005/report" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:formx="urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:scripts/>
  <office:font-face-decls>
    <style:font-face style:name="Arial" svg:font-family="Arial" style:font-adornments="Regular" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Liberation Sans" svg:font-family="'Liberation Sans'" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Arial Unicode MS" svg:font-family="'Arial Unicode MS'" style:font-family-generic="system" style:font-pitch="variable"/>
    <style:font-face style:name="PingFang SC" svg:font-family="'PingFang SC'" style:font-family-generic="system" style:font-pitch="variable"/>
  </office:font-face-decls>
  <office:automatic-styles>
    <style:style style:name="co1" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="2.258cm"/>
    </style:style>
{{#sheets}}
  {{#columnStyles}}
    <style:style style:name="{{name}}" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="{{widthCm}}cm"/>
    </style:style>
  {{/columnStyles}}
{{/sheets}}
    <style:style style:name="co3" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="15.723cm"/>
    </style:style>
    <style:style style:name="contents_and_notes_column_2" style:family="table-column">
      <style:table-column-properties fo:break-before="auto" style:column-width="12cm"/>
    </style:style>
    <style:style style:name="ro1" style:family="table-row">
      <style:table-row-properties style:row-height="0.778cm" fo:break-before="auto" style:use-optimal-row-height="true"/>
    </style:style>
    <style:style style:name="ro2" style:family="table-row">
      <style:table-row-properties style:row-height="0.529cm" fo:break-before="auto" style:use-optimal-row-height="true"/>
    </style:style>
{{#coverSheetRowStyles}}
    <style:style style:name="{{styleName}}" style:family="table-row">
      <style:table-row-properties style:row-height="{{rowHeightCm}}cm" fo:break-before="auto" style:use-optimal-row-height="false"/>
    </style:style>
{{/coverSheetRowStyles}}
    <style:style style:name="intro_text_row" style:family="table-row">
      <style:table-row-properties style:row-height="0.55cm" fo:break-before="auto" style:use-optimal-row-height="false"/>
    </style:style>
    <style:style style:name="intro_text_last_row" style:family="table-row">
      <style:table-row-properties style:row-height="1cm" fo:break-before="auto" style:use-optimal-row-height="false"/>
    </style:style>
    <style:style style:name="ro3" style:family="table-row">
      <style:table-row-properties style:row-height="1.25cm" fo:break-before="auto"/>
    </style:style>
    <style:style style:name="ta1" style:family="table" style:master-page-name="Default">
      <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
    </style:style>
    <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties fo:wrap-option="wrap"/>
      <style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="ce2" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N111"/>
    <style:style style:name="ce5" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties fo:wrap-option="wrap"/>
    </style:style>
    <style:style style:name="ce6" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties fo:wrap-option="wrap"/>
      <style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="right_aligned_table_heading" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties fo:wrap-option="wrap" style:text-align-source="fix" style:repeat-content="false"/>
      <style:paragraph-properties fo:text-align="end" fo:margin-left="0cm"/>
      <style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="cell_intro_text" style:family="table-cell" style:parent-style-name="Default">
      <style:table-cell-properties style:vertical-align="top"/>
    </style:style>
    <style:style style:name="cell_hyperlink" style:family="table-cell" style:parent-style-name="Hyperlink"/>
    <style:style style:name="cell_number_1dp" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N111"/>
    <style:style style:name="cell_number_with_commas" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="number_with_commas"/>
  </office:automatic-styles>
  <office:body>
    <office:spreadsheet>
      <table:calculation-settings table:automatic-find-labels="false" table:use-regular-expressions="false" table:use-wildcards="true"/>
      <table:table table:name="Cover_sheet" table:style-name="ta1">
        <table:table-column table:style-name="co3" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>{{coverSheetTitle}}</text:p>
          </table:table-cell>
        </table:table-row>
{{#coverSheetContents}}
{{#isSubtitle}}
        <table:table-row table:style-name="ro3">
          <table:table-cell table:style-name="Heading_20_2" office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
        </table:table-row>
{{/isSubtitle}}
{{^isSubtitle}}
        <table:table-row table:style-name="coverSheetRowStyle_{{rowCount}}">
  {{#isText}}
          <table:table-cell table:style-name="ce5" office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
  {{/isText}}
  {{#isHyperlink}}
          <table:table-cell table:style-name="cell_hyperlink" office:value-type="string" calcext:value-type="string">
            <text:p><text:a xlink:href="{{href}}" xlink:type="simple">{{text}}</text:a></text:p>
          </table:table-cell>
  {{/isHyperlink}}
        </table:table-row>
{{/isSubtitle}}
{{/coverSheetContents}}
      </table:table>
      <table:table table:name="Table_of_contents" table:style-name="ta1">
        <table:table-column table:style-name="co1" table:default-cell-style-name="Default"/>
        <table:table-column table:style-name="contents_and_notes_column_2" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>Table of contents</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="intro_text_last_row">
          <table:table-cell table:style-name="cell_intro_text" office:value-type="string" calcext:value-type="string">
            <text:p>This worksheet contains one table.</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
            <text:p>Table</text:p>
          </table:table-cell>
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
            <text:p>Name</text:p>
          </table:table-cell>
        </table:table-row>
{{#sheets}}
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="cell_hyperlink" office:value-type="string" calcext:value-type="string">
            <text:p><text:a xlink:href="#'{{sheetNumber}}'.A1" xlink:type="simple">Table {{sheetNumber}}</text:a></text:p>
          </table:table-cell>
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{sheetName}}</text:p>
          </table:table-cell>
        </table:table-row>
{{/sheets}}
      </table:table>
{{#hasNotes}}
      <table:table table:name="Notes" table:style-name="ta1">
        <table:table-column table:style-name="co1" table:default-cell-style-name="Default"/>
        <table:table-column table:style-name="contents_and_notes_column_2" table:default-cell-style-name="Default"/>
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>Notes</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="intro_text_last_row">
          <table:table-cell table:style-name="cell_intro_text" office:value-type="string" calcext:value-type="string">
            <text:p>This worksheet contains one table.</text:p>
          </table:table-cell>
          <table:table-cell/>
        </table:table-row>
        <table:table-row table:style-name="ro2">
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
            <text:p>Number</text:p>
          </table:table-cell>
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
            <text:p>Note</text:p>
          </table:table-cell>
        </table:table-row>
{{#notes}}
        <table:table-row table:style-name="ro2">
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{name}}</text:p>
          </table:table-cell>
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
        </table:table-row>
{{/notes}}
      </table:table>
{{/hasNotes}}
{{#sheets}}
      <table:table table:name="{{sheetNumber}}" table:style-name="ta1">
  {{#columnStyles}}
        <table:table-column table:style-name="{{name}}" table:default-cell-style-name="Default"/>
  {{/columnStyles}}
        <table:table-row table:style-name="ro1">
          <table:table-cell table:style-name="Heading_20_1" office:value-type="string" calcext:value-type="string">
            <text:p>Table {{sheetNumber}}: {{sheetName}}</text:p>
          </table:table-cell>
          <table:table-cell table:number-columns-repeated="2"/>
        </table:table-row>
{{#introText}}
  {{#isLastIntroRow}}
        <table:table-row table:style-name="intro_text_last_row">
          <table:table-cell table:style-name="cell_intro_text" office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
        </table:table-row>
  {{/isLastIntroRow}}
  {{^isLastIntroRow}}
        <table:table-row table:style-name="intro_text_row">
          <table:table-cell table:style-name="cell_intro_text" office:value-type="string" calcext:value-type="string">
            <text:p>{{text}}</text:p>
          </table:table-cell>
        </table:table-row>
  {{/isLastIntroRow}}
{{/introText}}
        <table:table-row table:style-name="ro2">
{{#columns}}
  {{#isNumeric}}
          <table:table-cell table:style-name="right_aligned_table_heading" office:value-type="string" calcext:value-type="string">
    {{#headingLines}}
            <text:p>{{.}}</text:p>
    {{/headingLines}}
          </table:table-cell>
  {{/isNumeric}}
  {{^isNumeric}}
          <table:table-cell table:style-name="ce6" office:value-type="string" calcext:value-type="string">
    {{#headingLines}}
            <text:p>{{.}}</text:p>
    {{/headingLines}}
          </table:table-cell>
  {{/isNumeric}}
{{/columns}}
        </table:table-row>
{{#rows}}
        <table:table-row table:style-name="ro2">
{{#cellsInRow}}
{{#isText}}
          <table:table-cell office:value-type="string" calcext:value-type="string">
            <text:p>{{displayValue}}</text:p>
          </table:table-cell>
{{/isText}}
{{#isNumeric}}
          <table:table-cell table:style-name="cell_{{style}}" office:value-type="float" office:value="{{rawValue}}" calcext:value-type="float">
            <text:p>{{displayValue}}</text:p>
          </table:table-cell>
{{/isNumeric}}
{{/cellsInRow}}
        </table:table-row>
{{/rows}}
      </table:table>
{{/sheets}}
      <table:named-expressions/>
      <table:database-ranges>
        <table:database-range table:name="table_of_contents" table:target-range-address="'Table_of_contents'.{{firstTocCell}}:'Table_of_contents'.{{lastTocCell}}" table:on-update-keep-styles="true" table:on-update-keep-size="false"/>
{{#hasNotes}}
        <table:database-range table:name="notes_table" table:target-range-address="'Notes'.{{firstNotesTableCell}}:'Notes'.{{lastNotesTableCell}}" table:on-update-keep-styles="true" table:on-update-keep-size="false"/>
{{/hasNotes}}
{{#sheets}}
        <table:database-range table:name="{{tableName}}" table:target-range-address="'{{sheetNumber}}'.{{firstTableCell}}:'{{sheetNumber}}'.{{lastTableCell}}" table:on-update-keep-styles="true" table:on-update-keep-size="false"/>
{{/sheets}}
      </table:database-ranges>
    </office:spreadsheet>
  </office:body>
</office:document-content>
`},{filename:"meta.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-meta xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:meta>
    <meta:creation-date>2023-09-21T12:53:29.924750298</meta:creation-date>
    <dc:date>2023-10-11T10:07:17.854771739</dc:date>
    <meta:editing-duration>PT12M36S</meta:editing-duration>
    <meta:editing-cycles>14</meta:editing-cycles>
    <meta:generator>LibreOffice/7.0.6.2$MacOSX_X86_64 LibreOffice_project/144abb84a525d8e30c9dbbefa69cbbf2d8d4ae3b</meta:generator>
    <meta:document-statistic meta:table-count="{{tableCount}}" meta:object-count="0"/>
  </office:meta>
</office:document-meta>
`},{filename:"styles.xml",contents:`<?xml version="1.0" encoding="UTF-8"?>
<office:document-styles xmlns:presentation="urn:oasis:names:tc:opendocument:xmlns:presentation:1.0" xmlns:css3t="http://www.w3.org/TR/css3-text/" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:rpt="http://openoffice.org/2005/report" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" office:version="1.3">
  <office:font-face-decls>
    <style:font-face style:name="Arial" svg:font-family="Arial" style:font-adornments="Regular" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Liberation Sans" svg:font-family="'Liberation Sans'" style:font-family-generic="swiss" style:font-pitch="variable"/>
    <style:font-face style:name="Arial Unicode MS" svg:font-family="'Arial Unicode MS'" style:font-family-generic="system" style:font-pitch="variable"/>
    <style:font-face style:name="PingFang SC" svg:font-family="'PingFang SC'" style:font-family-generic="system" style:font-pitch="variable"/>
  </office:font-face-decls>
  <office:styles>
    <style:default-style style:family="table-cell">
      <style:paragraph-properties style:tab-stop-distance="1.25cm"/>
      <style:text-properties style:font-name="Liberation Sans" fo:language="en" fo:country="GB" style:font-name-asian="PingFang SC" style:language-asian="zh" style:country-asian="CN" style:font-name-complex="Arial Unicode MS" style:language-complex="hi" style:country-complex="IN"/>
    </style:default-style>
    <number:number-style style:name="N0">
      <number:number number:min-integer-digits="1"/>
    </number:number-style>
    <number:number-style style:name="N111">
      <number:number number:decimal-places="1" number:min-decimal-places="1" number:min-integer-digits="1"/>
    </number:number-style>
    <number:number-style style:name="number_with_commas">
      <number:number number:decimal-places="0" number:min-decimal-places="0" number:min-integer-digits="1" number:grouping="true"/>
    </number:number-style>
    <style:style style:name="Default" style:family="table-cell">
      <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-style-name="Regular" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="12pt"/>
    </style:style>
    <style:style style:name="Heading" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="24pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Heading_20_1" style:display-name="Heading 1" style:family="table-cell" style:parent-style-name="Heading">
      <style:text-properties fo:color="#000000" fo:font-size="18pt" fo:font-style="normal" fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="Heading_20_2" style:display-name="Heading 2" style:family="table-cell" style:parent-style-name="Heading">
      <style:text-properties fo:color="#000000" fo:font-size="14pt" fo:font-style="normal" fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
    </style:style>
    <style:style style:name="Text" style:family="table-cell" style:parent-style-name="Default"/>
    <style:style style:name="Note" style:family="table-cell" style:parent-style-name="Text">
      <style:table-cell-properties fo:background-color="#ffffcc" style:diagonal-bl-tr="none" style:diagonal-tl-br="none" fo:border="0.74pt solid #808080"/>
      <style:text-properties fo:color="#333333" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Footnote" style:family="table-cell" style:parent-style-name="Text">
      <style:text-properties fo:color="#808080" fo:font-size="10pt" fo:font-style="italic" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Hyperlink" style:family="table-cell" style:parent-style-name="Text">
      <style:text-properties fo:color="#0000ee" fo:font-size="12pt" fo:font-style="normal" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="#0000ee" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Status" style:family="table-cell" style:parent-style-name="Default"/>
    <style:style style:name="Good" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ccffcc"/>
      <style:text-properties fo:color="#006600" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Neutral" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ffffcc"/>
      <style:text-properties fo:color="#996600" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Bad" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#ffcccc"/>
      <style:text-properties fo:color="#cc0000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Warning" style:family="table-cell" style:parent-style-name="Status">
      <style:text-properties fo:color="#cc0000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Error" style:family="table-cell" style:parent-style-name="Status">
      <style:table-cell-properties fo:background-color="#cc0000"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Accent" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="bold"/>
    </style:style>
    <style:style style:name="Accent_20_1" style:display-name="Accent 1" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#000000"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Accent_20_2" style:display-name="Accent 2" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#808080"/>
      <style:text-properties fo:color="#ffffff" fo:font-size="10pt" fo:font-style="normal" fo:font-weight="normal"/>
    </style:style>
    <style:style style:name="Accent_20_3" style:display-name="Accent 3" style:family="table-cell" style:parent-style-name="Accent">
      <style:table-cell-properties fo:background-color="#dddddd"/>
    </style:style>
    <style:style style:name="Result" style:family="table-cell" style:parent-style-name="Default">
      <style:text-properties fo:color="#000000" fo:font-size="10pt" fo:font-style="italic" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="#000000" fo:font-weight="bold"/>
    </style:style>
  </office:styles>
  <office:automatic-styles>
    <style:page-layout style:name="Mpm1">
      <style:page-layout-properties style:writing-mode="lr-tb"/>
      <style:header-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-bottom="0.25cm"/>
      </style:header-style>
      <style:footer-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-top="0.25cm"/>
      </style:footer-style>
    </style:page-layout>
    <style:page-layout style:name="Mpm2">
      <style:page-layout-properties style:writing-mode="lr-tb"/>
      <style:header-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-bottom="0.25cm" fo:border="2.49pt solid #000000" fo:padding="0.018cm" fo:background-color="#c0c0c0">
          <style:background-image/>
        </style:header-footer-properties>
      </style:header-style>
      <style:footer-style>
        <style:header-footer-properties fo:min-height="0.75cm" fo:margin-left="0cm" fo:margin-right="0cm" fo:margin-top="0.25cm" fo:border="2.49pt solid #000000" fo:padding="0.018cm" fo:background-color="#c0c0c0">
          <style:background-image/>
        </style:header-footer-properties>
      </style:footer-style>
    </style:page-layout>
  </office:automatic-styles>
  <office:master-styles>
    <style:master-page style:name="Default" style:page-layout-name="Mpm1">
      <style:header>
        <text:p>
          <text:sheet-name>???</text:sheet-name>
        </text:p>
      </style:header>
      <style:header-left style:display="false"/>
      <style:footer>
        <text:p>Page <text:page-number>1</text:page-number></text:p>
      </style:footer>
      <style:footer-left style:display="false"/>
    </style:master-page>
    <style:master-page style:name="Report" style:page-layout-name="Mpm2">
      <style:header>
        <style:region-left>
          <text:p><text:sheet-name>???</text:sheet-name><text:s/>(<text:title>???</text:title>)</text:p>
        </style:region-left>
        <style:region-right>
          <text:p><text:date style:data-style-name="N2" text:date-value="2023-10-11">00/00/0000</text:date>, <text:time style:data-style-name="N2" text:time-value="10:06:35.023372525">00:00:00</text:time></text:p>
        </style:region-right>
      </style:header>
      <style:header-left style:display="false"/>
      <style:footer>
        <text:p>Page <text:page-number>1</text:page-number><text:s/>/ <text:page-count>99</text:page-count></text:p>
      </style:footer>
      <style:footer-left style:display="false"/>
    </style:master-page>
  </office:master-styles>
</office:document-styles>
`}];function Pu(c){let r=0;for(const a of c)r+=a in df?df[a]:df.AVERAGE;return r}const df={0:8.9,1:8.9,2:8.9,3:8.9,4:8.9,5:8.9,6:8.9,7:8.9,8:8.9,9:8.9,a:8.9,b:8.9,c:8,d:8.9,e:8.9,f:4.43,g:8.9,h:8.9,i:3.57,j:3.57,k:8,l:3.57,m:13.33,n:8.9,o:8.9,p:8.9,q:8.9,r:5.33,s:8,t:4.43,u:8.9,v:8,w:11.57,x:8,y:8,z:8,A:10.67,B:10.67,C:11.57,D:11.57,E:10.67,F:9.77,G:12.43,H:11.57,I:4.43,J:8,K:10.67,L:8.9,M:13.33,N:11.57,O:12.43,P:10.67,Q:12.43,R:11.57,S:10.67,T:9.77,U:11.57,V:10.67,W:15.1,X:10.67,Y:10.67,Z:9.77," ":4.43,"!":4.43,'"':5.67,"#":8.9,$:8.9,"%":14.23,"&":10.67,"'":3.07,"(":5.33,")":5.33,"*":6.23,"+":9.33,",":4.43,"-":5.33,".":4.43,"/":4.43,":":4.43,";":4.43,"<":9.33,"=":9.33,">":9.33,"?":8.9,"@":16.23,"[":4.43,"]":4.43,"^":7.5,_:8.9,"`":5.33,"{":5.33,"|":4.17,"}":5.33,"~":9.33,AVERAGE:8.472},wv={$id:"https://github.com/jtrim-ons/accessible-spreadsheet-creator",title:"Accessible Spreadsheet Creator",description:"A description of an accessible spreadsheet",type:"object",properties:{coverSheetTitle:{type:"string",title:"Cover sheet title",description:"The title displayed in cell A1 of the workbook.",minLength:1},coverSheetContents:{type:"array",title:"Cover sheet contents",description:"The lines below the cover sheet title. Each can be a subtitle starting with '## ', a link in Markdown style, or just text.",items:{type:"string"}},notes:{type:"array",title:"Notes",description:"The notes, each with a name that can be referred to in double square brackets and text.",items:{type:"object",title:"Note",properties:{name:{type:"string",title:"Note name",description:"A note name (e.g. note1) that can be referred to in a sheet using double square brackets (e.g. [[note1]])."},text:{type:"string",title:"Note text",description:"The text that will appear on the Notes page."}}}},sheets:{type:"array",title:"Sheets",description:"The data an metadata for the worksheets other than cover, contents and notes sheets.",items:{type:"object",title:"Sheet",properties:{sheetName:{type:"string",minLength:1,title:"Sheet name",description:"The name to appear in cell A1"},tableName:{type:"string",minLength:1,title:"Table name",description:"The name to give to the data table",pattern:"^[A-Za-z0-9_]*$"},sheetIntroText:{type:"array",title:"Sheet intro text",description:"Introductory text to appear below cell A2",items:{type:"string"}},columns:{type:"array",title:"Data columns",items:{type:"object",title:"Data column",description:"A column with its heading, number/text style and data.",properties:{style:{type:"string",title:"Number/text style",description:"'text'=text column; 'number_with_commas': integers with thousand separator; 'number_1dp': numbers to 1 decimal place"},heading:{type:"string",title:"Column heading",description:"Table column heading. May contain notes in double square brackets."},values:{type:"array",title:"Column values",description:"An array of text or numeric values",anyOf:[{items:{type:"number"}},{items:{type:"string"}}]}},required:["style","heading","values"]}}},required:["sheetName","tableName","columns"]}}},required:["coverSheetTitle","coverSheetContents","sheets"]};var xf={exports:{}},B_={},Ns={},Ua={},vc={},Oi={},pc={};(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.regexpCode=c.getEsmExportName=c.getProperty=c.safeStringify=c.stringify=c.strConcat=c.addCodeArg=c.str=c._=c.nil=c._Code=c.Name=c.IDENTIFIER=c._CodeOrName=void 0;class r{}c._CodeOrName=r,c.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class a extends r{constructor(F){if(super(),!c.IDENTIFIER.test(F))throw new Error("CodeGen: name must be a valid identifier");this.str=F}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}c.Name=a;class l extends r{constructor(F){super(),this._items=typeof F=="string"?[F]:F}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const F=this._items[0];return F===""||F==='""'}get str(){var F;return(F=this._str)!==null&&F!==void 0?F:this._str=this._items.reduce((q,ee)=>`${q}${ee}`,"")}get names(){var F;return(F=this._names)!==null&&F!==void 0?F:this._names=this._items.reduce((q,ee)=>(ee instanceof a&&(q[ee.str]=(q[ee.str]||0)+1),q),{})}}c._Code=l,c.nil=new l("");function u(D,...F){const q=[D[0]];let ee=0;for(;ee<F.length;)n(q,F[ee]),q.push(D[++ee]);return new l(q)}c._=u;const f=new l("+");function d(D,...F){const q=[k(D[0])];let ee=0;for(;ee<F.length;)q.push(f),n(q,F[ee]),q.push(f,k(D[++ee]));return g(q),new l(q)}c.str=d;function n(D,F){F instanceof l?D.push(...F._items):F instanceof a?D.push(F):D.push(S(F))}c.addCodeArg=n;function g(D){let F=1;for(;F<D.length-1;){if(D[F]===f){const q=v(D[F-1],D[F+1]);if(q!==void 0){D.splice(F-1,3,q);continue}D[F++]="+"}F++}}function v(D,F){if(F==='""')return D;if(D==='""')return F;if(typeof D=="string")return F instanceof a||D[D.length-1]!=='"'?void 0:typeof F!="string"?`${D.slice(0,-1)}${F}"`:F[0]==='"'?D.slice(0,-1)+F.slice(1):void 0;if(typeof F=="string"&&F[0]==='"'&&!(D instanceof a))return`"${D}${F.slice(1)}`}function E(D,F){return F.emptyStr()?D:D.emptyStr()?F:d`${D}${F}`}c.strConcat=E;function S(D){return typeof D=="number"||typeof D=="boolean"||D===null?D:k(Array.isArray(D)?D.join(","):D)}function T(D){return new l(k(D))}c.stringify=T;function k(D){return JSON.stringify(D).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}c.safeStringify=k;function z(D){return typeof D=="string"&&c.IDENTIFIER.test(D)?new l(`.${D}`):u`[${D}]`}c.getProperty=z;function A(D){if(typeof D=="string"&&c.IDENTIFIER.test(D))return new l(`${D}`);throw new Error(`CodeGen: invalid export name: ${D}, use explicit $id name mapping`)}c.getEsmExportName=A;function R(D){return new l(D.toString())}c.regexpCode=R})(pc);var Ef={};(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.ValueScope=c.ValueScopeName=c.Scope=c.varKinds=c.UsedValueState=void 0;const r=pc;class a extends Error{constructor(v){super(`CodeGen: "code" for ${v} not defined`),this.value=v.value}}var l;(function(g){g[g.Started=0]="Started",g[g.Completed=1]="Completed"})(l=c.UsedValueState||(c.UsedValueState={})),c.varKinds={const:new r.Name("const"),let:new r.Name("let"),var:new r.Name("var")};class u{constructor({prefixes:v,parent:E}={}){this._names={},this._prefixes=v,this._parent=E}toName(v){return v instanceof r.Name?v:this.name(v)}name(v){return new r.Name(this._newName(v))}_newName(v){const E=this._names[v]||this._nameGroup(v);return`${v}${E.index++}`}_nameGroup(v){var E,S;if(!((S=(E=this._parent)===null||E===void 0?void 0:E._prefixes)===null||S===void 0)&&S.has(v)||this._prefixes&&!this._prefixes.has(v))throw new Error(`CodeGen: prefix "${v}" is not allowed in this scope`);return this._names[v]={prefix:v,index:0}}}c.Scope=u;class f extends r.Name{constructor(v,E){super(E),this.prefix=v}setValue(v,{property:E,itemIndex:S}){this.value=v,this.scopePath=(0,r._)`.${new r.Name(E)}[${S}]`}}c.ValueScopeName=f;const d=(0,r._)`\n`;class n extends u{constructor(v){super(v),this._values={},this._scope=v.scope,this.opts={...v,_n:v.lines?d:r.nil}}get(){return this._scope}name(v){return new f(v,this._newName(v))}value(v,E){var S;if(E.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const T=this.toName(v),{prefix:k}=T,z=(S=E.key)!==null&&S!==void 0?S:E.ref;let A=this._values[k];if(A){const F=A.get(z);if(F)return F}else A=this._values[k]=new Map;A.set(z,T);const R=this._scope[k]||(this._scope[k]=[]),D=R.length;return R[D]=E.ref,T.setValue(E,{property:k,itemIndex:D}),T}getValue(v,E){const S=this._values[v];if(S)return S.get(E)}scopeRefs(v,E=this._values){return this._reduceValues(E,S=>{if(S.scopePath===void 0)throw new Error(`CodeGen: name "${S}" has no value`);return(0,r._)`${v}${S.scopePath}`})}scopeCode(v=this._values,E,S){return this._reduceValues(v,T=>{if(T.value===void 0)throw new Error(`CodeGen: name "${T}" has no value`);return T.value.code},E,S)}_reduceValues(v,E,S={},T){let k=r.nil;for(const z in v){const A=v[z];if(!A)continue;const R=S[z]=S[z]||new Map;A.forEach(D=>{if(R.has(D))return;R.set(D,l.Started);let F=E(D);if(F){const q=this.opts.es5?c.varKinds.var:c.varKinds.const;k=(0,r._)`${k}${q} ${D} = ${F};${this.opts._n}`}else if(F=T==null?void 0:T(D))k=(0,r._)`${k}${F}${this.opts._n}`;else throw new a(D);R.set(D,l.Completed)})}return k}}c.ValueScope=n})(Ef);(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.or=c.and=c.not=c.CodeGen=c.operators=c.varKinds=c.ValueScopeName=c.ValueScope=c.Scope=c.Name=c.regexpCode=c.stringify=c.getProperty=c.nil=c.strConcat=c.str=c._=void 0;const r=pc,a=Ef;var l=pc;Object.defineProperty(c,"_",{enumerable:!0,get:function(){return l._}}),Object.defineProperty(c,"str",{enumerable:!0,get:function(){return l.str}}),Object.defineProperty(c,"strConcat",{enumerable:!0,get:function(){return l.strConcat}}),Object.defineProperty(c,"nil",{enumerable:!0,get:function(){return l.nil}}),Object.defineProperty(c,"getProperty",{enumerable:!0,get:function(){return l.getProperty}}),Object.defineProperty(c,"stringify",{enumerable:!0,get:function(){return l.stringify}}),Object.defineProperty(c,"regexpCode",{enumerable:!0,get:function(){return l.regexpCode}}),Object.defineProperty(c,"Name",{enumerable:!0,get:function(){return l.Name}});var u=Ef;Object.defineProperty(c,"Scope",{enumerable:!0,get:function(){return u.Scope}}),Object.defineProperty(c,"ValueScope",{enumerable:!0,get:function(){return u.ValueScope}}),Object.defineProperty(c,"ValueScopeName",{enumerable:!0,get:function(){return u.ValueScopeName}}),Object.defineProperty(c,"varKinds",{enumerable:!0,get:function(){return u.varKinds}}),c.operators={GT:new r._Code(">"),GTE:new r._Code(">="),LT:new r._Code("<"),LTE:new r._Code("<="),EQ:new r._Code("==="),NEQ:new r._Code("!=="),NOT:new r._Code("!"),OR:new r._Code("||"),AND:new r._Code("&&"),ADD:new r._Code("+")};class f{optimizeNodes(){return this}optimizeNames(Q,he){return this}}class d extends f{constructor(Q,he,it){super(),this.varKind=Q,this.name=he,this.rhs=it}render({es5:Q,_n:he}){const it=Q?a.varKinds.var:this.varKind,Ct=this.rhs===void 0?"":` = ${this.rhs}`;return`${it} ${this.name}${Ct};`+he}optimizeNames(Q,he){if(Q[this.name.str])return this.rhs&&(this.rhs=Z(this.rhs,Q,he)),this}get names(){return this.rhs instanceof r._CodeOrName?this.rhs.names:{}}}class n extends f{constructor(Q,he,it){super(),this.lhs=Q,this.rhs=he,this.sideEffects=it}render({_n:Q}){return`${this.lhs} = ${this.rhs};`+Q}optimizeNames(Q,he){if(!(this.lhs instanceof r.Name&&!Q[this.lhs.str]&&!this.sideEffects))return this.rhs=Z(this.rhs,Q,he),this}get names(){const Q=this.lhs instanceof r.Name?{}:{...this.lhs.names};return Le(Q,this.rhs)}}class g extends n{constructor(Q,he,it,Ct){super(Q,it,Ct),this.op=he}render({_n:Q}){return`${this.lhs} ${this.op}= ${this.rhs};`+Q}}class v extends f{constructor(Q){super(),this.label=Q,this.names={}}render({_n:Q}){return`${this.label}:`+Q}}class E extends f{constructor(Q){super(),this.label=Q,this.names={}}render({_n:Q}){return`break${this.label?` ${this.label}`:""};`+Q}}class S extends f{constructor(Q){super(),this.error=Q}render({_n:Q}){return`throw ${this.error};`+Q}get names(){return this.error.names}}class T extends f{constructor(Q){super(),this.code=Q}render({_n:Q}){return`${this.code};`+Q}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(Q,he){return this.code=Z(this.code,Q,he),this}get names(){return this.code instanceof r._CodeOrName?this.code.names:{}}}class k extends f{constructor(Q=[]){super(),this.nodes=Q}render(Q){return this.nodes.reduce((he,it)=>he+it.render(Q),"")}optimizeNodes(){const{nodes:Q}=this;let he=Q.length;for(;he--;){const it=Q[he].optimizeNodes();Array.isArray(it)?Q.splice(he,1,...it):it?Q[he]=it:Q.splice(he,1)}return Q.length>0?this:void 0}optimizeNames(Q,he){const{nodes:it}=this;let Ct=it.length;for(;Ct--;){const bt=it[Ct];bt.optimizeNames(Q,he)||(tt(Q,bt.names),it.splice(Ct,1))}return it.length>0?this:void 0}get names(){return this.nodes.reduce((Q,he)=>ae(Q,he.names),{})}}class z extends k{render(Q){return"{"+Q._n+super.render(Q)+"}"+Q._n}}class A extends k{}class R extends z{}R.kind="else";class D extends z{constructor(Q,he){super(he),this.condition=Q}render(Q){let he=`if(${this.condition})`+super.render(Q);return this.else&&(he+="else "+this.else.render(Q)),he}optimizeNodes(){super.optimizeNodes();const Q=this.condition;if(Q===!0)return this.nodes;let he=this.else;if(he){const it=he.optimizeNodes();he=this.else=Array.isArray(it)?new R(it):it}if(he)return Q===!1?he instanceof D?he:he.nodes:this.nodes.length?this:new D($t(Q),he instanceof D?[he]:he.nodes);if(!(Q===!1||!this.nodes.length))return this}optimizeNames(Q,he){var it;if(this.else=(it=this.else)===null||it===void 0?void 0:it.optimizeNames(Q,he),!!(super.optimizeNames(Q,he)||this.else))return this.condition=Z(this.condition,Q,he),this}get names(){const Q=super.names;return Le(Q,this.condition),this.else&&ae(Q,this.else.names),Q}}D.kind="if";class F extends z{}F.kind="for";class q extends F{constructor(Q){super(),this.iteration=Q}render(Q){return`for(${this.iteration})`+super.render(Q)}optimizeNames(Q,he){if(super.optimizeNames(Q,he))return this.iteration=Z(this.iteration,Q,he),this}get names(){return ae(super.names,this.iteration.names)}}class ee extends F{constructor(Q,he,it,Ct){super(),this.varKind=Q,this.name=he,this.from=it,this.to=Ct}render(Q){const he=Q.es5?a.varKinds.var:this.varKind,{name:it,from:Ct,to:bt}=this;return`for(${he} ${it}=${Ct}; ${it}<${bt}; ${it}++)`+super.render(Q)}get names(){const Q=Le(super.names,this.from);return Le(Q,this.to)}}class ie extends F{constructor(Q,he,it,Ct){super(),this.loop=Q,this.varKind=he,this.name=it,this.iterable=Ct}render(Q){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(Q)}optimizeNames(Q,he){if(super.optimizeNames(Q,he))return this.iterable=Z(this.iterable,Q,he),this}get names(){return ae(super.names,this.iterable.names)}}class ne extends z{constructor(Q,he,it){super(),this.name=Q,this.args=he,this.async=it}render(Q){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(Q)}}ne.kind="func";class se extends k{render(Q){return"return "+super.render(Q)}}se.kind="return";class ue extends z{render(Q){let he="try"+super.render(Q);return this.catch&&(he+=this.catch.render(Q)),this.finally&&(he+=this.finally.render(Q)),he}optimizeNodes(){var Q,he;return super.optimizeNodes(),(Q=this.catch)===null||Q===void 0||Q.optimizeNodes(),(he=this.finally)===null||he===void 0||he.optimizeNodes(),this}optimizeNames(Q,he){var it,Ct;return super.optimizeNames(Q,he),(it=this.catch)===null||it===void 0||it.optimizeNames(Q,he),(Ct=this.finally)===null||Ct===void 0||Ct.optimizeNames(Q,he),this}get names(){const Q=super.names;return this.catch&&ae(Q,this.catch.names),this.finally&&ae(Q,this.finally.names),Q}}class Ce extends z{constructor(Q){super(),this.error=Q}render(Q){return`catch(${this.error})`+super.render(Q)}}Ce.kind="catch";class ye extends z{render(Q){return"finally"+super.render(Q)}}ye.kind="finally";class Xe{constructor(Q,he={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...he,_n:he.lines?`
`:""},this._extScope=Q,this._scope=new a.Scope({parent:Q}),this._nodes=[new A]}toString(){return this._root.render(this.opts)}name(Q){return this._scope.name(Q)}scopeName(Q){return this._extScope.name(Q)}scopeValue(Q,he){const it=this._extScope.value(Q,he);return(this._values[it.prefix]||(this._values[it.prefix]=new Set)).add(it),it}getScopeValue(Q,he){return this._extScope.getValue(Q,he)}scopeRefs(Q){return this._extScope.scopeRefs(Q,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(Q,he,it,Ct){const bt=this._scope.toName(he);return it!==void 0&&Ct&&(this._constants[bt.str]=it),this._leafNode(new d(Q,bt,it)),bt}const(Q,he,it){return this._def(a.varKinds.const,Q,he,it)}let(Q,he,it){return this._def(a.varKinds.let,Q,he,it)}var(Q,he,it){return this._def(a.varKinds.var,Q,he,it)}assign(Q,he,it){return this._leafNode(new n(Q,he,it))}add(Q,he){return this._leafNode(new g(Q,c.operators.ADD,he))}code(Q){return typeof Q=="function"?Q():Q!==r.nil&&this._leafNode(new T(Q)),this}object(...Q){const he=["{"];for(const[it,Ct]of Q)he.length>1&&he.push(","),he.push(it),(it!==Ct||this.opts.es5)&&(he.push(":"),(0,r.addCodeArg)(he,Ct));return he.push("}"),new r._Code(he)}if(Q,he,it){if(this._blockNode(new D(Q)),he&&it)this.code(he).else().code(it).endIf();else if(he)this.code(he).endIf();else if(it)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(Q){return this._elseNode(new D(Q))}else(){return this._elseNode(new R)}endIf(){return this._endBlockNode(D,R)}_for(Q,he){return this._blockNode(Q),he&&this.code(he).endFor(),this}for(Q,he){return this._for(new q(Q),he)}forRange(Q,he,it,Ct,bt=this.opts.es5?a.varKinds.var:a.varKinds.let){const It=this._scope.toName(Q);return this._for(new ee(bt,It,he,it),()=>Ct(It))}forOf(Q,he,it,Ct=a.varKinds.const){const bt=this._scope.toName(Q);if(this.opts.es5){const It=he instanceof r.Name?he:this.var("_arr",he);return this.forRange("_i",0,(0,r._)`${It}.length`,Bt=>{this.var(bt,(0,r._)`${It}[${Bt}]`),it(bt)})}return this._for(new ie("of",Ct,bt,he),()=>it(bt))}forIn(Q,he,it,Ct=this.opts.es5?a.varKinds.var:a.varKinds.const){if(this.opts.ownProperties)return this.forOf(Q,(0,r._)`Object.keys(${he})`,it);const bt=this._scope.toName(Q);return this._for(new ie("in",Ct,bt,he),()=>it(bt))}endFor(){return this._endBlockNode(F)}label(Q){return this._leafNode(new v(Q))}break(Q){return this._leafNode(new E(Q))}return(Q){const he=new se;if(this._blockNode(he),this.code(Q),he.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(se)}try(Q,he,it){if(!he&&!it)throw new Error('CodeGen: "try" without "catch" and "finally"');const Ct=new ue;if(this._blockNode(Ct),this.code(Q),he){const bt=this.name("e");this._currNode=Ct.catch=new Ce(bt),he(bt)}return it&&(this._currNode=Ct.finally=new ye,this.code(it)),this._endBlockNode(Ce,ye)}throw(Q){return this._leafNode(new S(Q))}block(Q,he){return this._blockStarts.push(this._nodes.length),Q&&this.code(Q).endBlock(he),this}endBlock(Q){const he=this._blockStarts.pop();if(he===void 0)throw new Error("CodeGen: not in self-balancing block");const it=this._nodes.length-he;if(it<0||Q!==void 0&&it!==Q)throw new Error(`CodeGen: wrong number of nodes: ${it} vs ${Q} expected`);return this._nodes.length=he,this}func(Q,he=r.nil,it,Ct){return this._blockNode(new ne(Q,he,it)),Ct&&this.code(Ct).endFunc(),this}endFunc(){return this._endBlockNode(ne)}optimize(Q=1){for(;Q-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(Q){return this._currNode.nodes.push(Q),this}_blockNode(Q){this._currNode.nodes.push(Q),this._nodes.push(Q)}_endBlockNode(Q,he){const it=this._currNode;if(it instanceof Q||he&&it instanceof he)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${he?`${Q.kind}/${he.kind}`:Q.kind}"`)}_elseNode(Q){const he=this._currNode;if(!(he instanceof D))throw new Error('CodeGen: "else" without "if"');return this._currNode=he.else=Q,this}get _root(){return this._nodes[0]}get _currNode(){const Q=this._nodes;return Q[Q.length-1]}set _currNode(Q){const he=this._nodes;he[he.length-1]=Q}}c.CodeGen=Xe;function ae(Re,Q){for(const he in Q)Re[he]=(Re[he]||0)+(Q[he]||0);return Re}function Le(Re,Q){return Q instanceof r._CodeOrName?ae(Re,Q.names):Re}function Z(Re,Q,he){if(Re instanceof r.Name)return it(Re);if(!Ct(Re))return Re;return new r._Code(Re._items.reduce((bt,It)=>(It instanceof r.Name&&(It=it(It)),It instanceof r._Code?bt.push(...It._items):bt.push(It),bt),[]));function it(bt){const It=he[bt.str];return It===void 0||Q[bt.str]!==1?bt:(delete Q[bt.str],It)}function Ct(bt){return bt instanceof r._Code&&bt._items.some(It=>It instanceof r.Name&&Q[It.str]===1&&he[It.str]!==void 0)}}function tt(Re,Q){for(const he in Q)Re[he]=(Re[he]||0)-(Q[he]||0)}function $t(Re){return typeof Re=="boolean"||typeof Re=="number"||Re===null?!Re:(0,r._)`!${Ee(Re)}`}c.not=$t;const ft=le(c.operators.AND);function Jt(...Re){return Re.reduce(ft)}c.and=Jt;const ut=le(c.operators.OR);function at(...Re){return Re.reduce(ut)}c.or=at;function le(Re){return(Q,he)=>Q===r.nil?he:he===r.nil?Q:(0,r._)`${Ee(Q)} ${Re} ${Ee(he)}`}function Ee(Re){return Re instanceof r.Name?Re:(0,r._)`(${Re})`}})(Oi);var qi={};(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.checkStrictMode=c.getErrorPath=c.Type=c.useFunc=c.setEvaluated=c.evaluatedPropsToName=c.mergeEvaluated=c.eachItem=c.unescapeJsonPointer=c.escapeJsonPointer=c.escapeFragment=c.unescapeFragment=c.schemaRefOrVal=c.schemaHasRulesButRef=c.schemaHasRules=c.checkUnknownRules=c.alwaysValidSchema=c.toHash=void 0;const r=Oi,a=pc;function l(ne){const se={};for(const ue of ne)se[ue]=!0;return se}c.toHash=l;function u(ne,se){return typeof se=="boolean"?se:Object.keys(se).length===0?!0:(f(ne,se),!d(se,ne.self.RULES.all))}c.alwaysValidSchema=u;function f(ne,se=ne.schema){const{opts:ue,self:Ce}=ne;if(!ue.strictSchema||typeof se=="boolean")return;const ye=Ce.RULES.keywords;for(const Xe in se)ye[Xe]||ie(ne,`unknown keyword: "${Xe}"`)}c.checkUnknownRules=f;function d(ne,se){if(typeof ne=="boolean")return!ne;for(const ue in ne)if(se[ue])return!0;return!1}c.schemaHasRules=d;function n(ne,se){if(typeof ne=="boolean")return!ne;for(const ue in ne)if(ue!=="$ref"&&se.all[ue])return!0;return!1}c.schemaHasRulesButRef=n;function g({topSchemaRef:ne,schemaPath:se},ue,Ce,ye){if(!ye){if(typeof ue=="number"||typeof ue=="boolean")return ue;if(typeof ue=="string")return(0,r._)`${ue}`}return(0,r._)`${ne}${se}${(0,r.getProperty)(Ce)}`}c.schemaRefOrVal=g;function v(ne){return T(decodeURIComponent(ne))}c.unescapeFragment=v;function E(ne){return encodeURIComponent(S(ne))}c.escapeFragment=E;function S(ne){return typeof ne=="number"?`${ne}`:ne.replace(/~/g,"~0").replace(/\//g,"~1")}c.escapeJsonPointer=S;function T(ne){return ne.replace(/~1/g,"/").replace(/~0/g,"~")}c.unescapeJsonPointer=T;function k(ne,se){if(Array.isArray(ne))for(const ue of ne)se(ue);else se(ne)}c.eachItem=k;function z({mergeNames:ne,mergeToName:se,mergeValues:ue,resultToName:Ce}){return(ye,Xe,ae,Le)=>{const Z=ae===void 0?Xe:ae instanceof r.Name?(Xe instanceof r.Name?ne(ye,Xe,ae):se(ye,Xe,ae),ae):Xe instanceof r.Name?(se(ye,ae,Xe),Xe):ue(Xe,ae);return Le===r.Name&&!(Z instanceof r.Name)?Ce(ye,Z):Z}}c.mergeEvaluated={props:z({mergeNames:(ne,se,ue)=>ne.if((0,r._)`${ue} !== true && ${se} !== undefined`,()=>{ne.if((0,r._)`${se} === true`,()=>ne.assign(ue,!0),()=>ne.assign(ue,(0,r._)`${ue} || {}`).code((0,r._)`Object.assign(${ue}, ${se})`))}),mergeToName:(ne,se,ue)=>ne.if((0,r._)`${ue} !== true`,()=>{se===!0?ne.assign(ue,!0):(ne.assign(ue,(0,r._)`${ue} || {}`),R(ne,ue,se))}),mergeValues:(ne,se)=>ne===!0?!0:{...ne,...se},resultToName:A}),items:z({mergeNames:(ne,se,ue)=>ne.if((0,r._)`${ue} !== true && ${se} !== undefined`,()=>ne.assign(ue,(0,r._)`${se} === true ? true : ${ue} > ${se} ? ${ue} : ${se}`)),mergeToName:(ne,se,ue)=>ne.if((0,r._)`${ue} !== true`,()=>ne.assign(ue,se===!0?!0:(0,r._)`${ue} > ${se} ? ${ue} : ${se}`)),mergeValues:(ne,se)=>ne===!0?!0:Math.max(ne,se),resultToName:(ne,se)=>ne.var("items",se)})};function A(ne,se){if(se===!0)return ne.var("props",!0);const ue=ne.var("props",(0,r._)`{}`);return se!==void 0&&R(ne,ue,se),ue}c.evaluatedPropsToName=A;function R(ne,se,ue){Object.keys(ue).forEach(Ce=>ne.assign((0,r._)`${se}${(0,r.getProperty)(Ce)}`,!0))}c.setEvaluated=R;const D={};function F(ne,se){return ne.scopeValue("func",{ref:se,code:D[se.code]||(D[se.code]=new a._Code(se.code))})}c.useFunc=F;var q;(function(ne){ne[ne.Num=0]="Num",ne[ne.Str=1]="Str"})(q=c.Type||(c.Type={}));function ee(ne,se,ue){if(ne instanceof r.Name){const Ce=se===q.Num;return ue?Ce?(0,r._)`"[" + ${ne} + "]"`:(0,r._)`"['" + ${ne} + "']"`:Ce?(0,r._)`"/" + ${ne}`:(0,r._)`"/" + ${ne}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return ue?(0,r.getProperty)(ne).toString():"/"+S(ne)}c.getErrorPath=ee;function ie(ne,se,ue=ne.opts.strictSchema){if(ue){if(se=`strict mode: ${se}`,ue===!0)throw new Error(se);ne.self.logger.warn(se)}}c.checkStrictMode=ie})(qi);var Cs={};Object.defineProperty(Cs,"__esModule",{value:!0});const mn=Oi,xv={data:new mn.Name("data"),valCxt:new mn.Name("valCxt"),instancePath:new mn.Name("instancePath"),parentData:new mn.Name("parentData"),parentDataProperty:new mn.Name("parentDataProperty"),rootData:new mn.Name("rootData"),dynamicAnchors:new mn.Name("dynamicAnchors"),vErrors:new mn.Name("vErrors"),errors:new mn.Name("errors"),this:new mn.Name("this"),self:new mn.Name("self"),scope:new mn.Name("scope"),json:new mn.Name("json"),jsonPos:new mn.Name("jsonPos"),jsonLen:new mn.Name("jsonLen"),jsonPart:new mn.Name("jsonPart")};Cs.default=xv;(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.extendErrors=c.resetErrorsCount=c.reportExtraError=c.reportError=c.keyword$DataError=c.keywordError=void 0;const r=Oi,a=qi,l=Cs;c.keywordError={message:({keyword:R})=>(0,r.str)`must pass "${R}" keyword validation`},c.keyword$DataError={message:({keyword:R,schemaType:D})=>D?(0,r.str)`"${R}" keyword must be ${D} ($data)`:(0,r.str)`"${R}" keyword is invalid ($data)`};function u(R,D=c.keywordError,F,q){const{it:ee}=R,{gen:ie,compositeRule:ne,allErrors:se}=ee,ue=S(R,D,F);q??(ne||se)?g(ie,ue):v(ee,(0,r._)`[${ue}]`)}c.reportError=u;function f(R,D=c.keywordError,F){const{it:q}=R,{gen:ee,compositeRule:ie,allErrors:ne}=q,se=S(R,D,F);g(ee,se),ie||ne||v(q,l.default.vErrors)}c.reportExtraError=f;function d(R,D){R.assign(l.default.errors,D),R.if((0,r._)`${l.default.vErrors} !== null`,()=>R.if(D,()=>R.assign((0,r._)`${l.default.vErrors}.length`,D),()=>R.assign(l.default.vErrors,null)))}c.resetErrorsCount=d;function n({gen:R,keyword:D,schemaValue:F,data:q,errsCount:ee,it:ie}){if(ee===void 0)throw new Error("ajv implementation error");const ne=R.name("err");R.forRange("i",ee,l.default.errors,se=>{R.const(ne,(0,r._)`${l.default.vErrors}[${se}]`),R.if((0,r._)`${ne}.instancePath === undefined`,()=>R.assign((0,r._)`${ne}.instancePath`,(0,r.strConcat)(l.default.instancePath,ie.errorPath))),R.assign((0,r._)`${ne}.schemaPath`,(0,r.str)`${ie.errSchemaPath}/${D}`),ie.opts.verbose&&(R.assign((0,r._)`${ne}.schema`,F),R.assign((0,r._)`${ne}.data`,q))})}c.extendErrors=n;function g(R,D){const F=R.const("err",D);R.if((0,r._)`${l.default.vErrors} === null`,()=>R.assign(l.default.vErrors,(0,r._)`[${F}]`),(0,r._)`${l.default.vErrors}.push(${F})`),R.code((0,r._)`${l.default.errors}++`)}function v(R,D){const{gen:F,validateName:q,schemaEnv:ee}=R;ee.$async?F.throw((0,r._)`new ${R.ValidationError}(${D})`):(F.assign((0,r._)`${q}.errors`,D),F.return(!1))}const E={keyword:new r.Name("keyword"),schemaPath:new r.Name("schemaPath"),params:new r.Name("params"),propertyName:new r.Name("propertyName"),message:new r.Name("message"),schema:new r.Name("schema"),parentSchema:new r.Name("parentSchema")};function S(R,D,F){const{createErrors:q}=R.it;return q===!1?(0,r._)`{}`:T(R,D,F)}function T(R,D,F={}){const{gen:q,it:ee}=R,ie=[k(ee,F),z(R,F)];return A(R,D,ie),q.object(...ie)}function k({errorPath:R},{instancePath:D}){const F=D?(0,r.str)`${R}${(0,a.getErrorPath)(D,a.Type.Str)}`:R;return[l.default.instancePath,(0,r.strConcat)(l.default.instancePath,F)]}function z({keyword:R,it:{errSchemaPath:D}},{schemaPath:F,parentSchema:q}){let ee=q?D:(0,r.str)`${D}/${R}`;return F&&(ee=(0,r.str)`${ee}${(0,a.getErrorPath)(F,a.Type.Str)}`),[E.schemaPath,ee]}function A(R,{params:D,message:F},q){const{keyword:ee,data:ie,schemaValue:ne,it:se}=R,{opts:ue,propertyName:Ce,topSchemaRef:ye,schemaPath:Xe}=se;q.push([E.keyword,ee],[E.params,typeof D=="function"?D(R):D||(0,r._)`{}`]),ue.messages&&q.push([E.message,typeof F=="function"?F(R):F]),ue.verbose&&q.push([E.schema,ne],[E.parentSchema,(0,r._)`${ye}${Xe}`],[l.default.data,ie]),Ce&&q.push([E.propertyName,Ce])}})(vc);var zm;function Ev(){if(zm)return Ua;zm=1,Object.defineProperty(Ua,"__esModule",{value:!0}),Ua.boolOrEmptySchema=Ua.topBoolOrEmptySchema=void 0;const c=vc,r=Oi,a=Cs,l={message:"boolean schema is false"};function u(n){const{gen:g,schema:v,validateName:E}=n;v===!1?d(n,!1):typeof v=="object"&&v.$async===!0?g.return(a.default.data):(g.assign((0,r._)`${E}.errors`,null),g.return(!0))}Ua.topBoolOrEmptySchema=u;function f(n,g){const{gen:v,schema:E}=n;E===!1?(v.var(g,!1),d(n)):v.var(g,!0)}Ua.boolOrEmptySchema=f;function d(n,g){const{gen:v,data:E}=n,S={gen:v,keyword:"false schema",data:E,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:n};(0,c.reportError)(S,l,void 0,g)}return Ua}var mc={},Ha={};Object.defineProperty(Ha,"__esModule",{value:!0});Ha.getRules=Ha.isJSONType=void 0;const Sv=["string","number","integer","boolean","null","object","array"],kv=new Set(Sv);function Tv(c){return typeof c=="string"&&kv.has(c)}Ha.isJSONType=Tv;function Cv(){const c={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...c,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},c.number,c.string,c.array,c.object],post:{rules:[]},all:{},keywords:{}}}Ha.getRules=Cv;var Vs={};Object.defineProperty(Vs,"__esModule",{value:!0});Vs.shouldUseRule=Vs.shouldUseGroup=Vs.schemaHasRulesForType=void 0;function Iv({schema:c,self:r},a){const l=r.RULES.types[a];return l&&l!==!0&&O_(c,l)}Vs.schemaHasRulesForType=Iv;function O_(c,r){return r.rules.some(a=>F_(c,a))}Vs.shouldUseGroup=O_;function F_(c,r){var a;return c[r.keyword]!==void 0||((a=r.definition.implements)===null||a===void 0?void 0:a.some(l=>c[l]!==void 0))}Vs.shouldUseRule=F_;(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.reportTypeError=c.checkDataTypes=c.checkDataType=c.coerceAndCheckDataType=c.getJSONTypes=c.getSchemaTypes=c.DataType=void 0;const r=Ha,a=Vs,l=vc,u=Oi,f=qi;var d;(function(q){q[q.Correct=0]="Correct",q[q.Wrong=1]="Wrong"})(d=c.DataType||(c.DataType={}));function n(q){const ee=g(q.type);if(ee.includes("null")){if(q.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!ee.length&&q.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');q.nullable===!0&&ee.push("null")}return ee}c.getSchemaTypes=n;function g(q){const ee=Array.isArray(q)?q:q?[q]:[];if(ee.every(r.isJSONType))return ee;throw new Error("type must be JSONType or JSONType[]: "+ee.join(","))}c.getJSONTypes=g;function v(q,ee){const{gen:ie,data:ne,opts:se}=q,ue=S(ee,se.coerceTypes),Ce=ee.length>0&&!(ue.length===0&&ee.length===1&&(0,a.schemaHasRulesForType)(q,ee[0]));if(Ce){const ye=A(ee,ne,se.strictNumbers,d.Wrong);ie.if(ye,()=>{ue.length?T(q,ee,ue):D(q)})}return Ce}c.coerceAndCheckDataType=v;const E=new Set(["string","number","integer","boolean","null"]);function S(q,ee){return ee?q.filter(ie=>E.has(ie)||ee==="array"&&ie==="array"):[]}function T(q,ee,ie){const{gen:ne,data:se,opts:ue}=q,Ce=ne.let("dataType",(0,u._)`typeof ${se}`),ye=ne.let("coerced",(0,u._)`undefined`);ue.coerceTypes==="array"&&ne.if((0,u._)`${Ce} == 'object' && Array.isArray(${se}) && ${se}.length == 1`,()=>ne.assign(se,(0,u._)`${se}[0]`).assign(Ce,(0,u._)`typeof ${se}`).if(A(ee,se,ue.strictNumbers),()=>ne.assign(ye,se))),ne.if((0,u._)`${ye} !== undefined`);for(const ae of ie)(E.has(ae)||ae==="array"&&ue.coerceTypes==="array")&&Xe(ae);ne.else(),D(q),ne.endIf(),ne.if((0,u._)`${ye} !== undefined`,()=>{ne.assign(se,ye),k(q,ye)});function Xe(ae){switch(ae){case"string":ne.elseIf((0,u._)`${Ce} == "number" || ${Ce} == "boolean"`).assign(ye,(0,u._)`"" + ${se}`).elseIf((0,u._)`${se} === null`).assign(ye,(0,u._)`""`);return;case"number":ne.elseIf((0,u._)`${Ce} == "boolean" || ${se} === null
              || (${Ce} == "string" && ${se} && ${se} == +${se})`).assign(ye,(0,u._)`+${se}`);return;case"integer":ne.elseIf((0,u._)`${Ce} === "boolean" || ${se} === null
              || (${Ce} === "string" && ${se} && ${se} == +${se} && !(${se} % 1))`).assign(ye,(0,u._)`+${se}`);return;case"boolean":ne.elseIf((0,u._)`${se} === "false" || ${se} === 0 || ${se} === null`).assign(ye,!1).elseIf((0,u._)`${se} === "true" || ${se} === 1`).assign(ye,!0);return;case"null":ne.elseIf((0,u._)`${se} === "" || ${se} === 0 || ${se} === false`),ne.assign(ye,null);return;case"array":ne.elseIf((0,u._)`${Ce} === "string" || ${Ce} === "number"
              || ${Ce} === "boolean" || ${se} === null`).assign(ye,(0,u._)`[${se}]`)}}}function k({gen:q,parentData:ee,parentDataProperty:ie},ne){q.if((0,u._)`${ee} !== undefined`,()=>q.assign((0,u._)`${ee}[${ie}]`,ne))}function z(q,ee,ie,ne=d.Correct){const se=ne===d.Correct?u.operators.EQ:u.operators.NEQ;let ue;switch(q){case"null":return(0,u._)`${ee} ${se} null`;case"array":ue=(0,u._)`Array.isArray(${ee})`;break;case"object":ue=(0,u._)`${ee} && typeof ${ee} == "object" && !Array.isArray(${ee})`;break;case"integer":ue=Ce((0,u._)`!(${ee} % 1) && !isNaN(${ee})`);break;case"number":ue=Ce();break;default:return(0,u._)`typeof ${ee} ${se} ${q}`}return ne===d.Correct?ue:(0,u.not)(ue);function Ce(ye=u.nil){return(0,u.and)((0,u._)`typeof ${ee} == "number"`,ye,ie?(0,u._)`isFinite(${ee})`:u.nil)}}c.checkDataType=z;function A(q,ee,ie,ne){if(q.length===1)return z(q[0],ee,ie,ne);let se;const ue=(0,f.toHash)(q);if(ue.array&&ue.object){const Ce=(0,u._)`typeof ${ee} != "object"`;se=ue.null?Ce:(0,u._)`!${ee} || ${Ce}`,delete ue.null,delete ue.array,delete ue.object}else se=u.nil;ue.number&&delete ue.integer;for(const Ce in ue)se=(0,u.and)(se,z(Ce,ee,ie,ne));return se}c.checkDataTypes=A;const R={message:({schema:q})=>`must be ${q}`,params:({schema:q,schemaValue:ee})=>typeof q=="string"?(0,u._)`{type: ${q}}`:(0,u._)`{type: ${ee}}`};function D(q){const ee=F(q);(0,l.reportError)(ee,R)}c.reportTypeError=D;function F(q){const{gen:ee,data:ie,schema:ne}=q,se=(0,f.schemaRefOrVal)(q,ne,"type");return{gen:ee,keyword:"type",data:ie,schema:ne.type,schemaCode:se,schemaValue:se,parentSchema:ne,params:{},it:q}}})(mc);var nc={},Mm;function Av(){if(Mm)return nc;Mm=1,Object.defineProperty(nc,"__esModule",{value:!0}),nc.assignDefaults=void 0;const c=Oi,r=qi;function a(u,f){const{properties:d,items:n}=u.schema;if(f==="object"&&d)for(const g in d)l(u,g,d[g].default);else f==="array"&&Array.isArray(n)&&n.forEach((g,v)=>l(u,v,g.default))}nc.assignDefaults=a;function l(u,f,d){const{gen:n,compositeRule:g,data:v,opts:E}=u;if(d===void 0)return;const S=(0,c._)`${v}${(0,c.getProperty)(f)}`;if(g){(0,r.checkStrictMode)(u,`default is ignored for: ${S}`);return}let T=(0,c._)`${S} === undefined`;E.useDefaults==="empty"&&(T=(0,c._)`${T} || ${S} === null || ${S} === ""`),n.if(T,(0,c._)`${S} = ${(0,c.stringify)(d)}`)}return nc}var hs={},Bi={};Object.defineProperty(Bi,"__esModule",{value:!0});Bi.validateUnion=Bi.validateArray=Bi.usePattern=Bi.callValidateCode=Bi.schemaProperties=Bi.allSchemaProperties=Bi.noPropertyInData=Bi.propertyInData=Bi.isOwnProperty=Bi.hasPropFunc=Bi.reportMissingProp=Bi.checkMissingProp=Bi.checkReportMissingProp=void 0;const cr=Oi,Of=qi,ca=Cs,Pv=qi;function zv(c,r){const{gen:a,data:l,it:u}=c;a.if(Nf(a,l,r,u.opts.ownProperties),()=>{c.setParams({missingProperty:(0,cr._)`${r}`},!0),c.error()})}Bi.checkReportMissingProp=zv;function Mv({gen:c,data:r,it:{opts:a}},l,u){return(0,cr.or)(...l.map(f=>(0,cr.and)(Nf(c,r,f,a.ownProperties),(0,cr._)`${u} = ${f}`)))}Bi.checkMissingProp=Mv;function Dv(c,r){c.setParams({missingProperty:r},!0),c.error()}Bi.reportMissingProp=Dv;function N_(c){return c.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,cr._)`Object.prototype.hasOwnProperty`})}Bi.hasPropFunc=N_;function Ff(c,r,a){return(0,cr._)`${N_(c)}.call(${r}, ${a})`}Bi.isOwnProperty=Ff;function Lv(c,r,a,l){const u=(0,cr._)`${r}${(0,cr.getProperty)(a)} !== undefined`;return l?(0,cr._)`${u} && ${Ff(c,r,a)}`:u}Bi.propertyInData=Lv;function Nf(c,r,a,l){const u=(0,cr._)`${r}${(0,cr.getProperty)(a)} === undefined`;return l?(0,cr.or)(u,(0,cr.not)(Ff(c,r,a))):u}Bi.noPropertyInData=Nf;function U_(c){return c?Object.keys(c).filter(r=>r!=="__proto__"):[]}Bi.allSchemaProperties=U_;function Rv(c,r){return U_(r).filter(a=>!(0,Of.alwaysValidSchema)(c,r[a]))}Bi.schemaProperties=Rv;function Bv({schemaCode:c,data:r,it:{gen:a,topSchemaRef:l,schemaPath:u,errorPath:f},it:d},n,g,v){const E=v?(0,cr._)`${c}, ${r}, ${l}${u}`:r,S=[[ca.default.instancePath,(0,cr.strConcat)(ca.default.instancePath,f)],[ca.default.parentData,d.parentData],[ca.default.parentDataProperty,d.parentDataProperty],[ca.default.rootData,ca.default.rootData]];d.opts.dynamicRef&&S.push([ca.default.dynamicAnchors,ca.default.dynamicAnchors]);const T=(0,cr._)`${E}, ${a.object(...S)}`;return g!==cr.nil?(0,cr._)`${n}.call(${g}, ${T})`:(0,cr._)`${n}(${T})`}Bi.callValidateCode=Bv;const Ov=(0,cr._)`new RegExp`;function Fv({gen:c,it:{opts:r}},a){const l=r.unicodeRegExp?"u":"",{regExp:u}=r.code,f=u(a,l);return c.scopeValue("pattern",{key:f.toString(),ref:f,code:(0,cr._)`${u.code==="new RegExp"?Ov:(0,Pv.useFunc)(c,u)}(${a}, ${l})`})}Bi.usePattern=Fv;function Nv(c){const{gen:r,data:a,keyword:l,it:u}=c,f=r.name("valid");if(u.allErrors){const n=r.let("valid",!0);return d(()=>r.assign(n,!1)),n}return r.var(f,!0),d(()=>r.break()),f;function d(n){const g=r.const("len",(0,cr._)`${a}.length`);r.forRange("i",0,g,v=>{c.subschema({keyword:l,dataProp:v,dataPropType:Of.Type.Num},f),r.if((0,cr.not)(f),n)})}}Bi.validateArray=Nv;function Uv(c){const{gen:r,schema:a,keyword:l,it:u}=c;if(!Array.isArray(a))throw new Error("ajv implementation error");if(a.some(g=>(0,Of.alwaysValidSchema)(u,g))&&!u.opts.unevaluated)return;const d=r.let("valid",!1),n=r.name("_valid");r.block(()=>a.forEach((g,v)=>{const E=c.subschema({keyword:l,schemaProp:v,compositeRule:!0},n);r.assign(d,(0,cr._)`${d} || ${n}`),c.mergeValidEvaluated(E,n)||r.if((0,cr.not)(d))})),c.result(d,()=>c.reset(),()=>c.error(!0))}Bi.validateUnion=Uv;var Dm;function Vv(){if(Dm)return hs;Dm=1,Object.defineProperty(hs,"__esModule",{value:!0}),hs.validateKeywordUsage=hs.validSchemaType=hs.funcKeywordCode=hs.macroKeywordCode=void 0;const c=Oi,r=Cs,a=Bi,l=vc;function u(T,k){const{gen:z,keyword:A,schema:R,parentSchema:D,it:F}=T,q=k.macro.call(F.self,R,D,F),ee=v(z,A,q);F.opts.validateSchema!==!1&&F.self.validateSchema(q,!0);const ie=z.name("valid");T.subschema({schema:q,schemaPath:c.nil,errSchemaPath:`${F.errSchemaPath}/${A}`,topSchemaRef:ee,compositeRule:!0},ie),T.pass(ie,()=>T.error(!0))}hs.macroKeywordCode=u;function f(T,k){var z;const{gen:A,keyword:R,schema:D,parentSchema:F,$data:q,it:ee}=T;g(ee,k);const ie=!q&&k.compile?k.compile.call(ee.self,D,F,ee):k.validate,ne=v(A,R,ie),se=A.let("valid");T.block$data(se,ue),T.ok((z=k.valid)!==null&&z!==void 0?z:se);function ue(){if(k.errors===!1)Xe(),k.modifying&&d(T),ae(()=>T.error());else{const Le=k.async?Ce():ye();k.modifying&&d(T),ae(()=>n(T,Le))}}function Ce(){const Le=A.let("ruleErrs",null);return A.try(()=>Xe((0,c._)`await `),Z=>A.assign(se,!1).if((0,c._)`${Z} instanceof ${ee.ValidationError}`,()=>A.assign(Le,(0,c._)`${Z}.errors`),()=>A.throw(Z))),Le}function ye(){const Le=(0,c._)`${ne}.errors`;return A.assign(Le,null),Xe(c.nil),Le}function Xe(Le=k.async?(0,c._)`await `:c.nil){const Z=ee.opts.passContext?r.default.this:r.default.self,tt=!("compile"in k&&!q||k.schema===!1);A.assign(se,(0,c._)`${Le}${(0,a.callValidateCode)(T,ne,Z,tt)}`,k.modifying)}function ae(Le){var Z;A.if((0,c.not)((Z=k.valid)!==null&&Z!==void 0?Z:se),Le)}}hs.funcKeywordCode=f;function d(T){const{gen:k,data:z,it:A}=T;k.if(A.parentData,()=>k.assign(z,(0,c._)`${A.parentData}[${A.parentDataProperty}]`))}function n(T,k){const{gen:z}=T;z.if((0,c._)`Array.isArray(${k})`,()=>{z.assign(r.default.vErrors,(0,c._)`${r.default.vErrors} === null ? ${k} : ${r.default.vErrors}.concat(${k})`).assign(r.default.errors,(0,c._)`${r.default.vErrors}.length`),(0,l.extendErrors)(T)},()=>T.error())}function g({schemaEnv:T},k){if(k.async&&!T.$async)throw new Error("async keyword in sync schema")}function v(T,k,z){if(z===void 0)throw new Error(`keyword "${k}" failed to compile`);return T.scopeValue("keyword",typeof z=="function"?{ref:z}:{ref:z,code:(0,c.stringify)(z)})}function E(T,k,z=!1){return!k.length||k.some(A=>A==="array"?Array.isArray(T):A==="object"?T&&typeof T=="object"&&!Array.isArray(T):typeof T==A||z&&typeof T>"u")}hs.validSchemaType=E;function S({schema:T,opts:k,self:z,errSchemaPath:A},R,D){if(Array.isArray(R.keyword)?!R.keyword.includes(D):R.keyword!==D)throw new Error("ajv implementation error");const F=R.dependencies;if(F!=null&&F.some(q=>!Object.prototype.hasOwnProperty.call(T,q)))throw new Error(`parent schema must have dependencies of ${D}: ${F.join(",")}`);if(R.validateSchema&&!R.validateSchema(T[D])){const ee=`keyword "${D}" value is invalid at path "${A}": `+z.errorsText(R.validateSchema.errors);if(k.validateSchema==="log")z.logger.error(ee);else throw new Error(ee)}}return hs.validateKeywordUsage=S,hs}var Us={},Lm;function $v(){if(Lm)return Us;Lm=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us.extendSubschemaMode=Us.extendSubschemaData=Us.getSubschema=void 0;const c=Oi,r=qi;function a(f,{keyword:d,schemaProp:n,schema:g,schemaPath:v,errSchemaPath:E,topSchemaRef:S}){if(d!==void 0&&g!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(d!==void 0){const T=f.schema[d];return n===void 0?{schema:T,schemaPath:(0,c._)`${f.schemaPath}${(0,c.getProperty)(d)}`,errSchemaPath:`${f.errSchemaPath}/${d}`}:{schema:T[n],schemaPath:(0,c._)`${f.schemaPath}${(0,c.getProperty)(d)}${(0,c.getProperty)(n)}`,errSchemaPath:`${f.errSchemaPath}/${d}/${(0,r.escapeFragment)(n)}`}}if(g!==void 0){if(v===void 0||E===void 0||S===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:g,schemaPath:v,topSchemaRef:S,errSchemaPath:E}}throw new Error('either "keyword" or "schema" must be passed')}Us.getSubschema=a;function l(f,d,{dataProp:n,dataPropType:g,data:v,dataTypes:E,propertyName:S}){if(v!==void 0&&n!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:T}=d;if(n!==void 0){const{errorPath:z,dataPathArr:A,opts:R}=d,D=T.let("data",(0,c._)`${d.data}${(0,c.getProperty)(n)}`,!0);k(D),f.errorPath=(0,c.str)`${z}${(0,r.getErrorPath)(n,g,R.jsPropertySyntax)}`,f.parentDataProperty=(0,c._)`${n}`,f.dataPathArr=[...A,f.parentDataProperty]}if(v!==void 0){const z=v instanceof c.Name?v:T.let("data",v,!0);k(z),S!==void 0&&(f.propertyName=S)}E&&(f.dataTypes=E);function k(z){f.data=z,f.dataLevel=d.dataLevel+1,f.dataTypes=[],d.definedProperties=new Set,f.parentData=d.data,f.dataNames=[...d.dataNames,z]}}Us.extendSubschemaData=l;function u(f,{jtdDiscriminator:d,jtdMetadata:n,compositeRule:g,createErrors:v,allErrors:E}){g!==void 0&&(f.compositeRule=g),v!==void 0&&(f.createErrors=v),E!==void 0&&(f.allErrors=E),f.jtdDiscriminator=d,f.jtdMetadata=n}return Us.extendSubschemaMode=u,Us}var an={},V_=function c(r,a){if(r===a)return!0;if(r&&a&&typeof r=="object"&&typeof a=="object"){if(r.constructor!==a.constructor)return!1;var l,u,f;if(Array.isArray(r)){if(l=r.length,l!=a.length)return!1;for(u=l;u--!==0;)if(!c(r[u],a[u]))return!1;return!0}if(r.constructor===RegExp)return r.source===a.source&&r.flags===a.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===a.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===a.toString();if(f=Object.keys(r),l=f.length,l!==Object.keys(a).length)return!1;for(u=l;u--!==0;)if(!Object.prototype.hasOwnProperty.call(a,f[u]))return!1;for(u=l;u--!==0;){var d=f[u];if(!c(r[d],a[d]))return!1}return!0}return r!==r&&a!==a},$_={exports:{}},ha=$_.exports=function(c,r,a){typeof r=="function"&&(a=r,r={}),a=r.cb||a;var l=typeof a=="function"?a:a.pre||function(){},u=a.post||function(){};zu(r,l,u,c,"",c)};ha.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};ha.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};ha.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};ha.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function zu(c,r,a,l,u,f,d,n,g,v){if(l&&typeof l=="object"&&!Array.isArray(l)){r(l,u,f,d,n,g,v);for(var E in l){var S=l[E];if(Array.isArray(S)){if(E in ha.arrayKeywords)for(var T=0;T<S.length;T++)zu(c,r,a,S[T],u+"/"+E+"/"+T,f,u,E,l,T)}else if(E in ha.propsKeywords){if(S&&typeof S=="object")for(var k in S)zu(c,r,a,S[k],u+"/"+E+"/"+jv(k),f,u,E,l,k)}else(E in ha.keywords||c.allKeys&&!(E in ha.skipKeywords))&&zu(c,r,a,S,u+"/"+E,f,u,E,l)}a(l,u,f,d,n,g,v)}}function jv(c){return c.replace(/~/g,"~0").replace(/\//g,"~1")}var qv=$_.exports;Object.defineProperty(an,"__esModule",{value:!0});an.getSchemaRefs=an.resolveUrl=an.normalizeId=an._getFullPath=an.getFullPath=an.inlineRef=void 0;const Zv=qi,Gv=V_,Hv=qv,Wv=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Kv(c,r=!0){return typeof c=="boolean"?!0:r===!0?!Sf(c):r?j_(c)<=r:!1}an.inlineRef=Kv;const Xv=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Sf(c){for(const r in c){if(Xv.has(r))return!0;const a=c[r];if(Array.isArray(a)&&a.some(Sf)||typeof a=="object"&&Sf(a))return!0}return!1}function j_(c){let r=0;for(const a in c){if(a==="$ref")return 1/0;if(r++,!Wv.has(a)&&(typeof c[a]=="object"&&(0,Zv.eachItem)(c[a],l=>r+=j_(l)),r===1/0))return 1/0}return r}function q_(c,r="",a){a!==!1&&(r=Zo(r));const l=c.parse(r);return Z_(c,l)}an.getFullPath=q_;function Z_(c,r){return c.serialize(r).split("#")[0]+"#"}an._getFullPath=Z_;const Jv=/#\/?$/;function Zo(c){return c?c.replace(Jv,""):""}an.normalizeId=Zo;function Yv(c,r,a){return a=Zo(a),c.resolve(r,a)}an.resolveUrl=Yv;const Qv=/^[a-z_][-a-z0-9._]*$/i;function eb(c,r){if(typeof c=="boolean")return{};const{schemaId:a,uriResolver:l}=this.opts,u=Zo(c[a]||r),f={"":u},d=q_(l,u,!1),n={},g=new Set;return Hv(c,{allKeys:!0},(S,T,k,z)=>{if(z===void 0)return;const A=d+T;let R=f[z];typeof S[a]=="string"&&(R=D.call(this,S[a])),F.call(this,S.$anchor),F.call(this,S.$dynamicAnchor),f[T]=R;function D(q){const ee=this.opts.uriResolver.resolve;if(q=Zo(R?ee(R,q):q),g.has(q))throw E(q);g.add(q);let ie=this.refs[q];return typeof ie=="string"&&(ie=this.refs[ie]),typeof ie=="object"?v(S,ie.schema,q):q!==Zo(A)&&(q[0]==="#"?(v(S,n[q],q),n[q]=S):this.refs[q]=A),q}function F(q){if(typeof q=="string"){if(!Qv.test(q))throw new Error(`invalid anchor "${q}"`);D.call(this,`#${q}`)}}}),n;function v(S,T,k){if(T!==void 0&&!Gv(S,T))throw E(k)}function E(S){return new Error(`reference "${S}" resolves to more than one schema`)}}an.getSchemaRefs=eb;var Rm;function Ju(){if(Rm)return Ns;Rm=1,Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.getData=Ns.KeywordCxt=Ns.validateFunctionCode=void 0;const c=Ev(),r=mc,a=Vs,l=mc,u=Av(),f=Vv(),d=$v(),n=Oi,g=Cs,v=an,E=qi,S=vc;function T(Fe){if(ie(Fe)&&(se(Fe),ee(Fe))){R(Fe);return}k(Fe,()=>(0,c.topBoolOrEmptySchema)(Fe))}Ns.validateFunctionCode=T;function k({gen:Fe,validateName:Se,schema:ct,schemaEnv:N,opts:Je},We){Je.code.es5?Fe.func(Se,(0,n._)`${g.default.data}, ${g.default.valCxt}`,N.$async,()=>{Fe.code((0,n._)`"use strict"; ${F(ct,Je)}`),A(Fe,Je),Fe.code(We)}):Fe.func(Se,(0,n._)`${g.default.data}, ${z(Je)}`,N.$async,()=>Fe.code(F(ct,Je)).code(We))}function z(Fe){return(0,n._)`{${g.default.instancePath}="", ${g.default.parentData}, ${g.default.parentDataProperty}, ${g.default.rootData}=${g.default.data}${Fe.dynamicRef?(0,n._)`, ${g.default.dynamicAnchors}={}`:n.nil}}={}`}function A(Fe,Se){Fe.if(g.default.valCxt,()=>{Fe.var(g.default.instancePath,(0,n._)`${g.default.valCxt}.${g.default.instancePath}`),Fe.var(g.default.parentData,(0,n._)`${g.default.valCxt}.${g.default.parentData}`),Fe.var(g.default.parentDataProperty,(0,n._)`${g.default.valCxt}.${g.default.parentDataProperty}`),Fe.var(g.default.rootData,(0,n._)`${g.default.valCxt}.${g.default.rootData}`),Se.dynamicRef&&Fe.var(g.default.dynamicAnchors,(0,n._)`${g.default.valCxt}.${g.default.dynamicAnchors}`)},()=>{Fe.var(g.default.instancePath,(0,n._)`""`),Fe.var(g.default.parentData,(0,n._)`undefined`),Fe.var(g.default.parentDataProperty,(0,n._)`undefined`),Fe.var(g.default.rootData,g.default.data),Se.dynamicRef&&Fe.var(g.default.dynamicAnchors,(0,n._)`{}`)})}function R(Fe){const{schema:Se,opts:ct,gen:N}=Fe;k(Fe,()=>{ct.$comment&&Se.$comment&&Le(Fe),ye(Fe),N.let(g.default.vErrors,null),N.let(g.default.errors,0),ct.unevaluated&&D(Fe),ue(Fe),Z(Fe)})}function D(Fe){const{gen:Se,validateName:ct}=Fe;Fe.evaluated=Se.const("evaluated",(0,n._)`${ct}.evaluated`),Se.if((0,n._)`${Fe.evaluated}.dynamicProps`,()=>Se.assign((0,n._)`${Fe.evaluated}.props`,(0,n._)`undefined`)),Se.if((0,n._)`${Fe.evaluated}.dynamicItems`,()=>Se.assign((0,n._)`${Fe.evaluated}.items`,(0,n._)`undefined`))}function F(Fe,Se){const ct=typeof Fe=="object"&&Fe[Se.schemaId];return ct&&(Se.code.source||Se.code.process)?(0,n._)`/*# sourceURL=${ct} */`:n.nil}function q(Fe,Se){if(ie(Fe)&&(se(Fe),ee(Fe))){ne(Fe,Se);return}(0,c.boolOrEmptySchema)(Fe,Se)}function ee({schema:Fe,self:Se}){if(typeof Fe=="boolean")return!Fe;for(const ct in Fe)if(Se.RULES.all[ct])return!0;return!1}function ie(Fe){return typeof Fe.schema!="boolean"}function ne(Fe,Se){const{schema:ct,gen:N,opts:Je}=Fe;Je.$comment&&ct.$comment&&Le(Fe),Xe(Fe),ae(Fe);const We=N.const("_errs",g.default.errors);ue(Fe,We),N.var(Se,(0,n._)`${We} === ${g.default.errors}`)}function se(Fe){(0,E.checkUnknownRules)(Fe),Ce(Fe)}function ue(Fe,Se){if(Fe.opts.jtd)return $t(Fe,[],!1,Se);const ct=(0,r.getSchemaTypes)(Fe.schema),N=(0,r.coerceAndCheckDataType)(Fe,ct);$t(Fe,ct,!N,Se)}function Ce(Fe){const{schema:Se,errSchemaPath:ct,opts:N,self:Je}=Fe;Se.$ref&&N.ignoreKeywordsWithRef&&(0,E.schemaHasRulesButRef)(Se,Je.RULES)&&Je.logger.warn(`$ref: keywords ignored in schema at path "${ct}"`)}function ye(Fe){const{schema:Se,opts:ct}=Fe;Se.default!==void 0&&ct.useDefaults&&ct.strictSchema&&(0,E.checkStrictMode)(Fe,"default is ignored in the schema root")}function Xe(Fe){const Se=Fe.schema[Fe.opts.schemaId];Se&&(Fe.baseId=(0,v.resolveUrl)(Fe.opts.uriResolver,Fe.baseId,Se))}function ae(Fe){if(Fe.schema.$async&&!Fe.schemaEnv.$async)throw new Error("async schema in sync schema")}function Le({gen:Fe,schemaEnv:Se,schema:ct,errSchemaPath:N,opts:Je}){const We=ct.$comment;if(Je.$comment===!0)Fe.code((0,n._)`${g.default.self}.logger.log(${We})`);else if(typeof Je.$comment=="function"){const we=(0,n.str)`${N}/$comment`,me=Fe.scopeValue("root",{ref:Se.root});Fe.code((0,n._)`${g.default.self}.opts.$comment(${We}, ${we}, ${me}.schema)`)}}function Z(Fe){const{gen:Se,schemaEnv:ct,validateName:N,ValidationError:Je,opts:We}=Fe;ct.$async?Se.if((0,n._)`${g.default.errors} === 0`,()=>Se.return(g.default.data),()=>Se.throw((0,n._)`new ${Je}(${g.default.vErrors})`)):(Se.assign((0,n._)`${N}.errors`,g.default.vErrors),We.unevaluated&&tt(Fe),Se.return((0,n._)`${g.default.errors} === 0`))}function tt({gen:Fe,evaluated:Se,props:ct,items:N}){ct instanceof n.Name&&Fe.assign((0,n._)`${Se}.props`,ct),N instanceof n.Name&&Fe.assign((0,n._)`${Se}.items`,N)}function $t(Fe,Se,ct,N){const{gen:Je,schema:We,data:we,allErrors:me,opts:Ne,self:ht}=Fe,{RULES:ke}=ht;if(We.$ref&&(Ne.ignoreKeywordsWithRef||!(0,E.schemaHasRulesButRef)(We,ke))){Je.block(()=>Ct(Fe,"$ref",ke.all.$ref.definition));return}Ne.jtd||Jt(Fe,Se),Je.block(()=>{for(const xt of ke.rules)Qe(xt);Qe(ke.post)});function Qe(xt){(0,a.shouldUseGroup)(We,xt)&&(xt.type?(Je.if((0,l.checkDataType)(xt.type,we,Ne.strictNumbers)),ft(Fe,xt),Se.length===1&&Se[0]===xt.type&&ct&&(Je.else(),(0,l.reportTypeError)(Fe)),Je.endIf()):ft(Fe,xt),me||Je.if((0,n._)`${g.default.errors} === ${N||0}`))}}function ft(Fe,Se){const{gen:ct,schema:N,opts:{useDefaults:Je}}=Fe;Je&&(0,u.assignDefaults)(Fe,Se.type),ct.block(()=>{for(const We of Se.rules)(0,a.shouldUseRule)(N,We)&&Ct(Fe,We.keyword,We.definition,Se.type)})}function Jt(Fe,Se){Fe.schemaEnv.meta||!Fe.opts.strictTypes||(ut(Fe,Se),Fe.opts.allowUnionTypes||at(Fe,Se),le(Fe,Fe.dataTypes))}function ut(Fe,Se){if(Se.length){if(!Fe.dataTypes.length){Fe.dataTypes=Se;return}Se.forEach(ct=>{Re(Fe.dataTypes,ct)||he(Fe,`type "${ct}" not allowed by context "${Fe.dataTypes.join(",")}"`)}),Q(Fe,Se)}}function at(Fe,Se){Se.length>1&&!(Se.length===2&&Se.includes("null"))&&he(Fe,"use allowUnionTypes to allow union type keyword")}function le(Fe,Se){const ct=Fe.self.RULES.all;for(const N in ct){const Je=ct[N];if(typeof Je=="object"&&(0,a.shouldUseRule)(Fe.schema,Je)){const{type:We}=Je.definition;We.length&&!We.some(we=>Ee(Se,we))&&he(Fe,`missing type "${We.join(",")}" for keyword "${N}"`)}}}function Ee(Fe,Se){return Fe.includes(Se)||Se==="number"&&Fe.includes("integer")}function Re(Fe,Se){return Fe.includes(Se)||Se==="integer"&&Fe.includes("number")}function Q(Fe,Se){const ct=[];for(const N of Fe.dataTypes)Re(Se,N)?ct.push(N):Se.includes("integer")&&N==="number"&&ct.push("integer");Fe.dataTypes=ct}function he(Fe,Se){const ct=Fe.schemaEnv.baseId+Fe.errSchemaPath;Se+=` at "${ct}" (strictTypes)`,(0,E.checkStrictMode)(Fe,Se,Fe.opts.strictTypes)}class it{constructor(Se,ct,N){if((0,f.validateKeywordUsage)(Se,ct,N),this.gen=Se.gen,this.allErrors=Se.allErrors,this.keyword=N,this.data=Se.data,this.schema=Se.schema[N],this.$data=ct.$data&&Se.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,E.schemaRefOrVal)(Se,this.schema,N,this.$data),this.schemaType=ct.schemaType,this.parentSchema=Se.schema,this.params={},this.it=Se,this.def=ct,this.$data)this.schemaCode=Se.gen.const("vSchema",Bt(this.$data,Se));else if(this.schemaCode=this.schemaValue,!(0,f.validSchemaType)(this.schema,ct.schemaType,ct.allowUndefined))throw new Error(`${N} value must be ${JSON.stringify(ct.schemaType)}`);("code"in ct?ct.trackErrors:ct.errors!==!1)&&(this.errsCount=Se.gen.const("_errs",g.default.errors))}result(Se,ct,N){this.failResult((0,n.not)(Se),ct,N)}failResult(Se,ct,N){this.gen.if(Se),N?N():this.error(),ct?(this.gen.else(),ct(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(Se,ct){this.failResult((0,n.not)(Se),void 0,ct)}fail(Se){if(Se===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(Se),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(Se){if(!this.$data)return this.fail(Se);const{schemaCode:ct}=this;this.fail((0,n._)`${ct} !== undefined && (${(0,n.or)(this.invalid$data(),Se)})`)}error(Se,ct,N){if(ct){this.setParams(ct),this._error(Se,N),this.setParams({});return}this._error(Se,N)}_error(Se,ct){(Se?S.reportExtraError:S.reportError)(this,this.def.error,ct)}$dataError(){(0,S.reportError)(this,this.def.$dataError||S.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,S.resetErrorsCount)(this.gen,this.errsCount)}ok(Se){this.allErrors||this.gen.if(Se)}setParams(Se,ct){ct?Object.assign(this.params,Se):this.params=Se}block$data(Se,ct,N=n.nil){this.gen.block(()=>{this.check$data(Se,N),ct()})}check$data(Se=n.nil,ct=n.nil){if(!this.$data)return;const{gen:N,schemaCode:Je,schemaType:We,def:we}=this;N.if((0,n.or)((0,n._)`${Je} === undefined`,ct)),Se!==n.nil&&N.assign(Se,!0),(We.length||we.validateSchema)&&(N.elseIf(this.invalid$data()),this.$dataError(),Se!==n.nil&&N.assign(Se,!1)),N.else()}invalid$data(){const{gen:Se,schemaCode:ct,schemaType:N,def:Je,it:We}=this;return(0,n.or)(we(),me());function we(){if(N.length){if(!(ct instanceof n.Name))throw new Error("ajv implementation error");const Ne=Array.isArray(N)?N:[N];return(0,n._)`${(0,l.checkDataTypes)(Ne,ct,We.opts.strictNumbers,l.DataType.Wrong)}`}return n.nil}function me(){if(Je.validateSchema){const Ne=Se.scopeValue("validate$data",{ref:Je.validateSchema});return(0,n._)`!${Ne}(${ct})`}return n.nil}}subschema(Se,ct){const N=(0,d.getSubschema)(this.it,Se);(0,d.extendSubschemaData)(N,this.it,Se),(0,d.extendSubschemaMode)(N,Se);const Je={...this.it,...N,items:void 0,props:void 0};return q(Je,ct),Je}mergeEvaluated(Se,ct){const{it:N,gen:Je}=this;N.opts.unevaluated&&(N.props!==!0&&Se.props!==void 0&&(N.props=E.mergeEvaluated.props(Je,Se.props,N.props,ct)),N.items!==!0&&Se.items!==void 0&&(N.items=E.mergeEvaluated.items(Je,Se.items,N.items,ct)))}mergeValidEvaluated(Se,ct){const{it:N,gen:Je}=this;if(N.opts.unevaluated&&(N.props!==!0||N.items!==!0))return Je.if(ct,()=>this.mergeEvaluated(Se,n.Name)),!0}}Ns.KeywordCxt=it;function Ct(Fe,Se,ct,N){const Je=new it(Fe,ct,Se);"code"in ct?ct.code(Je,N):Je.$data&&ct.validate?(0,f.funcKeywordCode)(Je,ct):"macro"in ct?(0,f.macroKeywordCode)(Je,ct):(ct.compile||ct.validate)&&(0,f.funcKeywordCode)(Je,ct)}const bt=/^\/(?:[^~]|~0|~1)*$/,It=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Bt(Fe,{dataLevel:Se,dataNames:ct,dataPathArr:N}){let Je,We;if(Fe==="")return g.default.rootData;if(Fe[0]==="/"){if(!bt.test(Fe))throw new Error(`Invalid JSON-pointer: ${Fe}`);Je=Fe,We=g.default.rootData}else{const ht=It.exec(Fe);if(!ht)throw new Error(`Invalid JSON-pointer: ${Fe}`);const ke=+ht[1];if(Je=ht[2],Je==="#"){if(ke>=Se)throw new Error(Ne("property/index",ke));return N[Se-ke]}if(ke>Se)throw new Error(Ne("data",ke));if(We=ct[Se-ke],!Je)return We}let we=We;const me=Je.split("/");for(const ht of me)ht&&(We=(0,n._)`${We}${(0,n.getProperty)((0,E.unescapeJsonPointer)(ht))}`,we=(0,n._)`${we} && ${We}`);return we;function Ne(ht,ke){return`Cannot access ${ht} ${ke} levels up, current level is ${Se}`}}return Ns.getData=Bt,Ns}var bc={};Object.defineProperty(bc,"__esModule",{value:!0});class tb extends Error{constructor(r){super("validation failed"),this.errors=r,this.ajv=this.validation=!0}}bc.default=tb;var wc={};Object.defineProperty(wc,"__esModule",{value:!0});const pf=an;class ib extends Error{constructor(r,a,l,u){super(u||`can't resolve reference ${l} from id ${a}`),this.missingRef=(0,pf.resolveUrl)(r,a,l),this.missingSchema=(0,pf.normalizeId)((0,pf.getFullPath)(r,this.missingRef))}}wc.default=ib;var Bn={};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.resolveSchema=Bn.getCompilingSchema=Bn.resolveRef=Bn.compileSchema=Bn.SchemaEnv=void 0;const fs=Oi,rb=bc,Va=Cs,ms=an,Bm=qi,nb=Ju();class Yu{constructor(r){var a;this.refs={},this.dynamicAnchors={};let l;typeof r.schema=="object"&&(l=r.schema),this.schema=r.schema,this.schemaId=r.schemaId,this.root=r.root||this,this.baseId=(a=r.baseId)!==null&&a!==void 0?a:(0,ms.normalizeId)(l==null?void 0:l[r.schemaId||"$id"]),this.schemaPath=r.schemaPath,this.localRefs=r.localRefs,this.meta=r.meta,this.$async=l==null?void 0:l.$async,this.refs={}}}Bn.SchemaEnv=Yu;function Uf(c){const r=G_.call(this,c);if(r)return r;const a=(0,ms.getFullPath)(this.opts.uriResolver,c.root.baseId),{es5:l,lines:u}=this.opts.code,{ownProperties:f}=this.opts,d=new fs.CodeGen(this.scope,{es5:l,lines:u,ownProperties:f});let n;c.$async&&(n=d.scopeValue("Error",{ref:rb.default,code:(0,fs._)`require("ajv/dist/runtime/validation_error").default`}));const g=d.scopeName("validate");c.validateName=g;const v={gen:d,allErrors:this.opts.allErrors,data:Va.default.data,parentData:Va.default.parentData,parentDataProperty:Va.default.parentDataProperty,dataNames:[Va.default.data],dataPathArr:[fs.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:d.scopeValue("schema",this.opts.code.source===!0?{ref:c.schema,code:(0,fs.stringify)(c.schema)}:{ref:c.schema}),validateName:g,ValidationError:n,schema:c.schema,schemaEnv:c,rootId:a,baseId:c.baseId||a,schemaPath:fs.nil,errSchemaPath:c.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,fs._)`""`,opts:this.opts,self:this};let E;try{this._compilations.add(c),(0,nb.validateFunctionCode)(v),d.optimize(this.opts.code.optimize);const S=d.toString();E=`${d.scopeRefs(Va.default.scope)}return ${S}`,this.opts.code.process&&(E=this.opts.code.process(E,c));const k=new Function(`${Va.default.self}`,`${Va.default.scope}`,E)(this,this.scope.get());if(this.scope.value(g,{ref:k}),k.errors=null,k.schema=c.schema,k.schemaEnv=c,c.$async&&(k.$async=!0),this.opts.code.source===!0&&(k.source={validateName:g,validateCode:S,scopeValues:d._values}),this.opts.unevaluated){const{props:z,items:A}=v;k.evaluated={props:z instanceof fs.Name?void 0:z,items:A instanceof fs.Name?void 0:A,dynamicProps:z instanceof fs.Name,dynamicItems:A instanceof fs.Name},k.source&&(k.source.evaluated=(0,fs.stringify)(k.evaluated))}return c.validate=k,c}catch(S){throw delete c.validate,delete c.validateName,E&&this.logger.error("Error compiling schema, function code:",E),S}finally{this._compilations.delete(c)}}Bn.compileSchema=Uf;function sb(c,r,a){var l;a=(0,ms.resolveUrl)(this.opts.uriResolver,r,a);const u=c.refs[a];if(u)return u;let f=lb.call(this,c,a);if(f===void 0){const d=(l=c.localRefs)===null||l===void 0?void 0:l[a],{schemaId:n}=this.opts;d&&(f=new Yu({schema:d,schemaId:n,root:c,baseId:r}))}if(f!==void 0)return c.refs[a]=ab.call(this,f)}Bn.resolveRef=sb;function ab(c){return(0,ms.inlineRef)(c.schema,this.opts.inlineRefs)?c.schema:c.validate?c:Uf.call(this,c)}function G_(c){for(const r of this._compilations)if(ob(r,c))return r}Bn.getCompilingSchema=G_;function ob(c,r){return c.schema===r.schema&&c.root===r.root&&c.baseId===r.baseId}function lb(c,r){let a;for(;typeof(a=this.refs[r])=="string";)r=a;return a||this.schemas[r]||Qu.call(this,c,r)}function Qu(c,r){const a=this.opts.uriResolver.parse(r),l=(0,ms._getFullPath)(this.opts.uriResolver,a);let u=(0,ms.getFullPath)(this.opts.uriResolver,c.baseId,void 0);if(Object.keys(c.schema).length>0&&l===u)return mf.call(this,a,c);const f=(0,ms.normalizeId)(l),d=this.refs[f]||this.schemas[f];if(typeof d=="string"){const n=Qu.call(this,c,d);return typeof(n==null?void 0:n.schema)!="object"?void 0:mf.call(this,a,n)}if(typeof(d==null?void 0:d.schema)=="object"){if(d.validate||Uf.call(this,d),f===(0,ms.normalizeId)(r)){const{schema:n}=d,{schemaId:g}=this.opts,v=n[g];return v&&(u=(0,ms.resolveUrl)(this.opts.uriResolver,u,v)),new Yu({schema:n,schemaId:g,root:c,baseId:u})}return mf.call(this,a,d)}}Bn.resolveSchema=Qu;const cb=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function mf(c,{baseId:r,schema:a,root:l}){var u;if(((u=c.fragment)===null||u===void 0?void 0:u[0])!=="/")return;for(const n of c.fragment.slice(1).split("/")){if(typeof a=="boolean")return;const g=a[(0,Bm.unescapeFragment)(n)];if(g===void 0)return;a=g;const v=typeof a=="object"&&a[this.opts.schemaId];!cb.has(n)&&v&&(r=(0,ms.resolveUrl)(this.opts.uriResolver,r,v))}let f;if(typeof a!="boolean"&&a.$ref&&!(0,Bm.schemaHasRulesButRef)(a,this.RULES)){const n=(0,ms.resolveUrl)(this.opts.uriResolver,r,a.$ref);f=Qu.call(this,l,n)}const{schemaId:d}=this.opts;if(f=f||new Yu({schema:a,schemaId:d,root:l,baseId:r}),f.schema!==f.root.schema)return f}const ub="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",hb="Meta-schema for $data reference (JSON AnySchema extension proposal)",fb="object",db=["$data"],pb={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},mb=!1,gb={$id:ub,description:hb,type:fb,required:db,properties:pb,additionalProperties:mb};var Vf={},kf={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function(c,r){(function(a,l){l(r)})($o,function(a){function l(){for(var W=arguments.length,X=Array(W),oe=0;oe<W;oe++)X[oe]=arguments[oe];if(X.length>1){X[0]=X[0].slice(0,-1);for(var Ie=X.length-1,Ue=1;Ue<Ie;++Ue)X[Ue]=X[Ue].slice(1,-1);return X[Ie]=X[Ie].slice(1),X.join("")}else return X[0]}function u(W){return"(?:"+W+")"}function f(W){return W===void 0?"undefined":W===null?"null":Object.prototype.toString.call(W).split(" ").pop().split("]").shift().toLowerCase()}function d(W){return W.toUpperCase()}function n(W){return W!=null?W instanceof Array?W:typeof W.length!="number"||W.split||W.setInterval||W.call?[W]:Array.prototype.slice.call(W):[]}function g(W,X){var oe=W;if(X)for(var Ie in X)oe[Ie]=X[Ie];return oe}function v(W){var X="[A-Za-z]",oe="[0-9]",Ie=l(oe,"[A-Fa-f]"),Ue=u(u("%[EFef]"+Ie+"%"+Ie+Ie+"%"+Ie+Ie)+"|"+u("%[89A-Fa-f]"+Ie+"%"+Ie+Ie)+"|"+u("%"+Ie+Ie)),Et="[\\:\\/\\?\\#\\[\\]\\@]",yt="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",At=l(Et,yt),Gt=W?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",di=W?"[\\uE000-\\uF8FF]":"[]",ei=l(X,oe,"[\\-\\.\\_\\~]",Gt);u(X+l(X,oe,"[\\+\\-\\.]")+"*"),u(u(Ue+"|"+l(ei,yt,"[\\:]"))+"*");var ai=u(u("25[0-5]")+"|"+u("2[0-4]"+oe)+"|"+u("1"+oe+oe)+"|"+u("0?[1-9]"+oe)+"|0?0?"+oe),ui=u(ai+"\\."+ai+"\\."+ai+"\\."+ai),li=u(Ie+"{1,4}"),gi=u(u(li+"\\:"+li)+"|"+ui),Ii=u(u(li+"\\:")+"{6}"+gi),xi=u("\\:\\:"+u(li+"\\:")+"{5}"+gi),Vr=u(u(li)+"?\\:\\:"+u(li+"\\:")+"{4}"+gi),gn=u(u(u(li+"\\:")+"{0,1}"+li)+"?\\:\\:"+u(li+"\\:")+"{3}"+gi),dr=u(u(u(li+"\\:")+"{0,2}"+li)+"?\\:\\:"+u(li+"\\:")+"{2}"+gi),es=u(u(u(li+"\\:")+"{0,3}"+li)+"?\\:\\:"+li+"\\:"+gi),ts=u(u(u(li+"\\:")+"{0,4}"+li)+"?\\:\\:"+gi),Ti=u(u(u(li+"\\:")+"{0,5}"+li)+"?\\:\\:"+li),Kr=u(u(u(li+"\\:")+"{0,6}"+li)+"?\\:\\:"),ln=u([Ii,xi,Vr,gn,dr,es,ts,Ti,Kr].join("|")),ar=u(u(ei+"|"+Ue)+"+");u("[vV]"+Ie+"+\\."+l(ei,yt,"[\\:]")+"+"),u(u(Ue+"|"+l(ei,yt))+"*");var zr=u(Ue+"|"+l(ei,yt,"[\\:\\@]"));return u(u(Ue+"|"+l(ei,yt,"[\\@]"))+"+"),u(u(zr+"|"+l("[\\/\\?]",di))+"*"),{NOT_SCHEME:new RegExp(l("[^]",X,oe,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(l("[^\\%\\:]",ei,yt),"g"),NOT_HOST:new RegExp(l("[^\\%\\[\\]\\:]",ei,yt),"g"),NOT_PATH:new RegExp(l("[^\\%\\/\\:\\@]",ei,yt),"g"),NOT_PATH_NOSCHEME:new RegExp(l("[^\\%\\/\\@]",ei,yt),"g"),NOT_QUERY:new RegExp(l("[^\\%]",ei,yt,"[\\:\\@\\/\\?]",di),"g"),NOT_FRAGMENT:new RegExp(l("[^\\%]",ei,yt,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(l("[^]",ei,yt),"g"),UNRESERVED:new RegExp(ei,"g"),OTHER_CHARS:new RegExp(l("[^\\%]",ei,At),"g"),PCT_ENCODED:new RegExp(Ue,"g"),IPV4ADDRESS:new RegExp("^("+ui+")$"),IPV6ADDRESS:new RegExp("^\\[?("+ln+")"+u(u("\\%25|\\%(?!"+Ie+"{2})")+"("+ar+")")+"?\\]?$")}}var E=v(!1),S=v(!0),T=function(){function W(X,oe){var Ie=[],Ue=!0,Et=!1,yt=void 0;try{for(var At=X[Symbol.iterator](),Gt;!(Ue=(Gt=At.next()).done)&&(Ie.push(Gt.value),!(oe&&Ie.length===oe));Ue=!0);}catch(di){Et=!0,yt=di}finally{try{!Ue&&At.return&&At.return()}finally{if(Et)throw yt}}return Ie}return function(X,oe){if(Array.isArray(X))return X;if(Symbol.iterator in Object(X))return W(X,oe);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=function(W){if(Array.isArray(W)){for(var X=0,oe=Array(W.length);X<W.length;X++)oe[X]=W[X];return oe}else return Array.from(W)},z=2147483647,A=36,R=1,D=26,F=38,q=700,ee=72,ie=128,ne="-",se=/^xn--/,ue=/[^\0-\x7E]/,Ce=/[\x2E\u3002\uFF0E\uFF61]/g,ye={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Xe=A-R,ae=Math.floor,Le=String.fromCharCode;function Z(W){throw new RangeError(ye[W])}function tt(W,X){for(var oe=[],Ie=W.length;Ie--;)oe[Ie]=X(W[Ie]);return oe}function $t(W,X){var oe=W.split("@"),Ie="";oe.length>1&&(Ie=oe[0]+"@",W=oe[1]),W=W.replace(Ce,".");var Ue=W.split("."),Et=tt(Ue,X).join(".");return Ie+Et}function ft(W){for(var X=[],oe=0,Ie=W.length;oe<Ie;){var Ue=W.charCodeAt(oe++);if(Ue>=55296&&Ue<=56319&&oe<Ie){var Et=W.charCodeAt(oe++);(Et&64512)==56320?X.push(((Ue&1023)<<10)+(Et&1023)+65536):(X.push(Ue),oe--)}else X.push(Ue)}return X}var Jt=function(X){return String.fromCodePoint.apply(String,k(X))},ut=function(X){return X-48<10?X-22:X-65<26?X-65:X-97<26?X-97:A},at=function(X,oe){return X+22+75*(X<26)-((oe!=0)<<5)},le=function(X,oe,Ie){var Ue=0;for(X=Ie?ae(X/q):X>>1,X+=ae(X/oe);X>Xe*D>>1;Ue+=A)X=ae(X/Xe);return ae(Ue+(Xe+1)*X/(X+F))},Ee=function(X){var oe=[],Ie=X.length,Ue=0,Et=ie,yt=ee,At=X.lastIndexOf(ne);At<0&&(At=0);for(var Gt=0;Gt<At;++Gt)X.charCodeAt(Gt)>=128&&Z("not-basic"),oe.push(X.charCodeAt(Gt));for(var di=At>0?At+1:0;di<Ie;){for(var ei=Ue,ai=1,ui=A;;ui+=A){di>=Ie&&Z("invalid-input");var li=ut(X.charCodeAt(di++));(li>=A||li>ae((z-Ue)/ai))&&Z("overflow"),Ue+=li*ai;var gi=ui<=yt?R:ui>=yt+D?D:ui-yt;if(li<gi)break;var Ii=A-gi;ai>ae(z/Ii)&&Z("overflow"),ai*=Ii}var xi=oe.length+1;yt=le(Ue-ei,xi,ei==0),ae(Ue/xi)>z-Et&&Z("overflow"),Et+=ae(Ue/xi),Ue%=xi,oe.splice(Ue++,0,Et)}return String.fromCodePoint.apply(String,oe)},Re=function(X){var oe=[];X=ft(X);var Ie=X.length,Ue=ie,Et=0,yt=ee,At=!0,Gt=!1,di=void 0;try{for(var ei=X[Symbol.iterator](),ai;!(At=(ai=ei.next()).done);At=!0){var ui=ai.value;ui<128&&oe.push(Le(ui))}}catch(Xr){Gt=!0,di=Xr}finally{try{!At&&ei.return&&ei.return()}finally{if(Gt)throw di}}var li=oe.length,gi=li;for(li&&oe.push(ne);gi<Ie;){var Ii=z,xi=!0,Vr=!1,gn=void 0;try{for(var dr=X[Symbol.iterator](),es;!(xi=(es=dr.next()).done);xi=!0){var ts=es.value;ts>=Ue&&ts<Ii&&(Ii=ts)}}catch(Xr){Vr=!0,gn=Xr}finally{try{!xi&&dr.return&&dr.return()}finally{if(Vr)throw gn}}var Ti=gi+1;Ii-Ue>ae((z-Et)/Ti)&&Z("overflow"),Et+=(Ii-Ue)*Ti,Ue=Ii;var Kr=!0,ln=!1,ar=void 0;try{for(var zr=X[Symbol.iterator](),Xa;!(Kr=(Xa=zr.next()).done);Kr=!0){var Er=Xa.value;if(Er<Ue&&++Et>z&&Z("overflow"),Er==Ue){for(var Mr=Et,is=A;;is+=A){var _n=is<=yt?R:is>=yt+D?D:is-yt;if(Mr<_n)break;var _i=Mr-_n,gs=A-_n;oe.push(Le(at(_n+_i%gs,0))),Mr=ae(_i/gs)}oe.push(Le(at(Mr,0))),yt=le(Et,Ti,gi==li),Et=0,++gi}}}catch(Xr){ln=!0,ar=Xr}finally{try{!Kr&&zr.return&&zr.return()}finally{if(ln)throw ar}}++Et,++Ue}return oe.join("")},Q=function(X){return $t(X,function(oe){return se.test(oe)?Ee(oe.slice(4).toLowerCase()):oe})},he=function(X){return $t(X,function(oe){return ue.test(oe)?"xn--"+Re(oe):oe})},it={version:"2.1.0",ucs2:{decode:ft,encode:Jt},decode:Ee,encode:Re,toASCII:he,toUnicode:Q},Ct={};function bt(W){var X=W.charCodeAt(0),oe=void 0;return X<16?oe="%0"+X.toString(16).toUpperCase():X<128?oe="%"+X.toString(16).toUpperCase():X<2048?oe="%"+(X>>6|192).toString(16).toUpperCase()+"%"+(X&63|128).toString(16).toUpperCase():oe="%"+(X>>12|224).toString(16).toUpperCase()+"%"+(X>>6&63|128).toString(16).toUpperCase()+"%"+(X&63|128).toString(16).toUpperCase(),oe}function It(W){for(var X="",oe=0,Ie=W.length;oe<Ie;){var Ue=parseInt(W.substr(oe+1,2),16);if(Ue<128)X+=String.fromCharCode(Ue),oe+=3;else if(Ue>=194&&Ue<224){if(Ie-oe>=6){var Et=parseInt(W.substr(oe+4,2),16);X+=String.fromCharCode((Ue&31)<<6|Et&63)}else X+=W.substr(oe,6);oe+=6}else if(Ue>=224){if(Ie-oe>=9){var yt=parseInt(W.substr(oe+4,2),16),At=parseInt(W.substr(oe+7,2),16);X+=String.fromCharCode((Ue&15)<<12|(yt&63)<<6|At&63)}else X+=W.substr(oe,9);oe+=9}else X+=W.substr(oe,3),oe+=3}return X}function Bt(W,X){function oe(Ie){var Ue=It(Ie);return Ue.match(X.UNRESERVED)?Ue:Ie}return W.scheme&&(W.scheme=String(W.scheme).replace(X.PCT_ENCODED,oe).toLowerCase().replace(X.NOT_SCHEME,"")),W.userinfo!==void 0&&(W.userinfo=String(W.userinfo).replace(X.PCT_ENCODED,oe).replace(X.NOT_USERINFO,bt).replace(X.PCT_ENCODED,d)),W.host!==void 0&&(W.host=String(W.host).replace(X.PCT_ENCODED,oe).toLowerCase().replace(X.NOT_HOST,bt).replace(X.PCT_ENCODED,d)),W.path!==void 0&&(W.path=String(W.path).replace(X.PCT_ENCODED,oe).replace(W.scheme?X.NOT_PATH:X.NOT_PATH_NOSCHEME,bt).replace(X.PCT_ENCODED,d)),W.query!==void 0&&(W.query=String(W.query).replace(X.PCT_ENCODED,oe).replace(X.NOT_QUERY,bt).replace(X.PCT_ENCODED,d)),W.fragment!==void 0&&(W.fragment=String(W.fragment).replace(X.PCT_ENCODED,oe).replace(X.NOT_FRAGMENT,bt).replace(X.PCT_ENCODED,d)),W}function Fe(W){return W.replace(/^0*(.*)/,"$1")||"0"}function Se(W,X){var oe=W.match(X.IPV4ADDRESS)||[],Ie=T(oe,2),Ue=Ie[1];return Ue?Ue.split(".").map(Fe).join("."):W}function ct(W,X){var oe=W.match(X.IPV6ADDRESS)||[],Ie=T(oe,3),Ue=Ie[1],Et=Ie[2];if(Ue){for(var yt=Ue.toLowerCase().split("::").reverse(),At=T(yt,2),Gt=At[0],di=At[1],ei=di?di.split(":").map(Fe):[],ai=Gt.split(":").map(Fe),ui=X.IPV4ADDRESS.test(ai[ai.length-1]),li=ui?7:8,gi=ai.length-li,Ii=Array(li),xi=0;xi<li;++xi)Ii[xi]=ei[xi]||ai[gi+xi]||"";ui&&(Ii[li-1]=Se(Ii[li-1],X));var Vr=Ii.reduce(function(Ti,Kr,ln){if(!Kr||Kr==="0"){var ar=Ti[Ti.length-1];ar&&ar.index+ar.length===ln?ar.length++:Ti.push({index:ln,length:1})}return Ti},[]),gn=Vr.sort(function(Ti,Kr){return Kr.length-Ti.length})[0],dr=void 0;if(gn&&gn.length>1){var es=Ii.slice(0,gn.index),ts=Ii.slice(gn.index+gn.length);dr=es.join(":")+"::"+ts.join(":")}else dr=Ii.join(":");return Et&&(dr+="%"+Et),dr}else return W}var N=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Je="".match(/(){0}/)[1]===void 0;function We(W){var X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},oe={},Ie=X.iri!==!1?S:E;X.reference==="suffix"&&(W=(X.scheme?X.scheme+":":"")+"//"+W);var Ue=W.match(N);if(Ue){Je?(oe.scheme=Ue[1],oe.userinfo=Ue[3],oe.host=Ue[4],oe.port=parseInt(Ue[5],10),oe.path=Ue[6]||"",oe.query=Ue[7],oe.fragment=Ue[8],isNaN(oe.port)&&(oe.port=Ue[5])):(oe.scheme=Ue[1]||void 0,oe.userinfo=W.indexOf("@")!==-1?Ue[3]:void 0,oe.host=W.indexOf("//")!==-1?Ue[4]:void 0,oe.port=parseInt(Ue[5],10),oe.path=Ue[6]||"",oe.query=W.indexOf("?")!==-1?Ue[7]:void 0,oe.fragment=W.indexOf("#")!==-1?Ue[8]:void 0,isNaN(oe.port)&&(oe.port=W.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?Ue[4]:void 0)),oe.host&&(oe.host=ct(Se(oe.host,Ie),Ie)),oe.scheme===void 0&&oe.userinfo===void 0&&oe.host===void 0&&oe.port===void 0&&!oe.path&&oe.query===void 0?oe.reference="same-document":oe.scheme===void 0?oe.reference="relative":oe.fragment===void 0?oe.reference="absolute":oe.reference="uri",X.reference&&X.reference!=="suffix"&&X.reference!==oe.reference&&(oe.error=oe.error||"URI is not a "+X.reference+" reference.");var Et=Ct[(X.scheme||oe.scheme||"").toLowerCase()];if(!X.unicodeSupport&&(!Et||!Et.unicodeSupport)){if(oe.host&&(X.domainHost||Et&&Et.domainHost))try{oe.host=it.toASCII(oe.host.replace(Ie.PCT_ENCODED,It).toLowerCase())}catch(yt){oe.error=oe.error||"Host's domain name can not be converted to ASCII via punycode: "+yt}Bt(oe,E)}else Bt(oe,Ie);Et&&Et.parse&&Et.parse(oe,X)}else oe.error=oe.error||"URI can not be parsed.";return oe}function we(W,X){var oe=X.iri!==!1?S:E,Ie=[];return W.userinfo!==void 0&&(Ie.push(W.userinfo),Ie.push("@")),W.host!==void 0&&Ie.push(ct(Se(String(W.host),oe),oe).replace(oe.IPV6ADDRESS,function(Ue,Et,yt){return"["+Et+(yt?"%25"+yt:"")+"]"})),(typeof W.port=="number"||typeof W.port=="string")&&(Ie.push(":"),Ie.push(String(W.port))),Ie.length?Ie.join(""):void 0}var me=/^\.\.?\//,Ne=/^\/\.(\/|$)/,ht=/^\/\.\.(\/|$)/,ke=/^\/?(?:.|\n)*?(?=\/|$)/;function Qe(W){for(var X=[];W.length;)if(W.match(me))W=W.replace(me,"");else if(W.match(Ne))W=W.replace(Ne,"/");else if(W.match(ht))W=W.replace(ht,"/"),X.pop();else if(W==="."||W==="..")W="";else{var oe=W.match(ke);if(oe){var Ie=oe[0];W=W.slice(Ie.length),X.push(Ie)}else throw new Error("Unexpected dot segment condition")}return X.join("")}function xt(W){var X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},oe=X.iri?S:E,Ie=[],Ue=Ct[(X.scheme||W.scheme||"").toLowerCase()];if(Ue&&Ue.serialize&&Ue.serialize(W,X),W.host&&!oe.IPV6ADDRESS.test(W.host)){if(X.domainHost||Ue&&Ue.domainHost)try{W.host=X.iri?it.toUnicode(W.host):it.toASCII(W.host.replace(oe.PCT_ENCODED,It).toLowerCase())}catch(At){W.error=W.error||"Host's domain name can not be converted to "+(X.iri?"Unicode":"ASCII")+" via punycode: "+At}}Bt(W,oe),X.reference!=="suffix"&&W.scheme&&(Ie.push(W.scheme),Ie.push(":"));var Et=we(W,X);if(Et!==void 0&&(X.reference!=="suffix"&&Ie.push("//"),Ie.push(Et),W.path&&W.path.charAt(0)!=="/"&&Ie.push("/")),W.path!==void 0){var yt=W.path;!X.absolutePath&&(!Ue||!Ue.absolutePath)&&(yt=Qe(yt)),Et===void 0&&(yt=yt.replace(/^\/\//,"/%2F")),Ie.push(yt)}return W.query!==void 0&&(Ie.push("?"),Ie.push(W.query)),W.fragment!==void 0&&(Ie.push("#"),Ie.push(W.fragment)),Ie.join("")}function Tt(W,X){var oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},Ie=arguments[3],Ue={};return Ie||(W=We(xt(W,oe),oe),X=We(xt(X,oe),oe)),oe=oe||{},!oe.tolerant&&X.scheme?(Ue.scheme=X.scheme,Ue.userinfo=X.userinfo,Ue.host=X.host,Ue.port=X.port,Ue.path=Qe(X.path||""),Ue.query=X.query):(X.userinfo!==void 0||X.host!==void 0||X.port!==void 0?(Ue.userinfo=X.userinfo,Ue.host=X.host,Ue.port=X.port,Ue.path=Qe(X.path||""),Ue.query=X.query):(X.path?(X.path.charAt(0)==="/"?Ue.path=Qe(X.path):((W.userinfo!==void 0||W.host!==void 0||W.port!==void 0)&&!W.path?Ue.path="/"+X.path:W.path?Ue.path=W.path.slice(0,W.path.lastIndexOf("/")+1)+X.path:Ue.path=X.path,Ue.path=Qe(Ue.path)),Ue.query=X.query):(Ue.path=W.path,X.query!==void 0?Ue.query=X.query:Ue.query=W.query),Ue.userinfo=W.userinfo,Ue.host=W.host,Ue.port=W.port),Ue.scheme=W.scheme),Ue.fragment=X.fragment,Ue}function dt(W,X,oe){var Ie=g({scheme:"null"},oe);return xt(Tt(We(W,Ie),We(X,Ie),Ie,!0),Ie)}function Yt(W,X){return typeof W=="string"?W=xt(We(W,X),X):f(W)==="object"&&(W=We(xt(W,X),X)),W}function ki(W,X,oe){return typeof W=="string"?W=xt(We(W,oe),oe):f(W)==="object"&&(W=xt(W,oe)),typeof X=="string"?X=xt(We(X,oe),oe):f(X)==="object"&&(X=xt(X,oe)),W===X}function Si(W,X){return W&&W.toString().replace(!X||!X.iri?E.ESCAPE:S.ESCAPE,bt)}function Zi(W,X){return W&&W.toString().replace(!X||!X.iri?E.PCT_ENCODED:S.PCT_ENCODED,It)}var nr={scheme:"http",domainHost:!0,parse:function(X,oe){return X.host||(X.error=X.error||"HTTP URIs must have a host."),X},serialize:function(X,oe){var Ie=String(X.scheme).toLowerCase()==="https";return(X.port===(Ie?443:80)||X.port==="")&&(X.port=void 0),X.path||(X.path="/"),X}},fr={scheme:"https",domainHost:nr.domainHost,parse:nr.parse,serialize:nr.serialize};function qr(W){return typeof W.secure=="boolean"?W.secure:String(W.scheme).toLowerCase()==="wss"}var vt={scheme:"ws",domainHost:!0,parse:function(X,oe){var Ie=X;return Ie.secure=qr(Ie),Ie.resourceName=(Ie.path||"/")+(Ie.query?"?"+Ie.query:""),Ie.path=void 0,Ie.query=void 0,Ie},serialize:function(X,oe){if((X.port===(qr(X)?443:80)||X.port==="")&&(X.port=void 0),typeof X.secure=="boolean"&&(X.scheme=X.secure?"wss":"ws",X.secure=void 0),X.resourceName){var Ie=X.resourceName.split("?"),Ue=T(Ie,2),Et=Ue[0],yt=Ue[1];X.path=Et&&Et!=="/"?Et:void 0,X.query=yt,X.resourceName=void 0}return X.fragment=void 0,X}},Ki={scheme:"wss",domainHost:vt.domainHost,parse:vt.parse,serialize:vt.serialize},br={},wr="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",sr="[0-9A-Fa-f]",zt=u(u("%[EFef]"+sr+"%"+sr+sr+"%"+sr+sr)+"|"+u("%[89A-Fa-f]"+sr+"%"+sr+sr)+"|"+u("%"+sr+sr)),yi="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",vi="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",xr=l(vi,'[\\"\\\\]'),Ur="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",pi=new RegExp(wr,"g"),on=new RegExp(zt,"g"),ve=new RegExp(l("[^]",yi,"[\\.]",'[\\"]',xr),"g"),G=new RegExp(l("[^]",wr,Ur),"g"),K=G;function ce(W){var X=It(W);return X.match(pi)?X:W}var be={scheme:"mailto",parse:function(X,oe){var Ie=X,Ue=Ie.to=Ie.path?Ie.path.split(","):[];if(Ie.path=void 0,Ie.query){for(var Et=!1,yt={},At=Ie.query.split("&"),Gt=0,di=At.length;Gt<di;++Gt){var ei=At[Gt].split("=");switch(ei[0]){case"to":for(var ai=ei[1].split(","),ui=0,li=ai.length;ui<li;++ui)Ue.push(ai[ui]);break;case"subject":Ie.subject=Zi(ei[1],oe);break;case"body":Ie.body=Zi(ei[1],oe);break;default:Et=!0,yt[Zi(ei[0],oe)]=Zi(ei[1],oe);break}}Et&&(Ie.headers=yt)}Ie.query=void 0;for(var gi=0,Ii=Ue.length;gi<Ii;++gi){var xi=Ue[gi].split("@");if(xi[0]=Zi(xi[0]),oe.unicodeSupport)xi[1]=Zi(xi[1],oe).toLowerCase();else try{xi[1]=it.toASCII(Zi(xi[1],oe).toLowerCase())}catch(Vr){Ie.error=Ie.error||"Email address's domain name can not be converted to ASCII via punycode: "+Vr}Ue[gi]=xi.join("@")}return Ie},serialize:function(X,oe){var Ie=X,Ue=n(X.to);if(Ue){for(var Et=0,yt=Ue.length;Et<yt;++Et){var At=String(Ue[Et]),Gt=At.lastIndexOf("@"),di=At.slice(0,Gt).replace(on,ce).replace(on,d).replace(ve,bt),ei=At.slice(Gt+1);try{ei=oe.iri?it.toUnicode(ei):it.toASCII(Zi(ei,oe).toLowerCase())}catch(gi){Ie.error=Ie.error||"Email address's domain name can not be converted to "+(oe.iri?"Unicode":"ASCII")+" via punycode: "+gi}Ue[Et]=di+"@"+ei}Ie.path=Ue.join(",")}var ai=X.headers=X.headers||{};X.subject&&(ai.subject=X.subject),X.body&&(ai.body=X.body);var ui=[];for(var li in ai)ai[li]!==br[li]&&ui.push(li.replace(on,ce).replace(on,d).replace(G,bt)+"="+ai[li].replace(on,ce).replace(on,d).replace(K,bt));return ui.length&&(Ie.query=ui.join("&")),Ie}},Pe=/^([^\:]+)\:(.*)/,qe={scheme:"urn",parse:function(X,oe){var Ie=X.path&&X.path.match(Pe),Ue=X;if(Ie){var Et=oe.scheme||Ue.scheme||"urn",yt=Ie[1].toLowerCase(),At=Ie[2],Gt=Et+":"+(oe.nid||yt),di=Ct[Gt];Ue.nid=yt,Ue.nss=At,Ue.path=void 0,di&&(Ue=di.parse(Ue,oe))}else Ue.error=Ue.error||"URN can not be parsed.";return Ue},serialize:function(X,oe){var Ie=oe.scheme||X.scheme||"urn",Ue=X.nid,Et=Ie+":"+(oe.nid||Ue),yt=Ct[Et];yt&&(X=yt.serialize(X,oe));var At=X,Gt=X.nss;return At.path=(Ue||oe.nid)+":"+Gt,At}},Oe=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,De={scheme:"urn:uuid",parse:function(X,oe){var Ie=X;return Ie.uuid=Ie.nss,Ie.nss=void 0,!oe.tolerant&&(!Ie.uuid||!Ie.uuid.match(Oe))&&(Ie.error=Ie.error||"UUID is not valid."),Ie},serialize:function(X,oe){var Ie=X;return Ie.nss=(X.uuid||"").toLowerCase(),Ie}};Ct[nr.scheme]=nr,Ct[fr.scheme]=fr,Ct[vt.scheme]=vt,Ct[Ki.scheme]=Ki,Ct[be.scheme]=be,Ct[qe.scheme]=qe,Ct[De.scheme]=De,a.SCHEMES=Ct,a.pctEncChar=bt,a.pctDecChars=It,a.parse=We,a.removeDotSegments=Qe,a.serialize=xt,a.resolveComponents=Tt,a.resolve=dt,a.normalize=Yt,a.equal=ki,a.escapeComponent=Si,a.unescapeComponent=Zi,Object.defineProperty(a,"__esModule",{value:!0})})})(kf,kf.exports);var _b=kf.exports;Object.defineProperty(Vf,"__esModule",{value:!0});const H_=_b;H_.code='require("ajv/dist/runtime/uri").default';Vf.default=H_;(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.CodeGen=c.Name=c.nil=c.stringify=c.str=c._=c.KeywordCxt=void 0;var r=Ju();Object.defineProperty(c,"KeywordCxt",{enumerable:!0,get:function(){return r.KeywordCxt}});var a=Oi;Object.defineProperty(c,"_",{enumerable:!0,get:function(){return a._}}),Object.defineProperty(c,"str",{enumerable:!0,get:function(){return a.str}}),Object.defineProperty(c,"stringify",{enumerable:!0,get:function(){return a.stringify}}),Object.defineProperty(c,"nil",{enumerable:!0,get:function(){return a.nil}}),Object.defineProperty(c,"Name",{enumerable:!0,get:function(){return a.Name}}),Object.defineProperty(c,"CodeGen",{enumerable:!0,get:function(){return a.CodeGen}});const l=bc,u=wc,f=Ha,d=Bn,n=Oi,g=an,v=mc,E=qi,S=gb,T=Vf,k=(at,le)=>new RegExp(at,le);k.code="new RegExp";const z=["removeAdditional","useDefaults","coerceTypes"],A=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),R={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},D={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},F=200;function q(at){var le,Ee,Re,Q,he,it,Ct,bt,It,Bt,Fe,Se,ct,N,Je,We,we,me,Ne,ht,ke,Qe,xt,Tt,dt;const Yt=at.strict,ki=(le=at.code)===null||le===void 0?void 0:le.optimize,Si=ki===!0||ki===void 0?1:ki||0,Zi=(Re=(Ee=at.code)===null||Ee===void 0?void 0:Ee.regExp)!==null&&Re!==void 0?Re:k,nr=(Q=at.uriResolver)!==null&&Q!==void 0?Q:T.default;return{strictSchema:(it=(he=at.strictSchema)!==null&&he!==void 0?he:Yt)!==null&&it!==void 0?it:!0,strictNumbers:(bt=(Ct=at.strictNumbers)!==null&&Ct!==void 0?Ct:Yt)!==null&&bt!==void 0?bt:!0,strictTypes:(Bt=(It=at.strictTypes)!==null&&It!==void 0?It:Yt)!==null&&Bt!==void 0?Bt:"log",strictTuples:(Se=(Fe=at.strictTuples)!==null&&Fe!==void 0?Fe:Yt)!==null&&Se!==void 0?Se:"log",strictRequired:(N=(ct=at.strictRequired)!==null&&ct!==void 0?ct:Yt)!==null&&N!==void 0?N:!1,code:at.code?{...at.code,optimize:Si,regExp:Zi}:{optimize:Si,regExp:Zi},loopRequired:(Je=at.loopRequired)!==null&&Je!==void 0?Je:F,loopEnum:(We=at.loopEnum)!==null&&We!==void 0?We:F,meta:(we=at.meta)!==null&&we!==void 0?we:!0,messages:(me=at.messages)!==null&&me!==void 0?me:!0,inlineRefs:(Ne=at.inlineRefs)!==null&&Ne!==void 0?Ne:!0,schemaId:(ht=at.schemaId)!==null&&ht!==void 0?ht:"$id",addUsedSchema:(ke=at.addUsedSchema)!==null&&ke!==void 0?ke:!0,validateSchema:(Qe=at.validateSchema)!==null&&Qe!==void 0?Qe:!0,validateFormats:(xt=at.validateFormats)!==null&&xt!==void 0?xt:!0,unicodeRegExp:(Tt=at.unicodeRegExp)!==null&&Tt!==void 0?Tt:!0,int32range:(dt=at.int32range)!==null&&dt!==void 0?dt:!0,uriResolver:nr}}class ee{constructor(le={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,le=this.opts={...le,...q(le)};const{es5:Ee,lines:Re}=this.opts.code;this.scope=new n.ValueScope({scope:{},prefixes:A,es5:Ee,lines:Re}),this.logger=ae(le.logger);const Q=le.validateFormats;le.validateFormats=!1,this.RULES=(0,f.getRules)(),ie.call(this,R,le,"NOT SUPPORTED"),ie.call(this,D,le,"DEPRECATED","warn"),this._metaOpts=ye.call(this),le.formats&&ue.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),le.keywords&&Ce.call(this,le.keywords),typeof le.meta=="object"&&this.addMetaSchema(le.meta),se.call(this),le.validateFormats=Q}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:le,meta:Ee,schemaId:Re}=this.opts;let Q=S;Re==="id"&&(Q={...S},Q.id=Q.$id,delete Q.$id),Ee&&le&&this.addMetaSchema(Q,Q[Re],!1)}defaultMeta(){const{meta:le,schemaId:Ee}=this.opts;return this.opts.defaultMeta=typeof le=="object"?le[Ee]||le:void 0}validate(le,Ee){let Re;if(typeof le=="string"){if(Re=this.getSchema(le),!Re)throw new Error(`no schema with key or ref "${le}"`)}else Re=this.compile(le);const Q=Re(Ee);return"$async"in Re||(this.errors=Re.errors),Q}compile(le,Ee){const Re=this._addSchema(le,Ee);return Re.validate||this._compileSchemaEnv(Re)}compileAsync(le,Ee){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:Re}=this.opts;return Q.call(this,le,Ee);async function Q(Bt,Fe){await he.call(this,Bt.$schema);const Se=this._addSchema(Bt,Fe);return Se.validate||it.call(this,Se)}async function he(Bt){Bt&&!this.getSchema(Bt)&&await Q.call(this,{$ref:Bt},!0)}async function it(Bt){try{return this._compileSchemaEnv(Bt)}catch(Fe){if(!(Fe instanceof u.default))throw Fe;return Ct.call(this,Fe),await bt.call(this,Fe.missingSchema),it.call(this,Bt)}}function Ct({missingSchema:Bt,missingRef:Fe}){if(this.refs[Bt])throw new Error(`AnySchema ${Bt} is loaded but ${Fe} cannot be resolved`)}async function bt(Bt){const Fe=await It.call(this,Bt);this.refs[Bt]||await he.call(this,Fe.$schema),this.refs[Bt]||this.addSchema(Fe,Bt,Ee)}async function It(Bt){const Fe=this._loading[Bt];if(Fe)return Fe;try{return await(this._loading[Bt]=Re(Bt))}finally{delete this._loading[Bt]}}}addSchema(le,Ee,Re,Q=this.opts.validateSchema){if(Array.isArray(le)){for(const it of le)this.addSchema(it,void 0,Re,Q);return this}let he;if(typeof le=="object"){const{schemaId:it}=this.opts;if(he=le[it],he!==void 0&&typeof he!="string")throw new Error(`schema ${it} must be string`)}return Ee=(0,g.normalizeId)(Ee||he),this._checkUnique(Ee),this.schemas[Ee]=this._addSchema(le,Re,Ee,Q,!0),this}addMetaSchema(le,Ee,Re=this.opts.validateSchema){return this.addSchema(le,Ee,!0,Re),this}validateSchema(le,Ee){if(typeof le=="boolean")return!0;let Re;if(Re=le.$schema,Re!==void 0&&typeof Re!="string")throw new Error("$schema must be a string");if(Re=Re||this.opts.defaultMeta||this.defaultMeta(),!Re)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const Q=this.validate(Re,le);if(!Q&&Ee){const he="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(he);else throw new Error(he)}return Q}getSchema(le){let Ee;for(;typeof(Ee=ne.call(this,le))=="string";)le=Ee;if(Ee===void 0){const{schemaId:Re}=this.opts,Q=new d.SchemaEnv({schema:{},schemaId:Re});if(Ee=d.resolveSchema.call(this,Q,le),!Ee)return;this.refs[le]=Ee}return Ee.validate||this._compileSchemaEnv(Ee)}removeSchema(le){if(le instanceof RegExp)return this._removeAllSchemas(this.schemas,le),this._removeAllSchemas(this.refs,le),this;switch(typeof le){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const Ee=ne.call(this,le);return typeof Ee=="object"&&this._cache.delete(Ee.schema),delete this.schemas[le],delete this.refs[le],this}case"object":{const Ee=le;this._cache.delete(Ee);let Re=le[this.opts.schemaId];return Re&&(Re=(0,g.normalizeId)(Re),delete this.schemas[Re],delete this.refs[Re]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(le){for(const Ee of le)this.addKeyword(Ee);return this}addKeyword(le,Ee){let Re;if(typeof le=="string")Re=le,typeof Ee=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),Ee.keyword=Re);else if(typeof le=="object"&&Ee===void 0){if(Ee=le,Re=Ee.keyword,Array.isArray(Re)&&!Re.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Z.call(this,Re,Ee),!Ee)return(0,E.eachItem)(Re,he=>tt.call(this,he)),this;ft.call(this,Ee);const Q={...Ee,type:(0,v.getJSONTypes)(Ee.type),schemaType:(0,v.getJSONTypes)(Ee.schemaType)};return(0,E.eachItem)(Re,Q.type.length===0?he=>tt.call(this,he,Q):he=>Q.type.forEach(it=>tt.call(this,he,Q,it))),this}getKeyword(le){const Ee=this.RULES.all[le];return typeof Ee=="object"?Ee.definition:!!Ee}removeKeyword(le){const{RULES:Ee}=this;delete Ee.keywords[le],delete Ee.all[le];for(const Re of Ee.rules){const Q=Re.rules.findIndex(he=>he.keyword===le);Q>=0&&Re.rules.splice(Q,1)}return this}addFormat(le,Ee){return typeof Ee=="string"&&(Ee=new RegExp(Ee)),this.formats[le]=Ee,this}errorsText(le=this.errors,{separator:Ee=", ",dataVar:Re="data"}={}){return!le||le.length===0?"No errors":le.map(Q=>`${Re}${Q.instancePath} ${Q.message}`).reduce((Q,he)=>Q+Ee+he)}$dataMetaSchema(le,Ee){const Re=this.RULES.all;le=JSON.parse(JSON.stringify(le));for(const Q of Ee){const he=Q.split("/").slice(1);let it=le;for(const Ct of he)it=it[Ct];for(const Ct in Re){const bt=Re[Ct];if(typeof bt!="object")continue;const{$data:It}=bt.definition,Bt=it[Ct];It&&Bt&&(it[Ct]=ut(Bt))}}return le}_removeAllSchemas(le,Ee){for(const Re in le){const Q=le[Re];(!Ee||Ee.test(Re))&&(typeof Q=="string"?delete le[Re]:Q&&!Q.meta&&(this._cache.delete(Q.schema),delete le[Re]))}}_addSchema(le,Ee,Re,Q=this.opts.validateSchema,he=this.opts.addUsedSchema){let it;const{schemaId:Ct}=this.opts;if(typeof le=="object")it=le[Ct];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof le!="boolean")throw new Error("schema must be object or boolean")}let bt=this._cache.get(le);if(bt!==void 0)return bt;Re=(0,g.normalizeId)(it||Re);const It=g.getSchemaRefs.call(this,le,Re);return bt=new d.SchemaEnv({schema:le,schemaId:Ct,meta:Ee,baseId:Re,localRefs:It}),this._cache.set(bt.schema,bt),he&&!Re.startsWith("#")&&(Re&&this._checkUnique(Re),this.refs[Re]=bt),Q&&this.validateSchema(le,!0),bt}_checkUnique(le){if(this.schemas[le]||this.refs[le])throw new Error(`schema with key or id "${le}" already exists`)}_compileSchemaEnv(le){if(le.meta?this._compileMetaSchema(le):d.compileSchema.call(this,le),!le.validate)throw new Error("ajv implementation error");return le.validate}_compileMetaSchema(le){const Ee=this.opts;this.opts=this._metaOpts;try{d.compileSchema.call(this,le)}finally{this.opts=Ee}}}c.default=ee,ee.ValidationError=l.default,ee.MissingRefError=u.default;function ie(at,le,Ee,Re="error"){for(const Q in at){const he=Q;he in le&&this.logger[Re](`${Ee}: option ${Q}. ${at[he]}`)}}function ne(at){return at=(0,g.normalizeId)(at),this.schemas[at]||this.refs[at]}function se(){const at=this.opts.schemas;if(at)if(Array.isArray(at))this.addSchema(at);else for(const le in at)this.addSchema(at[le],le)}function ue(){for(const at in this.opts.formats){const le=this.opts.formats[at];le&&this.addFormat(at,le)}}function Ce(at){if(Array.isArray(at)){this.addVocabulary(at);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const le in at){const Ee=at[le];Ee.keyword||(Ee.keyword=le),this.addKeyword(Ee)}}function ye(){const at={...this.opts};for(const le of z)delete at[le];return at}const Xe={log(){},warn(){},error(){}};function ae(at){if(at===!1)return Xe;if(at===void 0)return console;if(at.log&&at.warn&&at.error)return at;throw new Error("logger must implement log, warn and error methods")}const Le=/^[a-z_$][a-z0-9_$:-]*$/i;function Z(at,le){const{RULES:Ee}=this;if((0,E.eachItem)(at,Re=>{if(Ee.keywords[Re])throw new Error(`Keyword ${Re} is already defined`);if(!Le.test(Re))throw new Error(`Keyword ${Re} has invalid name`)}),!!le&&le.$data&&!("code"in le||"validate"in le))throw new Error('$data keyword must have "code" or "validate" function')}function tt(at,le,Ee){var Re;const Q=le==null?void 0:le.post;if(Ee&&Q)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:he}=this;let it=Q?he.post:he.rules.find(({type:bt})=>bt===Ee);if(it||(it={type:Ee,rules:[]},he.rules.push(it)),he.keywords[at]=!0,!le)return;const Ct={keyword:at,definition:{...le,type:(0,v.getJSONTypes)(le.type),schemaType:(0,v.getJSONTypes)(le.schemaType)}};le.before?$t.call(this,it,Ct,le.before):it.rules.push(Ct),he.all[at]=Ct,(Re=le.implements)===null||Re===void 0||Re.forEach(bt=>this.addKeyword(bt))}function $t(at,le,Ee){const Re=at.rules.findIndex(Q=>Q.keyword===Ee);Re>=0?at.rules.splice(Re,0,le):(at.rules.push(le),this.logger.warn(`rule ${Ee} is not defined`))}function ft(at){let{metaSchema:le}=at;le!==void 0&&(at.$data&&this.opts.$data&&(le=ut(le)),at.validateSchema=this.compile(le,!0))}const Jt={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function ut(at){return{anyOf:[at,Jt]}}})(B_);var $f={},jf={},qf={};Object.defineProperty(qf,"__esModule",{value:!0});const yb={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};qf.default=yb;var Wa={};Object.defineProperty(Wa,"__esModule",{value:!0});Wa.callRef=Wa.getValidate=void 0;const vb=wc,Om=Bi,Rn=Oi,Fo=Cs,Fm=Bn,xu=qi,bb={keyword:"$ref",schemaType:"string",code(c){const{gen:r,schema:a,it:l}=c,{baseId:u,schemaEnv:f,validateName:d,opts:n,self:g}=l,{root:v}=f;if((a==="#"||a==="#/")&&u===v.baseId)return S();const E=Fm.resolveRef.call(g,v,u,a);if(E===void 0)throw new vb.default(l.opts.uriResolver,u,a);if(E instanceof Fm.SchemaEnv)return T(E);return k(E);function S(){if(f===v)return Mu(c,d,f,f.$async);const z=r.scopeValue("root",{ref:v});return Mu(c,(0,Rn._)`${z}.validate`,v,v.$async)}function T(z){const A=W_(c,z);Mu(c,A,z,z.$async)}function k(z){const A=r.scopeValue("schema",n.code.source===!0?{ref:z,code:(0,Rn.stringify)(z)}:{ref:z}),R=r.name("valid"),D=c.subschema({schema:z,dataTypes:[],schemaPath:Rn.nil,topSchemaRef:A,errSchemaPath:a},R);c.mergeEvaluated(D),c.ok(R)}}};function W_(c,r){const{gen:a}=c;return r.validate?a.scopeValue("validate",{ref:r.validate}):(0,Rn._)`${a.scopeValue("wrapper",{ref:r})}.validate`}Wa.getValidate=W_;function Mu(c,r,a,l){const{gen:u,it:f}=c,{allErrors:d,schemaEnv:n,opts:g}=f,v=g.passContext?Fo.default.this:Rn.nil;l?E():S();function E(){if(!n.$async)throw new Error("async schema referenced by sync schema");const z=u.let("valid");u.try(()=>{u.code((0,Rn._)`await ${(0,Om.callValidateCode)(c,r,v)}`),k(r),d||u.assign(z,!0)},A=>{u.if((0,Rn._)`!(${A} instanceof ${f.ValidationError})`,()=>u.throw(A)),T(A),d||u.assign(z,!1)}),c.ok(z)}function S(){c.result((0,Om.callValidateCode)(c,r,v),()=>k(r),()=>T(r))}function T(z){const A=(0,Rn._)`${z}.errors`;u.assign(Fo.default.vErrors,(0,Rn._)`${Fo.default.vErrors} === null ? ${A} : ${Fo.default.vErrors}.concat(${A})`),u.assign(Fo.default.errors,(0,Rn._)`${Fo.default.vErrors}.length`)}function k(z){var A;if(!f.opts.unevaluated)return;const R=(A=a==null?void 0:a.validate)===null||A===void 0?void 0:A.evaluated;if(f.props!==!0)if(R&&!R.dynamicProps)R.props!==void 0&&(f.props=xu.mergeEvaluated.props(u,R.props,f.props));else{const D=u.var("props",(0,Rn._)`${z}.evaluated.props`);f.props=xu.mergeEvaluated.props(u,D,f.props,Rn.Name)}if(f.items!==!0)if(R&&!R.dynamicItems)R.items!==void 0&&(f.items=xu.mergeEvaluated.items(u,R.items,f.items));else{const D=u.var("items",(0,Rn._)`${z}.evaluated.items`);f.items=xu.mergeEvaluated.items(u,D,f.items,Rn.Name)}}}Wa.callRef=Mu;Wa.default=bb;Object.defineProperty(jf,"__esModule",{value:!0});const wb=qf,xb=Wa,Eb=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",wb.default,xb.default];jf.default=Eb;var Zf={},Gf={};Object.defineProperty(Gf,"__esModule",{value:!0});const Bu=Oi,ua=Bu.operators,Ou={maximum:{okStr:"<=",ok:ua.LTE,fail:ua.GT},minimum:{okStr:">=",ok:ua.GTE,fail:ua.LT},exclusiveMaximum:{okStr:"<",ok:ua.LT,fail:ua.GTE},exclusiveMinimum:{okStr:">",ok:ua.GT,fail:ua.LTE}},Sb={message:({keyword:c,schemaCode:r})=>(0,Bu.str)`must be ${Ou[c].okStr} ${r}`,params:({keyword:c,schemaCode:r})=>(0,Bu._)`{comparison: ${Ou[c].okStr}, limit: ${r}}`},kb={keyword:Object.keys(Ou),type:"number",schemaType:"number",$data:!0,error:Sb,code(c){const{keyword:r,data:a,schemaCode:l}=c;c.fail$data((0,Bu._)`${a} ${Ou[r].fail} ${l} || isNaN(${a})`)}};Gf.default=kb;var Hf={};Object.defineProperty(Hf,"__esModule",{value:!0});const cc=Oi,Tb={message:({schemaCode:c})=>(0,cc.str)`must be multiple of ${c}`,params:({schemaCode:c})=>(0,cc._)`{multipleOf: ${c}}`},Cb={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:Tb,code(c){const{gen:r,data:a,schemaCode:l,it:u}=c,f=u.opts.multipleOfPrecision,d=r.let("res"),n=f?(0,cc._)`Math.abs(Math.round(${d}) - ${d}) > 1e-${f}`:(0,cc._)`${d} !== parseInt(${d})`;c.fail$data((0,cc._)`(${l} === 0 || (${d} = ${a}/${l}, ${n}))`)}};Hf.default=Cb;var Wf={},Kf={};Object.defineProperty(Kf,"__esModule",{value:!0});function K_(c){const r=c.length;let a=0,l=0,u;for(;l<r;)a++,u=c.charCodeAt(l++),u>=55296&&u<=56319&&l<r&&(u=c.charCodeAt(l),(u&64512)===56320&&l++);return a}Kf.default=K_;K_.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(Wf,"__esModule",{value:!0});const $a=Oi,Ib=qi,Ab=Kf,Pb={message({keyword:c,schemaCode:r}){const a=c==="maxLength"?"more":"fewer";return(0,$a.str)`must NOT have ${a} than ${r} characters`},params:({schemaCode:c})=>(0,$a._)`{limit: ${c}}`},zb={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:Pb,code(c){const{keyword:r,data:a,schemaCode:l,it:u}=c,f=r==="maxLength"?$a.operators.GT:$a.operators.LT,d=u.opts.unicode===!1?(0,$a._)`${a}.length`:(0,$a._)`${(0,Ib.useFunc)(c.gen,Ab.default)}(${a})`;c.fail$data((0,$a._)`${d} ${f} ${l}`)}};Wf.default=zb;var Xf={};Object.defineProperty(Xf,"__esModule",{value:!0});const Mb=Bi,Fu=Oi,Db={message:({schemaCode:c})=>(0,Fu.str)`must match pattern "${c}"`,params:({schemaCode:c})=>(0,Fu._)`{pattern: ${c}}`},Lb={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:Db,code(c){const{data:r,$data:a,schema:l,schemaCode:u,it:f}=c,d=f.opts.unicodeRegExp?"u":"",n=a?(0,Fu._)`(new RegExp(${u}, ${d}))`:(0,Mb.usePattern)(c,l);c.fail$data((0,Fu._)`!${n}.test(${r})`)}};Xf.default=Lb;var Jf={};Object.defineProperty(Jf,"__esModule",{value:!0});const uc=Oi,Rb={message({keyword:c,schemaCode:r}){const a=c==="maxProperties"?"more":"fewer";return(0,uc.str)`must NOT have ${a} than ${r} properties`},params:({schemaCode:c})=>(0,uc._)`{limit: ${c}}`},Bb={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:Rb,code(c){const{keyword:r,data:a,schemaCode:l}=c,u=r==="maxProperties"?uc.operators.GT:uc.operators.LT;c.fail$data((0,uc._)`Object.keys(${a}).length ${u} ${l}`)}};Jf.default=Bb;var Yf={};Object.defineProperty(Yf,"__esModule",{value:!0});const sc=Bi,hc=Oi,Ob=qi,Fb={message:({params:{missingProperty:c}})=>(0,hc.str)`must have required property '${c}'`,params:({params:{missingProperty:c}})=>(0,hc._)`{missingProperty: ${c}}`},Nb={keyword:"required",type:"object",schemaType:"array",$data:!0,error:Fb,code(c){const{gen:r,schema:a,schemaCode:l,data:u,$data:f,it:d}=c,{opts:n}=d;if(!f&&a.length===0)return;const g=a.length>=n.loopRequired;if(d.allErrors?v():E(),n.strictRequired){const k=c.parentSchema.properties,{definedProperties:z}=c.it;for(const A of a)if((k==null?void 0:k[A])===void 0&&!z.has(A)){const R=d.schemaEnv.baseId+d.errSchemaPath,D=`required property "${A}" is not defined at "${R}" (strictRequired)`;(0,Ob.checkStrictMode)(d,D,d.opts.strictRequired)}}function v(){if(g||f)c.block$data(hc.nil,S);else for(const k of a)(0,sc.checkReportMissingProp)(c,k)}function E(){const k=r.let("missing");if(g||f){const z=r.let("valid",!0);c.block$data(z,()=>T(k,z)),c.ok(z)}else r.if((0,sc.checkMissingProp)(c,a,k)),(0,sc.reportMissingProp)(c,k),r.else()}function S(){r.forOf("prop",l,k=>{c.setParams({missingProperty:k}),r.if((0,sc.noPropertyInData)(r,u,k,n.ownProperties),()=>c.error())})}function T(k,z){c.setParams({missingProperty:k}),r.forOf(k,l,()=>{r.assign(z,(0,sc.propertyInData)(r,u,k,n.ownProperties)),r.if((0,hc.not)(z),()=>{c.error(),r.break()})},hc.nil)}}};Yf.default=Nb;var Qf={};Object.defineProperty(Qf,"__esModule",{value:!0});const fc=Oi,Ub={message({keyword:c,schemaCode:r}){const a=c==="maxItems"?"more":"fewer";return(0,fc.str)`must NOT have ${a} than ${r} items`},params:({schemaCode:c})=>(0,fc._)`{limit: ${c}}`},Vb={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:Ub,code(c){const{keyword:r,data:a,schemaCode:l}=c,u=r==="maxItems"?fc.operators.GT:fc.operators.LT;c.fail$data((0,fc._)`${a}.length ${u} ${l}`)}};Qf.default=Vb;var ed={},xc={};Object.defineProperty(xc,"__esModule",{value:!0});const X_=V_;X_.code='require("ajv/dist/runtime/equal").default';xc.default=X_;Object.defineProperty(ed,"__esModule",{value:!0});const gf=mc,sn=Oi,$b=qi,jb=xc,qb={message:({params:{i:c,j:r}})=>(0,sn.str)`must NOT have duplicate items (items ## ${r} and ${c} are identical)`,params:({params:{i:c,j:r}})=>(0,sn._)`{i: ${c}, j: ${r}}`},Zb={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:qb,code(c){const{gen:r,data:a,$data:l,schema:u,parentSchema:f,schemaCode:d,it:n}=c;if(!l&&!u)return;const g=r.let("valid"),v=f.items?(0,gf.getSchemaTypes)(f.items):[];c.block$data(g,E,(0,sn._)`${d} === false`),c.ok(g);function E(){const z=r.let("i",(0,sn._)`${a}.length`),A=r.let("j");c.setParams({i:z,j:A}),r.assign(g,!0),r.if((0,sn._)`${z} > 1`,()=>(S()?T:k)(z,A))}function S(){return v.length>0&&!v.some(z=>z==="object"||z==="array")}function T(z,A){const R=r.name("item"),D=(0,gf.checkDataTypes)(v,R,n.opts.strictNumbers,gf.DataType.Wrong),F=r.const("indices",(0,sn._)`{}`);r.for((0,sn._)`;${z}--;`,()=>{r.let(R,(0,sn._)`${a}[${z}]`),r.if(D,(0,sn._)`continue`),v.length>1&&r.if((0,sn._)`typeof ${R} == "string"`,(0,sn._)`${R} += "_"`),r.if((0,sn._)`typeof ${F}[${R}] == "number"`,()=>{r.assign(A,(0,sn._)`${F}[${R}]`),c.error(),r.assign(g,!1).break()}).code((0,sn._)`${F}[${R}] = ${z}`)})}function k(z,A){const R=(0,$b.useFunc)(r,jb.default),D=r.name("outer");r.label(D).for((0,sn._)`;${z}--;`,()=>r.for((0,sn._)`${A} = ${z}; ${A}--;`,()=>r.if((0,sn._)`${R}(${a}[${z}], ${a}[${A}])`,()=>{c.error(),r.assign(g,!1).break(D)})))}}};ed.default=Zb;var td={};Object.defineProperty(td,"__esModule",{value:!0});const Tf=Oi,Gb=qi,Hb=xc,Wb={message:"must be equal to constant",params:({schemaCode:c})=>(0,Tf._)`{allowedValue: ${c}}`},Kb={keyword:"const",$data:!0,error:Wb,code(c){const{gen:r,data:a,$data:l,schemaCode:u,schema:f}=c;l||f&&typeof f=="object"?c.fail$data((0,Tf._)`!${(0,Gb.useFunc)(r,Hb.default)}(${a}, ${u})`):c.fail((0,Tf._)`${f} !== ${a}`)}};td.default=Kb;var id={};Object.defineProperty(id,"__esModule",{value:!0});const oc=Oi,Xb=qi,Jb=xc,Yb={message:"must be equal to one of the allowed values",params:({schemaCode:c})=>(0,oc._)`{allowedValues: ${c}}`},Qb={keyword:"enum",schemaType:"array",$data:!0,error:Yb,code(c){const{gen:r,data:a,$data:l,schema:u,schemaCode:f,it:d}=c;if(!l&&u.length===0)throw new Error("enum must have non-empty array");const n=u.length>=d.opts.loopEnum;let g;const v=()=>g??(g=(0,Xb.useFunc)(r,Jb.default));let E;if(n||l)E=r.let("valid"),c.block$data(E,S);else{if(!Array.isArray(u))throw new Error("ajv implementation error");const k=r.const("vSchema",f);E=(0,oc.or)(...u.map((z,A)=>T(k,A)))}c.pass(E);function S(){r.assign(E,!1),r.forOf("v",f,k=>r.if((0,oc._)`${v()}(${a}, ${k})`,()=>r.assign(E,!0).break()))}function T(k,z){const A=u[z];return typeof A=="object"&&A!==null?(0,oc._)`${v()}(${a}, ${k}[${z}])`:(0,oc._)`${a} === ${A}`}}};id.default=Qb;Object.defineProperty(Zf,"__esModule",{value:!0});const ew=Gf,tw=Hf,iw=Wf,rw=Xf,nw=Jf,sw=Yf,aw=Qf,ow=ed,lw=td,cw=id,uw=[ew.default,tw.default,iw.default,rw.default,nw.default,sw.default,aw.default,ow.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},lw.default,cw.default];Zf.default=uw;var rd={},Ko={};Object.defineProperty(Ko,"__esModule",{value:!0});Ko.validateAdditionalItems=void 0;const ja=Oi,Cf=qi,hw={message:({params:{len:c}})=>(0,ja.str)`must NOT have more than ${c} items`,params:({params:{len:c}})=>(0,ja._)`{limit: ${c}}`},fw={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:hw,code(c){const{parentSchema:r,it:a}=c,{items:l}=r;if(!Array.isArray(l)){(0,Cf.checkStrictMode)(a,'"additionalItems" is ignored when "items" is not an array of schemas');return}J_(c,l)}};function J_(c,r){const{gen:a,schema:l,data:u,keyword:f,it:d}=c;d.items=!0;const n=a.const("len",(0,ja._)`${u}.length`);if(l===!1)c.setParams({len:r.length}),c.pass((0,ja._)`${n} <= ${r.length}`);else if(typeof l=="object"&&!(0,Cf.alwaysValidSchema)(d,l)){const v=a.var("valid",(0,ja._)`${n} <= ${r.length}`);a.if((0,ja.not)(v),()=>g(v)),c.ok(v)}function g(v){a.forRange("i",r.length,n,E=>{c.subschema({keyword:f,dataProp:E,dataPropType:Cf.Type.Num},v),d.allErrors||a.if((0,ja.not)(v),()=>a.break())})}}Ko.validateAdditionalItems=J_;Ko.default=fw;var nd={},Xo={};Object.defineProperty(Xo,"__esModule",{value:!0});Xo.validateTuple=void 0;const Nm=Oi,Du=qi,dw=Bi,pw={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(c){const{schema:r,it:a}=c;if(Array.isArray(r))return Y_(c,"additionalItems",r);a.items=!0,!(0,Du.alwaysValidSchema)(a,r)&&c.ok((0,dw.validateArray)(c))}};function Y_(c,r,a=c.schema){const{gen:l,parentSchema:u,data:f,keyword:d,it:n}=c;E(u),n.opts.unevaluated&&a.length&&n.items!==!0&&(n.items=Du.mergeEvaluated.items(l,a.length,n.items));const g=l.name("valid"),v=l.const("len",(0,Nm._)`${f}.length`);a.forEach((S,T)=>{(0,Du.alwaysValidSchema)(n,S)||(l.if((0,Nm._)`${v} > ${T}`,()=>c.subschema({keyword:d,schemaProp:T,dataProp:T},g)),c.ok(g))});function E(S){const{opts:T,errSchemaPath:k}=n,z=a.length,A=z===S.minItems&&(z===S.maxItems||S[r]===!1);if(T.strictTuples&&!A){const R=`"${d}" is ${z}-tuple, but minItems or maxItems/${r} are not specified or different at path "${k}"`;(0,Du.checkStrictMode)(n,R,T.strictTuples)}}}Xo.validateTuple=Y_;Xo.default=pw;Object.defineProperty(nd,"__esModule",{value:!0});const mw=Xo,gw={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:c=>(0,mw.validateTuple)(c,"items")};nd.default=gw;var sd={};Object.defineProperty(sd,"__esModule",{value:!0});const Um=Oi,_w=qi,yw=Bi,vw=Ko,bw={message:({params:{len:c}})=>(0,Um.str)`must NOT have more than ${c} items`,params:({params:{len:c}})=>(0,Um._)`{limit: ${c}}`},ww={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:bw,code(c){const{schema:r,parentSchema:a,it:l}=c,{prefixItems:u}=a;l.items=!0,!(0,_w.alwaysValidSchema)(l,r)&&(u?(0,vw.validateAdditionalItems)(c,u):c.ok((0,yw.validateArray)(c)))}};sd.default=ww;var ad={};Object.defineProperty(ad,"__esModule",{value:!0});const Yn=Oi,Eu=qi,xw={message:({params:{min:c,max:r}})=>r===void 0?(0,Yn.str)`must contain at least ${c} valid item(s)`:(0,Yn.str)`must contain at least ${c} and no more than ${r} valid item(s)`,params:({params:{min:c,max:r}})=>r===void 0?(0,Yn._)`{minContains: ${c}}`:(0,Yn._)`{minContains: ${c}, maxContains: ${r}}`},Ew={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:xw,code(c){const{gen:r,schema:a,parentSchema:l,data:u,it:f}=c;let d,n;const{minContains:g,maxContains:v}=l;f.opts.next?(d=g===void 0?1:g,n=v):d=1;const E=r.const("len",(0,Yn._)`${u}.length`);if(c.setParams({min:d,max:n}),n===void 0&&d===0){(0,Eu.checkStrictMode)(f,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(n!==void 0&&d>n){(0,Eu.checkStrictMode)(f,'"minContains" > "maxContains" is always invalid'),c.fail();return}if((0,Eu.alwaysValidSchema)(f,a)){let A=(0,Yn._)`${E} >= ${d}`;n!==void 0&&(A=(0,Yn._)`${A} && ${E} <= ${n}`),c.pass(A);return}f.items=!0;const S=r.name("valid");n===void 0&&d===1?k(S,()=>r.if(S,()=>r.break())):d===0?(r.let(S,!0),n!==void 0&&r.if((0,Yn._)`${u}.length > 0`,T)):(r.let(S,!1),T()),c.result(S,()=>c.reset());function T(){const A=r.name("_valid"),R=r.let("count",0);k(A,()=>r.if(A,()=>z(R)))}function k(A,R){r.forRange("i",0,E,D=>{c.subschema({keyword:"contains",dataProp:D,dataPropType:Eu.Type.Num,compositeRule:!0},A),R()})}function z(A){r.code((0,Yn._)`${A}++`),n===void 0?r.if((0,Yn._)`${A} >= ${d}`,()=>r.assign(S,!0).break()):(r.if((0,Yn._)`${A} > ${n}`,()=>r.assign(S,!1).break()),d===1?r.assign(S,!0):r.if((0,Yn._)`${A} >= ${d}`,()=>r.assign(S,!0)))}}};ad.default=Ew;var Q_={};(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.validateSchemaDeps=c.validatePropertyDeps=c.error=void 0;const r=Oi,a=qi,l=Bi;c.error={message:({params:{property:g,depsCount:v,deps:E}})=>{const S=v===1?"property":"properties";return(0,r.str)`must have ${S} ${E} when property ${g} is present`},params:({params:{property:g,depsCount:v,deps:E,missingProperty:S}})=>(0,r._)`{property: ${g},
    missingProperty: ${S},
    depsCount: ${v},
    deps: ${E}}`};const u={keyword:"dependencies",type:"object",schemaType:"object",error:c.error,code(g){const[v,E]=f(g);d(g,v),n(g,E)}};function f({schema:g}){const v={},E={};for(const S in g){if(S==="__proto__")continue;const T=Array.isArray(g[S])?v:E;T[S]=g[S]}return[v,E]}function d(g,v=g.schema){const{gen:E,data:S,it:T}=g;if(Object.keys(v).length===0)return;const k=E.let("missing");for(const z in v){const A=v[z];if(A.length===0)continue;const R=(0,l.propertyInData)(E,S,z,T.opts.ownProperties);g.setParams({property:z,depsCount:A.length,deps:A.join(", ")}),T.allErrors?E.if(R,()=>{for(const D of A)(0,l.checkReportMissingProp)(g,D)}):(E.if((0,r._)`${R} && (${(0,l.checkMissingProp)(g,A,k)})`),(0,l.reportMissingProp)(g,k),E.else())}}c.validatePropertyDeps=d;function n(g,v=g.schema){const{gen:E,data:S,keyword:T,it:k}=g,z=E.name("valid");for(const A in v)(0,a.alwaysValidSchema)(k,v[A])||(E.if((0,l.propertyInData)(E,S,A,k.opts.ownProperties),()=>{const R=g.subschema({keyword:T,schemaProp:A},z);g.mergeValidEvaluated(R,z)},()=>E.var(z,!0)),g.ok(z))}c.validateSchemaDeps=n,c.default=u})(Q_);var od={};Object.defineProperty(od,"__esModule",{value:!0});const ey=Oi,Sw=qi,kw={message:"property name must be valid",params:({params:c})=>(0,ey._)`{propertyName: ${c.propertyName}}`},Tw={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:kw,code(c){const{gen:r,schema:a,data:l,it:u}=c;if((0,Sw.alwaysValidSchema)(u,a))return;const f=r.name("valid");r.forIn("key",l,d=>{c.setParams({propertyName:d}),c.subschema({keyword:"propertyNames",data:d,dataTypes:["string"],propertyName:d,compositeRule:!0},f),r.if((0,ey.not)(f),()=>{c.error(!0),u.allErrors||r.break()})}),c.ok(f)}};od.default=Tw;var eh={};Object.defineProperty(eh,"__esModule",{value:!0});const Su=Bi,ps=Oi,Cw=Cs,ku=qi,Iw={message:"must NOT have additional properties",params:({params:c})=>(0,ps._)`{additionalProperty: ${c.additionalProperty}}`},Aw={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:Iw,code(c){const{gen:r,schema:a,parentSchema:l,data:u,errsCount:f,it:d}=c;if(!f)throw new Error("ajv implementation error");const{allErrors:n,opts:g}=d;if(d.props=!0,g.removeAdditional!=="all"&&(0,ku.alwaysValidSchema)(d,a))return;const v=(0,Su.allSchemaProperties)(l.properties),E=(0,Su.allSchemaProperties)(l.patternProperties);S(),c.ok((0,ps._)`${f} === ${Cw.default.errors}`);function S(){r.forIn("key",u,R=>{!v.length&&!E.length?z(R):r.if(T(R),()=>z(R))})}function T(R){let D;if(v.length>8){const F=(0,ku.schemaRefOrVal)(d,l.properties,"properties");D=(0,Su.isOwnProperty)(r,F,R)}else v.length?D=(0,ps.or)(...v.map(F=>(0,ps._)`${R} === ${F}`)):D=ps.nil;return E.length&&(D=(0,ps.or)(D,...E.map(F=>(0,ps._)`${(0,Su.usePattern)(c,F)}.test(${R})`))),(0,ps.not)(D)}function k(R){r.code((0,ps._)`delete ${u}[${R}]`)}function z(R){if(g.removeAdditional==="all"||g.removeAdditional&&a===!1){k(R);return}if(a===!1){c.setParams({additionalProperty:R}),c.error(),n||r.break();return}if(typeof a=="object"&&!(0,ku.alwaysValidSchema)(d,a)){const D=r.name("valid");g.removeAdditional==="failing"?(A(R,D,!1),r.if((0,ps.not)(D),()=>{c.reset(),k(R)})):(A(R,D),n||r.if((0,ps.not)(D),()=>r.break()))}}function A(R,D,F){const q={keyword:"additionalProperties",dataProp:R,dataPropType:ku.Type.Str};F===!1&&Object.assign(q,{compositeRule:!0,createErrors:!1,allErrors:!1}),c.subschema(q,D)}}};eh.default=Aw;var ld={};Object.defineProperty(ld,"__esModule",{value:!0});const Pw=Ju(),Vm=Bi,_f=qi,$m=eh,zw={keyword:"properties",type:"object",schemaType:"object",code(c){const{gen:r,schema:a,parentSchema:l,data:u,it:f}=c;f.opts.removeAdditional==="all"&&l.additionalProperties===void 0&&$m.default.code(new Pw.KeywordCxt(f,$m.default,"additionalProperties"));const d=(0,Vm.allSchemaProperties)(a);for(const S of d)f.definedProperties.add(S);f.opts.unevaluated&&d.length&&f.props!==!0&&(f.props=_f.mergeEvaluated.props(r,(0,_f.toHash)(d),f.props));const n=d.filter(S=>!(0,_f.alwaysValidSchema)(f,a[S]));if(n.length===0)return;const g=r.name("valid");for(const S of n)v(S)?E(S):(r.if((0,Vm.propertyInData)(r,u,S,f.opts.ownProperties)),E(S),f.allErrors||r.else().var(g,!0),r.endIf()),c.it.definedProperties.add(S),c.ok(g);function v(S){return f.opts.useDefaults&&!f.compositeRule&&a[S].default!==void 0}function E(S){c.subschema({keyword:"properties",schemaProp:S,dataProp:S},g)}}};ld.default=zw;var cd={};Object.defineProperty(cd,"__esModule",{value:!0});const jm=Bi,Tu=Oi,qm=qi,Zm=qi,Mw={keyword:"patternProperties",type:"object",schemaType:"object",code(c){const{gen:r,schema:a,data:l,parentSchema:u,it:f}=c,{opts:d}=f,n=(0,jm.allSchemaProperties)(a),g=n.filter(A=>(0,qm.alwaysValidSchema)(f,a[A]));if(n.length===0||g.length===n.length&&(!f.opts.unevaluated||f.props===!0))return;const v=d.strictSchema&&!d.allowMatchingProperties&&u.properties,E=r.name("valid");f.props!==!0&&!(f.props instanceof Tu.Name)&&(f.props=(0,Zm.evaluatedPropsToName)(r,f.props));const{props:S}=f;T();function T(){for(const A of n)v&&k(A),f.allErrors?z(A):(r.var(E,!0),z(A),r.if(E))}function k(A){for(const R in v)new RegExp(A).test(R)&&(0,qm.checkStrictMode)(f,`property ${R} matches pattern ${A} (use allowMatchingProperties)`)}function z(A){r.forIn("key",l,R=>{r.if((0,Tu._)`${(0,jm.usePattern)(c,A)}.test(${R})`,()=>{const D=g.includes(A);D||c.subschema({keyword:"patternProperties",schemaProp:A,dataProp:R,dataPropType:Zm.Type.Str},E),f.opts.unevaluated&&S!==!0?r.assign((0,Tu._)`${S}[${R}]`,!0):!D&&!f.allErrors&&r.if((0,Tu.not)(E),()=>r.break())})})}}};cd.default=Mw;var ud={};Object.defineProperty(ud,"__esModule",{value:!0});const Dw=qi,Lw={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(c){const{gen:r,schema:a,it:l}=c;if((0,Dw.alwaysValidSchema)(l,a)){c.fail();return}const u=r.name("valid");c.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},u),c.failResult(u,()=>c.reset(),()=>c.error())},error:{message:"must NOT be valid"}};ud.default=Lw;var hd={};Object.defineProperty(hd,"__esModule",{value:!0});const Rw=Bi,Bw={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:Rw.validateUnion,error:{message:"must match a schema in anyOf"}};hd.default=Bw;var fd={};Object.defineProperty(fd,"__esModule",{value:!0});const Lu=Oi,Ow=qi,Fw={message:"must match exactly one schema in oneOf",params:({params:c})=>(0,Lu._)`{passingSchemas: ${c.passing}}`},Nw={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:Fw,code(c){const{gen:r,schema:a,parentSchema:l,it:u}=c;if(!Array.isArray(a))throw new Error("ajv implementation error");if(u.opts.discriminator&&l.discriminator)return;const f=a,d=r.let("valid",!1),n=r.let("passing",null),g=r.name("_valid");c.setParams({passing:n}),r.block(v),c.result(d,()=>c.reset(),()=>c.error(!0));function v(){f.forEach((E,S)=>{let T;(0,Ow.alwaysValidSchema)(u,E)?r.var(g,!0):T=c.subschema({keyword:"oneOf",schemaProp:S,compositeRule:!0},g),S>0&&r.if((0,Lu._)`${g} && ${d}`).assign(d,!1).assign(n,(0,Lu._)`[${n}, ${S}]`).else(),r.if(g,()=>{r.assign(d,!0),r.assign(n,S),T&&c.mergeEvaluated(T,Lu.Name)})})}}};fd.default=Nw;var dd={};Object.defineProperty(dd,"__esModule",{value:!0});const Uw=qi,Vw={keyword:"allOf",schemaType:"array",code(c){const{gen:r,schema:a,it:l}=c;if(!Array.isArray(a))throw new Error("ajv implementation error");const u=r.name("valid");a.forEach((f,d)=>{if((0,Uw.alwaysValidSchema)(l,f))return;const n=c.subschema({keyword:"allOf",schemaProp:d},u);c.ok(u),c.mergeEvaluated(n)})}};dd.default=Vw;var pd={};Object.defineProperty(pd,"__esModule",{value:!0});const Nu=Oi,ty=qi,$w={message:({params:c})=>(0,Nu.str)`must match "${c.ifClause}" schema`,params:({params:c})=>(0,Nu._)`{failingKeyword: ${c.ifClause}}`},jw={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:$w,code(c){const{gen:r,parentSchema:a,it:l}=c;a.then===void 0&&a.else===void 0&&(0,ty.checkStrictMode)(l,'"if" without "then" and "else" is ignored');const u=Gm(l,"then"),f=Gm(l,"else");if(!u&&!f)return;const d=r.let("valid",!0),n=r.name("_valid");if(g(),c.reset(),u&&f){const E=r.let("ifClause");c.setParams({ifClause:E}),r.if(n,v("then",E),v("else",E))}else u?r.if(n,v("then")):r.if((0,Nu.not)(n),v("else"));c.pass(d,()=>c.error(!0));function g(){const E=c.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},n);c.mergeEvaluated(E)}function v(E,S){return()=>{const T=c.subschema({keyword:E},n);r.assign(d,n),c.mergeValidEvaluated(T,d),S?r.assign(S,(0,Nu._)`${E}`):c.setParams({ifClause:E})}}}};function Gm(c,r){const a=c.schema[r];return a!==void 0&&!(0,ty.alwaysValidSchema)(c,a)}pd.default=jw;var md={};Object.defineProperty(md,"__esModule",{value:!0});const qw=qi,Zw={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:c,parentSchema:r,it:a}){r.if===void 0&&(0,qw.checkStrictMode)(a,`"${c}" without "if" is ignored`)}};md.default=Zw;Object.defineProperty(rd,"__esModule",{value:!0});const Gw=Ko,Hw=nd,Ww=Xo,Kw=sd,Xw=ad,Jw=Q_,Yw=od,Qw=eh,ex=ld,tx=cd,ix=ud,rx=hd,nx=fd,sx=dd,ax=pd,ox=md;function lx(c=!1){const r=[ix.default,rx.default,nx.default,sx.default,ax.default,ox.default,Yw.default,Qw.default,Jw.default,ex.default,tx.default];return c?r.push(Hw.default,Kw.default):r.push(Gw.default,Ww.default),r.push(Xw.default),r}rd.default=lx;var gd={},_d={};Object.defineProperty(_d,"__esModule",{value:!0});const Nr=Oi,cx={message:({schemaCode:c})=>(0,Nr.str)`must match format "${c}"`,params:({schemaCode:c})=>(0,Nr._)`{format: ${c}}`},ux={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:cx,code(c,r){const{gen:a,data:l,$data:u,schema:f,schemaCode:d,it:n}=c,{opts:g,errSchemaPath:v,schemaEnv:E,self:S}=n;if(!g.validateFormats)return;u?T():k();function T(){const z=a.scopeValue("formats",{ref:S.formats,code:g.code.formats}),A=a.const("fDef",(0,Nr._)`${z}[${d}]`),R=a.let("fType"),D=a.let("format");a.if((0,Nr._)`typeof ${A} == "object" && !(${A} instanceof RegExp)`,()=>a.assign(R,(0,Nr._)`${A}.type || "string"`).assign(D,(0,Nr._)`${A}.validate`),()=>a.assign(R,(0,Nr._)`"string"`).assign(D,A)),c.fail$data((0,Nr.or)(F(),q()));function F(){return g.strictSchema===!1?Nr.nil:(0,Nr._)`${d} && !${D}`}function q(){const ee=E.$async?(0,Nr._)`(${A}.async ? await ${D}(${l}) : ${D}(${l}))`:(0,Nr._)`${D}(${l})`,ie=(0,Nr._)`(typeof ${D} == "function" ? ${ee} : ${D}.test(${l}))`;return(0,Nr._)`${D} && ${D} !== true && ${R} === ${r} && !${ie}`}}function k(){const z=S.formats[f];if(!z){F();return}if(z===!0)return;const[A,R,D]=q(z);A===r&&c.pass(ee());function F(){if(g.strictSchema===!1){S.logger.warn(ie());return}throw new Error(ie());function ie(){return`unknown format "${f}" ignored in schema at path "${v}"`}}function q(ie){const ne=ie instanceof RegExp?(0,Nr.regexpCode)(ie):g.code.formats?(0,Nr._)`${g.code.formats}${(0,Nr.getProperty)(f)}`:void 0,se=a.scopeValue("formats",{key:f,ref:ie,code:ne});return typeof ie=="object"&&!(ie instanceof RegExp)?[ie.type||"string",ie.validate,(0,Nr._)`${se}.validate`]:["string",ie,se]}function ee(){if(typeof z=="object"&&!(z instanceof RegExp)&&z.async){if(!E.$async)throw new Error("async format in sync schema");return(0,Nr._)`await ${D}(${l})`}return typeof R=="function"?(0,Nr._)`${D}(${l})`:(0,Nr._)`${D}.test(${l})`}}}};_d.default=ux;Object.defineProperty(gd,"__esModule",{value:!0});const hx=_d,fx=[hx.default];gd.default=fx;var Go={};Object.defineProperty(Go,"__esModule",{value:!0});Go.contentVocabulary=Go.metadataVocabulary=void 0;Go.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];Go.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty($f,"__esModule",{value:!0});const dx=jf,px=Zf,mx=rd,gx=gd,Hm=Go,_x=[dx.default,px.default,(0,mx.default)(),gx.default,Hm.metadataVocabulary,Hm.contentVocabulary];$f.default=_x;var yd={},iy={};(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.DiscrError=void 0,function(r){r.Tag="tag",r.Mapping="mapping"}(c.DiscrError||(c.DiscrError={}))})(iy);Object.defineProperty(yd,"__esModule",{value:!0});const Uo=Oi,If=iy,Wm=Bn,yx=qi,vx={message:({params:{discrError:c,tagName:r}})=>c===If.DiscrError.Tag?`tag "${r}" must be string`:`value of tag "${r}" must be in oneOf`,params:({params:{discrError:c,tag:r,tagName:a}})=>(0,Uo._)`{error: ${c}, tag: ${a}, tagValue: ${r}}`},bx={keyword:"discriminator",type:"object",schemaType:"object",error:vx,code(c){const{gen:r,data:a,schema:l,parentSchema:u,it:f}=c,{oneOf:d}=u;if(!f.opts.discriminator)throw new Error("discriminator: requires discriminator option");const n=l.propertyName;if(typeof n!="string")throw new Error("discriminator: requires propertyName");if(l.mapping)throw new Error("discriminator: mapping is not supported");if(!d)throw new Error("discriminator: requires oneOf keyword");const g=r.let("valid",!1),v=r.const("tag",(0,Uo._)`${a}${(0,Uo.getProperty)(n)}`);r.if((0,Uo._)`typeof ${v} == "string"`,()=>E(),()=>c.error(!1,{discrError:If.DiscrError.Tag,tag:v,tagName:n})),c.ok(g);function E(){const k=T();r.if(!1);for(const z in k)r.elseIf((0,Uo._)`${v} === ${z}`),r.assign(g,S(k[z]));r.else(),c.error(!1,{discrError:If.DiscrError.Mapping,tag:v,tagName:n}),r.endIf()}function S(k){const z=r.name("valid"),A=c.subschema({keyword:"oneOf",schemaProp:k},z);return c.mergeEvaluated(A,Uo.Name),z}function T(){var k;const z={},A=D(u);let R=!0;for(let ee=0;ee<d.length;ee++){let ie=d[ee];ie!=null&&ie.$ref&&!(0,yx.schemaHasRulesButRef)(ie,f.self.RULES)&&(ie=Wm.resolveRef.call(f.self,f.schemaEnv.root,f.baseId,ie==null?void 0:ie.$ref),ie instanceof Wm.SchemaEnv&&(ie=ie.schema));const ne=(k=ie==null?void 0:ie.properties)===null||k===void 0?void 0:k[n];if(typeof ne!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${n}"`);R=R&&(A||D(ie)),F(ne,ee)}if(!R)throw new Error(`discriminator: "${n}" must be required`);return z;function D({required:ee}){return Array.isArray(ee)&&ee.includes(n)}function F(ee,ie){if(ee.const)q(ee.const,ie);else if(ee.enum)for(const ne of ee.enum)q(ne,ie);else throw new Error(`discriminator: "properties/${n}" must have "const" or "enum"`)}function q(ee,ie){if(typeof ee!="string"||ee in z)throw new Error(`discriminator: "${n}" values must be unique strings`);z[ee]=ie}}}};yd.default=bx;const wx="http://json-schema.org/draft-07/schema#",xx="http://json-schema.org/draft-07/schema#",Ex="Core schema meta-schema",Sx={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},kx=["object","boolean"],Tx={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},Cx={$schema:wx,$id:xx,title:Ex,definitions:Sx,type:kx,properties:Tx,default:!0};(function(c,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MissingRefError=r.ValidationError=r.CodeGen=r.Name=r.nil=r.stringify=r.str=r._=r.KeywordCxt=void 0;const a=B_,l=$f,u=yd,f=Cx,d=["/properties"],n="http://json-schema.org/draft-07/schema";class g extends a.default{_addVocabularies(){super._addVocabularies(),l.default.forEach(z=>this.addVocabulary(z)),this.opts.discriminator&&this.addKeyword(u.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const z=this.opts.$data?this.$dataMetaSchema(f,d):f;this.addMetaSchema(z,n,!1),this.refs["http://json-schema.org/schema"]=n}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(n)?n:void 0)}}c.exports=r=g,Object.defineProperty(r,"__esModule",{value:!0}),r.default=g;var v=Ju();Object.defineProperty(r,"KeywordCxt",{enumerable:!0,get:function(){return v.KeywordCxt}});var E=Oi;Object.defineProperty(r,"_",{enumerable:!0,get:function(){return E._}}),Object.defineProperty(r,"str",{enumerable:!0,get:function(){return E.str}}),Object.defineProperty(r,"stringify",{enumerable:!0,get:function(){return E.stringify}}),Object.defineProperty(r,"nil",{enumerable:!0,get:function(){return E.nil}}),Object.defineProperty(r,"Name",{enumerable:!0,get:function(){return E.Name}}),Object.defineProperty(r,"CodeGen",{enumerable:!0,get:function(){return E.CodeGen}});var S=bc;Object.defineProperty(r,"ValidationError",{enumerable:!0,get:function(){return S.default}});var T=wc;Object.defineProperty(r,"MissingRefError",{enumerable:!0,get:function(){return T.default}})})(xf,xf.exports);var Ix=xf.exports;const Ax=Ku(Ix);/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var Px=Object.prototype.toString,Jo=Array.isArray||function(r){return Px.call(r)==="[object Array]"};function vd(c){return typeof c=="function"}function zx(c){return Jo(c)?"array":typeof c}function yf(c){return c.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Km(c,r){return c!=null&&typeof c=="object"&&r in c}function Mx(c,r){return c!=null&&typeof c!="object"&&c.hasOwnProperty&&c.hasOwnProperty(r)}var Dx=RegExp.prototype.test;function Lx(c,r){return Dx.call(c,r)}var Rx=/\S/;function Bx(c){return!Lx(Rx,c)}var Ox={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Fx(c){return String(c).replace(/[&<>"'`=\/]/g,function(a){return Ox[a]})}var Nx=/\s*/,Ux=/\s+/,Xm=/\s*=/,Vx=/\s*\}/,$x=/#|\^|\/|>|\{|&|=|!/;function jx(c,r){if(!c)return[];var a=!1,l=[],u=[],f=[],d=!1,n=!1,g="",v=0;function E(){if(d&&!n)for(;f.length;)delete u[f.pop()];else f=[];d=!1,n=!1}var S,T,k;function z(ue){if(typeof ue=="string"&&(ue=ue.split(Ux,2)),!Jo(ue)||ue.length!==2)throw new Error("Invalid tags: "+ue);S=new RegExp(yf(ue[0])+"\\s*"),T=new RegExp("\\s*"+yf(ue[1])),k=new RegExp("\\s*"+yf("}"+ue[1]))}z(r||Qn.tags);for(var A=new Ec(c),R,D,F,q,ee,ie;!A.eos();){if(R=A.pos,F=A.scanUntil(S),F)for(var ne=0,se=F.length;ne<se;++ne)q=F.charAt(ne),Bx(q)?(f.push(u.length),g+=q):(n=!0,a=!0,g+=" "),u.push(["text",q,R,R+1]),R+=1,q===`
`&&(E(),g="",v=0,a=!1);if(!A.scan(S))break;if(d=!0,D=A.scan($x)||"name",A.scan(Nx),D==="="?(F=A.scanUntil(Xm),A.scan(Xm),A.scanUntil(T)):D==="{"?(F=A.scanUntil(k),A.scan(Vx),A.scanUntil(T),D="&"):F=A.scanUntil(T),!A.scan(T))throw new Error("Unclosed tag at "+A.pos);if(D==">"?ee=[D,F,R,A.pos,g,v,a]:ee=[D,F,R,A.pos],v++,u.push(ee),D==="#"||D==="^")l.push(ee);else if(D==="/"){if(ie=l.pop(),!ie)throw new Error('Unopened section "'+F+'" at '+R);if(ie[1]!==F)throw new Error('Unclosed section "'+ie[1]+'" at '+R)}else D==="name"||D==="{"||D==="&"?n=!0:D==="="&&z(F)}if(E(),ie=l.pop(),ie)throw new Error('Unclosed section "'+ie[1]+'" at '+A.pos);return Zx(qx(u))}function qx(c){for(var r=[],a,l,u=0,f=c.length;u<f;++u)a=c[u],a&&(a[0]==="text"&&l&&l[0]==="text"?(l[1]+=a[1],l[3]=a[3]):(r.push(a),l=a));return r}function Zx(c){for(var r=[],a=r,l=[],u,f,d=0,n=c.length;d<n;++d)switch(u=c[d],u[0]){case"#":case"^":a.push(u),l.push(u),a=u[4]=[];break;case"/":f=l.pop(),f[5]=u[2],a=l.length>0?l[l.length-1][4]:r;break;default:a.push(u)}return r}function Ec(c){this.string=c,this.tail=c,this.pos=0}Ec.prototype.eos=function(){return this.tail===""};Ec.prototype.scan=function(r){var a=this.tail.match(r);if(!a||a.index!==0)return"";var l=a[0];return this.tail=this.tail.substring(l.length),this.pos+=l.length,l};Ec.prototype.scanUntil=function(r){var a=this.tail.search(r),l;switch(a){case-1:l=this.tail,this.tail="";break;case 0:l="";break;default:l=this.tail.substring(0,a),this.tail=this.tail.substring(a)}return this.pos+=l.length,l};function Ho(c,r){this.view=c,this.cache={".":this.view},this.parent=r}Ho.prototype.push=function(r){return new Ho(r,this)};Ho.prototype.lookup=function(r){var a=this.cache,l;if(a.hasOwnProperty(r))l=a[r];else{for(var u=this,f,d,n,g=!1;u;){if(r.indexOf(".")>0)for(f=u.view,d=r.split("."),n=0;f!=null&&n<d.length;)n===d.length-1&&(g=Km(f,d[n])||Mx(f,d[n])),f=f[d[n++]];else f=u.view[r],g=Km(u.view,r);if(g){l=f;break}u=u.parent}a[r]=l}return vd(l)&&(l=l.call(this.view)),l};function Pn(){this.templateCache={_cache:{},set:function(r,a){this._cache[r]=a},get:function(r){return this._cache[r]},clear:function(){this._cache={}}}}Pn.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Pn.prototype.parse=function(r,a){var l=this.templateCache,u=r+":"+(a||Qn.tags).join(":"),f=typeof l<"u",d=f?l.get(u):void 0;return d==null&&(d=jx(r,a),f&&l.set(u,d)),d};Pn.prototype.render=function(r,a,l,u){var f=this.getConfigTags(u),d=this.parse(r,f),n=a instanceof Ho?a:new Ho(a,void 0);return this.renderTokens(d,n,l,r,u)};Pn.prototype.renderTokens=function(r,a,l,u,f){for(var d="",n,g,v,E=0,S=r.length;E<S;++E)v=void 0,n=r[E],g=n[0],g==="#"?v=this.renderSection(n,a,l,u,f):g==="^"?v=this.renderInverted(n,a,l,u,f):g===">"?v=this.renderPartial(n,a,l,f):g==="&"?v=this.unescapedValue(n,a):g==="name"?v=this.escapedValue(n,a,f):g==="text"&&(v=this.rawValue(n)),v!==void 0&&(d+=v);return d};Pn.prototype.renderSection=function(r,a,l,u,f){var d=this,n="",g=a.lookup(r[1]);function v(T){return d.render(T,a,l,f)}if(g){if(Jo(g))for(var E=0,S=g.length;E<S;++E)n+=this.renderTokens(r[4],a.push(g[E]),l,u,f);else if(typeof g=="object"||typeof g=="string"||typeof g=="number")n+=this.renderTokens(r[4],a.push(g),l,u,f);else if(vd(g)){if(typeof u!="string")throw new Error("Cannot use higher-order sections without the original template");g=g.call(a.view,u.slice(r[3],r[5]),v),g!=null&&(n+=g)}else n+=this.renderTokens(r[4],a,l,u,f);return n}};Pn.prototype.renderInverted=function(r,a,l,u,f){var d=a.lookup(r[1]);if(!d||Jo(d)&&d.length===0)return this.renderTokens(r[4],a,l,u,f)};Pn.prototype.indentPartial=function(r,a,l){for(var u=a.replace(/[^ \t]/g,""),f=r.split(`
`),d=0;d<f.length;d++)f[d].length&&(d>0||!l)&&(f[d]=u+f[d]);return f.join(`
`)};Pn.prototype.renderPartial=function(r,a,l,u){if(l){var f=this.getConfigTags(u),d=vd(l)?l(r[1]):l[r[1]];if(d!=null){var n=r[6],g=r[5],v=r[4],E=d;g==0&&v&&(E=this.indentPartial(d,v,n));var S=this.parse(E,f);return this.renderTokens(S,a,l,E,u)}}};Pn.prototype.unescapedValue=function(r,a){var l=a.lookup(r[1]);if(l!=null)return l};Pn.prototype.escapedValue=function(r,a,l){var u=this.getConfigEscape(l)||Qn.escape,f=a.lookup(r[1]);if(f!=null)return typeof f=="number"&&u===Qn.escape?String(f):u(f)};Pn.prototype.rawValue=function(r){return r[1]};Pn.prototype.getConfigTags=function(r){return Jo(r)?r:r&&typeof r=="object"?r.tags:void 0};Pn.prototype.getConfigEscape=function(r){if(r&&typeof r=="object"&&!Jo(r))return r.escape};var Qn={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(c){gc.templateCache=c},get templateCache(){return gc.templateCache}},gc=new Pn;Qn.clearCache=function(){return gc.clearCache()};Qn.parse=function(r,a){return gc.parse(r,a)};Qn.render=function(r,a,l,u){if(typeof r!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+zx(r)+'" was given as the first argument for mustache#render(template, view, partials)');return gc.render(r,a,l,u)};Qn.escape=Fx;Qn.Scanner=Ec;Qn.Context=Ho;Qn.Writer=Pn;let Cu=null;function No(c,r){return String.fromCodePoint("A".codePointAt(0)-1+c)+r}function Gx(c,r){if(r==="text")return c.map(a=>({isText:!0,displayValue:a}));if(r==="number_with_commas")return c.map(a=>({isNumeric:!0,rawValue:a,displayValue:a.toLocaleString("en-GB"),style:r}));if(r==="number_1dp")return c.map(a=>({isNumeric:!0,rawValue:a,displayValue:a.toFixed(1),style:r}));throw new Error("Unrecognised column style: "+r)}function Jm(c,r){r(c.sheetName,a=>{c.sheetName=a});for(let a=0;a<c.sheetIntroText.length;a++)r(c.sheetIntroText[a],l=>{c.sheetIntroText[a]=l});for(const a of c.columns)if(r(a.heading,l=>{a.heading=l}),a.style==="text")for(let l=0;l<a.values.length;l++)r(a.values[l],u=>{a.values[l]=u})}function Hx(c,r){if(!c)return[];const a=/\[\[[^\]]+\]\]/g;let l=c.map(({name:f,text:d})=>({name:f,text:d,used:!1}));const u=new Map(l.map(f=>[`[[${f.name}]]`,f]));for(const f of r)f.sheetIntroText||(f.sheetIntroText=[]),f.hasNotes=!1,Jm(f,d=>{for(const n of d.match(a)||[])u.get(n).used=!0,f.hasNotes=!0});l=l.filter(f=>f.used),l.forEach((f,d)=>f.name=`[note ${d+1}]`);for(const f of r)if(f.hasNotes){const d=n=>u.get(n).name;Jm(f,(n,g)=>{g(n.replace(a,d))})}return l}function Wx(c){return(Math.max(...c.map(a=>Pu(a)))/37.8+.5).toFixed(2)}function Ym(c){const r=c.split(" "),a=15.45*37.8,l=Pu(" ");let u=1,f=Pu(r[0]);for(const d of r.slice(1)){const n=Pu(d);f+=l+n,f>a&&(++u,f=n)}return u}function Kx(c){return c.flatMap(r=>r.split(`
`)).map((r,a)=>{if(r.startsWith("## "))return{isSubtitle:!0,text:r.slice(3)};if(/^\[.*\]\(.*\)$/.test(r)){const l=r.slice(1,-1).split("](");return{isHyperlink:!0,text:l[0],href:l[1],rowCount:Ym(".")}}return{isText:!0,text:r,rowCount:Ym(r)}})}function Xx(c){let r="This worksheet contains one table.";return c?r+" Some cells refer to notes, which can be found on the notes worksheet.":r}function Jx(c){if(Cu||(Cu=new Ax().compile(wv)),!Cu(c))throw console.log(Cu.errors),new Error("Input did not match the schema");const a={coverSheetTitle:c.coverSheetTitle,firstTocCell:No(1,3),lastTocCell:No(2,3+c.sheets.length),coverSheetContents:Kx(c.coverSheetContents),sheets:JSON.parse(JSON.stringify(c.sheets))};a.coverSheetRowStyles=[...new Set(a.coverSheetContents.map(l=>l.rowCount).filter(Boolean))].map(l=>({styleName:"coverSheetRowStyle_"+l,rowHeightCm:l*.53+.4})),a.notes=Hx(c.notes,a.sheets),a.notes.length>0&&(a.hasNotes=!0,a.firstNotesTableCell=No(1,3),a.lastNotesTableCell=No(2,3+a.notes.length)),a.tableCount=a.sheets.length+2+a.hasNotes;for(let l=0;l<a.sheets.length;l++){const u=a.sheets[l];u.sheetNumber=l+1,u.sheetIntroText=[Xx(u.hasNotes),...u.sheetIntroText||[]],u.introText=u.sheetIntroText.map((f,d)=>({text:f,isLastIntroRow:d===u.sheetIntroText.length-1})),u.firstTableCell=No(1,2+u.sheetIntroText.length),u.lastTableCell=No(u.columns.length,2+u.columns[0].values.length+u.sheetIntroText.length);for(const f of u.columns)f.valuesFormatted=Gx(f.values,f.style),f.isNumeric=f.style!=="text",f.headingLines=f.heading.split(`
`);u.rows=[];for(let f=0;f<u.columns[0].values.length;f++)u.rows.push({cellsInRow:u.columns.map(d=>d.valuesFormatted[f])});u.columnStyles=u.columns.map((f,d)=>{const n=Math.max(2.4,Wx(f.valuesFormatted.map(g=>g.displayValue)));return{name:"colStyle"+l+"_"+d,widthCm:n}})}return bv.map(l=>({filename:l.filename,contents:Qn.render(l.contents,a)}))}const Qm="https://jtrim-ons.github.io/key-pop-data2/generated/",qa={sameAsAnInputVar:"sameAsAnInputVar",missingBecauseDisclosive:"missingBecauseDisclosive",missingUnavailableAgeRange:"missingUnavailableAgeRange",missingAgeUnder16:"missingAgeUnder16",available:"available"};function Yx(c){let r=[...c].sort((l,u)=>l.key.localeCompare(u.key));return{selString:c.length==0?"data":r.map((l,u)=>u<r.length-1?`${l.key}-${l.code}`:`${l.key}`).join("/"),lastCode:c.length>0?r[r.length-1].code:null}}async function ry(c,r=[],a=window.fetch){if(r.length>0&&!r[0].newFormat)throw new Error("OLD FORMAT!");let{selString:l,lastCode:u}=Yx(r),f={data:{}},d;if(r.length===0){let n=`${Qm}${r.length}var_percent/${l}.json`;d=await(await a(n)).json(),f.total_pop={count:d.sex.count[0]+d.sex.count[1],percent:100}}else{let n=`${Qm}${r.length}var-combined_percent/${l}.json`,v=await(await a(n)).json();d=v.bar_chart_data[u],f.mapData=v.map_data[u],f.total_pop=d.total_pop}for(let n of c){f.data[n.key]={};for(let g of n.tables)f.data[n.key][g.code]={values:d[g.code]}}return f}function Qx(c,r,a){for(let l=1;l<r.length;l++)if(c<=r[l])return a[l-1]}async function e2(c,r,a=window.fetch){let u=await(await a(c)).json();return await yv(u,r)}function fa(c){return c.charAt(0).toUpperCase()+c.slice(1)}function Af(c){return c.replace(new RegExp(" \\([0-9]* categories\\)"),"")}const ny=(c,r)=>c.label===r.label?0:c.label==="Not answered"?1:r.label==="Not answered"?-1:c.label==="Other religion"?1:r.label==="Other religion"?-1:c.label.localeCompare(r.label,"en-GB");function Uu(c,r,a){let l=a.all[c][r].values,u=a.selected[c][r].values,f=[],d=Ru[r].map((n,g)=>({...n,index:g}));return r==="religion_tb"&&(d=[...d].sort(ny)),d.forEach(n=>{let g=n.label,v=l.percent[n.index],E=u.percent[n.index];a.selected.total_pop!=a.all.total_pop&&f.push({group:"This group",category:g,value:E}),f.push({group:"Whole population",category:g,value:v})}),f}function eg(c){if(c===100)return"100";const r=c.toFixed(1);return r!=="0.0"?r:"Less than 0.05"}function Ka(c){return c.split(": ").slice(-1)[0]}function Pf(c,r){return r.statusOfVariables[c]===qa.available}function t2(c){return["This spreadsheet contains the data for a profile generated using the tool 'Create a population group profile' on the Office for National Statistics website.",`[View this profile on the ONS website](${document.location.href})`,"## Source","Census 2021 from the Office for National Statistics","## Selected population group","This profile is for people who share the following characteristic"+(c.length>1?"s.":"."),...c.map(a=>` - ${a.longLabel}: ${Ka(a.label)}`),"## More Census data","[Other census datasets are available on the ONS website.](https://www.ons.gov.uk/census)","## Contact","[Email Census Customer Services](mailto:census.customerservices@ons.gov.uk?subject=Create%20a%20population%20group%20profile)","Phone +44 1329 444972"]}function i2(c){let r=["Source: Census 2021 from the Office for National Statistics",`Counts are for ${c.populationBase} meeting the criteria on the cover sheet.`];return Ru[c.code].some(a=>a.cells.length>1)&&(r.push(`The data on this sheet is based on  the variable "${c.key}" (${c.code}).`),r.push(`Some categories have been merged to create the ${Ru[c.code].length} categories shown.`)),r}function r2(c,r,a){const l={coverSheetTitle:"Data Downloaded from 'Create a Population Group Profile'",coverSheetContents:t2(a),tableHeadings:["Category","Selected group %","England and Wales %","Selected group count","England and Wales count"],sheets:[]};l.sheets.push({sheetName:"Total population",tableName:"total_population",sheetIntroText:["Source: Census 2021 from the Office for National Statistics"],columns:[{heading:"Group",style:"text",values:["Selected group"]},{heading:"Count",style:"number_with_commas",values:[c.selected.total_pop.count]},{heading:"% of England and Wales population",style:"number_1dp",values:[c.selected.total_pop.percent]}]});let u=c.geoPerc.filter(f=>f.value!=null).sort((f,d)=>f.name.localeCompare(d.name,"en-GB"));u.length>0&&l.sheets.push({sheetName:"Percentage of Population, by Local Authority",tableName:"percentage_of_population",sheetIntroText:["Source: Census 2021 from the Office for National Statistics"],columns:[{heading:"Local Authority",style:"text",values:u.map(f=>f.name)},{heading:"% of Local Authority Population",style:"number_1dp",values:u.map(f=>f.value)},{heading:"Count",style:"number_with_commas",values:u.map(f=>f.count)}]});for(let f of r[0].tables){if(c.statusOfVariables.resident_age_18b==="available"&&f.code==="resident_age_23a"||!Pf(f.code,c)||c.selected.residents[f.code].values==null)continue;let d={sheetName:Af(f.key).replace("Age (B)","Age"),tableName:f.code,sheetIntroText:i2(f),columns:[{heading:"Category",style:"text",values:Ru[f.code].map(n=>n.label)},{heading:`Selected group
(%)`,style:"number_1dp",values:c.selected.residents[f.code].values.percent},{heading:`England and Wales
(%)`,style:"number_1dp",values:c.all.residents[f.code].values.percent},{heading:`Selected group
(count)`,style:"number_with_commas",values:c.selected.residents[f.code].values.count},{heading:`England and Wales
(count)`,style:"number_with_commas",values:c.all.residents[f.code].values.count}]};l.sheets.push(d)}return Jx(l)}function n2(c,r){const a={};for(const l of r){const u=c.residents[l.code].values;u===void 0?a[l.code]=qa.sameAsAnInputVar:u==="blocked"?a[l.code]=qa.missingBecauseDisclosive:u==="unavailable_age_range"?a[l.code]=qa.missingUnavailableAgeRange:u==="all_zero"?a[l.code]=qa.missingAgeUnder16:a[l.code]=qa.available}return a}function s2(c){let r={};for(let a in qa)r[a]=0;for(let a of Object.values(c))++r[a];return c.resident_age_18b==="available"?--r[c.resident_age_23a]:--r[c.resident_age_18b],r.missing=r.missingBecauseDisclosive+r.missingUnavailableAgeRange+r.missingAgeUnder16,r.total=r.missing+r.available,r}async function a2({fetch:c}){let r=await e2(qo+ac.url,ac.layer,c),a=(await ry(jo,[],c)).data,l=[],u={},f=[];return r.features.forEach(d=>{const n=d.properties[ac.code],g=d.properties[ac.name],v={code:n,name:g};l.push(v),u[n]=v,f.push({...v,value:100,color:Vo.seq[4]})}),{geojson:r,geoCodesAndNames:l,geoCodesLookup:u,geoPerc:f,all:a,selected:null}}const jS=Object.freeze(Object.defineProperty({__proto__:null,load:a2},Symbol.toStringTag,{value:"Module"})),o2=D_("goto"),l2=D_("after_navigate");function c2(c){return c.slice().sort(function(r,a){return r-a})}function tg(c,r){for(var a=[],l=0;l<c;l++){for(var u=[],f=0;f<r;f++)u.push(0);a.push(u)}return a}function u2(c){for(var r=0,a,l=0;l<c.length;l++)(l===0||c[l]!==a)&&(a=c[l],r++);return r}function zf(c,r,a,l){var u;if(c>0){var f=(a[r]-a[c-1])/(r-c+1);u=l[r]-l[c-1]-(r-c+1)*f*f}else u=l[r]-a[r]*a[r]/(r+1);return u<0?0:u}function Mf(c,r,a,l,u,f,d){if(!(c>r)){var n=Math.floor((c+r)/2);l[a][n]=l[a-1][n-1],u[a][n]=n;var g=a;c>a&&(g=Math.max(g,u[a][c-1]||0)),g=Math.max(g,u[a-1][n]||0);var v=n-1;r<l[0].length-1&&(v=Math.min(v,u[a][r+1]||0));for(var E,S,T,k,z=v;z>=g&&(E=zf(z,n,f,d),!(E+l[a-1][g-1]>=l[a][n]));--z)S=zf(g,n,f,d),T=S+l[a-1][g-1],T<l[a][n]&&(l[a][n]=T,u[a][n]=g),g++,k=E+l[a-1][z-1],k<l[a][n]&&(l[a][n]=k,u[a][n]=z);Mf(c,n-1,a,l,u,f,d),Mf(n+1,r,a,l,u,f,d)}}function h2(c,r,a){for(var l=r[0].length,u=c[Math.floor(l/2)],f=[],d=[],n=0,g=void 0;n<l;++n)g=c[n]-u,n===0?(f.push(g),d.push(g*g)):(f.push(f[n-1]+g),d.push(d[n-1]+g*g)),r[0][n]=zf(0,n,f,d),a[0][n]=0;for(var v,E=1;E<r.length;++E)E<r.length-1?v=E:v=l-1,Mf(v,l-1,E,r,a,f,d)}function f2(c,r){if(r>c.length)throw new Error("cannot generate more classes than there are data values");var a=c2(c),l=u2(a);if(l===1)return[a];var u=tg(r,a.length),f=tg(r,a.length);h2(a,u,f);for(var d=[],n=f[0].length-1,g=f.length-1;g>=0;g--){var v=f[g][n];d[g]=a.slice(v,n+1),g>0&&(n=v-1)}return d}function ig(c,r,a){const l=c.slice();return l[15]=r[a],l}function rg(c,r,a){const l=c.slice();return l[18]=r[a],l[20]=a,l}function ng(c,r,a){const l=c.slice();return l[18]=r[a],l[20]=a,l}function sg(c,r,a){const l=c.slice();return l[15]=r[a],l[20]=a,l}function ag(c,r,a){const l=c.slice();return l[15]=r[a],l}function og(c,r,a){const l=c.slice();return l[18]=r[a],l[20]=a,l}function lg(c){let r,a=c[1](c[18][c[0]])+"",l,u;return{c(){r=$e("td"),l=Ut(a),u=Ut(c[2])},l(f){r=je(f,"TD",{});var d=et(r);l=Vt(d,a),u=Vt(d,c[2]),d.forEach(J)},m(f,d){Ze(f,r,d),ze(r,l),ze(r,u)},p(f,d){d&131&&a!==(a=f[1](f[18][f[0]])+"")&&bi(l,a),d&4&&bi(u,f[2])},d(f){f&&J(r)}}}function cg(c){let r,a,l=c[15].label+"",u,f,d,n=Pi(c[15].values),g=[];for(let v=0;v<n.length;v+=1)g[v]=lg(og(c,n,v));return{c(){r=$e("tr"),a=$e("td"),u=Ut(l),f=mt();for(let v=0;v<g.length;v+=1)g[v].c();d=mt()},l(v){r=je(v,"TR",{});var E=et(r);a=je(E,"TD",{});var S=et(a);u=Vt(S,l),S.forEach(J),f=gt(E);for(let T=0;T<g.length;T+=1)g[T].l(E);d=gt(E),E.forEach(J)},m(v,E){Ze(v,r,E),ze(r,a),ze(a,u),ze(r,f);for(let S=0;S<g.length;S+=1)g[S]&&g[S].m(r,null);ze(r,d)},p(v,E){if(E&128&&l!==(l=v[15].label+"")&&bi(u,l),E&135){n=Pi(v[15].values);let S;for(S=0;S<n.length;S+=1){const T=og(v,n,S);g[S]?g[S].p(T,E):(g[S]=lg(T),g[S].c(),g[S].m(r,d))}for(;S<g.length;S+=1)g[S].d(1);g.length=n.length}},d(v){v&&J(r),Pr(g,v)}}}function ug(c){let r,a=Pi(c[9]),l=[];for(let u=0;u<a.length;u+=1)l[u]=hg(sg(c,a,u));return{c(){r=$e("ul");for(let u=0;u<l.length;u+=1)l[u].c();this.h()},l(u){r=je(u,"UL",{class:!0});var f=et(r);for(let d=0;d<l.length;d+=1)l[d].l(f);f.forEach(J),this.h()},h(){_e(r,"class","legend-block svelte-1qm8uu9")},m(u,f){Ze(u,r,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(r,null)},p(u,f){if(f&544){a=Pi(u[9]);let d;for(d=0;d<a.length;d+=1){const n=sg(u,a,d);l[d]?l[d].p(n,f):(l[d]=hg(n),l[d].c(),l[d].m(r,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},d(u){u&&J(r),Pr(l,u)}}}function hg(c){let r,a,l,u,f=c[15]+"",d,n;return{c(){r=$e("li"),a=$e("div"),l=mt(),u=$e("span"),d=Ut(f),n=mt(),this.h()},l(g){r=je(g,"LI",{class:!0});var v=et(r);a=je(v,"DIV",{class:!0}),et(a).forEach(J),l=gt(v),u=je(v,"SPAN",{class:!0});var E=et(u);d=Vt(E,f),E.forEach(J),n=gt(v),v.forEach(J),this.h()},h(){_e(a,"class","legend-vis "+(c[20]==0?"bar":"marker")+" svelte-1qm8uu9"),Ft(a,"height","1rem"),Ft(a,"width",c[20]==0?"1rem":c[5]+"px"),_e(u,"class",dc(c[20]==0?"bold":"brackets")+" svelte-1qm8uu9"),_e(r,"class","svelte-1qm8uu9"),Ht(r,"ew",c[20]!=0)},m(g,v){Ze(g,r,v),ze(r,a),ze(r,l),ze(r,u),ze(u,d),ze(r,n)},p(g,v){v&32&&Ft(a,"width",g[20]==0?"1rem":g[5]+"px"),v&512&&f!==(f=g[15]+"")&&bi(d,f)},d(g){g&&J(r)}}}function fg(c){let r,a=c[1](c[18][c[0]])+"",l,u;return{c(){r=$e("span"),l=Ut(a),u=Ut(c[2]),this.h()},l(f){r=je(f,"SPAN",{class:!0});var d=et(r);l=Vt(d,a),u=Vt(d,c[2]),d.forEach(J),this.h()},h(){_e(r,"class","label "+(c[20]==0?"bold":"sml brackets")+" svelte-1qm8uu9")},m(f,d){Ze(f,r,d),ze(r,l),ze(r,u)},p(f,d){d&131&&a!==(a=f[1](f[18][f[0]])+"")&&bi(l,a),d&4&&bi(u,f[2])},d(f){f&&J(r)}}}function d2(c){let r,a=`calc(${c[8](c[18][c[0]])}% - ${c[5]/2}px)`,l=`${c[5]}px`;return{c(){r=$e("div"),this.h()},l(u){r=je(u,"DIV",{class:!0}),et(r).forEach(J),this.h()},h(){_e(r,"class","marker svelte-1qm8uu9"),Ft(r,"left",a),Ft(r,"border-left-width",l)},m(u,f){Ze(u,r,f)},p(u,f){f&417&&a!==(a=`calc(${u[8](u[18][u[0]])}% - ${u[5]/2}px)`)&&Ft(r,"left",a),f&32&&l!==(l=`${u[5]}px`)&&Ft(r,"border-left-width",l)},d(u){u&&J(r)}}}function p2(c){let r,a=`${c[8](c[18][c[0]])}%`;return{c(){r=$e("div"),this.h()},l(l){r=je(l,"DIV",{class:!0}),et(r).forEach(J),this.h()},h(){_e(r,"class","bar svelte-1qm8uu9"),Ft(r,"left","0"),Ft(r,"width",a)},m(l,u){Ze(l,r,u)},p(l,u){u&385&&a!==(a=`${l[8](l[18][l[0]])}%`)&&Ft(r,"width",a)},d(l){l&&J(r)}}}function dg(c){let r;function a(f,d){return f[20]==0?p2:d2}let u=a(c)(c);return{c(){u.c(),r=oi()},l(f){u.l(f),r=oi()},m(f,d){u.m(f,d),Ze(f,r,d)},p(f,d){u.p(f,d)},d(f){f&&J(r),u.d(f)}}}function pg(c){let r,a=c[15].label+"",l,u,f,d,n,g,v=`${c[4]}px`,E=Pi(c[15].values),S=[];for(let z=0;z<E.length;z+=1)S[z]=fg(ng(c,E,z));let T=Pi(c[15].values),k=[];for(let z=0;z<T.length;z+=1)k[z]=dg(rg(c,T,z));return{c(){r=$e("div"),l=Ut(a),u=mt(),f=$e("span");for(let z=0;z<S.length;z+=1)S[z].c();d=mt(),n=$e("div");for(let z=0;z<k.length;z+=1)k[z].c();g=mt(),this.h()},l(z){r=je(z,"DIV",{class:!0});var A=et(r);l=Vt(A,a),u=gt(A),f=je(A,"SPAN",{class:!0});var R=et(f);for(let F=0;F<S.length;F+=1)S[F].l(R);R.forEach(J),A.forEach(J),d=gt(z),n=je(z,"DIV",{class:!0});var D=et(n);for(let F=0;F<k.length;F+=1)k[F].l(D);g=gt(D),D.forEach(J),this.h()},h(){_e(f,"class","nowrap svelte-1qm8uu9"),_e(r,"class","label-group svelte-1qm8uu9"),_e(n,"class","bar-group svelte-1qm8uu9"),Ft(n,"height",v)},m(z,A){Ze(z,r,A),ze(r,l),ze(r,u),ze(r,f);for(let R=0;R<S.length;R+=1)S[R]&&S[R].m(f,null);Ze(z,d,A),Ze(z,n,A);for(let R=0;R<k.length;R+=1)k[R]&&k[R].m(n,null);ze(n,g)},p(z,A){if(A&128&&a!==(a=z[15].label+"")&&bi(l,a),A&135){E=Pi(z[15].values);let R;for(R=0;R<E.length;R+=1){const D=ng(z,E,R);S[R]?S[R].p(D,A):(S[R]=fg(D),S[R].c(),S[R].m(f,null))}for(;R<S.length;R+=1)S[R].d(1);S.length=E.length}if(A&417){T=Pi(z[15].values);let R;for(R=0;R<T.length;R+=1){const D=rg(z,T,R);k[R]?k[R].p(D,A):(k[R]=dg(D),k[R].c(),k[R].m(n,g))}for(;R<k.length;R+=1)k[R].d(1);k.length=T.length}A&16&&v!==(v=`${z[4]}px`)&&Ft(n,"height",v)},d(z){z&&(J(r),J(d),J(n)),Pr(S,z),Pr(k,z)}}}function mg(c){let r,a;return{c(){r=$e("small"),a=Ut(c[3]),this.h()},l(l){r=je(l,"SMALL",{class:!0});var u=et(r);a=Vt(u,c[3]),u.forEach(J),this.h()},h(){_e(r,"class","svelte-1qm8uu9")},m(l,u){Ze(l,r,u),ze(r,a)},p(l,u){u&8&&bi(a,l[3])},d(l){l&&J(r)}}}function m2(c){let r,a,l="<tr><th>Category</th><th>Proportion of selected group</th><th>Proportion of whole population</th></tr>",u,f,d,n,g,v,E,S=Pi(c[7]),T=[];for(let D=0;D<S.length;D+=1)T[D]=cg(ag(c,S,D));let k=c[6]&&c[9][1]&&ug(c),z=Pi(c[7]),A=[];for(let D=0;D<z.length;D+=1)A[D]=pg(ig(c,z,D));let R=c[3]&&mg(c);return{c(){r=$e("table"),a=$e("thead"),a.innerHTML=l,u=mt(),f=$e("tbody");for(let D=0;D<T.length;D+=1)T[D].c();d=mt(),n=$e("div"),k&&k.c(),g=mt();for(let D=0;D<A.length;D+=1)A[D].c();v=mt(),R&&R.c(),E=oi(),this.h()},l(D){r=je(D,"TABLE",{class:!0});var F=et(r);a=je(F,"THEAD",{"data-svelte-h":!0}),lr(a)!=="svelte-1rk8s78"&&(a.innerHTML=l),u=gt(F),f=je(F,"TBODY",{});var q=et(f);for(let ie=0;ie<T.length;ie+=1)T[ie].l(q);q.forEach(J),F.forEach(J),d=gt(D),n=je(D,"DIV",{"aria-hidden":!0});var ee=et(n);k&&k.l(ee),g=gt(ee);for(let ie=0;ie<A.length;ie+=1)A[ie].l(ee);ee.forEach(J),v=gt(D),R&&R.l(D),E=oi(),this.h()},h(){_e(r,"class","visuallyhidden"),_e(n,"aria-hidden","true")},m(D,F){Ze(D,r,F),ze(r,a),ze(r,u),ze(r,f);for(let q=0;q<T.length;q+=1)T[q]&&T[q].m(f,null);Ze(D,d,F),Ze(D,n,F),k&&k.m(n,null),ze(n,g);for(let q=0;q<A.length;q+=1)A[q]&&A[q].m(n,null);Ze(D,v,F),R&&R.m(D,F),Ze(D,E,F)},p(D,[F]){if(F&135){S=Pi(D[7]);let q;for(q=0;q<S.length;q+=1){const ee=ag(D,S,q);T[q]?T[q].p(ee,F):(T[q]=cg(ee),T[q].c(),T[q].m(f,null))}for(;q<T.length;q+=1)T[q].d(1);T.length=S.length}if(D[6]&&D[9][1]?k?k.p(D,F):(k=ug(D),k.c(),k.m(n,g)):k&&(k.d(1),k=null),F&439){z=Pi(D[7]);let q;for(q=0;q<z.length;q+=1){const ee=ig(D,z,q);A[q]?A[q].p(ee,F):(A[q]=pg(ee),A[q].c(),A[q].m(n,null))}for(;q<A.length;q+=1)A[q].d(1);A.length=z.length}D[3]?R?R.p(D,F):(R=mg(D),R.c(),R.m(E.parentNode,E)):R&&(R.d(1),R=null)},i:Ci,o:Ci,d(D){D&&(J(r),J(d),J(n),J(v),J(E)),Pr(T,D),k&&k.d(),Pr(A,D),R&&R.d(D)}}}function g2(c,r,a){let l,u,f,d,{data:n}=r,{xKey:g="value"}=r,{yKey:v="category"}=r,{zKey:E="areanm"}=r,{formatTick:S=F=>F.toFixed(1)}=r,{suffix:T="%"}=r,{base:k=null}=r,{barHeight:z=25}=r,{markerWidth:A=3}=r,{showLegend:R=!0}=r;function D(F,q){let ee={},ie=[];for(const se of F)ee[se[q]]||(ee[se[q]]={label:se[q],values:[]},ie.push(se[q])),ee[se[q]].values.push(se);let ne=[];return ie.forEach(se=>{ne.push(ee[se])}),ne}return c.$$set=F=>{"data"in F&&a(10,n=F.data),"xKey"in F&&a(0,g=F.xKey),"yKey"in F&&a(11,v=F.yKey),"zKey"in F&&a(12,E=F.zKey),"formatTick"in F&&a(1,S=F.formatTick),"suffix"in F&&a(2,T=F.suffix),"base"in F&&a(3,k=F.base),"barHeight"in F&&a(4,z=F.barHeight),"markerWidth"in F&&a(5,A=F.markerWidth),"showLegend"in F&&a(6,R=F.showLegend)},c.$$.update=()=>{c.$$.dirty&1025&&a(13,l=Math.max(...n.map(F=>F[g]))),c.$$.dirty&5120&&a(9,u=n.map(F=>F[E]).filter((F,q,ee)=>ee.indexOf(F)===q)),c.$$.dirty&8192&&a(8,f=F=>F/l*100),c.$$.dirty&3072&&a(7,d=D(n,v))},[g,S,T,k,z,A,R,d,f,u,n,v,E,l]}class _2 extends $i{constructor(r){super(),ji(this,r,g2,m2,Fi,{data:10,xKey:0,yKey:11,zKey:12,formatTick:1,suffix:2,base:3,barHeight:4,markerWidth:5,showLegend:6})}}function y2(c){let r,a,l;return{c(){r=da("svg"),a=da("path"),this.h()},l(u){r=pa(u,"svg",{class:!0,viewBox:!0,"fill-rule":!0,"clip-rule":!0,"aria-hidden":!0,focusable:!0,style:!0});var f=et(r);a=pa(f,"path",{d:!0}),et(a).forEach(J),f.forEach(J),this.h()},h(){_e(a,"d",l=c[4][c[0]]),_e(r,"class","ico svelte-175xtay"),_e(r,"viewBox","0 0 24 24"),_e(r,"fill-rule","evenodd"),_e(r,"clip-rule","evenodd"),_e(r,"aria-hidden","true"),_e(r,"focusable","false"),_e(r,"style",c[3]),Ht(r,"margin",c[2]),Ht(r,"noclick",!c[1])},m(u,f){Ze(u,r,f),ze(r,a)},p(u,[f]){f&1&&l!==(l=u[4][u[0]])&&_e(a,"d",l),f&8&&_e(r,"style",u[3]),f&4&&Ht(r,"margin",u[2]),f&2&&Ht(r,"noclick",!u[1])},i:Ci,o:Ci,d(u){u&&J(r)}}}function v2(c,r,a){let l,{type:u="compass"}=r,{rotation:f=0}=r,{position:d="inline"}=r,{clickable:n=!1}=r,{margin:g=!1}=r;const v={compass:"M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10zm-10 1H8v-2h4V8l4 4-4 4v-3z",info:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z",chart:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 17c-.55 0-1-.45-1-1v-5c0-.55.45-1 1-1s1 .45 1 1v5c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v8c0 .55-.45 1-1 1zm4 0c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1z",share:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",chevron:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",full:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z",full_exit:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",shuffle:"M10.59 9.17 5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z",replay:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z",save:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z",tick:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z",cross:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z",arrow:"M5,13h11.2l-2.9,2.9c-0.4,0.4-0.4,1,0,1.4s1,0.4,1.4,0l4.6-4.6c0.4-0.4,0.4-1,0-1.4l-4.6-4.6c-0.4-0.4-1-0.4-1.4,0c0,0,0,0,0,0c-0.4,0.4-0.4,1,0,1.4l2.9,2.9H5c-0.6,0-1,0.4-1,1S4.4,13,5,13z",plus:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z",minus:"M18 13H6c-.55 0-1-.45-1-1s.45-1 1-1h12c.55 0 1 .45 1 1s-.45 1-1 1z",subdir:"m19 15-6 6-1.42-1.42L15.17 16H4V4h2v10h9.17l-3.59-3.58L13 9l6 6z",touch:"M9 11.24V7.5C9 6.12 10.12 5 11.5 5S14 6.12 14 7.5v3.74c1.21-.81 2-2.18 2-3.74C16 5.01 13.99 3 11.5 3S7 5.01 7 7.5c0 1.56.79 2.93 2 3.74zm9.84 4.63-4.54-2.26c-.17-.07-.35-.11-.54-.11H13v-6c0-.83-.67-1.5-1.5-1.5S10 6.67 10 7.5v10.74c-3.6-.76-3.54-.75-3.67-.75-.31 0-.59.13-.79.33l-.79.8 4.94 4.94c.27.27.65.44 1.06.44h6.79c.75 0 1.33-.55 1.44-1.28l.75-5.27c.01-.07.02-.14.02-.2 0-.62-.38-1.16-.91-1.38z",launch:"M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.11 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1zM14 4c0 .55.45 1 1 1h2.59l-9.13 9.13c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V3h-6c-.55 0-1 .45-1 1z",close:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",error:"M 12 2 C 6.48 2 2 6.48 2 12 s 4.48 10 10 10 s 10 -4.48 10 -10 S 17.52 2 12 2 z m 1 15 h -2 v -2 h 2 v 2 z m 0 -4 h -2 V 7 h 2 v 6 z"};return c.$$set=E=>{"type"in E&&a(0,u=E.type),"rotation"in E&&a(5,f=E.rotation),"position"in E&&a(6,d=E.position),"clickable"in E&&a(1,n=E.clickable),"margin"in E&&a(2,g=E.margin)},c.$$.update=()=>{c.$$.dirty&96&&a(3,l=`transform: translate(0, 15%) scale(1.5) rotate(${-f}deg);${["left","right"].includes(d)?` position: absolute; ${d}: 10px;`:""}`)},[u,n,g,l,v,f,d]}class th extends $i{constructor(r){super(),ji(this,r,v2,y2,Fi,{type:0,rotation:5,position:6,clickable:1,margin:2})}}function gg(c,r,a){const l=c.slice();return l[10]=r[a],l[12]=a,l}function _g(c){let r,a,l,u,f=Ka(Vu(c[10],c[3]))+"",d;return{c(){r=$e("br"),a=mt(),l=$e("div"),u=Ut("Selected: "),d=Ut(f),this.h()},l(n){r=je(n,"BR",{}),a=gt(n),l=je(n,"DIV",{class:!0});var g=et(l);u=Vt(g,"Selected: "),d=Vt(g,f),g.forEach(J),this.h()},h(){_e(l,"class","selected-item-label svelte-1giixhw")},m(n,g){Ze(n,r,g),Ze(n,a,g),Ze(n,l,g),ze(l,u),ze(l,d)},p(n,g){g&10&&f!==(f=Ka(Vu(n[10],n[3]))+"")&&bi(d,f)},d(n){n&&(J(r),J(a),J(l))}}}function yg(c){let r,a=c[5](c[10])+"",l,u,f,d,n,g=Vu(c[10],c[3]),v,E,S;d=new th({props:{type:"chevron"}});let T=g&&_g(c);function k(){return c[9](c[10])}return{c(){r=$e("button"),l=Ut(a),u=mt(),f=$e("span"),ii(d.$$.fragment),n=mt(),T&&T.c(),this.h()},l(z){r=je(z,"BUTTON",{type:!0,class:!0});var A=et(r);l=Vt(A,a),u=gt(A),f=je(A,"SPAN",{class:!0});var R=et(f);si(d.$$.fragment,R),R.forEach(J),n=gt(A),T&&T.l(A),A.forEach(J),this.h()},h(){_e(f,"class","right-chevron svelte-1giixhw"),_e(r,"type","button"),_e(r,"class","svelte-1giixhw"),Ht(r,"plain-button",!0),Ht(r,"selected",c[10]===c[0])},m(z,A){Ze(z,r,A),ze(r,l),ze(r,u),ze(r,f),ri(d,f,null),ze(r,n),T&&T.m(r,null),v=!0,E||(S=$s(r,"click",k),E=!0)},p(z,A){c=z,(!v||A&34)&&a!==(a=c[5](c[10])+"")&&bi(l,a),A&10&&(g=Vu(c[10],c[3])),g?T?T.p(c,A):(T=_g(c),T.c(),T.m(r,null)):T&&(T.d(1),T=null),(!v||A&3)&&Ht(r,"selected",c[10]===c[0])},i(z){v||(Ye(d.$$.fragment,z),v=!0)},o(z){st(d.$$.fragment,z),v=!1},d(z){z&&J(r),ni(d),T&&T.d(),E=!1,S()}}}function b2(c){let r,a,l,u,f,d,n=Pi(c[1]),g=[];for(let T=0;T<n.length;T+=1)g[T]=yg(gg(c,n,T));const v=T=>st(g[T],1,1,()=>{g[T]=null}),E=c[8].default,S=Tr(E,c,c[7],null);return{c(){r=$e("div"),a=$e("h5"),l=Ut(c[4]),u=mt();for(let T=0;T<g.length;T+=1)g[T].c();f=mt(),S&&S.c(),this.h()},l(T){r=je(T,"DIV",{class:!0,role:!0,"aria-label":!0});var k=et(r);a=je(k,"H5",{class:!0});var z=et(a);l=Vt(z,c[4]),z.forEach(J),u=gt(k);for(let A=0;A<g.length;A+=1)g[A].l(k);f=gt(k),S&&S.l(k),k.forEach(J),this.h()},h(){_e(a,"class","column-title svelte-1giixhw"),_e(r,"class","column svelte-1giixhw"),_e(r,"role","form"),_e(r,"aria-label","Press up or down to choose a variable. Enter to select."),Ht(r,"hidden-first-column",c[6])},m(T,k){Ze(T,r,k),ze(r,a),ze(a,l),ze(r,u);for(let z=0;z<g.length;z+=1)g[z]&&g[z].m(r,null);ze(r,f),S&&S.m(r,null),d=!0},p(T,[k]){if((!d||k&16)&&bi(l,T[4]),k&47){n=Pi(T[1]);let z;for(z=0;z<n.length;z+=1){const A=gg(T,n,z);g[z]?(g[z].p(A,k),Ye(g[z],1)):(g[z]=yg(A),g[z].c(),Ye(g[z],1),g[z].m(r,f))}for(Ni(),z=n.length;z<g.length;z+=1)v(z);Ui()}S&&S.p&&(!d||k&128)&&Cr(S,E,T,T[7],d?Ar(E,T[7],k,null):Ir(T[7]),null),(!d||k&64)&&Ht(r,"hidden-first-column",T[6])},i(T){if(!d){for(let k=0;k<n.length;k+=1)Ye(g[k]);Ye(S,T),d=!0}},o(T){g=g.filter(Boolean);for(let k=0;k<g.length;k+=1)st(g[k]);st(S,T),d=!1},d(T){T&&J(r),Pr(g,T),S&&S.d(T)}}}function w2(c){console.log("clicked",c)}function Vu(c,r){for(let a of r)if(a.topic===c.label)return a.label;return!1}function x2(c,r,a){let{$$slots:l={},$$scope:u}=r,{options:f=[]}=r,{clickCallback:d=w2}=r,{globalSelectedCategories:n=[]}=r,{columnTitle:g="column title"}=r,{labeller:v=k=>k.label}=r,{selected:E=null}=r,{hiddenOnMobile:S=!1}=r;const T=k=>{a(0,E=k),d(k)};return c.$$set=k=>{"options"in k&&a(1,f=k.options),"clickCallback"in k&&a(2,d=k.clickCallback),"globalSelectedCategories"in k&&a(3,n=k.globalSelectedCategories),"columnTitle"in k&&a(4,g=k.columnTitle),"labeller"in k&&a(5,v=k.labeller),"selected"in k&&a(0,E=k.selected),"hiddenOnMobile"in k&&a(6,S=k.hiddenOnMobile),"$$scope"in k&&a(7,u=k.$$scope)},[E,f,d,n,g,v,S,u,l,T]}class E2 extends $i{constructor(r){super(),ji(this,r,x2,b2,Fi,{options:1,clickCallback:2,globalSelectedCategories:3,columnTitle:4,labeller:5,selected:0,hiddenOnMobile:6})}}function vg(c,r,a){const l=c.slice();return l[14]=r[a],l[16]=a,l}function bg(c){let r,a,l,u="Back",f,d,n,g,v;return{c(){r=$e("ol"),a=$e("li"),l=$e("button"),l.textContent=u,f=mt(),d=da("svg"),n=da("path"),this.h()},l(E){r=je(E,"OL",{class:!0});var S=et(r);a=je(S,"LI",{class:!0,id:!0});var T=et(a);l=je(T,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),lr(l)!=="svelte-1bhde6k"&&(l.textContent=u),f=gt(T),d=pa(T,"svg",{class:!0,viewBox:!0,xmlns:!0,focusable:!0,fill:!0});var k=et(d);n=pa(k,"path",{d:!0,transform:!0}),et(n).forEach(J),k.forEach(J),T.forEach(J),S.forEach(J),this.h()},h(){_e(l,"type","button"),_e(l,"class","btn-link ons-breadcrumb__link"),_e(n,"d","M5.74,14.28l-.57-.56a.5.5,0,0,1,0-.71h0l5-5-5-5a.5.5,0,0,1,0-.71h0l.57-.56a.5.5,0,0,1,.71,0h0l5.93,5.93a.5.5,0,0,1,0,.7L6.45,14.28a.5.5,0,0,1-.71,0Z"),_e(n,"transform","translate(-5.02 -1.59)"),_e(d,"class","ons-svg-icon svelte-w4p0hu"),_e(d,"viewBox","0 0 8 13"),_e(d,"xmlns","http://www.w3.org/2000/svg"),_e(d,"focusable","false"),_e(d,"fill","currentColor"),_e(a,"class","ons-breadcrumb__item"),_e(a,"id","breadcrumb-1"),_e(r,"class","ons-breadcrumb__items ons-u-fs-s")},m(E,S){Ze(E,r,S),ze(r,a),ze(a,l),ze(a,f),ze(a,d),ze(d,n),g||(v=$s(l,"click",function(){f1(c[3])&&c[3].apply(this,arguments)}),g=!0)},p(E,S){c=E},d(E){E&&J(r),g=!1,v()}}}function wg(c){let r,a;return r=new Bf({props:{variant:"secondary",small:!0,disabled:c[7],$$slots:{default:[S2]},$$scope:{ctx:c}}}),r.$on("click",c[11]),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&128&&(f.disabled=l[7]),u&8192&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function S2(c){let r;return{c(){r=Ut("Remove selection")},l(a){r=Vt(a,"Remove selection")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function k2(c){let r,a=c[0],l,u,f=Eg(c);const d=c[10].default,n=Tr(d,c,c[13],null);return{c(){r=$e("div"),f.c(),l=mt(),n&&n.c(),this.h()},l(g){r=je(g,"DIV",{class:!0,role:!0,"aria-label":!0});var v=et(r);f.l(v),v.forEach(J),l=gt(g),n&&n.l(g),this.h()},h(){_e(r,"class","ons-radios__items"),_e(r,"role","form"),_e(r,"aria-label","Press up or down to choose a category. Enter to select.")},m(g,v){Ze(g,r,v),f.m(r,null),Ze(g,l,v),n&&n.m(g,v),u=!0},p(g,v){v&1&&Fi(a,a=g[0])?(f.d(1),f=Eg(g),f.c(),f.m(r,null)):f.p(g,v),n&&n.p&&(!u||v&8192)&&Cr(n,d,g,g[13],u?Ar(d,g[13],v,null):Ir(g[13]),null)},i(g){u||(Ye(n,g),u=!0)},o(g){st(n,g),u=!1},d(g){g&&(J(r),J(l)),f.d(g),n&&n.d(g)}}}function T2(c){let r;return{c(){r=Ut(`At most three characteristics can be selected. To add another
    characteristic, please remove one of the three selected ones.`)},l(a){r=Vt(a,`At most three characteristics can be selected. To add another
    characteristic, please remove one of the three selected ones.`)},m(a,l){Ze(a,r,l)},p:Ci,i:Ci,o:Ci,d(a){a&&J(r)}}}function xg(c){let r,a,l,u,f,d=c[6](c[14])+"",n,g,v,E;function S(){return c[12](c[14])}return{c(){r=$e("button"),a=$e("span"),l=$e("span"),u=mt(),f=$e("span"),n=Ut(d),g=mt(),this.h()},l(T){r=je(T,"BUTTON",{class:!0});var k=et(r);a=je(k,"SPAN",{class:!0});var z=et(a);l=je(z,"SPAN",{class:!0}),et(l).forEach(J),u=gt(z),f=je(z,"SPAN",{class:!0});var A=et(f);n=Vt(A,d),A.forEach(J),z.forEach(J),g=gt(k),k.forEach(J),this.h()},h(){_e(l,"class","ons-radio__input ons-js-radio svelte-18p7qcp"),_e(f,"class","ons-radio__label svelte-18p7qcp"),_e(a,"class","ons-radio ons-radio--no-border"),_e(r,"class","ons-radios__item ons-radios__item--no-border svelte-18p7qcp"),r.disabled=c[7],Ht(r,"ons-radio__checked",kg(c[14],c[4]))},m(T,k){Ze(T,r,k),ze(r,a),ze(a,l),ze(a,u),ze(a,f),ze(f,n),ze(r,g),v||(E=[P_(I2.call(null,r,c[16]===0)),$s(r,"click",S)],v=!0)},p(T,k){c=T,k&65&&d!==(d=c[6](c[14])+"")&&bi(n,d),k&128&&(r.disabled=c[7]),k&17&&Ht(r,"ons-radio__checked",kg(c[14],c[4]))},d(T){T&&J(r),v=!1,d1(E)}}}function Eg(c){let r,a=Pi(c[0]),l=[];for(let u=0;u<a.length;u+=1)l[u]=xg(vg(c,a,u));return{c(){for(let u=0;u<l.length;u+=1)l[u].c();r=oi()},l(u){for(let f=0;f<l.length;f+=1)l[f].l(u);r=oi()},m(u,f){for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(u,f);Ze(u,r,f)},p(u,f){if(f&211){a=Pi(u[0]);let d;for(d=0;d<a.length;d+=1){const n=vg(u,a,d);l[d]?l[d].p(n,f):(l[d]=xg(n),l[d].c(),l[d].m(r.parentNode,r))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},d(u){u&&J(r),Pr(l,u)}}}function C2(c){let r,a,l,u,f,d,n,g=vf(c[9],c[4]),v,E,S,T,k,z=c[3]!=null&&bg(c),A=g&&wg(c);const R=[T2,k2],D=[];function F(q,ee){return ee&528&&(E=null),E==null&&(E=q[4].length===3&&!vf(q[9],q[4])),E?0:1}return S=F(c,-1),T=D[S]=R[S](c),{c(){r=$e("div"),a=$e("div"),z&&z.c(),l=mt(),u=$e("div"),f=$e("h5"),d=Ut(c[5]),n=mt(),A&&A.c(),v=mt(),T.c(),this.h()},l(q){r=je(q,"DIV",{class:!0});var ee=et(r);a=je(ee,"DIV",{class:!0});var ie=et(a);z&&z.l(ie),ie.forEach(J),l=gt(ee),u=je(ee,"DIV",{class:!0});var ne=et(u);f=je(ne,"H5",{class:!0});var se=et(f);d=Vt(se,c[5]),se.forEach(J),n=gt(ne),A&&A.l(ne),ne.forEach(J),v=gt(ee),T.l(ee),ee.forEach(J),this.h()},h(){_e(a,"class","svelte-18p7qcp"),Ht(a,"hidden-on-desktop",!0),_e(f,"class","column-title svelte-18p7qcp"),_e(u,"class","title-container svelte-18p7qcp"),_e(r,"class","column svelte-18p7qcp"),Ht(r,"hidden-first-column",c[8])},m(q,ee){Ze(q,r,ee),ze(r,a),z&&z.m(a,null),ze(r,l),ze(r,u),ze(u,f),ze(f,d),ze(u,n),A&&A.m(u,null),ze(r,v),D[S].m(r,null),k=!0},p(q,[ee]){q[3]!=null?z?z.p(q,ee):(z=bg(q),z.c(),z.m(a,null)):z&&(z.d(1),z=null),(!k||ee&32)&&bi(d,q[5]),ee&528&&(g=vf(q[9],q[4])),g?A?(A.p(q,ee),ee&528&&Ye(A,1)):(A=wg(q),A.c(),Ye(A,1),A.m(u,null)):A&&(Ni(),st(A,1,1,()=>{A=null}),Ui());let ie=S;S=F(q,ee),S===ie?D[S].p(q,ee):(Ni(),st(D[ie],1,1,()=>{D[ie]=null}),Ui(),T=D[S],T?T.p(q,ee):(T=D[S]=R[S](q),T.c()),Ye(T,1),T.m(r,null)),(!k||ee&256)&&Ht(r,"hidden-first-column",q[8])},i(q){k||(Ye(A),Ye(T),k=!0)},o(q){st(A),st(T),k=!1},d(q){q&&J(r),z&&z.d(),A&&A.d(),D[S].d()}}}function Sg(c){console.log("clicked",c)}function vf(c,r){for(let a of r)if(a.topic===c.label)return a.label;return!1}function kg(c,r){for(const a of r)if(a.var===c.var&&a.code===c.code)return!0;return!1}function I2(c,r){r&&c.focus()}function A2(c,r,a){let{$$slots:l={},$$scope:u}=r,{options:f=[]}=r,{clickCallback:d=Sg}=r,{removeCatCallback:n=Sg}=r,{backButtonCallback:g=null}=r,{globalSelectedCategories:v=[]}=r,{columnTitle:E="column title"}=r,{labeller:S=D=>D.label}=r,{disabled:T=!1}=r,{hiddenOnMobile:k=!1}=r,{currentVar:z=null}=r;const A=()=>n(z),R=D=>d(D);return c.$$set=D=>{"options"in D&&a(0,f=D.options),"clickCallback"in D&&a(1,d=D.clickCallback),"removeCatCallback"in D&&a(2,n=D.removeCatCallback),"backButtonCallback"in D&&a(3,g=D.backButtonCallback),"globalSelectedCategories"in D&&a(4,v=D.globalSelectedCategories),"columnTitle"in D&&a(5,E=D.columnTitle),"labeller"in D&&a(6,S=D.labeller),"disabled"in D&&a(7,T=D.disabled),"hiddenOnMobile"in D&&a(8,k=D.hiddenOnMobile),"currentVar"in D&&a(9,z=D.currentVar),"$$scope"in D&&a(13,u=D.$$scope)},[f,d,n,g,v,E,S,T,k,z,l,A,R,u]}class P2 extends $i{constructor(r){super(),ji(this,r,A2,C2,Fi,{options:0,clickCallback:1,removeCatCallback:2,backButtonCallback:3,globalSelectedCategories:4,columnTitle:5,labeller:6,disabled:7,hiddenOnMobile:8,currentVar:9})}}function Tg(c,r,a){const l=c.slice();return l[14]=r[a],l}function Cg(c){let r,a,l=Pi([c[0].vars[c[6][c[0].label]]]),u=[];for(let d=0;d<1;d+=1)u[d]=Pg(Tg(c,l,d));const f=d=>st(u[d],1,1,()=>{u[d]=null});return{c(){for(let d=0;d<1;d+=1)u[d].c();r=oi()},l(d){for(let n=0;n<1;n+=1)u[n].l(d);r=oi()},m(d,n){for(let g=0;g<1;g+=1)u[g]&&u[g].m(d,n);Ze(d,r,n),a=!0},p(d,n){if(n&1021){l=Pi([d[0].vars[d[6][d[0].label]]]);let g;for(g=0;g<1;g+=1){const v=Tg(d,l,g);u[g]?(u[g].p(v,n),Ye(u[g],1)):(u[g]=Pg(v),u[g].c(),Ye(u[g],1),u[g].m(r.parentNode,r))}for(Ni(),g=1;g<1;g+=1)f(g);Ui()}},i(d){if(!a){for(let n=0;n<1;n+=1)Ye(u[n]);a=!0}},o(d){u=u.filter(Boolean);for(let n=0;n<1;n+=1)st(u[n]);a=!1},d(d){d&&J(r),Pr(u,d)}}}function Ig(c){let r,a,l,u,f,d;return a=new th({props:{type:"chevron",rotation:90}}),{c(){r=$e("button"),ii(a.$$.fragment),l=Ut(" Show fewer"),this.h()},l(n){r=je(n,"BUTTON",{class:!0});var g=et(r);si(a.$$.fragment,g),l=Vt(g," Show fewer"),g.forEach(J),this.h()},h(){_e(r,"class","btn-link")},m(n,g){Ze(n,r,g),ri(a,r,null),ze(r,l),u=!0,f||(d=$s(r,"click",c[8]),f=!0)},p:Ci,i(n){u||(Ye(a.$$.fragment,n),u=!0)},o(n){st(a.$$.fragment,n),u=!1},d(n){n&&J(r),ni(a),f=!1,d()}}}function Ag(c){let r,a,l,u,f,d;return a=new th({props:{type:"chevron",rotation:-90}}),{c(){r=$e("button"),ii(a.$$.fragment),l=Ut(" Show more"),this.h()},l(n){r=je(n,"BUTTON",{class:!0});var g=et(r);si(a.$$.fragment,g),l=Vt(g," Show more"),g.forEach(J),this.h()},h(){_e(r,"class","btn-link")},m(n,g){Ze(n,r,g),ri(a,r,null),ze(r,l),u=!0,f||(d=$s(r,"click",c[7]),f=!0)},p:Ci,i(n){u||(Ye(a.$$.fragment,n),u=!0)},o(n){st(a.$$.fragment,n),u=!1},d(n){n&&J(r),ni(a),f=!1,d()}}}function z2(c){let r,a,l,u=c[6][c[0].label]>0&&Ig(c),f=c[6][c[0].label]<c[0].vars.length-1&&Ag(c);return{c(){u&&u.c(),r=mt(),f&&f.c(),a=mt()},l(d){u&&u.l(d),r=gt(d),f&&f.l(d),a=gt(d)},m(d,n){u&&u.m(d,n),Ze(d,r,n),f&&f.m(d,n),Ze(d,a,n),l=!0},p(d,n){d[6][d[0].label]>0?u?(u.p(d,n),n&65&&Ye(u,1)):(u=Ig(d),u.c(),Ye(u,1),u.m(r.parentNode,r)):u&&(Ni(),st(u,1,1,()=>{u=null}),Ui()),d[6][d[0].label]<d[0].vars.length-1?f?(f.p(d,n),n&65&&Ye(f,1)):(f=Ag(d),f.c(),Ye(f,1),f.m(a.parentNode,a)):f&&(Ni(),st(f,1,1,()=>{f=null}),Ui())},i(d){l||(Ye(u),Ye(f),l=!0)},o(d){st(u),st(f),l=!1},d(d){d&&(J(r),J(a)),u&&u.d(d),f&&f.d(d)}}}function Pg(c){let r,a;function l(...f){return c[11](c[14],...f)}function u(...f){return c[12](c[14],...f)}return r=new P2({props:{columnTitle:c[0].label,options:c[9](c[14]),clickCallback:l,removeCatCallback:u,backButtonCallback:c[13],globalSelectedCategories:c[4],currentVar:c[0],disabled:c[5],$$slots:{default:[z2]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(f){si(r.$$.fragment,f)},m(f,d){ri(r,f,d),a=!0},p(f,d){c=f;const n={};d&1&&(n.columnTitle=c[0].label),d&65&&(n.options=c[9](c[14])),d&69&&(n.clickCallback=l),d&73&&(n.removeCatCallback=u),d&1&&(n.backButtonCallback=c[13]),d&16&&(n.globalSelectedCategories=c[4]),d&1&&(n.currentVar=c[0]),d&32&&(n.disabled=c[5]),d&131137&&(n.$$scope={dirty:d,ctx:c}),r.$set(n)},i(f){a||(Ye(r.$$.fragment,f),a=!0)},o(f){st(r.$$.fragment,f),a=!1},d(f){ni(r,f)}}}function zg(c){let r,a,l=c[0]!=null&&Cg(c);return{c(){l&&l.c(),r=oi()},l(u){l&&l.l(u),r=oi()},m(u,f){l&&l.m(u,f),Ze(u,r,f),a=!0},p(u,f){u[0]!=null?l?(l.p(u,f),f&1&&Ye(l,1)):(l=Cg(u),l.c(),Ye(l,1),l.m(r.parentNode,r)):l&&(Ni(),st(l,1,1,()=>{l=null}),Ui())},i(u){a||(Ye(l),a=!0)},o(u){st(l),a=!1},d(u){u&&J(r),l&&l.d(u)}}}function M2(c){let r,a,l,u,f=c[0],d;function n(E){c[10](E)}let g={columnTitle:"Select a variable",clickCallback:R2,options:c[1],globalSelectedCategories:c[4],hiddenOnMobile:c[0]!=null};c[0]!==void 0&&(g.selected=c[0]),a=new E2({props:g}),yc.push(()=>Wu(a,"selected",n));let v=zg(c);return{c(){r=$e("div"),ii(a.$$.fragment),u=mt(),v.c(),this.h()},l(E){r=je(E,"DIV",{class:!0});var S=et(r);si(a.$$.fragment,S),u=gt(S),v.l(S),S.forEach(J),this.h()},h(){_e(r,"class","container svelte-10l6uhp")},m(E,S){Ze(E,r,S),ri(a,r,null),ze(r,u),v.m(r,null),d=!0},p(E,[S]){const T={};S&2&&(T.options=E[1]),S&16&&(T.globalSelectedCategories=E[4]),S&1&&(T.hiddenOnMobile=E[0]!=null),!l&&S&1&&(l=!0,T.selected=E[0],Gu(()=>l=!1)),a.$set(T),S&1&&Fi(f,f=E[0])?(Ni(),st(v,1,1,Ci),Ui(),v=zg(E),v.c(),Ye(v,1),v.m(r,null)):v.p(E,S)},i(E){d||(Ye(a.$$.fragment,E),Ye(v),d=!0)},o(E){st(a.$$.fragment,E),st(v),d=!1},d(E){E&&J(r),ni(a),v.d(E)}}}function D2(c,r){console.log(c,r)}function L2(c,r){console.log(c,r)}const R2=()=>{};function B2(c,r,a){let l,{options:u=[]}=r,{clickCallback:f=D2}=r,{removeCatCallback:d=L2}=r,{globalSelectedCategories:n=[]}=r,{disabled:g=!1}=r,{activeColumn:v=null}=r;function E(){a(6,++l[v.label],l)}function S(){a(6,--l[v.label],l)}function T(D){return D.key!=="religion_tb"?D.cats:D.cats.sort(ny)}function k(D){v=D,a(0,v)}const z=(D,F)=>f(D,F),A=(D,F)=>d(D,F),R=()=>a(0,v=null);return c.$$set=D=>{"options"in D&&a(1,u=D.options),"clickCallback"in D&&a(2,f=D.clickCallback),"removeCatCallback"in D&&a(3,d=D.removeCatCallback),"globalSelectedCategories"in D&&a(4,n=D.globalSelectedCategories),"disabled"in D&&a(5,g=D.disabled),"activeColumn"in D&&a(0,v=D.activeColumn)},c.$$.update=()=>{c.$$.dirty&2&&a(6,l=function(){let D={};return u.forEach(F=>D[F.label]=0),D}())},[v,u,f,d,n,g,l,E,S,T,k,z,A,R]}class O2 extends $i{constructor(r){super(),ji(this,r,B2,M2,Fi,{options:1,clickCallback:2,removeCatCallback:3,globalSelectedCategories:4,disabled:5,activeColumn:0})}}var sy={exports:{}};(function(c,r){(function(a,l){c.exports=l()})($o,function(){var a,l,u;function f(n,g){if(!a)a=g;else if(!l)l=g;else{var v="var sharedChunk = {}; ("+a+")(sharedChunk); ("+l+")(sharedChunk);",E={};a(E),u=g(E),typeof window<"u"&&(u.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}f(["exports"],function(n){function g(i,e,s,h){return new(s||(s=Promise))(function(m,b){function x(B){try{M(h.next(B))}catch(U){b(U)}}function C(B){try{M(h.throw(B))}catch(U){b(U)}}function M(B){var U;B.done?m(B.value):(U=B.value,U instanceof s?U:new s(function(j){j(U)})).then(x,C)}M((h=h.apply(i,e||[])).next())})}function v(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var E=S;function S(i,e){this.x=i,this.y=e}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,s=i.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),s=Math.sin(i),h=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=h,this},_rotateAround:function(i,e){var s=Math.cos(i),h=Math.sin(i),m=e.y+h*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-h*(this.y-e.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(i){return i instanceof S?i:Array.isArray(i)?new S(i[0],i[1]):i};var T=v(E),k=z;function z(i,e,s,h){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(h-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=s,this.p2y=h}z.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,h=0;h<8;h++){var m=this.sampleCurveX(s)-i;if(Math.abs(m)<e)return s;var b=this.sampleCurveDerivativeX(s);if(Math.abs(b)<1e-6)break;s-=m/b}var x=0,C=1;for(s=i,h=0;h<20&&(m=this.sampleCurveX(s),!(Math.abs(m-i)<e));h++)i>m?x=s:C=s,s=.5*(C-x)+x;return s},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var A=v(k);let R,D;function F(){return R==null&&(R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),R}function q(){if(D==null&&(D=!1,F())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let h=0;h<5*5;h++){const m=4*h;e.fillStyle=`rgb(${m},${m+1},${m+2})`,e.fillRect(h%5,Math.floor(h/5),1,1)}const s=e.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&s[h]!==h){D=!0;break}}}return D||!1}function ee(i,e,s,h){const m=new A(i,e,s,h);return function(b){return m.solve(b)}}const ie=ee(.25,.1,.25,1);function ne(i,e,s){return Math.min(s,Math.max(e,i))}function se(i,e,s){const h=s-e,m=((i-e)%h+h)%h+e;return m===e?s:m}function ue(i,...e){for(const s of e)for(const h in s)i[h]=s[h];return i}let Ce=1;function ye(i,e,s){const h={};for(const m in i)h[m]=e.call(s||this,i[m],m,i);return h}function Xe(i,e,s){const h={};for(const m in i)e.call(s||this,i[m],m,i)&&(h[m]=i[m]);return h}function ae(i){return Array.isArray(i)?i.map(ae):typeof i=="object"&&i?ye(i,ae):i}const Le={};function Z(i){Le[i]||(typeof console<"u"&&console.warn(i),Le[i]=!0)}function tt(i,e,s){return(s.y-i.y)*(e.x-i.x)>(e.y-i.y)*(s.x-i.x)}function $t(i){let e=0;for(let s,h,m=0,b=i.length,x=b-1;m<b;x=m++)s=i[m],h=i[x],e+=(h.x-s.x)*(s.y+h.y);return e}function ft(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Jt=null;function ut(i){if(Jt==null){const e=i.navigator?i.navigator.userAgent:null;Jt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Jt}function at(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ee(i,e,s,h,m){return g(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(i,{timestamp:0});try{const x=b==null?void 0:b.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const C=x.startsWith("BGR"),M=new Uint8ClampedArray(h*m*4);if(yield b.copyTo(M,function(B,U,j,H,te){const re=4*Math.max(-U,0),pe=(Math.max(0,j)-j)*H*4+re,Te=4*H,Me=Math.max(0,U),He=Math.max(0,j);return{rect:{x:Me,y:He,width:Math.min(B.width,U+H)-Me,height:Math.min(B.height,j+te)-He},layout:[{offset:pe,stride:Te}]}}(i,e,s,h,m)),C)for(let B=0;B<M.length;B+=4){const U=M[B];M[B]=M[B+2],M[B+2]=U}return M}finally{b.close()}})}let Re,Q,he,it;const Ct={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,s.drawImage(i,0,0,i.width,i.height),s},resolveURL:i=>(he||(he=document.createElement("a")),he.href=i,he.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(it==null&&(it=matchMedia("(prefers-reduced-motion: reduce)")),it.matches)}},bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class It extends Error{constructor(e,s,h,m){super(`AJAXError: ${s} (${e}): ${h}`),this.status=e,this.statusText=s,this.url=h,this.body=m}}const Bt=ft()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Fe=i=>bt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function Se(i,e){const s=new AbortController,h=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:Bt(),signal:s.signal});let m=!1,b=!1;return i.type==="json"&&h.headers.set("Accept","application/json"),b||fetch(h).then(x=>x.ok?(C=>{(i.type==="arrayBuffer"||i.type==="image"?C.arrayBuffer():i.type==="json"?C.json():C.text()).then(M=>{b||(m=!0,e(null,M,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(M=>{b||e(new Error(M.message))})})(x):x.blob().then(C=>e(new It(x.status,x.statusText,i.url,C)))).catch(x=>{x.code!==20&&e(new Error(x.message))}),{cancel:()=>{b=!0,m||s.abort()}}}const ct=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!ft())return(Fe(i.url)||Se)(i,e)}if(!(/^file:/.test(s=i.url)||/^file:/.test(Bt())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Se(i,e);if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var s;return function(h,m){const b=new XMLHttpRequest;b.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(b.responseType="arraybuffer");for(const x in h.headers)b.setRequestHeader(x,h.headers[x]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=()=>{m(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let x=b.response;if(h.type==="json")try{x=JSON.parse(b.response)}catch(C){return m(C)}m(null,x,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else{const x=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});m(new It(b.status,b.statusText,h.url,x))}},b.send(h.body),{cancel:()=>b.abort()}}(i,e)},N=function(i,e){return ct(ue(i,{type:"arrayBuffer"}),e)};function Je(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),s=window.location;return e.protocol===s.protocol&&e.host===s.host}function We(i,e,s){s[i]&&s[i].indexOf(e)!==-1||(s[i]=s[i]||[],s[i].push(e))}function we(i,e,s){if(s&&s[i]){const h=s[i].indexOf(e);h!==-1&&s[i].splice(h,1)}}class me{constructor(e,s={}){ue(this,s),this.type=e}}class Ne extends me{constructor(e,s={}){super("error",ue({error:e},s))}}class ht{on(e,s){return this._listeners=this._listeners||{},We(e,s,this._listeners),this}off(e,s){return we(e,s,this._listeners),we(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},We(e,s,this._oneTimeListeners),this):new Promise(h=>this.once(e,h))}fire(e,s){typeof e=="string"&&(e=new me(e,s||{}));const h=e.type;if(this.listens(h)){e.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const C of m)C.call(this,e);const b=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const C of b)we(h,C,this._oneTimeListeners),C.call(this,e);const x=this._eventedParent;x&&(ue(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof Ne&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Qe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xt(i,e){const s={};for(const h in i)h!=="ref"&&(s[h]=i[h]);return Qe.forEach(h=>{h in e&&(s[h]=e[h])}),s}function Tt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let s=0;s<i.length;s++)if(!Tt(i[s],e[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const s in i)if(!Tt(i[s],e[s]))return!1;return!0}return i===e}const dt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Yt(i,e,s){s.push({command:dt.addSource,args:[i,e[i]]})}function ki(i,e,s){e.push({command:dt.removeSource,args:[i]}),s[i]=!0}function Si(i,e,s,h){ki(i,s,h),Yt(i,e,s)}function Zi(i,e,s){let h;for(h in i[s])if(Object.prototype.hasOwnProperty.call(i[s],h)&&h!=="data"&&!Tt(i[s][h],e[s][h]))return!1;for(h in e[s])if(Object.prototype.hasOwnProperty.call(e[s],h)&&h!=="data"&&!Tt(i[s][h],e[s][h]))return!1;return!0}function nr(i,e,s,h,m,b){let x;for(x in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,x)&&(Tt(i[x],e[x])||s.push({command:b,args:[h,x,e[x],m]}));for(x in e)Object.prototype.hasOwnProperty.call(e,x)&&!Object.prototype.hasOwnProperty.call(i,x)&&(Tt(i[x],e[x])||s.push({command:b,args:[h,x,e[x],m]}))}function fr(i){return i.id}function qr(i,e){return i[e.id]=e,i}class vt{constructor(e,s,h,m){this.message=(e?`${e}: `:"")+h,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)}}function Ki(i,...e){for(const s of e)for(const h in s)i[h]=s[h];return i}class br extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class wr{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[h,m]of s)this.bindings[h]=m}concat(e){return new wr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const sr={kind:"null"},zt={kind:"number"},yi={kind:"string"},vi={kind:"boolean"},xr={kind:"color"},Ur={kind:"object"},pi={kind:"value"},on={kind:"collator"},ve={kind:"formatted"},G={kind:"padding"},K={kind:"resolvedImage"},ce={kind:"variableAnchorOffsetCollection"};function be(i,e){return{kind:"array",itemType:i,N:e}}function Pe(i){if(i.kind==="array"){const e=Pe(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const qe=[sr,zt,yi,vi,xr,ve,Ur,be(pi),G,K,ce];function Oe(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Oe(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const s of qe)if(!Oe(s,e))return null}}return`Expected ${Pe(i)} but found ${Pe(e)} instead.`}function De(i,e){return e.some(s=>s.kind===i.kind)}function W(i,e){return e.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}function X(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const oe=.96422,Ie=.82521,Ue=4/29,Et=6/29,yt=3*Et*Et,At=Et*Et*Et,Gt=Math.PI/180,di=180/Math.PI;function ei(i){return(i%=360)<0&&(i+=360),i}function ai([i,e,s,h]){let m,b;const x=li((.2225045*(i=ui(i))+.7168786*(e=ui(e))+.0606169*(s=ui(s)))/1);i===e&&e===s?m=b=x:(m=li((.4360747*i+.3850649*e+.1430804*s)/oe),b=li((.0139322*i+.0971045*e+.7141733*s)/Ie));const C=116*x-16;return[C<0?0:C,500*(m-x),200*(x-b),h]}function ui(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function li(i){return i>At?Math.pow(i,1/3):i/yt+Ue}function gi([i,e,s,h]){let m=(i+16)/116,b=isNaN(e)?m:m+e/500,x=isNaN(s)?m:m-s/200;return m=1*xi(m),b=oe*xi(b),x=Ie*xi(x),[Ii(3.1338561*b-1.6168667*m-.4906146*x),Ii(-.9787684*b+1.9161415*m+.033454*x),Ii(.0719453*b-.2289914*m+1.4052427*x),h]}function Ii(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function xi(i){return i>Et?i*i*i:yt*(i-Ue)}function Vr(i){return parseInt(i.padEnd(2,i),16)/255}function gn(i,e){return dr(e?i/100:i,0,1)}function dr(i,e,s){return Math.min(Math.max(e,i),s)}function es(i){return!i.some(Number.isNaN)}const ts={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ti{constructor(e,s,h,m=1,b=!0){this.r=e,this.g=s,this.b=h,this.a=m,b||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[e,s,h,m]))}static parse(e){if(e instanceof Ti)return e;if(typeof e!="string")return;const s=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=ts[h];if(m){const[x,C,M]=m;return[x/255,C/255,M/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const x=h.length<6?1:2;let C=1;return[Vr(h.slice(C,C+=x)),Vr(h.slice(C,C+=x)),Vr(h.slice(C,C+=x)),Vr(h.slice(C,C+x)||"ff")]}if(h.startsWith("rgb")){const x=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[C,M,B,U,j,H,te,re,pe,Te,Me,He]=x,Be=[U||" ",te||" ",Te].join("");if(Be==="  "||Be==="  /"||Be===",,"||Be===",,,"){const Ke=[B,H,pe].join(""),nt=Ke==="%%%"?100:Ke===""?255:0;if(nt){const _t=[dr(+M/nt,0,1),dr(+j/nt,0,1),dr(+re/nt,0,1),Me?gn(+Me,He):1];if(es(_t))return _t}}return}}const b=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[x,C,M,B,U,j,H,te,re]=b,pe=[M||" ",U||" ",H].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const Te=[+C,dr(+B,0,100),dr(+j,0,100),te?gn(+te,re):1];if(es(Te))return function([Me,He,Be,Ke]){function nt(_t){const Nt=(_t+Me/30)%12,Kt=He*Math.min(Be,1-Be);return Be-Kt*Math.max(-1,Math.min(Nt-3,9-Nt,1))}return Me=ei(Me),He/=100,Be/=100,[nt(0),nt(8),nt(4),Ke]}(Te)}}}(e);return s?new Ti(...s,!1):void 0}get rgb(){const{r:e,g:s,b:h,a:m}=this,b=m||1/0;return this.overwriteGetter("rgb",[e/b,s/b,h/b,m])}get hcl(){return this.overwriteGetter("hcl",function(e){const[s,h,m,b]=ai(e),x=Math.sqrt(h*h+m*m);return[Math.round(1e4*x)?ei(Math.atan2(m,h)*di):NaN,x,s,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ai(this.rgb))}overwriteGetter(e,s){return Object.defineProperty(this,e,{value:s}),s}toString(){const[e,s,h,m]=this.rgb;return`rgba(${[e,s,h].map(b=>Math.round(255*b)).join(",")},${m})`}}Ti.black=new Ti(0,0,0,1),Ti.white=new Ti(1,1,1,1),Ti.transparent=new Ti(0,0,0,0),Ti.red=new Ti(1,0,0,1);class Kr{constructor(e,s,h){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ln{constructor(e,s,h,m,b){this.text=e,this.image=s,this.scale=h,this.fontStack=m,this.textColor=b}}class ar{constructor(e){this.sections=e}static fromString(e){return new ar([new ln(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ar?e:ar.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class zr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof zr)return e;if(typeof e=="number")return new zr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const s of e)if(typeof s!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new zr(e)}}toString(){return JSON.stringify(this.values)}}const Xa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Er{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Er)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let s=0;s<e.length;s+=2){const h=e[s],m=e[s+1];if(typeof h!="string"||!Xa.has(h)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Er(e)}}toString(){return JSON.stringify(this.values)}}class Mr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Mr({name:e,available:!1}):null}}function is(i,e,s,h){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[i,e,s,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[i,e,s,h]:[i,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _n(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ti||i instanceof Kr||i instanceof ar||i instanceof zr||i instanceof Er||i instanceof Mr)return!0;if(Array.isArray(i)){for(const e of i)if(!_n(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!_n(i[e]))return!1;return!0}return!1}function _i(i){if(i===null)return sr;if(typeof i=="string")return yi;if(typeof i=="boolean")return vi;if(typeof i=="number")return zt;if(i instanceof Ti)return xr;if(i instanceof Kr)return on;if(i instanceof ar)return ve;if(i instanceof zr)return G;if(i instanceof Er)return ce;if(i instanceof Mr)return K;if(Array.isArray(i)){const e=i.length;let s;for(const h of i){const m=_i(h);if(s){if(s===m)continue;s=pi;break}s=m}return be(s||pi,e)}return Ur}function gs(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ti||i instanceof ar||i instanceof zr||i instanceof Er||i instanceof Mr?i.toString():JSON.stringify(i)}class Xr{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!_n(e[1]))return s.error("invalid value");const h=e[1];let m=_i(h);const b=s.expectedType;return m.kind!=="array"||m.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(m=b),new Xr(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class pr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ma={string:yi,number:zt,boolean:vi,object:Ur};class zn{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let h,m=1;const b=e[0];if(b==="array"){let C,M;if(e.length>2){const B=e[1];if(typeof B!="string"||!(B in ma)||B==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);C=ma[B],m++}else C=pi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);M=e[2],m++}h=be(C,M)}else{if(!ma[b])throw new Error(`Types doesn't contain name = ${b}`);h=ma[b]}const x=[];for(;m<e.length;m++){const C=s.parse(e[m],m,pi);if(!C)return null;x.push(C)}return new zn(h,x)}evaluate(e){for(let s=0;s<this.args.length;s++){const h=this.args[s].evaluate(e);if(!Oe(this.type,_i(h)))return h;if(s===this.args.length-1)throw new pr(`Expected value to be of type ${Pe(this.type)}, but found ${Pe(_i(h))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Sc={"to-boolean":vi,"to-color":xr,"to-number":zt,"to-string":yi};class rs{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const h=e[0];if(!Sc[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&e.length!==2)return s.error("Expected one argument.");const m=Sc[h],b=[];for(let x=1;x<e.length;x++){const C=s.parse(e[x],x,pi);if(!C)return null;b.push(C)}return new rs(m,b)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let s,h;for(const m of this.args){if(s=m.evaluate(e),h=null,s instanceof Ti)return s;if(typeof s=="string"){const b=e.parseColor(s);if(b)return b}else if(Array.isArray(s)&&(h=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:is(s[0],s[1],s[2],s[3]),!h))return new Ti(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new pr(h||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const h of this.args){s=h.evaluate(e);const m=zr.parse(s);if(m)return m}throw new pr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const h of this.args){s=h.evaluate(e);const m=Er.parse(s);if(m)return m}throw new pr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const h of this.args){if(s=h.evaluate(e),s===null)return 0;const m=Number(s);if(!isNaN(m))return m}throw new pr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return ar.fromString(gs(this.args[0].evaluate(e)));case"resolvedImage":return Mr.fromString(gs(this.args[0].evaluate(e)));default:return gs(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const kc=["Unknown","Point","LineString","Polygon"];class Tc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?kc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=Ti.parse(e)),s}}class Ja{constructor(e,s,h=[],m,b=new wr,x=[]){this.registry=e,this.path=h,this.key=h.map(C=>`[${C}]`).join(""),this.scope=b,this.errors=x,this.expectedType=m,this._isConstant=s}parse(e,s,h,m,b={}){return s?this.concat(s,h,m)._parse(e,b):this._parse(e,b)}_parse(e,s){function h(m,b,x){return x==="assert"?new zn(b,[m]):x==="coerce"?new rs(b,[m]):m}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=e[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let x=b.parse(e,this);if(!x)return null;if(this.expectedType){const C=this.expectedType,M=x.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||M.kind!=="value")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(C.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(C.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(C,M))return null}else x=h(x,C,s.typeAnnotation||"coerce");else x=h(x,C,s.typeAnnotation||"coerce");else x=h(x,C,s.typeAnnotation||"coerce");else x=h(x,C,s.typeAnnotation||"assert")}if(!(x instanceof Xr)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const C=new Tc;try{x=new Xr(x.type,x.evaluate(C))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,h){const m=typeof e=="number"?this.path.concat(e):this.path,b=h?this.scope.concat(h):this.scope;return new Ja(this.registry,this._isConstant,m,s||null,b,this.errors)}error(e,...s){const h=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new br(h,e))}checkSubtype(e,s){const h=Oe(e,s);return h&&this.error(h),h}}class Ya{constructor(e,s,h){this.type=on,this.locale=h,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const h=e[1];if(typeof h!="object"||Array.isArray(h))return s.error("Collator options argument must be an object.");const m=s.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,vi);if(!m)return null;const b=s.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,vi);if(!b)return null;let x=null;return h.locale&&(x=s.parse(h.locale,1,yi),!x)?null:new Ya(m,b,x)}evaluate(e){return new Kr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const _s=8192;function Qa(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ga(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function ih(i,e){const s=(180+i[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,m=Math.pow(2,e.z);return[Math.round(s*m*_s),Math.round(h*m*_s)]}function rh(i,e,s){const h=i[0]-e[0],m=i[1]-e[1],b=i[0]-s[0],x=i[1]-s[1];return h*x-b*m==0&&h*b<=0&&m*x<=0}function _a(i,e){let s=!1;for(let x=0,C=e.length;x<C;x++){const M=e[x];for(let B=0,U=M.length;B<U-1;B++){if(rh(i,M[B],M[B+1]))return!1;(m=M[B])[1]>(h=i)[1]!=(b=M[B+1])[1]>h[1]&&h[0]<(b[0]-m[0])*(h[1]-m[1])/(b[1]-m[1])+m[0]&&(s=!s)}}var h,m,b;return s}function nh(i,e){for(let s=0;s<e.length;s++)if(_a(i,e[s]))return!0;return!1}function Cc(i,e,s,h){const m=h[0]-s[0],b=h[1]-s[1],x=(i[0]-s[0])*b-m*(i[1]-s[1]),C=(e[0]-s[0])*b-m*(e[1]-s[1]);return x>0&&C<0||x<0&&C>0}function sh(i,e,s){for(const B of s)for(let U=0;U<B.length-1;++U)if((C=[(x=B[U+1])[0]-(b=B[U])[0],x[1]-b[1]])[0]*(M=[(m=e)[0]-(h=i)[0],m[1]-h[1]])[1]-C[1]*M[0]!=0&&Cc(h,m,b,x)&&Cc(b,x,h,m))return!0;var h,m,b,x,C,M;return!1}function Yo(i,e){for(let s=0;s<i.length;++s)if(!_a(i[s],e))return!1;for(let s=0;s<i.length-1;++s)if(sh(i[s],i[s+1],e))return!1;return!0}function Ic(i,e){for(let s=0;s<e.length;s++)if(Yo(i,e[s]))return!0;return!1}function Qo(i,e,s){const h=[];for(let m=0;m<i.length;m++){const b=[];for(let x=0;x<i[m].length;x++){const C=ih(i[m][x],s);Qa(e,C),b.push(C)}h.push(b)}return h}function Ac(i,e,s){const h=[];for(let m=0;m<i.length;m++){const b=Qo(i[m],e,s);h.push(b)}return h}function el(i,e,s,h){if(i[0]<s[0]||i[0]>s[2]){const m=.5*h;let b=i[0]-s[0]>m?-h:s[0]-i[0]>m?h:0;b===0&&(b=i[0]-s[2]>m?-h:s[2]-i[0]>m?h:0),i[0]+=b}Qa(e,i)}function tl(i,e,s,h){const m=Math.pow(2,h.z)*_s,b=[h.x*_s,h.y*_s],x=[];for(const C of i)for(const M of C){const B=[M.x+b[0],M.y+b[1]];el(B,e,s,m),x.push(B)}return x}function Pc(i,e,s,h){const m=Math.pow(2,h.z)*_s,b=[h.x*_s,h.y*_s],x=[];for(const M of i){const B=[];for(const U of M){const j=[U.x+b[0],U.y+b[1]];Qa(e,j),B.push(j)}x.push(B)}if(e[2]-e[0]<=m/2){(C=e)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const M of x)for(const B of M)el(B,e,s,m)}var C;return x}class Is{constructor(e,s){this.type=vi,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(_n(e[1])){const h=e[1];if(h.type==="FeatureCollection")for(let m=0;m<h.features.length;++m){const b=h.features[m].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Is(h,h.features[m].geometry)}else if(h.type==="Feature"){const m=h.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Is(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Is(h,h)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,h){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(h.type==="Polygon"){const C=Qo(h.coordinates,b,x),M=tl(s.geometry(),m,b,x);if(!ga(m,b))return!1;for(const B of M)if(!_a(B,C))return!1}if(h.type==="MultiPolygon"){const C=Ac(h.coordinates,b,x),M=tl(s.geometry(),m,b,x);if(!ga(m,b))return!1;for(const B of M)if(!nh(B,C))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,h){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],x=s.canonicalID();if(h.type==="Polygon"){const C=Qo(h.coordinates,b,x),M=Pc(s.geometry(),m,b,x);if(!ga(m,b))return!1;for(const B of M)if(!Yo(B,C))return!1}if(h.type==="MultiPolygon"){const C=Ac(h.coordinates,b,x),M=Pc(s.geometry(),m,b,x);if(!ga(m,b))return!1;for(const B of M)if(!Ic(B,C))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class eo{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const h=e[1];return s.scope.has(h)?new eo(h,s.scope.get(h)):s.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Mn{constructor(e,s,h,m){this.name=e,this.type=s,this._evaluate=h,this.args=m}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,s){const h=e[0],m=Mn.definitions[h];if(!m)return s.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,C=x.filter(([B])=>!Array.isArray(B)||B.length===e.length-1);let M=null;for(const[B,U]of C){M=new Ja(s.registry,to,s.path,null,s.scope);const j=[];let H=!1;for(let te=1;te<e.length;te++){const re=e[te],pe=Array.isArray(B)?B[te-1]:B.type,Te=M.parse(re,1+j.length,pe);if(!Te){H=!0;break}j.push(Te)}if(!H)if(Array.isArray(B)&&B.length!==j.length)M.error(`Expected ${B.length} arguments, but found ${j.length} instead.`);else{for(let te=0;te<j.length;te++){const re=Array.isArray(B)?B[te]:B.type,pe=j[te];M.concat(te+1).checkSubtype(re,pe.type)}if(M.errors.length===0)return new Mn(h,b,U,j)}}if(C.length===1)s.errors.push(...M.errors);else{const B=(C.length?C:x).map(([j])=>{return H=j,Array.isArray(H)?`(${H.map(Pe).join(", ")})`:`(${Pe(H.type)}...)`;var H}).join(" | "),U=[];for(let j=1;j<e.length;j++){const H=s.parse(e[j],1+U.length);if(!H)return null;U.push(Pe(H.type))}s.error(`Expected arguments of type ${B}, but found (${U.join(", ")}) instead.`)}return null}static register(e,s){Mn.definitions=s;for(const h in s)e[h]=Mn}}function to(i){if(i instanceof eo)return to(i.boundExpression);if(i instanceof Mn&&i.name==="error"||i instanceof Ya||i instanceof Is)return!1;const e=i instanceof rs||i instanceof zn;let s=!0;return i.eachChild(h=>{s=e?s&&to(h):s&&h instanceof Xr}),!!s&&io(i)&&js(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function io(i){if(i instanceof Mn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Is)return!1;let e=!0;return i.eachChild(s=>{e&&!io(s)&&(e=!1)}),e}function ya(i){if(i instanceof Mn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(s=>{e&&!ya(s)&&(e=!1)}),e}function js(i,e){if(i instanceof Mn&&e.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(h=>{s&&!js(h,e)&&(s=!1)}),s}function As(i,e){const s=i.length-1;let h,m,b=0,x=s,C=0;for(;b<=x;)if(C=Math.floor((b+x)/2),h=i[C],m=i[C+1],h<=e){if(C===s||e<m)return C;b=C+1}else{if(!(h>e))throw new pr("Input is not a number.");x=C-1}return 0}class Ri{constructor(e,s,h){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[m,b]of h)this.labels.push(m),this.outputs.push(b)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const h=s.parse(e[1],1,zt);if(!h)return null;const m=[];let b=null;s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let x=1;x<e.length;x+=2){const C=x===1?-1/0:e[x],M=e[x+1],B=x,U=x+1;if(typeof C!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(m.length&&m[m.length-1][0]>=C)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const j=s.parse(M,U,b);if(!j)return null;b=b||j.type,m.push([C,j])}return new Ri(b,h,m)}evaluate(e){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(e);const m=this.input.evaluate(e);if(m<=s[0])return h[0].evaluate(e);const b=s.length;return m>=s[b-1]?h[b-1].evaluate(e):h[As(s,m)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ps(i,e,s){return i+s*(e-i)}function ro(i,e,s){return i.map((h,m)=>Ps(h,e[m],s))}const yn={number:Ps,color:function(i,e,s,h="rgb"){switch(h){case"rgb":{const[m,b,x,C]=ro(i.rgb,e.rgb,s);return new Ti(m,b,x,C,!1)}case"hcl":{const[m,b,x,C]=i.hcl,[M,B,U,j]=e.hcl;let H,te;if(isNaN(m)||isNaN(M))isNaN(m)?isNaN(M)?H=NaN:(H=M,x!==1&&x!==0||(te=B)):(H=m,U!==1&&U!==0||(te=b));else{let He=M-m;M>m&&He>180?He-=360:M<m&&m-M>180&&(He+=360),H=m+s*He}const[re,pe,Te,Me]=function([He,Be,Ke,nt]){return He=isNaN(He)?0:He*Gt,gi([Ke,Math.cos(He)*Be,Math.sin(He)*Be,nt])}([H,te??Ps(b,B,s),Ps(x,U,s),Ps(C,j,s)]);return new Ti(re,pe,Te,Me,!1)}case"lab":{const[m,b,x,C]=gi(ro(i.lab,e.lab,s));return new Ti(m,b,x,C,!1)}}},array:ro,padding:function(i,e,s){return new zr(ro(i.values,e.values,s))},variableAnchorOffsetCollection:function(i,e,s){const h=i.values,m=e.values;if(h.length!==m.length)throw new pr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const b=[];for(let x=0;x<h.length;x+=2){if(h[x]!==m[x])throw new pr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${h[x]}, to[${x}]: ${m[x]}`);b.push(h[x]);const[C,M]=h[x+1],[B,U]=m[x+1];b.push([Ps(C,B,s),Ps(M,U,s)])}return new Er(b)}};class vn{constructor(e,s,h,m,b){this.type=e,this.operator=s,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[x,C]of b)this.labels.push(x),this.outputs.push(C)}static interpolationFactor(e,s,h,m){let b=0;if(e.name==="exponential")b=il(s,e.base,h,m);else if(e.name==="linear")b=il(s,1,h,m);else if(e.name==="cubic-bezier"){const x=e.controlPoints;b=new A(x[0],x[1],x[2],x[3]).solve(il(s,1,h,m))}return b}static parse(e,s){let[h,m,b,...x]=e;if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const B=m[1];if(typeof B!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:B}}else{if(m[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const B=m.slice(1);if(B.length!==4||B.some(U=>typeof U!="number"||U<0||U>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:B}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(b=s.parse(b,2,zt),!b)return null;const C=[];let M=null;h==="interpolate-hcl"||h==="interpolate-lab"?M=xr:s.expectedType&&s.expectedType.kind!=="value"&&(M=s.expectedType);for(let B=0;B<x.length;B+=2){const U=x[B],j=x[B+1],H=B+3,te=B+4;if(typeof U!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(C.length&&C[C.length-1][0]>=U)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const re=s.parse(j,te,M);if(!re)return null;M=M||re.type,C.push([U,re])}return X(M,zt)||X(M,xr)||X(M,G)||X(M,ce)||X(M,be(zt))?new vn(M,h,m,b,C):s.error(`Type ${Pe(M)} is not interpolatable.`)}evaluate(e){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(e);const m=this.input.evaluate(e);if(m<=s[0])return h[0].evaluate(e);const b=s.length;if(m>=s[b-1])return h[b-1].evaluate(e);const x=As(s,m),C=vn.interpolationFactor(this.interpolation,m,s[x],s[x+1]),M=h[x].evaluate(e),B=h[x+1].evaluate(e);switch(this.operator){case"interpolate":return yn[this.type.kind](M,B,C);case"interpolate-hcl":return yn.color(M,B,C,"hcl");case"interpolate-lab":return yn.color(M,B,C,"lab")}}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function il(i,e,s,h){const m=h-s,b=i-s;return m===0?0:e===1?b/m:(Math.pow(e,b)-1)/(Math.pow(e,m)-1)}class no{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let h=null;const m=s.expectedType;m&&m.kind!=="value"&&(h=m);const b=[];for(const C of e.slice(1)){const M=s.parse(C,1+b.length,h,void 0,{typeAnnotation:"omit"});if(!M)return null;h=h||M.type,b.push(M)}if(!h)throw new Error("No output type");const x=m&&b.some(C=>Oe(m,C.type));return new no(x?pi:h,b)}evaluate(e){let s,h=null,m=0;for(const b of this.args)if(m++,h=b.evaluate(e),h&&h instanceof Mr&&!h.available&&(s||(s=h.name),h=null,m===this.args.length&&(h=s)),h!==null)break;return h}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class so{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const h=[];for(let b=1;b<e.length-1;b+=2){const x=e[b];if(typeof x!="string")return s.error(`Expected string, but found ${typeof x} instead.`,b);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",b);const C=s.parse(e[b+1],b+1);if(!C)return null;h.push([x,C])}const m=s.parse(e[e.length-1],e.length-1,s.expectedType,h);return m?new so(h,m):null}outputDefined(){return this.result.outputDefined()}}class rl{constructor(e,s,h){this.type=e,this.index=s,this.input=h}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,zt),m=s.parse(e[2],2,be(s.expectedType||pi));return h&&m?new rl(m.type.itemType,h,m):null}evaluate(e){const s=this.index.evaluate(e),h=this.input.evaluate(e);if(s<0)throw new pr(`Array index out of bounds: ${s} < 0.`);if(s>=h.length)throw new pr(`Array index out of bounds: ${s} > ${h.length-1}.`);if(s!==Math.floor(s))throw new pr(`Array index must be an integer, but found ${s} instead.`);return h[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class nl{constructor(e,s){this.type=vi,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,pi),m=s.parse(e[2],2,pi);return h&&m?De(h.type,[vi,yi,zt,sr,pi])?new nl(h,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pe(h.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!h)return!1;if(!W(s,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${Pe(_i(s))} instead.`);if(!W(h,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${Pe(_i(h))} instead.`);return h.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ao{constructor(e,s,h){this.type=zt,this.needle=e,this.haystack=s,this.fromIndex=h}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,pi),m=s.parse(e[2],2,pi);if(!h||!m)return null;if(!De(h.type,[vi,yi,zt,sr,pi]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pe(h.type)} instead`);if(e.length===4){const b=s.parse(e[3],3,zt);return b?new ao(h,m,b):null}return new ao(h,m)}evaluate(e){const s=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!W(s,["boolean","string","number","null"]))throw new pr(`Expected first argument to be of type boolean, string, number or null, but found ${Pe(_i(s))} instead.`);if(!W(h,["string","array"]))throw new pr(`Expected second argument to be of type array or string, but found ${Pe(_i(h))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(e);return h.indexOf(s,m)}return h.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class sl{constructor(e,s,h,m,b,x){this.inputType=e,this.type=s,this.input=h,this.cases=m,this.outputs=b,this.otherwise=x}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let h,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);const b={},x=[];for(let B=2;B<e.length-1;B+=2){let U=e[B];const j=e[B+1];Array.isArray(U)||(U=[U]);const H=s.concat(B);if(U.length===0)return H.error("Expected at least one branch label.");for(const re of U){if(typeof re!="number"&&typeof re!="string")return H.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return H.error("Numeric branch labels must be integer values.");if(h){if(H.checkSubtype(h,_i(re)))return null}else h=_i(re);if(b[String(re)]!==void 0)return H.error("Branch labels must be unique.");b[String(re)]=x.length}const te=s.parse(j,B,m);if(!te)return null;m=m||te.type,x.push(te)}const C=s.parse(e[1],1,pi);if(!C)return null;const M=s.parse(e[e.length-1],e.length-1,m);return M?C.type.kind!=="value"&&s.concat(1).checkSubtype(h,C.type)?null:new sl(h,m,C,b,x,M):null}evaluate(e){const s=this.input.evaluate(e);return(_i(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class al{constructor(e,s,h){this.type=e,this.branches=s,this.otherwise=h}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const m=[];for(let x=1;x<e.length-1;x+=2){const C=s.parse(e[x],x,vi);if(!C)return null;const M=s.parse(e[x+1],x+1,h);if(!M)return null;m.push([C,M]),h=h||M.type}const b=s.parse(e[e.length-1],e.length-1,h);if(!b)return null;if(!h)throw new Error("Can't infer output type");return new al(h,m,b)}evaluate(e){for(const[s,h]of this.branches)if(s.evaluate(e))return h.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,h]of this.branches)e(s),e(h);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class oo{constructor(e,s,h,m){this.type=e,this.input=s,this.beginIndex=h,this.endIndex=m}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,pi),m=s.parse(e[2],2,zt);if(!h||!m)return null;if(!De(h.type,[be(pi),yi,pi]))return s.error(`Expected first argument to be of type array or string, but found ${Pe(h.type)} instead`);if(e.length===4){const b=s.parse(e[3],3,zt);return b?new oo(h.type,h,m,b):null}return new oo(h.type,h,m)}evaluate(e){const s=this.input.evaluate(e),h=this.beginIndex.evaluate(e);if(!W(s,["string","array"]))throw new pr(`Expected first argument to be of type array or string, but found ${Pe(_i(s))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(e);return s.slice(h,m)}return s.slice(h)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function zc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Mc(i,e,s,h){return h.compare(e,s)===0}function qs(i,e,s){const h=i!=="=="&&i!=="!=";return class ay{constructor(b,x,C){this.type=vi,this.lhs=b,this.rhs=x,this.collator=C,this.hasUntypedArgument=b.type.kind==="value"||x.type.kind==="value"}static parse(b,x){if(b.length!==3&&b.length!==4)return x.error("Expected two or three arguments.");const C=b[0];let M=x.parse(b[1],1,pi);if(!M)return null;if(!zc(C,M.type))return x.concat(1).error(`"${C}" comparisons are not supported for type '${Pe(M.type)}'.`);let B=x.parse(b[2],2,pi);if(!B)return null;if(!zc(C,B.type))return x.concat(2).error(`"${C}" comparisons are not supported for type '${Pe(B.type)}'.`);if(M.type.kind!==B.type.kind&&M.type.kind!=="value"&&B.type.kind!=="value")return x.error(`Cannot compare types '${Pe(M.type)}' and '${Pe(B.type)}'.`);h&&(M.type.kind==="value"&&B.type.kind!=="value"?M=new zn(B.type,[M]):M.type.kind!=="value"&&B.type.kind==="value"&&(B=new zn(M.type,[B])));let U=null;if(b.length===4){if(M.type.kind!=="string"&&B.type.kind!=="string"&&M.type.kind!=="value"&&B.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(U=x.parse(b[3],3,on),!U)return null}return new ay(M,B,U)}evaluate(b){const x=this.lhs.evaluate(b),C=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){const M=_i(x),B=_i(C);if(M.kind!==B.kind||M.kind!=="string"&&M.kind!=="number")throw new pr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${M.kind}, ${B.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const M=_i(x),B=_i(C);if(M.kind!=="string"||B.kind!=="string")return e(b,x,C)}return this.collator?s(b,x,C,this.collator.evaluate(b)):e(b,x,C)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const ah=qs("==",function(i,e,s){return e===s},Mc),oh=qs("!=",function(i,e,s){return e!==s},function(i,e,s,h){return!Mc(0,e,s,h)}),lh=qs("<",function(i,e,s){return e<s},function(i,e,s,h){return h.compare(e,s)<0}),ch=qs(">",function(i,e,s){return e>s},function(i,e,s,h){return h.compare(e,s)>0}),uh=qs("<=",function(i,e,s){return e<=s},function(i,e,s,h){return h.compare(e,s)<=0}),hh=qs(">=",function(i,e,s){return e>=s},function(i,e,s,h){return h.compare(e,s)>=0});class ol{constructor(e,s,h,m,b){this.type=yi,this.number=e,this.locale=s,this.currency=h,this.minFractionDigits=m,this.maxFractionDigits=b}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const h=s.parse(e[1],1,zt);if(!h)return null;const m=e[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=s.parse(m.locale,1,yi),!b))return null;let x=null;if(m.currency&&(x=s.parse(m.currency,1,yi),!x))return null;let C=null;if(m["min-fraction-digits"]&&(C=s.parse(m["min-fraction-digits"],1,zt),!C))return null;let M=null;return m["max-fraction-digits"]&&(M=s.parse(m["max-fraction-digits"],1,zt),!M)?null:new ol(h,b,x,C,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class lo{constructor(e){this.type=ve,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const h=e[1];if(!Array.isArray(h)&&typeof h=="object")return s.error("First argument must be an image or text section.");const m=[];let b=!1;for(let x=1;x<=e.length-1;++x){const C=e[x];if(b&&typeof C=="object"&&!Array.isArray(C)){b=!1;let M=null;if(C["font-scale"]&&(M=s.parse(C["font-scale"],1,zt),!M))return null;let B=null;if(C["text-font"]&&(B=s.parse(C["text-font"],1,be(yi)),!B))return null;let U=null;if(C["text-color"]&&(U=s.parse(C["text-color"],1,xr),!U))return null;const j=m[m.length-1];j.scale=M,j.font=B,j.textColor=U}else{const M=s.parse(e[x],1,pi);if(!M)return null;const B=M.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:M,scale:null,font:null,textColor:null})}}return new lo(m)}evaluate(e){return new ar(this.sections.map(s=>{const h=s.content.evaluate(e);return _i(h)===K?new ln("",h,null,null,null):new ln(gs(h),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}}class ll{constructor(e){this.type=K,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const h=s.parse(e[1],1,yi);return h?new ll(h):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),h=Mr.fromString(s);return h&&e.availableImages&&(h.available=e.availableImages.indexOf(s)>-1),h}eachChild(e){e(this.input)}outputDefined(){return!1}}class cl{constructor(e){this.type=zt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const h=s.parse(e[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Pe(h.type)} instead.`):new cl(h):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new pr(`Expected value to be of type string or array, but found ${Pe(_i(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Zs={"==":ah,"!=":oh,">":ch,"<":lh,">=":hh,"<=":uh,array:zn,at:rl,boolean:zn,case:al,coalesce:no,collator:Ya,format:lo,image:ll,in:nl,"index-of":ao,interpolate:vn,"interpolate-hcl":vn,"interpolate-lab":vn,length:cl,let:so,literal:Xr,match:sl,number:zn,"number-format":ol,object:zn,slice:oo,step:Ri,string:zn,"to-boolean":rs,"to-color":rs,"to-number":rs,"to-string":rs,var:eo,within:Is};function Dc(i,[e,s,h,m]){e=e.evaluate(i),s=s.evaluate(i),h=h.evaluate(i);const b=m?m.evaluate(i):1,x=is(e,s,h,b);if(x)throw new pr(x);return new Ti(e/255,s/255,h/255,b,!1)}function Lc(i,e){return i in e}function ul(i,e){const s=e[i];return s===void 0?null:s}function zs(i){return{type:i}}function co(i){return{result:"success",value:i}}function Gs(i){return{result:"error",value:i}}function Hs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Rc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function hl(i){return!!i.expression&&i.expression.interpolated}function mi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function uo(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Li(i){return i}function ho(i,e){const s=e.type==="color",h=i.stops&&typeof i.stops[0][0]=="object",m=h||!(h||i.property!==void 0),b=i.type||(hl(e)?"exponential":"interval");if(s||e.type==="padding"){const U=s?Ti.parse:zr.parse;(i=Ki({},i)).stops&&(i.stops=i.stops.map(j=>[j[0],U(j[1])])),i.default=U(i.default?i.default:e.default)}if(i.colorSpace&&(x=i.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var x;let C,M,B;if(b==="exponential")C=fl;else if(b==="interval")C=fo;else if(b==="categorical"){C=Yi,M=Object.create(null);for(const U of i.stops)M[U[0]]=U[1];B=typeof i.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);C=fh}if(h){const U={},j=[];for(let re=0;re<i.stops.length;re++){const pe=i.stops[re],Te=pe[0].zoom;U[Te]===void 0&&(U[Te]={zoom:Te,type:i.type,property:i.property,default:i.default,stops:[]},j.push(Te)),U[Te].stops.push([pe[0].value,pe[1]])}const H=[];for(const re of j)H.push([U[re].zoom,ho(U[re],e)]);const te={name:"linear"};return{kind:"composite",interpolationType:te,interpolationFactor:vn.interpolationFactor.bind(void 0,te),zoomStops:H.map(re=>re[0]),evaluate:({zoom:re},pe)=>fl({stops:H,base:i.base},e,re).evaluate(re,pe)}}if(m){const U=b==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:U,interpolationFactor:vn.interpolationFactor.bind(void 0,U),zoomStops:i.stops.map(j=>j[0]),evaluate:({zoom:j})=>C(i,e,j,M,B)}}return{kind:"source",evaluate(U,j){const H=j&&j.properties?j.properties[i.property]:void 0;return H===void 0?Hi(i.default,e.default):C(i,e,H,M,B)}}}function Hi(i,e,s){return i!==void 0?i:e!==void 0?e:s!==void 0?s:void 0}function Yi(i,e,s,h,m){return Hi(typeof s===m?h[s]:void 0,i.default,e.default)}function fo(i,e,s){if(mi(s)!=="number")return Hi(i.default,e.default);const h=i.stops.length;if(h===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const m=As(i.stops.map(b=>b[0]),s);return i.stops[m][1]}function fl(i,e,s){const h=i.base!==void 0?i.base:1;if(mi(s)!=="number")return Hi(i.default,e.default);const m=i.stops.length;if(m===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[m-1][0])return i.stops[m-1][1];const b=As(i.stops.map(U=>U[0]),s),x=function(U,j,H,te){const re=te-H,pe=U-H;return re===0?0:j===1?pe/re:(Math.pow(j,pe)-1)/(Math.pow(j,re)-1)}(s,h,i.stops[b][0],i.stops[b+1][0]),C=i.stops[b][1],M=i.stops[b+1][1],B=yn[e.type]||Li;return typeof C.evaluate=="function"?{evaluate(...U){const j=C.evaluate.apply(void 0,U),H=M.evaluate.apply(void 0,U);if(j!==void 0&&H!==void 0)return B(j,H,x,i.colorSpace)}}:B(C,M,x,i.colorSpace)}function fh(i,e,s){switch(e.type){case"color":s=Ti.parse(s);break;case"formatted":s=ar.fromString(s.toString());break;case"resolvedImage":s=Mr.fromString(s.toString());break;case"padding":s=zr.parse(s);break;default:mi(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0)}return Hi(s,i.default,e.default)}Mn.register(Zs,{error:[{kind:"error"},[yi],(i,[e])=>{throw new pr(e.evaluate(i))}],typeof:[yi,[pi],(i,[e])=>Pe(_i(e.evaluate(i)))],"to-rgba":[be(zt,4),[xr],(i,[e])=>{const[s,h,m,b]=e.evaluate(i).rgb;return[255*s,255*h,255*m,b]}],rgb:[xr,[zt,zt,zt],Dc],rgba:[xr,[zt,zt,zt,zt],Dc],has:{type:vi,overloads:[[[yi],(i,[e])=>Lc(e.evaluate(i),i.properties())],[[yi,Ur],(i,[e,s])=>Lc(e.evaluate(i),s.evaluate(i))]]},get:{type:pi,overloads:[[[yi],(i,[e])=>ul(e.evaluate(i),i.properties())],[[yi,Ur],(i,[e,s])=>ul(e.evaluate(i),s.evaluate(i))]]},"feature-state":[pi,[yi],(i,[e])=>ul(e.evaluate(i),i.featureState||{})],properties:[Ur,[],i=>i.properties()],"geometry-type":[yi,[],i=>i.geometryType()],id:[pi,[],i=>i.id()],zoom:[zt,[],i=>i.globals.zoom],"heatmap-density":[zt,[],i=>i.globals.heatmapDensity||0],"line-progress":[zt,[],i=>i.globals.lineProgress||0],accumulated:[pi,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[zt,zs(zt),(i,e)=>{let s=0;for(const h of e)s+=h.evaluate(i);return s}],"*":[zt,zs(zt),(i,e)=>{let s=1;for(const h of e)s*=h.evaluate(i);return s}],"-":{type:zt,overloads:[[[zt,zt],(i,[e,s])=>e.evaluate(i)-s.evaluate(i)],[[zt],(i,[e])=>-e.evaluate(i)]]},"/":[zt,[zt,zt],(i,[e,s])=>e.evaluate(i)/s.evaluate(i)],"%":[zt,[zt,zt],(i,[e,s])=>e.evaluate(i)%s.evaluate(i)],ln2:[zt,[],()=>Math.LN2],pi:[zt,[],()=>Math.PI],e:[zt,[],()=>Math.E],"^":[zt,[zt,zt],(i,[e,s])=>Math.pow(e.evaluate(i),s.evaluate(i))],sqrt:[zt,[zt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))],log2:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[zt,[zt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[zt,[zt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[zt,[zt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[zt,[zt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[zt,[zt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[zt,[zt],(i,[e])=>Math.atan(e.evaluate(i))],min:[zt,zs(zt),(i,e)=>Math.min(...e.map(s=>s.evaluate(i)))],max:[zt,zs(zt),(i,e)=>Math.max(...e.map(s=>s.evaluate(i)))],abs:[zt,[zt],(i,[e])=>Math.abs(e.evaluate(i))],round:[zt,[zt],(i,[e])=>{const s=e.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[zt,[zt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[zt,[zt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[vi,[yi,pi],(i,[e,s])=>i.properties()[e.value]===s.value],"filter-id-==":[vi,[pi],(i,[e])=>i.id()===e.value],"filter-type-==":[vi,[yi],(i,[e])=>i.geometryType()===e.value],"filter-<":[vi,[yi,pi],(i,[e,s])=>{const h=i.properties()[e.value],m=s.value;return typeof h==typeof m&&h<m}],"filter-id-<":[vi,[pi],(i,[e])=>{const s=i.id(),h=e.value;return typeof s==typeof h&&s<h}],"filter->":[vi,[yi,pi],(i,[e,s])=>{const h=i.properties()[e.value],m=s.value;return typeof h==typeof m&&h>m}],"filter-id->":[vi,[pi],(i,[e])=>{const s=i.id(),h=e.value;return typeof s==typeof h&&s>h}],"filter-<=":[vi,[yi,pi],(i,[e,s])=>{const h=i.properties()[e.value],m=s.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[vi,[pi],(i,[e])=>{const s=i.id(),h=e.value;return typeof s==typeof h&&s<=h}],"filter->=":[vi,[yi,pi],(i,[e,s])=>{const h=i.properties()[e.value],m=s.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[vi,[pi],(i,[e])=>{const s=i.id(),h=e.value;return typeof s==typeof h&&s>=h}],"filter-has":[vi,[pi],(i,[e])=>e.value in i.properties()],"filter-has-id":[vi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[vi,[be(yi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[vi,[be(pi)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[vi,[yi,be(pi)],(i,[e,s])=>s.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[vi,[yi,be(pi)],(i,[e,s])=>function(h,m,b,x){for(;b<=x;){const C=b+x>>1;if(m[C]===h)return!0;m[C]>h?x=C-1:b=C+1}return!1}(i.properties()[e.value],s.value,0,s.value.length-1)],all:{type:vi,overloads:[[[vi,vi],(i,[e,s])=>e.evaluate(i)&&s.evaluate(i)],[zs(vi),(i,e)=>{for(const s of e)if(!s.evaluate(i))return!1;return!0}]]},any:{type:vi,overloads:[[[vi,vi],(i,[e,s])=>e.evaluate(i)||s.evaluate(i)],[zs(vi),(i,e)=>{for(const s of e)if(s.evaluate(i))return!0;return!1}]]},"!":[vi,[vi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[vi,[yi],(i,[e])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(e.evaluate(i))}],upcase:[yi,[yi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[yi,[yi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[yi,zs(pi),(i,e)=>e.map(s=>gs(s.evaluate(i))).join("")],"resolved-locale":[yi,[on],(i,[e])=>e.evaluate(i).resolvedLocale()]});class dl{constructor(e,s){var h;this.expression=e,this._warningHistory={},this._evaluator=new Tc,this._defaultValue=s?(h=s).type==="color"&&uo(h.default)?new Ti(0,0,0,0):h.type==="color"?Ti.parse(h.default)||null:h.type==="padding"?zr.parse(h.default)||null:h.type==="variableAnchorOffsetCollection"?Er.parse(h.default)||null:h.default===void 0?null:h.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,h,m,b,x){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=h,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(e,s,h,m,b,x){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=x||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new pr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function po(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Zs}function mo(i,e){const s=new Ja(Zs,to,[],e?function(m){const b={color:xr,string:yi,number:zt,enum:yi,boolean:vi,formatted:ve,padding:G,resolvedImage:K,variableAnchorOffsetCollection:ce};return m.type==="array"?be(b[m.value]||pi,m.length):b[m.type]}(e):void 0),h=s.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?co(new dl(h,e)):Gs(s.errors)}class go{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!ya(s.expression)}evaluateWithoutErrorHandling(e,s,h,m,b,x){return this._styleExpression.evaluateWithoutErrorHandling(e,s,h,m,b,x)}evaluate(e,s,h,m,b,x){return this._styleExpression.evaluate(e,s,h,m,b,x)}}class _o{constructor(e,s,h,m){this.kind=e,this.zoomStops=h,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!ya(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(e,s,h,m,b,x){return this._styleExpression.evaluateWithoutErrorHandling(e,s,h,m,b,x)}evaluate(e,s,h,m,b,x){return this._styleExpression.evaluate(e,s,h,m,b,x)}interpolationFactor(e,s,h){return this.interpolationType?vn.interpolationFactor(this.interpolationType,e,s,h):0}}function pl(i,e){const s=mo(i,e);if(s.result==="error")return s;const h=s.value.expression,m=io(h);if(!m&&!Hs(e))return Gs([new br("","data expressions not supported")]);const b=js(h,["zoom"]);if(!b&&!Rc(e))return Gs([new br("","zoom expressions not supported")]);const x=Ws(h);return x||b?x instanceof br?Gs([x]):x instanceof vn&&!hl(e)?Gs([new br("",'"interpolate" expressions cannot be used with this property')]):co(x?new _o(m?"camera":"composite",s.value,x.labels,x instanceof vn?x.interpolation:void 0):new go(m?"constant":"source",s.value)):Gs([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class va{constructor(e,s){this._parameters=e,this._specification=s,Ki(this,ho(this._parameters,this._specification))}static deserialize(e){return new va(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ws(i){let e=null;if(i instanceof so)e=Ws(i.result);else if(i instanceof no){for(const s of i.args)if(e=Ws(s),e)break}else(i instanceof Ri||i instanceof vn)&&i.input instanceof Mn&&i.input.name==="zoom"&&(e=i);return e instanceof br||i.eachChild(s=>{const h=Ws(s);h instanceof br?e=h:!e&&h?e=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&h&&e!==h&&(e=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ml(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ml(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const dh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function gl(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ml(i)||(i=yo(i));const e=mo(i,dh);if(e.result==="error")throw new Error(e.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,h,m)=>e.value.evaluate(s,h,{},m),needGeometry:Bc(i)}}function ph(i,e){return i<e?-1:i>e?1:0}function Bc(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Bc(i[e]))return!0;return!1}function yo(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?_l(i[1],i[2],"=="):e==="!="?ba(_l(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?_l(i[1],i[2],e):e==="any"?(s=i.slice(1),["any"].concat(s.map(yo))):e==="all"?["all"].concat(i.slice(1).map(yo)):e==="none"?["all"].concat(i.slice(1).map(yo).map(ba)):e==="in"?Oc(i[1],i.slice(2)):e==="!in"?ba(Oc(i[1],i.slice(2))):e==="has"?yl(i[1]):e==="!has"?ba(yl(i[1])):e!=="within"||i;var s}function _l(i,e,s){switch(i){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,i,e]}}function Oc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",i,["literal",e.sort(ph)]]:["filter-in-small",i,["literal",e]]}}function yl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ba(i){return["!",i]}function Ks(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let m="[";for(const b of i)m+=`${Ks(b)},`;return`${m}]`}const s=Object.keys(i).sort();let h="{";for(let m=0;m<s.length;m++)h+=`${JSON.stringify(s[m])}:${Ks(i[s[m]])},`;return`${h}}`}function mh(i){let e="";for(const s of Qe)e+=`/${Ks(i[s])}`;return e}function vl(i){const e=i.value;return e?[new vt(i.key,e,"constants have been deprecated as of v8")]:[]}function ur(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ns(i){if(Array.isArray(i))return i.map(ns);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const s in i)e[s]=ns(i[s]);return e}return ur(i)}function Jr(i){const e=i.key,s=i.value,h=i.valueSpec||{},m=i.objectElementValidators||{},b=i.style,x=i.styleSpec,C=i.validateSpec;let M=[];const B=mi(s);if(B!=="object")return[new vt(e,s,`object expected, ${B} found`)];for(const U in s){const j=U.split(".")[0],H=h[j]||h["*"];let te;if(m[j])te=m[j];else if(h[j])te=C;else if(m["*"])te=m["*"];else{if(!h["*"]){M.push(new vt(e,s[U],`unknown property "${U}"`));continue}te=C}M=M.concat(te({key:(e&&`${e}.`)+U,value:s[U],valueSpec:H,style:b,styleSpec:x,object:s,objectKey:U,validateSpec:C},s))}for(const U in h)m[U]||h[U].required&&h[U].default===void 0&&s[U]===void 0&&M.push(new vt(e,s,`missing required property "${U}"`));return M}function wa(i){const e=i.value,s=i.valueSpec,h=i.style,m=i.styleSpec,b=i.key,x=i.arrayElementValidator||i.validateSpec;if(mi(e)!=="array")return[new vt(b,e,`array expected, ${mi(e)} found`)];if(s.length&&e.length!==s.length)return[new vt(b,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new vt(b,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let C={type:s.value,values:s.values};m.$version<7&&(C.function=s.function),mi(s.value)==="object"&&(C=s.value);let M=[];for(let B=0;B<e.length;B++)M=M.concat(x({array:e,arrayIndex:B,value:e[B],valueSpec:C,validateSpec:i.validateSpec,style:h,styleSpec:m,key:`${b}[${B}]`}));return M}function xa(i){const e=i.key,s=i.value,h=i.valueSpec;let m=mi(s);return m==="number"&&s!=s&&(m="NaN"),m!=="number"?[new vt(e,s,`number expected, ${m} found`)]:"minimum"in h&&s<h.minimum?[new vt(e,s,`${s} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&s>h.maximum?[new vt(e,s,`${s} is greater than the maximum value ${h.maximum}`)]:[]}function bl(i){const e=i.valueSpec,s=ur(i.value.type);let h,m,b,x={};const C=s!=="categorical"&&i.value.property===void 0,M=!C,B=mi(i.value.stops)==="array"&&mi(i.value.stops[0])==="array"&&mi(i.value.stops[0][0])==="object",U=Jr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(te){if(s==="identity")return[new vt(te.key,te.value,'identity function may not have a "stops" property')];let re=[];const pe=te.value;return re=re.concat(wa({key:te.key,value:pe,valueSpec:te.valueSpec,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:j})),mi(pe)==="array"&&pe.length===0&&re.push(new vt(te.key,pe,"array must have at least one stop")),re},default:function(te){return te.validateSpec({key:te.key,value:te.value,valueSpec:e,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec})}}});return s==="identity"&&C&&U.push(new vt(i.key,i.value,'missing required property "property"')),s==="identity"||i.value.stops||U.push(new vt(i.key,i.value,'missing required property "stops"')),s==="exponential"&&i.valueSpec.expression&&!hl(i.valueSpec)&&U.push(new vt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(M&&!Hs(i.valueSpec)?U.push(new vt(i.key,i.value,"property functions not supported")):C&&!Rc(i.valueSpec)&&U.push(new vt(i.key,i.value,"zoom functions not supported"))),s!=="categorical"&&!B||i.value.property!==void 0||U.push(new vt(i.key,i.value,'"property" property is required')),U;function j(te){let re=[];const pe=te.value,Te=te.key;if(mi(pe)!=="array")return[new vt(Te,pe,`array expected, ${mi(pe)} found`)];if(pe.length!==2)return[new vt(Te,pe,`array length 2 expected, length ${pe.length} found`)];if(B){if(mi(pe[0])!=="object")return[new vt(Te,pe,`object expected, ${mi(pe[0])} found`)];if(pe[0].zoom===void 0)return[new vt(Te,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new vt(Te,pe,"object stop key must have value")];if(b&&b>ur(pe[0].zoom))return[new vt(Te,pe[0].zoom,"stop zoom values must appear in ascending order")];ur(pe[0].zoom)!==b&&(b=ur(pe[0].zoom),m=void 0,x={}),re=re.concat(Jr({key:`${Te}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:xa,value:H}}))}else re=re.concat(H({key:`${Te}[0]`,value:pe[0],valueSpec:{},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec},pe));return po(ns(pe[1]))?re.concat([new vt(`${Te}[1]`,pe[1],"expressions are not allowed in function stops.")]):re.concat(te.validateSpec({key:`${Te}[1]`,value:pe[1],valueSpec:e,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec}))}function H(te,re){const pe=mi(te.value),Te=ur(te.value),Me=te.value!==null?te.value:re;if(h){if(pe!==h)return[new vt(te.key,Me,`${pe} stop domain type must match previous stop domain type ${h}`)]}else h=pe;if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new vt(te.key,Me,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&s!=="categorical"){let He=`number expected, ${pe} found`;return Hs(e)&&s===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new vt(te.key,Me,He)]}return s!=="categorical"||pe!=="number"||isFinite(Te)&&Math.floor(Te)===Te?s!=="categorical"&&pe==="number"&&m!==void 0&&Te<m?[new vt(te.key,Me,"stop domain values must appear in ascending order")]:(m=Te,s==="categorical"&&Te in x?[new vt(te.key,Me,"stop domain values must be unique")]:(x[Te]=!0,[])):[new vt(te.key,Me,`integer expected, found ${Te}`)]}}function Xs(i){const e=(i.expressionContext==="property"?pl:mo)(ns(i.value),i.valueSpec);if(e.result==="error")return e.value.map(h=>new vt(`${i.key}${h.key}`,i.value,h.message));const s=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!s.outputDefined())return[new vt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ya(s))return[new vt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ya(s))return[new vt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!js(s,["zoom","feature-state"]))return[new vt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!io(s))return[new vt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ys(i){const e=i.key,s=i.value,h=i.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(ur(s))===-1&&m.push(new vt(e,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(ur(s))===-1&&m.push(new vt(e,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function wl(i){return ml(ns(i.value))?Xs(Ki({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fc(i)}function Fc(i){const e=i.value,s=i.key;if(mi(e)!=="array")return[new vt(s,e,`array expected, ${mi(e)} found`)];const h=i.styleSpec;let m,b=[];if(e.length<1)return[new vt(s,e,"filter array must have at least 1 element")];switch(b=b.concat(ys({key:`${s}[0]`,value:e[0],valueSpec:h.filter_operator,style:i.style,styleSpec:i.styleSpec})),ur(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ur(e[1])==="$type"&&b.push(new vt(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&b.push(new vt(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(m=mi(e[1]),m!=="string"&&b.push(new vt(`${s}[1]`,e[1],`string expected, ${m} found`)));for(let x=2;x<e.length;x++)m=mi(e[x]),ur(e[1])==="$type"?b=b.concat(ys({key:`${s}[${x}]`,value:e[x],valueSpec:h.geometry_type,style:i.style,styleSpec:i.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&b.push(new vt(`${s}[${x}]`,e[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<e.length;x++)b=b.concat(Fc({key:`${s}[${x}]`,value:e[x],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":m=mi(e[1]),e.length!==2?b.push(new vt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):m!=="string"&&b.push(new vt(`${s}[1]`,e[1],`string expected, ${m} found`));break;case"within":m=mi(e[1]),e.length!==2?b.push(new vt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):m!=="object"&&b.push(new vt(`${s}[1]`,e[1],`object expected, ${m} found`))}return b}function Nc(i,e){const s=i.key,h=i.validateSpec,m=i.style,b=i.styleSpec,x=i.value,C=i.objectKey,M=b[`${e}_${i.layerType}`];if(!M)return[];const B=C.match(/^(.*)-transition$/);if(e==="paint"&&B&&M[B[1]]&&M[B[1]].transition)return h({key:s,value:x,valueSpec:b.transition,style:m,styleSpec:b});const U=i.valueSpec||M[C];if(!U)return[new vt(s,x,`unknown property "${C}"`)];let j;if(mi(x)==="string"&&Hs(U)&&!U.tokens&&(j=/^{([^}]+)}$/.exec(x)))return[new vt(s,x,`"${C}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const H=[];return i.layerType==="symbol"&&(C==="text-field"&&m&&!m.glyphs&&H.push(new vt(s,x,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&uo(ns(x))&&ur(x.type)==="identity"&&H.push(new vt(s,x,'"text-font" does not support identity functions'))),H.concat(h({key:i.key,value:x,valueSpec:U,style:m,styleSpec:b,expressionContext:"property",propertyType:e,propertyKey:C}))}function Uc(i){return Nc(i,"paint")}function Vc(i){return Nc(i,"layout")}function Ea(i){let e=[];const s=i.value,h=i.key,m=i.style,b=i.styleSpec;s.type||s.ref||e.push(new vt(h,s,'either "type" or "ref" is required'));let x=ur(s.type);const C=ur(s.ref);if(s.id){const M=ur(s.id);for(let B=0;B<i.arrayIndex;B++){const U=m.layers[B];ur(U.id)===M&&e.push(new vt(h,s.id,`duplicate layer id "${s.id}", previously used at line ${U.id.__line__}`))}}if("ref"in s){let M;["type","source","source-layer","filter","layout"].forEach(B=>{B in s&&e.push(new vt(h,s[B],`"${B}" is prohibited for ref layers`))}),m.layers.forEach(B=>{ur(B.id)===C&&(M=B)}),M?M.ref?e.push(new vt(h,s.ref,"ref cannot reference another ref layer")):x=ur(M.type):e.push(new vt(h,s.ref,`ref layer "${C}" not found`))}else if(x!=="background")if(s.source){const M=m.sources&&m.sources[s.source],B=M&&ur(M.type);M?B==="vector"&&x==="raster"?e.push(new vt(h,s.source,`layer "${s.id}" requires a raster source`)):B!=="raster-dem"&&x==="hillshade"?e.push(new vt(h,s.source,`layer "${s.id}" requires a raster-dem source`)):B==="raster"&&x!=="raster"?e.push(new vt(h,s.source,`layer "${s.id}" requires a vector source`)):B!=="vector"||s["source-layer"]?B==="raster-dem"&&x!=="hillshade"?e.push(new vt(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!s.paint||!s.paint["line-gradient"]||B==="geojson"&&M.lineMetrics||e.push(new vt(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new vt(h,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new vt(h,s.source,`source "${s.source}" not found`))}else e.push(new vt(h,s,'missing required property "source"'));return e=e.concat(Jr({key:h,value:s,valueSpec:b.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${h}.type`,value:s.type,valueSpec:b.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:s,objectKey:"type"}),filter:wl,layout:M=>Jr({layer:s,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":B=>Vc(Ki({layerType:x},B))}}),paint:M=>Jr({layer:s,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":B=>Uc(Ki({layerType:x},B))}})}})),e}function qn(i){const e=i.value,s=i.key,h=mi(e);return h!=="string"?[new vt(s,e,`string expected, ${h} found`)]:[]}const bn={promoteId:function({key:i,value:e}){if(mi(e)==="string")return qn({key:i,value:e});{const s=[];for(const h in e)s.push(...qn({key:`${i}.${h}`,value:e[h]}));return s}}};function Sa(i){const e=i.value,s=i.key,h=i.styleSpec,m=i.style,b=i.validateSpec;if(!e.type)return[new vt(s,e,'"type" is required')];const x=ur(e.type);let C;switch(x){case"vector":case"raster":return C=Jr({key:s,value:e,valueSpec:h[`source_${x.replace("-","_")}`],style:i.style,styleSpec:h,objectElementValidators:bn,validateSpec:b}),C;case"raster-dem":return C=function(M){var B;const U=(B=M.sourceName)!==null&&B!==void 0?B:"",j=M.value,H=M.styleSpec,te=H.source_raster_dem,re=M.style;let pe=[];const Te=mi(j);if(j===void 0)return pe;if(Te!=="object")return pe.push(new vt("source_raster_dem",j,`object expected, ${Te} found`)),pe;const Me=ur(j.encoding)==="custom",He=["redFactor","greenFactor","blueFactor","baseShift"],Be=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Ke in j)!Me&&He.includes(Ke)?pe.push(new vt(Ke,j[Ke],`In "${U}": "${Ke}" is only valid when "encoding" is set to "custom". ${Be} encoding found`)):te[Ke]?pe=pe.concat(M.validateSpec({key:Ke,value:j[Ke],valueSpec:te[Ke],validateSpec:M.validateSpec,style:re,styleSpec:H})):pe.push(new vt(Ke,j[Ke],`unknown property "${Ke}"`));return pe}({sourceName:s,value:e,style:i.style,styleSpec:h,validateSpec:b}),C;case"geojson":if(C=Jr({key:s,value:e,valueSpec:h.source_geojson,style:m,styleSpec:h,validateSpec:b,objectElementValidators:bn}),e.cluster)for(const M in e.clusterProperties){const[B,U]=e.clusterProperties[M],j=typeof B=="string"?[B,["accumulated"],["get",M]]:B;C.push(...Xs({key:`${s}.${M}.map`,value:U,validateSpec:b,expressionContext:"cluster-map"})),C.push(...Xs({key:`${s}.${M}.reduce`,value:j,validateSpec:b,expressionContext:"cluster-reduce"}))}return C;case"video":return Jr({key:s,value:e,valueSpec:h.source_video,style:m,validateSpec:b,styleSpec:h});case"image":return Jr({key:s,value:e,valueSpec:h.source_image,style:m,validateSpec:b,styleSpec:h});case"canvas":return[new vt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ys({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,validateSpec:b,styleSpec:h})}}function $c(i){const e=i.value,s=i.styleSpec,h=s.light,m=i.style;let b=[];const x=mi(e);if(e===void 0)return b;if(x!=="object")return b=b.concat([new vt("light",e,`object expected, ${x} found`)]),b;for(const C in e){const M=C.match(/^(.*)-transition$/);b=b.concat(M&&h[M[1]]&&h[M[1]].transition?i.validateSpec({key:C,value:e[C],valueSpec:s.transition,validateSpec:i.validateSpec,style:m,styleSpec:s}):h[C]?i.validateSpec({key:C,value:e[C],valueSpec:h[C],validateSpec:i.validateSpec,style:m,styleSpec:s}):[new vt(C,e[C],`unknown property "${C}"`)])}return b}function jc(i){const e=i.value,s=i.styleSpec,h=s.terrain,m=i.style;let b=[];const x=mi(e);if(e===void 0)return b;if(x!=="object")return b=b.concat([new vt("terrain",e,`object expected, ${x} found`)]),b;for(const C in e)b=b.concat(h[C]?i.validateSpec({key:C,value:e[C],valueSpec:h[C],validateSpec:i.validateSpec,style:m,styleSpec:s}):[new vt(C,e[C],`unknown property "${C}"`)]);return b}function qc(i){let e=[];const s=i.value,h=i.key;if(Array.isArray(s)){const m=[],b=[];for(const x in s)s[x].id&&m.includes(s[x].id)&&e.push(new vt(h,s,`all the sprites' ids must be unique, but ${s[x].id} is duplicated`)),m.push(s[x].id),s[x].url&&b.includes(s[x].url)&&e.push(new vt(h,s,`all the sprites' URLs must be unique, but ${s[x].url} is duplicated`)),b.push(s[x].url),e=e.concat(Jr({key:`${h}[${x}]`,value:s[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return qn({key:h,value:s})}const Js={"*":()=>[],array:wa,boolean:function(i){const e=i.value,s=i.key,h=mi(e);return h!=="boolean"?[new vt(s,e,`boolean expected, ${h} found`)]:[]},number:xa,color:function(i){const e=i.key,s=i.value,h=mi(s);return h!=="string"?[new vt(e,s,`color expected, ${h} found`)]:Ti.parse(String(s))?[]:[new vt(e,s,`color expected, "${s}" found`)]},constants:vl,enum:ys,filter:wl,function:bl,layer:Ea,object:Jr,source:Sa,light:$c,terrain:jc,string:qn,formatted:function(i){return qn(i).length===0?[]:Xs(i)},resolvedImage:function(i){return qn(i).length===0?[]:Xs(i)},padding:function(i){const e=i.key,s=i.value;if(mi(s)==="array"){if(s.length<1||s.length>4)return[new vt(e,s,`padding requires 1 to 4 values; ${s.length} values found`)];const h={type:"number"};let m=[];for(let b=0;b<s.length;b++)m=m.concat(i.validateSpec({key:`${e}[${b}]`,value:s[b],validateSpec:i.validateSpec,valueSpec:h}));return m}return xa({key:e,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,s=i.value,h=mi(s),m=i.styleSpec;if(h!=="array"||s.length<1||s.length%2!=0)return[new vt(e,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let x=0;x<s.length;x+=2)b=b.concat(ys({key:`${e}[${x}]`,value:s[x],valueSpec:m.layout_symbol["text-anchor"]})),b=b.concat(wa({key:`${e}[${x+1}]`,value:s[x+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:m}));return b},sprite:qc};function ka(i){const e=i.value,s=i.valueSpec,h=i.styleSpec;return i.validateSpec=ka,s.expression&&uo(ur(e))?bl(i):s.expression&&po(ns(e))?Xs(i):s.type&&Js[s.type]?Js[s.type](i):Jr(Ki({},i,{valueSpec:s.type?h[s.type]:s}))}function vo(i){const e=i.value,s=i.key,h=qn(i);return h.length||(e.indexOf("{fontstack}")===-1&&h.push(new vt(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&h.push(new vt(s,e,'"glyphs" url must include a "{range}" token'))),h}function Zn(i,e=ke){let s=[];return s=s.concat(ka({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:ka,objectElementValidators:{glyphs:vo,"*":()=>[]}})),i.constants&&(s=s.concat(vl({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:ka}))),Zc(s)}function On(i){return function(e){return i({...e,validateSpec:ka})}}function Zc(i){return[].concat(i).sort((e,s)=>e.line-s.line)}function wn(i){return function(...e){return Zc(i.apply(this,e))}}Zn.source=wn(On(Sa)),Zn.sprite=wn(On(qc)),Zn.glyphs=wn(On(vo)),Zn.light=wn(On($c)),Zn.terrain=wn(On(jc)),Zn.layer=wn(On(Ea)),Zn.filter=wn(On(wl)),Zn.paintProperty=wn(On(Uc)),Zn.layoutProperty=wn(On(Vc));const Ta=Zn,xl=Ta.light,Gc=Ta.paintProperty,El=Ta.layoutProperty;function Sl(i,e){let s=!1;if(e&&e.length)for(const h of e)i.fire(new Ne(new Error(h.message))),s=!0;return s}class Ys{constructor(e,s,h){const m=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const x=new Int32Array(this.arrayBuffer);e=x[0],this.d=(s=x[1])+2*(h=x[2]);for(let M=0;M<this.d*this.d;M++){const B=x[3+M],U=x[3+M+1];m.push(B===U?null:x.subarray(B,U))}const C=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],C),this.bboxes=x.subarray(C),this.insert=this._insertReadonly}else{this.d=s+2*h;for(let x=0;x<this.d*this.d;x++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=e,this.padding=h,this.scale=s/e,this.uid=0;const b=h/s*e;this.min=-b,this.max=e+b}insert(e,s,h,m,b){this._forEachCell(s,h,m,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,s,h,m,b,x){this.cells[b].push(x)}query(e,s,h,m,b){const x=this.min,C=this.max;if(e<=x&&s<=x&&C<=h&&C<=m&&!b)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(e,s,h,m,this._queryCell,M,{},b),M}}_queryCell(e,s,h,m,b,x,C,M){const B=this.cells[b];if(B!==null){const U=this.keys,j=this.bboxes;for(let H=0;H<B.length;H++){const te=B[H];if(C[te]===void 0){const re=4*te;(M?M(j[re+0],j[re+1],j[re+2],j[re+3]):e<=j[re+2]&&s<=j[re+3]&&h>=j[re+0]&&m>=j[re+1])?(C[te]=!0,x.push(U[te])):C[te]=!1}}}}_forEachCell(e,s,h,m,b,x,C,M){const B=this._convertToCellCoord(e),U=this._convertToCellCoord(s),j=this._convertToCellCoord(h),H=this._convertToCellCoord(m);for(let te=B;te<=j;te++)for(let re=U;re<=H;re++){const pe=this.d*re+te;if((!M||M(this._convertFromCellCoord(te),this._convertFromCellCoord(re),this._convertFromCellCoord(te+1),this._convertFromCellCoord(re+1)))&&b.call(this,e,s,h,m,pe,x,C,M))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,s=3+this.cells.length+1+1;let h=0;for(let x=0;x<this.cells.length;x++)h+=this.cells[x].length;const m=new Int32Array(s+h+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let b=s;for(let x=0;x<e.length;x++){const C=e[x];m[3+x]=b,m.set(C,b),b+=C.length}return m[3+e.length]=b,m.set(this.keys,b),b+=this.keys.length,m[3+e.length+1]=b,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer}static serialize(e,s){const h=e.toArrayBuffer();return s&&s.push(h),{buffer:h}}static deserialize(e){return new Ys(e.buffer)}}const vs={};function qt(i,e,s={}){if(vs[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),vs[i]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}qt("Object",Object),qt("TransferableGridIndex",Ys),qt("Color",Ti),qt("Error",Error),qt("AJAXError",It),qt("ResolvedImage",Mr),qt("StylePropertyFunction",va),qt("StyleExpression",dl,{omit:["_evaluator"]}),qt("ZoomDependentExpression",_o),qt("ZoomConstantExpression",go),qt("CompoundExpression",Mn,{omit:["_evaluate"]});for(const i in Zs)Zs[i]._classRegistryKey||qt(`Expression_${i}`,Zs[i]);function Ca(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Qs(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Ca(i)||at(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return e&&e.push(s.buffer),s}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const h of i)s.push(Qs(h,e));return s}if(typeof i=="object"){const s=i.constructor,h=s._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!vs[h])throw new Error(`${h} is not registered.`);const m=s.serialize?s.serialize(i,e):{};if(s.serialize){if(e&&m===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in i){if(!i.hasOwnProperty(b)||vs[h].omit.indexOf(b)>=0)continue;const x=i[b];m[b]=vs[h].shallow.indexOf(b)>=0?x:Qs(x,e)}i instanceof Error&&(m.message=i.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(m.$name=h),m}throw new Error("can't serialize object of type "+typeof i)}function Ia(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Ca(i)||at(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Ia);if(typeof i=="object"){const e=i.$name||"Object";if(!vs[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:s}=vs[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(i);const h=Object.create(s.prototype);for(const m of Object.keys(i)){if(m==="$name")continue;const b=i[m];h[m]=vs[e].shallow.indexOf(m)>=0?b:Ia(b)}return h}throw new Error("can't deserialize object of type "+typeof i)}class kl{constructor(){this.first=!0}update(e,s){const h=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=h,!0))}}const jt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Aa(i){for(const e of i)if(Tl(e.charCodeAt(0)))return!0;return!1}function gh(i){for(const e of i)if(!_h(e.charCodeAt(0)))return!1;return!0}function _h(i){return!(jt.Arabic(i)||jt["Arabic Supplement"](i)||jt["Arabic Extended-A"](i)||jt["Arabic Presentation Forms-A"](i)||jt["Arabic Presentation Forms-B"](i))}function Tl(i){return!(i!==746&&i!==747&&(i<4352||!(jt["Bopomofo Extended"](i)||jt.Bopomofo(i)||jt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||jt["CJK Compatibility Ideographs"](i)||jt["CJK Compatibility"](i)||jt["CJK Radicals Supplement"](i)||jt["CJK Strokes"](i)||!(!jt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||jt["CJK Unified Ideographs Extension A"](i)||jt["CJK Unified Ideographs"](i)||jt["Enclosed CJK Letters and Months"](i)||jt["Hangul Compatibility Jamo"](i)||jt["Hangul Jamo Extended-A"](i)||jt["Hangul Jamo Extended-B"](i)||jt["Hangul Jamo"](i)||jt["Hangul Syllables"](i)||jt.Hiragana(i)||jt["Ideographic Description Characters"](i)||jt.Kanbun(i)||jt["Kangxi Radicals"](i)||jt["Katakana Phonetic Extensions"](i)||jt.Katakana(i)&&i!==12540||!(!jt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!jt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||jt["Unified Canadian Aboriginal Syllabics"](i)||jt["Unified Canadian Aboriginal Syllabics Extended"](i)||jt["Vertical Forms"](i)||jt["Yijing Hexagram Symbols"](i)||jt["Yi Syllables"](i)||jt["Yi Radicals"](i))))}function Hc(i){return!(Tl(i)||function(e){return!!(jt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||jt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||jt["Letterlike Symbols"](e)||jt["Number Forms"](e)||jt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||jt["Control Pictures"](e)&&e!==9251||jt["Optical Character Recognition"](e)||jt["Enclosed Alphanumerics"](e)||jt["Geometric Shapes"](e)||jt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||jt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||jt["CJK Symbols and Punctuation"](e)||jt.Katakana(e)||jt["Private Use Area"](e)||jt["CJK Compatibility Forms"](e)||jt["Small Form Variants"](e)||jt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Cl(i){return i>=1424&&i<=2303||jt["Arabic Presentation Forms-A"](i)||jt["Arabic Presentation Forms-B"](i)}function yh(i,e){return!(!e&&Cl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||jt.Khmer(i))}function vh(i){for(const e of i)if(Cl(e.charCodeAt(0)))return!0;return!1}const Il="deferred",Al="loading",Pl="loaded";let zl=null,cn="unavailable",Fn=null;const Wc=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(cn="error"),zl&&zl(i)};function Pa(){Ml.fire(new me("pluginStateChange",{pluginStatus:cn,pluginURL:Fn}))}const Ml=new ht,Dl=function(){return cn},Ll=function(){if(cn!==Il||!Fn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");cn=Al,Pa(),Fn&&N({url:Fn},i=>{i?Wc(i):(cn=Pl,Pa())})},xn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>cn===Pl||xn.applyArabicShaping!=null,isLoading:()=>cn===Al,setState(i){if(!ft())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");cn=i.pluginStatus,Fn=i.pluginURL},isParsed(){if(!ft())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return xn.applyArabicShaping!=null&&xn.processBidirectionalText!=null&&xn.processStyledBidirectionalText!=null},getPluginURL(){if(!ft())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Fn}};class Qi{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kl,this.transition={})}isSupportedScript(e){return function(s,h){for(const m of s)if(!yh(m.charCodeAt(0),h))return!1;return!0}(e,xn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),h=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*s}}}class bo{constructor(e,s){this.property=e,this.value=s,this.expression=function(h,m){if(uo(h))return new va(h,m);if(po(h)){const b=pl(h,m);if(b.result==="error")throw new Error(b.value.map(x=>`${x.key}: ${x.message}`).join(", "));return b.value}{let b=h;return m.type==="color"&&typeof h=="string"?b=Ti.parse(h):m.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(h)&&(b=Er.parse(h)):b=zr.parse(h),{kind:"constant",evaluate:()=>b}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,h){return this.property.possiblyEvaluate(this,e,s,h)}}class Rl{constructor(e){this.property=e,this.value=new bo(e,void 0)}transitioned(e,s){return new Xc(this.property,this.value,s,ue({},e.transition,this.transition),e.now)}untransitioned(){return new Xc(this.property,this.value,null,{},0)}}class Kc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ae(this._values[e].value.value)}setValue(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Rl(this._values[e].property)),this._values[e].value=new bo(this._values[e].property,s===null?void 0:ae(s))}getTransition(e){return ae(this._values[e].transition)}setTransition(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Rl(this._values[e].property)),this._values[e].transition=ae(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(e[s]=h);const m=this.getTransition(s);m!==void 0&&(e[`${s}-transition`]=m)}return e}transitioned(e,s){const h=new Jc(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].transitioned(e,s._values[m]);return h}untransitioned(){const e=new Jc(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class Xc{constructor(e,s,h,m,b){this.property=e,this.value=s,this.begin=b+m.delay||0,this.end=this.begin+m.duration||0,e.specification.transition&&(m.delay||m.duration)&&(this.prior=h)}possiblyEvaluate(e,s,h){const m=e.now||0,b=this.value.possiblyEvaluate(e,s,h),x=this.prior;if(x){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return x.possiblyEvaluate(e,s,h);{const C=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(e,s,h),b,function(M){if(M<=0)return 0;if(M>=1)return 1;const B=M*M,U=B*M;return 4*(M<.5?U:3*(M-B)+U-.75)}(C))}}return b}}class Jc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,h){const m=new wo(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(e,s,h);return m}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ea{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return ae(this._values[e].value)}setValue(e,s){this._values[e]=new bo(this._values[e].property,s===null?void 0:ae(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(e[s]=h)}return e}possiblyEvaluate(e,s,h){const m=new wo(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(e,s,h);return m}}class Gn{constructor(e,s,h){this.property=e,this.value=s,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,h,m){return this.property.evaluate(this.value,this.parameters,e,s,h,m)}}class wo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ti{constructor(e){this.specification=e}possiblyEvaluate(e,s){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(s)}interpolate(e,s,h){const m=yn[this.specification.type];return m?m(e,s,h):e}}class hi{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,h,m){return new Gn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},h,m)}:e.expression,s)}interpolate(e,s,h){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new Gn(this,{kind:"constant",value:void 0},e.parameters);const m=yn[this.specification.type];if(m){const b=m(e.value.value,s.value.value,h);return new Gn(this,{kind:"constant",value:b},e.parameters)}return e}evaluate(e,s,h,m,b,x){return e.kind==="constant"?e.value:e.evaluate(s,h,m,b,x)}}class xo extends hi{possiblyEvaluate(e,s,h,m){if(e.value===void 0)return new Gn(this,{kind:"constant",value:void 0},s);if(e.expression.kind==="constant"){const b=e.expression.evaluate(s,null,{},h,m),x=e.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,C=this._calculate(x,x,x,s);return new Gn(this,{kind:"constant",value:C},s)}if(e.expression.kind==="camera"){const b=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new Gn(this,{kind:"constant",value:b},s)}return new Gn(this,e.expression,s)}evaluate(e,s,h,m,b,x){if(e.kind==="source"){const C=e.evaluate(s,h,m,b,x);return this._calculate(C,C,C,s)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},h,m),e.evaluate({zoom:Math.floor(s.zoom)},h,m),e.evaluate({zoom:Math.floor(s.zoom)+1},h,m),s):e.value}_calculate(e,s,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:h,to:s}}interpolate(e){return e}}class Bl{constructor(e){this.specification=e}possiblyEvaluate(e,s,h,m){if(e.value!==void 0){if(e.expression.kind==="constant"){const b=e.expression.evaluate(s,null,{},h,m);return this._calculate(b,b,b,s)}return this._calculate(e.expression.evaluate(new Qi(Math.floor(s.zoom-1),s)),e.expression.evaluate(new Qi(Math.floor(s.zoom),s)),e.expression.evaluate(new Qi(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:h,to:s}}interpolate(e){return e}}class Hn{constructor(e){this.specification=e}possiblyEvaluate(e,s,h,m){return!!e.expression.evaluate(s,null,{},h,m)}interpolate(){return!1}}class Yr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const m=this.defaultPropertyValues[s]=new bo(h,void 0),b=this.defaultTransitionablePropertyValues[s]=new Rl(h);this.defaultTransitioningPropertyValues[s]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}}}qt("DataDrivenProperty",hi),qt("DataConstantProperty",ti),qt("CrossFadedDataDrivenProperty",xo),qt("CrossFadedProperty",Bl),qt("ColorRampProperty",Hn);const Eo="-transition";class Nn extends ht{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new ea(s.layout)),s.paint)){this._transitionablePaint=new Kc(s.paint);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wo(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,h={}){s!=null&&this._validate(El,`layers.${this.id}.layout.${e}`,e,s,h)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return e.endsWith(Eo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,h={}){if(s!=null&&this._validate(Gc,`layers.${this.id}.paint.${e}`,e,s,h))return!1;if(e.endsWith(Eo))return this._transitionablePaint.setTransition(e.slice(0,-11),s||void 0),!1;{const m=this._transitionablePaint._values[e],b=m.property.specification["property-type"]==="cross-faded-data-driven",x=m.value.isDataDriven(),C=m.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const M=this._transitionablePaint._values[e].value;return M.isDataDriven()||x||b||this._handleOverridablePaintPropertyUpdate(e,C,M)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,s,h){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Xe(e,(s,h)=>!(s===void 0||h==="layout"&&!Object.keys(s).length||h==="paint"&&!Object.keys(s).length))}_validate(e,s,h,m,b={}){return(!b||b.validate!==!1)&&Sl(this,e.call(Ta,{key:s,layerType:this.type,objectKey:h,value:m,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof Gn&&Hs(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Ol={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class za{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function er(i,e=1){let s=0,h=0;return{members:i.map(m=>{const b=Ol[m.type].BYTES_PER_ELEMENT,x=s=Yc(s,Math.max(e,b)),C=m.components||1;return h=Math.max(h,b),s+=b*C,{name:m.name,type:m.type,components:C,offset:x}}),size:Yc(s,Math.max(h,e)),alignment:e}}function Yc(i,e){return Math.ceil(i/e)*e}class ta extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const m=2*e;return this.int16[m+0]=s,this.int16[m+1]=h,e}}ta.prototype.bytesPerElement=4,qt("StructArrayLayout2i4",ta);class bs extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,h)}emplace(e,s,h,m){const b=3*e;return this.int16[b+0]=s,this.int16[b+1]=h,this.int16[b+2]=m,e}}bs.prototype.bytesPerElement=6,qt("StructArrayLayout3i6",bs);class Fl extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,e,s,h,m)}emplace(e,s,h,m,b){const x=4*e;return this.int16[x+0]=s,this.int16[x+1]=h,this.int16[x+2]=m,this.int16[x+3]=b,e}}Fl.prototype.bytesPerElement=8,qt("StructArrayLayout4i8",Fl);class Nl extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b,x){const C=this.length;return this.resize(C+1),this.emplace(C,e,s,h,m,b,x)}emplace(e,s,h,m,b,x,C){const M=6*e;return this.int16[M+0]=s,this.int16[M+1]=h,this.int16[M+2]=m,this.int16[M+3]=b,this.int16[M+4]=x,this.int16[M+5]=C,e}}Nl.prototype.bytesPerElement=12,qt("StructArrayLayout2i4i12",Nl);class So extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b,x){const C=this.length;return this.resize(C+1),this.emplace(C,e,s,h,m,b,x)}emplace(e,s,h,m,b,x,C){const M=4*e,B=8*e;return this.int16[M+0]=s,this.int16[M+1]=h,this.uint8[B+4]=m,this.uint8[B+5]=b,this.uint8[B+6]=x,this.uint8[B+7]=C,e}}So.prototype.bytesPerElement=8,qt("StructArrayLayout2i4ub8",So);class Ma extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const m=2*e;return this.float32[m+0]=s,this.float32[m+1]=h,e}}Ma.prototype.bytesPerElement=8,qt("StructArrayLayout2f8",Ma);class Ul extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b,x,C,M,B,U){const j=this.length;return this.resize(j+1),this.emplace(j,e,s,h,m,b,x,C,M,B,U)}emplace(e,s,h,m,b,x,C,M,B,U,j){const H=10*e;return this.uint16[H+0]=s,this.uint16[H+1]=h,this.uint16[H+2]=m,this.uint16[H+3]=b,this.uint16[H+4]=x,this.uint16[H+5]=C,this.uint16[H+6]=M,this.uint16[H+7]=B,this.uint16[H+8]=U,this.uint16[H+9]=j,e}}Ul.prototype.bytesPerElement=20,qt("StructArrayLayout10ui20",Ul);class Vi extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b,x,C,M,B,U,j,H){const te=this.length;return this.resize(te+1),this.emplace(te,e,s,h,m,b,x,C,M,B,U,j,H)}emplace(e,s,h,m,b,x,C,M,B,U,j,H,te){const re=12*e;return this.int16[re+0]=s,this.int16[re+1]=h,this.int16[re+2]=m,this.int16[re+3]=b,this.uint16[re+4]=x,this.uint16[re+5]=C,this.uint16[re+6]=M,this.uint16[re+7]=B,this.int16[re+8]=U,this.int16[re+9]=j,this.int16[re+10]=H,this.int16[re+11]=te,e}}Vi.prototype.bytesPerElement=24,qt("StructArrayLayout4i4ui4i24",Vi);class y extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,h)}emplace(e,s,h,m){const b=3*e;return this.float32[b+0]=s,this.float32[b+1]=h,this.float32[b+2]=m,e}}y.prototype.bytesPerElement=12,qt("StructArrayLayout3f12",y);class t extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}t.prototype.bytesPerElement=4,qt("StructArrayLayout1ul4",t);class o extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b,x,C,M,B){const U=this.length;return this.resize(U+1),this.emplace(U,e,s,h,m,b,x,C,M,B)}emplace(e,s,h,m,b,x,C,M,B,U){const j=10*e,H=5*e;return this.int16[j+0]=s,this.int16[j+1]=h,this.int16[j+2]=m,this.int16[j+3]=b,this.int16[j+4]=x,this.int16[j+5]=C,this.uint32[H+3]=M,this.uint16[j+8]=B,this.uint16[j+9]=U,e}}o.prototype.bytesPerElement=20,qt("StructArrayLayout6i1ul2ui20",o);class p extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b,x){const C=this.length;return this.resize(C+1),this.emplace(C,e,s,h,m,b,x)}emplace(e,s,h,m,b,x,C){const M=6*e;return this.int16[M+0]=s,this.int16[M+1]=h,this.int16[M+2]=m,this.int16[M+3]=b,this.int16[M+4]=x,this.int16[M+5]=C,e}}p.prototype.bytesPerElement=12,qt("StructArrayLayout2i2i2i12",p);class _ extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,h,m,b)}emplace(e,s,h,m,b,x){const C=4*e,M=8*e;return this.float32[C+0]=s,this.float32[C+1]=h,this.float32[C+2]=m,this.int16[M+6]=b,this.int16[M+7]=x,e}}_.prototype.bytesPerElement=16,qt("StructArrayLayout2f1f2i16",_);class w extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,e,s,h,m)}emplace(e,s,h,m,b){const x=12*e,C=3*e;return this.uint8[x+0]=s,this.uint8[x+1]=h,this.float32[C+1]=m,this.float32[C+2]=b,e}}w.prototype.bytesPerElement=12,qt("StructArrayLayout2ub2f12",w);class I extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,h)}emplace(e,s,h,m){const b=3*e;return this.uint16[b+0]=s,this.uint16[b+1]=h,this.uint16[b+2]=m,e}}I.prototype.bytesPerElement=6,qt("StructArrayLayout3ui6",I);class P extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b,x,C,M,B,U,j,H,te,re,pe,Te,Me){const He=this.length;return this.resize(He+1),this.emplace(He,e,s,h,m,b,x,C,M,B,U,j,H,te,re,pe,Te,Me)}emplace(e,s,h,m,b,x,C,M,B,U,j,H,te,re,pe,Te,Me,He){const Be=24*e,Ke=12*e,nt=48*e;return this.int16[Be+0]=s,this.int16[Be+1]=h,this.uint16[Be+2]=m,this.uint16[Be+3]=b,this.uint32[Ke+2]=x,this.uint32[Ke+3]=C,this.uint32[Ke+4]=M,this.uint16[Be+10]=B,this.uint16[Be+11]=U,this.uint16[Be+12]=j,this.float32[Ke+7]=H,this.float32[Ke+8]=te,this.uint8[nt+36]=re,this.uint8[nt+37]=pe,this.uint8[nt+38]=Te,this.uint32[Ke+10]=Me,this.int16[Be+22]=He,e}}P.prototype.bytesPerElement=48,qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",P);class L extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,m,b,x,C,M,B,U,j,H,te,re,pe,Te,Me,He,Be,Ke,nt,_t,Nt,Kt,Ot,Rt,Mt,Zt){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,e,s,h,m,b,x,C,M,B,U,j,H,te,re,pe,Te,Me,He,Be,Ke,nt,_t,Nt,Kt,Ot,Rt,Mt,Zt)}emplace(e,s,h,m,b,x,C,M,B,U,j,H,te,re,pe,Te,Me,He,Be,Ke,nt,_t,Nt,Kt,Ot,Rt,Mt,Zt,Dt){const kt=32*e,ci=16*e;return this.int16[kt+0]=s,this.int16[kt+1]=h,this.int16[kt+2]=m,this.int16[kt+3]=b,this.int16[kt+4]=x,this.int16[kt+5]=C,this.int16[kt+6]=M,this.int16[kt+7]=B,this.uint16[kt+8]=U,this.uint16[kt+9]=j,this.uint16[kt+10]=H,this.uint16[kt+11]=te,this.uint16[kt+12]=re,this.uint16[kt+13]=pe,this.uint16[kt+14]=Te,this.uint16[kt+15]=Me,this.uint16[kt+16]=He,this.uint16[kt+17]=Be,this.uint16[kt+18]=Ke,this.uint16[kt+19]=nt,this.uint16[kt+20]=_t,this.uint16[kt+21]=Nt,this.uint16[kt+22]=Kt,this.uint32[ci+12]=Ot,this.float32[ci+13]=Rt,this.float32[ci+14]=Mt,this.uint16[kt+30]=Zt,this.uint16[kt+31]=Dt,e}}L.prototype.bytesPerElement=64,qt("StructArrayLayout8i15ui1ul2f2ui64",L);class O extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}O.prototype.bytesPerElement=4,qt("StructArrayLayout1f4",O);class V extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,h)}emplace(e,s,h,m){const b=3*e;return this.uint16[6*e+0]=s,this.float32[b+1]=h,this.float32[b+2]=m,e}}V.prototype.bytesPerElement=12,qt("StructArrayLayout1ui2f12",V);class $ extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,h)}emplace(e,s,h,m){const b=4*e;return this.uint32[2*e+0]=s,this.uint16[b+2]=h,this.uint16[b+3]=m,e}}$.prototype.bytesPerElement=8,qt("StructArrayLayout1ul2ui8",$);class Y extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const m=2*e;return this.uint16[m+0]=s,this.uint16[m+1]=h,e}}Y.prototype.bytesPerElement=4,qt("StructArrayLayout2ui4",Y);class ge extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}ge.prototype.bytesPerElement=2,qt("StructArrayLayout1ui2",ge);class de extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,m){const b=this.length;return this.resize(b+1),this.emplace(b,e,s,h,m)}emplace(e,s,h,m,b){const x=4*e;return this.float32[x+0]=s,this.float32[x+1]=h,this.float32[x+2]=m,this.float32[x+3]=b,e}}de.prototype.bytesPerElement=16,qt("StructArrayLayout4f16",de);class xe extends za{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}xe.prototype.size=20;class fe extends o{get(e){return new xe(this,e)}}qt("CollisionBoxArray",fe);class Ve extends za{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ve.prototype.size=48;class rt extends P{get(e){return new Ve(this,e)}}qt("PlacedSymbolArray",rt);class Ae extends za{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ae.prototype.size=64;class Ge extends L{get(e){return new Ae(this,e)}}qt("SymbolInstanceArray",Ge);class ot extends O{getoffsetX(e){return this.float32[1*e+0]}}qt("GlyphOffsetArray",ot);class lt extends bs{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}qt("SymbolLineVertexArray",lt);class pt extends za{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}pt.prototype.size=12;class St extends V{get(e){return new pt(this,e)}}qt("TextAnchorOffsetArray",St);class wt extends za{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}wt.prototype.size=8;class Pt extends ${get(e){return new wt(this,e)}}qt("FeatureIndexArray",Pt);class Wt extends ta{}class zi extends ta{}class Lt extends ta{}class fi extends Nl{}class Xt extends So{}class tr extends Ma{}class wi extends Ul{}class Ei extends Vi{}class Mi extends y{}class mr extends t{}class Wi extends p{}class Dn extends w{}class hr extends I{}class or extends Y{}const En=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wn}=En;class ir{constructor(e=[]){this.segments=e}prepareSegment(e,s,h,m){let b=this.segments[this.segments.length-1];return e>ir.MAX_VERTEX_ARRAY_LENGTH&&Z(`Max vertices per segment is ${ir.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!b||b.vertexLength+e>ir.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m)&&(b={vertexOffset:s.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},m!==void 0&&(b.sortKey=m),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,h,m){return new ir([{vertexOffset:e,primitiveOffset:s,vertexLength:h,primitiveLength:m,vaos:{},sortKey:0}])}}function ws(i,e){return 256*(i=ne(Math.floor(i),0,255))+ne(Math.floor(e),0,255)}ir.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt("SegmentVector",ir);const xs=er([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ss={exports:{}},Ms={exports:{}};Ms.exports=function(i,e){var s,h,m,b,x,C,M,B;for(h=i.length-(s=3&i.length),m=e,x=3432918353,C=461845907,B=0;B<h;)M=255&i.charCodeAt(B)|(255&i.charCodeAt(++B))<<8|(255&i.charCodeAt(++B))<<16|(255&i.charCodeAt(++B))<<24,++B,m=27492+(65535&(b=5*(65535&(m=(m^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(M=0,s){case 3:M^=(255&i.charCodeAt(B+2))<<16;case 2:M^=(255&i.charCodeAt(B+1))<<8;case 1:m^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(B)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var Qr=Ms.exports,$r={exports:{}};$r.exports=function(i,e){for(var s,h=i.length,m=e^h,b=0;h>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24))+((1540483477*(s>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),h-=4,++b;switch(h){case 3:m^=(255&i.charCodeAt(b+2))<<16;case 2:m^=(255&i.charCodeAt(b+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(b)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var Zr=Qr,Da=$r.exports;ss.exports=Zr,ss.exports.murmur3=Zr,ss.exports.murmur2=Da;var gr=v(ss.exports);class _r{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,h,m){this.ids.push(Sn(e)),this.positions.push(s,h,m)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Sn(e);let h=0,m=this.ids.length-1;for(;h<m;){const x=h+m>>1;this.ids[x]>=s?m=x:h=x+1}const b=[];for(;this.ids[h]===s;)b.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return b}static serialize(e,s){const h=new Float64Array(e.ids),m=new Uint32Array(e.positions);return yr(h,m,0,h.length-1),s&&s.push(h.buffer,m.buffer),{ids:h,positions:m}}static deserialize(e){const s=new _r;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function Sn(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:gr(String(i))}function yr(i,e,s,h){for(;s<h;){const m=i[s+h>>1];let b=s-1,x=h+1;for(;;){do b++;while(i[b]<m);do x--;while(i[x]>m);if(b>=x)break;ko(i,b,x),ko(e,3*b,3*x),ko(e,3*b+1,3*x+1),ko(e,3*b+2,3*x+2)}x-s<h-x?(yr(i,e,s,x),s=x+1):(yr(i,e,x+1,h),h=x)}}function ko(i,e,s){const h=i[e];i[e]=i[s],i[s]=h}qt("FeaturePositionMap",_r);class Ds{constructor(e,s){this.gl=e.gl,this.location=s}}class To extends Ds{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Qc extends Ds{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class eu extends Ds{constructor(e,s){super(e,s),this.current=Ti.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const bh=new Float32Array(16);function Es(i){return[ws(255*i.r,255*i.g),ws(255*i.b,255*i.a)]}class ia{constructor(e,s,h){this.value=e,this.uniformNames=s.map(m=>`u_${m}`),this.type=h}setUniform(e,s,h){e.set(h.constantOr(this.value))}getBinding(e,s,h){return this.type==="color"?new eu(e,s):new To(e,s)}}class Ls{constructor(e,s){this.uniformNames=s.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=e.tlbr}setUniform(e,s,h,m){const b=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&e.set(b)}getBinding(e,s,h){return h.substr(0,9)==="u_pattern"?new Qc(e,s):new To(e,s)}}class Kn{constructor(e,s,h,m){this.expression=e,this.type=h,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,s,h,m,b){const x=this.paintVertexArray.length,C=this.expression.evaluate(new Qi(0),s,{},m,[],b);this.paintVertexArray.resize(e),this._setPaintValue(x,e,C)}updatePaintArray(e,s,h,m){const b=this.expression.evaluate({zoom:0},h,m);this._setPaintValue(e,s,b)}_setPaintValue(e,s,h){if(this.type==="color"){const m=Es(h);for(let b=e;b<s;b++)this.paintVertexArray.emplace(b,m[0],m[1])}else{for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kn{constructor(e,s,h,m,b,x){this.expression=e,this.uniformNames=s.map(C=>`u_${C}_t`),this.type=h,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=s.map(C=>({name:`a_${C}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(e,s,h,m,b){const x=this.expression.evaluate(new Qi(this.zoom),s,{},m,[],b),C=this.expression.evaluate(new Qi(this.zoom+1),s,{},m,[],b),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,x,C)}updatePaintArray(e,s,h,m){const b=this.expression.evaluate({zoom:this.zoom},h,m),x=this.expression.evaluate({zoom:this.zoom+1},h,m);this._setPaintValue(e,s,b,x)}_setPaintValue(e,s,h,m){if(this.type==="color"){const b=Es(h),x=Es(m);for(let C=e;C<s;C++)this.paintVertexArray.emplace(C,b[0],b[1],x[0],x[1])}else{for(let b=e;b<s;b++)this.paintVertexArray.emplace(b,h,m);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(m))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=ne(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);e.set(m)}getBinding(e,s,h){return new To(e,s)}}class as{constructor(e,s,h,m,b,x){this.expression=e,this.type=s,this.useIntegerZoom=h,this.zoom=m,this.layerId=x,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(e,s,h){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(m,e,s.patterns&&s.patterns[this.layerId],h)}updatePaintArray(e,s,h,m,b){this._setPaintValues(e,s,h.patterns&&h.patterns[this.layerId],b)}_setPaintValues(e,s,h,m){if(!m||!h)return;const{min:b,mid:x,max:C}=h,M=m[b],B=m[x],U=m[C];if(M&&B&&U)for(let j=e;j<s;j++)this.zoomInPaintVertexArray.emplace(j,B.tl[0],B.tl[1],B.br[0],B.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],B.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,B.tl[0],B.tl[1],B.br[0],B.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],B.pixelRatio,U.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,xs.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,xs.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Co{constructor(e,s,h){this.binders={},this._buffers=[];const m=[];for(const b in e.paint._values){if(!h(b))continue;const x=e.paint.get(b);if(!(x instanceof Gn&&Hs(x.property.specification)))continue;const C=hy(b,e.type),M=x.value,B=x.property.specification.type,U=x.property.useIntegerZoom,j=x.property.specification["property-type"],H=j==="cross-faded"||j==="cross-faded-data-driven";if(M.kind==="constant")this.binders[b]=H?new Ls(M.value,C):new ia(M.value,C,B),m.push(`/u_${b}`);else if(M.kind==="source"||H){const te=bd(b,B,"source");this.binders[b]=H?new as(M,B,U,s,te,e.id):new Kn(M,C,B,te),m.push(`/a_${b}`)}else{const te=bd(b,B,"composite");this.binders[b]=new kn(M,C,B,U,s,te),m.push(`/z_${b}`)}}this.cacheKey=m.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Kn||s instanceof kn?s.maxValue:0}populatePaintArrays(e,s,h,m,b){for(const x in this.binders){const C=this.binders[x];(C instanceof Kn||C instanceof kn||C instanceof as)&&C.populatePaintArray(e,s,h,m,b)}}setConstantPatternPositions(e,s){for(const h in this.binders){const m=this.binders[h];m instanceof Ls&&m.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,h,m,b){let x=!1;for(const C in e){const M=s.getPositions(C);for(const B of M){const U=h.feature(B.index);for(const j in this.binders){const H=this.binders[j];if((H instanceof Kn||H instanceof kn||H instanceof as)&&H.expression.isStateDependent===!0){const te=m.paint.get(j);H.expression=te.value,H.updatePaintArray(B.start,B.end,U,e[C],b),x=!0}}}}return x}defines(){const e=[];for(const s in this.binders){const h=this.binders[s];(h instanceof ia||h instanceof Ls)&&e.push(...h.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Kn||h instanceof kn)for(let m=0;m<h.paintVertexAttributes.length;m++)e.push(h.paintVertexAttributes[m].name);else if(h instanceof as)for(let m=0;m<xs.members.length;m++)e.push(xs.members[m].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof ia||h instanceof Ls||h instanceof kn)for(const m of h.uniformNames)e.push(m)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const h=[];for(const m in this.binders){const b=this.binders[m];if(b instanceof ia||b instanceof Ls||b instanceof kn){for(const x of b.uniformNames)if(s[x]){const C=b.getBinding(e,s[x],x);h.push({name:x,property:m,binding:C})}}}return h}setUniforms(e,s,h,m){for(const{name:b,property:x,binding:C}of s)this.binders[x].setUniform(C,m,h.get(x),b)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const h=this.binders[s];if(e&&h instanceof as){const m=e.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(h instanceof Kn||h instanceof kn)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(e){for(const s in this.binders){const h=this.binders[s];(h instanceof Kn||h instanceof kn||h instanceof as)&&h.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Kn||s instanceof kn||s instanceof as)&&s.destroy()}}}class La{constructor(e,s,h=()=>!0){this.programConfigurations={};for(const m of e)this.programConfigurations[m.id]=new Co(m,s,h);this.needsUpload=!1,this._featureMap=new _r,this._bufferOffset=0}populatePaintArrays(e,s,h,m,b,x){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(e,s,m,b,x);s.id!==void 0&&this._featureMap.add(s.id,h,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,h,m){for(const b of h)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,s,b,m)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function hy(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function bd(i,e,s){const h={color:{source:Ma,composite:de},number:{source:O,composite:Ma}},m=function(b){return{"line-pattern":{source:wi,composite:wi},"fill-pattern":{source:wi,composite:wi},"fill-extrusion-pattern":{source:wi,composite:wi}}[b]}(i);return m&&m[s]||h[e][s]}qt("ConstantBinder",ia),qt("CrossFadedConstantBinder",Ls),qt("SourceExpressionBinder",Kn),qt("CrossFadedCompositeBinder",as),qt("CompositeExpressionBinder",kn),qt("ProgramConfiguration",Co,{omit:["_buffers"]}),qt("ProgramConfigurationSet",La);const Sr=8192,wh=Math.pow(2,14)-1,wd=-wh-1;function Ra(i){const e=Sr/i.extent,s=i.loadGeometry();for(let h=0;h<s.length;h++){const m=s[h];for(let b=0;b<m.length;b++){const x=m[b],C=Math.round(x.x*e),M=Math.round(x.y*e);x.x=ne(C,wd,wh),x.y=ne(M,wd,wh),(C<x.x||C>x.x+1||M<x.y||M>x.y+1)&&Z("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Ba(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ra(i):[]}}function tu(i,e,s,h,m){i.emplaceBack(2*e+(h+1)/2,2*s+(m+1)/2)}class xh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new zi,this.indexArray=new hr,this.segments=new ir,this.programConfigurations=new La(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){const m=this.layers[0],b=[];let x=null,C=!1;m.type==="circle"&&(x=m.layout.get("circle-sort-key"),C=!x.isConstant());for(const{feature:M,id:B,index:U,sourceLayerIndex:j}of e){const H=this.layers[0]._featureFilter.needGeometry,te=Ba(M,H);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),te,h))continue;const re=C?x.evaluate(te,{},h):void 0,pe={id:B,properties:M.properties,type:M.type,sourceLayerIndex:j,index:U,geometry:H?te.geometry:Ra(M),patterns:{},sortKey:re};b.push(pe)}C&&b.sort((M,B)=>M.sortKey-B.sortKey);for(const M of b){const{geometry:B,index:U,sourceLayerIndex:j}=M,H=e[U].feature;this.addFeature(M,B,U,h),s.featureIndex.insert(H,B,U,j,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,h,m){for(const b of s)for(const x of b){const C=x.x,M=x.y;if(C<0||C>=Sr||M<0||M>=Sr)continue;const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=B.vertexLength;tu(this.layoutVertexArray,C,M,-1,-1),tu(this.layoutVertexArray,C,M,1,-1),tu(this.layoutVertexArray,C,M,1,1),tu(this.layoutVertexArray,C,M,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,{},m)}}function xd(i,e){for(let s=0;s<i.length;s++)if(Io(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(Io(i,e[s]))return!0;return!!Eh(i,e)}function fy(i,e,s){return!!Io(i,e)||!!Sh(e,i,s)}function Ed(i,e){if(i.length===1)return kd(e,i[0]);for(let s=0;s<e.length;s++){const h=e[s];for(let m=0;m<h.length;m++)if(Io(i,h[m]))return!0}for(let s=0;s<i.length;s++)if(kd(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(Eh(i,e[s]))return!0;return!1}function dy(i,e,s){if(i.length>1){if(Eh(i,e))return!0;for(let h=0;h<e.length;h++)if(Sh(e[h],i,s))return!0}for(let h=0;h<i.length;h++)if(Sh(i[h],e,s))return!0;return!1}function Eh(i,e){if(i.length===0||e.length===0)return!1;for(let s=0;s<i.length-1;s++){const h=i[s],m=i[s+1];for(let b=0;b<e.length-1;b++)if(py(h,m,e[b],e[b+1]))return!0}return!1}function py(i,e,s,h){return tt(i,s,h)!==tt(e,s,h)&&tt(i,e,s)!==tt(i,e,h)}function Sh(i,e,s){const h=s*s;if(e.length===1)return i.distSqr(e[0])<h;for(let m=1;m<e.length;m++)if(Sd(i,e[m-1],e[m])<h)return!0;return!1}function Sd(i,e,s){const h=e.distSqr(s);if(h===0)return i.distSqr(e);const m=((i.x-e.x)*(s.x-e.x)+(i.y-e.y)*(s.y-e.y))/h;return i.distSqr(m<0?e:m>1?s:s.sub(e)._mult(m)._add(e))}function kd(i,e){let s,h,m,b=!1;for(let x=0;x<i.length;x++){s=i[x];for(let C=0,M=s.length-1;C<s.length;M=C++)h=s[C],m=s[M],h.y>e.y!=m.y>e.y&&e.x<(m.x-h.x)*(e.y-h.y)/(m.y-h.y)+h.x&&(b=!b)}return b}function Io(i,e){let s=!1;for(let h=0,m=i.length-1;h<i.length;m=h++){const b=i[h],x=i[m];b.y>e.y!=x.y>e.y&&e.x<(x.x-b.x)*(e.y-b.y)/(x.y-b.y)+b.x&&(s=!s)}return s}function my(i,e,s){const h=s[0],m=s[2];if(i.x<h.x&&e.x<h.x||i.x>m.x&&e.x>m.x||i.y<h.y&&e.y<h.y||i.y>m.y&&e.y>m.y)return!1;const b=tt(i,e,s[0]);return b!==tt(i,e,s[1])||b!==tt(i,e,s[2])||b!==tt(i,e,s[3])}function Vl(i,e,s){const h=e.paint.get(i).value;return h.kind==="constant"?h.value:s.programConfigurations.get(e.id).getMaxValue(i)}function iu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ru(i,e,s,h,m){if(!e[0]&&!e[1])return i;const b=T.convert(e)._mult(m);s==="viewport"&&b._rotate(-h);const x=[];for(let C=0;C<i.length;C++)x.push(i[C].sub(b));return x}let Td,Cd;qt("CircleBucket",xh,{omit:["layers"]});var gy={get paint(){return Cd=Cd||new Yr({"circle-radius":new hi(ke.paint_circle["circle-radius"]),"circle-color":new hi(ke.paint_circle["circle-color"]),"circle-blur":new hi(ke.paint_circle["circle-blur"]),"circle-opacity":new hi(ke.paint_circle["circle-opacity"]),"circle-translate":new ti(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new ti(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ti(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ti(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hi(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hi(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hi(ke.paint_circle["circle-stroke-opacity"])})},get layout(){return Td=Td||new Yr({"circle-sort-key":new hi(ke.layout_circle["circle-sort-key"])})}},un=1e-6,Ao=typeof Float32Array<"u"?Float32Array:Array;function kh(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Id(i,e,s){var h=e[0],m=e[1],b=e[2],x=e[3],C=e[4],M=e[5],B=e[6],U=e[7],j=e[8],H=e[9],te=e[10],re=e[11],pe=e[12],Te=e[13],Me=e[14],He=e[15],Be=s[0],Ke=s[1],nt=s[2],_t=s[3];return i[0]=Be*h+Ke*C+nt*j+_t*pe,i[1]=Be*m+Ke*M+nt*H+_t*Te,i[2]=Be*b+Ke*B+nt*te+_t*Me,i[3]=Be*x+Ke*U+nt*re+_t*He,i[4]=(Be=s[4])*h+(Ke=s[5])*C+(nt=s[6])*j+(_t=s[7])*pe,i[5]=Be*m+Ke*M+nt*H+_t*Te,i[6]=Be*b+Ke*B+nt*te+_t*Me,i[7]=Be*x+Ke*U+nt*re+_t*He,i[8]=(Be=s[8])*h+(Ke=s[9])*C+(nt=s[10])*j+(_t=s[11])*pe,i[9]=Be*m+Ke*M+nt*H+_t*Te,i[10]=Be*b+Ke*B+nt*te+_t*Me,i[11]=Be*x+Ke*U+nt*re+_t*He,i[12]=(Be=s[12])*h+(Ke=s[13])*C+(nt=s[14])*j+(_t=s[15])*pe,i[13]=Be*m+Ke*M+nt*H+_t*Te,i[14]=Be*b+Ke*B+nt*te+_t*Me,i[15]=Be*x+Ke*U+nt*re+_t*He,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var $l,_y=Id;function nu(i,e,s){var h=e[0],m=e[1],b=e[2],x=e[3];return i[0]=s[0]*h+s[4]*m+s[8]*b+s[12]*x,i[1]=s[1]*h+s[5]*m+s[9]*b+s[13]*x,i[2]=s[2]*h+s[6]*m+s[10]*b+s[14]*x,i[3]=s[3]*h+s[7]*m+s[11]*b+s[15]*x,i}$l=new Ao(4),Ao!=Float32Array&&($l[0]=0,$l[1]=0,$l[2]=0,$l[3]=0);class yy extends Nn{constructor(e){super(e,gy)}createBucket(e){return new xh(e)}queryRadius(e){const s=e;return Vl("circle-radius",this,s)+Vl("circle-stroke-width",this,s)+iu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,s,h,m,b,x,C,M){const B=ru(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,C),U=this.paint.get("circle-radius").evaluate(s,h)+this.paint.get("circle-stroke-width").evaluate(s,h),j=this.paint.get("circle-pitch-alignment")==="map",H=j?B:function(re,pe){return re.map(Te=>Ad(Te,pe))}(B,M),te=j?U*C:U;for(const re of m)for(const pe of re){const Te=j?pe:Ad(pe,M);let Me=te;const He=nu([],[pe.x,pe.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Me*=He[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Me*=x.cameraToCenterDistance/He[3]),fy(H,Te,Me))return!0}return!1}}function Ad(i,e){const s=nu([],[i.x,i.y,0,1],e);return new T(s[0]/s[3],s[1]/s[3])}class Pd extends xh{}let zd;qt("HeatmapBucket",Pd,{omit:["layers"]});var vy={get paint(){return zd=zd||new Yr({"heatmap-radius":new hi(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hi(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ti(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hn(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ti(ke.paint_heatmap["heatmap-opacity"])})}};function Th(i,{width:e,height:s},h,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==e*s*h)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${e*s*h}`)}else m=new Uint8Array(e*s*h);return i.width=e,i.height=s,i.data=m,i}function Md(i,{width:e,height:s},h){if(e===i.width&&s===i.height)return;const m=Th({},{width:e,height:s},h);Ch(i,m,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,s)},h),i.width=e,i.height=s,i.data=m.data}function Ch(i,e,s,h,m,b){if(m.width===0||m.height===0)return e;if(m.width>i.width||m.height>i.height||s.x>i.width-m.width||s.y>i.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>e.width||m.height>e.height||h.x>e.width-m.width||h.y>e.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=i.data,C=e.data;if(x===C)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<m.height;M++){const B=((s.y+M)*i.width+s.x)*b,U=((h.y+M)*e.width+h.x)*b;for(let j=0;j<m.width*b;j++)C[U+j]=x[B+j]}return e}class jl{constructor(e,s){Th(this,e,1,s)}resize(e){Md(this,e,1)}clone(){return new jl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,h,m,b){Ch(e,s,h,m,b,1)}}class Un{constructor(e,s){Th(this,e,4,s)}resize(e){Md(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Un({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,h,m,b){Ch(e,s,h,m,b,4)}}function Dd(i){const e={},s=i.resolution||256,h=i.clips?i.clips.length:1,m=i.image||new Un({width:s,height:h});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const b=(x,C,M)=>{e[i.evaluationKey]=M;const B=i.expression.evaluate(e);m.data[x+C+0]=Math.floor(255*B.r/B.a),m.data[x+C+1]=Math.floor(255*B.g/B.a),m.data[x+C+2]=Math.floor(255*B.b/B.a),m.data[x+C+3]=Math.floor(255*B.a)};if(i.clips)for(let x=0,C=0;x<h;++x,C+=4*s)for(let M=0,B=0;M<s;M++,B+=4){const U=M/(s-1),{start:j,end:H}=i.clips[x];b(C,B,j*(1-U)+H*U)}else for(let x=0,C=0;x<s;x++,C+=4)b(0,C,x/(s-1));return m}qt("AlphaImage",jl),qt("RGBAImage",Un);class by extends Nn{createBucket(e){return new Pd(e)}constructor(e){super(e,vy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Ld;var wy={get paint(){return Ld=Ld||new Yr({"hillshade-illumination-direction":new ti(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ti(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ti(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ti(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ti(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ti(ke.paint_hillshade["hillshade-accent-color"])})}};class xy extends Nn{constructor(e){super(e,wy)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Ey=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sy}=Ey;var Ih={exports:{}};function su(i,e,s){s=s||2;var h,m,b,x,C,M,B,U=e&&e.length,j=U?e[0]*s:i.length,H=Rd(i,0,j,s,!0),te=[];if(!H||H.next===H.prev)return te;if(U&&(H=function(pe,Te,Me,He){var Be,Ke,nt,_t=[];for(Be=0,Ke=Te.length;Be<Ke;Be++)(nt=Rd(pe,Te[Be]*He,Be<Ke-1?Te[Be+1]*He:pe.length,He,!1))===nt.next&&(nt.steiner=!0),_t.push(My(nt));for(_t.sort(Ay),Be=0;Be<_t.length;Be++)Me=Py(_t[Be],Me);return Me}(i,e,H,s)),i.length>80*s){h=b=i[0],m=x=i[1];for(var re=s;re<j;re+=s)(C=i[re])<h&&(h=C),(M=i[re+1])<m&&(m=M),C>b&&(b=C),M>x&&(x=M);B=(B=Math.max(b-h,x-m))!==0?32767/B:0}return ql(H,te,s,h,m,B,0),te}function Rd(i,e,s,h,m){var b,x;if(m===zh(i,e,s,h)>0)for(b=e;b<s;b+=h)x=Fd(b,i[b],i[b+1],x);else for(b=s-h;b>=e;b-=h)x=Fd(b,i[b],i[b+1],x);return x&&au(x,x.next)&&(Gl(x),x=x.next),x}function Oa(i,e){if(!i)return i;e||(e=i);var s,h=i;do if(s=!1,h.steiner||!au(h,h.next)&&vr(h.prev,h,h.next)!==0)h=h.next;else{if(Gl(h),(h=e=h.prev)===h.next)break;s=!0}while(s||h!==e);return e}function ql(i,e,s,h,m,b,x){if(i){!x&&b&&function(U,j,H,te){var re=U;do re.z===0&&(re.z=Ah(re.x,re.y,j,H,te)),re.prevZ=re.prev,re.nextZ=re.next,re=re.next;while(re!==U);re.prevZ.nextZ=null,re.prevZ=null,function(pe){var Te,Me,He,Be,Ke,nt,_t,Nt,Kt=1;do{for(Me=pe,pe=null,Ke=null,nt=0;Me;){for(nt++,He=Me,_t=0,Te=0;Te<Kt&&(_t++,He=He.nextZ);Te++);for(Nt=Kt;_t>0||Nt>0&&He;)_t!==0&&(Nt===0||!He||Me.z<=He.z)?(Be=Me,Me=Me.nextZ,_t--):(Be=He,He=He.nextZ,Nt--),Ke?Ke.nextZ=Be:pe=Be,Be.prevZ=Ke,Ke=Be;Me=He}Ke.nextZ=null,Kt*=2}while(nt>1)}(re)}(i,h,m,b);for(var C,M,B=i;i.prev!==i.next;)if(C=i.prev,M=i.next,b?Ty(i,h,m,b):ky(i))e.push(C.i/s|0),e.push(i.i/s|0),e.push(M.i/s|0),Gl(i),i=M.next,B=M.next;else if((i=M)===B){x?x===1?ql(i=Cy(Oa(i),e,s),e,s,h,m,b,2):x===2&&Iy(i,e,s,h,m,b):ql(Oa(i),e,s,h,m,b,1);break}}}function ky(i){var e=i.prev,s=i,h=i.next;if(vr(e,s,h)>=0)return!1;for(var m=e.x,b=s.x,x=h.x,C=e.y,M=s.y,B=h.y,U=m<b?m<x?m:x:b<x?b:x,j=C<M?C<B?C:B:M<B?M:B,H=m>b?m>x?m:x:b>x?b:x,te=C>M?C>B?C:B:M>B?M:B,re=h.next;re!==e;){if(re.x>=U&&re.x<=H&&re.y>=j&&re.y<=te&&Po(m,C,b,M,x,B,re.x,re.y)&&vr(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function Ty(i,e,s,h){var m=i.prev,b=i,x=i.next;if(vr(m,b,x)>=0)return!1;for(var C=m.x,M=b.x,B=x.x,U=m.y,j=b.y,H=x.y,te=C<M?C<B?C:B:M<B?M:B,re=U<j?U<H?U:H:j<H?j:H,pe=C>M?C>B?C:B:M>B?M:B,Te=U>j?U>H?U:H:j>H?j:H,Me=Ah(te,re,e,s,h),He=Ah(pe,Te,e,s,h),Be=i.prevZ,Ke=i.nextZ;Be&&Be.z>=Me&&Ke&&Ke.z<=He;){if(Be.x>=te&&Be.x<=pe&&Be.y>=re&&Be.y<=Te&&Be!==m&&Be!==x&&Po(C,U,M,j,B,H,Be.x,Be.y)&&vr(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Ke.x>=te&&Ke.x<=pe&&Ke.y>=re&&Ke.y<=Te&&Ke!==m&&Ke!==x&&Po(C,U,M,j,B,H,Ke.x,Ke.y)&&vr(Ke.prev,Ke,Ke.next)>=0))return!1;Ke=Ke.nextZ}for(;Be&&Be.z>=Me;){if(Be.x>=te&&Be.x<=pe&&Be.y>=re&&Be.y<=Te&&Be!==m&&Be!==x&&Po(C,U,M,j,B,H,Be.x,Be.y)&&vr(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Ke&&Ke.z<=He;){if(Ke.x>=te&&Ke.x<=pe&&Ke.y>=re&&Ke.y<=Te&&Ke!==m&&Ke!==x&&Po(C,U,M,j,B,H,Ke.x,Ke.y)&&vr(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.nextZ}return!0}function Cy(i,e,s){var h=i;do{var m=h.prev,b=h.next.next;!au(m,b)&&Bd(m,h,h.next,b)&&Zl(m,b)&&Zl(b,m)&&(e.push(m.i/s|0),e.push(h.i/s|0),e.push(b.i/s|0),Gl(h),Gl(h.next),h=i=b),h=h.next}while(h!==i);return Oa(h)}function Iy(i,e,s,h,m,b){var x=i;do{for(var C=x.next.next;C!==x.prev;){if(x.i!==C.i&&Dy(x,C)){var M=Od(x,C);return x=Oa(x,x.next),M=Oa(M,M.next),ql(x,e,s,h,m,b,0),void ql(M,e,s,h,m,b,0)}C=C.next}x=x.next}while(x!==i)}function Ay(i,e){return i.x-e.x}function Py(i,e){var s=function(m,b){var x,C=b,M=m.x,B=m.y,U=-1/0;do{if(B<=C.y&&B>=C.next.y&&C.next.y!==C.y){var j=C.x+(B-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(j<=M&&j>U&&(U=j,x=C.x<C.next.x?C:C.next,j===M))return x}C=C.next}while(C!==b);if(!x)return null;var H,te=x,re=x.x,pe=x.y,Te=1/0;C=x;do M>=C.x&&C.x>=re&&M!==C.x&&Po(B<pe?M:U,B,re,pe,B<pe?U:M,B,C.x,C.y)&&(H=Math.abs(B-C.y)/(M-C.x),Zl(C,m)&&(H<Te||H===Te&&(C.x>x.x||C.x===x.x&&zy(x,C)))&&(x=C,Te=H)),C=C.next;while(C!==te);return x}(i,e);if(!s)return e;var h=Od(s,i);return Oa(h,h.next),Oa(s,s.next)}function zy(i,e){return vr(i.prev,i,e.prev)<0&&vr(e.next,i,i.next)<0}function Ah(i,e,s,h,m){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-h)*m|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function My(i){var e=i,s=i;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==i);return s}function Po(i,e,s,h,m,b,x,C){return(m-x)*(e-C)>=(i-x)*(b-C)&&(i-x)*(h-C)>=(s-x)*(e-C)&&(s-x)*(b-C)>=(m-x)*(h-C)}function Dy(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(s,h){var m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==h.i&&m.next.i!==h.i&&Bd(m,m.next,s,h))return!0;m=m.next}while(m!==s);return!1}(i,e)&&(Zl(i,e)&&Zl(e,i)&&function(s,h){var m=s,b=!1,x=(s.x+h.x)/2,C=(s.y+h.y)/2;do m.y>C!=m.next.y>C&&m.next.y!==m.y&&x<(m.next.x-m.x)*(C-m.y)/(m.next.y-m.y)+m.x&&(b=!b),m=m.next;while(m!==s);return b}(i,e)&&(vr(i.prev,i,e.prev)||vr(i,e.prev,e))||au(i,e)&&vr(i.prev,i,i.next)>0&&vr(e.prev,e,e.next)>0)}function vr(i,e,s){return(e.y-i.y)*(s.x-e.x)-(e.x-i.x)*(s.y-e.y)}function au(i,e){return i.x===e.x&&i.y===e.y}function Bd(i,e,s,h){var m=lu(vr(i,e,s)),b=lu(vr(i,e,h)),x=lu(vr(s,h,i)),C=lu(vr(s,h,e));return m!==b&&x!==C||!(m!==0||!ou(i,s,e))||!(b!==0||!ou(i,h,e))||!(x!==0||!ou(s,i,h))||!(C!==0||!ou(s,e,h))}function ou(i,e,s){return e.x<=Math.max(i.x,s.x)&&e.x>=Math.min(i.x,s.x)&&e.y<=Math.max(i.y,s.y)&&e.y>=Math.min(i.y,s.y)}function lu(i){return i>0?1:i<0?-1:0}function Zl(i,e){return vr(i.prev,i,i.next)<0?vr(i,e,i.next)>=0&&vr(i,i.prev,e)>=0:vr(i,e,i.prev)<0||vr(i,i.next,e)<0}function Od(i,e){var s=new Ph(i.i,i.x,i.y),h=new Ph(e.i,e.x,e.y),m=i.next,b=e.prev;return i.next=e,e.prev=i,s.next=m,m.prev=s,h.next=s,s.prev=h,b.next=h,h.prev=b,h}function Fd(i,e,s,h){var m=new Ph(i,e,s);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function Gl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ph(i,e,s){this.i=i,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zh(i,e,s,h){for(var m=0,b=e,x=s-h;b<s;b+=h)m+=(i[x]-i[b])*(i[b+1]+i[x+1]),x=b;return m}Ih.exports=su,Ih.exports.default=su,su.deviation=function(i,e,s,h){var m=e&&e.length,b=Math.abs(zh(i,0,m?e[0]*s:i.length,s));if(m)for(var x=0,C=e.length;x<C;x++)b-=Math.abs(zh(i,e[x]*s,x<C-1?e[x+1]*s:i.length,s));var M=0;for(x=0;x<h.length;x+=3){var B=h[x]*s,U=h[x+1]*s,j=h[x+2]*s;M+=Math.abs((i[B]-i[j])*(i[U+1]-i[B+1])-(i[B]-i[U])*(i[j+1]-i[B+1]))}return b===0&&M===0?0:Math.abs((M-b)/b)},su.flatten=function(i){for(var e=i[0][0].length,s={vertices:[],holes:[],dimensions:e},h=0,m=0;m<i.length;m++){for(var b=0;b<i[m].length;b++)for(var x=0;x<e;x++)s.vertices.push(i[m][b][x]);m>0&&s.holes.push(h+=i[m-1].length)}return s};var Nd=v(Ih.exports);function Ly(i,e,s,h,m){Ud(i,e,s||0,h||i.length-1,m||Ry)}function Ud(i,e,s,h,m){for(;h>s;){if(h-s>600){var b=h-s+1,x=e-s+1,C=Math.log(b),M=.5*Math.exp(2*C/3),B=.5*Math.sqrt(C*M*(b-M)/b)*(x-b/2<0?-1:1);Ud(i,e,Math.max(s,Math.floor(e-x*M/b+B)),Math.min(h,Math.floor(e+(b-x)*M/b+B)),m)}var U=i[e],j=s,H=h;for(Hl(i,s,e),m(i[h],U)>0&&Hl(i,s,h);j<H;){for(Hl(i,j,H),j++,H--;m(i[j],U)<0;)j++;for(;m(i[H],U)>0;)H--}m(i[s],U)===0?Hl(i,s,H):Hl(i,++H,h),H<=e&&(s=H+1),e<=H&&(h=H-1)}}function Hl(i,e,s){var h=i[e];i[e]=i[s],i[s]=h}function Ry(i,e){return i<e?-1:i>e?1:0}function Mh(i,e){const s=i.length;if(s<=1)return[i];const h=[];let m,b;for(let x=0;x<s;x++){const C=$t(i[x]);C!==0&&(i[x].area=Math.abs(C),b===void 0&&(b=C<0),b===C<0?(m&&h.push(m),m=[i[x]]):m.push(i[x]))}if(m&&h.push(m),e>1)for(let x=0;x<h.length;x++)h[x].length<=e||(Ly(h[x],e,1,h[x].length-1,By),h[x]=h[x].slice(0,e));return h}function By(i,e){return e.area-i.area}function Dh(i,e,s){const h=s.patternDependencies;let m=!1;for(const b of e){const x=b.paint.get(`${i}-pattern`);x.isConstant()||(m=!0);const C=x.constantOr(null);C&&(m=!0,h[C.to]=!0,h[C.from]=!0)}return m}function Lh(i,e,s,h,m){const b=m.patternDependencies;for(const x of e){const C=x.paint.get(`${i}-pattern`).value;if(C.kind!=="constant"){let M=C.evaluate({zoom:h-1},s,{},m.availableImages),B=C.evaluate({zoom:h},s,{},m.availableImages),U=C.evaluate({zoom:h+1},s,{},m.availableImages);M=M&&M.name?M.name:M,B=B&&B.name?B.name:B,U=U&&U.name?U.name:U,b[M]=!0,b[B]=!0,b[U]=!0,s.patterns[x.id]={min:M,mid:B,max:U}}}return s}class Rh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Lt,this.indexArray=new hr,this.indexArray2=new or,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new ir,this.segments2=new ir,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.hasPattern=Dh("fill",this.layers,s);const m=this.layers[0].layout.get("fill-sort-key"),b=!m.isConstant(),x=[];for(const{feature:C,id:M,index:B,sourceLayerIndex:U}of e){const j=this.layers[0]._featureFilter.needGeometry,H=Ba(C,j);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),H,h))continue;const te=b?m.evaluate(H,{},h,s.availableImages):void 0,re={id:M,properties:C.properties,type:C.type,sourceLayerIndex:U,index:B,geometry:j?H.geometry:Ra(C),patterns:{},sortKey:te};x.push(re)}b&&x.sort((C,M)=>C.sortKey-M.sortKey);for(const C of x){const{geometry:M,index:B,sourceLayerIndex:U}=C;if(this.hasPattern){const j=Lh("fill",this.layers,C,this.zoom,s);this.patternFeatures.push(j)}else this.addFeature(C,M,B,h,{});s.featureIndex.insert(e[B].feature,M,B,U,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}addFeatures(e,s,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sy),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,h,m,b){for(const x of Mh(s,500)){let C=0;for(const te of x)C+=te.length;const M=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),B=M.vertexLength,U=[],j=[];for(const te of x){if(te.length===0)continue;te!==x[0]&&j.push(U.length/2);const re=this.segments2.prepareSegment(te.length,this.layoutVertexArray,this.indexArray2),pe=re.vertexLength;this.layoutVertexArray.emplaceBack(te[0].x,te[0].y),this.indexArray2.emplaceBack(pe+te.length-1,pe),U.push(te[0].x),U.push(te[0].y);for(let Te=1;Te<te.length;Te++)this.layoutVertexArray.emplaceBack(te[Te].x,te[Te].y),this.indexArray2.emplaceBack(pe+Te-1,pe+Te),U.push(te[Te].x),U.push(te[Te].y);re.vertexLength+=te.length,re.primitiveLength+=te.length}const H=Nd(U,j);for(let te=0;te<H.length;te+=3)this.indexArray.emplaceBack(B+H[te],B+H[te+1],B+H[te+2]);M.vertexLength+=C,M.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,b,m)}}let Vd,$d;qt("FillBucket",Rh,{omit:["layers","patternFeatures"]});var Oy={get paint(){return $d=$d||new Yr({"fill-antialias":new ti(ke.paint_fill["fill-antialias"]),"fill-opacity":new hi(ke.paint_fill["fill-opacity"]),"fill-color":new hi(ke.paint_fill["fill-color"]),"fill-outline-color":new hi(ke.paint_fill["fill-outline-color"]),"fill-translate":new ti(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new ti(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new xo(ke.paint_fill["fill-pattern"])})},get layout(){return Vd=Vd||new Yr({"fill-sort-key":new hi(ke.layout_fill["fill-sort-key"])})}};class Fy extends Nn{constructor(e){super(e,Oy)}recalculate(e,s){super.recalculate(e,s);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Rh(e)}queryRadius(){return iu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,s,h,m,b,x,C){return Ed(ru(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,C),m)}isTileClipped(){return!0}}const Ny=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Uy=er([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Vy}=Ny;var ra={},$y=E,jd=zo;function zo(i,e,s,h,m){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=h,this._values=m,i.readFields(jy,this,e)}function jy(i,e,s){i==1?e.id=s.readVarint():i==2?function(h,m){for(var b=h.readVarint()+h.pos;h.pos<b;){var x=m._keys[h.readVarint()],C=m._values[h.readVarint()];m.properties[x]=C}}(s,e):i==3?e.type=s.readVarint():i==4&&(e._geometry=s.pos)}function qy(i){for(var e,s,h=0,m=0,b=i.length,x=b-1;m<b;x=m++)h+=((s=i[x]).x-(e=i[m]).x)*(e.y+s.y);return h}zo.types=["Unknown","Point","LineString","Polygon"],zo.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,s=i.readVarint()+i.pos,h=1,m=0,b=0,x=0,C=[];i.pos<s;){if(m<=0){var M=i.readVarint();h=7&M,m=M>>3}if(m--,h===1||h===2)b+=i.readSVarint(),x+=i.readSVarint(),h===1&&(e&&C.push(e),e=[]),e.push(new $y(b,x));else{if(h!==7)throw new Error("unknown command "+h);e&&e.push(e[0].clone())}}return e&&C.push(e),C},zo.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,s=1,h=0,m=0,b=0,x=1/0,C=-1/0,M=1/0,B=-1/0;i.pos<e;){if(h<=0){var U=i.readVarint();s=7&U,h=U>>3}if(h--,s===1||s===2)(m+=i.readSVarint())<x&&(x=m),m>C&&(C=m),(b+=i.readSVarint())<M&&(M=b),b>B&&(B=b);else if(s!==7)throw new Error("unknown command "+s)}return[x,M,C,B]},zo.prototype.toGeoJSON=function(i,e,s){var h,m,b=this.extent*Math.pow(2,s),x=this.extent*i,C=this.extent*e,M=this.loadGeometry(),B=zo.types[this.type];function U(te){for(var re=0;re<te.length;re++){var pe=te[re];te[re]=[360*(pe.x+x)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+C)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(h=0;h<M.length;h++)j[h]=M[h][0];U(M=j);break;case 2:for(h=0;h<M.length;h++)U(M[h]);break;case 3:for(M=function(te){var re=te.length;if(re<=1)return[te];for(var pe,Te,Me=[],He=0;He<re;He++){var Be=qy(te[He]);Be!==0&&(Te===void 0&&(Te=Be<0),Te===Be<0?(pe&&Me.push(pe),pe=[te[He]]):pe.push(te[He]))}return pe&&Me.push(pe),Me}(M),h=0;h<M.length;h++)for(m=0;m<M[h].length;m++)U(M[h][m])}M.length===1?M=M[0]:B="Multi"+B;var H={type:"Feature",geometry:{type:B,coordinates:M},properties:this.properties};return"id"in this&&(H.id=this.id),H};var Zy=jd,qd=Zd;function Zd(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Gy,this,e),this.length=this._features.length}function Gy(i,e,s){i===15?e.version=s.readVarint():i===1?e.name=s.readString():i===5?e.extent=s.readVarint():i===2?e._features.push(s.pos):i===3?e._keys.push(s.readString()):i===4&&e._values.push(function(h){for(var m=null,b=h.readVarint()+h.pos;h.pos<b;){var x=h.readVarint()>>3;m=x===1?h.readString():x===2?h.readFloat():x===3?h.readDouble():x===4?h.readVarint64():x===5?h.readVarint():x===6?h.readSVarint():x===7?h.readBoolean():null}return m}(s))}Zd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Zy(this._pbf,e,this.extent,this._keys,this._values)};var Hy=qd;function Wy(i,e,s){if(i===3){var h=new Hy(s,s.readVarint()+s.pos);h.length&&(e[h.name]=h)}}ra.VectorTile=function(i,e){this.layers=i.readFields(Wy,{},e)},ra.VectorTileFeature=jd,ra.VectorTileLayer=qd;const Ky=ra.VectorTileFeature.types,Bh=Math.pow(2,13);function Wl(i,e,s,h,m,b,x,C){i.emplaceBack(e,s,2*Math.floor(h*Bh)+x,m*Bh*2,b*Bh*2,Math.round(C))}class Oh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new fi,this.centroidVertexArray=new Wt,this.indexArray=new hr,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new ir,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.features=[],this.hasPattern=Dh("fill-extrusion",this.layers,s);for(const{feature:m,id:b,index:x,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,B=Ba(m,M);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),B,h))continue;const U={id:b,sourceLayerIndex:C,index:x,geometry:M?B.geometry:Ra(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Lh("fill-extrusion",this.layers,U,this.zoom,s)):this.addFeature(U,U.geometry,x,h,{}),s.featureIndex.insert(m,U.geometry,x,C,this.index,!0)}}addFeatures(e,s,h){for(const m of this.features){const{geometry:b}=m;this.addFeature(m,b,m.index,s,h)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vy),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Uy.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,s,h,m,b){const x={x:0,y:0,vertexCount:0};for(const C of Mh(s,500)){let M=0;for(const re of C)M+=re.length;let B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const re of C){if(re.length===0||Jy(re))continue;let pe=0;for(let Te=0;Te<re.length;Te++){const Me=re[Te];if(Te>=1){const He=re[Te-1];if(!Xy(Me,He)){B.vertexLength+4>ir.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Be=Me.sub(He)._perp()._unit(),Ke=He.dist(Me);pe+Ke>32768&&(pe=0),Wl(this.layoutVertexArray,Me.x,Me.y,Be.x,Be.y,0,0,pe),Wl(this.layoutVertexArray,Me.x,Me.y,Be.x,Be.y,0,1,pe),x.x+=2*Me.x,x.y+=2*Me.y,x.vertexCount+=2,pe+=Ke,Wl(this.layoutVertexArray,He.x,He.y,Be.x,Be.y,0,0,pe),Wl(this.layoutVertexArray,He.x,He.y,Be.x,Be.y,0,1,pe),x.x+=2*He.x,x.y+=2*He.y,x.vertexCount+=2;const nt=B.vertexLength;this.indexArray.emplaceBack(nt,nt+2,nt+1),this.indexArray.emplaceBack(nt+1,nt+2,nt+3),B.vertexLength+=4,B.primitiveLength+=2}}}}if(B.vertexLength+M>ir.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),Ky[e.type]!=="Polygon")continue;const U=[],j=[],H=B.vertexLength;for(const re of C)if(re.length!==0){re!==C[0]&&j.push(U.length/2);for(let pe=0;pe<re.length;pe++){const Te=re[pe];Wl(this.layoutVertexArray,Te.x,Te.y,0,0,1,1,0),x.x+=Te.x,x.y+=Te.y,x.vertexCount+=1,U.push(Te.x),U.push(Te.y)}}const te=Nd(U,j);for(let re=0;re<te.length;re+=3)this.indexArray.emplaceBack(H+te[re],H+te[re+2],H+te[re+1]);B.primitiveLength+=te.length/3,B.vertexLength+=M}for(let C=0;C<x.vertexCount;C++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,b,m)}}function Xy(i,e){return i.x===e.x&&(i.x<0||i.x>Sr)||i.y===e.y&&(i.y<0||i.y>Sr)}function Jy(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Sr)||i.every(e=>e.y<0)||i.every(e=>e.y>Sr)}let Gd;qt("FillExtrusionBucket",Oh,{omit:["layers","features"]});var Yy={get paint(){return Gd=Gd||new Yr({"fill-extrusion-opacity":new ti(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new hi(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ti(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ti(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xo(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new hi(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new hi(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ti(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Qy extends Nn{constructor(e){super(e,Yy)}createBucket(e){return new Oh(e)}queryRadius(){return iu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,s,h,m,b,x,C,M){const B=ru(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,C),U=this.paint.get("fill-extrusion-height").evaluate(s,h),j=this.paint.get("fill-extrusion-base").evaluate(s,h),H=function(re,pe,Te,Me){const He=[];for(const Be of re){const Ke=[Be.x,Be.y,0,1];nu(Ke,Ke,pe),He.push(new T(Ke[0]/Ke[3],Ke[1]/Ke[3]))}return He}(B,M),te=function(re,pe,Te,Me){const He=[],Be=[],Ke=Me[8]*pe,nt=Me[9]*pe,_t=Me[10]*pe,Nt=Me[11]*pe,Kt=Me[8]*Te,Ot=Me[9]*Te,Rt=Me[10]*Te,Mt=Me[11]*Te;for(const Zt of re){const Dt=[],kt=[];for(const ci of Zt){const Qt=ci.x,Ai=ci.y,Ji=Me[0]*Qt+Me[4]*Ai+Me[12],rr=Me[1]*Qt+Me[5]*Ai+Me[13],Lr=Me[2]*Qt+Me[6]*Ai+Me[14],Ln=Me[3]*Qt+Me[7]*Ai+Me[15],hn=Lr+_t,kr=Ln+Nt,jr=Ji+Kt,Hr=rr+Ot,fn=Lr+Rt,dn=Ln+Mt,Rr=new T((Ji+Ke)/kr,(rr+nt)/kr);Rr.z=hn/kr,Dt.push(Rr);const Br=new T(jr/dn,Hr/dn);Br.z=fn/dn,kt.push(Br)}He.push(Dt),Be.push(kt)}return[He,Be]}(m,j,U,M);return function(re,pe,Te){let Me=1/0;Ed(Te,pe)&&(Me=Hd(Te,pe[0]));for(let He=0;He<pe.length;He++){const Be=pe[He],Ke=re[He];for(let nt=0;nt<Be.length-1;nt++){const _t=Be[nt],Nt=[_t,Be[nt+1],Ke[nt+1],Ke[nt],_t];xd(Te,Nt)&&(Me=Math.min(Me,Hd(Te,Nt)))}}return Me!==1/0&&Me}(te[0],te[1],H)}}function Kl(i,e){return i.x*e.x+i.y*e.y}function Hd(i,e){if(i.length===1){let s=0;const h=e[s++];let m;for(;!m||h.equals(m);)if(m=e[s++],!m)return 1/0;for(;s<e.length;s++){const b=e[s],x=i[0],C=m.sub(h),M=b.sub(h),B=x.sub(h),U=Kl(C,C),j=Kl(C,M),H=Kl(M,M),te=Kl(B,C),re=Kl(B,M),pe=U*H-j*j,Te=(H*te-j*re)/pe,Me=(U*re-j*te)/pe,He=h.z*(1-Te-Me)+m.z*Te+b.z*Me;if(isFinite(He))return He}return 1/0}{let s=1/0;for(const h of e)s=Math.min(s,h.z);return s}}const e0=er([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:t0}=e0,i0=er([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:r0}=i0,n0=ra.VectorTileFeature.types,s0=Math.cos(Math.PI/180*37.5),Wd=Math.pow(2,14)/.5;class Fh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Xt,this.layoutVertexArray2=new tr,this.indexArray=new hr,this.programConfigurations=new La(e.layers,e.zoom),this.segments=new ir,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.hasPattern=Dh("line",this.layers,s);const m=this.layers[0].layout.get("line-sort-key"),b=!m.isConstant(),x=[];for(const{feature:C,id:M,index:B,sourceLayerIndex:U}of e){const j=this.layers[0]._featureFilter.needGeometry,H=Ba(C,j);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),H,h))continue;const te=b?m.evaluate(H,{},h):void 0,re={id:M,properties:C.properties,type:C.type,sourceLayerIndex:U,index:B,geometry:j?H.geometry:Ra(C),patterns:{},sortKey:te};x.push(re)}b&&x.sort((C,M)=>C.sortKey-M.sortKey);for(const C of x){const{geometry:M,index:B,sourceLayerIndex:U}=C;if(this.hasPattern){const j=Lh("line",this.layers,C,this.zoom,s);this.patternFeatures.push(j)}else this.addFeature(C,M,B,h,{});s.featureIndex.insert(e[B].feature,M,B,U,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}addFeatures(e,s,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,r0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,t0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,h,m,b){const x=this.layers[0].layout,C=x.get("line-join").evaluate(e,{}),M=x.get("line-cap"),B=x.get("line-miter-limit"),U=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const j of s)this.addLine(j,e,C,M,B,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,b,m)}addLine(e,s,h,m,b,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Me=0;Me<e.length-1;Me++)this.totalDistance+=e[Me].dist(e[Me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=n0[s.type]==="Polygon";let M=e.length;for(;M>=2&&e[M-1].equals(e[M-2]);)M--;let B=0;for(;B<M-1&&e[B].equals(e[B+1]);)B++;if(M<(C?3:2))return;h==="bevel"&&(b=1.05);const U=this.overscaling<=16?15*Sr/(512*this.overscaling):0,j=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let H,te,re,pe,Te;this.e1=this.e2=-1,C&&(H=e[M-2],Te=e[B].sub(H)._unit()._perp());for(let Me=B;Me<M;Me++){if(re=Me===M-1?C?e[B+1]:void 0:e[Me+1],re&&e[Me].equals(re))continue;Te&&(pe=Te),H&&(te=H),H=e[Me],Te=re?re.sub(H)._unit()._perp():pe,pe=pe||Te;let He=pe.add(Te);He.x===0&&He.y===0||He._unit();const Be=pe.x*Te.x+pe.y*Te.y,Ke=He.x*Te.x+He.y*Te.y,nt=Ke!==0?1/Ke:1/0,_t=2*Math.sqrt(2-2*Ke),Nt=Ke<s0&&te&&re,Kt=pe.x*Te.y-pe.y*Te.x>0;if(Nt&&Me>B){const Mt=H.dist(te);if(Mt>2*U){const Zt=H.sub(H.sub(te)._mult(U/Mt)._round());this.updateDistance(te,Zt),this.addCurrentVertex(Zt,pe,0,0,j),te=Zt}}const Ot=te&&re;let Rt=Ot?h:C?"butt":m;if(Ot&&Rt==="round"&&(nt<x?Rt="miter":nt<=2&&(Rt="fakeround")),Rt==="miter"&&nt>b&&(Rt="bevel"),Rt==="bevel"&&(nt>2&&(Rt="flipbevel"),nt<b&&(Rt="miter")),te&&this.updateDistance(te,H),Rt==="miter")He._mult(nt),this.addCurrentVertex(H,He,0,0,j);else if(Rt==="flipbevel"){if(nt>100)He=Te.mult(-1);else{const Mt=nt*pe.add(Te).mag()/pe.sub(Te).mag();He._perp()._mult(Mt*(Kt?-1:1))}this.addCurrentVertex(H,He,0,0,j),this.addCurrentVertex(H,He.mult(-1),0,0,j)}else if(Rt==="bevel"||Rt==="fakeround"){const Mt=-Math.sqrt(nt*nt-1),Zt=Kt?Mt:0,Dt=Kt?0:Mt;if(te&&this.addCurrentVertex(H,pe,Zt,Dt,j),Rt==="fakeround"){const kt=Math.round(180*_t/Math.PI/20);for(let ci=1;ci<kt;ci++){let Qt=ci/kt;if(Qt!==.5){const Ji=Qt-.5;Qt+=Qt*Ji*(Qt-1)*((1.0904+Be*(Be*(3.55645-1.43519*Be)-3.2452))*Ji*Ji+(.848013+Be*(.215638*Be-1.06021)))}const Ai=Te.sub(pe)._mult(Qt)._add(pe)._unit()._mult(Kt?-1:1);this.addHalfVertex(H,Ai.x,Ai.y,!1,Kt,0,j)}}re&&this.addCurrentVertex(H,Te,-Zt,-Dt,j)}else if(Rt==="butt")this.addCurrentVertex(H,He,0,0,j);else if(Rt==="square"){const Mt=te?1:-1;this.addCurrentVertex(H,He,Mt,Mt,j)}else Rt==="round"&&(te&&(this.addCurrentVertex(H,pe,0,0,j),this.addCurrentVertex(H,pe,1,1,j,!0)),re&&(this.addCurrentVertex(H,Te,-1,-1,j,!0),this.addCurrentVertex(H,Te,0,0,j)));if(Nt&&Me<M-1){const Mt=H.dist(re);if(Mt>2*U){const Zt=H.add(re.sub(H)._mult(U/Mt)._round());this.updateDistance(H,Zt),this.addCurrentVertex(Zt,Te,0,0,j),H=Zt}}}}addCurrentVertex(e,s,h,m,b,x=!1){const C=s.y*m-s.x,M=-s.y-s.x*m;this.addHalfVertex(e,s.x+s.y*h,s.y-s.x*h,x,!1,h,b),this.addHalfVertex(e,C,M,x,!0,-m,b),this.distance>Wd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,s,h,m,b,x))}addHalfVertex({x:e,y:s},h,m,b,x,C,M){const B=.5*(this.lineClips?this.scaledDistance*(Wd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(b?1:0),(s<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*m)+128,1+(C===0?0:C<0?-1:1)|(63&B)<<2,B>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const U=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),M.primitiveLength++),x?this.e2=U:this.e1=U}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}let Kd,Xd;qt("LineBucket",Fh,{omit:["layers","patternFeatures"]});var Jd={get paint(){return Xd=Xd||new Yr({"line-opacity":new hi(ke.paint_line["line-opacity"]),"line-color":new hi(ke.paint_line["line-color"]),"line-translate":new ti(ke.paint_line["line-translate"]),"line-translate-anchor":new ti(ke.paint_line["line-translate-anchor"]),"line-width":new hi(ke.paint_line["line-width"]),"line-gap-width":new hi(ke.paint_line["line-gap-width"]),"line-offset":new hi(ke.paint_line["line-offset"]),"line-blur":new hi(ke.paint_line["line-blur"]),"line-dasharray":new Bl(ke.paint_line["line-dasharray"]),"line-pattern":new xo(ke.paint_line["line-pattern"]),"line-gradient":new Hn(ke.paint_line["line-gradient"])})},get layout(){return Kd=Kd||new Yr({"line-cap":new ti(ke.layout_line["line-cap"]),"line-join":new hi(ke.layout_line["line-join"]),"line-miter-limit":new ti(ke.layout_line["line-miter-limit"]),"line-round-limit":new ti(ke.layout_line["line-round-limit"]),"line-sort-key":new hi(ke.layout_line["line-sort-key"])})}};class a0 extends hi{possiblyEvaluate(e,s){return s=new Qi(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(e,s)}evaluate(e,s,h,m){return s=ue({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,h,m)}}let cu;class o0 extends Nn{constructor(e){super(e,Jd),this.gradientVersion=0,cu||(cu=new a0(Jd.paint.properties["line-width"].specification),cu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof Ri,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,s){super.recalculate(e,s),this.paint._values["line-floorwidth"]=cu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Fh(e)}queryRadius(e){const s=e,h=Yd(Vl("line-width",this,s),Vl("line-gap-width",this,s)),m=Vl("line-offset",this,s);return h/2+Math.abs(m)+iu(this.paint.get("line-translate"))}queryIntersectsFeature(e,s,h,m,b,x,C){const M=ru(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,C),B=C/2*Yd(this.paint.get("line-width").evaluate(s,h),this.paint.get("line-gap-width").evaluate(s,h)),U=this.paint.get("line-offset").evaluate(s,h);return U&&(m=function(j,H){const te=[];for(let re=0;re<j.length;re++){const pe=j[re],Te=[];for(let Me=0;Me<pe.length;Me++){const He=pe[Me-1],Be=pe[Me],Ke=pe[Me+1],nt=Me===0?new T(0,0):Be.sub(He)._unit()._perp(),_t=Me===pe.length-1?new T(0,0):Ke.sub(Be)._unit()._perp(),Nt=nt._add(_t)._unit(),Kt=Nt.x*_t.x+Nt.y*_t.y;Kt!==0&&Nt._mult(1/Kt),Te.push(Nt._mult(H)._add(Be))}te.push(Te)}return te}(m,U*C)),function(j,H,te){for(let re=0;re<H.length;re++){const pe=H[re];if(j.length>=3){for(let Te=0;Te<pe.length;Te++)if(Io(j,pe[Te]))return!0}if(dy(j,pe,te))return!0}return!1}(M,m,B)}isTileClipped(){return!0}}function Yd(i,e){return e>0?e+2*i:i}const l0=er([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),c0=er([{name:"a_projected_pos",components:3,type:"Float32"}],4);er([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const u0=er([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);er([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Qd=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),h0=er([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function f0(i,e,s){return i.sections.forEach(h=>{h.text=function(m,b,x){const C=b.layout.get("text-transform").evaluate(x,{});return C==="uppercase"?m=m.toLocaleUpperCase():C==="lowercase"&&(m=m.toLocaleLowerCase()),xn.applyArabicShaping&&(m=xn.applyArabicShaping(m)),m}(h.text,e,s)}),i}er([{name:"triangle",components:3,type:"Uint16"}]),er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),er([{type:"Float32",name:"offsetX"}]),er([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),er([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Xl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Dr=24,ep=Gi,tp=function(i,e,s,h,m){var b,x,C=8*m-h-1,M=(1<<C)-1,B=M>>1,U=-7,j=s?m-1:0,H=s?-1:1,te=i[e+j];for(j+=H,b=te&(1<<-U)-1,te>>=-U,U+=C;U>0;b=256*b+i[e+j],j+=H,U-=8);for(x=b&(1<<-U)-1,b>>=-U,U+=h;U>0;x=256*x+i[e+j],j+=H,U-=8);if(b===0)b=1-B;else{if(b===M)return x?NaN:1/0*(te?-1:1);x+=Math.pow(2,h),b-=B}return(te?-1:1)*x*Math.pow(2,b-h)},ip=function(i,e,s,h,m,b){var x,C,M,B=8*b-m-1,U=(1<<B)-1,j=U>>1,H=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=h?0:b-1,re=h?1:-1,pe=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(C=isNaN(e)?1:0,x=U):(x=Math.floor(Math.log(e)/Math.LN2),e*(M=Math.pow(2,-x))<1&&(x--,M*=2),(e+=x+j>=1?H/M:H*Math.pow(2,1-j))*M>=2&&(x++,M/=2),x+j>=U?(C=0,x=U):x+j>=1?(C=(e*M-1)*Math.pow(2,m),x+=j):(C=e*Math.pow(2,j-1)*Math.pow(2,m),x=0));m>=8;i[s+te]=255&C,te+=re,C/=256,m-=8);for(x=x<<m|C,B+=m;B>0;i[s+te]=255&x,te+=re,x/=256,B-=8);i[s+te-re]|=128*pe};function Gi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Gi.Varint=0,Gi.Fixed64=1,Gi.Bytes=2,Gi.Fixed32=5;var Nh=4294967296,rp=1/Nh,np=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Rs(i){return i.type===Gi.Bytes?i.readVarint()+i.pos:i.pos+1}function Mo(i,e,s){return s?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function sp(i,e,s){var h=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(h);for(var m=s.pos-1;m>=i;m--)s.buf[m+h]=s.buf[m]}function d0(i,e){for(var s=0;s<i.length;s++)e.writeVarint(i[s])}function p0(i,e){for(var s=0;s<i.length;s++)e.writeSVarint(i[s])}function m0(i,e){for(var s=0;s<i.length;s++)e.writeFloat(i[s])}function g0(i,e){for(var s=0;s<i.length;s++)e.writeDouble(i[s])}function _0(i,e){for(var s=0;s<i.length;s++)e.writeBoolean(i[s])}function y0(i,e){for(var s=0;s<i.length;s++)e.writeFixed32(i[s])}function v0(i,e){for(var s=0;s<i.length;s++)e.writeSFixed32(i[s])}function b0(i,e){for(var s=0;s<i.length;s++)e.writeFixed64(i[s])}function w0(i,e){for(var s=0;s<i.length;s++)e.writeSFixed64(i[s])}function uu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Do(i,e,s){i[s]=e,i[s+1]=e>>>8,i[s+2]=e>>>16,i[s+3]=e>>>24}function ap(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Gi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),m=h>>3,b=this.pos;this.type=7&h,i(m,e,this),this.pos===b&&this.skip(h)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=uu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=ap(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=uu(this.buf,this.pos)+uu(this.buf,this.pos+4)*Nh;return this.pos+=8,i},readSFixed64:function(){var i=uu(this.buf,this.pos)+ap(this.buf,this.pos+4)*Nh;return this.pos+=8,i},readFloat:function(){var i=tp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=tp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,s,h=this.buf;return e=127&(s=h[this.pos++]),s<128?e:(e|=(127&(s=h[this.pos++]))<<7,s<128?e:(e|=(127&(s=h[this.pos++]))<<14,s<128?e:(e|=(127&(s=h[this.pos++]))<<21,s<128?e:function(m,b,x){var C,M,B=x.buf;if(C=(112&(M=B[x.pos++]))>>4,M<128||(C|=(127&(M=B[x.pos++]))<<3,M<128)||(C|=(127&(M=B[x.pos++]))<<10,M<128)||(C|=(127&(M=B[x.pos++]))<<17,M<128)||(C|=(127&(M=B[x.pos++]))<<24,M<128)||(C|=(1&(M=B[x.pos++]))<<31,M<128))return Mo(m,C,b);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=h[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&np?function(s,h,m){return np.decode(s.subarray(h,m))}(this.buf,e,i):function(s,h,m){for(var b="",x=h;x<m;){var C,M,B,U=s[x],j=null,H=U>239?4:U>223?3:U>191?2:1;if(x+H>m)break;H===1?U<128&&(j=U):H===2?(192&(C=s[x+1]))==128&&(j=(31&U)<<6|63&C)<=127&&(j=null):H===3?(M=s[x+2],(192&(C=s[x+1]))==128&&(192&M)==128&&((j=(15&U)<<12|(63&C)<<6|63&M)<=2047||j>=55296&&j<=57343)&&(j=null)):H===4&&(M=s[x+2],B=s[x+3],(192&(C=s[x+1]))==128&&(192&M)==128&&(192&B)==128&&((j=(15&U)<<18|(63&C)<<12|(63&M)<<6|63&B)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,H=1):j>65535&&(j-=65536,b+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),b+=String.fromCharCode(j),x+=H}return b}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Gi.Bytes)return i.push(this.readVarint(e));var s=Rs(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Gi.Bytes)return i.push(this.readSVarint());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Gi.Bytes)return i.push(this.readBoolean());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Gi.Bytes)return i.push(this.readFloat());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Gi.Bytes)return i.push(this.readDouble());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Gi.Bytes)return i.push(this.readFixed32());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Gi.Bytes)return i.push(this.readSFixed32());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Gi.Bytes)return i.push(this.readFixed64());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Gi.Bytes)return i.push(this.readSFixed64());var e=Rs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Gi.Varint)for(;this.buf[this.pos++]>127;);else if(e===Gi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Gi.Fixed32)this.pos+=4;else{if(e!==Gi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Do(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Do(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Do(this.buf,-1&i,this.pos),Do(this.buf,Math.floor(i*rp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Do(this.buf,-1&i,this.pos),Do(this.buf,Math.floor(i*rp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,s){var h,m;if(e>=0?(h=e%4294967296|0,m=e/4294967296|0):(m=~(-e/4294967296),4294967295^(h=~(-e%4294967296))?h=h+1|0:(h=0,m=m+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(b,x,C){C.buf[C.pos++]=127&b|128,b>>>=7,C.buf[C.pos++]=127&b|128,b>>>=7,C.buf[C.pos++]=127&b|128,b>>>=7,C.buf[C.pos++]=127&b|128,C.buf[C.pos]=127&(b>>>=7)}(h,0,s),function(b,x){var C=(7&b)<<4;x.buf[x.pos++]|=C|((b>>>=3)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b)))))}(m,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(h,m,b){for(var x,C,M=0;M<m.length;M++){if((x=m.charCodeAt(M))>55295&&x<57344){if(!C){x>56319||M+1===m.length?(h[b++]=239,h[b++]=191,h[b++]=189):C=x;continue}if(x<56320){h[b++]=239,h[b++]=191,h[b++]=189,C=x;continue}x=C-55296<<10|x-56320|65536,C=null}else C&&(h[b++]=239,h[b++]=191,h[b++]=189,C=null);x<128?h[b++]=x:(x<2048?h[b++]=x>>6|192:(x<65536?h[b++]=x>>12|224:(h[b++]=x>>18|240,h[b++]=x>>12&63|128),h[b++]=x>>6&63|128),h[b++]=63&x|128)}return b}(this.buf,i,this.pos);var s=this.pos-e;s>=128&&sp(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),ip(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ip(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,e){this.pos++;var s=this.pos;i(e,this);var h=this.pos-s;h>=128&&sp(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(i,e,s){this.writeTag(i,Gi.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,d0,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,p0,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,_0,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,m0,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,g0,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,y0,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,v0,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,b0,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,w0,e)},writeBytesField:function(i,e){this.writeTag(i,Gi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Gi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Gi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Gi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Gi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Gi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Gi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Gi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Gi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Gi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Uh=v(ep);const Vh=3;function x0(i,e,s){i===1&&s.readMessage(E0,e)}function E0(i,e,s){if(i===3){const{id:h,bitmap:m,width:b,height:x,left:C,top:M,advance:B}=s.readMessage(S0,{});e.push({id:h,bitmap:new jl({width:b+2*Vh,height:x+2*Vh},m),metrics:{width:b,height:x,left:C,top:M,advance:B}})}}function S0(i,e,s){i===1?e.id=s.readVarint():i===2?e.bitmap=s.readBytes():i===3?e.width=s.readVarint():i===4?e.height=s.readVarint():i===5?e.left=s.readSVarint():i===6?e.top=s.readSVarint():i===7&&(e.advance=s.readVarint())}const op=Vh;function lp(i){let e=0,s=0;for(const x of i)e+=x.w*x.h,s=Math.max(s,x.w);i.sort((x,C)=>C.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let m=0,b=0;for(const x of i)for(let C=h.length-1;C>=0;C--){const M=h[C];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,b=Math.max(b,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===M.w&&x.h===M.h){const B=h.pop();C<h.length&&(h[C]=B)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(h.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:m,h:b,fill:e/(m*b)||0}}const Tn=1;class $h{constructor(e,{pixelRatio:s,version:h,stretchX:m,stretchY:b,content:x}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=m,this.stretchY=b,this.content=x,this.version=h}get tl(){return[this.paddedRect.x+Tn,this.paddedRect.y+Tn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Tn,this.paddedRect.y+this.paddedRect.h-Tn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Tn)/this.pixelRatio,(this.paddedRect.h-2*Tn)/this.pixelRatio]}}class cp{constructor(e,s){const h={},m={};this.haveRenderCallbacks=[];const b=[];this.addImages(e,h,b),this.addImages(s,m,b);const{w:x,h:C}=lp(b),M=new Un({width:x||1,height:C||1});for(const B in e){const U=e[B],j=h[B].paddedRect;Un.copy(U.data,M,{x:0,y:0},{x:j.x+Tn,y:j.y+Tn},U.data)}for(const B in s){const U=s[B],j=m[B].paddedRect,H=j.x+Tn,te=j.y+Tn,re=U.data.width,pe=U.data.height;Un.copy(U.data,M,{x:0,y:0},{x:H,y:te},U.data),Un.copy(U.data,M,{x:0,y:pe-1},{x:H,y:te-1},{width:re,height:1}),Un.copy(U.data,M,{x:0,y:0},{x:H,y:te+pe},{width:re,height:1}),Un.copy(U.data,M,{x:re-1,y:0},{x:H-1,y:te},{width:1,height:pe}),Un.copy(U.data,M,{x:0,y:0},{x:H+re,y:te},{width:1,height:pe})}this.image=M,this.iconPositions=h,this.patternPositions=m}addImages(e,s,h){for(const m in e){const b=e[m],x={x:0,y:0,w:b.data.width+2*Tn,h:b.data.height+2*Tn};h.push(x),s[m]=new $h(x,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in e.updatedImages)this.patchUpdatedImage(this.iconPositions[h],e.getImage(h),s),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h),s)}patchUpdatedImage(e,s,h){if(!e||!s||e.version===s.version)return;e.version=s.version;const[m,b]=e.tl;h.update(s.data,void 0,{x:m,y:b})}}var na;qt("ImagePosition",$h),qt("ImageAtlas",cp),n.WritingMode=void 0,(na=n.WritingMode||(n.WritingMode={}))[na.none=0]="none",na[na.horizontal=1]="horizontal",na[na.vertical=2]="vertical",na[na.horizontalOnly=3]="horizontalOnly";const Jl=-17;class Yl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const h=new Yl;return h.scale=e||1,h.fontStack=s,h}static forImage(e){const s=new Yl;return s.imageName=e,s}}class Lo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const h=new Lo;for(let m=0;m<e.sections.length;m++){const b=e.sections[m];b.image?h.addImageSection(b):h.addTextSection(b,s)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let s="";for(let h=0;h<e.length;h++){const m=e.charCodeAt(h+1)||null,b=e.charCodeAt(h-1)||null;s+=m&&Hc(m)&&!Xl[e[h+1]]||b&&Hc(b)&&!Xl[e[h-1]]||!Xl[e[h]]?e[h]:Xl[e[h]]}return s}(this.text)}trim(){let e=0;for(let h=0;h<this.text.length&&fu[this.text.charCodeAt(h)];h++)e++;let s=this.text.length;for(let h=this.text.length-1;h>=0&&h>=e&&fu[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const h=new Lo;return h.text=this.text.substring(e,s),h.sectionIndex=this.sectionIndex.slice(e,s),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(Yl.forText(e.scale,e.fontStack||s));const h=this.sections.length-1;for(let m=0;m<e.text.length;++m)this.sectionIndex.push(h)}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void Z("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Yl.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Z("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hu(i,e,s,h,m,b,x,C,M,B,U,j,H,te,re,pe){const Te=Lo.fromFeature(i,m);let Me;j===n.WritingMode.vertical&&Te.verticalizePunctuation();const{processBidirectionalText:He,processStyledBidirectionalText:Be}=xn;if(He&&Te.sections.length===1){Me=[];const _t=He(Te.toString(),jh(Te,B,b,e,h,te,re));for(const Nt of _t){const Kt=new Lo;Kt.text=Nt,Kt.sections=Te.sections;for(let Ot=0;Ot<Nt.length;Ot++)Kt.sectionIndex.push(0);Me.push(Kt)}}else if(Be){Me=[];const _t=Be(Te.text,Te.sectionIndex,jh(Te,B,b,e,h,te,re));for(const Nt of _t){const Kt=new Lo;Kt.text=Nt[0],Kt.sectionIndex=Nt[1],Kt.sections=Te.sections,Me.push(Kt)}}else Me=function(_t,Nt){const Kt=[],Ot=_t.text;let Rt=0;for(const Mt of Nt)Kt.push(_t.substring(Rt,Mt)),Rt=Mt;return Rt<Ot.length&&Kt.push(_t.substring(Rt,Ot.length)),Kt}(Te,jh(Te,B,b,e,h,te,re));const Ke=[],nt={positionedLines:Ke,text:Te.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(_t,Nt,Kt,Ot,Rt,Mt,Zt,Dt,kt,ci,Qt,Ai){let Ji=0,rr=Jl,Lr=0,Ln=0;const hn=Dt==="right"?1:Dt==="left"?0:.5;let kr=0;for(const Rr of Rt){Rr.trim();const Br=Rr.getMaxScale(),en=(Br-1)*Dr,pn={positionedGlyphs:[],lineOffset:0};_t.positionedLines[kr]=pn;const tn=pn.positionedGlyphs;let Cn=0;if(!Rr.length()){rr+=Mt,++kr;continue}for(let Or=0;Or<Rr.length();Or++){const Di=Rr.getSection(Or),rn=Rr.getSectionIndex(Or),Wr=Rr.getCharCode(Or);let Fr=0,Xn=null,os=null,ls=null,Bs=Dr;const Jn=!(kt===n.WritingMode.horizontal||!Qt&&!Tl(Wr)||Qt&&(fu[Wr]||(jr=Wr,jt.Arabic(jr)||jt["Arabic Supplement"](jr)||jt["Arabic Extended-A"](jr)||jt["Arabic Presentation Forms-A"](jr)||jt["Arabic Presentation Forms-B"](jr))));if(Di.imageName){const $n=Ot[Di.imageName];if(!$n)continue;ls=Di.imageName,_t.iconsInText=_t.iconsInText||!0,os=$n.paddedRect;const An=$n.displaySize;Di.scale=Di.scale*Dr/Ai,Xn={width:An[0],height:An[1],left:Tn,top:-op,advance:Jn?An[1]:An[0]},Fr=en+(Dr-An[1]*Di.scale),Bs=Xn.advance;const Os=Jn?An[0]*Di.scale-Dr*Br:An[1]*Di.scale-Dr*Br;Os>0&&Os>Cn&&(Cn=Os)}else{const $n=Kt[Di.fontStack],An=$n&&$n[Wr];if(An&&An.rect)os=An.rect,Xn=An.metrics;else{const Os=Nt[Di.fontStack],rc=Os&&Os[Wr];if(!rc)continue;Xn=rc.metrics}Fr=(Br-Di.scale)*Dr}Jn?(_t.verticalizable=!0,tn.push({glyph:Wr,imageName:ls,x:Ji,y:rr+Fr,vertical:Jn,scale:Di.scale,fontStack:Di.fontStack,sectionIndex:rn,metrics:Xn,rect:os}),Ji+=Bs*Di.scale+ci):(tn.push({glyph:Wr,imageName:ls,x:Ji,y:rr+Fr,vertical:Jn,scale:Di.scale,fontStack:Di.fontStack,sectionIndex:rn,metrics:Xn,rect:os}),Ji+=Xn.advance*Di.scale+ci)}tn.length!==0&&(Lr=Math.max(Ji-ci,Lr),C0(tn,0,tn.length-1,hn,Cn)),Ji=0;const In=Mt*Br+Cn;pn.lineOffset=Math.max(Cn,en),rr+=In,Ln=Math.max(In,Ln),++kr}var jr;const Hr=rr-Jl,{horizontalAlign:fn,verticalAlign:dn}=qh(Zt);(function(Rr,Br,en,pn,tn,Cn,In,Or,Di){const rn=(Br-en)*tn;let Wr=0;Wr=Cn!==In?-Or*pn-Jl:(-pn*Di+.5)*In;for(const Fr of Rr)for(const Xn of Fr.positionedGlyphs)Xn.x+=rn,Xn.y+=Wr})(_t.positionedLines,hn,fn,dn,Lr,Ln,Mt,Hr,Rt.length),_t.top+=-dn*Hr,_t.bottom=_t.top+Hr,_t.left+=-fn*Lr,_t.right=_t.left+Lr}(nt,e,s,h,Me,x,C,M,j,B,H,pe),!function(_t){for(const Nt of _t)if(Nt.positionedGlyphs.length!==0)return!1;return!0}(Ke)&&nt}const fu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},k0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function up(i,e,s,h,m,b){if(e.imageName){const x=h[e.imageName];return x?x.displaySize[0]*e.scale*Dr/b+m:0}{const x=s[e.fontStack],C=x&&x[i];return C?C.metrics.advance*e.scale+m:0}}function hp(i,e,s,h){const m=Math.pow(i-e,2);return h?i<e?m/2:2*m:m+Math.abs(s)*s}function T0(i,e,s){let h=0;return i===10&&(h-=1e4),s&&(h+=150),i!==40&&i!==65288||(h+=50),e!==41&&e!==65289||(h+=50),h}function fp(i,e,s,h,m,b){let x=null,C=hp(e,s,m,b);for(const M of h){const B=hp(e-M.x,s,m,b)+M.badness;B<=C&&(x=M,C=B)}return{index:i,x:e,priorBreak:x,badness:C}}function dp(i){return i?dp(i.priorBreak).concat(i.index):[]}function jh(i,e,s,h,m,b,x){if(b!=="point")return[];if(!i)return[];const C=[],M=function(H,te,re,pe,Te,Me){let He=0;for(let Be=0;Be<H.length();Be++){const Ke=H.getSection(Be);He+=up(H.getCharCode(Be),Ke,pe,Te,te,Me)}return He/Math.max(1,Math.ceil(He/re))}(i,e,s,h,m,x),B=i.text.indexOf("​")>=0;let U=0;for(let H=0;H<i.length();H++){const te=i.getSection(H),re=i.getCharCode(H);if(fu[re]||(U+=up(re,te,h,m,e,x)),H<i.length()-1){const pe=!((j=re)<11904||!(jt["Bopomofo Extended"](j)||jt.Bopomofo(j)||jt["CJK Compatibility Forms"](j)||jt["CJK Compatibility Ideographs"](j)||jt["CJK Compatibility"](j)||jt["CJK Radicals Supplement"](j)||jt["CJK Strokes"](j)||jt["CJK Symbols and Punctuation"](j)||jt["CJK Unified Ideographs Extension A"](j)||jt["CJK Unified Ideographs"](j)||jt["Enclosed CJK Letters and Months"](j)||jt["Halfwidth and Fullwidth Forms"](j)||jt.Hiragana(j)||jt["Ideographic Description Characters"](j)||jt["Kangxi Radicals"](j)||jt["Katakana Phonetic Extensions"](j)||jt.Katakana(j)||jt["Vertical Forms"](j)||jt["Yi Radicals"](j)||jt["Yi Syllables"](j)));(k0[re]||pe||te.imageName)&&C.push(fp(H+1,U,M,C,T0(re,i.getCharCode(H+1),pe&&B),!1))}}var j;return dp(fp(i.length(),U,M,C,0,!0))}function qh(i){let e=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function C0(i,e,s,h,m){if(!h&&!m)return;const b=i[s],x=(i[s].x+b.metrics.advance*b.scale)*h;for(let C=e;C<=s;C++)i[C].x-=x,i[C].y+=m}function I0(i,e,s){const{horizontalAlign:h,verticalAlign:m}=qh(s),b=e[0]-i.displaySize[0]*h,x=e[1]-i.displaySize[1]*m;return{image:i,top:x,bottom:x+i.displaySize[1],left:b,right:b+i.displaySize[0]}}function pp(i,e,s,h,m,b){const x=i.image;let C;if(x.content){const Te=x.content,Me=x.pixelRatio||1;C=[Te[0]/Me,Te[1]/Me,x.displaySize[0]-Te[2]/Me,x.displaySize[1]-Te[3]/Me]}const M=e.left*b,B=e.right*b;let U,j,H,te;s==="width"||s==="both"?(te=m[0]+M-h[3],j=m[0]+B+h[1]):(te=m[0]+(M+B-x.displaySize[0])/2,j=te+x.displaySize[0]);const re=e.top*b,pe=e.bottom*b;return s==="height"||s==="both"?(U=m[1]+re-h[0],H=m[1]+pe+h[2]):(U=m[1]+(re+pe-x.displaySize[1])/2,H=U+x.displaySize[1]),{image:x,top:U,right:j,bottom:H,left:te,collisionPadding:C}}const Ql=255,Ss=128,sa=Ql*Ss;function mp(i,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Qi(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:m}=s;let b=0;for(;b<h.length&&h[b]<=i;)b++;b=Math.max(0,b-1);let x=b;for(;x<h.length&&h[x]<i+1;)x++;x=Math.min(h.length-1,x);const C=h[b],M=h[x];return s.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:M,interpolationType:m}:{kind:"camera",minZoom:C,maxZoom:M,minSize:s.evaluate(new Qi(C)),maxSize:s.evaluate(new Qi(M)),interpolationType:m}}}function Zh(i,e,s){let h="never";const m=i.get(e);return m?h=m:i.get(s)&&(h="always"),h}const A0=ra.VectorTileFeature.types,P0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function du(i,e,s,h,m,b,x,C,M,B,U,j,H){const te=C?Math.min(sa,Math.round(C[0])):0,re=C?Math.min(sa,Math.round(C[1])):0;i.emplaceBack(e,s,Math.round(32*h),Math.round(32*m),b,x,(te<<1)+(M?1:0),re,16*B,16*U,256*j,256*H)}function Gh(i,e,s){i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s)}function z0(i){for(const e of i.sections)if(vh(e.text))return!0;return!1}class Hh{constructor(e){this.layoutVertexArray=new Ei,this.indexArray=new hr,this.programConfigurations=e,this.segments=new ir,this.dynamicLayoutVertexArray=new Mi,this.opacityVertexArray=new mr,this.hasVisibleVertices=!1,this.placedSymbolArray=new rt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,h,m){this.isEmpty()||(h&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,l0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,c0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,P0,!0),this.opacityVertexBuffer.itemSize=1),(h||m)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qt("SymbolBuffers",Hh);class Wh{constructor(e,s,h){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new h,this.segments=new ir,this.collisionVertexArray=new Dn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,u0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qt("CollisionBuffers",Wh);class Ro{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(x=>x.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=kh([]),this.placementViewportMatrix=kh([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mp(this.zoom,s["text-size"]),this.iconSizeData=mp(this.zoom,s["icon-size"]);const h=this.layers[0].layout,m=h.get("symbol-sort-key"),b=h.get("symbol-z-order");this.canOverlap=Zh(h,"text-overlap","text-allow-overlap")!=="never"||Zh(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(x=>n.WritingMode[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=e.sourceID}createArrays(){this.text=new Hh(new La(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Hh(new La(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ot,this.lineVertexArray=new lt,this.symbolInstances=new Ge,this.textAnchorOffsets=new St}calculateGlyphDependencies(e,s,h,m,b){for(let x=0;x<e.length;x++)if(s[e.charCodeAt(x)]=!0,(h||m)&&b){const C=Xl[e.charAt(x)];C&&(s[C.charCodeAt(0)]=!0)}}populate(e,s,h){const m=this.layers[0],b=m.layout,x=b.get("text-font"),C=b.get("text-field"),M=b.get("icon-image"),B=(C.value.kind!=="constant"||C.value.value instanceof ar&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),U=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,j=b.get("symbol-sort-key");if(this.features=[],!B&&!U)return;const H=s.iconDependencies,te=s.glyphDependencies,re=s.availableImages,pe=new Qi(this.zoom);for(const{feature:Te,id:Me,index:He,sourceLayerIndex:Be}of e){const Ke=m._featureFilter.needGeometry,nt=Ba(Te,Ke);if(!m._featureFilter.filter(pe,nt,h))continue;let _t,Nt;if(Ke||(nt.geometry=Ra(Te)),B){const Ot=m.getValueAndResolveTokens("text-field",nt,h,re),Rt=ar.factory(Ot);z0(Rt)&&(this.hasRTLText=!0),(!this.hasRTLText||Dl()==="unavailable"||this.hasRTLText&&xn.isParsed())&&(_t=f0(Rt,m,nt))}if(U){const Ot=m.getValueAndResolveTokens("icon-image",nt,h,re);Nt=Ot instanceof Mr?Ot:Mr.fromString(Ot)}if(!_t&&!Nt)continue;const Kt=this.sortFeaturesByKey?j.evaluate(nt,{},h):void 0;if(this.features.push({id:Me,text:_t,icon:Nt,index:He,sourceLayerIndex:Be,geometry:nt.geometry,properties:Te.properties,type:A0[Te.type],sortKey:Kt}),Nt&&(H[Nt.name]=!0),_t){const Ot=x.evaluate(nt,{},h).join(","),Rt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(n.WritingMode.vertical)>=0;for(const Mt of _t.sections)if(Mt.image)H[Mt.image.name]=!0;else{const Zt=Aa(_t.toString()),Dt=Mt.fontStack||Ot,kt=te[Dt]=te[Dt]||{};this.calculateGlyphDependencies(Mt.text,kt,Rt,this.allowVerticalPlacement,Zt)}}}b.get("symbol-placement")==="line"&&(this.features=function(Te){const Me={},He={},Be=[];let Ke=0;function nt(Ot){Be.push(Te[Ot]),Ke++}function _t(Ot,Rt,Mt){const Zt=He[Ot];return delete He[Ot],He[Rt]=Zt,Be[Zt].geometry[0].pop(),Be[Zt].geometry[0]=Be[Zt].geometry[0].concat(Mt[0]),Zt}function Nt(Ot,Rt,Mt){const Zt=Me[Rt];return delete Me[Rt],Me[Ot]=Zt,Be[Zt].geometry[0].shift(),Be[Zt].geometry[0]=Mt[0].concat(Be[Zt].geometry[0]),Zt}function Kt(Ot,Rt,Mt){const Zt=Mt?Rt[0][Rt[0].length-1]:Rt[0][0];return`${Ot}:${Zt.x}:${Zt.y}`}for(let Ot=0;Ot<Te.length;Ot++){const Rt=Te[Ot],Mt=Rt.geometry,Zt=Rt.text?Rt.text.toString():null;if(!Zt){nt(Ot);continue}const Dt=Kt(Zt,Mt),kt=Kt(Zt,Mt,!0);if(Dt in He&&kt in Me&&He[Dt]!==Me[kt]){const ci=Nt(Dt,kt,Mt),Qt=_t(Dt,kt,Be[ci].geometry);delete Me[Dt],delete He[kt],He[Kt(Zt,Be[Qt].geometry,!0)]=Qt,Be[ci].geometry=null}else Dt in He?_t(Dt,kt,Mt):kt in Me?Nt(Dt,kt,Mt):(nt(Ot),Me[Dt]=Ke-1,He[kt]=Ke-1)}return Be.filter(Ot=>Ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Me)=>Te.sortKey-Me.sortKey)}update(e,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,h),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const h=this.lineVertexArray.length;if(e.segment!==void 0){let m=e.dist(s[e.segment+1]),b=e.dist(s[e.segment]);const x={};for(let C=e.segment+1;C<s.length;C++)x[C]={x:s[C].x,y:s[C].y,tileUnitDistanceFromAnchor:m},C<s.length-1&&(m+=s[C+1].dist(s[C]));for(let C=e.segment||0;C>=0;C--)x[C]={x:s[C].x,y:s[C].y,tileUnitDistanceFromAnchor:b},C>0&&(b+=s[C-1].dist(s[C]));for(let C=0;C<s.length;C++){const M=x[C];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(e,s,h,m,b,x,C,M,B,U,j,H){const te=e.indexArray,re=e.layoutVertexArray,pe=e.segments.prepareSegment(4*s.length,re,te,this.canOverlap?x.sortKey:void 0),Te=this.glyphOffsetArray.length,Me=pe.vertexLength,He=this.allowVerticalPlacement&&C===n.WritingMode.vertical?Math.PI/2:0,Be=x.text&&x.text.sections;for(let Ke=0;Ke<s.length;Ke++){const{tl:nt,tr:_t,bl:Nt,br:Kt,tex:Ot,pixelOffsetTL:Rt,pixelOffsetBR:Mt,minFontScaleX:Zt,minFontScaleY:Dt,glyphOffset:kt,isSDF:ci,sectionIndex:Qt}=s[Ke],Ai=pe.vertexLength,Ji=kt[1];du(re,M.x,M.y,nt.x,Ji+nt.y,Ot.x,Ot.y,h,ci,Rt.x,Rt.y,Zt,Dt),du(re,M.x,M.y,_t.x,Ji+_t.y,Ot.x+Ot.w,Ot.y,h,ci,Mt.x,Rt.y,Zt,Dt),du(re,M.x,M.y,Nt.x,Ji+Nt.y,Ot.x,Ot.y+Ot.h,h,ci,Rt.x,Mt.y,Zt,Dt),du(re,M.x,M.y,Kt.x,Ji+Kt.y,Ot.x+Ot.w,Ot.y+Ot.h,h,ci,Mt.x,Mt.y,Zt,Dt),Gh(e.dynamicLayoutVertexArray,M,He),te.emplaceBack(Ai,Ai+1,Ai+2),te.emplaceBack(Ai+1,Ai+2,Ai+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),Ke!==s.length-1&&Qt===s[Ke+1].sectionIndex||e.programConfigurations.populatePaintArrays(re.length,x,x.index,{},H,Be&&Be[Qt])}e.placedSymbolArray.emplaceBack(M.x,M.y,Te,this.glyphOffsetArray.length-Te,Me,B,U,M.segment,h?h[0]:0,h?h[1]:0,m[0],m[1],C,0,!1,0,j)}_addCollisionDebugVertex(e,s,h,m,b,x){return s.emplaceBack(0,0),e.emplaceBack(h.x,h.y,m,b,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(e,s,h,m,b,x,C){const M=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),B=M.vertexLength,U=b.layoutVertexArray,j=b.collisionVertexArray,H=C.anchorX,te=C.anchorY;this._addCollisionDebugVertex(U,j,x,H,te,new T(e,s)),this._addCollisionDebugVertex(U,j,x,H,te,new T(h,s)),this._addCollisionDebugVertex(U,j,x,H,te,new T(h,m)),this._addCollisionDebugVertex(U,j,x,H,te,new T(e,m)),M.vertexLength+=4;const re=b.indexArray;re.emplaceBack(B,B+1),re.emplaceBack(B+1,B+2),re.emplaceBack(B+2,B+3),re.emplaceBack(B+3,B),M.primitiveLength+=4}addDebugCollisionBoxes(e,s,h,m){for(let b=e;b<s;b++){const x=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,m?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wh(Wi,Qd.members,or),this.iconCollisionBox=new Wh(Wi,Qd.members,or);for(let e=0;e<this.symbolInstances.length;e++){const s=this.symbolInstances.get(e);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(e,s,h,m,b,x,C,M,B){const U={};for(let j=s;j<h;j++){const H=e.get(j);U.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},U.textFeatureIndex=H.featureIndex;break}for(let j=m;j<b;j++){const H=e.get(j);U.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},U.verticalTextFeatureIndex=H.featureIndex;break}for(let j=x;j<C;j++){const H=e.get(j);U.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},U.iconFeatureIndex=H.featureIndex;break}for(let j=M;j<B;j++){const H=e.get(j);U.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},U.verticalIconFeatureIndex=H.featureIndex;break}return U}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const h=e.placedSymbolArray.get(s),m=h.vertexStartIndex+4*h.numGlyphs;for(let b=h.vertexStartIndex;b<m;b+=4)e.indexArray.emplaceBack(b,b+1,b+2),e.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),h=Math.cos(e),m=[],b=[],x=[];for(let C=0;C<this.symbolInstances.length;++C){x.push(C);const M=this.symbolInstances.get(C);m.push(0|Math.round(s*M.anchorX+h*M.anchorY)),b.push(M.featureIndex)}return x.sort((C,M)=>m[C]-m[M]||b[M]-b[C]),x}addToSortKeyRanges(e,s){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===s?h.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const h=this.symbolInstances.get(s);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((m,b,x)=>{m>=0&&x.indexOf(m)===b&&this.addIndicesForPlacedSymbol(this.text,m)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gp,_p;qt("SymbolBucket",Ro,{omit:["layers","collisionBoxArray","features","compareText"]}),Ro.MAX_GLYPHS=65535,Ro.addDynamicAttributes=Gh;var Kh={get paint(){return _p=_p||new Yr({"icon-opacity":new hi(ke.paint_symbol["icon-opacity"]),"icon-color":new hi(ke.paint_symbol["icon-color"]),"icon-halo-color":new hi(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new hi(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hi(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new ti(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new ti(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new hi(ke.paint_symbol["text-opacity"]),"text-color":new hi(ke.paint_symbol["text-color"],{runtimeType:xr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new hi(ke.paint_symbol["text-halo-color"]),"text-halo-width":new hi(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new hi(ke.paint_symbol["text-halo-blur"]),"text-translate":new ti(ke.paint_symbol["text-translate"]),"text-translate-anchor":new ti(ke.paint_symbol["text-translate-anchor"])})},get layout(){return gp=gp||new Yr({"symbol-placement":new ti(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new ti(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ti(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new hi(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ti(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ti(ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ti(ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ti(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new ti(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ti(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new hi(ke.layout_symbol["icon-size"]),"icon-text-fit":new ti(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ti(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new hi(ke.layout_symbol["icon-image"]),"icon-rotate":new hi(ke.layout_symbol["icon-rotate"]),"icon-padding":new hi(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new ti(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new hi(ke.layout_symbol["icon-offset"]),"icon-anchor":new hi(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ti(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ti(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ti(ke.layout_symbol["text-rotation-alignment"]),"text-field":new hi(ke.layout_symbol["text-field"]),"text-font":new hi(ke.layout_symbol["text-font"]),"text-size":new hi(ke.layout_symbol["text-size"]),"text-max-width":new hi(ke.layout_symbol["text-max-width"]),"text-line-height":new ti(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new hi(ke.layout_symbol["text-letter-spacing"]),"text-justify":new hi(ke.layout_symbol["text-justify"]),"text-radial-offset":new hi(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ti(ke.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new hi(ke.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new hi(ke.layout_symbol["text-anchor"]),"text-max-angle":new ti(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new ti(ke.layout_symbol["text-writing-mode"]),"text-rotate":new hi(ke.layout_symbol["text-rotate"]),"text-padding":new ti(ke.layout_symbol["text-padding"]),"text-keep-upright":new ti(ke.layout_symbol["text-keep-upright"]),"text-transform":new hi(ke.layout_symbol["text-transform"]),"text-offset":new hi(ke.layout_symbol["text-offset"]),"text-allow-overlap":new ti(ke.layout_symbol["text-allow-overlap"]),"text-overlap":new ti(ke.layout_symbol["text-overlap"]),"text-ignore-placement":new ti(ke.layout_symbol["text-ignore-placement"]),"text-optional":new ti(ke.layout_symbol["text-optional"])})}};class yp{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:sr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt("FormatSectionOverride",yp,{omit:["defaultValue"]});class pu extends Nn{constructor(e){super(e,Kh)}recalculate(e,s){if(super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const m=[];for(const b of h)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,s,h,m){const b=this.layout.get(e).evaluate(s,{},h,m),x=this._unevaluatedLayout._values[e];return x.isDataDriven()||po(x.value)||!b?b:function(C,M){return M.replace(/{([^{}]+)}/g,(B,U)=>U in C?String(C[U]):"")}(s.properties,b)}createBucket(e){return new Ro(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Kh.paint.overridableProperties){if(!pu.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),h=new yp(s),m=new dl(h,s.property.specification);let b=null;b=s.value.kind==="constant"||s.value.kind==="source"?new go("source",m):new _o("composite",m,s.value.zoomStops),this.paint._values[e]=new Gn(s.property,b,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,h){return!(!this.layout||s.isDataDriven()||h.isDataDriven())&&pu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const h=e.get("text-field"),m=Kh.paint.properties[s];let b=!1;const x=C=>{for(const M of C)if(m.overrides&&m.overrides.hasOverride(M))return void(b=!0)};if(h.value.kind==="constant"&&h.value.value instanceof ar)x(h.value.value.sections);else if(h.value.kind==="source"){const C=B=>{b||(B instanceof Xr&&_i(B.value)===ve?x(B.value.sections):B instanceof lo?x(B.sections):B.eachChild(C))},M=h.value;M._styleExpression&&C(M._styleExpression.expression)}return b}}let vp;var M0={get paint(){return vp=vp||new Yr({"background-color":new ti(ke.paint_background["background-color"]),"background-pattern":new Bl(ke.paint_background["background-pattern"]),"background-opacity":new ti(ke.paint_background["background-opacity"])})}};class D0 extends Nn{constructor(e){super(e,M0)}}let bp;var L0={get paint(){return bp=bp||new Yr({"raster-opacity":new ti(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new ti(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ti(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ti(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new ti(ke.paint_raster["raster-saturation"]),"raster-contrast":new ti(ke.paint_raster["raster-contrast"]),"raster-resampling":new ti(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new ti(ke.paint_raster["raster-fade-duration"])})}};class R0 extends Nn{constructor(e){super(e,L0)}}class B0 extends Nn{constructor(e){super(e,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class O0{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Xh=63710088e-1;class aa{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new aa(se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,h=this.lat*s,m=e.lat*s,b=Math.sin(h)*Math.sin(m)+Math.cos(h)*Math.cos(m)*Math.cos((e.lng-this.lng)*s);return Xh*Math.acos(Math.min(b,1))}static convert(e){if(e instanceof aa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new aa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new aa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const wp=2*Math.PI*Xh;function xp(i){return wp*Math.cos(i*Math.PI/180)}function Ep(i){return(180+i)/360}function Sp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function kp(i,e){return i/xp(e)}function Jh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class mu{constructor(e,s,h=0){this.x=+e,this.y=+s,this.z=+h}static fromLngLat(e,s=0){const h=aa.convert(e);return new mu(Ep(h.lng),Sp(h.lat),kp(s,h.lat))}toLngLat(){return new aa(360*this.x-180,Jh(this.y))}toAltitude(){return this.z*xp(Jh(this.y))}meterInMercatorCoordinateUnits(){return 1/wp*(e=Jh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Tp(i,e,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[i*h-2*Math.PI*6378137/2,e*h-2*Math.PI*6378137/2]}class Yh{constructor(e,s,h){if(e<0||e>25||h<0||h>=Math.pow(2,e)||s<0||s>=Math.pow(2,e))throw new Error(`x=${s}, y=${h}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=s,this.y=h,this.key=ec(0,e,e,s,h)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s,h){const m=(x=this.y,C=this.z,M=Tp(256*(b=this.x),256*(x=Math.pow(2,C)-x-1),C),B=Tp(256*(b+1),256*(x+1),C),M[0]+","+M[1]+","+B[0]+","+B[1]);var b,x,C,M,B;const U=function(j,H,te){let re,pe="";for(let Te=j;Te>0;Te--)re=1<<Te-1,pe+=(H&re?1:0)+(te&re?2:0);return pe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,U).replace(/{bbox-epsg-3857}/g,m)}isChildOf(e){const s=this.z-e.z;return s>0&&e.x===this.x>>s&&e.y===this.y>>s}getTilePoint(e){const s=Math.pow(2,this.z);return new T((e.x*s-this.x)*Sr,(e.y*s-this.y)*Sr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cp{constructor(e,s){this.wrap=e,this.canonical=s,this.key=ec(e,s.z,s.z,s.x,s.y)}}class Vn{constructor(e,s,h,m,b){if(e<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${h}`);this.overscaledZ=e,this.wrap=s,this.canonical=new Yh(h,+m,+b),this.key=ec(s,e,h,m,b)}clone(){return new Vn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?new Vn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vn(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-e;return e>this.canonical.z?ec(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y):ec(this.wrap*+s,e,e,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new Vn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,h=2*this.canonical.x,m=2*this.canonical.y;return[new Vn(s,this.wrap,s,h,m),new Vn(s,this.wrap,s,h+1,m),new Vn(s,this.wrap,s,h,m+1),new Vn(s,this.wrap,s,h+1,m+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Vn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Vn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new mu(e.x-this.wrap,e.y))}}function ec(i,e,s,h,m){(i*=2)<0&&(i=-1*i-1);const b=1<<s;return(b*b*i+b*m+h).toString(36)+s.toString(36)+e.toString(36)}qt("CanonicalTileID",Yh),qt("OverscaledTileID",Vn,{omit:["posMatrix"]});class Ip{constructor(e,s,h,m=1,b=1,x=1,C=0){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void Z(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const M=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=b,this.blueFactor=x,this.baseShift=C;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let B=0;B<M;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(M,B)]=this.data[this._idx(M-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,M)]=this.data[this._idx(B,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let B=0;B<M;B++)for(let U=0;U<M;U++){const j=this.get(B,U);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(e,s){const h=new Uint8Array(this.data.buffer),m=4*this._idx(e,s);return this.unpack(h[m],h[m+1],h[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}unpack(e,s,h){return e*this.redFactor+s*this.greenFactor+h*this.blueFactor-this.baseShift}getPixels(){return new Un({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,h){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let m=s*this.dim,b=s*this.dim+this.dim,x=h*this.dim,C=h*this.dim+this.dim;switch(s){case-1:m=b-1;break;case 1:b=m+1}switch(h){case-1:x=C-1;break;case 1:C=x+1}const M=-s*this.dim,B=-h*this.dim;for(let U=x;U<C;U++)for(let j=m;j<b;j++)this.data[this._idx(j,U)]=e.data[this._idx(j+M,U+B)]}}qt("DEMData",Ip);class Ap{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const h=e[s];this._stringToNumber[h]=s,this._numberToString[s]=h}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Pp{constructor(e,s,h,m,b){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=h,e._y=m,this.properties=e.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(e[s]=this[s]);return e}}class zp{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ys(Sr,16,0),this.grid3D=new Ys(Sr,16,0),this.featureIndexArray=new Pt,this.promoteId=s}insert(e,s,h,m,b,x){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,m,b);const M=x?this.grid3D:this.grid;for(let B=0;B<s.length;B++){const U=s[B],j=[1/0,1/0,-1/0,-1/0];for(let H=0;H<U.length;H++){const te=U[H];j[0]=Math.min(j[0],te.x),j[1]=Math.min(j[1],te.y),j[2]=Math.max(j[2],te.x),j[3]=Math.max(j[3],te.y)}j[0]<Sr&&j[1]<Sr&&j[2]>=0&&j[3]>=0&&M.insert(C,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ra.VectorTile(new Uh(this.rawTileData)).layers,this.sourceLayerCoder=new Ap(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,s,h,m){this.loadVTLayers();const b=e.params||{},x=Sr/e.tileSize/e.scale,C=gl(b.filter),M=e.queryGeometry,B=e.queryPadding*x,U=Dp(M),j=this.grid.query(U.minX-B,U.minY-B,U.maxX+B,U.maxY+B),H=Dp(e.cameraQueryGeometry),te=this.grid3D.query(H.minX-B,H.minY-B,H.maxX+B,H.maxY+B,(Te,Me,He,Be)=>function(Ke,nt,_t,Nt,Kt){for(const Rt of Ke)if(nt<=Rt.x&&_t<=Rt.y&&Nt>=Rt.x&&Kt>=Rt.y)return!0;const Ot=[new T(nt,_t),new T(nt,Kt),new T(Nt,Kt),new T(Nt,_t)];if(Ke.length>2){for(const Rt of Ot)if(Io(Ke,Rt))return!0}for(let Rt=0;Rt<Ke.length-1;Rt++)if(my(Ke[Rt],Ke[Rt+1],Ot))return!0;return!1}(e.cameraQueryGeometry,Te-B,Me-B,He+B,Be+B));for(const Te of te)j.push(Te);j.sort(F0);const re={};let pe;for(let Te=0;Te<j.length;Te++){const Me=j[Te];if(Me===pe)continue;pe=Me;const He=this.featureIndexArray.get(Me);let Be=null;this.loadMatchingFeature(re,He.bucketIndex,He.sourceLayerIndex,He.featureIndex,C,b.layers,b.availableImages,s,h,m,(Ke,nt,_t)=>(Be||(Be=Ra(Ke)),nt.queryIntersectsFeature(M,Ke,_t,Be,this.z,e.transform,x,e.pixelPosMatrix)))}return re}loadMatchingFeature(e,s,h,m,b,x,C,M,B,U,j){const H=this.bucketLayerIDs[s];if(x&&!function(Te,Me){for(let He=0;He<Te.length;He++)if(Me.indexOf(Te[He])>=0)return!0;return!1}(x,H))return;const te=this.sourceLayerCoder.decode(h),re=this.vtLayers[te].feature(m);if(b.needGeometry){const Te=Ba(re,!0);if(!b.filter(new Qi(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!b.filter(new Qi(this.tileID.overscaledZ),re))return;const pe=this.getId(re,te);for(let Te=0;Te<H.length;Te++){const Me=H[Te];if(x&&x.indexOf(Me)<0)continue;const He=M[Me];if(!He)continue;let Be={};pe&&U&&(Be=U.getState(He.sourceLayer||"_geojsonTileLayer",pe));const Ke=ue({},B[Me]);Ke.paint=Mp(Ke.paint,He.paint,re,Be,C),Ke.layout=Mp(Ke.layout,He.layout,re,Be,C);const nt=!j||j(re,He,Be);if(!nt)continue;const _t=new Pp(re,this.z,this.x,this.y,pe);_t.layer=Ke;let Nt=e[Me];Nt===void 0&&(Nt=e[Me]=[]),Nt.push({featureIndex:m,feature:_t,intersectionZ:nt})}}lookupSymbolFeatures(e,s,h,m,b,x,C,M){const B={};this.loadVTLayers();const U=gl(b);for(const j of e)this.loadMatchingFeature(B,h,m,j,U,x,C,M,s);return B}hasLayer(e){for(const s of this.bucketLayerIDs)for(const h of s)if(e===h)return!0;return!1}getId(e,s){let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof h=="boolean"&&(h=Number(h))),h}}function Mp(i,e,s,h,m){return ye(i,(b,x)=>{const C=e instanceof wo?e.get(x):null;return C&&C.evaluate?C.evaluate(s,h,m):C})}function Dp(i){let e=1/0,s=1/0,h=-1/0,m=-1/0;for(const b of i)e=Math.min(e,b.x),s=Math.min(s,b.y),h=Math.max(h,b.x),m=Math.max(m,b.y);return{minX:e,minY:s,maxX:h,maxY:m}}function F0(i,e){return e-i}function Lp(i,e,s,h,m){const b=[];for(let x=0;x<i.length;x++){const C=i[x];let M;for(let B=0;B<C.length-1;B++){let U=C[B],j=C[B+1];U.x<e&&j.x<e||(U.x<e?U=new T(e,U.y+(e-U.x)/(j.x-U.x)*(j.y-U.y))._round():j.x<e&&(j=new T(e,U.y+(e-U.x)/(j.x-U.x)*(j.y-U.y))._round()),U.y<s&&j.y<s||(U.y<s?U=new T(U.x+(s-U.y)/(j.y-U.y)*(j.x-U.x),s)._round():j.y<s&&(j=new T(U.x+(s-U.y)/(j.y-U.y)*(j.x-U.x),s)._round()),U.x>=h&&j.x>=h||(U.x>=h?U=new T(h,U.y+(h-U.x)/(j.x-U.x)*(j.y-U.y))._round():j.x>=h&&(j=new T(h,U.y+(h-U.x)/(j.x-U.x)*(j.y-U.y))._round()),U.y>=m&&j.y>=m||(U.y>=m?U=new T(U.x+(m-U.y)/(j.y-U.y)*(j.x-U.x),m)._round():j.y>=m&&(j=new T(U.x+(m-U.y)/(j.y-U.y)*(j.x-U.x),m)._round()),M&&U.equals(M[M.length-1])||(M=[U],b.push(M)),M.push(j)))))}}return b}qt("FeatureIndex",zp,{omit:["rawTileData","sourceLayerCoder"]});class oa extends T{constructor(e,s,h,m){super(e,s),this.angle=h,m!==void 0&&(this.segment=m)}clone(){return new oa(this.x,this.y,this.angle,this.segment)}}function Rp(i,e,s,h,m){if(e.segment===void 0||s===0)return!0;let b=e,x=e.segment+1,C=0;for(;C>-s/2;){if(x--,x<0)return!1;C-=i[x].dist(b),b=i[x]}C+=i[x].dist(i[x+1]),x++;const M=[];let B=0;for(;C<s/2;){const U=i[x],j=i[x+1];if(!j)return!1;let H=i[x-1].angleTo(U)-U.angleTo(j);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:C,angleDelta:H}),B+=H;C-M[0].distance>h;)B-=M.shift().angleDelta;if(B>m)return!1;x++,C+=U.dist(j)}return!0}function Bp(i){let e=0;for(let s=0;s<i.length-1;s++)e+=i[s].dist(i[s+1]);return e}function Op(i,e,s){return i?.6*e*s:0}function Fp(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function N0(i,e,s,h,m,b){const x=Op(s,m,b),C=Fp(s,h)*b;let M=0;const B=Bp(i)/2;for(let U=0;U<i.length-1;U++){const j=i[U],H=i[U+1],te=j.dist(H);if(M+te>B){const re=(B-M)/te,pe=yn.number(j.x,H.x,re),Te=yn.number(j.y,H.y,re),Me=new oa(pe,Te,H.angleTo(j),U);return Me._round(),!x||Rp(i,Me,C,x,e)?Me:void 0}M+=te}}function U0(i,e,s,h,m,b,x,C,M){const B=Op(h,b,x),U=Fp(h,m),j=U*x,H=i[0].x===0||i[0].x===M||i[0].y===0||i[0].y===M;return e-j<e/4&&(e=j+e/4),Np(i,H?e/2*C%e:(U/2+2*b)*x*C%e,e,B,s,j,H,!1,M)}function Np(i,e,s,h,m,b,x,C,M){const B=b/2,U=Bp(i);let j=0,H=e-s,te=[];for(let re=0;re<i.length-1;re++){const pe=i[re],Te=i[re+1],Me=pe.dist(Te),He=Te.angleTo(pe);for(;H+s<j+Me;){H+=s;const Be=(H-j)/Me,Ke=yn.number(pe.x,Te.x,Be),nt=yn.number(pe.y,Te.y,Be);if(Ke>=0&&Ke<M&&nt>=0&&nt<M&&H-B>=0&&H+B<=U){const _t=new oa(Ke,nt,He,re);_t._round(),h&&!Rp(i,_t,b,h,m)||te.push(_t)}}j+=Me}return C||te.length||x||(te=Np(i,j/2,s,h,m,b,x,!0,M)),te}qt("Anchor",oa);const Bo=Tn;function Up(i,e,s,h){const m=[],b=i.image,x=b.pixelRatio,C=b.paddedRect.w-2*Bo,M=b.paddedRect.h-2*Bo,B=i.right-i.left,U=i.bottom-i.top,j=b.stretchX||[[0,C]],H=b.stretchY||[[0,M]],te=(Mt,Zt)=>Mt+Zt[1]-Zt[0],re=j.reduce(te,0),pe=H.reduce(te,0),Te=C-re,Me=M-pe;let He=0,Be=re,Ke=0,nt=pe,_t=0,Nt=Te,Kt=0,Ot=Me;if(b.content&&h){const Mt=b.content;He=gu(j,0,Mt[0]),Ke=gu(H,0,Mt[1]),Be=gu(j,Mt[0],Mt[2]),nt=gu(H,Mt[1],Mt[3]),_t=Mt[0]-He,Kt=Mt[1]-Ke,Nt=Mt[2]-Mt[0]-Be,Ot=Mt[3]-Mt[1]-nt}const Rt=(Mt,Zt,Dt,kt)=>{const ci=_u(Mt.stretch-He,Be,B,i.left),Qt=yu(Mt.fixed-_t,Nt,Mt.stretch,re),Ai=_u(Zt.stretch-Ke,nt,U,i.top),Ji=yu(Zt.fixed-Kt,Ot,Zt.stretch,pe),rr=_u(Dt.stretch-He,Be,B,i.left),Lr=yu(Dt.fixed-_t,Nt,Dt.stretch,re),Ln=_u(kt.stretch-Ke,nt,U,i.top),hn=yu(kt.fixed-Kt,Ot,kt.stretch,pe),kr=new T(ci,Ai),jr=new T(rr,Ai),Hr=new T(rr,Ln),fn=new T(ci,Ln),dn=new T(Qt/x,Ji/x),Rr=new T(Lr/x,hn/x),Br=e*Math.PI/180;if(Br){const tn=Math.sin(Br),Cn=Math.cos(Br),In=[Cn,-tn,tn,Cn];kr._matMult(In),jr._matMult(In),fn._matMult(In),Hr._matMult(In)}const en=Mt.stretch+Mt.fixed,pn=Zt.stretch+Zt.fixed;return{tl:kr,tr:jr,bl:fn,br:Hr,tex:{x:b.paddedRect.x+Bo+en,y:b.paddedRect.y+Bo+pn,w:Dt.stretch+Dt.fixed-en,h:kt.stretch+kt.fixed-pn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:dn,pixelOffsetBR:Rr,minFontScaleX:Nt/x/B,minFontScaleY:Ot/x/U,isSDF:s}};if(h&&(b.stretchX||b.stretchY)){const Mt=Vp(j,Te,re),Zt=Vp(H,Me,pe);for(let Dt=0;Dt<Mt.length-1;Dt++){const kt=Mt[Dt],ci=Mt[Dt+1];for(let Qt=0;Qt<Zt.length-1;Qt++)m.push(Rt(kt,Zt[Qt],ci,Zt[Qt+1]))}}else m.push(Rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:M+1}));return m}function gu(i,e,s){let h=0;for(const m of i)h+=Math.max(e,Math.min(s,m[1]))-Math.max(e,Math.min(s,m[0]));return h}function Vp(i,e,s){const h=[{fixed:-Bo,stretch:0}];for(const[m,b]of i){const x=h[h.length-1];h.push({fixed:m-x.stretch,stretch:x.stretch}),h.push({fixed:m-x.stretch,stretch:x.stretch+(b-m)})}return h.push({fixed:e+Bo,stretch:s}),h}function _u(i,e,s,h){return i/e*s+h}function yu(i,e,s,h){return i-e*s/h}class vu{constructor(e,s,h,m,b,x,C,M,B,U){if(this.boxStartIndex=e.length,B){let j=x.top,H=x.bottom;const te=x.collisionPadding;te&&(j-=te[1],H+=te[3]);let re=H-j;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{let j=x.top*C-M[0],H=x.bottom*C+M[2],te=x.left*C-M[3],re=x.right*C+M[1];const pe=x.collisionPadding;if(pe&&(te-=pe[0]*C,j-=pe[1]*C,re+=pe[2]*C,H+=pe[3]*C),U){const Te=new T(te,j),Me=new T(re,j),He=new T(te,H),Be=new T(re,H),Ke=U*Math.PI/180;Te._rotate(Ke),Me._rotate(Ke),He._rotate(Ke),Be._rotate(Ke),te=Math.min(Te.x,Me.x,He.x,Be.x),re=Math.max(Te.x,Me.x,He.x,Be.x),j=Math.min(Te.y,Me.y,He.y,Be.y),H=Math.max(Te.y,Me.y,He.y,Be.y)}e.emplaceBack(s.x,s.y,te,j,re,H,h,m,b)}this.boxEndIndex=e.length}}class V0{constructor(e=[],s=$0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:h}=this,m=s[e];for(;e>0;){const b=e-1>>1,x=s[b];if(h(m,x)>=0)break;s[e]=x,e=b}s[e]=m}_down(e){const{data:s,compare:h}=this,m=this.length>>1,b=s[e];for(;e<m;){let x=1+(e<<1),C=s[x];const M=x+1;if(M<this.length&&h(s[M],C)<0&&(x=M,C=s[M]),h(C,b)>=0)break;s[e]=C,e=x}s[e]=b}}function $0(i,e){return i<e?-1:i>e?1:0}function j0(i,e=1,s=!1){let h=1/0,m=1/0,b=-1/0,x=-1/0;const C=i[0];for(let te=0;te<C.length;te++){const re=C[te];(!te||re.x<h)&&(h=re.x),(!te||re.y<m)&&(m=re.y),(!te||re.x>b)&&(b=re.x),(!te||re.y>x)&&(x=re.y)}const M=Math.min(b-h,x-m);let B=M/2;const U=new V0([],q0);if(M===0)return new T(h,m);for(let te=h;te<b;te+=M)for(let re=m;re<x;re+=M)U.push(new Oo(te+B,re+B,B,i));let j=function(te){let re=0,pe=0,Te=0;const Me=te[0];for(let He=0,Be=Me.length,Ke=Be-1;He<Be;Ke=He++){const nt=Me[He],_t=Me[Ke],Nt=nt.x*_t.y-_t.x*nt.y;pe+=(nt.x+_t.x)*Nt,Te+=(nt.y+_t.y)*Nt,re+=3*Nt}return new Oo(pe/re,Te/re,0,te)}(i),H=U.length;for(;U.length;){const te=U.pop();(te.d>j.d||!j.d)&&(j=te,s&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,H)),te.max-j.d<=e||(B=te.h/2,U.push(new Oo(te.p.x-B,te.p.y-B,B,i)),U.push(new Oo(te.p.x+B,te.p.y-B,B,i)),U.push(new Oo(te.p.x-B,te.p.y+B,B,i)),U.push(new Oo(te.p.x+B,te.p.y+B,B,i)),H+=4)}return s&&(console.log(`num probes: ${H}`),console.log(`best distance: ${j.d}`)),j.p}function q0(i,e){return e.max-i.max}function Oo(i,e,s,h){this.p=new T(i,e),this.h=s,this.d=function(m,b){let x=!1,C=1/0;for(let M=0;M<b.length;M++){const B=b[M];for(let U=0,j=B.length,H=j-1;U<j;H=U++){const te=B[U],re=B[H];te.y>m.y!=re.y>m.y&&m.x<(re.x-te.x)*(m.y-te.y)/(re.y-te.y)+te.x&&(x=!x),C=Math.min(C,Sd(m,te,re))}}return(x?1:-1)*Math.sqrt(C)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Gr;n.TextAnchorEnum=void 0,(Gr=n.TextAnchorEnum||(n.TextAnchorEnum={}))[Gr.center=1]="center",Gr[Gr.left=2]="left",Gr[Gr.right=3]="right",Gr[Gr.top=4]="top",Gr[Gr.bottom=5]="bottom",Gr[Gr["top-left"]=6]="top-left",Gr[Gr["top-right"]=7]="top-right",Gr[Gr["bottom-left"]=8]="bottom-left",Gr[Gr["bottom-right"]=9]="bottom-right";const la=7,Qh=Number.POSITIVE_INFINITY;function $p(i,e){return e[1]!==Qh?function(s,h,m){let b=0,x=0;switch(h=Math.abs(h),m=Math.abs(m),s){case"top-right":case"top-left":case"top":x=m-la;break;case"bottom-right":case"bottom-left":case"bottom":x=-m+la}switch(s){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,x]}(i,e[0],e[1]):function(s,h){let m=0,b=0;h<0&&(h=0);const x=h/Math.SQRT2;switch(s){case"top-right":case"top-left":b=x-la;break;case"bottom-right":case"bottom-left":b=-x+la;break;case"bottom":b=-h+la;break;case"top":b=h-la}switch(s){case"top-right":case"bottom-right":m=-x;break;case"top-left":case"bottom-left":m=x;break;case"left":m=h;break;case"right":m=-h}return[m,b]}(i,e[0])}function jp(i,e,s){var h;const m=i.layout,b=(h=m.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(e,{},s);if(b){const C=b.values,M=[];for(let B=0;B<C.length;B+=2){const U=M[B]=C[B],j=C[B+1].map(H=>H*Dr);U.startsWith("top")?j[1]-=la:U.startsWith("bottom")&&(j[1]+=la),M[B+1]=j}return new Er(M)}const x=m.get("text-variable-anchor");if(x){let C;C=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(e,{},s)*Dr,Qh]:m.get("text-offset").evaluate(e,{},s).map(B=>B*Dr);const M=[];for(const B of x)M.push(B,$p(B,C));return new Er(M)}return null}function ef(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Z0(i,e,s,h,m,b,x,C,M,B,U){let j=b.textMaxSize.evaluate(e,{});j===void 0&&(j=x);const H=i.layers[0].layout,te=H.get("icon-offset").evaluate(e,{},U),re=Zp(s.horizontal),pe=x/24,Te=i.tilePixelRatio*pe,Me=i.tilePixelRatio*j/24,He=i.tilePixelRatio*C,Be=i.tilePixelRatio*H.get("symbol-spacing"),Ke=H.get("text-padding")*i.tilePixelRatio,nt=function(kt,ci,Qt,Ai=1){const Ji=kt.get("icon-padding").evaluate(ci,{},Qt),rr=Ji&&Ji.values;return[rr[0]*Ai,rr[1]*Ai,rr[2]*Ai,rr[3]*Ai]}(H,e,U,i.tilePixelRatio),_t=H.get("text-max-angle")/180*Math.PI,Nt=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",Kt=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",Ot=H.get("symbol-placement"),Rt=Be/2,Mt=H.get("icon-text-fit");let Zt;h&&Mt!=="none"&&(i.allowVerticalPlacement&&s.vertical&&(Zt=pp(h,s.vertical,Mt,H.get("icon-text-fit-padding"),te,pe)),re&&(h=pp(h,re,Mt,H.get("icon-text-fit-padding"),te,pe)));const Dt=(kt,ci)=>{ci.x<0||ci.x>=Sr||ci.y<0||ci.y>=Sr||function(Qt,Ai,Ji,rr,Lr,Ln,hn,kr,jr,Hr,fn,dn,Rr,Br,en,pn,tn,Cn,In,Or,Di,rn,Wr,Fr,Xn){const os=Qt.addToLineVertexArray(Ai,Ji);let ls,Bs,Jn,$n,An=0,Os=0,rc=0,Kp=0,cf=-1,uf=-1;const Fs={};let Xp=gr("");if(Qt.allowVerticalPlacement&&rr.vertical){const nn=kr.layout.get("text-rotate").evaluate(Di,{},Fr)+90;Jn=new vu(jr,Ai,Hr,fn,dn,rr.vertical,Rr,Br,en,nn),hn&&($n=new vu(jr,Ai,Hr,fn,dn,hn,tn,Cn,en,nn))}if(Lr){const nn=kr.layout.get("icon-rotate").evaluate(Di,{}),jn=kr.layout.get("icon-text-fit")!=="none",Fa=Up(Lr,nn,Wr,jn),us=hn?Up(hn,nn,Wr,jn):void 0;Bs=new vu(jr,Ai,Hr,fn,dn,Lr,tn,Cn,!1,nn),An=4*Fa.length;const Na=Qt.iconSizeData;let ks=null;Na.kind==="source"?(ks=[Ss*kr.layout.get("icon-size").evaluate(Di,{})],ks[0]>sa&&Z(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${Ql}. Reduce your "icon-size".`)):Na.kind==="composite"&&(ks=[Ss*rn.compositeIconSizes[0].evaluate(Di,{},Fr),Ss*rn.compositeIconSizes[1].evaluate(Di,{},Fr)],(ks[0]>sa||ks[1]>sa)&&Z(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${Ql}. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,Fa,ks,Or,In,Di,n.WritingMode.none,Ai,os.lineStartIndex,os.lineLength,-1,Fr),cf=Qt.icon.placedSymbolArray.length-1,us&&(Os=4*us.length,Qt.addSymbols(Qt.icon,us,ks,Or,In,Di,n.WritingMode.vertical,Ai,os.lineStartIndex,os.lineLength,-1,Fr),uf=Qt.icon.placedSymbolArray.length-1)}const Jp=Object.keys(rr.horizontal);for(const nn of Jp){const jn=rr.horizontal[nn];if(!ls){Xp=gr(jn.text);const us=kr.layout.get("text-rotate").evaluate(Di,{},Fr);ls=new vu(jr,Ai,Hr,fn,dn,jn,Rr,Br,en,us)}const Fa=jn.positionedLines.length===1;if(rc+=qp(Qt,Ai,jn,Ln,kr,en,Di,pn,os,rr.vertical?n.WritingMode.horizontal:n.WritingMode.horizontalOnly,Fa?Jp:[nn],Fs,cf,rn,Fr),Fa)break}rr.vertical&&(Kp+=qp(Qt,Ai,rr.vertical,Ln,kr,en,Di,pn,os,n.WritingMode.vertical,["vertical"],Fs,uf,rn,Fr));const W0=ls?ls.boxStartIndex:Qt.collisionBoxArray.length,K0=ls?ls.boxEndIndex:Qt.collisionBoxArray.length,X0=Jn?Jn.boxStartIndex:Qt.collisionBoxArray.length,J0=Jn?Jn.boxEndIndex:Qt.collisionBoxArray.length,Y0=Bs?Bs.boxStartIndex:Qt.collisionBoxArray.length,Q0=Bs?Bs.boxEndIndex:Qt.collisionBoxArray.length,e1=$n?$n.boxStartIndex:Qt.collisionBoxArray.length,t1=$n?$n.boxEndIndex:Qt.collisionBoxArray.length;let cs=-1;const wu=(nn,jn)=>nn&&nn.circleDiameter?Math.max(nn.circleDiameter,jn):jn;cs=wu(ls,cs),cs=wu(Jn,cs),cs=wu(Bs,cs),cs=wu($n,cs);const Yp=cs>-1?1:0;Yp&&(cs*=Xn/Dr),Qt.glyphOffsetArray.length>=Ro.MAX_GLYPHS&&Z("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Di.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,Di.sortKey);const i1=jp(kr,Di,Fr),[r1,n1]=function(nn,jn){const Fa=nn.length,us=jn==null?void 0:jn.values;if((us==null?void 0:us.length)>0)for(let Na=0;Na<us.length;Na+=2){const ks=us[Na+1];nn.emplaceBack(n.TextAnchorEnum[us[Na]],ks[0],ks[1])}return[Fa,nn.length]}(Qt.textAnchorOffsets,i1);Qt.symbolInstances.emplaceBack(Ai.x,Ai.y,Fs.right>=0?Fs.right:-1,Fs.center>=0?Fs.center:-1,Fs.left>=0?Fs.left:-1,Fs.vertical||-1,cf,uf,Xp,W0,K0,X0,J0,Y0,Q0,e1,t1,Hr,rc,Kp,An,Os,Yp,0,Rr,cs,r1,n1)}(i,ci,kt,s,h,m,Zt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Te,[Ke,Ke,Ke,Ke],Nt,M,He,nt,Kt,te,e,b,B,U,x)};if(Ot==="line")for(const kt of Lp(e.geometry,0,0,Sr,Sr)){const ci=U0(kt,Be,_t,s.vertical||re,h,24,Me,i.overscaling,Sr);for(const Qt of ci)re&&G0(i,re.text,Rt,Qt)||Dt(kt,Qt)}else if(Ot==="line-center"){for(const kt of e.geometry)if(kt.length>1){const ci=N0(kt,_t,s.vertical||re,h,24,Me);ci&&Dt(kt,ci)}}else if(e.type==="Polygon")for(const kt of Mh(e.geometry,0)){const ci=j0(kt,16);Dt(kt[0],new oa(ci.x,ci.y,0))}else if(e.type==="LineString")for(const kt of e.geometry)Dt(kt,new oa(kt[0].x,kt[0].y,0));else if(e.type==="Point")for(const kt of e.geometry)for(const ci of kt)Dt([ci],new oa(ci.x,ci.y,0))}function qp(i,e,s,h,m,b,x,C,M,B,U,j,H,te,re){const pe=function(He,Be,Ke,nt,_t,Nt,Kt,Ot){const Rt=nt.layout.get("text-rotate").evaluate(Nt,{})*Math.PI/180,Mt=[];for(const Zt of Be.positionedLines)for(const Dt of Zt.positionedGlyphs){if(!Dt.rect)continue;const kt=Dt.rect||{};let ci=op+1,Qt=!0,Ai=1,Ji=0;const rr=(_t||Ot)&&Dt.vertical,Lr=Dt.metrics.advance*Dt.scale/2;if(Ot&&Be.verticalizable&&(Ji=Zt.lineOffset/2-(Dt.imageName?-(Dr-Dt.metrics.width*Dt.scale)/2:(Dt.scale-1)*Dr)),Dt.imageName){const Or=Kt[Dt.imageName];Qt=Or.sdf,Ai=Or.pixelRatio,ci=Tn/Ai}const Ln=_t?[Dt.x+Lr,Dt.y]:[0,0];let hn=_t?[0,0]:[Dt.x+Lr+Ke[0],Dt.y+Ke[1]-Ji],kr=[0,0];rr&&(kr=hn,hn=[0,0]);const jr=Dt.metrics.isDoubleResolution?2:1,Hr=(Dt.metrics.left-ci)*Dt.scale-Lr+hn[0],fn=(-Dt.metrics.top-ci)*Dt.scale+hn[1],dn=Hr+kt.w/jr*Dt.scale/Ai,Rr=fn+kt.h/jr*Dt.scale/Ai,Br=new T(Hr,fn),en=new T(dn,fn),pn=new T(Hr,Rr),tn=new T(dn,Rr);if(rr){const Or=new T(-Lr,Lr-Jl),Di=-Math.PI/2,rn=Dr/2-Lr,Wr=new T(5-Jl-rn,-(Dt.imageName?rn:0)),Fr=new T(...kr);Br._rotateAround(Di,Or)._add(Wr)._add(Fr),en._rotateAround(Di,Or)._add(Wr)._add(Fr),pn._rotateAround(Di,Or)._add(Wr)._add(Fr),tn._rotateAround(Di,Or)._add(Wr)._add(Fr)}if(Rt){const Or=Math.sin(Rt),Di=Math.cos(Rt),rn=[Di,-Or,Or,Di];Br._matMult(rn),en._matMult(rn),pn._matMult(rn),tn._matMult(rn)}const Cn=new T(0,0),In=new T(0,0);Mt.push({tl:Br,tr:en,bl:pn,br:tn,tex:kt,writingMode:Be.writingMode,glyphOffset:Ln,sectionIndex:Dt.sectionIndex,isSDF:Qt,pixelOffsetTL:Cn,pixelOffsetBR:In,minFontScaleX:0,minFontScaleY:0})}return Mt}(0,s,C,m,b,x,h,i.allowVerticalPlacement),Te=i.textSizeData;let Me=null;Te.kind==="source"?(Me=[Ss*m.layout.get("text-size").evaluate(x,{})],Me[0]>sa&&Z(`${i.layerIds[0]}: Value for "text-size" is >= ${Ql}. Reduce your "text-size".`)):Te.kind==="composite"&&(Me=[Ss*te.compositeTextSizes[0].evaluate(x,{},re),Ss*te.compositeTextSizes[1].evaluate(x,{},re)],(Me[0]>sa||Me[1]>sa)&&Z(`${i.layerIds[0]}: Value for "text-size" is >= ${Ql}. Reduce your "text-size".`)),i.addSymbols(i.text,pe,Me,C,b,x,B,e,M.lineStartIndex,M.lineLength,H,re);for(const He of U)j[He]=i.text.placedSymbolArray.length-1;return 4*pe.length}function Zp(i){for(const e in i)return i[e];return null}function G0(i,e,s,h){const m=i.compareText;if(e in m){const b=m[e];for(let x=b.length-1;x>=0;x--)if(h.dist(b[x])<s)return!0}else m[e]=[];return m[e].push(h),!1}const Gp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class tf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,h]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=h>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const b=Gp[15&h];if(!b)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(e,2,1),[C]=new Uint32Array(e,4,1);return new tf(C,x,b,e)}constructor(e,s=64,h=Float64Array,m){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=h,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const b=Gp.indexOf(this.ArrayType),x=2*e*this.ArrayType.BYTES_PER_ELEMENT,C=e*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-C%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${h}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+C+M,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+x+C+M),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+C+M,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=e,this.coords[this._pos++]=s,h}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return rf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:x,nodeSize:C}=this,M=[0,b.length-1,0],B=[];for(;M.length;){const U=M.pop()||0,j=M.pop()||0,H=M.pop()||0;if(j-H<=C){for(let Te=H;Te<=j;Te++){const Me=x[2*Te],He=x[2*Te+1];Me>=e&&Me<=h&&He>=s&&He<=m&&B.push(b[Te])}continue}const te=H+j>>1,re=x[2*te],pe=x[2*te+1];re>=e&&re<=h&&pe>=s&&pe<=m&&B.push(b[te]),(U===0?e<=re:s<=pe)&&(M.push(H),M.push(te-1),M.push(1-U)),(U===0?h>=re:m>=pe)&&(M.push(te+1),M.push(j),M.push(1-U))}return B}within(e,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:b,nodeSize:x}=this,C=[0,m.length-1,0],M=[],B=h*h;for(;C.length;){const U=C.pop()||0,j=C.pop()||0,H=C.pop()||0;if(j-H<=x){for(let Te=H;Te<=j;Te++)Wp(b[2*Te],b[2*Te+1],e,s)<=B&&M.push(m[Te]);continue}const te=H+j>>1,re=b[2*te],pe=b[2*te+1];Wp(re,pe,e,s)<=B&&M.push(m[te]),(U===0?e-h<=re:s-h<=pe)&&(C.push(H),C.push(te-1),C.push(1-U)),(U===0?e+h>=re:s+h>=pe)&&(C.push(te+1),C.push(j),C.push(1-U))}return M}}function rf(i,e,s,h,m,b){if(m-h<=s)return;const x=h+m>>1;Hp(i,e,x,h,m,b),rf(i,e,s,h,x-1,1-b),rf(i,e,s,x+1,m,1-b)}function Hp(i,e,s,h,m,b){for(;m>h;){if(m-h>600){const B=m-h+1,U=s-h+1,j=Math.log(B),H=.5*Math.exp(2*j/3),te=.5*Math.sqrt(j*H*(B-H)/B)*(U-B/2<0?-1:1);Hp(i,e,s,Math.max(h,Math.floor(s-U*H/B+te)),Math.min(m,Math.floor(s+(B-U)*H/B+te)),b)}const x=e[2*s+b];let C=h,M=m;for(tc(i,e,h,s),e[2*m+b]>x&&tc(i,e,h,m);C<M;){for(tc(i,e,C,M),C++,M--;e[2*C+b]<x;)C++;for(;e[2*M+b]>x;)M--}e[2*h+b]===x?tc(i,e,h,M):(M++,tc(i,e,M,m)),M<=s&&(h=M+1),s<=M&&(m=M-1)}}function tc(i,e,s,h){nf(i,s,h),nf(e,2*s,2*h),nf(e,2*s+1,2*h+1)}function nf(i,e,s){const h=i[e];i[e]=i[s],i[s]=h}function Wp(i,e,s,h){const m=i-s,b=e-h;return m*m+b*b}var sf;n.PerformanceMarkers=void 0,(sf=n.PerformanceMarkers||(n.PerformanceMarkers={})).create="create",sf.load="load",sf.fullLoad="fullLoad";let bu=null,ic=[];const af=1e3/60,of="loadTime",lf="fullLoadTime",H0={mark(i){performance.mark(i)},frame(i){const e=i;bu!=null&&ic.push(e-bu),bu=e},clearMetrics(){bu=null,ic=[],performance.clearMeasures(of),performance.clearMeasures(lf);for(const i in n.PerformanceMarkers)performance.clearMarks(n.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure(of,n.PerformanceMarkers.create,n.PerformanceMarkers.load),performance.measure(lf,n.PerformanceMarkers.create,n.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName(of)[0].duration,e=performance.getEntriesByName(lf)[0].duration,s=ic.length,h=1/(ic.reduce((b,x)=>b+x,0)/s/1e3),m=ic.filter(b=>b>af).reduce((b,x)=>b+(x-af)/af,0);return{loadTime:i,fullLoadTime:e,fps:h,percentDroppedFrames:m/(s+m)*100,totalFrames:s}}};n.AJAXError=It,n.ARRAY_TYPE=Ao,n.Actor=class{constructor(i,e,s){this.receive=h=>{const m=h.data,b=m.id;if(b&&(!m.targetMapId||this.mapId===m.targetMapId))if(m.type==="<cancel>"){delete this.tasks[b];const x=this.cancelCallbacks[b];delete this.cancelCallbacks[b],x&&x()}else ft()||m.mustQueue?(this.tasks[b]=m,this.taskQueue.push(b),this.invoker.trigger()):this.processTask(b,m)},this.process=()=>{if(!this.taskQueue.length)return;const h=this.taskQueue.shift(),m=this.tasks[h];delete this.tasks[h],this.taskQueue.length&&this.invoker.trigger(),m&&this.processTask(h,m)},this.target=i,this.parent=e,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new O0(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ft()?i:window}send(i,e,s,h,m=!1){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[b]=s);const x=ut(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:i,hasCallback:!!s,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:Qs(e,x)},x),{cancel:()=>{s&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const s=this.callbacks[i];delete this.callbacks[i],s&&(e.error?s(Ia(e.error)):s(null,Ia(e.data)))}else{let s=!1;const h=ut(this.globalScope)?void 0:[],m=e.hasCallback?(C,M)=>{s=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:C?Qs(C):null,data:Qs(M,h)},h)}:C=>{s=!0};let b=null;const x=Ia(e.data);if(this.parent[e.type])b=this.parent[e.type](e.sourceMapId,x,m);else if(this.parent.getWorkerSource){const C=e.type.split(".");b=this.parent.getWorkerSource(e.sourceMapId,C[0],x.source)[C[1]](x,m)}else m(new Error(`Could not find function ${e.type}`));!s&&b&&b.cancel&&(this.cancelCallbacks[i]=b.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},n.AlphaImage=jl,n.CanonicalTileID=Yh,n.CollisionBoxArray=fe,n.CollisionCircleLayoutArray=class extends _{},n.Color=Ti,n.DEMData=Ip,n.DataConstantProperty=ti,n.DictionaryCoder=Ap,n.EXTENT=Sr,n.ErrorEvent=Ne,n.EvaluationParameters=Qi,n.Event=me,n.Evented=ht,n.FeatureIndex=zp,n.FillBucket=Rh,n.FillExtrusionBucket=Oh,n.GeoJSONFeature=Pp,n.ImageAtlas=cp,n.ImagePosition=$h,n.KDBush=tf,n.LineBucket=Fh,n.LineStripIndexArray=class extends ge{},n.LngLat=aa,n.MercatorCoordinate=mu,n.ONE_EM=Dr,n.OverscaledTileID=Vn,n.PerformanceUtils=H0,n.Point=T,n.Pos3dArray=class extends bs{},n.PosArray=Wt,n.Properties=Yr,n.Protobuf=Uh,n.QuadTriangleArray=class extends I{},n.RGBAImage=Un,n.RasterBoundsArray=class extends Fl{},n.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},n.SegmentVector=ir,n.SymbolBucket=Ro,n.Transitionable=Kc,n.TriangleIndexArray=hr,n.Uniform1f=To,n.Uniform1i=class extends Ds{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},n.Uniform2f=class extends Ds{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},n.Uniform3f=class extends Ds{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},n.Uniform4f=Qc,n.UniformColor=eu,n.UniformMatrix4f=class extends Ds{constructor(i,e){super(i,e),this.current=bh}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},n.UnwrappedTileID=Cp,n.ValidationError=vt,n.ZoomHistory=kl,n.__awaiter=g,n.addDynamicAttributes=Gh,n.arrayBufferToImage=function(i,e){const s=new Image;s.onload=()=>{e(null,s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=le})},s.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(h):le},n.arrayBufferToImageBitmap=function(i,e){const s=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(s).then(h=>{e(null,h)}).catch(h=>{e(new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},n.asyncAll=function(i,e,s){if(!i.length)return s(null,[]);let h=i.length;const m=new Array(i.length);let b=null;i.forEach((x,C)=>{e(x,(M,B)=>{M&&(b=M),m[C]=B,--h==0&&s(b,m)})})},n.bezier=ee,n.browser=Ct,n.clamp=ne,n.clipLine=Lp,n.clone=function(i){var e=new Ao(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},n.clone$1=ae,n.collisionCircleLayout=h0,n.config=bt,n.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},n.create=function(){var i=new Ao(16);return Ao!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},n.createExpression=mo,n.createFilter=gl,n.createLayout=er,n.createStyleLayer=function(i){if(i.type==="custom")return new B0(i);switch(i.type){case"background":return new D0(i);case"circle":return new yy(i);case"fill":return new Fy(i);case"fill-extrusion":return new Qy(i);case"heatmap":return new by(i);case"hillshade":return new xy(i);case"line":return new o0(i);case"raster":return new R0(i);case"symbol":return new pu(i)}},n.deepEqual=function i(e,s){if(Array.isArray(e)){if(!Array.isArray(s)||e.length!==s.length)return!1;for(let h=0;h<e.length;h++)if(!i(e[h],s[h]))return!1;return!0}if(typeof e=="object"&&e!==null&&s!==null){if(typeof s!="object"||Object.keys(e).length!==Object.keys(s).length)return!1;for(const h in e)if(!i(e[h],s[h]))return!1;return!0}return e===s},n.defaultEasing=ie,n.derefLayers=function(i){i=i.slice();const e=Object.create(null);for(let s=0;s<i.length;s++)e[i[s].id]=i[s];for(let s=0;s<i.length;s++)"ref"in i[s]&&(i[s]=xt(i[s],e[i[s].ref]));return i},n.diffStyles=function(i,e){if(!i)return[{command:dt.setStyle,args:[e]}];let s=[];try{if(!Tt(i.version,e.version))return[{command:dt.setStyle,args:[e]}];Tt(i.center,e.center)||s.push({command:dt.setCenter,args:[e.center]}),Tt(i.zoom,e.zoom)||s.push({command:dt.setZoom,args:[e.zoom]}),Tt(i.bearing,e.bearing)||s.push({command:dt.setBearing,args:[e.bearing]}),Tt(i.pitch,e.pitch)||s.push({command:dt.setPitch,args:[e.pitch]}),Tt(i.sprite,e.sprite)||s.push({command:dt.setSprite,args:[e.sprite]}),Tt(i.glyphs,e.glyphs)||s.push({command:dt.setGlyphs,args:[e.glyphs]}),Tt(i.transition,e.transition)||s.push({command:dt.setTransition,args:[e.transition]}),Tt(i.light,e.light)||s.push({command:dt.setLight,args:[e.light]});const h={},m=[];(function(x,C,M,B){let U;for(U in C=C||{},x=x||{})Object.prototype.hasOwnProperty.call(x,U)&&(Object.prototype.hasOwnProperty.call(C,U)||ki(U,M,B));for(U in C)Object.prototype.hasOwnProperty.call(C,U)&&(Object.prototype.hasOwnProperty.call(x,U)?Tt(x[U],C[U])||(x[U].type==="geojson"&&C[U].type==="geojson"&&Zi(x,C,U)?M.push({command:dt.setGeoJSONSourceData,args:[U,C[U].data]}):Si(U,C,M,B)):Yt(U,C,M))})(i.sources,e.sources,m,h);const b=[];i.layers&&i.layers.forEach(x=>{h[x.source]?s.push({command:dt.removeLayer,args:[x.id]}):b.push(x)}),s=s.concat(m),function(x,C,M){C=C||[];const B=(x=x||[]).map(fr),U=C.map(fr),j=x.reduce(qr,{}),H=C.reduce(qr,{}),te=B.slice(),re=Object.create(null);let pe,Te,Me,He,Be,Ke,nt;for(pe=0,Te=0;pe<B.length;pe++)Me=B[pe],Object.prototype.hasOwnProperty.call(H,Me)?Te++:(M.push({command:dt.removeLayer,args:[Me]}),te.splice(te.indexOf(Me,Te),1));for(pe=0,Te=0;pe<U.length;pe++)Me=U[U.length-1-pe],te[te.length-1-pe]!==Me&&(Object.prototype.hasOwnProperty.call(j,Me)?(M.push({command:dt.removeLayer,args:[Me]}),te.splice(te.lastIndexOf(Me,te.length-Te),1)):Te++,Ke=te[te.length-pe],M.push({command:dt.addLayer,args:[H[Me],Ke]}),te.splice(te.length-pe,0,Me),re[Me]=!0);for(pe=0;pe<U.length;pe++)if(Me=U[pe],He=j[Me],Be=H[Me],!re[Me]&&!Tt(He,Be))if(Tt(He.source,Be.source)&&Tt(He["source-layer"],Be["source-layer"])&&Tt(He.type,Be.type)){for(nt in nr(He.layout,Be.layout,M,Me,null,dt.setLayoutProperty),nr(He.paint,Be.paint,M,Me,null,dt.setPaintProperty),Tt(He.filter,Be.filter)||M.push({command:dt.setFilter,args:[Me,Be.filter]}),Tt(He.minzoom,Be.minzoom)&&Tt(He.maxzoom,Be.maxzoom)||M.push({command:dt.setLayerZoomRange,args:[Me,Be.minzoom,Be.maxzoom]}),He)Object.prototype.hasOwnProperty.call(He,nt)&&nt!=="layout"&&nt!=="paint"&&nt!=="filter"&&nt!=="metadata"&&nt!=="minzoom"&&nt!=="maxzoom"&&(nt.indexOf("paint.")===0?nr(He[nt],Be[nt],M,Me,nt.slice(6),dt.setPaintProperty):Tt(He[nt],Be[nt])||M.push({command:dt.setLayerProperty,args:[Me,nt,Be[nt]]}));for(nt in Be)Object.prototype.hasOwnProperty.call(Be,nt)&&!Object.prototype.hasOwnProperty.call(He,nt)&&nt!=="layout"&&nt!=="paint"&&nt!=="filter"&&nt!=="metadata"&&nt!=="minzoom"&&nt!=="maxzoom"&&(nt.indexOf("paint.")===0?nr(He[nt],Be[nt],M,Me,nt.slice(6),dt.setPaintProperty):Tt(He[nt],Be[nt])||M.push({command:dt.setLayerProperty,args:[Me,nt,Be[nt]]}))}else M.push({command:dt.removeLayer,args:[Me]}),Ke=te[te.lastIndexOf(Me)+1],M.push({command:dt.addLayer,args:[Be,Ke]})}(b,e.layers,s)}catch(h){console.warn("Unable to compute style diff:",h),s=[{command:dt.setStyle,args:[e]}]}return s},n.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},n.earthRadius=Xh,n.emitValidationErrors=Sl,n.emptyStyle=function(){const i={},e=ke.$version;for(const s in ke.$root){const h=ke.$root[s];if(h.required){let m=null;m=s==="version"?e:h.type==="array"?[]:{},m!=null&&(i[s]=m)}}return i},n.equals=function(i,e){var s=i[0],h=i[1],m=i[2],b=i[3],x=i[4],C=i[5],M=i[6],B=i[7],U=i[8],j=i[9],H=i[10],te=i[11],re=i[12],pe=i[13],Te=i[14],Me=i[15],He=e[0],Be=e[1],Ke=e[2],nt=e[3],_t=e[4],Nt=e[5],Kt=e[6],Ot=e[7],Rt=e[8],Mt=e[9],Zt=e[10],Dt=e[11],kt=e[12],ci=e[13],Qt=e[14],Ai=e[15];return Math.abs(s-He)<=un*Math.max(1,Math.abs(s),Math.abs(He))&&Math.abs(h-Be)<=un*Math.max(1,Math.abs(h),Math.abs(Be))&&Math.abs(m-Ke)<=un*Math.max(1,Math.abs(m),Math.abs(Ke))&&Math.abs(b-nt)<=un*Math.max(1,Math.abs(b),Math.abs(nt))&&Math.abs(x-_t)<=un*Math.max(1,Math.abs(x),Math.abs(_t))&&Math.abs(C-Nt)<=un*Math.max(1,Math.abs(C),Math.abs(Nt))&&Math.abs(M-Kt)<=un*Math.max(1,Math.abs(M),Math.abs(Kt))&&Math.abs(B-Ot)<=un*Math.max(1,Math.abs(B),Math.abs(Ot))&&Math.abs(U-Rt)<=un*Math.max(1,Math.abs(U),Math.abs(Rt))&&Math.abs(j-Mt)<=un*Math.max(1,Math.abs(j),Math.abs(Mt))&&Math.abs(H-Zt)<=un*Math.max(1,Math.abs(H),Math.abs(Zt))&&Math.abs(te-Dt)<=un*Math.max(1,Math.abs(te),Math.abs(Dt))&&Math.abs(re-kt)<=un*Math.max(1,Math.abs(re),Math.abs(kt))&&Math.abs(pe-ci)<=un*Math.max(1,Math.abs(pe),Math.abs(ci))&&Math.abs(Te-Qt)<=un*Math.max(1,Math.abs(Te),Math.abs(Qt))&&Math.abs(Me-Ai)<=un*Math.max(1,Math.abs(Me),Math.abs(Ai))},n.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:s},{lowerSize:h,upperSize:m}){return i.kind==="source"?h/Ss:i.kind==="composite"?yn.number(h/Ss,m/Ss,s):e},n.evaluateSizeForZoom=function(i,e){let s=0,h=0;if(i.kind==="constant")h=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:m,minZoom:b,maxZoom:x}=i,C=m?ne(vn.interpolationFactor(m,e,b,x),0,1):0;i.kind==="camera"?h=yn.number(i.minSize,i.maxSize,C):s=C}return{uSizeT:s,uSize:h}},n.evented=Ml,n.extend=ue,n.filterObject=Xe,n.findLineIntersection=function(i,e,s,h){const m=e.y-i.y,b=e.x-i.x,x=h.y-s.y,C=h.x-s.x,M=x*b-C*m;if(M===0)return null;const B=(C*(i.y-s.y)-x*(i.x-s.x))/M;return new T(i.x+B*b,i.y+B*m)},n.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},n.getAnchorAlignment=qh,n.getAnchorJustification=ef,n.getArrayBuffer=N,n.getDefaultExportFromCjs=v,n.getImageData=function(i,e,s,h,m){return g(this,void 0,void 0,function*(){if(q())try{return yield Ee(i,e,s,h,m)}catch{}return function(b,x,C,M,B){const U=b.width,j=b.height;Re&&Q||(Re=new OffscreenCanvas(U,j),Q=Re.getContext("2d",{willReadFrequently:!0})),Re.width=U,Re.height=j,Q.drawImage(b,0,0,U,j);const H=Q.getImageData(x,C,M,B);return Q.clearRect(0,0,U,j),H.data}(i,e,s,h,m)})},n.getJSON=function(i,e){return ct(ue(i,{type:"json"}),e)},n.getOverlapMode=Zh,n.getProtocolAction=Fe,n.getRTLTextPluginStatus=Dl,n.getReferrer=Bt,n.getVideo=function(i,e){const s=window.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let h=0;h<i.length;h++){const m=window.document.createElement("source");Je(i[h])||(s.crossOrigin="Anonymous"),m.src=i[h],s.appendChild(m)}return{cancel:()=>{}}},n.groupByLayout=function(i,e){const s={};for(let m=0;m<i.length;m++){const b=e&&e[i[m].id]||mh(i[m]);e&&(e[i[m].id]=b);let x=s[b];x||(x=s[b]=[]),x.push(i[m])}const h=[];for(const m in s)h.push(s[m]);return h},n.identity=kh,n.interpolate=yn,n.invert=function(i,e){var s=e[0],h=e[1],m=e[2],b=e[3],x=e[4],C=e[5],M=e[6],B=e[7],U=e[8],j=e[9],H=e[10],te=e[11],re=e[12],pe=e[13],Te=e[14],Me=e[15],He=s*C-h*x,Be=s*M-m*x,Ke=s*B-b*x,nt=h*M-m*C,_t=h*B-b*C,Nt=m*B-b*M,Kt=U*pe-j*re,Ot=U*Te-H*re,Rt=U*Me-te*re,Mt=j*Te-H*pe,Zt=j*Me-te*pe,Dt=H*Me-te*Te,kt=He*Dt-Be*Zt+Ke*Mt+nt*Rt-_t*Ot+Nt*Kt;return kt?(i[0]=(C*Dt-M*Zt+B*Mt)*(kt=1/kt),i[1]=(m*Zt-h*Dt-b*Mt)*kt,i[2]=(pe*Nt-Te*_t+Me*nt)*kt,i[3]=(H*_t-j*Nt-te*nt)*kt,i[4]=(M*Rt-x*Dt-B*Ot)*kt,i[5]=(s*Dt-m*Rt+b*Ot)*kt,i[6]=(Te*Ke-re*Nt-Me*Be)*kt,i[7]=(U*Nt-H*Ke+te*Be)*kt,i[8]=(x*Zt-C*Rt+B*Kt)*kt,i[9]=(h*Rt-s*Zt-b*Kt)*kt,i[10]=(re*_t-pe*Ke+Me*He)*kt,i[11]=(j*Ke-U*_t-te*He)*kt,i[12]=(C*Ot-x*Mt-M*Kt)*kt,i[13]=(s*Mt-h*Ot+m*Kt)*kt,i[14]=(pe*Be-re*nt-Te*He)*kt,i[15]=(U*nt-j*Be+H*He)*kt,i):null},n.isImageBitmap=at,n.isOffscreenCanvasDistorted=q,n.isSafari=ut,n.isWorker=ft,n.keysDifference=function(i,e){const s=[];for(const h in i)h in e||s.push(h);return s},n.lazyLoadRTLTextPlugin=function(){xn.isLoading()||xn.isLoaded()||Dl()!=="deferred"||Ll()},n.makeRequest=ct,n.mapObject=ye,n.mercatorXfromLng=Ep,n.mercatorYfromLat=Sp,n.mercatorZfromAltitude=kp,n.mul=_y,n.mul$1=function(i,e,s){return i[0]=e[0]*s[0],i[1]=e[1]*s[1],i[2]=e[2]*s[2],i[3]=e[3]*s[3],i},n.multiply=Id,n.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},n.offscreenCanvasSupported=F,n.operations=dt,n.ortho=function(i,e,s,h,m,b,x){var C=1/(e-s),M=1/(h-m),B=1/(b-x);return i[0]=-2*C,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*M,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*B,i[11]=0,i[12]=(e+s)*C,i[13]=(m+h)*M,i[14]=(x+b)*B,i[15]=1,i},n.parseCacheControl=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,h,m,b)=>{const x=m||b;return e[h]=!x||x.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e},n.parseGlyphPbf=function(i){return new Uh(i).readFields(x0,[])},n.pbf=ep,n.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Sr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],s=e.layout,h=e._unevaluatedLayout._values,m={layoutIconSize:h["icon-size"].possiblyEvaluate(new Qi(i.bucket.zoom+1),i.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Qi(i.bucket.zoom+1),i.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Qi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:U}=i.bucket.textSizeData;m.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Qi(B),i.canonical),h["text-size"].possiblyEvaluate(new Qi(U),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:U}=i.bucket.iconSizeData;m.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Qi(B),i.canonical),h["icon-size"].possiblyEvaluate(new Qi(U),i.canonical)]}const b=s.get("text-line-height")*Dr,x=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",C=s.get("text-keep-upright"),M=s.get("text-size");for(const B of i.bucket.features){const U=s.get("text-font").evaluate(B,{},i.canonical).join(","),j=M.evaluate(B,{},i.canonical),H=m.layoutTextSize.evaluate(B,{},i.canonical),te=m.layoutIconSize.evaluate(B,{},i.canonical),re={horizontal:{},vertical:void 0},pe=B.text;let Te,Me=[0,0];if(pe){const Ke=pe.toString(),nt=s.get("text-letter-spacing").evaluate(B,{},i.canonical)*Dr,_t=gh(Ke)?nt:0,Nt=s.get("text-anchor").evaluate(B,{},i.canonical),Kt=jp(e,B,i.canonical);if(!Kt){const Dt=s.get("text-radial-offset").evaluate(B,{},i.canonical);Me=Dt?$p(Nt,[Dt*Dr,Qh]):s.get("text-offset").evaluate(B,{},i.canonical).map(kt=>kt*Dr)}let Ot=x?"center":s.get("text-justify").evaluate(B,{},i.canonical);const Rt=s.get("symbol-placement"),Mt=Rt==="point"?s.get("text-max-width").evaluate(B,{},i.canonical)*Dr:0,Zt=()=>{i.bucket.allowVerticalPlacement&&Aa(Ke)&&(re.vertical=hu(pe,i.glyphMap,i.glyphPositions,i.imagePositions,U,Mt,b,Nt,"left",_t,Me,n.WritingMode.vertical,!0,Rt,H,j))};if(!x&&Kt){const Dt=new Set;if(Ot==="auto")for(let ci=0;ci<Kt.values.length;ci+=2)Dt.add(ef(Kt.values[ci]));else Dt.add(Ot);let kt=!1;for(const ci of Dt)if(!re.horizontal[ci])if(kt)re.horizontal[ci]=re.horizontal[0];else{const Qt=hu(pe,i.glyphMap,i.glyphPositions,i.imagePositions,U,Mt,b,"center",ci,_t,Me,n.WritingMode.horizontal,!1,Rt,H,j);Qt&&(re.horizontal[ci]=Qt,kt=Qt.positionedLines.length===1)}Zt()}else{Ot==="auto"&&(Ot=ef(Nt));const Dt=hu(pe,i.glyphMap,i.glyphPositions,i.imagePositions,U,Mt,b,Nt,Ot,_t,Me,n.WritingMode.horizontal,!1,Rt,H,j);Dt&&(re.horizontal[Ot]=Dt),Zt(),Aa(Ke)&&x&&C&&(re.vertical=hu(pe,i.glyphMap,i.glyphPositions,i.imagePositions,U,Mt,b,Nt,Ot,_t,Me,n.WritingMode.vertical,!1,Rt,H,j))}}let He=!1;if(B.icon&&B.icon.name){const Ke=i.imageMap[B.icon.name];Ke&&(Te=I0(i.imagePositions[B.icon.name],s.get("icon-offset").evaluate(B,{},i.canonical),s.get("icon-anchor").evaluate(B,{},i.canonical)),He=!!Ke.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=He:i.bucket.sdfIcons!==He&&Z("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==i.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Be=Zp(re.horizontal)||re.vertical;i.bucket.iconsInText=!!Be&&Be.iconsInText,(Be||Te)&&Z0(i.bucket,B,re,Te,i.imageMap,m,H,te,Me,He,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},n.perspective=function(i,e,s,h,m){var b,x=1/Math.tan(e/2);return i[0]=x/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,m!=null&&m!==1/0?(i[10]=(m+h)*(b=1/(h-m)),i[14]=2*m*h*b):(i[10]=-1,i[14]=-2*h),i},n.pick=function(i,e){const s={};for(let h=0;h<e.length;h++){const m=e[h];m in i&&(s[m]=i[m])}return s},n.plugin=xn,n.pointGeometry=E,n.polygonIntersectsPolygon=xd,n.potpack=lp,n.readImageUsingVideoFrame=Ee,n.register=qt,n.registerForPluginStateChange=function(i){return i({pluginStatus:cn,pluginURL:Fn}),Ml.on("pluginStateChange",i),i},n.renderColorRamp=Dd,n.rotateX=function(i,e,s){var h=Math.sin(s),m=Math.cos(s),b=e[4],x=e[5],C=e[6],M=e[7],B=e[8],U=e[9],j=e[10],H=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=b*m+B*h,i[5]=x*m+U*h,i[6]=C*m+j*h,i[7]=M*m+H*h,i[8]=B*m-b*h,i[9]=U*m-x*h,i[10]=j*m-C*h,i[11]=H*m-M*h,i},n.rotateZ=function(i,e,s){var h=Math.sin(s),m=Math.cos(s),b=e[0],x=e[1],C=e[2],M=e[3],B=e[4],U=e[5],j=e[6],H=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=b*m+B*h,i[1]=x*m+U*h,i[2]=C*m+j*h,i[3]=M*m+H*h,i[4]=B*m-b*h,i[5]=U*m-x*h,i[6]=j*m-C*h,i[7]=H*m-M*h,i},n.sameOrigin=Je,n.scale=function(i,e,s){var h=s[0],m=s[1],b=s[2];return i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i[3]=e[3]*h,i[4]=e[4]*m,i[5]=e[5]*m,i[6]=e[6]*m,i[7]=e[7]*m,i[8]=e[8]*b,i[9]=e[9]*b,i[10]=e[10]*b,i[11]=e[11]*b,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},n.setRTLTextPlugin=function(i,e,s=!1){if(cn===Il||cn===Al||cn===Pl)throw new Error("setRTLTextPlugin cannot be called multiple times.");Fn=Ct.resolveURL(i),cn=Il,zl=e,Pa(),s||Ll()},n.sphericalToCartesian=function([i,e,s]){return e+=90,e*=Math.PI/180,s*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(s),y:i*Math.sin(e)*Math.sin(s),z:i*Math.cos(s)}},n.toEvaluationFeature=Ba,n.transformMat4=nu,n.translate=function(i,e,s){var h,m,b,x,C,M,B,U,j,H,te,re,pe=s[0],Te=s[1],Me=s[2];return e===i?(i[12]=e[0]*pe+e[4]*Te+e[8]*Me+e[12],i[13]=e[1]*pe+e[5]*Te+e[9]*Me+e[13],i[14]=e[2]*pe+e[6]*Te+e[10]*Me+e[14],i[15]=e[3]*pe+e[7]*Te+e[11]*Me+e[15]):(m=e[1],b=e[2],x=e[3],C=e[4],M=e[5],B=e[6],U=e[7],j=e[8],H=e[9],te=e[10],re=e[11],i[0]=h=e[0],i[1]=m,i[2]=b,i[3]=x,i[4]=C,i[5]=M,i[6]=B,i[7]=U,i[8]=j,i[9]=H,i[10]=te,i[11]=re,i[12]=h*pe+C*Te+j*Me+e[12],i[13]=m*pe+M*Te+H*Me+e[13],i[14]=b*pe+B*Te+te*Me+e[14],i[15]=x*pe+U*Te+re*Me+e[15]),i},n.triggerPluginCompletionEvent=Wc,n.unicodeBlockLookup=jt,n.uniqueId=function(){return Ce++},n.v8Spec=ke,n.validateCustomStyleLayer=function(i){const e=[],s=i.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},n.validateLight=xl,n.validateStyle=Ta,n.vectorTile=ra,n.warnOnce=Z,n.wrap=se}),f(["./shared"],function(n){class g{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,K){for(const be of G){this._layerConfigs[be.id]=be;const Pe=this._layers[be.id]=n.createStyleLayer(be);Pe._featureFilter=n.createFilter(Pe.filter),this.keyCache[be.id]&&delete this.keyCache[be.id]}for(const be of K)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const ce=n.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const be of ce){const Pe=be.map(oe=>this._layers[oe.id]),qe=Pe[0];if(qe.visibility==="none")continue;const Oe=qe.source||"";let De=this.familiesBySource[Oe];De||(De=this.familiesBySource[Oe]={});const W=qe.sourceLayer||"_geojsonTileLayer";let X=De[W];X||(X=De[W]=[]),X.push(Pe)}}}class v{constructor(G){const K={},ce=[];for(const Oe in G){const De=G[Oe],W=K[Oe]={};for(const X in De){const oe=De[+X];if(!oe||oe.bitmap.width===0||oe.bitmap.height===0)continue;const Ie={x:0,y:0,w:oe.bitmap.width+2,h:oe.bitmap.height+2};ce.push(Ie),W[X]={rect:Ie,metrics:oe.metrics}}}const{w:be,h:Pe}=n.potpack(ce),qe=new n.AlphaImage({width:be||1,height:Pe||1});for(const Oe in G){const De=G[Oe];for(const W in De){const X=De[+W];if(!X||X.bitmap.width===0||X.bitmap.height===0)continue;const oe=K[Oe][W].rect;n.AlphaImage.copy(X.bitmap,qe,{x:0,y:0},{x:oe.x+1,y:oe.y+1},X.bitmap)}}this.image=qe,this.positions=K}}n.register("GlyphAtlas",v);class E{constructor(G){this.tileID=new n.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(G,K,ce,be,Pe){this.status="parsing",this.data=G,this.collisionBoxArray=new n.CollisionBoxArray;const qe=new n.DictionaryCoder(Object.keys(G.layers).sort()),Oe=new n.FeatureIndex(this.tileID,this.promoteId);Oe.bucketLayerIDs=[];const De={},W={featureIndex:Oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce},X=K.familiesBySource[this.source];for(const ai in X){const ui=G.layers[ai];if(!ui)continue;ui.version===1&&n.warnOnce(`Vector tile source "${this.source}" layer "${ai}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const li=qe.encode(ai),gi=[];for(let Ii=0;Ii<ui.length;Ii++){const xi=ui.feature(Ii),Vr=Oe.getId(xi,ai);gi.push({feature:xi,id:Vr,index:Ii,sourceLayerIndex:li})}for(const Ii of X[ai]){const xi=Ii[0];xi.source!==this.source&&n.warnOnce(`layer.source = ${xi.source} does not equal this.source = ${this.source}`),xi.minzoom&&this.zoom<Math.floor(xi.minzoom)||xi.maxzoom&&this.zoom>=xi.maxzoom||xi.visibility!=="none"&&(S(Ii,this.zoom,ce),(De[xi.id]=xi.createBucket({index:Oe.bucketLayerIDs.length,layers:Ii,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:li,sourceID:this.source})).populate(gi,W,this.tileID.canonical),Oe.bucketLayerIDs.push(Ii.map(Vr=>Vr.id)))}}let oe,Ie,Ue,Et;const yt=n.mapObject(W.glyphDependencies,ai=>Object.keys(ai).map(Number));this.inFlightDependencies.forEach(ai=>ai==null?void 0:ai.cancel()),this.inFlightDependencies=[];const At=++this.dependencySentinel;Object.keys(yt).length?this.inFlightDependencies.push(be.send("getGlyphs",{uid:this.uid,stacks:yt,source:this.source,tileID:this.tileID,type:"glyphs"},(ai,ui)=>{At===this.dependencySentinel&&(oe||(oe=ai,Ie=ui,ei.call(this)))})):Ie={};const Gt=Object.keys(W.iconDependencies);Gt.length?this.inFlightDependencies.push(be.send("getImages",{icons:Gt,source:this.source,tileID:this.tileID,type:"icons"},(ai,ui)=>{At===this.dependencySentinel&&(oe||(oe=ai,Ue=ui,ei.call(this)))})):Ue={};const di=Object.keys(W.patternDependencies);function ei(){if(oe)return Pe(oe);if(Ie&&Ue&&Et){const ai=new v(Ie),ui=new n.ImageAtlas(Ue,Et);for(const li in De){const gi=De[li];gi instanceof n.SymbolBucket?(S(gi.layers,this.zoom,ce),n.performSymbolLayout({bucket:gi,glyphMap:Ie,glyphPositions:ai.positions,imageMap:Ue,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):gi.hasPattern&&(gi instanceof n.LineBucket||gi instanceof n.FillBucket||gi instanceof n.FillExtrusionBucket)&&(S(gi.layers,this.zoom,ce),gi.addFeatures(W,this.tileID.canonical,ui.patternPositions))}this.status="done",Pe(null,{buckets:Object.values(De).filter(li=>!li.isEmpty()),featureIndex:Oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ai.image,imageAtlas:ui,glyphMap:this.returnDependencies?Ie:null,iconMap:this.returnDependencies?Ue:null,glyphPositions:this.returnDependencies?ai.positions:null})}}di.length?this.inFlightDependencies.push(be.send("getImages",{icons:di,source:this.source,tileID:this.tileID,type:"patterns"},(ai,ui)=>{At===this.dependencySentinel&&(oe||(oe=ai,Et=ui,ei.call(this)))})):Et={},ei.call(this)}}function S(ve,G,K){const ce=new n.EvaluationParameters(G);for(const be of ve)be.recalculate(ce,K)}function T(ve,G){const K=n.getArrayBuffer(ve.request,(ce,be,Pe,qe)=>{if(ce)G(ce);else if(be)try{const Oe=new n.vectorTile.VectorTile(new n.Protobuf(be));G(null,{vectorTile:Oe,rawData:be,cacheControl:Pe,expires:qe})}catch(Oe){const De=new Uint8Array(be);let W=`Unable to parse the tile at ${ve.request.url}, `;W+=De[0]===31&&De[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Oe.messge}`,G(new Error(W))}});return()=>{K.cancel(),G()}}class k{constructor(G,K,ce,be){this.actor=G,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=be||T,this.fetching={},this.loading={},this.loaded={}}loadTile(G,K){const ce=G.uid;this.loading||(this.loading={});const be=!!(G&&G.request&&G.request.collectResourceTiming)&&new n.RequestPerformance(G.request),Pe=this.loading[ce]=new E(G);Pe.abort=this.loadVectorData(G,(qe,Oe)=>{if(delete this.loading[ce],qe||!Oe)return Pe.status="done",this.loaded[ce]=Pe,K(qe);const De=Oe.rawData,W={};Oe.expires&&(W.expires=Oe.expires),Oe.cacheControl&&(W.cacheControl=Oe.cacheControl);const X={};if(be){const oe=be.finish();oe&&(X.resourceTiming=JSON.parse(JSON.stringify(oe)))}Pe.vectorTile=Oe.vectorTile,Pe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,(oe,Ie)=>{if(delete this.fetching[ce],oe||!Ie)return K(oe);K(null,n.extend({rawTileData:De.slice(0)},Ie,W,X))}),this.loaded=this.loaded||{},this.loaded[ce]=Pe,this.fetching[ce]={rawTileData:De,cacheControl:W,resourceTiming:X}})}reloadTile(G,K){const ce=this.loaded,be=G.uid;if(ce&&ce[be]){const Pe=ce[be];Pe.showCollisionBoxes=G.showCollisionBoxes,Pe.status==="parsing"?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,(qe,Oe)=>{if(qe||!Oe)return K(qe,Oe);let De;if(this.fetching[be]){const{rawTileData:W,cacheControl:X,resourceTiming:oe}=this.fetching[be];delete this.fetching[be],De=n.extend({rawTileData:W.slice(0)},Oe,X,oe)}else De=Oe;K(null,De)}):Pe.status==="done"&&(Pe.vectorTile?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,K):K())}}abortTile(G,K){const ce=this.loading,be=G.uid;ce&&ce[be]&&ce[be].abort&&(ce[be].abort(),delete ce[be]),K()}removeTile(G,K){const ce=this.loaded,be=G.uid;ce&&ce[be]&&delete ce[be],K()}}class z{constructor(){this.loaded={}}loadTile(G,K){return n.__awaiter(this,void 0,void 0,function*(){const{uid:ce,encoding:be,rawImageData:Pe,redFactor:qe,greenFactor:Oe,blueFactor:De,baseShift:W}=G,X=Pe.width+2,oe=Pe.height+2,Ie=n.isImageBitmap(Pe)?new n.RGBAImage({width:X,height:oe},yield n.getImageData(Pe,-1,-1,X,oe)):Pe,Ue=new n.DEMData(ce,Ie,be,qe,Oe,De,W);this.loaded=this.loaded||{},this.loaded[ce]=Ue,K(null,Ue)})}removeTile(G){const K=this.loaded,ce=G.uid;K&&K[ce]&&delete K[ce]}}function A(ve,G){if(ve.length!==0){R(ve[0],G);for(var K=1;K<ve.length;K++)R(ve[K],!G)}}function R(ve,G){for(var K=0,ce=0,be=0,Pe=ve.length,qe=Pe-1;be<Pe;qe=be++){var Oe=(ve[be][0]-ve[qe][0])*(ve[qe][1]+ve[be][1]),De=K+Oe;ce+=Math.abs(K)>=Math.abs(Oe)?K-De+Oe:Oe-De+K,K=De}K+ce>=0!=!!G&&ve.reverse()}var D=n.getDefaultExportFromCjs(function ve(G,K){var ce,be=G&&G.type;if(be==="FeatureCollection")for(ce=0;ce<G.features.length;ce++)ve(G.features[ce],K);else if(be==="GeometryCollection")for(ce=0;ce<G.geometries.length;ce++)ve(G.geometries[ce],K);else if(be==="Feature")ve(G.geometry,K);else if(be==="Polygon")A(G.coordinates,K);else if(be==="MultiPolygon")for(ce=0;ce<G.coordinates.length;ce++)A(G.coordinates[ce],K);return G});const F=n.vectorTile.VectorTileFeature.prototype.toGeoJSON;var q={exports:{}},ee=n.pointGeometry,ie=n.vectorTile.VectorTileFeature,ne=se;function se(ve,G){this.options=G||{},this.features=ve,this.length=ve.length}function ue(ve,G){this.id=typeof ve.id=="number"?ve.id:void 0,this.type=ve.type,this.rawGeometry=ve.type===1?[ve.geometry]:ve.geometry,this.properties=ve.tags,this.extent=G||4096}se.prototype.feature=function(ve){return new ue(this.features[ve],this.options.extent)},ue.prototype.loadGeometry=function(){var ve=this.rawGeometry;this.geometry=[];for(var G=0;G<ve.length;G++){for(var K=ve[G],ce=[],be=0;be<K.length;be++)ce.push(new ee(K[be][0],K[be][1]));this.geometry.push(ce)}return this.geometry},ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ve=this.geometry,G=1/0,K=-1/0,ce=1/0,be=-1/0,Pe=0;Pe<ve.length;Pe++)for(var qe=ve[Pe],Oe=0;Oe<qe.length;Oe++){var De=qe[Oe];G=Math.min(G,De.x),K=Math.max(K,De.x),ce=Math.min(ce,De.y),be=Math.max(be,De.y)}return[G,ce,K,be]},ue.prototype.toGeoJSON=ie.prototype.toGeoJSON;var Ce=n.pbf,ye=ne;function Xe(ve){var G=new Ce;return function(K,ce){for(var be in K.layers)ce.writeMessage(3,ae,K.layers[be])}(ve,G),G.finish()}function ae(ve,G){var K;G.writeVarintField(15,ve.version||1),G.writeStringField(1,ve.name||""),G.writeVarintField(5,ve.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<ve.length;K++)ce.feature=ve.feature(K),G.writeMessage(2,Le,ce);var be=ce.keys;for(K=0;K<be.length;K++)G.writeStringField(3,be[K]);var Pe=ce.values;for(K=0;K<Pe.length;K++)G.writeMessage(4,Jt,Pe[K])}function Le(ve,G){var K=ve.feature;K.id!==void 0&&G.writeVarintField(1,K.id),G.writeMessage(2,Z,ve),G.writeVarintField(3,K.type),G.writeMessage(4,ft,K)}function Z(ve,G){var K=ve.feature,ce=ve.keys,be=ve.values,Pe=ve.keycache,qe=ve.valuecache;for(var Oe in K.properties){var De=K.properties[Oe],W=Pe[Oe];if(De!==null){W===void 0&&(ce.push(Oe),Pe[Oe]=W=ce.length-1),G.writeVarint(W);var X=typeof De;X!=="string"&&X!=="boolean"&&X!=="number"&&(De=JSON.stringify(De));var oe=X+":"+De,Ie=qe[oe];Ie===void 0&&(be.push(De),qe[oe]=Ie=be.length-1),G.writeVarint(Ie)}}}function tt(ve,G){return(G<<3)+(7&ve)}function $t(ve){return ve<<1^ve>>31}function ft(ve,G){for(var K=ve.loadGeometry(),ce=ve.type,be=0,Pe=0,qe=K.length,Oe=0;Oe<qe;Oe++){var De=K[Oe],W=1;ce===1&&(W=De.length),G.writeVarint(tt(1,W));for(var X=ce===3?De.length-1:De.length,oe=0;oe<X;oe++){oe===1&&ce!==1&&G.writeVarint(tt(2,X-1));var Ie=De[oe].x-be,Ue=De[oe].y-Pe;G.writeVarint($t(Ie)),G.writeVarint($t(Ue)),be+=Ie,Pe+=Ue}ce===3&&G.writeVarint(tt(7,1))}}function Jt(ve,G){var K=typeof ve;K==="string"?G.writeStringField(1,ve):K==="boolean"?G.writeBooleanField(7,ve):K==="number"&&(ve%1!=0?G.writeDoubleField(3,ve):ve<0?G.writeSVarintField(6,ve):G.writeVarintField(5,ve))}q.exports=Xe,q.exports.fromVectorTileJs=Xe,q.exports.fromGeojsonVt=function(ve,G){G=G||{};var K={};for(var ce in ve)K[ce]=new ye(ve[ce].features,G),K[ce].name=ce,K[ce].version=G.version,K[ce].extent=G.extent;return Xe({layers:K})},q.exports.GeoJSONWrapper=ye;var ut=n.getDefaultExportFromCjs(q.exports);const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},le=Math.fround||(Ee=new Float32Array(1),ve=>(Ee[0]=+ve,Ee[0]));var Ee;const Re=3,Q=5,he=6;class it{constructor(G){this.options=Object.assign(Object.create(at),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:K,minZoom:ce,maxZoom:be}=this.options;K&&console.time("total time");const Pe=`prepare ${G.length} points`;K&&console.time(Pe),this.points=G;const qe=[];for(let De=0;De<G.length;De++){const W=G[De];if(!W.geometry)continue;const[X,oe]=W.geometry.coordinates,Ie=le(It(X)),Ue=le(Bt(oe));qe.push(Ie,Ue,1/0,De,-1,1),this.options.reduce&&qe.push(0)}let Oe=this.trees[be+1]=this._createTree(qe);K&&console.timeEnd(Pe);for(let De=be;De>=ce;De--){const W=+Date.now();Oe=this.trees[De]=this._createTree(this._cluster(Oe,De)),K&&console.log("z%d: %d clusters in %dms",De,Oe.numItems,+Date.now()-W)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let ce=((G[0]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,G[1]));let Pe=G[2]===180?180:((G[2]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ce=-180,Pe=180;else if(ce>Pe){const oe=this.getClusters([ce,be,180,qe],K),Ie=this.getClusters([-180,be,Pe,qe],K);return oe.concat(Ie)}const Oe=this.trees[this._limitZoom(K)],De=Oe.range(It(ce),Bt(qe),It(Pe),Bt(be)),W=Oe.data,X=[];for(const oe of De){const Ie=this.stride*oe;X.push(W[Ie+Q]>1?Ct(W,Ie,this.clusterProps):this.points[W[Ie+Re]])}return X}getChildren(G){const K=this._getOriginId(G),ce=this._getOriginZoom(G),be="No cluster with the specified id.",Pe=this.trees[ce];if(!Pe)throw new Error(be);const qe=Pe.data;if(K*this.stride>=qe.length)throw new Error(be);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),De=Pe.within(qe[K*this.stride],qe[K*this.stride+1],Oe),W=[];for(const X of De){const oe=X*this.stride;qe[oe+4]===G&&W.push(qe[oe+Q]>1?Ct(qe,oe,this.clusterProps):this.points[qe[oe+Re]])}if(W.length===0)throw new Error(be);return W}getLeaves(G,K,ce){const be=[];return this._appendLeaves(be,G,K=K||10,ce=ce||0,0),be}getTile(G,K,ce){const be=this.trees[this._limitZoom(G)],Pe=Math.pow(2,G),{extent:qe,radius:Oe}=this.options,De=Oe/qe,W=(ce-De)/Pe,X=(ce+1+De)/Pe,oe={features:[]};return this._addTileFeatures(be.range((K-De)/Pe,W,(K+1+De)/Pe,X),be.data,K,ce,Pe,oe),K===0&&this._addTileFeatures(be.range(1-De/Pe,W,1,X),be.data,Pe,ce,Pe,oe),K===Pe-1&&this._addTileFeatures(be.range(0,W,De/Pe,X),be.data,-1,ce,Pe,oe),oe.features.length?oe:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){const ce=this.getChildren(G);if(K++,ce.length!==1)break;G=ce[0].properties.cluster_id}return K}_appendLeaves(G,K,ce,be,Pe){const qe=this.getChildren(K);for(const Oe of qe){const De=Oe.properties;if(De&&De.cluster?Pe+De.point_count<=be?Pe+=De.point_count:Pe=this._appendLeaves(G,De.cluster_id,ce,be,Pe):Pe<be?Pe++:G.push(Oe),G.length===ce)break}return Pe}_createTree(G){const K=new n.KDBush(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<G.length;ce+=this.stride)K.add(G[ce],G[ce+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,ce,be,Pe,qe){for(const Oe of G){const De=Oe*this.stride,W=K[De+Q]>1;let X,oe,Ie;if(W)X=bt(K,De,this.clusterProps),oe=K[De],Ie=K[De+1];else{const yt=this.points[K[De+Re]];X=yt.properties;const[At,Gt]=yt.geometry.coordinates;oe=It(At),Ie=Bt(Gt)}const Ue={type:1,geometry:[[Math.round(this.options.extent*(oe*Pe-ce)),Math.round(this.options.extent*(Ie*Pe-be))]],tags:X};let Et;Et=W||this.options.generateId?K[De+Re]:this.points[K[De+Re]].id,Et!==void 0&&(Ue.id=Et),qe.features.push(Ue)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){const{radius:ce,extent:be,reduce:Pe,minPoints:qe}=this.options,Oe=ce/(be*Math.pow(2,K)),De=G.data,W=[],X=this.stride;for(let oe=0;oe<De.length;oe+=X){if(De[oe+2]<=K)continue;De[oe+2]=K;const Ie=De[oe],Ue=De[oe+1],Et=G.within(De[oe],De[oe+1],Oe),yt=De[oe+Q];let At=yt;for(const Gt of Et){const di=Gt*X;De[di+2]>K&&(At+=De[di+Q])}if(At>yt&&At>=qe){let Gt,di=Ie*yt,ei=Ue*yt,ai=-1;const ui=((oe/X|0)<<5)+(K+1)+this.points.length;for(const li of Et){const gi=li*X;if(De[gi+2]<=K)continue;De[gi+2]=K;const Ii=De[gi+Q];di+=De[gi]*Ii,ei+=De[gi+1]*Ii,De[gi+4]=ui,Pe&&(Gt||(Gt=this._map(De,oe,!0),ai=this.clusterProps.length,this.clusterProps.push(Gt)),Pe(Gt,this._map(De,gi)))}De[oe+4]=ui,W.push(di/At,ei/At,1/0,ui,-1,At),Pe&&W.push(ai)}else{for(let Gt=0;Gt<X;Gt++)W.push(De[oe+Gt]);if(At>1)for(const Gt of Et){const di=Gt*X;if(!(De[di+2]<=K)){De[di+2]=K;for(let ei=0;ei<X;ei++)W.push(De[di+ei])}}}}return W}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,ce){if(G[K+Q]>1){const qe=this.clusterProps[G[K+he]];return ce?Object.assign({},qe):qe}const be=this.points[G[K+Re]].properties,Pe=this.options.map(be);return ce&&Pe===be?Object.assign({},Pe):Pe}}function Ct(ve,G,K){return{type:"Feature",id:ve[G+Re],properties:bt(ve,G,K),geometry:{type:"Point",coordinates:[(ce=ve[G],360*(ce-.5)),Fe(ve[G+1])]}};var ce}function bt(ve,G,K){const ce=ve[G+Q],be=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,Pe=ve[G+he],qe=Pe===-1?{}:Object.assign({},K[Pe]);return Object.assign(qe,{cluster:!0,cluster_id:ve[G+Re],point_count:ce,point_count_abbreviated:be})}function It(ve){return ve/360+.5}function Bt(ve){const G=Math.sin(ve*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Fe(ve){const G=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Se(ve,G,K,ce){for(var be,Pe=ce,qe=K-G>>1,Oe=K-G,De=ve[G],W=ve[G+1],X=ve[K],oe=ve[K+1],Ie=G+3;Ie<K;Ie+=3){var Ue=ct(ve[Ie],ve[Ie+1],De,W,X,oe);if(Ue>Pe)be=Ie,Pe=Ue;else if(Ue===Pe){var Et=Math.abs(Ie-qe);Et<Oe&&(be=Ie,Oe=Et)}}Pe>ce&&(be-G>3&&Se(ve,G,be,ce),ve[be+2]=Pe,K-be>3&&Se(ve,be,K,ce))}function ct(ve,G,K,ce,be,Pe){var qe=be-K,Oe=Pe-ce;if(qe!==0||Oe!==0){var De=((ve-K)*qe+(G-ce)*Oe)/(qe*qe+Oe*Oe);De>1?(K=be,ce=Pe):De>0&&(K+=qe*De,ce+=Oe*De)}return(qe=ve-K)*qe+(Oe=G-ce)*Oe}function N(ve,G,K,ce){var be={id:ve===void 0?null:ve,type:G,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var qe=Pe.geometry,Oe=Pe.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")Je(Pe,qe);else if(Oe==="Polygon"||Oe==="MultiLineString")for(var De=0;De<qe.length;De++)Je(Pe,qe[De]);else if(Oe==="MultiPolygon")for(De=0;De<qe.length;De++)for(var W=0;W<qe[De].length;W++)Je(Pe,qe[De][W])}(be),be}function Je(ve,G){for(var K=0;K<G.length;K+=3)ve.minX=Math.min(ve.minX,G[K]),ve.minY=Math.min(ve.minY,G[K+1]),ve.maxX=Math.max(ve.maxX,G[K]),ve.maxY=Math.max(ve.maxY,G[K+1])}function We(ve,G,K,ce){if(G.geometry){var be=G.geometry.coordinates,Pe=G.geometry.type,qe=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Oe=[],De=G.id;if(K.promoteId?De=G.properties[K.promoteId]:K.generateId&&(De=ce||0),Pe==="Point")we(be,Oe);else if(Pe==="MultiPoint")for(var W=0;W<be.length;W++)we(be[W],Oe);else if(Pe==="LineString")me(be,Oe,qe,!1);else if(Pe==="MultiLineString"){if(K.lineMetrics){for(W=0;W<be.length;W++)me(be[W],Oe=[],qe,!1),ve.push(N(De,"LineString",Oe,G.properties));return}Ne(be,Oe,qe,!1)}else if(Pe==="Polygon")Ne(be,Oe,qe,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(W=0;W<G.geometry.geometries.length;W++)We(ve,{id:De,geometry:G.geometry.geometries[W],properties:G.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(W=0;W<be.length;W++){var X=[];Ne(be[W],X,qe,!0),Oe.push(X)}}ve.push(N(De,Pe,Oe,G.properties))}}function we(ve,G){G.push(ht(ve[0])),G.push(ke(ve[1])),G.push(0)}function me(ve,G,K,ce){for(var be,Pe,qe=0,Oe=0;Oe<ve.length;Oe++){var De=ht(ve[Oe][0]),W=ke(ve[Oe][1]);G.push(De),G.push(W),G.push(0),Oe>0&&(qe+=ce?(be*W-De*Pe)/2:Math.sqrt(Math.pow(De-be,2)+Math.pow(W-Pe,2))),be=De,Pe=W}var X=G.length-3;G[2]=1,Se(G,0,X,K),G[X+2]=1,G.size=Math.abs(qe),G.start=0,G.end=G.size}function Ne(ve,G,K,ce){for(var be=0;be<ve.length;be++){var Pe=[];me(ve[be],Pe,K,ce),G.push(Pe)}}function ht(ve){return ve/360+.5}function ke(ve){var G=Math.sin(ve*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Qe(ve,G,K,ce,be,Pe,qe,Oe){if(ce/=G,Pe>=(K/=G)&&qe<ce)return ve;if(qe<K||Pe>=ce)return null;for(var De=[],W=0;W<ve.length;W++){var X=ve[W],oe=X.geometry,Ie=X.type,Ue=be===0?X.minX:X.minY,Et=be===0?X.maxX:X.maxY;if(Ue>=K&&Et<ce)De.push(X);else if(!(Et<K||Ue>=ce)){var yt=[];if(Ie==="Point"||Ie==="MultiPoint")xt(oe,yt,K,ce,be);else if(Ie==="LineString")Tt(oe,yt,K,ce,be,!1,Oe.lineMetrics);else if(Ie==="MultiLineString")Yt(oe,yt,K,ce,be,!1);else if(Ie==="Polygon")Yt(oe,yt,K,ce,be,!0);else if(Ie==="MultiPolygon")for(var At=0;At<oe.length;At++){var Gt=[];Yt(oe[At],Gt,K,ce,be,!0),Gt.length&&yt.push(Gt)}if(yt.length){if(Oe.lineMetrics&&Ie==="LineString"){for(At=0;At<yt.length;At++)De.push(N(X.id,Ie,yt[At],X.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(yt.length===1?(Ie="LineString",yt=yt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=yt.length===3?"Point":"MultiPoint"),De.push(N(X.id,Ie,yt,X.tags))}}}return De.length?De:null}function xt(ve,G,K,ce,be){for(var Pe=0;Pe<ve.length;Pe+=3){var qe=ve[Pe+be];qe>=K&&qe<=ce&&(G.push(ve[Pe]),G.push(ve[Pe+1]),G.push(ve[Pe+2]))}}function Tt(ve,G,K,ce,be,Pe,qe){for(var Oe,De,W=dt(ve),X=be===0?Si:Zi,oe=ve.start,Ie=0;Ie<ve.length-3;Ie+=3){var Ue=ve[Ie],Et=ve[Ie+1],yt=ve[Ie+2],At=ve[Ie+3],Gt=ve[Ie+4],di=be===0?Ue:Et,ei=be===0?At:Gt,ai=!1;qe&&(Oe=Math.sqrt(Math.pow(Ue-At,2)+Math.pow(Et-Gt,2))),di<K?ei>K&&(De=X(W,Ue,Et,At,Gt,K),qe&&(W.start=oe+Oe*De)):di>ce?ei<ce&&(De=X(W,Ue,Et,At,Gt,ce),qe&&(W.start=oe+Oe*De)):ki(W,Ue,Et,yt),ei<K&&di>=K&&(De=X(W,Ue,Et,At,Gt,K),ai=!0),ei>ce&&di<=ce&&(De=X(W,Ue,Et,At,Gt,ce),ai=!0),!Pe&&ai&&(qe&&(W.end=oe+Oe*De),G.push(W),W=dt(ve)),qe&&(oe+=Oe)}var ui=ve.length-3;Ue=ve[ui],Et=ve[ui+1],yt=ve[ui+2],(di=be===0?Ue:Et)>=K&&di<=ce&&ki(W,Ue,Et,yt),ui=W.length-3,Pe&&ui>=3&&(W[ui]!==W[0]||W[ui+1]!==W[1])&&ki(W,W[0],W[1],W[2]),W.length&&G.push(W)}function dt(ve){var G=[];return G.size=ve.size,G.start=ve.start,G.end=ve.end,G}function Yt(ve,G,K,ce,be,Pe){for(var qe=0;qe<ve.length;qe++)Tt(ve[qe],G,K,ce,be,Pe,!1)}function ki(ve,G,K,ce){ve.push(G),ve.push(K),ve.push(ce)}function Si(ve,G,K,ce,be,Pe){var qe=(Pe-G)/(ce-G);return ve.push(Pe),ve.push(K+(be-K)*qe),ve.push(1),qe}function Zi(ve,G,K,ce,be,Pe){var qe=(Pe-K)/(be-K);return ve.push(G+(ce-G)*qe),ve.push(Pe),ve.push(1),qe}function nr(ve,G){for(var K=[],ce=0;ce<ve.length;ce++){var be,Pe=ve[ce],qe=Pe.type;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")be=fr(Pe.geometry,G);else if(qe==="MultiLineString"||qe==="Polygon"){be=[];for(var Oe=0;Oe<Pe.geometry.length;Oe++)be.push(fr(Pe.geometry[Oe],G))}else if(qe==="MultiPolygon")for(be=[],Oe=0;Oe<Pe.geometry.length;Oe++){for(var De=[],W=0;W<Pe.geometry[Oe].length;W++)De.push(fr(Pe.geometry[Oe][W],G));be.push(De)}K.push(N(Pe.id,qe,be,Pe.tags))}return K}function fr(ve,G){var K=[];K.size=ve.size,ve.start!==void 0&&(K.start=ve.start,K.end=ve.end);for(var ce=0;ce<ve.length;ce+=3)K.push(ve[ce]+G,ve[ce+1],ve[ce+2]);return K}function qr(ve,G){if(ve.transformed)return ve;var K,ce,be,Pe=1<<ve.z,qe=ve.x,Oe=ve.y;for(K=0;K<ve.features.length;K++){var De=ve.features[K],W=De.geometry,X=De.type;if(De.geometry=[],X===1)for(ce=0;ce<W.length;ce+=2)De.geometry.push(vt(W[ce],W[ce+1],G,Pe,qe,Oe));else for(ce=0;ce<W.length;ce++){var oe=[];for(be=0;be<W[ce].length;be+=2)oe.push(vt(W[ce][be],W[ce][be+1],G,Pe,qe,Oe));De.geometry.push(oe)}}return ve.transformed=!0,ve}function vt(ve,G,K,ce,be,Pe){return[Math.round(K*(ve*ce-be)),Math.round(K*(G*ce-Pe))]}function Ki(ve,G,K,ce,be){for(var Pe=G===be.maxZoom?0:be.tolerance/((1<<G)*be.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:K,y:ce,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Oe=0;Oe<ve.length;Oe++){qe.numFeatures++,br(qe,ve[Oe],Pe,be);var De=ve[Oe].minX,W=ve[Oe].minY,X=ve[Oe].maxX,oe=ve[Oe].maxY;De<qe.minX&&(qe.minX=De),W<qe.minY&&(qe.minY=W),X>qe.maxX&&(qe.maxX=X),oe>qe.maxY&&(qe.maxY=oe)}return qe}function br(ve,G,K,ce){var be=G.geometry,Pe=G.type,qe=[];if(Pe==="Point"||Pe==="MultiPoint")for(var Oe=0;Oe<be.length;Oe+=3)qe.push(be[Oe]),qe.push(be[Oe+1]),ve.numPoints++,ve.numSimplified++;else if(Pe==="LineString")wr(qe,be,ve,K,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(Oe=0;Oe<be.length;Oe++)wr(qe,be[Oe],ve,K,Pe==="Polygon",Oe===0);else if(Pe==="MultiPolygon")for(var De=0;De<be.length;De++){var W=be[De];for(Oe=0;Oe<W.length;Oe++)wr(qe,W[Oe],ve,K,!0,Oe===0)}if(qe.length){var X=G.tags||null;if(Pe==="LineString"&&ce.lineMetrics){for(var oe in X={},G.tags)X[oe]=G.tags[oe];X.mapbox_clip_start=be.start/be.size,X.mapbox_clip_end=be.end/be.size}var Ie={geometry:qe,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:X};G.id!==null&&(Ie.id=G.id),ve.features.push(Ie)}}function wr(ve,G,K,ce,be,Pe){var qe=ce*ce;if(ce>0&&G.size<(be?qe:ce))K.numPoints+=G.length/3;else{for(var Oe=[],De=0;De<G.length;De+=3)(ce===0||G[De+2]>qe)&&(K.numSimplified++,Oe.push(G[De]),Oe.push(G[De+1])),K.numPoints++;be&&function(W,X){for(var oe=0,Ie=0,Ue=W.length,Et=Ue-2;Ie<Ue;Et=Ie,Ie+=2)oe+=(W[Ie]-W[Et])*(W[Ie+1]+W[Et+1]);if(oe>0===X)for(Ie=0,Ue=W.length;Ie<Ue/2;Ie+=2){var yt=W[Ie],At=W[Ie+1];W[Ie]=W[Ue-2-Ie],W[Ie+1]=W[Ue-1-Ie],W[Ue-2-Ie]=yt,W[Ue-1-Ie]=At}}(Oe,Pe),ve.push(Oe)}}function sr(ve,G){var K=(G=this.options=function(be,Pe){for(var qe in Pe)be[qe]=Pe[qe];return be}(Object.create(this.options),G)).debug;if(K&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var ce=function(be,Pe){var qe=[];if(be.type==="FeatureCollection")for(var Oe=0;Oe<be.features.length;Oe++)We(qe,be.features[Oe],Pe,Oe);else We(qe,be.type==="Feature"?be:{geometry:be},Pe);return qe}(ve,G);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(be,Pe){var qe=Pe.buffer/Pe.extent,Oe=be,De=Qe(be,1,-1-qe,qe,0,-1,2,Pe),W=Qe(be,1,1-qe,2+qe,0,-1,2,Pe);return(De||W)&&(Oe=Qe(be,1,-qe,1+qe,0,-1,2,Pe)||[],De&&(Oe=nr(De,1).concat(Oe)),W&&(Oe=Oe.concat(nr(W,-1)))),Oe}(ce,G),ce.length&&this.splitTile(ce,0,0,0),K&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function zt(ve,G,K){return 32*((1<<ve)*K+G)+ve}function yi(ve,G){return G?ve.properties[G]:ve.id}function vi(ve,G){if(ve==null)return!0;if(ve.type==="Feature")return yi(ve,G)!=null;if(ve.type==="FeatureCollection"){const K=new Set;for(const ce of ve.features){const be=yi(ce,G);if(be==null||K.has(be))return!1;K.add(be)}return!0}return!1}function xr(ve,G){const K=new Map;if(ve!=null)if(ve.type==="Feature")K.set(yi(ve,G),ve);else for(const ce of ve.features)K.set(yi(ce,G),ce);return K}function Ur(ve,G){const K=ve.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return G(null,null);const be=new class{constructor(qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.EXTENT,this.length=qe.length,this._features=qe}feature(qe){return new class{constructor(Oe){this._feature=Oe,this.extent=n.EXTENT,this.type=Oe.type,this.properties=Oe.tags,"id"in Oe&&!isNaN(Oe.id)&&(this.id=parseInt(Oe.id,10))}loadGeometry(){if(this._feature.type===1){const Oe=[];for(const De of this._feature.geometry)Oe.push([new n.Point(De[0],De[1])]);return Oe}{const Oe=[];for(const De of this._feature.geometry){const W=[];for(const X of De)W.push(new n.Point(X[0],X[1]));Oe.push(W)}return Oe}}toGeoJSON(Oe,De,W){return F.call(this,Oe,De,W)}}(this._features[qe])}}(ce.features);let Pe=ut(be);Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),G(null,{vectorTile:be,rawData:Pe.buffer})}sr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},sr.prototype.splitTile=function(ve,G,K,ce,be,Pe,qe){for(var Oe=[ve,G,K,ce],De=this.options,W=De.debug;Oe.length;){ce=Oe.pop(),K=Oe.pop(),G=Oe.pop(),ve=Oe.pop();var X=1<<G,oe=zt(G,K,ce),Ie=this.tiles[oe];if(!Ie&&(W>1&&console.time("creation"),Ie=this.tiles[oe]=Ki(ve,G,K,ce,De),this.tileCoords.push({z:G,x:K,y:ce}),W)){W>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,K,ce,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var Ue="z"+G;this.stats[Ue]=(this.stats[Ue]||0)+1,this.total++}if(Ie.source=ve,be){if(G===De.maxZoom||G===be)continue;var Et=1<<be-G;if(K!==Math.floor(Pe/Et)||ce!==Math.floor(qe/Et))continue}else if(G===De.indexMaxZoom||Ie.numPoints<=De.indexMaxPoints)continue;if(Ie.source=null,ve.length!==0){W>1&&console.time("clipping");var yt,At,Gt,di,ei,ai,ui=.5*De.buffer/De.extent,li=.5-ui,gi=.5+ui,Ii=1+ui;yt=At=Gt=di=null,ei=Qe(ve,X,K-ui,K+gi,0,Ie.minX,Ie.maxX,De),ai=Qe(ve,X,K+li,K+Ii,0,Ie.minX,Ie.maxX,De),ve=null,ei&&(yt=Qe(ei,X,ce-ui,ce+gi,1,Ie.minY,Ie.maxY,De),At=Qe(ei,X,ce+li,ce+Ii,1,Ie.minY,Ie.maxY,De),ei=null),ai&&(Gt=Qe(ai,X,ce-ui,ce+gi,1,Ie.minY,Ie.maxY,De),di=Qe(ai,X,ce+li,ce+Ii,1,Ie.minY,Ie.maxY,De),ai=null),W>1&&console.timeEnd("clipping"),Oe.push(yt||[],G+1,2*K,2*ce),Oe.push(At||[],G+1,2*K,2*ce+1),Oe.push(Gt||[],G+1,2*K+1,2*ce),Oe.push(di||[],G+1,2*K+1,2*ce+1)}}},sr.prototype.getTile=function(ve,G,K){var ce=this.options,be=ce.extent,Pe=ce.debug;if(ve<0||ve>24)return null;var qe=1<<ve,Oe=zt(ve,G=(G%qe+qe)%qe,K);if(this.tiles[Oe])return qr(this.tiles[Oe],be);Pe>1&&console.log("drilling down to z%d-%d-%d",ve,G,K);for(var De,W=ve,X=G,oe=K;!De&&W>0;)W--,X=Math.floor(X/2),oe=Math.floor(oe/2),De=this.tiles[zt(W,X,oe)];return De&&De.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",W,X,oe),Pe>1&&console.time("drilling down"),this.splitTile(De.source,W,X,oe,ve,G,K),Pe>1&&console.timeEnd("drilling down"),this.tiles[Oe]?qr(this.tiles[Oe],be):null):null};class pi extends k{constructor(G,K,ce,be){super(G,K,ce,Ur),this._dataUpdateable=new Map,this.loadGeoJSON=(Pe,qe)=>{const{promoteId:Oe}=Pe;if(Pe.request)return n.getJSON(Pe.request,(De,W,X,oe)=>{this._dataUpdateable=vi(W,Oe)?xr(W,Oe):void 0,qe(De,W,X,oe)});if(typeof Pe.data=="string")try{const De=JSON.parse(Pe.data);this._dataUpdateable=vi(De,Oe)?xr(De,Oe):void 0,qe(null,De)}catch{qe(new Error(`Input data given to '${Pe.source}' is not a valid GeoJSON object.`))}else Pe.dataDiff?this._dataUpdateable?(function(De,W,X){var oe,Ie,Ue,Et;if(W.removeAll&&De.clear(),W.remove)for(const yt of W.remove)De.delete(yt);if(W.add)for(const yt of W.add){const At=yi(yt,X);At!=null&&De.set(At,yt)}if(W.update)for(const yt of W.update){let At=De.get(yt.id);if(At==null)continue;const Gt=!yt.removeAllProperties&&(((oe=yt.removeProperties)===null||oe===void 0?void 0:oe.length)>0||((Ie=yt.addOrUpdateProperties)===null||Ie===void 0?void 0:Ie.length)>0);if((yt.newGeometry||yt.removeAllProperties||Gt)&&(At=Object.assign({},At),De.set(yt.id,At),Gt&&(At.properties=Object.assign({},At.properties))),yt.newGeometry&&(At.geometry=yt.newGeometry),yt.removeAllProperties)At.properties={};else if(((Ue=yt.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const di of yt.removeProperties)Object.prototype.hasOwnProperty.call(At.properties,di)&&delete At.properties[di];if(((Et=yt.addOrUpdateProperties)===null||Et===void 0?void 0:Et.length)>0)for(const{key:di,value:ei}of yt.addOrUpdateProperties)At.properties[di]=ei}}(this._dataUpdateable,Pe.dataDiff,Oe),qe(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):qe(new Error(`Cannot update existing geojson data in ${Pe.source}`)):qe(new Error(`Input data given to '${Pe.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},be&&(this.loadGeoJSON=be)}loadData(G,K){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const be=!!(G&&G.request&&G.request.collectResourceTiming)&&new n.RequestPerformance(G.request);this._pendingCallback=K,this._pendingRequest=this.loadGeoJSON(G,(Pe,qe)=>{if(delete this._pendingCallback,delete this._pendingRequest,Pe||!qe)return K(Pe);if(typeof qe!="object")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{D(qe,!0);try{if(G.filter){const De=n.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(X=>`${X.key}: ${X.message}`).join(", "));qe={type:"FeatureCollection",features:qe.features.filter(X=>De.value.evaluate({zoom:0},X))}}this._geoJSONIndex=G.cluster?new it(function({superclusterOptions:De,clusterProperties:W}){if(!W||!De)return De;const X={},oe={},Ie={accumulated:null,zoom:0},Ue={properties:null},Et=Object.keys(W);for(const yt of Et){const[At,Gt]=W[yt],di=n.createExpression(Gt),ei=n.createExpression(typeof At=="string"?[At,["accumulated"],["get",yt]]:At);X[yt]=di.value,oe[yt]=ei.value}return De.map=yt=>{Ue.properties=yt;const At={};for(const Gt of Et)At[Gt]=X[Gt].evaluate(Ie,Ue);return At},De.reduce=(yt,At)=>{Ue.properties=At;for(const Gt of Et)Ie.accumulated=yt[Gt],yt[Gt]=oe[Gt].evaluate(Ie,Ue)},De}(G)).load(qe.features):function(De,W){return new sr(De,W)}(qe,G.geojsonVtOptions)}catch(De){return K(De)}this.loaded={};const Oe={};if(be){const De=be.finish();De&&(Oe.resourceTiming={},Oe.resourceTiming[G.source]=JSON.parse(JSON.stringify(De)))}K(null,Oe)}})}reloadTile(G,K){const ce=this.loaded;return ce&&ce[G.uid]?super.reloadTile(G,K):this.loadTile(G,K)}removeSource(G,K){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),K()}getClusterExpansionZoom(G,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ce){K(ce)}}getClusterChildren(G,K){try{K(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ce){K(ce)}}getClusterLeaves(G,K){try{K(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ce){K(ce)}}}class on{constructor(G){this.self=G,this.actor=new n.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:k,geojson:pi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(n.plugin.isParsed())throw new Error("RTL text plugin already registered.");n.plugin.applyArabicShaping=K.applyArabicShaping,n.plugin.processBidirectionalText=K.processBidirectionalText,n.plugin.processStyledBidirectionalText=K.processStyledBidirectionalText}}setReferrer(G,K){this.referrer=K}setImages(G,K,ce){this.availableImages[G]=K;for(const be in this.workerSources[G]){const Pe=this.workerSources[G][be];for(const qe in Pe)Pe[qe].availableImages=K}ce()}setLayers(G,K,ce){this.getLayerIndex(G).replace(K),ce()}updateLayers(G,K,ce){this.getLayerIndex(G).update(K.layers,K.removedIds),ce()}loadTile(G,K,ce){this.getWorkerSource(G,K.type,K.source).loadTile(K,ce)}loadDEMTile(G,K,ce){this.getDEMWorkerSource(G,K.source).loadTile(K,ce)}reloadTile(G,K,ce){this.getWorkerSource(G,K.type,K.source).reloadTile(K,ce)}abortTile(G,K,ce){this.getWorkerSource(G,K.type,K.source).abortTile(K,ce)}removeTile(G,K,ce){this.getWorkerSource(G,K.type,K.source).removeTile(K,ce)}removeDEMTile(G,K){this.getDEMWorkerSource(G,K.source).removeTile(K)}removeSource(G,K,ce){if(!this.workerSources[G]||!this.workerSources[G][K.type]||!this.workerSources[G][K.type][K.source])return;const be=this.workerSources[G][K.type][K.source];delete this.workerSources[G][K.type][K.source],be.removeSource!==void 0?be.removeSource(K,ce):ce()}loadWorkerSource(G,K,ce){try{this.self.importScripts(K.url),ce()}catch(be){ce(be.toString())}}syncRTLPluginState(G,K,ce){try{n.plugin.setState(K);const be=n.plugin.getPluginURL();if(n.plugin.isLoaded()&&!n.plugin.isParsed()&&be!=null){this.self.importScripts(be);const Pe=n.plugin.isParsed();ce(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),Pe)}}catch(be){ce(be.toString())}}getAvailableImages(G){let K=this.availableImages[G];return K||(K=[]),K}getLayerIndex(G){let K=this.layerIndexes[G];return K||(K=this.layerIndexes[G]=new g),K}getWorkerSource(G,K,ce){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][K]||(this.workerSources[G][K]={}),!this.workerSources[G][K][ce]){const be={send:(Pe,qe,Oe)=>{this.actor.send(Pe,qe,Oe,G)}};this.workerSources[G][K][ce]=new this.workerSourceTypes[K](be,this.getLayerIndex(G),this.getAvailableImages(G))}return this.workerSources[G][K][ce]}getDEMWorkerSource(G,K){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][K]||(this.demWorkerSources[G][K]=new z),this.demWorkerSources[G][K]}}return n.isWorker()&&(self.worker=new on(self)),on}),f(["./shared"],function(n){var g="3.5.1";class v{static testProp(t){if(!v.docStyle)return t[0];for(let o=0;o<t.length;o++)if(t[o]in v.docStyle)return t[o];return t[0]}static create(t,o,p){const _=window.document.createElement(t);return o!==void 0&&(_.className=o),p&&p.appendChild(_),_}static createNS(t,o){return window.document.createElementNS(t,o)}static disableDrag(){v.docStyle&&v.selectProp&&(v.userSelect=v.docStyle[v.selectProp],v.docStyle[v.selectProp]="none")}static enableDrag(){v.docStyle&&v.selectProp&&(v.docStyle[v.selectProp]=v.userSelect)}static setTransform(t,o){t.style[v.transformProp]=o}static addEventListener(t,o,p,_={}){t.addEventListener(o,p,"passive"in _?_:_.capture)}static removeEventListener(t,o,p,_={}){t.removeEventListener(o,p,"passive"in _?_:_.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",v.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",v.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",v.suppressClickInternal,!0)},0)}static mousePos(t,o){const p=t.getBoundingClientRect();return new n.Point(o.clientX-p.left-t.clientLeft,o.clientY-p.top-t.clientTop)}static touchPos(t,o){const p=t.getBoundingClientRect(),_=[];for(let w=0;w<o.length;w++)_.push(new n.Point(o[w].clientX-p.left-t.clientLeft,o[w].clientY-p.top-t.clientTop));return _}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}v.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,v.selectProp=v.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),v.transformProp=v.testProp(["transform","WebkitTransform"]);const E={supported:!1,testSupport:function(y){!k&&T&&(z?A(y):S=y)}};let S,T,k=!1,z=!1;function A(y){const t=y.createTexture();y.bindTexture(y.TEXTURE_2D,t);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,T),y.isContextLost())return;E.supported=!0}catch{}y.deleteTexture(t),k=!0}var R,D;typeof document<"u"&&(T=document.createElement("img"),T.onload=function(){S&&A(S),S=null,z=!0},T.onerror=function(){k=!0,S=null},T.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let t,o,p,_;y.resetRequestQueue=()=>{t=[],o=0,p=0,_={}},y.addThrottleControl=O=>{const V=p++;return _[V]=O,V},y.removeThrottleControl=O=>{delete _[O],P()},y.getImage=(O,V,$=!0)=>{E.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*");const Y={requestParameters:O,supportImageRefresh:$,callback:V,cancelled:!1,completed:!1,cancel:()=>{Y.completed||Y.cancelled||(Y.cancelled=!0,Y.innerRequest&&(Y.innerRequest.cancel(),o--),P())}};return t.push(Y),P(),Y};const w=O=>{const{requestParameters:V,supportImageRefresh:$,callback:Y}=O;return n.extend(V,{type:"image"}),($!==!1||n.isWorker()||n.getProtocolAction(V.url)||V.headers&&!Object.keys(V.headers).reduce((ge,de)=>ge&&de==="accept",!0)?n.makeRequest:L)(V,(ge,de,xe,fe)=>{I(O,Y,ge,de,xe,fe)})},I=(O,V,$,Y,ge,de)=>{$?V($):Y instanceof HTMLImageElement||n.isImageBitmap(Y)?V(null,Y):Y&&((xe,fe)=>{typeof createImageBitmap=="function"?n.arrayBufferToImageBitmap(xe,fe):n.arrayBufferToImage(xe,fe)})(Y,(xe,fe)=>{xe!=null?V(xe):fe!=null&&V(null,fe,{cacheControl:ge,expires:de})}),O.cancelled||(O.completed=!0,o--,P())},P=()=>{const O=(()=>{const V=Object.keys(_);let $=!1;if(V.length>0){for(const Y of V)if($=_[Y](),$)break}return $})()?n.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:n.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let V=o;V<O&&t.length>0;V++){const $=t.shift();if($.cancelled){V--;continue}const Y=w($);o++,$.innerRequest=Y}},L=(O,V)=>{const $=new Image,Y=O.url;let ge=!1;const de=O.credentials;return de&&de==="include"?$.crossOrigin="use-credentials":(de&&de==="same-origin"||!n.sameOrigin(Y))&&($.crossOrigin="anonymous"),$.fetchPriority="high",$.onload=()=>{V(null,$),$.onerror=$.onload=null},$.onerror=()=>{ge||V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),$.onerror=$.onload=null},$.src=Y,{cancel:()=>{ge=!0,$.src=""}}}}(R||(R={})),R.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(D||(D={}));class F{constructor(t){this._transformRequestFn=t}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeSpriteURL(t,o,p){const _=function(w){const I=w.match(q);if(!I)throw new Error(`Unable to parse URL "${w}"`);return{protocol:I[1],authority:I[2],path:I[3]||"/",params:I[4]?I[4].split("&"):[]}}(t);return _.path+=`${o}${p}`,function(w){const I=w.params.length?`?${w.params.join("&")}`:"";return`${w.protocol}://${w.authority}${w.path}${I}`}(_)}setTransformRequest(t){this._transformRequestFn=t}}const q=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ee(y){var t=new n.ARRAY_TYPE(3);return t[0]=y[0],t[1]=y[1],t[2]=y[2],t}var ie,ne=function(y,t,o){return y[0]=t[0]-o[0],y[1]=t[1]-o[1],y[2]=t[2]-o[2],y};ie=new n.ARRAY_TYPE(3),n.ARRAY_TYPE!=Float32Array&&(ie[0]=0,ie[1]=0,ie[2]=0);var se=function(y){var t=y[0],o=y[1];return t*t+o*o};function ue(y){const t=[];if(typeof y=="string")t.push({id:"default",url:y});else if(y&&y.length>0){const o=[];for(const{id:p,url:_}of y){const w=`${p}${_}`;o.indexOf(w)===-1&&(o.push(w),t.push({id:p,url:_}))}}return t}function Ce(y,t,o,p,_){if(p)return void y(p);if(_!==Object.values(t).length||_!==Object.values(o).length)return;const w={};for(const I in t){w[I]={};const P=n.browser.getImageCanvasContext(o[I]),L=t[I];for(const O in L){const{width:V,height:$,x:Y,y:ge,sdf:de,pixelRatio:xe,stretchX:fe,stretchY:Ve,content:rt}=L[O];w[I][O]={data:null,pixelRatio:xe,sdf:de,stretchX:fe,stretchY:Ve,content:rt,spriteData:{width:V,height:$,x:Y,y:ge,context:P}}}}y(null,w)}(function(){var y=new n.ARRAY_TYPE(2);n.ARRAY_TYPE!=Float32Array&&(y[0]=0,y[1]=0)})();class ye{constructor(t,o,p,_){this.context=t,this.format=p,this.texture=t.gl.createTexture(),this.update(o,_)}update(t,o,p){const{width:_,height:w}=t,I=!(this.size&&this.size[0]===_&&this.size[1]===w||p),{context:P}=this,{gl:L}=P;if(this.useMipmap=!!(o&&o.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!o||o.premultiply!==!1)),I)this.size=[_,w],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||n.isImageBitmap(t)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,t):L.texImage2D(L.TEXTURE_2D,0,this.format,_,w,0,this.format,L.UNSIGNED_BYTE,t.data);else{const{x:O,y:V}=p||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||n.isImageBitmap(t)?L.texSubImage2D(L.TEXTURE_2D,0,O,V,L.RGBA,L.UNSIGNED_BYTE,t):L.texSubImage2D(L.TEXTURE_2D,0,O,V,_,w,L.RGBA,L.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(t,o,p){const{context:_}=this,{gl:w}=_;w.bindTexture(w.TEXTURE_2D,this.texture),p!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=w.LINEAR),t!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,t),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,p||t),this.filter=t),o!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,o),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Xe(y){const{userImage:t}=y;return!!(t&&t.render&&t.render())&&(y.data.replace(new Uint8Array(t.data.buffer)),!0)}class ae extends n.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:o,callback:p}of this.requestors)this._notify(o,p);this.requestors=[]}}getImage(t){const o=this.images[t];if(o&&!o.data&&o.spriteData){const p=o.spriteData;o.data=new n.RGBAImage({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),o.spriteData=null}return o}addImage(t,o){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,o)&&(this.images[t]=o)}_validate(t,o){let p=!0;const _=o.data||o.spriteData;return this._validateStretch(o.stretchX,_&&_.width)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(o.stretchY,_&&_.height)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(o.content,o)||(this.fire(new n.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,o){if(!t)return!0;let p=0;for(const _ of t){if(_[0]<p||_[1]<_[0]||o<_[1])return!1;p=_[1]}return!0}_validateContent(t,o){if(!t)return!0;if(t.length!==4)return!1;const p=o.spriteData,_=p&&p.width||o.data.width,w=p&&p.height||o.data.height;return!(t[0]<0||_<t[0]||t[1]<0||w<t[1]||t[2]<0||_<t[2]||t[3]<0||w<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,o,p=!0){const _=this.getImage(t);if(p&&(_.data.width!==o.data.width||_.data.height!==o.data.height))throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=_.version+1,this.images[t]=o,this.updatedImages[t]=!0}removeImage(t){const o=this.images[t];delete this.images[t],delete this.patterns[t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,o){let p=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(t,o):this.requestors.push({ids:t,callback:o})}_notify(t,o){const p={};for(const _ of t){let w=this.getImage(_);w||(this.fire(new n.Event("styleimagemissing",{id:_})),w=this.getImage(_)),w?p[_]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:n.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,p)}getPixelSize(){const{width:t,height:o}=this.atlasImage;return{width:t,height:o}}getPattern(t){const o=this.patterns[t],p=this.getImage(t);if(!p)return null;if(o&&o.position.version===p.version)return o.position;if(o)o.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},w=new n.ImagePosition(_,p);this.patterns[t]={bin:_,position:w}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const o=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ye(t,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const w in this.patterns)t.push(this.patterns[w].bin);const{w:o,h:p}=n.potpack(t),_=this.atlasImage;_.resize({width:o||1,height:p||1});for(const w in this.patterns){const{bin:I}=this.patterns[w],P=I.x+1,L=I.y+1,O=this.getImage(w).data,V=O.width,$=O.height;n.RGBAImage.copy(O,_,{x:0,y:0},{x:P,y:L},{width:V,height:$}),n.RGBAImage.copy(O,_,{x:0,y:$-1},{x:P,y:L-1},{width:V,height:1}),n.RGBAImage.copy(O,_,{x:0,y:0},{x:P,y:L+$},{width:V,height:1}),n.RGBAImage.copy(O,_,{x:V-1,y:0},{x:P-1,y:L},{width:1,height:$}),n.RGBAImage.copy(O,_,{x:0,y:0},{x:P+V,y:L},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const o of t){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const p=this.getImage(o);p||n.warnOnce(`Image with ID: "${o}" was not found`),Xe(p)&&this.updateImage(o,p)}}}const Le=1e20;function Z(y,t,o,p,_,w,I,P,L){for(let O=t;O<t+p;O++)tt(y,o*w+O,w,_,I,P,L);for(let O=o;O<o+_;O++)tt(y,O*w+t,1,p,I,P,L)}function tt(y,t,o,p,_,w,I){w[0]=0,I[0]=-Le,I[1]=Le,_[0]=y[t];for(let P=1,L=0,O=0;P<p;P++){_[P]=y[t+P*o];const V=P*P;do{const $=w[L];O=(_[P]-_[$]+V-$*$)/(P-$)/2}while(O<=I[L]&&--L>-1);L++,w[L]=P,I[L]=O,I[L+1]=Le}for(let P=0,L=0;P<p;P++){for(;I[L+1]<P;)L++;const O=w[L],V=P-O;y[t+P*o]=_[O]+V*V}}class $t{constructor(t,o){this.requestManager=t,this.localIdeographFontFamily=o,this.entries={}}setURL(t){this.url=t}getGlyphs(t,o){const p=[];for(const _ in t)for(const w of t[_])p.push({stack:_,id:w});n.asyncAll(p,({stack:_,id:w},I)=>{let P=this.entries[_];P||(P=this.entries[_]={glyphs:{},requests:{},ranges:{}});let L=P.glyphs[w];if(L!==void 0)return void I(null,{stack:_,id:w,glyph:L});if(L=this._tinySDF(P,_,w),L)return P.glyphs[w]=L,void I(null,{stack:_,id:w,glyph:L});const O=Math.floor(w/256);if(256*O>65535)return void I(new Error("glyphs > 65535 not supported"));if(P.ranges[O])return void I(null,{stack:_,id:w,glyph:L});if(!this.url)return void I(new Error("glyphsUrl is not set"));let V=P.requests[O];V||(V=P.requests[O]=[],$t.loadGlyphRange(_,O,this.url,this.requestManager,($,Y)=>{if(Y){for(const ge in Y)this._doesCharSupportLocalGlyph(+ge)||(P.glyphs[+ge]=Y[+ge]);P.ranges[O]=!0}for(const ge of V)ge($,Y);delete P.requests[O]})),V.push(($,Y)=>{$?I($):Y&&I(null,{stack:_,id:w,glyph:Y[w]||null})})},(_,w)=>{if(_)o(_);else if(w){const I={};for(const{stack:P,id:L,glyph:O}of w)(I[P]||(I[P]={}))[L]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};o(null,I)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(n.unicodeBlockLookup["CJK Unified Ideographs"](t)||n.unicodeBlockLookup["Hangul Syllables"](t)||n.unicodeBlockLookup.Hiragana(t)||n.unicodeBlockLookup.Katakana(t))}_tinySDF(t,o,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let w=t.tinySDF;if(!w){let P="400";/bold/i.test(o)?P="900":/medium/i.test(o)?P="500":/light/i.test(o)&&(P="200"),w=t.tinySDF=new $t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:_,fontWeight:P})}const I=w.draw(String.fromCharCode(p));return{id:p,bitmap:new n.AlphaImage({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}$t.loadGlyphRange=function(y,t,o,p,_){const w=256*t,I=w+255,P=p.transformRequest(o.replace("{fontstack}",y).replace("{range}",`${w}-${I}`),D.Glyphs);n.getArrayBuffer(P,(L,O)=>{if(L)_(L);else if(O){const V={};for(const $ of n.parseGlyphPbf(O))V[$.id]=$;_(null,V)}})},$t.TinySDF=class{constructor({fontSize:y=24,buffer:t=3,radius:o=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:w="normal",fontStyle:I="normal"}={}){this.buffer=t,this.cutoff=p,this.radius=o;const P=this.size=y+4*t,L=this._createCanvas(P),O=this.ctx=L.getContext("2d",{willReadFrequently:!0});O.font=`${I} ${w} ${y}px ${_}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(y){const t=document.createElement("canvas");return t.width=t.height=y,t}draw(y){const{width:t,actualBoundingBoxAscent:o,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:w}=this.ctx.measureText(y),I=Math.ceil(o),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-_))),L=Math.min(this.size-this.buffer,I+Math.ceil(p)),O=P+2*this.buffer,V=L+2*this.buffer,$=Math.max(O*V,0),Y=new Uint8ClampedArray($),ge={data:Y,width:O,height:V,glyphWidth:P,glyphHeight:L,glyphTop:I,glyphLeft:0,glyphAdvance:t};if(P===0||L===0)return ge;const{ctx:de,buffer:xe,gridInner:fe,gridOuter:Ve}=this;de.clearRect(xe,xe,P,L),de.fillText(y,xe,xe+I);const rt=de.getImageData(xe,xe,P,L);Ve.fill(Le,0,$),fe.fill(0,0,$);for(let Ae=0;Ae<L;Ae++)for(let Ge=0;Ge<P;Ge++){const ot=rt.data[4*(Ae*P+Ge)+3]/255;if(ot===0)continue;const lt=(Ae+xe)*O+Ge+xe;if(ot===1)Ve[lt]=0,fe[lt]=Le;else{const pt=.5-ot;Ve[lt]=pt>0?pt*pt:0,fe[lt]=pt<0?pt*pt:0}}Z(Ve,0,0,O,V,O,this.f,this.v,this.z),Z(fe,xe,xe,P,L,O,this.f,this.v,this.z);for(let Ae=0;Ae<$;Ae++){const Ge=Math.sqrt(Ve[Ae])-Math.sqrt(fe[Ae]);Y[Ae]=Math.round(255-255*(Ge/this.radius+this.cutoff))}return ge}};class ft{constructor(){this.specification=n.v8Spec.light.position}possiblyEvaluate(t,o){return n.sphericalToCartesian(t.expression.evaluate(o))}interpolate(t,o,p){return{x:n.interpolate.number(t.x,o.x,p),y:n.interpolate.number(t.y,o.y,p),z:n.interpolate.number(t.z,o.z,p)}}}let Jt;class ut extends n.Evented{constructor(t){super(),Jt=Jt||new n.Properties({anchor:new n.DataConstantProperty(n.v8Spec.light.anchor),position:new ft,color:new n.DataConstantProperty(n.v8Spec.light.color),intensity:new n.DataConstantProperty(n.v8Spec.light.intensity)}),this._transitionable=new n.Transitionable(Jt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o={}){if(!this._validate(n.validateLight,t,o))for(const p in t){const _=t[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,p){return(!p||p.validate!==!1)&&n.emitValidationErrors(this,t.call(n.validateStyle,n.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.v8Spec})))}}class at{constructor(t,o){this.width=t,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,o){const p=t.join(",")+String(o);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(t,o)),this.dashEntry[p]}getDashRanges(t,o,p){const _=[];let w=t.length%2==1?-t[t.length-1]*p:0,I=t[0]*p,P=!0;_.push({left:w,right:I,isDash:P,zeroLength:t[0]===0});let L=t[0];for(let O=1;O<t.length;O++){P=!P;const V=t[O];w=L*p,L+=V,I=L*p,_.push({left:w,right:I,isDash:P,zeroLength:V===0})}return _}addRoundDash(t,o,p){const _=o/2;for(let w=-p;w<=p;w++){const I=this.width*(this.nextRow+p+w);let P=0,L=t[P];for(let O=0;O<this.width;O++){O/L.right>1&&(L=t[++P]);const V=Math.abs(O-L.left),$=Math.abs(O-L.right),Y=Math.min(V,$);let ge;const de=w/p*(_+1);if(L.isDash){const xe=_-Math.abs(de);ge=Math.sqrt(Y*Y+xe*xe)}else ge=_-Math.sqrt(Y*Y+de*de);this.data[I+O]=Math.max(0,Math.min(255,ge+128))}}}addRegularDash(t){for(let P=t.length-1;P>=0;--P){const L=t[P],O=t[P+1];L.zeroLength?t.splice(P,1):O&&O.isDash===L.isDash&&(O.left=L.left,t.splice(P,1))}const o=t[0],p=t[t.length-1];o.isDash===p.isDash&&(o.left=p.left-this.width,p.right=o.right+this.width);const _=this.width*this.nextRow;let w=0,I=t[w];for(let P=0;P<this.width;P++){P/I.right>1&&(I=t[++w]);const L=Math.abs(P-I.left),O=Math.abs(P-I.right),V=Math.min(L,O);this.data[_+P]=Math.max(0,Math.min(255,(I.isDash?V:-V)+128))}}addDash(t,o){const p=o?7:0,_=2*p+1;if(this.nextRow+_>this.height)return n.warnOnce("LineAtlas out of space"),null;let w=0;for(let P=0;P<t.length;P++)w+=t[P];if(w!==0){const P=this.width/w,L=this.getDashRanges(t,this.width,P);o?this.addRoundDash(L,P,p):this.addRegularDash(L)}const I={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:w};return this.nextRow+=_,this.dirty=!0,I}bind(t){const o=t.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}class le{constructor(t,o,p){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=p;const _=this.workerPool.acquire(p);for(let w=0;w<_.length;w++){const I=new le.Actor(_[w],o,p);I.name=`Worker ${w}`,this.actors.push(I)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,o,p){n.asyncAll(this.actors,(_,w)=>{_.send(t,o,w)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Ee(y,t,o){const p=function(_,w){if(_)return o(_);if(w){const I=n.pick(n.extend(w,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(I.vectorLayers=w.vector_layers,I.vectorLayerIds=I.vectorLayers.map(P=>P.id)),o(null,I)}};return y.url?n.getJSON(t.transformRequest(y.url,D.Source),p):n.browser.frame(()=>p(null,y))}le.Actor=n.Actor;class Re{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof n.LngLat?new n.LngLat(t.lng,t.lat):n.LngLat.convert(t),this}setSouthWest(t){return this._sw=t instanceof n.LngLat?new n.LngLat(t.lng,t.lat):n.LngLat.convert(t),this}extend(t){const o=this._sw,p=this._ne;let _,w;if(t instanceof n.LngLat)_=t,w=t;else{if(!(t instanceof Re))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Re.convert(t)):this.extend(n.LngLat.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(n.LngLat.convert(t)):this;if(_=t._sw,w=t._ne,!_||!w)return this}return o||p?(o.lng=Math.min(_.lng,o.lng),o.lat=Math.min(_.lat,o.lat),p.lng=Math.max(w.lng,p.lng),p.lat=Math.max(w.lat,p.lat)):(this._sw=new n.LngLat(_.lng,_.lat),this._ne=new n.LngLat(w.lng,w.lat)),this}getCenter(){return new n.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new n.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new n.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:p}=n.LngLat.convert(t);let _=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&_}static convert(t){return t instanceof Re?t:t&&new Re(t)}static fromLngLat(t,o=0){const p=360*o/40075017,_=p/Math.cos(Math.PI/180*t.lat);return new Re(new n.LngLat(t.lng-_,t.lat-p),new n.LngLat(t.lng+_,t.lat+p))}}class Q{constructor(t,o,p){this.bounds=Re.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const o=Math.pow(2,t.z),p=Math.floor(n.mercatorXfromLng(this.bounds.getWest())*o),_=Math.floor(n.mercatorYfromLat(this.bounds.getNorth())*o),w=Math.ceil(n.mercatorXfromLng(this.bounds.getEast())*o),I=Math.ceil(n.mercatorYfromLat(this.bounds.getSouth())*o);return t.x>=p&&t.x<w&&t.y>=_&&t.y<I}}class he extends n.Evented{constructor(t,o,p,_){if(super(),this.load=()=>{this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ee(this._options,this.map._requestManager,(w,I)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),w?this.fire(new n.ErrorEvent(w)):I&&(n.extend(this,I),I.bounds&&(this.tileBounds=new Q(I.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>n.extend({},this._options),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.extend(this,n.pick(o,["url","scheme","tileSize","promoteId"])),this._options=n.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,o){const p=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,D.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function w(I,P){return delete t.request,t.aborted?o(null):I&&I.status!==404?o(I):(P&&P.resourceTiming&&(t.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&t.setExpiryData(P),t.loadVectorData(P,this.map.painter),o(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",_,w.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",_,w.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class it extends n.Evented{constructor(t,o,p,_){super(),this.id=t,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.extend({type:"raster"},o),n.extend(this,n.pick(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ee(this._options,this.map._requestManager,(t,o)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new n.ErrorEvent(t)):o&&(n.extend(this,o),o.bounds&&(this.tileBounds=new Q(o.bounds,this.minzoom,this.maxzoom)),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return n.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const p=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=R.getImage(this.map._requestManager.transformRequest(p,D.Tile),(_,w,I)=>{if(delete t.request,t.aborted)t.state="unloaded",o(null);else if(_)t.state="errored",o(_);else if(w){this.map._refreshExpiredTiles&&I&&t.setExpiryData(I);const P=this.map.painter.context,L=P.gl;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new ye(P,w,L.RGBA,{useMipmap:!0}),t.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),P.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax)),t.state="loaded",o(null)}},this.map._refreshExpiredTiles)}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o()}unloadTile(t,o){t.texture&&this.map.painter.saveTileTexture(t.texture),o()}hasTransition(){return!1}}class Ct extends it{constructor(t,o,p,_){super(t,o,p,_),this.type="raster-dem",this.maxzoom=22,this._options=n.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(t,o){const p=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(p,D.Tile);function w(I,P){I&&(t.state="errored",o(I)),P&&(t.dem=P,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",o(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=R.getImage(_,(I,P,L)=>n.__awaiter(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",o(null);else if(I)t.state="errored",o(I);else if(P){this.map._refreshExpiredTiles&&t.setExpiryData(L);const O=n.isImageBitmap(P)&&n.offscreenCanvasSupported()?P:yield function($){return n.__awaiter(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&n.isOffscreenCanvasDistorted()){const Y=$.width+2,ge=$.height+2;try{return new n.RGBAImage({width:Y,height:ge},yield n.readImageUsingVideoFrame($,-1,-1,Y,ge))}catch{}}return n.browser.getImageData($,1)})}(P),V={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:O,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",V,w))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const o=t.canonical,p=Math.pow(2,o.z),_=(o.x-1+p)%p,w=o.x===0?t.wrap-1:t.wrap,I=(o.x+1+p)%p,P=o.x+1===p?t.wrap+1:t.wrap,L={};return L[new n.OverscaledTileID(t.overscaledZ,w,o.z,_,o.y).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,P,o.z,I,o.y).key]={backfilled:!1},o.y>0&&(L[new n.OverscaledTileID(t.overscaledZ,w,o.z,_,o.y-1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,t.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,P,o.z,I,o.y-1).key]={backfilled:!1}),o.y+1<p&&(L[new n.OverscaledTileID(t.overscaledZ,w,o.z,_,o.y+1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,t.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},L[new n.OverscaledTileID(t.overscaledZ,P,o.z,I,o.y+1).key]={backfilled:!1}),L}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class bt extends n.Evented{constructor(t,o,p,_){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>n.extend({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=o.data,this._options=n.extend({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const w=n.EXTENT/this.tileSize;this.workerOptions=n.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*w,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*w,extent:n.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:n.EXTENT,radius:(o.clusterRadius||50)*w,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},o),this}getClusterChildren(t,o){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},o),this}getClusterLeaves(t,o,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:o,offset:p},_),this}_updateWorkerData(t){const o=n.extend({},this.workerOptions);t?o.dataDiff=t:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(n.browser.resolveURL(this._data),D.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new n.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,o,(p,_)=>{if(this._pendingLoads--,this._removed||_&&_.abandoned)return void this.fire(new n.Event("dataabort",{dataType:"source"}));let w=null;if(_&&_.resourceTiming&&_.resourceTiming[this.id]&&(w=_.resourceTiming[this.id].slice(0)),p)return void this.fire(new n.ErrorEvent(p));const I={dataType:"source"};this._collectResourceTiming&&w&&w.length>0&&n.extend(I,{resourceTiming:w}),this.fire(new n.Event("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new n.Event("data",Object.assign(Object.assign({},I),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,o){const p=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const _={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(p,_,(w,I)=>(delete t.request,t.unloadVectorData(),t.aborted?o(null):w?o(w):(t.loadVectorData(I,this.map.painter,p==="reloadTile"),o(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var It=n.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Bt extends n.Evented{constructor(t,o,p,_){super(),this.load=(w,I)=>{this._loaded=!1,this.fire(new n.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=R.getImage(this.map._requestManager.transformRequest(this.url,D.Image),(P,L)=>{this._request=null,this._loaded=!0,P?this.fire(new n.ErrorEvent(P)):L&&(this.image=L,w&&(this.coordinates=w),I&&I(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const w=this.map.painter.context,I=w.gl;this.boundsBuffer||(this.boundsBuffer=w.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ye(w,this.image,I.RGBA),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE));let P=!1;for(const L in this.tiles){const O=this.tiles[L];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,P=!0)}P&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=p,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=o}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const o=t.map(n.MercatorCoordinate.fromLngLat);this.tileID=function(_){let w=1/0,I=1/0,P=-1/0,L=-1/0;for(const Y of _)w=Math.min(w,Y.x),I=Math.min(I,Y.y),P=Math.max(P,Y.x),L=Math.max(L,Y.y);const O=Math.max(P-w,L-I),V=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),$=Math.pow(2,V);return new n.CanonicalTileID(V,Math.floor((w+P)/2*$),Math.floor((I+L)/2*$))}(o),this.minzoom=this.maxzoom=this.tileID.z;const p=o.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new n.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,n.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,n.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,n.EXTENT,n.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new n.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,o){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},o(null)):(t.state="errored",o(null))}hasTransition(){return!1}}class Fe extends Bt{constructor(t,o,p,_){super(t,o,p,_),this.load=()=>{this._loaded=!1;const w=this.options;this.urls=[];for(const I of w.urls)this.urls.push(this.map._requestManager.transformRequest(I,D.Source).url);n.getVideo(this.urls,(I,P)=>{this._loaded=!0,I?this.fire(new n.ErrorEvent(I)):P&&(this.video=P,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const w=this.map.painter.context,I=w.gl;this.boundsBuffer||(this.boundsBuffer=w.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.texSubImage2D(I.TEXTURE_2D,0,0,0,I.RGBA,I.UNSIGNED_BYTE,this.video)):(this.texture=new ye(w,this.video,I.RGBA),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE));let P=!1;for(const L in this.tiles){const O=this.tiles[L];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,P=!0)}P&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=o}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const o=this.video.seekable;t<o.start(0)||t>o.end(0)?this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Se extends Bt{constructor(t,o,p,_){super(t,o,p,_),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let w=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,w=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,w=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const I=this.map.painter.context,P=I.gl;this.boundsBuffer||(this.boundsBuffer=I.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=n.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(w||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ye(I,this.canvas,P.RGBA,{premultiply:!0});let L=!1;for(const O in this.tiles){const V=this.tiles[O];V.state!=="loaded"&&(V.state="loaded",V.texture=this.texture,L=!0)}L&&this.fire(new n.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(I=>typeof I!="number"))||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.ErrorEvent(new n.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const ct={},N=y=>{switch(y){case"geojson":return bt;case"image":return Bt;case"raster":return it;case"raster-dem":return Ct;case"vector":return he;case"video":return Fe;case"canvas":return Se}return ct[y]};function Je(y,t){const o=n.create();return n.translate(o,o,[1,1,0]),n.scale(o,o,[.5*y.width,.5*y.height,1]),n.multiply(o,o,y.calculatePosMatrix(t.toUnwrapped()))}function We(y,t,o,p,_,w){const I=function($,Y,ge){if($)for(const de of $){const xe=Y[de];if(xe&&xe.source===ge&&xe.type==="fill-extrusion")return!0}else for(const de in Y){const xe=Y[de];if(xe.source===ge&&xe.type==="fill-extrusion")return!0}return!1}(_&&_.layers,t,y.id),P=w.maxPitchScaleFactor(),L=y.tilesIn(p,P,I);L.sort(we);const O=[];for(const $ of L)O.push({wrappedTileID:$.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(t,o,y._state,$.queryGeometry,$.cameraQueryGeometry,$.scale,_,w,P,Je(y.transform,$.tileID))});const V=function($){const Y={},ge={};for(const de of $){const xe=de.queryResults,fe=de.wrappedTileID,Ve=ge[fe]=ge[fe]||{};for(const rt in xe){const Ae=xe[rt],Ge=Ve[rt]=Ve[rt]||{},ot=Y[rt]=Y[rt]||[];for(const lt of Ae)Ge[lt.featureIndex]||(Ge[lt.featureIndex]=!0,ot.push(lt))}}return Y}(O);for(const $ in V)V[$].forEach(Y=>{const ge=Y.feature,de=y.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=de});return V}function we(y,t){const o=y.tileID,p=t.tileID;return o.overscaledZ-p.overscaledZ||o.canonical.y-p.canonical.y||o.wrap-p.wrap||o.canonical.x-p.canonical.x}class me{constructor(t,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=n.uniqueId(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const o=t+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,o,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(_,w){const I={};if(!w)return I;for(const P of _){const L=P.layerIds.map(O=>w.getLayer(O)).filter(Boolean);if(L.length!==0){P.layers=L,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(O=>L.filter(V=>V.id===O)[0]));for(const O of L)I[O.id]=P}}return I}(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const w=this.buckets[_];if(w instanceof n.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const w=this.buckets[_];if(w instanceof n.SymbolBucket&&w.hasRTLText){this.hasRTLText=!0,n.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const w=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(_).queryRadius(w))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new n.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(t)}const o=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ye(t,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ye(t,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,o,p,_,w,I,P,L,O,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:w,scale:I,tileSize:this.tileSize,pixelPosMatrix:V,transform:L,params:P,queryPadding:this.queryPadding*O},t,o,p):{}}querySourceFeatures(t,o){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),w=o&&o.sourceLayer?o.sourceLayer:"",I=_._geojsonTileLayer||_[w];if(!I)return;const P=n.createFilter(o&&o.filter),{z:L,x:O,y:V}=this.tileID.canonical,$={z:L,x:O,y:V};for(let Y=0;Y<I.length;Y++){const ge=I.feature(Y);if(P.needGeometry){const fe=n.toEvaluationFeature(ge,!0);if(!P.filter(new n.EvaluationParameters(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!P.filter(new n.EvaluationParameters(this.tileID.overscaledZ),ge))continue;const de=p.getId(ge,w),xe=new n.GeoJSONFeature(ge,L,O,V,de);xe.tile=$,t.push(xe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const p=n.parseCacheControl(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{const w=this.expirationTime-o;w?this.expirationTime=p+Math.max(w,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!o.style.hasLayer(_))continue;const w=this.buckets[_],I=w.layers[0].sourceLayer||"_geojsonTileLayer",P=p[I],L=t[I];if(!P||!L||Object.keys(L).length===0)continue;w.update(L,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const O=o&&o.style&&o.style.getLayer(_);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.browser.now()+t}setDependencies(t,o){const p={};for(const _ of o)p[_]=!0;this.dependencies[t]=p}hasDependency(t,o){for(const p of t){const _=this.dependencies[p];if(_){for(const w of o)if(_[w])return!0}}return!1}}class Ne{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,p){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const w={value:o,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout(()=>{this.remove(t,w)},p)),this.data[_].push(w),this.order.push(_),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const p=t.wrapped().key,_=o===void 0?0:this.data[p].indexOf(o),w=this.data[p][_];return this.data[p].splice(_,1),w.timeout&&clearTimeout(w.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(w.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const p in this.data)for(const _ of this.data[p])t(_.value)||o.push(_);for(const p of o)this.remove(p.value.tileID,p)}}class ht{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,p){const _=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},n.extend(this.stateChanges[t][_],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const w in this.state[t])w!==_&&(this.deletedStates[t][w]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const w in this.state[t][_])p[w]||(this.deletedStates[t][_][w]=null)}else for(const w in p)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][w]===null&&delete this.deletedStates[t][_][w]}removeFeatureState(t,o,p){if(this.deletedStates[t]===null)return;const _=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&o!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][p]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(p in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][p]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,o){const p=String(o),_=n.extend({},(this.state[t]||{})[p],(this.stateChanges[t]||{})[p]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const w=this.deletedStates[t][o];if(w===null)return{};for(const I in w)delete _[I]}return _}initializeTileState(t,o){t.setFeatureState(this.state,o)}coalesceChanges(t,o){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const w={};for(const I in this.stateChanges[_])this.state[_][I]||(this.state[_][I]={}),n.extend(this.state[_][I],this.stateChanges[_][I]),w[I]=this.state[_][I];p[_]=w}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const w={};if(this.deletedStates[_]===null)for(const I in this.state[_])w[I]={},this.state[_][I]={};else for(const I in this.deletedStates[_]){if(this.deletedStates[_][I]===null)this.state[_][I]={};else for(const P of Object.keys(this.deletedStates[_][I]))delete this.state[_][I][P];w[I]=this.state[_][I]}p[_]=p[_]||{},n.extend(p[_],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in t)t[_].setFeatureState(p,o)}}class ke extends n.Evented{constructor(t,o,p){super(),this.id=t,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((_,w,I,P)=>{const L=new(N(w.type))(_,w,I,P);if(L.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${L.id}`);return L})(t,o,p,this),this._tiles={},this._cache=new Ne(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ht,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,o){return this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new n.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const p=this._tiles[o];p.upload(t),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Qe).map(t=>t.key)}getRenderableIds(t){const o=[];for(const p in this._tiles)this._isIdRenderable(p,t)&&o.push(this._tiles[p]);return t?o.sort((p,_)=>{const w=p.tileID,I=_.tileID,P=new n.Point(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),L=new n.Point(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-I.overscaledZ||L.y-P.y||L.x-P.x}).map(p=>p.tileID.key):o.map(p=>p.tileID).sort(Qe).map(p=>p.key)}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,o){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=o),this._loadTile(p,this._tileLoaded.bind(this,p,t,o)))}_tileLoaded(t,o,p,_){if(_)return t.state="errored",void(_.status!==404?this._source.fire(new n.ErrorEvent(_,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=n.browser.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new n.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const o=this.getRenderableIds();for(let _=0;_<o.length;_++){const w=o[_];if(t.neighboringTiles&&t.neighboringTiles[w]){const I=this.getTileByID(w);p(t,I),p(I,t)}}function p(_,w){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let I=w.tileID.canonical.x-_.tileID.canonical.x;const P=w.tileID.canonical.y-_.tileID.canonical.y,L=Math.pow(2,_.tileID.canonical.z),O=w.tileID.key;I===0&&P===0||Math.abs(P)>1||(Math.abs(I)>1&&(Math.abs(I+L)===1?I+=L:Math.abs(I-L)===1&&(I-=L)),w.dem&&_.dem&&(_.dem.backfillBorder(w.dem,I,P),_.neighboringTiles&&_.neighboringTiles[O]&&(_.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,p,_){for(const w in this._tiles){let I=this._tiles[w];if(_[w]||!I.hasData()||I.tileID.overscaledZ<=o||I.tileID.overscaledZ>p)continue;let P=I.tileID;for(;I&&I.tileID.overscaledZ>o+1;){const O=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[O.key],I&&I.hasData()&&(P=O)}let L=P;for(;L.overscaledZ>o;)if(L=L.scaledTo(L.overscaledZ-1),t[L.key]){_[P.key]=P;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=o?p:null}for(let p=t.overscaledZ-1;p>=o;p--){const _=t.scaledTo(p),w=this._getLoadedTile(_);if(w)return w}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const o=Math.ceil(t.width/this._source.tileSize)+1,p=Math.ceil(t.height/this._source.tileSize)+1,_=Math.floor(o*p*(this._maxTileCacheZoomLevels===null?n.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(w)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const p={};for(const _ in this._tiles){const w=this._tiles[_];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+o),p[w.tileID.key]=w}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(t,o){if(this.transform=t,this.terrain=o,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new n.OverscaledTileID(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)):(p=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(p=p.filter(V=>this._source.hasTile(V)))):p=[];const _=t.coveringZoomLevel(this._source),w=Math.max(_-ke.maxOverzooming,this._source.minzoom),I=Math.max(_+ke.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const V={};for(const $ of p)if($.canonical.z>this._source.minzoom){const Y=$.scaledTo($.canonical.z-1);V[Y.key]=Y;const ge=$.scaledTo(Math.max(this._source.minzoom,Math.min($.canonical.z,5)));V[ge.key]=ge}p=p.concat(Object.values(V))}const P=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new n.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const L=this._updateRetainedTiles(p,_);if(xt(this._source.type)){const V={},$={},Y=Object.keys(L),ge=n.browser.now();for(const de of Y){const xe=L[de],fe=this._tiles[de];if(!fe||fe.fadeEndTime!==0&&fe.fadeEndTime<=ge)continue;const Ve=this.findLoadedParent(xe,w);Ve&&(this._addTile(Ve.tileID),V[Ve.tileID.key]=Ve.tileID),$[de]=xe}this._retainLoadedChildren($,_,I,L);for(const de in V)L[de]||(this._coveredTiles[de]=!0,L[de]=V[de]);if(o){const de={},xe={};for(const fe of p)this._tiles[fe.key].hasData()?de[fe.key]=fe:xe[fe.key]=fe;for(const fe in xe){const Ve=xe[fe].children(this._source.maxzoom);this._tiles[Ve[0].key]&&this._tiles[Ve[1].key]&&this._tiles[Ve[2].key]&&this._tiles[Ve[3].key]&&(de[Ve[0].key]=L[Ve[0].key]=Ve[0],de[Ve[1].key]=L[Ve[1].key]=Ve[1],de[Ve[2].key]=L[Ve[2].key]=Ve[2],de[Ve[3].key]=L[Ve[3].key]=Ve[3],delete xe[fe])}for(const fe in xe){const Ve=this.findLoadedParent(xe[fe],this._source.minzoom);if(Ve){de[Ve.tileID.key]=L[Ve.tileID.key]=Ve.tileID;for(const rt in de)de[rt].isChildOf(Ve.tileID)&&delete de[rt]}}for(const fe in this._tiles)de[fe]||(this._coveredTiles[fe]=!0)}}for(const V in L)this._tiles[V].clearFadeHold();const O=n.keysDifference(this._tiles,L);for(const V of O){const $=this._tiles[V];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,o){const p={},_={},w=Math.max(o-ke.maxOverzooming,this._source.minzoom),I=Math.max(o+ke.maxUnderzooming,this._source.minzoom),P={};for(const L of t){const O=this._addTile(L);p[L.key]=L,O.hasData()||o<this._source.maxzoom&&(P[L.key]=L)}this._retainLoadedChildren(P,o,I,p);for(const L of t){let O=this._tiles[L.key];if(O.hasData())continue;if(o+1>this._source.maxzoom){const $=L.children(this._source.maxzoom)[0],Y=this.getTile($);if(Y&&Y.hasData()){p[$.key]=$;continue}}else{const $=L.children(this._source.maxzoom);if(p[$[0].key]&&p[$[1].key]&&p[$[2].key]&&p[$[3].key])continue}let V=O.wasRequested();for(let $=L.overscaledZ-1;$>=w;--$){const Y=L.scaledTo($);if(_[Y.key])break;if(_[Y.key]=!0,O=this.getTile(Y),!O&&V&&(O=this._addTile(Y)),O){const ge=O.hasData();if((V||ge)&&(p[Y.key]=Y),V=O.wasRequested(),ge)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let p,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}o.push(_.key);const w=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(w),p)break;_=w}for(const w of o)this._loadedParentTiles[w]=p}}_addTile(t){let o=this._tiles[t.key];if(o)return o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const p=o;return o||(o=new me(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))),o.uses++,this._tiles[t.key]=o,p||this._source.fire(new n.Event("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=o.getExpiryTimeout();p&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},p))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,o,p){const _=[],w=this.transform;if(!w)return _;const I=p?w.getCameraQueryGeometry(t):t,P=t.map(de=>w.pointCoordinate(de,this.terrain)),L=I.map(de=>w.pointCoordinate(de,this.terrain)),O=this.getIds();let V=1/0,$=1/0,Y=-1/0,ge=-1/0;for(const de of L)V=Math.min(V,de.x),$=Math.min($,de.y),Y=Math.max(Y,de.x),ge=Math.max(ge,de.y);for(let de=0;de<O.length;de++){const xe=this._tiles[O[de]];if(xe.holdingForFade())continue;const fe=xe.tileID,Ve=Math.pow(2,w.zoom-xe.tileID.overscaledZ),rt=o*xe.queryPadding*n.EXTENT/xe.tileSize/Ve,Ae=[fe.getTilePoint(new n.MercatorCoordinate(V,$)),fe.getTilePoint(new n.MercatorCoordinate(Y,ge))];if(Ae[0].x-rt<n.EXTENT&&Ae[0].y-rt<n.EXTENT&&Ae[1].x+rt>=0&&Ae[1].y+rt>=0){const Ge=P.map(lt=>fe.getTilePoint(lt)),ot=L.map(lt=>fe.getTilePoint(lt));_.push({tile:xe,tileID:fe,queryGeometry:Ge,cameraQueryGeometry:ot,scale:Ve})}}return _}getVisibleCoordinates(t){const o=this.getRenderableIds(t).map(p=>this._tiles[p].tileID);for(const p of o)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(xt(this._source.type)){const t=n.browser.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=t)return!0}return!1}setFeatureState(t,o,p){this._state.updateState(t=t||"_geojsonTileLayer",o,p)}removeFeatureState(t,o,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,p)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,p){const _=this._tiles[t];_&&_.setDependencies(o,p)}reloadTilesForDependencies(t,o){for(const p in this._tiles)this._tiles[p].hasDependency(t,o)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(t,o))}}function Qe(y,t){const o=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return y.overscaledZ-t.overscaledZ||p-o||t.canonical.y-y.canonical.y||t.canonical.x-y.canonical.x}function xt(y){return y==="raster"||y==="image"||y==="video"}ke.maxOverzooming=10,ke.maxUnderzooming=3;const Tt="mapboxgl_preloaded_worker_pool";class dt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<dt.workerCount;)this.workers.push(new Worker(n.config.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Tt]}numActive(){return Object.keys(this.active).length}}const Yt=Math.floor(n.browser.hardwareConcurrency/2);let ki;function Si(){return ki||(ki=new dt),ki}dt.workerCount=n.isSafari(globalThis)?Math.max(Math.min(Yt,3),1):1;class Zi{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.clamp(t,0,1);let o=1,p=this._distances[o];const _=t*this.paddedLength+this.padding;for(;p<_&&o<this._distances.length;)p=this._distances[++o];const w=o-1,I=this._distances[w],P=p-I,L=P>0?(_-I)/P:0;return this.points[w].mult(1-L).add(this.points[o].mult(L))}}function nr(y,t){let o=!0;return y==="always"||y!=="never"&&t!=="never"||(o=!1),o}class fr{constructor(t,o,p){const _=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(o/p);for(let I=0;I<this.xCellCount*this.yCellCount;I++)_.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,p,_,w){this._forEachCell(o,p,_,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(w)}insertCircle(t,o,p,_){this._forEachCell(o-_,p-_,o+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(p),this.circles.push(_)}_insertBoxCell(t,o,p,_,w,I){this.boxCells[w].push(I)}_insertCircleCell(t,o,p,_,w,I){this.circleCells[w].push(I)}_query(t,o,p,_,w,I,P){if(p<0||t>this.width||_<0||o>this.height)return[];const L=[];if(t<=0&&o<=0&&this.width<=p&&this.height<=_){if(w)return[{key:null,x1:t,y1:o,x2:p,y2:_}];for(let O=0;O<this.boxKeys.length;O++)L.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const V=this.circles[3*O],$=this.circles[3*O+1],Y=this.circles[3*O+2];L.push({key:this.circleKeys[O],x1:V-Y,y1:$-Y,x2:V+Y,y2:$+Y})}}else this._forEachCell(t,o,p,_,this._queryCell,L,{hitTest:w,overlapMode:I,seenUids:{box:{},circle:{}}},P);return L}query(t,o,p,_){return this._query(t,o,p,_,!1,null)}hitTest(t,o,p,_,w,I){return this._query(t,o,p,_,!0,w,I).length>0}hitTestCircle(t,o,p,_,w){const I=t-p,P=t+p,L=o-p,O=o+p;if(P<0||I>this.width||O<0||L>this.height)return!1;const V=[];return this._forEachCell(I,L,P,O,this._queryCellCircle,V,{hitTest:!0,overlapMode:_,circle:{x:t,y:o,radius:p},seenUids:{box:{},circle:{}}},w),V.length>0}_queryCell(t,o,p,_,w,I,P,L){const{seenUids:O,hitTest:V,overlapMode:$}=P,Y=this.boxCells[w];if(Y!==null){const de=this.bboxes;for(const xe of Y)if(!O.box[xe]){O.box[xe]=!0;const fe=4*xe,Ve=this.boxKeys[xe];if(t<=de[fe+2]&&o<=de[fe+3]&&p>=de[fe+0]&&_>=de[fe+1]&&(!L||L(Ve))&&(!V||!nr($,Ve.overlapMode))&&(I.push({key:Ve,x1:de[fe],y1:de[fe+1],x2:de[fe+2],y2:de[fe+3]}),V))return!0}}const ge=this.circleCells[w];if(ge!==null){const de=this.circles;for(const xe of ge)if(!O.circle[xe]){O.circle[xe]=!0;const fe=3*xe,Ve=this.circleKeys[xe];if(this._circleAndRectCollide(de[fe],de[fe+1],de[fe+2],t,o,p,_)&&(!L||L(Ve))&&(!V||!nr($,Ve.overlapMode))){const rt=de[fe],Ae=de[fe+1],Ge=de[fe+2];if(I.push({key:Ve,x1:rt-Ge,y1:Ae-Ge,x2:rt+Ge,y2:Ae+Ge}),V)return!0}}}return!1}_queryCellCircle(t,o,p,_,w,I,P,L){const{circle:O,seenUids:V,overlapMode:$}=P,Y=this.boxCells[w];if(Y!==null){const de=this.bboxes;for(const xe of Y)if(!V.box[xe]){V.box[xe]=!0;const fe=4*xe,Ve=this.boxKeys[xe];if(this._circleAndRectCollide(O.x,O.y,O.radius,de[fe+0],de[fe+1],de[fe+2],de[fe+3])&&(!L||L(Ve))&&!nr($,Ve.overlapMode))return I.push(!0),!0}}const ge=this.circleCells[w];if(ge!==null){const de=this.circles;for(const xe of ge)if(!V.circle[xe]){V.circle[xe]=!0;const fe=3*xe,Ve=this.circleKeys[xe];if(this._circlesCollide(de[fe],de[fe+1],de[fe+2],O.x,O.y,O.radius)&&(!L||L(Ve))&&!nr($,Ve.overlapMode))return I.push(!0),!0}}}_forEachCell(t,o,p,_,w,I,P,L){const O=this._convertToXCellCoord(t),V=this._convertToYCellCoord(o),$=this._convertToXCellCoord(p),Y=this._convertToYCellCoord(_);for(let ge=O;ge<=$;ge++)for(let de=V;de<=Y;de++)if(w.call(this,t,o,p,_,this.xCellCount*de+ge,I,P,L))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,p,_,w,I){const P=_-t,L=w-o,O=p+I;return O*O>P*P+L*L}_circleAndRectCollide(t,o,p,_,w,I,P){const L=(I-_)/2,O=Math.abs(t-(_+L));if(O>L+p)return!1;const V=(P-w)/2,$=Math.abs(o-(w+V));if($>V+p)return!1;if(O<=L||$<=V)return!0;const Y=O-L,ge=$-V;return Y*Y+ge*ge<=p*p}}function qr(y,t,o,p,_){const w=n.create();return t?(n.scale(w,w,[1/_,1/_,1]),o||n.rotateZ(w,w,p.angle)):n.multiply(w,p.labelPlaneMatrix,y),w}function vt(y,t,o,p,_){if(t){const w=n.clone(y);return n.scale(w,w,[_,_,1]),o||n.rotateZ(w,w,-p.angle),w}return p.glCoordMatrix}function Ki(y,t,o){let p;o?(p=[y.x,y.y,o(y.x,y.y),1],n.transformMat4(p,p,t)):(p=[y.x,y.y,0,1],ce(p,p,t));const _=p[3];return{point:new n.Point(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function br(y,t){return .5+y/t*.5}function wr(y,t){const o=y[0]/y[3],p=y[1]/y[3];return o>=-t[0]&&o<=t[0]&&p>=-t[1]&&p<=t[1]}function sr(y,t,o,p,_,w,I,P,L,O){const V=p?y.textSizeData:y.iconSizeData,$=n.evaluateSizeForZoom(V,o.transform.zoom),Y=[256/o.width*2+1,256/o.height*2+1],ge=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ge.clear();const de=y.lineVertexArray,xe=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,fe=o.transform.width/o.transform.height;let Ve=!1;for(let rt=0;rt<xe.length;rt++){const Ae=xe.get(rt);if(Ae.hidden||Ae.writingMode===n.WritingMode.vertical&&!Ve){K(Ae.numGlyphs,ge);continue}let Ge;if(Ve=!1,O?(Ge=[Ae.anchorX,Ae.anchorY,O(Ae.anchorX,Ae.anchorY),1],n.transformMat4(Ge,Ge,t)):(Ge=[Ae.anchorX,Ae.anchorY,0,1],ce(Ge,Ge,t)),!wr(Ge,Y)){K(Ae.numGlyphs,ge);continue}const ot=br(o.transform.cameraToCenterDistance,Ge[3]),lt=n.evaluateSizeForFeature(V,$,Ae),pt=I?lt/ot:lt*ot,St=new n.Point(Ae.anchorX,Ae.anchorY),wt=Ki(St,_,O).point,Pt={projections:{},offsets:{}},Wt=vi(Ae,pt,!1,P,t,_,w,y.glyphOffsetArray,de,ge,wt,St,Pt,fe,L,O);Ve=Wt.useVertical,(Wt.notEnoughRoom||Ve||Wt.needsFlipping&&vi(Ae,pt,!0,P,t,_,w,y.glyphOffsetArray,de,ge,wt,St,Pt,fe,L,O).notEnoughRoom)&&K(Ae.numGlyphs,ge)}p?y.text.dynamicLayoutVertexBuffer.updateData(ge):y.icon.dynamicLayoutVertexBuffer.updateData(ge)}function zt(y,t,o,p,_,w,I,P,L,O,V,$,Y){const ge=P.glyphStartIndex+P.numGlyphs,de=P.lineStartIndex,xe=P.lineStartIndex+P.lineLength,fe=t.getoffsetX(P.glyphStartIndex),Ve=t.getoffsetX(ge-1),rt=ve(y*fe,o,p,_,w,I,P.segment,de,xe,L,O,V,$,Y);if(!rt)return null;const Ae=ve(y*Ve,o,p,_,w,I,P.segment,de,xe,L,O,V,$,Y);return Ae?{first:rt,last:Ae}:null}function yi(y,t,o,p){return y===n.WritingMode.horizontal&&Math.abs(o.y-t.y)>Math.abs(o.x-t.x)*p?{useVertical:!0}:(y===n.WritingMode.vertical?t.y<o.y:t.x>o.x)?{needsFlipping:!0}:null}function vi(y,t,o,p,_,w,I,P,L,O,V,$,Y,ge,de,xe){const fe=t/24,Ve=y.lineOffsetX*fe,rt=y.lineOffsetY*fe;let Ae;if(y.numGlyphs>1){const Ge=y.glyphStartIndex+y.numGlyphs,ot=y.lineStartIndex,lt=y.lineStartIndex+y.lineLength,pt=zt(fe,P,Ve,rt,o,V,$,y,L,w,Y,de,xe);if(!pt)return{notEnoughRoom:!0};const St=Ki(pt.first.point,I,xe).point,wt=Ki(pt.last.point,I,xe).point;if(p&&!o){const Pt=yi(y.writingMode,St,wt,ge);if(Pt)return Pt}Ae=[pt.first];for(let Pt=y.glyphStartIndex+1;Pt<Ge-1;Pt++)Ae.push(ve(fe*P.getoffsetX(Pt),Ve,rt,o,V,$,y.segment,ot,lt,L,w,Y,de,xe));Ae.push(pt.last)}else{if(p&&!o){const ot=Ki($,_,xe).point,lt=y.lineStartIndex+y.segment+1,pt=new n.Point(L.getx(lt),L.gety(lt)),St=Ki(pt,_,xe),wt=St.signedDistanceFromCamera>0?St.point:xr($,pt,ot,1,_,xe),Pt=yi(y.writingMode,ot,wt,ge);if(Pt)return Pt}const Ge=ve(fe*P.getoffsetX(y.glyphStartIndex),Ve,rt,o,V,$,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,L,w,Y,de,xe);if(!Ge)return{notEnoughRoom:!0};Ae=[Ge]}for(const Ge of Ae)n.addDynamicAttributes(O,Ge.point,Ge.angle);return{}}function xr(y,t,o,p,_,w){const I=Ki(y.add(y.sub(t)._unit()),_,w).point,P=o.sub(I);return o.add(P._mult(p/P.mag()))}function Ur(y,t){const{projectionCache:o,lineVertexArray:p,labelPlaneMatrix:_,tileAnchorPoint:w,distanceFromAnchor:I,getElevation:P,previousVertex:L,direction:O,absOffsetX:V}=t;if(o.projections[y])return o.projections[y];const $=new n.Point(p.getx(y),p.gety(y)),Y=Ki($,_,P);if(Y.signedDistanceFromCamera>0)return o.projections[y]=Y.point,Y.point;const ge=y-O;return xr(I===0?w:new n.Point(p.getx(ge),p.gety(ge)),$,L,V-I+1,_,P)}function pi(y,t,o){return y._unit()._perp()._mult(t*o)}function on(y,t,o,p,_,w,I,P){const{projectionCache:L,direction:O}=P;if(L.offsets[y])return L.offsets[y];const V=o.add(t);if(y+O<p||y+O>=_)return L.offsets[y]=V,V;const $=Ur(y+O,P),Y=pi($.sub(o),I,O),ge=o.add(Y),de=$.add(Y);return L.offsets[y]=n.findLineIntersection(w,V,ge,de)||V,L.offsets[y]}function ve(y,t,o,p,_,w,I,P,L,O,V,$,Y,ge){const de=p?y-t:y+t;let xe=de>0?1:-1,fe=0;p&&(xe*=-1,fe=Math.PI),xe<0&&(fe+=Math.PI);let Ve,rt,Ae=xe>0?P+I:P+I+1,Ge=_,ot=_,lt=0,pt=0;const St=Math.abs(de),wt=[];let Pt;for(;lt+pt<=St;){if(Ae+=xe,Ae<P||Ae>=L)return null;lt+=pt,ot=Ge,rt=Ve;const Lt={projectionCache:$,lineVertexArray:O,labelPlaneMatrix:V,tileAnchorPoint:w,distanceFromAnchor:lt,getElevation:ge,previousVertex:ot,direction:xe,absOffsetX:St};if(Ge=Ur(Ae,Lt),o===0)wt.push(ot),Pt=Ge.sub(ot);else{let fi;const Xt=Ge.sub(ot);fi=Xt.mag()===0?pi(Ur(Ae+xe,Lt).sub(Ge),o,xe):pi(Xt,o,xe),rt||(rt=ot.add(fi)),Ve=on(Ae,fi,Ge,P,L,rt,o,Lt),wt.push(rt),Pt=Ve.sub(rt)}pt=Pt.mag()}const Wt=Pt._mult((St-lt)/pt)._add(rt||ot),zi=fe+Math.atan2(Ge.y-ot.y,Ge.x-ot.x);return wt.push(Wt),{point:Wt,angle:Y?zi:0,path:wt}}const G=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function K(y,t){for(let o=0;o<y;o++){const p=t.length;t.resize(p+4),t.float32.set(G,3*p)}}function ce(y,t,o){const p=t[0],_=t[1];return y[0]=o[0]*p+o[4]*_+o[12],y[1]=o[1]*p+o[5]*_+o[13],y[3]=o[3]*p+o[7]*_+o[15],y}const be=100;class Pe{constructor(t,o=new fr(t.width+200,t.height+200,25),p=new fr(t.width+200,t.height+200,25)){this.transform=t,this.grid=o,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+be,this.screenBottomBoundary=t.height+be,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,o,p,_,w,I){const P=this.projectAndGetPerspectiveRatio(_,t.anchorPointX,t.anchorPointY,I),L=p*P.perspectiveRatio,O=t.x1*L+P.point.x,V=t.y1*L+P.point.y,$=t.x2*L+P.point.x,Y=t.y2*L+P.point.y;return!this.isInsideGrid(O,V,$,Y)||o!=="always"&&this.grid.hitTest(O,V,$,Y,o,w)||P.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[O,V,$,Y],offscreen:this.isOffscreen(O,V,$,Y)}}placeCollisionCircles(t,o,p,_,w,I,P,L,O,V,$,Y,ge,de){const xe=[],fe=new n.Point(o.anchorX,o.anchorY),Ve=Ki(fe,I,de),rt=br(this.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Ae=(V?w/rt:w*rt)/n.ONE_EM,Ge=Ki(fe,P,de).point,ot=zt(Ae,_,o.lineOffsetX*Ae,o.lineOffsetY*Ae,!1,Ge,fe,o,p,P,{projections:{},offsets:{}},!1,de);let lt=!1,pt=!1,St=!0;if(ot){const wt=.5*Y*rt+ge,Pt=new n.Point(-100,-100),Wt=new n.Point(this.screenRightBoundary,this.screenBottomBoundary),zi=new Zi,Lt=ot.first,fi=ot.last;let Xt=[];for(let Ei=Lt.path.length-1;Ei>=1;Ei--)Xt.push(Lt.path[Ei]);for(let Ei=1;Ei<fi.path.length;Ei++)Xt.push(fi.path[Ei]);const tr=2.5*wt;if(L){const Ei=Xt.map(Mi=>Ki(Mi,L,de));Xt=Ei.some(Mi=>Mi.signedDistanceFromCamera<=0)?[]:Ei.map(Mi=>Mi.point)}let wi=[];if(Xt.length>0){const Ei=Xt[0].clone(),Mi=Xt[0].clone();for(let mr=1;mr<Xt.length;mr++)Ei.x=Math.min(Ei.x,Xt[mr].x),Ei.y=Math.min(Ei.y,Xt[mr].y),Mi.x=Math.max(Mi.x,Xt[mr].x),Mi.y=Math.max(Mi.y,Xt[mr].y);wi=Ei.x>=Pt.x&&Mi.x<=Wt.x&&Ei.y>=Pt.y&&Mi.y<=Wt.y?[Xt]:Mi.x<Pt.x||Ei.x>Wt.x||Mi.y<Pt.y||Ei.y>Wt.y?[]:n.clipLine([Xt],Pt.x,Pt.y,Wt.x,Wt.y)}for(const Ei of wi){zi.reset(Ei,.25*wt);let Mi=0;Mi=zi.length<=.5*wt?1:Math.ceil(zi.paddedLength/tr)+1;for(let mr=0;mr<Mi;mr++){const Wi=mr/Math.max(Mi-1,1),Dn=zi.lerp(Wi),hr=Dn.x+be,or=Dn.y+be;xe.push(hr,or,wt,0);const En=hr-wt,Wn=or-wt,ir=hr+wt,ws=or+wt;if(St=St&&this.isOffscreen(En,Wn,ir,ws),pt=pt||this.isInsideGrid(En,Wn,ir,ws),t!=="always"&&this.grid.hitTestCircle(hr,or,wt,t,$)&&(lt=!0,!O))return{circles:[],offscreen:!1,collisionDetected:lt}}}}return{circles:!O&&lt||!pt||rt<this.perspectiveRatioCutoff?[]:xe,offscreen:St,collisionDetected:lt}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let p=1/0,_=1/0,w=-1/0,I=-1/0;for(const V of t){const $=new n.Point(V.x+be,V.y+be);p=Math.min(p,$.x),_=Math.min(_,$.y),w=Math.max(w,$.x),I=Math.max(I,$.y),o.push($)}const P=this.grid.query(p,_,w,I).concat(this.ignoredGrid.query(p,_,w,I)),L={},O={};for(const V of P){const $=V.key;if(L[$.bucketInstanceId]===void 0&&(L[$.bucketInstanceId]={}),L[$.bucketInstanceId][$.featureIndex])continue;const Y=[new n.Point(V.x1,V.y1),new n.Point(V.x2,V.y1),new n.Point(V.x2,V.y2),new n.Point(V.x1,V.y2)];n.polygonIntersectsPolygon(o,Y)&&(L[$.bucketInstanceId][$.featureIndex]=!0,O[$.bucketInstanceId]===void 0&&(O[$.bucketInstanceId]=[]),O[$.bucketInstanceId].push($.featureIndex))}return O}insertCollisionBox(t,o,p,_,w,I){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:I,overlapMode:o},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,p,_,w,I){const P=p?this.ignoredGrid:this.grid,L={bucketInstanceId:_,featureIndex:w,collisionGroupID:I,overlapMode:o};for(let O=0;O<t.length;O+=4)P.insertCircle(L,t[O],t[O+1],t[O+2])}projectAndGetPerspectiveRatio(t,o,p,_){let w;return _?(w=[o,p,_(o,p),1],n.transformMat4(w,w,t)):(w=[o,p,0,1],ce(w,w,t)),{point:new n.Point((w[0]/w[3]+1)/2*this.transform.width+be,(-w[1]/w[3]+1)/2*this.transform.height+be),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w[3]*.5}}isOffscreen(t,o,p,_){return p<be||t>=this.screenRightBoundary||_<be||o>this.screenBottomBoundary}isInsideGrid(t,o,p,_){return p>=0&&t<this.gridRightBoundary&&_>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=n.identity([]);return n.translate(t,t,[-100,-100,0]),t}}function qe(y,t,o){return t*(n.EXTENT/(y.tileSize*Math.pow(2,o-y.tileID.overscaledZ)))}class Oe{constructor(t,o,p,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class De{constructor(t,o,p,_,w){this.text=new Oe(t?t.text:null,o,p,w),this.icon=new Oe(t?t.icon:null,o,_,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class W{constructor(t,o,p){this.text=t,this.icon=o,this.skipFade=p}}class X{constructor(){this.invProjMatrix=n.create(),this.viewportMatrix=n.create(),this.circles=[]}}class oe{constructor(t,o,p,_,w){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=w}}class Ie{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:p=>p.collisionGroupID===o}}return this.collisionGroups[t]}}function Ue(y,t,o,p,_){const{horizontalAlign:w,verticalAlign:I}=n.getAnchorAlignment(y);return new n.Point(-(w-.5)*t+p[0]*_,-(I-.5)*o+p[1]*_)}function Et(y,t,o,p,_,w){const{x1:I,x2:P,y1:L,y2:O,anchorPointX:V,anchorPointY:$}=y,Y=new n.Point(t,o);return p&&Y._rotate(_?w:-w),{x1:I+Y.x,y1:L+Y.y,x2:P+Y.x,y2:O+Y.y,anchorPointX:V,anchorPointY:$}}class yt{constructor(t,o,p,_,w){this.transform=t.clone(),this.terrain=o,this.collisionIndex=new Pe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Ie(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,p,_){const w=p.getBucket(o),I=p.latestFeatureIndex;if(!w||!I||o.id!==w.layerIds[0])return;const P=p.collisionBoxArray,L=w.layers[0].layout,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/n.EXTENT,$=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),Y=L.get("text-pitch-alignment")==="map",ge=L.get("text-rotation-alignment")==="map",de=qe(p,1,this.transform.zoom),xe=qr($,Y,ge,this.transform,de);let fe=null;if(Y){const rt=vt($,Y,ge,this.transform,de);fe=n.multiply([],this.transform.labelPlaneMatrix,rt)}this.retainedQueryData[w.bucketInstanceId]=new oe(w.bucketInstanceId,I,w.sourceLayerIndex,w.index,p.tileID);const Ve={bucket:w,layout:L,posMatrix:$,textLabelPlaneMatrix:xe,labelToScreenMatrix:fe,scale:O,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:n.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(_)for(const rt of w.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:Ge,symbolInstanceEnd:ot}=rt;t.push({sortKey:Ae,symbolInstanceStart:Ge,symbolInstanceEnd:ot,parameters:Ve})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(t,o,p,_,w,I,P,L,O,V,$,Y,ge,de,xe,fe){const Ve=n.TextAnchorEnum[t.textAnchor],rt=[t.textOffset0,t.textOffset1],Ae=Ue(Ve,p,_,rt,w),Ge=this.collisionIndex.placeCollisionBox(Et(o,Ae.x,Ae.y,I,P,this.transform.angle),$,L,O,V.predicate,fe);if((!xe||this.collisionIndex.placeCollisionBox(Et(xe,Ae.x,Ae.y,I,P,this.transform.angle),$,L,O,V.predicate,fe).box.length!==0)&&Ge.box.length>0){let ot;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(ot=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:rt,width:p,height:_,anchor:Ve,textBoxScale:w,prevAnchor:ot},this.markUsedJustification(ge,Ve,Y,de),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,de,Y),this.placedOrientations[Y.crossTileID]=de),{shift:Ae,placedGlyphBoxes:Ge}}}placeLayerBucketPart(t,o,p){const{bucket:_,layout:w,posMatrix:I,textLabelPlaneMatrix:P,labelToScreenMatrix:L,textPixelRatio:O,holdingForFade:V,collisionBoxArray:$,partiallyEvaluatedTextSize:Y,collisionGroup:ge}=t.parameters,de=w.get("text-optional"),xe=w.get("icon-optional"),fe=n.getOverlapMode(w,"text-overlap","text-allow-overlap"),Ve=fe==="always",rt=n.getOverlapMode(w,"icon-overlap","icon-allow-overlap"),Ae=rt==="always",Ge=w.get("text-rotation-alignment")==="map",ot=w.get("text-pitch-alignment")==="map",lt=w.get("icon-text-fit")!=="none",pt=w.get("symbol-z-order")==="viewport-y",St=Ve&&(Ae||!_.hasIconData()||xe),wt=Ae&&(Ve||!_.hasTextData()||de);!_.collisionArrays&&$&&_.deserializeCollisionBoxes($);const Pt=this.retainedQueryData[_.bucketInstanceId].tileID,Wt=this.terrain?(Lt,fi)=>this.terrain.getElevation(Pt,Lt,fi):null,zi=(Lt,fi)=>{var Xt,tr;if(o[Lt.crossTileID])return;if(V)return void(this.placements[Lt.crossTileID]=new W(!1,!1,!1));let wi=!1,Ei=!1,Mi=!0,mr=null,Wi={box:null,offscreen:null},Dn={box:null,offscreen:null},hr=null,or=null,En=null,Wn=0,ir=0,ws=0;fi.textFeatureIndex?Wn=fi.textFeatureIndex:Lt.useRuntimeCollisionCircles&&(Wn=Lt.featureIndex),fi.verticalTextFeatureIndex&&(ir=fi.verticalTextFeatureIndex);const xs=fi.textBox;if(xs){const Qr=gr=>{let _r=n.WritingMode.horizontal;if(_.allowVerticalPlacement&&!gr&&this.prevPlacement){const Sn=this.prevPlacement.placedOrientations[Lt.crossTileID];Sn&&(this.placedOrientations[Lt.crossTileID]=Sn,_r=Sn,this.markUsedOrientation(_,_r,Lt))}return _r},$r=(gr,_r)=>{if(_.allowVerticalPlacement&&Lt.numVerticalGlyphVertices>0&&fi.verticalTextBox){for(const Sn of _.writingModes)if(Sn===n.WritingMode.vertical?(Wi=_r(),Dn=Wi):Wi=gr(),Wi&&Wi.box&&Wi.box.length)break}else Wi=gr()},Zr=Lt.textAnchorOffsetStartIndex,Da=Lt.textAnchorOffsetEndIndex;if(Da===Zr){const gr=(_r,Sn)=>{const yr=this.collisionIndex.placeCollisionBox(_r,fe,O,I,ge.predicate,Wt);return yr&&yr.box&&yr.box.length&&(this.markUsedOrientation(_,Sn,Lt),this.placedOrientations[Lt.crossTileID]=Sn),yr};$r(()=>gr(xs,n.WritingMode.horizontal),()=>{const _r=fi.verticalTextBox;return _.allowVerticalPlacement&&Lt.numVerticalGlyphVertices>0&&_r?gr(_r,n.WritingMode.vertical):{box:null,offscreen:null}}),Qr(Wi&&Wi.box&&Wi.box.length)}else{let gr=n.TextAnchorEnum[(tr=(Xt=this.prevPlacement)===null||Xt===void 0?void 0:Xt.variableOffsets[Lt.crossTileID])===null||tr===void 0?void 0:tr.anchor];const _r=(yr,ko,Ds)=>{const To=yr.x2-yr.x1,Qc=yr.y2-yr.y1,eu=Lt.textBoxScale,bh=lt&&rt==="never"?ko:null;let Es={box:[],offscreen:!1},ia=fe==="never"?1:2,Ls="never";gr&&ia++;for(let Kn=0;Kn<ia;Kn++){for(let kn=Zr;kn<Da;kn++){const as=_.textAnchorOffsets.get(kn);if(gr&&as.textAnchor!==gr)continue;const Co=this.attemptAnchorPlacement(as,yr,To,Qc,eu,Ge,ot,O,I,ge,Ls,Lt,_,Ds,bh,Wt);if(Co&&(Es=Co.placedGlyphBoxes,Es&&Es.box&&Es.box.length))return wi=!0,mr=Co.shift,Es}gr?gr=null:Ls=fe}return Es};$r(()=>_r(xs,fi.iconBox,n.WritingMode.horizontal),()=>{const yr=fi.verticalTextBox;return _.allowVerticalPlacement&&!(Wi&&Wi.box&&Wi.box.length)&&Lt.numVerticalGlyphVertices>0&&yr?_r(yr,fi.verticalIconBox,n.WritingMode.vertical):{box:null,offscreen:null}}),Wi&&(wi=Wi.box,Mi=Wi.offscreen);const Sn=Qr(Wi&&Wi.box);if(!wi&&this.prevPlacement){const yr=this.prevPlacement.variableOffsets[Lt.crossTileID];yr&&(this.variableOffsets[Lt.crossTileID]=yr,this.markUsedJustification(_,yr.anchor,Lt,Sn))}}}if(hr=Wi,wi=hr&&hr.box&&hr.box.length>0,Mi=hr&&hr.offscreen,Lt.useRuntimeCollisionCircles){const Qr=_.text.placedSymbolArray.get(Lt.centerJustifiedTextSymbolIndex),$r=n.evaluateSizeForFeature(_.textSizeData,Y,Qr),Zr=w.get("text-padding");or=this.collisionIndex.placeCollisionCircles(fe,Qr,_.lineVertexArray,_.glyphOffsetArray,$r,I,P,L,p,ot,ge.predicate,Lt.collisionCircleDiameter,Zr,Wt),or.circles.length&&or.collisionDetected&&!p&&n.warnOnce("Collisions detected, but collision boxes are not shown"),wi=Ve||or.circles.length>0&&!or.collisionDetected,Mi=Mi&&or.offscreen}if(fi.iconFeatureIndex&&(ws=fi.iconFeatureIndex),fi.iconBox){const Qr=$r=>{const Zr=lt&&mr?Et($r,mr.x,mr.y,Ge,ot,this.transform.angle):$r;return this.collisionIndex.placeCollisionBox(Zr,rt,O,I,ge.predicate,Wt)};Dn&&Dn.box&&Dn.box.length&&fi.verticalIconBox?(En=Qr(fi.verticalIconBox),Ei=En.box.length>0):(En=Qr(fi.iconBox),Ei=En.box.length>0),Mi=Mi&&En.offscreen}const ss=de||Lt.numHorizontalGlyphVertices===0&&Lt.numVerticalGlyphVertices===0,Ms=xe||Lt.numIconVertices===0;if(ss||Ms?Ms?ss||(Ei=Ei&&wi):wi=Ei&&wi:Ei=wi=Ei&&wi,wi&&hr&&hr.box&&this.collisionIndex.insertCollisionBox(hr.box,fe,w.get("text-ignore-placement"),_.bucketInstanceId,Dn&&Dn.box&&ir?ir:Wn,ge.ID),Ei&&En&&this.collisionIndex.insertCollisionBox(En.box,rt,w.get("icon-ignore-placement"),_.bucketInstanceId,ws,ge.ID),or&&(wi&&this.collisionIndex.insertCollisionCircles(or.circles,fe,w.get("text-ignore-placement"),_.bucketInstanceId,Wn,ge.ID),p)){const Qr=_.bucketInstanceId;let $r=this.collisionCircleArrays[Qr];$r===void 0&&($r=this.collisionCircleArrays[Qr]=new X);for(let Zr=0;Zr<or.circles.length;Zr+=4)$r.circles.push(or.circles[Zr+0]),$r.circles.push(or.circles[Zr+1]),$r.circles.push(or.circles[Zr+2]),$r.circles.push(or.collisionDetected?1:0)}if(Lt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Lt.crossTileID]=new W(wi||St,Ei||wt,Mi||_.justReloaded),o[Lt.crossTileID]=!0};if(pt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Lt=_.getSortedSymbolIndexes(this.transform.angle);for(let fi=Lt.length-1;fi>=0;--fi){const Xt=Lt[fi];zi(_.symbolInstances.get(Xt),_.collisionArrays[Xt])}}else for(let Lt=t.symbolInstanceStart;Lt<t.symbolInstanceEnd;Lt++)zi(_.symbolInstances.get(Lt),_.collisionArrays[Lt]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const Lt=this.collisionCircleArrays[_.bucketInstanceId];n.invert(Lt.invProjMatrix,I),Lt.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,o,p,_){let w;w=_===n.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[n.getAnchorJustification(o)];const I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const P of I)P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=w>=0&&P!==w?0:p.crossTileID)}markUsedOrientation(t,o,p){const _=o===n.WritingMode.horizontal||o===n.WritingMode.horizontalOnly?o:0,w=o===n.WritingMode.vertical?o:0,I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const P of I)t.text.placedSymbolArray.get(P).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let p=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const _=o?o.symbolFadeChange(t):1,w=o?o.opacities:{},I=o?o.variableOffsets:{},P=o?o.placedOrientations:{};for(const L in this.placements){const O=this.placements[L],V=w[L];V?(this.opacities[L]=new De(V,_,O.text,O.icon),p=p||O.text!==V.text.placed||O.icon!==V.icon.placed):(this.opacities[L]=new De(null,_,O.text,O.icon,O.skipFade),p=p||O.text||O.icon)}for(const L in w){const O=w[L];if(!this.opacities[L]){const V=new De(O,_,!1,!1);V.isHidden()||(this.opacities[L]=V,p=p||O.text.placed||O.icon.placed)}}for(const L in I)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=I[L]);for(const L in P)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=P[L]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o){const p={};for(const _ of o){const w=_.getBucket(t);w&&_.latestFeatureIndex&&t.id===w.layerIds[0]&&this.updateBucketOpacities(w,p,_.collisionBoxArray)}}updateBucketOpacities(t,o,p){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],w=_.layout,I=new De(null,0,!1,!1,!0),P=w.get("text-allow-overlap"),L=w.get("icon-allow-overlap"),O=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=w.get("text-rotation-alignment")==="map",$=w.get("text-pitch-alignment")==="map",Y=w.get("icon-text-fit")!=="none",ge=new De(null,0,P&&(L||!t.hasIconData()||w.get("icon-optional")),L&&(P||!t.hasTextData()||w.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const de=(xe,fe,Ve)=>{for(let rt=0;rt<fe/4;rt++)xe.opacityVertexArray.emplaceBack(Ve);xe.hasVisibleVertices=xe.hasVisibleVertices||Ve!==xi};for(let xe=0;xe<t.symbolInstances.length;xe++){const fe=t.symbolInstances.get(xe),{numHorizontalGlyphVertices:Ve,numVerticalGlyphVertices:rt,crossTileID:Ae}=fe;let Ge=this.opacities[Ae];o[Ae]?Ge=I:Ge||(Ge=ge,this.opacities[Ae]=Ge),o[Ae]=!0;const ot=fe.numIconVertices>0,lt=this.placedOrientations[fe.crossTileID],pt=lt===n.WritingMode.vertical,St=lt===n.WritingMode.horizontal||lt===n.WritingMode.horizontalOnly;if(Ve>0||rt>0){const wt=Ii(Ge.text);de(t.text,Ve,pt?xi:wt),de(t.text,rt,St?xi:wt);const Pt=Ge.text.isHidden();[fe.rightJustifiedTextSymbolIndex,fe.centerJustifiedTextSymbolIndex,fe.leftJustifiedTextSymbolIndex].forEach(Lt=>{Lt>=0&&(t.text.placedSymbolArray.get(Lt).hidden=Pt||pt?1:0)}),fe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(fe.verticalPlacedTextSymbolIndex).hidden=Pt||St?1:0);const Wt=this.variableOffsets[fe.crossTileID];Wt&&this.markUsedJustification(t,Wt.anchor,fe,lt);const zi=this.placedOrientations[fe.crossTileID];zi&&(this.markUsedJustification(t,"left",fe,zi),this.markUsedOrientation(t,zi,fe))}if(ot){const wt=Ii(Ge.icon),Pt=!(Y&&fe.verticalPlacedIconSymbolIndex&&pt);fe.placedIconSymbolIndex>=0&&(de(t.icon,fe.numIconVertices,Pt?wt:xi),t.icon.placedSymbolArray.get(fe.placedIconSymbolIndex).hidden=Ge.icon.isHidden()),fe.verticalPlacedIconSymbolIndex>=0&&(de(t.icon,fe.numVerticalIconVertices,Pt?xi:wt),t.icon.placedSymbolArray.get(fe.verticalPlacedIconSymbolIndex).hidden=Ge.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const wt=t.collisionArrays[xe];if(wt){let Pt=new n.Point(0,0);if(wt.textBox||wt.verticalTextBox){let zi=!0;if(O){const Lt=this.variableOffsets[Ae];Lt?(Pt=Ue(Lt.anchor,Lt.width,Lt.height,Lt.textOffset,Lt.textBoxScale),V&&Pt._rotate($?this.transform.angle:-this.transform.angle)):zi=!1}wt.textBox&&At(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!zi||pt,Pt.x,Pt.y),wt.verticalTextBox&&At(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!zi||St,Pt.x,Pt.y)}const Wt=!!(!St&&wt.verticalIconBox);wt.iconBox&&At(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,Wt,Y?Pt.x:0,Y?Pt.y:0),wt.verticalIconBox&&At(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!Wt,Y?Pt.x:0,Y?Pt.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=xe.invProjMatrix,t.placementViewportMatrix=xe.viewportMatrix,t.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const p=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function At(y,t,o,p,_){y.emplaceBack(t?1:0,o?1:0,p||0,_||0),y.emplaceBack(t?1:0,o?1:0,p||0,_||0),y.emplaceBack(t?1:0,o?1:0,p||0,_||0),y.emplaceBack(t?1:0,o?1:0,p||0,_||0)}const Gt=Math.pow(2,25),di=Math.pow(2,24),ei=Math.pow(2,17),ai=Math.pow(2,16),ui=Math.pow(2,9),li=Math.pow(2,8),gi=Math.pow(2,1);function Ii(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const t=y.placed?1:0,o=Math.floor(127*y.opacity);return o*Gt+t*di+o*ei+t*ai+o*ui+t*li+o*gi+t}const xi=0;class Vr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,o,p,_,w){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(I,_,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((P,L)=>P.sortKey-L.sortKey));this._currentPartIndex<I.length;)if(o.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,w())return!0;return!1}}class gn{constructor(t,o,p,_,w,I,P,L){this.placement=new yt(t,o,I,P,L),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(t,o,p){const _=n.browser.now(),w=()=>!this._forceFullPlacement&&n.browser.now()-_>2;for(;this._currentPlacementIndex>=0;){const I=o[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=P)&&(!I.maxzoom||I.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Vr(I)),this._inProgressLayer.continuePlacement(p[I.source],this.placement,this._showCollisionBoxes,I,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const dr=512/n.EXTENT/2;class es{constructor(t,o,p){this.tileID=t,this.bucketInstanceId=p,this._symbolsByKey={};const _=new Map;for(let w=0;w<o.length;w++){const I=o.get(w),P=I.key,L=_.get(P);L?L.push(I):_.set(P,[I])}for(const[w,I]of _){const P={positions:I.map(L=>({x:Math.floor(L.anchorX*dr),y:Math.floor(L.anchorY*dr)})),crossTileIDs:I.map(L=>L.crossTileID)};if(P.positions.length>128){const L=new n.KDBush(P.positions.length,16,Uint16Array);for(const{x:O,y:V}of P.positions)L.add(O,V);L.finish(),delete P.positions,P.index=L}this._symbolsByKey[w]=P}}getScaledCoordinates(t,o){const{x:p,y:_,z:w}=this.tileID.canonical,{x:I,y:P,z:L}=o.canonical,O=dr/Math.pow(2,L-w),V=(P*n.EXTENT+t.anchorY)*O,$=_*n.EXTENT*dr;return{x:Math.floor((I*n.EXTENT+t.anchorX)*O-p*n.EXTENT*dr),y:Math.floor(V-$)}}findMatches(t,o,p){const _=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let w=0;w<t.length;w++){const I=t.get(w);if(I.crossTileID)continue;const P=this._symbolsByKey[I.key];if(!P)continue;const L=this.getScaledCoordinates(I,o);if(P.index){const O=P.index.range(L.x-_,L.y-_,L.x+_,L.y+_).sort();for(const V of O){const $=P.crossTileIDs[V];if(!p[$]){p[$]=!0,I.crossTileID=$;break}}}else if(P.positions)for(let O=0;O<P.positions.length;O++){const V=P.positions[O],$=P.crossTileIDs[O];if(Math.abs(V.x-L.x)<=_&&Math.abs(V.y-L.y)<=_&&!p[$]){p[$]=!0,I.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ts{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ti{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const p in this.indexes){const _=this.indexes[p],w={};for(const I in _){const P=_[I];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+o),w[P.tileID.key]=P}this.indexes[p]=w}this.lng=t}addBucket(t,o,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let w=0;w<o.symbolInstances.length;w++)o.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const _=this.usedCrossTileIDs[t.overscaledZ];for(const w in this.indexes){const I=this.indexes[w];if(Number(w)>t.overscaledZ)for(const P in I){const L=I[P];L.tileID.isChildOf(t)&&L.findMatches(o.symbolInstances,t,_)}else{const P=I[t.scaledTo(Number(w)).key];P&&P.findMatches(o.symbolInstances,t,_)}}for(let w=0;w<o.symbolInstances.length;w++){const I=o.symbolInstances.get(w);I.crossTileID||(I.crossTileID=p.generate(),_[I.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new es(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const p of o.getCrossTileIDsLists())for(const _ of p)delete this.usedCrossTileIDs[t][_]}removeStaleBuckets(t){let o=!1;for(const p in this.indexes){const _=this.indexes[p];for(const w in _)t[_[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[w]),delete _[w],o=!0)}return o}}class Kr{constructor(){this.layerIndexes={},this.crossTileIDs=new ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,p){let _=this.layerIndexes[t.id];_===void 0&&(_=this.layerIndexes[t.id]=new Ti);let w=!1;const I={};_.handleWrapJump(p);for(const P of o){const L=P.getBucket(t);L&&t.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(P.tileID,L,this.crossTileIDs)&&(w=!0),I[L.bucketInstanceId]=!0)}return _.removeStaleBuckets(I)&&(w=!0),w}pruneUnusedLayers(t){const o={};t.forEach(p=>{o[p]=!0});for(const p in this.layerIndexes)o[p]||delete this.layerIndexes[p]}}const ln=(y,t)=>n.emitValidationErrors(y,t&&t.filter(o=>o.identifier!=="source.canvas")),ar=n.pick(n.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),zr=n.pick(n.operations,["setCenter","setZoom","setBearing","setPitch"]),Xa=n.emptyStyle();class Er extends n.Evented{constructor(t,o={}){super(),this.map=t,this.dispatcher=new le(Si(),this,t._getMapId()),this.imageManager=new ae,this.imageManager.setEventedParent(this),this.glyphManager=new $t(t._requestManager,o.localIdeographFontFamily),this.lineAtlas=new at(256,512),this.crossTileSymbolIndex=new Kr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new n.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",n.getReferrer());const p=this;this._rtlTextPluginCallback=Er.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(w,I)=>{if(n.triggerPluginCompletionEvent(w),I&&I.every(P=>P))for(const P in p.sourceCaches){const L=p.sourceCaches[P].getSource().type;L!=="vector"&&L!=="geojson"||p.sourceCaches[P].reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const w=this.sourceCaches[_.sourceId];if(!w)return;const I=w.getSource();if(I&&I.vectorLayerIds)for(const P in this._layers){const L=this._layers[P];L.source===I.id&&this._validateLayer(L)}})}loadURL(t,o={},p){this.fire(new n.Event("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const _=this.map._requestManager.transformRequest(t,D.Style);this._request=n.getJSON(_,(w,I)=>{this._request=null,w?this.fire(new n.ErrorEvent(w)):I&&this._load(I,o,p)})}loadJSON(t,o={},p){this.fire(new n.Event("dataloading",{dataType:"style"})),this._request=n.browser.frame(()=>{this._request=null,o.validate=o.validate!==!1,this._load(t,o,p)})}loadEmpty(){this.fire(new n.Event("dataloading",{dataType:"style"})),this._load(Xa,{validate:!1})}_load(t,o,p){var _;const w=o.transformStyle?o.transformStyle(p,t):t;if(!o.validate||!ln(this,n.validateStyle(w))){this._loaded=!0,this.stylesheet=w;for(const I in w.sources)this.addSource(I,w.sources[I],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new ut(this.stylesheet.light),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new n.Event("data",{dataType:"style"})),this.fire(new n.Event("style.load"))}}_createLayers(){const t=n.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(o=>o.id),this._layers={},this._serializedLayers=null;for(const o of t){const p=n.createStyleLayer(o);p.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=p}}_loadSprite(t,o=!1,p=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(_,w,I,P){const L=ue(_),O=L.length,V=I>1?"@2x":"",$={},Y={},ge={};for(const{id:de,url:xe}of L){const fe=w.transformRequest(w.normalizeSpriteURL(xe,V,".json"),D.SpriteJSON),Ve=`${de}_${fe.url}`;$[Ve]=n.getJSON(fe,(Ge,ot)=>{delete $[Ve],Y[de]=ot,Ce(P,Y,ge,Ge,O)});const rt=w.transformRequest(w.normalizeSpriteURL(xe,V,".png"),D.SpriteImage),Ae=`${de}_${rt.url}`;$[Ae]=R.getImage(rt,(Ge,ot)=>{delete $[Ae],ge[de]=ot,Ce(P,Y,ge,Ge,O)})}return{cancel(){for(const de of Object.values($))de.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(_,w)=>{if(this._spriteRequest=null,_)this.fire(new n.ErrorEvent(_));else if(w)for(const I in w){this._spritesImagesIds[I]=[];const P=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(L=>!(L in w)):[];for(const L of P)this.imageManager.removeImage(L),this._changedImages[L]=!0;for(const L in w[I]){const O=I==="default"?L:`${I}:${L}`;this._spritesImagesIds[I].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,w[I][L],!1):this.imageManager.addImage(O,w[I][L]),o&&(this._changedImages[O]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"})),p&&p(_)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}_validateLayer(t){const o=this.sourceCaches[t.source];if(!o)return;const p=t.sourceLayer;if(!p)return;const _=o.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new n.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const o=this._serializedAllLayers();if(!t||t.length===0)return Object.values(o);const p=[];for(const _ of t)o[_]&&p.push(o[_]);return p}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const o=Object.keys(this._layers);for(const p of o){const _=this._layers[p];_.type!=="custom"&&(t[p]=_.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const o=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(_.length||w.length)&&this._updateWorkerLayers(_,w);for(const I in this._updatedSources){const P=this._updatedSources[I];if(P==="reload")this._reloadSource(I);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const w=this.sourceCaches[_];p[_]=w.used,w.used=!1}for(const _ of this._order){const w=this._layers[_];w.recalculate(t,this._availableImages),!w.isHidden(t.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const _ in p){const w=this.sourceCaches[_];p[_]!==w.used&&w.fire(new n.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(t),this.z=t.zoom,o&&this.fire(new n.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,o={}){this._checkLoaded();const p=this.serialize();if(t=o.transformStyle?o.transformStyle(p,t):t,ln(this,n.validateStyle(t)))return!1;(t=n.clone$1(t)).layers=n.derefLayers(t.layers);const _=n.diffStyles(p,t).filter(I=>!(I.command in zr));if(_.length===0)return!1;const w=_.filter(I=>!(I.command in ar));if(w.length>0)throw new Error(`Unimplemented: ${w.map(I=>I.command).join(", ")}.`);for(const I of _)I.command!=="setTransition"&&this[I.command].apply(this,I.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,o){if(this.getImage(t))return this.fire(new n.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,o),this._afterImageUpdated(t)}updateImage(t,o){this.imageManager.updateImage(t,o)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new n.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,o,p={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(n.validateStyle.source,`sources.${t}`,o,null,p))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const _=this.sourceCaches[t]=new ke(t,o,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:_.loaded(),source:_.serialize(),sourceId:t})),_.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new n.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));const o=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],o.fire(new n.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,o){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const p=this.sourceCaches[t].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(o),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,o,p={}){this._checkLoaded();const _=t.id;if(this.getLayer(_))return void this.fire(new n.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let w;if(t.type==="custom"){if(ln(this,n.validateCustomStyleLayer(t)))return;w=n.createStyleLayer(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(_,t.source),t=n.clone$1(t),t=n.extend(t,{source:_})),this._validate(n.validateStyle.layer,`layers.${_}`,t,{arrayIndex:-1},p))return;w=n.createStyleLayer(t),this._validateLayer(w),w.setEventedParent(this,{layer:{id:_}})}const I=o?this._order.indexOf(o):this._order.length;if(o&&I===-1)this.fire(new n.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${o}".`)));else{if(this._order.splice(I,0,_),this._layerOrderChanged=!0,this._layers[_]=w,this._removedLayers[_]&&w.source&&w.type!=="custom"){const P=this._removedLayers[_];delete this._removedLayers[_],P.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(t,o){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new n.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===o)return;const p=this._order.indexOf(t);this._order.splice(p,1);const _=o?this._order.indexOf(o):this._order.length;o&&_===-1?this.fire(new n.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${o}".`))):(this._order.splice(_,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const o=this._layers[t];if(!o)return void this.fire(new n.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));o.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=o,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],o.onRemove&&o.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,o,p){this._checkLoaded();const _=this.getLayer(t);_?_.minzoom===o&&_.maxzoom===p||(o!=null&&(_.minzoom=o),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new n.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,o,p={}){this._checkLoaded();const _=this.getLayer(t);if(_){if(!n.deepEqual(_.filter,o))return o==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(n.validateStyle.filter,`layers.${_.id}.filter`,o,null,p)||(_.filter=n.clone$1(o),this._updateLayer(_)))}else this.fire(new n.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return n.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,o,p,_={}){this._checkLoaded();const w=this.getLayer(t);w?n.deepEqual(w.getLayoutProperty(o),p)||(w.setLayoutProperty(o,p,_),this._updateLayer(w)):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,o){const p=this.getLayer(t);if(p)return p.getLayoutProperty(o);this.fire(new n.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,o,p,_={}){this._checkLoaded();const w=this.getLayer(t);w?n.deepEqual(w.getPaintProperty(o),p)||(w.setPaintProperty(o,p,_)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new n.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,o){return this.getLayer(t).getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();const p=t.source,_=t.sourceLayer,w=this.sourceCaches[p];if(w===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const I=w.getSource().type;I==="geojson"&&_?this.fire(new n.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||_?(t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),w.setFeatureState(_,t.id,o)):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,o){this._checkLoaded();const p=t.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new n.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const w=_.getSource().type,I=w==="vector"?t.sourceLayer:void 0;w!=="vector"||I?o&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new n.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(I,t.id,o):this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const o=t.source,p=t.sourceLayer,_=this.sourceCaches[o];if(_!==void 0)return _.getSource().type!=="vector"||p?(t.id===void 0&&this.fire(new n.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,t.id)):void this.fire(new n.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new n.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return n.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=n.mapObject(this.sourceCaches,_=>_.serialize()),o=this._serializeByIds(this._order),p=this.stylesheet;return n.filterObject({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:t,layers:o},_=>_!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const o=I=>this._layers[I].type==="fill-extrusion",p={},_=[];for(let I=this._order.length-1;I>=0;I--){const P=this._order[I];if(o(P)){p[P]=I;for(const L of t){const O=L[P];if(O)for(const V of O)_.push(V)}}}_.sort((I,P)=>P.intersectionZ-I.intersectionZ);const w=[];for(let I=this._order.length-1;I>=0;I--){const P=this._order[I];if(o(P))for(let L=_.length-1;L>=0;L--){const O=_[L].feature;if(p[O.layer.id]<I)break;w.push(O),_.pop()}else for(const L of t){const O=L[P];if(O)for(const V of O)w.push(V.feature)}}return w}queryRenderedFeatures(t,o,p){o&&o.filter&&this._validate(n.validateStyle.filter,"queryRenderedFeatures.filter",o.filter,null,o);const _={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of o.layers){const L=this._layers[P];if(!L)return this.fire(new n.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];_[L.source]=!0}}const w=[];o.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const P in this.sourceCaches)o.layers&&!_[P]||w.push(We(this.sourceCaches[P],this._layers,I,t,o,p));return this.placement&&w.push(function(P,L,O,V,$,Y,ge){const de={},xe=Y.queryRenderedSymbols(V),fe=[];for(const Ve of Object.keys(xe).map(Number))fe.push(ge[Ve]);fe.sort(we);for(const Ve of fe){const rt=Ve.featureIndex.lookupSymbolFeatures(xe[Ve.bucketInstanceId],L,Ve.bucketIndex,Ve.sourceLayerIndex,$.filter,$.layers,$.availableImages,P);for(const Ae in rt){const Ge=de[Ae]=de[Ae]||[],ot=rt[Ae];ot.sort((lt,pt)=>{const St=Ve.featureSortOrder;if(St){const wt=St.indexOf(lt.featureIndex);return St.indexOf(pt.featureIndex)-wt}return pt.featureIndex-lt.featureIndex});for(const lt of ot)Ge.push(lt)}}for(const Ve in de)de[Ve].forEach(rt=>{const Ae=rt.feature,Ge=O[P[Ve].source].getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=Ge});return de}(this._layers,I,this.sourceCaches,t,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(t,o){o&&o.filter&&this._validate(n.validateStyle.filter,"querySourceFeatures.filter",o.filter,null,o);const p=this.sourceCaches[t];return p?function(_,w){const I=_.getRenderableIds().map(O=>_.getTileByID(O)),P=[],L={};for(let O=0;O<I.length;O++){const V=I[O],$=V.tileID.canonical.key;L[$]||(L[$]=!0,V.querySourceFeatures(P,w))}return P}(p,o):[]}addSourceType(t,o,p){return N(t)?p(new Error(`A source type called "${t}" already exists.`)):(((_,w)=>{ct[_]=w})(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,o={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const I in t)if(!n.deepEqual(t[I],p[I])){_=!0;break}if(!_)return;const w={now:n.browser.now(),transition:n.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,o),this.light.updateTransitions(w)}_validate(t,o,p,_,w={}){return(!w||w.validate!==!1)&&ln(this,t.call(n.validateStyle,n.extend({key:o,style:this.serialize(),value:p,styleSpec:n.v8Spec},_)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const p=this.sourceCaches[o];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const o in this.sourceCaches)this.sourceCaches[o].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,o,p,_,w=!1){let I=!1,P=!1;const L={};for(const O of this._order){const V=this._layers[O];if(V.type!=="symbol")continue;if(!L[V.source]){const Y=this.sourceCaches[V.source];L[V.source]=Y.getRenderableIds(!0).map(ge=>Y.getTileByID(ge)).sort((ge,de)=>de.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(de.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(V,L[V.source],t.center.lng);I=I||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.browser.now(),t.zoom))&&(this.pauseablePlacement=new gn(t,this.map.terrain,this._order,w,o,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.browser.now()),P=!0),I&&this.pauseablePlacement.placement.setStale()),P||I)for(const O of this._order){const V=this._layers[O];V.type==="symbol"&&this.placement.updateLayerOpacities(V,L[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.browser.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,o,p){this.imageManager.getImages(o.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[o.source];_&&_.setDependencies(o.tileID.key,o.type,o.icons)}getGlyphs(t,o,p){this.glyphManager.getGlyphs(o.stacks,p);const _=this.sourceCaches[o.source];_&&_.setDependencies(o.tileID.key,o.type,[""])}getResource(t,o,p){return n.makeRequest(o,p)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,o={}){this._checkLoaded(),t&&this._validate(n.validateStyle.glyphs,"glyphs",t,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,o,p={},_){this._checkLoaded();const w=[{id:t,url:o}],I=[...ue(this.stylesheet.sprite),...w];this._validate(n.validateStyle.sprite,"sprite",I,null,p)||(this.stylesheet.sprite=I,this._loadSprite(w,!0,_))}removeSprite(t){this._checkLoaded();const o=ue(this.stylesheet.sprite);if(o.find(p=>p.id===t)){if(this._spritesImagesIds[t])for(const p of this._spritesImagesIds[t])this.imageManager.removeImage(p),this._changedImages[p]=!0;o.splice(o.findIndex(p=>p.id===t),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new n.Event("data",{dataType:"style"}))}else this.fire(new n.ErrorEvent(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ue(this.stylesheet.sprite)}setSprite(t,o={},p){this._checkLoaded(),t&&this._validate(n.validateStyle.sprite,"sprite",t,null,o)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,p):(this._unloadSprite(),p&&p(null)))}}Er.registerForPluginStateChange=n.registerForPluginStateChange;var Mr=n.createLayout([{name:"a_pos",type:"Int16",components:2}]),is="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const _n={prelude:_i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:_i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:_i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:_i(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:_i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:_i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:_i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:_i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:_i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:_i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:_i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:_i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:_i(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:_i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:_i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:_i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:_i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:_i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:_i("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",is),terrainDepth:_i("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",is),terrainCoords:_i("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",is)};function _i(y,t){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=t.match(/attribute ([\w]+) ([\w]+)/g),_=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=w?w.concat(_):_,P={};return{fragmentSource:y=y.replace(o,(L,O,V,$,Y)=>(P[Y]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
varying ${V} ${$} ${Y};
#else
uniform ${V} ${$} u_${Y};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Y}
    ${V} ${$} ${Y} = u_${Y};
#endif
`)),vertexSource:t=t.replace(o,(L,O,V,$,Y)=>{const ge=$==="float"?"vec2":"vec4",de=Y.match(/color/)?"color":ge;return P[Y]?O==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${V} ${ge} a_${Y};
varying ${V} ${$} ${Y};
#else
uniform ${V} ${$} u_${Y};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${V} ${$} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${de}(a_${Y}, u_${Y}_t);
#else
    ${V} ${$} ${Y} = u_${Y};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${V} ${ge} a_${Y};
#else
uniform ${V} ${$} u_${Y};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${V} ${$} ${Y} = a_${Y};
#else
    ${V} ${$} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${V} ${$} ${Y} = unpack_mix_${de}(a_${Y}, u_${Y}_t);
#else
    ${V} ${$} ${Y} = u_${Y};
#endif
`}),staticAttributes:p,staticUniforms:I}}class gs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,o,p,_,w,I,P,L,O){this.context=t;let V=this.boundPaintVertexBuffers.length!==_.length;for(let $=0;!V&&$<_.length;$++)this.boundPaintVertexBuffers[$]!==_[$]&&(V=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==p||V||this.boundIndexBuffer!==w||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==L||this.boundDynamicVertexBuffer3!==O?this.freshBind(o,p,_,w,I,P,L,O):(t.bindVertexArray.set(this.vao),P&&P.bind(),w&&w.dynamicDraw&&w.bind(),L&&L.bind(),O&&O.bind())}freshBind(t,o,p,_,w,I,P,L){const O=t.numAttributes,V=this.context,$=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=L,o.enableAttributes($,t);for(const Y of p)Y.enableAttributes($,t);I&&I.enableAttributes($,t),P&&P.enableAttributes($,t),L&&L.enableAttributes($,t),o.bind(),o.setVertexAttribPointers($,t,w);for(const Y of p)Y.bind(),Y.setVertexAttribPointers($,t,w);I&&(I.bind(),I.setVertexAttribPointers($,t,w)),_&&_.bind(),P&&(P.bind(),P.setVertexAttribPointers($,t,w)),L&&(L.bind(),L.setVertexAttribPointers($,t,w)),V.currentNumAttributes=O}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Xr(y){const t=[];for(let o=0;o<y.length;o++){if(y[o]===null)continue;const p=y[o].split(" ");t.push(p.pop())}return t}class pr{constructor(t,o,p,_,w,I){const P=t.gl;this.program=P.createProgram();const L=Xr(o.staticAttributes),O=p?p.getBinderAttributes():[],V=L.concat(O),$=_n.prelude.staticUniforms?Xr(_n.prelude.staticUniforms):[],Y=o.staticUniforms?Xr(o.staticUniforms):[],ge=p?p.getBinderUniforms():[],de=$.concat(Y).concat(ge),xe=[];for(const lt of de)xe.indexOf(lt)<0&&xe.push(lt);const fe=p?p.defines():[];w&&fe.push("#define OVERDRAW_INSPECTOR;"),I&&fe.push("#define TERRAIN3D;");const Ve=fe.concat(_n.prelude.fragmentSource,o.fragmentSource).join(`
`),rt=fe.concat(_n.prelude.vertexSource,o.vertexSource).join(`
`),Ae=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Ae,Ve),P.compileShader(Ae),!P.getShaderParameter(Ae,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(Ae)}`);P.attachShader(this.program,Ae);const Ge=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Ge,rt),P.compileShader(Ge),!P.getShaderParameter(Ge,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(Ge)}`);P.attachShader(this.program,Ge),this.attributes={};const ot={};this.numAttributes=V.length;for(let lt=0;lt<this.numAttributes;lt++)V[lt]&&(P.bindAttribLocation(this.program,lt,V[lt]),this.attributes[V[lt]]=lt);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(Ge),P.deleteShader(Ae);for(let lt=0;lt<xe.length;lt++){const pt=xe[lt];if(pt&&!ot[pt]){const St=P.getUniformLocation(this.program,pt);St&&(ot[pt]=St)}}this.fixedUniforms=_(t,ot),this.terrainUniforms=((lt,pt)=>({u_depth:new n.Uniform1i(lt,pt.u_depth),u_terrain:new n.Uniform1i(lt,pt.u_terrain),u_terrain_dim:new n.Uniform1f(lt,pt.u_terrain_dim),u_terrain_matrix:new n.UniformMatrix4f(lt,pt.u_terrain_matrix),u_terrain_unpack:new n.Uniform4f(lt,pt.u_terrain_unpack),u_terrain_exaggeration:new n.Uniform1f(lt,pt.u_terrain_exaggeration)}))(t,ot),this.binderUniforms=p?p.getUniforms(t,ot):[]}draw(t,o,p,_,w,I,P,L,O,V,$,Y,ge,de,xe,fe,Ve,rt){const Ae=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(_),t.setColorMode(w),t.setCullFace(I),L){t.activeTexture.set(Ae.TEXTURE2),Ae.bindTexture(Ae.TEXTURE_2D,L.depthTexture),t.activeTexture.set(Ae.TEXTURE3),Ae.bindTexture(Ae.TEXTURE_2D,L.texture);for(const ot in this.terrainUniforms)this.terrainUniforms[ot].set(L[ot])}for(const ot in this.fixedUniforms)this.fixedUniforms[ot].set(P[ot]);xe&&xe.setUniforms(t,this.binderUniforms,ge,{zoom:de});let Ge=0;switch(o){case Ae.LINES:Ge=2;break;case Ae.TRIANGLES:Ge=3;break;case Ae.LINE_STRIP:Ge=1}for(const ot of Y.get()){const lt=ot.vaos||(ot.vaos={});(lt[O]||(lt[O]=new gs)).bind(t,this,V,xe?xe.getPaintVertexBuffers():[],$,ot.vertexOffset,fe,Ve,rt),Ae.drawElements(o,ot.primitiveLength*Ge,Ae.UNSIGNED_SHORT,ot.primitiveOffset*Ge*2)}}}function ma(y,t,o){const p=1/qe(o,1,t.transform.tileZoom),_=Math.pow(2,o.tileID.overscaledZ),w=o.tileSize*Math.pow(2,t.transform.tileZoom)/_,I=w*(o.tileID.canonical.x+o.tileID.wrap*_),P=w*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[I>>16,P>>16],u_pixel_coord_lower:[65535&I,65535&P]}}const zn=(y,t,o,p)=>{const _=t.style.light,w=_.properties.get("position"),I=[w.x,w.y,w.z],P=function(){var O=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(O[1]=0,O[2]=0,O[3]=0,O[5]=0,O[6]=0,O[7]=0),O[0]=1,O[4]=1,O[8]=1,O}();_.properties.get("anchor")==="viewport"&&function(O,V){var $=Math.sin(V),Y=Math.cos(V);O[0]=Y,O[1]=$,O[2]=0,O[3]=-$,O[4]=Y,O[5]=0,O[6]=0,O[7]=0,O[8]=1}(P,-t.transform.angle),function(O,V,$){var Y=V[0],ge=V[1],de=V[2];O[0]=Y*$[0]+ge*$[3]+de*$[6],O[1]=Y*$[1]+ge*$[4]+de*$[7],O[2]=Y*$[2]+ge*$[5]+de*$[8]}(I,I,P);const L=_.properties.get("color");return{u_matrix:y,u_lightpos:I,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+o,u_opacity:p}},Sc=(y,t,o,p,_,w,I)=>n.extend(zn(y,t,o,p),ma(w,t,I),{u_height_factor:-Math.pow(2,_.overscaledZ)/I.tileSize/8}),rs=y=>({u_matrix:y}),kc=(y,t,o,p)=>n.extend(rs(y),ma(o,t,p)),Tc=(y,t)=>({u_matrix:y,u_world:t}),Ja=(y,t,o,p,_)=>n.extend(kc(y,t,o,p),{u_world:_}),Ya=(y,t,o,p)=>{const _=y.transform;let w,I;if(p.paint.get("circle-pitch-alignment")==="map"){const P=qe(o,1,_.zoom);w=!0,I=[P,P]}else w=!1,I=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(t.posMatrix,o,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:I}},_s=(y,t,o)=>{const p=qe(o,1,t.zoom),_=Math.pow(2,t.zoom-o.tileID.overscaledZ),w=o.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[t.pixelsToGLUnits[0]/(p*_),t.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:w}},Qa=(y,t,o=1)=>({u_matrix:y,u_color:t,u_overlay:0,u_overlay_scale:o}),ga=y=>({u_matrix:y}),ih=(y,t,o,p)=>({u_matrix:y,u_extrude_scale:qe(t,1,o),u_intensity:p});function rh(y,t){const o=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new n.MercatorCoordinate(0,p/o).toLngLat().lat,new n.MercatorCoordinate(0,(p+1)/o).toLngLat().lat]}const _a=(y,t,o,p)=>{const _=y.transform;return{u_matrix:Ic(y,t,o,p),u_ratio:1/qe(t,1,_.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},nh=(y,t,o,p,_)=>n.extend(_a(y,t,o,_),{u_image:0,u_image_height:p}),Cc=(y,t,o,p,_)=>{const w=y.transform,I=Yo(t,w);return{u_matrix:Ic(y,t,o,_),u_texsize:t.imageAtlasTexture.size,u_ratio:1/qe(t,1,w.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[I,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},sh=(y,t,o,p,_,w)=>{const I=y.lineAtlas,P=Yo(t,y.transform),L=o.layout.get("line-cap")==="round",O=I.getDash(p.from,L),V=I.getDash(p.to,L),$=O.width*_.fromScale,Y=V.width*_.toScale;return n.extend(_a(y,t,o,w),{u_patternscale_a:[P/$,-O.height/2],u_patternscale_b:[P/Y,-V.height/2],u_sdfgamma:I.width/(256*Math.min($,Y)*y.pixelRatio)/2,u_image:0,u_tex_y_a:O.y,u_tex_y_b:V.y,u_mix:_.t})};function Yo(y,t){return 1/qe(y,1,t.tileZoom)}function Ic(y,t,o,p){return y.translatePosMatrix(p?p.posMatrix:t.tileID.posMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Qo=(y,t,o,p,_)=>{return{u_matrix:y,u_tl_parent:t,u_scale_parent:o,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(I=_.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ac(_.paint.get("raster-hue-rotate"))};var w,I};function Ac(y){y*=Math.PI/180;const t=Math.sin(y),o=Math.cos(y);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const el=(y,t,o,p,_,w,I,P,L,O)=>{const V=_.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:V.width/V.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:I,u_coord_matrix:P,u_is_text:+L,u_pitch_with_map:+p,u_texsize:O,u_texture:0}},tl=(y,t,o,p,_,w,I,P,L,O,V)=>{const $=_.transform;return n.extend(el(y,t,o,p,_,w,I,P,L,O),{u_gamma_scale:p?Math.cos($._pitch)*$.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+V})},Pc=(y,t,o,p,_,w,I,P,L,O)=>n.extend(tl(y,t,o,p,_,w,I,P,!0,L,!0),{u_texsize_icon:O,u_texture_icon:1}),Is=(y,t,o)=>({u_matrix:y,u_opacity:t,u_color:o}),eo=(y,t,o,p,_,w)=>n.extend(function(I,P,L,O){const V=L.imageManager.getPattern(I.from.toString()),$=L.imageManager.getPattern(I.to.toString()),{width:Y,height:ge}=L.imageManager.getPixelSize(),de=Math.pow(2,O.tileID.overscaledZ),xe=O.tileSize*Math.pow(2,L.transform.tileZoom)/de,fe=xe*(O.tileID.canonical.x+O.tileID.wrap*de),Ve=xe*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:$.tl,u_pattern_br_b:$.br,u_texsize:[Y,ge],u_mix:P.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:$.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/qe(O,1,L.transform.tileZoom),u_pixel_coord_upper:[fe>>16,Ve>>16],u_pixel_coord_lower:[65535&fe,65535&Ve]}}(p,w,o,_),{u_matrix:y,u_opacity:t}),Mn={fillExtrusion:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_lightpos:new n.Uniform3f(y,t.u_lightpos),u_lightintensity:new n.Uniform1f(y,t.u_lightintensity),u_lightcolor:new n.Uniform3f(y,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(y,t.u_vertical_gradient),u_opacity:new n.Uniform1f(y,t.u_opacity)}),fillExtrusionPattern:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_lightpos:new n.Uniform3f(y,t.u_lightpos),u_lightintensity:new n.Uniform1f(y,t.u_lightintensity),u_lightcolor:new n.Uniform3f(y,t.u_lightcolor),u_vertical_gradient:new n.Uniform1f(y,t.u_vertical_gradient),u_height_factor:new n.Uniform1f(y,t.u_height_factor),u_image:new n.Uniform1i(y,t.u_image),u_texsize:new n.Uniform2f(y,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(y,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(y,t.u_scale),u_fade:new n.Uniform1f(y,t.u_fade),u_opacity:new n.Uniform1f(y,t.u_opacity)}),fill:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix)}),fillPattern:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_image:new n.Uniform1i(y,t.u_image),u_texsize:new n.Uniform2f(y,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(y,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(y,t.u_scale),u_fade:new n.Uniform1f(y,t.u_fade)}),fillOutline:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_world:new n.Uniform2f(y,t.u_world)}),fillOutlinePattern:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_world:new n.Uniform2f(y,t.u_world),u_image:new n.Uniform1i(y,t.u_image),u_texsize:new n.Uniform2f(y,t.u_texsize),u_pixel_coord_upper:new n.Uniform2f(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(y,t.u_pixel_coord_lower),u_scale:new n.Uniform3f(y,t.u_scale),u_fade:new n.Uniform1f(y,t.u_fade)}),circle:(y,t)=>({u_camera_to_center_distance:new n.Uniform1f(y,t.u_camera_to_center_distance),u_scale_with_map:new n.Uniform1i(y,t.u_scale_with_map),u_pitch_with_map:new n.Uniform1i(y,t.u_pitch_with_map),u_extrude_scale:new n.Uniform2f(y,t.u_extrude_scale),u_device_pixel_ratio:new n.Uniform1f(y,t.u_device_pixel_ratio),u_matrix:new n.UniformMatrix4f(y,t.u_matrix)}),collisionBox:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_camera_to_center_distance:new n.Uniform1f(y,t.u_camera_to_center_distance),u_pixels_to_tile_units:new n.Uniform1f(y,t.u_pixels_to_tile_units),u_extrude_scale:new n.Uniform2f(y,t.u_extrude_scale),u_overscale_factor:new n.Uniform1f(y,t.u_overscale_factor)}),collisionCircle:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_inv_matrix:new n.UniformMatrix4f(y,t.u_inv_matrix),u_camera_to_center_distance:new n.Uniform1f(y,t.u_camera_to_center_distance),u_viewport_size:new n.Uniform2f(y,t.u_viewport_size)}),debug:(y,t)=>({u_color:new n.UniformColor(y,t.u_color),u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_overlay:new n.Uniform1i(y,t.u_overlay),u_overlay_scale:new n.Uniform1f(y,t.u_overlay_scale)}),clippingMask:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix)}),heatmap:(y,t)=>({u_extrude_scale:new n.Uniform1f(y,t.u_extrude_scale),u_intensity:new n.Uniform1f(y,t.u_intensity),u_matrix:new n.UniformMatrix4f(y,t.u_matrix)}),heatmapTexture:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_world:new n.Uniform2f(y,t.u_world),u_image:new n.Uniform1i(y,t.u_image),u_color_ramp:new n.Uniform1i(y,t.u_color_ramp),u_opacity:new n.Uniform1f(y,t.u_opacity)}),hillshade:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_image:new n.Uniform1i(y,t.u_image),u_latrange:new n.Uniform2f(y,t.u_latrange),u_light:new n.Uniform2f(y,t.u_light),u_shadow:new n.UniformColor(y,t.u_shadow),u_highlight:new n.UniformColor(y,t.u_highlight),u_accent:new n.UniformColor(y,t.u_accent)}),hillshadePrepare:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_image:new n.Uniform1i(y,t.u_image),u_dimension:new n.Uniform2f(y,t.u_dimension),u_zoom:new n.Uniform1f(y,t.u_zoom),u_unpack:new n.Uniform4f(y,t.u_unpack)}),line:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_ratio:new n.Uniform1f(y,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(y,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(y,t.u_units_to_pixels)}),lineGradient:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_ratio:new n.Uniform1f(y,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(y,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(y,t.u_units_to_pixels),u_image:new n.Uniform1i(y,t.u_image),u_image_height:new n.Uniform1f(y,t.u_image_height)}),linePattern:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_texsize:new n.Uniform2f(y,t.u_texsize),u_ratio:new n.Uniform1f(y,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(y,t.u_device_pixel_ratio),u_image:new n.Uniform1i(y,t.u_image),u_units_to_pixels:new n.Uniform2f(y,t.u_units_to_pixels),u_scale:new n.Uniform3f(y,t.u_scale),u_fade:new n.Uniform1f(y,t.u_fade)}),lineSDF:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_ratio:new n.Uniform1f(y,t.u_ratio),u_device_pixel_ratio:new n.Uniform1f(y,t.u_device_pixel_ratio),u_units_to_pixels:new n.Uniform2f(y,t.u_units_to_pixels),u_patternscale_a:new n.Uniform2f(y,t.u_patternscale_a),u_patternscale_b:new n.Uniform2f(y,t.u_patternscale_b),u_sdfgamma:new n.Uniform1f(y,t.u_sdfgamma),u_image:new n.Uniform1i(y,t.u_image),u_tex_y_a:new n.Uniform1f(y,t.u_tex_y_a),u_tex_y_b:new n.Uniform1f(y,t.u_tex_y_b),u_mix:new n.Uniform1f(y,t.u_mix)}),raster:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_tl_parent:new n.Uniform2f(y,t.u_tl_parent),u_scale_parent:new n.Uniform1f(y,t.u_scale_parent),u_buffer_scale:new n.Uniform1f(y,t.u_buffer_scale),u_fade_t:new n.Uniform1f(y,t.u_fade_t),u_opacity:new n.Uniform1f(y,t.u_opacity),u_image0:new n.Uniform1i(y,t.u_image0),u_image1:new n.Uniform1i(y,t.u_image1),u_brightness_low:new n.Uniform1f(y,t.u_brightness_low),u_brightness_high:new n.Uniform1f(y,t.u_brightness_high),u_saturation_factor:new n.Uniform1f(y,t.u_saturation_factor),u_contrast_factor:new n.Uniform1f(y,t.u_contrast_factor),u_spin_weights:new n.Uniform3f(y,t.u_spin_weights)}),symbolIcon:(y,t)=>({u_is_size_zoom_constant:new n.Uniform1i(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(y,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(y,t.u_size_t),u_size:new n.Uniform1f(y,t.u_size),u_camera_to_center_distance:new n.Uniform1f(y,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(y,t.u_pitch),u_rotate_symbol:new n.Uniform1i(y,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(y,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(y,t.u_fade_change),u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(y,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(y,t.u_coord_matrix),u_is_text:new n.Uniform1i(y,t.u_is_text),u_pitch_with_map:new n.Uniform1i(y,t.u_pitch_with_map),u_texsize:new n.Uniform2f(y,t.u_texsize),u_texture:new n.Uniform1i(y,t.u_texture)}),symbolSDF:(y,t)=>({u_is_size_zoom_constant:new n.Uniform1i(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(y,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(y,t.u_size_t),u_size:new n.Uniform1f(y,t.u_size),u_camera_to_center_distance:new n.Uniform1f(y,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(y,t.u_pitch),u_rotate_symbol:new n.Uniform1i(y,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(y,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(y,t.u_fade_change),u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(y,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(y,t.u_coord_matrix),u_is_text:new n.Uniform1i(y,t.u_is_text),u_pitch_with_map:new n.Uniform1i(y,t.u_pitch_with_map),u_texsize:new n.Uniform2f(y,t.u_texsize),u_texture:new n.Uniform1i(y,t.u_texture),u_gamma_scale:new n.Uniform1f(y,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(y,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(y,t.u_is_halo)}),symbolTextAndIcon:(y,t)=>({u_is_size_zoom_constant:new n.Uniform1i(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new n.Uniform1i(y,t.u_is_size_feature_constant),u_size_t:new n.Uniform1f(y,t.u_size_t),u_size:new n.Uniform1f(y,t.u_size),u_camera_to_center_distance:new n.Uniform1f(y,t.u_camera_to_center_distance),u_pitch:new n.Uniform1f(y,t.u_pitch),u_rotate_symbol:new n.Uniform1i(y,t.u_rotate_symbol),u_aspect_ratio:new n.Uniform1f(y,t.u_aspect_ratio),u_fade_change:new n.Uniform1f(y,t.u_fade_change),u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_label_plane_matrix:new n.UniformMatrix4f(y,t.u_label_plane_matrix),u_coord_matrix:new n.UniformMatrix4f(y,t.u_coord_matrix),u_is_text:new n.Uniform1i(y,t.u_is_text),u_pitch_with_map:new n.Uniform1i(y,t.u_pitch_with_map),u_texsize:new n.Uniform2f(y,t.u_texsize),u_texsize_icon:new n.Uniform2f(y,t.u_texsize_icon),u_texture:new n.Uniform1i(y,t.u_texture),u_texture_icon:new n.Uniform1i(y,t.u_texture_icon),u_gamma_scale:new n.Uniform1f(y,t.u_gamma_scale),u_device_pixel_ratio:new n.Uniform1f(y,t.u_device_pixel_ratio),u_is_halo:new n.Uniform1i(y,t.u_is_halo)}),background:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_opacity:new n.Uniform1f(y,t.u_opacity),u_color:new n.UniformColor(y,t.u_color)}),backgroundPattern:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_opacity:new n.Uniform1f(y,t.u_opacity),u_image:new n.Uniform1i(y,t.u_image),u_pattern_tl_a:new n.Uniform2f(y,t.u_pattern_tl_a),u_pattern_br_a:new n.Uniform2f(y,t.u_pattern_br_a),u_pattern_tl_b:new n.Uniform2f(y,t.u_pattern_tl_b),u_pattern_br_b:new n.Uniform2f(y,t.u_pattern_br_b),u_texsize:new n.Uniform2f(y,t.u_texsize),u_mix:new n.Uniform1f(y,t.u_mix),u_pattern_size_a:new n.Uniform2f(y,t.u_pattern_size_a),u_pattern_size_b:new n.Uniform2f(y,t.u_pattern_size_b),u_scale_a:new n.Uniform1f(y,t.u_scale_a),u_scale_b:new n.Uniform1f(y,t.u_scale_b),u_pixel_coord_upper:new n.Uniform2f(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new n.Uniform2f(y,t.u_pixel_coord_lower),u_tile_units_to_pixels:new n.Uniform1f(y,t.u_tile_units_to_pixels)}),terrain:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_texture:new n.Uniform1i(y,t.u_texture),u_ele_delta:new n.Uniform1f(y,t.u_ele_delta)}),terrainDepth:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_ele_delta:new n.Uniform1f(y,t.u_ele_delta)}),terrainCoords:(y,t)=>({u_matrix:new n.UniformMatrix4f(y,t.u_matrix),u_texture:new n.Uniform1i(y,t.u_texture),u_terrain_coords_id:new n.Uniform1f(y,t.u_terrain_coords_id),u_ele_delta:new n.Uniform1f(y,t.u_ele_delta)})};class to{constructor(t,o,p){this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const io={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ya{constructor(t,o,p,_){this.length=o.length,this.attributes=p,this.itemSize=o.bytesPerElement,this.dynamicDraw=_,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let p=0;p<this.attributes.length;p++){const _=o.attributes[this.attributes[p].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,o,p){for(let _=0;_<this.attributes.length;_++){const w=this.attributes[_],I=o.attributes[w.name];I!==void 0&&t.vertexAttribPointer(I,w.components,t[io[w.type]],!1,this.itemSize,w.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const js=new WeakMap;function As(y){if(js.has(y))return js.get(y);{const t=y.getParameter(y.VERSION).startsWith("WebGL 2.0");return js.set(y,t),t}}class Ri{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ps extends Ri{getDefault(){return n.Color.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ro extends Ri{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class yn extends Ri{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class vn extends Ri{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class il extends Ri{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class no extends Ri{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class so extends Ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class rl extends Ri{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class nl extends Ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class ao extends Ri{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class sl extends Ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class al extends Ri{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class oo extends Ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class zc extends Ri{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Mc extends Ri{getDefault(){return n.Color.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class qs extends Ri{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ah extends Ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class oh extends Ri{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class lh extends Ri{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ch extends Ri{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class uh extends Ri{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class hh extends Ri{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ol extends Ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class lo extends Ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ll extends Ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class cl extends Ri{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Zs extends Ri{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Dc extends Ri{getDefault(){return null}set(t){var o;if(t===this.current&&!this.dirty)return;const p=this.gl;As(p)?p.bindVertexArray(t):(o=p.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Lc extends Ri{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ul extends Ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class zs extends Ri{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class co extends Ri{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Gs extends co{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Hs extends co{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Rc extends co{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class hl{constructor(t,o,p,_,w){this.context=t,this.width=o,this.height=p;const I=t.gl,P=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new Gs(t,P),_)this.depthAttachment=w?new Rc(t,P):new Hs(t,P);else if(w)throw new Error("Stencil cannot be setted without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,o=this.colorAttachment.get();if(o&&t.deleteTexture(o),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class mi{constructor(t,o,p){this.blendFunction=t,this.blendColor=o,this.mask=p}}mi.Replace=[1,0],mi.disabled=new mi(mi.Replace,n.Color.transparent,[!1,!1,!1,!1]),mi.unblended=new mi(mi.Replace,n.Color.transparent,[!0,!0,!0,!0]),mi.alphaBlended=new mi([1,771],n.Color.transparent,[!0,!0,!0,!0]);class uo{constructor(t){var o,p;if(this.gl=t,this.clearColor=new Ps(this),this.clearDepth=new ro(this),this.clearStencil=new yn(this),this.colorMask=new vn(this),this.depthMask=new il(this),this.stencilMask=new no(this),this.stencilFunc=new so(this),this.stencilOp=new rl(this),this.stencilTest=new nl(this),this.depthRange=new ao(this),this.depthTest=new sl(this),this.depthFunc=new al(this),this.blend=new oo(this),this.blendFunc=new zc(this),this.blendColor=new Mc(this),this.blendEquation=new qs(this),this.cullFace=new ah(this),this.cullFaceSide=new oh(this),this.frontFace=new lh(this),this.program=new ch(this),this.activeTexture=new uh(this),this.viewport=new hh(this),this.bindFramebuffer=new ol(this),this.bindRenderbuffer=new lo(this),this.bindTexture=new ll(this),this.bindVertexBuffer=new cl(this),this.bindElementBuffer=new Zs(this),this.bindVertexArray=new Dc(this),this.pixelStoreUnpack=new Lc(this),this.pixelStoreUnpackPremultiplyAlpha=new ul(this),this.pixelStoreUnpackFlipY=new zs(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),As(t)){this.HALF_FLOAT=t.HALF_FLOAT;const _=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=t.RGBA16F)!==null&&o!==void 0?o:_==null?void 0:_.RGBA16F_EXT,this.RGB16F=(p=t.RGB16F)!==null&&p!==void 0?p:_==null?void 0:_.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const _=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=_==null?void 0:_.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o){return new to(this,t,o)}createVertexBuffer(t,o,p){return new ya(this,t,o,p)}createRenderbuffer(t,o,p){const _=this.gl,w=_.createRenderbuffer();return this.bindRenderbuffer.set(w),_.renderbufferStorage(_.RENDERBUFFER,t,o,p),this.bindRenderbuffer.set(null),w}createFramebuffer(t,o,p,_){return new hl(this,t,o,p,_)}clear({color:t,depth:o,stencil:p}){const _=this.gl;let w=0;t&&(w|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(w|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),p!==void 0&&(w|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.deepEqual(t.blendFunction,mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return As(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var o;return As(this.gl)?this.gl.deleteVertexArray(t):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Li{constructor(t,o,p){this.func=t,this.mask=o,this.range=p}}Li.ReadOnly=!1,Li.ReadWrite=!0,Li.disabled=new Li(519,Li.ReadOnly,[0,1]);const ho=7680;class Hi{constructor(t,o,p,_,w,I){this.test=t,this.ref=o,this.mask=p,this.fail=_,this.depthFail=w,this.pass=I}}Hi.disabled=new Hi({func:519,mask:0},0,0,ho,ho,ho);class Yi{constructor(t,o,p){this.enable=t,this.mode=o,this.frontFace=p}}let fo;function fl(y,t,o,p,_,w,I){const P=y.context,L=P.gl,O=y.useProgram("collisionBox"),V=[];let $=0,Y=0;for(let Ae=0;Ae<p.length;Ae++){const Ge=p[Ae],ot=t.getTile(Ge),lt=ot.getBucket(o);if(!lt)continue;let pt=Ge.posMatrix;_[0]===0&&_[1]===0||(pt=y.translatePosMatrix(Ge.posMatrix,ot,_,w));const St=I?lt.textCollisionBox:lt.iconCollisionBox,wt=lt.collisionCircleArray;if(wt.length>0){const Pt=n.create(),Wt=pt;n.mul(Pt,lt.placementInvProjMatrix,y.transform.glCoordMatrix),n.mul(Pt,Pt,lt.placementViewportMatrix),V.push({circleArray:wt,circleOffset:Y,transform:Wt,invTransform:Pt,coord:Ge}),$+=wt.length/4,Y=$}St&&O.draw(P,L.LINES,Li.disabled,Hi.disabled,y.colorModeForRenderPass(),Yi.disabled,_s(pt,y.transform,ot),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ge),o.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,y.transform.zoom,null,null,St.collisionVertexBuffer)}if(!I||!V.length)return;const ge=y.useProgram("collisionCircle"),de=new n.CollisionCircleLayoutArray;de.resize(4*$),de._trim();let xe=0;for(const Ae of V)for(let Ge=0;Ge<Ae.circleArray.length/4;Ge++){const ot=4*Ge,lt=Ae.circleArray[ot+0],pt=Ae.circleArray[ot+1],St=Ae.circleArray[ot+2],wt=Ae.circleArray[ot+3];de.emplace(xe++,lt,pt,St,wt,0),de.emplace(xe++,lt,pt,St,wt,1),de.emplace(xe++,lt,pt,St,wt,2),de.emplace(xe++,lt,pt,St,wt,3)}(!fo||fo.length<2*$)&&(fo=function(Ae){const Ge=2*Ae,ot=new n.QuadTriangleArray;ot.resize(Ge),ot._trim();for(let lt=0;lt<Ge;lt++){const pt=6*lt;ot.uint16[pt+0]=4*lt+0,ot.uint16[pt+1]=4*lt+1,ot.uint16[pt+2]=4*lt+2,ot.uint16[pt+3]=4*lt+2,ot.uint16[pt+4]=4*lt+3,ot.uint16[pt+5]=4*lt+0}return ot}($));const fe=P.createIndexBuffer(fo,!0),Ve=P.createVertexBuffer(de,n.collisionCircleLayout.members,!0);for(const Ae of V){const Ge={u_matrix:Ae.transform,u_inv_matrix:Ae.invTransform,u_camera_to_center_distance:(rt=y.transform).cameraToCenterDistance,u_viewport_size:[rt.width,rt.height]};ge.draw(P,L.TRIANGLES,Li.disabled,Hi.disabled,y.colorModeForRenderPass(),Yi.disabled,Ge,y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae.coord),o.id,Ve,fe,n.SegmentVector.simpleSegment(0,2*Ae.circleOffset,Ae.circleArray.length,Ae.circleArray.length/2),null,y.transform.zoom,null,null,null)}var rt;Ve.destroy(),fe.destroy()}Yi.disabled=new Yi(!1,1029,2305),Yi.backCCW=new Yi(!0,1029,2305);const fh=n.identity(new Float32Array(16));function dl(y,t,o,p,_,w){const{horizontalAlign:I,verticalAlign:P}=n.getAnchorAlignment(y);return new n.Point((-(I-.5)*t/_+p[0])*w,(-(P-.5)*o/_+p[1])*w)}function po(y,t,o,p,_,w,I,P,L,O,V){const $=y.text.placedSymbolArray,Y=y.text.dynamicLayoutVertexArray,ge=y.icon.dynamicLayoutVertexArray,de={};Y.clear();for(let xe=0;xe<$.length;xe++){const fe=$.get(xe),Ve=fe.hidden||!fe.crossTileID||y.allowVerticalPlacement&&!fe.placedOrientation?null:p[fe.crossTileID];if(Ve){const rt=new n.Point(fe.anchorX,fe.anchorY),Ae=Ki(rt,o?I:w,V),Ge=br(_.cameraToCenterDistance,Ae.signedDistanceFromCamera);let ot=n.evaluateSizeForFeature(y.textSizeData,L,fe)*Ge/n.ONE_EM;o&&(ot*=y.tilePixelRatio/P);const{width:lt,height:pt,anchor:St,textOffset:wt,textBoxScale:Pt}=Ve,Wt=dl(St,lt,pt,wt,Pt,ot),zi=o?Ki(rt.add(Wt),w,V).point:Ae.point.add(t?Wt.rotate(-_.angle):Wt),Lt=y.allowVerticalPlacement&&fe.placedOrientation===n.WritingMode.vertical?Math.PI/2:0;for(let fi=0;fi<fe.numGlyphs;fi++)n.addDynamicAttributes(Y,zi,Lt);O&&fe.associatedIconIndex>=0&&(de[fe.associatedIconIndex]={shiftedAnchor:zi,angle:Lt})}else K(fe.numGlyphs,Y)}if(O){ge.clear();const xe=y.icon.placedSymbolArray;for(let fe=0;fe<xe.length;fe++){const Ve=xe.get(fe);if(Ve.hidden)K(Ve.numGlyphs,ge);else{const rt=de[fe];if(rt)for(let Ae=0;Ae<Ve.numGlyphs;Ae++)n.addDynamicAttributes(ge,rt.shiftedAnchor,rt.angle);else K(Ve.numGlyphs,ge)}}y.icon.dynamicLayoutVertexBuffer.updateData(ge)}y.text.dynamicLayoutVertexBuffer.updateData(Y)}function mo(y,t,o){return o.iconsInText&&t?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function go(y,t,o,p,_,w,I,P,L,O,V,$){const Y=y.context,ge=Y.gl,de=y.transform,xe=P==="map",fe=L==="map",Ve=P!=="viewport"&&o.layout.get("symbol-placement")!=="point",rt=xe&&!fe&&!Ve,Ae=!o.layout.get("symbol-sort-key").isConstant();let Ge=!1;const ot=y.depthModeForSublayer(0,Li.ReadOnly),lt=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),pt=[];for(const St of p){const wt=t.getTile(St),Pt=wt.getBucket(o);if(!Pt)continue;const Wt=_?Pt.text:Pt.icon;if(!Wt||!Wt.segments.get().length||!Wt.hasVisibleVertices)continue;const zi=Wt.programConfigurations.get(o.id),Lt=_||Pt.sdfIcons,fi=_?Pt.textSizeData:Pt.iconSizeData,Xt=fe||de.pitch!==0,tr=y.useProgram(mo(Lt,_,Pt),zi),wi=n.evaluateSizeForZoom(fi,de.zoom),Ei=y.style.map.terrain&&y.style.map.terrain.getTerrainData(St);let Mi,mr,Wi,Dn,hr=[0,0],or=null;if(_)mr=wt.glyphAtlasTexture,Wi=ge.LINEAR,Mi=wt.glyphAtlasTexture.size,Pt.iconsInText&&(hr=wt.imageAtlasTexture.size,or=wt.imageAtlasTexture,Dn=Xt||y.options.rotating||y.options.zooming||fi.kind==="composite"||fi.kind==="camera"?ge.LINEAR:ge.NEAREST);else{const gr=o.layout.get("icon-size").constantOr(0)!==1||Pt.iconsNeedLinear;mr=wt.imageAtlasTexture,Wi=Lt||y.options.rotating||y.options.zooming||gr||Xt?ge.LINEAR:ge.NEAREST,Mi=wt.imageAtlasTexture.size}const En=qe(wt,1,y.transform.zoom),Wn=qr(St.posMatrix,fe,xe,y.transform,En),ir=vt(St.posMatrix,fe,xe,y.transform,En),ws=lt&&Pt.hasTextData(),xs=o.layout.get("icon-text-fit")!=="none"&&ws&&Pt.hasIconData();if(Ve){const gr=y.style.map.terrain?(Sn,yr)=>y.style.map.terrain.getElevation(St,Sn,yr):null,_r=o.layout.get("text-rotation-alignment")==="map";sr(Pt,St.posMatrix,y,_,Wn,ir,fe,O,_r,gr)}const ss=y.translatePosMatrix(St.posMatrix,wt,w,I),Ms=Ve||_&&lt||xs?fh:Wn,Qr=y.translatePosMatrix(ir,wt,w,I,!0),$r=Lt&&o.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Zr;Zr=Lt?Pt.iconsInText?Pc(fi.kind,wi,rt,fe,y,ss,Ms,Qr,Mi,hr):tl(fi.kind,wi,rt,fe,y,ss,Ms,Qr,_,Mi,!0):el(fi.kind,wi,rt,fe,y,ss,Ms,Qr,_,Mi);const Da={program:tr,buffers:Wt,uniformValues:Zr,atlasTexture:mr,atlasTextureIcon:or,atlasInterpolation:Wi,atlasInterpolationIcon:Dn,isSDF:Lt,hasHalo:$r};if(Ae&&Pt.canOverlap){Ge=!0;const gr=Wt.segments.get();for(const _r of gr)pt.push({segments:new n.SegmentVector([_r]),sortKey:_r.sortKey,state:Da,terrainData:Ei})}else pt.push({segments:Wt.segments,sortKey:0,state:Da,terrainData:Ei})}Ge&&pt.sort((St,wt)=>St.sortKey-wt.sortKey);for(const St of pt){const wt=St.state;if(Y.activeTexture.set(ge.TEXTURE0),wt.atlasTexture.bind(wt.atlasInterpolation,ge.CLAMP_TO_EDGE),wt.atlasTextureIcon&&(Y.activeTexture.set(ge.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,ge.CLAMP_TO_EDGE)),wt.isSDF){const Pt=wt.uniformValues;wt.hasHalo&&(Pt.u_is_halo=1,_o(wt.buffers,St.segments,o,y,wt.program,ot,V,$,Pt,St.terrainData)),Pt.u_is_halo=0}_o(wt.buffers,St.segments,o,y,wt.program,ot,V,$,wt.uniformValues,St.terrainData)}}function _o(y,t,o,p,_,w,I,P,L,O){const V=p.context;_.draw(V,V.gl.TRIANGLES,w,I,P,Yi.disabled,L,O,o.id,y.layoutVertexBuffer,y.indexBuffer,t,o.paint,p.transform.zoom,y.programConfigurations.get(o.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function pl(y,t,o,p,_){if(!o||!p||!p.imageAtlas)return;const w=p.imageAtlas.patternPositions;let I=w[o.to.toString()],P=w[o.from.toString()];if(!I||!P){const L=_.getPaintProperty(t);I=w[L],P=w[L]}I&&P&&y.setConstantPatternPositions(I,P)}function va(y,t,o,p,_,w,I){const P=y.context.gl,L="fill-pattern",O=o.paint.get(L),V=O&&O.constantOr(1),$=o.getCrossfadeParameters();let Y,ge,de,xe,fe;I?(ge=V&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=P.LINES):(ge=V?"fillPattern":"fill",Y=P.TRIANGLES);const Ve=O.constantOr(null);for(const rt of p){const Ae=t.getTile(rt);if(V&&!Ae.patternsLoaded())continue;const Ge=Ae.getBucket(o);if(!Ge)continue;const ot=Ge.programConfigurations.get(o.id),lt=y.useProgram(ge,ot),pt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(rt);V&&(y.context.activeTexture.set(P.TEXTURE0),Ae.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ot.updatePaintBuffers($)),pl(ot,L,Ve,Ae,o);const St=pt?rt:null,wt=y.translatePosMatrix(St?St.posMatrix:rt.posMatrix,Ae,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(I){xe=Ge.indexBuffer2,fe=Ge.segments2;const Pt=[P.drawingBufferWidth,P.drawingBufferHeight];de=ge==="fillOutlinePattern"&&V?Ja(wt,y,$,Ae,Pt):Tc(wt,Pt)}else xe=Ge.indexBuffer,fe=Ge.segments,de=V?kc(wt,y,$,Ae):rs(wt);lt.draw(y.context,Y,_,y.stencilModeForClipping(rt),w,Yi.disabled,de,pt,o.id,Ge.layoutVertexBuffer,xe,fe,o.paint,y.transform.zoom,ot)}}function Ws(y,t,o,p,_,w,I){const P=y.context,L=P.gl,O="fill-extrusion-pattern",V=o.paint.get(O),$=V.constantOr(1),Y=o.getCrossfadeParameters(),ge=o.paint.get("fill-extrusion-opacity"),de=V.constantOr(null);for(const xe of p){const fe=t.getTile(xe),Ve=fe.getBucket(o);if(!Ve)continue;const rt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(xe),Ae=Ve.programConfigurations.get(o.id),Ge=y.useProgram($?"fillExtrusionPattern":"fillExtrusion",Ae);$&&(y.context.activeTexture.set(L.TEXTURE0),fe.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ae.updatePaintBuffers(Y)),pl(Ae,O,de,fe,o);const ot=y.translatePosMatrix(xe.posMatrix,fe,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),lt=o.paint.get("fill-extrusion-vertical-gradient"),pt=$?Sc(ot,y,lt,ge,xe,Y,fe):zn(ot,y,lt,ge);Ge.draw(P,P.gl.TRIANGLES,_,w,I,Yi.backCCW,pt,rt,o.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,o.paint,y.transform.zoom,Ae,y.style.map.terrain&&Ve.centroidVertexBuffer)}}function ml(y,t,o,p,_,w,I){const P=y.context,L=P.gl,O=o.fbo;if(!O)return;const V=y.useProgram("hillshade"),$=y.style.map.terrain&&y.style.map.terrain.getTerrainData(t);P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,O.colorAttachment.get()),V.draw(P,L.TRIANGLES,_,w,I,Yi.disabled,((Y,ge,de,xe)=>{const fe=de.paint.get("hillshade-shadow-color"),Ve=de.paint.get("hillshade-highlight-color"),rt=de.paint.get("hillshade-accent-color");let Ae=de.paint.get("hillshade-illumination-direction")*(Math.PI/180);de.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ae-=Y.transform.angle);const Ge=!Y.options.moving;return{u_matrix:xe?xe.posMatrix:Y.transform.calculatePosMatrix(ge.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:rh(0,ge.tileID),u_light:[de.paint.get("hillshade-exaggeration"),Ae],u_shadow:fe,u_highlight:Ve,u_accent:rt}})(y,o,p,$?t:null),$,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function dh(y,t,o,p,_,w){const I=y.context,P=I.gl,L=t.dem;if(L&&L.data){const O=L.dim,V=L.stride,$=L.getPixels();if(I.activeTexture.set(P.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||y.getTileTexture(V),t.demTexture){const ge=t.demTexture;ge.update($,{premultiply:!1}),ge.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else t.demTexture=new ye(I,$,P.RGBA,{premultiply:!1}),t.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);I.activeTexture.set(P.TEXTURE0);let Y=t.fbo;if(!Y){const ge=new ye(I,{width:O,height:O,data:null},P.RGBA);ge.bind(P.LINEAR,P.CLAMP_TO_EDGE),Y=t.fbo=I.createFramebuffer(O,O,!0,!1),Y.colorAttachment.set(ge.texture)}I.bindFramebuffer.set(Y.framebuffer),I.viewport.set([0,0,O,O]),y.useProgram("hillshadePrepare").draw(I,P.TRIANGLES,p,_,w,Yi.disabled,((ge,de)=>{const xe=de.stride,fe=n.create();return n.ortho(fe,0,n.EXTENT,-n.EXTENT,0,0,1),n.translate(fe,fe,[0,-n.EXTENT,0]),{u_matrix:fe,u_image:1,u_dimension:[xe,xe],u_zoom:ge.overscaledZ,u_unpack:de.getUnpackVector()}})(t.tileID,L),null,o.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function gl(y,t,o,p,_,w){const I=p.paint.get("raster-fade-duration");if(!w&&I>0){const P=n.browser.now(),L=(P-y.timeAdded)/I,O=t?(P-t.timeAdded)/I:-1,V=o.getSource(),$=_.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),Y=!t||Math.abs(t.tileID.overscaledZ-$)>Math.abs(y.tileID.overscaledZ-$),ge=Y&&y.refreshedUponExpiration?1:n.clamp(Y?L:1-O,0,1);return y.refreshedUponExpiration&&L>=1&&(y.refreshedUponExpiration=!1),t?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}const ph=new n.Color(1,0,0,1),Bc=new n.Color(0,1,0,1),yo=new n.Color(0,0,1,1),_l=new n.Color(1,0,1,1),Oc=new n.Color(0,1,1,1);function yl(y,t,o,p){Ks(y,0,t+o/2,y.transform.width,o,p)}function ba(y,t,o,p){Ks(y,t-o/2,0,o,y.transform.height,p)}function Ks(y,t,o,p,_,w){const I=y.context,P=I.gl;P.enable(P.SCISSOR_TEST),P.scissor(t*y.pixelRatio,o*y.pixelRatio,p*y.pixelRatio,_*y.pixelRatio),I.clear({color:w}),P.disable(P.SCISSOR_TEST)}function mh(y,t,o){const p=y.context,_=p.gl,w=o.posMatrix,I=y.useProgram("debug"),P=Li.disabled,L=Hi.disabled,O=y.colorModeForRenderPass(),V="$debug",$=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);p.activeTexture.set(_.TEXTURE0);const Y=t.getTileByID(o.key).latestRawTileData,ge=Math.floor((Y&&Y.byteLength||0)/1024),de=t.getTile(o).tileSize,xe=512/Math.min(de,512)*(o.overscaledZ/y.transform.zoom)*.5;let fe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(fe+=` => ${o.overscaledZ}`),function(Ve,rt){Ve.initDebugOverlayCanvas();const Ae=Ve.debugOverlayCanvas,Ge=Ve.context.gl,ot=Ve.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,Ae.width,Ae.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(rt,5,5),ot.strokeText(rt,5,5),Ve.debugOverlayTexture.update(Ae),Ve.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(y,`${fe} ${ge}kB`),I.draw(p,_.TRIANGLES,P,L,mi.alphaBlended,Yi.disabled,Qa(w,n.Color.transparent,xe),null,V,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),I.draw(p,_.LINE_STRIP,P,L,O,Yi.disabled,Qa(w,n.Color.red),$,V,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function vl(y,t,o){const p=y.context,_=p.gl,w=y.colorModeForRenderPass(),I=new Li(_.LEQUAL,Li.ReadWrite,y.depthRangeFor3D),P=y.useProgram("terrain"),L=t.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const O of o){const V=y.renderToTexture.getTexture(O),$=t.getTerrainData(O.tileID);p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,V.texture);const Y={u_matrix:y.transform.calculatePosMatrix(O.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(y.transform.zoom)};P.draw(p,_.TRIANGLES,I,Hi.disabled,w,Yi.backCCW,Y,$,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}class ur{constructor(t,o){this.context=new uo(t),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:n.create(),renderTime:0},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Kr}resize(t,o,p){if(this.width=Math.floor(t*p),this.height=Math.floor(o*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const t=this.context,o=new n.PosArray;o.emplaceBack(0,0),o.emplaceBack(n.EXTENT,0),o.emplaceBack(0,n.EXTENT),o.emplaceBack(n.EXTENT,n.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(o,Mr.members),this.tileExtentSegments=n.SegmentVector.simpleSegment(0,0,4,2);const p=new n.PosArray;p.emplaceBack(0,0),p.emplaceBack(n.EXTENT,0),p.emplaceBack(0,n.EXTENT),p.emplaceBack(n.EXTENT,n.EXTENT),this.debugBuffer=t.createVertexBuffer(p,Mr.members),this.debugSegments=n.SegmentVector.simpleSegment(0,0,4,5);const _=new n.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(n.EXTENT,0,n.EXTENT,0),_.emplaceBack(0,n.EXTENT,0,n.EXTENT),_.emplaceBack(n.EXTENT,n.EXTENT,n.EXTENT,n.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(_,It.members),this.rasterBoundsSegments=n.SegmentVector.simpleSegment(0,0,4,2);const w=new n.PosArray;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,Mr.members),this.viewportSegments=n.SegmentVector.simpleSegment(0,0,4,2);const I=new n.LineStripIndexArray;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(I);const P=new n.TriangleIndexArray;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(P);const L=this.context.gl;this.stencilClearMode=new Hi({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const t=this.context,o=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=n.create();n.ortho(p,0,this.width,this.height,0,0,1),n.scale(p,p,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,o.TRIANGLES,Li.disabled,this.stencilClearMode,mi.disabled,Yi.disabled,ga(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,o){if(this.currentStencilSource===t.source||!t.isTileClipped()||!o||!o.length)return;this.currentStencilSource=t.source;const p=this.context,_=p.gl;this.nextStencilID+o.length>256&&this.clearStencil(),p.setColorMode(mi.disabled),p.setDepthMode(Li.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of o){const P=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);w.draw(p,_.TRIANGLES,Li.disabled,new Hi({func:_.ALWAYS,mask:0},P,255,_.KEEP,_.KEEP,_.REPLACE),mi.disabled,Yi.disabled,ga(I.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new Hi({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){const o=this.context.gl;return new Hi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,p=t.sort((I,P)=>P.overscaledZ-I.overscaledZ),_=p[p.length-1].overscaledZ,w=p[0].overscaledZ-_+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const I={};for(let P=0;P<w;P++)I[P+_]=new Hi({func:o.GEQUAL,mask:255},P+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=w,[I,p]}return[{[_]:Hi.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new mi([t.CONSTANT_COLOR,t.ONE],new n.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mi.unblended:mi.alphaBlended}depthModeForSublayer(t,o,p){if(!this.opaquePassEnabledForLayer())return Li.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Li(p||this.context.gl.LEQUAL,o,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,o){this.style=t,this.options=o,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.browser.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,w={},I={},P={};for(const L in _){const O=_[L];O.used&&O.prepare(this.context),w[L]=O.getVisibleCoordinates(),I[L]=w[L].slice().reverse(),P[L]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<p.length;L++)if(this.style._layers[p[L]].is3D()){this.opaquePassCutoff=L;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const L=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!n.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||L.length)&&(n.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(O,V){const $=O.context,Y=$.gl,ge=mi.unblended,de=new Li(Y.LEQUAL,Li.ReadWrite,[0,1]),xe=V.getTerrainMesh(),fe=V.sourceCache.getRenderableTiles(),Ve=O.useProgram("terrainDepth");$.bindFramebuffer.set(V.getFramebuffer("depth").framebuffer),$.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),$.clear({color:n.Color.transparent,depth:1});for(const rt of fe){const Ae=V.getTerrainData(rt.tileID),Ge={u_matrix:O.transform.calculatePosMatrix(rt.tileID.toUnwrapped()),u_ele_delta:V.getMeshFrameDelta(O.transform.zoom)};Ve.draw($,Y.TRIANGLES,de,Hi.disabled,ge,Yi.backCCW,Ge,Ae,"terrain",xe.vertexBuffer,xe.indexBuffer,xe.segments)}$.bindFramebuffer.set(null),$.viewport.set([0,0,O.width,O.height])}(this,this.style.map.terrain),function(O,V){const $=O.context,Y=$.gl,ge=mi.unblended,de=new Li(Y.LEQUAL,Li.ReadWrite,[0,1]),xe=V.getTerrainMesh(),fe=V.getCoordsTexture(),Ve=V.sourceCache.getRenderableTiles(),rt=O.useProgram("terrainCoords");$.bindFramebuffer.set(V.getFramebuffer("coords").framebuffer),$.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),$.clear({color:n.Color.transparent,depth:1}),V.coordsIndex=[];for(const Ae of Ve){const Ge=V.getTerrainData(Ae.tileID);$.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,fe.texture);const ot={u_matrix:O.transform.calculatePosMatrix(Ae.tileID.toUnwrapped()),u_terrain_coords_id:(255-V.coordsIndex.length)/255,u_texture:0,u_ele_delta:V.getMeshFrameDelta(O.transform.zoom)};rt.draw($,Y.TRIANGLES,de,Hi.disabled,ge,Yi.backCCW,ot,Ge,"terrain",xe.vertexBuffer,xe.indexBuffer,xe.segments),V.coordsIndex.push(Ae.tileID.key)}$.bindFramebuffer.set(null),$.viewport.set([0,0,O.width,O.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const L of p){const O=this.style._layers[L];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const V=I[O.source];(O.type==="custom"||V.length)&&this.renderLayer(this,_[O.source],O,V)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?n.Color.black:n.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[p[this.currentLayer]],O=_[L.source],V=w[L.source];this._renderTileClippingMasks(L,V),this.renderLayer(this,O,L,V)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const L=this.style._layers[p[this.currentLayer]],O=_[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L))continue;const V=(L.type==="symbol"?P:I)[L.source];this._renderTileClippingMasks(L,w[L.source]),this.renderLayer(this,O,L,V)}if(this.options.showTileBoundaries){const L=function(O,V){let $=null;const Y=Object.values(O._layers).flatMap(fe=>fe.source&&!fe.isHidden(V)?[O.sourceCaches[fe.source]]:[]),ge=Y.filter(fe=>fe.getSource().type==="vector"),de=Y.filter(fe=>fe.getSource().type!=="vector"),xe=fe=>{(!$||$.getSource().maxzoom<fe.getSource().maxzoom)&&($=fe)};return ge.forEach(fe=>xe(fe)),$||de.forEach(fe=>xe(fe)),$}(this.style,this.transform.zoom);L&&function(O,V,$){for(let Y=0;Y<$.length;Y++)mh(O,V,$[Y])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const O=L.transform.padding;yl(L,L.transform.height-(O.top||0),3,ph),yl(L,O.bottom||0,3,Bc),ba(L,O.left||0,3,yo),ba(L,L.transform.width-(O.right||0),3,_l);const V=L.transform.centerPoint;(function($,Y,ge,de){Ks($,Y-1,ge-10,2,20,de),Ks($,Y-10,ge-1,20,2,de)})(L,V.x,L.transform.height-V.y,Oc)}(this),this.context.setDefault()}renderLayer(t,o,p,_){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(_||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(w,I,P,L,O){if(w.renderPass!=="translucent")return;const V=Hi.disabled,$=w.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Y,ge,de,xe,fe,Ve,rt){const Ae=ge.transform,Ge=fe==="map",ot=Ve==="map";for(const lt of Y){const pt=xe.getTile(lt),St=pt.getBucket(de);if(!St||!St.text||!St.text.segments.get().length)continue;const wt=n.evaluateSizeForZoom(St.textSizeData,Ae.zoom),Pt=qe(pt,1,ge.transform.zoom),Wt=qr(lt.posMatrix,ot,Ge,ge.transform,Pt),zi=de.layout.get("icon-text-fit")!=="none"&&St.hasIconData();if(wt){const Lt=Math.pow(2,Ae.zoom-pt.tileID.overscaledZ);po(St,Ge,ot,rt,Ae,Wt,lt.posMatrix,Lt,wt,zi,ge.style.map.terrain?(fi,Xt)=>ge.style.map.terrain.getElevation(lt,fi,Xt):null)}}}(L,w,P,I,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),O),P.paint.get("icon-opacity").constantOr(1)!==0&&go(w,I,P,L,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),V,$),P.paint.get("text-opacity").constantOr(1)!==0&&go(w,I,P,L,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),V,$),I.map.showCollisionBoxes&&(fl(w,I,P,L,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),!0),fl(w,I,P,L,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),!1))})(t,o,p,_,this.style.placement.variableOffsets);break;case"circle":(function(w,I,P,L){if(w.renderPass!=="translucent")return;const O=P.paint.get("circle-opacity"),V=P.paint.get("circle-stroke-width"),$=P.paint.get("circle-stroke-opacity"),Y=!P.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&(V.constantOr(1)===0||$.constantOr(1)===0))return;const ge=w.context,de=ge.gl,xe=w.depthModeForSublayer(0,Li.ReadOnly),fe=Hi.disabled,Ve=w.colorModeForRenderPass(),rt=[];for(let Ae=0;Ae<L.length;Ae++){const Ge=L[Ae],ot=I.getTile(Ge),lt=ot.getBucket(P);if(!lt)continue;const pt=lt.programConfigurations.get(P.id),St=w.useProgram("circle",pt),wt=lt.layoutVertexBuffer,Pt=lt.indexBuffer,Wt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ge),zi={programConfiguration:pt,program:St,layoutVertexBuffer:wt,indexBuffer:Pt,uniformValues:Ya(w,Ge,ot,P),terrainData:Wt};if(Y){const Lt=lt.segments.get();for(const fi of Lt)rt.push({segments:new n.SegmentVector([fi]),sortKey:fi.sortKey,state:zi})}else rt.push({segments:lt.segments,sortKey:0,state:zi})}Y&&rt.sort((Ae,Ge)=>Ae.sortKey-Ge.sortKey);for(const Ae of rt){const{programConfiguration:Ge,program:ot,layoutVertexBuffer:lt,indexBuffer:pt,uniformValues:St,terrainData:wt}=Ae.state;ot.draw(ge,de.TRIANGLES,xe,fe,Ve,Yi.disabled,St,wt,P.id,lt,pt,Ae.segments,P.paint,w.transform.zoom,Ge)}})(t,o,p,_);break;case"heatmap":(function(w,I,P,L){if(P.paint.get("heatmap-opacity")!==0)if(w.renderPass==="offscreen"){const O=w.context,V=O.gl,$=Hi.disabled,Y=new mi([V.ONE,V.ONE],n.Color.transparent,[!0,!0,!0,!0]);(function(ge,de,xe){const fe=ge.gl;ge.activeTexture.set(fe.TEXTURE1),ge.viewport.set([0,0,de.width/4,de.height/4]);let Ve=xe.heatmapFbo;if(Ve)fe.bindTexture(fe.TEXTURE_2D,Ve.colorAttachment.get()),ge.bindFramebuffer.set(Ve.framebuffer);else{const rt=fe.createTexture();fe.bindTexture(fe.TEXTURE_2D,rt),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MAG_FILTER,fe.LINEAR),Ve=xe.heatmapFbo=ge.createFramebuffer(de.width/4,de.height/4,!1,!1),function(Ae,Ge,ot,lt){var pt,St;const wt=Ae.gl,Pt=(pt=Ae.HALF_FLOAT)!==null&&pt!==void 0?pt:wt.UNSIGNED_BYTE,Wt=(St=Ae.RGBA16F)!==null&&St!==void 0?St:wt.RGBA;wt.texImage2D(wt.TEXTURE_2D,0,Wt,Ge.width/4,Ge.height/4,0,wt.RGBA,Pt,null),lt.colorAttachment.set(ot)}(ge,de,rt,Ve)}})(O,w,P),O.clear({color:n.Color.transparent});for(let ge=0;ge<L.length;ge++){const de=L[ge];if(I.hasRenderableParent(de))continue;const xe=I.getTile(de),fe=xe.getBucket(P);if(!fe)continue;const Ve=fe.programConfigurations.get(P.id),rt=w.useProgram("heatmap",Ve),{zoom:Ae}=w.transform;rt.draw(O,V.TRIANGLES,Li.disabled,$,Y,Yi.disabled,ih(de.posMatrix,xe,Ae,P.paint.get("heatmap-intensity")),null,P.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,P.paint,w.transform.zoom,Ve)}O.viewport.set([0,0,w.width,w.height])}else w.renderPass==="translucent"&&(w.context.setColorMode(w.colorModeForRenderPass()),function(O,V){const $=O.context,Y=$.gl,ge=V.heatmapFbo;if(!ge)return;$.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,ge.colorAttachment.get()),$.activeTexture.set(Y.TEXTURE1);let de=V.colorRampTexture;de||(de=V.colorRampTexture=new ye($,V.colorRamp,Y.RGBA)),de.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw($,Y.TRIANGLES,Li.disabled,Hi.disabled,O.colorModeForRenderPass(),Yi.disabled,((xe,fe,Ve,rt)=>{const Ae=n.create();n.ortho(Ae,0,xe.width,xe.height,0,0,1);const Ge=xe.context.gl;return{u_matrix:Ae,u_world:[Ge.drawingBufferWidth,Ge.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:fe.paint.get("heatmap-opacity")}})(O,V),null,V.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,V.paint,O.transform.zoom)}(w,P))})(t,o,p,_);break;case"line":(function(w,I,P,L){if(w.renderPass!=="translucent")return;const O=P.paint.get("line-opacity"),V=P.paint.get("line-width");if(O.constantOr(1)===0||V.constantOr(1)===0)return;const $=w.depthModeForSublayer(0,Li.ReadOnly),Y=w.colorModeForRenderPass(),ge=P.paint.get("line-dasharray"),de=P.paint.get("line-pattern"),xe=de.constantOr(1),fe=P.paint.get("line-gradient"),Ve=P.getCrossfadeParameters(),rt=xe?"linePattern":ge?"lineSDF":fe?"lineGradient":"line",Ae=w.context,Ge=Ae.gl;let ot=!0;for(const lt of L){const pt=I.getTile(lt);if(xe&&!pt.patternsLoaded())continue;const St=pt.getBucket(P);if(!St)continue;const wt=St.programConfigurations.get(P.id),Pt=w.context.program.get(),Wt=w.useProgram(rt,wt),zi=ot||Wt.program!==Pt,Lt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(lt),fi=de.constantOr(null);if(fi&&pt.imageAtlas){const wi=pt.imageAtlas,Ei=wi.patternPositions[fi.to.toString()],Mi=wi.patternPositions[fi.from.toString()];Ei&&Mi&&wt.setConstantPatternPositions(Ei,Mi)}const Xt=Lt?lt:null,tr=xe?Cc(w,pt,P,Ve,Xt):ge?sh(w,pt,P,ge,Ve,Xt):fe?nh(w,pt,P,St.lineClipsArray.length,Xt):_a(w,pt,P,Xt);if(xe)Ae.activeTexture.set(Ge.TEXTURE0),pt.imageAtlasTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE),wt.updatePaintBuffers(Ve);else if(ge&&(zi||w.lineAtlas.dirty))Ae.activeTexture.set(Ge.TEXTURE0),w.lineAtlas.bind(Ae);else if(fe){const wi=St.gradients[P.id];let Ei=wi.texture;if(P.gradientVersion!==wi.version){let Mi=256;if(P.stepInterpolant){const mr=I.getSource().maxzoom,Wi=lt.canonical.z===mr?Math.ceil(1<<w.transform.maxZoom-lt.canonical.z):1;Mi=n.clamp(n.nextPowerOfTwo(St.maxLineLength/n.EXTENT*1024*Wi),256,Ae.maxTextureSize)}wi.gradient=n.renderColorRamp({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:Mi,image:wi.gradient||void 0,clips:St.lineClipsArray}),wi.texture?wi.texture.update(wi.gradient):wi.texture=new ye(Ae,wi.gradient,Ge.RGBA),wi.version=P.gradientVersion,Ei=wi.texture}Ae.activeTexture.set(Ge.TEXTURE0),Ei.bind(P.stepInterpolant?Ge.NEAREST:Ge.LINEAR,Ge.CLAMP_TO_EDGE)}Wt.draw(Ae,Ge.TRIANGLES,$,w.stencilModeForClipping(lt),Y,Yi.disabled,tr,Lt,P.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,P.paint,w.transform.zoom,wt,St.layoutVertexBuffer2),ot=!1}})(t,o,p,_);break;case"fill":(function(w,I,P,L){const O=P.paint.get("fill-color"),V=P.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const $=w.colorModeForRenderPass(),Y=P.paint.get("fill-pattern"),ge=w.opaquePassEnabledForLayer()&&!Y.constantOr(1)&&O.constantOr(n.Color.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===ge){const de=w.depthModeForSublayer(1,w.renderPass==="opaque"?Li.ReadWrite:Li.ReadOnly);va(w,I,P,L,de,$,!1)}if(w.renderPass==="translucent"&&P.paint.get("fill-antialias")){const de=w.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Li.ReadOnly);va(w,I,P,L,de,$,!0)}})(t,o,p,_);break;case"fill-extrusion":(function(w,I,P,L){const O=P.paint.get("fill-extrusion-opacity");if(O!==0&&w.renderPass==="translucent"){const V=new Li(w.context.gl.LEQUAL,Li.ReadWrite,w.depthRangeFor3D);if(O!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Ws(w,I,P,L,V,Hi.disabled,mi.disabled),Ws(w,I,P,L,V,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const $=w.colorModeForRenderPass();Ws(w,I,P,L,V,Hi.disabled,$)}}})(t,o,p,_);break;case"hillshade":(function(w,I,P,L){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const O=w.context,V=w.depthModeForSublayer(0,Li.ReadOnly),$=w.colorModeForRenderPass(),[Y,ge]=w.renderPass==="translucent"?w.stencilConfigForOverlap(L):[{},L];for(const de of ge){const xe=I.getTile(de);xe.needsHillshadePrepare!==void 0&&xe.needsHillshadePrepare&&w.renderPass==="offscreen"?dh(w,xe,P,V,Hi.disabled,$):w.renderPass==="translucent"&&ml(w,de,xe,P,V,Y[de.overscaledZ],$)}O.viewport.set([0,0,w.width,w.height])})(t,o,p,_);break;case"raster":(function(w,I,P,L){if(w.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!L.length)return;const O=w.context,V=O.gl,$=I.getSource(),Y=w.useProgram("raster"),ge=w.colorModeForRenderPass(),[de,xe]=$ instanceof Bt?[{},L]:w.stencilConfigForOverlap(L),fe=xe[xe.length-1].overscaledZ,Ve=!w.options.moving;for(const rt of xe){const Ae=w.depthModeForSublayer(rt.overscaledZ-fe,P.paint.get("raster-opacity")===1?Li.ReadWrite:Li.ReadOnly,V.LESS),Ge=I.getTile(rt);Ge.registerFadeDuration(P.paint.get("raster-fade-duration"));const ot=I.findLoadedParent(rt,0),lt=gl(Ge,ot,I,P,w.transform,w.style.map.terrain);let pt,St;const wt=P.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;O.activeTexture.set(V.TEXTURE0),Ge.texture.bind(wt,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),O.activeTexture.set(V.TEXTURE1),ot?(ot.texture.bind(wt,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),pt=Math.pow(2,ot.tileID.overscaledZ-Ge.tileID.overscaledZ),St=[Ge.tileID.canonical.x*pt%1,Ge.tileID.canonical.y*pt%1]):Ge.texture.bind(wt,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const Pt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(rt),Wt=Pt?rt:null,zi=Wt?Wt.posMatrix:w.transform.calculatePosMatrix(rt.toUnwrapped(),Ve),Lt=Qo(zi,St||[0,0],pt||1,lt,P);$ instanceof Bt?Y.draw(O,V.TRIANGLES,Ae,Hi.disabled,ge,Yi.disabled,Lt,Pt,P.id,$.boundsBuffer,w.quadTriangleIndexBuffer,$.boundsSegments):Y.draw(O,V.TRIANGLES,Ae,de[rt.overscaledZ],ge,Yi.disabled,Lt,Pt,P.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}})(t,o,p,_);break;case"background":(function(w,I,P,L){const O=P.paint.get("background-color"),V=P.paint.get("background-opacity");if(V===0)return;const $=w.context,Y=$.gl,ge=w.transform,de=ge.tileSize,xe=P.paint.get("background-pattern");if(w.isPatternMissing(xe))return;const fe=!xe&&O.a===1&&V===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==fe)return;const Ve=Hi.disabled,rt=w.depthModeForSublayer(0,fe==="opaque"?Li.ReadWrite:Li.ReadOnly),Ae=w.colorModeForRenderPass(),Ge=w.useProgram(xe?"backgroundPattern":"background"),ot=L||ge.coveringTiles({tileSize:de,terrain:w.style.map.terrain});xe&&($.activeTexture.set(Y.TEXTURE0),w.imageManager.bind(w.context));const lt=P.getCrossfadeParameters();for(const pt of ot){const St=L?pt.posMatrix:w.transform.calculatePosMatrix(pt.toUnwrapped()),wt=xe?eo(St,V,w,xe,{tileID:pt,tileSize:de},lt):Is(St,V,O),Pt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(pt);Ge.draw($,Y.TRIANGLES,rt,Ve,Ae,Yi.disabled,wt,Pt,P.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}})(t,0,p,_);break;case"custom":(function(w,I,P){const L=w.context,O=P.implementation;if(w.renderPass==="offscreen"){const V=O.prerender;V&&(w.setCustomLayerDefaults(),L.setColorMode(w.colorModeForRenderPass()),V.call(O,L.gl,w.transform.customLayerMatrix()),L.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),L.setColorMode(w.colorModeForRenderPass()),L.setStencilMode(Hi.disabled);const V=O.renderingMode==="3d"?new Li(w.context.gl.LEQUAL,Li.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,Li.ReadOnly);L.setDepthMode(V),O.render(L.gl,w.transform.customLayerMatrix()),L.setDirty(),w.setBaseState(),L.bindFramebuffer.set(null)}})(t,0,p)}}translatePosMatrix(t,o,p,_,w){if(!p[0]&&!p[1])return t;const I=w?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(I){const O=Math.sin(I),V=Math.cos(I);p=[p[0]*V-p[1]*O,p[0]*O+p[1]*V]}const P=[w?p[0]:qe(o,p[0],this.transform.zoom),w?p[1]:qe(o,p[1],this.transform.zoom),0],L=new Float32Array(16);return n.translate(L,t,P),L}saveTileTexture(t){const o=this._tileTextures[t.size[0]];o?o.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const o=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!o||!p}useProgram(t,o){this.cache=this.cache||{};const p=t+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new pr(this.context,_n[t],o,Mn[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ye(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:o}=this.context.gl;return this.width!==t||this.height!==o}}class ns{constructor(t,o){this.points=t,this.planes=o}static fromInvProjectionMatrix(t,o,p){const _=Math.pow(2,p),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const L=1/(P=n.transformMat4([],P,t))[3]/o*_;return n.mul$1(P,P,[L,L,1/P[3],L])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const L=function(Y,ge){var de=ge[0],xe=ge[1],fe=ge[2],Ve=de*de+xe*xe+fe*fe;return Ve>0&&(Ve=1/Math.sqrt(Ve)),Y[0]=ge[0]*Ve,Y[1]=ge[1]*Ve,Y[2]=ge[2]*Ve,Y}([],function(Y,ge,de){var xe=ge[0],fe=ge[1],Ve=ge[2],rt=de[0],Ae=de[1],Ge=de[2];return Y[0]=fe*Ge-Ve*Ae,Y[1]=Ve*rt-xe*Ge,Y[2]=xe*Ae-fe*rt,Y}([],ne([],w[P[0]],w[P[1]]),ne([],w[P[2]],w[P[1]]))),O=-((V=L)[0]*($=w[P[1]])[0]+V[1]*$[1]+V[2]*$[2]);var V,$;return L.concat(O)});return new ns(w,I)}}class Jr{constructor(t,o){this.min=t,this.max=o,this.center=function(p,_,w){return p[0]=.5*_[0],p[1]=.5*_[1],p[2]=.5*_[2],p}([],function(p,_,w){return p[0]=_[0]+w[0],p[1]=_[1]+w[1],p[2]=_[2]+w[2],p}([],this.min,this.max))}quadrant(t){const o=[t%2==0,t<2],p=ee(this.min),_=ee(this.max);for(let w=0;w<o.length;w++)p[w]=o[w]?this.min[w]:this.center[w],_[w]=o[w]?this.center[w]:this.max[w];return _[2]=this.max[2],new Jr(p,_)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<t.planes.length;_++){const w=t.planes[_];let I=0;for(let P=0;P<o.length;P++)n.dot(w,o[P])>=0&&I++;if(I===0)return 0;I!==o.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let w=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let P=0;P<t.points.length;P++){const L=t.points[P][_]-this.min[_];w=Math.min(w,L),I=Math.max(I,L)}if(I<0||w>this.max[_]-this.min[_])return 0}return 1}}class wa{constructor(t=0,o=0,p=0,_=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=p,this.right=_}interpolate(t,o,p){return o.top!=null&&t.top!=null&&(this.top=n.interpolate.number(t.top,o.top,p)),o.bottom!=null&&t.bottom!=null&&(this.bottom=n.interpolate.number(t.bottom,o.bottom,p)),o.left!=null&&t.left!=null&&(this.left=n.interpolate.number(t.left,o.left,p)),o.right!=null&&t.right!=null&&(this.right=n.interpolate.number(t.right,o.right,p)),this}getCenter(t,o){const p=n.clamp((this.left+t-this.right)/2,0,t),_=n.clamp((this.top+o-this.bottom)/2,0,o);return new n.Point(p,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class xa{constructor(t,o,p,_,w){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=w===void 0||!!w,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new n.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wa,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new xa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const o=-n.wrap(t,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var p=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,_,w){var I=_[0],P=_[1],L=_[2],O=_[3],V=Math.sin(w),$=Math.cos(w);p[0]=I*$+L*V,p[1]=P*$+O*V,p[2]=I*-V+L*$,p[3]=P*-V+O*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=n.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,p){this._unmodified=!1,this._edgeInsets.interpolate(t,o,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new n.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const p=this.pointCoordinate(new n.Point(0,0)),_=this.pointCoordinate(new n.Point(this.width,0)),w=this.pointCoordinate(new n.Point(this.width,this.height)),I=this.pointCoordinate(new n.Point(0,this.height)),P=Math.floor(Math.min(p.x,_.x,w.x,I.x)),L=Math.floor(Math.max(p.x,_.x,w.x,I.x)),O=1;for(let V=P-O;V<=L+O;V++)V!==0&&o.push(new n.UnwrappedTileID(V,t))}return o}coveringTiles(t){var o,p;let _=this.coveringZoomLevel(t);const w=_;if(t.minzoom!==void 0&&_<t.minzoom)return[];t.maxzoom!==void 0&&_>t.maxzoom&&(_=t.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),P=n.MercatorCoordinate.fromLngLat(this.center),L=Math.pow(2,_),O=[L*I.x,L*I.y,0],V=[L*P.x,L*P.y,0],$=ns.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let Y=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Y=_);const ge=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,de=Ae=>({aabb:new Jr([Ae*L,0,0],[(Ae+1)*L,L,0]),zoom:0,x:0,y:0,wrap:Ae,fullyVisible:!1}),xe=[],fe=[],Ve=_,rt=t.reparseOverscaled?w:_;if(this._renderWorldCopies)for(let Ae=1;Ae<=3;Ae++)xe.push(de(-Ae)),xe.push(de(Ae));for(xe.push(de(0));xe.length>0;){const Ae=xe.pop(),Ge=Ae.x,ot=Ae.y;let lt=Ae.fullyVisible;if(!lt){const Wt=Ae.aabb.intersects($);if(Wt===0)continue;lt=Wt===2}const pt=t.terrain?O:V,St=Ae.aabb.distanceX(pt),wt=Ae.aabb.distanceY(pt),Pt=Math.max(Math.abs(St),Math.abs(wt));if(Ae.zoom===Ve||Pt>ge+(1<<Ve-Ae.zoom)-2&&Ae.zoom>=Y){const Wt=Ve-Ae.zoom,zi=O[0]-.5-(Ge<<Wt),Lt=O[1]-.5-(ot<<Wt);fe.push({tileID:new n.OverscaledTileID(Ae.zoom===Ve?rt:Ae.zoom,Ae.wrap,Ae.zoom,Ge,ot),distanceSq:se([V[0]-.5-Ge,V[1]-.5-ot]),tileDistanceToCamera:Math.sqrt(zi*zi+Lt*Lt)})}else for(let Wt=0;Wt<4;Wt++){const zi=(Ge<<1)+Wt%2,Lt=(ot<<1)+(Wt>>1),fi=Ae.zoom+1;let Xt=Ae.aabb.quadrant(Wt);if(t.terrain){const tr=new n.OverscaledTileID(fi,Ae.wrap,fi,zi,Lt),wi=t.terrain.getMinMaxElevation(tr),Ei=(o=wi.minElevation)!==null&&o!==void 0?o:this.elevation,Mi=(p=wi.maxElevation)!==null&&p!==void 0?p:this.elevation;Xt=new Jr([Xt.min[0],Xt.min[1],Ei],[Xt.max[0],Xt.max[1],Mi])}xe.push({aabb:Xt,zoom:fi,x:zi,y:Lt,wrap:Ae.wrap,fullyVisible:lt})}}return fe.sort((Ae,Ge)=>Ae.distanceSq-Ge.distanceSq).map(Ae=>Ae.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=n.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new n.Point(n.mercatorXfromLng(t.lng)*this.worldSize,n.mercatorYfromLat(o)*this.worldSize)}unproject(t){return new n.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const o=this.pointLocation(this.centerPoint,t),p=t.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-p))return;const _=this.getCameraPosition(),w=n.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),I=n.MercatorCoordinate.fromLngLat(o,p),P=w.x-I.x,L=w.y-I.y,O=w.z-I.z,V=Math.sqrt(P*P+L*L+O*O),$=this.scaleZoom(this.cameraToCenterDistance/V/this.tileSize);this._elevation=p,this._center=o,this.zoom=$}setLocationAtPoint(t,o){const p=this.pointCoordinate(o),_=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(t),I=new n.MercatorCoordinate(w.x-(p.x-_.x),w.y-(p.y-_.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,o){return o?this.coordinatePoint(this.locationCoordinate(t),o.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,o){return this.coordinateLocation(this.pointCoordinate(t,o))}locationCoordinate(t){return n.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,o){if(o){const Y=o.pointCoordinate(t);if(Y!=null)return Y}const p=[t.x,t.y,0,1],_=[t.x,t.y,1,1];n.transformMat4(p,p,this.pixelMatrixInverse),n.transformMat4(_,_,this.pixelMatrixInverse);const w=p[3],I=_[3],P=p[1]/w,L=_[1]/I,O=p[2]/w,V=_[2]/I,$=O===V?0:(0-O)/(V-O);return new n.MercatorCoordinate(n.interpolate.number(p[0]/w,_[0]/I,$)/this.worldSize,n.interpolate.number(P,L,$)/this.worldSize)}coordinatePoint(t,o=0,p=this.pixelMatrix){const _=[t.x*this.worldSize,t.y*this.worldSize,o,1];return n.transformMat4(_,_,p),new n.Point(_[0]/_[3],_[1]/_[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Re().extend(this.pointLocation(new n.Point(0,t))).extend(this.pointLocation(new n.Point(this.width,t))).extend(this.pointLocation(new n.Point(this.width,this.height))).extend(this.pointLocation(new n.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Re([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,o=!1){const p=t.key,_=o?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const w=t.canonical,I=this.worldSize/this.zoomScale(w.z),P=w.x+Math.pow(2,w.z)*t.wrap,L=n.identity(new Float64Array(16));return n.translate(L,L,[P*I,w.y*I,0]),n.scale(L,L,[I/n.EXTENT,I/n.EXTENT,1]),n.multiply(L,o?this.alignedProjMatrix:this.projMatrix,L),_[p]=new Float32Array(L),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,o,p,_,w=-90,I=90,P=-180,L=180;const O=this.size,V=this._unmodified;if(this.latRange){const ge=this.latRange;w=n.mercatorYfromLat(ge[1])*this.worldSize,I=n.mercatorYfromLat(ge[0])*this.worldSize,t=I-w<O.y?O.y/(I-w):0}if(this.lngRange){const ge=this.lngRange;P=n.wrap(n.mercatorXfromLng(ge[0])*this.worldSize,0,this.worldSize),L=n.wrap(n.mercatorXfromLng(ge[1])*this.worldSize,0,this.worldSize),L<P&&(L+=this.worldSize),o=L-P<O.x?O.x/(L-P):0}const $=this.point,Y=Math.max(o||0,t||0);if(Y)return this.center=this.unproject(new n.Point(o?(L+P)/2:$.x,t?(I+w)/2:$.y)),this.zoom+=this.scaleZoom(Y),this._unmodified=V,void(this._constraining=!1);if(this.latRange){const ge=$.y,de=O.y/2;ge-de<w&&(_=w+de),ge+de>I&&(_=I-de)}if(this.lngRange){const ge=(P+L)/2,de=n.wrap($.x,ge-this.worldSize/2,ge+this.worldSize/2),xe=O.x/2;de-xe<P&&(p=P+xe),de+xe>L&&(p=L-xe)}p===void 0&&_===void 0||(this.center=this.unproject(new n.Point(p!==void 0?p:$.x,_!==void 0?_:$.y)).wrap()),this._unmodified=V,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=n.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=n.identity(new Float64Array(16));n.scale(_,_,[this.width/2,-this.height/2,1]),n.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=n.identity(new Float64Array(16)),n.scale(_,_,[1,-1,1]),n.translate(_,_,[-1,-1,0]),n.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_;const w=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this._minEleveationForCurrentTile),P=w-I*this._pixelPerMeter/Math.cos(this._pitch),L=I<0?P:w,O=Math.PI/2+this._pitch,V=this._fov*(.5+t.y/this.height),$=Math.sin(V)*L/Math.sin(n.clamp(Math.PI-O-V,.01,Math.PI-.01)),Y=this.getHorizon(),ge=2*Math.atan(Y/this.cameraToCenterDistance)*(.5+t.y/(2*Y)),de=Math.sin(ge)*L/Math.sin(n.clamp(Math.PI-O-ge,.01,Math.PI-.01)),xe=Math.min($,de),fe=1.01*(Math.cos(Math.PI/2-this._pitch)*xe+L),Ve=this.height/50;_=new Float64Array(16),n.perspective(_,this._fov,this.width/this.height,Ve,fe),_[8]=2*-t.x/this.width,_[9]=2*t.y/this.height,n.scale(_,_,[1,-1,1]),n.translate(_,_,[0,0,-this.cameraToCenterDistance]),n.rotateX(_,_,this._pitch),n.rotateZ(_,_,this.angle),n.translate(_,_,[-o,-p,0]),this.mercatorMatrix=n.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),n.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=n.multiply(new Float64Array(16),this.labelPlaneMatrix,_),n.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=n.invert([],_),this.pixelMatrix3D=n.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const rt=this.width%2/2,Ae=this.height%2/2,Ge=Math.cos(this.angle),ot=Math.sin(this.angle),lt=o-Math.round(o)+Ge*rt+ot*Ae,pt=p-Math.round(p)+Ge*Ae+ot*rt,St=new Float64Array(_);if(n.translate(St,St,[lt>.5?lt-1:lt,pt>.5?pt-1:pt,0]),this.alignedProjMatrix=St,_=n.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new n.Point(0,0)),o=[t.x*this.worldSize,t.y*this.worldSize,0,1];return n.transformMat4(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.Point(0,t))}getCameraQueryGeometry(t){const o=this.getCameraPoint();if(t.length===1)return[t[0],o];{let p=o.x,_=o.y,w=o.x,I=o.y;for(const P of t)p=Math.min(p,P.x),_=Math.min(_,P.y),w=Math.max(w,P.x),I=Math.max(I,P.y);return[new n.Point(p,_),new n.Point(w,_),new n.Point(w,I),new n.Point(p,I),new n.Point(p,_)]}}}function bl(y,t){let o,p=!1,_=null,w=null;const I=()=>{_=null,p&&(y.apply(w,o),_=setTimeout(I,t),p=!1)};return(...P)=>(p=!0,w=this,o=P,_||I(),_)}class Xs{constructor(t){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let p;return o.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(p=_)}),(p&&p[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:p,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=bl(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const o=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,_),I=Math.round(o.lng*w)/w,P=Math.round(o.lat*w)/w,L=this._map.getBearing(),O=this._map.getPitch();let V="";if(V+=t?`/${I}/${P}/${p}`:`${p}/${P}/${I}`,(L||O)&&(V+="/"+Math.round(10*L)/10),O&&(V+=`/${Math.round(O)}`),this._hashName){const $=this._hashName;let Y=!1;const ge=window.location.hash.slice(1).split("&").map(de=>{const xe=de.split("=")[0];return xe===$?(Y=!0,`${xe}=${V}`):de}).filter(de=>de);return Y||ge.push(`${$}=${V}`),`#${ge.join("&")}`}return`#${V}`}}const ys={linearity:.3,easing:n.bezier(0,0,.3,1)},wl=n.extend({deceleration:2500,maxSpeed:1400},ys),Fc=n.extend({deceleration:20,maxSpeed:1400},ys),Nc=n.extend({deceleration:1e3,maxSpeed:360},ys),Uc=n.extend({deceleration:1e3,maxSpeed:90},ys);class Vc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.browser.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=n.browser.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new n.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)o.zoom+=w.zoomDelta||0,o.bearing+=w.bearingDelta||0,o.pitch+=w.pitchDelta||0,w.panDelta&&o.pan._add(w.panDelta),w.around&&(o.around=w.around),w.pinchAround&&(o.pinchAround=w.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(o.pan.mag()){const w=qn(o.pan.mag(),p,n.extend({},wl,t||{}));_.offset=o.pan.mult(w.amount/o.pan.mag()),_.center=this._map.transform.center,Ea(_,w)}if(o.zoom){const w=qn(o.zoom,p,Fc);_.zoom=this._map.transform.zoom+w.amount,Ea(_,w)}if(o.bearing){const w=qn(o.bearing,p,Nc);_.bearing=this._map.transform.bearing+n.clamp(w.amount,-179,179),Ea(_,w)}if(o.pitch){const w=qn(o.pitch,p,Uc);_.pitch=this._map.transform.pitch+w.amount,Ea(_,w)}if(_.zoom||_.bearing){const w=o.pinchAround===void 0?o.around:o.pinchAround;_.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),n.extend(_,{noMoveStart:!0})}}function Ea(y,t){(!y.duration||y.duration<t.duration)&&(y.duration=t.duration,y.easing=t.easing)}function qn(y,t,o){const{maxSpeed:p,linearity:_,deceleration:w}=o,I=n.clamp(y*_/(t/1e3),-p,p),P=Math.abs(I)/(w*_);return{easing:o.easing,duration:1e3*P,amount:I*(P/2)}}class bn extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p,_={}){const w=v.mousePos(o.getCanvasContainer(),p),I=o.unproject(w);super(t,n.extend({point:w,lngLat:I,originalEvent:p},_)),this._defaultPrevented=!1,this.target=o}}class Sa extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p){const _=t==="touchend"?p.changedTouches:p.touches,w=v.touchPos(o.getCanvasContainer(),_),I=w.map(L=>o.unproject(L)),P=w.reduce((L,O,V,$)=>L.add(O.div($.length)),new n.Point(0,0));super(t,{points:w,point:P,lngLats:I,lngLat:o.unproject(P),originalEvent:p}),this._defaultPrevented=!1}}class $c extends n.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class jc{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new $c(t.type,this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new bn(t.type,this._map,t))}mouseup(t){this._map.fire(new bn(t.type,this._map,t))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new bn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new bn(t.type,this._map,t))}mouseover(t){this._map.fire(new bn(t.type,this._map,t))}mouseout(t){this._map.fire(new bn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Sa(t.type,this._map,t))}touchmove(t){this._map.fire(new Sa(t.type,this._map,t))}touchend(t){this._map.fire(new Sa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Sa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new bn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new bn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Js{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(n.Point.convert(t),this._map.terrain)}}class ka{constructor(t,o){this._map=t,this._tr=new Js(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(v.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const p=o;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=v.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(_.x,p.x),I=Math.max(_.x,p.x),P=Math.min(_.y,p.y),L=Math.max(_.y,p.y);v.setTransform(this._box,`translate(${w}px,${P}px)`),this._box.style.width=I-w+"px",this._box.style.height=L-P+"px"}mouseupWindow(t,o){if(!this._active||t.button!==0)return;const p=this._startPos,_=o;if(this.reset(),v.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new n.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:w=>w.fitScreenCoordinates(p,_,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(v.remove(this._box),this._box=null),v.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new n.Event(t,{originalEvent:o}))}}function vo(y,t){if(y.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${t.length}`);const o={};for(let p=0;p<y.length;p++)o[y[p].identifier]=t[p];return o}class Zn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,o,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const w=new n.Point(0,0);for(const I of _)w._add(I);return w.div(_.length)}(o),this.touches=vo(p,o)))}touchmove(t,o,p){if(this.aborted||!this.centroid)return;const _=vo(p,o);for(const w in this.touches){const I=_[w];(!I||I.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(t,o,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class On{constructor(t){this.singleTap=new Zn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,o,p){this.singleTap.touchstart(t,o,p)}touchmove(t,o,p){this.singleTap.touchmove(t,o,p)}touchend(t,o,p){const _=this.singleTap.touchend(t,o,p);if(_){const w=t.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(_)<30;if(w&&I||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Zc{constructor(t){this._tr=new Js(t),this._zoomIn=new On({numTouches:1,numTaps:2}),this._zoomOut=new On({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,p){this._zoomIn.touchstart(t,o,p),this._zoomOut.touchstart(t,o,p)}touchmove(t,o,p){this._zoomIn.touchmove(t,o,p),this._zoomOut.touchmove(t,o,p)}touchend(t,o,p){const _=this._zoomIn.touchend(t,o,p),w=this._zoomOut.touchend(t,o,p),I=this._tr;return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(_)},{originalEvent:t})}):w?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(w)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const o=this._moveFunction(...t);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(t,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,o){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const _=o.length?o[0]:o;return!this._moved&&_.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_,this._move(p,_))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&v.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ta={0:1,2:2};class xl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const o=v.mouseButton(t);this._eventButton=o}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(o,p){const _=Ta[p];return o.buttons===void 0||(o.buttons&_)!==_}(t,this._eventButton)}isValidEndEvent(t){return v.mouseButton(t)===this._eventButton}}class Gc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const El=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(t){t.preventDefault()}},Sl=({enable:y,clickTolerance:t,bearingDegreesPerPixelMoved:o=.8})=>{const p=new xl({checkCorrectEvent:_=>v.mouseButton(_)===0&&_.ctrlKey||v.mouseButton(_)===2});return new wn({clickTolerance:t,move:(_,w)=>({bearingDelta:(w.x-_.x)*o}),moveStateManager:p,enable:y,assignEvents:El})},Ys=({enable:y,clickTolerance:t,pitchDegreesPerPixelMoved:o=-.5})=>{const p=new xl({checkCorrectEvent:_=>v.mouseButton(_)===0&&_.ctrlKey||v.mouseButton(_)===2});return new wn({clickTolerance:t,move:(_,w)=>({pitchDelta:(w.y-_.y)*o}),moveStateManager:p,enable:y,assignEvents:El})};class vs{constructor(t,o){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new n.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,o,p){return this._calculateTransform(t,o,p)}touchmove(t,o,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,o,p)}touchend(t,o,p){this._calculateTransform(t,o,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,p){p.length>0&&(this._active=!0);const _=vo(p,o),w=new n.Point(0,0),I=new n.Point(0,0);let P=0;for(const O in _){const V=_[O],$=this._touches[O];$&&(w._add(V),I._add(V.sub($)),P++,_[O]=V)}if(this._touches=_,P<this._minTouches||!I.mag())return;const L=I.div(P);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(P),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,o,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,p){if(!this._firstTwoTouches)return;t.preventDefault();const[_,w]=this._firstTwoTouches,I=Ca(p,o,_),P=Ca(p,o,w);if(!I||!P)return;const L=this._aroundCenter?null:I.add(P).div(2);return this._move([I,P],L,t)}touchend(t,o,p){if(!this._firstTwoTouches)return;const[_,w]=this._firstTwoTouches,I=Ca(p,o,_),P=Ca(p,o,w);I&&P||(this._active&&v.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ca(y,t,o){for(let p=0;p<y.length;p++)if(y[p].identifier===o)return t[p]}function Qs(y,t){return Math.log(y/t)/Math.LN2}class Ia extends qt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Qs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qs(this._distance,p),pinchAround:o}}}function kl(y,t){return 180*y.angleWith(t)/Math.PI}class jt extends qt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:kl(this._vector,p),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,p=kl(t,this._startVector);return Math.abs(p)<o}}function Aa(y){return Math.abs(y.y)>Math.abs(y.x)}class gh extends qt{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,o,p){super.touchstart(t,o,p),this._currentTouchCount=p.length}_start(t){this._lastPoints=t,Aa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=t[0].sub(this._lastPoints[0]),w=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,w,p.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(t,o,p){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,w=o.mag()>=2;if(!_&&!w)return;if(!_||!w)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const I=t.y>0==o.y>0;return Aa(t)&&Aa(o)&&I}}const _h={panStep:100,bearingStep:15,pitchStep:10};class Tl{constructor(t){this._tr=new Js(t);const o=_h;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,p=0,_=0,w=0,I=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),w=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),w=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),I=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:P=>{const L=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Hc,zoom:o?Math.round(L.zoom)+o*(t.shiftKey?2:1):L.zoom,bearing:L.bearing+p*this._bearingStep,pitch:L.pitch+_*this._pitchStep,offset:[-w*this._panStep,-I*this._panStep],center:L.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hc(y){return y*(2-y)}const Cl=4.000244140625;class yh{constructor(t,o){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=t,this._tr=new Js(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=n.browser.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,o!==0&&o%Cl==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=v.mousePos(this._el,t),p=this._tr;this._around=n.LngLat.convert(this._aroundCenter?p.center:p.unproject(o)),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Cl?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&L!==0&&(L=1/L);const O=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(O*L))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,p=this._startZoom,_=this._easing;let w,I=!1;if(this._type==="wheel"&&p&&_){const P=Math.min((n.browser.now()-this._lastWheelEventTime)/200,1),L=_(P);w=n.interpolate.number(p,o,L),P<1?this._frameId||(this._frameId=!0):I=!0}else w=o,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:w-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=n.defaultEasing;if(this._prevEase){const p=this._prevEase,_=(n.browser.now()-p.start)/p.duration,w=p.easing(_+.01)-p.easing(_),I=.27/Math.sqrt(w*w+1e-4)*.01,P=Math.sqrt(.0729-I*I);o=n.bezier(I,P,.25,1)}return this._prevEase={start:n.browser.now(),duration:t,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class vh{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Il{constructor(t){this._tr=new Js(t),this.reset()}reset(){this._active=!1}dblclick(t,o){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Al{constructor(){this._tap=new On({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,o,p){if(!this._swipePoint)if(this._tapTime){const _=o[0],w=t.timeStamp-this._tapTime<500,I=this._tapPoint.dist(_)<30;w&&I?p.length>0&&(this._swipePoint=_,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(t,o,p)}touchmove(t,o,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=o[0],w=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(t,o,p)}touchend(t,o,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const _=this._tap.touchend(t,o,p);_&&(this._tapTime=t.timeStamp,this._tapPoint=_)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pl{constructor(t,o,p){this._el=t,this._mousePan=o,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zl{constructor(t,o,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cn{constructor(t,o,p,_){this._el=t,this._touchZoom=o,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fn=y=>y.zoom||y.drag||y.pitch||y.rotate;class Wc extends n.Event{}function Pa(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Ml{constructor(t,o){this.handleWindowEvent=_=>{this.handleEvent(_,`${_.type}Window`)},this.handleEvent=(_,w)=>{if(_.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=_.type==="renderFrame"?void 0:_,P={needsRenderFrame:!1},L={},O={},V=_.touches,$=V?this._getMapTouches(V):void 0,Y=$?v.touchPos(this._el,$):v.mousePos(this._el,_);for(const{handlerName:xe,handler:fe,allowed:Ve}of this._handlers){if(!fe.isEnabled())continue;let rt;this._blockedByActive(O,Ve,xe)?fe.reset():fe[w||_.type]&&(rt=fe[w||_.type](_,Y,$),this.mergeHandlerResult(P,L,rt,xe,I),rt&&rt.needsRenderFrame&&this._triggerRenderFrame()),(rt||fe.isActive())&&(O[xe]=fe)}const ge={};for(const xe in this._previousActiveHandlers)O[xe]||(ge[xe]=I);this._previousActiveHandlers=O,(Object.keys(ge).length||Pa(P))&&(this._changes.push([P,L,ge]),this._triggerRenderFrame()),(Object.keys(O).length||Pa(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:de}=P;de&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],de(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vc(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,w,I]of this._listeners)v.addEventListener(_,w,_===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[t,o,p]of this._listeners)v.removeEventListener(t,o,t===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const o=this._map,p=o.getCanvasContainer();this._add("mapEvent",new jc(o,t));const _=o.boxZoom=new ka(o,t);this._add("boxZoom",_),t.interactive&&t.boxZoom&&_.enable();const w=new Zc(o),I=new Il(o);o.doubleClickZoom=new vh(I,w),this._add("tapZoom",w),this._add("clickZoom",I),t.interactive&&t.doubleClickZoom&&o.doubleClickZoom.enable();const P=new Al;this._add("tapDragZoom",P);const L=o.touchPitch=new gh(o);this._add("touchPitch",L),t.interactive&&t.touchPitch&&o.touchPitch.enable(t.touchPitch);const O=Sl(t),V=Ys(t);o.dragRotate=new zl(t,O,V),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]),t.interactive&&t.dragRotate&&o.dragRotate.enable();const $=(({enable:Ve,clickTolerance:rt})=>{const Ae=new xl({checkCorrectEvent:Ge=>v.mouseButton(Ge)===0&&!Ge.ctrlKey});return new wn({clickTolerance:rt,move:(Ge,ot)=>({around:ot,panDelta:ot.sub(Ge)}),activateOnStart:!0,moveStateManager:Ae,enable:Ve,assignEvents:El})})(t),Y=new vs(t,o);o.dragPan=new Pl(p,$,Y),this._add("mousePan",$),this._add("touchPan",Y,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&o.dragPan.enable(t.dragPan);const ge=new jt,de=new Ia;o.touchZoomRotate=new cn(p,de,ge,P),this._add("touchRotate",ge,["touchPan","touchZoom"]),this._add("touchZoom",de,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&o.touchZoomRotate.enable(t.touchZoomRotate);const xe=o.scrollZoom=new yh(o,()=>this._triggerRenderFrame());this._add("scrollZoom",xe,["mousePan"]),t.interactive&&t.scrollZoom&&o.scrollZoom.enable(t.scrollZoom);const fe=o.keyboard=new Tl(o);this._add("keyboard",fe),t.interactive&&t.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new qc(o))}_add(t,o,p){this._handlers.push({handlerName:t,handler:o,allowed:p}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fn(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,o,p){for(const _ in t)if(_!==p&&(!o||o.indexOf(_)<0))return!0;return!1}_getMapTouches(t){const o=[];for(const p of t)this._el.contains(p.target)&&o.push(p);return o}mergeHandlerResult(t,o,p,_,w){if(!p)return;n.extend(t,p);const I={handlerName:_,originalEvent:p.originalEvent||w};p.zoomDelta!==void 0&&(o.zoom=I),p.panDelta!==void 0&&(o.drag=I),p.pitchDelta!==void 0&&(o.pitch=I),p.bearingDelta!==void 0&&(o.rotate=I)}_applyChanges(){const t={},o={},p={};for(const[_,w,I]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new n.Point(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),n.extend(o,w),n.extend(p,I);this._updateMapTransform(t,o,p),this._changes=[]}_updateMapTransform(t,o,p){const _=this._map,w=_._getTransformForUpdate(),I=_.terrain;if(!(Pa(t)||I&&this._terrainMovement))return this._fireEvents(o,p,!0);let{panDelta:P,zoomDelta:L,bearingDelta:O,pitchDelta:V,around:$,pinchAround:Y}=t;Y!==void 0&&($=Y),_._stop(!0),$=$||_.transform.centerPoint;const ge=w.pointLocation(P?$.sub(P):$);O&&(w.bearing+=O),V&&(w.pitch+=V),L&&(w.zoom+=L),I?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(P)):w.setLocationAtPoint(ge,$):(this._terrainMovement=!0,this._map._elevationFreeze=!0,w.setLocationAtPoint(ge,$),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,w.recalculateZoom(_.terrain)})):w.setLocationAtPoint(ge,$),_._applyUpdatedTransform(w),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,p,!0)}_fireEvents(t,o,p){const _=Fn(this._eventsInProgress),w=Fn(t),I={};for(const V in t){const{originalEvent:$}=t[V];this._eventsInProgress[V]||(I[`${V}start`]=$),this._eventsInProgress[V]=t[V]}!_&&w&&this._fireEvent("movestart",w.originalEvent);for(const V in I)this._fireEvent(V,I[V]);w&&this._fireEvent("move",w.originalEvent);for(const V in t){const{originalEvent:$}=t[V];this._fireEvent(V,$)}const P={};let L;for(const V in this._eventsInProgress){const{handlerName:$,originalEvent:Y}=this._eventsInProgress[V];this._handlersById[$].isActive()||(delete this._eventsInProgress[V],L=o[$]||Y,P[`${V}end`]=L)}for(const V in P)this._fireEvent(V,P[V]);const O=Fn(this._eventsInProgress);if(p&&(_||w)&&!O){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!V||!V.essential&&n.browser.prefersReducedMotion?(this._map.fire(new n.Event("moveend",{originalEvent:L})),$(this._map.getBearing())&&this._map.resetNorth()):($(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:L})),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new n.Event(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Wc("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Dl extends n.Evented{constructor(t,o){super(),this._renderFrameCallback=()=>{const p=Math.min((n.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new n.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,p){return t=n.Point.convert(t).mult(-1),this.panTo(this.transform.center,n.extend({offset:t},o),p)}panTo(t,o,p){return this.easeTo(n.extend({center:t},o),p)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,p){return this.easeTo(n.extend({zoom:t},o),p)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,p){return this.easeTo(n.extend({bearing:t},o),p)}resetNorth(t,o){return this.rotateTo(0,n.extend({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(n.extend({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=Re.convert(t);const p=o&&o.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,o)}_cameraForBoxAndBearing(t,o,p,_){const w={top:0,bottom:0,right:0,left:0};if(typeof(_=n.extend({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const ot=_.padding;_.padding={top:ot,bottom:ot,right:ot,left:ot}}_.padding=n.extend(w,_.padding);const I=this.transform,P=I.padding,L=I.project(n.LngLat.convert(t)),O=I.project(n.LngLat.convert(o)),V=L.rotate(-p*Math.PI/180),$=O.rotate(-p*Math.PI/180),Y=new n.Point(Math.max(V.x,$.x),Math.max(V.y,$.y)),ge=new n.Point(Math.min(V.x,$.x),Math.min(V.y,$.y)),de=Y.sub(ge),xe=(I.width-(P.left+P.right+_.padding.left+_.padding.right))/de.x,fe=(I.height-(P.top+P.bottom+_.padding.top+_.padding.bottom))/de.y;if(fe<0||xe<0)return void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ve=Math.min(I.scaleZoom(I.scale*Math.min(xe,fe)),_.maxZoom),rt=n.Point.convert(_.offset),Ae=new n.Point((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Ge=rt.add(Ae).mult(I.scale/I.zoomScale(Ve));return{center:I.unproject(L.add(O).div(2).sub(Ge)),zoom:Ve,bearing:p}}fitBounds(t,o,p){return this._fitInternal(this.cameraForBounds(t,o),o,p)}fitScreenCoordinates(t,o,p,_,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(n.Point.convert(t)),this.transform.pointLocation(n.Point.convert(o)),p,_),_,w)}_fitInternal(t,o,p){return t?(delete(o=n.extend(t,o)).padding,o.linear?this.easeTo(o,p):this.flyTo(o,p)):this}jumpTo(t,o){this.stop();const p=this._getTransformForUpdate();let _=!1,w=!1,I=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(_=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=n.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(w=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(I=!0,p.pitch=+t.pitch),t.padding==null||p.isPaddingEqual(t.padding)||(p.padding=t.padding),this._applyUpdatedTransform(p),this.fire(new n.Event("movestart",o)).fire(new n.Event("move",o)),_&&this.fire(new n.Event("zoomstart",o)).fire(new n.Event("zoom",o)).fire(new n.Event("zoomend",o)),w&&this.fire(new n.Event("rotatestart",o)).fire(new n.Event("rotate",o)).fire(new n.Event("rotateend",o)),I&&this.fire(new n.Event("pitchstart",o)).fire(new n.Event("pitch",o)).fire(new n.Event("pitchend",o)),this.fire(new n.Event("moveend",o))}calculateCameraOptionsFromTo(t,o,p,_=0){const w=n.MercatorCoordinate.fromLngLat(t,o),I=n.MercatorCoordinate.fromLngLat(p,_),P=I.x-w.x,L=I.y-w.y,O=I.z-w.z,V=Math.hypot(P,L,O);if(V===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(P,L),Y=this.transform.scaleZoom(this.transform.cameraToCenterDistance/V/this.transform.tileSize),ge=180*Math.atan2(P,-L)/Math.PI;let de=180*Math.acos($/V)/Math.PI;return de=O<0?90-de:90+de,{center:I.toLngLat(),zoom:Y,pitch:de,bearing:ge}}easeTo(t,o){this._stop(!1,t.easeId),((t=n.extend({offset:[0,0],duration:500,easing:n.defaultEasing},t)).animate===!1||!t.essential&&n.browser.prefersReducedMotion)&&(t.duration=0);const p=this._getTransformForUpdate(),_=this.getZoom(),w=this.getBearing(),I=this.getPitch(),P=this.getPadding(),L="zoom"in t?+t.zoom:_,O="bearing"in t?this._normalizeBearing(t.bearing,w):w,V="pitch"in t?+t.pitch:I,$="padding"in t?t.padding:p.padding,Y=n.Point.convert(t.offset);let ge=p.centerPoint.add(Y);const de=p.pointLocation(ge),xe=n.LngLat.convert(t.center||de);this._normalizeCenter(xe);const fe=p.project(de),Ve=p.project(xe).sub(fe),rt=p.zoomScale(L-_);let Ae,Ge;t.around&&(Ae=n.LngLat.convert(t.around),Ge=p.locationPoint(Ae));const ot={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||L!==_,this._rotating=this._rotating||w!==O,this._pitching=this._pitching||V!==I,this._padding=!p.isPaddingEqual($),this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,ot),this.terrain&&this._prepareElevation(xe),this._ease(lt=>{if(this._zooming&&(p.zoom=n.interpolate.number(_,L,lt)),this._rotating&&(p.bearing=n.interpolate.number(w,O,lt)),this._pitching&&(p.pitch=n.interpolate.number(I,V,lt)),this._padding&&(p.interpolatePadding(P,$,lt),ge=p.centerPoint.add(Y)),this.terrain&&!t.freezeElevation&&this._updateElevation(lt),Ae)p.setLocationAtPoint(Ae,Ge);else{const pt=p.zoomScale(p.zoom-_),St=L>_?Math.min(2,rt):Math.max(.5,rt),wt=Math.pow(St,1-lt),Pt=p.unproject(fe.add(Ve.mult(lt*wt)).mult(pt));p.setLocationAtPoint(p.renderWorldCopies?Pt.wrap():Pt,ge)}this._applyUpdatedTransform(p),this._fireMoveEvents(o)},lt=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,lt)},t),this}_prepareEase(t,o,p={}){this._moving=!0,o||p.moving||this.fire(new n.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new n.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new n.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new n.Event("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&o!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(p-(o-(p*t+this._elevationStart))/(1-t)),this._elevationTarget=o}this.transform.elevation=n.interpolate.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const o=t.clone(),{center:p,zoom:_,pitch:w,bearing:I,elevation:P}=this.transformCameraUpdate(o);p&&(o.center=p),_!==void 0&&(o.zoom=_),w!==void 0&&(o.pitch=w),I!==void 0&&(o.bearing=I),P!==void 0&&(o.elevation=P),this.transform.apply(o)}_fireMoveEvents(t){this.fire(new n.Event("move",t)),this._zooming&&this.fire(new n.Event("zoom",t)),this._rotating&&this.fire(new n.Event("rotate",t)),this._pitching&&this.fire(new n.Event("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const p=this._zooming,_=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new n.Event("zoomend",t)),_&&this.fire(new n.Event("rotateend",t)),w&&this.fire(new n.Event("pitchend",t)),this.fire(new n.Event("moveend",t))}flyTo(t,o){if(!t.essential&&n.browser.prefersReducedMotion){const Xt=n.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xt,o)}this.stop(),t=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.defaultEasing},t);const p=this._getTransformForUpdate(),_=this.getZoom(),w=this.getBearing(),I=this.getPitch(),P=this.getPadding(),L="zoom"in t?n.clamp(+t.zoom,p.minZoom,p.maxZoom):_,O="bearing"in t?this._normalizeBearing(t.bearing,w):w,V="pitch"in t?+t.pitch:I,$="padding"in t?t.padding:p.padding,Y=p.zoomScale(L-_),ge=n.Point.convert(t.offset);let de=p.centerPoint.add(ge);const xe=p.pointLocation(de),fe=n.LngLat.convert(t.center||xe);this._normalizeCenter(fe);const Ve=p.project(xe),rt=p.project(fe).sub(Ve);let Ae=t.curve;const Ge=Math.max(p.width,p.height),ot=Ge/Y,lt=rt.mag();if("minZoom"in t){const Xt=n.clamp(Math.min(t.minZoom,_,L),p.minZoom,p.maxZoom),tr=Ge/p.zoomScale(Xt-_);Ae=Math.sqrt(tr/lt*2)}const pt=Ae*Ae;function St(Xt){const tr=(ot*ot-Ge*Ge+(Xt?-1:1)*pt*pt*lt*lt)/(2*(Xt?ot:Ge)*pt*lt);return Math.log(Math.sqrt(tr*tr+1)-tr)}function wt(Xt){return(Math.exp(Xt)-Math.exp(-Xt))/2}function Pt(Xt){return(Math.exp(Xt)+Math.exp(-Xt))/2}const Wt=St(!1);let zi=function(Xt){return Pt(Wt)/Pt(Wt+Ae*Xt)},Lt=function(Xt){return Ge*((Pt(Wt)*(wt(tr=Wt+Ae*Xt)/Pt(tr))-wt(Wt))/pt)/lt;var tr},fi=(St(!0)-Wt)/Ae;if(Math.abs(lt)<1e-6||!isFinite(fi)){if(Math.abs(Ge-ot)<1e-6)return this.easeTo(t,o);const Xt=ot<Ge?-1:1;fi=Math.abs(Math.log(ot/Ge))/Ae,Lt=function(){return 0},zi=function(tr){return Math.exp(Xt*Ae*tr)}}return t.duration="duration"in t?+t.duration:1e3*fi/("screenSpeed"in t?+t.screenSpeed/Ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=w!==O,this._pitching=V!==I,this._padding=!p.isPaddingEqual($),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(fe),this._ease(Xt=>{const tr=Xt*fi,wi=1/zi(tr);p.zoom=Xt===1?L:_+p.scaleZoom(wi),this._rotating&&(p.bearing=n.interpolate.number(w,O,Xt)),this._pitching&&(p.pitch=n.interpolate.number(I,V,Xt)),this._padding&&(p.interpolatePadding(P,$,Xt),de=p.centerPoint.add(ge)),this.terrain&&!t.freezeElevation&&this._updateElevation(Xt);const Ei=Xt===1?fe:p.unproject(Ve.add(rt.mult(Lt(tr))).mult(wi));p.setLocationAtPoint(p.renderWorldCopies?Ei.wrap():Ei,de),this._applyUpdatedTransform(p),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,o)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,o,p){p.animate===!1||p.duration===0?(t(1),o()):(this._easeStart=n.browser.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,o){t=n.wrap(t,-180,180);const p=Math.abs(t-o);return Math.abs(t-360-o)<p&&(t-=360),Math.abs(t+360-o)<p&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;const p=t.lng-o.center.lng;t.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(n.LngLat.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Ll{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=v.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=v.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=v.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){v.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,o){const p=this._map._getUIString(`AttributionControl.${o}`);t.title=p,t.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const o=this._map.style.sourceCaches;for(const _ in o){const w=o[_];if(w.used||w.usedForTerrain){const I=w.getSource();I.attribution&&t.indexOf(I.attribution)<0&&t.push(I.attribution)}}t=t.filter(_=>String(_).trim()),t.sort((_,w)=>_.length-w.length),t=t.filter((_,w)=>{for(let I=w+1;I<t.length;I++)if(t[I].indexOf(_)>=0)return!1;return!0});const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class xn{constructor(t={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const p=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=v.create("div","maplibregl-ctrl");const o=v.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){v.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,p=o?this._queue.concat(o):this._queue;for(const _ of p)if(_.id===t)return void(_.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const p of o)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const bo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Rl=n.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class Kc extends n.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,o){this.sourceCache.update(t,o),this._renderableTilesKeys=[];const p={};for(const _ of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))p[_.key]=!0,this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.posMatrix=new Float64Array(16),n.ortho(_.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),this._tiles[_.key]=new me(_,this.tileSize));for(const _ in this._tiles)p[_]||delete this._tiles[_]}freeRtt(t){for(const o in this._tiles){const p=this._tiles[o];(!t||p.tileID.equals(t)||p.tileID.isChildOf(t)||t.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const o={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16),n.ortho(w.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),o[p]=w}else if(_.canonical.isChildOf(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const I=_.canonical.z-t.canonical.z,P=_.canonical.x-(_.canonical.x>>I<<I),L=_.canonical.y-(_.canonical.y>>I<<I),O=n.EXTENT>>I;n.ortho(w.posMatrix,0,O,0,O,0,1),n.translate(w.posMatrix,w.posMatrix,[-P*O,-L*O,0]),o[p]=w}else if(t.canonical.isChildOf(_.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const I=t.canonical.z-_.canonical.z,P=t.canonical.x-(t.canonical.x>>I<<I),L=t.canonical.y-(t.canonical.y>>I<<I),O=n.EXTENT>>I;n.ortho(w.posMatrix,0,n.EXTENT,0,n.EXTENT,0,1),n.translate(w.posMatrix,w.posMatrix,[P*O,L*O,0]),n.scale(w.posMatrix,w.posMatrix,[1/2**I,1/2**I,0]),o[p]=w}}return o}getSourceTile(t,o){const p=this.sourceCache._source;let _=t.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(_).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!w||!w.dem)&&o)for(;_>=p.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(t.scaledTo(_--).key);return w}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=t)}}class Xc{constructor(t,o,p){this.painter=t,this.sourceCache=new Kc(o),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,o,p,_=n.EXTENT){var w;if(!(o>=0&&o<_&&p>=0&&p<_))return 0;const I=this.getTerrainData(t),P=(w=I.tile)===null||w===void 0?void 0:w.dem;if(!P)return 0;const L=function(de,xe,fe){var Ve=xe[0],rt=xe[1];return de[0]=fe[0]*Ve+fe[4]*rt+fe[12],de[1]=fe[1]*Ve+fe[5]*rt+fe[13],de}([],[o/_*n.EXTENT,p/_*n.EXTENT],I.u_terrain_matrix),O=[L[0]*P.dim,L[1]*P.dim],V=Math.floor(O[0]),$=Math.floor(O[1]),Y=O[0]-V,ge=O[1]-$;return P.get(V,$)*(1-Y)*(1-ge)+P.get(V+1,$)*Y*(1-ge)+P.get(V,$+1)*(1-Y)*ge+P.get(V+1,$+1)*Y*ge}getElevationForLngLatZoom(t,o){const{tileID:p,mercatorX:_,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(t,o);return this.getElevation(p,_%n.EXTENT,w%n.EXTENT,n.EXTENT)}getElevation(t,o,p,_=n.EXTENT){return this.getDEMElevation(t,o,p,_)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const _=this.painter.context,w=new n.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ye(_,w,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ye(_,new n.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=n.identity([])}const o=this.sourceCache.getSourceTile(t,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const _=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new ye(_,o.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),o.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const p=o&&o+o.tileID.key+t.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let w=t.canonical.z-o.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=_?w=t.canonical.z-_:n.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=t.canonical.x-(t.canonical.x>>w<<w),P=t.canonical.y-(t.canonical.y>>w<<w),L=n.fromScaling(new Float64Array(16),[1/(n.EXTENT<<w),1/(n.EXTENT<<w),0]);n.translate(L,L,[I*n.EXTENT,P*n.EXTENT,0]),this._demMatrixCache[t.key]={matrix:L,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(t){const o=this.painter,p=o.width/devicePixelRatio,_=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ye(o.context,{width:p,height:_,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ye(o.context,{width:p,height:_,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(p,_,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,I=0;w<this._coordsTextureSize;w++)for(let P=0;P<this._coordsTextureSize;P++,I+=4)o[I+0]=255&P,o[I+1]=255&w,o[I+2]=P>>8<<4|w>>8,o[I+3]=0;const p=new n.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),_=new ye(t,p,t.gl.RGBA,{premultiply:!1});return _.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(t){const o=new Uint8Array(4),p=this.painter.context,_=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,o),p.bindFramebuffer.set(null);const w=o[0]+(o[2]>>4<<8),I=o[1]+((15&o[2])<<8),P=this.coordsIndex[255-o[3]],L=P&&this.sourceCache.getTileByID(P);if(!L)return null;const O=this._coordsTextureSize,V=(1<<L.tileID.canonical.z)*O;return new n.MercatorCoordinate((L.tileID.canonical.x*O+w)/V,(L.tileID.canonical.y*O+I)/V,this.getElevation(L.tileID,w,I,O))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,o=new n.Pos3dArray,p=new n.TriangleIndexArray,_=this.meshSize,w=n.EXTENT/_,I=_*_;for(let $=0;$<=_;$++)for(let Y=0;Y<=_;Y++)o.emplaceBack(Y*w,$*w,0);for(let $=0;$<I;$+=_+1)for(let Y=0;Y<_;Y++)p.emplaceBack(Y+$,_+Y+$+1,_+Y+$+2),p.emplaceBack(Y+$,_+Y+$+2,Y+$+1);const P=o.length,L=P+2*(_+1);for(const $ of[0,1])for(let Y=0;Y<=_;Y++)for(const ge of[0,1])o.emplaceBack(Y*w,$*n.EXTENT,ge);for(let $=0;$<2*_;$+=2)p.emplaceBack(L+$,L+$+1,L+$+3),p.emplaceBack(L+$,L+$+3,L+$+2),p.emplaceBack(P+$,P+$+3,P+$+1),p.emplaceBack(P+$,P+$+2,P+$+3);const O=o.length,V=O+2*(_+1);for(const $ of[0,1])for(let Y=0;Y<=_;Y++)for(const ge of[0,1])o.emplaceBack($*n.EXTENT,Y*w,ge);for(let $=0;$<2*_;$+=2)p.emplaceBack(O+$,O+$+1,O+$+3),p.emplaceBack(O+$,O+$+3,O+$+2),p.emplaceBack(V+$,V+$+3,V+$+1),p.emplaceBack(V+$,V+$+2,V+$+3);return this._mesh={indexBuffer:t.createIndexBuffer(p),vertexBuffer:t.createVertexBuffer(o,Rl.members),segments:n.SegmentVector.simpleSegment(0,0,o.length,p.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*n.earthRadius/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,o){var p;const{tileID:_}=this._getOverscaledTileIDFromLngLatZoom(t,o);return(p=this.getMinMaxElevation(_).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(t){const o=this.getTerrainData(t).tile,p={minElevation:null,maxElevation:null};return o&&o.dem&&(p.minElevation=o.dem.min*this.exaggeration,p.maxElevation=o.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(t,o){const p=n.MercatorCoordinate.fromLngLat(t.wrap()),_=(1<<o)*n.EXTENT,w=p.x*_,I=p.y*_,P=Math.floor(w/n.EXTENT),L=Math.floor(I/n.EXTENT);return{tileID:new n.OverscaledTileID(o,0,o,P,L),mercatorX:w,mercatorY:I}}}class Jc{constructor(t,o,p){this._context=t,this._size=o,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ye(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(p.texture),{id:t,fbo:o,texture:p,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>t.id!==o),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const ea={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Gn{constructor(t,o){this.painter=t,this.terrain=o,this.pool=new Jc(t.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(p=>!t._layers[p].isHidden(o)),this._coordsDescendingInv={};for(const p in t.sourceCaches){this._coordsDescendingInv[p]={};const _=t.sourceCaches[p].getVisibleCoordinates();for(const w of _){const I=this.terrain.sourceCache.getTerrainCoords(w);for(const P in I)this._coordsDescendingInv[p][P]||(this._coordsDescendingInv[p][P]=[]),this._coordsDescendingInv[p][P].push(I[P])}}this._coordsDescendingInvStr={};for(const p of t._order){const _=t._layers[p],w=_.source;if(ea[_.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const I in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][I]=this._coordsDescendingInv[w][I].map(P=>P.key).sort().join()}}for(const p of this._renderableTiles)for(const _ in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[_][p.tileID.key];w&&w!==p.rttCoords[_]&&(p.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const o=t.type,p=this.painter,_=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ea[o]&&(this._prevType&&ea[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(t.id),!_))return!0;if(ea[this._prevType]||ea[o]&&_){this._prevType=o;const w=this._stacks.length-1,I=this._stacks[w]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(vl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[w]){const O=this.pool.getObjectForId(P.rtt[w].id);if(O.stamp===P.rtt[w].stamp){this.pool.useObject(O);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),P.rtt[w]={id:L.id,stamp:L.stamp},p.context.bindFramebuffer.set(L.fbo.framebuffer),p.context.clear({color:n.Color.transparent,stencil:0}),p.currentStencilSource=void 0;for(let O=0;O<I.length;O++){const V=p.style._layers[I[O]],$=V.source?this._coordsDescendingInv[V.source][P.tileID.key]:[P.tileID];p.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),p._renderTileClippingMasks(V,$),p.renderLayer(p,p.style.sourceCaches[V.source],V,$),V.source&&(P.rttCoords[V.source]=this._coordsDescendingInvStr[V.source][P.tileID.key])}}return vl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ea[o]}return!1}}const wo=g,ti={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:n.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},hi=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},xo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bl{constructor(t,o,p=!1){this.mousedown=I=>{this.startMouse(n.extend({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),v.mousePos(this.element,I)),v.addEventListener(window,"mousemove",this.mousemove),v.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,v.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=v.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),v.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=v.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const _=t.dragRotate._mouseRotate.getClickTolerance(),w=t.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=Sl({clickTolerance:_,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:P,bearingDegreesPerPixelMoved:L=.8})=>{const O=new Gc;return new wn({clickTolerance:P,move:(V,$)=>({bearingDelta:($.x-V.x)*L}),moveStateManager:O,enable:I,assignEvents:hi})})({clickTolerance:_,enable:!0}),this.map=t,p&&(this.mousePitch=Ys({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:P,pitchDegreesPerPixelMoved:L=-.5})=>{const O=new Gc;return new wn({clickTolerance:P,move:(V,$)=>({pitchDelta:($.y-V.y)*L}),moveStateManager:O,enable:I,assignEvents:hi})})({clickTolerance:w,enable:!0})),v.addEventListener(o,"mousedown",this.mousedown),v.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),v.addEventListener(o,"touchcancel",this.reset)}startMouse(t,o){this.mouseRotate.dragStart(t,o),this.mousePitch&&this.mousePitch.dragStart(t,o),v.disableDrag()}startTouch(t,o){this.touchRotate.dragStart(t,o),this.touchPitch&&this.touchPitch.dragStart(t,o),v.disableDrag()}moveMouse(t,o){const p=this.map,{bearingDelta:_}=this.mouseRotate.dragMove(t,o)||{};if(_&&p.setBearing(p.getBearing()+_),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(t,o)||{};w&&p.setPitch(p.getPitch()+w)}}moveTouch(t,o){const p=this.map,{bearingDelta:_}=this.touchRotate.dragMove(t,o)||{};if(_&&p.setBearing(p.getBearing()+_),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(t,o)||{};w&&p.setPitch(p.getPitch()+w)}}off(){const t=this.element;v.removeEventListener(t,"mousedown",this.mousedown),v.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),v.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.removeEventListener(window,"touchend",this.touchend),v.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){v.enableDrag(),v.removeEventListener(window,"mousemove",this.mousemove),v.removeEventListener(window,"mouseup",this.mouseup),v.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),v.removeEventListener(window,"touchend",this.touchend)}}let Hn;function Yr(y,t,o){if(y=new n.LngLat(y.lng,y.lat),t){const p=new n.LngLat(y.lng-360,y.lat),_=new n.LngLat(y.lng+360,y.lat),w=o.locationPoint(y).distSqr(t);o.locationPoint(p).distSqr(t)<w?y=p:o.locationPoint(_).distSqr(t)<w&&(y=_)}for(;Math.abs(y.lng-o.center.lng)>180;){const p=o.locationPoint(y);if(p.x>=0&&p.y>=0&&p.x<=o.width&&p.y<=o.height)break;y.lng>o.center.lng?y.lng-=360:y.lng+=360}return y}const Eo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Nn(y,t,o){const p=y.classList;for(const _ in Eo)p.remove(`maplibregl-${o}-anchor-${_}`);p.add(`maplibregl-${o}-anchor-${t}`)}class Ol extends n.Evented{constructor(t){if(super(),this._onKeyPress=o=>{const p=o.code,_=o.charCode||o.keyCode;p!=="Space"&&p!=="Enter"&&_!==32&&_!==13||this.togglePopup()},this._onMapClick=o=>{const p=o.originalEvent.target,_=this._element;this._popup&&(p===_||_.contains(p))&&this.togglePopup()},this._update=o=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!p)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Yr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),v.setTransform(this._element,`${Eo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${_}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const I=this._map.unproject(this._pos),P=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=I.distanceTo(this._lngLat)>20*P?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=o=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.Event("dragstart"))),this.fire(new n.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new n.Event("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=n.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=v.create("div"),this._element.setAttribute("aria-label","Map marker");const o=v.createNS("http://www.w3.org/2000/svg","svg"),p=41,_=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${p}px`),o.setAttributeNS(null,"width",`${_}px`),o.setAttributeNS(null,"viewBox",`0 0 ${_} ${p}`);const w=v.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const I=v.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const P=v.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ve of L){const rt=v.createNS("http://www.w3.org/2000/svg","ellipse");rt.setAttributeNS(null,"opacity","0.04"),rt.setAttributeNS(null,"cx","10.5"),rt.setAttributeNS(null,"cy","5.80029008"),rt.setAttributeNS(null,"rx",Ve.rx),rt.setAttributeNS(null,"ry",Ve.ry),P.appendChild(rt)}const O=v.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const V=v.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(V);const $=v.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const Y=v.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(Y);const ge=v.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");const de=v.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(8.0, 8.0)");const xe=v.createNS("http://www.w3.org/2000/svg","circle");xe.setAttributeNS(null,"fill","#000000"),xe.setAttributeNS(null,"opacity","0.25"),xe.setAttributeNS(null,"cx","5.5"),xe.setAttributeNS(null,"cy","5.5"),xe.setAttributeNS(null,"r","5.4999962");const fe=v.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#FFFFFF"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962"),de.appendChild(xe),de.appendChild(fe),I.appendChild(P),I.appendChild(O),I.appendChild($),I.appendChild(ge),I.appendChild(de),o.appendChild(I),o.setAttributeNS(null,"height",p*this._scale+"px"),o.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(o),this._offset=n.Point.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Nn(this._element,this._anchor,"marker"),t&&t.className)for(const o of t.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),v.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=n.Point.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const za={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Xi=0,er=!1;const Yc={maxWidth:100,unit:"metric"};function ta(y,t,o){const p=o&&o.maxWidth||100,_=y._container.clientHeight/2,w=y.unproject([0,_]),I=y.unproject([p,_]),P=w.distanceTo(I);if(o&&o.unit==="imperial"){const L=3.2808*P;L>5280?bs(t,p,L/5280,y._getUIString("ScaleControl.Miles")):bs(t,p,L,y._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?bs(t,p,P/1852,y._getUIString("ScaleControl.NauticalMiles")):P>=1e3?bs(t,p,P/1e3,y._getUIString("ScaleControl.Kilometers")):bs(t,p,P,y._getUIString("ScaleControl.Meters"))}function bs(y,t,o,p){const _=function(w){const I=Math.pow(10,`${Math.floor(w)}`.length-1);let P=w/I;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(L){const O=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*O)/O}(P),I*P}(o);y.style.width=t*(_/o)+"px",y.innerHTML=`${_}&nbsp;${p}`}const Fl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function So(y){if(y){if(typeof y=="number"){const t=Math.round(Math.abs(y)/Math.SQRT2);return{center:new n.Point(0,0),top:new n.Point(0,y),"top-left":new n.Point(t,t),"top-right":new n.Point(-t,t),bottom:new n.Point(0,-y),"bottom-left":new n.Point(t,-t),"bottom-right":new n.Point(-t,-t),left:new n.Point(y,0),right:new n.Point(-y,0)}}if(y instanceof n.Point||Array.isArray(y)){const t=n.Point.convert(y);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:n.Point.convert(y.center||[0,0]),top:n.Point.convert(y.top||[0,0]),"top-left":n.Point.convert(y["top-left"]||[0,0]),"top-right":n.Point.convert(y["top-right"]||[0,0]),bottom:n.Point.convert(y.bottom||[0,0]),"bottom-left":n.Point.convert(y["bottom-left"]||[0,0]),"bottom-right":n.Point.convert(y["bottom-right"]||[0,0]),left:n.Point.convert(y.left||[0,0]),right:n.Point.convert(y.right||[0,0])}}return So(new n.Point(0,0))}const Ma={extend:(y,...t)=>n.extend(y,...t),run(y){y()},logToElement(y,t=!1,o="log"){const p=window.document.getElementById(o);p&&(t&&(p.innerHTML=""),p.innerHTML+=`<br>${y}`)}},Ul=g;class Vi{static get version(){return Ul}static get workerCount(){return dt.workerCount}static set workerCount(t){dt.workerCount=t}static get maxParallelImageRequests(){return n.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){n.config.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return n.config.WORKER_URL}static set workerUrl(t){n.config.WORKER_URL=t}static addProtocol(t,o){n.config.REGISTERED_PROTOCOLS[t]=o}static removeProtocol(t){delete n.config.REGISTERED_PROTOCOLS[t]}}return Vi.Map=class extends Dl{constructor(y){if(n.PerformanceUtils.mark(n.PerformanceMarkers.create),(y=n.extend({},ti,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new xa(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.Event("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new n.Event("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._cooperativeGestures=y.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Qi,this._controls=[],this._mapId=n.uniqueId(),this._locale=n.extend({},bo,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=R.addThrottleControl(()=>this.isMoving()),this._requestManager=new F(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const o=bl(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{t?o(p):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ml(this,y),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=y.hash&&new Xs(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,n.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Ll({customAttribution:y.customAttribution})),y.maplibreLogo&&this.addControl(new xn,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new n.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new n.Event(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new n.Event("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(y,t){if(t===void 0&&(t=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(o,p.firstChild):p.appendChild(o),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new n.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(y);return t>-1&&this._controls.splice(t,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,t,o,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,t,o,p)}resize(y){var t;const o=this._containerDimensions(),p=o[0],_=o[1],w=this._getClampedPixelRatio(p,_);if(this._resizeCanvas(p,_,w),this.painter.resize(p,_,w),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const L=this._getClampedPixelRatio(p,_);this._resizeCanvas(p,_,L),this.painter.resize(p,_,L)}this.transform.resize(p,_),(t=this._requestedCameraState)===null||t===void 0||t.resize(p,_);const I=!this._moving;return I&&(this.stop(),this.fire(new n.Event("movestart",y)).fire(new n.Event("move",y))),this.fire(new n.Event("resize",y)),I&&this.fire(new n.Event("moveend",y)),this}_getClampedPixelRatio(y,t){const{0:o,1:p}=this._maxCanvasSize,_=this.getPixelRatio(),w=y*_,I=t*_;return Math.min(w>o?o/w:1,I>p?p/I:1)*_}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Re.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(y){return this.transform.locationPoint(n.LngLat.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(n.Point.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,t,o){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:t,listener:o,delegates:{mousemove:w=>{const I=this.getLayer(t)?this.queryRenderedFeatures(w.point,{layers:[t]}):[];I.length?p||(p=!0,o.call(this,new bn(y,this,w.originalEvent,{features:I}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:t,listener:o,delegates:{mousemove:I=>{(this.getLayer(t)?this.queryRenderedFeatures(I.point,{layers:[t]}):[]).length?p=!0:p&&(p=!1,o.call(this,new bn(y,this,I.originalEvent)))},mouseout:I=>{p&&(p=!1,o.call(this,new bn(y,this,I.originalEvent)))}}}}{const p=_=>{const w=this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[];w.length&&(_.features=w,o.call(this,_),delete _.features)};return{layer:t,listener:o,delegates:{[y]:p}}}}on(y,t,o){if(o===void 0)return super.on(y,t);const p=this._createDelegatedListener(y,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(y,t,o){if(o===void 0)return super.once(y,t);const p=this._createDelegatedListener(y,t,o);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(y,t,o){return o===void 0?super.off(y,t):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const _=this._delegatedListeners[y];for(let w=0;w<_.length;w++){const I=_[w];if(I.layer===t&&I.listener===o){for(const P in I.delegates)this.off(P,I.delegates[P]);return _.splice(w,1),this}}})(),this)}queryRenderedFeatures(y,t){if(!this.style)return[];let o;const p=y instanceof n.Point||Array.isArray(y),_=p?y:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(p?{}:y)||{},_ instanceof n.Point||typeof _[0]=="number")o=[n.Point.convert(_)];else{const w=n.Point.convert(_[0]),I=n.Point.convert(_[1]);o=[w,new n.Point(I.x,w.y),I,new n.Point(w.x,I.y),w]}return this.style.queryRenderedFeatures(o,t,this.transform)}querySourceFeatures(y,t){return this.style.querySourceFeatures(y,t)}setStyle(y,t){return(t=n.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(y,t))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const t=this._locale[y];if(t==null)throw new Error(`Missing UI string '${y}'`);return t}_updateStyle(y,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,t));const o=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Er(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,t,o):this.style.loadJSON(y,t,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Er(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,t){if(typeof y=="string"){const o=this._requestManager.transformRequest(y,D.Style);n.getJSON(o,(p,_)=>{p?this.fire(new n.ErrorEvent(p)):_&&this._updateDiff(_,t)})}else typeof y=="object"&&this._updateDiff(y,t)}_updateDiff(y,t){try{this.style.setState(y,t)&&this._update(!0)}catch(o){n.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(y,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():n.warnOnce("There is no style added to the map.")}addSource(y,t){return this._lazyInitEmptyStyle(),this.style.addSource(y,t),this._update(!0)}isSourceLoaded(y){const t=this.style&&this.style.sourceCaches[y];if(t!==void 0)return t.loaded();this.fire(new n.ErrorEvent(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const t=this.style.sourceCaches[y.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);for(const o in this.style._layers){const p=this.style._layers[o];p.type==="hillshade"&&p.source===y.source&&n.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Xc(this.painter,t,y),this.painter.renderToTexture=new Gn(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==y.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new n.Event("terrain",{terrain:y})),this}getTerrain(){var y,t;return(t=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const t in y){const o=y[t]._tiles;for(const p in o){const _=o[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(y,t,o){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,t,o)}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,t,o={}){const{pixelRatio:p=1,sdf:_=!1,stretchX:w,stretchY:I,content:P}=o;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||n.isImageBitmap(t))){if(t.width===void 0||t.height===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:O,data:V}=t,$=t;return this.style.addImage(y,{data:new n.RGBAImage({width:L,height:O},new Uint8Array(V)),pixelRatio:p,stretchX:w,stretchY:I,content:P,sdf:_,version:0,userImage:$}),$.onAdd&&$.onAdd(this,y),this}}{const{width:L,height:O,data:V}=n.browser.getImageData(t);this.style.addImage(y,{data:new n.RGBAImage({width:L,height:O},V),pixelRatio:p,stretchX:w,stretchY:I,content:P,sdf:_,version:0})}}updateImage(y,t){const o=this.style.getImage(y);if(!o)return this.fire(new n.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||n.isImageBitmap(t)?n.browser.getImageData(t):t,{width:_,height:w,data:I}=p;if(_===void 0||w===void 0)return this.fire(new n.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==o.data.width||w!==o.data.height)return this.fire(new n.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(t instanceof HTMLImageElement||n.isImageBitmap(t));return o.data.replace(I,P),this.style.updateImage(y,o),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new n.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,t){R.getImage(this._requestManager.transformRequest(y,D.Image),t)}listImages(){return this.style.listImages()}addLayer(y,t){return this._lazyInitEmptyStyle(),this.style.addLayer(y,t),this._update(!0)}moveLayer(y,t){return this.style.moveLayer(y,t),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,t,o){return this.style.setLayerZoomRange(y,t,o),this._update(!0)}setFilter(y,t,o={}){return this.style.setFilter(y,t,o),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,t,o,p={}){return this.style.setPaintProperty(y,t,o,p),this._update(!0)}getPaintProperty(y,t){return this.style.getPaintProperty(y,t)}setLayoutProperty(y,t,o,p={}){return this.style.setLayoutProperty(y,t,o,p),this._update(!0)}getLayoutProperty(y,t){return this.style.getLayoutProperty(y,t)}setGlyphs(y,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,t,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,t,o,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,t,o=>{o||this._update(!0)}),this}setLight(y,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,t){return this.style.setFeatureState(y,t),this._update()}removeFeatureState(y,t){return this.style.removeFeatureState(y,t),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,t=0;return this._container&&(y=this._container.clientWidth||400,t=this._container.clientHeight||300),[y,t]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const t=this._canvasContainer=v.create("div","maplibregl-canvas-container",y);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=v.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),p=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],p);const _=this._controlContainer=v.create("div","maplibregl-control-container",y),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{w[I]=v.create("div",`maplibregl-ctrl-${I} `,_)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=v.create("div","maplibregl-cooperative-gesture-screen",this._container);let y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${y}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){v.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(y,t,o){this._canvas.width=Math.floor(o*y),this._canvas.height=Math.floor(o*t),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{t={requestedAttributes:y},p&&(t.statusMessage=p.statusMessage,t.type=p.type)},{once:!0});const o=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!o){const p="Failed to initialize WebGL";throw t?(t.message=p,new Error(JSON.stringify(t))):new Error(p)}this.painter=new ur(o,this.transform),E.testSupport(o)}_onCooperativeGesture(y,t,o){return!t&&o<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const _=this.transform.zoom,w=n.browser.now();this.style.zoomHistory.update(_,w);const I=new n.EvaluationParameters(_,{now:w,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=I.crossFadingFactor();P===1&&P===this._crossFadingFactor||(o=!0,this._crossFadingFactor=P),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new n.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.load),this.fire(new n.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new n.Event("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,n.PerformanceUtils.mark(n.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),R.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),v.remove(this._canvasContainer),v.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),n.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new n.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=n.browser.frame(y=>{n.PerformanceUtils.frame(y),this._frame=null,this._render(y)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return wo}getCameraTargetElevation(){return this.transform.elevation}},Vi.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const t=this._map.getZoom(),o=t===this._map.getMaxZoom(),p=t===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,o)=>{const p=this._map._getUIString(`NavigationControl.${o}`);t.title=p,t.setAttribute("aria-label",p)},this.options=n.extend({},xo,y),this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),v.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),v.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=v.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){v.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,t){const o=v.create("button",y,this._container);return o.type="button",o.addEventListener("click",t),o}},Vi.GeolocateControl=class extends n.Evented{constructor(y){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new n.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new n.Event("geolocate",t)),this._finish()}},this._updateCamera=t=>{const o=new n.LngLat(t.coords.longitude,t.coords.latitude),p=t.coords.accuracy,_=this._map.getBearing(),w=n.extend({bearing:_},this.options.fitBoundsOptions),I=Re.fromLngLat(o,p);this._map.fitBounds(I,w,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const o=new n.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&er)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new n.Event("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=v.create("button","maplibregl-ctrl-geolocate",this._container),v.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){n.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=v.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ol({element:this._dotElement}),this._circleElement=v.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ol({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new n.Event("trackuserlocationend")))})}},this.options=n.extend({},za,y)}onAdd(y){return this._map=y,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,o=!1){Hn===void 0||o?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(p=>{Hn=p.state!=="denied",t(Hn)}).catch(()=>{Hn=!!window.navigator.geolocation,t(Hn)}):(Hn=!!window.navigator.geolocation,t(Hn)):t(Hn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),v.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Xi=0,er=!1}_isOutOfMapMaxBounds(y){const t=this._map.getMaxBounds(),o=y.coords;return t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),t=y.getSouthEast(),o=y.getNorthEast(),p=t.distanceTo(o),_=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}trigger(){if(!this._setup)return n.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xi--,er=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new n.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Xi++,Xi>1?(y={maximumAge:6e5,timeout:0},er=!0):(y=this.options.positionOptions,er=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Vi.AttributionControl=Ll,Vi.LogoControl=xn,Vi.ScaleControl=class{constructor(y){this._onMove=()=>{ta(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ta(this._map,this._container,this.options)},this.options=n.extend({},Yc,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){v.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Vi.FullscreenControl=class extends n.Evented{constructor(y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:n.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){v.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=v.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);v.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new n.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new n.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Vi.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=y}onAdd(y){return this._map=y,this._container=v.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=v.create("button","maplibregl-ctrl-terrain",this._container),v.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){v.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Vi.Popup=class extends n.Evented{constructor(y){super(),this.remove=()=>(this._content&&v.remove(this._content),this._container&&(v.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new n.Event("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=v.create("div","maplibregl-popup",this._map.getContainer()),this._tip=v.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Yr(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const o=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let p=this.options.anchor;const _=So(this.options.offset);if(!p){const I=this._container.offsetWidth,P=this._container.offsetHeight;let L;L=o.y+_.bottom.y<P?["top"]:o.y>this._map.transform.height-P?["bottom"]:[],o.x<I/2?L.push("left"):o.x>this._map.transform.width-I/2&&L.push("right"),p=L.length===0?"bottom":L.join("-")}const w=o.add(_[p]).round();v.setTransform(this._container,`${Eo[p]} translate(${w.x}px,${w.y}px)`),Nn(this._container,p,"popup")},this._onClose=()=>{this.remove()},this.options=n.extend(Object.create(Fl),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new n.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=n.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const t=document.createDocumentFragment(),o=document.createElement("body");let p;for(o.innerHTML=y;p=o.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=v.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=v.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Nl);y&&y.focus()}},Vi.Marker=Ol,Vi.Style=Er,Vi.LngLat=n.LngLat,Vi.LngLatBounds=Re,Vi.Point=n.Point,Vi.MercatorCoordinate=n.MercatorCoordinate,Vi.Evented=n.Evented,Vi.AJAXError=n.AJAXError,Vi.config=n.config,Vi.CanvasSource=Se,Vi.GeoJSONSource=bt,Vi.ImageSource=Bt,Vi.RasterDEMTileSource=Ct,Vi.RasterTileSource=it,Vi.VectorTileSource=he,Vi.VideoSource=Fe,Vi.setRTLTextPlugin=n.setRTLTextPlugin,Vi.getRTLTextPluginStatus=n.getRTLTextPluginStatus,Vi.prewarm=function(){Si().acquire(Tt)},Vi.clearPrewarmedResources=function(){const y=ki;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Tt),ki=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Ma.extend(Vi,{isSafari:n.isSafari,getPerformanceMetrics:n.PerformanceUtils.getPerformanceMetrics}),Vi});var d=u;return d})})(sy);var F2=sy.exports;const lc=Ku(F2);const{document:Mg}=L_;function Dg(c){let r;const a=c[19].default,l=Tr(a,c,c[18],null);return{c(){l&&l.c()},l(u){l&&l.l(u)},m(u,f){l&&l.m(u,f),r=!0},p(u,f){l&&l.p&&(!r||f&262144)&&Cr(l,a,u,u[18],r?Ar(a,u[18],f,null):Ir(u[18]),null)},i(u){r||(Ye(l,u),r=!0)},o(u){st(l,u),r=!1},d(u){l&&l.d(u)}}}function N2(c){let r,a,l,u,f,d=c[3]&&Dg(c);return{c(){r=$e("link"),l=mt(),u=$e("div"),d&&d.c(),this.h()},l(n){const g=z_("svelte-12hmray",Mg.head);r=je(g,"LINK",{rel:!0,href:!0}),g.forEach(J),l=gt(n),u=je(n,"DIV",{id:!0,class:!0});var v=et(u);d&&d.l(v),v.forEach(J),this.h()},h(){_e(r,"rel","stylesheet"),_e(r,"href",a=c[1]?c[1]:"https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css"),_e(u,"id",c[0]),_e(u,"class","map svelte-1tna482")},m(n,g){ze(Mg.head,r),Ze(n,l,g),Ze(n,u,g),d&&d.m(u,null),c[20](u),f=!0},p(n,[g]){(!f||g&2&&a!==(a=n[1]?n[1]:"https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css"))&&_e(r,"href",a),n[3]?d?(d.p(n,g),g&8&&Ye(d,1)):(d=Dg(n),d.c(),Ye(d,1),d.m(u,null)):d&&(Ni(),st(d,1,1,()=>{d=null}),Ui()),(!f||g&1)&&_e(u,"id",n[0])},i(n){f||(Ye(d),f=!0)},o(n){st(d),f=!1},d(n){n&&(J(l),J(u)),J(r),d&&d.d(),c[20](null)}}}function U2(c=1e3){return new Promise(r=>setTimeout(r,c))}function V2(c,r,a){let{$$slots:l={},$$scope:u}=r;const f=Lf();let{map:d}=r,{id:n="map"}=r,{location:g={lng:15,lat:45,zoom:1}}=r,{style:v={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=r,{css:E=null}=r,{options:S={}}=r,{minzoom:T=0}=r,{maxzoom:k=14}=r,{controls:z=!1}=r,{tabbable:A=!1}=r,{zoom:R=null}=r,{center:D=null}=r,{pitch:F=null}=r,{bearing:q=null}=r,{interactive:ee=!0}=r,{attribution:ie=!0}=r,ne,se={},ue=!1;Za("map",{getMap:()=>d}),g.bounds?se.bounds=g.bounds:g.lng&&g.lat&&(se.center=[+g.lng,+g.lat],g.zoom&&(se.zoom=+g.zoom),g.pitch&&(se.pitch=+g.pitch),g.bearing&&(se.bearing=+g.bearing)),ie||(se.attributionControl=!1),se={...se,...S},Zu(()=>{a(4,d=new lc.Map({container:ne,style:v,minZoom:T,maxZoom:k,interactive:ee,...se})),z&&!Array.isArray(z)?d.addControl(new lc.NavigationControl({showCompass:!1})):Array.isArray(z)&&z!=["locate"]&&d.addControl(new lc.NavigationControl({showCompass:z.includes("compass"),visualizePitch:z.includes("pitch")})),Array.isArray(z)&&z.includes("locate")&&d.addControl(new lc.GeolocateControl),d.on("load",Xe=>{a(5,R=d.getZoom()),a(6,D=d.getCenter()),a(7,F=d.getPitch()),a(8,q=d.getBearing()),a(3,ue=!0),!A&&document.querySelector(`#${n} canvas`)&&(document.querySelector(`#${n} canvas`).tabIndex="-1"),f("load",{event:Xe})}),d.on("moveend",()=>{a(5,R=d.getZoom()),a(6,D=d.getCenter()),a(7,F=d.getPitch()),a(8,q=d.getBearing())})}),Hu(async()=>{await U2(250),d&&d.remove(),a(4,d=null)});function Ce(Xe){d&&d.setStyle(Xe),f("style",{style:Xe})}function ye(Xe){yc[Xe?"unshift":"push"](()=>{ne=Xe,a(2,ne)})}return c.$$set=Xe=>{"map"in Xe&&a(4,d=Xe.map),"id"in Xe&&a(0,n=Xe.id),"location"in Xe&&a(9,g=Xe.location),"style"in Xe&&a(10,v=Xe.style),"css"in Xe&&a(1,E=Xe.css),"options"in Xe&&a(11,S=Xe.options),"minzoom"in Xe&&a(12,T=Xe.minzoom),"maxzoom"in Xe&&a(13,k=Xe.maxzoom),"controls"in Xe&&a(14,z=Xe.controls),"tabbable"in Xe&&a(15,A=Xe.tabbable),"zoom"in Xe&&a(5,R=Xe.zoom),"center"in Xe&&a(6,D=Xe.center),"pitch"in Xe&&a(7,F=Xe.pitch),"bearing"in Xe&&a(8,q=Xe.bearing),"interactive"in Xe&&a(16,ee=Xe.interactive),"attribution"in Xe&&a(17,ie=Xe.attribution),"$$scope"in Xe&&a(18,u=Xe.$$scope)},c.$$.update=()=>{c.$$.dirty&1024&&Ce(v)},[n,E,ne,ue,d,R,D,F,q,g,v,S,T,k,z,A,ee,ie,u,l,ye]}let $2=class extends $i{constructor(r){super(),ji(this,r,V2,N2,Fi,{map:4,id:0,location:9,style:10,css:1,options:11,minzoom:12,maxzoom:13,controls:14,tabbable:15,zoom:5,center:6,pitch:7,bearing:8,interactive:16,attribution:17})}};function Lg(c){let r;const a=c[12].default,l=Tr(a,c,c[11],null);return{c(){l&&l.c()},l(u){l&&l.l(u)},m(u,f){l&&l.m(u,f),r=!0},p(u,f){l&&l.p&&(!r||f&2048)&&Cr(l,a,u,u[11],r?Ar(a,u[11],f,null):Ir(u[11]),null)},i(u){r||(Ye(l,u),r=!0)},o(u){st(l,u),r=!1},d(u){l&&l.d(u)}}}function j2(c){let r,a,l=c[0]&&Lg(c);return{c(){l&&l.c(),r=oi()},l(u){l&&l.l(u),r=oi()},m(u,f){l&&l.m(u,f),Ze(u,r,f),a=!0},p(u,[f]){u[0]?l?(l.p(u,f),f&1&&Ye(l,1)):(l=Lg(u),l.c(),Ye(l,1),l.m(r.parentNode,r)):l&&(Ni(),st(l,1,1,()=>{l=null}),Ui())},i(u){a||(Ye(l),a=!0)},o(u){st(l),a=!1},d(u){u&&J(r),l&&l.d(u)}}}function q2(c=1e3){return new Promise(r=>setTimeout(r,c))}function Z2(c,r,a){let{$$slots:l={},$$scope:u}=r,{id:f}=r,{type:d}=r,{url:n=null}=r,{props:g={}}=r,{data:v=null}=r,{layer:E=null}=r,{promoteId:S=null}=r,{minzoom:T=null}=r,{maxzoom:k=null}=r,{tilesize:z=256}=r,A=!1,R=n;const{getMap:D}=Ga("map"),F=D();Za("source",{source:f,layer:E,promoteId:S}),F.getSource(f)&&F.removeSource(f);async function q(){await q2(100),F.isSourceLoaded(f)?(a(0,A=!0),console.debug(f+" map source loaded!")):(console.debug("..."),q())}T&&(g.minzoom=T),k&&(g.maxzoom=k),E&&S?(g.promoteId={},g.promoteId[E]=S):S&&(g.promoteId=S);function ee(){console.debug(f+" map source loading...");let ue;d=="geojson"?v?ue={type:d,data:v,...g}:n&&(ue={type:d,data:n,...g}):d=="vector"?ue={type:d,tiles:[n],...g}:d=="raster"?ue={type:d,tiles:[n],tileSize:z,...g}:d=="raster-dem"&&(ue={type:d,tiles:[n],tileSize:z,...g}),ue&&(F.addSource(f,ue),q())}function ie(ue){let Ce=F.getSource(f);Ce&&Ce.setData(ue)}function ne(ue){if(ue!==R){let Ce=F.getSource(f);Ce&&Ce.setTiles([ue]),R=ue}}function se(ue){ue!==R&&(F.getSource(f).tiles=[ue],F.style.sourceCaches[f].clearTiles(),F.style.sourceCaches[f].update(F.transform),F.triggerRepaint(),R=ue)}return Zu(ee),Hu(async()=>{F&&F.getSource(f)&&(F.getStyle().layers.filter(Ce=>Ce.source==f).forEach(Ce=>{F.removeLayer(Ce.id)}),F.removeSource(f))}),c.$$set=ue=>{"id"in ue&&a(2,f=ue.id),"type"in ue&&a(3,d=ue.type),"url"in ue&&a(4,n=ue.url),"props"in ue&&a(1,g=ue.props),"data"in ue&&a(5,v=ue.data),"layer"in ue&&a(6,E=ue.layer),"promoteId"in ue&&a(7,S=ue.promoteId),"minzoom"in ue&&a(8,T=ue.minzoom),"maxzoom"in ue&&a(9,k=ue.maxzoom),"tilesize"in ue&&a(10,z=ue.tilesize),"$$scope"in ue&&a(11,u=ue.$$scope)},c.$$.update=()=>{c.$$.dirty&41&&d=="geojson"&&A&&ie(v),c.$$.dirty&25&&d=="vector"&&A&&ne(n),c.$$.dirty&25&&d=="raster"&&A&&se(n)},[A,g,f,d,n,v,E,S,T,k,z,u,l]}class G2 extends $i{constructor(r){super(),ji(this,r,Z2,j2,Fi,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const H2=c=>({hovered:c[0]&1}),Rg=c=>({hovered:c[0]});function W2(c){let r;const a=c[30].default,l=Tr(a,c,c[29],Rg);return{c(){l&&l.c()},l(u){l&&l.l(u)},m(u,f){l&&l.m(u,f),r=!0},p(u,f){l&&l.p&&(!r||f[0]&536870913)&&Cr(l,a,u,u[29],r?Ar(a,u[29],f,H2):Ir(u[29]),Rg)},i(u){r||(Ye(l,u),r=!0)},o(u){st(l,u),r=!1},d(u){l&&l.d(u)}}}function K2(c,r,a){let l,{$$slots:u={},$$scope:f}=r;const d=Lf();let{id:n}=r,{type:g}=r,{filter:v=null}=r,{layout:E={}}=r,{paint:S={}}=r,{data:T=null}=r,{colorKey:k="color"}=r,{nameKey:z=null}=r,{valueKey:A=null}=r,{idKey:R=null}=r,{select:D=!1}=r,{clickIgnore:F=!1}=r,{clickCenter:q=!1}=r,{selected:ee=null}=r,{hover:ie=!1}=r,{hovered:ne=null}=r,{highlight:se=!1}=r,{highlightKey:ue="highlighted"}=r,{highlighted:Ce=[]}=r,{order:ye=null}=r,{maxzoom:Xe=null}=r,{minzoom:ae=null}=r,{sourceLayer:Le=null}=r,{visible:Z=!0}=r;const{source:tt,layer:$t,promoteId:ft}=Ga("source"),{getMap:Jt}=Ga("map"),ut=Jt();Za("layer",{layer:n});const at=M_({id:null,feature:null,event:null});qu(c,at,Se=>a(34,l=Se)),Za("hover",at),R=R||ft,Le=Le||$t;let le=null,Ee=null,Re=[],Q={...E};E.visibility||(Q.visibility=Z?"visible":"none");let he={id:n,type:g,source:tt,paint:S,layout:Q};v&&(he.filter=v),Le&&(he["source-layer"]=Le),Xe&&(he.maxzoom=Xe),ae&&(he.minzoom=ae),Zu(()=>{ut.getLayer(n)&&ut.removeLayer(n),ut.addLayer(he,ye)});let it=[];function Ct(Se,ct=k){console.debug("updating colors...");for(const N of it)ut.setFeatureState({source:tt,sourceLayer:Le,id:N},{color:null,value:null});it=[];for(const N of Se)ut.setFeatureState({source:tt,sourceLayer:Le,id:N[R]},{color:ct?N[ct]:null,value:A?N[A]:null,name:z?N[z]:null}),it.push(N[R])}function bt(Se){ut.getLayer(n)&&ut.setFilter(n,Se)}function It(Se){if(ut.getLayer(n))for(const ct in Se)ut.setLayoutProperty(n,ct,Se[ct])}function Bt(Se){if(ut.getLayer(n))for(const ct in Se)ut.setPaintProperty(n,ct,Se[ct])}function Fe(Se){!E.visibility&&ut.getLayer(n)&&ut.setLayoutProperty(n,"visibility",Se?"visible":"none")}return D&&ut.on("click",n,Se=>{if(Se.features.length>0&&!F){let ct=Se.features[0];if(a(2,ee=ct.id),d("select",{id:ee,feature:ct,event:Se}),le&&ut.setFeatureState({source:tt,sourceLayer:Le,id:le},{selected:!1}),ut.setFeatureState({source:tt,sourceLayer:Le,id:ee},{selected:!0}),q){let N=centroid(Se.features[0].toJSON().geometry);ut.flyTo({center:N.geometry.coordinates})}a(26,le=ee)}}),ie&&(ut.on("mousemove",n,Se=>{if(Se.features.length>0){ne&&ut.setFeatureState({source:tt,sourceLayer:Le,id:ne},{hovered:!1});let ct=Se.features[0];a(0,ne=a(27,Ee=ct.id)),at.set({id:ne,feature:ct,event:Se}),d("hover",l),ut.setFeatureState({source:tt,sourceLayer:Le,id:ne},{hovered:!0}),ut.getCanvas().style.cursor="pointer"}}),ut.on("mouseleave",n,Se=>{ne&&ut.setFeatureState({source:tt,sourceLayer:Le,id:ne},{hovered:!1}),a(0,ne=a(27,Ee=null)),at.set({id:null,feature:null,event:Se}),d("hover",l),ut.getCanvas().style.cursor=""})),Hu(async()=>{ut&&ut.getLayer(n)&&ut.removeLayer(n)}),c.$$set=Se=>{"id"in Se&&a(5,n=Se.id),"type"in Se&&a(6,g=Se.type),"filter"in Se&&a(7,v=Se.filter),"layout"in Se&&a(8,E=Se.layout),"paint"in Se&&a(9,S=Se.paint),"data"in Se&&a(10,T=Se.data),"colorKey"in Se&&a(11,k=Se.colorKey),"nameKey"in Se&&a(12,z=Se.nameKey),"valueKey"in Se&&a(13,A=Se.valueKey),"idKey"in Se&&a(4,R=Se.idKey),"select"in Se&&a(14,D=Se.select),"clickIgnore"in Se&&a(15,F=Se.clickIgnore),"clickCenter"in Se&&a(16,q=Se.clickCenter),"selected"in Se&&a(2,ee=Se.selected),"hover"in Se&&a(17,ie=Se.hover),"hovered"in Se&&a(0,ne=Se.hovered),"highlight"in Se&&a(18,se=Se.highlight),"highlightKey"in Se&&a(19,ue=Se.highlightKey),"highlighted"in Se&&a(20,Ce=Se.highlighted),"order"in Se&&a(21,ye=Se.order),"maxzoom"in Se&&a(22,Xe=Se.maxzoom),"minzoom"in Se&&a(23,ae=Se.minzoom),"sourceLayer"in Se&&a(3,Le=Se.sourceLayer),"visible"in Se&&a(24,Z=Se.visible),"$$scope"in Se&&a(29,f=Se.$$scope)},c.$$.update=()=>{if(c.$$.dirty[0]&3072&&T&&Ct(T,k),c.$$.dirty[0]&128&&bt(v),c.$$.dirty[0]&256&&It(E),c.$$.dirty[0]&512&&Bt(S),c.$$.dirty[0]&16777216&&Fe(Z),c.$$.dirty[0]&270270472&&se&&Ce!=Re){if(Re[0])for(const Se of Re){let ct={};ct[ue]=!1,ut.setFeatureState({source:tt,sourceLayer:Le,id:Se},ct)}if(a(28,Re=Ce),Ce[0])for(const Se of Ce){let ct={};ct[ue]=!0,ut.setFeatureState({source:tt,sourceLayer:Le,id:Se},ct)}}c.$$.dirty[0]&67125260&&D&&ee!=le&&(le&&ut.setFeatureState({source:tt,sourceLayer:Le,id:le},{selected:!1}),ee&&ut.setFeatureState({source:tt,sourceLayer:Le,id:ee},{selected:!0}),a(26,le=ee)),c.$$.dirty[0]&134348809&&ie&&ne!=Ee&&(Ee&&ut.setFeatureState({source:tt,sourceLayer:Le,id:Ee},{hovered:!1}),ne&&ut.setFeatureState({source:tt,sourceLayer:Le,id:ne},{hovered:!0}),a(27,Ee=ne))},[ne,at,ee,Le,R,n,g,v,E,S,T,k,z,A,D,F,q,ie,se,ue,Ce,ye,Xe,ae,Z,Ct,le,Ee,Re,f,u]}class bf extends $i{constructor(r){super(),ji(this,r,K2,W2,Fi,{id:5,type:6,filter:7,layout:8,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:4,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function X2(c,r,a){let l,{content:u}=r;const f=new lc.Popup({closeButton:!1,closeOnClick:!1}),{getMap:d}=Ga("map"),n=d(),g=Ga("hover");qu(c,g,E=>a(2,l=E));function v(E,S){E.id?f.setLngLat(E.event.lngLat).setHTML(S||E.code).addTo(n):f.remove()}return Hu(()=>f.remove()),c.$$set=E=>{"content"in E&&a(1,u=E.content)},c.$$.update=()=>{c.$$.dirty&6&&v(l,u)},[g,u,l]}class J2 extends $i{constructor(r){super(),ji(this,r,X2,null,Fi,{content:1})}}function Bg(c,r,a){const l=c.slice();return l[8]=r[a],l[10]=a,l}function Og(c){let r,a,l,u,f,d=c[4](c[2][c[10]])+"",n;return{c(){r=$e("div"),a=mt(),l=$e("div"),u=mt(),f=$e("div"),n=Ut(d),this.h()},l(g){r=je(g,"DIV",{class:!0,style:!0}),et(r).forEach(J),a=gt(g),l=je(g,"DIV",{class:!0,style:!0}),et(l).forEach(J),u=gt(g),f=je(g,"DIV",{class:!0,style:!0});var v=et(f);n=Vt(v,d),v.forEach(J),this.h()},h(){_e(r,"class","block svelte-4k2wr9"),Ft(r,"width",100/(c[2].length-1)+"%"),Ft(r,"left",c[10]*(100/(c[2].length-1))+"%"),Ft(r,"background-color",c[3][c[10]]),_e(l,"class","line svelte-4k2wr9"),Ft(l,"left",c[10]*(100/(c[2].length-1))+"%"),_e(f,"class","tick svelte-4k2wr9"),Ft(f,"left",c[10]*(100/(c[2].length-1))+"%"),Ht(f,"tick-start",c[10]==0)},m(g,v){Ze(g,r,v),Ze(g,a,v),Ze(g,l,v),Ze(g,u,v),Ze(g,f,v),ze(f,n)},p(g,v){v&4&&Ft(r,"width",100/(g[2].length-1)+"%"),v&4&&Ft(r,"left",g[10]*(100/(g[2].length-1))+"%"),v&8&&Ft(r,"background-color",g[3][g[10]]),v&4&&Ft(l,"left",g[10]*(100/(g[2].length-1))+"%"),v&20&&d!==(d=g[4](g[2][g[10]])+"")&&bi(n,d),v&4&&Ft(f,"left",g[10]*(100/(g[2].length-1))+"%")},d(g){g&&(J(r),J(a),J(l),J(u),J(f))}}}function Fg(c){let r,a=`${c[7](c[0],c[2])}%`,l,u,f=c[5](c[0])+"",d,n;return{c(){r=$e("div"),l=mt(),u=$e("div"),d=Ut(f),n=Ut(c[6]),this.h()},l(g){r=je(g,"DIV",{class:!0}),et(r).forEach(J),l=gt(g),u=je(g,"DIV",{class:!0,style:!0});var v=et(u);d=Vt(v,f),n=Vt(v,c[6]),v.forEach(J),this.h()},h(){_e(r,"class","marker svelte-4k2wr9"),Ft(r,"left",a),_e(u,"class","value svelte-4k2wr9"),Ft(u,"left",c[7](c[0],c[2])+"%")},m(g,v){Ze(g,r,v),Ze(g,l,v),Ze(g,u,v),ze(u,d),ze(u,n)},p(g,v){v&5&&a!==(a=`${g[7](g[0],g[2])}%`)&&Ft(r,"left",a),v&33&&f!==(f=g[5](g[0])+"")&&bi(d,f),v&64&&bi(n,g[6]),v&5&&Ft(u,"left",g[7](g[0],g[2])+"%")},d(g){g&&(J(r),J(l),J(u))}}}function Y2(c){let r,a,l,u,f,d=c[4](c[2][c[2].length-1])+"",n,g,v,E=Pi(c[2].slice(1)),S=[];for(let k=0;k<E.length;k+=1)S[k]=Og(Bg(c,E,k));let T=typeof c[0]=="number"&&Fg(c);return{c(){r=$e("div");for(let k=0;k<S.length;k+=1)S[k].c();a=mt(),l=$e("div"),u=mt(),f=$e("div"),n=Ut(d),g=Ut(c[6]),v=mt(),T&&T.c(),this.h()},l(k){r=je(k,"DIV",{class:!0,style:!0});var z=et(r);for(let R=0;R<S.length;R+=1)S[R].l(z);a=gt(z),l=je(z,"DIV",{class:!0,style:!0}),et(l).forEach(J),u=gt(z),f=je(z,"DIV",{class:!0,style:!0});var A=et(f);n=Vt(A,d),g=Vt(A,c[6]),A.forEach(J),v=gt(z),T&&T.l(z),z.forEach(J),this.h()},h(){_e(l,"class","line svelte-4k2wr9"),Ft(l,"left","100%"),_e(f,"class","tick tick-end svelte-4k2wr9"),Ft(f,"left","100%"),_e(r,"class","container svelte-4k2wr9"),Ft(r,"height",c[1]+"px")},m(k,z){Ze(k,r,z);for(let A=0;A<S.length;A+=1)S[A]&&S[A].m(r,null);ze(r,a),ze(r,l),ze(r,u),ze(r,f),ze(f,n),ze(f,g),ze(r,v),T&&T.m(r,null)},p(k,[z]){if(z&28){E=Pi(k[2].slice(1));let A;for(A=0;A<E.length;A+=1){const R=Bg(k,E,A);S[A]?S[A].p(R,z):(S[A]=Og(R),S[A].c(),S[A].m(r,a))}for(;A<S.length;A+=1)S[A].d(1);S.length=E.length}z&20&&d!==(d=k[4](k[2][k[2].length-1])+"")&&bi(n,d),z&64&&bi(g,k[6]),typeof k[0]=="number"?T?T.p(k,z):(T=Fg(k),T.c(),T.m(r,null)):T&&(T.d(1),T=null),z&2&&Ft(r,"height",k[1]+"px")},i:Ci,o:Ci,d(k){k&&J(r),Pr(S,k),T&&T.d()}}}function Q2(c,r,a){let{hovered:l=null}=r,{height:u=15}=r,{breaks:f=[0,20,40,60,80,100]}=r,{colors:d=["rgba(234,236,177,.8)","rgba(169,216,145,.8)","rgba(0,167,186,.8)","rgba(0,78,166,.8)","rgba(0,13,84,.8)"]}=r,{formatTick:n=S=>S.toFixed(1)}=r,{formatVal:g=S=>S.toFixed(1)}=r,{suffix:v="%"}=r;const E=(S,T)=>{let k=0;for(;S>T[k+1];)k+=1;let z=100/(T.length-1),A=(S-T[k])/(T[k+1]-T[k]);return(k+A)*z};return c.$$set=S=>{"hovered"in S&&a(0,l=S.hovered),"height"in S&&a(1,u=S.height),"breaks"in S&&a(2,f=S.breaks),"colors"in S&&a(3,d=S.colors),"formatTick"in S&&a(4,n=S.formatTick),"formatVal"in S&&a(5,g=S.formatVal),"suffix"in S&&a(6,v=S.suffix)},[l,u,f,d,n,g,v,E]}class eE extends $i{constructor(r){super(),ji(this,r,Q2,Y2,Fi,{hovered:0,height:1,breaks:2,colors:3,formatTick:4,formatVal:5,suffix:6})}}function Ng(c,r,a){const l=c.slice();return l[1]=r[a],l[3]=a,l}function Ug(c){let r,a,l,u=c[1].name+"",f,d,n,g=c[1].value.toFixed(1)+"",v,E,S;return{c(){r=$e("tr"),a=$e("td"),l=$e("strong"),f=Ut(u),d=mt(),n=$e("td"),v=Ut(g),E=Ut("%"),S=mt(),this.h()},l(T){r=je(T,"TR",{});var k=et(r);a=je(k,"TD",{class:!0});var z=et(a);l=je(z,"STRONG",{});var A=et(l);f=Vt(A,u),A.forEach(J),z.forEach(J),d=gt(k),n=je(k,"TD",{class:!0});var R=et(n);v=Vt(R,g),E=Vt(R,"%"),R.forEach(J),S=gt(k),k.forEach(J),this.h()},h(){_e(a,"class","svelte-3y1mkq"),_e(n,"class","text-right svelte-3y1mkq")},m(T,k){Ze(T,r,k),ze(r,a),ze(a,l),ze(l,f),ze(r,d),ze(r,n),ze(n,v),ze(n,E),ze(r,S)},p(T,k){k&1&&u!==(u=T[1].name+"")&&bi(f,u),k&1&&g!==(g=T[1].value.toFixed(1)+"")&&bi(v,g)},d(T){T&&J(r)}}}function tE(c){let r,a,l=Pi(c[0]),u=[];for(let f=0;f<l.length;f+=1)u[f]=Ug(Ng(c,l,f));return{c(){r=$e("table"),a=$e("tbody");for(let f=0;f<u.length;f+=1)u[f].c();this.h()},l(f){r=je(f,"TABLE",{class:!0});var d=et(r);a=je(d,"TBODY",{});var n=et(a);for(let g=0;g<u.length;g+=1)u[g].l(n);n.forEach(J),d.forEach(J),this.h()},h(){_e(r,"class","table-rank text-small svelte-3y1mkq")},m(f,d){Ze(f,r,d),ze(r,a);for(let n=0;n<u.length;n+=1)u[n]&&u[n].m(a,null)},p(f,[d]){if(d&1){l=Pi(f[0]);let n;for(n=0;n<l.length;n+=1){const g=Ng(f,l,n);u[n]?u[n].p(g,d):(u[n]=Ug(g),u[n].c(),u[n].m(a,null))}for(;n<u.length;n+=1)u[n].d(1);u.length=l.length}},i:Ci,o:Ci,d(f){f&&J(r),Pr(u,f)}}}function iE(c,r,a){let{data:l}=r;return c.$$set=u=>{"data"in u&&a(0,l=u.data)},[l]}class oy extends $i{constructor(r){super(),ji(this,r,iE,tE,Fi,{data:0})}}function rE(c){let r,a,l,u,f="No data";return{c(){r=$e("div"),a=$e("div"),l=mt(),u=$e("div"),u.textContent=f,this.h()},l(d){r=je(d,"DIV",{class:!0,style:!0});var n=et(r);a=je(n,"DIV",{class:!0,style:!0}),et(a).forEach(J),l=gt(n),u=je(n,"DIV",{class:!0,"data-svelte-h":!0}),lr(u)!=="svelte-1n9tqdn"&&(u.textContent=f),n.forEach(J),this.h()},h(){_e(a,"class","block svelte-b1cp2z"),Ft(a,"width","100%"),Ft(a,"background-color",c[1]),_e(u,"class","tick svelte-b1cp2z"),_e(r,"class","container svelte-b1cp2z"),Ft(r,"height",c[0]+"px")},m(d,n){Ze(d,r,n),ze(r,a),ze(r,l),ze(r,u)},p(d,[n]){n&2&&Ft(a,"background-color",d[1]),n&1&&Ft(r,"height",d[0]+"px")},i:Ci,o:Ci,d(d){d&&J(r)}}}function nE(c,r,a){let{height:l=15}=r,{color:u="lightgrey"}=r;return c.$$set=f=>{"height"in f&&a(0,l=f.height),"color"in f&&a(1,u=f.color)},[l,u]}class sE extends $i{constructor(r){super(),ji(this,r,nE,rE,Fi,{height:0,color:1})}}function aE(c){let r,a=`People with the selected characteristics as a proportion of the whole
      population in each area.`;return{c(){r=$e("p"),r.textContent=a,this.h()},l(l){r=je(l,"P",{class:!0,"data-svelte-h":!0}),lr(r)!=="svelte-16szk9e"&&(r.textContent=a),this.h()},h(){_e(r,"class","subtitle svelte-d3fzt1")},m(l,u){Ze(l,r,u)},p:Ci,d(l){l&&J(r)}}}function Vg(c){let r,a;return r=new G2({props:{id:"lad",type:"geojson",data:c[0].geojson,promoteId:c[2].code,$$slots:{default:[lE]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&1&&(f.data=l[0].geojson),u&4&&(f.promoteId=l[2].code),u&8321&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function oE(c){let r,a;return r=new J2({props:{content:c[8](c[7])}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&128&&(f.content=l[8](l[7])),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function lE(c){let r,a,l,u,f,d,n;function g(E){c[9](E)}let v={id:"lad-fill",data:c[0].geoPerc,idKey:"code",nameKey:"name",valueKey:"value",hover:!0,tooltip:!0,type:"fill",paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"],"fill-opacity":.8},order:"place_other",$$slots:{default:[oE]},$$scope:{ctx:c}};return c[7]!==void 0&&(v.hovered=c[7]),r=new bf({props:v}),yc.push(()=>Wu(r,"hovered",g)),u=new bf({props:{id:"lad-line",type:"line",paint:{"line-color":"white","line-width":.3},order:"place_other"}}),d=new bf({props:{id:"lad-hover",type:"line",paint:{"line-color":"black","line-width":2,"line-opacity":["case",["==",["feature-state","hovered"],!0],1,0]},order:"place_other"}}),{c(){ii(r.$$.fragment),l=mt(),ii(u.$$.fragment),f=mt(),ii(d.$$.fragment)},l(E){si(r.$$.fragment,E),l=gt(E),si(u.$$.fragment,E),f=gt(E),si(d.$$.fragment,E)},m(E,S){ri(r,E,S),Ze(E,l,S),ri(u,E,S),Ze(E,f,S),ri(d,E,S),n=!0},p(E,S){const T={};S&1&&(T.data=E[0].geoPerc),S&8320&&(T.$$scope={dirty:S,ctx:E}),!a&&S&128&&(a=!0,T.hovered=E[7],Gu(()=>a=!1)),r.$set(T)},i(E){n||(Ye(r.$$.fragment,E),Ye(u.$$.fragment,E),Ye(d.$$.fragment,E),n=!0)},o(E){st(r.$$.fragment,E),st(u.$$.fragment,E),st(d.$$.fragment,E),n=!1},d(E){E&&(J(l),J(f)),ni(r,E),ni(u,E),ni(d,E)}}}function cE(c){let r,a,l=c[0].geojson&&c[0].geoPerc&&Vg(c);return{c(){l&&l.c(),r=oi()},l(u){l&&l.l(u),r=oi()},m(u,f){l&&l.m(u,f),Ze(u,r,f),a=!0},p(u,f){u[0].geojson&&u[0].geoPerc?l?(l.p(u,f),f&1&&Ye(l,1)):(l=Vg(u),l.c(),Ye(l,1),l.m(r.parentNode,r)):l&&(Ni(),st(l,1,1,()=>{l=null}),Ui())},i(u){a||(Ye(l),a=!0)},o(u){st(l),a=!1},d(u){u&&J(r),l&&l.d(u)}}}function $g(c){let r,a,l,u,f=c[0].geoPerc.some(qg),d;l=new eE({props:{breaks:c[0].geoBreaks,hovered:c[7]&&c[0].geoPerc.find(c[10])?c[0].geoPerc.find(c[11]).value:null,colors:c[0].geoBreaks[1]==100?[c[6].seq[4]]:c[6].seq}});let n=f&&jg();return{c(){r=$e("div"),a=$e("div"),ii(l.$$.fragment),u=mt(),n&&n.c(),this.h()},l(g){r=je(g,"DIV",{class:!0});var v=et(r);a=je(v,"DIV",{class:!0});var E=et(a);si(l.$$.fragment,E),E.forEach(J),u=gt(v),n&&n.l(v),v.forEach(J),this.h()},h(){_e(a,"class","map-legend-breaks svelte-d3fzt1"),_e(r,"class","map-legend svelte-d3fzt1")},m(g,v){Ze(g,r,v),ze(r,a),ri(l,a,null),ze(r,u),n&&n.m(r,null),d=!0},p(g,v){const E={};v&1&&(E.breaks=g[0].geoBreaks),v&129&&(E.hovered=g[7]&&g[0].geoPerc.find(g[10])?g[0].geoPerc.find(g[11]).value:null),v&65&&(E.colors=g[0].geoBreaks[1]==100?[g[6].seq[4]]:g[6].seq),l.$set(E),v&1&&(f=g[0].geoPerc.some(qg)),f?n?v&1&&Ye(n,1):(n=jg(),n.c(),Ye(n,1),n.m(r,null)):n&&(Ni(),st(n,1,1,()=>{n=null}),Ui())},i(g){d||(Ye(l.$$.fragment,g),Ye(n),d=!0)},o(g){st(l.$$.fragment,g),st(n),d=!1},d(g){g&&J(r),ni(l),n&&n.d()}}}function jg(c){let r,a,l;return a=new sE({}),{c(){r=$e("div"),ii(a.$$.fragment),this.h()},l(u){r=je(u,"DIV",{class:!0});var f=et(r);si(a.$$.fragment,f),f.forEach(J),this.h()},h(){_e(r,"class","map-legend-nodata svelte-d3fzt1")},m(u,f){Ze(u,r,f),ri(a,r,null),l=!0},i(u){l||(Ye(a.$$.fragment,u),l=!0)},o(u){st(a.$$.fragment,u),l=!1},d(u){u&&J(r),ni(a)}}}function uE(c){let r,a,l,u,f;a=new $2({props:{css:qo+"/css/maplibre-gl.css",style:c[1],location:{bounds:c[3]},options:{maxBounds:c[4],preserveDrawingBuffer:!0,cooperativeGestures:!0},maxzoom:10,controls:!0,$$slots:{default:[cE]},$$scope:{ctx:c}}});let d=c[0].geoBreaks&&c[0].geoPerc&&$g(c);return{c(){r=$e("div"),ii(a.$$.fragment),l=mt(),d&&d.c(),u=oi(),this.h()},l(n){r=je(n,"DIV",{});var g=et(r);si(a.$$.fragment,g),g.forEach(J),l=gt(n),d&&d.l(n),u=oi(),this.h()},h(){Ft(r,"height","450px")},m(n,g){Ze(n,r,g),ri(a,r,null),Ze(n,l,g),d&&d.m(n,g),Ze(n,u,g),f=!0},p(n,g){const v={};g&2&&(v.style=n[1]),g&8&&(v.location={bounds:n[3]}),g&16&&(v.options={maxBounds:n[4],preserveDrawingBuffer:!0,cooperativeGestures:!0}),g&8325&&(v.$$scope={dirty:g,ctx:n}),a.$set(v),n[0].geoBreaks&&n[0].geoPerc?d?(d.p(n,g),g&1&&Ye(d,1)):(d=$g(n),d.c(),Ye(d,1),d.m(u.parentNode,u)):d&&(Ni(),st(d,1,1,()=>{d=null}),Ui())},i(n){f||(Ye(a.$$.fragment,n),Ye(d),f=!0)},o(n){st(a.$$.fragment,n),st(d),f=!1},d(n){n&&(J(r),J(l),J(u)),ni(a),d&&d.d(n)}}}function hE(c){let r,a="Make a selection to see rankings.";return{c(){r=$e("span"),r.textContent=a,this.h()},l(l){r=je(l,"SPAN",{class:!0,"data-svelte-h":!0}),lr(r)!=="svelte-14ggolm"&&(r.textContent=a),this.h()},h(){_e(r,"class","muted svelte-d3fzt1")},m(l,u){Ze(l,r,u)},p:Ci,i:Ci,o:Ci,d(l){l&&J(r)}}}function fE(c){let r,a;return r=new oy({props:{data:[...c[0].geoPerc].filter(Zg).sort(Gg).slice(0,5)}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&1&&(f.data=[...l[0].geoPerc].filter(Zg).sort(Gg).slice(0,5)),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function dE(c){let r,a,l,u;const f=[fE,hE],d=[];function n(g,v){return g[0].geoPerc&&g[5][0]?0:1}return r=n(c),a=d[r]=f[r](c),{c(){a.c(),l=oi()},l(g){a.l(g),l=oi()},m(g,v){d[r].m(g,v),Ze(g,l,v),u=!0},p(g,v){let E=r;r=n(g),r===E?d[r].p(g,v):(Ni(),st(d[E],1,1,()=>{d[E]=null}),Ui(),a=d[r],a?a.p(g,v):(a=d[r]=f[r](g),a.c()),Ye(a,1),a.m(l.parentNode,l))},i(g){u||(Ye(a),u=!0)},o(g){st(a),u=!1},d(g){g&&J(l),d[r].d(g)}}}function pE(c){let r,a="Make a selection to see rankings.";return{c(){r=$e("span"),r.textContent=a,this.h()},l(l){r=je(l,"SPAN",{class:!0,"data-svelte-h":!0}),lr(r)!=="svelte-14ggolm"&&(r.textContent=a),this.h()},h(){_e(r,"class","muted svelte-d3fzt1")},m(l,u){Ze(l,r,u)},p:Ci,i:Ci,o:Ci,d(l){l&&J(r)}}}function mE(c){let r,a;return r=new oy({props:{data:c[0].geoPerc.filter(Hg).sort(Wg).slice(-5)}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&1&&(f.data=l[0].geoPerc.filter(Hg).sort(Wg).slice(-5)),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function gE(c){let r,a,l,u;const f=[mE,pE],d=[];function n(g,v){return g[0].geoPerc&&g[5][0]?0:1}return r=n(c),a=d[r]=f[r](c),{c(){a.c(),l=oi()},l(g){a.l(g),l=oi()},m(g,v){d[r].m(g,v),Ze(g,l,v),u=!0},p(g,v){let E=r;r=n(g),r===E?d[r].p(g,v):(Ni(),st(d[E],1,1,()=>{d[E]=null}),Ui(),a=d[r],a?a.p(g,v):(a=d[r]=f[r](g),a.c()),Ye(a,1),a.m(l.parentNode,l))},i(g){u||(Ye(a),u=!0)},o(g){st(a),u=!1},d(g){g&&J(l),d[r].d(g)}}}function _E(c){let r,a,l,u,f,d,n,g;return r=new Ts({props:{colspan:3,rowspan:1,noBackground:!0,$$slots:{default:[aE]},$$scope:{ctx:c}}}),l=new Ts({props:{colspan:2,rowspan:2,noBackground:!0,$$slots:{default:[uE]},$$scope:{ctx:c}}}),f=new Ts({props:{title:"Areas with high %",$$slots:{default:[dE]},$$scope:{ctx:c}}}),n=new Ts({props:{title:"Areas with low %",$$slots:{default:[gE]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment),a=mt(),ii(l.$$.fragment),u=mt(),ii(f.$$.fragment),d=mt(),ii(n.$$.fragment)},l(v){si(r.$$.fragment,v),a=gt(v),si(l.$$.fragment,v),u=gt(v),si(f.$$.fragment,v),d=gt(v),si(n.$$.fragment,v)},m(v,E){ri(r,v,E),Ze(v,a,E),ri(l,v,E),Ze(v,u,E),ri(f,v,E),Ze(v,d,E),ri(n,v,E),g=!0},p(v,E){const S={};E&8192&&(S.$$scope={dirty:E,ctx:v}),r.$set(S);const T={};E&8415&&(T.$$scope={dirty:E,ctx:v}),l.$set(T);const k={};E&8225&&(k.$$scope={dirty:E,ctx:v}),f.$set(k);const z={};E&8225&&(z.$$scope={dirty:E,ctx:v}),n.$set(z)},i(v){g||(Ye(r.$$.fragment,v),Ye(l.$$.fragment,v),Ye(f.$$.fragment,v),Ye(n.$$.fragment,v),g=!0)},o(v){st(r.$$.fragment,v),st(l.$$.fragment,v),st(f.$$.fragment,v),st(n.$$.fragment,v),g=!1},d(v){v&&(J(a),J(u),J(d)),ni(r,v),ni(l,v),ni(f,v),ni(n,v)}}}function yE(c){let r,a;return r=new Rf({props:{title:"Population by area",height:"auto",cls:"ons-cards pgp-map-tiles",$$slots:{default:[_E]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,[u]){const f={};u&8447&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}const qg=c=>c.value===null,Zg=c=>c.value!=null,Gg=(c,r)=>r.value-c.value,Hg=c=>c.value!=null,Wg=(c,r)=>r.value-c.value;function vE(c,r,a){let l,{data:u}=r,{mapStyle:f}=r,{ladBounds:d}=r,{mapBounds:n}=r,{maxBounds:g}=r,{selected:v}=r,{colors:E}=r,S;const T=R=>{var F;let D="";if(R){D=`<b>${u.geoCodesLookup[S].name}</b><br/>`;const q=(F=l==null?void 0:l[R])==null?void 0:F.value;D+=q!=null?`${q}%`:"No data"}return D};function k(R){S=R,a(7,S)}const z=R=>R.code==S,A=R=>R.code==S;return c.$$set=R=>{"data"in R&&a(0,u=R.data),"mapStyle"in R&&a(1,f=R.mapStyle),"ladBounds"in R&&a(2,d=R.ladBounds),"mapBounds"in R&&a(3,n=R.mapBounds),"maxBounds"in R&&a(4,g=R.maxBounds),"selected"in R&&a(5,v=R.selected),"colors"in R&&a(6,E=R.colors)},c.$$.update=()=>{c.$$.dirty&1&&(l=(R=>{const D={};return Array.isArray(R)&&R.forEach(F=>D[F.code]=F),D})(u.geoPerc))},[u,f,d,n,g,v,E,S,T,k,z,A]}class bE extends $i{constructor(r){super(),ji(this,r,vE,yE,Fi,{data:0,mapStyle:1,ladBounds:2,mapBounds:3,maxBounds:4,selected:5,colors:6})}}function Kg(c){let r,a;return r=new Ts({props:{title:c[0],$$slots:{default:[EE]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&1&&(f.title=l[0]),u&30&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function wE(c){let r,a,l;var u=c[3];function f(d,n){return{props:{data:d[2].selected&&Uu("residents",d[1].code,d[2]),showLegend:!1}}}return u&&(r=em(u,f(c))),{c(){r&&ii(r.$$.fragment),a=oi()},l(d){r&&si(r.$$.fragment,d),a=oi()},m(d,n){r&&ri(r,d,n),Ze(d,a,n),l=!0},p(d,n){if(n&8&&u!==(u=d[3])){if(r){Ni();const g=r;st(g.$$.fragment,1,0,()=>{ni(g,1)}),Ui()}u?(r=em(u,f(d)),ii(r.$$.fragment),Ye(r.$$.fragment,1),ri(r,a.parentNode,a)):r=null}else if(u){const g={};n&6&&(g.data=d[2].selected&&Uu("residents",d[1].code,d[2])),r.$set(g)}},i(d){l||(r&&Ye(r.$$.fragment,d),l=!0)},o(d){r&&st(r.$$.fragment,d),l=!1},d(d){d&&J(a),r&&ni(r,d)}}}function xE(c){let r,a=Df.nodata+"",l;return{c(){r=$e("span"),l=Ut(a),this.h()},l(u){r=je(u,"SPAN",{class:!0});var f=et(r);l=Vt(f,a),f.forEach(J),this.h()},h(){_e(r,"class","num-desc svelte-1yn8adz")},m(u,f){Ze(u,r,f),ze(r,l)},p:Ci,i:Ci,o:Ci,d(u){u&&J(r)}}}function EE(c){let r,a,l,u,f,d=c[1].populationBase+"",n,g;const v=[xE,wE],E=[];function S(T,k){return T[2].statusOfVariables[T[1].code]!=="available"?0:1}return r=S(c),a=E[r]=v[r](c),{c(){a.c(),l=mt(),u=$e("span"),f=Ut("% of "),n=Ut(d),this.h()},l(T){a.l(T),l=gt(T),u=je(T,"SPAN",{class:!0});var k=et(u);f=Vt(k,"% of "),n=Vt(k,d),k.forEach(J),this.h()},h(){_e(u,"class","num-desc svelte-1yn8adz")},m(T,k){E[r].m(T,k),Ze(T,l,k),Ze(T,u,k),ze(u,f),ze(u,n),g=!0},p(T,k){let z=r;r=S(T),r===z?E[r].p(T,k):(Ni(),st(E[z],1,1,()=>{E[z]=null}),Ui(),a=E[r],a?a.p(T,k):(a=E[r]=v[r](T),a.c()),Ye(a,1),a.m(l.parentNode,l)),(!g||k&2)&&d!==(d=T[1].populationBase+"")&&bi(n,d)},i(T){g||(Ye(a),g=!0)},o(T){st(a),g=!1},d(T){T&&(J(l),J(u)),E[r].d(T)}}}function SE(c){var u,f;let r,a,l=((f=(u=c[2].selected.residents)==null?void 0:u[c[1].code])==null?void 0:f.values)&&Kg(c);return{c(){l&&l.c(),r=oi()},l(d){l&&l.l(d),r=oi()},m(d,n){l&&l.m(d,n),Ze(d,r,n),a=!0},p(d,[n]){var g,v;(v=(g=d[2].selected.residents)==null?void 0:g[d[1].code])!=null&&v.values?l?(l.p(d,n),n&6&&Ye(l,1)):(l=Kg(d),l.c(),Ye(l,1),l.m(r.parentNode,r)):l&&(Ni(),st(l,1,1,()=>{l=null}),Ui())},i(d){a||(Ye(l),a=!0)},o(d){st(l),a=!1},d(d){d&&J(r),l&&l.d(d)}}}function kE(c,r,a){let{title:l}=r,{table:u}=r,{data:f}=r,{chart_type:d}=r;return c.$$set=n=>{"title"in n&&a(0,l=n.title),"table"in n&&a(1,u=n.table),"data"in n&&a(2,f=n.data),"chart_type"in n&&a(3,d=n.chart_type)},[l,u,f,d]}class ly extends $i{constructor(r){super(),ji(this,r,kE,SE,Fi,{title:0,table:1,data:2,chart_type:3})}}function TE(c){let r,a;const l=c[5].default,u=Tr(l,c,c[4],null);return{c(){r=$e("mark"),u&&u.c(),this.h()},l(f){r=je(f,"MARK",{class:!0,style:!0,role:!0});var d=et(r);u&&u.l(d),d.forEach(J),this.h()},h(){_e(r,"class","em svelte-1602h77"),Ft(r,"background-color",c[0]),Ft(r,"color",c[2]),_e(r,"role","presentation"),Ht(r,"nowrap",c[1])},m(f,d){Ze(f,r,d),u&&u.m(r,null),a=!0},p(f,[d]){u&&u.p&&(!a||d&16)&&Cr(u,l,f,f[4],a?Ar(l,f[4],d,null):Ir(f[4]),null),(!a||d&1)&&Ft(r,"background-color",f[0]),(!a||d&4)&&Ft(r,"color",f[2]),(!a||d&2)&&Ht(r,"nowrap",f[1])},i(f){a||(Ye(u,f),a=!0)},o(f){st(u,f),a=!1},d(f){f&&J(r),u&&u.d(f)}}}function CE(c,r,a){let l,{$$slots:u={},$$scope:f}=r,{color:d="lightgrey"}=r,{nowrap:n=!0}=r;function g(E){return(E[0]*299+E[1]*587+E[2]*114)/1e3>125?"black":"white"}let v="black";return c.$$set=E=>{"color"in E&&a(0,d=E.color),"nowrap"in E&&a(1,n=E.nowrap),"$$scope"in E&&a(4,f=E.$$scope)},c.$$.update=()=>{c.$$.dirty&1&&a(3,l=pv(d).rgb),c.$$.dirty&8&&l&&a(2,v=g(l))},[d,n,v,l,f,u]}class IE extends $i{constructor(r){super(),ji(this,r,CE,TE,Fi,{color:0,nowrap:1})}}function AE(c){let r,a=c[0].selected.total_pop.count.toLocaleString()+"",l,u,f,d="people",n,g,v,E,S;return v=new IE({props:{color:"lightgrey",$$slots:{default:[zE]},$$scope:{ctx:c}}}),{c(){r=$e("div"),l=Ut(a),u=mt(),f=$e("div"),f.textContent=d,n=mt(),g=$e("div"),ii(v.$$.fragment),E=Ut(" of the total population of England and Wales"),this.h()},l(T){r=je(T,"DIV",{class:!0});var k=et(r);l=Vt(k,a),k.forEach(J),u=gt(T),f=je(T,"DIV",{class:!0,"data-svelte-h":!0}),lr(f)!=="svelte-hz5rwm"&&(f.textContent=d),n=gt(T),g=je(T,"DIV",{class:!0});var z=et(g);si(v.$$.fragment,z),E=Vt(z," of the total population of England and Wales"),z.forEach(J),this.h()},h(){_e(r,"class","num-big svelte-fj5nm7"),_e(f,"class","num-suffix svelte-fj5nm7"),_e(g,"class","num-desc svelte-fj5nm7")},m(T,k){Ze(T,r,k),ze(r,l),Ze(T,u,k),Ze(T,f,k),Ze(T,n,k),Ze(T,g,k),ri(v,g,null),ze(g,E),S=!0},p(T,k){(!S||k&1)&&a!==(a=T[0].selected.total_pop.count.toLocaleString()+"")&&bi(l,a);const z={};k&3&&(z.$$scope={dirty:k,ctx:T}),v.$set(z)},i(T){S||(Ye(v.$$.fragment,T),S=!0)},o(T){st(v.$$.fragment,T),S=!1},d(T){T&&(J(r),J(u),J(f),J(n),J(g)),ni(v)}}}function PE(c){let r,a=Df.nodata+"",l;return{c(){r=$e("div"),l=Ut(a),this.h()},l(u){r=je(u,"DIV",{class:!0});var f=et(r);l=Vt(f,a),f.forEach(J),this.h()},h(){_e(r,"class","num-desc svelte-fj5nm7")},m(u,f){Ze(u,r,f),ze(r,l)},p:Ci,i:Ci,o:Ci,d(u){u&&J(r)}}}function zE(c){let r=eg(c[0].selected.total_pop.percent)+"",a,l;return{c(){a=Ut(r),l=Ut("%")},l(u){a=Vt(u,r),l=Vt(u,"%")},m(u,f){Ze(u,a,f),Ze(u,l,f)},p(u,f){f&1&&r!==(r=eg(u[0].selected.total_pop.percent)+"")&&bi(a,r)},d(u){u&&(J(a),J(l))}}}function ME(c){let r,a,l,u;const f=[PE,AE],d=[];function n(g,v){return g[0].selected.total_pop.count==null?0:1}return r=n(c),a=d[r]=f[r](c),{c(){a.c(),l=oi()},l(g){a.l(g),l=oi()},m(g,v){d[r].m(g,v),Ze(g,l,v),u=!0},p(g,v){let E=r;r=n(g),r===E?d[r].p(g,v):(Ni(),st(d[E],1,1,()=>{d[E]=null}),Ui(),a=d[r],a?a.p(g,v):(a=d[r]=f[r](g),a.c()),Ye(a,1),a.m(l.parentNode,l))},i(g){u||(Ye(a),u=!0)},o(g){st(a),u=!1},d(g){g&&J(l),d[r].d(g)}}}function DE(c){let r,a;return r=new Ts({props:{title:"Population",$$slots:{default:[ME]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,[u]){const f={};u&3&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function LE(c,r,a){let{data:l}=r;return c.$$set=u=>{"data"in u&&a(0,l=u.data)},[l]}class RE extends $i{constructor(r){super(),ji(this,r,LE,DE,Fi,{data:0})}}function BE(c){let r,a,l,u,f=`translateX(${c[3]/c[1]+(c[1]-c[4])}px)`,d,n=`${c[2]}px`,g=`${c[4]}px`;return{c(){r=$e("div"),a=Ut(c[0]),l=mt(),u=$e("div"),this.h()},l(v){r=je(v,"DIV",{class:!0});var E=et(r);a=Vt(E,c[0]),l=gt(E),u=je(E,"DIV",{class:!0}),et(u).forEach(J),E.forEach(J),this.h()},h(){_e(u,"class","caret svelte-1491tb3"),Ft(u,"transform",f),_e(r,"class","tooltip svelte-1491tb3"),I_(()=>c[6].call(r)),Ft(r,"top",n),Ft(r,"left",g)},m(v,E){Ze(v,r,E),ze(r,a),ze(r,l),ze(r,u),d=A_(r,c[6].bind(r))},p(v,[E]){E&1&&bi(a,v[0]),E&26&&f!==(f=`translateX(${v[3]/v[1]+(v[1]-v[4])}px)`)&&Ft(u,"transform",f),E&4&&n!==(n=`${v[2]}px`)&&Ft(r,"top",n),E&16&&g!==(g=`${v[4]}px`)&&Ft(r,"left",g)},i:Ci,o:Ci,d(v){v&&J(r),d()}}}const Iu=4;function OE(c,r,a){let l,{title:u}=r,{x:f}=r,{y:d}=r,{width:n}=r,g;function v(){g=this.clientWidth,a(3,g)}return c.$$set=E=>{"title"in E&&a(0,u=E.title),"x"in E&&a(1,f=E.x),"y"in E&&a(2,d=E.y),"width"in E&&a(5,n=E.width)},c.$$.update=()=>{c.$$.dirty&42&&a(4,l=g&&f+g/2>n-Iu?n-g/2-Iu:g&&f-g/2<0+Iu?g/2+Iu:f)},[u,f,d,g,l,n,v]}class FE extends $i{constructor(r){super(),ji(this,r,OE,BE,Fi,{title:0,x:1,y:2,width:5})}}function NE(c){let r,a;function l(f){r=c.getAttribute("title"),c.removeAttribute("title");let d=document.body.getBoundingClientRect(),n=c.getBoundingClientRect(),g=n.bottom,v=(n.left+n.right)/2;a=new FE({props:{title:r,x:v,y:g-d.y,width:d.width},target:document.body})}function u(){a.$destroy(),c.setAttribute("title",r)}return c.addEventListener("mouseover",l),c.addEventListener("mouseout",u),{destroy(){a&&a.$destroy(),c.removeEventListener("mouseover",l),c.removeEventListener("mouseout",u)}}}function Xg(c,r,a){const l=c.slice();return l[18]=r[a],l[20]=a,l}function Jg(c,r,a){const l=c.slice();return l[21]=r[a],l[23]=a,l}function Yg(c,r,a){const l=c.slice();return l[21]=r[a],l[23]=a,l}function Qg(c,r,a){const l=c.slice();return l[25]=r[a],l[20]=a,l}function e_(c,r,a){const l=c.slice();return l[27]=r[a],l}function t_(c){let r,a,l=c[27].category+"",u,f,d,n=c[27].selected_value+"",g,v,E,S=c[27].all_value+"",T,k;return{c(){r=$e("tr"),a=$e("td"),u=Ut(l),f=mt(),d=$e("td"),g=Ut(n),v=mt(),E=$e("td"),T=Ut(S),k=mt()},l(z){r=je(z,"TR",{});var A=et(r);a=je(A,"TD",{});var R=et(a);u=Vt(R,l),R.forEach(J),f=gt(A),d=je(A,"TD",{});var D=et(d);g=Vt(D,n),D.forEach(J),v=gt(A),E=je(A,"TD",{});var F=et(E);T=Vt(F,S),F.forEach(J),k=gt(A),A.forEach(J)},m(z,A){Ze(z,r,A),ze(r,a),ze(a,u),ze(r,f),ze(r,d),ze(d,g),ze(r,v),ze(r,E),ze(E,T),ze(r,k)},p(z,A){A&1024&&l!==(l=z[27].category+"")&&bi(u,l),A&1024&&n!==(n=z[27].selected_value+"")&&bi(g,n),A&1024&&S!==(S=z[27].all_value+"")&&bi(T,S)},d(z){z&&J(r)}}}function i_(c){let r,a=Pi(c[12]),l=[];for(let u=0;u<a.length;u+=1)l[u]=r_(Qg(c,a,u));return{c(){r=$e("ul");for(let u=0;u<l.length;u+=1)l[u].c();this.h()},l(u){r=je(u,"UL",{class:!0});var f=et(r);for(let d=0;d<l.length;d+=1)l[d].l(f);f.forEach(J),this.h()},h(){_e(r,"class","legend-block svelte-8c0efj")},m(u,f){Ze(u,r,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(r,null)},p(u,f){if(f&4112){a=Pi(u[12]);let d;for(d=0;d<a.length;d+=1){const n=Qg(u,a,d);l[d]?l[d].p(n,f):(l[d]=r_(n),l[d].c(),l[d].m(r,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},d(u){u&&J(r),Pr(l,u)}}}function r_(c){let r,a,l=`${c[20]==0?0:c[4]}px`,u,f,d=c[25]+"",n,g;return{c(){r=$e("li"),a=$e("div"),u=mt(),f=$e("span"),n=Ut(d),g=mt(),this.h()},l(v){r=je(v,"LI",{class:!0});var E=et(r);a=je(E,"DIV",{class:!0}),et(a).forEach(J),u=gt(E),f=je(E,"SPAN",{class:!0});var S=et(f);n=Vt(S,d),S.forEach(J),g=gt(E),E.forEach(J),this.h()},h(){_e(a,"class","legend-vis "+(c[20]==0?"bar":"marker-vis")+" svelte-8c0efj"),Ft(a,"border-bottom-width",l),_e(f,"class",dc(c[20]==0?"bold":"brackets")+" svelte-8c0efj"),_e(r,"class","svelte-8c0efj")},m(v,E){Ze(v,r,E),ze(r,a),ze(r,u),ze(r,f),ze(f,n),ze(r,g)},p(v,E){E&16&&l!==(l=`${v[20]==0?0:v[4]}px`)&&Ft(a,"border-bottom-width",l),E&4096&&d!==(d=v[25]+"")&&bi(n,d)},d(v){v&&J(r)}}}function UE(c){let r,a=Pi(c[18].values),l=[];for(let u=0;u<a.length;u+=1)l[u]=n_(Jg(c,a,u));return{c(){for(let u=0;u<l.length;u+=1)l[u].c();r=oi()},l(u){for(let f=0;f<l.length;f+=1)l[f].l(u);r=oi()},m(u,f){for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(u,f);Ze(u,r,f)},p(u,f){if(f&10770){a=Pi(u[18].values);let d;for(d=0;d<a.length;d+=1){const n=Jg(u,a,d);l[d]?l[d].p(n,f):(l[d]=n_(n),l[d].c(),l[d].m(r.parentNode,r))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},d(u){u&&J(r),Pr(l,u)}}}function VE(c){let r,a=Pi(c[18].values),l=[];for(let u=0;u<a.length;u+=1)l[u]=s_(Yg(c,a,u));return{c(){for(let u=0;u<l.length;u+=1)l[u].c();r=oi()},l(u){for(let f=0;f<l.length;f+=1)l[f].l(u);r=oi()},m(u,f){for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(u,f);Ze(u,r,f)},p(u,f){if(f&10759){a=Pi(u[18].values);let d;for(d=0;d<a.length;d+=1){const n=Yg(u,a,d);l[d]?l[d].p(n,f):(l[d]=s_(n),l[d].c(),l[d].m(r.parentNode,r))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},d(u){u&&J(r),Pr(l,u)}}}function n_(c){let r,a=`calc(${c[11](c[21][c[1]])}% - ${c[4]/2}px)`,l=`${c[23]/c[13].length*100}%`,u=`calc(${1/c[13].length*100}% - 2px)`,f=`${c[4]}px`;return{c(){r=$e("div"),this.h()},l(d){r=je(d,"DIV",{class:!0}),et(r).forEach(J),this.h()},h(){_e(r,"class","marker svelte-8c0efj"),Ft(r,"bottom",a),Ft(r,"height","0px"),Ft(r,"left",l),Ft(r,"width",u),Ft(r,"border-bottom-width",f)},m(d,n){Ze(d,r,n)},p(d,n){n&2578&&a!==(a=`calc(${d[11](d[21][d[1]])}% - ${d[4]/2}px)`)&&Ft(r,"bottom",a),n&8192&&l!==(l=`${d[23]/d[13].length*100}%`)&&Ft(r,"left",l),n&8192&&u!==(u=`calc(${1/d[13].length*100}% - 2px)`)&&Ft(r,"width",u),n&16&&f!==(f=`${d[4]}px`)&&Ft(r,"border-bottom-width",f)},d(d){d&&J(r)}}}function s_(c){let r,a,l=`${c[11](c[21][c[1]])}%`,u=`calc(${c[23]/c[13].length*100}%)`,f=`calc(${1/c[13].length*100}% - 2px)`,d,n;return{c(){r=$e("div"),this.h()},l(g){r=je(g,"DIV",{title:!0,class:!0}),et(r).forEach(J),this.h()},h(){_e(r,"title",a=`${c[21][c[0]]}: ${c[2](c[21][c[1]])}%`+(c[9].length>1?` (${c[2](c[9][c[20]+1].values[c[23]][c[1]])}%)`:"")),_e(r,"class","bar svelte-8c0efj"),Ft(r,"bottom","0"),Ft(r,"height",l),Ft(r,"left",u),Ft(r,"width",f)},m(g,v){Ze(g,r,v),d||(n=P_(NE.call(null,r)),d=!0)},p(g,v){v&519&&a!==(a=`${g[21][g[0]]}: ${g[2](g[21][g[1]])}%`+(g[9].length>1?` (${g[2](g[9][g[20]+1].values[g[23]][g[1]])}%)`:""))&&_e(r,"title",a),v&2562&&l!==(l=`${g[11](g[21][g[1]])}%`)&&Ft(r,"height",l),v&8192&&u!==(u=`calc(${g[23]/g[13].length*100}%)`)&&Ft(r,"left",u),v&8192&&f!==(f=`calc(${1/g[13].length*100}% - 2px)`)&&Ft(r,"width",f)},d(g){g&&J(r),d=!1,n()}}}function a_(c){let r;function a(f,d){return f[20]==0?VE:UE}let u=a(c)(c);return{c(){u.c(),r=oi()},l(f){u.l(f),r=oi()},m(f,d){u.m(f,d),Ze(f,r,d)},p(f,d){u.p(f,d)},d(f){f&&J(r),u.d(f)}}}function o_(c){let r,a,l;return{c(){r=$e("small"),a=Ut(c[6]),l=Ut(c[7]),this.h()},l(u){r=je(u,"SMALL",{class:!0});var f=et(r);a=Vt(f,c[6]),l=Vt(f,c[7]),f.forEach(J),this.h()},h(){_e(r,"class","svelte-8c0efj")},m(u,f){Ze(u,r,f),ze(r,a),ze(r,l)},p(u,f){f&64&&bi(a,u[6]),f&128&&bi(l,u[7])},d(u){u&&J(r)}}}function $E(c){let r,a,l="<tr><th>Age group</th><th>Proportion of selected group</th><th>Proportion of whole population</th></tr>",u,f,d,n,g,v,E=`${c[3]}px`,S,T,k,z=c[5][0]+"",A,R,D,F=c[5][1]+"",q,ee,ie,ne=Pi(c[10]||[]),se=[];for(let ae=0;ae<ne.length;ae+=1)se[ae]=t_(e_(c,ne,ae));let ue=c[8]&&c[12][1]&&i_(c),Ce=Pi(c[9]),ye=[];for(let ae=0;ae<Ce.length;ae+=1)ye[ae]=a_(Xg(c,Ce,ae));let Xe=c[6]&&o_(c);return{c(){r=$e("table"),a=$e("thead"),a.innerHTML=l,u=mt(),f=$e("tbody");for(let ae=0;ae<se.length;ae+=1)se[ae].c();d=mt(),n=$e("div"),ue&&ue.c(),g=mt(),v=$e("div");for(let ae=0;ae<ye.length;ae+=1)ye[ae].c();S=mt(),T=$e("div"),k=$e("div"),A=Ut(z),R=mt(),D=$e("div"),q=Ut(F),ee=mt(),Xe&&Xe.c(),ie=oi(),this.h()},l(ae){r=je(ae,"TABLE",{class:!0});var Le=et(r);a=je(Le,"THEAD",{"data-svelte-h":!0}),lr(a)!=="svelte-10qeefk"&&(a.innerHTML=l),u=gt(Le),f=je(Le,"TBODY",{});var Z=et(f);for(let at=0;at<se.length;at+=1)se[at].l(Z);Z.forEach(J),Le.forEach(J),d=gt(ae),n=je(ae,"DIV",{"aria-hidden":!0});var tt=et(n);ue&&ue.l(tt),g=gt(tt),v=je(tt,"DIV",{class:!0});var $t=et(v);for(let at=0;at<ye.length;at+=1)ye[at].l($t);$t.forEach(J),S=gt(tt),T=je(tt,"DIV",{class:!0});var ft=et(T);k=je(ft,"DIV",{class:!0});var Jt=et(k);A=Vt(Jt,z),Jt.forEach(J),R=gt(ft),D=je(ft,"DIV",{class:!0});var ut=et(D);q=Vt(ut,F),ut.forEach(J),ft.forEach(J),tt.forEach(J),ee=gt(ae),Xe&&Xe.l(ae),ie=oi(),this.h()},h(){_e(r,"class","visuallyhidden"),_e(v,"class","bar-group svelte-8c0efj"),Ft(v,"height",E),_e(k,"class","svelte-8c0efj"),Ft(k,"left","0"),_e(D,"class","svelte-8c0efj"),Ft(D,"right","0"),_e(T,"class","x-scale svelte-8c0efj"),Ft(T,"height","1rem"),_e(n,"aria-hidden","true")},m(ae,Le){Ze(ae,r,Le),ze(r,a),ze(r,u),ze(r,f);for(let Z=0;Z<se.length;Z+=1)se[Z]&&se[Z].m(f,null);Ze(ae,d,Le),Ze(ae,n,Le),ue&&ue.m(n,null),ze(n,g),ze(n,v);for(let Z=0;Z<ye.length;Z+=1)ye[Z]&&ye[Z].m(v,null);ze(n,S),ze(n,T),ze(T,k),ze(k,A),ze(T,R),ze(T,D),ze(D,q),Ze(ae,ee,Le),Xe&&Xe.m(ae,Le),Ze(ae,ie,Le)},p(ae,[Le]){if(Le&1024){ne=Pi(ae[10]||[]);let Z;for(Z=0;Z<ne.length;Z+=1){const tt=e_(ae,ne,Z);se[Z]?se[Z].p(tt,Le):(se[Z]=t_(tt),se[Z].c(),se[Z].m(f,null))}for(;Z<se.length;Z+=1)se[Z].d(1);se.length=ne.length}if(ae[8]&&ae[12][1]?ue?ue.p(ae,Le):(ue=i_(ae),ue.c(),ue.m(n,g)):ue&&(ue.d(1),ue=null),Le&10775){Ce=Pi(ae[9]);let Z;for(Z=0;Z<Ce.length;Z+=1){const tt=Xg(ae,Ce,Z);ye[Z]?ye[Z].p(tt,Le):(ye[Z]=a_(tt),ye[Z].c(),ye[Z].m(v,null))}for(;Z<ye.length;Z+=1)ye[Z].d(1);ye.length=Ce.length}Le&8&&E!==(E=`${ae[3]}px`)&&Ft(v,"height",E),Le&32&&z!==(z=ae[5][0]+"")&&bi(A,z),Le&32&&F!==(F=ae[5][1]+"")&&bi(q,F),ae[6]?Xe?Xe.p(ae,Le):(Xe=o_(ae),Xe.c(),Xe.m(ie.parentNode,ie)):Xe&&(Xe.d(1),Xe=null)},i:Ci,o:Ci,d(ae){ae&&(J(r),J(d),J(n),J(ee),J(ie)),Pr(se,ae),ue&&ue.d(),Pr(ye,ae),Xe&&Xe.d(ae)}}}function jE(c,r,a){let l,u,f,d,n,g,{data:v}=r,{xKey:E="category"}=r,{yKey:S="value"}=r,{zKey:T="areanm"}=r,{formatTick:k=ie=>ie.toFixed(1)}=r,{height:z=100}=r,{markerWidth:A=2.5}=r,{minmax:R=["0 years","85+"]}=r,{base:D=null}=r,{base_ext:F=", 5 year age bands"}=r,{showLegend:q=!0}=r;function ee(ie,ne){let se={};for(const Ce of ie)se[Ce[ne]]||(se[Ce[ne]]={label:Ce[ne],values:[]}),se[Ce[ne]].values.push(Ce);let ue=[];for(const Ce in se)ue.push(se[Ce]);return ue}return c.$$set=ie=>{"data"in ie&&a(14,v=ie.data),"xKey"in ie&&a(0,E=ie.xKey),"yKey"in ie&&a(1,S=ie.yKey),"zKey"in ie&&a(15,T=ie.zKey),"formatTick"in ie&&a(2,k=ie.formatTick),"height"in ie&&a(3,z=ie.height),"markerWidth"in ie&&a(4,A=ie.markerWidth),"minmax"in ie&&a(5,R=ie.minmax),"base"in ie&&a(6,D=ie.base),"base_ext"in ie&&a(7,F=ie.base_ext),"showLegend"in ie&&a(8,q=ie.showLegend)},c.$$.update=()=>{c.$$.dirty&16385&&a(13,l=v.map(ie=>ie[E]).filter((ie,ne,se)=>se.indexOf(ie)===ne)),c.$$.dirty&16386&&a(16,u=[0,Math.max(...v.map(ie=>ie[S]))]),c.$$.dirty&49152&&a(12,f=v.map(ie=>ie[T]).filter((ie,ne,se)=>se.indexOf(ie)===ne)),c.$$.dirty&65536&&a(11,d=ie=>Math.abs(ie/u[1])*100),c.$$.dirty&49152&&a(9,n=ee(v,T)),c.$$.dirty&512&&a(10,g=(ie=>ie[0].values.map((ne,se)=>({category:ne.category,selected_value:ne.value,all_value:ie[1].values[se].value})))(n))},[E,S,k,z,A,R,D,F,q,n,g,d,f,l,v,T,u]}class qE extends $i{constructor(r){super(),ji(this,r,jE,$E,Fi,{data:14,xKey:0,yKey:1,zKey:15,formatTick:2,height:3,markerWidth:4,minmax:5,base:6,base_ext:7,showLegend:8})}}function ZE(c){let r,a;return r=new qE({props:{data:c[0].selected&&Uu("residents",c[1],c[0]),zKey:"group",base:"% of all people",showLegend:!1}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u&3&&(f.data=l[0].selected&&Uu("residents",l[1],l[0])),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function GE(c){let r,a=Df.nodata+"",l;return{c(){r=$e("span"),l=Ut(a),this.h()},l(u){r=je(u,"SPAN",{class:!0});var f=et(r);l=Vt(f,a),f.forEach(J),this.h()},h(){_e(r,"class","num-desc svelte-1yn8adz")},m(u,f){Ze(u,r,f),ze(r,l)},p:Ci,i:Ci,o:Ci,d(u){u&&J(r)}}}function HE(c){let r,a,l,u;const f=[GE,ZE],d=[];function n(g,v){return g[0].statusOfVariables[g[1]]!=="available"?0:1}return r=n(c),a=d[r]=f[r](c),{c(){a.c(),l=oi()},l(g){a.l(g),l=oi()},m(g,v){d[r].m(g,v),Ze(g,l,v),u=!0},p(g,v){let E=r;r=n(g),r===E?d[r].p(g,v):(Ni(),st(d[E],1,1,()=>{d[E]=null}),Ui(),a=d[r],a?a.p(g,v):(a=d[r]=f[r](g),a.c()),Ye(a,1),a.m(l.parentNode,l))},i(g){u||(Ye(a),u=!0)},o(g){st(a),u=!1},d(g){g&&J(l),d[r].d(g)}}}function WE(c){let r,a;return r=new Ts({props:{title:"Age profile",$$slots:{default:[HE]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,[u]){const f={};u&11&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function KE(c,r,a){let l,{data:u}=r,{selected:f}=r;return c.$$set=d=>{"data"in d&&a(0,u=d.data),"selected"in d&&a(2,f=d.selected)},c.$$.update=()=>{c.$$.dirty&1&&a(1,l=u.statusOfVariables.resident_age_18b==="available"?"resident_age_18b":"resident_age_23a")},[u,l,f]}class XE extends $i{constructor(r){super(),ji(this,r,KE,WE,Fi,{data:0,selected:2})}}function JE(c,r,a){const l=c.slice();return l[2]=r[a],l[4]=a,l}function YE(c){let r,a,l,u,f,d;return{c(){r=$e("li"),a=$e("div"),l=mt(),u=$e("span"),f=Ut(c[2]),d=mt(),this.h()},l(n){r=je(n,"LI",{class:!0});var g=et(r);a=je(g,"DIV",{class:!0}),et(a).forEach(J),l=gt(g),u=je(g,"SPAN",{class:!0});var v=et(u);f=Vt(v,c[2]),v.forEach(J),d=gt(g),g.forEach(J),this.h()},h(){_e(a,"class","legend-vis "+(c[4]==0?"bar":"marker")+" svelte-1d48t1n"),_e(u,"class",dc(c[4]==0?"bold":"brackets")+" svelte-1d48t1n"),_e(r,"class","svelte-1d48t1n"),Ht(r,"ew",c[4]!=0)},m(n,g){Ze(n,r,g),ze(r,a),ze(r,l),ze(r,u),ze(u,f),ze(r,d)},p:Ci,d(n){n&&J(r)}}}function QE(c){let r,a,l,u;const f=c[1].default,d=Tr(f,c,c[0],null);let n=Pi(["People with the selected characteristics","All people in England and Wales"]),g=[];for(let v=0;v<2;v+=1)g[v]=YE(JE(c,n,v));return{c(){r=$e("p"),d&&d.c(),a=mt(),l=$e("ul");for(let v=0;v<2;v+=1)g[v].c();this.h()},l(v){r=je(v,"P",{class:!0});var E=et(r);d&&d.l(E),E.forEach(J),a=gt(v),l=je(v,"UL",{"aria-hidden":!0,class:!0});var S=et(l);for(let T=0;T<2;T+=1)g[T].l(S);S.forEach(J),this.h()},h(){_e(r,"class","legend-text svelte-1d48t1n"),_e(l,"aria-hidden","true"),_e(l,"class","legend-block svelte-1d48t1n")},m(v,E){Ze(v,r,E),d&&d.m(r,null),Ze(v,a,E),Ze(v,l,E);for(let S=0;S<2;S+=1)g[S]&&g[S].m(l,null);u=!0},p(v,[E]){d&&d.p&&(!u||E&1)&&Cr(d,f,v,v[0],u?Ar(f,v[0],E,null):Ir(v[0]),null)},i(v){u||(Ye(d,v),u=!0)},o(v){st(d,v),u=!1},d(v){v&&(J(r),J(a),J(l)),d&&d.d(v),Pr(g,v)}}}function eS(c,r,a){let{$$slots:l={},$$scope:u}=r;return c.$$set=f=>{"$$scope"in f&&a(0,u=f.$$scope)},[u,l]}class cy extends $i{constructor(r){super(),ji(this,r,eS,QE,Fi,{})}}function tS(c){let r,a,l,u,f=(c[0]?"Close panel":c[1])+"",d,n,g,v,E,S,T;const k=c[3].default,z=Tr(k,c,c[2],null);return{c(){r=$e("details"),a=$e("summary"),l=$e("h3"),u=$e("span"),d=Ut(f),g=mt(),v=$e("div"),z&&z.c(),this.h()},l(A){r=je(A,"DETAILS",{class:!0});var R=et(r);a=je(R,"SUMMARY",{class:!0,"data-ga-action":!0});var D=et(a);l=je(D,"H3",{class:!0});var F=et(l);u=je(F,"SPAN",{class:!0});var q=et(u);d=Vt(q,f),q.forEach(J),F.forEach(J),D.forEach(J),g=gt(R),v=je(R,"DIV",{class:!0});var ee=et(v);z&&z.l(ee),ee.forEach(J),R.forEach(J),this.h()},h(){_e(u,"class","ons-btn__inner"),_e(l,"class","ons-btn"),Ht(l,"ons-btn--secondary",c[0]),_e(a,"class","ons-collapsible__heading ons-js-collapsible-heading svelte-cnb450"),_e(a,"data-ga-action",n=c[0]?"Close panel":"Open panel"),_e(v,"class","ons-collapsible__content ons-js-collapsible-content svelte-cnb450"),_e(r,"class","ons-collapsible ons-js-collapsible svelte-cnb450")},m(A,R){Ze(A,r,R),ze(r,a),ze(a,l),ze(l,u),ze(u,d),ze(r,g),ze(r,v),z&&z.m(v,null),r.open=c[0],E=!0,S||(T=$s(r,"toggle",c[4]),S=!0)},p(A,[R]){(!E||R&3)&&f!==(f=(A[0]?"Close panel":A[1])+"")&&bi(d,f),(!E||R&1)&&Ht(l,"ons-btn--secondary",A[0]),(!E||R&1&&n!==(n=A[0]?"Close panel":"Open panel"))&&_e(a,"data-ga-action",n),z&&z.p&&(!E||R&4)&&Cr(z,k,A,A[2],E?Ar(k,A[2],R,null):Ir(A[2]),null),R&1&&(r.open=A[0])},i(A){E||(Ye(z,A),E=!0)},o(A){st(z,A),E=!1},d(A){A&&J(r),z&&z.d(A),S=!1,T()}}}function iS(c,r,a){let{$$slots:l={},$$scope:u}=r,{title:f="Title"}=r,{open:d=!1}=r;function n(){d=this.open,a(0,d)}return c.$$set=g=>{"title"in g&&a(1,f=g.title),"open"in g&&a(0,d=g.open),"$$scope"in g&&a(2,u=g.$$scope)},[d,f,u,l,n]}class rS extends $i{constructor(r){super(),ji(this,r,iS,tS,Fi,{title:1,open:0})}}function nS(c){let r,a,l,u,f;l=new th({props:{type:"error"}});const d=c[1].default,n=Tr(d,c,c[0],null);return{c(){r=$e("div"),a=$e("div"),ii(l.$$.fragment),u=mt(),n&&n.c(),this.h()},l(g){r=je(g,"DIV",{class:!0});var v=et(r);a=je(v,"DIV",{class:!0});var E=et(a);si(l.$$.fragment,E),E.forEach(J),u=gt(v),n&&n.l(v),v.forEach(J),this.h()},h(){_e(a,"class","notice-icon svelte-1404fgr"),_e(r,"class","notice-container svelte-1404fgr")},m(g,v){Ze(g,r,v),ze(r,a),ri(l,a,null),ze(r,u),n&&n.m(r,null),f=!0},p(g,[v]){n&&n.p&&(!f||v&1)&&Cr(n,d,g,g[0],f?Ar(d,g[0],v,null):Ir(g[0]),null)},i(g){f||(Ye(l.$$.fragment,g),Ye(n,g),f=!0)},o(g){st(l.$$.fragment,g),st(n,g),f=!1},d(g){g&&J(r),ni(l),n&&n.d(g)}}}function sS(c,r,a){let{$$slots:l={},$$scope:u}=r;return c.$$set=f=>{"$$scope"in f&&a(0,u=f.$$scope)},[u,l]}class aS extends $i{constructor(r){super(),ji(this,r,sS,nS,Fi,{})}}function Au(c){throw new Error('Could not dynamically require "'+c+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var uy={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(c,r){(function(a){c.exports=a()})(function(){return function a(l,u,f){function d(v,E){if(!u[v]){if(!l[v]){var S=typeof Au=="function"&&Au;if(!E&&S)return S(v,!0);if(n)return n(v,!0);var T=new Error("Cannot find module '"+v+"'");throw T.code="MODULE_NOT_FOUND",T}var k=u[v]={exports:{}};l[v][0].call(k.exports,function(z){var A=l[v][1][z];return d(A||z)},k,k.exports,a,l,u,f)}return u[v].exports}for(var n=typeof Au=="function"&&Au,g=0;g<f.length;g++)d(f[g]);return d}({1:[function(a,l,u){var f=a("./utils"),d=a("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u.encode=function(g){for(var v,E,S,T,k,z,A,R=[],D=0,F=g.length,q=F,ee=f.getTypeOf(g)!=="string";D<g.length;)q=F-D,S=ee?(v=g[D++],E=D<F?g[D++]:0,D<F?g[D++]:0):(v=g.charCodeAt(D++),E=D<F?g.charCodeAt(D++):0,D<F?g.charCodeAt(D++):0),T=v>>2,k=(3&v)<<4|E>>4,z=1<q?(15&E)<<2|S>>6:64,A=2<q?63&S:64,R.push(n.charAt(T)+n.charAt(k)+n.charAt(z)+n.charAt(A));return R.join("")},u.decode=function(g){var v,E,S,T,k,z,A=0,R=0,D="data:";if(g.substr(0,D.length)===D)throw new Error("Invalid base64 input, it looks like a data url.");var F,q=3*(g=g.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(g.charAt(g.length-1)===n.charAt(64)&&q--,g.charAt(g.length-2)===n.charAt(64)&&q--,q%1!=0)throw new Error("Invalid base64 input, bad content length.");for(F=d.uint8array?new Uint8Array(0|q):new Array(0|q);A<g.length;)v=n.indexOf(g.charAt(A++))<<2|(T=n.indexOf(g.charAt(A++)))>>4,E=(15&T)<<4|(k=n.indexOf(g.charAt(A++)))>>2,S=(3&k)<<6|(z=n.indexOf(g.charAt(A++))),F[R++]=v,k!==64&&(F[R++]=E),z!==64&&(F[R++]=S);return F}},{"./support":30,"./utils":32}],2:[function(a,l,u){var f=a("./external"),d=a("./stream/DataWorker"),n=a("./stream/Crc32Probe"),g=a("./stream/DataLengthProbe");function v(E,S,T,k,z){this.compressedSize=E,this.uncompressedSize=S,this.crc32=T,this.compression=k,this.compressedContent=z}v.prototype={getContentWorker:function(){var E=new d(f.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),S=this;return E.on("end",function(){if(this.streamInfo.data_length!==S.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),E},getCompressedWorker:function(){return new d(f.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},v.createWorkerFrom=function(E,S,T){return E.pipe(new n).pipe(new g("uncompressedSize")).pipe(S.compressWorker(T)).pipe(new g("compressedSize")).withStreamInfo("compression",S)},l.exports=v},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(a,l,u){var f=a("./stream/GenericWorker");u.STORE={magic:"\0\0",compressWorker:function(){return new f("STORE compression")},uncompressWorker:function(){return new f("STORE decompression")}},u.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(a,l,u){var f=a("./utils"),d=function(){for(var n,g=[],v=0;v<256;v++){n=v;for(var E=0;E<8;E++)n=1&n?3988292384^n>>>1:n>>>1;g[v]=n}return g}();l.exports=function(n,g){return n!==void 0&&n.length?f.getTypeOf(n)!=="string"?function(v,E,S,T){var k=d,z=T+S;v^=-1;for(var A=T;A<z;A++)v=v>>>8^k[255&(v^E[A])];return-1^v}(0|g,n,n.length,0):function(v,E,S,T){var k=d,z=T+S;v^=-1;for(var A=T;A<z;A++)v=v>>>8^k[255&(v^E.charCodeAt(A))];return-1^v}(0|g,n,n.length,0):0}},{"./utils":32}],5:[function(a,l,u){u.base64=!1,u.binary=!1,u.dir=!1,u.createFolders=!0,u.date=null,u.compression=null,u.compressionOptions=null,u.comment=null,u.unixPermissions=null,u.dosPermissions=null},{}],6:[function(a,l,u){var f=null;f=typeof Promise<"u"?Promise:a("lie"),l.exports={Promise:f}},{lie:37}],7:[function(a,l,u){var f=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",d=a("pako"),n=a("./utils"),g=a("./stream/GenericWorker"),v=f?"uint8array":"array";function E(S,T){g.call(this,"FlateWorker/"+S),this._pako=null,this._pakoAction=S,this._pakoOptions=T,this.meta={}}u.magic="\b\0",n.inherits(E,g),E.prototype.processChunk=function(S){this.meta=S.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(v,S.data),!1)},E.prototype.flush=function(){g.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},E.prototype.cleanUp=function(){g.prototype.cleanUp.call(this),this._pako=null},E.prototype._createPako=function(){this._pako=new d[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var S=this;this._pako.onData=function(T){S.push({data:T,meta:S.meta})}},u.compressWorker=function(S){return new E("Deflate",S)},u.uncompressWorker=function(){return new E("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(a,l,u){function f(k,z){var A,R="";for(A=0;A<z;A++)R+=String.fromCharCode(255&k),k>>>=8;return R}function d(k,z,A,R,D,F){var q,ee,ie=k.file,ne=k.compression,se=F!==v.utf8encode,ue=n.transformTo("string",F(ie.name)),Ce=n.transformTo("string",v.utf8encode(ie.name)),ye=ie.comment,Xe=n.transformTo("string",F(ye)),ae=n.transformTo("string",v.utf8encode(ye)),Le=Ce.length!==ie.name.length,Z=ae.length!==ye.length,tt="",$t="",ft="",Jt=ie.dir,ut=ie.date,at={crc32:0,compressedSize:0,uncompressedSize:0};z&&!A||(at.crc32=k.crc32,at.compressedSize=k.compressedSize,at.uncompressedSize=k.uncompressedSize);var le=0;z&&(le|=8),se||!Le&&!Z||(le|=2048);var Ee=0,Re=0;Jt&&(Ee|=16),D==="UNIX"?(Re=798,Ee|=function(he,it){var Ct=he;return he||(Ct=it?16893:33204),(65535&Ct)<<16}(ie.unixPermissions,Jt)):(Re=20,Ee|=function(he){return 63&(he||0)}(ie.dosPermissions)),q=ut.getUTCHours(),q<<=6,q|=ut.getUTCMinutes(),q<<=5,q|=ut.getUTCSeconds()/2,ee=ut.getUTCFullYear()-1980,ee<<=4,ee|=ut.getUTCMonth()+1,ee<<=5,ee|=ut.getUTCDate(),Le&&($t=f(1,1)+f(E(ue),4)+Ce,tt+="up"+f($t.length,2)+$t),Z&&(ft=f(1,1)+f(E(Xe),4)+ae,tt+="uc"+f(ft.length,2)+ft);var Q="";return Q+=`
\0`,Q+=f(le,2),Q+=ne.magic,Q+=f(q,2),Q+=f(ee,2),Q+=f(at.crc32,4),Q+=f(at.compressedSize,4),Q+=f(at.uncompressedSize,4),Q+=f(ue.length,2),Q+=f(tt.length,2),{fileRecord:S.LOCAL_FILE_HEADER+Q+ue+tt,dirRecord:S.CENTRAL_FILE_HEADER+f(Re,2)+Q+f(Xe.length,2)+"\0\0\0\0"+f(Ee,4)+f(R,4)+ue+tt+Xe}}var n=a("../utils"),g=a("../stream/GenericWorker"),v=a("../utf8"),E=a("../crc32"),S=a("../signature");function T(k,z,A,R){g.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=z,this.zipPlatform=A,this.encodeFileName=R,this.streamFiles=k,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(T,g),T.prototype.push=function(k){var z=k.meta.percent||0,A=this.entriesCount,R=this._sources.length;this.accumulate?this.contentBuffer.push(k):(this.bytesWritten+=k.data.length,g.prototype.push.call(this,{data:k.data,meta:{currentFile:this.currentFile,percent:A?(z+100*(A-R-1))/A:100}}))},T.prototype.openedSource=function(k){this.currentSourceOffset=this.bytesWritten,this.currentFile=k.file.name;var z=this.streamFiles&&!k.file.dir;if(z){var A=d(k,z,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:A.fileRecord,meta:{percent:0}})}else this.accumulate=!0},T.prototype.closedSource=function(k){this.accumulate=!1;var z=this.streamFiles&&!k.file.dir,A=d(k,z,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(A.dirRecord),z)this.push({data:function(R){return S.DATA_DESCRIPTOR+f(R.crc32,4)+f(R.compressedSize,4)+f(R.uncompressedSize,4)}(k),meta:{percent:100}});else for(this.push({data:A.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},T.prototype.flush=function(){for(var k=this.bytesWritten,z=0;z<this.dirRecords.length;z++)this.push({data:this.dirRecords[z],meta:{percent:100}});var A=this.bytesWritten-k,R=function(D,F,q,ee,ie){var ne=n.transformTo("string",ie(ee));return S.CENTRAL_DIRECTORY_END+"\0\0\0\0"+f(D,2)+f(D,2)+f(F,4)+f(q,4)+f(ne.length,2)+ne}(this.dirRecords.length,A,k,this.zipComment,this.encodeFileName);this.push({data:R,meta:{percent:100}})},T.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},T.prototype.registerPrevious=function(k){this._sources.push(k);var z=this;return k.on("data",function(A){z.processChunk(A)}),k.on("end",function(){z.closedSource(z.previous.streamInfo),z._sources.length?z.prepareNextSource():z.end()}),k.on("error",function(A){z.error(A)}),this},T.prototype.resume=function(){return!!g.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},T.prototype.error=function(k){var z=this._sources;if(!g.prototype.error.call(this,k))return!1;for(var A=0;A<z.length;A++)try{z[A].error(k)}catch{}return!0},T.prototype.lock=function(){g.prototype.lock.call(this);for(var k=this._sources,z=0;z<k.length;z++)k[z].lock()},l.exports=T},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(a,l,u){var f=a("../compressions"),d=a("./ZipFileWorker");u.generateWorker=function(n,g,v){var E=new d(g.streamFiles,v,g.platform,g.encodeFileName),S=0;try{n.forEach(function(T,k){S++;var z=function(F,q){var ee=F||q,ie=f[ee];if(!ie)throw new Error(ee+" is not a valid compression method !");return ie}(k.options.compression,g.compression),A=k.options.compressionOptions||g.compressionOptions||{},R=k.dir,D=k.date;k._compressWorker(z,A).withStreamInfo("file",{name:T,dir:R,date:D,comment:k.comment||"",unixPermissions:k.unixPermissions,dosPermissions:k.dosPermissions}).pipe(E)}),E.entriesCount=S}catch(T){E.error(T)}return E}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,l,u){function f(){if(!(this instanceof f))return new f;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var d=new f;for(var n in this)typeof this[n]!="function"&&(d[n]=this[n]);return d}}(f.prototype=a("./object")).loadAsync=a("./load"),f.support=a("./support"),f.defaults=a("./defaults"),f.version="3.10.1",f.loadAsync=function(d,n){return new f().loadAsync(d,n)},f.external=a("./external"),l.exports=f},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(a,l,u){var f=a("./utils"),d=a("./external"),n=a("./utf8"),g=a("./zipEntries"),v=a("./stream/Crc32Probe"),E=a("./nodejsUtils");function S(T){return new d.Promise(function(k,z){var A=T.decompressed.getContentWorker().pipe(new v);A.on("error",function(R){z(R)}).on("end",function(){A.streamInfo.crc32!==T.decompressed.crc32?z(new Error("Corrupted zip : CRC32 mismatch")):k()}).resume()})}l.exports=function(T,k){var z=this;return k=f.extend(k||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),E.isNode&&E.isStream(T)?d.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):f.prepareContent("the loaded zip file",T,!0,k.optimizedBinaryString,k.base64).then(function(A){var R=new g(k);return R.load(A),R}).then(function(A){var R=[d.Promise.resolve(A)],D=A.files;if(k.checkCRC32)for(var F=0;F<D.length;F++)R.push(S(D[F]));return d.Promise.all(R)}).then(function(A){for(var R=A.shift(),D=R.files,F=0;F<D.length;F++){var q=D[F],ee=q.fileNameStr,ie=f.resolve(q.fileNameStr);z.file(ie,q.decompressed,{binary:!0,optimizedBinaryString:!0,date:q.date,dir:q.dir,comment:q.fileCommentStr.length?q.fileCommentStr:null,unixPermissions:q.unixPermissions,dosPermissions:q.dosPermissions,createFolders:k.createFolders}),q.dir||(z.file(ie).unsafeOriginalName=ee)}return R.zipComment.length&&(z.comment=R.zipComment),z})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(a,l,u){var f=a("../utils"),d=a("../stream/GenericWorker");function n(g,v){d.call(this,"Nodejs stream input adapter for "+g),this._upstreamEnded=!1,this._bindStream(v)}f.inherits(n,d),n.prototype._bindStream=function(g){var v=this;(this._stream=g).pause(),g.on("data",function(E){v.push({data:E,meta:{percent:0}})}).on("error",function(E){v.isPaused?this.generatedError=E:v.error(E)}).on("end",function(){v.isPaused?v._upstreamEnded=!0:v.end()})},n.prototype.pause=function(){return!!d.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},l.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(a,l,u){var f=a("readable-stream").Readable;function d(n,g,v){f.call(this,g),this._helper=n;var E=this;n.on("data",function(S,T){E.push(S)||E._helper.pause(),v&&v(T)}).on("error",function(S){E.emit("error",S)}).on("end",function(){E.push(null)})}a("../utils").inherits(d,f),d.prototype._read=function(){this._helper.resume()},l.exports=d},{"../utils":32,"readable-stream":16}],14:[function(a,l,u){l.exports={isNode:typeof Buffer<"u",newBufferFrom:function(f,d){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(f,d);if(typeof f=="number")throw new Error('The "data" argument must not be a number');return new Buffer(f,d)},allocBuffer:function(f){if(Buffer.alloc)return Buffer.alloc(f);var d=new Buffer(f);return d.fill(0),d},isBuffer:function(f){return Buffer.isBuffer(f)},isStream:function(f){return f&&typeof f.on=="function"&&typeof f.pause=="function"&&typeof f.resume=="function"}}},{}],15:[function(a,l,u){function f(ie,ne,se){var ue,Ce=n.getTypeOf(ne),ye=n.extend(se||{},E);ye.date=ye.date||new Date,ye.compression!==null&&(ye.compression=ye.compression.toUpperCase()),typeof ye.unixPermissions=="string"&&(ye.unixPermissions=parseInt(ye.unixPermissions,8)),ye.unixPermissions&&16384&ye.unixPermissions&&(ye.dir=!0),ye.dosPermissions&&16&ye.dosPermissions&&(ye.dir=!0),ye.dir&&(ie=D(ie)),ye.createFolders&&(ue=R(ie))&&F.call(this,ue,!0);var Xe=Ce==="string"&&ye.binary===!1&&ye.base64===!1;se&&se.binary!==void 0||(ye.binary=!Xe),(ne instanceof S&&ne.uncompressedSize===0||ye.dir||!ne||ne.length===0)&&(ye.base64=!1,ye.binary=!0,ne="",ye.compression="STORE",Ce="string");var ae=null;ae=ne instanceof S||ne instanceof g?ne:z.isNode&&z.isStream(ne)?new A(ie,ne):n.prepareContent(ie,ne,ye.binary,ye.optimizedBinaryString,ye.base64);var Le=new T(ie,ae,ye);this.files[ie]=Le}var d=a("./utf8"),n=a("./utils"),g=a("./stream/GenericWorker"),v=a("./stream/StreamHelper"),E=a("./defaults"),S=a("./compressedObject"),T=a("./zipObject"),k=a("./generate"),z=a("./nodejsUtils"),A=a("./nodejs/NodejsStreamInputAdapter"),R=function(ie){ie.slice(-1)==="/"&&(ie=ie.substring(0,ie.length-1));var ne=ie.lastIndexOf("/");return 0<ne?ie.substring(0,ne):""},D=function(ie){return ie.slice(-1)!=="/"&&(ie+="/"),ie},F=function(ie,ne){return ne=ne!==void 0?ne:E.createFolders,ie=D(ie),this.files[ie]||f.call(this,ie,null,{dir:!0,createFolders:ne}),this.files[ie]};function q(ie){return Object.prototype.toString.call(ie)==="[object RegExp]"}var ee={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(ie){var ne,se,ue;for(ne in this.files)ue=this.files[ne],(se=ne.slice(this.root.length,ne.length))&&ne.slice(0,this.root.length)===this.root&&ie(se,ue)},filter:function(ie){var ne=[];return this.forEach(function(se,ue){ie(se,ue)&&ne.push(ue)}),ne},file:function(ie,ne,se){if(arguments.length!==1)return ie=this.root+ie,f.call(this,ie,ne,se),this;if(q(ie)){var ue=ie;return this.filter(function(ye,Xe){return!Xe.dir&&ue.test(ye)})}var Ce=this.files[this.root+ie];return Ce&&!Ce.dir?Ce:null},folder:function(ie){if(!ie)return this;if(q(ie))return this.filter(function(Ce,ye){return ye.dir&&ie.test(Ce)});var ne=this.root+ie,se=F.call(this,ne),ue=this.clone();return ue.root=se.name,ue},remove:function(ie){ie=this.root+ie;var ne=this.files[ie];if(ne||(ie.slice(-1)!=="/"&&(ie+="/"),ne=this.files[ie]),ne&&!ne.dir)delete this.files[ie];else for(var se=this.filter(function(Ce,ye){return ye.name.slice(0,ie.length)===ie}),ue=0;ue<se.length;ue++)delete this.files[se[ue].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(ie){var ne,se={};try{if((se=n.extend(ie||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:d.utf8encode})).type=se.type.toLowerCase(),se.compression=se.compression.toUpperCase(),se.type==="binarystring"&&(se.type="string"),!se.type)throw new Error("No output type specified.");n.checkSupport(se.type),se.platform!=="darwin"&&se.platform!=="freebsd"&&se.platform!=="linux"&&se.platform!=="sunos"||(se.platform="UNIX"),se.platform==="win32"&&(se.platform="DOS");var ue=se.comment||this.comment||"";ne=k.generateWorker(this,se,ue)}catch(Ce){(ne=new g("error")).error(Ce)}return new v(ne,se.type||"string",se.mimeType)},generateAsync:function(ie,ne){return this.generateInternalStream(ie).accumulate(ne)},generateNodeStream:function(ie,ne){return(ie=ie||{}).type||(ie.type="nodebuffer"),this.generateInternalStream(ie).toNodejsStream(ne)}};l.exports=ee},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(a,l,u){l.exports=a("stream")},{stream:void 0}],17:[function(a,l,u){var f=a("./DataReader");function d(n){f.call(this,n);for(var g=0;g<this.data.length;g++)n[g]=255&n[g]}a("../utils").inherits(d,f),d.prototype.byteAt=function(n){return this.data[this.zero+n]},d.prototype.lastIndexOfSignature=function(n){for(var g=n.charCodeAt(0),v=n.charCodeAt(1),E=n.charCodeAt(2),S=n.charCodeAt(3),T=this.length-4;0<=T;--T)if(this.data[T]===g&&this.data[T+1]===v&&this.data[T+2]===E&&this.data[T+3]===S)return T-this.zero;return-1},d.prototype.readAndCheckSignature=function(n){var g=n.charCodeAt(0),v=n.charCodeAt(1),E=n.charCodeAt(2),S=n.charCodeAt(3),T=this.readData(4);return g===T[0]&&v===T[1]&&E===T[2]&&S===T[3]},d.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var g=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,g},l.exports=d},{"../utils":32,"./DataReader":18}],18:[function(a,l,u){var f=a("../utils");function d(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}d.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(){},readInt:function(n){var g,v=0;for(this.checkOffset(n),g=this.index+n-1;g>=this.index;g--)v=(v<<8)+this.byteAt(g);return this.index+=n,v},readString:function(n){return f.transformTo("string",this.readData(n))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},l.exports=d},{"../utils":32}],19:[function(a,l,u){var f=a("./Uint8ArrayReader");function d(n){f.call(this,n)}a("../utils").inherits(d,f),d.prototype.readData=function(n){this.checkOffset(n);var g=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,g},l.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(a,l,u){var f=a("./DataReader");function d(n){f.call(this,n)}a("../utils").inherits(d,f),d.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},d.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},d.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},d.prototype.readData=function(n){this.checkOffset(n);var g=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,g},l.exports=d},{"../utils":32,"./DataReader":18}],21:[function(a,l,u){var f=a("./ArrayReader");function d(n){f.call(this,n)}a("../utils").inherits(d,f),d.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var g=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,g},l.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(a,l,u){var f=a("../utils"),d=a("../support"),n=a("./ArrayReader"),g=a("./StringReader"),v=a("./NodeBufferReader"),E=a("./Uint8ArrayReader");l.exports=function(S){var T=f.getTypeOf(S);return f.checkSupport(T),T!=="string"||d.uint8array?T==="nodebuffer"?new v(S):d.uint8array?new E(f.transformTo("uint8array",S)):new n(f.transformTo("array",S)):new g(S)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(a,l,u){u.LOCAL_FILE_HEADER="PK",u.CENTRAL_FILE_HEADER="PK",u.CENTRAL_DIRECTORY_END="PK",u.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",u.ZIP64_CENTRAL_DIRECTORY_END="PK",u.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(a,l,u){var f=a("./GenericWorker"),d=a("../utils");function n(g){f.call(this,"ConvertWorker to "+g),this.destType=g}d.inherits(n,f),n.prototype.processChunk=function(g){this.push({data:d.transformTo(this.destType,g.data),meta:g.meta})},l.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(a,l,u){var f=a("./GenericWorker"),d=a("../crc32");function n(){f.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}a("../utils").inherits(n,f),n.prototype.processChunk=function(g){this.streamInfo.crc32=d(g.data,this.streamInfo.crc32||0),this.push(g)},l.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(a,l,u){var f=a("../utils"),d=a("./GenericWorker");function n(g){d.call(this,"DataLengthProbe for "+g),this.propName=g,this.withStreamInfo(g,0)}f.inherits(n,d),n.prototype.processChunk=function(g){if(g){var v=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=v+g.data.length}d.prototype.processChunk.call(this,g)},l.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(a,l,u){var f=a("../utils"),d=a("./GenericWorker");function n(g){d.call(this,"DataWorker");var v=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,g.then(function(E){v.dataIsReady=!0,v.data=E,v.max=E&&E.length||0,v.type=f.getTypeOf(E),v.isPaused||v._tickAndRepeat()},function(E){v.error(E)})}f.inherits(n,d),n.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,f.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(f.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var g=null,v=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":g=this.data.substring(this.index,v);break;case"uint8array":g=this.data.subarray(this.index,v);break;case"array":case"nodebuffer":g=this.data.slice(this.index,v)}return this.index=v,this.push({data:g,meta:{percent:this.max?this.index/this.max*100:0}})},l.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(a,l,u){function f(d){this.name=d||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}f.prototype={push:function(d){this.emit("data",d)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(d){this.emit("error",d)}return!0},error:function(d){return!this.isFinished&&(this.isPaused?this.generatedError=d:(this.isFinished=!0,this.emit("error",d),this.previous&&this.previous.error(d),this.cleanUp()),!0)},on:function(d,n){return this._listeners[d].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(d,n){if(this._listeners[d])for(var g=0;g<this._listeners[d].length;g++)this._listeners[d][g].call(this,n)},pipe:function(d){return d.registerPrevious(this)},registerPrevious:function(d){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=d.streamInfo,this.mergeStreamInfo(),this.previous=d;var n=this;return d.on("data",function(g){n.processChunk(g)}),d.on("end",function(){n.end()}),d.on("error",function(g){n.error(g)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var d=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),d=!0),this.previous&&this.previous.resume(),!d},flush:function(){},processChunk:function(d){this.push(d)},withStreamInfo:function(d,n){return this.extraStreamInfo[d]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var d in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,d)&&(this.streamInfo[d]=this.extraStreamInfo[d])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var d="Worker "+this.name;return this.previous?this.previous+" -> "+d:d}},l.exports=f},{}],29:[function(a,l,u){var f=a("../utils"),d=a("./ConvertWorker"),n=a("./GenericWorker"),g=a("../base64"),v=a("../support"),E=a("../external"),S=null;if(v.nodestream)try{S=a("../nodejs/NodejsStreamOutputAdapter")}catch{}function T(z,A){return new E.Promise(function(R,D){var F=[],q=z._internalType,ee=z._outputType,ie=z._mimeType;z.on("data",function(ne,se){F.push(ne),A&&A(se)}).on("error",function(ne){F=[],D(ne)}).on("end",function(){try{var ne=function(se,ue,Ce){switch(se){case"blob":return f.newBlob(f.transformTo("arraybuffer",ue),Ce);case"base64":return g.encode(ue);default:return f.transformTo(se,ue)}}(ee,function(se,ue){var Ce,ye=0,Xe=null,ae=0;for(Ce=0;Ce<ue.length;Ce++)ae+=ue[Ce].length;switch(se){case"string":return ue.join("");case"array":return Array.prototype.concat.apply([],ue);case"uint8array":for(Xe=new Uint8Array(ae),Ce=0;Ce<ue.length;Ce++)Xe.set(ue[Ce],ye),ye+=ue[Ce].length;return Xe;case"nodebuffer":return Buffer.concat(ue);default:throw new Error("concat : unsupported type '"+se+"'")}}(q,F),ie);R(ne)}catch(se){D(se)}F=[]}).resume()})}function k(z,A,R){var D=A;switch(A){case"blob":case"arraybuffer":D="uint8array";break;case"base64":D="string"}try{this._internalType=D,this._outputType=A,this._mimeType=R,f.checkSupport(D),this._worker=z.pipe(new d(D)),z.lock()}catch(F){this._worker=new n("error"),this._worker.error(F)}}k.prototype={accumulate:function(z){return T(this,z)},on:function(z,A){var R=this;return z==="data"?this._worker.on(z,function(D){A.call(R,D.data,D.meta)}):this._worker.on(z,function(){f.delay(A,arguments,R)}),this},resume:function(){return f.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(z){if(f.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new S(this,{objectMode:this._outputType!=="nodebuffer"},z)}},l.exports=k},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(a,l,u){if(u.base64=!0,u.array=!0,u.string=!0,u.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",u.nodebuffer=typeof Buffer<"u",u.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")u.blob=!1;else{var f=new ArrayBuffer(0);try{u.blob=new Blob([f],{type:"application/zip"}).size===0}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);d.append(f),u.blob=d.getBlob("application/zip").size===0}catch{u.blob=!1}}}try{u.nodestream=!!a("readable-stream").Readable}catch{u.nodestream=!1}},{"readable-stream":16}],31:[function(a,l,u){for(var f=a("./utils"),d=a("./support"),n=a("./nodejsUtils"),g=a("./stream/GenericWorker"),v=new Array(256),E=0;E<256;E++)v[E]=252<=E?6:248<=E?5:240<=E?4:224<=E?3:192<=E?2:1;v[254]=v[254]=1;function S(){g.call(this,"utf-8 decode"),this.leftOver=null}function T(){g.call(this,"utf-8 encode")}u.utf8encode=function(k){return d.nodebuffer?n.newBufferFrom(k,"utf-8"):function(z){var A,R,D,F,q,ee=z.length,ie=0;for(F=0;F<ee;F++)(64512&(R=z.charCodeAt(F)))==55296&&F+1<ee&&(64512&(D=z.charCodeAt(F+1)))==56320&&(R=65536+(R-55296<<10)+(D-56320),F++),ie+=R<128?1:R<2048?2:R<65536?3:4;for(A=d.uint8array?new Uint8Array(ie):new Array(ie),F=q=0;q<ie;F++)(64512&(R=z.charCodeAt(F)))==55296&&F+1<ee&&(64512&(D=z.charCodeAt(F+1)))==56320&&(R=65536+(R-55296<<10)+(D-56320),F++),R<128?A[q++]=R:(R<2048?A[q++]=192|R>>>6:(R<65536?A[q++]=224|R>>>12:(A[q++]=240|R>>>18,A[q++]=128|R>>>12&63),A[q++]=128|R>>>6&63),A[q++]=128|63&R);return A}(k)},u.utf8decode=function(k){return d.nodebuffer?f.transformTo("nodebuffer",k).toString("utf-8"):function(z){var A,R,D,F,q=z.length,ee=new Array(2*q);for(A=R=0;A<q;)if((D=z[A++])<128)ee[R++]=D;else if(4<(F=v[D]))ee[R++]=65533,A+=F-1;else{for(D&=F===2?31:F===3?15:7;1<F&&A<q;)D=D<<6|63&z[A++],F--;1<F?ee[R++]=65533:D<65536?ee[R++]=D:(D-=65536,ee[R++]=55296|D>>10&1023,ee[R++]=56320|1023&D)}return ee.length!==R&&(ee.subarray?ee=ee.subarray(0,R):ee.length=R),f.applyFromCharCode(ee)}(k=f.transformTo(d.uint8array?"uint8array":"array",k))},f.inherits(S,g),S.prototype.processChunk=function(k){var z=f.transformTo(d.uint8array?"uint8array":"array",k.data);if(this.leftOver&&this.leftOver.length){if(d.uint8array){var A=z;(z=new Uint8Array(A.length+this.leftOver.length)).set(this.leftOver,0),z.set(A,this.leftOver.length)}else z=this.leftOver.concat(z);this.leftOver=null}var R=function(F,q){var ee;for((q=q||F.length)>F.length&&(q=F.length),ee=q-1;0<=ee&&(192&F[ee])==128;)ee--;return ee<0||ee===0?q:ee+v[F[ee]]>q?ee:q}(z),D=z;R!==z.length&&(d.uint8array?(D=z.subarray(0,R),this.leftOver=z.subarray(R,z.length)):(D=z.slice(0,R),this.leftOver=z.slice(R,z.length))),this.push({data:u.utf8decode(D),meta:k.meta})},S.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:u.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},u.Utf8DecodeWorker=S,f.inherits(T,g),T.prototype.processChunk=function(k){this.push({data:u.utf8encode(k.data),meta:k.meta})},u.Utf8EncodeWorker=T},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(a,l,u){var f=a("./support"),d=a("./base64"),n=a("./nodejsUtils"),g=a("./external");function v(A){return A}function E(A,R){for(var D=0;D<A.length;++D)R[D]=255&A.charCodeAt(D);return R}a("setimmediate"),u.newBlob=function(A,R){u.checkSupport("blob");try{return new Blob([A],{type:R})}catch{try{var D=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return D.append(A),D.getBlob(R)}catch{throw new Error("Bug : can't construct the Blob.")}}};var S={stringifyByChunk:function(A,R,D){var F=[],q=0,ee=A.length;if(ee<=D)return String.fromCharCode.apply(null,A);for(;q<ee;)R==="array"||R==="nodebuffer"?F.push(String.fromCharCode.apply(null,A.slice(q,Math.min(q+D,ee)))):F.push(String.fromCharCode.apply(null,A.subarray(q,Math.min(q+D,ee)))),q+=D;return F.join("")},stringifyByChar:function(A){for(var R="",D=0;D<A.length;D++)R+=String.fromCharCode(A[D]);return R},applyCanBeUsed:{uint8array:function(){try{return f.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return f.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}}()}};function T(A){var R=65536,D=u.getTypeOf(A),F=!0;if(D==="uint8array"?F=S.applyCanBeUsed.uint8array:D==="nodebuffer"&&(F=S.applyCanBeUsed.nodebuffer),F)for(;1<R;)try{return S.stringifyByChunk(A,D,R)}catch{R=Math.floor(R/2)}return S.stringifyByChar(A)}function k(A,R){for(var D=0;D<A.length;D++)R[D]=A[D];return R}u.applyFromCharCode=T;var z={};z.string={string:v,array:function(A){return E(A,new Array(A.length))},arraybuffer:function(A){return z.string.uint8array(A).buffer},uint8array:function(A){return E(A,new Uint8Array(A.length))},nodebuffer:function(A){return E(A,n.allocBuffer(A.length))}},z.array={string:T,array:v,arraybuffer:function(A){return new Uint8Array(A).buffer},uint8array:function(A){return new Uint8Array(A)},nodebuffer:function(A){return n.newBufferFrom(A)}},z.arraybuffer={string:function(A){return T(new Uint8Array(A))},array:function(A){return k(new Uint8Array(A),new Array(A.byteLength))},arraybuffer:v,uint8array:function(A){return new Uint8Array(A)},nodebuffer:function(A){return n.newBufferFrom(new Uint8Array(A))}},z.uint8array={string:T,array:function(A){return k(A,new Array(A.length))},arraybuffer:function(A){return A.buffer},uint8array:v,nodebuffer:function(A){return n.newBufferFrom(A)}},z.nodebuffer={string:T,array:function(A){return k(A,new Array(A.length))},arraybuffer:function(A){return z.nodebuffer.uint8array(A).buffer},uint8array:function(A){return k(A,new Uint8Array(A.length))},nodebuffer:v},u.transformTo=function(A,R){if(R=R||"",!A)return R;u.checkSupport(A);var D=u.getTypeOf(R);return z[D][A](R)},u.resolve=function(A){for(var R=A.split("/"),D=[],F=0;F<R.length;F++){var q=R[F];q==="."||q===""&&F!==0&&F!==R.length-1||(q===".."?D.pop():D.push(q))}return D.join("/")},u.getTypeOf=function(A){return typeof A=="string"?"string":Object.prototype.toString.call(A)==="[object Array]"?"array":f.nodebuffer&&n.isBuffer(A)?"nodebuffer":f.uint8array&&A instanceof Uint8Array?"uint8array":f.arraybuffer&&A instanceof ArrayBuffer?"arraybuffer":void 0},u.checkSupport=function(A){if(!f[A.toLowerCase()])throw new Error(A+" is not supported by this platform")},u.MAX_VALUE_16BITS=65535,u.MAX_VALUE_32BITS=-1,u.pretty=function(A){var R,D,F="";for(D=0;D<(A||"").length;D++)F+="\\x"+((R=A.charCodeAt(D))<16?"0":"")+R.toString(16).toUpperCase();return F},u.delay=function(A,R,D){setImmediate(function(){A.apply(D||null,R||[])})},u.inherits=function(A,R){function D(){}D.prototype=R.prototype,A.prototype=new D},u.extend=function(){var A,R,D={};for(A=0;A<arguments.length;A++)for(R in arguments[A])Object.prototype.hasOwnProperty.call(arguments[A],R)&&D[R]===void 0&&(D[R]=arguments[A][R]);return D},u.prepareContent=function(A,R,D,F,q){return g.Promise.resolve(R).then(function(ee){return f.blob&&(ee instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(ee))!==-1)&&typeof FileReader<"u"?new g.Promise(function(ie,ne){var se=new FileReader;se.onload=function(ue){ie(ue.target.result)},se.onerror=function(ue){ne(ue.target.error)},se.readAsArrayBuffer(ee)}):ee}).then(function(ee){var ie=u.getTypeOf(ee);return ie?(ie==="arraybuffer"?ee=u.transformTo("uint8array",ee):ie==="string"&&(q?ee=d.decode(ee):D&&F!==!0&&(ee=function(ne){return E(ne,f.uint8array?new Uint8Array(ne.length):new Array(ne.length))}(ee))),ee):g.Promise.reject(new Error("Can't read the data of '"+A+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(a,l,u){var f=a("./reader/readerFor"),d=a("./utils"),n=a("./signature"),g=a("./zipEntry"),v=a("./support");function E(S){this.files=[],this.loadOptions=S}E.prototype={checkSignature:function(S){if(!this.reader.readAndCheckSignature(S)){this.reader.index-=4;var T=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+d.pretty(T)+", expected "+d.pretty(S)+")")}},isSignature:function(S,T){var k=this.reader.index;this.reader.setIndex(S);var z=this.reader.readString(4)===T;return this.reader.setIndex(k),z},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var S=this.reader.readData(this.zipCommentLength),T=v.uint8array?"uint8array":"array",k=d.transformTo(T,S);this.zipComment=this.loadOptions.decodeFileName(k)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var S,T,k,z=this.zip64EndOfCentralSize-44;0<z;)S=this.reader.readInt(2),T=this.reader.readInt(4),k=this.reader.readData(T),this.zip64ExtensibleData[S]={id:S,length:T,value:k}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var S,T;for(S=0;S<this.files.length;S++)T=this.files[S],this.reader.setIndex(T.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),T.readLocalPart(this.reader),T.handleUTF8(),T.processAttributes()},readCentralDir:function(){var S;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(S=new g({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(S);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var S=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(S<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(S);var T=S;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===d.MAX_VALUE_16BITS||this.diskWithCentralDirStart===d.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===d.MAX_VALUE_16BITS||this.centralDirRecords===d.MAX_VALUE_16BITS||this.centralDirSize===d.MAX_VALUE_32BITS||this.centralDirOffset===d.MAX_VALUE_32BITS){if(this.zip64=!0,(S=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(S),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var k=this.centralDirOffset+this.centralDirSize;this.zip64&&(k+=20,k+=12+this.zip64EndOfCentralSize);var z=T-k;if(0<z)this.isSignature(T,n.CENTRAL_FILE_HEADER)||(this.reader.zero=z);else if(z<0)throw new Error("Corrupted zip: missing "+Math.abs(z)+" bytes.")},prepareReader:function(S){this.reader=f(S)},load:function(S){this.prepareReader(S),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},l.exports=E},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(a,l,u){var f=a("./reader/readerFor"),d=a("./utils"),n=a("./compressedObject"),g=a("./crc32"),v=a("./utf8"),E=a("./compressions"),S=a("./support");function T(k,z){this.options=k,this.loadOptions=z}T.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(k){var z,A;if(k.skip(22),this.fileNameLength=k.readInt(2),A=k.readInt(2),this.fileName=k.readData(this.fileNameLength),k.skip(A),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((z=function(R){for(var D in E)if(Object.prototype.hasOwnProperty.call(E,D)&&E[D].magic===R)return E[D];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+d.pretty(this.compressionMethod)+" unknown (inner file : "+d.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,z,k.readData(this.compressedSize))},readCentralPart:function(k){this.versionMadeBy=k.readInt(2),k.skip(2),this.bitFlag=k.readInt(2),this.compressionMethod=k.readString(2),this.date=k.readDate(),this.crc32=k.readInt(4),this.compressedSize=k.readInt(4),this.uncompressedSize=k.readInt(4);var z=k.readInt(2);if(this.extraFieldsLength=k.readInt(2),this.fileCommentLength=k.readInt(2),this.diskNumberStart=k.readInt(2),this.internalFileAttributes=k.readInt(2),this.externalFileAttributes=k.readInt(4),this.localHeaderOffset=k.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");k.skip(z),this.readExtraFields(k),this.parseZIP64ExtraField(k),this.fileComment=k.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var k=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),k==0&&(this.dosPermissions=63&this.externalFileAttributes),k==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var k=f(this.extraFields[1].value);this.uncompressedSize===d.MAX_VALUE_32BITS&&(this.uncompressedSize=k.readInt(8)),this.compressedSize===d.MAX_VALUE_32BITS&&(this.compressedSize=k.readInt(8)),this.localHeaderOffset===d.MAX_VALUE_32BITS&&(this.localHeaderOffset=k.readInt(8)),this.diskNumberStart===d.MAX_VALUE_32BITS&&(this.diskNumberStart=k.readInt(4))}},readExtraFields:function(k){var z,A,R,D=k.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});k.index+4<D;)z=k.readInt(2),A=k.readInt(2),R=k.readData(A),this.extraFields[z]={id:z,length:A,value:R};k.setIndex(D)},handleUTF8:function(){var k=S.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=v.utf8decode(this.fileName),this.fileCommentStr=v.utf8decode(this.fileComment);else{var z=this.findExtraFieldUnicodePath();if(z!==null)this.fileNameStr=z;else{var A=d.transformTo(k,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(A)}var R=this.findExtraFieldUnicodeComment();if(R!==null)this.fileCommentStr=R;else{var D=d.transformTo(k,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(D)}}},findExtraFieldUnicodePath:function(){var k=this.extraFields[28789];if(k){var z=f(k.value);return z.readInt(1)!==1||g(this.fileName)!==z.readInt(4)?null:v.utf8decode(z.readData(k.length-5))}return null},findExtraFieldUnicodeComment:function(){var k=this.extraFields[25461];if(k){var z=f(k.value);return z.readInt(1)!==1||g(this.fileComment)!==z.readInt(4)?null:v.utf8decode(z.readData(k.length-5))}return null}},l.exports=T},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(a,l,u){function f(z,A,R){this.name=z,this.dir=R.dir,this.date=R.date,this.comment=R.comment,this.unixPermissions=R.unixPermissions,this.dosPermissions=R.dosPermissions,this._data=A,this._dataBinary=R.binary,this.options={compression:R.compression,compressionOptions:R.compressionOptions}}var d=a("./stream/StreamHelper"),n=a("./stream/DataWorker"),g=a("./utf8"),v=a("./compressedObject"),E=a("./stream/GenericWorker");f.prototype={internalStream:function(z){var A=null,R="string";try{if(!z)throw new Error("No output type specified.");var D=(R=z.toLowerCase())==="string"||R==="text";R!=="binarystring"&&R!=="text"||(R="string"),A=this._decompressWorker();var F=!this._dataBinary;F&&!D&&(A=A.pipe(new g.Utf8EncodeWorker)),!F&&D&&(A=A.pipe(new g.Utf8DecodeWorker))}catch(q){(A=new E("error")).error(q)}return new d(A,R,"")},async:function(z,A){return this.internalStream(z).accumulate(A)},nodeStream:function(z,A){return this.internalStream(z||"nodebuffer").toNodejsStream(A)},_compressWorker:function(z,A){if(this._data instanceof v&&this._data.compression.magic===z.magic)return this._data.getCompressedWorker();var R=this._decompressWorker();return this._dataBinary||(R=R.pipe(new g.Utf8EncodeWorker)),v.createWorkerFrom(R,z,A)},_decompressWorker:function(){return this._data instanceof v?this._data.getContentWorker():this._data instanceof E?this._data:new n(this._data)}};for(var S=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],T=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},k=0;k<S.length;k++)f.prototype[S[k]]=T;l.exports=f},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(a,l,u){(function(f){var d,n,g=f.MutationObserver||f.WebKitMutationObserver;if(g){var v=0,E=new g(z),S=f.document.createTextNode("");E.observe(S,{characterData:!0}),d=function(){S.data=v=++v%2}}else if(f.setImmediate||f.MessageChannel===void 0)d="document"in f&&"onreadystatechange"in f.document.createElement("script")?function(){var A=f.document.createElement("script");A.onreadystatechange=function(){z(),A.onreadystatechange=null,A.parentNode.removeChild(A),A=null},f.document.documentElement.appendChild(A)}:function(){setTimeout(z,0)};else{var T=new f.MessageChannel;T.port1.onmessage=z,d=function(){T.port2.postMessage(0)}}var k=[];function z(){var A,R;n=!0;for(var D=k.length;D;){for(R=k,k=[],A=-1;++A<D;)R[A]();D=k.length}n=!1}l.exports=function(A){k.push(A)!==1||n||d()}}).call(this,typeof $o<"u"?$o:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(a,l,u){var f=a("immediate");function d(){}var n={},g=["REJECTED"],v=["FULFILLED"],E=["PENDING"];function S(D){if(typeof D!="function")throw new TypeError("resolver must be a function");this.state=E,this.queue=[],this.outcome=void 0,D!==d&&A(this,D)}function T(D,F,q){this.promise=D,typeof F=="function"&&(this.onFulfilled=F,this.callFulfilled=this.otherCallFulfilled),typeof q=="function"&&(this.onRejected=q,this.callRejected=this.otherCallRejected)}function k(D,F,q){f(function(){var ee;try{ee=F(q)}catch(ie){return n.reject(D,ie)}ee===D?n.reject(D,new TypeError("Cannot resolve promise with itself")):n.resolve(D,ee)})}function z(D){var F=D&&D.then;if(D&&(typeof D=="object"||typeof D=="function")&&typeof F=="function")return function(){F.apply(D,arguments)}}function A(D,F){var q=!1;function ee(se){q||(q=!0,n.reject(D,se))}function ie(se){q||(q=!0,n.resolve(D,se))}var ne=R(function(){F(ie,ee)});ne.status==="error"&&ee(ne.value)}function R(D,F){var q={};try{q.value=D(F),q.status="success"}catch(ee){q.status="error",q.value=ee}return q}(l.exports=S).prototype.finally=function(D){if(typeof D!="function")return this;var F=this.constructor;return this.then(function(q){return F.resolve(D()).then(function(){return q})},function(q){return F.resolve(D()).then(function(){throw q})})},S.prototype.catch=function(D){return this.then(null,D)},S.prototype.then=function(D,F){if(typeof D!="function"&&this.state===v||typeof F!="function"&&this.state===g)return this;var q=new this.constructor(d);return this.state!==E?k(q,this.state===v?D:F,this.outcome):this.queue.push(new T(q,D,F)),q},T.prototype.callFulfilled=function(D){n.resolve(this.promise,D)},T.prototype.otherCallFulfilled=function(D){k(this.promise,this.onFulfilled,D)},T.prototype.callRejected=function(D){n.reject(this.promise,D)},T.prototype.otherCallRejected=function(D){k(this.promise,this.onRejected,D)},n.resolve=function(D,F){var q=R(z,F);if(q.status==="error")return n.reject(D,q.value);var ee=q.value;if(ee)A(D,ee);else{D.state=v,D.outcome=F;for(var ie=-1,ne=D.queue.length;++ie<ne;)D.queue[ie].callFulfilled(F)}return D},n.reject=function(D,F){D.state=g,D.outcome=F;for(var q=-1,ee=D.queue.length;++q<ee;)D.queue[q].callRejected(F);return D},S.resolve=function(D){return D instanceof this?D:n.resolve(new this(d),D)},S.reject=function(D){var F=new this(d);return n.reject(F,D)},S.all=function(D){var F=this;if(Object.prototype.toString.call(D)!=="[object Array]")return this.reject(new TypeError("must be an array"));var q=D.length,ee=!1;if(!q)return this.resolve([]);for(var ie=new Array(q),ne=0,se=-1,ue=new this(d);++se<q;)Ce(D[se],se);return ue;function Ce(ye,Xe){F.resolve(ye).then(function(ae){ie[Xe]=ae,++ne!==q||ee||(ee=!0,n.resolve(ue,ie))},function(ae){ee||(ee=!0,n.reject(ue,ae))})}},S.race=function(D){var F=this;if(Object.prototype.toString.call(D)!=="[object Array]")return this.reject(new TypeError("must be an array"));var q=D.length,ee=!1;if(!q)return this.resolve([]);for(var ie=-1,ne=new this(d);++ie<q;)se=D[ie],F.resolve(se).then(function(ue){ee||(ee=!0,n.resolve(ne,ue))},function(ue){ee||(ee=!0,n.reject(ne,ue))});var se;return ne}},{immediate:36}],38:[function(a,l,u){var f={};(0,a("./lib/utils/common").assign)(f,a("./lib/deflate"),a("./lib/inflate"),a("./lib/zlib/constants")),l.exports=f},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(a,l,u){var f=a("./zlib/deflate"),d=a("./utils/common"),n=a("./utils/strings"),g=a("./zlib/messages"),v=a("./zlib/zstream"),E=Object.prototype.toString,S=0,T=-1,k=0,z=8;function A(D){if(!(this instanceof A))return new A(D);this.options=d.assign({level:T,method:z,chunkSize:16384,windowBits:15,memLevel:8,strategy:k,to:""},D||{});var F=this.options;F.raw&&0<F.windowBits?F.windowBits=-F.windowBits:F.gzip&&0<F.windowBits&&F.windowBits<16&&(F.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var q=f.deflateInit2(this.strm,F.level,F.method,F.windowBits,F.memLevel,F.strategy);if(q!==S)throw new Error(g[q]);if(F.header&&f.deflateSetHeader(this.strm,F.header),F.dictionary){var ee;if(ee=typeof F.dictionary=="string"?n.string2buf(F.dictionary):E.call(F.dictionary)==="[object ArrayBuffer]"?new Uint8Array(F.dictionary):F.dictionary,(q=f.deflateSetDictionary(this.strm,ee))!==S)throw new Error(g[q]);this._dict_set=!0}}function R(D,F){var q=new A(F);if(q.push(D,!0),q.err)throw q.msg||g[q.err];return q.result}A.prototype.push=function(D,F){var q,ee,ie=this.strm,ne=this.options.chunkSize;if(this.ended)return!1;ee=F===~~F?F:F===!0?4:0,typeof D=="string"?ie.input=n.string2buf(D):E.call(D)==="[object ArrayBuffer]"?ie.input=new Uint8Array(D):ie.input=D,ie.next_in=0,ie.avail_in=ie.input.length;do{if(ie.avail_out===0&&(ie.output=new d.Buf8(ne),ie.next_out=0,ie.avail_out=ne),(q=f.deflate(ie,ee))!==1&&q!==S)return this.onEnd(q),!(this.ended=!0);ie.avail_out!==0&&(ie.avail_in!==0||ee!==4&&ee!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(d.shrinkBuf(ie.output,ie.next_out))):this.onData(d.shrinkBuf(ie.output,ie.next_out)))}while((0<ie.avail_in||ie.avail_out===0)&&q!==1);return ee===4?(q=f.deflateEnd(this.strm),this.onEnd(q),this.ended=!0,q===S):ee!==2||(this.onEnd(S),!(ie.avail_out=0))},A.prototype.onData=function(D){this.chunks.push(D)},A.prototype.onEnd=function(D){D===S&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=D,this.msg=this.strm.msg},u.Deflate=A,u.deflate=R,u.deflateRaw=function(D,F){return(F=F||{}).raw=!0,R(D,F)},u.gzip=function(D,F){return(F=F||{}).gzip=!0,R(D,F)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(a,l,u){var f=a("./zlib/inflate"),d=a("./utils/common"),n=a("./utils/strings"),g=a("./zlib/constants"),v=a("./zlib/messages"),E=a("./zlib/zstream"),S=a("./zlib/gzheader"),T=Object.prototype.toString;function k(A){if(!(this instanceof k))return new k(A);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},A||{});var R=this.options;R.raw&&0<=R.windowBits&&R.windowBits<16&&(R.windowBits=-R.windowBits,R.windowBits===0&&(R.windowBits=-15)),!(0<=R.windowBits&&R.windowBits<16)||A&&A.windowBits||(R.windowBits+=32),15<R.windowBits&&R.windowBits<48&&!(15&R.windowBits)&&(R.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new E,this.strm.avail_out=0;var D=f.inflateInit2(this.strm,R.windowBits);if(D!==g.Z_OK)throw new Error(v[D]);this.header=new S,f.inflateGetHeader(this.strm,this.header)}function z(A,R){var D=new k(R);if(D.push(A,!0),D.err)throw D.msg||v[D.err];return D.result}k.prototype.push=function(A,R){var D,F,q,ee,ie,ne,se=this.strm,ue=this.options.chunkSize,Ce=this.options.dictionary,ye=!1;if(this.ended)return!1;F=R===~~R?R:R===!0?g.Z_FINISH:g.Z_NO_FLUSH,typeof A=="string"?se.input=n.binstring2buf(A):T.call(A)==="[object ArrayBuffer]"?se.input=new Uint8Array(A):se.input=A,se.next_in=0,se.avail_in=se.input.length;do{if(se.avail_out===0&&(se.output=new d.Buf8(ue),se.next_out=0,se.avail_out=ue),(D=f.inflate(se,g.Z_NO_FLUSH))===g.Z_NEED_DICT&&Ce&&(ne=typeof Ce=="string"?n.string2buf(Ce):T.call(Ce)==="[object ArrayBuffer]"?new Uint8Array(Ce):Ce,D=f.inflateSetDictionary(this.strm,ne)),D===g.Z_BUF_ERROR&&ye===!0&&(D=g.Z_OK,ye=!1),D!==g.Z_STREAM_END&&D!==g.Z_OK)return this.onEnd(D),!(this.ended=!0);se.next_out&&(se.avail_out!==0&&D!==g.Z_STREAM_END&&(se.avail_in!==0||F!==g.Z_FINISH&&F!==g.Z_SYNC_FLUSH)||(this.options.to==="string"?(q=n.utf8border(se.output,se.next_out),ee=se.next_out-q,ie=n.buf2string(se.output,q),se.next_out=ee,se.avail_out=ue-ee,ee&&d.arraySet(se.output,se.output,q,ee,0),this.onData(ie)):this.onData(d.shrinkBuf(se.output,se.next_out)))),se.avail_in===0&&se.avail_out===0&&(ye=!0)}while((0<se.avail_in||se.avail_out===0)&&D!==g.Z_STREAM_END);return D===g.Z_STREAM_END&&(F=g.Z_FINISH),F===g.Z_FINISH?(D=f.inflateEnd(this.strm),this.onEnd(D),this.ended=!0,D===g.Z_OK):F!==g.Z_SYNC_FLUSH||(this.onEnd(g.Z_OK),!(se.avail_out=0))},k.prototype.onData=function(A){this.chunks.push(A)},k.prototype.onEnd=function(A){A===g.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg},u.Inflate=k,u.inflate=z,u.inflateRaw=function(A,R){return(R=R||{}).raw=!0,z(A,R)},u.ungzip=z},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(a,l,u){var f=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";u.assign=function(g){for(var v=Array.prototype.slice.call(arguments,1);v.length;){var E=v.shift();if(E){if(typeof E!="object")throw new TypeError(E+"must be non-object");for(var S in E)E.hasOwnProperty(S)&&(g[S]=E[S])}}return g},u.shrinkBuf=function(g,v){return g.length===v?g:g.subarray?g.subarray(0,v):(g.length=v,g)};var d={arraySet:function(g,v,E,S,T){if(v.subarray&&g.subarray)g.set(v.subarray(E,E+S),T);else for(var k=0;k<S;k++)g[T+k]=v[E+k]},flattenChunks:function(g){var v,E,S,T,k,z;for(v=S=0,E=g.length;v<E;v++)S+=g[v].length;for(z=new Uint8Array(S),v=T=0,E=g.length;v<E;v++)k=g[v],z.set(k,T),T+=k.length;return z}},n={arraySet:function(g,v,E,S,T){for(var k=0;k<S;k++)g[T+k]=v[E+k]},flattenChunks:function(g){return[].concat.apply([],g)}};u.setTyped=function(g){g?(u.Buf8=Uint8Array,u.Buf16=Uint16Array,u.Buf32=Int32Array,u.assign(u,d)):(u.Buf8=Array,u.Buf16=Array,u.Buf32=Array,u.assign(u,n))},u.setTyped(f)},{}],42:[function(a,l,u){var f=a("./common"),d=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{d=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var g=new f.Buf8(256),v=0;v<256;v++)g[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;function E(S,T){if(T<65537&&(S.subarray&&n||!S.subarray&&d))return String.fromCharCode.apply(null,f.shrinkBuf(S,T));for(var k="",z=0;z<T;z++)k+=String.fromCharCode(S[z]);return k}g[254]=g[254]=1,u.string2buf=function(S){var T,k,z,A,R,D=S.length,F=0;for(A=0;A<D;A++)(64512&(k=S.charCodeAt(A)))==55296&&A+1<D&&(64512&(z=S.charCodeAt(A+1)))==56320&&(k=65536+(k-55296<<10)+(z-56320),A++),F+=k<128?1:k<2048?2:k<65536?3:4;for(T=new f.Buf8(F),A=R=0;R<F;A++)(64512&(k=S.charCodeAt(A)))==55296&&A+1<D&&(64512&(z=S.charCodeAt(A+1)))==56320&&(k=65536+(k-55296<<10)+(z-56320),A++),k<128?T[R++]=k:(k<2048?T[R++]=192|k>>>6:(k<65536?T[R++]=224|k>>>12:(T[R++]=240|k>>>18,T[R++]=128|k>>>12&63),T[R++]=128|k>>>6&63),T[R++]=128|63&k);return T},u.buf2binstring=function(S){return E(S,S.length)},u.binstring2buf=function(S){for(var T=new f.Buf8(S.length),k=0,z=T.length;k<z;k++)T[k]=S.charCodeAt(k);return T},u.buf2string=function(S,T){var k,z,A,R,D=T||S.length,F=new Array(2*D);for(k=z=0;k<D;)if((A=S[k++])<128)F[z++]=A;else if(4<(R=g[A]))F[z++]=65533,k+=R-1;else{for(A&=R===2?31:R===3?15:7;1<R&&k<D;)A=A<<6|63&S[k++],R--;1<R?F[z++]=65533:A<65536?F[z++]=A:(A-=65536,F[z++]=55296|A>>10&1023,F[z++]=56320|1023&A)}return E(F,z)},u.utf8border=function(S,T){var k;for((T=T||S.length)>S.length&&(T=S.length),k=T-1;0<=k&&(192&S[k])==128;)k--;return k<0||k===0?T:k+g[S[k]]>T?k:T}},{"./common":41}],43:[function(a,l,u){l.exports=function(f,d,n,g){for(var v=65535&f|0,E=f>>>16&65535|0,S=0;n!==0;){for(n-=S=2e3<n?2e3:n;E=E+(v=v+d[g++]|0)|0,--S;);v%=65521,E%=65521}return v|E<<16|0}},{}],44:[function(a,l,u){l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(a,l,u){var f=function(){for(var d,n=[],g=0;g<256;g++){d=g;for(var v=0;v<8;v++)d=1&d?3988292384^d>>>1:d>>>1;n[g]=d}return n}();l.exports=function(d,n,g,v){var E=f,S=v+g;d^=-1;for(var T=v;T<S;T++)d=d>>>8^E[255&(d^n[T])];return-1^d}},{}],46:[function(a,l,u){var f,d=a("../utils/common"),n=a("./trees"),g=a("./adler32"),v=a("./crc32"),E=a("./messages"),S=0,T=4,k=0,z=-2,A=-1,R=4,D=2,F=8,q=9,ee=286,ie=30,ne=19,se=2*ee+1,ue=15,Ce=3,ye=258,Xe=ye+Ce+1,ae=42,Le=113,Z=1,tt=2,$t=3,ft=4;function Jt(N,Je){return N.msg=E[Je],Je}function ut(N){return(N<<1)-(4<N?9:0)}function at(N){for(var Je=N.length;0<=--Je;)N[Je]=0}function le(N){var Je=N.state,We=Je.pending;We>N.avail_out&&(We=N.avail_out),We!==0&&(d.arraySet(N.output,Je.pending_buf,Je.pending_out,We,N.next_out),N.next_out+=We,Je.pending_out+=We,N.total_out+=We,N.avail_out-=We,Je.pending-=We,Je.pending===0&&(Je.pending_out=0))}function Ee(N,Je){n._tr_flush_block(N,0<=N.block_start?N.block_start:-1,N.strstart-N.block_start,Je),N.block_start=N.strstart,le(N.strm)}function Re(N,Je){N.pending_buf[N.pending++]=Je}function Q(N,Je){N.pending_buf[N.pending++]=Je>>>8&255,N.pending_buf[N.pending++]=255&Je}function he(N,Je){var We,we,me=N.max_chain_length,Ne=N.strstart,ht=N.prev_length,ke=N.nice_match,Qe=N.strstart>N.w_size-Xe?N.strstart-(N.w_size-Xe):0,xt=N.window,Tt=N.w_mask,dt=N.prev,Yt=N.strstart+ye,ki=xt[Ne+ht-1],Si=xt[Ne+ht];N.prev_length>=N.good_match&&(me>>=2),ke>N.lookahead&&(ke=N.lookahead);do if(xt[(We=Je)+ht]===Si&&xt[We+ht-1]===ki&&xt[We]===xt[Ne]&&xt[++We]===xt[Ne+1]){Ne+=2,We++;do;while(xt[++Ne]===xt[++We]&&xt[++Ne]===xt[++We]&&xt[++Ne]===xt[++We]&&xt[++Ne]===xt[++We]&&xt[++Ne]===xt[++We]&&xt[++Ne]===xt[++We]&&xt[++Ne]===xt[++We]&&xt[++Ne]===xt[++We]&&Ne<Yt);if(we=ye-(Yt-Ne),Ne=Yt-ye,ht<we){if(N.match_start=Je,ke<=(ht=we))break;ki=xt[Ne+ht-1],Si=xt[Ne+ht]}}while((Je=dt[Je&Tt])>Qe&&--me!=0);return ht<=N.lookahead?ht:N.lookahead}function it(N){var Je,We,we,me,Ne,ht,ke,Qe,xt,Tt,dt=N.w_size;do{if(me=N.window_size-N.lookahead-N.strstart,N.strstart>=dt+(dt-Xe)){for(d.arraySet(N.window,N.window,dt,dt,0),N.match_start-=dt,N.strstart-=dt,N.block_start-=dt,Je=We=N.hash_size;we=N.head[--Je],N.head[Je]=dt<=we?we-dt:0,--We;);for(Je=We=dt;we=N.prev[--Je],N.prev[Je]=dt<=we?we-dt:0,--We;);me+=dt}if(N.strm.avail_in===0)break;if(ht=N.strm,ke=N.window,Qe=N.strstart+N.lookahead,xt=me,Tt=void 0,Tt=ht.avail_in,xt<Tt&&(Tt=xt),We=Tt===0?0:(ht.avail_in-=Tt,d.arraySet(ke,ht.input,ht.next_in,Tt,Qe),ht.state.wrap===1?ht.adler=g(ht.adler,ke,Tt,Qe):ht.state.wrap===2&&(ht.adler=v(ht.adler,ke,Tt,Qe)),ht.next_in+=Tt,ht.total_in+=Tt,Tt),N.lookahead+=We,N.lookahead+N.insert>=Ce)for(Ne=N.strstart-N.insert,N.ins_h=N.window[Ne],N.ins_h=(N.ins_h<<N.hash_shift^N.window[Ne+1])&N.hash_mask;N.insert&&(N.ins_h=(N.ins_h<<N.hash_shift^N.window[Ne+Ce-1])&N.hash_mask,N.prev[Ne&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=Ne,Ne++,N.insert--,!(N.lookahead+N.insert<Ce)););}while(N.lookahead<Xe&&N.strm.avail_in!==0)}function Ct(N,Je){for(var We,we;;){if(N.lookahead<Xe){if(it(N),N.lookahead<Xe&&Je===S)return Z;if(N.lookahead===0)break}if(We=0,N.lookahead>=Ce&&(N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+Ce-1])&N.hash_mask,We=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),We!==0&&N.strstart-We<=N.w_size-Xe&&(N.match_length=he(N,We)),N.match_length>=Ce)if(we=n._tr_tally(N,N.strstart-N.match_start,N.match_length-Ce),N.lookahead-=N.match_length,N.match_length<=N.max_lazy_match&&N.lookahead>=Ce){for(N.match_length--;N.strstart++,N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+Ce-1])&N.hash_mask,We=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart,--N.match_length!=0;);N.strstart++}else N.strstart+=N.match_length,N.match_length=0,N.ins_h=N.window[N.strstart],N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+1])&N.hash_mask;else we=n._tr_tally(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++;if(we&&(Ee(N,!1),N.strm.avail_out===0))return Z}return N.insert=N.strstart<Ce-1?N.strstart:Ce-1,Je===T?(Ee(N,!0),N.strm.avail_out===0?$t:ft):N.last_lit&&(Ee(N,!1),N.strm.avail_out===0)?Z:tt}function bt(N,Je){for(var We,we,me;;){if(N.lookahead<Xe){if(it(N),N.lookahead<Xe&&Je===S)return Z;if(N.lookahead===0)break}if(We=0,N.lookahead>=Ce&&(N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+Ce-1])&N.hash_mask,We=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),N.prev_length=N.match_length,N.prev_match=N.match_start,N.match_length=Ce-1,We!==0&&N.prev_length<N.max_lazy_match&&N.strstart-We<=N.w_size-Xe&&(N.match_length=he(N,We),N.match_length<=5&&(N.strategy===1||N.match_length===Ce&&4096<N.strstart-N.match_start)&&(N.match_length=Ce-1)),N.prev_length>=Ce&&N.match_length<=N.prev_length){for(me=N.strstart+N.lookahead-Ce,we=n._tr_tally(N,N.strstart-1-N.prev_match,N.prev_length-Ce),N.lookahead-=N.prev_length-1,N.prev_length-=2;++N.strstart<=me&&(N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+Ce-1])&N.hash_mask,We=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),--N.prev_length!=0;);if(N.match_available=0,N.match_length=Ce-1,N.strstart++,we&&(Ee(N,!1),N.strm.avail_out===0))return Z}else if(N.match_available){if((we=n._tr_tally(N,0,N.window[N.strstart-1]))&&Ee(N,!1),N.strstart++,N.lookahead--,N.strm.avail_out===0)return Z}else N.match_available=1,N.strstart++,N.lookahead--}return N.match_available&&(we=n._tr_tally(N,0,N.window[N.strstart-1]),N.match_available=0),N.insert=N.strstart<Ce-1?N.strstart:Ce-1,Je===T?(Ee(N,!0),N.strm.avail_out===0?$t:ft):N.last_lit&&(Ee(N,!1),N.strm.avail_out===0)?Z:tt}function It(N,Je,We,we,me){this.good_length=N,this.max_lazy=Je,this.nice_length=We,this.max_chain=we,this.func=me}function Bt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=F,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*se),this.dyn_dtree=new d.Buf16(2*(2*ie+1)),this.bl_tree=new d.Buf16(2*(2*ne+1)),at(this.dyn_ltree),at(this.dyn_dtree),at(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16(ue+1),this.heap=new d.Buf16(2*ee+1),at(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*ee+1),at(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Fe(N){var Je;return N&&N.state?(N.total_in=N.total_out=0,N.data_type=D,(Je=N.state).pending=0,Je.pending_out=0,Je.wrap<0&&(Je.wrap=-Je.wrap),Je.status=Je.wrap?ae:Le,N.adler=Je.wrap===2?0:1,Je.last_flush=S,n._tr_init(Je),k):Jt(N,z)}function Se(N){var Je=Fe(N);return Je===k&&function(We){We.window_size=2*We.w_size,at(We.head),We.max_lazy_match=f[We.level].max_lazy,We.good_match=f[We.level].good_length,We.nice_match=f[We.level].nice_length,We.max_chain_length=f[We.level].max_chain,We.strstart=0,We.block_start=0,We.lookahead=0,We.insert=0,We.match_length=We.prev_length=Ce-1,We.match_available=0,We.ins_h=0}(N.state),Je}function ct(N,Je,We,we,me,Ne){if(!N)return z;var ht=1;if(Je===A&&(Je=6),we<0?(ht=0,we=-we):15<we&&(ht=2,we-=16),me<1||q<me||We!==F||we<8||15<we||Je<0||9<Je||Ne<0||R<Ne)return Jt(N,z);we===8&&(we=9);var ke=new Bt;return(N.state=ke).strm=N,ke.wrap=ht,ke.gzhead=null,ke.w_bits=we,ke.w_size=1<<ke.w_bits,ke.w_mask=ke.w_size-1,ke.hash_bits=me+7,ke.hash_size=1<<ke.hash_bits,ke.hash_mask=ke.hash_size-1,ke.hash_shift=~~((ke.hash_bits+Ce-1)/Ce),ke.window=new d.Buf8(2*ke.w_size),ke.head=new d.Buf16(ke.hash_size),ke.prev=new d.Buf16(ke.w_size),ke.lit_bufsize=1<<me+6,ke.pending_buf_size=4*ke.lit_bufsize,ke.pending_buf=new d.Buf8(ke.pending_buf_size),ke.d_buf=1*ke.lit_bufsize,ke.l_buf=3*ke.lit_bufsize,ke.level=Je,ke.strategy=Ne,ke.method=We,Se(N)}f=[new It(0,0,0,0,function(N,Je){var We=65535;for(We>N.pending_buf_size-5&&(We=N.pending_buf_size-5);;){if(N.lookahead<=1){if(it(N),N.lookahead===0&&Je===S)return Z;if(N.lookahead===0)break}N.strstart+=N.lookahead,N.lookahead=0;var we=N.block_start+We;if((N.strstart===0||N.strstart>=we)&&(N.lookahead=N.strstart-we,N.strstart=we,Ee(N,!1),N.strm.avail_out===0)||N.strstart-N.block_start>=N.w_size-Xe&&(Ee(N,!1),N.strm.avail_out===0))return Z}return N.insert=0,Je===T?(Ee(N,!0),N.strm.avail_out===0?$t:ft):(N.strstart>N.block_start&&(Ee(N,!1),N.strm.avail_out),Z)}),new It(4,4,8,4,Ct),new It(4,5,16,8,Ct),new It(4,6,32,32,Ct),new It(4,4,16,16,bt),new It(8,16,32,32,bt),new It(8,16,128,128,bt),new It(8,32,128,256,bt),new It(32,128,258,1024,bt),new It(32,258,258,4096,bt)],u.deflateInit=function(N,Je){return ct(N,Je,F,15,8,0)},u.deflateInit2=ct,u.deflateReset=Se,u.deflateResetKeep=Fe,u.deflateSetHeader=function(N,Je){return N&&N.state?N.state.wrap!==2?z:(N.state.gzhead=Je,k):z},u.deflate=function(N,Je){var We,we,me,Ne;if(!N||!N.state||5<Je||Je<0)return N?Jt(N,z):z;if(we=N.state,!N.output||!N.input&&N.avail_in!==0||we.status===666&&Je!==T)return Jt(N,N.avail_out===0?-5:z);if(we.strm=N,We=we.last_flush,we.last_flush=Je,we.status===ae)if(we.wrap===2)N.adler=0,Re(we,31),Re(we,139),Re(we,8),we.gzhead?(Re(we,(we.gzhead.text?1:0)+(we.gzhead.hcrc?2:0)+(we.gzhead.extra?4:0)+(we.gzhead.name?8:0)+(we.gzhead.comment?16:0)),Re(we,255&we.gzhead.time),Re(we,we.gzhead.time>>8&255),Re(we,we.gzhead.time>>16&255),Re(we,we.gzhead.time>>24&255),Re(we,we.level===9?2:2<=we.strategy||we.level<2?4:0),Re(we,255&we.gzhead.os),we.gzhead.extra&&we.gzhead.extra.length&&(Re(we,255&we.gzhead.extra.length),Re(we,we.gzhead.extra.length>>8&255)),we.gzhead.hcrc&&(N.adler=v(N.adler,we.pending_buf,we.pending,0)),we.gzindex=0,we.status=69):(Re(we,0),Re(we,0),Re(we,0),Re(we,0),Re(we,0),Re(we,we.level===9?2:2<=we.strategy||we.level<2?4:0),Re(we,3),we.status=Le);else{var ht=F+(we.w_bits-8<<4)<<8;ht|=(2<=we.strategy||we.level<2?0:we.level<6?1:we.level===6?2:3)<<6,we.strstart!==0&&(ht|=32),ht+=31-ht%31,we.status=Le,Q(we,ht),we.strstart!==0&&(Q(we,N.adler>>>16),Q(we,65535&N.adler)),N.adler=1}if(we.status===69)if(we.gzhead.extra){for(me=we.pending;we.gzindex<(65535&we.gzhead.extra.length)&&(we.pending!==we.pending_buf_size||(we.gzhead.hcrc&&we.pending>me&&(N.adler=v(N.adler,we.pending_buf,we.pending-me,me)),le(N),me=we.pending,we.pending!==we.pending_buf_size));)Re(we,255&we.gzhead.extra[we.gzindex]),we.gzindex++;we.gzhead.hcrc&&we.pending>me&&(N.adler=v(N.adler,we.pending_buf,we.pending-me,me)),we.gzindex===we.gzhead.extra.length&&(we.gzindex=0,we.status=73)}else we.status=73;if(we.status===73)if(we.gzhead.name){me=we.pending;do{if(we.pending===we.pending_buf_size&&(we.gzhead.hcrc&&we.pending>me&&(N.adler=v(N.adler,we.pending_buf,we.pending-me,me)),le(N),me=we.pending,we.pending===we.pending_buf_size)){Ne=1;break}Ne=we.gzindex<we.gzhead.name.length?255&we.gzhead.name.charCodeAt(we.gzindex++):0,Re(we,Ne)}while(Ne!==0);we.gzhead.hcrc&&we.pending>me&&(N.adler=v(N.adler,we.pending_buf,we.pending-me,me)),Ne===0&&(we.gzindex=0,we.status=91)}else we.status=91;if(we.status===91)if(we.gzhead.comment){me=we.pending;do{if(we.pending===we.pending_buf_size&&(we.gzhead.hcrc&&we.pending>me&&(N.adler=v(N.adler,we.pending_buf,we.pending-me,me)),le(N),me=we.pending,we.pending===we.pending_buf_size)){Ne=1;break}Ne=we.gzindex<we.gzhead.comment.length?255&we.gzhead.comment.charCodeAt(we.gzindex++):0,Re(we,Ne)}while(Ne!==0);we.gzhead.hcrc&&we.pending>me&&(N.adler=v(N.adler,we.pending_buf,we.pending-me,me)),Ne===0&&(we.status=103)}else we.status=103;if(we.status===103&&(we.gzhead.hcrc?(we.pending+2>we.pending_buf_size&&le(N),we.pending+2<=we.pending_buf_size&&(Re(we,255&N.adler),Re(we,N.adler>>8&255),N.adler=0,we.status=Le)):we.status=Le),we.pending!==0){if(le(N),N.avail_out===0)return we.last_flush=-1,k}else if(N.avail_in===0&&ut(Je)<=ut(We)&&Je!==T)return Jt(N,-5);if(we.status===666&&N.avail_in!==0)return Jt(N,-5);if(N.avail_in!==0||we.lookahead!==0||Je!==S&&we.status!==666){var ke=we.strategy===2?function(Qe,xt){for(var Tt;;){if(Qe.lookahead===0&&(it(Qe),Qe.lookahead===0)){if(xt===S)return Z;break}if(Qe.match_length=0,Tt=n._tr_tally(Qe,0,Qe.window[Qe.strstart]),Qe.lookahead--,Qe.strstart++,Tt&&(Ee(Qe,!1),Qe.strm.avail_out===0))return Z}return Qe.insert=0,xt===T?(Ee(Qe,!0),Qe.strm.avail_out===0?$t:ft):Qe.last_lit&&(Ee(Qe,!1),Qe.strm.avail_out===0)?Z:tt}(we,Je):we.strategy===3?function(Qe,xt){for(var Tt,dt,Yt,ki,Si=Qe.window;;){if(Qe.lookahead<=ye){if(it(Qe),Qe.lookahead<=ye&&xt===S)return Z;if(Qe.lookahead===0)break}if(Qe.match_length=0,Qe.lookahead>=Ce&&0<Qe.strstart&&(dt=Si[Yt=Qe.strstart-1])===Si[++Yt]&&dt===Si[++Yt]&&dt===Si[++Yt]){ki=Qe.strstart+ye;do;while(dt===Si[++Yt]&&dt===Si[++Yt]&&dt===Si[++Yt]&&dt===Si[++Yt]&&dt===Si[++Yt]&&dt===Si[++Yt]&&dt===Si[++Yt]&&dt===Si[++Yt]&&Yt<ki);Qe.match_length=ye-(ki-Yt),Qe.match_length>Qe.lookahead&&(Qe.match_length=Qe.lookahead)}if(Qe.match_length>=Ce?(Tt=n._tr_tally(Qe,1,Qe.match_length-Ce),Qe.lookahead-=Qe.match_length,Qe.strstart+=Qe.match_length,Qe.match_length=0):(Tt=n._tr_tally(Qe,0,Qe.window[Qe.strstart]),Qe.lookahead--,Qe.strstart++),Tt&&(Ee(Qe,!1),Qe.strm.avail_out===0))return Z}return Qe.insert=0,xt===T?(Ee(Qe,!0),Qe.strm.avail_out===0?$t:ft):Qe.last_lit&&(Ee(Qe,!1),Qe.strm.avail_out===0)?Z:tt}(we,Je):f[we.level].func(we,Je);if(ke!==$t&&ke!==ft||(we.status=666),ke===Z||ke===$t)return N.avail_out===0&&(we.last_flush=-1),k;if(ke===tt&&(Je===1?n._tr_align(we):Je!==5&&(n._tr_stored_block(we,0,0,!1),Je===3&&(at(we.head),we.lookahead===0&&(we.strstart=0,we.block_start=0,we.insert=0))),le(N),N.avail_out===0))return we.last_flush=-1,k}return Je!==T?k:we.wrap<=0?1:(we.wrap===2?(Re(we,255&N.adler),Re(we,N.adler>>8&255),Re(we,N.adler>>16&255),Re(we,N.adler>>24&255),Re(we,255&N.total_in),Re(we,N.total_in>>8&255),Re(we,N.total_in>>16&255),Re(we,N.total_in>>24&255)):(Q(we,N.adler>>>16),Q(we,65535&N.adler)),le(N),0<we.wrap&&(we.wrap=-we.wrap),we.pending!==0?k:1)},u.deflateEnd=function(N){var Je;return N&&N.state?(Je=N.state.status)!==ae&&Je!==69&&Je!==73&&Je!==91&&Je!==103&&Je!==Le&&Je!==666?Jt(N,z):(N.state=null,Je===Le?Jt(N,-3):k):z},u.deflateSetDictionary=function(N,Je){var We,we,me,Ne,ht,ke,Qe,xt,Tt=Je.length;if(!N||!N.state||(Ne=(We=N.state).wrap)===2||Ne===1&&We.status!==ae||We.lookahead)return z;for(Ne===1&&(N.adler=g(N.adler,Je,Tt,0)),We.wrap=0,Tt>=We.w_size&&(Ne===0&&(at(We.head),We.strstart=0,We.block_start=0,We.insert=0),xt=new d.Buf8(We.w_size),d.arraySet(xt,Je,Tt-We.w_size,We.w_size,0),Je=xt,Tt=We.w_size),ht=N.avail_in,ke=N.next_in,Qe=N.input,N.avail_in=Tt,N.next_in=0,N.input=Je,it(We);We.lookahead>=Ce;){for(we=We.strstart,me=We.lookahead-(Ce-1);We.ins_h=(We.ins_h<<We.hash_shift^We.window[we+Ce-1])&We.hash_mask,We.prev[we&We.w_mask]=We.head[We.ins_h],We.head[We.ins_h]=we,we++,--me;);We.strstart=we,We.lookahead=Ce-1,it(We)}return We.strstart+=We.lookahead,We.block_start=We.strstart,We.insert=We.lookahead,We.lookahead=0,We.match_length=We.prev_length=Ce-1,We.match_available=0,N.next_in=ke,N.input=Qe,N.avail_in=ht,We.wrap=Ne,k},u.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(a,l,u){l.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(a,l,u){l.exports=function(f,d){var n,g,v,E,S,T,k,z,A,R,D,F,q,ee,ie,ne,se,ue,Ce,ye,Xe,ae,Le,Z,tt;n=f.state,g=f.next_in,Z=f.input,v=g+(f.avail_in-5),E=f.next_out,tt=f.output,S=E-(d-f.avail_out),T=E+(f.avail_out-257),k=n.dmax,z=n.wsize,A=n.whave,R=n.wnext,D=n.window,F=n.hold,q=n.bits,ee=n.lencode,ie=n.distcode,ne=(1<<n.lenbits)-1,se=(1<<n.distbits)-1;e:do{q<15&&(F+=Z[g++]<<q,q+=8,F+=Z[g++]<<q,q+=8),ue=ee[F&ne];t:for(;;){if(F>>>=Ce=ue>>>24,q-=Ce,(Ce=ue>>>16&255)===0)tt[E++]=65535&ue;else{if(!(16&Ce)){if(!(64&Ce)){ue=ee[(65535&ue)+(F&(1<<Ce)-1)];continue t}if(32&Ce){n.mode=12;break e}f.msg="invalid literal/length code",n.mode=30;break e}ye=65535&ue,(Ce&=15)&&(q<Ce&&(F+=Z[g++]<<q,q+=8),ye+=F&(1<<Ce)-1,F>>>=Ce,q-=Ce),q<15&&(F+=Z[g++]<<q,q+=8,F+=Z[g++]<<q,q+=8),ue=ie[F&se];i:for(;;){if(F>>>=Ce=ue>>>24,q-=Ce,!(16&(Ce=ue>>>16&255))){if(!(64&Ce)){ue=ie[(65535&ue)+(F&(1<<Ce)-1)];continue i}f.msg="invalid distance code",n.mode=30;break e}if(Xe=65535&ue,q<(Ce&=15)&&(F+=Z[g++]<<q,(q+=8)<Ce&&(F+=Z[g++]<<q,q+=8)),k<(Xe+=F&(1<<Ce)-1)){f.msg="invalid distance too far back",n.mode=30;break e}if(F>>>=Ce,q-=Ce,(Ce=E-S)<Xe){if(A<(Ce=Xe-Ce)&&n.sane){f.msg="invalid distance too far back",n.mode=30;break e}if(Le=D,(ae=0)===R){if(ae+=z-Ce,Ce<ye){for(ye-=Ce;tt[E++]=D[ae++],--Ce;);ae=E-Xe,Le=tt}}else if(R<Ce){if(ae+=z+R-Ce,(Ce-=R)<ye){for(ye-=Ce;tt[E++]=D[ae++],--Ce;);if(ae=0,R<ye){for(ye-=Ce=R;tt[E++]=D[ae++],--Ce;);ae=E-Xe,Le=tt}}}else if(ae+=R-Ce,Ce<ye){for(ye-=Ce;tt[E++]=D[ae++],--Ce;);ae=E-Xe,Le=tt}for(;2<ye;)tt[E++]=Le[ae++],tt[E++]=Le[ae++],tt[E++]=Le[ae++],ye-=3;ye&&(tt[E++]=Le[ae++],1<ye&&(tt[E++]=Le[ae++]))}else{for(ae=E-Xe;tt[E++]=tt[ae++],tt[E++]=tt[ae++],tt[E++]=tt[ae++],2<(ye-=3););ye&&(tt[E++]=tt[ae++],1<ye&&(tt[E++]=tt[ae++]))}break}}break}}while(g<v&&E<T);g-=ye=q>>3,F&=(1<<(q-=ye<<3))-1,f.next_in=g,f.next_out=E,f.avail_in=g<v?v-g+5:5-(g-v),f.avail_out=E<T?T-E+257:257-(E-T),n.hold=F,n.bits=q}},{}],49:[function(a,l,u){var f=a("../utils/common"),d=a("./adler32"),n=a("./crc32"),g=a("./inffast"),v=a("./inftrees"),E=1,S=2,T=0,k=-2,z=1,A=852,R=592;function D(ae){return(ae>>>24&255)+(ae>>>8&65280)+((65280&ae)<<8)+((255&ae)<<24)}function F(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new f.Buf16(320),this.work=new f.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function q(ae){var Le;return ae&&ae.state?(Le=ae.state,ae.total_in=ae.total_out=Le.total=0,ae.msg="",Le.wrap&&(ae.adler=1&Le.wrap),Le.mode=z,Le.last=0,Le.havedict=0,Le.dmax=32768,Le.head=null,Le.hold=0,Le.bits=0,Le.lencode=Le.lendyn=new f.Buf32(A),Le.distcode=Le.distdyn=new f.Buf32(R),Le.sane=1,Le.back=-1,T):k}function ee(ae){var Le;return ae&&ae.state?((Le=ae.state).wsize=0,Le.whave=0,Le.wnext=0,q(ae)):k}function ie(ae,Le){var Z,tt;return ae&&ae.state?(tt=ae.state,Le<0?(Z=0,Le=-Le):(Z=1+(Le>>4),Le<48&&(Le&=15)),Le&&(Le<8||15<Le)?k:(tt.window!==null&&tt.wbits!==Le&&(tt.window=null),tt.wrap=Z,tt.wbits=Le,ee(ae))):k}function ne(ae,Le){var Z,tt;return ae?(tt=new F,(ae.state=tt).window=null,(Z=ie(ae,Le))!==T&&(ae.state=null),Z):k}var se,ue,Ce=!0;function ye(ae){if(Ce){var Le;for(se=new f.Buf32(512),ue=new f.Buf32(32),Le=0;Le<144;)ae.lens[Le++]=8;for(;Le<256;)ae.lens[Le++]=9;for(;Le<280;)ae.lens[Le++]=7;for(;Le<288;)ae.lens[Le++]=8;for(v(E,ae.lens,0,288,se,0,ae.work,{bits:9}),Le=0;Le<32;)ae.lens[Le++]=5;v(S,ae.lens,0,32,ue,0,ae.work,{bits:5}),Ce=!1}ae.lencode=se,ae.lenbits=9,ae.distcode=ue,ae.distbits=5}function Xe(ae,Le,Z,tt){var $t,ft=ae.state;return ft.window===null&&(ft.wsize=1<<ft.wbits,ft.wnext=0,ft.whave=0,ft.window=new f.Buf8(ft.wsize)),tt>=ft.wsize?(f.arraySet(ft.window,Le,Z-ft.wsize,ft.wsize,0),ft.wnext=0,ft.whave=ft.wsize):(tt<($t=ft.wsize-ft.wnext)&&($t=tt),f.arraySet(ft.window,Le,Z-tt,$t,ft.wnext),(tt-=$t)?(f.arraySet(ft.window,Le,Z-tt,tt,0),ft.wnext=tt,ft.whave=ft.wsize):(ft.wnext+=$t,ft.wnext===ft.wsize&&(ft.wnext=0),ft.whave<ft.wsize&&(ft.whave+=$t))),0}u.inflateReset=ee,u.inflateReset2=ie,u.inflateResetKeep=q,u.inflateInit=function(ae){return ne(ae,15)},u.inflateInit2=ne,u.inflate=function(ae,Le){var Z,tt,$t,ft,Jt,ut,at,le,Ee,Re,Q,he,it,Ct,bt,It,Bt,Fe,Se,ct,N,Je,We,we,me=0,Ne=new f.Buf8(4),ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ae||!ae.state||!ae.output||!ae.input&&ae.avail_in!==0)return k;(Z=ae.state).mode===12&&(Z.mode=13),Jt=ae.next_out,$t=ae.output,at=ae.avail_out,ft=ae.next_in,tt=ae.input,ut=ae.avail_in,le=Z.hold,Ee=Z.bits,Re=ut,Q=at,Je=T;e:for(;;)switch(Z.mode){case z:if(Z.wrap===0){Z.mode=13;break}for(;Ee<16;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(2&Z.wrap&&le===35615){Ne[Z.check=0]=255&le,Ne[1]=le>>>8&255,Z.check=n(Z.check,Ne,2,0),Ee=le=0,Z.mode=2;break}if(Z.flags=0,Z.head&&(Z.head.done=!1),!(1&Z.wrap)||(((255&le)<<8)+(le>>8))%31){ae.msg="incorrect header check",Z.mode=30;break}if((15&le)!=8){ae.msg="unknown compression method",Z.mode=30;break}if(Ee-=4,N=8+(15&(le>>>=4)),Z.wbits===0)Z.wbits=N;else if(N>Z.wbits){ae.msg="invalid window size",Z.mode=30;break}Z.dmax=1<<N,ae.adler=Z.check=1,Z.mode=512&le?10:12,Ee=le=0;break;case 2:for(;Ee<16;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(Z.flags=le,(255&Z.flags)!=8){ae.msg="unknown compression method",Z.mode=30;break}if(57344&Z.flags){ae.msg="unknown header flags set",Z.mode=30;break}Z.head&&(Z.head.text=le>>8&1),512&Z.flags&&(Ne[0]=255&le,Ne[1]=le>>>8&255,Z.check=n(Z.check,Ne,2,0)),Ee=le=0,Z.mode=3;case 3:for(;Ee<32;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}Z.head&&(Z.head.time=le),512&Z.flags&&(Ne[0]=255&le,Ne[1]=le>>>8&255,Ne[2]=le>>>16&255,Ne[3]=le>>>24&255,Z.check=n(Z.check,Ne,4,0)),Ee=le=0,Z.mode=4;case 4:for(;Ee<16;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}Z.head&&(Z.head.xflags=255&le,Z.head.os=le>>8),512&Z.flags&&(Ne[0]=255&le,Ne[1]=le>>>8&255,Z.check=n(Z.check,Ne,2,0)),Ee=le=0,Z.mode=5;case 5:if(1024&Z.flags){for(;Ee<16;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}Z.length=le,Z.head&&(Z.head.extra_len=le),512&Z.flags&&(Ne[0]=255&le,Ne[1]=le>>>8&255,Z.check=n(Z.check,Ne,2,0)),Ee=le=0}else Z.head&&(Z.head.extra=null);Z.mode=6;case 6:if(1024&Z.flags&&(ut<(he=Z.length)&&(he=ut),he&&(Z.head&&(N=Z.head.extra_len-Z.length,Z.head.extra||(Z.head.extra=new Array(Z.head.extra_len)),f.arraySet(Z.head.extra,tt,ft,he,N)),512&Z.flags&&(Z.check=n(Z.check,tt,he,ft)),ut-=he,ft+=he,Z.length-=he),Z.length))break e;Z.length=0,Z.mode=7;case 7:if(2048&Z.flags){if(ut===0)break e;for(he=0;N=tt[ft+he++],Z.head&&N&&Z.length<65536&&(Z.head.name+=String.fromCharCode(N)),N&&he<ut;);if(512&Z.flags&&(Z.check=n(Z.check,tt,he,ft)),ut-=he,ft+=he,N)break e}else Z.head&&(Z.head.name=null);Z.length=0,Z.mode=8;case 8:if(4096&Z.flags){if(ut===0)break e;for(he=0;N=tt[ft+he++],Z.head&&N&&Z.length<65536&&(Z.head.comment+=String.fromCharCode(N)),N&&he<ut;);if(512&Z.flags&&(Z.check=n(Z.check,tt,he,ft)),ut-=he,ft+=he,N)break e}else Z.head&&(Z.head.comment=null);Z.mode=9;case 9:if(512&Z.flags){for(;Ee<16;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(le!==(65535&Z.check)){ae.msg="header crc mismatch",Z.mode=30;break}Ee=le=0}Z.head&&(Z.head.hcrc=Z.flags>>9&1,Z.head.done=!0),ae.adler=Z.check=0,Z.mode=12;break;case 10:for(;Ee<32;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}ae.adler=Z.check=D(le),Ee=le=0,Z.mode=11;case 11:if(Z.havedict===0)return ae.next_out=Jt,ae.avail_out=at,ae.next_in=ft,ae.avail_in=ut,Z.hold=le,Z.bits=Ee,2;ae.adler=Z.check=1,Z.mode=12;case 12:if(Le===5||Le===6)break e;case 13:if(Z.last){le>>>=7&Ee,Ee-=7&Ee,Z.mode=27;break}for(;Ee<3;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}switch(Z.last=1&le,Ee-=1,3&(le>>>=1)){case 0:Z.mode=14;break;case 1:if(ye(Z),Z.mode=20,Le!==6)break;le>>>=2,Ee-=2;break e;case 2:Z.mode=17;break;case 3:ae.msg="invalid block type",Z.mode=30}le>>>=2,Ee-=2;break;case 14:for(le>>>=7&Ee,Ee-=7&Ee;Ee<32;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if((65535&le)!=(le>>>16^65535)){ae.msg="invalid stored block lengths",Z.mode=30;break}if(Z.length=65535&le,Ee=le=0,Z.mode=15,Le===6)break e;case 15:Z.mode=16;case 16:if(he=Z.length){if(ut<he&&(he=ut),at<he&&(he=at),he===0)break e;f.arraySet($t,tt,ft,he,Jt),ut-=he,ft+=he,at-=he,Jt+=he,Z.length-=he;break}Z.mode=12;break;case 17:for(;Ee<14;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(Z.nlen=257+(31&le),le>>>=5,Ee-=5,Z.ndist=1+(31&le),le>>>=5,Ee-=5,Z.ncode=4+(15&le),le>>>=4,Ee-=4,286<Z.nlen||30<Z.ndist){ae.msg="too many length or distance symbols",Z.mode=30;break}Z.have=0,Z.mode=18;case 18:for(;Z.have<Z.ncode;){for(;Ee<3;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}Z.lens[ht[Z.have++]]=7&le,le>>>=3,Ee-=3}for(;Z.have<19;)Z.lens[ht[Z.have++]]=0;if(Z.lencode=Z.lendyn,Z.lenbits=7,We={bits:Z.lenbits},Je=v(0,Z.lens,0,19,Z.lencode,0,Z.work,We),Z.lenbits=We.bits,Je){ae.msg="invalid code lengths set",Z.mode=30;break}Z.have=0,Z.mode=19;case 19:for(;Z.have<Z.nlen+Z.ndist;){for(;It=(me=Z.lencode[le&(1<<Z.lenbits)-1])>>>16&255,Bt=65535&me,!((bt=me>>>24)<=Ee);){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(Bt<16)le>>>=bt,Ee-=bt,Z.lens[Z.have++]=Bt;else{if(Bt===16){for(we=bt+2;Ee<we;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(le>>>=bt,Ee-=bt,Z.have===0){ae.msg="invalid bit length repeat",Z.mode=30;break}N=Z.lens[Z.have-1],he=3+(3&le),le>>>=2,Ee-=2}else if(Bt===17){for(we=bt+3;Ee<we;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}Ee-=bt,N=0,he=3+(7&(le>>>=bt)),le>>>=3,Ee-=3}else{for(we=bt+7;Ee<we;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}Ee-=bt,N=0,he=11+(127&(le>>>=bt)),le>>>=7,Ee-=7}if(Z.have+he>Z.nlen+Z.ndist){ae.msg="invalid bit length repeat",Z.mode=30;break}for(;he--;)Z.lens[Z.have++]=N}}if(Z.mode===30)break;if(Z.lens[256]===0){ae.msg="invalid code -- missing end-of-block",Z.mode=30;break}if(Z.lenbits=9,We={bits:Z.lenbits},Je=v(E,Z.lens,0,Z.nlen,Z.lencode,0,Z.work,We),Z.lenbits=We.bits,Je){ae.msg="invalid literal/lengths set",Z.mode=30;break}if(Z.distbits=6,Z.distcode=Z.distdyn,We={bits:Z.distbits},Je=v(S,Z.lens,Z.nlen,Z.ndist,Z.distcode,0,Z.work,We),Z.distbits=We.bits,Je){ae.msg="invalid distances set",Z.mode=30;break}if(Z.mode=20,Le===6)break e;case 20:Z.mode=21;case 21:if(6<=ut&&258<=at){ae.next_out=Jt,ae.avail_out=at,ae.next_in=ft,ae.avail_in=ut,Z.hold=le,Z.bits=Ee,g(ae,Q),Jt=ae.next_out,$t=ae.output,at=ae.avail_out,ft=ae.next_in,tt=ae.input,ut=ae.avail_in,le=Z.hold,Ee=Z.bits,Z.mode===12&&(Z.back=-1);break}for(Z.back=0;It=(me=Z.lencode[le&(1<<Z.lenbits)-1])>>>16&255,Bt=65535&me,!((bt=me>>>24)<=Ee);){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(It&&!(240&It)){for(Fe=bt,Se=It,ct=Bt;It=(me=Z.lencode[ct+((le&(1<<Fe+Se)-1)>>Fe)])>>>16&255,Bt=65535&me,!(Fe+(bt=me>>>24)<=Ee);){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}le>>>=Fe,Ee-=Fe,Z.back+=Fe}if(le>>>=bt,Ee-=bt,Z.back+=bt,Z.length=Bt,It===0){Z.mode=26;break}if(32&It){Z.back=-1,Z.mode=12;break}if(64&It){ae.msg="invalid literal/length code",Z.mode=30;break}Z.extra=15&It,Z.mode=22;case 22:if(Z.extra){for(we=Z.extra;Ee<we;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}Z.length+=le&(1<<Z.extra)-1,le>>>=Z.extra,Ee-=Z.extra,Z.back+=Z.extra}Z.was=Z.length,Z.mode=23;case 23:for(;It=(me=Z.distcode[le&(1<<Z.distbits)-1])>>>16&255,Bt=65535&me,!((bt=me>>>24)<=Ee);){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(!(240&It)){for(Fe=bt,Se=It,ct=Bt;It=(me=Z.distcode[ct+((le&(1<<Fe+Se)-1)>>Fe)])>>>16&255,Bt=65535&me,!(Fe+(bt=me>>>24)<=Ee);){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}le>>>=Fe,Ee-=Fe,Z.back+=Fe}if(le>>>=bt,Ee-=bt,Z.back+=bt,64&It){ae.msg="invalid distance code",Z.mode=30;break}Z.offset=Bt,Z.extra=15&It,Z.mode=24;case 24:if(Z.extra){for(we=Z.extra;Ee<we;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}Z.offset+=le&(1<<Z.extra)-1,le>>>=Z.extra,Ee-=Z.extra,Z.back+=Z.extra}if(Z.offset>Z.dmax){ae.msg="invalid distance too far back",Z.mode=30;break}Z.mode=25;case 25:if(at===0)break e;if(he=Q-at,Z.offset>he){if((he=Z.offset-he)>Z.whave&&Z.sane){ae.msg="invalid distance too far back",Z.mode=30;break}it=he>Z.wnext?(he-=Z.wnext,Z.wsize-he):Z.wnext-he,he>Z.length&&(he=Z.length),Ct=Z.window}else Ct=$t,it=Jt-Z.offset,he=Z.length;for(at<he&&(he=at),at-=he,Z.length-=he;$t[Jt++]=Ct[it++],--he;);Z.length===0&&(Z.mode=21);break;case 26:if(at===0)break e;$t[Jt++]=Z.length,at--,Z.mode=21;break;case 27:if(Z.wrap){for(;Ee<32;){if(ut===0)break e;ut--,le|=tt[ft++]<<Ee,Ee+=8}if(Q-=at,ae.total_out+=Q,Z.total+=Q,Q&&(ae.adler=Z.check=Z.flags?n(Z.check,$t,Q,Jt-Q):d(Z.check,$t,Q,Jt-Q)),Q=at,(Z.flags?le:D(le))!==Z.check){ae.msg="incorrect data check",Z.mode=30;break}Ee=le=0}Z.mode=28;case 28:if(Z.wrap&&Z.flags){for(;Ee<32;){if(ut===0)break e;ut--,le+=tt[ft++]<<Ee,Ee+=8}if(le!==(4294967295&Z.total)){ae.msg="incorrect length check",Z.mode=30;break}Ee=le=0}Z.mode=29;case 29:Je=1;break e;case 30:Je=-3;break e;case 31:return-4;case 32:default:return k}return ae.next_out=Jt,ae.avail_out=at,ae.next_in=ft,ae.avail_in=ut,Z.hold=le,Z.bits=Ee,(Z.wsize||Q!==ae.avail_out&&Z.mode<30&&(Z.mode<27||Le!==4))&&Xe(ae,ae.output,ae.next_out,Q-ae.avail_out)?(Z.mode=31,-4):(Re-=ae.avail_in,Q-=ae.avail_out,ae.total_in+=Re,ae.total_out+=Q,Z.total+=Q,Z.wrap&&Q&&(ae.adler=Z.check=Z.flags?n(Z.check,$t,Q,ae.next_out-Q):d(Z.check,$t,Q,ae.next_out-Q)),ae.data_type=Z.bits+(Z.last?64:0)+(Z.mode===12?128:0)+(Z.mode===20||Z.mode===15?256:0),(Re==0&&Q===0||Le===4)&&Je===T&&(Je=-5),Je)},u.inflateEnd=function(ae){if(!ae||!ae.state)return k;var Le=ae.state;return Le.window&&(Le.window=null),ae.state=null,T},u.inflateGetHeader=function(ae,Le){var Z;return ae&&ae.state&&2&(Z=ae.state).wrap?((Z.head=Le).done=!1,T):k},u.inflateSetDictionary=function(ae,Le){var Z,tt=Le.length;return ae&&ae.state?(Z=ae.state).wrap!==0&&Z.mode!==11?k:Z.mode===11&&d(1,Le,tt,0)!==Z.check?-3:Xe(ae,Le,tt,tt)?(Z.mode=31,-4):(Z.havedict=1,T):k},u.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(a,l,u){var f=a("../utils/common"),d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],v=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(E,S,T,k,z,A,R,D){var F,q,ee,ie,ne,se,ue,Ce,ye,Xe=D.bits,ae=0,Le=0,Z=0,tt=0,$t=0,ft=0,Jt=0,ut=0,at=0,le=0,Ee=null,Re=0,Q=new f.Buf16(16),he=new f.Buf16(16),it=null,Ct=0;for(ae=0;ae<=15;ae++)Q[ae]=0;for(Le=0;Le<k;Le++)Q[S[T+Le]]++;for($t=Xe,tt=15;1<=tt&&Q[tt]===0;tt--);if(tt<$t&&($t=tt),tt===0)return z[A++]=20971520,z[A++]=20971520,D.bits=1,0;for(Z=1;Z<tt&&Q[Z]===0;Z++);for($t<Z&&($t=Z),ae=ut=1;ae<=15;ae++)if(ut<<=1,(ut-=Q[ae])<0)return-1;if(0<ut&&(E===0||tt!==1))return-1;for(he[1]=0,ae=1;ae<15;ae++)he[ae+1]=he[ae]+Q[ae];for(Le=0;Le<k;Le++)S[T+Le]!==0&&(R[he[S[T+Le]]++]=Le);if(se=E===0?(Ee=it=R,19):E===1?(Ee=d,Re-=257,it=n,Ct-=257,256):(Ee=g,it=v,-1),ae=Z,ne=A,Jt=Le=le=0,ee=-1,ie=(at=1<<(ft=$t))-1,E===1&&852<at||E===2&&592<at)return 1;for(;;){for(ue=ae-Jt,ye=R[Le]<se?(Ce=0,R[Le]):R[Le]>se?(Ce=it[Ct+R[Le]],Ee[Re+R[Le]]):(Ce=96,0),F=1<<ae-Jt,Z=q=1<<ft;z[ne+(le>>Jt)+(q-=F)]=ue<<24|Ce<<16|ye|0,q!==0;);for(F=1<<ae-1;le&F;)F>>=1;if(F!==0?(le&=F-1,le+=F):le=0,Le++,--Q[ae]==0){if(ae===tt)break;ae=S[T+R[Le]]}if($t<ae&&(le&ie)!==ee){for(Jt===0&&(Jt=$t),ne+=Z,ut=1<<(ft=ae-Jt);ft+Jt<tt&&!((ut-=Q[ft+Jt])<=0);)ft++,ut<<=1;if(at+=1<<ft,E===1&&852<at||E===2&&592<at)return 1;z[ee=le&ie]=$t<<24|ft<<16|ne-A|0}}return le!==0&&(z[ne+le]=ae-Jt<<24|64<<16|0),D.bits=$t,0}},{"../utils/common":41}],51:[function(a,l,u){l.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(a,l,u){var f=a("../utils/common"),d=0,n=1;function g(me){for(var Ne=me.length;0<=--Ne;)me[Ne]=0}var v=0,E=29,S=256,T=S+1+E,k=30,z=19,A=2*T+1,R=15,D=16,F=7,q=256,ee=16,ie=17,ne=18,se=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ue=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ye=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Xe=new Array(2*(T+2));g(Xe);var ae=new Array(2*k);g(ae);var Le=new Array(512);g(Le);var Z=new Array(256);g(Z);var tt=new Array(E);g(tt);var $t,ft,Jt,ut=new Array(k);function at(me,Ne,ht,ke,Qe){this.static_tree=me,this.extra_bits=Ne,this.extra_base=ht,this.elems=ke,this.max_length=Qe,this.has_stree=me&&me.length}function le(me,Ne){this.dyn_tree=me,this.max_code=0,this.stat_desc=Ne}function Ee(me){return me<256?Le[me]:Le[256+(me>>>7)]}function Re(me,Ne){me.pending_buf[me.pending++]=255&Ne,me.pending_buf[me.pending++]=Ne>>>8&255}function Q(me,Ne,ht){me.bi_valid>D-ht?(me.bi_buf|=Ne<<me.bi_valid&65535,Re(me,me.bi_buf),me.bi_buf=Ne>>D-me.bi_valid,me.bi_valid+=ht-D):(me.bi_buf|=Ne<<me.bi_valid&65535,me.bi_valid+=ht)}function he(me,Ne,ht){Q(me,ht[2*Ne],ht[2*Ne+1])}function it(me,Ne){for(var ht=0;ht|=1&me,me>>>=1,ht<<=1,0<--Ne;);return ht>>>1}function Ct(me,Ne,ht){var ke,Qe,xt=new Array(R+1),Tt=0;for(ke=1;ke<=R;ke++)xt[ke]=Tt=Tt+ht[ke-1]<<1;for(Qe=0;Qe<=Ne;Qe++){var dt=me[2*Qe+1];dt!==0&&(me[2*Qe]=it(xt[dt]++,dt))}}function bt(me){var Ne;for(Ne=0;Ne<T;Ne++)me.dyn_ltree[2*Ne]=0;for(Ne=0;Ne<k;Ne++)me.dyn_dtree[2*Ne]=0;for(Ne=0;Ne<z;Ne++)me.bl_tree[2*Ne]=0;me.dyn_ltree[2*q]=1,me.opt_len=me.static_len=0,me.last_lit=me.matches=0}function It(me){8<me.bi_valid?Re(me,me.bi_buf):0<me.bi_valid&&(me.pending_buf[me.pending++]=me.bi_buf),me.bi_buf=0,me.bi_valid=0}function Bt(me,Ne,ht,ke){var Qe=2*Ne,xt=2*ht;return me[Qe]<me[xt]||me[Qe]===me[xt]&&ke[Ne]<=ke[ht]}function Fe(me,Ne,ht){for(var ke=me.heap[ht],Qe=ht<<1;Qe<=me.heap_len&&(Qe<me.heap_len&&Bt(Ne,me.heap[Qe+1],me.heap[Qe],me.depth)&&Qe++,!Bt(Ne,ke,me.heap[Qe],me.depth));)me.heap[ht]=me.heap[Qe],ht=Qe,Qe<<=1;me.heap[ht]=ke}function Se(me,Ne,ht){var ke,Qe,xt,Tt,dt=0;if(me.last_lit!==0)for(;ke=me.pending_buf[me.d_buf+2*dt]<<8|me.pending_buf[me.d_buf+2*dt+1],Qe=me.pending_buf[me.l_buf+dt],dt++,ke===0?he(me,Qe,Ne):(he(me,(xt=Z[Qe])+S+1,Ne),(Tt=se[xt])!==0&&Q(me,Qe-=tt[xt],Tt),he(me,xt=Ee(--ke),ht),(Tt=ue[xt])!==0&&Q(me,ke-=ut[xt],Tt)),dt<me.last_lit;);he(me,q,Ne)}function ct(me,Ne){var ht,ke,Qe,xt=Ne.dyn_tree,Tt=Ne.stat_desc.static_tree,dt=Ne.stat_desc.has_stree,Yt=Ne.stat_desc.elems,ki=-1;for(me.heap_len=0,me.heap_max=A,ht=0;ht<Yt;ht++)xt[2*ht]!==0?(me.heap[++me.heap_len]=ki=ht,me.depth[ht]=0):xt[2*ht+1]=0;for(;me.heap_len<2;)xt[2*(Qe=me.heap[++me.heap_len]=ki<2?++ki:0)]=1,me.depth[Qe]=0,me.opt_len--,dt&&(me.static_len-=Tt[2*Qe+1]);for(Ne.max_code=ki,ht=me.heap_len>>1;1<=ht;ht--)Fe(me,xt,ht);for(Qe=Yt;ht=me.heap[1],me.heap[1]=me.heap[me.heap_len--],Fe(me,xt,1),ke=me.heap[1],me.heap[--me.heap_max]=ht,me.heap[--me.heap_max]=ke,xt[2*Qe]=xt[2*ht]+xt[2*ke],me.depth[Qe]=(me.depth[ht]>=me.depth[ke]?me.depth[ht]:me.depth[ke])+1,xt[2*ht+1]=xt[2*ke+1]=Qe,me.heap[1]=Qe++,Fe(me,xt,1),2<=me.heap_len;);me.heap[--me.heap_max]=me.heap[1],function(Si,Zi){var nr,fr,qr,vt,Ki,br,wr=Zi.dyn_tree,sr=Zi.max_code,zt=Zi.stat_desc.static_tree,yi=Zi.stat_desc.has_stree,vi=Zi.stat_desc.extra_bits,xr=Zi.stat_desc.extra_base,Ur=Zi.stat_desc.max_length,pi=0;for(vt=0;vt<=R;vt++)Si.bl_count[vt]=0;for(wr[2*Si.heap[Si.heap_max]+1]=0,nr=Si.heap_max+1;nr<A;nr++)Ur<(vt=wr[2*wr[2*(fr=Si.heap[nr])+1]+1]+1)&&(vt=Ur,pi++),wr[2*fr+1]=vt,sr<fr||(Si.bl_count[vt]++,Ki=0,xr<=fr&&(Ki=vi[fr-xr]),br=wr[2*fr],Si.opt_len+=br*(vt+Ki),yi&&(Si.static_len+=br*(zt[2*fr+1]+Ki)));if(pi!==0){do{for(vt=Ur-1;Si.bl_count[vt]===0;)vt--;Si.bl_count[vt]--,Si.bl_count[vt+1]+=2,Si.bl_count[Ur]--,pi-=2}while(0<pi);for(vt=Ur;vt!==0;vt--)for(fr=Si.bl_count[vt];fr!==0;)sr<(qr=Si.heap[--nr])||(wr[2*qr+1]!==vt&&(Si.opt_len+=(vt-wr[2*qr+1])*wr[2*qr],wr[2*qr+1]=vt),fr--)}}(me,Ne),Ct(xt,ki,me.bl_count)}function N(me,Ne,ht){var ke,Qe,xt=-1,Tt=Ne[1],dt=0,Yt=7,ki=4;for(Tt===0&&(Yt=138,ki=3),Ne[2*(ht+1)+1]=65535,ke=0;ke<=ht;ke++)Qe=Tt,Tt=Ne[2*(ke+1)+1],++dt<Yt&&Qe===Tt||(dt<ki?me.bl_tree[2*Qe]+=dt:Qe!==0?(Qe!==xt&&me.bl_tree[2*Qe]++,me.bl_tree[2*ee]++):dt<=10?me.bl_tree[2*ie]++:me.bl_tree[2*ne]++,xt=Qe,ki=(dt=0)===Tt?(Yt=138,3):Qe===Tt?(Yt=6,3):(Yt=7,4))}function Je(me,Ne,ht){var ke,Qe,xt=-1,Tt=Ne[1],dt=0,Yt=7,ki=4;for(Tt===0&&(Yt=138,ki=3),ke=0;ke<=ht;ke++)if(Qe=Tt,Tt=Ne[2*(ke+1)+1],!(++dt<Yt&&Qe===Tt)){if(dt<ki)for(;he(me,Qe,me.bl_tree),--dt!=0;);else Qe!==0?(Qe!==xt&&(he(me,Qe,me.bl_tree),dt--),he(me,ee,me.bl_tree),Q(me,dt-3,2)):dt<=10?(he(me,ie,me.bl_tree),Q(me,dt-3,3)):(he(me,ne,me.bl_tree),Q(me,dt-11,7));xt=Qe,ki=(dt=0)===Tt?(Yt=138,3):Qe===Tt?(Yt=6,3):(Yt=7,4)}}g(ut);var We=!1;function we(me,Ne,ht,ke){Q(me,(v<<1)+(ke?1:0),3),function(Qe,xt,Tt,dt){It(Qe),dt&&(Re(Qe,Tt),Re(Qe,~Tt)),f.arraySet(Qe.pending_buf,Qe.window,xt,Tt,Qe.pending),Qe.pending+=Tt}(me,Ne,ht,!0)}u._tr_init=function(me){We||(function(){var Ne,ht,ke,Qe,xt,Tt=new Array(R+1);for(Qe=ke=0;Qe<E-1;Qe++)for(tt[Qe]=ke,Ne=0;Ne<1<<se[Qe];Ne++)Z[ke++]=Qe;for(Z[ke-1]=Qe,Qe=xt=0;Qe<16;Qe++)for(ut[Qe]=xt,Ne=0;Ne<1<<ue[Qe];Ne++)Le[xt++]=Qe;for(xt>>=7;Qe<k;Qe++)for(ut[Qe]=xt<<7,Ne=0;Ne<1<<ue[Qe]-7;Ne++)Le[256+xt++]=Qe;for(ht=0;ht<=R;ht++)Tt[ht]=0;for(Ne=0;Ne<=143;)Xe[2*Ne+1]=8,Ne++,Tt[8]++;for(;Ne<=255;)Xe[2*Ne+1]=9,Ne++,Tt[9]++;for(;Ne<=279;)Xe[2*Ne+1]=7,Ne++,Tt[7]++;for(;Ne<=287;)Xe[2*Ne+1]=8,Ne++,Tt[8]++;for(Ct(Xe,T+1,Tt),Ne=0;Ne<k;Ne++)ae[2*Ne+1]=5,ae[2*Ne]=it(Ne,5);$t=new at(Xe,se,S+1,T,R),ft=new at(ae,ue,0,k,R),Jt=new at(new Array(0),Ce,0,z,F)}(),We=!0),me.l_desc=new le(me.dyn_ltree,$t),me.d_desc=new le(me.dyn_dtree,ft),me.bl_desc=new le(me.bl_tree,Jt),me.bi_buf=0,me.bi_valid=0,bt(me)},u._tr_stored_block=we,u._tr_flush_block=function(me,Ne,ht,ke){var Qe,xt,Tt=0;0<me.level?(me.strm.data_type===2&&(me.strm.data_type=function(dt){var Yt,ki=4093624447;for(Yt=0;Yt<=31;Yt++,ki>>>=1)if(1&ki&&dt.dyn_ltree[2*Yt]!==0)return d;if(dt.dyn_ltree[18]!==0||dt.dyn_ltree[20]!==0||dt.dyn_ltree[26]!==0)return n;for(Yt=32;Yt<S;Yt++)if(dt.dyn_ltree[2*Yt]!==0)return n;return d}(me)),ct(me,me.l_desc),ct(me,me.d_desc),Tt=function(dt){var Yt;for(N(dt,dt.dyn_ltree,dt.l_desc.max_code),N(dt,dt.dyn_dtree,dt.d_desc.max_code),ct(dt,dt.bl_desc),Yt=z-1;3<=Yt&&dt.bl_tree[2*ye[Yt]+1]===0;Yt--);return dt.opt_len+=3*(Yt+1)+5+5+4,Yt}(me),Qe=me.opt_len+3+7>>>3,(xt=me.static_len+3+7>>>3)<=Qe&&(Qe=xt)):Qe=xt=ht+5,ht+4<=Qe&&Ne!==-1?we(me,Ne,ht,ke):me.strategy===4||xt===Qe?(Q(me,2+(ke?1:0),3),Se(me,Xe,ae)):(Q(me,4+(ke?1:0),3),function(dt,Yt,ki,Si){var Zi;for(Q(dt,Yt-257,5),Q(dt,ki-1,5),Q(dt,Si-4,4),Zi=0;Zi<Si;Zi++)Q(dt,dt.bl_tree[2*ye[Zi]+1],3);Je(dt,dt.dyn_ltree,Yt-1),Je(dt,dt.dyn_dtree,ki-1)}(me,me.l_desc.max_code+1,me.d_desc.max_code+1,Tt+1),Se(me,me.dyn_ltree,me.dyn_dtree)),bt(me),ke&&It(me)},u._tr_tally=function(me,Ne,ht){return me.pending_buf[me.d_buf+2*me.last_lit]=Ne>>>8&255,me.pending_buf[me.d_buf+2*me.last_lit+1]=255&Ne,me.pending_buf[me.l_buf+me.last_lit]=255&ht,me.last_lit++,Ne===0?me.dyn_ltree[2*ht]++:(me.matches++,Ne--,me.dyn_ltree[2*(Z[ht]+S+1)]++,me.dyn_dtree[2*Ee(Ne)]++),me.last_lit===me.lit_bufsize-1},u._tr_align=function(me){Q(me,2,3),he(me,q,Xe),function(Ne){Ne.bi_valid===16?(Re(Ne,Ne.bi_buf),Ne.bi_buf=0,Ne.bi_valid=0):8<=Ne.bi_valid&&(Ne.pending_buf[Ne.pending++]=255&Ne.bi_buf,Ne.bi_buf>>=8,Ne.bi_valid-=8)}(me)}},{"../utils/common":41}],53:[function(a,l,u){l.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(a,l,u){(function(f){(function(d,n){if(!d.setImmediate){var g,v,E,S,T=1,k={},z=!1,A=d.document,R=Object.getPrototypeOf&&Object.getPrototypeOf(d);R=R&&R.setTimeout?R:d,g={}.toString.call(d.process)==="[object process]"?function(ee){process.nextTick(function(){F(ee)})}:function(){if(d.postMessage&&!d.importScripts){var ee=!0,ie=d.onmessage;return d.onmessage=function(){ee=!1},d.postMessage("","*"),d.onmessage=ie,ee}}()?(S="setImmediate$"+Math.random()+"$",d.addEventListener?d.addEventListener("message",q,!1):d.attachEvent("onmessage",q),function(ee){d.postMessage(S+ee,"*")}):d.MessageChannel?((E=new MessageChannel).port1.onmessage=function(ee){F(ee.data)},function(ee){E.port2.postMessage(ee)}):A&&"onreadystatechange"in A.createElement("script")?(v=A.documentElement,function(ee){var ie=A.createElement("script");ie.onreadystatechange=function(){F(ee),ie.onreadystatechange=null,v.removeChild(ie),ie=null},v.appendChild(ie)}):function(ee){setTimeout(F,0,ee)},R.setImmediate=function(ee){typeof ee!="function"&&(ee=new Function(""+ee));for(var ie=new Array(arguments.length-1),ne=0;ne<ie.length;ne++)ie[ne]=arguments[ne+1];var se={callback:ee,args:ie};return k[T]=se,g(T),T++},R.clearImmediate=D}function D(ee){delete k[ee]}function F(ee){if(z)setTimeout(F,0,ee);else{var ie=k[ee];if(ie){z=!0;try{(function(ne){var se=ne.callback,ue=ne.args;switch(ue.length){case 0:se();break;case 1:se(ue[0]);break;case 2:se(ue[0],ue[1]);break;case 3:se(ue[0],ue[1],ue[2]);break;default:se.apply(n,ue)}})(ie)}finally{D(ee),z=!1}}}}function q(ee){ee.source===d&&typeof ee.data=="string"&&ee.data.indexOf(S)===0&&F(+ee.data.slice(S.length))}})(typeof self>"u"?f===void 0?this:f:self)}).call(this,typeof $o<"u"?$o:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(uy);var oS=uy.exports;const lS=Ku(oS);const{document:ds}=L_;function l_(c,r,a){const l=c.slice();return l[25]=r[a],l}function c_(c,r,a){const l=c.slice();return l[28]=r[a],l}function u_(c,r,a){const l=c.slice();return l[31]=r[a],l}function h_(c){let r,a,l=k_(c[0]),u,f,d;r=new R_({props:{mode:c[3]=="failed"?"error":"info",$$slots:{default:[mS]},$$scope:{ctx:c}}});let n=l&&m_(c);return{c(){ii(r.$$.fragment),a=mt(),n&&n.c(),u=mt(),f=$e("div"),this.h()},l(g){si(r.$$.fragment,g),a=gt(g),n&&n.l(g),u=gt(g),f=je(g,"DIV",{}),et(f).forEach(J),this.h()},h(){Ft(f,"height","24px")},m(g,v){ri(r,g,v),Ze(g,a,v),n&&n.m(g,v),Ze(g,u,v),Ze(g,f,v),d=!0},p(g,v){const E={};v[0]&8&&(E.mode=g[3]=="failed"?"error":"info"),v[0]&10|v[1]&8&&(E.$$scope={dirty:v,ctx:g}),r.$set(E),v[0]&1&&(l=k_(g[0])),l?n?(n.p(g,v),v[0]&1&&Ye(n,1)):(n=m_(g),n.c(),Ye(n,1),n.m(u.parentNode,u)):n&&(Ni(),st(n,1,1,()=>{n=null}),Ui())},i(g){d||(Ye(r.$$.fragment,g),Ye(n),d=!0)},o(g){st(r.$$.fragment,g),st(n),d=!1},d(g){g&&(J(a),J(u),J(f)),ni(r,g),n&&n.d(g)}}}function f_(c){let r;function a(f,d){return f[1].length===1?uS:cS}let l=a(c),u=l(c);return{c(){r=$e("p"),u.c()},l(f){r=je(f,"P",{});var d=et(r);u.l(d),d.forEach(J)},m(f,d){Ze(f,r,d),u.m(r,null)},p(f,d){l===(l=a(f))&&u?u.p(f,d):(u.d(1),u=l(f),u&&(u.c(),u.m(r,null)))},d(f){f&&J(r),u.d()}}}function cS(c){let r,a;function l(d,n){return d[1].length===2?fS:hS}let u=l(c),f=u(c);return{c(){r=Ut("The profile below is for people who share "),f.c(),a=Ut(`
                of the following characteristics:`)},l(d){r=Vt(d,"The profile below is for people who share "),f.l(d),a=Vt(d,`
                of the following characteristics:`)},m(d,n){Ze(d,r,n),f.m(d,n),Ze(d,a,n)},p(d,n){u!==(u=l(d))&&(f.d(1),f=u(d),f&&(f.c(),f.m(a.parentNode,a)))},d(d){d&&(J(r),J(a)),f.d(d)}}}function uS(c){let r;return{c(){r=Ut(`The profile below is for people who share the following
                characteristic:`)},l(a){r=Vt(a,`The profile below is for people who share the following
                characteristic:`)},m(a,l){Ze(a,r,l)},p:Ci,d(a){a&&J(r)}}}function hS(c){let r;return{c(){r=Ut("all")},l(a){r=Vt(a,"all")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function fS(c){let r;return{c(){r=Ut("both")},l(a){r=Vt(a,"both")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function dS(c){let r,a,l=fa(c[31].topic)+"",u,f,d=fa(Ka(c[31].label))+"",n,g,v,E,S;function T(){return c[12](c[31])}return{c(){r=$e("button"),a=$e("span"),u=Ut(l),f=Ut(": "),n=Ut(d),g=mt(),v=$e("span"),this.h()},l(k){r=je(k,"BUTTON",{class:!0});var z=et(r);a=je(z,"SPAN",{class:!0});var A=et(a);u=Vt(A,l),f=Vt(A,": "),n=Vt(A,d),A.forEach(J),g=gt(z),v=je(z,"SPAN",{class:!0}),et(v).forEach(J),z.forEach(J),this.h()},h(){_e(a,"class","chip-text svelte-1mbdfig"),_e(v,"class","chip-ready svelte-1mbdfig"),_e(r,"class","chip svelte-1mbdfig")},m(k,z){Ze(k,r,z),ze(r,a),ze(a,u),ze(a,f),ze(a,n),ze(r,g),ze(r,v),E||(S=$s(r,"click",T),E=!0)},p(k,z){c=k,z[0]&2&&l!==(l=fa(c[31].topic)+"")&&bi(u,l),z[0]&2&&d!==(d=fa(Ka(c[31].label))+"")&&bi(n,d)},d(k){k&&J(r),E=!1,S()}}}function pS(c){let r,a,l=fa(c[31].topic)+"",u,f,d=fa(Ka(c[31].label))+"",n,g,v;return{c(){r=$e("div"),a=$e("span"),u=Ut(l),f=Ut(": "),n=Ut(d),g=mt(),v=$e("div"),this.h()},l(E){r=je(E,"DIV",{class:!0});var S=et(r);a=je(S,"SPAN",{class:!0});var T=et(a);u=Vt(T,l),f=Vt(T,": "),n=Vt(T,d),T.forEach(J),g=gt(S),v=je(S,"DIV",{class:!0}),et(v).forEach(J),S.forEach(J),this.h()},h(){_e(a,"class","chip-text svelte-1mbdfig"),_e(v,"class","chip-loader svelte-1mbdfig"),_e(r,"class","chip chip-pending svelte-1mbdfig")},m(E,S){Ze(E,r,S),ze(r,a),ze(a,u),ze(a,f),ze(a,n),ze(r,g),ze(r,v)},p(E,S){S[0]&2&&l!==(l=fa(E[31].topic)+"")&&bi(u,l),S[0]&2&&d!==(d=fa(Ka(E[31].label))+"")&&bi(n,d)},d(E){E&&J(r)}}}function d_(c){let r;function a(f,d){return f[3]=="loading"?pS:dS}let l=a(c),u=l(c);return{c(){u.c(),r=oi()},l(f){u.l(f),r=oi()},m(f,d){u.m(f,d),Ze(f,r,d)},p(f,d){l===(l=a(f))&&u?u.p(f,d):(u.d(1),u=l(f),u&&(u.c(),u.m(r.parentNode,r)))},d(f){f&&J(r),u.d(f)}}}function p_(c){let r,a=`No data is available for the selected variables. Try removing a
              variable to see more datasets.`;return{c(){r=$e("p"),r.textContent=a,this.h()},l(l){r=je(l,"P",{"data-svelte-h":!0}),lr(r)!=="svelte-1vmdqji"&&(r.textContent=a),this.h()},h(){Ft(r,"margin","1rem 0 0")},m(l,u){Ze(l,r,u)},d(l){l&&J(r)}}}function mS(c){let r,a,l,u=c[3]!="failed"&&f_(c),f=Pi(c[1]),d=[];for(let g=0;g<f.length;g+=1)d[g]=d_(u_(c,f,g));let n=c[3]=="failed"&&p_();return{c(){r=$e("div"),u&&u.c(),a=mt();for(let g=0;g<d.length;g+=1)d[g].c();l=mt(),n&&n.c(),this.h()},l(g){r=je(g,"DIV",{"aria-live":!0});var v=et(r);u&&u.l(v),a=gt(v);for(let E=0;E<d.length;E+=1)d[E].l(v);l=gt(v),n&&n.l(v),v.forEach(J),this.h()},h(){_e(r,"aria-live","polite")},m(g,v){Ze(g,r,v),u&&u.m(r,null),ze(r,a);for(let E=0;E<d.length;E+=1)d[E]&&d[E].m(r,null);ze(r,l),n&&n.m(r,null)},p(g,v){if(g[3]!="failed"?u?u.p(g,v):(u=f_(g),u.c(),u.m(r,a)):u&&(u.d(1),u=null),v[0]&266){f=Pi(g[1]);let E;for(E=0;E<f.length;E+=1){const S=u_(g,f,E);d[E]?d[E].p(S,v):(d[E]=d_(S),d[E].c(),d[E].m(r,l))}for(;E<d.length;E+=1)d[E].d(1);d.length=f.length}g[3]=="failed"?n||(n=p_(),n.c(),n.m(r,null)):n&&(n.d(1),n=null)},d(g){g&&J(r),u&&u.d(),Pr(d,g),n&&n.d()}}}function m_(c){let r,a;return r=new R_({props:{mode:"info",$$slots:{default:[gS]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u[0]&17|u[1]&8&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function g_(c){let r,a,l,u="Protecting personal data",f;return{c(){r=$e("br"),a=mt(),l=$e("a"),l.textContent=u,f=Ut(`
            prevents some datasets from being included.`),this.h()},l(d){r=je(d,"BR",{}),a=gt(d),l=je(d,"A",{href:!0,class:!0,"data-svelte-h":!0}),lr(l)!=="svelte-1bmwzx7"&&(l.textContent=u),f=Vt(d,`
            prevents some datasets from being included.`),this.h()},h(){_e(l,"href","https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/methodologies/protectingpersonaldataincensus2021results"),_e(l,"class","svelte-1mbdfig")},m(d,n){Ze(d,r,n),Ze(d,a,n),Ze(d,l,n),Ze(d,f,n)},d(d){d&&(J(r),J(a),J(l),J(f))}}}function __(c){let r,a;return{c(){r=$e("br"),a=Ut(`
            Work-related indicators (employment, occupation etc) are not available
            for ages 0 to 15.`)},l(l){r=je(l,"BR",{}),a=Vt(l,`
            Work-related indicators (employment, occupation etc) are not available
            for ages 0 to 15.`)},m(l,u){Ze(l,r,u),Ze(l,a,u)},d(l){l&&(J(r),J(a))}}}function gS(c){let r,a=c[0].availableChartCounts.available+"",l,u,f=c[0].availableChartCounts.total+"",d,n,g,v,E,S=c[0].availableChartCounts.missingBecauseDisclosive>0&&g_(),T=c[4]&&c[0].availableChartCounts.missingAgeUnder16>0&&__();return{c(){r=$e("strong"),l=Ut(a),u=Ut(`
            of `),d=Ut(f),n=Ut(" charts are available."),g=mt(),S&&S.c(),v=mt(),T&&T.c(),E=oi()},l(k){r=je(k,"STRONG",{});var z=et(r);l=Vt(z,a),u=Vt(z,`
            of `),d=Vt(z,f),n=Vt(z," charts are available."),z.forEach(J),g=gt(k),S&&S.l(k),v=gt(k),T&&T.l(k),E=oi()},m(k,z){Ze(k,r,z),ze(r,l),ze(r,u),ze(r,d),ze(r,n),Ze(k,g,z),S&&S.m(k,z),Ze(k,v,z),T&&T.m(k,z),Ze(k,E,z)},p(k,z){z[0]&1&&a!==(a=k[0].availableChartCounts.available+"")&&bi(l,a),z[0]&1&&f!==(f=k[0].availableChartCounts.total+"")&&bi(d,f),k[0].availableChartCounts.missingBecauseDisclosive>0?S||(S=g_(),S.c(),S.m(v.parentNode,v)):S&&(S.d(1),S=null),k[4]&&k[0].availableChartCounts.missingAgeUnder16>0?T||(T=__(),T.c(),T.m(E.parentNode,E)):T&&(T.d(1),T=null)},d(k){k&&(J(r),J(g),J(v),J(E)),S&&S.d(k),T&&T.d(k)}}}function _S(c){let r,a,l;function u(d){c[14](d)}let f={options:h1,clickCallback:c[7],removeCatCallback:c[13],globalSelectedCategories:c[1],disabled:c[3]==="loading"};return c[5]!==void 0&&(f.activeColumn=c[5]),r=new O2({props:f}),yc.push(()=>Wu(r,"activeColumn",u)),{c(){ii(r.$$.fragment)},l(d){si(r.$$.fragment,d)},m(d,n){ri(r,d,n),l=!0},p(d,n){const g={};n[0]&2&&(g.globalSelectedCategories=d[1]),n[0]&8&&(g.disabled=d[3]==="loading"),!a&&n[0]&32&&(a=!0,g.activeColumn=d[5],Gu(()=>a=!1)),r.$set(g)},i(d){l||(Ye(r.$$.fragment,d),l=!0)},o(d){st(r.$$.fragment,d),l=!1},d(d){ni(r,d)}}}function yS(c){let r,a,l=`Select one or more identity characteristics to define a population group,
      for example people whose
      <a href="?main_language_23a=6" data-sveltekit-noscroll="" class="svelte-1mbdfig">main language is Spanish</a>
      or people
      <a href="?disability_3a=1&amp;country_of_birth_3a=1" data-sveltekit-noscroll="" class="svelte-1mbdfig">born in the UK who are disabled under the Equality Act</a>. Once selected, you will see how your selected group compares to the
      whole population of England and Wales, based on Census 2021 data.`,u,f,d,n,g,v=c[1][0]&&h_(c);function E(T){c[15](T)}let S={title:c[1][0]?c[1][2]?"Change selected characteristics":"Add another characteristic":"Start creating profile",$$slots:{default:[_S]},$$scope:{ctx:c}};return c[2]!==void 0&&(S.open=c[2]),d=new rS({props:S}),yc.push(()=>Wu(d,"open",E)),{c(){r=$e("div"),a=$e("p"),a.innerHTML=l,u=mt(),v&&v.c(),f=mt(),ii(d.$$.fragment),this.h()},l(T){r=je(T,"DIV",{slot:!0});var k=et(r);a=je(k,"P",{class:!0,"data-svelte-h":!0}),lr(a)!=="svelte-4suibz"&&(a.innerHTML=l),u=gt(k),v&&v.l(k),f=gt(k),si(d.$$.fragment,k),k.forEach(J),this.h()},h(){_e(a,"class","subtitle svelte-1mbdfig"),_e(r,"slot","after")},m(T,k){Ze(T,r,k),ze(r,a),ze(r,u),v&&v.m(r,null),ze(r,f),ri(d,r,null),g=!0},p(T,k){T[1][0]?v?(v.p(T,k),k[0]&2&&Ye(v,1)):(v=h_(T),v.c(),Ye(v,1),v.m(r,f)):v&&(Ni(),st(v,1,1,()=>{v=null}),Ui());const z={};k[0]&2&&(z.title=T[1][0]?T[1][2]?"Change selected characteristics":"Add another characteristic":"Start creating profile"),k[0]&42|k[1]&8&&(z.$$scope={dirty:k,ctx:T}),!n&&k[0]&4&&(n=!0,z.open=T[2],Gu(()=>n=!1)),d.$set(z)},i(T){g||(Ye(v),Ye(d.$$.fragment,T),g=!0)},o(T){st(v),st(d.$$.fragment,T),g=!1},d(T){T&&J(r),v&&v.d(),ni(d)}}}function y_(c){let r,a,l=_c(c[0]),u,f,d,n,g,v,E,S;r=new Rf({props:{title:"Demographics",height:"auto",$$slots:{default:[wS]},$$scope:{ctx:c}}});let T=l&&b_(c);return d=new mm({props:{title:"Use this profile",$$slots:{default:[PS]},$$scope:{ctx:c}}}),g=new W1({props:{title:"Share this profile"}}),E=new mm({props:{title:"About the data",width:"medium",$$slots:{default:[zS]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment),a=mt(),T&&T.c(),u=mt(),f=$e("div"),ii(d.$$.fragment),n=mt(),ii(g.$$.fragment),v=mt(),ii(E.$$.fragment),this.h()},l(k){si(r.$$.fragment,k),a=gt(k),T&&T.l(k),u=gt(k),f=je(k,"DIV",{class:!0});var z=et(f);si(d.$$.fragment,z),n=gt(z),si(g.$$.fragment,z),z.forEach(J),v=gt(k),si(E.$$.fragment,k),this.h()},h(){_e(f,"class","hide-when-printing svelte-1mbdfig")},m(k,z){ri(r,k,z),Ze(k,a,z),T&&T.m(k,z),Ze(k,u,z),Ze(k,f,z),ri(d,f,null),ze(f,n),ri(g,f,null),Ze(k,v,z),ri(E,k,z),S=!0},p(k,z){const A={};z[0]&3|z[1]&8&&(A.$$scope={dirty:z,ctx:k}),r.$set(A),z[0]&1&&(l=_c(k[0])),l?T?(T.p(k,z),z[0]&1&&Ye(T,1)):(T=b_(k),T.c(),Ye(T,1),T.m(u.parentNode,u)):T&&(Ni(),st(T,1,1,()=>{T=null}),Ui());const R={};z[0]&1|z[1]&8&&(R.$$scope={dirty:z,ctx:k}),d.$set(R);const D={};z[1]&8&&(D.$$scope={dirty:z,ctx:k}),E.$set(D)},i(k){S||(Ye(r.$$.fragment,k),Ye(T),Ye(d.$$.fragment,k),Ye(g.$$.fragment,k),Ye(E.$$.fragment,k),S=!0)},o(k){st(r.$$.fragment,k),st(T),st(d.$$.fragment,k),st(g.$$.fragment,k),st(E.$$.fragment,k),S=!1},d(k){k&&(J(a),J(u),J(f),J(v)),ni(r,k),T&&T.d(k),ni(d),ni(g),ni(E,k)}}}function vS(c){let r;return{c(){r=Ut("Number of people, age and sex compared to the population as a whole.")},l(a){r=Vt(a,"Number of people, age and sex compared to the population as a whole.")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function bS(c){let r,a;return r=new cy({props:{$$slots:{default:[vS]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u[1]&8&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function v_(c){let r,a;return r=new ly({props:{title:"Sex",table:{code:"sex",key:"Sex"},data:c[0],chart_type:c[6]}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u[0]&1&&(f.data=l[0]),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function wS(c){let r,a,l,u,f,d,n=!c[1].map(T_).includes("sex")&&c[0].selected.residents.sex.values!=="blocked",g,v;r=new Ts({props:{colspan:3,noBackground:!0,$$slots:{default:[bS]},$$scope:{ctx:c}}}),l=new RE({props:{data:c[0]}}),f=new XE({props:{data:c[0],selected:c[1]}});let E=n&&v_(c);return{c(){ii(r.$$.fragment),a=mt(),ii(l.$$.fragment),u=mt(),ii(f.$$.fragment),d=mt(),E&&E.c(),g=oi()},l(S){si(r.$$.fragment,S),a=gt(S),si(l.$$.fragment,S),u=gt(S),si(f.$$.fragment,S),d=gt(S),E&&E.l(S),g=oi()},m(S,T){ri(r,S,T),Ze(S,a,T),ri(l,S,T),Ze(S,u,T),ri(f,S,T),Ze(S,d,T),E&&E.m(S,T),Ze(S,g,T),v=!0},p(S,T){const k={};T[1]&8&&(k.$$scope={dirty:T,ctx:S}),r.$set(k);const z={};T[0]&1&&(z.data=S[0]),l.$set(z);const A={};T[0]&1&&(A.data=S[0]),T[0]&2&&(A.selected=S[1]),f.$set(A),T[0]&3&&(n=!S[1].map(T_).includes("sex")&&S[0].selected.residents.sex.values!=="blocked"),n?E?(E.p(S,T),T[0]&3&&Ye(E,1)):(E=v_(S),E.c(),Ye(E,1),E.m(g.parentNode,g)):E&&(Ni(),st(E,1,1,()=>{E=null}),Ui())},i(S){v||(Ye(r.$$.fragment,S),Ye(l.$$.fragment,S),Ye(f.$$.fragment,S),Ye(E),v=!0)},o(S){st(r.$$.fragment,S),st(l.$$.fragment,S),st(f.$$.fragment,S),st(E),v=!1},d(S){S&&(J(a),J(u),J(d),J(g)),ni(r,S),ni(l,S),ni(f,S),E&&E.d(S)}}}function b_(c){let r,a,l,u;r=new bE({props:{data:c[0],mapStyle:a1,mapBounds:o1,maxBounds:l1,ladBounds:ac,selected:c[1],colors:Vo}});let f=Pi(jo[0].tablesCategorised),d=[];for(let g=0;g<f.length;g+=1)d[g]=E_(l_(c,f,g));const n=g=>st(d[g],1,1,()=>{d[g]=null});return{c(){ii(r.$$.fragment),a=mt();for(let g=0;g<d.length;g+=1)d[g].c();l=oi()},l(g){si(r.$$.fragment,g),a=gt(g);for(let v=0;v<d.length;v+=1)d[v].l(g);l=oi()},m(g,v){ri(r,g,v),Ze(g,a,v);for(let E=0;E<d.length;E+=1)d[E]&&d[E].m(g,v);Ze(g,l,v),u=!0},p(g,v){const E={};if(v[0]&1&&(E.data=g[0]),v[0]&2&&(E.selected=g[1]),r.$set(E),v[0]&65){f=Pi(jo[0].tablesCategorised);let S;for(S=0;S<f.length;S+=1){const T=l_(g,f,S);d[S]?(d[S].p(T,v),Ye(d[S],1)):(d[S]=E_(T),d[S].c(),Ye(d[S],1),d[S].m(l.parentNode,l))}for(Ni(),S=f.length;S<d.length;S+=1)n(S);Ui()}},i(g){if(!u){Ye(r.$$.fragment,g);for(let v=0;v<f.length;v+=1)Ye(d[v]);u=!0}},o(g){st(r.$$.fragment,g),d=d.filter(Boolean);for(let v=0;v<d.length;v+=1)st(d[v]);u=!1},d(g){g&&(J(a),J(l)),ni(r,g),Pr(d,g)}}}function w_(c){let r,a;return r=new Rf({props:{title:c[25].categoryName,height:"auto",$$slots:{default:[CS]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u[0]&1|u[1]&8&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function xS(c){let r=c[25].categoryDescription+"",a;return{c(){a=Ut(r)},l(l){a=Vt(l,r)},m(l,u){Ze(l,a,u)},p:Ci,d(l){l&&J(a)}}}function ES(c){let r,a;return r=new cy({props:{$$slots:{default:[xS]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u[1]&8&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function SS(c){let r,a;return r=new Ts({props:{colspan:3,noBackground:!0,$$slots:{default:[TS]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function kS(c){let r,a=c[25].qualityInformationHtml+"",l;return{c(){r=new $u(!1),l=oi(),this.h()},l(u){r=ju(u,!1),l=oi(),this.h()},h(){r.a=l},m(u,f){r.m(a,u,f),Ze(u,l,f)},p:Ci,d(u){u&&(J(l),r.d())}}}function TS(c){let r,a;return r=new aS({props:{$$slots:{default:[kS]},$$scope:{ctx:c}}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u[1]&8&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function x_(c){let r,a;return r=new ly({props:{title:Af(c[28].key),table:c[28],data:c[0],chart_type:c[6]}}),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u[0]&1&&(f.title=Af(l[28].key)),u[0]&1&&(f.table=l[28]),u[0]&1&&(f.data=l[0]),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function CS(c){let r,a,l,u,f;r=new Ts({props:{colspan:3,noBackground:!0,$$slots:{default:[ES]},$$scope:{ctx:c}}});let d=c[25].qualityInformationHtml&&SS(c),n=Pi(c[25].tables.filter(c[16])),g=[];for(let E=0;E<n.length;E+=1)g[E]=x_(c_(c,n,E));const v=E=>st(g[E],1,1,()=>{g[E]=null});return{c(){ii(r.$$.fragment),a=mt(),d&&d.c(),l=mt();for(let E=0;E<g.length;E+=1)g[E].c();u=mt()},l(E){si(r.$$.fragment,E),a=gt(E),d&&d.l(E),l=gt(E);for(let S=0;S<g.length;S+=1)g[S].l(E);u=gt(E)},m(E,S){ri(r,E,S),Ze(E,a,S),d&&d.m(E,S),Ze(E,l,S);for(let T=0;T<g.length;T+=1)g[T]&&g[T].m(E,S);Ze(E,u,S),f=!0},p(E,S){const T={};if(S[1]&8&&(T.$$scope={dirty:S,ctx:E}),r.$set(T),S[0]&65){n=Pi(E[25].tables.filter(E[16]));let k;for(k=0;k<n.length;k+=1){const z=c_(E,n,k);g[k]?(g[k].p(z,S),Ye(g[k],1)):(g[k]=x_(z),g[k].c(),Ye(g[k],1),g[k].m(u.parentNode,u))}for(Ni(),k=n.length;k<g.length;k+=1)v(k);Ui()}},i(E){if(!f){Ye(r.$$.fragment,E),Ye(d);for(let S=0;S<n.length;S+=1)Ye(g[S]);f=!0}},o(E){st(r.$$.fragment,E),st(d),g=g.filter(Boolean);for(let S=0;S<g.length;S+=1)st(g[S]);f=!1},d(E){E&&(J(a),J(l),J(u)),ni(r,E),d&&d.d(E),Pr(g,E)}}}function E_(c){let r=c[25].shouldBeDisplayed&&c[25].tables.some(c[11]),a,l,u=r&&w_(c);return{c(){u&&u.c(),a=oi()},l(f){u&&u.l(f),a=oi()},m(f,d){u&&u.m(f,d),Ze(f,a,d),l=!0},p(f,d){d[0]&1&&(r=f[25].shouldBeDisplayed&&f[25].tables.some(f[11])),r?u?(u.p(f,d),d[0]&1&&Ye(u,1)):(u=w_(f),u.c(),Ye(u,1),u.m(a.parentNode,a)):u&&(Ni(),st(u,1,1,()=>{u=null}),Ui())},i(f){l||(Ye(u),l=!0)},o(f){st(u),l=!1},d(f){f&&J(a),u&&u.d(f)}}}function IS(c){let r;return{c(){r=Ut("Print profile")},l(a){r=Vt(a,"Print profile")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function S_(c){let r,a;return r=new Bf({props:{variant:"secondary",icon:"download",$$slots:{default:[AS]},$$scope:{ctx:c}}}),r.$on("click",c[17]),{c(){ii(r.$$.fragment)},l(l){si(r.$$.fragment,l)},m(l,u){ri(r,l,u),a=!0},p(l,u){const f={};u[1]&8&&(f.$$scope={dirty:u,ctx:l}),r.$set(f)},i(l){a||(Ye(r.$$.fragment,l),a=!0)},o(l){st(r.$$.fragment,l),a=!1},d(l){ni(r,l)}}}function AS(c){let r;return{c(){r=Ut("Download data (ODS, <100 kB)")},l(a){r=Vt(a,"Download data (ODS, <100 kB)")},m(a,l){Ze(a,r,l)},d(a){a&&J(r)}}}function PS(c){let r,a,l,u=_c(c[0]),f;a=new Bf({props:{variant:"secondary",icon:"print",$$slots:{default:[IS]},$$scope:{ctx:c}}}),a.$on("click",c[10]);let d=u&&S_(c);return{c(){r=$e("div"),ii(a.$$.fragment),l=mt(),d&&d.c(),this.h()},l(n){r=je(n,"DIV",{class:!0});var g=et(r);si(a.$$.fragment,g),l=gt(g),d&&d.l(g),g.forEach(J),this.h()},h(){_e(r,"class","use-this-profile-buttons")},m(n,g){Ze(n,r,g),ri(a,r,null),ze(r,l),d&&d.m(r,null),f=!0},p(n,g){const v={};g[1]&8&&(v.$$scope={dirty:g,ctx:n}),a.$set(v),g[0]&1&&(u=_c(n[0])),u?d?(d.p(n,g),g[0]&1&&Ye(d,1)):(d=S_(n),d.c(),Ye(d,1),d.m(r,null)):d&&(Ni(),st(d,1,1,()=>{d=null}),Ui())},i(n){f||(Ye(a.$$.fragment,n),Ye(d),f=!0)},o(n){st(a.$$.fragment,n),st(d),f=!1},d(n){n&&J(r),ni(a),d&&d.d()}}}function zS(c){let r,a='The data presented in this tool is derived from the <a href="https://www.ons.gov.uk/datasets/create" class="svelte-1mbdfig">Create a custom dataset</a> service, which allows you to make your own datasets combining multiple census variables. <a href="https://www.ons.gov.uk/aboutus/transparencyandgovernance/datastrategy/datapolicies/statisticaldisclosurecontrol" class="svelte-1mbdfig">Statistical disclosure control</a> methods are automatically applied to this data to ensure that the confidentiality of data subjects, including individuals and households, are protected.',l,u,f="Note that some population groups have age and geographic profiles that may affect other variables such as education, employment, health and housing. Take care when making comparisons between different groups.",d,n,g='* Some tables are presented in this tool using the base population "% of people in households". Values in these tables may vary significantly from other Census 2021 data sources using the base population "% of households".';return{c(){r=$e("p"),r.innerHTML=a,l=mt(),u=$e("p"),u.textContent=f,d=mt(),n=$e("p"),n.textContent=g},l(v){r=je(v,"P",{"data-svelte-h":!0}),lr(r)!=="svelte-1jo6t8x"&&(r.innerHTML=a),l=gt(v),u=je(v,"P",{"data-svelte-h":!0}),lr(u)!=="svelte-qzettw"&&(u.textContent=f),d=gt(v),n=je(v,"P",{"data-svelte-h":!0}),lr(n)!=="svelte-e30v4w"&&(n.textContent=g)},m(v,E){Ze(v,r,E),Ze(v,l,E),Ze(v,u,E),Ze(v,d,E),Ze(v,n,E)},p:Ci,d(v){v&&(J(r),J(l),J(u),J(d),J(n))}}}function MS(c){let r,a,l,u,f,d,n,g,v,E,S,T,k,z,A,R;S=new T1({props:{links:[{label:"Census",href:"/census"},{label:"Create a population group profile"}]}}),k=new av({props:{title:"Create a population group profile",$$slots:{after:[yS]},$$scope:{ctx:c}}});let D=c[3]=="success"&&c[1].length>0&&y_(c);return{c(){r=$e("meta"),a=$e("meta"),l=$e("meta"),u=$e("meta"),f=$e("meta"),d=$e("meta"),n=$e("meta"),g=$e("meta"),v=$e("link"),E=mt(),ii(S.$$.fragment),T=mt(),ii(k.$$.fragment),z=mt(),D&&D.c(),A=oi(),this.h()},l(F){const q=z_("svelte-w3mxea",ds.head);r=je(q,"META",{property:!0,content:!0}),a=je(q,"META",{property:!0,content:!0}),l=je(q,"META",{property:!0,content:!0}),u=je(q,"META",{property:!0,content:!0}),f=je(q,"META",{name:!0,content:!0}),d=je(q,"META",{property:!0,content:!0}),n=je(q,"META",{name:!0,content:!0}),g=je(q,"META",{property:!0,content:!0}),v=je(q,"LINK",{rel:!0,href:!0}),q.forEach(J),E=gt(F),si(S.$$.fragment,F),T=gt(F),si(k.$$.fragment,F),z=gt(F),D&&D.l(F),A=oi(),this.h()},h(){ds.title="Create a population group profile - Census 2021 - ONS",_e(r,"property","og:title"),_e(r,"content","Create a population group profile - Census 2021"),_e(a,"property","og:type"),_e(a,"content","website"),_e(l,"property","og:image"),_e(l,"content","https://www.ons.gov.uk"+qo+"/img/og.png"),_e(u,"property","og:image:type"),_e(u,"content","image/png"),_e(f,"name","twitter:card"),_e(f,"content","summary_large_image"),_e(d,"property","og:description"),_e(d,"content","Select multiple datasets to define a population group based on Census 2021 England and Wales data."),_e(n,"name","description"),_e(n,"content","Select multiple datasets to define a population group based on Census 2021 England and Wales data."),_e(g,"property","og:url"),_e(g,"content","https://www.ons.gov.uk"+qo),_e(v,"rel","canonical"),_e(v,"href","https://www.ons.gov.uk"+qo)},m(F,q){ze(ds.head,r),ze(ds.head,a),ze(ds.head,l),ze(ds.head,u),ze(ds.head,f),ze(ds.head,d),ze(ds.head,n),ze(ds.head,g),ze(ds.head,v),Ze(F,E,q),ri(S,F,q),Ze(F,T,q),ri(k,F,q),Ze(F,z,q),D&&D.m(F,q),Ze(F,A,q),R=!0},p(F,q){const ee={};q[0]&63|q[1]&8&&(ee.$$scope={dirty:q,ctx:F}),k.$set(ee),F[3]=="success"&&F[1].length>0?D?(D.p(F,q),q[0]&10&&Ye(D,1)):(D=y_(F),D.c(),Ye(D,1),D.m(A.parentNode,A)):D&&(Ni(),st(D,1,1,()=>{D=null}),Ui())},i(F){R||(Ye(S.$$.fragment,F),Ye(k.$$.fragment,F),Ye(D),R=!0)},o(F){st(S.$$.fragment,F),st(k.$$.fragment,F),st(D),R=!1},d(F){F&&(J(E),J(T),J(z),J(A)),J(r),J(a),J(l),J(u),J(f),J(d),J(n),J(g),J(v),ni(S,F),ni(k,F),D&&D.d(F)}}}let DS="light";function LS(c){let r=[];c.forEach(l=>r.push(l[0]));const a=c.flat().pop();return(c.length===1||a!=r[r.length-1])&&r.push(a),r}function _c(c){return c.selected.total_pop.count!=null&&c.selected.total_pop.count>=100}function k_(c){return c.selected!=null&&c.availableChartCounts.missing>0&&_c(c)}const T_=c=>c.key;function RS(c,r,a){let l;qu(c,p1,ye=>a(19,l=ye));let{data:u}=r;Za("theme",c1[DS]);let f=[],d=!1,n="success",g=!1,v=_2,E=null;function S(ye){o2(`${qo}?${ye.map(Xe=>`${Xe.key}=${Xe.code}`).join("&")}`,{noScroll:!0,keepFocus:!0})}function T(ye,Xe){const ae=[...f.filter(Le=>Le.topic!==ye.shortLabel),{topic:ye.shortLabel,longLabel:ye.label,key:ye.key,...Xe}];hf({event:"variableSelect",variable:ye.shortLabel,category:Xe.label,count:ae.length}),S(ae)}function k(ye){const Xe=f.filter(ae=>ae.topic!==ye);S(Xe)}function z(ye){hf({event:"fileDownload",fileExtension:"ods",selection:f.map(Le=>`${Le.topic}: ${Le.label}`)});let Xe=r2(ye,jo,f);const ae=new lS;for(let{filename:Le,contents:Z}of Xe)ae.file(Le,Z,{compression:Le==="mimetype"?"STORE":"DEFLATE"});ae.generateAsync({type:"blob"}).then(Le=>{let Z=new Blob([Le],{type:"application/vnd.oasis.opendocument.spreadsheet"}),$t=(window.URL||window.webkitURL||window).createObjectURL(Z),ft=document.createElement("a");ft.download="population-profile-"+f.map(Jt=>`${Jt.key}-${Jt.code}`).join("-")+".ods",ft.href=$t,ft.style.display="none",document.body.appendChild(ft),ft.click(),document.body.removeChild(ft)})}function A(){hf({event:"pagePrint",selection:f.map(ye=>`${ye.topic}: ${ye.label}`)}),print()}function R(ye){a(0,u.selected=ye.data,u),a(0,u.selected.total_pop=ye.total_pop,u),a(0,u.geoPerc=[],u);let Xe;u.geoCodesAndNames.forEach(({code:Le,name:Z})=>{let tt=f.length===0?100:ye.mapData[Le]!=null?ye.mapData[Le][1]:null,$t=f.length===0?-1:ye.mapData[Le]!=null?ye.mapData[Le][0]:null;u.geoPerc.push({code:Le,name:Z,value:tt,count:$t})});let ae=u.geoPerc.map(Le=>Le.value).filter(Le=>Le!=null);if(Xe=ae.length===0?null:f2(ae,Math.min(5,ae.length)),!Xe)u.geoPerc.forEach(Le=>Le.color=Vo.nodata),a(0,u.geoBreaks=[0,100],u);else if(f.length===0)u.geoPerc.forEach(Le=>Le.color=Vo.seq[4]),a(0,u.geoBreaks=[100,100],u);else{let Le=LS(Xe);u.geoPerc.forEach(Z=>Z.color=Z.value!=null?Qx(Z.value,Le,Vo.seq):Vo.nodata),a(0,u.geoBreaks=Le,u)}f.length,a(0,u.statusOfVariables=n2(u.selected,jo[0].tables),u),a(0,u.availableChartCounts=s2(u.statusOfVariables),u),a(3,n=u.selected.total_pop.count==null?"failed":"success")}function D(){a(3,n="loading"),a(4,g=f&&f.some(ye=>["Aged 4 years and under","Aged 5 to 9 years","Aged 10 to 14 years","Aged 15 years and under"].includes(ye.label))),ry(jo,f).then(R)}function F(){a(1,f=[]);for(let ye of l.url.searchParams.entries()){let Xe=u1.find(Le=>Le.key==ye[0]);if(!Xe)continue;let ae=Xe.cats.find(Le=>Le.code==ye[1]);ae&&f.push({topic:Xe.shortLabel,longLabel:Xe.label,key:Xe.key,...ae})}D()}l2(()=>{F(),a(2,d=!1),a(5,E=null)});const q=ye=>Pf(ye.code,u),ee=ye=>k(ye.topic),ie=ye=>k(ye.shortLabel);function ne(ye){E=ye,a(5,E)}function se(ye){d=ye,a(2,d)}const ue=ye=>Pf(ye.code,u),Ce=()=>z(u);return c.$$set=ye=>{"data"in ye&&a(0,u=ye.data)},[u,f,d,n,g,E,v,T,k,z,A,q,ee,ie,ne,se,ue,Ce]}class ZS extends $i{constructor(r){super(),ji(this,r,RS,MS,Fi,{data:0},null,[-1,-1])}}export{ZS as component,jS as universal};
